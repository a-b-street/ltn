var FS=Object.defineProperty;var OS=(r,e,t)=>e in r?FS(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var Wn=(r,e,t)=>(OS(r,typeof e!="symbol"?e+"":e,t),t);function NS(r,e){for(var t=0;t<e.length;t++){const n=e[t];if(typeof n!="string"&&!Array.isArray(n)){for(const l in n)if(l!=="default"&&!(l in r)){const u=Object.getOwnPropertyDescriptor(n,l);u&&Object.defineProperty(r,l,u.get?u:{enumerable:!0,get:()=>n[l]})}}}return Object.freeze(Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))n(l);new MutationObserver(l=>{for(const u of l)if(u.type==="childList")for(const f of u.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&n(f)}).observe(document,{childList:!0,subtree:!0});function t(l){const u={};return l.integrity&&(u.integrity=l.integrity),l.referrerPolicy&&(u.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?u.credentials="include":l.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function n(l){if(l.ep)return;l.ep=!0;const u=t(l);fetch(l.href,u)}})();function It(){}function mn(r,e){for(const t in e)r[t]=e[t];return r}function Eb(r){return r()}function Ny(){return Object.create(null)}function yn(r){r.forEach(Eb)}function Sc(r){return typeof r=="function"}function Vt(r,e){return r!=r?e==e:r!==e||r&&typeof r=="object"||typeof r=="function"}let Vf;function Mn(r,e){return r===e?!0:(Vf||(Vf=document.createElement("a")),Vf.href=e,r===Vf.href)}function jS(r){return Object.keys(r).length===0}function Cb(r,...e){if(r==null){for(const n of e)n(void 0);return It}const t=r.subscribe(...e);return t.unsubscribe?()=>t.unsubscribe():t}function Hi(r){let e;return Cb(r,t=>e=t)(),e}function pt(r,e,t){r.$$.on_destroy.push(Cb(e,t))}function $r(r,e,t,n){if(r){const l=Mb(r,e,t,n);return r[0](l)}}function Mb(r,e,t,n){return r[1]&&n?mn(t.ctx.slice(),r[1](n(e))):t.ctx}function qr(r,e,t,n){if(r[2]&&n){const l=r[2](n(t));if(e.dirty===void 0)return l;if(typeof l=="object"){const u=[],f=Math.max(e.dirty.length,l.length);for(let a=0;a<f;a+=1)u[a]=e.dirty[a]|l[a];return u}return e.dirty|l}return e.dirty}function Gr(r,e,t,n,l,u){if(l){const f=Mb(e,t,n,u);r.p(f,l)}}function Wr(r){if(r.ctx.length>32){const e=[],t=r.ctx.length/32;for(let n=0;n<t;n++)e[n]=-1;return e}return-1}function US(r){const e={};for(const t in r)e[t]=!0;return e}function fd(r){return r??""}function Lt(r,e,t){return r.set(t),e}function zm(r){return r&&Sc(r.destroy)?r.destroy:It}const Fd=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function re(r,e){r.appendChild(e)}function me(r,e,t){r.insertBefore(e,t||null)}function pe(r){r.parentNode&&r.parentNode.removeChild(r)}function Bs(r,e){for(let t=0;t<r.length;t+=1)r[t]&&r[t].d(e)}function ce(r){return document.createElement(r)}function Ds(r){return document.createElementNS("http://www.w3.org/2000/svg",r)}function tt(r){return document.createTextNode(r)}function Ue(){return tt(" ")}function Hn(){return tt("")}function Ct(r,e,t,n){return r.addEventListener(e,t,n),()=>r.removeEventListener(e,t,n)}function Sg(r){return function(e){return e.preventDefault(),r.call(this,e)}}function tm(r){return function(e){return e.stopPropagation(),r.call(this,e)}}function Te(r,e,t){t==null?r.removeAttribute(e):r.getAttribute(e)!==t&&r.setAttribute(e,t)}function Ib(r){let e;return{p(...t){e=t,e.forEach(n=>r.push(n))},r(){e.forEach(t=>r.splice(r.indexOf(t),1))}}}function kg(r){return r===""?null:+r}function VS(r){return Array.from(r.childNodes)}function Ar(r,e){e=""+e,r.data!==e&&(r.data=e)}function ti(r,e){r.value=e??""}function pn(r,e,t,n){t==null?r.style.removeProperty(e):r.style.setProperty(e,t,n?"important":"")}function dd(r,e,t){for(let n=0;n<r.options.length;n+=1){const l=r.options[n];if(l.__value===e){l.selected=!0;return}}(!t||e!==void 0)&&(r.selectedIndex=-1)}function Ab(r){const e=r.querySelector(":checked");return e&&e.__value}function fi(r,e,t){r.classList.toggle(e,!!t)}function $S(r,e,{bubbles:t=!1,cancelable:n=!1}={}){return new CustomEvent(r,{detail:e,bubbles:t,cancelable:n})}let uh;function th(r){uh=r}function Ch(){if(!uh)throw new Error("Function called outside component initialization");return uh}function Od(r){Ch().$$.on_mount.push(r)}function ni(r){Ch().$$.on_destroy.push(r)}function us(){const r=Ch();return(e,t,{cancelable:n=!1}={})=>{const l=r.$$.callbacks[e];if(l){const u=$S(e,t,{cancelable:n});return l.slice().forEach(f=>{f.call(r,u)}),!u.defaultPrevented}return!0}}function Tg(r,e){return Ch().$$.context.set(r,e),e}function Lb(r){return Ch().$$.context.get(r)}function fr(r,e){const t=r.$$.callbacks[e.type];t&&t.slice().forEach(n=>n.call(this,e))}const dc=[],nn=[];let vc=[];const Dm=[],Pb=Promise.resolve();let Rm=!1;function zb(){Rm||(Rm=!0,Pb.then(Rb))}function Db(){return zb(),Pb}function hh(r){vc.push(r)}function ro(r){Dm.push(r)}const rm=new Set;let oc=0;function Rb(){if(oc!==0)return;const r=uh;do{try{for(;oc<dc.length;){const e=dc[oc];oc++,th(e),qS(e.$$)}}catch(e){throw dc.length=0,oc=0,e}for(th(null),dc.length=0,oc=0;nn.length;)nn.pop()();for(let e=0;e<vc.length;e+=1){const t=vc[e];rm.has(t)||(rm.add(t),t())}vc.length=0}while(dc.length);for(;Dm.length;)Dm.pop()();Rm=!1,rm.clear(),th(r)}function qS(r){if(r.fragment!==null){r.update(),yn(r.before_update);const e=r.dirty;r.dirty=[-1],r.fragment&&r.fragment.p(r.ctx,e),r.after_update.forEach(hh)}}function GS(r){const e=[],t=[];vc.forEach(n=>r.indexOf(n)===-1?e.push(n):t.push(n)),t.forEach(n=>n()),vc=e}const Kf=new Set;let Ya;function vr(){Ya={r:0,c:[],p:Ya}}function br(){Ya.r||yn(Ya.c),Ya=Ya.p}function oe(r,e){r&&r.i&&(Kf.delete(r),r.i(e))}function ue(r,e,t,n){if(r&&r.o){if(Kf.has(r))return;Kf.add(r),Ya.c.push(()=>{Kf.delete(r),n&&(t&&r.d(1),n())}),r.o(e)}else n&&n()}function Jn(r){return(r==null?void 0:r.length)!==void 0?r:Array.from(r)}function WS(r,e){ue(r,1,1,()=>{e.delete(r.key)})}function ZS(r,e,t,n,l,u,f,a,_,x,k,S){let C=r.length,z=u.length,R=C;const D={};for(;R--;)D[r[R].key]=R;const P=[],B=new Map,N=new Map,V=[];for(R=z;R--;){const H=S(l,u,R),J=t(H);let ye=f.get(J);ye?n&&V.push(()=>ye.p(H,e)):(ye=x(J,H),ye.c()),B.set(J,P[R]=ye),J in D&&N.set(J,Math.abs(R-D[J]))}const U=new Set,te=new Set;function le(H){oe(H,1),H.m(a,k),f.set(H.key,H),k=H.first,z--}for(;C&&z;){const H=P[z-1],J=r[C-1],ye=H.key,ze=J.key;H===J?(k=H.first,C--,z--):B.has(ze)?!f.has(ye)||U.has(ye)?le(H):te.has(ze)?C--:N.get(ye)>N.get(ze)?(te.add(ye),le(H)):(U.add(ze),C--):(_(J,f),C--)}for(;C--;){const H=r[C];B.has(H.key)||_(H,f)}for(;z;)le(P[z-1]);return yn(V),P}function pd(r,e){const t={},n={},l={$$scope:1};let u=r.length;for(;u--;){const f=r[u],a=e[u];if(a){for(const _ in f)_ in a||(n[_]=1);for(const _ in a)l[_]||(t[_]=a[_],l[_]=1);r[u]=a}else for(const _ in f)l[_]=1}for(const f in n)f in t||(t[f]=void 0);return t}function no(r,e,t){const n=r.$$.props[e];n!==void 0&&(r.$$.bound[n]=t,t(r.$$.ctx[n]))}function Oe(r){r&&r.c()}function Be(r,e,t){const{fragment:n,after_update:l}=r.$$;n&&n.m(e,t),hh(()=>{const u=r.$$.on_mount.map(Eb).filter(Sc);r.$$.on_destroy?r.$$.on_destroy.push(...u):yn(u),r.$$.on_mount=[]}),l.forEach(hh)}function Fe(r,e){const t=r.$$;t.fragment!==null&&(GS(t.after_update),yn(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function HS(r,e){r.$$.dirty[0]===-1&&(dc.push(r),zb(),r.$$.dirty.fill(0)),r.$$.dirty[e/31|0]|=1<<e%31}function Wt(r,e,t,n,l,u,f=null,a=[-1]){const _=uh;th(r);const x=r.$$={fragment:null,ctx:[],props:u,update:It,not_equal:l,bound:Ny(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(_?_.$$.context:[])),callbacks:Ny(),dirty:a,skip_bound:!1,root:e.target||_.$$.root};f&&f(x.root);let k=!1;if(x.ctx=t?t(r,e.props||{},(S,C,...z)=>{const R=z.length?z[0]:C;return x.ctx&&l(x.ctx[S],x.ctx[S]=R)&&(!x.skip_bound&&x.bound[S]&&x.bound[S](R),k&&HS(r,S)),C}):[],x.update(),k=!0,yn(x.before_update),x.fragment=n?n(x.ctx):!1,e.target){if(e.hydrate){const S=VS(e.target);x.fragment&&x.fragment.l(S),S.forEach(pe)}else x.fragment&&x.fragment.c();e.intro&&oe(r.$$.fragment),Be(r,e.target,e.anchor),Rb()}th(_)}class Zt{constructor(){Wn(this,"$$");Wn(this,"$$set")}$destroy(){Fe(this,1),this.$destroy=It}$on(e,t){if(!Sc(t))return It;const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const l=n.indexOf(t);l!==-1&&n.splice(l,1)}}$set(e){this.$$set&&!jS(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const XS="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(XS);function jy(r){let e,t;return{c(){e=ce("div"),t=tt(r[0]),Te(e,"class","svelte-1uuov7f")},m(n,l){me(n,e,l),re(e,t)},p(n,l){l&1&&Ar(t,n[0])},d(n){n&&pe(e)}}}function KS(r){let e,t=r[0]&&jy(r);return{c(){t&&t.c(),e=Hn()},m(n,l){t&&t.m(n,l),me(n,e,l)},p(n,[l]){n[0]?t?t.p(n,l):(t=jy(n),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:It,o:It,d(n){n&&pe(e),t&&t.d(n)}}}function JS(r,e,t){let{loading:n}=e;return r.$$set=l=>{"loading"in l&&t(0,n=l.loading)},[n]}class Bb extends Zt{constructor(e){super(),Wt(this,e,JS,KS,Vt,{loading:0})}}const YS=r=>({dialog:r&1}),Uy=r=>({dialog:r[0]});function QS(r){let e,t,n,l,u;const f=r[4].default,a=$r(f,r,r[3],Uy);return{c(){e=ce("dialog"),t=ce("article"),a&&a.c(),e.open=!0},m(_,x){me(_,e,x),re(e,t),a&&a.m(t,null),r[6](e),n=!0,l||(u=[Ct(window,"click",r[1]),Ct(window,"keydown",r[2]),Ct(e,"close",r[5])],l=!0)},p(_,[x]){a&&a.p&&(!n||x&9)&&Gr(a,f,_,_[3],n?qr(f,_[3],x,YS):Wr(_[3]),Uy)},i(_){n||(oe(a,_),n=!0)},o(_){ue(a,_),n=!1},d(_){_&&pe(e),a&&a.d(_),r[6](null),l=!1,yn(u)}}}function ek(r,e,t){let{$$slots:n={},$$scope:l}=e,u;function f(k){u.open&&k.target==u&&u.close()}function a(k){(k.key=="Escape"||k.key=="Enter")&&(k.stopPropagation(),u.close())}function _(k){fr.call(this,r,k)}function x(k){nn[k?"unshift":"push"](()=>{u=k,t(0,u)})}return r.$$set=k=>{"$$scope"in k&&t(3,l=k.$$scope)},[u,f,a,l,n,_,x]}class Nd extends Zt{constructor(e){super(),Wt(this,e,ek,QS,Vt,{})}}function Vy(r,e,t){const n=r.slice();return n[1]=e[t][0],n[2]=e[t][1],n}function $y(r){let e,t,n=r[1]+"",l,u,f,a=r[2]+"",_,x;return{c(){e=ce("tr"),t=ce("td"),l=tt(n),u=Ue(),f=ce("td"),_=tt(a),x=Ue()},m(k,S){me(k,e,S),re(e,t),re(t,l),re(e,u),re(e,f),re(f,_),re(e,x)},p(k,S){S&1&&n!==(n=k[1]+"")&&Ar(l,n),S&1&&a!==(a=k[2]+"")&&Ar(_,a)},d(k){k&&pe(e)}}}function tk(r){let e,t,n=Jn(Object.entries(r[0])),l=[];for(let u=0;u<n.length;u+=1)l[u]=$y(Vy(r,n,u));return{c(){e=ce("table"),t=ce("tbody");for(let u=0;u<l.length;u+=1)l[u].c();Te(e,"class","svelte-lh2o9l")},m(u,f){me(u,e,f),re(e,t);for(let a=0;a<l.length;a+=1)l[a]&&l[a].m(t,null)},p(u,[f]){if(f&1){n=Jn(Object.entries(u[0]));let a;for(a=0;a<n.length;a+=1){const _=Vy(u,n,a);l[a]?l[a].p(_,f):(l[a]=$y(_),l[a].c(),l[a].m(t,null))}for(;a<l.length;a+=1)l[a].d(1);l.length=n.length}},i:It,o:It,d(u){u&&pe(e),Bs(l,u)}}}function rk(r,e,t){let{properties:n}=e;return r.$$set=l=>{"properties"in l&&t(0,n=l.properties)},[n]}class jd extends Zt{constructor(e){super(),Wt(this,e,rk,tk,Vt,{properties:0})}}function md(r,e){let t=document.createElement("a");t.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(e)),t.setAttribute("download",r),document.body.appendChild(t),t.click(),document.body.removeChild(t)}function rn(r){if(r==null||r==null)throw new Error("Oops, notNull given something null");return r}let at;const Fb=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&Fb.decode();let Zu=null;function bc(){return(Zu===null||Zu.byteLength===0)&&(Zu=new Uint8Array(at.memory.buffer)),Zu}function Gi(r,e){return r=r>>>0,Fb.decode(bc().subarray(r,r+e))}const Ps=new Array(128).fill(void 0);Ps.push(void 0,null,!0,!1);let rh=Ps.length;function Vr(r){rh===Ps.length&&Ps.push(Ps.length+1);const e=rh;return rh=Ps[e],Ps[e]=r,e}function dr(r){return Ps[r]}function nk(r){r<132||(Ps[r]=rh,rh=r)}function bi(r){const e=dr(r);return nk(r),e}let Wi=0;const Jf=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},ik=typeof Jf.encodeInto=="function"?function(r,e){return Jf.encodeInto(r,e)}:function(r,e){const t=Jf.encode(r);return e.set(t),{read:r.length,written:t.length}};function Go(r,e,t){if(t===void 0){const a=Jf.encode(r),_=e(a.length,1)>>>0;return bc().subarray(_,_+a.length).set(a),Wi=a.length,_}let n=r.length,l=e(n,1)>>>0;const u=bc();let f=0;for(;f<n;f++){const a=r.charCodeAt(f);if(a>127)break;u[l+f]=a}if(f!==n){f!==0&&(r=r.slice(f)),l=t(l,n,n=f+r.length*3,1)>>>0;const a=bc().subarray(l+f,l+n),_=ik(r,a);f+=_.written}return Wi=f,l}function pc(r){return r==null}let Hu=null;function $t(){return(Hu===null||Hu.byteLength===0)&&(Hu=new Int32Array(at.memory.buffer)),Hu}let Xu=null;function Ob(){return(Xu===null||Xu.byteLength===0)&&(Xu=new Float64Array(at.memory.buffer)),Xu}let Ku=null;function ok(){return(Ku===null||Ku.byteLength===0)&&(Ku=new BigInt64Array(at.memory.buffer)),Ku}function Bm(r){const e=typeof r;if(e=="number"||e=="boolean"||r==null)return`${r}`;if(e=="string")return`"${r}"`;if(e=="symbol"){const l=r.description;return l==null?"Symbol":`Symbol(${l})`}if(e=="function"){const l=r.name;return typeof l=="string"&&l.length>0?`Function(${l})`:"Function"}if(Array.isArray(r)){const l=r.length;let u="[";l>0&&(u+=Bm(r[0]));for(let f=1;f<l;f++)u+=", "+Bm(r[f]);return u+="]",u}const t=/\[object ([^\]]+)\]/.exec(toString.call(r));let n;if(t.length>1)n=t[1];else return toString.call(r);if(n=="Object")try{return"Object("+JSON.stringify(r)+")"}catch{return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:n}function sk(r,e){const t=e(r.length*1,1)>>>0;return bc().set(r,t/1),Wi=r.length,t}function ak(r,e){return r=r>>>0,Ob().subarray(r/8,r/8+e)}function lk(r,e){return r=r>>>0,bc().subarray(r/1,r/1+e)}function Ja(r,e){try{return r.apply(this,e)}catch(t){at.__wbindgen_exn_store(Vr(t))}}class Nb{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();at.__wbg_ltn_free(e)}constructor(e,t,n){try{const x=at.__wbindgen_add_to_stack_pointer(-16),k=sk(e,at.__wbindgen_malloc),S=Wi;var l=pc(n)?0:Go(n,at.__wbindgen_malloc,at.__wbindgen_realloc),u=Wi;at.ltn_new(x,k,S,Vr(t),l,u);var f=$t()[x/4+0],a=$t()[x/4+1],_=$t()[x/4+2];if(_)throw bi(a);return this.__wbg_ptr=f>>>0,this}finally{at.__wbindgen_add_to_stack_pointer(16)}}getInvertedBoundary(){let e,t;try{const x=at.__wbindgen_add_to_stack_pointer(-16);at.ltn_getInvertedBoundary(x,this.__wbg_ptr);var n=$t()[x/4+0],l=$t()[x/4+1],u=$t()[x/4+2],f=$t()[x/4+3],a=n,_=l;if(f)throw a=0,_=0,bi(u);return e=a,t=_,Gi(a,_)}finally{at.__wbindgen_add_to_stack_pointer(16),at.__wbindgen_free(e,t,1)}}getBounds(){try{const l=at.__wbindgen_add_to_stack_pointer(-16);at.ltn_getBounds(l,this.__wbg_ptr);var e=$t()[l/4+0],t=$t()[l/4+1],n=ak(e,t).slice();return at.__wbindgen_free(e,t*8,8),n}finally{at.__wbindgen_add_to_stack_pointer(16)}}toRouteSnapper(){try{const l=at.__wbindgen_add_to_stack_pointer(-16);at.ltn_toRouteSnapper(l,this.__wbg_ptr);var e=$t()[l/4+0],t=$t()[l/4+1],n=lk(e,t).slice();return at.__wbindgen_free(e,t*1,1),n}finally{at.__wbindgen_add_to_stack_pointer(16)}}toRouteSnapperGj(){let e,t;try{const x=at.__wbindgen_add_to_stack_pointer(-16);at.ltn_toRouteSnapperGj(x,this.__wbg_ptr);var n=$t()[x/4+0],l=$t()[x/4+1],u=$t()[x/4+2],f=$t()[x/4+3],a=n,_=l;if(f)throw a=0,_=0,bi(u);return e=a,t=_,Gi(a,_)}finally{at.__wbindgen_add_to_stack_pointer(16),at.__wbindgen_free(e,t,1)}}renderModalFilters(){let e,t;try{const x=at.__wbindgen_add_to_stack_pointer(-16);at.ltn_renderModalFilters(x,this.__wbg_ptr);var n=$t()[x/4+0],l=$t()[x/4+1],u=$t()[x/4+2],f=$t()[x/4+3],a=n,_=l;if(f)throw a=0,_=0,bi(u);return e=a,t=_,Gi(a,_)}finally{at.__wbindgen_add_to_stack_pointer(16),at.__wbindgen_free(e,t,1)}}renderNeighbourhood(){let e,t;try{const x=at.__wbindgen_add_to_stack_pointer(-16);at.ltn_renderNeighbourhood(x,this.__wbg_ptr);var n=$t()[x/4+0],l=$t()[x/4+1],u=$t()[x/4+2],f=$t()[x/4+3],a=n,_=l;if(f)throw a=0,_=0,bi(u);return e=a,t=_,Gi(a,_)}finally{at.__wbindgen_add_to_stack_pointer(16),at.__wbindgen_free(e,t,1)}}renderAutoBoundaries(){let e,t;try{const x=at.__wbindgen_add_to_stack_pointer(-16);at.ltn_renderAutoBoundaries(x,this.__wbg_ptr);var n=$t()[x/4+0],l=$t()[x/4+1],u=$t()[x/4+2],f=$t()[x/4+3],a=n,_=l;if(f)throw a=0,_=0,bi(u);return e=a,t=_,Gi(a,_)}finally{at.__wbindgen_add_to_stack_pointer(16),at.__wbindgen_free(e,t,1)}}setNeighbourhoodBoundary(e,t){try{const u=at.__wbindgen_add_to_stack_pointer(-16),f=Go(e,at.__wbindgen_malloc,at.__wbindgen_realloc),a=Wi;at.ltn_setNeighbourhoodBoundary(u,this.__wbg_ptr,f,a,Vr(t));var n=$t()[u/4+0],l=$t()[u/4+1];if(l)throw bi(n)}finally{at.__wbindgen_add_to_stack_pointer(16)}}deleteNeighbourhoodBoundary(e){const t=Go(e,at.__wbindgen_malloc,at.__wbindgen_realloc),n=Wi;at.ltn_deleteNeighbourhoodBoundary(this.__wbg_ptr,t,n)}renameNeighbourhoodBoundary(e,t){const n=Go(e,at.__wbindgen_malloc,at.__wbindgen_realloc),l=Wi,u=Go(t,at.__wbindgen_malloc,at.__wbindgen_realloc),f=Wi;at.ltn_renameNeighbourhoodBoundary(this.__wbg_ptr,n,l,u,f)}setCurrentNeighbourhood(e,t){try{const u=at.__wbindgen_add_to_stack_pointer(-16),f=Go(e,at.__wbindgen_malloc,at.__wbindgen_realloc),a=Wi;at.ltn_setCurrentNeighbourhood(u,this.__wbg_ptr,f,a,t);var n=$t()[u/4+0],l=$t()[u/4+1];if(l)throw bi(n)}finally{at.__wbindgen_add_to_stack_pointer(16)}}addModalFilter(e,t){try{const u=at.__wbindgen_add_to_stack_pointer(-16),f=Go(t,at.__wbindgen_malloc,at.__wbindgen_realloc),a=Wi;at.ltn_addModalFilter(u,this.__wbg_ptr,Vr(e),f,a);var n=$t()[u/4+0],l=$t()[u/4+1];if(l)throw bi(n)}finally{at.__wbindgen_add_to_stack_pointer(16)}}addManyModalFilters(e,t){try{const u=at.__wbindgen_add_to_stack_pointer(-16),f=Go(t,at.__wbindgen_malloc,at.__wbindgen_realloc),a=Wi;at.ltn_addManyModalFilters(u,this.__wbg_ptr,Vr(e),f,a);var n=$t()[u/4+0],l=$t()[u/4+1];if(l)throw bi(n)}finally{at.__wbindgen_add_to_stack_pointer(16)}}deleteModalFilter(e){at.ltn_deleteModalFilter(this.__wbg_ptr,e)}toggleDirection(e){at.ltn_toggleDirection(this.__wbg_ptr,e)}undo(){at.ltn_undo(this.__wbg_ptr)}redo(){at.ltn_redo(this.__wbg_ptr)}getShortcutsCrossingRoad(e){let t,n;try{const k=at.__wbindgen_add_to_stack_pointer(-16);at.ltn_getShortcutsCrossingRoad(k,this.__wbg_ptr,e);var l=$t()[k/4+0],u=$t()[k/4+1],f=$t()[k/4+2],a=$t()[k/4+3],_=l,x=u;if(a)throw _=0,x=0,bi(f);return t=_,n=x,Gi(_,x)}finally{at.__wbindgen_add_to_stack_pointer(16),at.__wbindgen_free(t,n,1)}}getAllShortcuts(){let e,t;try{const x=at.__wbindgen_add_to_stack_pointer(-16);at.ltn_getAllShortcuts(x,this.__wbg_ptr);var n=$t()[x/4+0],l=$t()[x/4+1],u=$t()[x/4+2],f=$t()[x/4+3],a=n,_=l;if(f)throw a=0,_=0,bi(u);return e=a,t=_,Gi(a,_)}finally{at.__wbindgen_add_to_stack_pointer(16),at.__wbindgen_free(e,t,1)}}toSavefile(){let e,t;try{const x=at.__wbindgen_add_to_stack_pointer(-16);at.ltn_toSavefile(x,this.__wbg_ptr);var n=$t()[x/4+0],l=$t()[x/4+1],u=$t()[x/4+2],f=$t()[x/4+3],a=n,_=l;if(f)throw a=0,_=0,bi(u);return e=a,t=_,Gi(a,_)}finally{at.__wbindgen_add_to_stack_pointer(16),at.__wbindgen_free(e,t,1)}}loadSavefile(e){try{const l=at.__wbindgen_add_to_stack_pointer(-16);at.ltn_loadSavefile(l,this.__wbg_ptr,Vr(e));var t=$t()[l/4+0],n=$t()[l/4+1];if(n)throw bi(t)}finally{at.__wbindgen_add_to_stack_pointer(16)}}compareRoute(e,t,n,l,u){let f,a;try{const R=at.__wbindgen_add_to_stack_pointer(-16);at.ltn_compareRoute(R,this.__wbg_ptr,e,t,n,l,u);var _=$t()[R/4+0],x=$t()[R/4+1],k=$t()[R/4+2],S=$t()[R/4+3],C=_,z=x;if(S)throw C=0,z=0,bi(k);return f=C,a=z,Gi(C,z)}finally{at.__wbindgen_add_to_stack_pointer(16),at.__wbindgen_free(f,a,1)}}impactToOneDestination(e,t){let n,l;try{const S=at.__wbindgen_add_to_stack_pointer(-16);at.ltn_impactToOneDestination(S,this.__wbg_ptr,e,t);var u=$t()[S/4+0],f=$t()[S/4+1],a=$t()[S/4+2],_=$t()[S/4+3],x=u,k=f;if(_)throw x=0,k=0,bi(a);return n=x,l=k,Gi(x,k)}finally{at.__wbindgen_add_to_stack_pointer(16),at.__wbindgen_free(n,l,1)}}}async function ck(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(n){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const t=await r.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(r,e);return t instanceof WebAssembly.Instance?{instance:t,module:r}:t}}function uk(){const r={};return r.wbg={},r.wbg.__wbindgen_error_new=function(e,t){const n=new Error(Gi(e,t));return Vr(n)},r.wbg.__wbindgen_object_drop_ref=function(e){bi(e)},r.wbg.__wbindgen_string_get=function(e,t){const n=dr(t),l=typeof n=="string"?n:void 0;var u=pc(l)?0:Go(l,at.__wbindgen_malloc,at.__wbindgen_realloc),f=Wi;$t()[e/4+1]=f,$t()[e/4+0]=u},r.wbg.__wbindgen_string_new=function(e,t){const n=Gi(e,t);return Vr(n)},r.wbg.__wbindgen_boolean_get=function(e){const t=dr(e);return typeof t=="boolean"?t?1:0:2},r.wbg.__wbindgen_is_bigint=function(e){return typeof dr(e)=="bigint"},r.wbg.__wbindgen_number_get=function(e,t){const n=dr(t),l=typeof n=="number"?n:void 0;Ob()[e/8+1]=pc(l)?0:l,$t()[e/4+0]=!pc(l)},r.wbg.__wbindgen_is_object=function(e){const t=dr(e);return typeof t=="object"&&t!==null},r.wbg.__wbindgen_in=function(e,t){return dr(e)in dr(t)},r.wbg.__wbindgen_bigint_from_i64=function(e){return Vr(e)},r.wbg.__wbindgen_jsval_eq=function(e,t){return dr(e)===dr(t)},r.wbg.__wbindgen_bigint_from_u64=function(e){const t=BigInt.asUintN(64,e);return Vr(t)},r.wbg.__wbindgen_is_undefined=function(e){return dr(e)===void 0},r.wbg.__wbindgen_jsval_loose_eq=function(e,t){return dr(e)==dr(t)},r.wbg.__wbindgen_object_clone_ref=function(e){const t=dr(e);return Vr(t)},r.wbg.__wbg_getwithrefkey_3b3c46ba20582127=function(e,t){const n=dr(e)[dr(t)];return Vr(n)},r.wbg.__wbg_debug_34c9290896ec9856=function(e){console.debug(dr(e))},r.wbg.__wbg_error_e60eff06f24ab7a4=function(e){console.error(dr(e))},r.wbg.__wbg_info_d7d58472d0bab115=function(e){console.info(dr(e))},r.wbg.__wbg_log_a4530b4fe289336f=function(e){console.log(dr(e))},r.wbg.__wbg_warn_f260f49434e45e62=function(e){console.warn(dr(e))},r.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return Vr(e)},r.wbg.__wbg_stack_658279fe44541cf6=function(e,t){const n=dr(t).stack,l=Go(n,at.__wbindgen_malloc,at.__wbindgen_realloc),u=Wi;$t()[e/4+1]=u,$t()[e/4+0]=l},r.wbg.__wbg_error_f851667af71bcfc6=function(e,t){let n,l;try{n=e,l=t,console.error(Gi(e,t))}finally{at.__wbindgen_free(n,l,1)}},r.wbg.__wbg_performance_3f3012faa4463882=function(e){const t=dr(e).performance;return Vr(t)},r.wbg.__wbg_now_2fd65358804c9485=function(e){return dr(e).now()},r.wbg.__wbg_get_f01601b5a68d10e3=function(e,t){const n=dr(e)[t>>>0];return Vr(n)},r.wbg.__wbg_length_1009b1af0c481d7b=function(e){return dr(e).length},r.wbg.__wbindgen_is_function=function(e){return typeof dr(e)=="function"},r.wbg.__wbg_newnoargs_c62ea9419c21fbac=function(e,t){const n=new Function(Gi(e,t));return Vr(n)},r.wbg.__wbg_next_9b877f231f476d01=function(e){const t=dr(e).next;return Vr(t)},r.wbg.__wbg_next_6529ee0cca8d57ed=function(){return Ja(function(e){const t=dr(e).next();return Vr(t)},arguments)},r.wbg.__wbg_done_5fe336b092d60cf2=function(e){return dr(e).done},r.wbg.__wbg_value_0c248a78fdc8e19f=function(e){const t=dr(e).value;return Vr(t)},r.wbg.__wbg_iterator_db7ca081358d4fb2=function(){return Vr(Symbol.iterator)},r.wbg.__wbg_get_7b48513de5dc5ea4=function(){return Ja(function(e,t){const n=Reflect.get(dr(e),dr(t));return Vr(n)},arguments)},r.wbg.__wbg_call_90c26b09837aba1c=function(){return Ja(function(e,t){const n=dr(e).call(dr(t));return Vr(n)},arguments)},r.wbg.__wbg_self_f0e34d89f33b99fd=function(){return Ja(function(){const e=self.self;return Vr(e)},arguments)},r.wbg.__wbg_window_d3b084224f4774d7=function(){return Ja(function(){const e=window.window;return Vr(e)},arguments)},r.wbg.__wbg_globalThis_9caa27ff917c6860=function(){return Ja(function(){const e=globalThis.globalThis;return Vr(e)},arguments)},r.wbg.__wbg_global_35dfdd59a4da3e74=function(){return Ja(function(){const e=global.global;return Vr(e)},arguments)},r.wbg.__wbg_isArray_74fb723e24f76012=function(e){return Array.isArray(dr(e))},r.wbg.__wbg_instanceof_ArrayBuffer_e7d53d51371448e2=function(e){let t;try{t=dr(e)instanceof ArrayBuffer}catch{t=!1}return t},r.wbg.__wbg_isSafeInteger_f93fde0dca9820f8=function(e){return Number.isSafeInteger(dr(e))},r.wbg.__wbg_entries_9e2e2aa45aa5094a=function(e){const t=Object.entries(dr(e));return Vr(t)},r.wbg.__wbg_buffer_a448f833075b71ba=function(e){const t=dr(e).buffer;return Vr(t)},r.wbg.__wbg_new_8f67e318f15d7254=function(e){const t=new Uint8Array(dr(e));return Vr(t)},r.wbg.__wbg_set_2357bf09366ee480=function(e,t,n){dr(e).set(dr(t),n>>>0)},r.wbg.__wbg_length_1d25fa9e4ac21ce7=function(e){return dr(e).length},r.wbg.__wbg_instanceof_Uint8Array_bced6f43aed8c1aa=function(e){let t;try{t=dr(e)instanceof Uint8Array}catch{t=!1}return t},r.wbg.__wbindgen_bigint_get_as_i64=function(e,t){const n=dr(t),l=typeof n=="bigint"?n:void 0;ok()[e/8+1]=pc(l)?BigInt(0):l,$t()[e/4+0]=!pc(l)},r.wbg.__wbindgen_debug_string=function(e,t){const n=Bm(dr(t)),l=Go(n,at.__wbindgen_malloc,at.__wbindgen_realloc),u=Wi;$t()[e/4+1]=u,$t()[e/4+0]=l},r.wbg.__wbindgen_throw=function(e,t){throw new Error(Gi(e,t))},r.wbg.__wbindgen_memory=function(){const e=at.memory;return Vr(e)},r}function hk(r,e){return at=r.exports,jb.__wbindgen_wasm_module=e,Ku=null,Xu=null,Hu=null,Zu=null,at}async function jb(r){if(at!==void 0)return at;typeof r>"u"&&(r="/ltn/assets/backend_bg.wasm");const e=uk();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:t,module:n}=await ck(await r,e);return hk(t,n)}var Mh=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Eg(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function Ud(r){if(r.__esModule)return r;var e=r.default;if(typeof e=="function"){var t=function n(){return this instanceof n?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(r).forEach(function(n){var l=Object.getOwnPropertyDescriptor(r,n);Object.defineProperty(t,n,l.get?l:{enumerable:!0,get:function(){return r[n]}})}),t}var Ub={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v4.1.3/LICENSE.txt
 */(function(r,e){(function(t,n){r.exports=n()})(Mh,function(){var t={},n={};function l(f,a,_){if(n[f]=_,f==="index"){var x="var sharedModule = {}; ("+n.shared+")(sharedModule); ("+n.worker+")(sharedModule);",k={};return n.shared(k),n.index(t,k),typeof window<"u"&&t.setWorkerUrl(window.URL.createObjectURL(new Blob([x],{type:"text/javascript"}))),t}}l("shared",["exports"],function(f){function a(s,i,c,d){return new(c||(c=Promise))(function(g,b){function w(L){try{I(d.next(L))}catch(O){b(O)}}function T(L){try{I(d.throw(L))}catch(O){b(O)}}function I(L){var O;L.done?g(L.value):(O=L.value,O instanceof c?O:new c(function(j){j(O)})).then(w,T)}I((d=d.apply(s,i||[])).next())})}function _(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}typeof SuppressedError=="function"&&SuppressedError;var x=k;function k(s,i){this.x=s,this.y=i}k.prototype={clone:function(){return new k(this.x,this.y)},add:function(s){return this.clone()._add(s)},sub:function(s){return this.clone()._sub(s)},multByPoint:function(s){return this.clone()._multByPoint(s)},divByPoint:function(s){return this.clone()._divByPoint(s)},mult:function(s){return this.clone()._mult(s)},div:function(s){return this.clone()._div(s)},rotate:function(s){return this.clone()._rotate(s)},rotateAround:function(s,i){return this.clone()._rotateAround(s,i)},matMult:function(s){return this.clone()._matMult(s)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(s){return this.x===s.x&&this.y===s.y},dist:function(s){return Math.sqrt(this.distSqr(s))},distSqr:function(s){var i=s.x-this.x,c=s.y-this.y;return i*i+c*c},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(s){return Math.atan2(this.y-s.y,this.x-s.x)},angleWith:function(s){return this.angleWithSep(s.x,s.y)},angleWithSep:function(s,i){return Math.atan2(this.x*i-this.y*s,this.x*s+this.y*i)},_matMult:function(s){var i=s[2]*this.x+s[3]*this.y;return this.x=s[0]*this.x+s[1]*this.y,this.y=i,this},_add:function(s){return this.x+=s.x,this.y+=s.y,this},_sub:function(s){return this.x-=s.x,this.y-=s.y,this},_mult:function(s){return this.x*=s,this.y*=s,this},_div:function(s){return this.x/=s,this.y/=s,this},_multByPoint:function(s){return this.x*=s.x,this.y*=s.y,this},_divByPoint:function(s){return this.x/=s.x,this.y/=s.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var s=this.y;return this.y=this.x,this.x=-s,this},_rotate:function(s){var i=Math.cos(s),c=Math.sin(s),d=c*this.x+i*this.y;return this.x=i*this.x-c*this.y,this.y=d,this},_rotateAround:function(s,i){var c=Math.cos(s),d=Math.sin(s),g=i.y+d*(this.x-i.x)+c*(this.y-i.y);return this.x=i.x+c*(this.x-i.x)-d*(this.y-i.y),this.y=g,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},k.convert=function(s){return s instanceof k?s:Array.isArray(s)?new k(s[0],s[1]):s};var S=_(x),C=z;function z(s,i,c,d){this.cx=3*s,this.bx=3*(c-s)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(d-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=s,this.p1y=i,this.p2x=c,this.p2y=d}z.prototype={sampleCurveX:function(s){return((this.ax*s+this.bx)*s+this.cx)*s},sampleCurveY:function(s){return((this.ay*s+this.by)*s+this.cy)*s},sampleCurveDerivativeX:function(s){return(3*this.ax*s+2*this.bx)*s+this.cx},solveCurveX:function(s,i){if(i===void 0&&(i=1e-6),s<0)return 0;if(s>1)return 1;for(var c=s,d=0;d<8;d++){var g=this.sampleCurveX(c)-s;if(Math.abs(g)<i)return c;var b=this.sampleCurveDerivativeX(c);if(Math.abs(b)<1e-6)break;c-=g/b}var w=0,T=1;for(c=s,d=0;d<20&&(g=this.sampleCurveX(c),!(Math.abs(g-s)<i));d++)s>g?w=c:T=c,c=.5*(T-w)+w;return c},solve:function(s,i){return this.sampleCurveY(this.solveCurveX(s,i))}};var R=_(C);let D,P;function B(){return D==null&&(D=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),D}function N(){if(P==null&&(P=!1,B())){const i=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(i){for(let d=0;d<5*5;d++){const g=4*d;i.fillStyle=`rgb(${g},${g+1},${g+2})`,i.fillRect(d%5,Math.floor(d/5),1,1)}const c=i.getImageData(0,0,5,5).data;for(let d=0;d<5*5*4;d++)if(d%4!=3&&c[d]!==d){P=!0;break}}}return P||!1}function V(s,i,c,d){const g=new R(s,i,c,d);return function(b){return g.solve(b)}}const U=V(.25,.1,.25,1);function te(s,i,c){return Math.min(c,Math.max(i,s))}function le(s,i,c){const d=c-i,g=((s-i)%d+d)%d+i;return g===i?c:g}function H(s,...i){for(const c of i)for(const d in c)s[d]=c[d];return s}let J=1;function ye(s,i,c){const d={};for(const g in s)d[g]=i.call(c||this,s[g],g,s);return d}function ze(s,i,c){const d={};for(const g in s)i.call(c||this,s[g],g,s)&&(d[g]=s[g]);return d}function ne(s){return Array.isArray(s)?s.map(ne):typeof s=="object"&&s?ye(s,ne):s}const be={};function He(s){be[s]||(typeof console<"u"&&console.warn(s),be[s]=!0)}function Ce(s,i,c){return(c.y-s.y)*(i.x-s.x)>(i.y-s.y)*(c.x-s.x)}function Qe(s){let i=0;for(let c,d,g=0,b=s.length,w=b-1;g<b;w=g++)c=s[g],d=s[w],i+=(d.x-c.x)*(c.y+d.y);return i}function _t(s){return typeof WorkerGlobalScope<"u"&&s!==void 0&&s instanceof WorkerGlobalScope}let Ut=null;function Je(s){return typeof ImageBitmap<"u"&&s instanceof ImageBitmap}const Yt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Kt(s,i,c,d,g){return a(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const b=new VideoFrame(s,{timestamp:0});try{const w=b==null?void 0:b.format;if(!w||!w.startsWith("BGR")&&!w.startsWith("RGB"))throw new Error(`Unrecognized format ${w}`);const T=w.startsWith("BGR"),I=new Uint8ClampedArray(d*g*4);if(yield b.copyTo(I,function(L,O,j,Z,K){const Q=4*Math.max(-O,0),ae=(Math.max(0,j)-j)*Z*4+Q,_e=4*Z,xe=Math.max(0,O),Re=Math.max(0,j);return{rect:{x:xe,y:Re,width:Math.min(L.width,O+Z)-xe,height:Math.min(L.height,j+K)-Re},layout:[{offset:ae,stride:_e}]}}(s,i,c,d,g)),T)for(let L=0;L<I.length;L+=4){const O=I[L];I[L]=I[L+2],I[L+2]=O}return I}finally{b.close()}})}let Ft,Ot;const Jt="AbortError";function Et(){return new Error(Jt)}const sr={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function zt(s){return sr.REGISTERED_PROTOCOLS[s.substring(0,s.indexOf("://"))]}const rr="global-dispatcher";class wr extends Error{constructor(i,c,d,g){super(`AJAXError: ${c} (${i}): ${d}`),this.status=i,this.statusText=c,this.url=d,this.body=g}}const gr=()=>_t(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Br=function(s,i){if(/:\/\//.test(s.url)&&!/^https?:|^file:/.test(s.url)){const d=zt(s.url);if(d)return d(s,i);if(_t(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:s,targetMapId:rr},i)}if(!(/^file:/.test(c=s.url)||/^file:/.test(gr())&&!/^\w+:/.test(c))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(d,g){return a(this,void 0,void 0,function*(){const b=new Request(d.url,{method:d.method||"GET",body:d.body,credentials:d.credentials,headers:d.headers,cache:d.cache,referrer:gr(),signal:g.signal});d.type==="json"&&b.headers.set("Accept","application/json");const w=yield fetch(b);if(!w.ok){const L=yield w.blob();throw new wr(w.status,w.statusText,d.url,L)}let T;T=d.type==="arrayBuffer"||d.type==="image"?w.arrayBuffer():d.type==="json"?w.json():w.text();const I=yield T;if(g.signal.aborted)throw Et();return{data:I,cacheControl:w.headers.get("Cache-Control"),expires:w.headers.get("Expires")}})}(s,i);if(_t(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:s,mustQueue:!0,targetMapId:rr},i)}var c;return function(d,g){return new Promise((b,w)=>{const T=new XMLHttpRequest;T.open(d.method||"GET",d.url,!0),d.type!=="arrayBuffer"&&d.type!=="image"||(T.responseType="arraybuffer");for(const I in d.headers)T.setRequestHeader(I,d.headers[I]);d.type==="json"&&(T.responseType="text",T.setRequestHeader("Accept","application/json")),T.withCredentials=d.credentials==="include",T.onerror=()=>{w(new Error(T.statusText))},T.onload=()=>{if(!g.signal.aborted)if((T.status>=200&&T.status<300||T.status===0)&&T.response!==null){let I=T.response;if(d.type==="json")try{I=JSON.parse(T.response)}catch(L){return void w(L)}b({data:I,cacheControl:T.getResponseHeader("Cache-Control"),expires:T.getResponseHeader("Expires")})}else{const I=new Blob([T.response],{type:T.getResponseHeader("Content-Type")});w(new wr(T.status,T.statusText,d.url,I))}},g.signal.addEventListener("abort",()=>{T.abort(),w(Et())}),T.send(d.body)})}(s,i)};function ht(s){if(!s||s.indexOf("://")<=0||s.indexOf("data:image/")===0||s.indexOf("blob:")===0)return!0;const i=new URL(s),c=window.location;return i.protocol===c.protocol&&i.host===c.host}function Mt(s,i,c){c[s]&&c[s].indexOf(i)!==-1||(c[s]=c[s]||[],c[s].push(i))}function De(s,i,c){if(c&&c[s]){const d=c[s].indexOf(i);d!==-1&&c[s].splice(d,1)}}class ut{constructor(i,c={}){H(this,c),this.type=i}}class it extends ut{constructor(i,c={}){super("error",H({error:i},c))}}class xt{on(i,c){return this._listeners=this._listeners||{},Mt(i,c,this._listeners),this}off(i,c){return De(i,c,this._listeners),De(i,c,this._oneTimeListeners),this}once(i,c){return c?(this._oneTimeListeners=this._oneTimeListeners||{},Mt(i,c,this._oneTimeListeners),this):new Promise(d=>this.once(i,d))}fire(i,c){typeof i=="string"&&(i=new ut(i,c||{}));const d=i.type;if(this.listens(d)){i.target=this;const g=this._listeners&&this._listeners[d]?this._listeners[d].slice():[];for(const T of g)T.call(this,i);const b=this._oneTimeListeners&&this._oneTimeListeners[d]?this._oneTimeListeners[d].slice():[];for(const T of b)De(d,T,this._oneTimeListeners),T.call(this,i);const w=this._eventedParent;w&&(H(i,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),w.fire(i))}else i instanceof it&&console.error(i.error);return this}listens(i){return this._listeners&&this._listeners[i]&&this._listeners[i].length>0||this._oneTimeListeners&&this._oneTimeListeners[i]&&this._oneTimeListeners[i].length>0||this._eventedParent&&this._eventedParent.listens(i)}setEventedParent(i,c){return this._eventedParent=i,this._eventedParentData=c,this}}var ie={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const nr=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Ne(s,i){const c={};for(const d in s)d!=="ref"&&(c[d]=s[d]);return nr.forEach(d=>{d in i&&(c[d]=i[d])}),c}function We(s,i){if(Array.isArray(s)){if(!Array.isArray(i)||s.length!==i.length)return!1;for(let c=0;c<s.length;c++)if(!We(s[c],i[c]))return!1;return!0}if(typeof s=="object"&&s!==null&&i!==null){if(typeof i!="object"||Object.keys(s).length!==Object.keys(i).length)return!1;for(const c in s)if(!We(s[c],i[c]))return!1;return!0}return s===i}function wt(s,i){s.push(i)}function xn(s,i,c){wt(c,{command:"addSource",args:[s,i[s]]})}function Sn(s,i,c){wt(i,{command:"removeSource",args:[s]}),c[s]=!0}function In(s,i,c,d){Sn(s,c,d),xn(s,i,c)}function ii(s,i,c){let d;for(d in s[c])if(Object.prototype.hasOwnProperty.call(s[c],d)&&d!=="data"&&!We(s[c][d],i[c][d]))return!1;for(d in i[c])if(Object.prototype.hasOwnProperty.call(i[c],d)&&d!=="data"&&!We(s[c][d],i[c][d]))return!1;return!0}function oi(s,i,c,d,g,b){s=s||{},i=i||{};for(const w in s)Object.prototype.hasOwnProperty.call(s,w)&&(We(s[w],i[w])||c.push({command:b,args:[d,w,i[w],g]}));for(const w in i)Object.prototype.hasOwnProperty.call(i,w)&&!Object.prototype.hasOwnProperty.call(s,w)&&(We(s[w],i[w])||c.push({command:b,args:[d,w,i[w],g]}))}function Xo(s){return s.id}function Jr(s,i){return s[i.id]=i,s}class lt{constructor(i,c,d,g){this.message=(i?`${i}: `:"")+d,g&&(this.identifier=g),c!=null&&c.__line__&&(this.line=c.__line__)}}function Xn(s,...i){for(const c of i)for(const d in c)s[d]=c[d];return s}class kn extends Error{constructor(i,c){super(c),this.message=c,this.key=i}}class Fo{constructor(i,c=[]){this.parent=i,this.bindings={};for(const[d,g]of c)this.bindings[d]=g}concat(i){return new Fo(this,i)}get(i){if(this.bindings[i])return this.bindings[i];if(this.parent)return this.parent.get(i);throw new Error(`${i} not found in scope.`)}has(i){return!!this.bindings[i]||!!this.parent&&this.parent.has(i)}}const Nr={kind:"null"},mt={kind:"number"},ir={kind:"string"},Qt={kind:"boolean"},jr={kind:"color"},wi={kind:"object"},tr={kind:"value"},io={kind:"collator"},cn={kind:"formatted"},ge={kind:"padding"},W={kind:"resolvedImage"},X={kind:"variableAnchorOffsetCollection"};function ee(s,i){return{kind:"array",itemType:s,N:i}}function he(s){if(s.kind==="array"){const i=he(s.itemType);return typeof s.N=="number"?`array<${i}, ${s.N}>`:s.itemType.kind==="value"?"array":`array<${i}>`}return s.kind}const Me=[Nr,mt,ir,Qt,jr,cn,wi,ee(tr),ge,W,X];function Ie(s,i){if(i.kind==="error")return null;if(s.kind==="array"){if(i.kind==="array"&&(i.N===0&&i.itemType.kind==="value"||!Ie(s.itemType,i.itemType))&&(typeof s.N!="number"||s.N===i.N))return null}else{if(s.kind===i.kind)return null;if(s.kind==="value"){for(const c of Me)if(!Ie(c,i))return null}}return`Expected ${he(s)} but found ${he(i)} instead.`}function Pe(s,i){return i.some(c=>c.kind===s.kind)}function Se(s,i){return i.some(c=>c==="null"?s===null:c==="array"?Array.isArray(s):c==="object"?s&&!Array.isArray(s)&&typeof s=="object":c===typeof s)}function G(s,i){return s.kind==="array"&&i.kind==="array"?s.itemType.kind===i.itemType.kind&&typeof s.N=="number":s.kind===i.kind}const je=.96422,Ve=.82521,qe=4/29,Ke=6/29,ct=3*Ke*Ke,Dt=Ke*Ke*Ke,Ht=Math.PI/180,cr=180/Math.PI;function _r(s){return(s%=360)<0&&(s+=360),s}function Yr([s,i,c,d]){let g,b;const w=ur((.2225045*(s=An(s))+.7168786*(i=An(i))+.0606169*(c=An(c)))/1);s===i&&i===c?g=b=w:(g=ur((.4360747*s+.3850649*i+.1430804*c)/je),b=ur((.0139322*s+.0971045*i+.7141733*c)/Ve));const T=116*w-16;return[T<0?0:T,500*(g-w),200*(w-b),d]}function An(s){return s<=.04045?s/12.92:Math.pow((s+.055)/1.055,2.4)}function ur(s){return s>Dt?Math.pow(s,1/3):s/ct+qe}function un([s,i,c,d]){let g=(s+16)/116,b=isNaN(i)?g:g+i/500,w=isNaN(c)?g:g-c/200;return g=1*di(g),b=je*di(b),w=Ve*di(w),[Fn(3.1338561*b-1.6168667*g-.4906146*w),Fn(-.9787684*b+1.9161415*g+.033454*w),Fn(.0719453*b-.2289914*g+1.4052427*w),d]}function Fn(s){return(s=s<=.00304?12.92*s:1.055*Math.pow(s,1/2.4)-.055)<0?0:s>1?1:s}function di(s){return s>Ke?s*s*s:ct*(s-qe)}function xi(s){return parseInt(s.padEnd(2,s),16)/255}function Kn(s,i){return _o(i?s/100:s,0,1)}function _o(s,i,c){return Math.min(Math.max(i,s),c)}function Bh(s){return!s.some(Number.isNaN)}const Kd={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class zr{constructor(i,c,d,g=1,b=!0){this.r=i,this.g=c,this.b=d,this.a=g,b||(this.r*=g,this.g*=g,this.b*=g,g||this.overwriteGetter("rgb",[i,c,d,g]))}static parse(i){if(i instanceof zr)return i;if(typeof i!="string")return;const c=function(d){if((d=d.toLowerCase().trim())==="transparent")return[0,0,0,0];const g=Kd[d];if(g){const[w,T,I]=g;return[w/255,T/255,I/255,1]}if(d.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(d)){const w=d.length<6?1:2;let T=1;return[xi(d.slice(T,T+=w)),xi(d.slice(T,T+=w)),xi(d.slice(T,T+=w)),xi(d.slice(T,T+w)||"ff")]}if(d.startsWith("rgb")){const w=d.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(w){const[T,I,L,O,j,Z,K,Q,ae,_e,xe,Re]=w,ke=[O||" ",K||" ",_e].join("");if(ke==="  "||ke==="  /"||ke===",,"||ke===",,,"){const Ae=[L,Z,ae].join(""),Ye=Ae==="%%%"?100:Ae===""?255:0;if(Ye){const et=[_o(+I/Ye,0,1),_o(+j/Ye,0,1),_o(+Q/Ye,0,1),xe?Kn(+xe,Re):1];if(Bh(et))return et}}return}}const b=d.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(b){const[w,T,I,L,O,j,Z,K,Q]=b,ae=[I||" ",O||" ",Z].join("");if(ae==="  "||ae==="  /"||ae===",,"||ae===",,,"){const _e=[+T,_o(+L,0,100),_o(+j,0,100),K?Kn(+K,Q):1];if(Bh(_e))return function([xe,Re,ke,Ae]){function Ye(et){const Tt=(et+xe/30)%12,Rt=Re*Math.min(ke,1-ke);return ke-Rt*Math.max(-1,Math.min(Tt-3,9-Tt,1))}return xe=_r(xe),Re/=100,ke/=100,[Ye(0),Ye(8),Ye(4),Ae]}(_e)}}}(i);return c?new zr(...c,!1):void 0}get rgb(){const{r:i,g:c,b:d,a:g}=this,b=g||1/0;return this.overwriteGetter("rgb",[i/b,c/b,d/b,g])}get hcl(){return this.overwriteGetter("hcl",function(i){const[c,d,g,b]=Yr(i),w=Math.sqrt(d*d+g*g);return[Math.round(1e4*w)?_r(Math.atan2(g,d)*cr):NaN,w,c,b]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Yr(this.rgb))}overwriteGetter(i,c){return Object.defineProperty(this,i,{value:c}),c}toString(){const[i,c,d,g]=this.rgb;return`rgba(${[i,c,d].map(b=>Math.round(255*b)).join(",")},${g})`}}zr.black=new zr(0,0,0,1),zr.white=new zr(1,1,1,1),zr.transparent=new zr(0,0,0,0),zr.red=new zr(1,0,0,1);class Fc{constructor(i,c,d){this.sensitivity=i?c?"variant":"case":c?"accent":"base",this.locale=d,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(i,c){return this.collator.compare(i,c)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Oc{constructor(i,c,d,g,b){this.text=i,this.image=c,this.scale=d,this.fontStack=g,this.textColor=b}}class Ri{constructor(i){this.sections=i}static fromString(i){return new Ri([new Oc(i,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(i=>i.text.length!==0||i.image&&i.image.name.length!==0)}static factory(i){return i instanceof Ri?i:Ri.fromString(i)}toString(){return this.sections.length===0?"":this.sections.map(i=>i.text).join("")}}class Si{constructor(i){this.values=i.slice()}static parse(i){if(i instanceof Si)return i;if(typeof i=="number")return new Si([i,i,i,i]);if(Array.isArray(i)&&!(i.length<1||i.length>4)){for(const c of i)if(typeof c!="number")return;switch(i.length){case 1:i=[i[0],i[0],i[0],i[0]];break;case 2:i=[i[0],i[1],i[0],i[1]];break;case 3:i=[i[0],i[1],i[2],i[1]]}return new Si(i)}}toString(){return JSON.stringify(this.values)}}const Ta=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Xi{constructor(i){this.values=i.slice()}static parse(i){if(i instanceof Xi)return i;if(Array.isArray(i)&&!(i.length<1)&&i.length%2==0){for(let c=0;c<i.length;c+=2){const d=i[c],g=i[c+1];if(typeof d!="string"||!Ta.has(d)||!Array.isArray(g)||g.length!==2||typeof g[0]!="number"||typeof g[1]!="number")return}return new Xi(i)}}toString(){return JSON.stringify(this.values)}}class Ki{constructor(i){this.name=i.name,this.available=i.available}toString(){return this.name}static fromString(i){return i?new Ki({name:i,available:!1}):null}}function Us(s,i,c,d){return typeof s=="number"&&s>=0&&s<=255&&typeof i=="number"&&i>=0&&i<=255&&typeof c=="number"&&c>=0&&c<=255?d===void 0||typeof d=="number"&&d>=0&&d<=1?null:`Invalid rgba value [${[s,i,c,d].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof d=="number"?[s,i,c,d]:[s,i,c]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function ll(s){if(s===null||typeof s=="string"||typeof s=="boolean"||typeof s=="number"||s instanceof zr||s instanceof Fc||s instanceof Ri||s instanceof Si||s instanceof Xi||s instanceof Ki)return!0;if(Array.isArray(s)){for(const i of s)if(!ll(i))return!1;return!0}if(typeof s=="object"){for(const i in s)if(!ll(s[i]))return!1;return!0}return!1}function Ln(s){if(s===null)return Nr;if(typeof s=="string")return ir;if(typeof s=="boolean")return Qt;if(typeof s=="number")return mt;if(s instanceof zr)return jr;if(s instanceof Fc)return io;if(s instanceof Ri)return cn;if(s instanceof Si)return ge;if(s instanceof Xi)return X;if(s instanceof Ki)return W;if(Array.isArray(s)){const i=s.length;let c;for(const d of s){const g=Ln(d);if(c){if(c===g)continue;c=tr;break}c=g}return ee(c||tr,i)}return wi}function Ea(s){const i=typeof s;return s===null?"":i==="string"||i==="number"||i==="boolean"?String(s):s instanceof zr||s instanceof Ri||s instanceof Si||s instanceof Xi||s instanceof Ki?s.toString():JSON.stringify(s)}class Ko{constructor(i,c){this.type=i,this.value=c}static parse(i,c){if(i.length!==2)return c.error(`'literal' expression requires exactly one argument, but found ${i.length-1} instead.`);if(!ll(i[1]))return c.error("invalid value");const d=i[1];let g=Ln(d);const b=c.expectedType;return g.kind!=="array"||g.N!==0||!b||b.kind!=="array"||typeof b.N=="number"&&b.N!==0||(g=b),new Ko(g,d)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class on{constructor(i){this.name="ExpressionEvaluationError",this.message=i}toJSON(){return this.message}}const cl={string:ir,number:mt,boolean:Qt,object:wi};class Bi{constructor(i,c){this.type=i,this.args=c}static parse(i,c){if(i.length<2)return c.error("Expected at least one argument.");let d,g=1;const b=i[0];if(b==="array"){let T,I;if(i.length>2){const L=i[1];if(typeof L!="string"||!(L in cl)||L==="object")return c.error('The item type argument of "array" must be one of string, number, boolean',1);T=cl[L],g++}else T=tr;if(i.length>3){if(i[2]!==null&&(typeof i[2]!="number"||i[2]<0||i[2]!==Math.floor(i[2])))return c.error('The length argument to "array" must be a positive integer literal',2);I=i[2],g++}d=ee(T,I)}else{if(!cl[b])throw new Error(`Types doesn't contain name = ${b}`);d=cl[b]}const w=[];for(;g<i.length;g++){const T=c.parse(i[g],g,tr);if(!T)return null;w.push(T)}return new Bi(d,w)}evaluate(i){for(let c=0;c<this.args.length;c++){const d=this.args[c].evaluate(i);if(!Ie(this.type,Ln(d)))return d;if(c===this.args.length-1)throw new on(`Expected value to be of type ${he(this.type)}, but found ${he(Ln(d))} instead.`)}throw new Error}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}}const ul={"to-boolean":Qt,"to-color":jr,"to-number":mt,"to-string":ir};class yo{constructor(i,c){this.type=i,this.args=c}static parse(i,c){if(i.length<2)return c.error("Expected at least one argument.");const d=i[0];if(!ul[d])throw new Error(`Can't parse ${d} as it is not part of the known types`);if((d==="to-boolean"||d==="to-string")&&i.length!==2)return c.error("Expected one argument.");const g=ul[d],b=[];for(let w=1;w<i.length;w++){const T=c.parse(i[w],w,tr);if(!T)return null;b.push(T)}return new yo(g,b)}evaluate(i){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(i);case"color":{let c,d;for(const g of this.args){if(c=g.evaluate(i),d=null,c instanceof zr)return c;if(typeof c=="string"){const b=i.parseColor(c);if(b)return b}else if(Array.isArray(c)&&(d=c.length<3||c.length>4?`Invalid rbga value ${JSON.stringify(c)}: expected an array containing either three or four numeric values.`:Us(c[0],c[1],c[2],c[3]),!d))return new zr(c[0]/255,c[1]/255,c[2]/255,c[3])}throw new on(d||`Could not parse color from value '${typeof c=="string"?c:JSON.stringify(c)}'`)}case"padding":{let c;for(const d of this.args){c=d.evaluate(i);const g=Si.parse(c);if(g)return g}throw new on(`Could not parse padding from value '${typeof c=="string"?c:JSON.stringify(c)}'`)}case"variableAnchorOffsetCollection":{let c;for(const d of this.args){c=d.evaluate(i);const g=Xi.parse(c);if(g)return g}throw new on(`Could not parse variableAnchorOffsetCollection from value '${typeof c=="string"?c:JSON.stringify(c)}'`)}case"number":{let c=null;for(const d of this.args){if(c=d.evaluate(i),c===null)return 0;const g=Number(c);if(!isNaN(g))return g}throw new on(`Could not convert ${JSON.stringify(c)} to number.`)}case"formatted":return Ri.fromString(Ea(this.args[0].evaluate(i)));case"resolvedImage":return Ki.fromString(Ea(this.args[0].evaluate(i)));default:return Ea(this.args[0].evaluate(i))}}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}}const Ca=["Unknown","Point","LineString","Polygon"];class Dr{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Ca[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(i){let c=this._parseColorCache[i];return c||(c=this._parseColorCache[i]=zr.parse(i)),c}}class hl{constructor(i,c,d=[],g,b=new Fo,w=[]){this.registry=i,this.path=d,this.key=d.map(T=>`[${T}]`).join(""),this.scope=b,this.errors=w,this.expectedType=g,this._isConstant=c}parse(i,c,d,g,b={}){return c?this.concat(c,d,g)._parse(i,b):this._parse(i,b)}_parse(i,c){function d(g,b,w){return w==="assert"?new Bi(b,[g]):w==="coerce"?new yo(b,[g]):g}if(i!==null&&typeof i!="string"&&typeof i!="boolean"&&typeof i!="number"||(i=["literal",i]),Array.isArray(i)){if(i.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const g=i[0];if(typeof g!="string")return this.error(`Expression name must be a string, but found ${typeof g} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const b=this.registry[g];if(b){let w=b.parse(i,this);if(!w)return null;if(this.expectedType){const T=this.expectedType,I=w.type;if(T.kind!=="string"&&T.kind!=="number"&&T.kind!=="boolean"&&T.kind!=="object"&&T.kind!=="array"||I.kind!=="value")if(T.kind!=="color"&&T.kind!=="formatted"&&T.kind!=="resolvedImage"||I.kind!=="value"&&I.kind!=="string")if(T.kind!=="padding"||I.kind!=="value"&&I.kind!=="number"&&I.kind!=="array")if(T.kind!=="variableAnchorOffsetCollection"||I.kind!=="value"&&I.kind!=="array"){if(this.checkSubtype(T,I))return null}else w=d(w,T,c.typeAnnotation||"coerce");else w=d(w,T,c.typeAnnotation||"coerce");else w=d(w,T,c.typeAnnotation||"coerce");else w=d(w,T,c.typeAnnotation||"assert")}if(!(w instanceof Ko)&&w.type.kind!=="resolvedImage"&&this._isConstant(w)){const T=new Dr;try{w=new Ko(w.type,w.evaluate(T))}catch(I){return this.error(I.message),null}}return w}return this.error(`Unknown expression "${g}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(i===void 0?"'undefined' value invalid. Use null instead.":typeof i=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof i} instead.`)}concat(i,c,d){const g=typeof i=="number"?this.path.concat(i):this.path,b=d?this.scope.concat(d):this.scope;return new hl(this.registry,this._isConstant,g,c||null,b,this.errors)}error(i,...c){const d=`${this.key}${c.map(g=>`[${g}]`).join("")}`;this.errors.push(new kn(d,i))}checkSubtype(i,c){const d=Ie(i,c);return d&&this.error(d),d}}class Vs{constructor(i,c,d){this.type=io,this.locale=d,this.caseSensitive=i,this.diacriticSensitive=c}static parse(i,c){if(i.length!==2)return c.error("Expected one argument.");const d=i[1];if(typeof d!="object"||Array.isArray(d))return c.error("Collator options argument must be an object.");const g=c.parse(d["case-sensitive"]!==void 0&&d["case-sensitive"],1,Qt);if(!g)return null;const b=c.parse(d["diacritic-sensitive"]!==void 0&&d["diacritic-sensitive"],1,Qt);if(!b)return null;let w=null;return d.locale&&(w=c.parse(d.locale,1,ir),!w)?null:new Vs(g,b,w)}evaluate(i){return new Fc(this.caseSensitive.evaluate(i),this.diacriticSensitive.evaluate(i),this.locale?this.locale.evaluate(i):null)}eachChild(i){i(this.caseSensitive),i(this.diacriticSensitive),this.locale&&i(this.locale)}outputDefined(){return!1}}const Jo=8192;function fl(s,i){s[0]=Math.min(s[0],i[0]),s[1]=Math.min(s[1],i[1]),s[2]=Math.max(s[2],i[0]),s[3]=Math.max(s[3],i[1])}function Ma(s,i){return!(s[0]<=i[0]||s[2]>=i[2]||s[1]<=i[1]||s[3]>=i[3])}function Jd(s,i){const c=(180+s[0])/360,d=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s[1]*Math.PI/360)))/360,g=Math.pow(2,i.z);return[Math.round(c*g*Jo),Math.round(d*g*Jo)]}function Fh(s,i,c){const d=s[0]-i[0],g=s[1]-i[1],b=s[0]-c[0],w=s[1]-c[1];return d*w-b*g==0&&d*b<=0&&g*w<=0}function dl(s,i){let c=!1;for(let w=0,T=i.length;w<T;w++){const I=i[w];for(let L=0,O=I.length;L<O-1;L++){if(Fh(s,I[L],I[L+1]))return!1;(g=I[L])[1]>(d=s)[1]!=(b=I[L+1])[1]>d[1]&&d[0]<(b[0]-g[0])*(d[1]-g[1])/(b[1]-g[1])+g[0]&&(c=!c)}}var d,g,b;return c}function Yd(s,i){for(let c=0;c<i.length;c++)if(dl(s,i[c]))return!0;return!1}function Oh(s,i,c,d){const g=d[0]-c[0],b=d[1]-c[1],w=(s[0]-c[0])*b-g*(s[1]-c[1]),T=(i[0]-c[0])*b-g*(i[1]-c[1]);return w>0&&T<0||w<0&&T>0}function Qd(s,i,c){for(const L of c)for(let O=0;O<L.length-1;++O)if((T=[(w=L[O+1])[0]-(b=L[O])[0],w[1]-b[1]])[0]*(I=[(g=i)[0]-(d=s)[0],g[1]-d[1]])[1]-T[1]*I[0]!=0&&Oh(d,g,b,w)&&Oh(b,w,d,g))return!0;var d,g,b,w,T,I;return!1}function Nh(s,i){for(let c=0;c<s.length;++c)if(!dl(s[c],i))return!1;for(let c=0;c<s.length-1;++c)if(Qd(s[c],s[c+1],i))return!1;return!0}function jh(s,i){for(let c=0;c<i.length;c++)if(Nh(s,i[c]))return!0;return!1}function pl(s,i,c){const d=[];for(let g=0;g<s.length;g++){const b=[];for(let w=0;w<s[g].length;w++){const T=Jd(s[g][w],c);fl(i,T),b.push(T)}d.push(b)}return d}function Uh(s,i,c){const d=[];for(let g=0;g<s.length;g++){const b=pl(s[g],i,c);d.push(b)}return d}function Vh(s,i,c,d){if(s[0]<c[0]||s[0]>c[2]){const g=.5*d;let b=s[0]-c[0]>g?-d:c[0]-s[0]>g?d:0;b===0&&(b=s[0]-c[2]>g?-d:c[2]-s[0]>g?d:0),s[0]+=b}fl(i,s)}function ml(s,i,c,d){const g=Math.pow(2,d.z)*Jo,b=[d.x*Jo,d.y*Jo],w=[];for(const T of s)for(const I of T){const L=[I.x+b[0],I.y+b[1]];Vh(L,i,c,g),w.push(L)}return w}function $h(s,i,c,d){const g=Math.pow(2,d.z)*Jo,b=[d.x*Jo,d.y*Jo],w=[];for(const I of s){const L=[];for(const O of I){const j=[O.x+b[0],O.y+b[1]];fl(i,j),L.push(j)}w.push(L)}if(i[2]-i[0]<=g/2){(T=i)[0]=T[1]=1/0,T[2]=T[3]=-1/0;for(const I of w)for(const L of I)Vh(L,i,c,g)}var T;return w}class ms{constructor(i,c){this.type=Qt,this.geojson=i,this.geometries=c}static parse(i,c){if(i.length!==2)return c.error(`'within' expression requires exactly one argument, but found ${i.length-1} instead.`);if(ll(i[1])){const d=i[1];if(d.type==="FeatureCollection"){const g=[];for(const b of d.features){const{type:w,coordinates:T}=b.geometry;w==="Polygon"&&g.push(T),w==="MultiPolygon"&&g.push(...T)}if(g.length)return new ms(d,{type:"MultiPolygon",coordinates:g})}else if(d.type==="Feature"){const g=d.geometry.type;if(g==="Polygon"||g==="MultiPolygon")return new ms(d,d.geometry)}else if(d.type==="Polygon"||d.type==="MultiPolygon")return new ms(d,d)}return c.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(i){if(i.geometry()!=null&&i.canonicalID()!=null){if(i.geometryType()==="Point")return function(c,d){const g=[1/0,1/0,-1/0,-1/0],b=[1/0,1/0,-1/0,-1/0],w=c.canonicalID();if(d.type==="Polygon"){const T=pl(d.coordinates,b,w),I=ml(c.geometry(),g,b,w);if(!Ma(g,b))return!1;for(const L of I)if(!dl(L,T))return!1}if(d.type==="MultiPolygon"){const T=Uh(d.coordinates,b,w),I=ml(c.geometry(),g,b,w);if(!Ma(g,b))return!1;for(const L of I)if(!Yd(L,T))return!1}return!0}(i,this.geometries);if(i.geometryType()==="LineString")return function(c,d){const g=[1/0,1/0,-1/0,-1/0],b=[1/0,1/0,-1/0,-1/0],w=c.canonicalID();if(d.type==="Polygon"){const T=pl(d.coordinates,b,w),I=$h(c.geometry(),g,b,w);if(!Ma(g,b))return!1;for(const L of I)if(!Nh(L,T))return!1}if(d.type==="MultiPolygon"){const T=Uh(d.coordinates,b,w),I=$h(c.geometry(),g,b,w);if(!Ma(g,b))return!1;for(const L of I)if(!jh(L,T))return!1}return!0}(i,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class gl{constructor(i,c){this.type=c.type,this.name=i,this.boundExpression=c}static parse(i,c){if(i.length!==2||typeof i[1]!="string")return c.error("'var' expression requires exactly one string literal argument.");const d=i[1];return c.scope.has(d)?new gl(d,c.scope.get(d)):c.error(`Unknown variable "${d}". Make sure "${d}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(i){return this.boundExpression.evaluate(i)}eachChild(){}outputDefined(){return!1}}class Fi{constructor(i,c,d,g){this.name=i,this.type=c,this._evaluate=d,this.args=g}evaluate(i){return this._evaluate(i,this.args)}eachChild(i){this.args.forEach(i)}outputDefined(){return!1}static parse(i,c){const d=i[0],g=Fi.definitions[d];if(!g)return c.error(`Unknown expression "${d}". If you wanted a literal array, use ["literal", [...]].`,0);const b=Array.isArray(g)?g[0]:g.type,w=Array.isArray(g)?[[g[1],g[2]]]:g.overloads,T=w.filter(([L])=>!Array.isArray(L)||L.length===i.length-1);let I=null;for(const[L,O]of T){I=new hl(c.registry,Ia,c.path,null,c.scope);const j=[];let Z=!1;for(let K=1;K<i.length;K++){const Q=i[K],ae=Array.isArray(L)?L[K-1]:L.type,_e=I.parse(Q,1+j.length,ae);if(!_e){Z=!0;break}j.push(_e)}if(!Z)if(Array.isArray(L)&&L.length!==j.length)I.error(`Expected ${L.length} arguments, but found ${j.length} instead.`);else{for(let K=0;K<j.length;K++){const Q=Array.isArray(L)?L[K]:L.type,ae=j[K];I.concat(K+1).checkSubtype(Q,ae.type)}if(I.errors.length===0)return new Fi(d,b,O,j)}}if(T.length===1)c.errors.push(...I.errors);else{const L=(T.length?T:w).map(([j])=>{return Z=j,Array.isArray(Z)?`(${Z.map(he).join(", ")})`:`(${he(Z.type)}...)`;var Z}).join(" | "),O=[];for(let j=1;j<i.length;j++){const Z=c.parse(i[j],1+O.length);if(!Z)return null;O.push(he(Z.type))}c.error(`Expected arguments of type ${L}, but found (${O.join(", ")}) instead.`)}return null}static register(i,c){Fi.definitions=c;for(const d in c)i[d]=Fi}}function Ia(s){if(s instanceof gl)return Ia(s.boundExpression);if(s instanceof Fi&&s.name==="error"||s instanceof Vs||s instanceof ms)return!1;const i=s instanceof yo||s instanceof Bi;let c=!0;return s.eachChild(d=>{c=i?c&&Ia(d):c&&d instanceof Ko}),!!c&&_l(s)&&La(s,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function _l(s){if(s instanceof Fi&&(s.name==="get"&&s.args.length===1||s.name==="feature-state"||s.name==="has"&&s.args.length===1||s.name==="properties"||s.name==="geometry-type"||s.name==="id"||/^filter-/.test(s.name))||s instanceof ms)return!1;let i=!0;return s.eachChild(c=>{i&&!_l(c)&&(i=!1)}),i}function Aa(s){if(s instanceof Fi&&s.name==="feature-state")return!1;let i=!0;return s.eachChild(c=>{i&&!Aa(c)&&(i=!1)}),i}function La(s,i){if(s instanceof Fi&&i.indexOf(s.name)>=0)return!1;let c=!0;return s.eachChild(d=>{c&&!La(d,i)&&(c=!1)}),c}function Pa(s,i){const c=s.length-1;let d,g,b=0,w=c,T=0;for(;b<=w;)if(T=Math.floor((b+w)/2),d=s[T],g=s[T+1],d<=i){if(T===c||i<g)return T;b=T+1}else{if(!(d>i))throw new on("Input is not a number.");w=T-1}return 0}class za{constructor(i,c,d){this.type=i,this.input=c,this.labels=[],this.outputs=[];for(const[g,b]of d)this.labels.push(g),this.outputs.push(b)}static parse(i,c){if(i.length-1<4)return c.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if((i.length-1)%2!=0)return c.error("Expected an even number of arguments.");const d=c.parse(i[1],1,mt);if(!d)return null;const g=[];let b=null;c.expectedType&&c.expectedType.kind!=="value"&&(b=c.expectedType);for(let w=1;w<i.length;w+=2){const T=w===1?-1/0:i[w],I=i[w+1],L=w,O=w+1;if(typeof T!="number")return c.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',L);if(g.length&&g[g.length-1][0]>=T)return c.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',L);const j=c.parse(I,O,b);if(!j)return null;b=b||j.type,g.push([T,j])}return new za(b,d,g)}evaluate(i){const c=this.labels,d=this.outputs;if(c.length===1)return d[0].evaluate(i);const g=this.input.evaluate(i);if(g<=c[0])return d[0].evaluate(i);const b=c.length;return g>=c[b-1]?d[b-1].evaluate(i):d[Pa(c,g)].evaluate(i)}eachChild(i){i(this.input);for(const c of this.outputs)i(c)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}}function ep(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var tp=qh;function qh(s,i,c,d){this.cx=3*s,this.bx=3*(c-s)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(d-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=s,this.p1y=i,this.p2x=c,this.p2y=d}qh.prototype={sampleCurveX:function(s){return((this.ax*s+this.bx)*s+this.cx)*s},sampleCurveY:function(s){return((this.ay*s+this.by)*s+this.cy)*s},sampleCurveDerivativeX:function(s){return(3*this.ax*s+2*this.bx)*s+this.cx},solveCurveX:function(s,i){if(i===void 0&&(i=1e-6),s<0)return 0;if(s>1)return 1;for(var c=s,d=0;d<8;d++){var g=this.sampleCurveX(c)-s;if(Math.abs(g)<i)return c;var b=this.sampleCurveDerivativeX(c);if(Math.abs(b)<1e-6)break;c-=g/b}var w=0,T=1;for(c=s,d=0;d<20&&(g=this.sampleCurveX(c),!(Math.abs(g-s)<i));d++)s>g?w=c:T=c,c=.5*(T-w)+w;return c},solve:function(s,i){return this.sampleCurveY(this.solveCurveX(s,i))}};var rp=ep(tp);function gs(s,i,c){return s+c*(i-s)}function yl(s,i,c){return s.map((d,g)=>gs(d,i[g],c))}const pi={number:gs,color:function(s,i,c,d="rgb"){switch(d){case"rgb":{const[g,b,w,T]=yl(s.rgb,i.rgb,c);return new zr(g,b,w,T,!1)}case"hcl":{const[g,b,w,T]=s.hcl,[I,L,O,j]=i.hcl;let Z,K;if(isNaN(g)||isNaN(I))isNaN(g)?isNaN(I)?Z=NaN:(Z=I,w!==1&&w!==0||(K=L)):(Z=g,O!==1&&O!==0||(K=b));else{let Re=I-g;I>g&&Re>180?Re-=360:I<g&&g-I>180&&(Re+=360),Z=g+c*Re}const[Q,ae,_e,xe]=function([Re,ke,Ae,Ye]){return Re=isNaN(Re)?0:Re*Ht,un([Ae,Math.cos(Re)*ke,Math.sin(Re)*ke,Ye])}([Z,K??gs(b,L,c),gs(w,O,c),gs(T,j,c)]);return new zr(Q,ae,_e,xe,!1)}case"lab":{const[g,b,w,T]=un(yl(s.lab,i.lab,c));return new zr(g,b,w,T,!1)}}},array:yl,padding:function(s,i,c){return new Si(yl(s.values,i.values,c))},variableAnchorOffsetCollection:function(s,i,c){const d=s.values,g=i.values;if(d.length!==g.length)throw new on(`Cannot interpolate values of different length. from: ${s.toString()}, to: ${i.toString()}`);const b=[];for(let w=0;w<d.length;w+=2){if(d[w]!==g[w])throw new on(`Cannot interpolate values containing mismatched anchors. from[${w}]: ${d[w]}, to[${w}]: ${g[w]}`);b.push(d[w]);const[T,I]=d[w+1],[L,O]=g[w+1];b.push([gs(T,L,c),gs(I,O,c)])}return new Xi(b)}};class si{constructor(i,c,d,g,b){this.type=i,this.operator=c,this.interpolation=d,this.input=g,this.labels=[],this.outputs=[];for(const[w,T]of b)this.labels.push(w),this.outputs.push(T)}static interpolationFactor(i,c,d,g){let b=0;if(i.name==="exponential")b=Cr(c,i.base,d,g);else if(i.name==="linear")b=Cr(c,1,d,g);else if(i.name==="cubic-bezier"){const w=i.controlPoints;b=new rp(w[0],w[1],w[2],w[3]).solve(Cr(c,1,d,g))}return b}static parse(i,c){let[d,g,b,...w]=i;if(!Array.isArray(g)||g.length===0)return c.error("Expected an interpolation type expression.",1);if(g[0]==="linear")g={name:"linear"};else if(g[0]==="exponential"){const L=g[1];if(typeof L!="number")return c.error("Exponential interpolation requires a numeric base.",1,1);g={name:"exponential",base:L}}else{if(g[0]!=="cubic-bezier")return c.error(`Unknown interpolation type ${String(g[0])}`,1,0);{const L=g.slice(1);if(L.length!==4||L.some(O=>typeof O!="number"||O<0||O>1))return c.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);g={name:"cubic-bezier",controlPoints:L}}}if(i.length-1<4)return c.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if((i.length-1)%2!=0)return c.error("Expected an even number of arguments.");if(b=c.parse(b,2,mt),!b)return null;const T=[];let I=null;d==="interpolate-hcl"||d==="interpolate-lab"?I=jr:c.expectedType&&c.expectedType.kind!=="value"&&(I=c.expectedType);for(let L=0;L<w.length;L+=2){const O=w[L],j=w[L+1],Z=L+3,K=L+4;if(typeof O!="number")return c.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',Z);if(T.length&&T[T.length-1][0]>=O)return c.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',Z);const Q=c.parse(j,K,I);if(!Q)return null;I=I||Q.type,T.push([O,Q])}return G(I,mt)||G(I,jr)||G(I,ge)||G(I,X)||G(I,ee(mt))?new si(I,d,g,b,T):c.error(`Type ${he(I)} is not interpolatable.`)}evaluate(i){const c=this.labels,d=this.outputs;if(c.length===1)return d[0].evaluate(i);const g=this.input.evaluate(i);if(g<=c[0])return d[0].evaluate(i);const b=c.length;if(g>=c[b-1])return d[b-1].evaluate(i);const w=Pa(c,g),T=si.interpolationFactor(this.interpolation,g,c[w],c[w+1]),I=d[w].evaluate(i),L=d[w+1].evaluate(i);switch(this.operator){case"interpolate":return pi[this.type.kind](I,L,T);case"interpolate-hcl":return pi.color(I,L,T,"hcl");case"interpolate-lab":return pi.color(I,L,T,"lab")}}eachChild(i){i(this.input);for(const c of this.outputs)i(c)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}}function Cr(s,i,c,d){const g=d-c,b=s-c;return g===0?0:i===1?b/g:(Math.pow(i,b)-1)/(Math.pow(i,g)-1)}class vl{constructor(i,c){this.type=i,this.args=c}static parse(i,c){if(i.length<2)return c.error("Expectected at least one argument.");let d=null;const g=c.expectedType;g&&g.kind!=="value"&&(d=g);const b=[];for(const T of i.slice(1)){const I=c.parse(T,1+b.length,d,void 0,{typeAnnotation:"omit"});if(!I)return null;d=d||I.type,b.push(I)}if(!d)throw new Error("No output type");const w=g&&b.some(T=>Ie(g,T.type));return new vl(w?tr:d,b)}evaluate(i){let c,d=null,g=0;for(const b of this.args)if(g++,d=b.evaluate(i),d&&d instanceof Ki&&!d.available&&(c||(c=d.name),d=null,g===this.args.length&&(d=c)),d!==null)break;return d}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}}class bl{constructor(i,c){this.type=c.type,this.bindings=[].concat(i),this.result=c}evaluate(i){return this.result.evaluate(i)}eachChild(i){for(const c of this.bindings)i(c[1]);i(this.result)}static parse(i,c){if(i.length<4)return c.error(`Expected at least 3 arguments, but found ${i.length-1} instead.`);const d=[];for(let b=1;b<i.length-1;b+=2){const w=i[b];if(typeof w!="string")return c.error(`Expected string, but found ${typeof w} instead.`,b);if(/[^a-zA-Z0-9_]/.test(w))return c.error("Variable names must contain only alphanumeric characters or '_'.",b);const T=c.parse(i[b+1],b+1);if(!T)return null;d.push([w,T])}const g=c.parse(i[i.length-1],i.length-1,c.expectedType,d);return g?new bl(d,g):null}outputDefined(){return this.result.outputDefined()}}class Nc{constructor(i,c,d){this.type=i,this.index=c,this.input=d}static parse(i,c){if(i.length!==3)return c.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const d=c.parse(i[1],1,mt),g=c.parse(i[2],2,ee(c.expectedType||tr));return d&&g?new Nc(g.type.itemType,d,g):null}evaluate(i){const c=this.index.evaluate(i),d=this.input.evaluate(i);if(c<0)throw new on(`Array index out of bounds: ${c} < 0.`);if(c>=d.length)throw new on(`Array index out of bounds: ${c} > ${d.length-1}.`);if(c!==Math.floor(c))throw new on(`Array index must be an integer, but found ${c} instead.`);return d[c]}eachChild(i){i(this.index),i(this.input)}outputDefined(){return!1}}class jc{constructor(i,c){this.type=Qt,this.needle=i,this.haystack=c}static parse(i,c){if(i.length!==3)return c.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const d=c.parse(i[1],1,tr),g=c.parse(i[2],2,tr);return d&&g?Pe(d.type,[Qt,ir,mt,Nr,tr])?new jc(d,g):c.error(`Expected first argument to be of type boolean, string, number or null, but found ${he(d.type)} instead`):null}evaluate(i){const c=this.needle.evaluate(i),d=this.haystack.evaluate(i);if(!d)return!1;if(!Se(c,["boolean","string","number","null"]))throw new on(`Expected first argument to be of type boolean, string, number or null, but found ${he(Ln(c))} instead.`);if(!Se(d,["string","array"]))throw new on(`Expected second argument to be of type array or string, but found ${he(Ln(d))} instead.`);return d.indexOf(c)>=0}eachChild(i){i(this.needle),i(this.haystack)}outputDefined(){return!0}}class wl{constructor(i,c,d){this.type=mt,this.needle=i,this.haystack=c,this.fromIndex=d}static parse(i,c){if(i.length<=2||i.length>=5)return c.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);const d=c.parse(i[1],1,tr),g=c.parse(i[2],2,tr);if(!d||!g)return null;if(!Pe(d.type,[Qt,ir,mt,Nr,tr]))return c.error(`Expected first argument to be of type boolean, string, number or null, but found ${he(d.type)} instead`);if(i.length===4){const b=c.parse(i[3],3,mt);return b?new wl(d,g,b):null}return new wl(d,g)}evaluate(i){const c=this.needle.evaluate(i),d=this.haystack.evaluate(i);if(!Se(c,["boolean","string","number","null"]))throw new on(`Expected first argument to be of type boolean, string, number or null, but found ${he(Ln(c))} instead.`);if(!Se(d,["string","array"]))throw new on(`Expected second argument to be of type array or string, but found ${he(Ln(d))} instead.`);if(this.fromIndex){const g=this.fromIndex.evaluate(i);return d.indexOf(c,g)}return d.indexOf(c)}eachChild(i){i(this.needle),i(this.haystack),this.fromIndex&&i(this.fromIndex)}outputDefined(){return!1}}class Uc{constructor(i,c,d,g,b,w){this.inputType=i,this.type=c,this.input=d,this.cases=g,this.outputs=b,this.otherwise=w}static parse(i,c){if(i.length<5)return c.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if(i.length%2!=1)return c.error("Expected an even number of arguments.");let d,g;c.expectedType&&c.expectedType.kind!=="value"&&(g=c.expectedType);const b={},w=[];for(let L=2;L<i.length-1;L+=2){let O=i[L];const j=i[L+1];Array.isArray(O)||(O=[O]);const Z=c.concat(L);if(O.length===0)return Z.error("Expected at least one branch label.");for(const Q of O){if(typeof Q!="number"&&typeof Q!="string")return Z.error("Branch labels must be numbers or strings.");if(typeof Q=="number"&&Math.abs(Q)>Number.MAX_SAFE_INTEGER)return Z.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof Q=="number"&&Math.floor(Q)!==Q)return Z.error("Numeric branch labels must be integer values.");if(d){if(Z.checkSubtype(d,Ln(Q)))return null}else d=Ln(Q);if(b[String(Q)]!==void 0)return Z.error("Branch labels must be unique.");b[String(Q)]=w.length}const K=c.parse(j,L,g);if(!K)return null;g=g||K.type,w.push(K)}const T=c.parse(i[1],1,tr);if(!T)return null;const I=c.parse(i[i.length-1],i.length-1,g);return I?T.type.kind!=="value"&&c.concat(1).checkSubtype(d,T.type)?null:new Uc(d,g,T,b,w,I):null}evaluate(i){const c=this.input.evaluate(i);return(Ln(c)===this.inputType&&this.outputs[this.cases[c]]||this.otherwise).evaluate(i)}eachChild(i){i(this.input),this.outputs.forEach(i),i(this.otherwise)}outputDefined(){return this.outputs.every(i=>i.outputDefined())&&this.otherwise.outputDefined()}}class Vc{constructor(i,c,d){this.type=i,this.branches=c,this.otherwise=d}static parse(i,c){if(i.length<4)return c.error(`Expected at least 3 arguments, but found only ${i.length-1}.`);if(i.length%2!=0)return c.error("Expected an odd number of arguments.");let d;c.expectedType&&c.expectedType.kind!=="value"&&(d=c.expectedType);const g=[];for(let w=1;w<i.length-1;w+=2){const T=c.parse(i[w],w,Qt);if(!T)return null;const I=c.parse(i[w+1],w+1,d);if(!I)return null;g.push([T,I]),d=d||I.type}const b=c.parse(i[i.length-1],i.length-1,d);if(!b)return null;if(!d)throw new Error("Can't infer output type");return new Vc(d,g,b)}evaluate(i){for(const[c,d]of this.branches)if(c.evaluate(i))return d.evaluate(i);return this.otherwise.evaluate(i)}eachChild(i){for(const[c,d]of this.branches)i(c),i(d);i(this.otherwise)}outputDefined(){return this.branches.every(([i,c])=>c.outputDefined())&&this.otherwise.outputDefined()}}class xl{constructor(i,c,d,g){this.type=i,this.input=c,this.beginIndex=d,this.endIndex=g}static parse(i,c){if(i.length<=2||i.length>=5)return c.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);const d=c.parse(i[1],1,tr),g=c.parse(i[2],2,mt);if(!d||!g)return null;if(!Pe(d.type,[ee(tr),ir,tr]))return c.error(`Expected first argument to be of type array or string, but found ${he(d.type)} instead`);if(i.length===4){const b=c.parse(i[3],3,mt);return b?new xl(d.type,d,g,b):null}return new xl(d.type,d,g)}evaluate(i){const c=this.input.evaluate(i),d=this.beginIndex.evaluate(i);if(!Se(c,["string","array"]))throw new on(`Expected first argument to be of type array or string, but found ${he(Ln(c))} instead.`);if(this.endIndex){const g=this.endIndex.evaluate(i);return c.slice(d,g)}return c.slice(d)}eachChild(i){i(this.input),i(this.beginIndex),this.endIndex&&i(this.endIndex)}outputDefined(){return!1}}function Gh(s,i){return s==="=="||s==="!="?i.kind==="boolean"||i.kind==="string"||i.kind==="number"||i.kind==="null"||i.kind==="value":i.kind==="string"||i.kind==="number"||i.kind==="value"}function Wh(s,i,c,d){return d.compare(i,c)===0}function $s(s,i,c){const d=s!=="=="&&s!=="!=";return class Vb{constructor(b,w,T){this.type=Qt,this.lhs=b,this.rhs=w,this.collator=T,this.hasUntypedArgument=b.type.kind==="value"||w.type.kind==="value"}static parse(b,w){if(b.length!==3&&b.length!==4)return w.error("Expected two or three arguments.");const T=b[0];let I=w.parse(b[1],1,tr);if(!I)return null;if(!Gh(T,I.type))return w.concat(1).error(`"${T}" comparisons are not supported for type '${he(I.type)}'.`);let L=w.parse(b[2],2,tr);if(!L)return null;if(!Gh(T,L.type))return w.concat(2).error(`"${T}" comparisons are not supported for type '${he(L.type)}'.`);if(I.type.kind!==L.type.kind&&I.type.kind!=="value"&&L.type.kind!=="value")return w.error(`Cannot compare types '${he(I.type)}' and '${he(L.type)}'.`);d&&(I.type.kind==="value"&&L.type.kind!=="value"?I=new Bi(L.type,[I]):I.type.kind!=="value"&&L.type.kind==="value"&&(L=new Bi(I.type,[L])));let O=null;if(b.length===4){if(I.type.kind!=="string"&&L.type.kind!=="string"&&I.type.kind!=="value"&&L.type.kind!=="value")return w.error("Cannot use collator to compare non-string types.");if(O=w.parse(b[3],3,io),!O)return null}return new Vb(I,L,O)}evaluate(b){const w=this.lhs.evaluate(b),T=this.rhs.evaluate(b);if(d&&this.hasUntypedArgument){const I=Ln(w),L=Ln(T);if(I.kind!==L.kind||I.kind!=="string"&&I.kind!=="number")throw new on(`Expected arguments for "${s}" to be (string, string) or (number, number), but found (${I.kind}, ${L.kind}) instead.`)}if(this.collator&&!d&&this.hasUntypedArgument){const I=Ln(w),L=Ln(T);if(I.kind!=="string"||L.kind!=="string")return i(b,w,T)}return this.collator?c(b,w,T,this.collator.evaluate(b)):i(b,w,T)}eachChild(b){b(this.lhs),b(this.rhs),this.collator&&b(this.collator)}outputDefined(){return!0}}}const np=$s("==",function(s,i,c){return i===c},Wh),ip=$s("!=",function(s,i,c){return i!==c},function(s,i,c,d){return!Wh(0,i,c,d)}),op=$s("<",function(s,i,c){return i<c},function(s,i,c,d){return d.compare(i,c)<0}),sp=$s(">",function(s,i,c){return i>c},function(s,i,c,d){return d.compare(i,c)>0}),ap=$s("<=",function(s,i,c){return i<=c},function(s,i,c,d){return d.compare(i,c)<=0}),lp=$s(">=",function(s,i,c){return i>=c},function(s,i,c,d){return d.compare(i,c)>=0});class $c{constructor(i,c,d,g,b){this.type=ir,this.number=i,this.locale=c,this.currency=d,this.minFractionDigits=g,this.maxFractionDigits=b}static parse(i,c){if(i.length!==3)return c.error("Expected two arguments.");const d=c.parse(i[1],1,mt);if(!d)return null;const g=i[2];if(typeof g!="object"||Array.isArray(g))return c.error("NumberFormat options argument must be an object.");let b=null;if(g.locale&&(b=c.parse(g.locale,1,ir),!b))return null;let w=null;if(g.currency&&(w=c.parse(g.currency,1,ir),!w))return null;let T=null;if(g["min-fraction-digits"]&&(T=c.parse(g["min-fraction-digits"],1,mt),!T))return null;let I=null;return g["max-fraction-digits"]&&(I=c.parse(g["max-fraction-digits"],1,mt),!I)?null:new $c(d,b,w,T,I)}evaluate(i){return new Intl.NumberFormat(this.locale?this.locale.evaluate(i):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(i):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(i):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(i):void 0}).format(this.number.evaluate(i))}eachChild(i){i(this.number),this.locale&&i(this.locale),this.currency&&i(this.currency),this.minFractionDigits&&i(this.minFractionDigits),this.maxFractionDigits&&i(this.maxFractionDigits)}outputDefined(){return!1}}class Sl{constructor(i){this.type=cn,this.sections=i}static parse(i,c){if(i.length<2)return c.error("Expected at least one argument.");const d=i[1];if(!Array.isArray(d)&&typeof d=="object")return c.error("First argument must be an image or text section.");const g=[];let b=!1;for(let w=1;w<=i.length-1;++w){const T=i[w];if(b&&typeof T=="object"&&!Array.isArray(T)){b=!1;let I=null;if(T["font-scale"]&&(I=c.parse(T["font-scale"],1,mt),!I))return null;let L=null;if(T["text-font"]&&(L=c.parse(T["text-font"],1,ee(ir)),!L))return null;let O=null;if(T["text-color"]&&(O=c.parse(T["text-color"],1,jr),!O))return null;const j=g[g.length-1];j.scale=I,j.font=L,j.textColor=O}else{const I=c.parse(i[w],1,tr);if(!I)return null;const L=I.type.kind;if(L!=="string"&&L!=="value"&&L!=="null"&&L!=="resolvedImage")return c.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");b=!0,g.push({content:I,scale:null,font:null,textColor:null})}}return new Sl(g)}evaluate(i){return new Ri(this.sections.map(c=>{const d=c.content.evaluate(i);return Ln(d)===W?new Oc("",d,null,null,null):new Oc(Ea(d),null,c.scale?c.scale.evaluate(i):null,c.font?c.font.evaluate(i).join(","):null,c.textColor?c.textColor.evaluate(i):null)}))}eachChild(i){for(const c of this.sections)i(c.content),c.scale&&i(c.scale),c.font&&i(c.font),c.textColor&&i(c.textColor)}outputDefined(){return!1}}class qc{constructor(i){this.type=W,this.input=i}static parse(i,c){if(i.length!==2)return c.error("Expected two arguments.");const d=c.parse(i[1],1,ir);return d?new qc(d):c.error("No image name provided.")}evaluate(i){const c=this.input.evaluate(i),d=Ki.fromString(c);return d&&i.availableImages&&(d.available=i.availableImages.indexOf(c)>-1),d}eachChild(i){i(this.input)}outputDefined(){return!1}}class Gc{constructor(i){this.type=mt,this.input=i}static parse(i,c){if(i.length!==2)return c.error(`Expected 1 argument, but found ${i.length-1} instead.`);const d=c.parse(i[1],1);return d?d.type.kind!=="array"&&d.type.kind!=="string"&&d.type.kind!=="value"?c.error(`Expected argument of type string or array, but found ${he(d.type)} instead.`):new Gc(d):null}evaluate(i){const c=this.input.evaluate(i);if(typeof c=="string"||Array.isArray(c))return c.length;throw new on(`Expected value to be of type string or array, but found ${he(Ln(c))} instead.`)}eachChild(i){i(this.input)}outputDefined(){return!1}}const qs={"==":np,"!=":ip,">":sp,"<":op,">=":lp,"<=":ap,array:Bi,at:Nc,boolean:Bi,case:Vc,coalesce:vl,collator:Vs,format:Sl,image:qc,in:jc,"index-of":wl,interpolate:si,"interpolate-hcl":si,"interpolate-lab":si,length:Gc,let:bl,literal:Ko,match:Uc,number:Bi,"number-format":$c,object:Bi,slice:xl,step:za,string:Bi,"to-boolean":yo,"to-color":yo,"to-number":yo,"to-string":yo,var:gl,within:ms};function Zh(s,[i,c,d,g]){i=i.evaluate(s),c=c.evaluate(s),d=d.evaluate(s);const b=g?g.evaluate(s):1,w=Us(i,c,d,b);if(w)throw new on(w);return new zr(i/255,c/255,d/255,b,!1)}function Hh(s,i){return s in i}function Wc(s,i){const c=i[s];return c===void 0?null:c}function _s(s){return{type:s}}function Xh(s){return{result:"success",value:s}}function Gs(s){return{result:"error",value:s}}function Ws(s){return s["property-type"]==="data-driven"||s["property-type"]==="cross-faded-data-driven"}function Kh(s){return!!s.expression&&s.expression.parameters.indexOf("zoom")>-1}function Zc(s){return!!s.expression&&s.expression.interpolated}function Er(s){return s instanceof Number?"number":s instanceof String?"string":s instanceof Boolean?"boolean":Array.isArray(s)?"array":s===null?"null":typeof s}function kl(s){return typeof s=="object"&&s!==null&&!Array.isArray(s)}function cp(s){return s}function Jh(s,i){const c=i.type==="color",d=s.stops&&typeof s.stops[0][0]=="object",g=d||!(d||s.property!==void 0),b=s.type||(Zc(i)?"exponential":"interval");if(c||i.type==="padding"){const O=c?zr.parse:Si.parse;(s=Xn({},s)).stops&&(s.stops=s.stops.map(j=>[j[0],O(j[1])])),s.default=O(s.default?s.default:i.default)}if(s.colorSpace&&(w=s.colorSpace)!=="rgb"&&w!=="hcl"&&w!=="lab")throw new Error(`Unknown color space: "${s.colorSpace}"`);var w;let T,I,L;if(b==="exponential")T=xr;else if(b==="interval")T=up;else if(b==="categorical"){T=Tn,I=Object.create(null);for(const O of s.stops)I[O[0]]=O[1];L=typeof s.stops[0][0]}else{if(b!=="identity")throw new Error(`Unknown function type "${b}"`);T=Hc}if(d){const O={},j=[];for(let Q=0;Q<s.stops.length;Q++){const ae=s.stops[Q],_e=ae[0].zoom;O[_e]===void 0&&(O[_e]={zoom:_e,type:s.type,property:s.property,default:s.default,stops:[]},j.push(_e)),O[_e].stops.push([ae[0].value,ae[1]])}const Z=[];for(const Q of j)Z.push([O[Q].zoom,Jh(O[Q],i)]);const K={name:"linear"};return{kind:"composite",interpolationType:K,interpolationFactor:si.interpolationFactor.bind(void 0,K),zoomStops:Z.map(Q=>Q[0]),evaluate:({zoom:Q},ae)=>xr({stops:Z,base:s.base},i,Q).evaluate(Q,ae)}}if(g){const O=b==="exponential"?{name:"exponential",base:s.base!==void 0?s.base:1}:null;return{kind:"camera",interpolationType:O,interpolationFactor:si.interpolationFactor.bind(void 0,O),zoomStops:s.stops.map(j=>j[0]),evaluate:({zoom:j})=>T(s,i,j,I,L)}}return{kind:"source",evaluate(O,j){const Z=j&&j.properties?j.properties[s.property]:void 0;return Z===void 0?Da(s.default,i.default):T(s,i,Z,I,L)}}}function Da(s,i,c){return s!==void 0?s:i!==void 0?i:c!==void 0?c:void 0}function Tn(s,i,c,d,g){return Da(typeof c===g?d[c]:void 0,s.default,i.default)}function up(s,i,c){if(Er(c)!=="number")return Da(s.default,i.default);const d=s.stops.length;if(d===1||c<=s.stops[0][0])return s.stops[0][1];if(c>=s.stops[d-1][0])return s.stops[d-1][1];const g=Pa(s.stops.map(b=>b[0]),c);return s.stops[g][1]}function xr(s,i,c){const d=s.base!==void 0?s.base:1;if(Er(c)!=="number")return Da(s.default,i.default);const g=s.stops.length;if(g===1||c<=s.stops[0][0])return s.stops[0][1];if(c>=s.stops[g-1][0])return s.stops[g-1][1];const b=Pa(s.stops.map(O=>O[0]),c),w=function(O,j,Z,K){const Q=K-Z,ae=O-Z;return Q===0?0:j===1?ae/Q:(Math.pow(j,ae)-1)/(Math.pow(j,Q)-1)}(c,d,s.stops[b][0],s.stops[b+1][0]),T=s.stops[b][1],I=s.stops[b+1][1],L=pi[i.type]||cp;return typeof T.evaluate=="function"?{evaluate(...O){const j=T.evaluate.apply(void 0,O),Z=I.evaluate.apply(void 0,O);if(j!==void 0&&Z!==void 0)return L(j,Z,w,s.colorSpace)}}:L(T,I,w,s.colorSpace)}function Hc(s,i,c){switch(i.type){case"color":c=zr.parse(c);break;case"formatted":c=Ri.fromString(c.toString());break;case"resolvedImage":c=Ki.fromString(c.toString());break;case"padding":c=Si.parse(c);break;default:Er(c)===i.type||i.type==="enum"&&i.values[c]||(c=void 0)}return Da(c,s.default,i.default)}Fi.register(qs,{error:[{kind:"error"},[ir],(s,[i])=>{throw new on(i.evaluate(s))}],typeof:[ir,[tr],(s,[i])=>he(Ln(i.evaluate(s)))],"to-rgba":[ee(mt,4),[jr],(s,[i])=>{const[c,d,g,b]=i.evaluate(s).rgb;return[255*c,255*d,255*g,b]}],rgb:[jr,[mt,mt,mt],Zh],rgba:[jr,[mt,mt,mt,mt],Zh],has:{type:Qt,overloads:[[[ir],(s,[i])=>Hh(i.evaluate(s),s.properties())],[[ir,wi],(s,[i,c])=>Hh(i.evaluate(s),c.evaluate(s))]]},get:{type:tr,overloads:[[[ir],(s,[i])=>Wc(i.evaluate(s),s.properties())],[[ir,wi],(s,[i,c])=>Wc(i.evaluate(s),c.evaluate(s))]]},"feature-state":[tr,[ir],(s,[i])=>Wc(i.evaluate(s),s.featureState||{})],properties:[wi,[],s=>s.properties()],"geometry-type":[ir,[],s=>s.geometryType()],id:[tr,[],s=>s.id()],zoom:[mt,[],s=>s.globals.zoom],"heatmap-density":[mt,[],s=>s.globals.heatmapDensity||0],"line-progress":[mt,[],s=>s.globals.lineProgress||0],accumulated:[tr,[],s=>s.globals.accumulated===void 0?null:s.globals.accumulated],"+":[mt,_s(mt),(s,i)=>{let c=0;for(const d of i)c+=d.evaluate(s);return c}],"*":[mt,_s(mt),(s,i)=>{let c=1;for(const d of i)c*=d.evaluate(s);return c}],"-":{type:mt,overloads:[[[mt,mt],(s,[i,c])=>i.evaluate(s)-c.evaluate(s)],[[mt],(s,[i])=>-i.evaluate(s)]]},"/":[mt,[mt,mt],(s,[i,c])=>i.evaluate(s)/c.evaluate(s)],"%":[mt,[mt,mt],(s,[i,c])=>i.evaluate(s)%c.evaluate(s)],ln2:[mt,[],()=>Math.LN2],pi:[mt,[],()=>Math.PI],e:[mt,[],()=>Math.E],"^":[mt,[mt,mt],(s,[i,c])=>Math.pow(i.evaluate(s),c.evaluate(s))],sqrt:[mt,[mt],(s,[i])=>Math.sqrt(i.evaluate(s))],log10:[mt,[mt],(s,[i])=>Math.log(i.evaluate(s))/Math.LN10],ln:[mt,[mt],(s,[i])=>Math.log(i.evaluate(s))],log2:[mt,[mt],(s,[i])=>Math.log(i.evaluate(s))/Math.LN2],sin:[mt,[mt],(s,[i])=>Math.sin(i.evaluate(s))],cos:[mt,[mt],(s,[i])=>Math.cos(i.evaluate(s))],tan:[mt,[mt],(s,[i])=>Math.tan(i.evaluate(s))],asin:[mt,[mt],(s,[i])=>Math.asin(i.evaluate(s))],acos:[mt,[mt],(s,[i])=>Math.acos(i.evaluate(s))],atan:[mt,[mt],(s,[i])=>Math.atan(i.evaluate(s))],min:[mt,_s(mt),(s,i)=>Math.min(...i.map(c=>c.evaluate(s)))],max:[mt,_s(mt),(s,i)=>Math.max(...i.map(c=>c.evaluate(s)))],abs:[mt,[mt],(s,[i])=>Math.abs(i.evaluate(s))],round:[mt,[mt],(s,[i])=>{const c=i.evaluate(s);return c<0?-Math.round(-c):Math.round(c)}],floor:[mt,[mt],(s,[i])=>Math.floor(i.evaluate(s))],ceil:[mt,[mt],(s,[i])=>Math.ceil(i.evaluate(s))],"filter-==":[Qt,[ir,tr],(s,[i,c])=>s.properties()[i.value]===c.value],"filter-id-==":[Qt,[tr],(s,[i])=>s.id()===i.value],"filter-type-==":[Qt,[ir],(s,[i])=>s.geometryType()===i.value],"filter-<":[Qt,[ir,tr],(s,[i,c])=>{const d=s.properties()[i.value],g=c.value;return typeof d==typeof g&&d<g}],"filter-id-<":[Qt,[tr],(s,[i])=>{const c=s.id(),d=i.value;return typeof c==typeof d&&c<d}],"filter->":[Qt,[ir,tr],(s,[i,c])=>{const d=s.properties()[i.value],g=c.value;return typeof d==typeof g&&d>g}],"filter-id->":[Qt,[tr],(s,[i])=>{const c=s.id(),d=i.value;return typeof c==typeof d&&c>d}],"filter-<=":[Qt,[ir,tr],(s,[i,c])=>{const d=s.properties()[i.value],g=c.value;return typeof d==typeof g&&d<=g}],"filter-id-<=":[Qt,[tr],(s,[i])=>{const c=s.id(),d=i.value;return typeof c==typeof d&&c<=d}],"filter->=":[Qt,[ir,tr],(s,[i,c])=>{const d=s.properties()[i.value],g=c.value;return typeof d==typeof g&&d>=g}],"filter-id->=":[Qt,[tr],(s,[i])=>{const c=s.id(),d=i.value;return typeof c==typeof d&&c>=d}],"filter-has":[Qt,[tr],(s,[i])=>i.value in s.properties()],"filter-has-id":[Qt,[],s=>s.id()!==null&&s.id()!==void 0],"filter-type-in":[Qt,[ee(ir)],(s,[i])=>i.value.indexOf(s.geometryType())>=0],"filter-id-in":[Qt,[ee(tr)],(s,[i])=>i.value.indexOf(s.id())>=0],"filter-in-small":[Qt,[ir,ee(tr)],(s,[i,c])=>c.value.indexOf(s.properties()[i.value])>=0],"filter-in-large":[Qt,[ir,ee(tr)],(s,[i,c])=>function(d,g,b,w){for(;b<=w;){const T=b+w>>1;if(g[T]===d)return!0;g[T]>d?w=T-1:b=T+1}return!1}(s.properties()[i.value],c.value,0,c.value.length-1)],all:{type:Qt,overloads:[[[Qt,Qt],(s,[i,c])=>i.evaluate(s)&&c.evaluate(s)],[_s(Qt),(s,i)=>{for(const c of i)if(!c.evaluate(s))return!1;return!0}]]},any:{type:Qt,overloads:[[[Qt,Qt],(s,[i,c])=>i.evaluate(s)||c.evaluate(s)],[_s(Qt),(s,i)=>{for(const c of i)if(c.evaluate(s))return!0;return!1}]]},"!":[Qt,[Qt],(s,[i])=>!i.evaluate(s)],"is-supported-script":[Qt,[ir],(s,[i])=>{const c=s.globals&&s.globals.isSupportedScript;return!c||c(i.evaluate(s))}],upcase:[ir,[ir],(s,[i])=>i.evaluate(s).toUpperCase()],downcase:[ir,[ir],(s,[i])=>i.evaluate(s).toLowerCase()],concat:[ir,_s(tr),(s,i)=>i.map(c=>Ea(c.evaluate(s))).join("")],"resolved-locale":[ir,[io],(s,[i])=>i.evaluate(s).resolvedLocale()]});class Hr{constructor(i,c){var d;this.expression=i,this._warningHistory={},this._evaluator=new Dr,this._defaultValue=c?(d=c).type==="color"&&kl(d.default)?new zr(0,0,0,0):d.type==="color"?zr.parse(d.default)||null:d.type==="padding"?Si.parse(d.default)||null:d.type==="variableAnchorOffsetCollection"?Xi.parse(d.default)||null:d.default===void 0?null:d.default:null,this._enumValues=c&&c.type==="enum"?c.values:null}evaluateWithoutErrorHandling(i,c,d,g,b,w){return this._evaluator.globals=i,this._evaluator.feature=c,this._evaluator.featureState=d,this._evaluator.canonical=g,this._evaluator.availableImages=b||null,this._evaluator.formattedSection=w,this.expression.evaluate(this._evaluator)}evaluate(i,c,d,g,b,w){this._evaluator.globals=i,this._evaluator.feature=c||null,this._evaluator.featureState=d||null,this._evaluator.canonical=g,this._evaluator.availableImages=b||null,this._evaluator.formattedSection=w||null;try{const T=this.expression.evaluate(this._evaluator);if(T==null||typeof T=="number"&&T!=T)return this._defaultValue;if(this._enumValues&&!(T in this._enumValues))throw new on(`Expected value to be one of ${Object.keys(this._enumValues).map(I=>JSON.stringify(I)).join(", ")}, but found ${JSON.stringify(T)} instead.`);return T}catch(T){return this._warningHistory[T.message]||(this._warningHistory[T.message]=!0,typeof console<"u"&&console.warn(T.message)),this._defaultValue}}}function Ur(s){return Array.isArray(s)&&s.length>0&&typeof s[0]=="string"&&s[0]in qs}function ys(s,i){const c=new hl(qs,Ia,[],i?function(g){const b={color:jr,string:ir,number:mt,enum:ir,boolean:Qt,formatted:cn,padding:ge,resolvedImage:W,variableAnchorOffsetCollection:X};return g.type==="array"?ee(b[g.value]||tr,g.length):b[g.type]}(i):void 0),d=c.parse(s,void 0,void 0,void 0,i&&i.type==="string"?{typeAnnotation:"coerce"}:void 0);return d?Xh(new Hr(d,i)):Gs(c.errors)}class Tl{constructor(i,c){this.kind=i,this._styleExpression=c,this.isStateDependent=i!=="constant"&&!Aa(c.expression)}evaluateWithoutErrorHandling(i,c,d,g,b,w){return this._styleExpression.evaluateWithoutErrorHandling(i,c,d,g,b,w)}evaluate(i,c,d,g,b,w){return this._styleExpression.evaluate(i,c,d,g,b,w)}}class Xc{constructor(i,c,d,g){this.kind=i,this.zoomStops=d,this._styleExpression=c,this.isStateDependent=i!=="camera"&&!Aa(c.expression),this.interpolationType=g}evaluateWithoutErrorHandling(i,c,d,g,b,w){return this._styleExpression.evaluateWithoutErrorHandling(i,c,d,g,b,w)}evaluate(i,c,d,g,b,w){return this._styleExpression.evaluate(i,c,d,g,b,w)}interpolationFactor(i,c,d){return this.interpolationType?si.interpolationFactor(this.interpolationType,i,c,d):0}}function Yh(s,i){const c=ys(s,i);if(c.result==="error")return c;const d=c.value.expression,g=_l(d);if(!g&&!Ws(i))return Gs([new kn("","data expressions not supported")]);const b=La(d,["zoom"]);if(!b&&!Kh(i))return Gs([new kn("","zoom expressions not supported")]);const w=Cl(d);return w||b?w instanceof kn?Gs([w]):w instanceof si&&!Zc(i)?Gs([new kn("",'"interpolate" expressions cannot be used with this property')]):Xh(w?new Xc(g?"camera":"composite",c.value,w.labels,w instanceof si?w.interpolation:void 0):new Tl(g?"constant":"source",c.value)):Gs([new kn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class El{constructor(i,c){this._parameters=i,this._specification=c,Xn(this,Jh(this._parameters,this._specification))}static deserialize(i){return new El(i._parameters,i._specification)}static serialize(i){return{_parameters:i._parameters,_specification:i._specification}}}function Cl(s){let i=null;if(s instanceof bl)i=Cl(s.result);else if(s instanceof vl){for(const c of s.args)if(i=Cl(c),i)break}else(s instanceof za||s instanceof si)&&s.input instanceof Fi&&s.input.name==="zoom"&&(i=s);return i instanceof kn||s.eachChild(c=>{const d=Cl(c);d instanceof kn?i=d:!i&&d?i=new kn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):i&&d&&i!==d&&(i=new kn("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),i}function Ml(s){if(s===!0||s===!1)return!0;if(!Array.isArray(s)||s.length===0)return!1;switch(s[0]){case"has":return s.length>=2&&s[1]!=="$id"&&s[1]!=="$type";case"in":return s.length>=3&&(typeof s[1]!="string"||Array.isArray(s[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return s.length!==3||Array.isArray(s[1])||Array.isArray(s[2]);case"any":case"all":for(const i of s.slice(1))if(!Ml(i)&&typeof i!="boolean")return!1;return!0;default:return!0}}const Qh={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Il(s){if(s==null)return{filter:()=>!0,needGeometry:!1};Ml(s)||(s=Ll(s));const i=ys(s,Qh);if(i.result==="error")throw new Error(i.value.map(c=>`${c.key}: ${c.message}`).join(", "));return{filter:(c,d,g)=>i.value.evaluate(c,d,{},g),needGeometry:Al(s)}}function ef(s,i){return s<i?-1:s>i?1:0}function Al(s){if(!Array.isArray(s))return!1;if(s[0]==="within")return!0;for(let i=1;i<s.length;i++)if(Al(s[i]))return!0;return!1}function Ll(s){if(!s)return!0;const i=s[0];return s.length<=1?i!=="any":i==="=="?Kc(s[1],s[2],"=="):i==="!="?Pl(Kc(s[1],s[2],"==")):i==="<"||i===">"||i==="<="||i===">="?Kc(s[1],s[2],i):i==="any"?(c=s.slice(1),["any"].concat(c.map(Ll))):i==="all"?["all"].concat(s.slice(1).map(Ll)):i==="none"?["all"].concat(s.slice(1).map(Ll).map(Pl)):i==="in"?tf(s[1],s.slice(2)):i==="!in"?Pl(tf(s[1],s.slice(2))):i==="has"?rf(s[1]):i==="!has"?Pl(rf(s[1])):i!=="within"||s;var c}function Kc(s,i,c){switch(s){case"$type":return[`filter-type-${c}`,i];case"$id":return[`filter-id-${c}`,i];default:return[`filter-${c}`,s,i]}}function tf(s,i){if(i.length===0)return!1;switch(s){case"$type":return["filter-type-in",["literal",i]];case"$id":return["filter-id-in",["literal",i]];default:return i.length>200&&!i.some(c=>typeof c!=typeof i[0])?["filter-in-large",s,["literal",i.sort(ef)]]:["filter-in-small",s,["literal",i]]}}function rf(s){switch(s){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",s]}}function Pl(s){return["!",s]}function Jc(s){const i=typeof s;if(i==="number"||i==="boolean"||i==="string"||s==null)return JSON.stringify(s);if(Array.isArray(s)){let g="[";for(const b of s)g+=`${Jc(b)},`;return`${g}]`}const c=Object.keys(s).sort();let d="{";for(let g=0;g<c.length;g++)d+=`${JSON.stringify(c[g])}:${Jc(s[c[g]])},`;return`${d}}`}function hp(s){let i="";for(const c of nr)i+=`/${Jc(s[c])}`;return i}function nf(s){const i=s.value;return i?[new lt(s.key,i,"constants have been deprecated as of v8")]:[]}function hn(s){return s instanceof Number||s instanceof String||s instanceof Boolean?s.valueOf():s}function Yo(s){if(Array.isArray(s))return s.map(Yo);if(s instanceof Object&&!(s instanceof Number||s instanceof String||s instanceof Boolean)){const i={};for(const c in s)i[c]=Yo(s[c]);return i}return hn(s)}function mi(s){const i=s.key,c=s.value,d=s.valueSpec||{},g=s.objectElementValidators||{},b=s.style,w=s.styleSpec,T=s.validateSpec;let I=[];const L=Er(c);if(L!=="object")return[new lt(i,c,`object expected, ${L} found`)];for(const O in c){const j=O.split(".")[0],Z=d[j]||d["*"];let K;if(g[j])K=g[j];else if(d[j])K=T;else if(g["*"])K=g["*"];else{if(!d["*"]){I.push(new lt(i,c[O],`unknown property "${O}"`));continue}K=T}I=I.concat(K({key:(i&&`${i}.`)+O,value:c[O],valueSpec:Z,style:b,styleSpec:w,object:c,objectKey:O,validateSpec:T},c))}for(const O in d)g[O]||d[O].required&&d[O].default===void 0&&c[O]===void 0&&I.push(new lt(i,c,`missing required property "${O}"`));return I}function Yc(s){const i=s.value,c=s.valueSpec,d=s.style,g=s.styleSpec,b=s.key,w=s.arrayElementValidator||s.validateSpec;if(Er(i)!=="array")return[new lt(b,i,`array expected, ${Er(i)} found`)];if(c.length&&i.length!==c.length)return[new lt(b,i,`array length ${c.length} expected, length ${i.length} found`)];if(c["min-length"]&&i.length<c["min-length"])return[new lt(b,i,`array length at least ${c["min-length"]} expected, length ${i.length} found`)];let T={type:c.value,values:c.values};g.$version<7&&(T.function=c.function),Er(c.value)==="object"&&(T=c.value);let I=[];for(let L=0;L<i.length;L++)I=I.concat(w({array:i,arrayIndex:L,value:i[L],valueSpec:T,validateSpec:s.validateSpec,style:d,styleSpec:g,key:`${b}[${L}]`}));return I}function zl(s){const i=s.key,c=s.value,d=s.valueSpec;let g=Er(c);return g==="number"&&c!=c&&(g="NaN"),g!=="number"?[new lt(i,c,`number expected, ${g} found`)]:"minimum"in d&&c<d.minimum?[new lt(i,c,`${c} is less than the minimum value ${d.minimum}`)]:"maximum"in d&&c>d.maximum?[new lt(i,c,`${c} is greater than the maximum value ${d.maximum}`)]:[]}function of(s){const i=s.valueSpec,c=hn(s.value.type);let d,g,b,w={};const T=c!=="categorical"&&s.value.property===void 0,I=!T,L=Er(s.value.stops)==="array"&&Er(s.value.stops[0])==="array"&&Er(s.value.stops[0][0])==="object",O=mi({key:s.key,value:s.value,valueSpec:s.styleSpec.function,validateSpec:s.validateSpec,style:s.style,styleSpec:s.styleSpec,objectElementValidators:{stops:function(K){if(c==="identity")return[new lt(K.key,K.value,'identity function may not have a "stops" property')];let Q=[];const ae=K.value;return Q=Q.concat(Yc({key:K.key,value:ae,valueSpec:K.valueSpec,validateSpec:K.validateSpec,style:K.style,styleSpec:K.styleSpec,arrayElementValidator:j})),Er(ae)==="array"&&ae.length===0&&Q.push(new lt(K.key,ae,"array must have at least one stop")),Q},default:function(K){return K.validateSpec({key:K.key,value:K.value,valueSpec:i,validateSpec:K.validateSpec,style:K.style,styleSpec:K.styleSpec})}}});return c==="identity"&&T&&O.push(new lt(s.key,s.value,'missing required property "property"')),c==="identity"||s.value.stops||O.push(new lt(s.key,s.value,'missing required property "stops"')),c==="exponential"&&s.valueSpec.expression&&!Zc(s.valueSpec)&&O.push(new lt(s.key,s.value,"exponential functions not supported")),s.styleSpec.$version>=8&&(I&&!Ws(s.valueSpec)?O.push(new lt(s.key,s.value,"property functions not supported")):T&&!Kh(s.valueSpec)&&O.push(new lt(s.key,s.value,"zoom functions not supported"))),c!=="categorical"&&!L||s.value.property!==void 0||O.push(new lt(s.key,s.value,'"property" property is required')),O;function j(K){let Q=[];const ae=K.value,_e=K.key;if(Er(ae)!=="array")return[new lt(_e,ae,`array expected, ${Er(ae)} found`)];if(ae.length!==2)return[new lt(_e,ae,`array length 2 expected, length ${ae.length} found`)];if(L){if(Er(ae[0])!=="object")return[new lt(_e,ae,`object expected, ${Er(ae[0])} found`)];if(ae[0].zoom===void 0)return[new lt(_e,ae,"object stop key must have zoom")];if(ae[0].value===void 0)return[new lt(_e,ae,"object stop key must have value")];if(b&&b>hn(ae[0].zoom))return[new lt(_e,ae[0].zoom,"stop zoom values must appear in ascending order")];hn(ae[0].zoom)!==b&&(b=hn(ae[0].zoom),g=void 0,w={}),Q=Q.concat(mi({key:`${_e}[0]`,value:ae[0],valueSpec:{zoom:{}},validateSpec:K.validateSpec,style:K.style,styleSpec:K.styleSpec,objectElementValidators:{zoom:zl,value:Z}}))}else Q=Q.concat(Z({key:`${_e}[0]`,value:ae[0],valueSpec:{},validateSpec:K.validateSpec,style:K.style,styleSpec:K.styleSpec},ae));return Ur(Yo(ae[1]))?Q.concat([new lt(`${_e}[1]`,ae[1],"expressions are not allowed in function stops.")]):Q.concat(K.validateSpec({key:`${_e}[1]`,value:ae[1],valueSpec:i,validateSpec:K.validateSpec,style:K.style,styleSpec:K.styleSpec}))}function Z(K,Q){const ae=Er(K.value),_e=hn(K.value),xe=K.value!==null?K.value:Q;if(d){if(ae!==d)return[new lt(K.key,xe,`${ae} stop domain type must match previous stop domain type ${d}`)]}else d=ae;if(ae!=="number"&&ae!=="string"&&ae!=="boolean")return[new lt(K.key,xe,"stop domain value must be a number, string, or boolean")];if(ae!=="number"&&c!=="categorical"){let Re=`number expected, ${ae} found`;return Ws(i)&&c===void 0&&(Re+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new lt(K.key,xe,Re)]}return c!=="categorical"||ae!=="number"||isFinite(_e)&&Math.floor(_e)===_e?c!=="categorical"&&ae==="number"&&g!==void 0&&_e<g?[new lt(K.key,xe,"stop domain values must appear in ascending order")]:(g=_e,c==="categorical"&&_e in w?[new lt(K.key,xe,"stop domain values must be unique")]:(w[_e]=!0,[])):[new lt(K.key,xe,`integer expected, found ${_e}`)]}}function Qo(s){const i=(s.expressionContext==="property"?Yh:ys)(Yo(s.value),s.valueSpec);if(i.result==="error")return i.value.map(d=>new lt(`${s.key}${d.key}`,s.value,d.message));const c=i.value.expression||i.value._styleExpression.expression;if(s.expressionContext==="property"&&s.propertyKey==="text-font"&&!c.outputDefined())return[new lt(s.key,s.value,`Invalid data expression for "${s.propertyKey}". Output values must be contained as literals within the expression.`)];if(s.expressionContext==="property"&&s.propertyType==="layout"&&!Aa(c))return[new lt(s.key,s.value,'"feature-state" data expressions are not supported with layout properties.')];if(s.expressionContext==="filter"&&!Aa(c))return[new lt(s.key,s.value,'"feature-state" data expressions are not supported with filters.')];if(s.expressionContext&&s.expressionContext.indexOf("cluster")===0){if(!La(c,["zoom","feature-state"]))return[new lt(s.key,s.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(s.expressionContext==="cluster-initial"&&!_l(c))return[new lt(s.key,s.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function es(s){const i=s.key,c=s.value,d=s.valueSpec,g=[];return Array.isArray(d.values)?d.values.indexOf(hn(c))===-1&&g.push(new lt(i,c,`expected one of [${d.values.join(", ")}], ${JSON.stringify(c)} found`)):Object.keys(d.values).indexOf(hn(c))===-1&&g.push(new lt(i,c,`expected one of [${Object.keys(d.values).join(", ")}], ${JSON.stringify(c)} found`)),g}function Zs(s){return Ml(Yo(s.value))?Qo(Xn({},s,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Qc(s)}function Qc(s){const i=s.value,c=s.key;if(Er(i)!=="array")return[new lt(c,i,`array expected, ${Er(i)} found`)];const d=s.styleSpec;let g,b=[];if(i.length<1)return[new lt(c,i,"filter array must have at least 1 element")];switch(b=b.concat(es({key:`${c}[0]`,value:i[0],valueSpec:d.filter_operator,style:s.style,styleSpec:s.styleSpec})),hn(i[0])){case"<":case"<=":case">":case">=":i.length>=2&&hn(i[1])==="$type"&&b.push(new lt(c,i,`"$type" cannot be use with operator "${i[0]}"`));case"==":case"!=":i.length!==3&&b.push(new lt(c,i,`filter array for operator "${i[0]}" must have 3 elements`));case"in":case"!in":i.length>=2&&(g=Er(i[1]),g!=="string"&&b.push(new lt(`${c}[1]`,i[1],`string expected, ${g} found`)));for(let w=2;w<i.length;w++)g=Er(i[w]),hn(i[1])==="$type"?b=b.concat(es({key:`${c}[${w}]`,value:i[w],valueSpec:d.geometry_type,style:s.style,styleSpec:s.styleSpec})):g!=="string"&&g!=="number"&&g!=="boolean"&&b.push(new lt(`${c}[${w}]`,i[w],`string, number, or boolean expected, ${g} found`));break;case"any":case"all":case"none":for(let w=1;w<i.length;w++)b=b.concat(Qc({key:`${c}[${w}]`,value:i[w],style:s.style,styleSpec:s.styleSpec}));break;case"has":case"!has":g=Er(i[1]),i.length!==2?b.push(new lt(c,i,`filter array for "${i[0]}" operator must have 2 elements`)):g!=="string"&&b.push(new lt(`${c}[1]`,i[1],`string expected, ${g} found`));break;case"within":g=Er(i[1]),i.length!==2?b.push(new lt(c,i,`filter array for "${i[0]}" operator must have 2 elements`)):g!=="object"&&b.push(new lt(`${c}[1]`,i[1],`object expected, ${g} found`))}return b}function Dl(s,i){const c=s.key,d=s.validateSpec,g=s.style,b=s.styleSpec,w=s.value,T=s.objectKey,I=b[`${i}_${s.layerType}`];if(!I)return[];const L=T.match(/^(.*)-transition$/);if(i==="paint"&&L&&I[L[1]]&&I[L[1]].transition)return d({key:c,value:w,valueSpec:b.transition,style:g,styleSpec:b});const O=s.valueSpec||I[T];if(!O)return[new lt(c,w,`unknown property "${T}"`)];let j;if(Er(w)==="string"&&Ws(O)&&!O.tokens&&(j=/^{([^}]+)}$/.exec(w)))return[new lt(c,w,`"${T}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(j[1])} }\`.`)];const Z=[];return s.layerType==="symbol"&&(T==="text-field"&&g&&!g.glyphs&&Z.push(new lt(c,w,'use of "text-field" requires a style "glyphs" property')),T==="text-font"&&kl(Yo(w))&&hn(w.type)==="identity"&&Z.push(new lt(c,w,'"text-font" does not support identity functions'))),Z.concat(d({key:s.key,value:w,valueSpec:O,style:g,styleSpec:b,expressionContext:"property",propertyType:i,propertyKey:T}))}function eu(s){return Dl(s,"paint")}function tu(s){return Dl(s,"layout")}function Ra(s){let i=[];const c=s.value,d=s.key,g=s.style,b=s.styleSpec;c.type||c.ref||i.push(new lt(d,c,'either "type" or "ref" is required'));let w=hn(c.type);const T=hn(c.ref);if(c.id){const I=hn(c.id);for(let L=0;L<s.arrayIndex;L++){const O=g.layers[L];hn(O.id)===I&&i.push(new lt(d,c.id,`duplicate layer id "${c.id}", previously used at line ${O.id.__line__}`))}}if("ref"in c){let I;["type","source","source-layer","filter","layout"].forEach(L=>{L in c&&i.push(new lt(d,c[L],`"${L}" is prohibited for ref layers`))}),g.layers.forEach(L=>{hn(L.id)===T&&(I=L)}),I?I.ref?i.push(new lt(d,c.ref,"ref cannot reference another ref layer")):w=hn(I.type):i.push(new lt(d,c.ref,`ref layer "${T}" not found`))}else if(w!=="background")if(c.source){const I=g.sources&&g.sources[c.source],L=I&&hn(I.type);I?L==="vector"&&w==="raster"?i.push(new lt(d,c.source,`layer "${c.id}" requires a raster source`)):L!=="raster-dem"&&w==="hillshade"?i.push(new lt(d,c.source,`layer "${c.id}" requires a raster-dem source`)):L==="raster"&&w!=="raster"?i.push(new lt(d,c.source,`layer "${c.id}" requires a vector source`)):L!=="vector"||c["source-layer"]?L==="raster-dem"&&w!=="hillshade"?i.push(new lt(d,c.source,"raster-dem source can only be used with layer type 'hillshade'.")):w!=="line"||!c.paint||!c.paint["line-gradient"]||L==="geojson"&&I.lineMetrics||i.push(new lt(d,c,`layer "${c.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):i.push(new lt(d,c,`layer "${c.id}" must specify a "source-layer"`)):i.push(new lt(d,c.source,`source "${c.source}" not found`))}else i.push(new lt(d,c,'missing required property "source"'));return i=i.concat(mi({key:d,value:c,valueSpec:b.layer,style:s.style,styleSpec:s.styleSpec,validateSpec:s.validateSpec,objectElementValidators:{"*":()=>[],type:()=>s.validateSpec({key:`${d}.type`,value:c.type,valueSpec:b.layer.type,style:s.style,styleSpec:s.styleSpec,validateSpec:s.validateSpec,object:c,objectKey:"type"}),filter:Zs,layout:I=>mi({layer:c,key:I.key,value:I.value,style:I.style,styleSpec:I.styleSpec,validateSpec:I.validateSpec,objectElementValidators:{"*":L=>tu(Xn({layerType:w},L))}}),paint:I=>mi({layer:c,key:I.key,value:I.value,style:I.style,styleSpec:I.styleSpec,validateSpec:I.validateSpec,objectElementValidators:{"*":L=>eu(Xn({layerType:w},L))}})}})),i}function vs(s){const i=s.value,c=s.key,d=Er(i);return d!=="string"?[new lt(c,i,`string expected, ${d} found`)]:[]}const sf={promoteId:function({key:s,value:i}){if(Er(i)==="string")return vs({key:s,value:i});{const c=[];for(const d in i)c.push(...vs({key:`${s}.${d}`,value:i[d]}));return c}}};function af(s){const i=s.value,c=s.key,d=s.styleSpec,g=s.style,b=s.validateSpec;if(!i.type)return[new lt(c,i,'"type" is required')];const w=hn(i.type);let T;switch(w){case"vector":case"raster":return T=mi({key:c,value:i,valueSpec:d[`source_${w.replace("-","_")}`],style:s.style,styleSpec:d,objectElementValidators:sf,validateSpec:b}),T;case"raster-dem":return T=function(I){var L;const O=(L=I.sourceName)!==null&&L!==void 0?L:"",j=I.value,Z=I.styleSpec,K=Z.source_raster_dem,Q=I.style;let ae=[];const _e=Er(j);if(j===void 0)return ae;if(_e!=="object")return ae.push(new lt("source_raster_dem",j,`object expected, ${_e} found`)),ae;const xe=hn(j.encoding)==="custom",Re=["redFactor","greenFactor","blueFactor","baseShift"],ke=I.value.encoding?`"${I.value.encoding}"`:"Default";for(const Ae in j)!xe&&Re.includes(Ae)?ae.push(new lt(Ae,j[Ae],`In "${O}": "${Ae}" is only valid when "encoding" is set to "custom". ${ke} encoding found`)):K[Ae]?ae=ae.concat(I.validateSpec({key:Ae,value:j[Ae],valueSpec:K[Ae],validateSpec:I.validateSpec,style:Q,styleSpec:Z})):ae.push(new lt(Ae,j[Ae],`unknown property "${Ae}"`));return ae}({sourceName:c,value:i,style:s.style,styleSpec:d,validateSpec:b}),T;case"geojson":if(T=mi({key:c,value:i,valueSpec:d.source_geojson,style:g,styleSpec:d,validateSpec:b,objectElementValidators:sf}),i.cluster)for(const I in i.clusterProperties){const[L,O]=i.clusterProperties[I],j=typeof L=="string"?[L,["accumulated"],["get",I]]:L;T.push(...Qo({key:`${c}.${I}.map`,value:O,validateSpec:b,expressionContext:"cluster-map"})),T.push(...Qo({key:`${c}.${I}.reduce`,value:j,validateSpec:b,expressionContext:"cluster-reduce"}))}return T;case"video":return mi({key:c,value:i,valueSpec:d.source_video,style:g,validateSpec:b,styleSpec:d});case"image":return mi({key:c,value:i,valueSpec:d.source_image,style:g,validateSpec:b,styleSpec:d});case"canvas":return[new lt(c,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return es({key:`${c}.type`,value:i.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:g,validateSpec:b,styleSpec:d})}}function lf(s){const i=s.value,c=s.styleSpec,d=c.light,g=s.style;let b=[];const w=Er(i);if(i===void 0)return b;if(w!=="object")return b=b.concat([new lt("light",i,`object expected, ${w} found`)]),b;for(const T in i){const I=T.match(/^(.*)-transition$/);b=b.concat(I&&d[I[1]]&&d[I[1]].transition?s.validateSpec({key:T,value:i[T],valueSpec:c.transition,validateSpec:s.validateSpec,style:g,styleSpec:c}):d[T]?s.validateSpec({key:T,value:i[T],valueSpec:d[T],validateSpec:s.validateSpec,style:g,styleSpec:c}):[new lt(T,i[T],`unknown property "${T}"`)])}return b}function cf(s){const i=s.value,c=s.styleSpec,d=c.sky,g=s.style,b=Er(i);if(i===void 0)return[];if(b!=="object")return[new lt("sky",i,`object expected, ${b} found`)];let w=[];for(const T in i)w=w.concat(d[T]?vo({key:T,value:i[T],valueSpec:d[T],style:g,styleSpec:c}):[new lt(T,i[T],`unknown property "${T}"`)]);return w}function Ba(s){const i=s.value,c=s.styleSpec,d=c.terrain,g=s.style;let b=[];const w=Er(i);if(i===void 0)return b;if(w!=="object")return b=b.concat([new lt("terrain",i,`object expected, ${w} found`)]),b;for(const T in i)b=b.concat(d[T]?s.validateSpec({key:T,value:i[T],valueSpec:d[T],validateSpec:s.validateSpec,style:g,styleSpec:c}):[new lt(T,i[T],`unknown property "${T}"`)]);return b}function Fa(s){let i=[];const c=s.value,d=s.key;if(Array.isArray(c)){const g=[],b=[];for(const w in c)c[w].id&&g.includes(c[w].id)&&i.push(new lt(d,c,`all the sprites' ids must be unique, but ${c[w].id} is duplicated`)),g.push(c[w].id),c[w].url&&b.includes(c[w].url)&&i.push(new lt(d,c,`all the sprites' URLs must be unique, but ${c[w].url} is duplicated`)),b.push(c[w].url),i=i.concat(mi({key:`${d}[${w}]`,value:c[w],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:s.validateSpec}));return i}return vs({key:d,value:c})}const ki={"*":()=>[],array:Yc,boolean:function(s){const i=s.value,c=s.key,d=Er(i);return d!=="boolean"?[new lt(c,i,`boolean expected, ${d} found`)]:[]},number:zl,color:function(s){const i=s.key,c=s.value,d=Er(c);return d!=="string"?[new lt(i,c,`color expected, ${d} found`)]:zr.parse(String(c))?[]:[new lt(i,c,`color expected, "${c}" found`)]},constants:nf,enum:es,filter:Zs,function:of,layer:Ra,object:mi,source:af,light:lf,sky:cf,terrain:Ba,string:vs,formatted:function(s){return vs(s).length===0?[]:Qo(s)},resolvedImage:function(s){return vs(s).length===0?[]:Qo(s)},padding:function(s){const i=s.key,c=s.value;if(Er(c)==="array"){if(c.length<1||c.length>4)return[new lt(i,c,`padding requires 1 to 4 values; ${c.length} values found`)];const d={type:"number"};let g=[];for(let b=0;b<c.length;b++)g=g.concat(s.validateSpec({key:`${i}[${b}]`,value:c[b],validateSpec:s.validateSpec,valueSpec:d}));return g}return zl({key:i,value:c,valueSpec:{}})},variableAnchorOffsetCollection:function(s){const i=s.key,c=s.value,d=Er(c),g=s.styleSpec;if(d!=="array"||c.length<1||c.length%2!=0)return[new lt(i,c,"variableAnchorOffsetCollection requires a non-empty array of even length")];let b=[];for(let w=0;w<c.length;w+=2)b=b.concat(es({key:`${i}[${w}]`,value:c[w],valueSpec:g.layout_symbol["text-anchor"]})),b=b.concat(Yc({key:`${i}[${w+1}]`,value:c[w+1],valueSpec:{length:2,value:"number"},validateSpec:s.validateSpec,style:s.style,styleSpec:g}));return b},sprite:Fa};function vo(s){const i=s.value,c=s.valueSpec,d=s.styleSpec;return s.validateSpec=vo,c.expression&&kl(hn(i))?of(s):c.expression&&Ur(Yo(i))?Qo(s):c.type&&ki[c.type]?ki[c.type](s):mi(Xn({},s,{valueSpec:c.type?d[c.type]:c}))}function ru(s){const i=s.value,c=s.key,d=vs(s);return d.length||(i.indexOf("{fontstack}")===-1&&d.push(new lt(c,i,'"glyphs" url must include a "{fontstack}" token')),i.indexOf("{range}")===-1&&d.push(new lt(c,i,'"glyphs" url must include a "{range}" token'))),d}function oo(s,i=ie){let c=[];return c=c.concat(vo({key:"",value:s,valueSpec:i.$root,styleSpec:i,style:s,validateSpec:vo,objectElementValidators:{glyphs:ru,"*":()=>[]}})),s.constants&&(c=c.concat(nf({key:"constants",value:s.constants,style:s,styleSpec:i,validateSpec:vo}))),Hs(c)}function bo(s){return function(i){return s({...i,validateSpec:vo})}}function Hs(s){return[].concat(s).sort((i,c)=>i.line-c.line)}function so(s){return function(...i){return Hs(s.apply(this,i))}}oo.source=so(bo(af)),oo.sprite=so(bo(Fa)),oo.glyphs=so(bo(ru)),oo.light=so(bo(lf)),oo.sky=so(bo(cf)),oo.terrain=so(bo(Ba)),oo.layer=so(bo(Ra)),oo.filter=so(bo(Zs)),oo.paintProperty=so(bo(eu)),oo.layoutProperty=so(bo(tu));const bs=oo,fp=bs.light,nu=bs.paintProperty,dp=bs.layoutProperty;function Xs(s,i){let c=!1;if(i&&i.length)for(const d of i)s.fire(new it(new Error(d.message))),c=!0;return c}class Oa{constructor(i,c,d){const g=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;const w=new Int32Array(this.arrayBuffer);i=w[0],this.d=(c=w[1])+2*(d=w[2]);for(let I=0;I<this.d*this.d;I++){const L=w[3+I],O=w[3+I+1];g.push(L===O?null:w.subarray(L,O))}const T=w[3+g.length+1];this.keys=w.subarray(w[3+g.length],T),this.bboxes=w.subarray(T),this.insert=this._insertReadonly}else{this.d=c+2*d;for(let w=0;w<this.d*this.d;w++)g.push([]);this.keys=[],this.bboxes=[]}this.n=c,this.extent=i,this.padding=d,this.scale=c/i,this.uid=0;const b=d/c*i;this.min=-b,this.max=i+b}insert(i,c,d,g,b){this._forEachCell(c,d,g,b,this._insertCell,this.uid++,void 0,void 0),this.keys.push(i),this.bboxes.push(c),this.bboxes.push(d),this.bboxes.push(g),this.bboxes.push(b)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(i,c,d,g,b,w){this.cells[b].push(w)}query(i,c,d,g,b){const w=this.min,T=this.max;if(i<=w&&c<=w&&T<=d&&T<=g&&!b)return Array.prototype.slice.call(this.keys);{const I=[];return this._forEachCell(i,c,d,g,this._queryCell,I,{},b),I}}_queryCell(i,c,d,g,b,w,T,I){const L=this.cells[b];if(L!==null){const O=this.keys,j=this.bboxes;for(let Z=0;Z<L.length;Z++){const K=L[Z];if(T[K]===void 0){const Q=4*K;(I?I(j[Q+0],j[Q+1],j[Q+2],j[Q+3]):i<=j[Q+2]&&c<=j[Q+3]&&d>=j[Q+0]&&g>=j[Q+1])?(T[K]=!0,w.push(O[K])):T[K]=!1}}}}_forEachCell(i,c,d,g,b,w,T,I){const L=this._convertToCellCoord(i),O=this._convertToCellCoord(c),j=this._convertToCellCoord(d),Z=this._convertToCellCoord(g);for(let K=L;K<=j;K++)for(let Q=O;Q<=Z;Q++){const ae=this.d*Q+K;if((!I||I(this._convertFromCellCoord(K),this._convertFromCellCoord(Q),this._convertFromCellCoord(K+1),this._convertFromCellCoord(Q+1)))&&b.call(this,i,c,d,g,ae,w,T,I))return}}_convertFromCellCoord(i){return(i-this.padding)/this.scale}_convertToCellCoord(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const i=this.cells,c=3+this.cells.length+1+1;let d=0;for(let w=0;w<this.cells.length;w++)d+=this.cells[w].length;const g=new Int32Array(c+d+this.keys.length+this.bboxes.length);g[0]=this.extent,g[1]=this.n,g[2]=this.padding;let b=c;for(let w=0;w<i.length;w++){const T=i[w];g[3+w]=b,g.set(T,b),b+=T.length}return g[3+i.length]=b,g.set(this.keys,b),b+=this.keys.length,g[3+i.length+1]=b,g.set(this.bboxes,b),b+=this.bboxes.length,g.buffer}static serialize(i,c){const d=i.toArrayBuffer();return c&&c.push(d),{buffer:d}}static deserialize(i){return new Oa(i.buffer)}}const wo={};function At(s,i,c={}){if(wo[s])throw new Error(`${s} is already registered.`);Object.defineProperty(i,"_classRegistryKey",{value:s,writeable:!1}),wo[s]={klass:i,omit:c.omit||[],shallow:c.shallow||[]}}At("Object",Object),At("TransferableGridIndex",Oa),At("Color",zr),At("Error",Error),At("AJAXError",wr),At("ResolvedImage",Ki),At("StylePropertyFunction",El),At("StyleExpression",Hr,{omit:["_evaluator"]}),At("ZoomDependentExpression",Xc),At("ZoomConstantExpression",Tl),At("CompoundExpression",Fi,{omit:["_evaluate"]});for(const s in qs)qs[s]._classRegistryKey||At(`Expression_${s}`,qs[s]);function Rl(s){return s&&typeof ArrayBuffer<"u"&&(s instanceof ArrayBuffer||s.constructor&&s.constructor.name==="ArrayBuffer")}function Ks(s,i){if(s==null||typeof s=="boolean"||typeof s=="number"||typeof s=="string"||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp||s instanceof Blob||s instanceof Error)return s;if(Rl(s)||Je(s))return i&&i.push(s),s;if(ArrayBuffer.isView(s)){const c=s;return i&&i.push(c.buffer),c}if(s instanceof ImageData)return i&&i.push(s.data.buffer),s;if(Array.isArray(s)){const c=[];for(const d of s)c.push(Ks(d,i));return c}if(typeof s=="object"){const c=s.constructor,d=c._classRegistryKey;if(!d)throw new Error(`can't serialize object of unregistered class ${c.name}`);if(!wo[d])throw new Error(`${d} is not registered.`);const g=c.serialize?c.serialize(s,i):{};if(c.serialize){if(i&&g===i[i.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const b in s){if(!s.hasOwnProperty(b)||wo[d].omit.indexOf(b)>=0)continue;const w=s[b];g[b]=wo[d].shallow.indexOf(b)>=0?w:Ks(w,i)}s instanceof Error&&(g.message=s.message)}if(g.$name)throw new Error("$name property is reserved for worker serialization logic.");return d!=="Object"&&(g.$name=d),g}throw new Error("can't serialize object of type "+typeof s)}function Js(s){if(s==null||typeof s=="boolean"||typeof s=="number"||typeof s=="string"||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp||s instanceof Blob||s instanceof Error||Rl(s)||Je(s)||ArrayBuffer.isView(s)||s instanceof ImageData)return s;if(Array.isArray(s))return s.map(Js);if(typeof s=="object"){const i=s.$name||"Object";if(!wo[i])throw new Error(`can't deserialize unregistered class ${i}`);const{klass:c}=wo[i];if(!c)throw new Error(`can't deserialize unregistered class ${i}`);if(c.deserialize)return c.deserialize(s);const d=Object.create(c.prototype);for(const g of Object.keys(s)){if(g==="$name")continue;const b=s[g];d[g]=wo[i].shallow.indexOf(g)>=0?b:Js(b)}return d}throw new Error("can't deserialize object of type "+typeof s)}class uf{constructor(){this.first=!0}update(i,c){const d=Math.floor(i);return this.first?(this.first=!1,this.lastIntegerZoom=d,this.lastIntegerZoomTime=0,this.lastZoom=i,this.lastFloorZoom=d,!0):(this.lastFloorZoom>d?(this.lastIntegerZoom=d+1,this.lastIntegerZoomTime=c):this.lastFloorZoom<d&&(this.lastIntegerZoom=d,this.lastIntegerZoomTime=c),i!==this.lastZoom&&(this.lastZoom=i,this.lastFloorZoom=d,!0))}}const St={"Latin-1 Supplement":s=>s>=128&&s<=255,Arabic:s=>s>=1536&&s<=1791,"Arabic Supplement":s=>s>=1872&&s<=1919,"Arabic Extended-A":s=>s>=2208&&s<=2303,"Hangul Jamo":s=>s>=4352&&s<=4607,"Unified Canadian Aboriginal Syllabics":s=>s>=5120&&s<=5759,Khmer:s=>s>=6016&&s<=6143,"Unified Canadian Aboriginal Syllabics Extended":s=>s>=6320&&s<=6399,"General Punctuation":s=>s>=8192&&s<=8303,"Letterlike Symbols":s=>s>=8448&&s<=8527,"Number Forms":s=>s>=8528&&s<=8591,"Miscellaneous Technical":s=>s>=8960&&s<=9215,"Control Pictures":s=>s>=9216&&s<=9279,"Optical Character Recognition":s=>s>=9280&&s<=9311,"Enclosed Alphanumerics":s=>s>=9312&&s<=9471,"Geometric Shapes":s=>s>=9632&&s<=9727,"Miscellaneous Symbols":s=>s>=9728&&s<=9983,"Miscellaneous Symbols and Arrows":s=>s>=11008&&s<=11263,"CJK Radicals Supplement":s=>s>=11904&&s<=12031,"Kangxi Radicals":s=>s>=12032&&s<=12255,"Ideographic Description Characters":s=>s>=12272&&s<=12287,"CJK Symbols and Punctuation":s=>s>=12288&&s<=12351,Hiragana:s=>s>=12352&&s<=12447,Katakana:s=>s>=12448&&s<=12543,Bopomofo:s=>s>=12544&&s<=12591,"Hangul Compatibility Jamo":s=>s>=12592&&s<=12687,Kanbun:s=>s>=12688&&s<=12703,"Bopomofo Extended":s=>s>=12704&&s<=12735,"CJK Strokes":s=>s>=12736&&s<=12783,"Katakana Phonetic Extensions":s=>s>=12784&&s<=12799,"Enclosed CJK Letters and Months":s=>s>=12800&&s<=13055,"CJK Compatibility":s=>s>=13056&&s<=13311,"CJK Unified Ideographs Extension A":s=>s>=13312&&s<=19903,"Yijing Hexagram Symbols":s=>s>=19904&&s<=19967,"CJK Unified Ideographs":s=>s>=19968&&s<=40959,"Yi Syllables":s=>s>=40960&&s<=42127,"Yi Radicals":s=>s>=42128&&s<=42191,"Hangul Jamo Extended-A":s=>s>=43360&&s<=43391,"Hangul Syllables":s=>s>=44032&&s<=55215,"Hangul Jamo Extended-B":s=>s>=55216&&s<=55295,"Private Use Area":s=>s>=57344&&s<=63743,"CJK Compatibility Ideographs":s=>s>=63744&&s<=64255,"Arabic Presentation Forms-A":s=>s>=64336&&s<=65023,"Vertical Forms":s=>s>=65040&&s<=65055,"CJK Compatibility Forms":s=>s>=65072&&s<=65103,"Small Form Variants":s=>s>=65104&&s<=65135,"Arabic Presentation Forms-B":s=>s>=65136&&s<=65279,"Halfwidth and Fullwidth Forms":s=>s>=65280&&s<=65519};function Ys(s){for(const i of s)if(Bl(i.charCodeAt(0)))return!0;return!1}function hf(s){for(const i of s)if(!ff(i.charCodeAt(0)))return!1;return!0}function ff(s){return!(St.Arabic(s)||St["Arabic Supplement"](s)||St["Arabic Extended-A"](s)||St["Arabic Presentation Forms-A"](s)||St["Arabic Presentation Forms-B"](s))}function Bl(s){return!(s!==746&&s!==747&&(s<4352||!(St["Bopomofo Extended"](s)||St.Bopomofo(s)||St["CJK Compatibility Forms"](s)&&!(s>=65097&&s<=65103)||St["CJK Compatibility Ideographs"](s)||St["CJK Compatibility"](s)||St["CJK Radicals Supplement"](s)||St["CJK Strokes"](s)||!(!St["CJK Symbols and Punctuation"](s)||s>=12296&&s<=12305||s>=12308&&s<=12319||s===12336)||St["CJK Unified Ideographs Extension A"](s)||St["CJK Unified Ideographs"](s)||St["Enclosed CJK Letters and Months"](s)||St["Hangul Compatibility Jamo"](s)||St["Hangul Jamo Extended-A"](s)||St["Hangul Jamo Extended-B"](s)||St["Hangul Jamo"](s)||St["Hangul Syllables"](s)||St.Hiragana(s)||St["Ideographic Description Characters"](s)||St.Kanbun(s)||St["Kangxi Radicals"](s)||St["Katakana Phonetic Extensions"](s)||St.Katakana(s)&&s!==12540||!(!St["Halfwidth and Fullwidth Forms"](s)||s===65288||s===65289||s===65293||s>=65306&&s<=65310||s===65339||s===65341||s===65343||s>=65371&&s<=65503||s===65507||s>=65512&&s<=65519)||!(!St["Small Form Variants"](s)||s>=65112&&s<=65118||s>=65123&&s<=65126)||St["Unified Canadian Aboriginal Syllabics"](s)||St["Unified Canadian Aboriginal Syllabics Extended"](s)||St["Vertical Forms"](s)||St["Yijing Hexagram Symbols"](s)||St["Yi Syllables"](s)||St["Yi Radicals"](s))))}function iu(s){return!(Bl(s)||function(i){return!!(St["Latin-1 Supplement"](i)&&(i===167||i===169||i===174||i===177||i===188||i===189||i===190||i===215||i===247)||St["General Punctuation"](i)&&(i===8214||i===8224||i===8225||i===8240||i===8241||i===8251||i===8252||i===8258||i===8263||i===8264||i===8265||i===8273)||St["Letterlike Symbols"](i)||St["Number Forms"](i)||St["Miscellaneous Technical"](i)&&(i>=8960&&i<=8967||i>=8972&&i<=8991||i>=8996&&i<=9e3||i===9003||i>=9085&&i<=9114||i>=9150&&i<=9165||i===9167||i>=9169&&i<=9179||i>=9186&&i<=9215)||St["Control Pictures"](i)&&i!==9251||St["Optical Character Recognition"](i)||St["Enclosed Alphanumerics"](i)||St["Geometric Shapes"](i)||St["Miscellaneous Symbols"](i)&&!(i>=9754&&i<=9759)||St["Miscellaneous Symbols and Arrows"](i)&&(i>=11026&&i<=11055||i>=11088&&i<=11097||i>=11192&&i<=11243)||St["CJK Symbols and Punctuation"](i)||St.Katakana(i)||St["Private Use Area"](i)||St["CJK Compatibility Forms"](i)||St["Small Form Variants"](i)||St["Halfwidth and Fullwidth Forms"](i)||i===8734||i===8756||i===8757||i>=9984&&i<=10087||i>=10102&&i<=10131||i===65532||i===65533)}(s))}function Fl(s){return s>=1424&&s<=2303||St["Arabic Presentation Forms-A"](s)||St["Arabic Presentation Forms-B"](s)}function df(s,i){return!(!i&&Fl(s)||s>=2304&&s<=3583||s>=3840&&s<=4255||St.Khmer(s))}function pp(s){for(const i of s)if(Fl(i.charCodeAt(0)))return!0;return!1}const ts=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(s){this.pluginStatus=s.pluginStatus,this.pluginURL=s.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(s){this.applyArabicShaping=s.applyArabicShaping,this.processBidirectionalText=s.processBidirectionalText,this.processStyledBidirectionalText=s.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class Qr{constructor(i,c){this.zoom=i,c?(this.now=c.now,this.fadeDuration=c.fadeDuration,this.zoomHistory=c.zoomHistory,this.transition=c.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new uf,this.transition={})}isSupportedScript(i){return function(c,d){for(const g of c)if(!df(g.charCodeAt(0),d))return!1;return!0}(i,ts.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const i=this.zoom,c=i-Math.floor(i),d=this.crossFadingFactor();return i>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:c+(1-c)*d}:{fromScale:.5,toScale:1,t:1-(1-d)*c}}}class Na{constructor(i,c){this.property=i,this.value=c,this.expression=function(d,g){if(kl(d))return new El(d,g);if(Ur(d)){const b=Yh(d,g);if(b.result==="error")throw new Error(b.value.map(w=>`${w.key}: ${w.message}`).join(", "));return b.value}{let b=d;return g.type==="color"&&typeof d=="string"?b=zr.parse(d):g.type!=="padding"||typeof d!="number"&&!Array.isArray(d)?g.type==="variableAnchorOffsetCollection"&&Array.isArray(d)&&(b=Xi.parse(d)):b=Si.parse(d),{kind:"constant",evaluate:()=>b}}}(c===void 0?i.specification.default:c,i.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(i,c,d){return this.property.possiblyEvaluate(this,i,c,d)}}class Ol{constructor(i){this.property=i,this.value=new Na(i,void 0)}transitioned(i,c){return new pf(this.property,this.value,c,H({},i.transition,this.transition),i.now)}untransitioned(){return new pf(this.property,this.value,null,{},0)}}class ou{constructor(i){this._properties=i,this._values=Object.create(i.defaultTransitionablePropertyValues)}getValue(i){return ne(this._values[i].value.value)}setValue(i,c){Object.prototype.hasOwnProperty.call(this._values,i)||(this._values[i]=new Ol(this._values[i].property)),this._values[i].value=new Na(this._values[i].property,c===null?void 0:ne(c))}getTransition(i){return ne(this._values[i].transition)}setTransition(i,c){Object.prototype.hasOwnProperty.call(this._values,i)||(this._values[i]=new Ol(this._values[i].property)),this._values[i].transition=ne(c)||void 0}serialize(){const i={};for(const c of Object.keys(this._values)){const d=this.getValue(c);d!==void 0&&(i[c]=d);const g=this.getTransition(c);g!==void 0&&(i[`${c}-transition`]=g)}return i}transitioned(i,c){const d=new mf(this._properties);for(const g of Object.keys(this._values))d._values[g]=this._values[g].transitioned(i,c._values[g]);return d}untransitioned(){const i=new mf(this._properties);for(const c of Object.keys(this._values))i._values[c]=this._values[c].untransitioned();return i}}class pf{constructor(i,c,d,g,b){this.property=i,this.value=c,this.begin=b+g.delay||0,this.end=this.begin+g.duration||0,i.specification.transition&&(g.delay||g.duration)&&(this.prior=d)}possiblyEvaluate(i,c,d){const g=i.now||0,b=this.value.possiblyEvaluate(i,c,d),w=this.prior;if(w){if(g>this.end)return this.prior=null,b;if(this.value.isDataDriven())return this.prior=null,b;if(g<this.begin)return w.possiblyEvaluate(i,c,d);{const T=(g-this.begin)/(this.end-this.begin);return this.property.interpolate(w.possiblyEvaluate(i,c,d),b,function(I){if(I<=0)return 0;if(I>=1)return 1;const L=I*I,O=L*I;return 4*(I<.5?O:3*(I-L)+O-.75)}(T))}}return b}}class mf{constructor(i){this._properties=i,this._values=Object.create(i.defaultTransitioningPropertyValues)}possiblyEvaluate(i,c,d){const g=new ja(this._properties);for(const b of Object.keys(this._values))g._values[b]=this._values[b].possiblyEvaluate(i,c,d);return g}hasTransition(){for(const i of Object.keys(this._values))if(this._values[i].prior)return!0;return!1}}class gf{constructor(i){this._properties=i,this._values=Object.create(i.defaultPropertyValues)}hasValue(i){return this._values[i].value!==void 0}getValue(i){return ne(this._values[i].value)}setValue(i,c){this._values[i]=new Na(this._values[i].property,c===null?void 0:ne(c))}serialize(){const i={};for(const c of Object.keys(this._values)){const d=this.getValue(c);d!==void 0&&(i[c]=d)}return i}possiblyEvaluate(i,c,d){const g=new ja(this._properties);for(const b of Object.keys(this._values))g._values[b]=this._values[b].possiblyEvaluate(i,c,d);return g}}class ao{constructor(i,c,d){this.property=i,this.value=c,this.parameters=d}isConstant(){return this.value.kind==="constant"}constantOr(i){return this.value.kind==="constant"?this.value.value:i}evaluate(i,c,d,g){return this.property.evaluate(this.value,this.parameters,i,c,d,g)}}class ja{constructor(i){this._properties=i,this._values=Object.create(i.defaultPossiblyEvaluatedValues)}get(i){return this._values[i]}}class Nt{constructor(i){this.specification=i}possiblyEvaluate(i,c){if(i.isDataDriven())throw new Error("Value should not be data driven");return i.expression.evaluate(c)}interpolate(i,c,d){const g=pi[this.specification.type];return g?g(i,c,d):i}}class Gt{constructor(i,c){this.specification=i,this.overrides=c}possiblyEvaluate(i,c,d,g){return new ao(this,i.expression.kind==="constant"||i.expression.kind==="camera"?{kind:"constant",value:i.expression.evaluate(c,null,{},d,g)}:i.expression,c)}interpolate(i,c,d){if(i.value.kind!=="constant"||c.value.kind!=="constant")return i;if(i.value.value===void 0||c.value.value===void 0)return new ao(this,{kind:"constant",value:void 0},i.parameters);const g=pi[this.specification.type];if(g){const b=g(i.value.value,c.value.value,d);return new ao(this,{kind:"constant",value:b},i.parameters)}return i}evaluate(i,c,d,g,b,w){return i.kind==="constant"?i.value:i.evaluate(c,d,g,b,w)}}class Nl extends Gt{possiblyEvaluate(i,c,d,g){if(i.value===void 0)return new ao(this,{kind:"constant",value:void 0},c);if(i.expression.kind==="constant"){const b=i.expression.evaluate(c,null,{},d,g),w=i.property.specification.type==="resolvedImage"&&typeof b!="string"?b.name:b,T=this._calculate(w,w,w,c);return new ao(this,{kind:"constant",value:T},c)}if(i.expression.kind==="camera"){const b=this._calculate(i.expression.evaluate({zoom:c.zoom-1}),i.expression.evaluate({zoom:c.zoom}),i.expression.evaluate({zoom:c.zoom+1}),c);return new ao(this,{kind:"constant",value:b},c)}return new ao(this,i.expression,c)}evaluate(i,c,d,g,b,w){if(i.kind==="source"){const T=i.evaluate(c,d,g,b,w);return this._calculate(T,T,T,c)}return i.kind==="composite"?this._calculate(i.evaluate({zoom:Math.floor(c.zoom)-1},d,g),i.evaluate({zoom:Math.floor(c.zoom)},d,g),i.evaluate({zoom:Math.floor(c.zoom)+1},d,g),c):i.value}_calculate(i,c,d,g){return g.zoom>g.zoomHistory.lastIntegerZoom?{from:i,to:c}:{from:d,to:c}}interpolate(i){return i}}class Ua{constructor(i){this.specification=i}possiblyEvaluate(i,c,d,g){if(i.value!==void 0){if(i.expression.kind==="constant"){const b=i.expression.evaluate(c,null,{},d,g);return this._calculate(b,b,b,c)}return this._calculate(i.expression.evaluate(new Qr(Math.floor(c.zoom-1),c)),i.expression.evaluate(new Qr(Math.floor(c.zoom),c)),i.expression.evaluate(new Qr(Math.floor(c.zoom+1),c)),c)}}_calculate(i,c,d,g){return g.zoom>g.zoomHistory.lastIntegerZoom?{from:i,to:c}:{from:d,to:c}}interpolate(i){return i}}class su{constructor(i){this.specification=i}possiblyEvaluate(i,c,d,g){return!!i.expression.evaluate(c,null,{},d,g)}interpolate(){return!1}}class Ti{constructor(i){this.properties=i,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const c in i){const d=i[c];d.specification.overridable&&this.overridableProperties.push(c);const g=this.defaultPropertyValues[c]=new Na(d,void 0),b=this.defaultTransitionablePropertyValues[c]=new Ol(d);this.defaultTransitioningPropertyValues[c]=b.untransitioned(),this.defaultPossiblyEvaluatedValues[c]=g.possiblyEvaluate({})}}}At("DataDrivenProperty",Gt),At("DataConstantProperty",Nt),At("CrossFadedDataDrivenProperty",Nl),At("CrossFadedProperty",Ua),At("ColorRampProperty",su);const au="-transition";class lo extends xt{constructor(i,c){if(super(),this.id=i.id,this.type=i.type,this._featureFilter={filter:()=>!0,needGeometry:!1},i.type!=="custom"&&(this.metadata=i.metadata,this.minzoom=i.minzoom,this.maxzoom=i.maxzoom,i.type!=="background"&&(this.source=i.source,this.sourceLayer=i["source-layer"],this.filter=i.filter),c.layout&&(this._unevaluatedLayout=new gf(c.layout)),c.paint)){this._transitionablePaint=new ou(c.paint);for(const d in i.paint)this.setPaintProperty(d,i.paint[d],{validate:!1});for(const d in i.layout)this.setLayoutProperty(d,i.layout[d],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new ja(c.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(i){return i==="visibility"?this.visibility:this._unevaluatedLayout.getValue(i)}setLayoutProperty(i,c,d={}){c!=null&&this._validate(dp,`layers.${this.id}.layout.${i}`,i,c,d)||(i!=="visibility"?this._unevaluatedLayout.setValue(i,c):this.visibility=c)}getPaintProperty(i){return i.endsWith(au)?this._transitionablePaint.getTransition(i.slice(0,-11)):this._transitionablePaint.getValue(i)}setPaintProperty(i,c,d={}){if(c!=null&&this._validate(nu,`layers.${this.id}.paint.${i}`,i,c,d))return!1;if(i.endsWith(au))return this._transitionablePaint.setTransition(i.slice(0,-11),c||void 0),!1;{const g=this._transitionablePaint._values[i],b=g.property.specification["property-type"]==="cross-faded-data-driven",w=g.value.isDataDriven(),T=g.value;this._transitionablePaint.setValue(i,c),this._handleSpecialPaintPropertyUpdate(i);const I=this._transitionablePaint._values[i].value;return I.isDataDriven()||w||b||this._handleOverridablePaintPropertyUpdate(i,T,I)}}_handleSpecialPaintPropertyUpdate(i){}_handleOverridablePaintPropertyUpdate(i,c,d){return!1}isHidden(i){return!!(this.minzoom&&i<this.minzoom)||!!(this.maxzoom&&i>=this.maxzoom)||this.visibility==="none"}updateTransitions(i){this._transitioningPaint=this._transitionablePaint.transitioned(i,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(i,c){i.getCrossfadeParameters&&(this._crossfadeParameters=i.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(i,void 0,c)),this.paint=this._transitioningPaint.possiblyEvaluate(i,void 0,c)}serialize(){const i={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(i.layout=i.layout||{},i.layout.visibility=this.visibility),ze(i,(c,d)=>!(c===void 0||d==="layout"&&!Object.keys(c).length||d==="paint"&&!Object.keys(c).length))}_validate(i,c,d,g,b={}){return(!b||b.validate!==!1)&&Xs(this,i.call(bs,{key:c,layerType:this.type,objectKey:d,value:g,styleSpec:ie,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const i in this.paint._values){const c=this.paint.get(i);if(c instanceof ao&&Ws(c.property.specification)&&(c.value.kind==="source"||c.value.kind==="composite")&&c.value.isStateDependent)return!0}return!1}}const _f={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Va{constructor(i,c){this._structArray=i,this._pos1=c*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class fn{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(i,c){return i._trim(),c&&(i.isTransferred=!0,c.push(i.arrayBuffer)),{length:i.length,arrayBuffer:i.arrayBuffer}}static deserialize(i){const c=Object.create(this.prototype);return c.arrayBuffer=i.arrayBuffer,c.length=i.length,c.capacity=i.arrayBuffer.byteLength/c.bytesPerElement,c._refreshViews(),c}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(i){this.reserve(i),this.length=i}reserve(i){if(i>this.capacity){this.capacity=Math.max(i,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const c=this.uint8;this._refreshViews(),c&&this.uint8.set(c)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function En(s,i=1){let c=0,d=0;return{members:s.map(g=>{const b=_f[g.type].BYTES_PER_ELEMENT,w=c=yf(c,Math.max(i,b)),T=g.components||1;return d=Math.max(d,b),c+=b*T,{name:g.name,type:g.type,components:T,offset:w}}),size:yf(c,Math.max(d,i)),alignment:i}}function yf(s,i){return Math.ceil(s/i)*i}class $a extends fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,c){const d=this.length;return this.resize(d+1),this.emplace(d,i,c)}emplace(i,c,d){const g=2*i;return this.int16[g+0]=c,this.int16[g+1]=d,i}}$a.prototype.bytesPerElement=4,At("StructArrayLayout2i4",$a);class Oo extends fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,c,d){const g=this.length;return this.resize(g+1),this.emplace(g,i,c,d)}emplace(i,c,d,g){const b=3*i;return this.int16[b+0]=c,this.int16[b+1]=d,this.int16[b+2]=g,i}}Oo.prototype.bytesPerElement=6,At("StructArrayLayout3i6",Oo);class lu extends fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,c,d,g){const b=this.length;return this.resize(b+1),this.emplace(b,i,c,d,g)}emplace(i,c,d,g,b){const w=4*i;return this.int16[w+0]=c,this.int16[w+1]=d,this.int16[w+2]=g,this.int16[w+3]=b,i}}lu.prototype.bytesPerElement=8,At("StructArrayLayout4i8",lu);class cu extends fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,c,d,g,b,w){const T=this.length;return this.resize(T+1),this.emplace(T,i,c,d,g,b,w)}emplace(i,c,d,g,b,w,T){const I=6*i;return this.int16[I+0]=c,this.int16[I+1]=d,this.int16[I+2]=g,this.int16[I+3]=b,this.int16[I+4]=w,this.int16[I+5]=T,i}}cu.prototype.bytesPerElement=12,At("StructArrayLayout2i4i12",cu);class uu extends fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,c,d,g,b,w){const T=this.length;return this.resize(T+1),this.emplace(T,i,c,d,g,b,w)}emplace(i,c,d,g,b,w,T){const I=4*i,L=8*i;return this.int16[I+0]=c,this.int16[I+1]=d,this.uint8[L+4]=g,this.uint8[L+5]=b,this.uint8[L+6]=w,this.uint8[L+7]=T,i}}uu.prototype.bytesPerElement=8,At("StructArrayLayout2i4ub8",uu);class qa extends fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,c){const d=this.length;return this.resize(d+1),this.emplace(d,i,c)}emplace(i,c,d){const g=2*i;return this.float32[g+0]=c,this.float32[g+1]=d,i}}qa.prototype.bytesPerElement=8,At("StructArrayLayout2f8",qa);class jl extends fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,c,d,g,b,w,T,I,L,O){const j=this.length;return this.resize(j+1),this.emplace(j,i,c,d,g,b,w,T,I,L,O)}emplace(i,c,d,g,b,w,T,I,L,O,j){const Z=10*i;return this.uint16[Z+0]=c,this.uint16[Z+1]=d,this.uint16[Z+2]=g,this.uint16[Z+3]=b,this.uint16[Z+4]=w,this.uint16[Z+5]=T,this.uint16[Z+6]=I,this.uint16[Z+7]=L,this.uint16[Z+8]=O,this.uint16[Z+9]=j,i}}jl.prototype.bytesPerElement=20,At("StructArrayLayout10ui20",jl);class hu extends fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,c,d,g,b,w,T,I,L,O,j,Z){const K=this.length;return this.resize(K+1),this.emplace(K,i,c,d,g,b,w,T,I,L,O,j,Z)}emplace(i,c,d,g,b,w,T,I,L,O,j,Z,K){const Q=12*i;return this.int16[Q+0]=c,this.int16[Q+1]=d,this.int16[Q+2]=g,this.int16[Q+3]=b,this.uint16[Q+4]=w,this.uint16[Q+5]=T,this.uint16[Q+6]=I,this.uint16[Q+7]=L,this.int16[Q+8]=O,this.int16[Q+9]=j,this.int16[Q+10]=Z,this.int16[Q+11]=K,i}}hu.prototype.bytesPerElement=24,At("StructArrayLayout4i4ui4i24",hu);class fu extends fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,c,d){const g=this.length;return this.resize(g+1),this.emplace(g,i,c,d)}emplace(i,c,d,g){const b=3*i;return this.float32[b+0]=c,this.float32[b+1]=d,this.float32[b+2]=g,i}}fu.prototype.bytesPerElement=12,At("StructArrayLayout3f12",fu);class No extends fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i){const c=this.length;return this.resize(c+1),this.emplace(c,i)}emplace(i,c){return this.uint32[1*i+0]=c,i}}No.prototype.bytesPerElement=4,At("StructArrayLayout1ul4",No);class Ul extends fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,c,d,g,b,w,T,I,L){const O=this.length;return this.resize(O+1),this.emplace(O,i,c,d,g,b,w,T,I,L)}emplace(i,c,d,g,b,w,T,I,L,O){const j=10*i,Z=5*i;return this.int16[j+0]=c,this.int16[j+1]=d,this.int16[j+2]=g,this.int16[j+3]=b,this.int16[j+4]=w,this.int16[j+5]=T,this.uint32[Z+3]=I,this.uint16[j+8]=L,this.uint16[j+9]=O,i}}Ul.prototype.bytesPerElement=20,At("StructArrayLayout6i1ul2ui20",Ul);class Ga extends fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,c,d,g,b,w){const T=this.length;return this.resize(T+1),this.emplace(T,i,c,d,g,b,w)}emplace(i,c,d,g,b,w,T){const I=6*i;return this.int16[I+0]=c,this.int16[I+1]=d,this.int16[I+2]=g,this.int16[I+3]=b,this.int16[I+4]=w,this.int16[I+5]=T,i}}Ga.prototype.bytesPerElement=12,At("StructArrayLayout2i2i2i12",Ga);class Vl extends fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,c,d,g,b){const w=this.length;return this.resize(w+1),this.emplace(w,i,c,d,g,b)}emplace(i,c,d,g,b,w){const T=4*i,I=8*i;return this.float32[T+0]=c,this.float32[T+1]=d,this.float32[T+2]=g,this.int16[I+6]=b,this.int16[I+7]=w,i}}Vl.prototype.bytesPerElement=16,At("StructArrayLayout2f1f2i16",Vl);class Wa extends fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,c,d,g){const b=this.length;return this.resize(b+1),this.emplace(b,i,c,d,g)}emplace(i,c,d,g,b){const w=12*i,T=3*i;return this.uint8[w+0]=c,this.uint8[w+1]=d,this.float32[T+1]=g,this.float32[T+2]=b,i}}Wa.prototype.bytesPerElement=12,At("StructArrayLayout2ub2f12",Wa);class $l extends fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,c,d){const g=this.length;return this.resize(g+1),this.emplace(g,i,c,d)}emplace(i,c,d,g){const b=3*i;return this.uint16[b+0]=c,this.uint16[b+1]=d,this.uint16[b+2]=g,i}}$l.prototype.bytesPerElement=6,At("StructArrayLayout3ui6",$l);class Qs extends fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,c,d,g,b,w,T,I,L,O,j,Z,K,Q,ae,_e,xe){const Re=this.length;return this.resize(Re+1),this.emplace(Re,i,c,d,g,b,w,T,I,L,O,j,Z,K,Q,ae,_e,xe)}emplace(i,c,d,g,b,w,T,I,L,O,j,Z,K,Q,ae,_e,xe,Re){const ke=24*i,Ae=12*i,Ye=48*i;return this.int16[ke+0]=c,this.int16[ke+1]=d,this.uint16[ke+2]=g,this.uint16[ke+3]=b,this.uint32[Ae+2]=w,this.uint32[Ae+3]=T,this.uint32[Ae+4]=I,this.uint16[ke+10]=L,this.uint16[ke+11]=O,this.uint16[ke+12]=j,this.float32[Ae+7]=Z,this.float32[Ae+8]=K,this.uint8[Ye+36]=Q,this.uint8[Ye+37]=ae,this.uint8[Ye+38]=_e,this.uint32[Ae+10]=xe,this.int16[ke+22]=Re,i}}Qs.prototype.bytesPerElement=48,At("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Qs);class ws extends fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,c,d,g,b,w,T,I,L,O,j,Z,K,Q,ae,_e,xe,Re,ke,Ae,Ye,et,Tt,Rt,kt,bt,dt,Pt){const vt=this.length;return this.resize(vt+1),this.emplace(vt,i,c,d,g,b,w,T,I,L,O,j,Z,K,Q,ae,_e,xe,Re,ke,Ae,Ye,et,Tt,Rt,kt,bt,dt,Pt)}emplace(i,c,d,g,b,w,T,I,L,O,j,Z,K,Q,ae,_e,xe,Re,ke,Ae,Ye,et,Tt,Rt,kt,bt,dt,Pt,vt){const st=32*i,qt=16*i;return this.int16[st+0]=c,this.int16[st+1]=d,this.int16[st+2]=g,this.int16[st+3]=b,this.int16[st+4]=w,this.int16[st+5]=T,this.int16[st+6]=I,this.int16[st+7]=L,this.uint16[st+8]=O,this.uint16[st+9]=j,this.uint16[st+10]=Z,this.uint16[st+11]=K,this.uint16[st+12]=Q,this.uint16[st+13]=ae,this.uint16[st+14]=_e,this.uint16[st+15]=xe,this.uint16[st+16]=Re,this.uint16[st+17]=ke,this.uint16[st+18]=Ae,this.uint16[st+19]=Ye,this.uint16[st+20]=et,this.uint16[st+21]=Tt,this.uint16[st+22]=Rt,this.uint32[qt+12]=kt,this.float32[qt+13]=bt,this.float32[qt+14]=dt,this.uint16[st+30]=Pt,this.uint16[st+31]=vt,i}}ws.prototype.bytesPerElement=64,At("StructArrayLayout8i15ui1ul2f2ui64",ws);class ql extends fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i){const c=this.length;return this.resize(c+1),this.emplace(c,i)}emplace(i,c){return this.float32[1*i+0]=c,i}}ql.prototype.bytesPerElement=4,At("StructArrayLayout1f4",ql);class Gl extends fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,c,d){const g=this.length;return this.resize(g+1),this.emplace(g,i,c,d)}emplace(i,c,d,g){const b=3*i;return this.uint16[6*i+0]=c,this.float32[b+1]=d,this.float32[b+2]=g,i}}Gl.prototype.bytesPerElement=12,At("StructArrayLayout1ui2f12",Gl);class xs extends fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,c,d){const g=this.length;return this.resize(g+1),this.emplace(g,i,c,d)}emplace(i,c,d,g){const b=4*i;return this.uint32[2*i+0]=c,this.uint16[b+2]=d,this.uint16[b+3]=g,i}}xs.prototype.bytesPerElement=8,At("StructArrayLayout1ul2ui8",xs);class du extends fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,c){const d=this.length;return this.resize(d+1),this.emplace(d,i,c)}emplace(i,c,d){const g=2*i;return this.uint16[g+0]=c,this.uint16[g+1]=d,i}}du.prototype.bytesPerElement=4,At("StructArrayLayout2ui4",du);class pu extends fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i){const c=this.length;return this.resize(c+1),this.emplace(c,i)}emplace(i,c){return this.uint16[1*i+0]=c,i}}pu.prototype.bytesPerElement=2,At("StructArrayLayout1ui2",pu);class Wl extends fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,c,d,g){const b=this.length;return this.resize(b+1),this.emplace(b,i,c,d,g)}emplace(i,c,d,g,b){const w=4*i;return this.float32[w+0]=c,this.float32[w+1]=d,this.float32[w+2]=g,this.float32[w+3]=b,i}}Wl.prototype.bytesPerElement=16,At("StructArrayLayout4f16",Wl);class vf extends Va{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new S(this.anchorPointX,this.anchorPointY)}}vf.prototype.size=20;class y extends Ul{get(i){return new vf(this,i)}}At("CollisionBoxArray",y);class o extends Va{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(i){this._structArray.uint8[this._pos1+37]=i}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(i){this._structArray.uint8[this._pos1+38]=i}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(i){this._structArray.uint32[this._pos4+10]=i}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}o.prototype.size=48;class h extends Qs{get(i){return new o(this,i)}}At("PlacedSymbolArray",h);class p extends Va{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(i){this._structArray.uint32[this._pos4+12]=i}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}p.prototype.size=64;class m extends ws{get(i){return new p(this,i)}}At("SymbolInstanceArray",m);class v extends ql{getoffsetX(i){return this.float32[1*i+0]}}At("GlyphOffsetArray",v);class E extends Oo{getx(i){return this.int16[3*i+0]}gety(i){return this.int16[3*i+1]}gettileUnitDistanceFromAnchor(i){return this.int16[3*i+2]}}At("SymbolLineVertexArray",E);class M extends Va{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}M.prototype.size=12;class A extends Gl{get(i){return new M(this,i)}}At("TextAnchorOffsetArray",A);class F extends Va{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}F.prototype.size=8;class $ extends xs{get(i){return new F(this,i)}}At("FeatureIndexArray",$);class q extends $a{}class Y extends $a{}class de extends $a{}class fe extends cu{}class ve extends uu{}class se extends qa{}class Ee extends jl{}class $e extends hu{}class we extends fu{}class Le extends No{}class Ge extends Ga{}class Ze extends Wa{}class Xe extends $l{}class nt extends du{}const rt=En([{name:"a_pos",components:2,type:"Int16"}],4),{members:ft}=rt;class gt{constructor(i=[]){this.segments=i}prepareSegment(i,c,d,g){let b=this.segments[this.segments.length-1];return i>gt.MAX_VERTEX_ARRAY_LENGTH&&He(`Max vertices per segment is ${gt.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${i}`),(!b||b.vertexLength+i>gt.MAX_VERTEX_ARRAY_LENGTH||b.sortKey!==g)&&(b={vertexOffset:c.length,primitiveOffset:d.length,vertexLength:0,primitiveLength:0},g!==void 0&&(b.sortKey=g),this.segments.push(b)),b}get(){return this.segments}destroy(){for(const i of this.segments)for(const c in i.vaos)i.vaos[c].destroy()}static simpleSegment(i,c,d,g){return new gt([{vertexOffset:i,primitiveOffset:c,vertexLength:d,primitiveLength:g,vaos:{},sortKey:0}])}}function ar(s,i){return 256*(s=te(Math.floor(s),0,255))+te(Math.floor(i),0,255)}gt.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,At("SegmentVector",gt);const yt=En([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Xt={exports:{}},lr={exports:{}};lr.exports=function(s,i){var c,d,g,b,w,T,I,L;for(d=s.length-(c=3&s.length),g=i,w=3432918353,T=461845907,L=0;L<d;)I=255&s.charCodeAt(L)|(255&s.charCodeAt(++L))<<8|(255&s.charCodeAt(++L))<<16|(255&s.charCodeAt(++L))<<24,++L,g=27492+(65535&(b=5*(65535&(g=(g^=I=(65535&(I=(I=(65535&I)*w+(((I>>>16)*w&65535)<<16)&4294967295)<<15|I>>>17))*T+(((I>>>16)*T&65535)<<16)&4294967295)<<13|g>>>19))+((5*(g>>>16)&65535)<<16)&4294967295))+((58964+(b>>>16)&65535)<<16);switch(I=0,c){case 3:I^=(255&s.charCodeAt(L+2))<<16;case 2:I^=(255&s.charCodeAt(L+1))<<8;case 1:g^=I=(65535&(I=(I=(65535&(I^=255&s.charCodeAt(L)))*w+(((I>>>16)*w&65535)<<16)&4294967295)<<15|I>>>17))*T+(((I>>>16)*T&65535)<<16)&4294967295}return g^=s.length,g=2246822507*(65535&(g^=g>>>16))+((2246822507*(g>>>16)&65535)<<16)&4294967295,g=3266489909*(65535&(g^=g>>>13))+((3266489909*(g>>>16)&65535)<<16)&4294967295,(g^=g>>>16)>>>0};var Sr=lr.exports,er={exports:{}};er.exports=function(s,i){for(var c,d=s.length,g=i^d,b=0;d>=4;)c=1540483477*(65535&(c=255&s.charCodeAt(b)|(255&s.charCodeAt(++b))<<8|(255&s.charCodeAt(++b))<<16|(255&s.charCodeAt(++b))<<24))+((1540483477*(c>>>16)&65535)<<16),g=1540483477*(65535&g)+((1540483477*(g>>>16)&65535)<<16)^(c=1540483477*(65535&(c^=c>>>24))+((1540483477*(c>>>16)&65535)<<16)),d-=4,++b;switch(d){case 3:g^=(255&s.charCodeAt(b+2))<<16;case 2:g^=(255&s.charCodeAt(b+1))<<8;case 1:g=1540483477*(65535&(g^=255&s.charCodeAt(b)))+((1540483477*(g>>>16)&65535)<<16)}return g=1540483477*(65535&(g^=g>>>13))+((1540483477*(g>>>16)&65535)<<16),(g^=g>>>15)>>>0};var hr=Sr,pr=er.exports;Xt.exports=hr,Xt.exports.murmur3=hr,Xt.exports.murmur2=pr;var dn=_(Xt.exports);class Rr{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(i,c,d,g){this.ids.push(Oi(i)),this.positions.push(c,d,g)}getPositions(i){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const c=Oi(i);let d=0,g=this.ids.length-1;for(;d<g;){const w=d+g>>1;this.ids[w]>=c?g=w:d=w+1}const b=[];for(;this.ids[d]===c;)b.push({index:this.positions[3*d],start:this.positions[3*d+1],end:this.positions[3*d+2]}),d++;return b}static serialize(i,c){const d=new Float64Array(i.ids),g=new Uint32Array(i.positions);return On(d,g,0,d.length-1),c&&c.push(d.buffer,g.buffer),{ids:d,positions:g}}static deserialize(i){const c=new Rr;return c.ids=i.ids,c.positions=i.positions,c.indexed=!0,c}}function Oi(s){const i=+s;return!isNaN(i)&&i<=Number.MAX_SAFE_INTEGER?i:dn(String(s))}function On(s,i,c,d){for(;c<d;){const g=s[c+d>>1];let b=c-1,w=d+1;for(;;){do b++;while(s[b]<g);do w--;while(s[w]>g);if(b>=w)break;sn(s,b,w),sn(i,3*b,3*w),sn(i,3*b+1,3*w+1),sn(i,3*b+2,3*w+2)}w-c<d-w?(On(s,i,c,w),c=w+1):(On(s,i,w+1,d),d=w)}}function sn(s,i,c){const d=s[i];s[i]=s[c],s[c]=d}At("FeaturePositionMap",Rr);class Nn{constructor(i,c){this.gl=i.gl,this.location=c}}class Ni extends Nn{constructor(i,c){super(i,c),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1f(this.location,i))}}class xo extends Nn{constructor(i,c){super(i,c),this.current=[0,0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]&&i[3]===this.current[3]||(this.current=i,this.gl.uniform4f(this.location,i[0],i[1],i[2],i[3]))}}class rs extends Nn{constructor(i,c){super(i,c),this.current=zr.transparent}set(i){i.r===this.current.r&&i.g===this.current.g&&i.b===this.current.b&&i.a===this.current.a||(this.current=i,this.gl.uniform4f(this.location,i.r,i.g,i.b,i.a))}}const Za=new Float32Array(16);function ns(s){return[ar(255*s.r,255*s.g),ar(255*s.b,255*s.a)]}class So{constructor(i,c,d){this.value=i,this.uniformNames=c.map(g=>`u_${g}`),this.type=d}setUniform(i,c,d){i.set(d.constantOr(this.value))}getBinding(i,c,d){return this.type==="color"?new rs(i,c):new Ni(i,c)}}class Pn{constructor(i,c){this.uniformNames=c.map(d=>`u_${d}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(i,c){this.pixelRatioFrom=c.pixelRatio,this.pixelRatioTo=i.pixelRatio,this.patternFrom=c.tlbr,this.patternTo=i.tlbr}setUniform(i,c,d,g){const b=g==="u_pattern_to"?this.patternTo:g==="u_pattern_from"?this.patternFrom:g==="u_pixel_ratio_to"?this.pixelRatioTo:g==="u_pixel_ratio_from"?this.pixelRatioFrom:null;b&&i.set(b)}getBinding(i,c,d){return d.substr(0,9)==="u_pattern"?new xo(i,c):new Ni(i,c)}}class an{constructor(i,c,d,g){this.expression=i,this.type=d,this.maxValue=0,this.paintVertexAttributes=c.map(b=>({name:`a_${b}`,type:"Float32",components:d==="color"?2:1,offset:0})),this.paintVertexArray=new g}populatePaintArray(i,c,d,g,b){const w=this.paintVertexArray.length,T=this.expression.evaluate(new Qr(0),c,{},g,[],b);this.paintVertexArray.resize(i),this._setPaintValue(w,i,T)}updatePaintArray(i,c,d,g){const b=this.expression.evaluate({zoom:0},d,g);this._setPaintValue(i,c,b)}_setPaintValue(i,c,d){if(this.type==="color"){const g=ns(d);for(let b=i;b<c;b++)this.paintVertexArray.emplace(b,g[0],g[1])}else{for(let g=i;g<c;g++)this.paintVertexArray.emplace(g,d);this.maxValue=Math.max(this.maxValue,Math.abs(d))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class en{constructor(i,c,d,g,b,w){this.expression=i,this.uniformNames=c.map(T=>`u_${T}_t`),this.type=d,this.useIntegerZoom=g,this.zoom=b,this.maxValue=0,this.paintVertexAttributes=c.map(T=>({name:`a_${T}`,type:"Float32",components:d==="color"?4:2,offset:0})),this.paintVertexArray=new w}populatePaintArray(i,c,d,g,b){const w=this.expression.evaluate(new Qr(this.zoom),c,{},g,[],b),T=this.expression.evaluate(new Qr(this.zoom+1),c,{},g,[],b),I=this.paintVertexArray.length;this.paintVertexArray.resize(i),this._setPaintValue(I,i,w,T)}updatePaintArray(i,c,d,g){const b=this.expression.evaluate({zoom:this.zoom},d,g),w=this.expression.evaluate({zoom:this.zoom+1},d,g);this._setPaintValue(i,c,b,w)}_setPaintValue(i,c,d,g){if(this.type==="color"){const b=ns(d),w=ns(g);for(let T=i;T<c;T++)this.paintVertexArray.emplace(T,b[0],b[1],w[0],w[1])}else{for(let b=i;b<c;b++)this.paintVertexArray.emplace(b,d,g);this.maxValue=Math.max(this.maxValue,Math.abs(d),Math.abs(g))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(i,c){const d=this.useIntegerZoom?Math.floor(c.zoom):c.zoom,g=te(this.expression.interpolationFactor(d,this.zoom,this.zoom+1),0,1);i.set(g)}getBinding(i,c,d){return new Ni(i,c)}}class Ji{constructor(i,c,d,g,b,w){this.expression=i,this.type=c,this.useIntegerZoom=d,this.zoom=g,this.layerId=w,this.zoomInPaintVertexArray=new b,this.zoomOutPaintVertexArray=new b}populatePaintArray(i,c,d){const g=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(i),this.zoomOutPaintVertexArray.resize(i),this._setPaintValues(g,i,c.patterns&&c.patterns[this.layerId],d)}updatePaintArray(i,c,d,g,b){this._setPaintValues(i,c,d.patterns&&d.patterns[this.layerId],b)}_setPaintValues(i,c,d,g){if(!g||!d)return;const{min:b,mid:w,max:T}=d,I=g[b],L=g[w],O=g[T];if(I&&L&&O)for(let j=i;j<c;j++)this.zoomInPaintVertexArray.emplace(j,L.tl[0],L.tl[1],L.br[0],L.br[1],I.tl[0],I.tl[1],I.br[0],I.br[1],L.pixelRatio,I.pixelRatio),this.zoomOutPaintVertexArray.emplace(j,L.tl[0],L.tl[1],L.br[0],L.br[1],O.tl[0],O.tl[1],O.br[0],O.br[1],L.pixelRatio,O.pixelRatio)}upload(i){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=i.createVertexBuffer(this.zoomInPaintVertexArray,yt.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=i.createVertexBuffer(this.zoomOutPaintVertexArray,yt.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class zn{constructor(i,c,d){this.binders={},this._buffers=[];const g=[];for(const b in i.paint._values){if(!d(b))continue;const w=i.paint.get(b);if(!(w instanceof ao&&Ws(w.property.specification)))continue;const T=Yi(b,i.type),I=w.value,L=w.property.specification.type,O=w.property.useIntegerZoom,j=w.property.specification["property-type"],Z=j==="cross-faded"||j==="cross-faded-data-driven";if(I.kind==="constant")this.binders[b]=Z?new Pn(I.value,T):new So(I.value,T,L),g.push(`/u_${b}`);else if(I.kind==="source"||Z){const K=Dn(b,L,"source");this.binders[b]=Z?new Ji(I,L,O,c,K,i.id):new an(I,T,L,K),g.push(`/a_${b}`)}else{const K=Dn(b,L,"composite");this.binders[b]=new en(I,T,L,O,c,K),g.push(`/z_${b}`)}}this.cacheKey=g.sort().join("")}getMaxValue(i){const c=this.binders[i];return c instanceof an||c instanceof en?c.maxValue:0}populatePaintArrays(i,c,d,g,b){for(const w in this.binders){const T=this.binders[w];(T instanceof an||T instanceof en||T instanceof Ji)&&T.populatePaintArray(i,c,d,g,b)}}setConstantPatternPositions(i,c){for(const d in this.binders){const g=this.binders[d];g instanceof Pn&&g.setConstantPatternPositions(i,c)}}updatePaintArrays(i,c,d,g,b){let w=!1;for(const T in i){const I=c.getPositions(T);for(const L of I){const O=d.feature(L.index);for(const j in this.binders){const Z=this.binders[j];if((Z instanceof an||Z instanceof en||Z instanceof Ji)&&Z.expression.isStateDependent===!0){const K=g.paint.get(j);Z.expression=K.value,Z.updatePaintArray(L.start,L.end,O,i[T],b),w=!0}}}}return w}defines(){const i=[];for(const c in this.binders){const d=this.binders[c];(d instanceof So||d instanceof Pn)&&i.push(...d.uniformNames.map(g=>`#define HAS_UNIFORM_${g}`))}return i}getBinderAttributes(){const i=[];for(const c in this.binders){const d=this.binders[c];if(d instanceof an||d instanceof en)for(let g=0;g<d.paintVertexAttributes.length;g++)i.push(d.paintVertexAttributes[g].name);else if(d instanceof Ji)for(let g=0;g<yt.members.length;g++)i.push(yt.members[g].name)}return i}getBinderUniforms(){const i=[];for(const c in this.binders){const d=this.binders[c];if(d instanceof So||d instanceof Pn||d instanceof en)for(const g of d.uniformNames)i.push(g)}return i}getPaintVertexBuffers(){return this._buffers}getUniforms(i,c){const d=[];for(const g in this.binders){const b=this.binders[g];if(b instanceof So||b instanceof Pn||b instanceof en){for(const w of b.uniformNames)if(c[w]){const T=b.getBinding(i,c[w],w);d.push({name:w,property:g,binding:T})}}}return d}setUniforms(i,c,d,g){for(const{name:b,property:w,binding:T}of c)this.binders[w].setUniform(T,g,d.get(w),b)}updatePaintBuffers(i){this._buffers=[];for(const c in this.binders){const d=this.binders[c];if(i&&d instanceof Ji){const g=i.fromScale===2?d.zoomInPaintVertexBuffer:d.zoomOutPaintVertexBuffer;g&&this._buffers.push(g)}else(d instanceof an||d instanceof en)&&d.paintVertexBuffer&&this._buffers.push(d.paintVertexBuffer)}}upload(i){for(const c in this.binders){const d=this.binders[c];(d instanceof an||d instanceof en||d instanceof Ji)&&d.upload(i)}this.updatePaintBuffers()}destroy(){for(const i in this.binders){const c=this.binders[i];(c instanceof an||c instanceof en||c instanceof Ji)&&c.destroy()}}}class ln{constructor(i,c,d=()=>!0){this.programConfigurations={};for(const g of i)this.programConfigurations[g.id]=new zn(g,c,d);this.needsUpload=!1,this._featureMap=new Rr,this._bufferOffset=0}populatePaintArrays(i,c,d,g,b,w){for(const T in this.programConfigurations)this.programConfigurations[T].populatePaintArrays(i,c,g,b,w);c.id!==void 0&&this._featureMap.add(c.id,d,this._bufferOffset,i),this._bufferOffset=i,this.needsUpload=!0}updatePaintArrays(i,c,d,g){for(const b of d)this.needsUpload=this.programConfigurations[b.id].updatePaintArrays(i,this._featureMap,c,b,g)||this.needsUpload}get(i){return this.programConfigurations[i]}upload(i){if(this.needsUpload){for(const c in this.programConfigurations)this.programConfigurations[c].upload(i);this.needsUpload=!1}}destroy(){for(const i in this.programConfigurations)this.programConfigurations[i].destroy()}}function Yi(s,i){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[s]||[s.replace(`${i}-`,"").replace(/-/g,"_")]}function Dn(s,i,c){const d={color:{source:qa,composite:Wl},number:{source:ql,composite:qa}},g=function(b){return{"line-pattern":{source:Ee,composite:Ee},"fill-pattern":{source:Ee,composite:Ee},"fill-extrusion-pattern":{source:Ee,composite:Ee}}[b]}(s);return g&&g[c]||d[i][c]}At("ConstantBinder",So),At("CrossFadedConstantBinder",Pn),At("SourceExpressionBinder",an),At("CrossFadedCompositeBinder",Ji),At("CompositeExpressionBinder",en),At("ProgramConfiguration",zn,{omit:["_buffers"]}),At("ProgramConfigurationSet",ln);const vn=8192,mu=Math.pow(2,14)-1,bf=-mu-1;function Ss(s){const i=vn/s.extent,c=s.loadGeometry();for(let d=0;d<c.length;d++){const g=c[d];for(let b=0;b<g.length;b++){const w=g[b],T=Math.round(w.x*i),I=Math.round(w.y*i);w.x=te(T,bf,mu),w.y=te(I,bf,mu),(T<w.x||T>w.x+1||I<w.y||I>w.y+1)&&He("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return c}function ks(s,i){return{type:s.type,id:s.id,properties:s.properties,geometry:i?Ss(s):[]}}function Zl(s,i,c,d,g){s.emplaceBack(2*i+(d+1)/2,2*c+(g+1)/2)}class is{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(c=>c.id),this.index=i.index,this.hasPattern=!1,this.layoutVertexArray=new Y,this.indexArray=new Xe,this.segments=new gt,this.programConfigurations=new ln(i.layers,i.zoom),this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id)}populate(i,c,d){const g=this.layers[0],b=[];let w=null,T=!1;g.type==="circle"&&(w=g.layout.get("circle-sort-key"),T=!w.isConstant());for(const{feature:I,id:L,index:O,sourceLayerIndex:j}of i){const Z=this.layers[0]._featureFilter.needGeometry,K=ks(I,Z);if(!this.layers[0]._featureFilter.filter(new Qr(this.zoom),K,d))continue;const Q=T?w.evaluate(K,{},d):void 0,ae={id:L,properties:I.properties,type:I.type,sourceLayerIndex:j,index:O,geometry:Z?K.geometry:Ss(I),patterns:{},sortKey:Q};b.push(ae)}T&&b.sort((I,L)=>I.sortKey-L.sortKey);for(const I of b){const{geometry:L,index:O,sourceLayerIndex:j}=I,Z=i[O].feature;this.addFeature(I,L,O,d),c.featureIndex.insert(Z,L,O,j,this.index)}}update(i,c,d){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,c,this.stateDependentLayers,d)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,ft),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(i,c,d,g){for(const b of c)for(const w of b){const T=w.x,I=w.y;if(T<0||T>=vn||I<0||I>=vn)continue;const L=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,i.sortKey),O=L.vertexLength;Zl(this.layoutVertexArray,T,I,-1,-1),Zl(this.layoutVertexArray,T,I,1,-1),Zl(this.layoutVertexArray,T,I,1,1),Zl(this.layoutVertexArray,T,I,-1,1),this.indexArray.emplaceBack(O,O+1,O+2),this.indexArray.emplaceBack(O,O+3,O+2),L.vertexLength+=4,L.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,d,{},g)}}function gu(s,i){for(let c=0;c<s.length;c++)if(Xl(i,s[c]))return!0;for(let c=0;c<i.length;c++)if(Xl(s,i[c]))return!0;return!!Hl(s,i)}function wf(s,i,c){return!!Xl(s,i)||!!mp(i,s,c)}function _u(s,i){if(s.length===1)return h_(i,s[0]);for(let c=0;c<i.length;c++){const d=i[c];for(let g=0;g<d.length;g++)if(Xl(s,d[g]))return!0}for(let c=0;c<s.length;c++)if(h_(i,s[c]))return!0;for(let c=0;c<i.length;c++)if(Hl(s,i[c]))return!0;return!1}function yu(s,i,c){if(s.length>1){if(Hl(s,i))return!0;for(let d=0;d<i.length;d++)if(mp(i[d],s,c))return!0}for(let d=0;d<s.length;d++)if(mp(s[d],i,c))return!0;return!1}function Hl(s,i){if(s.length===0||i.length===0)return!1;for(let c=0;c<s.length-1;c++){const d=s[c],g=s[c+1];for(let b=0;b<i.length-1;b++)if(vu(d,g,i[b],i[b+1]))return!0}return!1}function vu(s,i,c,d){return Ce(s,c,d)!==Ce(i,c,d)&&Ce(s,i,c)!==Ce(s,i,d)}function mp(s,i,c){const d=c*c;if(i.length===1)return s.distSqr(i[0])<d;for(let g=1;g<i.length;g++)if(u_(s,i[g-1],i[g])<d)return!0;return!1}function u_(s,i,c){const d=i.distSqr(c);if(d===0)return s.distSqr(i);const g=((s.x-i.x)*(c.x-i.x)+(s.y-i.y)*(c.y-i.y))/d;return s.distSqr(g<0?i:g>1?c:c.sub(i)._mult(g)._add(i))}function h_(s,i){let c,d,g,b=!1;for(let w=0;w<s.length;w++){c=s[w];for(let T=0,I=c.length-1;T<c.length;I=T++)d=c[T],g=c[I],d.y>i.y!=g.y>i.y&&i.x<(g.x-d.x)*(i.y-d.y)/(g.y-d.y)+d.x&&(b=!b)}return b}function Xl(s,i){let c=!1;for(let d=0,g=s.length-1;d<s.length;g=d++){const b=s[d],w=s[g];b.y>i.y!=w.y>i.y&&i.x<(w.x-b.x)*(i.y-b.y)/(w.y-b.y)+b.x&&(c=!c)}return c}function Zx(s,i,c){const d=c[0],g=c[2];if(s.x<d.x&&i.x<d.x||s.x>g.x&&i.x>g.x||s.y<d.y&&i.y<d.y||s.y>g.y&&i.y>g.y)return!1;const b=Ce(s,i,c[0]);return b!==Ce(s,i,c[1])||b!==Ce(s,i,c[2])||b!==Ce(s,i,c[3])}function bu(s,i,c){const d=i.paint.get(s).value;return d.kind==="constant"?d.value:c.programConfigurations.get(i.id).getMaxValue(s)}function xf(s){return Math.sqrt(s[0]*s[0]+s[1]*s[1])}function Sf(s,i,c,d,g){if(!i[0]&&!i[1])return s;const b=S.convert(i)._mult(g);c==="viewport"&&b._rotate(-d);const w=[];for(let T=0;T<s.length;T++)w.push(s[T].sub(b));return w}let f_,d_;At("CircleBucket",is,{omit:["layers"]});var Hx={get paint(){return d_=d_||new Ti({"circle-radius":new Gt(ie.paint_circle["circle-radius"]),"circle-color":new Gt(ie.paint_circle["circle-color"]),"circle-blur":new Gt(ie.paint_circle["circle-blur"]),"circle-opacity":new Gt(ie.paint_circle["circle-opacity"]),"circle-translate":new Nt(ie.paint_circle["circle-translate"]),"circle-translate-anchor":new Nt(ie.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Nt(ie.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Nt(ie.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Gt(ie.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Gt(ie.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Gt(ie.paint_circle["circle-stroke-opacity"])})},get layout(){return f_=f_||new Ti({"circle-sort-key":new Gt(ie.layout_circle["circle-sort-key"])})}},Ei=1e-6,Kl=typeof Float32Array<"u"?Float32Array:Array;function gp(s){return s[0]=1,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=1,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}function p_(s,i,c){var d=i[0],g=i[1],b=i[2],w=i[3],T=i[4],I=i[5],L=i[6],O=i[7],j=i[8],Z=i[9],K=i[10],Q=i[11],ae=i[12],_e=i[13],xe=i[14],Re=i[15],ke=c[0],Ae=c[1],Ye=c[2],et=c[3];return s[0]=ke*d+Ae*T+Ye*j+et*ae,s[1]=ke*g+Ae*I+Ye*Z+et*_e,s[2]=ke*b+Ae*L+Ye*K+et*xe,s[3]=ke*w+Ae*O+Ye*Q+et*Re,s[4]=(ke=c[4])*d+(Ae=c[5])*T+(Ye=c[6])*j+(et=c[7])*ae,s[5]=ke*g+Ae*I+Ye*Z+et*_e,s[6]=ke*b+Ae*L+Ye*K+et*xe,s[7]=ke*w+Ae*O+Ye*Q+et*Re,s[8]=(ke=c[8])*d+(Ae=c[9])*T+(Ye=c[10])*j+(et=c[11])*ae,s[9]=ke*g+Ae*I+Ye*Z+et*_e,s[10]=ke*b+Ae*L+Ye*K+et*xe,s[11]=ke*w+Ae*O+Ye*Q+et*Re,s[12]=(ke=c[12])*d+(Ae=c[13])*T+(Ye=c[14])*j+(et=c[15])*ae,s[13]=ke*g+Ae*I+Ye*Z+et*_e,s[14]=ke*b+Ae*L+Ye*K+et*xe,s[15]=ke*w+Ae*O+Ye*Q+et*Re,s}Math.hypot||(Math.hypot=function(){for(var s=0,i=arguments.length;i--;)s+=arguments[i]*arguments[i];return Math.sqrt(s)});var wu,Xx=p_;function kf(s,i,c){var d=i[0],g=i[1],b=i[2],w=i[3];return s[0]=c[0]*d+c[4]*g+c[8]*b+c[12]*w,s[1]=c[1]*d+c[5]*g+c[9]*b+c[13]*w,s[2]=c[2]*d+c[6]*g+c[10]*b+c[14]*w,s[3]=c[3]*d+c[7]*g+c[11]*b+c[15]*w,s}wu=new Kl(4),Kl!=Float32Array&&(wu[0]=0,wu[1]=0,wu[2]=0,wu[3]=0);class Kx extends lo{constructor(i){super(i,Hx)}createBucket(i){return new is(i)}queryRadius(i){const c=i;return bu("circle-radius",this,c)+bu("circle-stroke-width",this,c)+xf(this.paint.get("circle-translate"))}queryIntersectsFeature(i,c,d,g,b,w,T,I){const L=Sf(i,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),w.angle,T),O=this.paint.get("circle-radius").evaluate(c,d)+this.paint.get("circle-stroke-width").evaluate(c,d),j=this.paint.get("circle-pitch-alignment")==="map",Z=j?L:function(Q,ae){return Q.map(_e=>m_(_e,ae))}(L,I),K=j?O*T:O;for(const Q of g)for(const ae of Q){const _e=j?ae:m_(ae,I);let xe=K;const Re=kf([],[ae.x,ae.y,0,1],I);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?xe*=Re[3]/w.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(xe*=w.cameraToCenterDistance/Re[3]),wf(Z,_e,xe))return!0}return!1}}function m_(s,i){const c=kf([],[s.x,s.y,0,1],i);return new S(c[0]/c[3],c[1]/c[3])}class g_ extends is{}let __;At("HeatmapBucket",g_,{omit:["layers"]});var Jx={get paint(){return __=__||new Ti({"heatmap-radius":new Gt(ie.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Gt(ie.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Nt(ie.paint_heatmap["heatmap-intensity"]),"heatmap-color":new su(ie.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Nt(ie.paint_heatmap["heatmap-opacity"])})}};function _p(s,{width:i,height:c},d,g){if(g){if(g instanceof Uint8ClampedArray)g=new Uint8Array(g.buffer);else if(g.length!==i*c*d)throw new RangeError(`mismatched image size. expected: ${g.length} but got: ${i*c*d}`)}else g=new Uint8Array(i*c*d);return s.width=i,s.height=c,s.data=g,s}function y_(s,{width:i,height:c},d){if(i===s.width&&c===s.height)return;const g=_p({},{width:i,height:c},d);yp(s,g,{x:0,y:0},{x:0,y:0},{width:Math.min(s.width,i),height:Math.min(s.height,c)},d),s.width=i,s.height=c,s.data=g.data}function yp(s,i,c,d,g,b){if(g.width===0||g.height===0)return i;if(g.width>s.width||g.height>s.height||c.x>s.width-g.width||c.y>s.height-g.height)throw new RangeError("out of range source coordinates for image copy");if(g.width>i.width||g.height>i.height||d.x>i.width-g.width||d.y>i.height-g.height)throw new RangeError("out of range destination coordinates for image copy");const w=s.data,T=i.data;if(w===T)throw new Error("srcData equals dstData, so image is already copied");for(let I=0;I<g.height;I++){const L=((c.y+I)*s.width+c.x)*b,O=((d.y+I)*i.width+d.x)*b;for(let j=0;j<g.width*b;j++)T[O+j]=w[L+j]}return i}class xu{constructor(i,c){_p(this,i,1,c)}resize(i){y_(this,i,1)}clone(){return new xu({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,c,d,g,b){yp(i,c,d,g,b,1)}}class co{constructor(i,c){_p(this,i,4,c)}resize(i){y_(this,i,4)}replace(i,c){c?this.data.set(i):this.data=i instanceof Uint8ClampedArray?new Uint8Array(i.buffer):i}clone(){return new co({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,c,d,g,b){yp(i,c,d,g,b,4)}}function v_(s){const i={},c=s.resolution||256,d=s.clips?s.clips.length:1,g=s.image||new co({width:c,height:d});if(Math.log(c)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${c}`);const b=(w,T,I)=>{i[s.evaluationKey]=I;const L=s.expression.evaluate(i);g.data[w+T+0]=Math.floor(255*L.r/L.a),g.data[w+T+1]=Math.floor(255*L.g/L.a),g.data[w+T+2]=Math.floor(255*L.b/L.a),g.data[w+T+3]=Math.floor(255*L.a)};if(s.clips)for(let w=0,T=0;w<d;++w,T+=4*c)for(let I=0,L=0;I<c;I++,L+=4){const O=I/(c-1),{start:j,end:Z}=s.clips[w];b(T,L,j*(1-O)+Z*O)}else for(let w=0,T=0;w<c;w++,T+=4)b(0,T,w/(c-1));return g}At("AlphaImage",xu),At("RGBAImage",co);class Yx extends lo{createBucket(i){return new g_(i)}constructor(i){super(i,Jx),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(i){i==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=v_({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let b_;var Qx={get paint(){return b_=b_||new Ti({"hillshade-illumination-direction":new Nt(ie.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Nt(ie.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Nt(ie.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Nt(ie.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Nt(ie.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Nt(ie.paint_hillshade["hillshade-accent-color"])})}};class e2 extends lo{constructor(i){super(i,Qx)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const t2=En([{name:"a_pos",components:2,type:"Int16"}],4),{members:r2}=t2;var vp={exports:{}};function Tf(s,i,c){c=c||2;var d,g,b,w,T,I,L,O=i&&i.length,j=O?i[0]*c:s.length,Z=w_(s,0,j,c,!0),K=[];if(!Z||Z.next===Z.prev)return K;if(O&&(Z=function(ae,_e,xe,Re){var ke,Ae,Ye,et=[];for(ke=0,Ae=_e.length;ke<Ae;ke++)(Ye=w_(ae,_e[ke]*Re,ke<Ae-1?_e[ke+1]*Re:ae.length,Re,!1))===Ye.next&&(Ye.steiner=!0),et.push(u2(Ye));for(et.sort(a2),ke=0;ke<et.length;ke++)xe=l2(et[ke],xe);return xe}(s,i,Z,c)),s.length>80*c){d=b=s[0],g=w=s[1];for(var Q=c;Q<j;Q+=c)(T=s[Q])<d&&(d=T),(I=s[Q+1])<g&&(g=I),T>b&&(b=T),I>w&&(w=I);L=(L=Math.max(b-d,w-g))!==0?32767/L:0}return Su(Z,K,c,d,g,L,0),K}function w_(s,i,c,d,g){var b,w;if(g===xp(s,i,c,d)>0)for(b=i;b<c;b+=d)w=k_(b,s[b],s[b+1],w);else for(b=c-d;b>=i;b-=d)w=k_(b,s[b],s[b+1],w);return w&&Ef(w,w.next)&&(Tu(w),w=w.next),w}function Ha(s,i){if(!s)return s;i||(i=s);var c,d=s;do if(c=!1,d.steiner||!Ef(d,d.next)&&Cn(d.prev,d,d.next)!==0)d=d.next;else{if(Tu(d),(d=i=d.prev)===d.next)break;c=!0}while(c||d!==i);return i}function Su(s,i,c,d,g,b,w){if(s){!w&&b&&function(O,j,Z,K){var Q=O;do Q.z===0&&(Q.z=bp(Q.x,Q.y,j,Z,K)),Q.prevZ=Q.prev,Q.nextZ=Q.next,Q=Q.next;while(Q!==O);Q.prevZ.nextZ=null,Q.prevZ=null,function(ae){var _e,xe,Re,ke,Ae,Ye,et,Tt,Rt=1;do{for(xe=ae,ae=null,Ae=null,Ye=0;xe;){for(Ye++,Re=xe,et=0,_e=0;_e<Rt&&(et++,Re=Re.nextZ);_e++);for(Tt=Rt;et>0||Tt>0&&Re;)et!==0&&(Tt===0||!Re||xe.z<=Re.z)?(ke=xe,xe=xe.nextZ,et--):(ke=Re,Re=Re.nextZ,Tt--),Ae?Ae.nextZ=ke:ae=ke,ke.prevZ=Ae,Ae=ke;xe=Re}Ae.nextZ=null,Rt*=2}while(Ye>1)}(Q)}(s,d,g,b);for(var T,I,L=s;s.prev!==s.next;)if(T=s.prev,I=s.next,b?i2(s,d,g,b):n2(s))i.push(T.i/c|0),i.push(s.i/c|0),i.push(I.i/c|0),Tu(s),s=I.next,L=I.next;else if((s=I)===L){w?w===1?Su(s=o2(Ha(s),i,c),i,c,d,g,b,2):w===2&&s2(s,i,c,d,g,b):Su(Ha(s),i,c,d,g,b,1);break}}}function n2(s){var i=s.prev,c=s,d=s.next;if(Cn(i,c,d)>=0)return!1;for(var g=i.x,b=c.x,w=d.x,T=i.y,I=c.y,L=d.y,O=g<b?g<w?g:w:b<w?b:w,j=T<I?T<L?T:L:I<L?I:L,Z=g>b?g>w?g:w:b>w?b:w,K=T>I?T>L?T:L:I>L?I:L,Q=d.next;Q!==i;){if(Q.x>=O&&Q.x<=Z&&Q.y>=j&&Q.y<=K&&Jl(g,T,b,I,w,L,Q.x,Q.y)&&Cn(Q.prev,Q,Q.next)>=0)return!1;Q=Q.next}return!0}function i2(s,i,c,d){var g=s.prev,b=s,w=s.next;if(Cn(g,b,w)>=0)return!1;for(var T=g.x,I=b.x,L=w.x,O=g.y,j=b.y,Z=w.y,K=T<I?T<L?T:L:I<L?I:L,Q=O<j?O<Z?O:Z:j<Z?j:Z,ae=T>I?T>L?T:L:I>L?I:L,_e=O>j?O>Z?O:Z:j>Z?j:Z,xe=bp(K,Q,i,c,d),Re=bp(ae,_e,i,c,d),ke=s.prevZ,Ae=s.nextZ;ke&&ke.z>=xe&&Ae&&Ae.z<=Re;){if(ke.x>=K&&ke.x<=ae&&ke.y>=Q&&ke.y<=_e&&ke!==g&&ke!==w&&Jl(T,O,I,j,L,Z,ke.x,ke.y)&&Cn(ke.prev,ke,ke.next)>=0||(ke=ke.prevZ,Ae.x>=K&&Ae.x<=ae&&Ae.y>=Q&&Ae.y<=_e&&Ae!==g&&Ae!==w&&Jl(T,O,I,j,L,Z,Ae.x,Ae.y)&&Cn(Ae.prev,Ae,Ae.next)>=0))return!1;Ae=Ae.nextZ}for(;ke&&ke.z>=xe;){if(ke.x>=K&&ke.x<=ae&&ke.y>=Q&&ke.y<=_e&&ke!==g&&ke!==w&&Jl(T,O,I,j,L,Z,ke.x,ke.y)&&Cn(ke.prev,ke,ke.next)>=0)return!1;ke=ke.prevZ}for(;Ae&&Ae.z<=Re;){if(Ae.x>=K&&Ae.x<=ae&&Ae.y>=Q&&Ae.y<=_e&&Ae!==g&&Ae!==w&&Jl(T,O,I,j,L,Z,Ae.x,Ae.y)&&Cn(Ae.prev,Ae,Ae.next)>=0)return!1;Ae=Ae.nextZ}return!0}function o2(s,i,c){var d=s;do{var g=d.prev,b=d.next.next;!Ef(g,b)&&x_(g,d,d.next,b)&&ku(g,b)&&ku(b,g)&&(i.push(g.i/c|0),i.push(d.i/c|0),i.push(b.i/c|0),Tu(d),Tu(d.next),d=s=b),d=d.next}while(d!==s);return Ha(d)}function s2(s,i,c,d,g,b){var w=s;do{for(var T=w.next.next;T!==w.prev;){if(w.i!==T.i&&h2(w,T)){var I=S_(w,T);return w=Ha(w,w.next),I=Ha(I,I.next),Su(w,i,c,d,g,b,0),void Su(I,i,c,d,g,b,0)}T=T.next}w=w.next}while(w!==s)}function a2(s,i){return s.x-i.x}function l2(s,i){var c=function(g,b){var w,T=b,I=g.x,L=g.y,O=-1/0;do{if(L<=T.y&&L>=T.next.y&&T.next.y!==T.y){var j=T.x+(L-T.y)*(T.next.x-T.x)/(T.next.y-T.y);if(j<=I&&j>O&&(O=j,w=T.x<T.next.x?T:T.next,j===I))return w}T=T.next}while(T!==b);if(!w)return null;var Z,K=w,Q=w.x,ae=w.y,_e=1/0;T=w;do I>=T.x&&T.x>=Q&&I!==T.x&&Jl(L<ae?I:O,L,Q,ae,L<ae?O:I,L,T.x,T.y)&&(Z=Math.abs(L-T.y)/(I-T.x),ku(T,g)&&(Z<_e||Z===_e&&(T.x>w.x||T.x===w.x&&c2(w,T)))&&(w=T,_e=Z)),T=T.next;while(T!==K);return w}(s,i);if(!c)return i;var d=S_(c,s);return Ha(d,d.next),Ha(c,c.next)}function c2(s,i){return Cn(s.prev,s,i.prev)<0&&Cn(i.next,s,s.next)<0}function bp(s,i,c,d,g){return(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s=(s-c)*g|0)|s<<8))|s<<4))|s<<2))|s<<1))|(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-d)*g|0)|i<<8))|i<<4))|i<<2))|i<<1))<<1}function u2(s){var i=s,c=s;do(i.x<c.x||i.x===c.x&&i.y<c.y)&&(c=i),i=i.next;while(i!==s);return c}function Jl(s,i,c,d,g,b,w,T){return(g-w)*(i-T)>=(s-w)*(b-T)&&(s-w)*(d-T)>=(c-w)*(i-T)&&(c-w)*(b-T)>=(g-w)*(d-T)}function h2(s,i){return s.next.i!==i.i&&s.prev.i!==i.i&&!function(c,d){var g=c;do{if(g.i!==c.i&&g.next.i!==c.i&&g.i!==d.i&&g.next.i!==d.i&&x_(g,g.next,c,d))return!0;g=g.next}while(g!==c);return!1}(s,i)&&(ku(s,i)&&ku(i,s)&&function(c,d){var g=c,b=!1,w=(c.x+d.x)/2,T=(c.y+d.y)/2;do g.y>T!=g.next.y>T&&g.next.y!==g.y&&w<(g.next.x-g.x)*(T-g.y)/(g.next.y-g.y)+g.x&&(b=!b),g=g.next;while(g!==c);return b}(s,i)&&(Cn(s.prev,s,i.prev)||Cn(s,i.prev,i))||Ef(s,i)&&Cn(s.prev,s,s.next)>0&&Cn(i.prev,i,i.next)>0)}function Cn(s,i,c){return(i.y-s.y)*(c.x-i.x)-(i.x-s.x)*(c.y-i.y)}function Ef(s,i){return s.x===i.x&&s.y===i.y}function x_(s,i,c,d){var g=Mf(Cn(s,i,c)),b=Mf(Cn(s,i,d)),w=Mf(Cn(c,d,s)),T=Mf(Cn(c,d,i));return g!==b&&w!==T||!(g!==0||!Cf(s,c,i))||!(b!==0||!Cf(s,d,i))||!(w!==0||!Cf(c,s,d))||!(T!==0||!Cf(c,i,d))}function Cf(s,i,c){return i.x<=Math.max(s.x,c.x)&&i.x>=Math.min(s.x,c.x)&&i.y<=Math.max(s.y,c.y)&&i.y>=Math.min(s.y,c.y)}function Mf(s){return s>0?1:s<0?-1:0}function ku(s,i){return Cn(s.prev,s,s.next)<0?Cn(s,i,s.next)>=0&&Cn(s,s.prev,i)>=0:Cn(s,i,s.prev)<0||Cn(s,s.next,i)<0}function S_(s,i){var c=new wp(s.i,s.x,s.y),d=new wp(i.i,i.x,i.y),g=s.next,b=i.prev;return s.next=i,i.prev=s,c.next=g,g.prev=c,d.next=c,c.prev=d,b.next=d,d.prev=b,d}function k_(s,i,c,d){var g=new wp(s,i,c);return d?(g.next=d.next,g.prev=d,d.next.prev=g,d.next=g):(g.prev=g,g.next=g),g}function Tu(s){s.next.prev=s.prev,s.prev.next=s.next,s.prevZ&&(s.prevZ.nextZ=s.nextZ),s.nextZ&&(s.nextZ.prevZ=s.prevZ)}function wp(s,i,c){this.i=s,this.x=i,this.y=c,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function xp(s,i,c,d){for(var g=0,b=i,w=c-d;b<c;b+=d)g+=(s[w]-s[b])*(s[b+1]+s[w+1]),w=b;return g}vp.exports=Tf,vp.exports.default=Tf,Tf.deviation=function(s,i,c,d){var g=i&&i.length,b=Math.abs(xp(s,0,g?i[0]*c:s.length,c));if(g)for(var w=0,T=i.length;w<T;w++)b-=Math.abs(xp(s,i[w]*c,w<T-1?i[w+1]*c:s.length,c));var I=0;for(w=0;w<d.length;w+=3){var L=d[w]*c,O=d[w+1]*c,j=d[w+2]*c;I+=Math.abs((s[L]-s[j])*(s[O+1]-s[L+1])-(s[L]-s[O])*(s[j+1]-s[L+1]))}return b===0&&I===0?0:Math.abs((I-b)/b)},Tf.flatten=function(s){for(var i=s[0][0].length,c={vertices:[],holes:[],dimensions:i},d=0,g=0;g<s.length;g++){for(var b=0;b<s[g].length;b++)for(var w=0;w<i;w++)c.vertices.push(s[g][b][w]);g>0&&c.holes.push(d+=s[g-1].length)}return c};var T_=_(vp.exports);function f2(s,i,c,d,g){E_(s,i,c||0,d||s.length-1,g||d2)}function E_(s,i,c,d,g){for(;d>c;){if(d-c>600){var b=d-c+1,w=i-c+1,T=Math.log(b),I=.5*Math.exp(2*T/3),L=.5*Math.sqrt(T*I*(b-I)/b)*(w-b/2<0?-1:1);E_(s,i,Math.max(c,Math.floor(i-w*I/b+L)),Math.min(d,Math.floor(i+(b-w)*I/b+L)),g)}var O=s[i],j=c,Z=d;for(Eu(s,c,i),g(s[d],O)>0&&Eu(s,c,d);j<Z;){for(Eu(s,j,Z),j++,Z--;g(s[j],O)<0;)j++;for(;g(s[Z],O)>0;)Z--}g(s[c],O)===0?Eu(s,c,Z):Eu(s,++Z,d),Z<=i&&(c=Z+1),i<=Z&&(d=Z-1)}}function Eu(s,i,c){var d=s[i];s[i]=s[c],s[c]=d}function d2(s,i){return s<i?-1:s>i?1:0}function Sp(s,i){const c=s.length;if(c<=1)return[s];const d=[];let g,b;for(let w=0;w<c;w++){const T=Qe(s[w]);T!==0&&(s[w].area=Math.abs(T),b===void 0&&(b=T<0),b===T<0?(g&&d.push(g),g=[s[w]]):g.push(s[w]))}if(g&&d.push(g),i>1)for(let w=0;w<d.length;w++)d[w].length<=i||(f2(d[w],i,1,d[w].length-1,p2),d[w]=d[w].slice(0,i));return d}function p2(s,i){return i.area-s.area}function kp(s,i,c){const d=c.patternDependencies;let g=!1;for(const b of i){const w=b.paint.get(`${s}-pattern`);w.isConstant()||(g=!0);const T=w.constantOr(null);T&&(g=!0,d[T.to]=!0,d[T.from]=!0)}return g}function Tp(s,i,c,d,g){const b=g.patternDependencies;for(const w of i){const T=w.paint.get(`${s}-pattern`).value;if(T.kind!=="constant"){let I=T.evaluate({zoom:d-1},c,{},g.availableImages),L=T.evaluate({zoom:d},c,{},g.availableImages),O=T.evaluate({zoom:d+1},c,{},g.availableImages);I=I&&I.name?I.name:I,L=L&&L.name?L.name:L,O=O&&O.name?O.name:O,b[I]=!0,b[L]=!0,b[O]=!0,c.patterns[w.id]={min:I,mid:L,max:O}}}return c}class Ep{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(c=>c.id),this.index=i.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new de,this.indexArray=new Xe,this.indexArray2=new nt,this.programConfigurations=new ln(i.layers,i.zoom),this.segments=new gt,this.segments2=new gt,this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id)}populate(i,c,d){this.hasPattern=kp("fill",this.layers,c);const g=this.layers[0].layout.get("fill-sort-key"),b=!g.isConstant(),w=[];for(const{feature:T,id:I,index:L,sourceLayerIndex:O}of i){const j=this.layers[0]._featureFilter.needGeometry,Z=ks(T,j);if(!this.layers[0]._featureFilter.filter(new Qr(this.zoom),Z,d))continue;const K=b?g.evaluate(Z,{},d,c.availableImages):void 0,Q={id:I,properties:T.properties,type:T.type,sourceLayerIndex:O,index:L,geometry:j?Z.geometry:Ss(T),patterns:{},sortKey:K};w.push(Q)}b&&w.sort((T,I)=>T.sortKey-I.sortKey);for(const T of w){const{geometry:I,index:L,sourceLayerIndex:O}=T;if(this.hasPattern){const j=Tp("fill",this.layers,T,this.zoom,c);this.patternFeatures.push(j)}else this.addFeature(T,I,L,d,{});c.featureIndex.insert(i[L].feature,I,L,O,this.index)}}update(i,c,d){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,c,this.stateDependentLayers,d)}addFeatures(i,c,d){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,c,d)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,r2),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.indexBuffer2=i.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(i,c,d,g,b){for(const w of Sp(c,500)){let T=0;for(const K of w)T+=K.length;const I=this.segments.prepareSegment(T,this.layoutVertexArray,this.indexArray),L=I.vertexLength,O=[],j=[];for(const K of w){if(K.length===0)continue;K!==w[0]&&j.push(O.length/2);const Q=this.segments2.prepareSegment(K.length,this.layoutVertexArray,this.indexArray2),ae=Q.vertexLength;this.layoutVertexArray.emplaceBack(K[0].x,K[0].y),this.indexArray2.emplaceBack(ae+K.length-1,ae),O.push(K[0].x),O.push(K[0].y);for(let _e=1;_e<K.length;_e++)this.layoutVertexArray.emplaceBack(K[_e].x,K[_e].y),this.indexArray2.emplaceBack(ae+_e-1,ae+_e),O.push(K[_e].x),O.push(K[_e].y);Q.vertexLength+=K.length,Q.primitiveLength+=K.length}const Z=T_(O,j);for(let K=0;K<Z.length;K+=3)this.indexArray.emplaceBack(L+Z[K],L+Z[K+1],L+Z[K+2]);I.vertexLength+=T,I.primitiveLength+=Z.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,d,b,g)}}let C_,M_;At("FillBucket",Ep,{omit:["layers","patternFeatures"]});var m2={get paint(){return M_=M_||new Ti({"fill-antialias":new Nt(ie.paint_fill["fill-antialias"]),"fill-opacity":new Gt(ie.paint_fill["fill-opacity"]),"fill-color":new Gt(ie.paint_fill["fill-color"]),"fill-outline-color":new Gt(ie.paint_fill["fill-outline-color"]),"fill-translate":new Nt(ie.paint_fill["fill-translate"]),"fill-translate-anchor":new Nt(ie.paint_fill["fill-translate-anchor"]),"fill-pattern":new Nl(ie.paint_fill["fill-pattern"])})},get layout(){return C_=C_||new Ti({"fill-sort-key":new Gt(ie.layout_fill["fill-sort-key"])})}};class g2 extends lo{constructor(i){super(i,m2)}recalculate(i,c){super.recalculate(i,c);const d=this.paint._values["fill-outline-color"];d.value.kind==="constant"&&d.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(i){return new Ep(i)}queryRadius(){return xf(this.paint.get("fill-translate"))}queryIntersectsFeature(i,c,d,g,b,w,T){return _u(Sf(i,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),w.angle,T),g)}isTileClipped(){return!0}}const _2=En([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),y2=En([{name:"a_centroid",components:2,type:"Int16"}],4),{members:v2}=_2;var ea={},b2=x,I_=Yl;function Yl(s,i,c,d,g){this.properties={},this.extent=c,this.type=0,this._pbf=s,this._geometry=-1,this._keys=d,this._values=g,s.readFields(w2,this,i)}function w2(s,i,c){s==1?i.id=c.readVarint():s==2?function(d,g){for(var b=d.readVarint()+d.pos;d.pos<b;){var w=g._keys[d.readVarint()],T=g._values[d.readVarint()];g.properties[w]=T}}(c,i):s==3?i.type=c.readVarint():s==4&&(i._geometry=c.pos)}function x2(s){for(var i,c,d=0,g=0,b=s.length,w=b-1;g<b;w=g++)d+=((c=s[w]).x-(i=s[g]).x)*(i.y+c.y);return d}Yl.types=["Unknown","Point","LineString","Polygon"],Yl.prototype.loadGeometry=function(){var s=this._pbf;s.pos=this._geometry;for(var i,c=s.readVarint()+s.pos,d=1,g=0,b=0,w=0,T=[];s.pos<c;){if(g<=0){var I=s.readVarint();d=7&I,g=I>>3}if(g--,d===1||d===2)b+=s.readSVarint(),w+=s.readSVarint(),d===1&&(i&&T.push(i),i=[]),i.push(new b2(b,w));else{if(d!==7)throw new Error("unknown command "+d);i&&i.push(i[0].clone())}}return i&&T.push(i),T},Yl.prototype.bbox=function(){var s=this._pbf;s.pos=this._geometry;for(var i=s.readVarint()+s.pos,c=1,d=0,g=0,b=0,w=1/0,T=-1/0,I=1/0,L=-1/0;s.pos<i;){if(d<=0){var O=s.readVarint();c=7&O,d=O>>3}if(d--,c===1||c===2)(g+=s.readSVarint())<w&&(w=g),g>T&&(T=g),(b+=s.readSVarint())<I&&(I=b),b>L&&(L=b);else if(c!==7)throw new Error("unknown command "+c)}return[w,I,T,L]},Yl.prototype.toGeoJSON=function(s,i,c){var d,g,b=this.extent*Math.pow(2,c),w=this.extent*s,T=this.extent*i,I=this.loadGeometry(),L=Yl.types[this.type];function O(K){for(var Q=0;Q<K.length;Q++){var ae=K[Q];K[Q]=[360*(ae.x+w)/b-180,360/Math.PI*Math.atan(Math.exp((180-360*(ae.y+T)/b)*Math.PI/180))-90]}}switch(this.type){case 1:var j=[];for(d=0;d<I.length;d++)j[d]=I[d][0];O(I=j);break;case 2:for(d=0;d<I.length;d++)O(I[d]);break;case 3:for(I=function(K){var Q=K.length;if(Q<=1)return[K];for(var ae,_e,xe=[],Re=0;Re<Q;Re++){var ke=x2(K[Re]);ke!==0&&(_e===void 0&&(_e=ke<0),_e===ke<0?(ae&&xe.push(ae),ae=[K[Re]]):ae.push(K[Re]))}return ae&&xe.push(ae),xe}(I),d=0;d<I.length;d++)for(g=0;g<I[d].length;g++)O(I[d][g])}I.length===1?I=I[0]:L="Multi"+L;var Z={type:"Feature",geometry:{type:L,coordinates:I},properties:this.properties};return"id"in this&&(Z.id=this.id),Z};var S2=I_,A_=L_;function L_(s,i){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=s,this._keys=[],this._values=[],this._features=[],s.readFields(k2,this,i),this.length=this._features.length}function k2(s,i,c){s===15?i.version=c.readVarint():s===1?i.name=c.readString():s===5?i.extent=c.readVarint():s===2?i._features.push(c.pos):s===3?i._keys.push(c.readString()):s===4&&i._values.push(function(d){for(var g=null,b=d.readVarint()+d.pos;d.pos<b;){var w=d.readVarint()>>3;g=w===1?d.readString():w===2?d.readFloat():w===3?d.readDouble():w===4?d.readVarint64():w===5?d.readVarint():w===6?d.readSVarint():w===7?d.readBoolean():null}return g}(c))}L_.prototype.feature=function(s){if(s<0||s>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[s];var i=this._pbf.readVarint()+this._pbf.pos;return new S2(this._pbf,i,this.extent,this._keys,this._values)};var T2=A_;function E2(s,i,c){if(s===3){var d=new T2(c,c.readVarint()+c.pos);d.length&&(i[d.name]=d)}}ea.VectorTile=function(s,i){this.layers=s.readFields(E2,{},i)},ea.VectorTileFeature=I_,ea.VectorTileLayer=A_;const C2=ea.VectorTileFeature.types,Cp=Math.pow(2,13);function Cu(s,i,c,d,g,b,w,T){s.emplaceBack(i,c,2*Math.floor(d*Cp)+w,g*Cp*2,b*Cp*2,Math.round(T))}class Mp{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(c=>c.id),this.index=i.index,this.hasPattern=!1,this.layoutVertexArray=new fe,this.centroidVertexArray=new q,this.indexArray=new Xe,this.programConfigurations=new ln(i.layers,i.zoom),this.segments=new gt,this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id)}populate(i,c,d){this.features=[],this.hasPattern=kp("fill-extrusion",this.layers,c);for(const{feature:g,id:b,index:w,sourceLayerIndex:T}of i){const I=this.layers[0]._featureFilter.needGeometry,L=ks(g,I);if(!this.layers[0]._featureFilter.filter(new Qr(this.zoom),L,d))continue;const O={id:b,sourceLayerIndex:T,index:w,geometry:I?L.geometry:Ss(g),properties:g.properties,type:g.type,patterns:{}};this.hasPattern?this.features.push(Tp("fill-extrusion",this.layers,O,this.zoom,c)):this.addFeature(O,O.geometry,w,d,{}),c.featureIndex.insert(g,O.geometry,w,T,this.index,!0)}}addFeatures(i,c,d){for(const g of this.features){const{geometry:b}=g;this.addFeature(g,b,g.index,c,d)}}update(i,c,d){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,c,this.stateDependentLayers,d)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,v2),this.centroidVertexBuffer=i.createVertexBuffer(this.centroidVertexArray,y2.members,!0),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(i,c,d,g,b){const w={x:0,y:0,vertexCount:0};for(const T of Sp(c,500)){let I=0;for(const Q of T)I+=Q.length;let L=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const Q of T){if(Q.length===0||I2(Q))continue;let ae=0;for(let _e=0;_e<Q.length;_e++){const xe=Q[_e];if(_e>=1){const Re=Q[_e-1];if(!M2(xe,Re)){L.vertexLength+4>gt.MAX_VERTEX_ARRAY_LENGTH&&(L=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const ke=xe.sub(Re)._perp()._unit(),Ae=Re.dist(xe);ae+Ae>32768&&(ae=0),Cu(this.layoutVertexArray,xe.x,xe.y,ke.x,ke.y,0,0,ae),Cu(this.layoutVertexArray,xe.x,xe.y,ke.x,ke.y,0,1,ae),w.x+=2*xe.x,w.y+=2*xe.y,w.vertexCount+=2,ae+=Ae,Cu(this.layoutVertexArray,Re.x,Re.y,ke.x,ke.y,0,0,ae),Cu(this.layoutVertexArray,Re.x,Re.y,ke.x,ke.y,0,1,ae),w.x+=2*Re.x,w.y+=2*Re.y,w.vertexCount+=2;const Ye=L.vertexLength;this.indexArray.emplaceBack(Ye,Ye+2,Ye+1),this.indexArray.emplaceBack(Ye+1,Ye+2,Ye+3),L.vertexLength+=4,L.primitiveLength+=2}}}}if(L.vertexLength+I>gt.MAX_VERTEX_ARRAY_LENGTH&&(L=this.segments.prepareSegment(I,this.layoutVertexArray,this.indexArray)),C2[i.type]!=="Polygon")continue;const O=[],j=[],Z=L.vertexLength;for(const Q of T)if(Q.length!==0){Q!==T[0]&&j.push(O.length/2);for(let ae=0;ae<Q.length;ae++){const _e=Q[ae];Cu(this.layoutVertexArray,_e.x,_e.y,0,0,1,1,0),w.x+=_e.x,w.y+=_e.y,w.vertexCount+=1,O.push(_e.x),O.push(_e.y)}}const K=T_(O,j);for(let Q=0;Q<K.length;Q+=3)this.indexArray.emplaceBack(Z+K[Q],Z+K[Q+2],Z+K[Q+1]);L.primitiveLength+=K.length/3,L.vertexLength+=I}for(let T=0;T<w.vertexCount;T++)this.centroidVertexArray.emplaceBack(Math.floor(w.x/w.vertexCount),Math.floor(w.y/w.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,d,b,g)}}function M2(s,i){return s.x===i.x&&(s.x<0||s.x>vn)||s.y===i.y&&(s.y<0||s.y>vn)}function I2(s){return s.every(i=>i.x<0)||s.every(i=>i.x>vn)||s.every(i=>i.y<0)||s.every(i=>i.y>vn)}let P_;At("FillExtrusionBucket",Mp,{omit:["layers","features"]});var A2={get paint(){return P_=P_||new Ti({"fill-extrusion-opacity":new Nt(ie["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Gt(ie["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Nt(ie["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Nt(ie["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Nl(ie["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Gt(ie["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Gt(ie["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Nt(ie["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class L2 extends lo{constructor(i){super(i,A2)}createBucket(i){return new Mp(i)}queryRadius(){return xf(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(i,c,d,g,b,w,T,I){const L=Sf(i,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),w.angle,T),O=this.paint.get("fill-extrusion-height").evaluate(c,d),j=this.paint.get("fill-extrusion-base").evaluate(c,d),Z=function(Q,ae,_e,xe){const Re=[];for(const ke of Q){const Ae=[ke.x,ke.y,0,1];kf(Ae,Ae,ae),Re.push(new S(Ae[0]/Ae[3],Ae[1]/Ae[3]))}return Re}(L,I),K=function(Q,ae,_e,xe){const Re=[],ke=[],Ae=xe[8]*ae,Ye=xe[9]*ae,et=xe[10]*ae,Tt=xe[11]*ae,Rt=xe[8]*_e,kt=xe[9]*_e,bt=xe[10]*_e,dt=xe[11]*_e;for(const Pt of Q){const vt=[],st=[];for(const qt of Pt){const Bt=qt.x,mr=qt.y,Xr=xe[0]*Bt+xe[4]*mr+xe[12],tn=xe[1]*Bt+xe[5]*mr+xe[13],Un=xe[2]*Bt+xe[6]*mr+xe[14],Qi=xe[3]*Bt+xe[7]*mr+xe[15],Ci=Un+et,Rn=Qi+Tt,Qn=Xr+Rt,li=tn+kt,Mi=Un+bt,Ii=Qi+dt,Vn=new S((Xr+Ae)/Rn,(tn+Ye)/Rn);Vn.z=Ci/Rn,vt.push(Vn);const $n=new S(Qn/Ii,li/Ii);$n.z=Mi/Ii,st.push($n)}Re.push(vt),ke.push(st)}return[Re,ke]}(g,j,O,I);return function(Q,ae,_e){let xe=1/0;_u(_e,ae)&&(xe=z_(_e,ae[0]));for(let Re=0;Re<ae.length;Re++){const ke=ae[Re],Ae=Q[Re];for(let Ye=0;Ye<ke.length-1;Ye++){const et=ke[Ye],Tt=[et,ke[Ye+1],Ae[Ye+1],Ae[Ye],et];gu(_e,Tt)&&(xe=Math.min(xe,z_(_e,Tt)))}}return xe!==1/0&&xe}(K[0],K[1],Z)}}function Mu(s,i){return s.x*i.x+s.y*i.y}function z_(s,i){if(s.length===1){let c=0;const d=i[c++];let g;for(;!g||d.equals(g);)if(g=i[c++],!g)return 1/0;for(;c<i.length;c++){const b=i[c],w=s[0],T=g.sub(d),I=b.sub(d),L=w.sub(d),O=Mu(T,T),j=Mu(T,I),Z=Mu(I,I),K=Mu(L,T),Q=Mu(L,I),ae=O*Z-j*j,_e=(Z*K-j*Q)/ae,xe=(O*Q-j*K)/ae,Re=d.z*(1-_e-xe)+g.z*_e+b.z*xe;if(isFinite(Re))return Re}return 1/0}{let c=1/0;for(const d of i)c=Math.min(c,d.z);return c}}const P2=En([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:z2}=P2,D2=En([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:R2}=D2,B2=ea.VectorTileFeature.types,F2=Math.cos(Math.PI/180*37.5),D_=Math.pow(2,14)/.5;class Ip{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(c=>c.id),this.index=i.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(c=>{this.gradients[c.id]={}}),this.layoutVertexArray=new ve,this.layoutVertexArray2=new se,this.indexArray=new Xe,this.programConfigurations=new ln(i.layers,i.zoom),this.segments=new gt,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id)}populate(i,c,d){this.hasPattern=kp("line",this.layers,c);const g=this.layers[0].layout.get("line-sort-key"),b=!g.isConstant(),w=[];for(const{feature:T,id:I,index:L,sourceLayerIndex:O}of i){const j=this.layers[0]._featureFilter.needGeometry,Z=ks(T,j);if(!this.layers[0]._featureFilter.filter(new Qr(this.zoom),Z,d))continue;const K=b?g.evaluate(Z,{},d):void 0,Q={id:I,properties:T.properties,type:T.type,sourceLayerIndex:O,index:L,geometry:j?Z.geometry:Ss(T),patterns:{},sortKey:K};w.push(Q)}b&&w.sort((T,I)=>T.sortKey-I.sortKey);for(const T of w){const{geometry:I,index:L,sourceLayerIndex:O}=T;if(this.hasPattern){const j=Tp("line",this.layers,T,this.zoom,c);this.patternFeatures.push(j)}else this.addFeature(T,I,L,d,{});c.featureIndex.insert(i[L].feature,I,L,O,this.index)}}update(i,c,d){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,c,this.stateDependentLayers,d)}addFeatures(i,c,d){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,c,d)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=i.createVertexBuffer(this.layoutVertexArray2,R2)),this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,z2),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(i){if(i.properties&&Object.prototype.hasOwnProperty.call(i.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(i.properties,"mapbox_clip_end"))return{start:+i.properties.mapbox_clip_start,end:+i.properties.mapbox_clip_end}}addFeature(i,c,d,g,b){const w=this.layers[0].layout,T=w.get("line-join").evaluate(i,{}),I=w.get("line-cap"),L=w.get("line-miter-limit"),O=w.get("line-round-limit");this.lineClips=this.lineFeatureClips(i);for(const j of c)this.addLine(j,i,T,I,L,O);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,d,b,g)}addLine(i,c,d,g,b,w){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let xe=0;xe<i.length-1;xe++)this.totalDistance+=i[xe].dist(i[xe+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const T=B2[c.type]==="Polygon";let I=i.length;for(;I>=2&&i[I-1].equals(i[I-2]);)I--;let L=0;for(;L<I-1&&i[L].equals(i[L+1]);)L++;if(I<(T?3:2))return;d==="bevel"&&(b=1.05);const O=this.overscaling<=16?15*vn/(512*this.overscaling):0,j=this.segments.prepareSegment(10*I,this.layoutVertexArray,this.indexArray);let Z,K,Q,ae,_e;this.e1=this.e2=-1,T&&(Z=i[I-2],_e=i[L].sub(Z)._unit()._perp());for(let xe=L;xe<I;xe++){if(Q=xe===I-1?T?i[L+1]:void 0:i[xe+1],Q&&i[xe].equals(Q))continue;_e&&(ae=_e),Z&&(K=Z),Z=i[xe],_e=Q?Q.sub(Z)._unit()._perp():ae,ae=ae||_e;let Re=ae.add(_e);Re.x===0&&Re.y===0||Re._unit();const ke=ae.x*_e.x+ae.y*_e.y,Ae=Re.x*_e.x+Re.y*_e.y,Ye=Ae!==0?1/Ae:1/0,et=2*Math.sqrt(2-2*Ae),Tt=Ae<F2&&K&&Q,Rt=ae.x*_e.y-ae.y*_e.x>0;if(Tt&&xe>L){const dt=Z.dist(K);if(dt>2*O){const Pt=Z.sub(Z.sub(K)._mult(O/dt)._round());this.updateDistance(K,Pt),this.addCurrentVertex(Pt,ae,0,0,j),K=Pt}}const kt=K&&Q;let bt=kt?d:T?"butt":g;if(kt&&bt==="round"&&(Ye<w?bt="miter":Ye<=2&&(bt="fakeround")),bt==="miter"&&Ye>b&&(bt="bevel"),bt==="bevel"&&(Ye>2&&(bt="flipbevel"),Ye<b&&(bt="miter")),K&&this.updateDistance(K,Z),bt==="miter")Re._mult(Ye),this.addCurrentVertex(Z,Re,0,0,j);else if(bt==="flipbevel"){if(Ye>100)Re=_e.mult(-1);else{const dt=Ye*ae.add(_e).mag()/ae.sub(_e).mag();Re._perp()._mult(dt*(Rt?-1:1))}this.addCurrentVertex(Z,Re,0,0,j),this.addCurrentVertex(Z,Re.mult(-1),0,0,j)}else if(bt==="bevel"||bt==="fakeround"){const dt=-Math.sqrt(Ye*Ye-1),Pt=Rt?dt:0,vt=Rt?0:dt;if(K&&this.addCurrentVertex(Z,ae,Pt,vt,j),bt==="fakeround"){const st=Math.round(180*et/Math.PI/20);for(let qt=1;qt<st;qt++){let Bt=qt/st;if(Bt!==.5){const Xr=Bt-.5;Bt+=Bt*Xr*(Bt-1)*((1.0904+ke*(ke*(3.55645-1.43519*ke)-3.2452))*Xr*Xr+(.848013+ke*(.215638*ke-1.06021)))}const mr=_e.sub(ae)._mult(Bt)._add(ae)._unit()._mult(Rt?-1:1);this.addHalfVertex(Z,mr.x,mr.y,!1,Rt,0,j)}}Q&&this.addCurrentVertex(Z,_e,-Pt,-vt,j)}else if(bt==="butt")this.addCurrentVertex(Z,Re,0,0,j);else if(bt==="square"){const dt=K?1:-1;this.addCurrentVertex(Z,Re,dt,dt,j)}else bt==="round"&&(K&&(this.addCurrentVertex(Z,ae,0,0,j),this.addCurrentVertex(Z,ae,1,1,j,!0)),Q&&(this.addCurrentVertex(Z,_e,-1,-1,j,!0),this.addCurrentVertex(Z,_e,0,0,j)));if(Tt&&xe<I-1){const dt=Z.dist(Q);if(dt>2*O){const Pt=Z.add(Q.sub(Z)._mult(O/dt)._round());this.updateDistance(Z,Pt),this.addCurrentVertex(Pt,_e,0,0,j),Z=Pt}}}}addCurrentVertex(i,c,d,g,b,w=!1){const T=c.y*g-c.x,I=-c.y-c.x*g;this.addHalfVertex(i,c.x+c.y*d,c.y-c.x*d,w,!1,d,b),this.addHalfVertex(i,T,I,w,!0,-g,b),this.distance>D_/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(i,c,d,g,b,w))}addHalfVertex({x:i,y:c},d,g,b,w,T,I){const L=.5*(this.lineClips?this.scaledDistance*(D_-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((i<<1)+(b?1:0),(c<<1)+(w?1:0),Math.round(63*d)+128,Math.round(63*g)+128,1+(T===0?0:T<0?-1:1)|(63&L)<<2,L>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const O=I.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,O),I.primitiveLength++),w?this.e2=O:this.e1=O}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(i,c){this.distance+=i.dist(c),this.updateScaledDistance()}}let R_,B_;At("LineBucket",Ip,{omit:["layers","patternFeatures"]});var F_={get paint(){return B_=B_||new Ti({"line-opacity":new Gt(ie.paint_line["line-opacity"]),"line-color":new Gt(ie.paint_line["line-color"]),"line-translate":new Nt(ie.paint_line["line-translate"]),"line-translate-anchor":new Nt(ie.paint_line["line-translate-anchor"]),"line-width":new Gt(ie.paint_line["line-width"]),"line-gap-width":new Gt(ie.paint_line["line-gap-width"]),"line-offset":new Gt(ie.paint_line["line-offset"]),"line-blur":new Gt(ie.paint_line["line-blur"]),"line-dasharray":new Ua(ie.paint_line["line-dasharray"]),"line-pattern":new Nl(ie.paint_line["line-pattern"]),"line-gradient":new su(ie.paint_line["line-gradient"])})},get layout(){return R_=R_||new Ti({"line-cap":new Nt(ie.layout_line["line-cap"]),"line-join":new Gt(ie.layout_line["line-join"]),"line-miter-limit":new Nt(ie.layout_line["line-miter-limit"]),"line-round-limit":new Nt(ie.layout_line["line-round-limit"]),"line-sort-key":new Gt(ie.layout_line["line-sort-key"])})}};class O2 extends Gt{possiblyEvaluate(i,c){return c=new Qr(Math.floor(c.zoom),{now:c.now,fadeDuration:c.fadeDuration,zoomHistory:c.zoomHistory,transition:c.transition}),super.possiblyEvaluate(i,c)}evaluate(i,c,d,g){return c=H({},c,{zoom:Math.floor(c.zoom)}),super.evaluate(i,c,d,g)}}let If;class N2 extends lo{constructor(i){super(i,F_),this.gradientVersion=0,If||(If=new O2(F_.paint.properties["line-width"].specification),If.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(i){if(i==="line-gradient"){const c=this.gradientExpression();this.stepInterpolant=!!function(d){return d._styleExpression!==void 0}(c)&&c._styleExpression.expression instanceof za,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(i,c){super.recalculate(i,c),this.paint._values["line-floorwidth"]=If.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,i)}createBucket(i){return new Ip(i)}queryRadius(i){const c=i,d=O_(bu("line-width",this,c),bu("line-gap-width",this,c)),g=bu("line-offset",this,c);return d/2+Math.abs(g)+xf(this.paint.get("line-translate"))}queryIntersectsFeature(i,c,d,g,b,w,T){const I=Sf(i,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),w.angle,T),L=T/2*O_(this.paint.get("line-width").evaluate(c,d),this.paint.get("line-gap-width").evaluate(c,d)),O=this.paint.get("line-offset").evaluate(c,d);return O&&(g=function(j,Z){const K=[];for(let Q=0;Q<j.length;Q++){const ae=j[Q],_e=[];for(let xe=0;xe<ae.length;xe++){const Re=ae[xe-1],ke=ae[xe],Ae=ae[xe+1],Ye=xe===0?new S(0,0):ke.sub(Re)._unit()._perp(),et=xe===ae.length-1?new S(0,0):Ae.sub(ke)._unit()._perp(),Tt=Ye._add(et)._unit(),Rt=Tt.x*et.x+Tt.y*et.y;Rt!==0&&Tt._mult(1/Rt),_e.push(Tt._mult(Z)._add(ke))}K.push(_e)}return K}(g,O*T)),function(j,Z,K){for(let Q=0;Q<Z.length;Q++){const ae=Z[Q];if(j.length>=3){for(let _e=0;_e<ae.length;_e++)if(Xl(j,ae[_e]))return!0}if(yu(j,ae,K))return!0}return!1}(I,g,L)}isTileClipped(){return!0}}function O_(s,i){return i>0?i+2*s:s}const j2=En([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),U2=En([{name:"a_projected_pos",components:3,type:"Float32"}],4);En([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const V2=En([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);En([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const N_=En([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),$2=En([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function q2(s,i,c){return s.sections.forEach(d=>{d.text=function(g,b,w){const T=b.layout.get("text-transform").evaluate(w,{});return T==="uppercase"?g=g.toLocaleUpperCase():T==="lowercase"&&(g=g.toLocaleLowerCase()),ts.applyArabicShaping&&(g=ts.applyArabicShaping(g)),g}(d.text,i,c)}),s}En([{name:"triangle",components:3,type:"Uint16"}]),En([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),En([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),En([{type:"Float32",name:"offsetX"}]),En([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),En([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const Iu={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var jn=24,j_=Fr,U_=function(s,i,c,d,g){var b,w,T=8*g-d-1,I=(1<<T)-1,L=I>>1,O=-7,j=c?g-1:0,Z=c?-1:1,K=s[i+j];for(j+=Z,b=K&(1<<-O)-1,K>>=-O,O+=T;O>0;b=256*b+s[i+j],j+=Z,O-=8);for(w=b&(1<<-O)-1,b>>=-O,O+=d;O>0;w=256*w+s[i+j],j+=Z,O-=8);if(b===0)b=1-L;else{if(b===I)return w?NaN:1/0*(K?-1:1);w+=Math.pow(2,d),b-=L}return(K?-1:1)*w*Math.pow(2,b-d)},V_=function(s,i,c,d,g,b){var w,T,I,L=8*b-g-1,O=(1<<L)-1,j=O>>1,Z=g===23?Math.pow(2,-24)-Math.pow(2,-77):0,K=d?0:b-1,Q=d?1:-1,ae=i<0||i===0&&1/i<0?1:0;for(i=Math.abs(i),isNaN(i)||i===1/0?(T=isNaN(i)?1:0,w=O):(w=Math.floor(Math.log(i)/Math.LN2),i*(I=Math.pow(2,-w))<1&&(w--,I*=2),(i+=w+j>=1?Z/I:Z*Math.pow(2,1-j))*I>=2&&(w++,I/=2),w+j>=O?(T=0,w=O):w+j>=1?(T=(i*I-1)*Math.pow(2,g),w+=j):(T=i*Math.pow(2,j-1)*Math.pow(2,g),w=0));g>=8;s[c+K]=255&T,K+=Q,T/=256,g-=8);for(w=w<<g|T,L+=g;L>0;s[c+K]=255&w,K+=Q,w/=256,L-=8);s[c+K-Q]|=128*ae};function Fr(s){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(s)?s:new Uint8Array(s||0),this.pos=0,this.type=0,this.length=this.buf.length}Fr.Varint=0,Fr.Fixed64=1,Fr.Bytes=2,Fr.Fixed32=5;var Ap=4294967296,$_=1/Ap,q_=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Ts(s){return s.type===Fr.Bytes?s.readVarint()+s.pos:s.pos+1}function Ql(s,i,c){return c?4294967296*i+(s>>>0):4294967296*(i>>>0)+(s>>>0)}function G_(s,i,c){var d=i<=16383?1:i<=2097151?2:i<=268435455?3:Math.floor(Math.log(i)/(7*Math.LN2));c.realloc(d);for(var g=c.pos-1;g>=s;g--)c.buf[g+d]=c.buf[g]}function G2(s,i){for(var c=0;c<s.length;c++)i.writeVarint(s[c])}function W2(s,i){for(var c=0;c<s.length;c++)i.writeSVarint(s[c])}function Z2(s,i){for(var c=0;c<s.length;c++)i.writeFloat(s[c])}function H2(s,i){for(var c=0;c<s.length;c++)i.writeDouble(s[c])}function X2(s,i){for(var c=0;c<s.length;c++)i.writeBoolean(s[c])}function K2(s,i){for(var c=0;c<s.length;c++)i.writeFixed32(s[c])}function J2(s,i){for(var c=0;c<s.length;c++)i.writeSFixed32(s[c])}function Y2(s,i){for(var c=0;c<s.length;c++)i.writeFixed64(s[c])}function Q2(s,i){for(var c=0;c<s.length;c++)i.writeSFixed64(s[c])}function Af(s,i){return(s[i]|s[i+1]<<8|s[i+2]<<16)+16777216*s[i+3]}function ec(s,i,c){s[c]=i,s[c+1]=i>>>8,s[c+2]=i>>>16,s[c+3]=i>>>24}function W_(s,i){return(s[i]|s[i+1]<<8|s[i+2]<<16)+(s[i+3]<<24)}Fr.prototype={destroy:function(){this.buf=null},readFields:function(s,i,c){for(c=c||this.length;this.pos<c;){var d=this.readVarint(),g=d>>3,b=this.pos;this.type=7&d,s(g,i,this),this.pos===b&&this.skip(d)}return i},readMessage:function(s,i){return this.readFields(s,i,this.readVarint()+this.pos)},readFixed32:function(){var s=Af(this.buf,this.pos);return this.pos+=4,s},readSFixed32:function(){var s=W_(this.buf,this.pos);return this.pos+=4,s},readFixed64:function(){var s=Af(this.buf,this.pos)+Af(this.buf,this.pos+4)*Ap;return this.pos+=8,s},readSFixed64:function(){var s=Af(this.buf,this.pos)+W_(this.buf,this.pos+4)*Ap;return this.pos+=8,s},readFloat:function(){var s=U_(this.buf,this.pos,!0,23,4);return this.pos+=4,s},readDouble:function(){var s=U_(this.buf,this.pos,!0,52,8);return this.pos+=8,s},readVarint:function(s){var i,c,d=this.buf;return i=127&(c=d[this.pos++]),c<128?i:(i|=(127&(c=d[this.pos++]))<<7,c<128?i:(i|=(127&(c=d[this.pos++]))<<14,c<128?i:(i|=(127&(c=d[this.pos++]))<<21,c<128?i:function(g,b,w){var T,I,L=w.buf;if(T=(112&(I=L[w.pos++]))>>4,I<128||(T|=(127&(I=L[w.pos++]))<<3,I<128)||(T|=(127&(I=L[w.pos++]))<<10,I<128)||(T|=(127&(I=L[w.pos++]))<<17,I<128)||(T|=(127&(I=L[w.pos++]))<<24,I<128)||(T|=(1&(I=L[w.pos++]))<<31,I<128))return Ql(g,T,b);throw new Error("Expected varint not more than 10 bytes")}(i|=(15&(c=d[this.pos]))<<28,s,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var s=this.readVarint();return s%2==1?(s+1)/-2:s/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var s=this.readVarint()+this.pos,i=this.pos;return this.pos=s,s-i>=12&&q_?function(c,d,g){return q_.decode(c.subarray(d,g))}(this.buf,i,s):function(c,d,g){for(var b="",w=d;w<g;){var T,I,L,O=c[w],j=null,Z=O>239?4:O>223?3:O>191?2:1;if(w+Z>g)break;Z===1?O<128&&(j=O):Z===2?(192&(T=c[w+1]))==128&&(j=(31&O)<<6|63&T)<=127&&(j=null):Z===3?(I=c[w+2],(192&(T=c[w+1]))==128&&(192&I)==128&&((j=(15&O)<<12|(63&T)<<6|63&I)<=2047||j>=55296&&j<=57343)&&(j=null)):Z===4&&(I=c[w+2],L=c[w+3],(192&(T=c[w+1]))==128&&(192&I)==128&&(192&L)==128&&((j=(15&O)<<18|(63&T)<<12|(63&I)<<6|63&L)<=65535||j>=1114112)&&(j=null)),j===null?(j=65533,Z=1):j>65535&&(j-=65536,b+=String.fromCharCode(j>>>10&1023|55296),j=56320|1023&j),b+=String.fromCharCode(j),w+=Z}return b}(this.buf,i,s)},readBytes:function(){var s=this.readVarint()+this.pos,i=this.buf.subarray(this.pos,s);return this.pos=s,i},readPackedVarint:function(s,i){if(this.type!==Fr.Bytes)return s.push(this.readVarint(i));var c=Ts(this);for(s=s||[];this.pos<c;)s.push(this.readVarint(i));return s},readPackedSVarint:function(s){if(this.type!==Fr.Bytes)return s.push(this.readSVarint());var i=Ts(this);for(s=s||[];this.pos<i;)s.push(this.readSVarint());return s},readPackedBoolean:function(s){if(this.type!==Fr.Bytes)return s.push(this.readBoolean());var i=Ts(this);for(s=s||[];this.pos<i;)s.push(this.readBoolean());return s},readPackedFloat:function(s){if(this.type!==Fr.Bytes)return s.push(this.readFloat());var i=Ts(this);for(s=s||[];this.pos<i;)s.push(this.readFloat());return s},readPackedDouble:function(s){if(this.type!==Fr.Bytes)return s.push(this.readDouble());var i=Ts(this);for(s=s||[];this.pos<i;)s.push(this.readDouble());return s},readPackedFixed32:function(s){if(this.type!==Fr.Bytes)return s.push(this.readFixed32());var i=Ts(this);for(s=s||[];this.pos<i;)s.push(this.readFixed32());return s},readPackedSFixed32:function(s){if(this.type!==Fr.Bytes)return s.push(this.readSFixed32());var i=Ts(this);for(s=s||[];this.pos<i;)s.push(this.readSFixed32());return s},readPackedFixed64:function(s){if(this.type!==Fr.Bytes)return s.push(this.readFixed64());var i=Ts(this);for(s=s||[];this.pos<i;)s.push(this.readFixed64());return s},readPackedSFixed64:function(s){if(this.type!==Fr.Bytes)return s.push(this.readSFixed64());var i=Ts(this);for(s=s||[];this.pos<i;)s.push(this.readSFixed64());return s},skip:function(s){var i=7&s;if(i===Fr.Varint)for(;this.buf[this.pos++]>127;);else if(i===Fr.Bytes)this.pos=this.readVarint()+this.pos;else if(i===Fr.Fixed32)this.pos+=4;else{if(i!==Fr.Fixed64)throw new Error("Unimplemented type: "+i);this.pos+=8}},writeTag:function(s,i){this.writeVarint(s<<3|i)},realloc:function(s){for(var i=this.length||16;i<this.pos+s;)i*=2;if(i!==this.length){var c=new Uint8Array(i);c.set(this.buf),this.buf=c,this.length=i}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(s){this.realloc(4),ec(this.buf,s,this.pos),this.pos+=4},writeSFixed32:function(s){this.realloc(4),ec(this.buf,s,this.pos),this.pos+=4},writeFixed64:function(s){this.realloc(8),ec(this.buf,-1&s,this.pos),ec(this.buf,Math.floor(s*$_),this.pos+4),this.pos+=8},writeSFixed64:function(s){this.realloc(8),ec(this.buf,-1&s,this.pos),ec(this.buf,Math.floor(s*$_),this.pos+4),this.pos+=8},writeVarint:function(s){(s=+s||0)>268435455||s<0?function(i,c){var d,g;if(i>=0?(d=i%4294967296|0,g=i/4294967296|0):(g=~(-i/4294967296),4294967295^(d=~(-i%4294967296))?d=d+1|0:(d=0,g=g+1|0)),i>=18446744073709552e3||i<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");c.realloc(10),function(b,w,T){T.buf[T.pos++]=127&b|128,b>>>=7,T.buf[T.pos++]=127&b|128,b>>>=7,T.buf[T.pos++]=127&b|128,b>>>=7,T.buf[T.pos++]=127&b|128,T.buf[T.pos]=127&(b>>>=7)}(d,0,c),function(b,w){var T=(7&b)<<4;w.buf[w.pos++]|=T|((b>>>=3)?128:0),b&&(w.buf[w.pos++]=127&b|((b>>>=7)?128:0),b&&(w.buf[w.pos++]=127&b|((b>>>=7)?128:0),b&&(w.buf[w.pos++]=127&b|((b>>>=7)?128:0),b&&(w.buf[w.pos++]=127&b|((b>>>=7)?128:0),b&&(w.buf[w.pos++]=127&b)))))}(g,c)}(s,this):(this.realloc(4),this.buf[this.pos++]=127&s|(s>127?128:0),s<=127||(this.buf[this.pos++]=127&(s>>>=7)|(s>127?128:0),s<=127||(this.buf[this.pos++]=127&(s>>>=7)|(s>127?128:0),s<=127||(this.buf[this.pos++]=s>>>7&127))))},writeSVarint:function(s){this.writeVarint(s<0?2*-s-1:2*s)},writeBoolean:function(s){this.writeVarint(!!s)},writeString:function(s){s=String(s),this.realloc(4*s.length),this.pos++;var i=this.pos;this.pos=function(d,g,b){for(var w,T,I=0;I<g.length;I++){if((w=g.charCodeAt(I))>55295&&w<57344){if(!T){w>56319||I+1===g.length?(d[b++]=239,d[b++]=191,d[b++]=189):T=w;continue}if(w<56320){d[b++]=239,d[b++]=191,d[b++]=189,T=w;continue}w=T-55296<<10|w-56320|65536,T=null}else T&&(d[b++]=239,d[b++]=191,d[b++]=189,T=null);w<128?d[b++]=w:(w<2048?d[b++]=w>>6|192:(w<65536?d[b++]=w>>12|224:(d[b++]=w>>18|240,d[b++]=w>>12&63|128),d[b++]=w>>6&63|128),d[b++]=63&w|128)}return b}(this.buf,s,this.pos);var c=this.pos-i;c>=128&&G_(i,c,this),this.pos=i-1,this.writeVarint(c),this.pos+=c},writeFloat:function(s){this.realloc(4),V_(this.buf,s,this.pos,!0,23,4),this.pos+=4},writeDouble:function(s){this.realloc(8),V_(this.buf,s,this.pos,!0,52,8),this.pos+=8},writeBytes:function(s){var i=s.length;this.writeVarint(i),this.realloc(i);for(var c=0;c<i;c++)this.buf[this.pos++]=s[c]},writeRawMessage:function(s,i){this.pos++;var c=this.pos;s(i,this);var d=this.pos-c;d>=128&&G_(c,d,this),this.pos=c-1,this.writeVarint(d),this.pos+=d},writeMessage:function(s,i,c){this.writeTag(s,Fr.Bytes),this.writeRawMessage(i,c)},writePackedVarint:function(s,i){i.length&&this.writeMessage(s,G2,i)},writePackedSVarint:function(s,i){i.length&&this.writeMessage(s,W2,i)},writePackedBoolean:function(s,i){i.length&&this.writeMessage(s,X2,i)},writePackedFloat:function(s,i){i.length&&this.writeMessage(s,Z2,i)},writePackedDouble:function(s,i){i.length&&this.writeMessage(s,H2,i)},writePackedFixed32:function(s,i){i.length&&this.writeMessage(s,K2,i)},writePackedSFixed32:function(s,i){i.length&&this.writeMessage(s,J2,i)},writePackedFixed64:function(s,i){i.length&&this.writeMessage(s,Y2,i)},writePackedSFixed64:function(s,i){i.length&&this.writeMessage(s,Q2,i)},writeBytesField:function(s,i){this.writeTag(s,Fr.Bytes),this.writeBytes(i)},writeFixed32Field:function(s,i){this.writeTag(s,Fr.Fixed32),this.writeFixed32(i)},writeSFixed32Field:function(s,i){this.writeTag(s,Fr.Fixed32),this.writeSFixed32(i)},writeFixed64Field:function(s,i){this.writeTag(s,Fr.Fixed64),this.writeFixed64(i)},writeSFixed64Field:function(s,i){this.writeTag(s,Fr.Fixed64),this.writeSFixed64(i)},writeVarintField:function(s,i){this.writeTag(s,Fr.Varint),this.writeVarint(i)},writeSVarintField:function(s,i){this.writeTag(s,Fr.Varint),this.writeSVarint(i)},writeStringField:function(s,i){this.writeTag(s,Fr.Bytes),this.writeString(i)},writeFloatField:function(s,i){this.writeTag(s,Fr.Fixed32),this.writeFloat(i)},writeDoubleField:function(s,i){this.writeTag(s,Fr.Fixed64),this.writeDouble(i)},writeBooleanField:function(s,i){this.writeVarintField(s,!!i)}};var Lp=_(j_);const Pp=3;function eS(s,i,c){s===1&&c.readMessage(tS,i)}function tS(s,i,c){if(s===3){const{id:d,bitmap:g,width:b,height:w,left:T,top:I,advance:L}=c.readMessage(rS,{});i.push({id:d,bitmap:new xu({width:b+2*Pp,height:w+2*Pp},g),metrics:{width:b,height:w,left:T,top:I,advance:L}})}}function rS(s,i,c){s===1?i.id=c.readVarint():s===2?i.bitmap=c.readBytes():s===3?i.width=c.readVarint():s===4?i.height=c.readVarint():s===5?i.left=c.readSVarint():s===6?i.top=c.readSVarint():s===7&&(i.advance=c.readVarint())}const Z_=Pp;function H_(s){let i=0,c=0;for(const w of s)i+=w.w*w.h,c=Math.max(c,w.w);s.sort((w,T)=>T.h-w.h);const d=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(i/.95)),c),h:1/0}];let g=0,b=0;for(const w of s)for(let T=d.length-1;T>=0;T--){const I=d[T];if(!(w.w>I.w||w.h>I.h)){if(w.x=I.x,w.y=I.y,b=Math.max(b,w.y+w.h),g=Math.max(g,w.x+w.w),w.w===I.w&&w.h===I.h){const L=d.pop();T<d.length&&(d[T]=L)}else w.h===I.h?(I.x+=w.w,I.w-=w.w):w.w===I.w?(I.y+=w.h,I.h-=w.h):(d.push({x:I.x+w.w,y:I.y,w:I.w-w.w,h:w.h}),I.y+=w.h,I.h-=w.h);break}}return{w:g,h:b,fill:i/(g*b)||0}}const ji=1;class zp{constructor(i,{pixelRatio:c,version:d,stretchX:g,stretchY:b,content:w}){this.paddedRect=i,this.pixelRatio=c,this.stretchX=g,this.stretchY=b,this.content=w,this.version=d}get tl(){return[this.paddedRect.x+ji,this.paddedRect.y+ji]}get br(){return[this.paddedRect.x+this.paddedRect.w-ji,this.paddedRect.y+this.paddedRect.h-ji]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*ji)/this.pixelRatio,(this.paddedRect.h-2*ji)/this.pixelRatio]}}class X_{constructor(i,c){const d={},g={};this.haveRenderCallbacks=[];const b=[];this.addImages(i,d,b),this.addImages(c,g,b);const{w,h:T}=H_(b),I=new co({width:w||1,height:T||1});for(const L in i){const O=i[L],j=d[L].paddedRect;co.copy(O.data,I,{x:0,y:0},{x:j.x+ji,y:j.y+ji},O.data)}for(const L in c){const O=c[L],j=g[L].paddedRect,Z=j.x+ji,K=j.y+ji,Q=O.data.width,ae=O.data.height;co.copy(O.data,I,{x:0,y:0},{x:Z,y:K},O.data),co.copy(O.data,I,{x:0,y:ae-1},{x:Z,y:K-1},{width:Q,height:1}),co.copy(O.data,I,{x:0,y:0},{x:Z,y:K+ae},{width:Q,height:1}),co.copy(O.data,I,{x:Q-1,y:0},{x:Z-1,y:K},{width:1,height:ae}),co.copy(O.data,I,{x:0,y:0},{x:Z+Q,y:K},{width:1,height:ae})}this.image=I,this.iconPositions=d,this.patternPositions=g}addImages(i,c,d){for(const g in i){const b=i[g],w={x:0,y:0,w:b.data.width+2*ji,h:b.data.height+2*ji};d.push(w),c[g]=new zp(w,b),b.hasRenderCallback&&this.haveRenderCallbacks.push(g)}}patchUpdatedImages(i,c){i.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const d in i.updatedImages)this.patchUpdatedImage(this.iconPositions[d],i.getImage(d),c),this.patchUpdatedImage(this.patternPositions[d],i.getImage(d),c)}patchUpdatedImage(i,c,d){if(!i||!c||i.version===c.version)return;i.version=c.version;const[g,b]=i.tl;d.update(c.data,void 0,{x:g,y:b})}}var ta;At("ImagePosition",zp),At("ImageAtlas",X_),f.ah=void 0,(ta=f.ah||(f.ah={}))[ta.none=0]="none",ta[ta.horizontal=1]="horizontal",ta[ta.vertical=2]="vertical",ta[ta.horizontalOnly=3]="horizontalOnly";const Au=-17;class Lu{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(i,c){const d=new Lu;return d.scale=i||1,d.fontStack=c,d}static forImage(i){const c=new Lu;return c.imageName=i,c}}class tc{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(i,c){const d=new tc;for(let g=0;g<i.sections.length;g++){const b=i.sections[g];b.image?d.addImageSection(b):d.addTextSection(b,c)}return d}length(){return this.text.length}getSection(i){return this.sections[this.sectionIndex[i]]}getSectionIndex(i){return this.sectionIndex[i]}getCharCode(i){return this.text.charCodeAt(i)}verticalizePunctuation(){this.text=function(i){let c="";for(let d=0;d<i.length;d++){const g=i.charCodeAt(d+1)||null,b=i.charCodeAt(d-1)||null;c+=g&&iu(g)&&!Iu[i[d+1]]||b&&iu(b)&&!Iu[i[d-1]]||!Iu[i[d]]?i[d]:Iu[i[d]]}return c}(this.text)}trim(){let i=0;for(let d=0;d<this.text.length&&Pf[this.text.charCodeAt(d)];d++)i++;let c=this.text.length;for(let d=this.text.length-1;d>=0&&d>=i&&Pf[this.text.charCodeAt(d)];d--)c--;this.text=this.text.substring(i,c),this.sectionIndex=this.sectionIndex.slice(i,c)}substring(i,c){const d=new tc;return d.text=this.text.substring(i,c),d.sectionIndex=this.sectionIndex.slice(i,c),d.sections=this.sections,d}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((i,c)=>Math.max(i,this.sections[c].scale),0)}addTextSection(i,c){this.text+=i.text,this.sections.push(Lu.forText(i.scale,i.fontStack||c));const d=this.sections.length-1;for(let g=0;g<i.text.length;++g)this.sectionIndex.push(d)}addImageSection(i){const c=i.image?i.image.name:"";if(c.length===0)return void He("Can't add FormattedSection with an empty image.");const d=this.getNextImageSectionCharCode();d?(this.text+=String.fromCharCode(d),this.sections.push(Lu.forImage(c)),this.sectionIndex.push(this.sections.length-1)):He("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Lf(s,i,c,d,g,b,w,T,I,L,O,j,Z,K,Q,ae){const _e=tc.fromFeature(s,g);let xe;j===f.ah.vertical&&_e.verticalizePunctuation();const{processBidirectionalText:Re,processStyledBidirectionalText:ke}=ts;if(Re&&_e.sections.length===1){xe=[];const et=Re(_e.toString(),Dp(_e,L,b,i,d,K,Q));for(const Tt of et){const Rt=new tc;Rt.text=Tt,Rt.sections=_e.sections;for(let kt=0;kt<Tt.length;kt++)Rt.sectionIndex.push(0);xe.push(Rt)}}else if(ke){xe=[];const et=ke(_e.text,_e.sectionIndex,Dp(_e,L,b,i,d,K,Q));for(const Tt of et){const Rt=new tc;Rt.text=Tt[0],Rt.sectionIndex=Tt[1],Rt.sections=_e.sections,xe.push(Rt)}}else xe=function(et,Tt){const Rt=[],kt=et.text;let bt=0;for(const dt of Tt)Rt.push(et.substring(bt,dt)),bt=dt;return bt<kt.length&&Rt.push(et.substring(bt,kt.length)),Rt}(_e,Dp(_e,L,b,i,d,K,Q));const Ae=[],Ye={positionedLines:Ae,text:_e.toString(),top:O[1],bottom:O[1],left:O[0],right:O[0],writingMode:j,iconsInText:!1,verticalizable:!1};return function(et,Tt,Rt,kt,bt,dt,Pt,vt,st,qt,Bt,mr){let Xr=0,tn=Au,Un=0,Qi=0;const Ci=vt==="right"?1:vt==="left"?0:.5;let Rn=0;for(const Vn of bt){Vn.trim();const $n=Vn.getMaxScale(),gi=($n-1)*jn,Ai={positionedGlyphs:[],lineOffset:0};et.positionedLines[Rn]=Ai;const _i=Ai.positionedGlyphs;let Ui=0;if(!Vn.length()){tn+=dt,++Rn;continue}for(let qn=0;qn<Vn.length();qn++){const yr=Vn.getSection(qn),yi=Vn.getSectionIndex(qn),ci=Vn.getCharCode(qn);let Gn=0,ko=null,jo=null,Uo=null,Es=jn;const To=!(st===f.ah.horizontal||!Bt&&!Bl(ci)||Bt&&(Pf[ci]||(Qn=ci,St.Arabic(Qn)||St["Arabic Supplement"](Qn)||St["Arabic Extended-A"](Qn)||St["Arabic Presentation Forms-A"](Qn)||St["Arabic Presentation Forms-B"](Qn))));if(yr.imageName){const ho=kt[yr.imageName];if(!ho)continue;Uo=yr.imageName,et.iconsInText=et.iconsInText||!0,jo=ho.paddedRect;const $i=ho.displaySize;yr.scale=yr.scale*jn/mr,ko={width:$i[0],height:$i[1],left:ji,top:-Z_,advance:To?$i[1]:$i[0]},Gn=gi+(jn-$i[1]*yr.scale),Es=ko.advance;const Cs=To?$i[0]*yr.scale-jn*$n:$i[1]*yr.scale-jn*$n;Cs>0&&Cs>Ui&&(Ui=Cs)}else{const ho=Rt[yr.fontStack],$i=ho&&ho[ci];if($i&&$i.rect)jo=$i.rect,ko=$i.metrics;else{const Cs=Tt[yr.fontStack],Bu=Cs&&Cs[ci];if(!Bu)continue;ko=Bu.metrics}Gn=($n-yr.scale)*jn}To?(et.verticalizable=!0,_i.push({glyph:ci,imageName:Uo,x:Xr,y:tn+Gn,vertical:To,scale:yr.scale,fontStack:yr.fontStack,sectionIndex:yi,metrics:ko,rect:jo}),Xr+=Es*yr.scale+qt):(_i.push({glyph:ci,imageName:Uo,x:Xr,y:tn+Gn,vertical:To,scale:yr.scale,fontStack:yr.fontStack,sectionIndex:yi,metrics:ko,rect:jo}),Xr+=ko.advance*yr.scale+qt)}_i.length!==0&&(Un=Math.max(Xr-qt,Un),oS(_i,0,_i.length-1,Ci,Ui)),Xr=0;const Vi=dt*$n+Ui;Ai.lineOffset=Math.max(Ui,gi),tn+=Vi,Qi=Math.max(Vi,Qi),++Rn}var Qn;const li=tn-Au,{horizontalAlign:Mi,verticalAlign:Ii}=Rp(Pt);(function(Vn,$n,gi,Ai,_i,Ui,Vi,qn,yr){const yi=($n-gi)*_i;let ci=0;ci=Ui!==Vi?-qn*Ai-Au:(-Ai*yr+.5)*Vi;for(const Gn of Vn)for(const ko of Gn.positionedGlyphs)ko.x+=yi,ko.y+=ci})(et.positionedLines,Ci,Mi,Ii,Un,Qi,dt,li,bt.length),et.top+=-Ii*li,et.bottom=et.top+li,et.left+=-Mi*Un,et.right=et.left+Un}(Ye,i,c,d,xe,w,T,I,j,L,Z,ae),!function(et){for(const Tt of et)if(Tt.positionedGlyphs.length!==0)return!1;return!0}(Ae)&&Ye}const Pf={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},nS={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function K_(s,i,c,d,g,b){if(i.imageName){const w=d[i.imageName];return w?w.displaySize[0]*i.scale*jn/b+g:0}{const w=c[i.fontStack],T=w&&w[s];return T?T.metrics.advance*i.scale+g:0}}function J_(s,i,c,d){const g=Math.pow(s-i,2);return d?s<i?g/2:2*g:g+Math.abs(c)*c}function iS(s,i,c){let d=0;return s===10&&(d-=1e4),c&&(d+=150),s!==40&&s!==65288||(d+=50),i!==41&&i!==65289||(d+=50),d}function Y_(s,i,c,d,g,b){let w=null,T=J_(i,c,g,b);for(const I of d){const L=J_(i-I.x,c,g,b)+I.badness;L<=T&&(w=I,T=L)}return{index:s,x:i,priorBreak:w,badness:T}}function Q_(s){return s?Q_(s.priorBreak).concat(s.index):[]}function Dp(s,i,c,d,g,b,w){if(b!=="point")return[];if(!s)return[];const T=[],I=function(Z,K,Q,ae,_e,xe){let Re=0;for(let ke=0;ke<Z.length();ke++){const Ae=Z.getSection(ke);Re+=K_(Z.getCharCode(ke),Ae,ae,_e,K,xe)}return Re/Math.max(1,Math.ceil(Re/Q))}(s,i,c,d,g,w),L=s.text.indexOf("")>=0;let O=0;for(let Z=0;Z<s.length();Z++){const K=s.getSection(Z),Q=s.getCharCode(Z);if(Pf[Q]||(O+=K_(Q,K,d,g,i,w)),Z<s.length()-1){const ae=!((j=Q)<11904||!(St["Bopomofo Extended"](j)||St.Bopomofo(j)||St["CJK Compatibility Forms"](j)||St["CJK Compatibility Ideographs"](j)||St["CJK Compatibility"](j)||St["CJK Radicals Supplement"](j)||St["CJK Strokes"](j)||St["CJK Symbols and Punctuation"](j)||St["CJK Unified Ideographs Extension A"](j)||St["CJK Unified Ideographs"](j)||St["Enclosed CJK Letters and Months"](j)||St["Halfwidth and Fullwidth Forms"](j)||St.Hiragana(j)||St["Ideographic Description Characters"](j)||St["Kangxi Radicals"](j)||St["Katakana Phonetic Extensions"](j)||St.Katakana(j)||St["Vertical Forms"](j)||St["Yi Radicals"](j)||St["Yi Syllables"](j)));(nS[Q]||ae||K.imageName)&&T.push(Y_(Z+1,O,I,T,iS(Q,s.getCharCode(Z+1),ae&&L),!1))}}var j;return Q_(Y_(s.length(),O,I,T,0,!0))}function Rp(s){let i=.5,c=.5;switch(s){case"right":case"top-right":case"bottom-right":i=1;break;case"left":case"top-left":case"bottom-left":i=0}switch(s){case"bottom":case"bottom-right":case"bottom-left":c=1;break;case"top":case"top-right":case"top-left":c=0}return{horizontalAlign:i,verticalAlign:c}}function oS(s,i,c,d,g){if(!d&&!g)return;const b=s[c],w=(s[c].x+b.metrics.advance*b.scale)*d;for(let T=i;T<=c;T++)s[T].x-=w,s[T].y+=g}function sS(s,i,c){const{horizontalAlign:d,verticalAlign:g}=Rp(c),b=i[0]-s.displaySize[0]*d,w=i[1]-s.displaySize[1]*g;return{image:s,top:w,bottom:w+s.displaySize[1],left:b,right:b+s.displaySize[0]}}function ey(s,i,c,d,g,b){const w=s.image;let T;if(w.content){const _e=w.content,xe=w.pixelRatio||1;T=[_e[0]/xe,_e[1]/xe,w.displaySize[0]-_e[2]/xe,w.displaySize[1]-_e[3]/xe]}const I=i.left*b,L=i.right*b;let O,j,Z,K;c==="width"||c==="both"?(K=g[0]+I-d[3],j=g[0]+L+d[1]):(K=g[0]+(I+L-w.displaySize[0])/2,j=K+w.displaySize[0]);const Q=i.top*b,ae=i.bottom*b;return c==="height"||c==="both"?(O=g[1]+Q-d[0],Z=g[1]+ae+d[2]):(O=g[1]+(Q+ae-w.displaySize[1])/2,Z=O+w.displaySize[1]),{image:w,top:O,right:j,bottom:Z,left:K,collisionPadding:T}}const Pu=255,os=128,ra=Pu*os;function ty(s,i){const{expression:c}=i;if(c.kind==="constant")return{kind:"constant",layoutSize:c.evaluate(new Qr(s+1))};if(c.kind==="source")return{kind:"source"};{const{zoomStops:d,interpolationType:g}=c;let b=0;for(;b<d.length&&d[b]<=s;)b++;b=Math.max(0,b-1);let w=b;for(;w<d.length&&d[w]<s+1;)w++;w=Math.min(d.length-1,w);const T=d[b],I=d[w];return c.kind==="composite"?{kind:"composite",minZoom:T,maxZoom:I,interpolationType:g}:{kind:"camera",minZoom:T,maxZoom:I,minSize:c.evaluate(new Qr(T)),maxSize:c.evaluate(new Qr(I)),interpolationType:g}}}function Bp(s,i,c){let d="never";const g=s.get(i);return g?d=g:s.get(c)&&(d="always"),d}const aS=ea.VectorTileFeature.types,lS=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function zf(s,i,c,d,g,b,w,T,I,L,O,j,Z){const K=T?Math.min(ra,Math.round(T[0])):0,Q=T?Math.min(ra,Math.round(T[1])):0;s.emplaceBack(i,c,Math.round(32*d),Math.round(32*g),b,w,(K<<1)+(I?1:0),Q,16*L,16*O,256*j,256*Z)}function Fp(s,i,c){s.emplaceBack(i.x,i.y,c),s.emplaceBack(i.x,i.y,c),s.emplaceBack(i.x,i.y,c),s.emplaceBack(i.x,i.y,c)}function cS(s){for(const i of s.sections)if(pp(i.text))return!0;return!1}class Op{constructor(i){this.layoutVertexArray=new $e,this.indexArray=new Xe,this.programConfigurations=i,this.segments=new gt,this.dynamicLayoutVertexArray=new we,this.opacityVertexArray=new Le,this.hasVisibleVertices=!1,this.placedSymbolArray=new h}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(i,c,d,g){this.isEmpty()||(d&&(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,j2.members),this.indexBuffer=i.createIndexBuffer(this.indexArray,c),this.dynamicLayoutVertexBuffer=i.createVertexBuffer(this.dynamicLayoutVertexArray,U2.members,!0),this.opacityVertexBuffer=i.createVertexBuffer(this.opacityVertexArray,lS,!0),this.opacityVertexBuffer.itemSize=1),(d||g)&&this.programConfigurations.upload(i))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}At("SymbolBuffers",Op);class Np{constructor(i,c,d){this.layoutVertexArray=new i,this.layoutAttributes=c,this.indexArray=new d,this.segments=new gt,this.collisionVertexArray=new Ze}upload(i){this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=i.createVertexBuffer(this.collisionVertexArray,V2.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}At("CollisionBuffers",Np);class rc{constructor(i){this.collisionBoxArray=i.collisionBoxArray,this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(w=>w.id),this.index=i.index,this.pixelRatio=i.pixelRatio,this.sourceLayerIndex=i.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=gp([]),this.placementViewportMatrix=gp([]);const c=this.layers[0]._unevaluatedLayout._values;this.textSizeData=ty(this.zoom,c["text-size"]),this.iconSizeData=ty(this.zoom,c["icon-size"]);const d=this.layers[0].layout,g=d.get("symbol-sort-key"),b=d.get("symbol-z-order");this.canOverlap=Bp(d,"text-overlap","text-allow-overlap")!=="never"||Bp(d,"icon-overlap","icon-allow-overlap")!=="never"||d.get("text-ignore-placement")||d.get("icon-ignore-placement"),this.sortFeaturesByKey=b!=="viewport-y"&&!g.isConstant(),this.sortFeaturesByY=(b==="viewport-y"||b==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,d.get("symbol-placement")==="point"&&(this.writingModes=d.get("text-writing-mode").map(w=>f.ah[w])),this.stateDependentLayerIds=this.layers.filter(w=>w.isStateDependent()).map(w=>w.id),this.sourceID=i.sourceID}createArrays(){this.text=new Op(new ln(this.layers,this.zoom,i=>/^text/.test(i))),this.icon=new Op(new ln(this.layers,this.zoom,i=>/^icon/.test(i))),this.glyphOffsetArray=new v,this.lineVertexArray=new E,this.symbolInstances=new m,this.textAnchorOffsets=new A}calculateGlyphDependencies(i,c,d,g,b){for(let w=0;w<i.length;w++)if(c[i.charCodeAt(w)]=!0,(d||g)&&b){const T=Iu[i.charAt(w)];T&&(c[T.charCodeAt(0)]=!0)}}populate(i,c,d){const g=this.layers[0],b=g.layout,w=b.get("text-font"),T=b.get("text-field"),I=b.get("icon-image"),L=(T.value.kind!=="constant"||T.value.value instanceof Ri&&!T.value.value.isEmpty()||T.value.value.toString().length>0)&&(w.value.kind!=="constant"||w.value.value.length>0),O=I.value.kind!=="constant"||!!I.value.value||Object.keys(I.parameters).length>0,j=b.get("symbol-sort-key");if(this.features=[],!L&&!O)return;const Z=c.iconDependencies,K=c.glyphDependencies,Q=c.availableImages,ae=new Qr(this.zoom);for(const{feature:_e,id:xe,index:Re,sourceLayerIndex:ke}of i){const Ae=g._featureFilter.needGeometry,Ye=ks(_e,Ae);if(!g._featureFilter.filter(ae,Ye,d))continue;let et,Tt;if(Ae||(Ye.geometry=Ss(_e)),L){const kt=g.getValueAndResolveTokens("text-field",Ye,d,Q),bt=Ri.factory(kt),dt=this.hasRTLText=this.hasRTLText||cS(bt);(!dt||ts.getRTLTextPluginStatus()==="unavailable"||dt&&ts.isParsed())&&(et=q2(bt,g,Ye))}if(O){const kt=g.getValueAndResolveTokens("icon-image",Ye,d,Q);Tt=kt instanceof Ki?kt:Ki.fromString(kt)}if(!et&&!Tt)continue;const Rt=this.sortFeaturesByKey?j.evaluate(Ye,{},d):void 0;if(this.features.push({id:xe,text:et,icon:Tt,index:Re,sourceLayerIndex:ke,geometry:Ye.geometry,properties:_e.properties,type:aS[_e.type],sortKey:Rt}),Tt&&(Z[Tt.name]=!0),et){const kt=w.evaluate(Ye,{},d).join(","),bt=b.get("text-rotation-alignment")!=="viewport"&&b.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(f.ah.vertical)>=0;for(const dt of et.sections)if(dt.image)Z[dt.image.name]=!0;else{const Pt=Ys(et.toString()),vt=dt.fontStack||kt,st=K[vt]=K[vt]||{};this.calculateGlyphDependencies(dt.text,st,bt,this.allowVerticalPlacement,Pt)}}}b.get("symbol-placement")==="line"&&(this.features=function(_e){const xe={},Re={},ke=[];let Ae=0;function Ye(kt){ke.push(_e[kt]),Ae++}function et(kt,bt,dt){const Pt=Re[kt];return delete Re[kt],Re[bt]=Pt,ke[Pt].geometry[0].pop(),ke[Pt].geometry[0]=ke[Pt].geometry[0].concat(dt[0]),Pt}function Tt(kt,bt,dt){const Pt=xe[bt];return delete xe[bt],xe[kt]=Pt,ke[Pt].geometry[0].shift(),ke[Pt].geometry[0]=dt[0].concat(ke[Pt].geometry[0]),Pt}function Rt(kt,bt,dt){const Pt=dt?bt[0][bt[0].length-1]:bt[0][0];return`${kt}:${Pt.x}:${Pt.y}`}for(let kt=0;kt<_e.length;kt++){const bt=_e[kt],dt=bt.geometry,Pt=bt.text?bt.text.toString():null;if(!Pt){Ye(kt);continue}const vt=Rt(Pt,dt),st=Rt(Pt,dt,!0);if(vt in Re&&st in xe&&Re[vt]!==xe[st]){const qt=Tt(vt,st,dt),Bt=et(vt,st,ke[qt].geometry);delete xe[vt],delete Re[st],Re[Rt(Pt,ke[Bt].geometry,!0)]=Bt,ke[qt].geometry=null}else vt in Re?et(vt,st,dt):st in xe?Tt(vt,st,dt):(Ye(kt),xe[vt]=Ae-1,Re[st]=Ae-1)}return ke.filter(kt=>kt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((_e,xe)=>_e.sortKey-xe.sortKey)}update(i,c,d){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(i,c,this.layers,d),this.icon.programConfigurations.updatePaintArrays(i,c,this.layers,d))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(i){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(i),this.iconCollisionBox.upload(i)),this.text.upload(i,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(i,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(i,c){const d=this.lineVertexArray.length;if(i.segment!==void 0){let g=i.dist(c[i.segment+1]),b=i.dist(c[i.segment]);const w={};for(let T=i.segment+1;T<c.length;T++)w[T]={x:c[T].x,y:c[T].y,tileUnitDistanceFromAnchor:g},T<c.length-1&&(g+=c[T+1].dist(c[T]));for(let T=i.segment||0;T>=0;T--)w[T]={x:c[T].x,y:c[T].y,tileUnitDistanceFromAnchor:b},T>0&&(b+=c[T-1].dist(c[T]));for(let T=0;T<c.length;T++){const I=w[T];this.lineVertexArray.emplaceBack(I.x,I.y,I.tileUnitDistanceFromAnchor)}}return{lineStartIndex:d,lineLength:this.lineVertexArray.length-d}}addSymbols(i,c,d,g,b,w,T,I,L,O,j,Z){const K=i.indexArray,Q=i.layoutVertexArray,ae=i.segments.prepareSegment(4*c.length,Q,K,this.canOverlap?w.sortKey:void 0),_e=this.glyphOffsetArray.length,xe=ae.vertexLength,Re=this.allowVerticalPlacement&&T===f.ah.vertical?Math.PI/2:0,ke=w.text&&w.text.sections;for(let Ae=0;Ae<c.length;Ae++){const{tl:Ye,tr:et,bl:Tt,br:Rt,tex:kt,pixelOffsetTL:bt,pixelOffsetBR:dt,minFontScaleX:Pt,minFontScaleY:vt,glyphOffset:st,isSDF:qt,sectionIndex:Bt}=c[Ae],mr=ae.vertexLength,Xr=st[1];zf(Q,I.x,I.y,Ye.x,Xr+Ye.y,kt.x,kt.y,d,qt,bt.x,bt.y,Pt,vt),zf(Q,I.x,I.y,et.x,Xr+et.y,kt.x+kt.w,kt.y,d,qt,dt.x,bt.y,Pt,vt),zf(Q,I.x,I.y,Tt.x,Xr+Tt.y,kt.x,kt.y+kt.h,d,qt,bt.x,dt.y,Pt,vt),zf(Q,I.x,I.y,Rt.x,Xr+Rt.y,kt.x+kt.w,kt.y+kt.h,d,qt,dt.x,dt.y,Pt,vt),Fp(i.dynamicLayoutVertexArray,I,Re),K.emplaceBack(mr,mr+1,mr+2),K.emplaceBack(mr+1,mr+2,mr+3),ae.vertexLength+=4,ae.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(st[0]),Ae!==c.length-1&&Bt===c[Ae+1].sectionIndex||i.programConfigurations.populatePaintArrays(Q.length,w,w.index,{},Z,ke&&ke[Bt])}i.placedSymbolArray.emplaceBack(I.x,I.y,_e,this.glyphOffsetArray.length-_e,xe,L,O,I.segment,d?d[0]:0,d?d[1]:0,g[0],g[1],T,0,!1,0,j)}_addCollisionDebugVertex(i,c,d,g,b,w){return c.emplaceBack(0,0),i.emplaceBack(d.x,d.y,g,b,Math.round(w.x),Math.round(w.y))}addCollisionDebugVertices(i,c,d,g,b,w,T){const I=b.segments.prepareSegment(4,b.layoutVertexArray,b.indexArray),L=I.vertexLength,O=b.layoutVertexArray,j=b.collisionVertexArray,Z=T.anchorX,K=T.anchorY;this._addCollisionDebugVertex(O,j,w,Z,K,new S(i,c)),this._addCollisionDebugVertex(O,j,w,Z,K,new S(d,c)),this._addCollisionDebugVertex(O,j,w,Z,K,new S(d,g)),this._addCollisionDebugVertex(O,j,w,Z,K,new S(i,g)),I.vertexLength+=4;const Q=b.indexArray;Q.emplaceBack(L,L+1),Q.emplaceBack(L+1,L+2),Q.emplaceBack(L+2,L+3),Q.emplaceBack(L+3,L),I.primitiveLength+=4}addDebugCollisionBoxes(i,c,d,g){for(let b=i;b<c;b++){const w=this.collisionBoxArray.get(b);this.addCollisionDebugVertices(w.x1,w.y1,w.x2,w.y2,g?this.textCollisionBox:this.iconCollisionBox,w.anchorPoint,d)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Np(Ge,N_.members,nt),this.iconCollisionBox=new Np(Ge,N_.members,nt);for(let i=0;i<this.symbolInstances.length;i++){const c=this.symbolInstances.get(i);this.addDebugCollisionBoxes(c.textBoxStartIndex,c.textBoxEndIndex,c,!0),this.addDebugCollisionBoxes(c.verticalTextBoxStartIndex,c.verticalTextBoxEndIndex,c,!0),this.addDebugCollisionBoxes(c.iconBoxStartIndex,c.iconBoxEndIndex,c,!1),this.addDebugCollisionBoxes(c.verticalIconBoxStartIndex,c.verticalIconBoxEndIndex,c,!1)}}_deserializeCollisionBoxesForSymbol(i,c,d,g,b,w,T,I,L){const O={};for(let j=c;j<d;j++){const Z=i.get(j);O.textBox={x1:Z.x1,y1:Z.y1,x2:Z.x2,y2:Z.y2,anchorPointX:Z.anchorPointX,anchorPointY:Z.anchorPointY},O.textFeatureIndex=Z.featureIndex;break}for(let j=g;j<b;j++){const Z=i.get(j);O.verticalTextBox={x1:Z.x1,y1:Z.y1,x2:Z.x2,y2:Z.y2,anchorPointX:Z.anchorPointX,anchorPointY:Z.anchorPointY},O.verticalTextFeatureIndex=Z.featureIndex;break}for(let j=w;j<T;j++){const Z=i.get(j);O.iconBox={x1:Z.x1,y1:Z.y1,x2:Z.x2,y2:Z.y2,anchorPointX:Z.anchorPointX,anchorPointY:Z.anchorPointY},O.iconFeatureIndex=Z.featureIndex;break}for(let j=I;j<L;j++){const Z=i.get(j);O.verticalIconBox={x1:Z.x1,y1:Z.y1,x2:Z.x2,y2:Z.y2,anchorPointX:Z.anchorPointX,anchorPointY:Z.anchorPointY},O.verticalIconFeatureIndex=Z.featureIndex;break}return O}deserializeCollisionBoxes(i){this.collisionArrays=[];for(let c=0;c<this.symbolInstances.length;c++){const d=this.symbolInstances.get(c);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(i,d.textBoxStartIndex,d.textBoxEndIndex,d.verticalTextBoxStartIndex,d.verticalTextBoxEndIndex,d.iconBoxStartIndex,d.iconBoxEndIndex,d.verticalIconBoxStartIndex,d.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(i,c){const d=i.placedSymbolArray.get(c),g=d.vertexStartIndex+4*d.numGlyphs;for(let b=d.vertexStartIndex;b<g;b+=4)i.indexArray.emplaceBack(b,b+1,b+2),i.indexArray.emplaceBack(b+1,b+2,b+3)}getSortedSymbolIndexes(i){if(this.sortedAngle===i&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const c=Math.sin(i),d=Math.cos(i),g=[],b=[],w=[];for(let T=0;T<this.symbolInstances.length;++T){w.push(T);const I=this.symbolInstances.get(T);g.push(0|Math.round(c*I.anchorX+d*I.anchorY)),b.push(I.featureIndex)}return w.sort((T,I)=>g[T]-g[I]||b[I]-b[T]),w}addToSortKeyRanges(i,c){const d=this.sortKeyRanges[this.sortKeyRanges.length-1];d&&d.sortKey===c?d.symbolInstanceEnd=i+1:this.sortKeyRanges.push({sortKey:c,symbolInstanceStart:i,symbolInstanceEnd:i+1})}sortFeatures(i){if(this.sortFeaturesByY&&this.sortedAngle!==i&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(i),this.sortedAngle=i,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const c of this.symbolInstanceIndexes){const d=this.symbolInstances.get(c);this.featureSortOrder.push(d.featureIndex),[d.rightJustifiedTextSymbolIndex,d.centerJustifiedTextSymbolIndex,d.leftJustifiedTextSymbolIndex].forEach((g,b,w)=>{g>=0&&w.indexOf(g)===b&&this.addIndicesForPlacedSymbol(this.text,g)}),d.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,d.verticalPlacedTextSymbolIndex),d.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,d.placedIconSymbolIndex),d.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,d.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let ry,ny;At("SymbolBucket",rc,{omit:["layers","collisionBoxArray","features","compareText"]}),rc.MAX_GLYPHS=65535,rc.addDynamicAttributes=Fp;var jp={get paint(){return ny=ny||new Ti({"icon-opacity":new Gt(ie.paint_symbol["icon-opacity"]),"icon-color":new Gt(ie.paint_symbol["icon-color"]),"icon-halo-color":new Gt(ie.paint_symbol["icon-halo-color"]),"icon-halo-width":new Gt(ie.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Gt(ie.paint_symbol["icon-halo-blur"]),"icon-translate":new Nt(ie.paint_symbol["icon-translate"]),"icon-translate-anchor":new Nt(ie.paint_symbol["icon-translate-anchor"]),"text-opacity":new Gt(ie.paint_symbol["text-opacity"]),"text-color":new Gt(ie.paint_symbol["text-color"],{runtimeType:jr,getOverride:s=>s.textColor,hasOverride:s=>!!s.textColor}),"text-halo-color":new Gt(ie.paint_symbol["text-halo-color"]),"text-halo-width":new Gt(ie.paint_symbol["text-halo-width"]),"text-halo-blur":new Gt(ie.paint_symbol["text-halo-blur"]),"text-translate":new Nt(ie.paint_symbol["text-translate"]),"text-translate-anchor":new Nt(ie.paint_symbol["text-translate-anchor"])})},get layout(){return ry=ry||new Ti({"symbol-placement":new Nt(ie.layout_symbol["symbol-placement"]),"symbol-spacing":new Nt(ie.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Nt(ie.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Gt(ie.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Nt(ie.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Nt(ie.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Nt(ie.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Nt(ie.layout_symbol["icon-ignore-placement"]),"icon-optional":new Nt(ie.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Nt(ie.layout_symbol["icon-rotation-alignment"]),"icon-size":new Gt(ie.layout_symbol["icon-size"]),"icon-text-fit":new Nt(ie.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Nt(ie.layout_symbol["icon-text-fit-padding"]),"icon-image":new Gt(ie.layout_symbol["icon-image"]),"icon-rotate":new Gt(ie.layout_symbol["icon-rotate"]),"icon-padding":new Gt(ie.layout_symbol["icon-padding"]),"icon-keep-upright":new Nt(ie.layout_symbol["icon-keep-upright"]),"icon-offset":new Gt(ie.layout_symbol["icon-offset"]),"icon-anchor":new Gt(ie.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Nt(ie.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Nt(ie.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Nt(ie.layout_symbol["text-rotation-alignment"]),"text-field":new Gt(ie.layout_symbol["text-field"]),"text-font":new Gt(ie.layout_symbol["text-font"]),"text-size":new Gt(ie.layout_symbol["text-size"]),"text-max-width":new Gt(ie.layout_symbol["text-max-width"]),"text-line-height":new Nt(ie.layout_symbol["text-line-height"]),"text-letter-spacing":new Gt(ie.layout_symbol["text-letter-spacing"]),"text-justify":new Gt(ie.layout_symbol["text-justify"]),"text-radial-offset":new Gt(ie.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Nt(ie.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Gt(ie.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Gt(ie.layout_symbol["text-anchor"]),"text-max-angle":new Nt(ie.layout_symbol["text-max-angle"]),"text-writing-mode":new Nt(ie.layout_symbol["text-writing-mode"]),"text-rotate":new Gt(ie.layout_symbol["text-rotate"]),"text-padding":new Nt(ie.layout_symbol["text-padding"]),"text-keep-upright":new Nt(ie.layout_symbol["text-keep-upright"]),"text-transform":new Gt(ie.layout_symbol["text-transform"]),"text-offset":new Gt(ie.layout_symbol["text-offset"]),"text-allow-overlap":new Nt(ie.layout_symbol["text-allow-overlap"]),"text-overlap":new Nt(ie.layout_symbol["text-overlap"]),"text-ignore-placement":new Nt(ie.layout_symbol["text-ignore-placement"]),"text-optional":new Nt(ie.layout_symbol["text-optional"])})}};class iy{constructor(i){if(i.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=i.property.overrides?i.property.overrides.runtimeType:Nr,this.defaultValue=i}evaluate(i){if(i.formattedSection){const c=this.defaultValue.property.overrides;if(c&&c.hasOverride(i.formattedSection))return c.getOverride(i.formattedSection)}return i.feature&&i.featureState?this.defaultValue.evaluate(i.feature,i.featureState):this.defaultValue.property.specification.default}eachChild(i){this.defaultValue.isConstant()||i(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}At("FormatSectionOverride",iy,{omit:["defaultValue"]});class Df extends lo{constructor(i){super(i,jp)}recalculate(i,c){if(super.recalculate(i,c),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const d=this.layout.get("text-writing-mode");if(d){const g=[];for(const b of d)g.indexOf(b)<0&&g.push(b);this.layout._values["text-writing-mode"]=g}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(i,c,d,g){const b=this.layout.get(i).evaluate(c,{},d,g),w=this._unevaluatedLayout._values[i];return w.isDataDriven()||Ur(w.value)||!b?b:function(T,I){return I.replace(/{([^{}]+)}/g,(L,O)=>T&&O in T?String(T[O]):"")}(c.properties,b)}createBucket(i){return new rc(i)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const i of jp.paint.overridableProperties){if(!Df.hasPaintOverride(this.layout,i))continue;const c=this.paint.get(i),d=new iy(c),g=new Hr(d,c.property.specification);let b=null;b=c.value.kind==="constant"||c.value.kind==="source"?new Tl("source",g):new Xc("composite",g,c.value.zoomStops),this.paint._values[i]=new ao(c.property,b,c.parameters)}}_handleOverridablePaintPropertyUpdate(i,c,d){return!(!this.layout||c.isDataDriven()||d.isDataDriven())&&Df.hasPaintOverride(this.layout,i)}static hasPaintOverride(i,c){const d=i.get("text-field"),g=jp.paint.properties[c];let b=!1;const w=T=>{for(const I of T)if(g.overrides&&g.overrides.hasOverride(I))return void(b=!0)};if(d.value.kind==="constant"&&d.value.value instanceof Ri)w(d.value.value.sections);else if(d.value.kind==="source"){const T=L=>{b||(L instanceof Ko&&Ln(L.value)===cn?w(L.value.sections):L instanceof Sl?w(L.sections):L.eachChild(T))},I=d.value;I._styleExpression&&T(I._styleExpression.expression)}return b}}let oy;var uS={get paint(){return oy=oy||new Ti({"background-color":new Nt(ie.paint_background["background-color"]),"background-pattern":new Ua(ie.paint_background["background-pattern"]),"background-opacity":new Nt(ie.paint_background["background-opacity"])})}};class hS extends lo{constructor(i){super(i,uS)}}let sy;var fS={get paint(){return sy=sy||new Ti({"raster-opacity":new Nt(ie.paint_raster["raster-opacity"]),"raster-hue-rotate":new Nt(ie.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Nt(ie.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Nt(ie.paint_raster["raster-brightness-max"]),"raster-saturation":new Nt(ie.paint_raster["raster-saturation"]),"raster-contrast":new Nt(ie.paint_raster["raster-contrast"]),"raster-resampling":new Nt(ie.paint_raster["raster-resampling"]),"raster-fade-duration":new Nt(ie.paint_raster["raster-fade-duration"])})}};class dS extends lo{constructor(i){super(i,fS)}}class pS extends lo{constructor(i){super(i,{}),this.onAdd=c=>{this.implementation.onAdd&&this.implementation.onAdd(c,c.painter.context.gl)},this.onRemove=c=>{this.implementation.onRemove&&this.implementation.onRemove(c,c.painter.context.gl)},this.implementation=i}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class mS{constructor(i){this._methodToThrottle=i,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const Up=63710088e-1;class na{constructor(i,c){if(isNaN(i)||isNaN(c))throw new Error(`Invalid LngLat object: (${i}, ${c})`);if(this.lng=+i,this.lat=+c,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new na(le(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(i){const c=Math.PI/180,d=this.lat*c,g=i.lat*c,b=Math.sin(d)*Math.sin(g)+Math.cos(d)*Math.cos(g)*Math.cos((i.lng-this.lng)*c);return Up*Math.acos(Math.min(b,1))}static convert(i){if(i instanceof na)return i;if(Array.isArray(i)&&(i.length===2||i.length===3))return new na(Number(i[0]),Number(i[1]));if(!Array.isArray(i)&&typeof i=="object"&&i!==null)return new na(Number("lng"in i?i.lng:i.lon),Number(i.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const ay=2*Math.PI*Up;function ly(s){return ay*Math.cos(s*Math.PI/180)}function cy(s){return(180+s)/360}function uy(s){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s*Math.PI/360)))/360}function hy(s,i){return s/ly(i)}function Vp(s){return 360/Math.PI*Math.atan(Math.exp((180-360*s)*Math.PI/180))-90}class Rf{constructor(i,c,d=0){this.x=+i,this.y=+c,this.z=+d}static fromLngLat(i,c=0){const d=na.convert(i);return new Rf(cy(d.lng),uy(d.lat),hy(c,d.lat))}toLngLat(){return new na(360*this.x-180,Vp(this.y))}toAltitude(){return this.z*ly(Vp(this.y))}meterInMercatorCoordinateUnits(){return 1/ay*(i=Vp(this.y),1/Math.cos(i*Math.PI/180));var i}}function fy(s,i,c){var d=2*Math.PI*6378137/256/Math.pow(2,c);return[s*d-2*Math.PI*6378137/2,i*d-2*Math.PI*6378137/2]}class $p{constructor(i,c,d){if(i<0||i>25||d<0||d>=Math.pow(2,i)||c<0||c>=Math.pow(2,i))throw new Error(`x=${c}, y=${d}, z=${i} outside of bounds. 0<=x<${Math.pow(2,i)}, 0<=y<${Math.pow(2,i)} 0<=z<=25 `);this.z=i,this.x=c,this.y=d,this.key=zu(0,i,i,c,d)}equals(i){return this.z===i.z&&this.x===i.x&&this.y===i.y}url(i,c,d){const g=(w=this.y,T=this.z,I=fy(256*(b=this.x),256*(w=Math.pow(2,T)-w-1),T),L=fy(256*(b+1),256*(w+1),T),I[0]+","+I[1]+","+L[0]+","+L[1]);var b,w,T,I,L;const O=function(j,Z,K){let Q,ae="";for(let _e=j;_e>0;_e--)Q=1<<_e-1,ae+=(Z&Q?1:0)+(K&Q?2:0);return ae}(this.z,this.x,this.y);return i[(this.x+this.y)%i.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(d==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,c>1?"@2x":"").replace(/{quadkey}/g,O).replace(/{bbox-epsg-3857}/g,g)}isChildOf(i){const c=this.z-i.z;return c>0&&i.x===this.x>>c&&i.y===this.y>>c}getTilePoint(i){const c=Math.pow(2,this.z);return new S((i.x*c-this.x)*vn,(i.y*c-this.y)*vn)}toString(){return`${this.z}/${this.x}/${this.y}`}}class dy{constructor(i,c){this.wrap=i,this.canonical=c,this.key=zu(i,c.z,c.z,c.x,c.y)}}class uo{constructor(i,c,d,g,b){if(i<d)throw new Error(`overscaledZ should be >= z; overscaledZ = ${i}; z = ${d}`);this.overscaledZ=i,this.wrap=c,this.canonical=new $p(d,+g,+b),this.key=zu(c,i,d,g,b)}clone(){return new uo(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(i){return this.overscaledZ===i.overscaledZ&&this.wrap===i.wrap&&this.canonical.equals(i.canonical)}scaledTo(i){if(i>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${i}; overscaledZ = ${this.overscaledZ}`);const c=this.canonical.z-i;return i>this.canonical.z?new uo(i,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new uo(i,this.wrap,i,this.canonical.x>>c,this.canonical.y>>c)}calculateScaledKey(i,c){if(i>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${i}; overscaledZ = ${this.overscaledZ}`);const d=this.canonical.z-i;return i>this.canonical.z?zu(this.wrap*+c,i,this.canonical.z,this.canonical.x,this.canonical.y):zu(this.wrap*+c,i,i,this.canonical.x>>d,this.canonical.y>>d)}isChildOf(i){if(i.wrap!==this.wrap)return!1;const c=this.canonical.z-i.canonical.z;return i.overscaledZ===0||i.overscaledZ<this.overscaledZ&&i.canonical.x===this.canonical.x>>c&&i.canonical.y===this.canonical.y>>c}children(i){if(this.overscaledZ>=i)return[new uo(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const c=this.canonical.z+1,d=2*this.canonical.x,g=2*this.canonical.y;return[new uo(c,this.wrap,c,d,g),new uo(c,this.wrap,c,d+1,g),new uo(c,this.wrap,c,d,g+1),new uo(c,this.wrap,c,d+1,g+1)]}isLessThan(i){return this.wrap<i.wrap||!(this.wrap>i.wrap)&&(this.overscaledZ<i.overscaledZ||!(this.overscaledZ>i.overscaledZ)&&(this.canonical.x<i.canonical.x||!(this.canonical.x>i.canonical.x)&&this.canonical.y<i.canonical.y))}wrapped(){return new uo(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(i){return new uo(this.overscaledZ,i,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new dy(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(i){return this.canonical.getTilePoint(new Rf(i.x-this.wrap,i.y))}}function zu(s,i,c,d,g){(s*=2)<0&&(s=-1*s-1);const b=1<<c;return(b*b*s+b*g+d).toString(36)+c.toString(36)+i.toString(36)}At("CanonicalTileID",$p),At("OverscaledTileID",uo,{omit:["posMatrix"]});class py{constructor(i,c,d,g=1,b=1,w=1,T=0){if(this.uid=i,c.height!==c.width)throw new RangeError("DEM tiles must be square");if(d&&!["mapbox","terrarium","custom"].includes(d))return void He(`"${d}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=c.height;const I=this.dim=c.height-2;switch(this.data=new Uint32Array(c.data.buffer),d){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=g,this.greenFactor=b,this.blueFactor=w,this.baseShift=T;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let L=0;L<I;L++)this.data[this._idx(-1,L)]=this.data[this._idx(0,L)],this.data[this._idx(I,L)]=this.data[this._idx(I-1,L)],this.data[this._idx(L,-1)]=this.data[this._idx(L,0)],this.data[this._idx(L,I)]=this.data[this._idx(L,I-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(I,-1)]=this.data[this._idx(I-1,0)],this.data[this._idx(-1,I)]=this.data[this._idx(0,I-1)],this.data[this._idx(I,I)]=this.data[this._idx(I-1,I-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let L=0;L<I;L++)for(let O=0;O<I;O++){const j=this.get(L,O);j>this.max&&(this.max=j),j<this.min&&(this.min=j)}}get(i,c){const d=new Uint8Array(this.data.buffer),g=4*this._idx(i,c);return this.unpack(d[g],d[g+1],d[g+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(i,c){if(i<-1||i>=this.dim+1||c<-1||c>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(c+1)*this.stride+(i+1)}unpack(i,c,d){return i*this.redFactor+c*this.greenFactor+d*this.blueFactor-this.baseShift}getPixels(){return new co({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(i,c,d){if(this.dim!==i.dim)throw new Error("dem dimension mismatch");let g=c*this.dim,b=c*this.dim+this.dim,w=d*this.dim,T=d*this.dim+this.dim;switch(c){case-1:g=b-1;break;case 1:b=g+1}switch(d){case-1:w=T-1;break;case 1:T=w+1}const I=-c*this.dim,L=-d*this.dim;for(let O=w;O<T;O++)for(let j=g;j<b;j++)this.data[this._idx(j,O)]=i.data[this._idx(j+I,O+L)]}}At("DEMData",py);class my{constructor(i){this._stringToNumber={},this._numberToString=[];for(let c=0;c<i.length;c++){const d=i[c];this._stringToNumber[d]=c,this._numberToString[c]=d}}encode(i){return this._stringToNumber[i]}decode(i){if(i>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${i} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[i]}}class gy{constructor(i,c,d,g,b){this.type="Feature",this._vectorTileFeature=i,i._z=c,i._x=d,i._y=g,this.properties=i.properties,this.id=b}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(i){this._geometry=i}toJSON(){const i={geometry:this.geometry};for(const c in this)c!=="_geometry"&&c!=="_vectorTileFeature"&&(i[c]=this[c]);return i}}class _y{constructor(i,c){this.tileID=i,this.x=i.canonical.x,this.y=i.canonical.y,this.z=i.canonical.z,this.grid=new Oa(vn,16,0),this.grid3D=new Oa(vn,16,0),this.featureIndexArray=new $,this.promoteId=c}insert(i,c,d,g,b,w){const T=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(d,g,b);const I=w?this.grid3D:this.grid;for(let L=0;L<c.length;L++){const O=c[L],j=[1/0,1/0,-1/0,-1/0];for(let Z=0;Z<O.length;Z++){const K=O[Z];j[0]=Math.min(j[0],K.x),j[1]=Math.min(j[1],K.y),j[2]=Math.max(j[2],K.x),j[3]=Math.max(j[3],K.y)}j[0]<vn&&j[1]<vn&&j[2]>=0&&j[3]>=0&&I.insert(T,j[0],j[1],j[2],j[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new ea.VectorTile(new Lp(this.rawTileData)).layers,this.sourceLayerCoder=new my(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(i,c,d,g){this.loadVTLayers();const b=i.params||{},w=vn/i.tileSize/i.scale,T=Il(b.filter),I=i.queryGeometry,L=i.queryPadding*w,O=vy(I),j=this.grid.query(O.minX-L,O.minY-L,O.maxX+L,O.maxY+L),Z=vy(i.cameraQueryGeometry),K=this.grid3D.query(Z.minX-L,Z.minY-L,Z.maxX+L,Z.maxY+L,(_e,xe,Re,ke)=>function(Ae,Ye,et,Tt,Rt){for(const bt of Ae)if(Ye<=bt.x&&et<=bt.y&&Tt>=bt.x&&Rt>=bt.y)return!0;const kt=[new S(Ye,et),new S(Ye,Rt),new S(Tt,Rt),new S(Tt,et)];if(Ae.length>2){for(const bt of kt)if(Xl(Ae,bt))return!0}for(let bt=0;bt<Ae.length-1;bt++)if(Zx(Ae[bt],Ae[bt+1],kt))return!0;return!1}(i.cameraQueryGeometry,_e-L,xe-L,Re+L,ke+L));for(const _e of K)j.push(_e);j.sort(gS);const Q={};let ae;for(let _e=0;_e<j.length;_e++){const xe=j[_e];if(xe===ae)continue;ae=xe;const Re=this.featureIndexArray.get(xe);let ke=null;this.loadMatchingFeature(Q,Re.bucketIndex,Re.sourceLayerIndex,Re.featureIndex,T,b.layers,b.availableImages,c,d,g,(Ae,Ye,et)=>(ke||(ke=Ss(Ae)),Ye.queryIntersectsFeature(I,Ae,et,ke,this.z,i.transform,w,i.pixelPosMatrix)))}return Q}loadMatchingFeature(i,c,d,g,b,w,T,I,L,O,j){const Z=this.bucketLayerIDs[c];if(w&&!function(_e,xe){for(let Re=0;Re<_e.length;Re++)if(xe.indexOf(_e[Re])>=0)return!0;return!1}(w,Z))return;const K=this.sourceLayerCoder.decode(d),Q=this.vtLayers[K].feature(g);if(b.needGeometry){const _e=ks(Q,!0);if(!b.filter(new Qr(this.tileID.overscaledZ),_e,this.tileID.canonical))return}else if(!b.filter(new Qr(this.tileID.overscaledZ),Q))return;const ae=this.getId(Q,K);for(let _e=0;_e<Z.length;_e++){const xe=Z[_e];if(w&&w.indexOf(xe)<0)continue;const Re=I[xe];if(!Re)continue;let ke={};ae&&O&&(ke=O.getState(Re.sourceLayer||"_geojsonTileLayer",ae));const Ae=H({},L[xe]);Ae.paint=yy(Ae.paint,Re.paint,Q,ke,T),Ae.layout=yy(Ae.layout,Re.layout,Q,ke,T);const Ye=!j||j(Q,Re,ke);if(!Ye)continue;const et=new gy(Q,this.z,this.x,this.y,ae);et.layer=Ae;let Tt=i[xe];Tt===void 0&&(Tt=i[xe]=[]),Tt.push({featureIndex:g,feature:et,intersectionZ:Ye})}}lookupSymbolFeatures(i,c,d,g,b,w,T,I){const L={};this.loadVTLayers();const O=Il(b);for(const j of i)this.loadMatchingFeature(L,d,g,j,O,w,T,I,c);return L}hasLayer(i){for(const c of this.bucketLayerIDs)for(const d of c)if(i===d)return!0;return!1}getId(i,c){let d=i.id;return this.promoteId&&(d=i.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[c]],typeof d=="boolean"&&(d=Number(d))),d}}function yy(s,i,c,d,g){return ye(s,(b,w)=>{const T=i instanceof ja?i.get(w):null;return T&&T.evaluate?T.evaluate(c,d,g):T})}function vy(s){let i=1/0,c=1/0,d=-1/0,g=-1/0;for(const b of s)i=Math.min(i,b.x),c=Math.min(c,b.y),d=Math.max(d,b.x),g=Math.max(g,b.y);return{minX:i,minY:c,maxX:d,maxY:g}}function gS(s,i){return i-s}function by(s,i,c,d,g){const b=[];for(let w=0;w<s.length;w++){const T=s[w];let I;for(let L=0;L<T.length-1;L++){let O=T[L],j=T[L+1];O.x<i&&j.x<i||(O.x<i?O=new S(i,O.y+(i-O.x)/(j.x-O.x)*(j.y-O.y))._round():j.x<i&&(j=new S(i,O.y+(i-O.x)/(j.x-O.x)*(j.y-O.y))._round()),O.y<c&&j.y<c||(O.y<c?O=new S(O.x+(c-O.y)/(j.y-O.y)*(j.x-O.x),c)._round():j.y<c&&(j=new S(O.x+(c-O.y)/(j.y-O.y)*(j.x-O.x),c)._round()),O.x>=d&&j.x>=d||(O.x>=d?O=new S(d,O.y+(d-O.x)/(j.x-O.x)*(j.y-O.y))._round():j.x>=d&&(j=new S(d,O.y+(d-O.x)/(j.x-O.x)*(j.y-O.y))._round()),O.y>=g&&j.y>=g||(O.y>=g?O=new S(O.x+(g-O.y)/(j.y-O.y)*(j.x-O.x),g)._round():j.y>=g&&(j=new S(O.x+(g-O.y)/(j.y-O.y)*(j.x-O.x),g)._round()),I&&O.equals(I[I.length-1])||(I=[O],b.push(I)),I.push(j)))))}}return b}At("FeatureIndex",_y,{omit:["rawTileData","sourceLayerCoder"]});class ia extends S{constructor(i,c,d,g){super(i,c),this.angle=d,g!==void 0&&(this.segment=g)}clone(){return new ia(this.x,this.y,this.angle,this.segment)}}function wy(s,i,c,d,g){if(i.segment===void 0||c===0)return!0;let b=i,w=i.segment+1,T=0;for(;T>-c/2;){if(w--,w<0)return!1;T-=s[w].dist(b),b=s[w]}T+=s[w].dist(s[w+1]),w++;const I=[];let L=0;for(;T<c/2;){const O=s[w],j=s[w+1];if(!j)return!1;let Z=s[w-1].angleTo(O)-O.angleTo(j);for(Z=Math.abs((Z+3*Math.PI)%(2*Math.PI)-Math.PI),I.push({distance:T,angleDelta:Z}),L+=Z;T-I[0].distance>d;)L-=I.shift().angleDelta;if(L>g)return!1;w++,T+=O.dist(j)}return!0}function xy(s){let i=0;for(let c=0;c<s.length-1;c++)i+=s[c].dist(s[c+1]);return i}function Sy(s,i,c){return s?.6*i*c:0}function ky(s,i){return Math.max(s?s.right-s.left:0,i?i.right-i.left:0)}function _S(s,i,c,d,g,b){const w=Sy(c,g,b),T=ky(c,d)*b;let I=0;const L=xy(s)/2;for(let O=0;O<s.length-1;O++){const j=s[O],Z=s[O+1],K=j.dist(Z);if(I+K>L){const Q=(L-I)/K,ae=pi.number(j.x,Z.x,Q),_e=pi.number(j.y,Z.y,Q),xe=new ia(ae,_e,Z.angleTo(j),O);return xe._round(),!w||wy(s,xe,T,w,i)?xe:void 0}I+=K}}function yS(s,i,c,d,g,b,w,T,I){const L=Sy(d,b,w),O=ky(d,g),j=O*w,Z=s[0].x===0||s[0].x===I||s[0].y===0||s[0].y===I;return i-j<i/4&&(i=j+i/4),Ty(s,Z?i/2*T%i:(O/2+2*b)*w*T%i,i,L,c,j,Z,!1,I)}function Ty(s,i,c,d,g,b,w,T,I){const L=b/2,O=xy(s);let j=0,Z=i-c,K=[];for(let Q=0;Q<s.length-1;Q++){const ae=s[Q],_e=s[Q+1],xe=ae.dist(_e),Re=_e.angleTo(ae);for(;Z+c<j+xe;){Z+=c;const ke=(Z-j)/xe,Ae=pi.number(ae.x,_e.x,ke),Ye=pi.number(ae.y,_e.y,ke);if(Ae>=0&&Ae<I&&Ye>=0&&Ye<I&&Z-L>=0&&Z+L<=O){const et=new ia(Ae,Ye,Re,Q);et._round(),d&&!wy(s,et,b,d,g)||K.push(et)}}j+=xe}return T||K.length||w||(K=Ty(s,j/2,c,d,g,b,w,!0,I)),K}At("Anchor",ia);const nc=ji;function Ey(s,i,c,d){const g=[],b=s.image,w=b.pixelRatio,T=b.paddedRect.w-2*nc,I=b.paddedRect.h-2*nc,L=s.right-s.left,O=s.bottom-s.top,j=b.stretchX||[[0,T]],Z=b.stretchY||[[0,I]],K=(dt,Pt)=>dt+Pt[1]-Pt[0],Q=j.reduce(K,0),ae=Z.reduce(K,0),_e=T-Q,xe=I-ae;let Re=0,ke=Q,Ae=0,Ye=ae,et=0,Tt=_e,Rt=0,kt=xe;if(b.content&&d){const dt=b.content;Re=Bf(j,0,dt[0]),Ae=Bf(Z,0,dt[1]),ke=Bf(j,dt[0],dt[2]),Ye=Bf(Z,dt[1],dt[3]),et=dt[0]-Re,Rt=dt[1]-Ae,Tt=dt[2]-dt[0]-ke,kt=dt[3]-dt[1]-Ye}const bt=(dt,Pt,vt,st)=>{const qt=Ff(dt.stretch-Re,ke,L,s.left),Bt=Of(dt.fixed-et,Tt,dt.stretch,Q),mr=Ff(Pt.stretch-Ae,Ye,O,s.top),Xr=Of(Pt.fixed-Rt,kt,Pt.stretch,ae),tn=Ff(vt.stretch-Re,ke,L,s.left),Un=Of(vt.fixed-et,Tt,vt.stretch,Q),Qi=Ff(st.stretch-Ae,Ye,O,s.top),Ci=Of(st.fixed-Rt,kt,st.stretch,ae),Rn=new S(qt,mr),Qn=new S(tn,mr),li=new S(tn,Qi),Mi=new S(qt,Qi),Ii=new S(Bt/w,Xr/w),Vn=new S(Un/w,Ci/w),$n=i*Math.PI/180;if($n){const _i=Math.sin($n),Ui=Math.cos($n),Vi=[Ui,-_i,_i,Ui];Rn._matMult(Vi),Qn._matMult(Vi),Mi._matMult(Vi),li._matMult(Vi)}const gi=dt.stretch+dt.fixed,Ai=Pt.stretch+Pt.fixed;return{tl:Rn,tr:Qn,bl:Mi,br:li,tex:{x:b.paddedRect.x+nc+gi,y:b.paddedRect.y+nc+Ai,w:vt.stretch+vt.fixed-gi,h:st.stretch+st.fixed-Ai},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Ii,pixelOffsetBR:Vn,minFontScaleX:Tt/w/L,minFontScaleY:kt/w/O,isSDF:c}};if(d&&(b.stretchX||b.stretchY)){const dt=Cy(j,_e,Q),Pt=Cy(Z,xe,ae);for(let vt=0;vt<dt.length-1;vt++){const st=dt[vt],qt=dt[vt+1];for(let Bt=0;Bt<Pt.length-1;Bt++)g.push(bt(st,Pt[Bt],qt,Pt[Bt+1]))}}else g.push(bt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:T+1},{fixed:0,stretch:I+1}));return g}function Bf(s,i,c){let d=0;for(const g of s)d+=Math.max(i,Math.min(c,g[1]))-Math.max(i,Math.min(c,g[0]));return d}function Cy(s,i,c){const d=[{fixed:-nc,stretch:0}];for(const[g,b]of s){const w=d[d.length-1];d.push({fixed:g-w.stretch,stretch:w.stretch}),d.push({fixed:g-w.stretch,stretch:w.stretch+(b-g)})}return d.push({fixed:i+nc,stretch:c}),d}function Ff(s,i,c,d){return s/i*c+d}function Of(s,i,c,d){return s-i*c/d}class Nf{constructor(i,c,d,g,b,w,T,I,L,O){if(this.boxStartIndex=i.length,L){let j=w.top,Z=w.bottom;const K=w.collisionPadding;K&&(j-=K[1],Z+=K[3]);let Q=Z-j;Q>0&&(Q=Math.max(10,Q),this.circleDiameter=Q)}else{let j=w.top*T-I[0],Z=w.bottom*T+I[2],K=w.left*T-I[3],Q=w.right*T+I[1];const ae=w.collisionPadding;if(ae&&(K-=ae[0]*T,j-=ae[1]*T,Q+=ae[2]*T,Z+=ae[3]*T),O){const _e=new S(K,j),xe=new S(Q,j),Re=new S(K,Z),ke=new S(Q,Z),Ae=O*Math.PI/180;_e._rotate(Ae),xe._rotate(Ae),Re._rotate(Ae),ke._rotate(Ae),K=Math.min(_e.x,xe.x,Re.x,ke.x),Q=Math.max(_e.x,xe.x,Re.x,ke.x),j=Math.min(_e.y,xe.y,Re.y,ke.y),Z=Math.max(_e.y,xe.y,Re.y,ke.y)}i.emplaceBack(c.x,c.y,K,j,Q,Z,d,g,b)}this.boxEndIndex=i.length}}class vS{constructor(i=[],c=bS){if(this.data=i,this.length=this.data.length,this.compare=c,this.length>0)for(let d=(this.length>>1)-1;d>=0;d--)this._down(d)}push(i){this.data.push(i),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const i=this.data[0],c=this.data.pop();return this.length--,this.length>0&&(this.data[0]=c,this._down(0)),i}peek(){return this.data[0]}_up(i){const{data:c,compare:d}=this,g=c[i];for(;i>0;){const b=i-1>>1,w=c[b];if(d(g,w)>=0)break;c[i]=w,i=b}c[i]=g}_down(i){const{data:c,compare:d}=this,g=this.length>>1,b=c[i];for(;i<g;){let w=1+(i<<1),T=c[w];const I=w+1;if(I<this.length&&d(c[I],T)<0&&(w=I,T=c[I]),d(T,b)>=0)break;c[i]=T,i=w}c[i]=b}}function bS(s,i){return s<i?-1:s>i?1:0}function wS(s,i=1,c=!1){let d=1/0,g=1/0,b=-1/0,w=-1/0;const T=s[0];for(let K=0;K<T.length;K++){const Q=T[K];(!K||Q.x<d)&&(d=Q.x),(!K||Q.y<g)&&(g=Q.y),(!K||Q.x>b)&&(b=Q.x),(!K||Q.y>w)&&(w=Q.y)}const I=Math.min(b-d,w-g);let L=I/2;const O=new vS([],xS);if(I===0)return new S(d,g);for(let K=d;K<b;K+=I)for(let Q=g;Q<w;Q+=I)O.push(new ic(K+L,Q+L,L,s));let j=function(K){let Q=0,ae=0,_e=0;const xe=K[0];for(let Re=0,ke=xe.length,Ae=ke-1;Re<ke;Ae=Re++){const Ye=xe[Re],et=xe[Ae],Tt=Ye.x*et.y-et.x*Ye.y;ae+=(Ye.x+et.x)*Tt,_e+=(Ye.y+et.y)*Tt,Q+=3*Tt}return new ic(ae/Q,_e/Q,0,K)}(s),Z=O.length;for(;O.length;){const K=O.pop();(K.d>j.d||!j.d)&&(j=K,c&&console.log("found best %d after %d probes",Math.round(1e4*K.d)/1e4,Z)),K.max-j.d<=i||(L=K.h/2,O.push(new ic(K.p.x-L,K.p.y-L,L,s)),O.push(new ic(K.p.x+L,K.p.y-L,L,s)),O.push(new ic(K.p.x-L,K.p.y+L,L,s)),O.push(new ic(K.p.x+L,K.p.y+L,L,s)),Z+=4)}return c&&(console.log(`num probes: ${Z}`),console.log(`best distance: ${j.d}`)),j.p}function xS(s,i){return i.max-s.max}function ic(s,i,c,d){this.p=new S(s,i),this.h=c,this.d=function(g,b){let w=!1,T=1/0;for(let I=0;I<b.length;I++){const L=b[I];for(let O=0,j=L.length,Z=j-1;O<j;Z=O++){const K=L[O],Q=L[Z];K.y>g.y!=Q.y>g.y&&g.x<(Q.x-K.x)*(g.y-K.y)/(Q.y-K.y)+K.x&&(w=!w),T=Math.min(T,u_(g,K,Q))}}return(w?1:-1)*Math.sqrt(T)}(this.p,d),this.max=this.d+this.h*Math.SQRT2}var ai;f.ap=void 0,(ai=f.ap||(f.ap={}))[ai.center=1]="center",ai[ai.left=2]="left",ai[ai.right=3]="right",ai[ai.top=4]="top",ai[ai.bottom=5]="bottom",ai[ai["top-left"]=6]="top-left",ai[ai["top-right"]=7]="top-right",ai[ai["bottom-left"]=8]="bottom-left",ai[ai["bottom-right"]=9]="bottom-right";const oa=7,qp=Number.POSITIVE_INFINITY;function My(s,i){return i[1]!==qp?function(c,d,g){let b=0,w=0;switch(d=Math.abs(d),g=Math.abs(g),c){case"top-right":case"top-left":case"top":w=g-oa;break;case"bottom-right":case"bottom-left":case"bottom":w=-g+oa}switch(c){case"top-right":case"bottom-right":case"right":b=-d;break;case"top-left":case"bottom-left":case"left":b=d}return[b,w]}(s,i[0],i[1]):function(c,d){let g=0,b=0;d<0&&(d=0);const w=d/Math.SQRT2;switch(c){case"top-right":case"top-left":b=w-oa;break;case"bottom-right":case"bottom-left":b=-w+oa;break;case"bottom":b=-d+oa;break;case"top":b=d-oa}switch(c){case"top-right":case"bottom-right":g=-w;break;case"top-left":case"bottom-left":g=w;break;case"left":g=d;break;case"right":g=-d}return[g,b]}(s,i[0])}function Iy(s,i,c){var d;const g=s.layout,b=(d=g.get("text-variable-anchor-offset"))===null||d===void 0?void 0:d.evaluate(i,{},c);if(b){const T=b.values,I=[];for(let L=0;L<T.length;L+=2){const O=I[L]=T[L],j=T[L+1].map(Z=>Z*jn);O.startsWith("top")?j[1]-=oa:O.startsWith("bottom")&&(j[1]+=oa),I[L+1]=j}return new Xi(I)}const w=g.get("text-variable-anchor");if(w){let T;T=s._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[g.get("text-radial-offset").evaluate(i,{},c)*jn,qp]:g.get("text-offset").evaluate(i,{},c).map(L=>L*jn);const I=[];for(const L of w)I.push(L,My(L,T));return new Xi(I)}return null}function Gp(s){switch(s){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function SS(s,i,c,d,g,b,w,T,I,L,O){let j=b.textMaxSize.evaluate(i,{});j===void 0&&(j=w);const Z=s.layers[0].layout,K=Z.get("icon-offset").evaluate(i,{},O),Q=Ly(c.horizontal),ae=w/24,_e=s.tilePixelRatio*ae,xe=s.tilePixelRatio*j/24,Re=s.tilePixelRatio*T,ke=s.tilePixelRatio*Z.get("symbol-spacing"),Ae=Z.get("text-padding")*s.tilePixelRatio,Ye=function(st,qt,Bt,mr=1){const Xr=st.get("icon-padding").evaluate(qt,{},Bt),tn=Xr&&Xr.values;return[tn[0]*mr,tn[1]*mr,tn[2]*mr,tn[3]*mr]}(Z,i,O,s.tilePixelRatio),et=Z.get("text-max-angle")/180*Math.PI,Tt=Z.get("text-rotation-alignment")!=="viewport"&&Z.get("symbol-placement")!=="point",Rt=Z.get("icon-rotation-alignment")==="map"&&Z.get("symbol-placement")!=="point",kt=Z.get("symbol-placement"),bt=ke/2,dt=Z.get("icon-text-fit");let Pt;d&&dt!=="none"&&(s.allowVerticalPlacement&&c.vertical&&(Pt=ey(d,c.vertical,dt,Z.get("icon-text-fit-padding"),K,ae)),Q&&(d=ey(d,Q,dt,Z.get("icon-text-fit-padding"),K,ae)));const vt=(st,qt)=>{qt.x<0||qt.x>=vn||qt.y<0||qt.y>=vn||function(Bt,mr,Xr,tn,Un,Qi,Ci,Rn,Qn,li,Mi,Ii,Vn,$n,gi,Ai,_i,Ui,Vi,qn,yr,yi,ci,Gn,ko){const jo=Bt.addToLineVertexArray(mr,Xr);let Uo,Es,To,ho,$i=0,Cs=0,Bu=0,Ry=0,Qp=-1,em=-1;const Ms={};let By=dn("");if(Bt.allowVerticalPlacement&&tn.vertical){const vi=Rn.layout.get("text-rotate").evaluate(yr,{},Gn)+90;To=new Nf(Qn,mr,li,Mi,Ii,tn.vertical,Vn,$n,gi,vi),Ci&&(ho=new Nf(Qn,mr,li,Mi,Ii,Ci,_i,Ui,gi,vi))}if(Un){const vi=Rn.layout.get("icon-rotate").evaluate(yr,{}),fo=Rn.layout.get("icon-text-fit")!=="none",Xa=Ey(Un,vi,ci,fo),$o=Ci?Ey(Ci,vi,ci,fo):void 0;Es=new Nf(Qn,mr,li,Mi,Ii,Un,_i,Ui,!1,vi),$i=4*Xa.length;const Ka=Bt.iconSizeData;let ss=null;Ka.kind==="source"?(ss=[os*Rn.layout.get("icon-size").evaluate(yr,{})],ss[0]>ra&&He(`${Bt.layerIds[0]}: Value for "icon-size" is >= ${Pu}. Reduce your "icon-size".`)):Ka.kind==="composite"&&(ss=[os*yi.compositeIconSizes[0].evaluate(yr,{},Gn),os*yi.compositeIconSizes[1].evaluate(yr,{},Gn)],(ss[0]>ra||ss[1]>ra)&&He(`${Bt.layerIds[0]}: Value for "icon-size" is >= ${Pu}. Reduce your "icon-size".`)),Bt.addSymbols(Bt.icon,Xa,ss,qn,Vi,yr,f.ah.none,mr,jo.lineStartIndex,jo.lineLength,-1,Gn),Qp=Bt.icon.placedSymbolArray.length-1,$o&&(Cs=4*$o.length,Bt.addSymbols(Bt.icon,$o,ss,qn,Vi,yr,f.ah.vertical,mr,jo.lineStartIndex,jo.lineLength,-1,Gn),em=Bt.icon.placedSymbolArray.length-1)}const Fy=Object.keys(tn.horizontal);for(const vi of Fy){const fo=tn.horizontal[vi];if(!Uo){By=dn(fo.text);const $o=Rn.layout.get("text-rotate").evaluate(yr,{},Gn);Uo=new Nf(Qn,mr,li,Mi,Ii,fo,Vn,$n,gi,$o)}const Xa=fo.positionedLines.length===1;if(Bu+=Ay(Bt,mr,fo,Qi,Rn,gi,yr,Ai,jo,tn.vertical?f.ah.horizontal:f.ah.horizontalOnly,Xa?Fy:[vi],Ms,Qp,yi,Gn),Xa)break}tn.vertical&&(Ry+=Ay(Bt,mr,tn.vertical,Qi,Rn,gi,yr,Ai,jo,f.ah.vertical,["vertical"],Ms,em,yi,Gn));const ES=Uo?Uo.boxStartIndex:Bt.collisionBoxArray.length,CS=Uo?Uo.boxEndIndex:Bt.collisionBoxArray.length,MS=To?To.boxStartIndex:Bt.collisionBoxArray.length,IS=To?To.boxEndIndex:Bt.collisionBoxArray.length,AS=Es?Es.boxStartIndex:Bt.collisionBoxArray.length,LS=Es?Es.boxEndIndex:Bt.collisionBoxArray.length,PS=ho?ho.boxStartIndex:Bt.collisionBoxArray.length,zS=ho?ho.boxEndIndex:Bt.collisionBoxArray.length;let Vo=-1;const Uf=(vi,fo)=>vi&&vi.circleDiameter?Math.max(vi.circleDiameter,fo):fo;Vo=Uf(Uo,Vo),Vo=Uf(To,Vo),Vo=Uf(Es,Vo),Vo=Uf(ho,Vo);const Oy=Vo>-1?1:0;Oy&&(Vo*=ko/jn),Bt.glyphOffsetArray.length>=rc.MAX_GLYPHS&&He("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),yr.sortKey!==void 0&&Bt.addToSortKeyRanges(Bt.symbolInstances.length,yr.sortKey);const DS=Iy(Rn,yr,Gn),[RS,BS]=function(vi,fo){const Xa=vi.length,$o=fo==null?void 0:fo.values;if(($o==null?void 0:$o.length)>0)for(let Ka=0;Ka<$o.length;Ka+=2){const ss=$o[Ka+1];vi.emplaceBack(f.ap[$o[Ka]],ss[0],ss[1])}return[Xa,vi.length]}(Bt.textAnchorOffsets,DS);Bt.symbolInstances.emplaceBack(mr.x,mr.y,Ms.right>=0?Ms.right:-1,Ms.center>=0?Ms.center:-1,Ms.left>=0?Ms.left:-1,Ms.vertical||-1,Qp,em,By,ES,CS,MS,IS,AS,LS,PS,zS,li,Bu,Ry,$i,Cs,Oy,0,Vn,Vo,RS,BS)}(s,qt,st,c,d,g,Pt,s.layers[0],s.collisionBoxArray,i.index,i.sourceLayerIndex,s.index,_e,[Ae,Ae,Ae,Ae],Tt,I,Re,Ye,Rt,K,i,b,L,O,w)};if(kt==="line")for(const st of by(i.geometry,0,0,vn,vn)){const qt=yS(st,ke,et,c.vertical||Q,d,24,xe,s.overscaling,vn);for(const Bt of qt)Q&&kS(s,Q.text,bt,Bt)||vt(st,Bt)}else if(kt==="line-center"){for(const st of i.geometry)if(st.length>1){const qt=_S(st,et,c.vertical||Q,d,24,xe);qt&&vt(st,qt)}}else if(i.type==="Polygon")for(const st of Sp(i.geometry,0)){const qt=wS(st,16);vt(st[0],new ia(qt.x,qt.y,0))}else if(i.type==="LineString")for(const st of i.geometry)vt(st,new ia(st[0].x,st[0].y,0));else if(i.type==="Point")for(const st of i.geometry)for(const qt of st)vt([qt],new ia(qt.x,qt.y,0))}function Ay(s,i,c,d,g,b,w,T,I,L,O,j,Z,K,Q){const ae=function(Re,ke,Ae,Ye,et,Tt,Rt,kt){const bt=Ye.layout.get("text-rotate").evaluate(Tt,{})*Math.PI/180,dt=[];for(const Pt of ke.positionedLines)for(const vt of Pt.positionedGlyphs){if(!vt.rect)continue;const st=vt.rect||{};let qt=Z_+1,Bt=!0,mr=1,Xr=0;const tn=(et||kt)&&vt.vertical,Un=vt.metrics.advance*vt.scale/2;if(kt&&ke.verticalizable&&(Xr=Pt.lineOffset/2-(vt.imageName?-(jn-vt.metrics.width*vt.scale)/2:(vt.scale-1)*jn)),vt.imageName){const qn=Rt[vt.imageName];Bt=qn.sdf,mr=qn.pixelRatio,qt=ji/mr}const Qi=et?[vt.x+Un,vt.y]:[0,0];let Ci=et?[0,0]:[vt.x+Un+Ae[0],vt.y+Ae[1]-Xr],Rn=[0,0];tn&&(Rn=Ci,Ci=[0,0]);const Qn=vt.metrics.isDoubleResolution?2:1,li=(vt.metrics.left-qt)*vt.scale-Un+Ci[0],Mi=(-vt.metrics.top-qt)*vt.scale+Ci[1],Ii=li+st.w/Qn*vt.scale/mr,Vn=Mi+st.h/Qn*vt.scale/mr,$n=new S(li,Mi),gi=new S(Ii,Mi),Ai=new S(li,Vn),_i=new S(Ii,Vn);if(tn){const qn=new S(-Un,Un-Au),yr=-Math.PI/2,yi=jn/2-Un,ci=new S(5-Au-yi,-(vt.imageName?yi:0)),Gn=new S(...Rn);$n._rotateAround(yr,qn)._add(ci)._add(Gn),gi._rotateAround(yr,qn)._add(ci)._add(Gn),Ai._rotateAround(yr,qn)._add(ci)._add(Gn),_i._rotateAround(yr,qn)._add(ci)._add(Gn)}if(bt){const qn=Math.sin(bt),yr=Math.cos(bt),yi=[yr,-qn,qn,yr];$n._matMult(yi),gi._matMult(yi),Ai._matMult(yi),_i._matMult(yi)}const Ui=new S(0,0),Vi=new S(0,0);dt.push({tl:$n,tr:gi,bl:Ai,br:_i,tex:st,writingMode:ke.writingMode,glyphOffset:Qi,sectionIndex:vt.sectionIndex,isSDF:Bt,pixelOffsetTL:Ui,pixelOffsetBR:Vi,minFontScaleX:0,minFontScaleY:0})}return dt}(0,c,T,g,b,w,d,s.allowVerticalPlacement),_e=s.textSizeData;let xe=null;_e.kind==="source"?(xe=[os*g.layout.get("text-size").evaluate(w,{})],xe[0]>ra&&He(`${s.layerIds[0]}: Value for "text-size" is >= ${Pu}. Reduce your "text-size".`)):_e.kind==="composite"&&(xe=[os*K.compositeTextSizes[0].evaluate(w,{},Q),os*K.compositeTextSizes[1].evaluate(w,{},Q)],(xe[0]>ra||xe[1]>ra)&&He(`${s.layerIds[0]}: Value for "text-size" is >= ${Pu}. Reduce your "text-size".`)),s.addSymbols(s.text,ae,xe,T,b,w,L,i,I.lineStartIndex,I.lineLength,Z,Q);for(const Re of O)j[Re]=s.text.placedSymbolArray.length-1;return 4*ae.length}function Ly(s){for(const i in s)return s[i];return null}function kS(s,i,c,d){const g=s.compareText;if(i in g){const b=g[i];for(let w=b.length-1;w>=0;w--)if(d.dist(b[w])<c)return!0}else g[i]=[];return g[i].push(d),!1}const Py=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Wp{static from(i){if(!(i instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[c,d]=new Uint8Array(i,0,2);if(c!==219)throw new Error("Data does not appear to be in a KDBush format.");const g=d>>4;if(g!==1)throw new Error(`Got v${g} data when expected v1.`);const b=Py[15&d];if(!b)throw new Error("Unrecognized array type.");const[w]=new Uint16Array(i,2,1),[T]=new Uint32Array(i,4,1);return new Wp(T,w,b,i)}constructor(i,c=64,d=Float64Array,g){if(isNaN(i)||i<0)throw new Error(`Unpexpected numItems value: ${i}.`);this.numItems=+i,this.nodeSize=Math.min(Math.max(+c,2),65535),this.ArrayType=d,this.IndexArrayType=i<65536?Uint16Array:Uint32Array;const b=Py.indexOf(this.ArrayType),w=2*i*this.ArrayType.BYTES_PER_ELEMENT,T=i*this.IndexArrayType.BYTES_PER_ELEMENT,I=(8-T%8)%8;if(b<0)throw new Error(`Unexpected typed array class: ${d}.`);g&&g instanceof ArrayBuffer?(this.data=g,this.ids=new this.IndexArrayType(this.data,8,i),this.coords=new this.ArrayType(this.data,8+T+I,2*i),this._pos=2*i,this._finished=!0):(this.data=new ArrayBuffer(8+w+T+I),this.ids=new this.IndexArrayType(this.data,8,i),this.coords=new this.ArrayType(this.data,8+T+I,2*i),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+b]),new Uint16Array(this.data,2,1)[0]=c,new Uint32Array(this.data,4,1)[0]=i)}add(i,c){const d=this._pos>>1;return this.ids[d]=d,this.coords[this._pos++]=i,this.coords[this._pos++]=c,d}finish(){const i=this._pos>>1;if(i!==this.numItems)throw new Error(`Added ${i} items when expected ${this.numItems}.`);return Zp(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(i,c,d,g){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:b,coords:w,nodeSize:T}=this,I=[0,b.length-1,0],L=[];for(;I.length;){const O=I.pop()||0,j=I.pop()||0,Z=I.pop()||0;if(j-Z<=T){for(let _e=Z;_e<=j;_e++){const xe=w[2*_e],Re=w[2*_e+1];xe>=i&&xe<=d&&Re>=c&&Re<=g&&L.push(b[_e])}continue}const K=Z+j>>1,Q=w[2*K],ae=w[2*K+1];Q>=i&&Q<=d&&ae>=c&&ae<=g&&L.push(b[K]),(O===0?i<=Q:c<=ae)&&(I.push(Z),I.push(K-1),I.push(1-O)),(O===0?d>=Q:g>=ae)&&(I.push(K+1),I.push(j),I.push(1-O))}return L}within(i,c,d){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:g,coords:b,nodeSize:w}=this,T=[0,g.length-1,0],I=[],L=d*d;for(;T.length;){const O=T.pop()||0,j=T.pop()||0,Z=T.pop()||0;if(j-Z<=w){for(let _e=Z;_e<=j;_e++)Dy(b[2*_e],b[2*_e+1],i,c)<=L&&I.push(g[_e]);continue}const K=Z+j>>1,Q=b[2*K],ae=b[2*K+1];Dy(Q,ae,i,c)<=L&&I.push(g[K]),(O===0?i-d<=Q:c-d<=ae)&&(T.push(Z),T.push(K-1),T.push(1-O)),(O===0?i+d>=Q:c+d>=ae)&&(T.push(K+1),T.push(j),T.push(1-O))}return I}}function Zp(s,i,c,d,g,b){if(g-d<=c)return;const w=d+g>>1;zy(s,i,w,d,g,b),Zp(s,i,c,d,w-1,1-b),Zp(s,i,c,w+1,g,1-b)}function zy(s,i,c,d,g,b){for(;g>d;){if(g-d>600){const L=g-d+1,O=c-d+1,j=Math.log(L),Z=.5*Math.exp(2*j/3),K=.5*Math.sqrt(j*Z*(L-Z)/L)*(O-L/2<0?-1:1);zy(s,i,c,Math.max(d,Math.floor(c-O*Z/L+K)),Math.min(g,Math.floor(c+(L-O)*Z/L+K)),b)}const w=i[2*c+b];let T=d,I=g;for(Du(s,i,d,c),i[2*g+b]>w&&Du(s,i,d,g);T<I;){for(Du(s,i,T,I),T++,I--;i[2*T+b]<w;)T++;for(;i[2*I+b]>w;)I--}i[2*d+b]===w?Du(s,i,d,I):(I++,Du(s,i,I,g)),I<=c&&(d=I+1),c<=I&&(g=I-1)}}function Du(s,i,c,d){Hp(s,c,d),Hp(i,2*c,2*d),Hp(i,2*c+1,2*d+1)}function Hp(s,i,c){const d=s[i];s[i]=s[c],s[c]=d}function Dy(s,i,c,d){const g=s-c,b=i-d;return g*g+b*b}var Xp;f.bd=void 0,(Xp=f.bd||(f.bd={})).create="create",Xp.load="load",Xp.fullLoad="fullLoad";let jf=null,Ru=[];const Kp=1e3/60,Jp="loadTime",Yp="fullLoadTime",TS={mark(s){performance.mark(s)},frame(s){const i=s;jf!=null&&Ru.push(i-jf),jf=i},clearMetrics(){jf=null,Ru=[],performance.clearMeasures(Jp),performance.clearMeasures(Yp);for(const s in f.bd)performance.clearMarks(f.bd[s])},getPerformanceMetrics(){performance.measure(Jp,f.bd.create,f.bd.load),performance.measure(Yp,f.bd.create,f.bd.fullLoad);const s=performance.getEntriesByName(Jp)[0].duration,i=performance.getEntriesByName(Yp)[0].duration,c=Ru.length,d=1/(Ru.reduce((b,w)=>b+w,0)/c/1e3),g=Ru.filter(b=>b>Kp).reduce((b,w)=>b+(w-Kp)/Kp,0);return{loadTime:s,fullLoadTime:i,fps:d,percentDroppedFrames:g/(c+g)*100,totalFrames:c}}};f.$=gt,f.A=Kl,f.B=function(s){if(Ut==null){const i=s.navigator?s.navigator.userAgent:null;Ut=!!s.safari||!(!i||!(/\b(iPad|iPhone|iPod)\b/.test(i)||i.match("Safari")&&!i.match("Chrome")))}return Ut},f.C=class{constructor(s,i){this.target=s,this.mapId=i,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new mS(()=>this.process()),this.subscription=function(c,d,g,b){return c.addEventListener(d,g,!1),{unsubscribe:()=>{c.removeEventListener(d,g,!1)}}}(this.target,"message",c=>this.receive(c)),this.globalScope=_t(self)?s:window}registerMessageHandler(s,i){this.messageHandlers[s]=i}sendAsync(s,i){return new Promise((c,d)=>{const g=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[g]={resolve:c,reject:d},i&&i.signal.addEventListener("abort",()=>{delete this.resolveRejects[g];const T={id:g,type:"<cancel>",origin:location.origin,targetMapId:s.targetMapId,sourceMapId:this.mapId};this.target.postMessage(T)},{once:!0});const b=[],w=Object.assign(Object.assign({},s),{id:g,sourceMapId:this.mapId,origin:location.origin,data:Ks(s.data,b)});this.target.postMessage(w,{transfer:b})})}receive(s){const i=s.data,c=i.id;if(!(i.origin!=="file://"&&location.origin!=="file://"&&i.origin!==location.origin||i.targetMapId&&this.mapId!==i.targetMapId)){if(i.type==="<cancel>"){delete this.tasks[c];const d=this.abortControllers[c];return delete this.abortControllers[c],void(d&&d.abort())}if(_t(self)||i.mustQueue)return this.tasks[c]=i,this.taskQueue.push(c),void this.invoker.trigger();this.processTask(c,i)}}process(){if(this.taskQueue.length===0)return;const s=this.taskQueue.shift(),i=this.tasks[s];delete this.tasks[s],this.taskQueue.length>0&&this.invoker.trigger(),i&&this.processTask(s,i)}processTask(s,i){return a(this,void 0,void 0,function*(){if(i.type==="<response>"){const g=this.resolveRejects[s];return delete this.resolveRejects[s],g?void(i.error?g.reject(Js(i.error)):g.resolve(Js(i.data))):void 0}if(!this.messageHandlers[i.type])return void this.completeTask(s,new Error(`Could not find a registered handler for ${i.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const c=Js(i.data),d=new AbortController;this.abortControllers[s]=d;try{const g=yield this.messageHandlers[i.type](i.sourceMapId,c,d);this.completeTask(s,null,g)}catch(g){this.completeTask(s,g)}})}completeTask(s,i,c){const d=[];delete this.abortControllers[s];const g={id:s,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:i?Ks(i):null,data:Ks(c,d)};this.target.postMessage(g,{transfer:d})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},f.D=Nt,f.E=xt,f.F=function(){var s=new Kl(16);return Kl!=Float32Array&&(s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=0,s[12]=0,s[13]=0,s[14]=0),s[0]=1,s[5]=1,s[10]=1,s[15]=1,s},f.G=rr,f.H=function(s,i,c){var d,g,b,w,T,I,L,O,j,Z,K,Q,ae=c[0],_e=c[1],xe=c[2];return i===s?(s[12]=i[0]*ae+i[4]*_e+i[8]*xe+i[12],s[13]=i[1]*ae+i[5]*_e+i[9]*xe+i[13],s[14]=i[2]*ae+i[6]*_e+i[10]*xe+i[14],s[15]=i[3]*ae+i[7]*_e+i[11]*xe+i[15]):(g=i[1],b=i[2],w=i[3],T=i[4],I=i[5],L=i[6],O=i[7],j=i[8],Z=i[9],K=i[10],Q=i[11],s[0]=d=i[0],s[1]=g,s[2]=b,s[3]=w,s[4]=T,s[5]=I,s[6]=L,s[7]=O,s[8]=j,s[9]=Z,s[10]=K,s[11]=Q,s[12]=d*ae+T*_e+j*xe+i[12],s[13]=g*ae+I*_e+Z*xe+i[13],s[14]=b*ae+L*_e+K*xe+i[14],s[15]=w*ae+O*_e+Q*xe+i[15]),s},f.I=zp,f.J=function(s,i,c){var d=c[0],g=c[1],b=c[2];return s[0]=i[0]*d,s[1]=i[1]*d,s[2]=i[2]*d,s[3]=i[3]*d,s[4]=i[4]*g,s[5]=i[5]*g,s[6]=i[6]*g,s[7]=i[7]*g,s[8]=i[8]*b,s[9]=i[9]*b,s[10]=i[10]*b,s[11]=i[11]*b,s[12]=i[12],s[13]=i[13],s[14]=i[14],s[15]=i[15],s},f.K=p_,f.L=function(s,i){const c={};for(let d=0;d<i.length;d++){const g=i[d];g in s&&(c[g]=s[g])}return c},f.M=na,f.N=cy,f.O=uy,f.P=S,f.Q=uo,f.R=co,f.S=B,f.T=ou,f.U=N,f.V=Kt,f.W=vn,f.X=En,f.Y=Rf,f.Z=class extends lu{},f._=a,f.a=sr,f.a$=function(s,i,c){return s[0]=i[0]*c[0],s[1]=i[1]*c[1],s[2]=i[2]*c[2],s[3]=i[3]*c[3],s},f.a0=$p,f.a1=lt,f.a2=s=>{const i=window.document.createElement("video");return i.muted=!0,new Promise(c=>{i.onloadstart=()=>{c(i)};for(const d of s){const g=window.document.createElement("source");ht(d)||(i.crossOrigin="Anonymous"),g.src=d,i.appendChild(g)}})},f.a3=function(){return J++},f.a4=y,f.a5=rc,f.a6=Il,f.a7=ks,f.a8=Qr,f.a9=gy,f.aA=ne,f.aB=function(s,i){if(!s)return[{command:"setStyle",args:[i]}];let c=[];try{if(!We(s.version,i.version))return[{command:"setStyle",args:[i]}];We(s.center,i.center)||c.push({command:"setCenter",args:[i.center]}),We(s.zoom,i.zoom)||c.push({command:"setZoom",args:[i.zoom]}),We(s.bearing,i.bearing)||c.push({command:"setBearing",args:[i.bearing]}),We(s.pitch,i.pitch)||c.push({command:"setPitch",args:[i.pitch]}),We(s.sprite,i.sprite)||c.push({command:"setSprite",args:[i.sprite]}),We(s.glyphs,i.glyphs)||c.push({command:"setGlyphs",args:[i.glyphs]}),We(s.transition,i.transition)||c.push({command:"setTransition",args:[i.transition]}),We(s.light,i.light)||c.push({command:"setLight",args:[i.light]}),We(s.terrain,i.terrain)||c.push({command:"setTerrain",args:[i.terrain]}),We(s.sky,i.sky)||c.push({command:"setSky",args:[i.sky]});const d={},g=[];(function(w,T,I,L){let O;for(O in T=T||{},w=w||{})Object.prototype.hasOwnProperty.call(w,O)&&(Object.prototype.hasOwnProperty.call(T,O)||Sn(O,I,L));for(O in T)Object.prototype.hasOwnProperty.call(T,O)&&(Object.prototype.hasOwnProperty.call(w,O)?We(w[O],T[O])||(w[O].type==="geojson"&&T[O].type==="geojson"&&ii(w,T,O)?wt(I,{command:"setGeoJSONSourceData",args:[O,T[O].data]}):In(O,T,I,L)):xn(O,T,I))})(s.sources,i.sources,g,d);const b=[];s.layers&&s.layers.forEach(w=>{"source"in w&&d[w.source]?c.push({command:"removeLayer",args:[w.id]}):b.push(w)}),c=c.concat(g),function(w,T,I){T=T||[];const L=(w=w||[]).map(Xo),O=T.map(Xo),j=w.reduce(Jr,{}),Z=T.reduce(Jr,{}),K=L.slice(),Q=Object.create(null);let ae,_e,xe,Re,ke;for(let Ae=0,Ye=0;Ae<L.length;Ae++)ae=L[Ae],Object.prototype.hasOwnProperty.call(Z,ae)?Ye++:(wt(I,{command:"removeLayer",args:[ae]}),K.splice(K.indexOf(ae,Ye),1));for(let Ae=0,Ye=0;Ae<O.length;Ae++)ae=O[O.length-1-Ae],K[K.length-1-Ae]!==ae&&(Object.prototype.hasOwnProperty.call(j,ae)?(wt(I,{command:"removeLayer",args:[ae]}),K.splice(K.lastIndexOf(ae,K.length-Ye),1)):Ye++,Re=K[K.length-Ae],wt(I,{command:"addLayer",args:[Z[ae],Re]}),K.splice(K.length-Ae,0,ae),Q[ae]=!0);for(let Ae=0;Ae<O.length;Ae++)if(ae=O[Ae],_e=j[ae],xe=Z[ae],!Q[ae]&&!We(_e,xe))if(We(_e.source,xe.source)&&We(_e["source-layer"],xe["source-layer"])&&We(_e.type,xe.type)){for(ke in oi(_e.layout,xe.layout,I,ae,null,"setLayoutProperty"),oi(_e.paint,xe.paint,I,ae,null,"setPaintProperty"),We(_e.filter,xe.filter)||wt(I,{command:"setFilter",args:[ae,xe.filter]}),We(_e.minzoom,xe.minzoom)&&We(_e.maxzoom,xe.maxzoom)||wt(I,{command:"setLayerZoomRange",args:[ae,xe.minzoom,xe.maxzoom]}),_e)Object.prototype.hasOwnProperty.call(_e,ke)&&ke!=="layout"&&ke!=="paint"&&ke!=="filter"&&ke!=="metadata"&&ke!=="minzoom"&&ke!=="maxzoom"&&(ke.indexOf("paint.")===0?oi(_e[ke],xe[ke],I,ae,ke.slice(6),"setPaintProperty"):We(_e[ke],xe[ke])||wt(I,{command:"setLayerProperty",args:[ae,ke,xe[ke]]}));for(ke in xe)Object.prototype.hasOwnProperty.call(xe,ke)&&!Object.prototype.hasOwnProperty.call(_e,ke)&&ke!=="layout"&&ke!=="paint"&&ke!=="filter"&&ke!=="metadata"&&ke!=="minzoom"&&ke!=="maxzoom"&&(ke.indexOf("paint.")===0?oi(_e[ke],xe[ke],I,ae,ke.slice(6),"setPaintProperty"):We(_e[ke],xe[ke])||wt(I,{command:"setLayerProperty",args:[ae,ke,xe[ke]]}))}else wt(I,{command:"removeLayer",args:[ae]}),Re=K[K.lastIndexOf(ae)+1],wt(I,{command:"addLayer",args:[xe,Re]})}(b,i.layers,c)}catch(d){console.warn("Unable to compute style diff:",d),c=[{command:"setStyle",args:[i]}]}return c},f.aC=function(s){const i=[],c=s.id;return c===void 0&&i.push({message:`layers.${c}: missing required property "id"`}),s.render===void 0&&i.push({message:`layers.${c}: missing required method "render"`}),s.renderingMode&&s.renderingMode!=="2d"&&s.renderingMode!=="3d"&&i.push({message:`layers.${c}: property "renderingMode" must be either "2d" or "3d"`}),i},f.aD=function s(i,c){if(Array.isArray(i)){if(!Array.isArray(c)||i.length!==c.length)return!1;for(let d=0;d<i.length;d++)if(!s(i[d],c[d]))return!1;return!0}if(typeof i=="object"&&i!==null&&c!==null){if(typeof c!="object"||Object.keys(i).length!==Object.keys(c).length)return!1;for(const d in i)if(!s(i[d],c[d]))return!1;return!0}return i===c},f.aE=ye,f.aF=ze,f.aG=class extends Nn{constructor(s,i){super(s,i),this.current=0}set(s){this.current!==s&&(this.current=s,this.gl.uniform1i(this.location,s))}},f.aH=Ni,f.aI=class extends Nn{constructor(s,i){super(s,i),this.current=Za}set(s){if(s[12]!==this.current[12]||s[0]!==this.current[0])return this.current=s,void this.gl.uniformMatrix4fv(this.location,!1,s);for(let i=1;i<16;i++)if(s[i]!==this.current[i]){this.current=s,this.gl.uniformMatrix4fv(this.location,!1,s);break}}},f.aJ=xo,f.aK=class extends Nn{constructor(s,i){super(s,i),this.current=[0,0,0]}set(s){s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]||(this.current=s,this.gl.uniform3f(this.location,s[0],s[1],s[2]))}},f.aL=class extends Nn{constructor(s,i){super(s,i),this.current=[0,0]}set(s){s[0]===this.current[0]&&s[1]===this.current[1]||(this.current=s,this.gl.uniform2f(this.location,s[0],s[1]))}},f.aM=rs,f.aN=function(s,i,c,d,g,b,w){var T=1/(i-c),I=1/(d-g),L=1/(b-w);return s[0]=-2*T,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=-2*I,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=2*L,s[11]=0,s[12]=(i+c)*T,s[13]=(g+d)*I,s[14]=(w+b)*L,s[15]=1,s},f.aO=zr,f.aP=Xx,f.aQ=class extends Vl{},f.aR=$2,f.aS=class extends $l{},f.aT=function(s){return s<=1?1:Math.pow(2,Math.ceil(Math.log(s)/Math.LN2))},f.aU=v_,f.aV=q,f.aW=class extends pu{},f.aX=Xe,f.aY=function(s,i){return s[0]===i[0]&&s[1]===i[1]&&s[2]===i[2]&&s[3]===i[3]&&s[4]===i[4]&&s[5]===i[5]&&s[6]===i[6]&&s[7]===i[7]&&s[8]===i[8]&&s[9]===i[9]&&s[10]===i[10]&&s[11]===i[11]&&s[12]===i[12]&&s[13]===i[13]&&s[14]===i[14]&&s[15]===i[15]},f.aZ=function(s,i){var c=s[0],d=s[1],g=s[2],b=s[3],w=s[4],T=s[5],I=s[6],L=s[7],O=s[8],j=s[9],Z=s[10],K=s[11],Q=s[12],ae=s[13],_e=s[14],xe=s[15],Re=i[0],ke=i[1],Ae=i[2],Ye=i[3],et=i[4],Tt=i[5],Rt=i[6],kt=i[7],bt=i[8],dt=i[9],Pt=i[10],vt=i[11],st=i[12],qt=i[13],Bt=i[14],mr=i[15];return Math.abs(c-Re)<=Ei*Math.max(1,Math.abs(c),Math.abs(Re))&&Math.abs(d-ke)<=Ei*Math.max(1,Math.abs(d),Math.abs(ke))&&Math.abs(g-Ae)<=Ei*Math.max(1,Math.abs(g),Math.abs(Ae))&&Math.abs(b-Ye)<=Ei*Math.max(1,Math.abs(b),Math.abs(Ye))&&Math.abs(w-et)<=Ei*Math.max(1,Math.abs(w),Math.abs(et))&&Math.abs(T-Tt)<=Ei*Math.max(1,Math.abs(T),Math.abs(Tt))&&Math.abs(I-Rt)<=Ei*Math.max(1,Math.abs(I),Math.abs(Rt))&&Math.abs(L-kt)<=Ei*Math.max(1,Math.abs(L),Math.abs(kt))&&Math.abs(O-bt)<=Ei*Math.max(1,Math.abs(O),Math.abs(bt))&&Math.abs(j-dt)<=Ei*Math.max(1,Math.abs(j),Math.abs(dt))&&Math.abs(Z-Pt)<=Ei*Math.max(1,Math.abs(Z),Math.abs(Pt))&&Math.abs(K-vt)<=Ei*Math.max(1,Math.abs(K),Math.abs(vt))&&Math.abs(Q-st)<=Ei*Math.max(1,Math.abs(Q),Math.abs(st))&&Math.abs(ae-qt)<=Ei*Math.max(1,Math.abs(ae),Math.abs(qt))&&Math.abs(_e-Bt)<=Ei*Math.max(1,Math.abs(_e),Math.abs(Bt))&&Math.abs(xe-mr)<=Ei*Math.max(1,Math.abs(xe),Math.abs(mr))},f.a_=function(s,i){return s[0]=i[0],s[1]=i[1],s[2]=i[2],s[3]=i[3],s[4]=i[4],s[5]=i[5],s[6]=i[6],s[7]=i[7],s[8]=i[8],s[9]=i[9],s[10]=i[10],s[11]=i[11],s[12]=i[12],s[13]=i[13],s[14]=i[14],s[15]=i[15],s},f.aa=function(s){const i={};if(s.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(c,d,g,b)=>{const w=g||b;return i[d]=!w||w.toLowerCase(),""}),i["max-age"]){const c=parseInt(i["max-age"],10);isNaN(c)?delete i["max-age"]:i["max-age"]=c}return i},f.ab=function(s,i){const c=[];for(const d in s)d in i||c.push(d);return c},f.ac=te,f.ad=function(s,i,c){var d=Math.sin(c),g=Math.cos(c),b=i[0],w=i[1],T=i[2],I=i[3],L=i[4],O=i[5],j=i[6],Z=i[7];return i!==s&&(s[8]=i[8],s[9]=i[9],s[10]=i[10],s[11]=i[11],s[12]=i[12],s[13]=i[13],s[14]=i[14],s[15]=i[15]),s[0]=b*g+L*d,s[1]=w*g+O*d,s[2]=T*g+j*d,s[3]=I*g+Z*d,s[4]=L*g-b*d,s[5]=O*g-w*d,s[6]=j*g-T*d,s[7]=Z*g-I*d,s},f.ae=function(s){var i=new Kl(16);return i[0]=s[0],i[1]=s[1],i[2]=s[2],i[3]=s[3],i[4]=s[4],i[5]=s[5],i[6]=s[6],i[7]=s[7],i[8]=s[8],i[9]=s[9],i[10]=s[10],i[11]=s[11],i[12]=s[12],i[13]=s[13],i[14]=s[14],i[15]=s[15],i},f.af=kf,f.ag=function(s,i){let c=0,d=0;if(s.kind==="constant")d=s.layoutSize;else if(s.kind!=="source"){const{interpolationType:g,minZoom:b,maxZoom:w}=s,T=g?te(si.interpolationFactor(g,i,b,w),0,1):0;s.kind==="camera"?d=pi.number(s.minSize,s.maxSize,T):c=T}return{uSizeT:c,uSize:d}},f.ai=function(s,{uSize:i,uSizeT:c},{lowerSize:d,upperSize:g}){return s.kind==="source"?d/os:s.kind==="composite"?pi.number(d/os,g/os,c):i},f.aj=Fp,f.ak=function(s,i,c,d){const g=i.y-s.y,b=i.x-s.x,w=d.y-c.y,T=d.x-c.x,I=w*b-T*g;if(I===0)return null;const L=(T*(s.y-c.y)-w*(s.x-c.x))/I;return new S(s.x+L*b,s.y+L*g)},f.al=by,f.am=gu,f.an=gp,f.ao=jn,f.aq=Bp,f.ar=function(s,i){var c=i[0],d=i[1],g=i[2],b=i[3],w=i[4],T=i[5],I=i[6],L=i[7],O=i[8],j=i[9],Z=i[10],K=i[11],Q=i[12],ae=i[13],_e=i[14],xe=i[15],Re=c*T-d*w,ke=c*I-g*w,Ae=c*L-b*w,Ye=d*I-g*T,et=d*L-b*T,Tt=g*L-b*I,Rt=O*ae-j*Q,kt=O*_e-Z*Q,bt=O*xe-K*Q,dt=j*_e-Z*ae,Pt=j*xe-K*ae,vt=Z*xe-K*_e,st=Re*vt-ke*Pt+Ae*dt+Ye*bt-et*kt+Tt*Rt;return st?(s[0]=(T*vt-I*Pt+L*dt)*(st=1/st),s[1]=(g*Pt-d*vt-b*dt)*st,s[2]=(ae*Tt-_e*et+xe*Ye)*st,s[3]=(Z*et-j*Tt-K*Ye)*st,s[4]=(I*bt-w*vt-L*kt)*st,s[5]=(c*vt-g*bt+b*kt)*st,s[6]=(_e*Ae-Q*Tt-xe*ke)*st,s[7]=(O*Tt-Z*Ae+K*ke)*st,s[8]=(w*Pt-T*bt+L*Rt)*st,s[9]=(d*bt-c*Pt-b*Rt)*st,s[10]=(Q*et-ae*Ae+xe*Re)*st,s[11]=(j*Ae-O*et-K*Re)*st,s[12]=(T*kt-w*dt-I*Rt)*st,s[13]=(c*dt-d*kt+g*Rt)*st,s[14]=(ae*ke-Q*Ye-_e*Re)*st,s[15]=(O*Ye-j*ke+Z*Re)*st,s):null},f.as=Gp,f.at=Rp,f.au=Wp,f.av=function(){const s={},i=ie.$version;for(const c in ie.$root){const d=ie.$root[c];if(d.required){let g=null;g=c==="version"?i:d.type==="array"?[]:{},g!=null&&(s[c]=g)}}return s},f.aw=uf,f.ax=gr,f.ay=function(s){s=s.slice();const i=Object.create(null);for(let c=0;c<s.length;c++)i[s[c].id]=s[c];for(let c=0;c<s.length;c++)"ref"in s[c]&&(s[c]=Ne(s[c],i[s[c].ref]));return s},f.az=function(s){if(s.type==="custom")return new pS(s);switch(s.type){case"background":return new hS(s);case"circle":return new Kx(s);case"fill":return new g2(s);case"fill-extrusion":return new L2(s);case"heatmap":return new Yx(s);case"hillshade":return new e2(s);case"line":return new N2(s);case"raster":return new dS(s);case"symbol":return new Df(s)}},f.b=Je,f.b0=function(s,i){return s[0]*i[0]+s[1]*i[1]+s[2]*i[2]+s[3]*i[3]},f.b1=le,f.b2=dy,f.b3=hy,f.b4=function(s,i,c,d,g){var b,w=1/Math.tan(i/2);return s[0]=w/c,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=w,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=-1,s[12]=0,s[13]=0,s[15]=0,g!=null&&g!==1/0?(s[10]=(g+d)*(b=1/(d-g)),s[14]=2*g*d*b):(s[10]=-1,s[14]=-2*d),s},f.b5=function(s,i,c){var d=Math.sin(c),g=Math.cos(c),b=i[4],w=i[5],T=i[6],I=i[7],L=i[8],O=i[9],j=i[10],Z=i[11];return i!==s&&(s[0]=i[0],s[1]=i[1],s[2]=i[2],s[3]=i[3],s[12]=i[12],s[13]=i[13],s[14]=i[14],s[15]=i[15]),s[4]=b*g+L*d,s[5]=w*g+O*d,s[6]=T*g+j*d,s[7]=I*g+Z*d,s[8]=L*g-b*d,s[9]=O*g-w*d,s[10]=j*g-T*d,s[11]=Z*g-I*d,s},f.b6=V,f.b7=U,f.b8=function(s){return s*Math.PI/180},f.b9=function(s,i){return s[0]=i[0],s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=i[1],s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=i[2],s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s},f.bA=ts,f.ba=class extends Oo{},f.bb=Up,f.bc=TS,f.be=wr,f.bf=function(s,i){sr.REGISTERED_PROTOCOLS[s]=i},f.bg=function(s){delete sr.REGISTERED_PROTOCOLS[s]},f.bh=function(s,i){const c={};for(let g=0;g<s.length;g++){const b=i&&i[s[g].id]||hp(s[g]);i&&(i[s[g].id]=b);let w=c[b];w||(w=c[b]=[]),w.push(s[g])}const d=[];for(const g in c)d.push(c[g]);return d},f.bi=At,f.bj=my,f.bk=_y,f.bl=X_,f.bm=function(s){s.bucket.createArrays(),s.bucket.tilePixelRatio=vn/(512*s.bucket.overscaling),s.bucket.compareText={},s.bucket.iconsNeedLinear=!1;const i=s.bucket.layers[0],c=i.layout,d=i._unevaluatedLayout._values,g={layoutIconSize:d["icon-size"].possiblyEvaluate(new Qr(s.bucket.zoom+1),s.canonical),layoutTextSize:d["text-size"].possiblyEvaluate(new Qr(s.bucket.zoom+1),s.canonical),textMaxSize:d["text-size"].possiblyEvaluate(new Qr(18))};if(s.bucket.textSizeData.kind==="composite"){const{minZoom:L,maxZoom:O}=s.bucket.textSizeData;g.compositeTextSizes=[d["text-size"].possiblyEvaluate(new Qr(L),s.canonical),d["text-size"].possiblyEvaluate(new Qr(O),s.canonical)]}if(s.bucket.iconSizeData.kind==="composite"){const{minZoom:L,maxZoom:O}=s.bucket.iconSizeData;g.compositeIconSizes=[d["icon-size"].possiblyEvaluate(new Qr(L),s.canonical),d["icon-size"].possiblyEvaluate(new Qr(O),s.canonical)]}const b=c.get("text-line-height")*jn,w=c.get("text-rotation-alignment")!=="viewport"&&c.get("symbol-placement")!=="point",T=c.get("text-keep-upright"),I=c.get("text-size");for(const L of s.bucket.features){const O=c.get("text-font").evaluate(L,{},s.canonical).join(","),j=I.evaluate(L,{},s.canonical),Z=g.layoutTextSize.evaluate(L,{},s.canonical),K=g.layoutIconSize.evaluate(L,{},s.canonical),Q={horizontal:{},vertical:void 0},ae=L.text;let _e,xe=[0,0];if(ae){const Ae=ae.toString(),Ye=c.get("text-letter-spacing").evaluate(L,{},s.canonical)*jn,et=hf(Ae)?Ye:0,Tt=c.get("text-anchor").evaluate(L,{},s.canonical),Rt=Iy(i,L,s.canonical);if(!Rt){const vt=c.get("text-radial-offset").evaluate(L,{},s.canonical);xe=vt?My(Tt,[vt*jn,qp]):c.get("text-offset").evaluate(L,{},s.canonical).map(st=>st*jn)}let kt=w?"center":c.get("text-justify").evaluate(L,{},s.canonical);const bt=c.get("symbol-placement"),dt=bt==="point"?c.get("text-max-width").evaluate(L,{},s.canonical)*jn:0,Pt=()=>{s.bucket.allowVerticalPlacement&&Ys(Ae)&&(Q.vertical=Lf(ae,s.glyphMap,s.glyphPositions,s.imagePositions,O,dt,b,Tt,"left",et,xe,f.ah.vertical,!0,bt,Z,j))};if(!w&&Rt){const vt=new Set;if(kt==="auto")for(let qt=0;qt<Rt.values.length;qt+=2)vt.add(Gp(Rt.values[qt]));else vt.add(kt);let st=!1;for(const qt of vt)if(!Q.horizontal[qt])if(st)Q.horizontal[qt]=Q.horizontal[0];else{const Bt=Lf(ae,s.glyphMap,s.glyphPositions,s.imagePositions,O,dt,b,"center",qt,et,xe,f.ah.horizontal,!1,bt,Z,j);Bt&&(Q.horizontal[qt]=Bt,st=Bt.positionedLines.length===1)}Pt()}else{kt==="auto"&&(kt=Gp(Tt));const vt=Lf(ae,s.glyphMap,s.glyphPositions,s.imagePositions,O,dt,b,Tt,kt,et,xe,f.ah.horizontal,!1,bt,Z,j);vt&&(Q.horizontal[kt]=vt),Pt(),Ys(Ae)&&w&&T&&(Q.vertical=Lf(ae,s.glyphMap,s.glyphPositions,s.imagePositions,O,dt,b,Tt,kt,et,xe,f.ah.vertical,!1,bt,Z,j))}}let Re=!1;if(L.icon&&L.icon.name){const Ae=s.imageMap[L.icon.name];Ae&&(_e=sS(s.imagePositions[L.icon.name],c.get("icon-offset").evaluate(L,{},s.canonical),c.get("icon-anchor").evaluate(L,{},s.canonical)),Re=!!Ae.sdf,s.bucket.sdfIcons===void 0?s.bucket.sdfIcons=Re:s.bucket.sdfIcons!==Re&&He("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ae.pixelRatio!==s.bucket.pixelRatio||c.get("icon-rotate").constantOr(1)!==0)&&(s.bucket.iconsNeedLinear=!0))}const ke=Ly(Q.horizontal)||Q.vertical;s.bucket.iconsInText=!!ke&&ke.iconsInText,(ke||_e)&&SS(s.bucket,L,Q,_e,s.imageMap,g,Z,K,xe,Re,s.canonical)}s.showCollisionBoxes&&s.bucket.generateCollisionDebugBuffers()},f.bn=Ip,f.bo=Ep,f.bp=Mp,f.bq=ea,f.br=Lp,f.bs=class{constructor(s){this._marks={start:[s.url,"start"].join("#"),end:[s.url,"end"].join("#"),measure:s.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let s=performance.getEntriesByName(this._marks.measure);return s.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),s=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),s}},f.bt=function(s,i,c,d,g){return a(this,void 0,void 0,function*(){if(N())try{return yield Kt(s,i,c,d,g)}catch{}return function(b,w,T,I,L){const O=b.width,j=b.height;Ft&&Ot||(Ft=new OffscreenCanvas(O,j),Ot=Ft.getContext("2d",{willReadFrequently:!0})),Ft.width=O,Ft.height=j,Ot.drawImage(b,0,0,O,j);const Z=Ot.getImageData(w,T,I,L);return Ot.clearRect(0,0,O,j),Z.data}(s,i,c,d,g)})},f.bu=py,f.bv=_,f.bw=x,f.bx=j_,f.by=ys,f.bz=function(s){return s.message===Jt},f.c=Et,f.d=s=>a(void 0,void 0,void 0,function*(){if(s.byteLength===0)return createImageBitmap(new ImageData(1,1));const i=new Blob([new Uint8Array(s)],{type:"image/png"});try{return createImageBitmap(i)}catch(c){throw new Error(`Could not load image because of ${c.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),f.e=H,f.f=s=>new Promise((i,c)=>{const d=new Image;d.onload=()=>{i(d),URL.revokeObjectURL(d.src),d.onload=null,window.requestAnimationFrame(()=>{d.src=Yt})},d.onerror=()=>c(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const g=new Blob([new Uint8Array(s)],{type:"image/png"});d.src=s.byteLength?URL.createObjectURL(g):Yt}),f.g=zt,f.h=(s,i)=>Br(H(s,{type:"json"}),i),f.i=_t,f.j=it,f.k=ut,f.l=(s,i)=>Br(H(s,{type:"arrayBuffer"}),i),f.m=Br,f.n=function(s){return new Lp(s).readFields(eS,[])},f.o=xu,f.p=H_,f.q=Ti,f.r=fp,f.s=ht,f.t=Xs,f.u=St,f.v=ie,f.w=He,f.x=bs,f.y=function([s,i,c]){return i+=90,i*=Math.PI/180,c*=Math.PI/180,{x:s*Math.cos(i)*Math.sin(c),y:s*Math.sin(i)*Math.sin(c),z:s*Math.cos(c)}},f.z=pi}),l("worker",["./shared"],function(f){class a{constructor(W){this.keyCache={},W&&this.replace(W)}replace(W){this._layerConfigs={},this._layers={},this.update(W,[])}update(W,X){for(const he of W){this._layerConfigs[he.id]=he;const Me=this._layers[he.id]=f.az(he);Me._featureFilter=f.a6(Me.filter),this.keyCache[he.id]&&delete this.keyCache[he.id]}for(const he of X)delete this.keyCache[he],delete this._layerConfigs[he],delete this._layers[he];this.familiesBySource={};const ee=f.bh(Object.values(this._layerConfigs),this.keyCache);for(const he of ee){const Me=he.map(Ve=>this._layers[Ve.id]),Ie=Me[0];if(Ie.visibility==="none")continue;const Pe=Ie.source||"";let Se=this.familiesBySource[Pe];Se||(Se=this.familiesBySource[Pe]={});const G=Ie.sourceLayer||"_geojsonTileLayer";let je=Se[G];je||(je=Se[G]=[]),je.push(Me)}}}class _{constructor(W){const X={},ee=[];for(const Pe in W){const Se=W[Pe],G=X[Pe]={};for(const je in Se){const Ve=Se[+je];if(!Ve||Ve.bitmap.width===0||Ve.bitmap.height===0)continue;const qe={x:0,y:0,w:Ve.bitmap.width+2,h:Ve.bitmap.height+2};ee.push(qe),G[je]={rect:qe,metrics:Ve.metrics}}}const{w:he,h:Me}=f.p(ee),Ie=new f.o({width:he||1,height:Me||1});for(const Pe in W){const Se=W[Pe];for(const G in Se){const je=Se[+G];if(!je||je.bitmap.width===0||je.bitmap.height===0)continue;const Ve=X[Pe][G].rect;f.o.copy(je.bitmap,Ie,{x:0,y:0},{x:Ve.x+1,y:Ve.y+1},je.bitmap)}}this.image=Ie,this.positions=X}}f.bi("GlyphAtlas",_);class x{constructor(W){this.tileID=new f.Q(W.tileID.overscaledZ,W.tileID.wrap,W.tileID.canonical.z,W.tileID.canonical.x,W.tileID.canonical.y),this.uid=W.uid,this.zoom=W.zoom,this.pixelRatio=W.pixelRatio,this.tileSize=W.tileSize,this.source=W.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=W.showCollisionBoxes,this.collectResourceTiming=!!W.collectResourceTiming,this.returnDependencies=!!W.returnDependencies,this.promoteId=W.promoteId,this.inFlightDependencies=[]}parse(W,X,ee,he){return f._(this,void 0,void 0,function*(){this.status="parsing",this.data=W,this.collisionBoxArray=new f.a4;const Me=new f.bj(Object.keys(W.layers).sort()),Ie=new f.bk(this.tileID,this.promoteId);Ie.bucketLayerIDs=[];const Pe={},Se={featureIndex:Ie,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:ee},G=X.familiesBySource[this.source];for(const ur in G){const un=W.layers[ur];if(!un)continue;un.version===1&&f.w(`Vector tile source "${this.source}" layer "${ur}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Fn=Me.encode(ur),di=[];for(let xi=0;xi<un.length;xi++){const Kn=un.feature(xi),_o=Ie.getId(Kn,ur);di.push({feature:Kn,id:_o,index:xi,sourceLayerIndex:Fn})}for(const xi of G[ur]){const Kn=xi[0];Kn.source!==this.source&&f.w(`layer.source = ${Kn.source} does not equal this.source = ${this.source}`),Kn.minzoom&&this.zoom<Math.floor(Kn.minzoom)||Kn.maxzoom&&this.zoom>=Kn.maxzoom||Kn.visibility!=="none"&&(k(xi,this.zoom,ee),(Pe[Kn.id]=Kn.createBucket({index:Ie.bucketLayerIDs.length,layers:xi,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Fn,sourceID:this.source})).populate(di,Se,this.tileID.canonical),Ie.bucketLayerIDs.push(xi.map(_o=>_o.id)))}}const je=f.aE(Se.glyphDependencies,ur=>Object.keys(ur).map(Number));this.inFlightDependencies.forEach(ur=>ur==null?void 0:ur.abort()),this.inFlightDependencies=[];let Ve=Promise.resolve({});if(Object.keys(je).length){const ur=new AbortController;this.inFlightDependencies.push(ur),Ve=he.sendAsync({type:"GG",data:{stacks:je,source:this.source,tileID:this.tileID,type:"glyphs"}},ur)}const qe=Object.keys(Se.iconDependencies);let Ke=Promise.resolve({});if(qe.length){const ur=new AbortController;this.inFlightDependencies.push(ur),Ke=he.sendAsync({type:"GI",data:{icons:qe,source:this.source,tileID:this.tileID,type:"icons"}},ur)}const ct=Object.keys(Se.patternDependencies);let Dt=Promise.resolve({});if(ct.length){const ur=new AbortController;this.inFlightDependencies.push(ur),Dt=he.sendAsync({type:"GI",data:{icons:ct,source:this.source,tileID:this.tileID,type:"patterns"}},ur)}const[Ht,cr,_r]=yield Promise.all([Ve,Ke,Dt]),Yr=new _(Ht),An=new f.bl(cr,_r);for(const ur in Pe){const un=Pe[ur];un instanceof f.a5?(k(un.layers,this.zoom,ee),f.bm({bucket:un,glyphMap:Ht,glyphPositions:Yr.positions,imageMap:cr,imagePositions:An.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):un.hasPattern&&(un instanceof f.bn||un instanceof f.bo||un instanceof f.bp)&&(k(un.layers,this.zoom,ee),un.addFeatures(Se,this.tileID.canonical,An.patternPositions))}return this.status="done",{buckets:Object.values(Pe).filter(ur=>!ur.isEmpty()),featureIndex:Ie,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Yr.image,imageAtlas:An,glyphMap:this.returnDependencies?Ht:null,iconMap:this.returnDependencies?cr:null,glyphPositions:this.returnDependencies?Yr.positions:null}})}}function k(ge,W,X){const ee=new f.a8(W);for(const he of ge)he.recalculate(ee,X)}class S{constructor(W,X,ee){this.actor=W,this.layerIndex=X,this.availableImages=ee,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(W,X){return f._(this,void 0,void 0,function*(){const ee=yield f.l(W.request,X);try{return{vectorTile:new f.bq.VectorTile(new f.br(ee.data)),rawData:ee.data,cacheControl:ee.cacheControl,expires:ee.expires}}catch(he){const Me=new Uint8Array(ee.data);let Ie=`Unable to parse the tile at ${W.request.url}, `;throw Ie+=Me[0]===31&&Me[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${he.messge}`,new Error(Ie)}})}loadTile(W){return f._(this,void 0,void 0,function*(){const X=W.uid,ee=!!(W&&W.request&&W.request.collectResourceTiming)&&new f.bs(W.request),he=new x(W);this.loading[X]=he;const Me=new AbortController;he.abort=Me;try{const Ie=yield this.loadVectorTile(W,Me);if(delete this.loading[X],!Ie)return null;const Pe=Ie.rawData,Se={};Ie.expires&&(Se.expires=Ie.expires),Ie.cacheControl&&(Se.cacheControl=Ie.cacheControl);const G={};if(ee){const Ve=ee.finish();Ve&&(G.resourceTiming=JSON.parse(JSON.stringify(Ve)))}he.vectorTile=Ie.vectorTile;const je=he.parse(Ie.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[X]=he,this.fetching[X]={rawTileData:Pe,cacheControl:Se,resourceTiming:G};try{const Ve=yield je;return f.e({rawTileData:Pe.slice(0)},Ve,Se,G)}finally{delete this.fetching[X]}}catch(Ie){throw delete this.loading[X],he.status="done",this.loaded[X]=he,Ie}})}reloadTile(W){return f._(this,void 0,void 0,function*(){const X=W.uid;if(!this.loaded||!this.loaded[X])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const ee=this.loaded[X];if(ee.showCollisionBoxes=W.showCollisionBoxes,ee.status==="parsing"){const he=yield ee.parse(ee.vectorTile,this.layerIndex,this.availableImages,this.actor);let Me;if(this.fetching[X]){const{rawTileData:Ie,cacheControl:Pe,resourceTiming:Se}=this.fetching[X];delete this.fetching[X],Me=f.e({rawTileData:Ie.slice(0)},he,Pe,Se)}else Me=he;return Me}if(ee.status==="done"&&ee.vectorTile)return ee.parse(ee.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(W){return f._(this,void 0,void 0,function*(){const X=this.loading,ee=W.uid;X&&X[ee]&&X[ee].abort&&(X[ee].abort.abort(),delete X[ee])})}removeTile(W){return f._(this,void 0,void 0,function*(){this.loaded&&this.loaded[W.uid]&&delete this.loaded[W.uid]})}}class C{constructor(){this.loaded={}}loadTile(W){return f._(this,void 0,void 0,function*(){const{uid:X,encoding:ee,rawImageData:he,redFactor:Me,greenFactor:Ie,blueFactor:Pe,baseShift:Se}=W,G=he.width+2,je=he.height+2,Ve=f.b(he)?new f.R({width:G,height:je},yield f.bt(he,-1,-1,G,je)):he,qe=new f.bu(X,Ve,ee,Me,Ie,Pe,Se);return this.loaded=this.loaded||{},this.loaded[X]=qe,qe})}removeTile(W){const X=this.loaded,ee=W.uid;X&&X[ee]&&delete X[ee]}}function z(ge,W){if(ge.length!==0){R(ge[0],W);for(var X=1;X<ge.length;X++)R(ge[X],!W)}}function R(ge,W){for(var X=0,ee=0,he=0,Me=ge.length,Ie=Me-1;he<Me;Ie=he++){var Pe=(ge[he][0]-ge[Ie][0])*(ge[Ie][1]+ge[he][1]),Se=X+Pe;ee+=Math.abs(X)>=Math.abs(Pe)?X-Se+Pe:Pe-Se+X,X=Se}X+ee>=0!=!!W&&ge.reverse()}var D=f.bv(function ge(W,X){var ee,he=W&&W.type;if(he==="FeatureCollection")for(ee=0;ee<W.features.length;ee++)ge(W.features[ee],X);else if(he==="GeometryCollection")for(ee=0;ee<W.geometries.length;ee++)ge(W.geometries[ee],X);else if(he==="Feature")ge(W.geometry,X);else if(he==="Polygon")z(W.coordinates,X);else if(he==="MultiPolygon")for(ee=0;ee<W.coordinates.length;ee++)z(W.coordinates[ee],X);return W});const P=f.bq.VectorTileFeature.prototype.toGeoJSON;var B={exports:{}},N=f.bw,V=f.bq.VectorTileFeature,U=te;function te(ge,W){this.options=W||{},this.features=ge,this.length=ge.length}function le(ge,W){this.id=typeof ge.id=="number"?ge.id:void 0,this.type=ge.type,this.rawGeometry=ge.type===1?[ge.geometry]:ge.geometry,this.properties=ge.tags,this.extent=W||4096}te.prototype.feature=function(ge){return new le(this.features[ge],this.options.extent)},le.prototype.loadGeometry=function(){var ge=this.rawGeometry;this.geometry=[];for(var W=0;W<ge.length;W++){for(var X=ge[W],ee=[],he=0;he<X.length;he++)ee.push(new N(X[he][0],X[he][1]));this.geometry.push(ee)}return this.geometry},le.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ge=this.geometry,W=1/0,X=-1/0,ee=1/0,he=-1/0,Me=0;Me<ge.length;Me++)for(var Ie=ge[Me],Pe=0;Pe<Ie.length;Pe++){var Se=Ie[Pe];W=Math.min(W,Se.x),X=Math.max(X,Se.x),ee=Math.min(ee,Se.y),he=Math.max(he,Se.y)}return[W,ee,X,he]},le.prototype.toGeoJSON=V.prototype.toGeoJSON;var H=f.bx,J=U;function ye(ge){var W=new H;return function(X,ee){for(var he in X.layers)ee.writeMessage(3,ze,X.layers[he])}(ge,W),W.finish()}function ze(ge,W){var X;W.writeVarintField(15,ge.version||1),W.writeStringField(1,ge.name||""),W.writeVarintField(5,ge.extent||4096);var ee={keys:[],values:[],keycache:{},valuecache:{}};for(X=0;X<ge.length;X++)ee.feature=ge.feature(X),W.writeMessage(2,ne,ee);var he=ee.keys;for(X=0;X<he.length;X++)W.writeStringField(3,he[X]);var Me=ee.values;for(X=0;X<Me.length;X++)W.writeMessage(4,_t,Me[X])}function ne(ge,W){var X=ge.feature;X.id!==void 0&&W.writeVarintField(1,X.id),W.writeMessage(2,be,ge),W.writeVarintField(3,X.type),W.writeMessage(4,Qe,X)}function be(ge,W){var X=ge.feature,ee=ge.keys,he=ge.values,Me=ge.keycache,Ie=ge.valuecache;for(var Pe in X.properties){var Se=X.properties[Pe],G=Me[Pe];if(Se!==null){G===void 0&&(ee.push(Pe),Me[Pe]=G=ee.length-1),W.writeVarint(G);var je=typeof Se;je!=="string"&&je!=="boolean"&&je!=="number"&&(Se=JSON.stringify(Se));var Ve=je+":"+Se,qe=Ie[Ve];qe===void 0&&(he.push(Se),Ie[Ve]=qe=he.length-1),W.writeVarint(qe)}}}function He(ge,W){return(W<<3)+(7&ge)}function Ce(ge){return ge<<1^ge>>31}function Qe(ge,W){for(var X=ge.loadGeometry(),ee=ge.type,he=0,Me=0,Ie=X.length,Pe=0;Pe<Ie;Pe++){var Se=X[Pe],G=1;ee===1&&(G=Se.length),W.writeVarint(He(1,G));for(var je=ee===3?Se.length-1:Se.length,Ve=0;Ve<je;Ve++){Ve===1&&ee!==1&&W.writeVarint(He(2,je-1));var qe=Se[Ve].x-he,Ke=Se[Ve].y-Me;W.writeVarint(Ce(qe)),W.writeVarint(Ce(Ke)),he+=qe,Me+=Ke}ee===3&&W.writeVarint(He(7,1))}}function _t(ge,W){var X=typeof ge;X==="string"?W.writeStringField(1,ge):X==="boolean"?W.writeBooleanField(7,ge):X==="number"&&(ge%1!=0?W.writeDoubleField(3,ge):ge<0?W.writeSVarintField(6,ge):W.writeVarintField(5,ge))}B.exports=ye,B.exports.fromVectorTileJs=ye,B.exports.fromGeojsonVt=function(ge,W){W=W||{};var X={};for(var ee in ge)X[ee]=new J(ge[ee].features,W),X[ee].name=ee,X[ee].version=W.version,X[ee].extent=W.extent;return ye({layers:X})},B.exports.GeoJSONWrapper=J;var Ut=f.bv(B.exports);const Je={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ge=>ge},Yt=Math.fround||(Kt=new Float32Array(1),ge=>(Kt[0]=+ge,Kt[0]));var Kt;const Ft=3,Ot=5,Jt=6;class Et{constructor(W){this.options=Object.assign(Object.create(Je),W),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(W){const{log:X,minZoom:ee,maxZoom:he}=this.options;X&&console.time("total time");const Me=`prepare ${W.length} points`;X&&console.time(Me),this.points=W;const Ie=[];for(let Se=0;Se<W.length;Se++){const G=W[Se];if(!G.geometry)continue;const[je,Ve]=G.geometry.coordinates,qe=Yt(rr(je)),Ke=Yt(wr(Ve));Ie.push(qe,Ke,1/0,Se,-1,1),this.options.reduce&&Ie.push(0)}let Pe=this.trees[he+1]=this._createTree(Ie);X&&console.timeEnd(Me);for(let Se=he;Se>=ee;Se--){const G=+Date.now();Pe=this.trees[Se]=this._createTree(this._cluster(Pe,Se)),X&&console.log("z%d: %d clusters in %dms",Se,Pe.numItems,+Date.now()-G)}return X&&console.timeEnd("total time"),this}getClusters(W,X){let ee=((W[0]+180)%360+360)%360-180;const he=Math.max(-90,Math.min(90,W[1]));let Me=W[2]===180?180:((W[2]+180)%360+360)%360-180;const Ie=Math.max(-90,Math.min(90,W[3]));if(W[2]-W[0]>=360)ee=-180,Me=180;else if(ee>Me){const Ve=this.getClusters([ee,he,180,Ie],X),qe=this.getClusters([-180,he,Me,Ie],X);return Ve.concat(qe)}const Pe=this.trees[this._limitZoom(X)],Se=Pe.range(rr(ee),wr(Ie),rr(Me),wr(he)),G=Pe.data,je=[];for(const Ve of Se){const qe=this.stride*Ve;je.push(G[qe+Ot]>1?sr(G,qe,this.clusterProps):this.points[G[qe+Ft]])}return je}getChildren(W){const X=this._getOriginId(W),ee=this._getOriginZoom(W),he="No cluster with the specified id.",Me=this.trees[ee];if(!Me)throw new Error(he);const Ie=Me.data;if(X*this.stride>=Ie.length)throw new Error(he);const Pe=this.options.radius/(this.options.extent*Math.pow(2,ee-1)),Se=Me.within(Ie[X*this.stride],Ie[X*this.stride+1],Pe),G=[];for(const je of Se){const Ve=je*this.stride;Ie[Ve+4]===W&&G.push(Ie[Ve+Ot]>1?sr(Ie,Ve,this.clusterProps):this.points[Ie[Ve+Ft]])}if(G.length===0)throw new Error(he);return G}getLeaves(W,X,ee){const he=[];return this._appendLeaves(he,W,X=X||10,ee=ee||0,0),he}getTile(W,X,ee){const he=this.trees[this._limitZoom(W)],Me=Math.pow(2,W),{extent:Ie,radius:Pe}=this.options,Se=Pe/Ie,G=(ee-Se)/Me,je=(ee+1+Se)/Me,Ve={features:[]};return this._addTileFeatures(he.range((X-Se)/Me,G,(X+1+Se)/Me,je),he.data,X,ee,Me,Ve),X===0&&this._addTileFeatures(he.range(1-Se/Me,G,1,je),he.data,Me,ee,Me,Ve),X===Me-1&&this._addTileFeatures(he.range(0,G,Se/Me,je),he.data,-1,ee,Me,Ve),Ve.features.length?Ve:null}getClusterExpansionZoom(W){let X=this._getOriginZoom(W)-1;for(;X<=this.options.maxZoom;){const ee=this.getChildren(W);if(X++,ee.length!==1)break;W=ee[0].properties.cluster_id}return X}_appendLeaves(W,X,ee,he,Me){const Ie=this.getChildren(X);for(const Pe of Ie){const Se=Pe.properties;if(Se&&Se.cluster?Me+Se.point_count<=he?Me+=Se.point_count:Me=this._appendLeaves(W,Se.cluster_id,ee,he,Me):Me<he?Me++:W.push(Pe),W.length===ee)break}return Me}_createTree(W){const X=new f.au(W.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ee=0;ee<W.length;ee+=this.stride)X.add(W[ee],W[ee+1]);return X.finish(),X.data=W,X}_addTileFeatures(W,X,ee,he,Me,Ie){for(const Pe of W){const Se=Pe*this.stride,G=X[Se+Ot]>1;let je,Ve,qe;if(G)je=zt(X,Se,this.clusterProps),Ve=X[Se],qe=X[Se+1];else{const Dt=this.points[X[Se+Ft]];je=Dt.properties;const[Ht,cr]=Dt.geometry.coordinates;Ve=rr(Ht),qe=wr(cr)}const Ke={type:1,geometry:[[Math.round(this.options.extent*(Ve*Me-ee)),Math.round(this.options.extent*(qe*Me-he))]],tags:je};let ct;ct=G||this.options.generateId?X[Se+Ft]:this.points[X[Se+Ft]].id,ct!==void 0&&(Ke.id=ct),Ie.features.push(Ke)}}_limitZoom(W){return Math.max(this.options.minZoom,Math.min(Math.floor(+W),this.options.maxZoom+1))}_cluster(W,X){const{radius:ee,extent:he,reduce:Me,minPoints:Ie}=this.options,Pe=ee/(he*Math.pow(2,X)),Se=W.data,G=[],je=this.stride;for(let Ve=0;Ve<Se.length;Ve+=je){if(Se[Ve+2]<=X)continue;Se[Ve+2]=X;const qe=Se[Ve],Ke=Se[Ve+1],ct=W.within(Se[Ve],Se[Ve+1],Pe),Dt=Se[Ve+Ot];let Ht=Dt;for(const cr of ct){const _r=cr*je;Se[_r+2]>X&&(Ht+=Se[_r+Ot])}if(Ht>Dt&&Ht>=Ie){let cr,_r=qe*Dt,Yr=Ke*Dt,An=-1;const ur=((Ve/je|0)<<5)+(X+1)+this.points.length;for(const un of ct){const Fn=un*je;if(Se[Fn+2]<=X)continue;Se[Fn+2]=X;const di=Se[Fn+Ot];_r+=Se[Fn]*di,Yr+=Se[Fn+1]*di,Se[Fn+4]=ur,Me&&(cr||(cr=this._map(Se,Ve,!0),An=this.clusterProps.length,this.clusterProps.push(cr)),Me(cr,this._map(Se,Fn)))}Se[Ve+4]=ur,G.push(_r/Ht,Yr/Ht,1/0,ur,-1,Ht),Me&&G.push(An)}else{for(let cr=0;cr<je;cr++)G.push(Se[Ve+cr]);if(Ht>1)for(const cr of ct){const _r=cr*je;if(!(Se[_r+2]<=X)){Se[_r+2]=X;for(let Yr=0;Yr<je;Yr++)G.push(Se[_r+Yr])}}}}return G}_getOriginId(W){return W-this.points.length>>5}_getOriginZoom(W){return(W-this.points.length)%32}_map(W,X,ee){if(W[X+Ot]>1){const Ie=this.clusterProps[W[X+Jt]];return ee?Object.assign({},Ie):Ie}const he=this.points[W[X+Ft]].properties,Me=this.options.map(he);return ee&&Me===he?Object.assign({},Me):Me}}function sr(ge,W,X){return{type:"Feature",id:ge[W+Ft],properties:zt(ge,W,X),geometry:{type:"Point",coordinates:[(ee=ge[W],360*(ee-.5)),gr(ge[W+1])]}};var ee}function zt(ge,W,X){const ee=ge[W+Ot],he=ee>=1e4?`${Math.round(ee/1e3)}k`:ee>=1e3?Math.round(ee/100)/10+"k":ee,Me=ge[W+Jt],Ie=Me===-1?{}:Object.assign({},X[Me]);return Object.assign(Ie,{cluster:!0,cluster_id:ge[W+Ft],point_count:ee,point_count_abbreviated:he})}function rr(ge){return ge/360+.5}function wr(ge){const W=Math.sin(ge*Math.PI/180),X=.5-.25*Math.log((1+W)/(1-W))/Math.PI;return X<0?0:X>1?1:X}function gr(ge){const W=(180-360*ge)*Math.PI/180;return 360*Math.atan(Math.exp(W))/Math.PI-90}function Br(ge,W,X,ee){for(var he,Me=ee,Ie=X-W>>1,Pe=X-W,Se=ge[W],G=ge[W+1],je=ge[X],Ve=ge[X+1],qe=W+3;qe<X;qe+=3){var Ke=ht(ge[qe],ge[qe+1],Se,G,je,Ve);if(Ke>Me)he=qe,Me=Ke;else if(Ke===Me){var ct=Math.abs(qe-Ie);ct<Pe&&(he=qe,Pe=ct)}}Me>ee&&(he-W>3&&Br(ge,W,he,ee),ge[he+2]=Me,X-he>3&&Br(ge,he,X,ee))}function ht(ge,W,X,ee,he,Me){var Ie=he-X,Pe=Me-ee;if(Ie!==0||Pe!==0){var Se=((ge-X)*Ie+(W-ee)*Pe)/(Ie*Ie+Pe*Pe);Se>1?(X=he,ee=Me):Se>0&&(X+=Ie*Se,ee+=Pe*Se)}return(Ie=ge-X)*Ie+(Pe=W-ee)*Pe}function Mt(ge,W,X,ee){var he={id:ge===void 0?null:ge,type:W,geometry:X,tags:ee,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Me){var Ie=Me.geometry,Pe=Me.type;if(Pe==="Point"||Pe==="MultiPoint"||Pe==="LineString")De(Me,Ie);else if(Pe==="Polygon"||Pe==="MultiLineString")for(var Se=0;Se<Ie.length;Se++)De(Me,Ie[Se]);else if(Pe==="MultiPolygon")for(Se=0;Se<Ie.length;Se++)for(var G=0;G<Ie[Se].length;G++)De(Me,Ie[Se][G])}(he),he}function De(ge,W){for(var X=0;X<W.length;X+=3)ge.minX=Math.min(ge.minX,W[X]),ge.minY=Math.min(ge.minY,W[X+1]),ge.maxX=Math.max(ge.maxX,W[X]),ge.maxY=Math.max(ge.maxY,W[X+1])}function ut(ge,W,X,ee){if(W.geometry){var he=W.geometry.coordinates,Me=W.geometry.type,Ie=Math.pow(X.tolerance/((1<<X.maxZoom)*X.extent),2),Pe=[],Se=W.id;if(X.promoteId?Se=W.properties[X.promoteId]:X.generateId&&(Se=ee||0),Me==="Point")it(he,Pe);else if(Me==="MultiPoint")for(var G=0;G<he.length;G++)it(he[G],Pe);else if(Me==="LineString")xt(he,Pe,Ie,!1);else if(Me==="MultiLineString"){if(X.lineMetrics){for(G=0;G<he.length;G++)xt(he[G],Pe=[],Ie,!1),ge.push(Mt(Se,"LineString",Pe,W.properties));return}ie(he,Pe,Ie,!1)}else if(Me==="Polygon")ie(he,Pe,Ie,!0);else{if(Me!=="MultiPolygon"){if(Me==="GeometryCollection"){for(G=0;G<W.geometry.geometries.length;G++)ut(ge,{id:Se,geometry:W.geometry.geometries[G],properties:W.properties},X,ee);return}throw new Error("Input data is not a valid GeoJSON object.")}for(G=0;G<he.length;G++){var je=[];ie(he[G],je,Ie,!0),Pe.push(je)}}ge.push(Mt(Se,Me,Pe,W.properties))}}function it(ge,W){W.push(nr(ge[0])),W.push(Ne(ge[1])),W.push(0)}function xt(ge,W,X,ee){for(var he,Me,Ie=0,Pe=0;Pe<ge.length;Pe++){var Se=nr(ge[Pe][0]),G=Ne(ge[Pe][1]);W.push(Se),W.push(G),W.push(0),Pe>0&&(Ie+=ee?(he*G-Se*Me)/2:Math.sqrt(Math.pow(Se-he,2)+Math.pow(G-Me,2))),he=Se,Me=G}var je=W.length-3;W[2]=1,Br(W,0,je,X),W[je+2]=1,W.size=Math.abs(Ie),W.start=0,W.end=W.size}function ie(ge,W,X,ee){for(var he=0;he<ge.length;he++){var Me=[];xt(ge[he],Me,X,ee),W.push(Me)}}function nr(ge){return ge/360+.5}function Ne(ge){var W=Math.sin(ge*Math.PI/180),X=.5-.25*Math.log((1+W)/(1-W))/Math.PI;return X<0?0:X>1?1:X}function We(ge,W,X,ee,he,Me,Ie,Pe){if(ee/=W,Me>=(X/=W)&&Ie<ee)return ge;if(Ie<X||Me>=ee)return null;for(var Se=[],G=0;G<ge.length;G++){var je=ge[G],Ve=je.geometry,qe=je.type,Ke=he===0?je.minX:je.minY,ct=he===0?je.maxX:je.maxY;if(Ke>=X&&ct<ee)Se.push(je);else if(!(ct<X||Ke>=ee)){var Dt=[];if(qe==="Point"||qe==="MultiPoint")wt(Ve,Dt,X,ee,he);else if(qe==="LineString")xn(Ve,Dt,X,ee,he,!1,Pe.lineMetrics);else if(qe==="MultiLineString")In(Ve,Dt,X,ee,he,!1);else if(qe==="Polygon")In(Ve,Dt,X,ee,he,!0);else if(qe==="MultiPolygon")for(var Ht=0;Ht<Ve.length;Ht++){var cr=[];In(Ve[Ht],cr,X,ee,he,!0),cr.length&&Dt.push(cr)}if(Dt.length){if(Pe.lineMetrics&&qe==="LineString"){for(Ht=0;Ht<Dt.length;Ht++)Se.push(Mt(je.id,qe,Dt[Ht],je.tags));continue}qe!=="LineString"&&qe!=="MultiLineString"||(Dt.length===1?(qe="LineString",Dt=Dt[0]):qe="MultiLineString"),qe!=="Point"&&qe!=="MultiPoint"||(qe=Dt.length===3?"Point":"MultiPoint"),Se.push(Mt(je.id,qe,Dt,je.tags))}}}return Se.length?Se:null}function wt(ge,W,X,ee,he){for(var Me=0;Me<ge.length;Me+=3){var Ie=ge[Me+he];Ie>=X&&Ie<=ee&&(W.push(ge[Me]),W.push(ge[Me+1]),W.push(ge[Me+2]))}}function xn(ge,W,X,ee,he,Me,Ie){for(var Pe,Se,G=Sn(ge),je=he===0?oi:Xo,Ve=ge.start,qe=0;qe<ge.length-3;qe+=3){var Ke=ge[qe],ct=ge[qe+1],Dt=ge[qe+2],Ht=ge[qe+3],cr=ge[qe+4],_r=he===0?Ke:ct,Yr=he===0?Ht:cr,An=!1;Ie&&(Pe=Math.sqrt(Math.pow(Ke-Ht,2)+Math.pow(ct-cr,2))),_r<X?Yr>X&&(Se=je(G,Ke,ct,Ht,cr,X),Ie&&(G.start=Ve+Pe*Se)):_r>ee?Yr<ee&&(Se=je(G,Ke,ct,Ht,cr,ee),Ie&&(G.start=Ve+Pe*Se)):ii(G,Ke,ct,Dt),Yr<X&&_r>=X&&(Se=je(G,Ke,ct,Ht,cr,X),An=!0),Yr>ee&&_r<=ee&&(Se=je(G,Ke,ct,Ht,cr,ee),An=!0),!Me&&An&&(Ie&&(G.end=Ve+Pe*Se),W.push(G),G=Sn(ge)),Ie&&(Ve+=Pe)}var ur=ge.length-3;Ke=ge[ur],ct=ge[ur+1],Dt=ge[ur+2],(_r=he===0?Ke:ct)>=X&&_r<=ee&&ii(G,Ke,ct,Dt),ur=G.length-3,Me&&ur>=3&&(G[ur]!==G[0]||G[ur+1]!==G[1])&&ii(G,G[0],G[1],G[2]),G.length&&W.push(G)}function Sn(ge){var W=[];return W.size=ge.size,W.start=ge.start,W.end=ge.end,W}function In(ge,W,X,ee,he,Me){for(var Ie=0;Ie<ge.length;Ie++)xn(ge[Ie],W,X,ee,he,Me,!1)}function ii(ge,W,X,ee){ge.push(W),ge.push(X),ge.push(ee)}function oi(ge,W,X,ee,he,Me){var Ie=(Me-W)/(ee-W);return ge.push(Me),ge.push(X+(he-X)*Ie),ge.push(1),Ie}function Xo(ge,W,X,ee,he,Me){var Ie=(Me-X)/(he-X);return ge.push(W+(ee-W)*Ie),ge.push(Me),ge.push(1),Ie}function Jr(ge,W){for(var X=[],ee=0;ee<ge.length;ee++){var he,Me=ge[ee],Ie=Me.type;if(Ie==="Point"||Ie==="MultiPoint"||Ie==="LineString")he=lt(Me.geometry,W);else if(Ie==="MultiLineString"||Ie==="Polygon"){he=[];for(var Pe=0;Pe<Me.geometry.length;Pe++)he.push(lt(Me.geometry[Pe],W))}else if(Ie==="MultiPolygon")for(he=[],Pe=0;Pe<Me.geometry.length;Pe++){for(var Se=[],G=0;G<Me.geometry[Pe].length;G++)Se.push(lt(Me.geometry[Pe][G],W));he.push(Se)}X.push(Mt(Me.id,Ie,he,Me.tags))}return X}function lt(ge,W){var X=[];X.size=ge.size,ge.start!==void 0&&(X.start=ge.start,X.end=ge.end);for(var ee=0;ee<ge.length;ee+=3)X.push(ge[ee]+W,ge[ee+1],ge[ee+2]);return X}function Xn(ge,W){if(ge.transformed)return ge;var X,ee,he,Me=1<<ge.z,Ie=ge.x,Pe=ge.y;for(X=0;X<ge.features.length;X++){var Se=ge.features[X],G=Se.geometry,je=Se.type;if(Se.geometry=[],je===1)for(ee=0;ee<G.length;ee+=2)Se.geometry.push(kn(G[ee],G[ee+1],W,Me,Ie,Pe));else for(ee=0;ee<G.length;ee++){var Ve=[];for(he=0;he<G[ee].length;he+=2)Ve.push(kn(G[ee][he],G[ee][he+1],W,Me,Ie,Pe));Se.geometry.push(Ve)}}return ge.transformed=!0,ge}function kn(ge,W,X,ee,he,Me){return[Math.round(X*(ge*ee-he)),Math.round(X*(W*ee-Me))]}function Fo(ge,W,X,ee,he){for(var Me=W===he.maxZoom?0:he.tolerance/((1<<W)*he.extent),Ie={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:X,y:ee,z:W,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Pe=0;Pe<ge.length;Pe++){Ie.numFeatures++,Nr(Ie,ge[Pe],Me,he);var Se=ge[Pe].minX,G=ge[Pe].minY,je=ge[Pe].maxX,Ve=ge[Pe].maxY;Se<Ie.minX&&(Ie.minX=Se),G<Ie.minY&&(Ie.minY=G),je>Ie.maxX&&(Ie.maxX=je),Ve>Ie.maxY&&(Ie.maxY=Ve)}return Ie}function Nr(ge,W,X,ee){var he=W.geometry,Me=W.type,Ie=[];if(Me==="Point"||Me==="MultiPoint")for(var Pe=0;Pe<he.length;Pe+=3)Ie.push(he[Pe]),Ie.push(he[Pe+1]),ge.numPoints++,ge.numSimplified++;else if(Me==="LineString")mt(Ie,he,ge,X,!1,!1);else if(Me==="MultiLineString"||Me==="Polygon")for(Pe=0;Pe<he.length;Pe++)mt(Ie,he[Pe],ge,X,Me==="Polygon",Pe===0);else if(Me==="MultiPolygon")for(var Se=0;Se<he.length;Se++){var G=he[Se];for(Pe=0;Pe<G.length;Pe++)mt(Ie,G[Pe],ge,X,!0,Pe===0)}if(Ie.length){var je=W.tags||null;if(Me==="LineString"&&ee.lineMetrics){for(var Ve in je={},W.tags)je[Ve]=W.tags[Ve];je.mapbox_clip_start=he.start/he.size,je.mapbox_clip_end=he.end/he.size}var qe={geometry:Ie,type:Me==="Polygon"||Me==="MultiPolygon"?3:Me==="LineString"||Me==="MultiLineString"?2:1,tags:je};W.id!==null&&(qe.id=W.id),ge.features.push(qe)}}function mt(ge,W,X,ee,he,Me){var Ie=ee*ee;if(ee>0&&W.size<(he?Ie:ee))X.numPoints+=W.length/3;else{for(var Pe=[],Se=0;Se<W.length;Se+=3)(ee===0||W[Se+2]>Ie)&&(X.numSimplified++,Pe.push(W[Se]),Pe.push(W[Se+1])),X.numPoints++;he&&function(G,je){for(var Ve=0,qe=0,Ke=G.length,ct=Ke-2;qe<Ke;ct=qe,qe+=2)Ve+=(G[qe]-G[ct])*(G[qe+1]+G[ct+1]);if(Ve>0===je)for(qe=0,Ke=G.length;qe<Ke/2;qe+=2){var Dt=G[qe],Ht=G[qe+1];G[qe]=G[Ke-2-qe],G[qe+1]=G[Ke-1-qe],G[Ke-2-qe]=Dt,G[Ke-1-qe]=Ht}}(Pe,Me),ge.push(Pe)}}function ir(ge,W){var X=(W=this.options=function(he,Me){for(var Ie in Me)he[Ie]=Me[Ie];return he}(Object.create(this.options),W)).debug;if(X&&console.time("preprocess data"),W.maxZoom<0||W.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(W.promoteId&&W.generateId)throw new Error("promoteId and generateId cannot be used together.");var ee=function(he,Me){var Ie=[];if(he.type==="FeatureCollection")for(var Pe=0;Pe<he.features.length;Pe++)ut(Ie,he.features[Pe],Me,Pe);else ut(Ie,he.type==="Feature"?he:{geometry:he},Me);return Ie}(ge,W);this.tiles={},this.tileCoords=[],X&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",W.indexMaxZoom,W.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ee=function(he,Me){var Ie=Me.buffer/Me.extent,Pe=he,Se=We(he,1,-1-Ie,Ie,0,-1,2,Me),G=We(he,1,1-Ie,2+Ie,0,-1,2,Me);return(Se||G)&&(Pe=We(he,1,-Ie,1+Ie,0,-1,2,Me)||[],Se&&(Pe=Jr(Se,1).concat(Pe)),G&&(Pe=Pe.concat(Jr(G,-1)))),Pe}(ee,W),ee.length&&this.splitTile(ee,0,0,0),X&&(ee.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Qt(ge,W,X){return 32*((1<<ge)*X+W)+ge}function jr(ge,W){return W?ge.properties[W]:ge.id}function wi(ge,W){if(ge==null)return!0;if(ge.type==="Feature")return jr(ge,W)!=null;if(ge.type==="FeatureCollection"){const X=new Set;for(const ee of ge.features){const he=jr(ee,W);if(he==null||X.has(he))return!1;X.add(he)}return!0}return!1}function tr(ge,W){const X=new Map;if(ge!=null)if(ge.type==="Feature")X.set(jr(ge,W),ge);else for(const ee of ge.features)X.set(jr(ee,W),ee);return X}ir.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},ir.prototype.splitTile=function(ge,W,X,ee,he,Me,Ie){for(var Pe=[ge,W,X,ee],Se=this.options,G=Se.debug;Pe.length;){ee=Pe.pop(),X=Pe.pop(),W=Pe.pop(),ge=Pe.pop();var je=1<<W,Ve=Qt(W,X,ee),qe=this.tiles[Ve];if(!qe&&(G>1&&console.time("creation"),qe=this.tiles[Ve]=Fo(ge,W,X,ee,Se),this.tileCoords.push({z:W,x:X,y:ee}),G)){G>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",W,X,ee,qe.numFeatures,qe.numPoints,qe.numSimplified),console.timeEnd("creation"));var Ke="z"+W;this.stats[Ke]=(this.stats[Ke]||0)+1,this.total++}if(qe.source=ge,he){if(W===Se.maxZoom||W===he)continue;var ct=1<<he-W;if(X!==Math.floor(Me/ct)||ee!==Math.floor(Ie/ct))continue}else if(W===Se.indexMaxZoom||qe.numPoints<=Se.indexMaxPoints)continue;if(qe.source=null,ge.length!==0){G>1&&console.time("clipping");var Dt,Ht,cr,_r,Yr,An,ur=.5*Se.buffer/Se.extent,un=.5-ur,Fn=.5+ur,di=1+ur;Dt=Ht=cr=_r=null,Yr=We(ge,je,X-ur,X+Fn,0,qe.minX,qe.maxX,Se),An=We(ge,je,X+un,X+di,0,qe.minX,qe.maxX,Se),ge=null,Yr&&(Dt=We(Yr,je,ee-ur,ee+Fn,1,qe.minY,qe.maxY,Se),Ht=We(Yr,je,ee+un,ee+di,1,qe.minY,qe.maxY,Se),Yr=null),An&&(cr=We(An,je,ee-ur,ee+Fn,1,qe.minY,qe.maxY,Se),_r=We(An,je,ee+un,ee+di,1,qe.minY,qe.maxY,Se),An=null),G>1&&console.timeEnd("clipping"),Pe.push(Dt||[],W+1,2*X,2*ee),Pe.push(Ht||[],W+1,2*X,2*ee+1),Pe.push(cr||[],W+1,2*X+1,2*ee),Pe.push(_r||[],W+1,2*X+1,2*ee+1)}}},ir.prototype.getTile=function(ge,W,X){var ee=this.options,he=ee.extent,Me=ee.debug;if(ge<0||ge>24)return null;var Ie=1<<ge,Pe=Qt(ge,W=(W%Ie+Ie)%Ie,X);if(this.tiles[Pe])return Xn(this.tiles[Pe],he);Me>1&&console.log("drilling down to z%d-%d-%d",ge,W,X);for(var Se,G=ge,je=W,Ve=X;!Se&&G>0;)G--,je=Math.floor(je/2),Ve=Math.floor(Ve/2),Se=this.tiles[Qt(G,je,Ve)];return Se&&Se.source?(Me>1&&console.log("found parent tile z%d-%d-%d",G,je,Ve),Me>1&&console.time("drilling down"),this.splitTile(Se.source,G,je,Ve,ge,W,X),Me>1&&console.timeEnd("drilling down"),this.tiles[Pe]?Xn(this.tiles[Pe],he):null):null};class io extends S{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(W,X){return f._(this,void 0,void 0,function*(){const ee=W.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const he=this._geoJSONIndex.getTile(ee.z,ee.x,ee.y);if(!he)return null;const Me=new class{constructor(Pe){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=f.W,this.length=Pe.length,this._features=Pe}feature(Pe){return new class{constructor(Se){this._feature=Se,this.extent=f.W,this.type=Se.type,this.properties=Se.tags,"id"in Se&&!isNaN(Se.id)&&(this.id=parseInt(Se.id,10))}loadGeometry(){if(this._feature.type===1){const Se=[];for(const G of this._feature.geometry)Se.push([new f.P(G[0],G[1])]);return Se}{const Se=[];for(const G of this._feature.geometry){const je=[];for(const Ve of G)je.push(new f.P(Ve[0],Ve[1]));Se.push(je)}return Se}}toGeoJSON(Se,G,je){return P.call(this,Se,G,je)}}(this._features[Pe])}}(he.features);let Ie=Ut(Me);return Ie.byteOffset===0&&Ie.byteLength===Ie.buffer.byteLength||(Ie=new Uint8Array(Ie)),{vectorTile:Me,rawData:Ie.buffer}})}loadData(W){return f._(this,void 0,void 0,function*(){var X;(X=this._pendingRequest)===null||X===void 0||X.abort();const ee=!!(W&&W.request&&W.request.collectResourceTiming)&&new f.bs(W.request);this._pendingRequest=new AbortController;try{let he=yield this.loadGeoJSON(W,this._pendingRequest);if(delete this._pendingRequest,typeof he!="object")throw new Error(`Input data given to '${W.source}' is not a valid GeoJSON object.`);if(D(he,!0),W.filter){const Ie=f.by(W.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Ie.result==="error")throw new Error(Ie.value.map(Se=>`${Se.key}: ${Se.message}`).join(", "));he={type:"FeatureCollection",features:he.features.filter(Se=>Ie.value.evaluate({zoom:0},Se))}}this._geoJSONIndex=W.cluster?new Et(function({superclusterOptions:Ie,clusterProperties:Pe}){if(!Pe||!Ie)return Ie;const Se={},G={},je={accumulated:null,zoom:0},Ve={properties:null},qe=Object.keys(Pe);for(const Ke of qe){const[ct,Dt]=Pe[Ke],Ht=f.by(Dt),cr=f.by(typeof ct=="string"?[ct,["accumulated"],["get",Ke]]:ct);Se[Ke]=Ht.value,G[Ke]=cr.value}return Ie.map=Ke=>{Ve.properties=Ke;const ct={};for(const Dt of qe)ct[Dt]=Se[Dt].evaluate(je,Ve);return ct},Ie.reduce=(Ke,ct)=>{Ve.properties=ct;for(const Dt of qe)je.accumulated=Ke[Dt],Ke[Dt]=G[Dt].evaluate(je,Ve)},Ie}(W)).load(he.features):function(Ie,Pe){return new ir(Ie,Pe)}(he,W.geojsonVtOptions),this.loaded={};const Me={};if(ee){const Ie=ee.finish();Ie&&(Me.resourceTiming={},Me.resourceTiming[W.source]=JSON.parse(JSON.stringify(Ie)))}return Me}catch(he){if(delete this._pendingRequest,f.bz(he))return{abandoned:!0};throw he}})}reloadTile(W){const X=this.loaded;return X&&X[W.uid]?super.reloadTile(W):this.loadTile(W)}loadGeoJSON(W,X){return f._(this,void 0,void 0,function*(){const{promoteId:ee}=W;if(W.request){const he=yield f.h(W.request,X);return this._dataUpdateable=wi(he.data,ee)?tr(he.data,ee):void 0,he.data}if(typeof W.data=="string")try{const he=JSON.parse(W.data);return this._dataUpdateable=wi(he,ee)?tr(he,ee):void 0,he}catch{throw new Error(`Input data given to '${W.source}' is not a valid GeoJSON object.`)}if(!W.dataDiff)throw new Error(`Input data given to '${W.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${W.source}`);return function(he,Me,Ie){var Pe,Se,G,je;if(Me.removeAll&&he.clear(),Me.remove)for(const Ve of Me.remove)he.delete(Ve);if(Me.add)for(const Ve of Me.add){const qe=jr(Ve,Ie);qe!=null&&he.set(qe,Ve)}if(Me.update)for(const Ve of Me.update){let qe=he.get(Ve.id);if(qe==null)continue;const Ke=!Ve.removeAllProperties&&(((Pe=Ve.removeProperties)===null||Pe===void 0?void 0:Pe.length)>0||((Se=Ve.addOrUpdateProperties)===null||Se===void 0?void 0:Se.length)>0);if((Ve.newGeometry||Ve.removeAllProperties||Ke)&&(qe=Object.assign({},qe),he.set(Ve.id,qe),Ke&&(qe.properties=Object.assign({},qe.properties))),Ve.newGeometry&&(qe.geometry=Ve.newGeometry),Ve.removeAllProperties)qe.properties={};else if(((G=Ve.removeProperties)===null||G===void 0?void 0:G.length)>0)for(const ct of Ve.removeProperties)Object.prototype.hasOwnProperty.call(qe.properties,ct)&&delete qe.properties[ct];if(((je=Ve.addOrUpdateProperties)===null||je===void 0?void 0:je.length)>0)for(const{key:ct,value:Dt}of Ve.addOrUpdateProperties)qe.properties[ct]=Dt}}(this._dataUpdateable,W.dataDiff,ee),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(W){return f._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(W){return this._geoJSONIndex.getClusterExpansionZoom(W.clusterId)}getClusterChildren(W){return this._geoJSONIndex.getChildren(W.clusterId)}getClusterLeaves(W){return this._geoJSONIndex.getLeaves(W.clusterId,W.limit,W.offset)}}class cn{constructor(W){this.self=W,this.actor=new f.C(W),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(X,ee)=>{if(this.externalWorkerSourceTypes[X])throw new Error(`Worker source with name "${X}" already registered.`);this.externalWorkerSourceTypes[X]=ee},this.self.addProtocol=f.bf,this.self.removeProtocol=f.bg,this.self.registerRTLTextPlugin=X=>{if(f.bA.isParsed())throw new Error("RTL text plugin already registered.");f.bA.setMethods(X)},this.actor.registerMessageHandler("LDT",(X,ee)=>this._getDEMWorkerSource(X,ee.source).loadTile(ee)),this.actor.registerMessageHandler("RDT",(X,ee)=>f._(this,void 0,void 0,function*(){this._getDEMWorkerSource(X,ee.source).removeTile(ee)})),this.actor.registerMessageHandler("GCEZ",(X,ee)=>f._(this,void 0,void 0,function*(){return this._getWorkerSource(X,ee.type,ee.source).getClusterExpansionZoom(ee)})),this.actor.registerMessageHandler("GCC",(X,ee)=>f._(this,void 0,void 0,function*(){return this._getWorkerSource(X,ee.type,ee.source).getClusterChildren(ee)})),this.actor.registerMessageHandler("GCL",(X,ee)=>f._(this,void 0,void 0,function*(){return this._getWorkerSource(X,ee.type,ee.source).getClusterLeaves(ee)})),this.actor.registerMessageHandler("LD",(X,ee)=>this._getWorkerSource(X,ee.type,ee.source).loadData(ee)),this.actor.registerMessageHandler("LT",(X,ee)=>this._getWorkerSource(X,ee.type,ee.source).loadTile(ee)),this.actor.registerMessageHandler("RT",(X,ee)=>this._getWorkerSource(X,ee.type,ee.source).reloadTile(ee)),this.actor.registerMessageHandler("AT",(X,ee)=>this._getWorkerSource(X,ee.type,ee.source).abortTile(ee)),this.actor.registerMessageHandler("RMT",(X,ee)=>this._getWorkerSource(X,ee.type,ee.source).removeTile(ee)),this.actor.registerMessageHandler("RS",(X,ee)=>f._(this,void 0,void 0,function*(){if(!this.workerSources[X]||!this.workerSources[X][ee.type]||!this.workerSources[X][ee.type][ee.source])return;const he=this.workerSources[X][ee.type][ee.source];delete this.workerSources[X][ee.type][ee.source],he.removeSource!==void 0&&he.removeSource(ee)})),this.actor.registerMessageHandler("RM",X=>f._(this,void 0,void 0,function*(){delete this.layerIndexes[X],delete this.availableImages[X],delete this.workerSources[X],delete this.demWorkerSources[X]})),this.actor.registerMessageHandler("SR",(X,ee)=>f._(this,void 0,void 0,function*(){this.referrer=ee})),this.actor.registerMessageHandler("SRPS",(X,ee)=>this._syncRTLPluginState(X,ee)),this.actor.registerMessageHandler("IS",(X,ee)=>f._(this,void 0,void 0,function*(){this.self.importScripts(ee)})),this.actor.registerMessageHandler("SI",(X,ee)=>this._setImages(X,ee)),this.actor.registerMessageHandler("UL",(X,ee)=>f._(this,void 0,void 0,function*(){this._getLayerIndex(X).update(ee.layers,ee.removedIds)})),this.actor.registerMessageHandler("SL",(X,ee)=>f._(this,void 0,void 0,function*(){this._getLayerIndex(X).replace(ee)}))}_setImages(W,X){return f._(this,void 0,void 0,function*(){this.availableImages[W]=X;for(const ee in this.workerSources[W]){const he=this.workerSources[W][ee];for(const Me in he)he[Me].availableImages=X}})}_syncRTLPluginState(W,X){return f._(this,void 0,void 0,function*(){if(f.bA.isParsed())return f.bA.getState();if(X.pluginStatus!=="loading")return f.bA.setState(X),X;const ee=X.pluginURL;if(this.self.importScripts(ee),f.bA.isParsed()){const he={pluginStatus:"loaded",pluginURL:ee};return f.bA.setState(he),he}throw f.bA.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${ee}`)})}_getAvailableImages(W){let X=this.availableImages[W];return X||(X=[]),X}_getLayerIndex(W){let X=this.layerIndexes[W];return X||(X=this.layerIndexes[W]=new a),X}_getWorkerSource(W,X,ee){if(this.workerSources[W]||(this.workerSources[W]={}),this.workerSources[W][X]||(this.workerSources[W][X]={}),!this.workerSources[W][X][ee]){const he={sendAsync:(Me,Ie)=>(Me.targetMapId=W,this.actor.sendAsync(Me,Ie))};switch(X){case"vector":this.workerSources[W][X][ee]=new S(he,this._getLayerIndex(W),this._getAvailableImages(W));break;case"geojson":this.workerSources[W][X][ee]=new io(he,this._getLayerIndex(W),this._getAvailableImages(W));break;default:this.workerSources[W][X][ee]=new this.externalWorkerSourceTypes[X](he,this._getLayerIndex(W),this._getAvailableImages(W))}}return this.workerSources[W][X][ee]}_getDEMWorkerSource(W,X){return this.demWorkerSources[W]||(this.demWorkerSources[W]={}),this.demWorkerSources[W][X]||(this.demWorkerSources[W][X]=new C),this.demWorkerSources[W][X]}}return f.i(self)&&(self.worker=new cn(self)),cn}),l("index",["exports","./shared"],function(f,a){var _="4.1.3";let x,k;const S={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:y=>new Promise((o,h)=>{const p=requestAnimationFrame(o);y.signal.addEventListener("abort",()=>{cancelAnimationFrame(p),h(a.c())})}),getImageData(y,o=0){return this.getImageCanvasContext(y).getImageData(-o,-o,y.width+2*o,y.height+2*o)},getImageCanvasContext(y){const o=window.document.createElement("canvas"),h=o.getContext("2d",{willReadFrequently:!0});if(!h)throw new Error("failed to create canvas 2d context");return o.width=y.width,o.height=y.height,h.drawImage(y,0,0,y.width,y.height),h},resolveURL:y=>(x||(x=document.createElement("a")),x.href=y,x.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(k==null&&(k=matchMedia("(prefers-reduced-motion: reduce)")),k.matches)}};class C{static testProp(o){if(!C.docStyle)return o[0];for(let h=0;h<o.length;h++)if(o[h]in C.docStyle)return o[h];return o[0]}static create(o,h,p){const m=window.document.createElement(o);return h!==void 0&&(m.className=h),p&&p.appendChild(m),m}static createNS(o,h){return window.document.createElementNS(o,h)}static disableDrag(){C.docStyle&&C.selectProp&&(C.userSelect=C.docStyle[C.selectProp],C.docStyle[C.selectProp]="none")}static enableDrag(){C.docStyle&&C.selectProp&&(C.docStyle[C.selectProp]=C.userSelect)}static setTransform(o,h){o.style[C.transformProp]=h}static addEventListener(o,h,p,m={}){o.addEventListener(h,p,"passive"in m?m:m.capture)}static removeEventListener(o,h,p,m={}){o.removeEventListener(h,p,"passive"in m?m:m.capture)}static suppressClickInternal(o){o.preventDefault(),o.stopPropagation(),window.removeEventListener("click",C.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",C.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",C.suppressClickInternal,!0)},0)}static getScale(o){const h=o.getBoundingClientRect();return{x:h.width/o.offsetWidth||1,y:h.height/o.offsetHeight||1,boundingClientRect:h}}static getPoint(o,h,p){const m=h.boundingClientRect;return new a.P((p.clientX-m.left)/h.x-o.clientLeft,(p.clientY-m.top)/h.y-o.clientTop)}static mousePos(o,h){const p=C.getScale(o);return C.getPoint(o,p,h)}static touchPos(o,h){const p=[],m=C.getScale(o);for(let v=0;v<h.length;v++)p.push(C.getPoint(o,m,h[v]));return p}static mouseButton(o){return o.button}static remove(o){o.parentNode&&o.parentNode.removeChild(o)}}C.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,C.selectProp=C.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),C.transformProp=C.testProp(["transform","WebkitTransform"]);const z={supported:!1,testSupport:function(y){!P&&D&&(B?N(y):R=y)}};let R,D,P=!1,B=!1;function N(y){const o=y.createTexture();y.bindTexture(y.TEXTURE_2D,o);try{if(y.texImage2D(y.TEXTURE_2D,0,y.RGBA,y.RGBA,y.UNSIGNED_BYTE,D),y.isContextLost())return;z.supported=!0}catch{}y.deleteTexture(o),P=!0}var V;typeof document<"u"&&(D=document.createElement("img"),D.onload=function(){R&&N(R),R=null,B=!0},D.onerror=function(){P=!0,R=null},D.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(y){let o,h,p,m;y.resetRequestQueue=()=>{o=[],h=0,p=0,m={}},y.addThrottleControl=A=>{const F=p++;return m[F]=A,F},y.removeThrottleControl=A=>{delete m[A],E()},y.getImage=(A,F,$=!0)=>new Promise((q,Y)=>{z.supported&&(A.headers||(A.headers={}),A.headers.accept="image/webp,*/*"),a.e(A,{type:"image"}),o.push({abortController:F,requestParameters:A,supportImageRefresh:$,state:"queued",onError:de=>{Y(de)},onSuccess:de=>{q(de)}}),E()});const v=A=>a._(this,void 0,void 0,function*(){A.state="running";const{requestParameters:F,supportImageRefresh:$,onError:q,onSuccess:Y,abortController:de}=A,fe=$===!1&&!a.i(self)&&!a.g(F.url)&&(!F.headers||Object.keys(F.headers).reduce((Ee,$e)=>Ee&&$e==="accept",!0));h++;const ve=fe?M(F,de):a.m(F,de);try{const Ee=yield ve;delete A.abortController,A.state="completed",Ee.data instanceof HTMLImageElement||a.b(Ee.data)?Y(Ee):Ee.data&&Y({data:yield(se=Ee.data,typeof createImageBitmap=="function"?a.d(se):a.f(se)),cacheControl:Ee.cacheControl,expires:Ee.expires})}catch(Ee){delete A.abortController,q(Ee)}finally{h--,E()}var se}),E=()=>{const A=(()=>{for(const F of Object.keys(m))if(m[F]())return!0;return!1})()?a.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:a.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let F=h;F<A&&o.length>0;F++){const $=o.shift();$.abortController.signal.aborted?F--:v($)}},M=(A,F)=>new Promise(($,q)=>{const Y=new Image,de=A.url,fe=A.credentials;fe&&fe==="include"?Y.crossOrigin="use-credentials":(fe&&fe==="same-origin"||!a.s(de))&&(Y.crossOrigin="anonymous"),F.signal.addEventListener("abort",()=>{Y.src="",q(a.c())}),Y.fetchPriority="high",Y.onload=()=>{Y.onerror=Y.onload=null,$({data:Y})},Y.onerror=()=>{Y.onerror=Y.onload=null,F.signal.aborted||q(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},Y.src=de})}(V||(V={})),V.resetRequestQueue();class U{constructor(o){this._transformRequestFn=o}transformRequest(o,h){return this._transformRequestFn&&this._transformRequestFn(o,h)||{url:o}}normalizeSpriteURL(o,h,p){const m=function(v){const E=v.match(te);if(!E)throw new Error(`Unable to parse URL "${v}"`);return{protocol:E[1],authority:E[2],path:E[3]||"/",params:E[4]?E[4].split("&"):[]}}(o);return m.path+=`${h}${p}`,function(v){const E=v.params.length?`?${v.params.join("&")}`:"";return`${v.protocol}://${v.authority}${v.path}${E}`}(m)}setTransformRequest(o){this._transformRequestFn=o}}const te=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function le(y){var o=new a.A(3);return o[0]=y[0],o[1]=y[1],o[2]=y[2],o}var H,J=function(y,o,h){return y[0]=o[0]-h[0],y[1]=o[1]-h[1],y[2]=o[2]-h[2],y};H=new a.A(3),a.A!=Float32Array&&(H[0]=0,H[1]=0,H[2]=0);var ye=function(y){var o=y[0],h=y[1];return o*o+h*h};function ze(y){const o=[];if(typeof y=="string")o.push({id:"default",url:y});else if(y&&y.length>0){const h=[];for(const{id:p,url:m}of y){const v=`${p}${m}`;h.indexOf(v)===-1&&(h.push(v),o.push({id:p,url:m}))}}return o}(function(){var y=new a.A(2);a.A!=Float32Array&&(y[0]=0,y[1]=0)})();class ne{constructor(o,h,p,m){this.context=o,this.format=p,this.texture=o.gl.createTexture(),this.update(h,m)}update(o,h,p){const{width:m,height:v}=o,E=!(this.size&&this.size[0]===m&&this.size[1]===v||p),{context:M}=this,{gl:A}=M;if(this.useMipmap=!!(h&&h.useMipmap),A.bindTexture(A.TEXTURE_2D,this.texture),M.pixelStoreUnpackFlipY.set(!1),M.pixelStoreUnpack.set(1),M.pixelStoreUnpackPremultiplyAlpha.set(this.format===A.RGBA&&(!h||h.premultiply!==!1)),E)this.size=[m,v],o instanceof HTMLImageElement||o instanceof HTMLCanvasElement||o instanceof HTMLVideoElement||o instanceof ImageData||a.b(o)?A.texImage2D(A.TEXTURE_2D,0,this.format,this.format,A.UNSIGNED_BYTE,o):A.texImage2D(A.TEXTURE_2D,0,this.format,m,v,0,this.format,A.UNSIGNED_BYTE,o.data);else{const{x:F,y:$}=p||{x:0,y:0};o instanceof HTMLImageElement||o instanceof HTMLCanvasElement||o instanceof HTMLVideoElement||o instanceof ImageData||a.b(o)?A.texSubImage2D(A.TEXTURE_2D,0,F,$,A.RGBA,A.UNSIGNED_BYTE,o):A.texSubImage2D(A.TEXTURE_2D,0,F,$,m,v,A.RGBA,A.UNSIGNED_BYTE,o.data)}this.useMipmap&&this.isSizePowerOfTwo()&&A.generateMipmap(A.TEXTURE_2D)}bind(o,h,p){const{context:m}=this,{gl:v}=m;v.bindTexture(v.TEXTURE_2D,this.texture),p!==v.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(p=v.LINEAR),o!==this.filter&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MAG_FILTER,o),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MIN_FILTER,p||o),this.filter=o),h!==this.wrap&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_S,h),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_T,h),this.wrap=h)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:o}=this.context;o.deleteTexture(this.texture),this.texture=null}}function be(y){const{userImage:o}=y;return!!(o&&o.render&&o.render())&&(y.data.replace(new Uint8Array(o.data.buffer)),!0)}class He extends a.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new a.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(o){if(this.loaded!==o&&(this.loaded=o,o)){for(const{ids:h,promiseResolve:p}of this.requestors)p(this._getImagesForIds(h));this.requestors=[]}}getImage(o){const h=this.images[o];if(h&&!h.data&&h.spriteData){const p=h.spriteData;h.data=new a.R({width:p.width,height:p.height},p.context.getImageData(p.x,p.y,p.width,p.height).data),h.spriteData=null}return h}addImage(o,h){if(this.images[o])throw new Error(`Image id ${o} already exist, use updateImage instead`);this._validate(o,h)&&(this.images[o]=h)}_validate(o,h){let p=!0;const m=h.data||h.spriteData;return this._validateStretch(h.stretchX,m&&m.width)||(this.fire(new a.j(new Error(`Image "${o}" has invalid "stretchX" value`))),p=!1),this._validateStretch(h.stretchY,m&&m.height)||(this.fire(new a.j(new Error(`Image "${o}" has invalid "stretchY" value`))),p=!1),this._validateContent(h.content,h)||(this.fire(new a.j(new Error(`Image "${o}" has invalid "content" value`))),p=!1),p}_validateStretch(o,h){if(!o)return!0;let p=0;for(const m of o){if(m[0]<p||m[1]<m[0]||h<m[1])return!1;p=m[1]}return!0}_validateContent(o,h){if(!o)return!0;if(o.length!==4)return!1;const p=h.spriteData,m=p&&p.width||h.data.width,v=p&&p.height||h.data.height;return!(o[0]<0||m<o[0]||o[1]<0||v<o[1]||o[2]<0||m<o[2]||o[3]<0||v<o[3]||o[2]<o[0]||o[3]<o[1])}updateImage(o,h,p=!0){const m=this.getImage(o);if(p&&(m.data.width!==h.data.width||m.data.height!==h.data.height))throw new Error(`size mismatch between old image (${m.data.width}x${m.data.height}) and new image (${h.data.width}x${h.data.height}).`);h.version=m.version+1,this.images[o]=h,this.updatedImages[o]=!0}removeImage(o){const h=this.images[o];delete this.images[o],delete this.patterns[o],h.userImage&&h.userImage.onRemove&&h.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(o){return new Promise((h,p)=>{let m=!0;if(!this.isLoaded())for(const v of o)this.images[v]||(m=!1);this.isLoaded()||m?h(this._getImagesForIds(o)):this.requestors.push({ids:o,promiseResolve:h})})}_getImagesForIds(o){const h={};for(const p of o){let m=this.getImage(p);m||(this.fire(new a.k("styleimagemissing",{id:p})),m=this.getImage(p)),m?h[p]={data:m.data.clone(),pixelRatio:m.pixelRatio,sdf:m.sdf,version:m.version,stretchX:m.stretchX,stretchY:m.stretchY,content:m.content,hasRenderCallback:!!(m.userImage&&m.userImage.render)}:a.w(`Image "${p}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return h}getPixelSize(){const{width:o,height:h}=this.atlasImage;return{width:o,height:h}}getPattern(o){const h=this.patterns[o],p=this.getImage(o);if(!p)return null;if(h&&h.position.version===p.version)return h.position;if(h)h.position.version=p.version;else{const m={w:p.data.width+2,h:p.data.height+2,x:0,y:0},v=new a.I(m,p);this.patterns[o]={bin:m,position:v}}return this._updatePatternAtlas(),this.patterns[o].position}bind(o){const h=o.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new ne(o,this.atlasImage,h.RGBA),this.atlasTexture.bind(h.LINEAR,h.CLAMP_TO_EDGE)}_updatePatternAtlas(){const o=[];for(const v in this.patterns)o.push(this.patterns[v].bin);const{w:h,h:p}=a.p(o),m=this.atlasImage;m.resize({width:h||1,height:p||1});for(const v in this.patterns){const{bin:E}=this.patterns[v],M=E.x+1,A=E.y+1,F=this.getImage(v).data,$=F.width,q=F.height;a.R.copy(F,m,{x:0,y:0},{x:M,y:A},{width:$,height:q}),a.R.copy(F,m,{x:0,y:q-1},{x:M,y:A-1},{width:$,height:1}),a.R.copy(F,m,{x:0,y:0},{x:M,y:A+q},{width:$,height:1}),a.R.copy(F,m,{x:$-1,y:0},{x:M-1,y:A},{width:1,height:q}),a.R.copy(F,m,{x:0,y:0},{x:M+$,y:A},{width:1,height:q})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(o){for(const h of o){if(this.callbackDispatchedThisFrame[h])continue;this.callbackDispatchedThisFrame[h]=!0;const p=this.getImage(h);p||a.w(`Image with ID: "${h}" was not found`),be(p)&&this.updateImage(h,p)}}}const Ce=1e20;function Qe(y,o,h,p,m,v,E,M,A){for(let F=o;F<o+p;F++)_t(y,h*v+F,v,m,E,M,A);for(let F=h;F<h+m;F++)_t(y,F*v+o,1,p,E,M,A)}function _t(y,o,h,p,m,v,E){v[0]=0,E[0]=-Ce,E[1]=Ce,m[0]=y[o];for(let M=1,A=0,F=0;M<p;M++){m[M]=y[o+M*h];const $=M*M;do{const q=v[A];F=(m[M]-m[q]+$-q*q)/(M-q)/2}while(F<=E[A]&&--A>-1);A++,v[A]=M,E[A]=F,E[A+1]=Ce}for(let M=0,A=0;M<p;M++){for(;E[A+1]<M;)A++;const F=v[A],$=M-F;y[o+M*h]=m[F]+$*$}}class Ut{constructor(o,h){this.requestManager=o,this.localIdeographFontFamily=h,this.entries={}}setURL(o){this.url=o}getGlyphs(o){return a._(this,void 0,void 0,function*(){const h=[];for(const v in o)for(const E of o[v])h.push(this._getAndCacheGlyphsPromise(v,E));const p=yield Promise.all(h),m={};for(const{stack:v,id:E,glyph:M}of p)m[v]||(m[v]={}),m[v][E]=M&&{id:M.id,bitmap:M.bitmap.clone(),metrics:M.metrics};return m})}_getAndCacheGlyphsPromise(o,h){return a._(this,void 0,void 0,function*(){let p=this.entries[o];p||(p=this.entries[o]={glyphs:{},requests:{},ranges:{}});let m=p.glyphs[h];if(m!==void 0)return{stack:o,id:h,glyph:m};if(m=this._tinySDF(p,o,h),m)return p.glyphs[h]=m,{stack:o,id:h,glyph:m};const v=Math.floor(h/256);if(256*v>65535)throw new Error("glyphs > 65535 not supported");if(p.ranges[v])return{stack:o,id:h,glyph:m};if(!this.url)throw new Error("glyphsUrl is not set");if(!p.requests[v]){const M=Ut.loadGlyphRange(o,v,this.url,this.requestManager);p.requests[v]=M}const E=yield p.requests[v];for(const M in E)this._doesCharSupportLocalGlyph(+M)||(p.glyphs[+M]=E[+M]);return p.ranges[v]=!0,{stack:o,id:h,glyph:E[h]||null}})}_doesCharSupportLocalGlyph(o){return!!this.localIdeographFontFamily&&(a.u["CJK Unified Ideographs"](o)||a.u["Hangul Syllables"](o)||a.u.Hiragana(o)||a.u.Katakana(o))}_tinySDF(o,h,p){const m=this.localIdeographFontFamily;if(!m||!this._doesCharSupportLocalGlyph(p))return;let v=o.tinySDF;if(!v){let M="400";/bold/i.test(h)?M="900":/medium/i.test(h)?M="500":/light/i.test(h)&&(M="200"),v=o.tinySDF=new Ut.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:m,fontWeight:M})}const E=v.draw(String.fromCharCode(p));return{id:p,bitmap:new a.o({width:E.width||60,height:E.height||60},E.data),metrics:{width:E.glyphWidth/2||24,height:E.glyphHeight/2||24,left:E.glyphLeft/2+.5||0,top:E.glyphTop/2-27.5||-8,advance:E.glyphAdvance/2||24,isDoubleResolution:!0}}}}Ut.loadGlyphRange=function(y,o,h,p){return a._(this,void 0,void 0,function*(){const m=256*o,v=m+255,E=p.transformRequest(h.replace("{fontstack}",y).replace("{range}",`${m}-${v}`),"Glyphs"),M=yield a.l(E,new AbortController);if(!M||!M.data)throw new Error(`Could not load glyph range. range: ${o}, ${m}-${v}`);const A={};for(const F of a.n(M.data))A[F.id]=F;return A})},Ut.TinySDF=class{constructor({fontSize:y=24,buffer:o=3,radius:h=8,cutoff:p=.25,fontFamily:m="sans-serif",fontWeight:v="normal",fontStyle:E="normal"}={}){this.buffer=o,this.cutoff=p,this.radius=h;const M=this.size=y+4*o,A=this._createCanvas(M),F=this.ctx=A.getContext("2d",{willReadFrequently:!0});F.font=`${E} ${v} ${y}px ${m}`,F.textBaseline="alphabetic",F.textAlign="left",F.fillStyle="black",this.gridOuter=new Float64Array(M*M),this.gridInner=new Float64Array(M*M),this.f=new Float64Array(M),this.z=new Float64Array(M+1),this.v=new Uint16Array(M)}_createCanvas(y){const o=document.createElement("canvas");return o.width=o.height=y,o}draw(y){const{width:o,actualBoundingBoxAscent:h,actualBoundingBoxDescent:p,actualBoundingBoxLeft:m,actualBoundingBoxRight:v}=this.ctx.measureText(y),E=Math.ceil(h),M=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(v-m))),A=Math.min(this.size-this.buffer,E+Math.ceil(p)),F=M+2*this.buffer,$=A+2*this.buffer,q=Math.max(F*$,0),Y=new Uint8ClampedArray(q),de={data:Y,width:F,height:$,glyphWidth:M,glyphHeight:A,glyphTop:E,glyphLeft:0,glyphAdvance:o};if(M===0||A===0)return de;const{ctx:fe,buffer:ve,gridInner:se,gridOuter:Ee}=this;fe.clearRect(ve,ve,M,A),fe.fillText(y,ve,ve+E);const $e=fe.getImageData(ve,ve,M,A);Ee.fill(Ce,0,q),se.fill(0,0,q);for(let we=0;we<A;we++)for(let Le=0;Le<M;Le++){const Ge=$e.data[4*(we*M+Le)+3]/255;if(Ge===0)continue;const Ze=(we+ve)*F+Le+ve;if(Ge===1)Ee[Ze]=0,se[Ze]=Ce;else{const Xe=.5-Ge;Ee[Ze]=Xe>0?Xe*Xe:0,se[Ze]=Xe<0?Xe*Xe:0}}Qe(Ee,0,0,F,$,F,this.f,this.v,this.z),Qe(se,ve,ve,M,A,F,this.f,this.v,this.z);for(let we=0;we<q;we++){const Le=Math.sqrt(Ee[we])-Math.sqrt(se[we]);Y[we]=Math.round(255-255*(Le/this.radius+this.cutoff))}return de}};class Je{constructor(){this.specification=a.v.light.position}possiblyEvaluate(o,h){return a.y(o.expression.evaluate(h))}interpolate(o,h,p){return{x:a.z.number(o.x,h.x,p),y:a.z.number(o.y,h.y,p),z:a.z.number(o.z,h.z,p)}}}let Yt;class Kt extends a.E{constructor(o){super(),Yt=Yt||new a.q({anchor:new a.D(a.v.light.anchor),position:new Je,color:new a.D(a.v.light.color),intensity:new a.D(a.v.light.intensity)}),this._transitionable=new a.T(Yt),this.setLight(o),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(o,h={}){if(!this._validate(a.r,o,h))for(const p in o){const m=o[p];p.endsWith("-transition")?this._transitionable.setTransition(p.slice(0,-11),m):this._transitionable.setValue(p,m)}}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,h,p){return(!p||p.validate!==!1)&&a.t(this,o.call(a.x,{value:h,style:{glyphs:!0,sprite:!0},styleSpec:a.v}))}}class Ft{constructor(o,h){this.width=o,this.height=h,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(o,h){const p=o.join(",")+String(h);return this.dashEntry[p]||(this.dashEntry[p]=this.addDash(o,h)),this.dashEntry[p]}getDashRanges(o,h,p){const m=[];let v=o.length%2==1?-o[o.length-1]*p:0,E=o[0]*p,M=!0;m.push({left:v,right:E,isDash:M,zeroLength:o[0]===0});let A=o[0];for(let F=1;F<o.length;F++){M=!M;const $=o[F];v=A*p,A+=$,E=A*p,m.push({left:v,right:E,isDash:M,zeroLength:$===0})}return m}addRoundDash(o,h,p){const m=h/2;for(let v=-p;v<=p;v++){const E=this.width*(this.nextRow+p+v);let M=0,A=o[M];for(let F=0;F<this.width;F++){F/A.right>1&&(A=o[++M]);const $=Math.abs(F-A.left),q=Math.abs(F-A.right),Y=Math.min($,q);let de;const fe=v/p*(m+1);if(A.isDash){const ve=m-Math.abs(fe);de=Math.sqrt(Y*Y+ve*ve)}else de=m-Math.sqrt(Y*Y+fe*fe);this.data[E+F]=Math.max(0,Math.min(255,de+128))}}}addRegularDash(o){for(let M=o.length-1;M>=0;--M){const A=o[M],F=o[M+1];A.zeroLength?o.splice(M,1):F&&F.isDash===A.isDash&&(F.left=A.left,o.splice(M,1))}const h=o[0],p=o[o.length-1];h.isDash===p.isDash&&(h.left=p.left-this.width,p.right=h.right+this.width);const m=this.width*this.nextRow;let v=0,E=o[v];for(let M=0;M<this.width;M++){M/E.right>1&&(E=o[++v]);const A=Math.abs(M-E.left),F=Math.abs(M-E.right),$=Math.min(A,F);this.data[m+M]=Math.max(0,Math.min(255,(E.isDash?$:-$)+128))}}addDash(o,h){const p=h?7:0,m=2*p+1;if(this.nextRow+m>this.height)return a.w("LineAtlas out of space"),null;let v=0;for(let M=0;M<o.length;M++)v+=o[M];if(v!==0){const M=this.width/v,A=this.getDashRanges(o,this.width,M);h?this.addRoundDash(A,M,p):this.addRegularDash(A)}const E={y:(this.nextRow+p+.5)/this.height,height:2*p/this.height,width:v};return this.nextRow+=m,this.dirty=!0,E}bind(o){const h=o.gl;this.texture?(h.bindTexture(h.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,h.texSubImage2D(h.TEXTURE_2D,0,0,0,this.width,this.height,h.ALPHA,h.UNSIGNED_BYTE,this.data))):(this.texture=h.createTexture(),h.bindTexture(h.TEXTURE_2D,this.texture),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.LINEAR),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.LINEAR),h.texImage2D(h.TEXTURE_2D,0,h.ALPHA,this.width,this.height,0,h.ALPHA,h.UNSIGNED_BYTE,this.data))}}const Ot="maplibre_preloaded_worker_pool";class Jt{constructor(){this.active={}}acquire(o){if(!this.workers)for(this.workers=[];this.workers.length<Jt.workerCount;)this.workers.push(new Worker(a.a.WORKER_URL));return this.active[o]=!0,this.workers.slice()}release(o){delete this.active[o],this.numActive()===0&&(this.workers.forEach(h=>{h.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Ot]}numActive(){return Object.keys(this.active).length}}const Et=Math.floor(S.hardwareConcurrency/2);let sr,zt;function rr(){return sr||(sr=new Jt),sr}Jt.workerCount=a.B(globalThis)?Math.max(Math.min(Et,3),1):1;class wr{constructor(o,h){this.workerPool=o,this.actors=[],this.currentActor=0,this.id=h;const p=this.workerPool.acquire(h);for(let m=0;m<p.length;m++){const v=new a.C(p[m],h);v.name=`Worker ${m}`,this.actors.push(v)}if(!this.actors.length)throw new Error("No actors found")}broadcast(o,h){const p=[];for(const m of this.actors)p.push(m.sendAsync({type:o,data:h}));return Promise.all(p)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(o=!0){this.actors.forEach(h=>{h.remove()}),this.actors=[],o&&this.workerPool.release(this.id)}registerMessageHandler(o,h){for(const p of this.actors)p.registerMessageHandler(o,h)}}function gr(){return zt||(zt=new wr(rr(),a.G),zt.registerMessageHandler("GR",(y,o,h)=>a.m(o,h))),zt}function Br(y,o){const h=a.F();return a.H(h,h,[1,1,0]),a.J(h,h,[.5*y.width,.5*y.height,1]),a.K(h,h,y.calculatePosMatrix(o.toUnwrapped()))}function ht(y,o,h,p,m,v){const E=function(q,Y,de){if(q)for(const fe of q){const ve=Y[fe];if(ve&&ve.source===de&&ve.type==="fill-extrusion")return!0}else for(const fe in Y){const ve=Y[fe];if(ve.source===de&&ve.type==="fill-extrusion")return!0}return!1}(m&&m.layers,o,y.id),M=v.maxPitchScaleFactor(),A=y.tilesIn(p,M,E);A.sort(Mt);const F=[];for(const q of A)F.push({wrappedTileID:q.tileID.wrapped().key,queryResults:q.tile.queryRenderedFeatures(o,h,y._state,q.queryGeometry,q.cameraQueryGeometry,q.scale,m,v,M,Br(y.transform,q.tileID))});const $=function(q){const Y={},de={};for(const fe of q){const ve=fe.queryResults,se=fe.wrappedTileID,Ee=de[se]=de[se]||{};for(const $e in ve){const we=ve[$e],Le=Ee[$e]=Ee[$e]||{},Ge=Y[$e]=Y[$e]||[];for(const Ze of we)Le[Ze.featureIndex]||(Le[Ze.featureIndex]=!0,Ge.push(Ze))}}return Y}(F);for(const q in $)$[q].forEach(Y=>{const de=Y.feature,fe=y.getFeatureState(de.layer["source-layer"],de.id);de.source=de.layer.source,de.layer["source-layer"]&&(de.sourceLayer=de.layer["source-layer"]),de.state=fe});return $}function Mt(y,o){const h=y.tileID,p=o.tileID;return h.overscaledZ-p.overscaledZ||h.canonical.y-p.canonical.y||h.wrap-p.wrap||h.canonical.x-p.canonical.x}function De(y,o,h){return a._(this,void 0,void 0,function*(){let p=y;if(y.url?p=(yield a.h(o.transformRequest(y.url,"Source"),h)).data:yield S.frameAsync(h),!p)return null;const m=a.L(a.e(p,y),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in p&&p.vector_layers&&(m.vectorLayerIds=p.vector_layers.map(v=>v.id)),m})}class ut{constructor(o,h){o&&(h?this.setSouthWest(o).setNorthEast(h):Array.isArray(o)&&(o.length===4?this.setSouthWest([o[0],o[1]]).setNorthEast([o[2],o[3]]):this.setSouthWest(o[0]).setNorthEast(o[1])))}setNorthEast(o){return this._ne=o instanceof a.M?new a.M(o.lng,o.lat):a.M.convert(o),this}setSouthWest(o){return this._sw=o instanceof a.M?new a.M(o.lng,o.lat):a.M.convert(o),this}extend(o){const h=this._sw,p=this._ne;let m,v;if(o instanceof a.M)m=o,v=o;else{if(!(o instanceof ut))return Array.isArray(o)?o.length===4||o.every(Array.isArray)?this.extend(ut.convert(o)):this.extend(a.M.convert(o)):o&&("lng"in o||"lon"in o)&&"lat"in o?this.extend(a.M.convert(o)):this;if(m=o._sw,v=o._ne,!m||!v)return this}return h||p?(h.lng=Math.min(m.lng,h.lng),h.lat=Math.min(m.lat,h.lat),p.lng=Math.max(v.lng,p.lng),p.lat=Math.max(v.lat,p.lat)):(this._sw=new a.M(m.lng,m.lat),this._ne=new a.M(v.lng,v.lat)),this}getCenter(){return new a.M((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new a.M(this.getWest(),this.getNorth())}getSouthEast(){return new a.M(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(o){const{lng:h,lat:p}=a.M.convert(o);let m=this._sw.lng<=h&&h<=this._ne.lng;return this._sw.lng>this._ne.lng&&(m=this._sw.lng>=h&&h>=this._ne.lng),this._sw.lat<=p&&p<=this._ne.lat&&m}static convert(o){return o instanceof ut?o:o&&new ut(o)}static fromLngLat(o,h=0){const p=360*h/40075017,m=p/Math.cos(Math.PI/180*o.lat);return new ut(new a.M(o.lng-m,o.lat-p),new a.M(o.lng+m,o.lat+p))}}class it{constructor(o,h,p){this.bounds=ut.convert(this.validateBounds(o)),this.minzoom=h||0,this.maxzoom=p||24}validateBounds(o){return Array.isArray(o)&&o.length===4?[Math.max(-180,o[0]),Math.max(-90,o[1]),Math.min(180,o[2]),Math.min(90,o[3])]:[-180,-90,180,90]}contains(o){const h=Math.pow(2,o.z),p=Math.floor(a.N(this.bounds.getWest())*h),m=Math.floor(a.O(this.bounds.getNorth())*h),v=Math.ceil(a.N(this.bounds.getEast())*h),E=Math.ceil(a.O(this.bounds.getSouth())*h);return o.x>=p&&o.x<v&&o.y>=m&&o.y<E}}class xt extends a.E{constructor(o,h,p,m){if(super(),this.id=o,this.dispatcher=p,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,a.e(this,a.L(h,["url","scheme","tileSize","promoteId"])),this._options=a.e({type:"vector"},h),this._collectResourceTiming=h.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(m)}load(){return a._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new a.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const o=yield De(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),o&&(a.e(this,o),o.bounds&&(this.tileBounds=new it(o.bounds,this.minzoom,this.maxzoom)),this.fire(new a.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.k("data",{dataType:"source",sourceDataType:"content"})))}catch(o){this._tileJSONRequest=null,this.fire(new a.j(o))}})}loaded(){return this._loaded}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}onAdd(o){this.map=o,this.load()}setSourceProperty(o){this._tileJSONRequest&&this._tileJSONRequest.abort(),o(),this.load()}setTiles(o){return this.setSourceProperty(()=>{this._options.tiles=o}),this}setUrl(o){return this.setSourceProperty(()=>{this.url=o,this._options.url=o}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return a.e({},this._options)}loadTile(o){return a._(this,void 0,void 0,function*(){const h=o.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),p={request:this.map._requestManager.transformRequest(h,"Tile"),uid:o.uid,tileID:o.tileID,zoom:o.tileID.overscaledZ,tileSize:this.tileSize*o.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};p.request.collectResourceTiming=this._collectResourceTiming;let m="RT";if(o.actor&&o.state!=="expired"){if(o.state==="loading")return new Promise((v,E)=>{o.reloadPromise={resolve:v,reject:E}})}else o.actor=this.dispatcher.getActor(),m="LT";o.abortController=new AbortController;try{const v=yield o.actor.sendAsync({type:m,data:p},o.abortController);if(delete o.abortController,o.aborted)return;this._afterTileLoadWorkerResponse(o,v)}catch(v){if(delete o.abortController,o.aborted)return;if(v&&v.status!==404)throw v;this._afterTileLoadWorkerResponse(o,null)}})}_afterTileLoadWorkerResponse(o,h){if(h&&h.resourceTiming&&(o.resourceTiming=h.resourceTiming),h&&this.map._refreshExpiredTiles&&o.setExpiryData(h),o.loadVectorData(h,this.map.painter),o.reloadPromise){const p=o.reloadPromise;o.reloadPromise=null,this.loadTile(o).then(p.resolve).catch(p.reject)}}abortTile(o){return a._(this,void 0,void 0,function*(){o.abortController&&(o.abortController.abort(),delete o.abortController),o.actor&&(yield o.actor.sendAsync({type:"AT",data:{uid:o.uid,type:this.type,source:this.id}}))})}unloadTile(o){return a._(this,void 0,void 0,function*(){o.unloadVectorData(),o.actor&&(yield o.actor.sendAsync({type:"RMT",data:{uid:o.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class ie extends a.E{constructor(o,h,p,m){super(),this.id=o,this.dispatcher=p,this.setEventedParent(m),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=a.e({type:"raster"},h),a.e(this,a.L(h,["url","scheme","tileSize"]))}load(){return a._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new a.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const o=yield De(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,o&&(a.e(this,o),o.bounds&&(this.tileBounds=new it(o.bounds,this.minzoom,this.maxzoom)),this.fire(new a.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.k("data",{dataType:"source",sourceDataType:"content"})))}catch(o){this._tileJSONRequest=null,this.fire(new a.j(o))}})}loaded(){return this._loaded}onAdd(o){this.map=o,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(o){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),o(),this.load()}setTiles(o){return this.setSourceProperty(()=>{this._options.tiles=o}),this}setUrl(o){return this.setSourceProperty(()=>{this.url=o,this._options.url=o}),this}serialize(){return a.e({},this._options)}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}loadTile(o){return a._(this,void 0,void 0,function*(){const h=o.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);o.abortController=new AbortController;try{const p=yield V.getImage(this.map._requestManager.transformRequest(h,"Tile"),o.abortController,this.map._refreshExpiredTiles);if(delete o.abortController,o.aborted)return void(o.state="unloaded");if(p&&p.data){this.map._refreshExpiredTiles&&p.cacheControl&&p.expires&&o.setExpiryData({cacheControl:p.cacheControl,expires:p.expires});const m=this.map.painter.context,v=m.gl,E=p.data;o.texture=this.map.painter.getTileTexture(E.width),o.texture?o.texture.update(E,{useMipmap:!0}):(o.texture=new ne(m,E,v.RGBA,{useMipmap:!0}),o.texture.bind(v.LINEAR,v.CLAMP_TO_EDGE,v.LINEAR_MIPMAP_NEAREST),m.extTextureFilterAnisotropic&&v.texParameterf(v.TEXTURE_2D,m.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,m.extTextureFilterAnisotropicMax)),o.state="loaded"}}catch(p){if(delete o.abortController,o.aborted)o.state="unloaded";else if(p)throw o.state="errored",p}})}abortTile(o){return a._(this,void 0,void 0,function*(){o.abortController&&(o.abortController.abort(),delete o.abortController)})}unloadTile(o){return a._(this,void 0,void 0,function*(){o.texture&&this.map.painter.saveTileTexture(o.texture)})}hasTransition(){return!1}}class nr extends ie{constructor(o,h,p,m){super(o,h,p,m),this.type="raster-dem",this.maxzoom=22,this._options=a.e({type:"raster-dem"},h),this.encoding=h.encoding||"mapbox",this.redFactor=h.redFactor,this.greenFactor=h.greenFactor,this.blueFactor=h.blueFactor,this.baseShift=h.baseShift}loadTile(o){return a._(this,void 0,void 0,function*(){const h=o.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),p=this.map._requestManager.transformRequest(h,"Tile");o.neighboringTiles=this._getNeighboringTiles(o.tileID),o.abortController=new AbortController;try{const m=yield V.getImage(p,o.abortController,this.map._refreshExpiredTiles);if(delete o.abortController,o.aborted)return void(o.state="unloaded");if(m&&m.data){const v=m.data;this.map._refreshExpiredTiles&&m.cacheControl&&m.expires&&o.setExpiryData({cacheControl:m.cacheControl,expires:m.expires});const E=a.b(v)&&a.S()?v:yield this.readImageNow(v),M={type:this.type,uid:o.uid,source:this.id,rawImageData:E,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!o.actor||o.state==="expired"){o.actor=this.dispatcher.getActor();const A=yield o.actor.sendAsync({type:"LDT",data:M});o.dem=A,o.needsHillshadePrepare=!0,o.needsTerrainPrepare=!0,o.state="loaded"}}}catch(m){if(delete o.abortController,o.aborted)o.state="unloaded";else if(m)throw o.state="errored",m}})}readImageNow(o){return a._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&a.U()){const h=o.width+2,p=o.height+2;try{return new a.R({width:h,height:p},yield a.V(o,-1,-1,h,p))}catch{}}return S.getImageData(o,1)})}_getNeighboringTiles(o){const h=o.canonical,p=Math.pow(2,h.z),m=(h.x-1+p)%p,v=h.x===0?o.wrap-1:o.wrap,E=(h.x+1+p)%p,M=h.x+1===p?o.wrap+1:o.wrap,A={};return A[new a.Q(o.overscaledZ,v,h.z,m,h.y).key]={backfilled:!1},A[new a.Q(o.overscaledZ,M,h.z,E,h.y).key]={backfilled:!1},h.y>0&&(A[new a.Q(o.overscaledZ,v,h.z,m,h.y-1).key]={backfilled:!1},A[new a.Q(o.overscaledZ,o.wrap,h.z,h.x,h.y-1).key]={backfilled:!1},A[new a.Q(o.overscaledZ,M,h.z,E,h.y-1).key]={backfilled:!1}),h.y+1<p&&(A[new a.Q(o.overscaledZ,v,h.z,m,h.y+1).key]={backfilled:!1},A[new a.Q(o.overscaledZ,o.wrap,h.z,h.x,h.y+1).key]={backfilled:!1},A[new a.Q(o.overscaledZ,M,h.z,E,h.y+1).key]={backfilled:!1}),A}unloadTile(o){return a._(this,void 0,void 0,function*(){o.demTexture&&this.map.painter.saveTileTexture(o.demTexture),o.fbo&&(o.fbo.destroy(),delete o.fbo),o.dem&&delete o.dem,delete o.neighboringTiles,o.state="unloaded",o.actor&&(yield o.actor.sendAsync({type:"RDT",data:{type:this.type,uid:o.uid,source:this.id}}))})}}class Ne extends a.E{constructor(o,h,p,m){super(),this.id=o,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=p.getActor(),this.setEventedParent(m),this._data=h.data,this._options=a.e({},h),this._collectResourceTiming=h.collectResourceTiming,h.maxzoom!==void 0&&(this.maxzoom=h.maxzoom),h.type&&(this.type=h.type),h.attribution&&(this.attribution=h.attribution),this.promoteId=h.promoteId;const v=a.W/this.tileSize;this.workerOptions=a.e({source:this.id,cluster:h.cluster||!1,geojsonVtOptions:{buffer:(h.buffer!==void 0?h.buffer:128)*v,tolerance:(h.tolerance!==void 0?h.tolerance:.375)*v,extent:a.W,maxZoom:this.maxzoom,lineMetrics:h.lineMetrics||!1,generateId:h.generateId||!1},superclusterOptions:{maxZoom:h.clusterMaxZoom!==void 0?h.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,h.clusterMinPoints||2),extent:a.W,radius:(h.clusterRadius||50)*v,log:!1,generateId:h.generateId||!1},clusterProperties:h.clusterProperties,filter:h.filter},h.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return a._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(o){this.map=o,this.load()}setData(o){return this._data=o,this._updateWorkerData(),this}updateData(o){return this._updateWorkerData(o),this}setClusterOptions(o){return this.workerOptions.cluster=o.cluster,o&&(o.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=o.clusterRadius),o.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=o.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(o){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:o,source:this.id}})}getClusterChildren(o){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:o,source:this.id}})}getClusterLeaves(o,h,p){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:o,limit:h,offset:p}})}_updateWorkerData(o){return a._(this,void 0,void 0,function*(){const h=a.e({type:this.type},this.workerOptions);o?h.dataDiff=o:typeof this._data=="string"?(h.request=this.map._requestManager.transformRequest(S.resolveURL(this._data),"Source"),h.request.collectResourceTiming=this._collectResourceTiming):h.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new a.k("dataloading",{dataType:"source"}));try{const p=yield this.actor.sendAsync({type:"LD",data:h});if(this._pendingLoads--,this._removed||p.abandoned)return void this.fire(new a.k("dataabort",{dataType:"source"}));let m=null;p.resourceTiming&&p.resourceTiming[this.id]&&(m=p.resourceTiming[this.id].slice(0));const v={dataType:"source"};this._collectResourceTiming&&m&&m.length>0&&a.e(v,{resourceTiming:m}),this.fire(new a.k("data",Object.assign(Object.assign({},v),{sourceDataType:"metadata"}))),this.fire(new a.k("data",Object.assign(Object.assign({},v),{sourceDataType:"content"})))}catch(p){if(this._pendingLoads--,this._removed)return void this.fire(new a.k("dataabort",{dataType:"source"}));this.fire(new a.j(p))}})}loaded(){return this._pendingLoads===0}loadTile(o){return a._(this,void 0,void 0,function*(){const h=o.actor?"RT":"LT";o.actor=this.actor;const p={type:this.type,uid:o.uid,tileID:o.tileID,zoom:o.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};o.abortController=new AbortController;const m=yield this.actor.sendAsync({type:h,data:p},o.abortController);delete o.abortController,o.unloadVectorData(),o.aborted||o.loadVectorData(m,this.map.painter,h==="RT")})}abortTile(o){return a._(this,void 0,void 0,function*(){o.abortController&&(o.abortController.abort(),delete o.abortController),o.aborted=!0})}unloadTile(o){return a._(this,void 0,void 0,function*(){o.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:o.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return a.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var We=a.X([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class wt extends a.E{constructor(o,h,p,m){super(),this.id=o,this.dispatcher=p,this.coordinates=h.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(m),this.options=h}load(o){return a._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new a.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const h=yield V.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,h&&h.data&&(this.image=h.data,o&&(this.coordinates=o),this._finishLoading())}catch(h){this._request=null,this._loaded=!0,this.fire(new a.j(h))}})}loaded(){return this._loaded}updateImage(o){return o.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=o.url,this.load(o.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new a.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(o){this.map=o,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(o){this.coordinates=o;const h=o.map(a.Y.fromLngLat);this.tileID=function(m){let v=1/0,E=1/0,M=-1/0,A=-1/0;for(const Y of m)v=Math.min(v,Y.x),E=Math.min(E,Y.y),M=Math.max(M,Y.x),A=Math.max(A,Y.y);const F=Math.max(M-v,A-E),$=Math.max(0,Math.floor(-Math.log(F)/Math.LN2)),q=Math.pow(2,$);return new a.a0($,Math.floor((v+M)/2*q),Math.floor((E+A)/2*q))}(h),this.minzoom=this.maxzoom=this.tileID.z;const p=h.map(m=>this.tileID.getTilePoint(m)._round());return this._boundsArray=new a.Z,this._boundsArray.emplaceBack(p[0].x,p[0].y,0,0),this._boundsArray.emplaceBack(p[1].x,p[1].y,a.W,0),this._boundsArray.emplaceBack(p[3].x,p[3].y,0,a.W),this._boundsArray.emplaceBack(p[2].x,p[2].y,a.W,a.W),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new a.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const o=this.map.painter.context,h=o.gl;this.boundsBuffer||(this.boundsBuffer=o.createVertexBuffer(this._boundsArray,We.members)),this.boundsSegments||(this.boundsSegments=a.$.simpleSegment(0,0,4,2)),this.texture||(this.texture=new ne(o,this.image,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE));let p=!1;for(const m in this.tiles){const v=this.tiles[m];v.state!=="loaded"&&(v.state="loaded",v.texture=this.texture,p=!0)}p&&this.fire(new a.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(o){return a._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(o.tileID.canonical)?(this.tiles[String(o.tileID.wrap)]=o,o.buckets={}):o.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class xn extends wt{constructor(o,h,p,m){super(o,h,p,m),this.roundZoom=!0,this.type="video",this.options=h}load(){return a._(this,void 0,void 0,function*(){this._loaded=!1;const o=this.options;this.urls=[];for(const h of o.urls)this.urls.push(this.map._requestManager.transformRequest(h,"Source").url);try{const h=yield a.a2(this.urls);if(this._loaded=!0,!h)return;this.video=h,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(h){this.fire(new a.j(h))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(o){if(this.video){const h=this.video.seekable;o<h.start(0)||o>h.end(0)?this.fire(new a.j(new a.a1(`sources.${this.id}`,null,`Playback for this video can be set only between the ${h.start(0)} and ${h.end(0)}-second mark.`))):this.video.currentTime=o}}getVideo(){return this.video}onAdd(o){this.map||(this.map=o,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const o=this.map.painter.context,h=o.gl;this.boundsBuffer||(this.boundsBuffer=o.createVertexBuffer(this._boundsArray,We.members)),this.boundsSegments||(this.boundsSegments=a.$.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE),h.texSubImage2D(h.TEXTURE_2D,0,0,0,h.RGBA,h.UNSIGNED_BYTE,this.video)):(this.texture=new ne(o,this.video,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE));let p=!1;for(const m in this.tiles){const v=this.tiles[m];v.state!=="loaded"&&(v.state="loaded",v.texture=this.texture,p=!0)}p&&this.fire(new a.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Sn extends wt{constructor(o,h,p,m){super(o,h,p,m),h.coordinates?Array.isArray(h.coordinates)&&h.coordinates.length===4&&!h.coordinates.some(v=>!Array.isArray(v)||v.length!==2||v.some(E=>typeof E!="number"))||this.fire(new a.j(new a.a1(`sources.${o}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new a.j(new a.a1(`sources.${o}`,null,'missing required property "coordinates"'))),h.animate&&typeof h.animate!="boolean"&&this.fire(new a.j(new a.a1(`sources.${o}`,null,'optional "animate" property must be a boolean value'))),h.canvas?typeof h.canvas=="string"||h.canvas instanceof HTMLCanvasElement||this.fire(new a.j(new a.a1(`sources.${o}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new a.j(new a.a1(`sources.${o}`,null,'missing required property "canvas"'))),this.options=h,this.animate=h.animate===void 0||h.animate}load(){return a._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new a.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(o){this.map=o,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let o=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,o=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,o=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const h=this.map.painter.context,p=h.gl;this.boundsBuffer||(this.boundsBuffer=h.createVertexBuffer(this._boundsArray,We.members)),this.boundsSegments||(this.boundsSegments=a.$.simpleSegment(0,0,4,2)),this.texture?(o||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new ne(h,this.canvas,p.RGBA,{premultiply:!0});let m=!1;for(const v in this.tiles){const E=this.tiles[v];E.state!=="loaded"&&(E.state="loaded",E.texture=this.texture,m=!0)}m&&this.fire(new a.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const o of[this.canvas.width,this.canvas.height])if(isNaN(o)||o<=0)return!0;return!1}}const In={},ii=y=>{switch(y){case"geojson":return Ne;case"image":return wt;case"raster":return ie;case"raster-dem":return nr;case"vector":return xt;case"video":return xn;case"canvas":return Sn}return In[y]},oi="RTLPluginLoaded";class Xo extends a.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=gr()}_syncState(o){return this.status=o,this.dispatcher.broadcast("SRPS",{pluginStatus:o,pluginURL:this.url}).catch(h=>{throw this.status="error",h})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(o){return a._(this,arguments,void 0,function*(h,p=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=S.resolveURL(h),!this.url)throw new Error(`requested url ${h} is invalid`);if(this.status==="unavailable"){if(!p)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return a._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new a.k(oi))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Jr=null;function lt(){return Jr||(Jr=new Xo),Jr}class Xn{constructor(o,h){this.timeAdded=0,this.fadeEndTime=0,this.tileID=o,this.uid=a.a3(),this.uses=0,this.tileSize=h,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(o){const h=o+this.timeAdded;h<this.fadeEndTime||(this.fadeEndTime=h)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(o){this.demTexture&&o.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(o,h,p){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",o){o.featureIndex&&(this.latestFeatureIndex=o.featureIndex,o.rawTileData?(this.latestRawTileData=o.rawTileData,this.latestFeatureIndex.rawTileData=o.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=o.collisionBoxArray,this.buckets=function(m,v){const E={};if(!v)return E;for(const M of m){const A=M.layerIds.map(F=>v.getLayer(F)).filter(Boolean);if(A.length!==0){M.layers=A,M.stateDependentLayerIds&&(M.stateDependentLayers=M.stateDependentLayerIds.map(F=>A.filter($=>$.id===F)[0]));for(const F of A)E[F.id]=M}}return E}(o.buckets,h.style),this.hasSymbolBuckets=!1;for(const m in this.buckets){const v=this.buckets[m];if(v instanceof a.a5){if(this.hasSymbolBuckets=!0,!p)break;v.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const m in this.buckets){const v=this.buckets[m];if(v instanceof a.a5&&v.hasRTLText){this.hasRTLText=!0,lt().lazyLoad();break}}this.queryPadding=0;for(const m in this.buckets){const v=this.buckets[m];this.queryPadding=Math.max(this.queryPadding,h.style.getLayer(m).queryRadius(v))}o.imageAtlas&&(this.imageAtlas=o.imageAtlas),o.glyphAtlasImage&&(this.glyphAtlasImage=o.glyphAtlasImage)}else this.collisionBoxArray=new a.a4}unloadVectorData(){for(const o in this.buckets)this.buckets[o].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(o){return this.buckets[o.id]}upload(o){for(const p in this.buckets){const m=this.buckets[p];m.uploadPending()&&m.upload(o)}const h=o.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new ne(o,this.imageAtlas.image,h.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new ne(o,this.glyphAtlasImage,h.ALPHA),this.glyphAtlasImage=null)}prepare(o){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(o,this.imageAtlasTexture)}queryRenderedFeatures(o,h,p,m,v,E,M,A,F,$){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:m,cameraQueryGeometry:v,scale:E,tileSize:this.tileSize,pixelPosMatrix:$,transform:A,params:M,queryPadding:this.queryPadding*F},o,h,p):{}}querySourceFeatures(o,h){const p=this.latestFeatureIndex;if(!p||!p.rawTileData)return;const m=p.loadVTLayers(),v=h&&h.sourceLayer?h.sourceLayer:"",E=m._geojsonTileLayer||m[v];if(!E)return;const M=a.a6(h&&h.filter),{z:A,x:F,y:$}=this.tileID.canonical,q={z:A,x:F,y:$};for(let Y=0;Y<E.length;Y++){const de=E.feature(Y);if(M.needGeometry){const se=a.a7(de,!0);if(!M.filter(new a.a8(this.tileID.overscaledZ),se,this.tileID.canonical))continue}else if(!M.filter(new a.a8(this.tileID.overscaledZ),de))continue;const fe=p.getId(de,v),ve=new a.a9(de,A,F,$,fe);ve.tile=q,o.push(ve)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(o){const h=this.expirationTime;if(o.cacheControl){const p=a.aa(o.cacheControl);p["max-age"]&&(this.expirationTime=Date.now()+1e3*p["max-age"])}else o.expires&&(this.expirationTime=new Date(o.expires).getTime());if(this.expirationTime){const p=Date.now();let m=!1;if(this.expirationTime>p)m=!1;else if(h)if(this.expirationTime<h)m=!0;else{const v=this.expirationTime-h;v?this.expirationTime=p+Math.max(v,3e4):m=!0}else m=!0;m?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(o,h){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(o).length===0)return;const p=this.latestFeatureIndex.loadVTLayers();for(const m in this.buckets){if(!h.style.hasLayer(m))continue;const v=this.buckets[m],E=v.layers[0].sourceLayer||"_geojsonTileLayer",M=p[E],A=o[E];if(!M||!A||Object.keys(A).length===0)continue;v.update(A,M,this.imageAtlas&&this.imageAtlas.patternPositions||{});const F=h&&h.style&&h.style.getLayer(m);F&&(this.queryPadding=Math.max(this.queryPadding,F.queryRadius(v)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<S.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(o){this.symbolFadeHoldUntil=S.now()+o}setDependencies(o,h){const p={};for(const m of h)p[m]=!0;this.dependencies[o]=p}hasDependency(o,h){for(const p of o){const m=this.dependencies[p];if(m){for(const v of h)if(m[v])return!0}}return!1}}class kn{constructor(o,h){this.max=o,this.onRemove=h,this.reset()}reset(){for(const o in this.data)for(const h of this.data[o])h.timeout&&clearTimeout(h.timeout),this.onRemove(h.value);return this.data={},this.order=[],this}add(o,h,p){const m=o.wrapped().key;this.data[m]===void 0&&(this.data[m]=[]);const v={value:h,timeout:void 0};if(p!==void 0&&(v.timeout=setTimeout(()=>{this.remove(o,v)},p)),this.data[m].push(v),this.order.push(m),this.order.length>this.max){const E=this._getAndRemoveByKey(this.order[0]);E&&this.onRemove(E)}return this}has(o){return o.wrapped().key in this.data}getAndRemove(o){return this.has(o)?this._getAndRemoveByKey(o.wrapped().key):null}_getAndRemoveByKey(o){const h=this.data[o].shift();return h.timeout&&clearTimeout(h.timeout),this.data[o].length===0&&delete this.data[o],this.order.splice(this.order.indexOf(o),1),h.value}getByKey(o){const h=this.data[o];return h?h[0].value:null}get(o){return this.has(o)?this.data[o.wrapped().key][0].value:null}remove(o,h){if(!this.has(o))return this;const p=o.wrapped().key,m=h===void 0?0:this.data[p].indexOf(h),v=this.data[p][m];return this.data[p].splice(m,1),v.timeout&&clearTimeout(v.timeout),this.data[p].length===0&&delete this.data[p],this.onRemove(v.value),this.order.splice(this.order.indexOf(p),1),this}setMaxSize(o){for(this.max=o;this.order.length>this.max;){const h=this._getAndRemoveByKey(this.order[0]);h&&this.onRemove(h)}return this}filter(o){const h=[];for(const p in this.data)for(const m of this.data[p])o(m.value)||h.push(m);for(const p of h)this.remove(p.value.tileID,p)}}class Fo{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(o,h,p){const m=String(h);if(this.stateChanges[o]=this.stateChanges[o]||{},this.stateChanges[o][m]=this.stateChanges[o][m]||{},a.e(this.stateChanges[o][m],p),this.deletedStates[o]===null){this.deletedStates[o]={};for(const v in this.state[o])v!==m&&(this.deletedStates[o][v]=null)}else if(this.deletedStates[o]&&this.deletedStates[o][m]===null){this.deletedStates[o][m]={};for(const v in this.state[o][m])p[v]||(this.deletedStates[o][m][v]=null)}else for(const v in p)this.deletedStates[o]&&this.deletedStates[o][m]&&this.deletedStates[o][m][v]===null&&delete this.deletedStates[o][m][v]}removeFeatureState(o,h,p){if(this.deletedStates[o]===null)return;const m=String(h);if(this.deletedStates[o]=this.deletedStates[o]||{},p&&h!==void 0)this.deletedStates[o][m]!==null&&(this.deletedStates[o][m]=this.deletedStates[o][m]||{},this.deletedStates[o][m][p]=null);else if(h!==void 0)if(this.stateChanges[o]&&this.stateChanges[o][m])for(p in this.deletedStates[o][m]={},this.stateChanges[o][m])this.deletedStates[o][m][p]=null;else this.deletedStates[o][m]=null;else this.deletedStates[o]=null}getState(o,h){const p=String(h),m=a.e({},(this.state[o]||{})[p],(this.stateChanges[o]||{})[p]);if(this.deletedStates[o]===null)return{};if(this.deletedStates[o]){const v=this.deletedStates[o][h];if(v===null)return{};for(const E in v)delete m[E]}return m}initializeTileState(o,h){o.setFeatureState(this.state,h)}coalesceChanges(o,h){const p={};for(const m in this.stateChanges){this.state[m]=this.state[m]||{};const v={};for(const E in this.stateChanges[m])this.state[m][E]||(this.state[m][E]={}),a.e(this.state[m][E],this.stateChanges[m][E]),v[E]=this.state[m][E];p[m]=v}for(const m in this.deletedStates){this.state[m]=this.state[m]||{};const v={};if(this.deletedStates[m]===null)for(const E in this.state[m])v[E]={},this.state[m][E]={};else for(const E in this.deletedStates[m]){if(this.deletedStates[m][E]===null)this.state[m][E]={};else for(const M of Object.keys(this.deletedStates[m][E]))delete this.state[m][E][M];v[E]=this.state[m][E]}p[m]=p[m]||{},a.e(p[m],v)}if(this.stateChanges={},this.deletedStates={},Object.keys(p).length!==0)for(const m in o)o[m].setFeatureState(p,h)}}class Nr extends a.E{constructor(o,h,p){super(),this.id=o,this.dispatcher=p,this.on("data",m=>this._dataHandler(m)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((m,v,E,M)=>{const A=new(ii(v.type))(m,v,E,M);if(A.id!==m)throw new Error(`Expected Source id to be ${m} instead of ${A.id}`);return A})(o,h,p,this),this._tiles={},this._cache=new kn(0,m=>this._unloadTile(m)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Fo,this._didEmitContent=!1,this._updated=!1}onAdd(o){this.map=o,this._maxTileCacheSize=o?o._maxTileCacheSize:null,this._maxTileCacheZoomLevels=o?o._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(o)}onRemove(o){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(o)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const o in this._tiles){const h=this._tiles[o];if(h.state!=="loaded"&&h.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const o=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,o&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(o,h,p){return a._(this,void 0,void 0,function*(){try{yield this._source.loadTile(o),this._tileLoaded(o,h,p)}catch(m){o.state="errored",m.status!==404?this._source.fire(new a.j(m,{tile:o})):this.update(this.transform,this.terrain)}})}_unloadTile(o){this._source.unloadTile&&this._source.unloadTile(o)}_abortTile(o){this._source.abortTile&&this._source.abortTile(o),this._source.fire(new a.k("dataabort",{tile:o,coord:o.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(o){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const h in this._tiles){const p=this._tiles[h];p.upload(o),p.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(o=>o.tileID).sort(mt).map(o=>o.key)}getRenderableIds(o){const h=[];for(const p in this._tiles)this._isIdRenderable(p,o)&&h.push(this._tiles[p]);return o?h.sort((p,m)=>{const v=p.tileID,E=m.tileID,M=new a.P(v.canonical.x,v.canonical.y)._rotate(this.transform.angle),A=new a.P(E.canonical.x,E.canonical.y)._rotate(this.transform.angle);return v.overscaledZ-E.overscaledZ||A.y-M.y||A.x-M.x}).map(p=>p.tileID.key):h.map(p=>p.tileID).sort(mt).map(p=>p.key)}hasRenderableParent(o){const h=this.findLoadedParent(o,0);return!!h&&this._isIdRenderable(h.tileID.key)}_isIdRenderable(o,h){return this._tiles[o]&&this._tiles[o].hasData()&&!this._coveredTiles[o]&&(h||!this._tiles[o].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const o in this._tiles)this._tiles[o].state!=="errored"&&this._reloadTile(o,"reloading")}}_reloadTile(o,h){return a._(this,void 0,void 0,function*(){const p=this._tiles[o];p&&(p.state!=="loading"&&(p.state=h),yield this._loadTile(p,o,h))})}_tileLoaded(o,h,p){o.timeAdded=S.now(),p==="expired"&&(o.refreshedUponExpiration=!0),this._setTileReloadTimer(h,o),this.getSource().type==="raster-dem"&&o.dem&&this._backfillDEM(o),this._state.initializeTileState(o,this.map?this.map.painter:null),o.aborted||this._source.fire(new a.k("data",{dataType:"source",tile:o,coord:o.tileID}))}_backfillDEM(o){const h=this.getRenderableIds();for(let m=0;m<h.length;m++){const v=h[m];if(o.neighboringTiles&&o.neighboringTiles[v]){const E=this.getTileByID(v);p(o,E),p(E,o)}}function p(m,v){m.needsHillshadePrepare=!0,m.needsTerrainPrepare=!0;let E=v.tileID.canonical.x-m.tileID.canonical.x;const M=v.tileID.canonical.y-m.tileID.canonical.y,A=Math.pow(2,m.tileID.canonical.z),F=v.tileID.key;E===0&&M===0||Math.abs(M)>1||(Math.abs(E)>1&&(Math.abs(E+A)===1?E+=A:Math.abs(E-A)===1&&(E-=A)),v.dem&&m.dem&&(m.dem.backfillBorder(v.dem,E,M),m.neighboringTiles&&m.neighboringTiles[F]&&(m.neighboringTiles[F].backfilled=!0)))}}getTile(o){return this.getTileByID(o.key)}getTileByID(o){return this._tiles[o]}_retainLoadedChildren(o,h,p,m){for(const v in this._tiles){let E=this._tiles[v];if(m[v]||!E.hasData()||E.tileID.overscaledZ<=h||E.tileID.overscaledZ>p)continue;let M=E.tileID;for(;E&&E.tileID.overscaledZ>h+1;){const F=E.tileID.scaledTo(E.tileID.overscaledZ-1);E=this._tiles[F.key],E&&E.hasData()&&(M=F)}let A=M;for(;A.overscaledZ>h;)if(A=A.scaledTo(A.overscaledZ-1),o[A.key]){m[M.key]=M;break}}}findLoadedParent(o,h){if(o.key in this._loadedParentTiles){const p=this._loadedParentTiles[o.key];return p&&p.tileID.overscaledZ>=h?p:null}for(let p=o.overscaledZ-1;p>=h;p--){const m=o.scaledTo(p),v=this._getLoadedTile(m);if(v)return v}}_getLoadedTile(o){const h=this._tiles[o.key];return h&&h.hasData()?h:this._cache.getByKey(o.wrapped().key)}updateCacheSize(o){const h=Math.ceil(o.width/this._source.tileSize)+1,p=Math.ceil(o.height/this._source.tileSize)+1,m=Math.floor(h*p*(this._maxTileCacheZoomLevels===null?a.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),v=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,m):m;this._cache.setMaxSize(v)}handleWrapJump(o){const h=Math.round((o-(this._prevLng===void 0?o:this._prevLng))/360);if(this._prevLng=o,h){const p={};for(const m in this._tiles){const v=this._tiles[m];v.tileID=v.tileID.unwrapTo(v.tileID.wrap+h),p[v.tileID.key]=v}this._tiles=p;for(const m in this._timers)clearTimeout(this._timers[m]),delete this._timers[m];for(const m in this._tiles)this._setTileReloadTimer(m,this._tiles[m])}}update(o,h){if(!this._sourceLoaded||this._paused)return;let p;this.transform=o,this.terrain=h,this.updateCacheSize(o),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?p=o.getVisibleUnwrappedCoordinates(this._source.tileID).map($=>new a.Q($.canonical.z,$.wrap,$.canonical.z,$.canonical.x,$.canonical.y)):(p=o.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:h}),this._source.hasTile&&(p=p.filter($=>this._source.hasTile($)))):p=[];const m=o.coveringZoomLevel(this._source),v=Math.max(m-Nr.maxOverzooming,this._source.minzoom),E=Math.max(m+Nr.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const $={};for(const q of p)if(q.canonical.z>this._source.minzoom){const Y=q.scaledTo(q.canonical.z-1);$[Y.key]=Y;const de=q.scaledTo(Math.max(this._source.minzoom,Math.min(q.canonical.z,5)));$[de.key]=de}p=p.concat(Object.values($))}const M=p.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,M&&this.fire(new a.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const A=this._updateRetainedTiles(p,m);if(ir(this._source.type)){const $={},q={},Y=Object.keys(A),de=S.now();for(const fe of Y){const ve=A[fe],se=this._tiles[fe];if(!se||se.fadeEndTime!==0&&se.fadeEndTime<=de)continue;const Ee=this.findLoadedParent(ve,v);Ee&&(this._addTile(Ee.tileID),$[Ee.tileID.key]=Ee.tileID),q[fe]=ve}this._retainLoadedChildren(q,m,E,A);for(const fe in $)A[fe]||(this._coveredTiles[fe]=!0,A[fe]=$[fe]);if(h){const fe={},ve={};for(const se of p)this._tiles[se.key].hasData()?fe[se.key]=se:ve[se.key]=se;for(const se in ve){const Ee=ve[se].children(this._source.maxzoom);this._tiles[Ee[0].key]&&this._tiles[Ee[1].key]&&this._tiles[Ee[2].key]&&this._tiles[Ee[3].key]&&(fe[Ee[0].key]=A[Ee[0].key]=Ee[0],fe[Ee[1].key]=A[Ee[1].key]=Ee[1],fe[Ee[2].key]=A[Ee[2].key]=Ee[2],fe[Ee[3].key]=A[Ee[3].key]=Ee[3],delete ve[se])}for(const se in ve){const Ee=this.findLoadedParent(ve[se],this._source.minzoom);if(Ee){fe[Ee.tileID.key]=A[Ee.tileID.key]=Ee.tileID;for(const $e in fe)fe[$e].isChildOf(Ee.tileID)&&delete fe[$e]}}for(const se in this._tiles)fe[se]||(this._coveredTiles[se]=!0)}}for(const $ in A)this._tiles[$].clearFadeHold();const F=a.ab(this._tiles,A);for(const $ of F){const q=this._tiles[$];q.hasSymbolBuckets&&!q.holdingForFade()?q.setHoldDuration(this.map._fadeDuration):q.hasSymbolBuckets&&!q.symbolFadeFinished()||this._removeTile($)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const o in this._tiles)this._tiles[o].holdingForFade()&&this._removeTile(o)}_updateRetainedTiles(o,h){const p={},m={},v=Math.max(h-Nr.maxOverzooming,this._source.minzoom),E=Math.max(h+Nr.maxUnderzooming,this._source.minzoom),M={};for(const A of o){const F=this._addTile(A);p[A.key]=A,F.hasData()||h<this._source.maxzoom&&(M[A.key]=A)}this._retainLoadedChildren(M,h,E,p);for(const A of o){let F=this._tiles[A.key];if(F.hasData())continue;if(h+1>this._source.maxzoom){const q=A.children(this._source.maxzoom)[0],Y=this.getTile(q);if(Y&&Y.hasData()){p[q.key]=q;continue}}else{const q=A.children(this._source.maxzoom);if(p[q[0].key]&&p[q[1].key]&&p[q[2].key]&&p[q[3].key])continue}let $=F.wasRequested();for(let q=A.overscaledZ-1;q>=v;--q){const Y=A.scaledTo(q);if(m[Y.key])break;if(m[Y.key]=!0,F=this.getTile(Y),!F&&$&&(F=this._addTile(Y)),F){const de=F.hasData();if(($||de)&&(p[Y.key]=Y),$=F.wasRequested(),de)break}}}return p}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const o in this._tiles){const h=[];let p,m=this._tiles[o].tileID;for(;m.overscaledZ>0;){if(m.key in this._loadedParentTiles){p=this._loadedParentTiles[m.key];break}h.push(m.key);const v=m.scaledTo(m.overscaledZ-1);if(p=this._getLoadedTile(v),p)break;m=v}for(const v of h)this._loadedParentTiles[v]=p}}_addTile(o){let h=this._tiles[o.key];if(h)return h;h=this._cache.getAndRemove(o),h&&(this._setTileReloadTimer(o.key,h),h.tileID=o,this._state.initializeTileState(h,this.map?this.map.painter:null),this._cacheTimers[o.key]&&(clearTimeout(this._cacheTimers[o.key]),delete this._cacheTimers[o.key],this._setTileReloadTimer(o.key,h)));const p=h;return h||(h=new Xn(o,this._source.tileSize*o.overscaleFactor()),this._loadTile(h,o.key,h.state)),h.uses++,this._tiles[o.key]=h,p||this._source.fire(new a.k("dataloading",{tile:h,coord:h.tileID,dataType:"source"})),h}_setTileReloadTimer(o,h){o in this._timers&&(clearTimeout(this._timers[o]),delete this._timers[o]);const p=h.getExpiryTimeout();p&&(this._timers[o]=setTimeout(()=>{this._reloadTile(o,"expired"),delete this._timers[o]},p))}_removeTile(o){const h=this._tiles[o];h&&(h.uses--,delete this._tiles[o],this._timers[o]&&(clearTimeout(this._timers[o]),delete this._timers[o]),h.uses>0||(h.hasData()&&h.state!=="reloading"?this._cache.add(h.tileID,h,h.getExpiryTimeout()):(h.aborted=!0,this._abortTile(h),this._unloadTile(h))))}_dataHandler(o){const h=o.sourceDataType;o.dataType==="source"&&h==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&o.dataType==="source"&&h==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const o in this._tiles)this._removeTile(o);this._cache.reset()}tilesIn(o,h,p){const m=[],v=this.transform;if(!v)return m;const E=p?v.getCameraQueryGeometry(o):o,M=o.map(fe=>v.pointCoordinate(fe,this.terrain)),A=E.map(fe=>v.pointCoordinate(fe,this.terrain)),F=this.getIds();let $=1/0,q=1/0,Y=-1/0,de=-1/0;for(const fe of A)$=Math.min($,fe.x),q=Math.min(q,fe.y),Y=Math.max(Y,fe.x),de=Math.max(de,fe.y);for(let fe=0;fe<F.length;fe++){const ve=this._tiles[F[fe]];if(ve.holdingForFade())continue;const se=ve.tileID,Ee=Math.pow(2,v.zoom-ve.tileID.overscaledZ),$e=h*ve.queryPadding*a.W/ve.tileSize/Ee,we=[se.getTilePoint(new a.Y($,q)),se.getTilePoint(new a.Y(Y,de))];if(we[0].x-$e<a.W&&we[0].y-$e<a.W&&we[1].x+$e>=0&&we[1].y+$e>=0){const Le=M.map(Ze=>se.getTilePoint(Ze)),Ge=A.map(Ze=>se.getTilePoint(Ze));m.push({tile:ve,tileID:se,queryGeometry:Le,cameraQueryGeometry:Ge,scale:Ee})}}return m}getVisibleCoordinates(o){const h=this.getRenderableIds(o).map(p=>this._tiles[p].tileID);for(const p of h)p.posMatrix=this.transform.calculatePosMatrix(p.toUnwrapped());return h}hasTransition(){if(this._source.hasTransition())return!0;if(ir(this._source.type)){const o=S.now();for(const h in this._tiles)if(this._tiles[h].fadeEndTime>=o)return!0}return!1}setFeatureState(o,h,p){this._state.updateState(o=o||"_geojsonTileLayer",h,p)}removeFeatureState(o,h,p){this._state.removeFeatureState(o=o||"_geojsonTileLayer",h,p)}getFeatureState(o,h){return this._state.getState(o=o||"_geojsonTileLayer",h)}setDependencies(o,h,p){const m=this._tiles[o];m&&m.setDependencies(h,p)}reloadTilesForDependencies(o,h){for(const p in this._tiles)this._tiles[p].hasDependency(o,h)&&this._reloadTile(p,"reloading");this._cache.filter(p=>!p.hasDependency(o,h))}}function mt(y,o){const h=Math.abs(2*y.wrap)-+(y.wrap<0),p=Math.abs(2*o.wrap)-+(o.wrap<0);return y.overscaledZ-o.overscaledZ||p-h||o.canonical.y-y.canonical.y||o.canonical.x-y.canonical.x}function ir(y){return y==="raster"||y==="image"||y==="video"}Nr.maxOverzooming=10,Nr.maxUnderzooming=3;class Qt{constructor(o,h){this.reset(o,h)}reset(o,h){this.points=o||[],this._distances=[0];for(let p=1;p<this.points.length;p++)this._distances[p]=this._distances[p-1]+this.points[p].dist(this.points[p-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(h||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(o){if(this.points.length===1)return this.points[0];o=a.ac(o,0,1);let h=1,p=this._distances[h];const m=o*this.paddedLength+this.padding;for(;p<m&&h<this._distances.length;)p=this._distances[++h];const v=h-1,E=this._distances[v],M=p-E,A=M>0?(m-E)/M:0;return this.points[v].mult(1-A).add(this.points[h].mult(A))}}function jr(y,o){let h=!0;return y==="always"||y!=="never"&&o!=="never"||(h=!1),h}class wi{constructor(o,h,p){const m=this.boxCells=[],v=this.circleCells=[];this.xCellCount=Math.ceil(o/p),this.yCellCount=Math.ceil(h/p);for(let E=0;E<this.xCellCount*this.yCellCount;E++)m.push([]),v.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=o,this.height=h,this.xScale=this.xCellCount/o,this.yScale=this.yCellCount/h,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(o,h,p,m,v){this._forEachCell(h,p,m,v,this._insertBoxCell,this.boxUid++),this.boxKeys.push(o),this.bboxes.push(h),this.bboxes.push(p),this.bboxes.push(m),this.bboxes.push(v)}insertCircle(o,h,p,m){this._forEachCell(h-m,p-m,h+m,p+m,this._insertCircleCell,this.circleUid++),this.circleKeys.push(o),this.circles.push(h),this.circles.push(p),this.circles.push(m)}_insertBoxCell(o,h,p,m,v,E){this.boxCells[v].push(E)}_insertCircleCell(o,h,p,m,v,E){this.circleCells[v].push(E)}_query(o,h,p,m,v,E,M){if(p<0||o>this.width||m<0||h>this.height)return[];const A=[];if(o<=0&&h<=0&&this.width<=p&&this.height<=m){if(v)return[{key:null,x1:o,y1:h,x2:p,y2:m}];for(let F=0;F<this.boxKeys.length;F++)A.push({key:this.boxKeys[F],x1:this.bboxes[4*F],y1:this.bboxes[4*F+1],x2:this.bboxes[4*F+2],y2:this.bboxes[4*F+3]});for(let F=0;F<this.circleKeys.length;F++){const $=this.circles[3*F],q=this.circles[3*F+1],Y=this.circles[3*F+2];A.push({key:this.circleKeys[F],x1:$-Y,y1:q-Y,x2:$+Y,y2:q+Y})}}else this._forEachCell(o,h,p,m,this._queryCell,A,{hitTest:v,overlapMode:E,seenUids:{box:{},circle:{}}},M);return A}query(o,h,p,m){return this._query(o,h,p,m,!1,null)}hitTest(o,h,p,m,v,E){return this._query(o,h,p,m,!0,v,E).length>0}hitTestCircle(o,h,p,m,v){const E=o-p,M=o+p,A=h-p,F=h+p;if(M<0||E>this.width||F<0||A>this.height)return!1;const $=[];return this._forEachCell(E,A,M,F,this._queryCellCircle,$,{hitTest:!0,overlapMode:m,circle:{x:o,y:h,radius:p},seenUids:{box:{},circle:{}}},v),$.length>0}_queryCell(o,h,p,m,v,E,M,A){const{seenUids:F,hitTest:$,overlapMode:q}=M,Y=this.boxCells[v];if(Y!==null){const fe=this.bboxes;for(const ve of Y)if(!F.box[ve]){F.box[ve]=!0;const se=4*ve,Ee=this.boxKeys[ve];if(o<=fe[se+2]&&h<=fe[se+3]&&p>=fe[se+0]&&m>=fe[se+1]&&(!A||A(Ee))&&(!$||!jr(q,Ee.overlapMode))&&(E.push({key:Ee,x1:fe[se],y1:fe[se+1],x2:fe[se+2],y2:fe[se+3]}),$))return!0}}const de=this.circleCells[v];if(de!==null){const fe=this.circles;for(const ve of de)if(!F.circle[ve]){F.circle[ve]=!0;const se=3*ve,Ee=this.circleKeys[ve];if(this._circleAndRectCollide(fe[se],fe[se+1],fe[se+2],o,h,p,m)&&(!A||A(Ee))&&(!$||!jr(q,Ee.overlapMode))){const $e=fe[se],we=fe[se+1],Le=fe[se+2];if(E.push({key:Ee,x1:$e-Le,y1:we-Le,x2:$e+Le,y2:we+Le}),$)return!0}}}return!1}_queryCellCircle(o,h,p,m,v,E,M,A){const{circle:F,seenUids:$,overlapMode:q}=M,Y=this.boxCells[v];if(Y!==null){const fe=this.bboxes;for(const ve of Y)if(!$.box[ve]){$.box[ve]=!0;const se=4*ve,Ee=this.boxKeys[ve];if(this._circleAndRectCollide(F.x,F.y,F.radius,fe[se+0],fe[se+1],fe[se+2],fe[se+3])&&(!A||A(Ee))&&!jr(q,Ee.overlapMode))return E.push(!0),!0}}const de=this.circleCells[v];if(de!==null){const fe=this.circles;for(const ve of de)if(!$.circle[ve]){$.circle[ve]=!0;const se=3*ve,Ee=this.circleKeys[ve];if(this._circlesCollide(fe[se],fe[se+1],fe[se+2],F.x,F.y,F.radius)&&(!A||A(Ee))&&!jr(q,Ee.overlapMode))return E.push(!0),!0}}}_forEachCell(o,h,p,m,v,E,M,A){const F=this._convertToXCellCoord(o),$=this._convertToYCellCoord(h),q=this._convertToXCellCoord(p),Y=this._convertToYCellCoord(m);for(let de=F;de<=q;de++)for(let fe=$;fe<=Y;fe++)if(v.call(this,o,h,p,m,this.xCellCount*fe+de,E,M,A))return}_convertToXCellCoord(o){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(o*this.xScale)))}_convertToYCellCoord(o){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(o*this.yScale)))}_circlesCollide(o,h,p,m,v,E){const M=m-o,A=v-h,F=p+E;return F*F>M*M+A*A}_circleAndRectCollide(o,h,p,m,v,E,M){const A=(E-m)/2,F=Math.abs(o-(m+A));if(F>A+p)return!1;const $=(M-v)/2,q=Math.abs(h-(v+$));if(q>$+p)return!1;if(F<=A||q<=$)return!0;const Y=F-A,de=q-$;return Y*Y+de*de<=p*p}}function tr(y,o,h,p,m){const v=a.F();return o?(a.J(v,v,[1/m,1/m,1]),h||a.ad(v,v,p.angle)):a.K(v,p.labelPlaneMatrix,y),v}function io(y,o,h,p,m){if(o){const v=a.ae(y);return a.J(v,v,[m,m,1]),h||a.ad(v,v,-p.angle),v}return p.glCoordMatrix}function cn(y,o,h){let p;h?(p=[y.x,y.y,h(y.x,y.y),1],a.af(p,p,o)):(p=[y.x,y.y,0,1],Ke(p,p,o));const m=p[3];return{point:new a.P(p[0]/m,p[1]/m),signedDistanceFromCamera:m}}function ge(y,o){return .5+y/o*.5}function W(y,o){const h=y[0]/y[3],p=y[1]/y[3];return h>=-o[0]&&h<=o[0]&&p>=-o[1]&&p<=o[1]}function X(y,o,h,p,m,v,E,M,A,F){const $=p?y.textSizeData:y.iconSizeData,q=a.ag($,h.transform.zoom),Y=[256/h.width*2+1,256/h.height*2+1],de=p?y.text.dynamicLayoutVertexArray:y.icon.dynamicLayoutVertexArray;de.clear();const fe=y.lineVertexArray,ve=p?y.text.placedSymbolArray:y.icon.placedSymbolArray,se=h.transform.width/h.transform.height;let Ee=!1;for(let $e=0;$e<ve.length;$e++){const we=ve.get($e);if(we.hidden||we.writingMode===a.ah.vertical&&!Ee){qe(we.numGlyphs,de);continue}let Le;if(Ee=!1,F?(Le=[we.anchorX,we.anchorY,F(we.anchorX,we.anchorY),1],a.af(Le,Le,o)):(Le=[we.anchorX,we.anchorY,0,1],Ke(Le,Le,o)),!W(Le,Y)){qe(we.numGlyphs,de);continue}const Ge=ge(h.transform.cameraToCenterDistance,Le[3]),Ze=a.ai($,q,we),Xe=E?Ze/Ge:Ze*Ge,nt=new a.P(we.anchorX,we.anchorY),rt=cn(nt,m,F).point,ft={projections:{},offsets:{}},gt=Me(we,Xe,!1,M,o,m,v,y.glyphOffsetArray,fe,de,rt,nt,ft,se,A,F);Ee=gt.useVertical,(gt.notEnoughRoom||Ee||gt.needsFlipping&&Me(we,Xe,!0,M,o,m,v,y.glyphOffsetArray,fe,de,rt,nt,ft,se,A,F).notEnoughRoom)&&qe(we.numGlyphs,de)}p?y.text.dynamicLayoutVertexBuffer.updateData(de):y.icon.dynamicLayoutVertexBuffer.updateData(de)}function ee(y,o,h,p,m,v,E,M,A,F,$,q,Y){const de=M.glyphStartIndex+M.numGlyphs,fe=M.lineStartIndex,ve=M.lineStartIndex+M.lineLength,se=o.getoffsetX(M.glyphStartIndex),Ee=o.getoffsetX(de-1),$e=je(y*se,h,p,m,v,E,M.segment,fe,ve,A,F,$,q,Y);if(!$e)return null;const we=je(y*Ee,h,p,m,v,E,M.segment,fe,ve,A,F,$,q,Y);return we?{first:$e,last:we}:null}function he(y,o,h,p){return y===a.ah.horizontal&&Math.abs(h.y-o.y)>Math.abs(h.x-o.x)*p?{useVertical:!0}:(y===a.ah.vertical?o.y<h.y:o.x>h.x)?{needsFlipping:!0}:null}function Me(y,o,h,p,m,v,E,M,A,F,$,q,Y,de,fe,ve){const se=o/24,Ee=y.lineOffsetX*se,$e=y.lineOffsetY*se;let we;if(y.numGlyphs>1){const Le=y.glyphStartIndex+y.numGlyphs,Ge=y.lineStartIndex,Ze=y.lineStartIndex+y.lineLength,Xe=ee(se,M,Ee,$e,h,$,q,y,A,v,Y,fe,ve);if(!Xe)return{notEnoughRoom:!0};const nt=cn(Xe.first.point,E,ve).point,rt=cn(Xe.last.point,E,ve).point;if(p&&!h){const ft=he(y.writingMode,nt,rt,de);if(ft)return ft}we=[Xe.first];for(let ft=y.glyphStartIndex+1;ft<Le-1;ft++)we.push(je(se*M.getoffsetX(ft),Ee,$e,h,$,q,y.segment,Ge,Ze,A,v,Y,fe,ve));we.push(Xe.last)}else{if(p&&!h){const Ge=cn(q,m,ve).point,Ze=y.lineStartIndex+y.segment+1,Xe=new a.P(A.getx(Ze),A.gety(Ze)),nt=cn(Xe,m,ve),rt=nt.signedDistanceFromCamera>0?nt.point:Ie(q,Xe,Ge,1,m,ve),ft=he(y.writingMode,Ge,rt,de);if(ft)return ft}const Le=je(se*M.getoffsetX(y.glyphStartIndex),Ee,$e,h,$,q,y.segment,y.lineStartIndex,y.lineStartIndex+y.lineLength,A,v,Y,fe,ve);if(!Le)return{notEnoughRoom:!0};we=[Le]}for(const Le of we)a.aj(F,Le.point,Le.angle);return{}}function Ie(y,o,h,p,m,v){const E=cn(y.add(y.sub(o)._unit()),m,v).point,M=h.sub(E);return h.add(M._mult(p/M.mag()))}function Pe(y,o){const{projectionCache:h,lineVertexArray:p,labelPlaneMatrix:m,tileAnchorPoint:v,distanceFromAnchor:E,getElevation:M,previousVertex:A,direction:F,absOffsetX:$}=o;if(h.projections[y])return h.projections[y];const q=new a.P(p.getx(y),p.gety(y)),Y=cn(q,m,M);if(Y.signedDistanceFromCamera>0)return h.projections[y]=Y.point,Y.point;const de=y-F;return Ie(E===0?v:new a.P(p.getx(de),p.gety(de)),q,A,$-E+1,m,M)}function Se(y,o,h){return y._unit()._perp()._mult(o*h)}function G(y,o,h,p,m,v,E,M){const{projectionCache:A,direction:F}=M;if(A.offsets[y])return A.offsets[y];const $=h.add(o);if(y+F<p||y+F>=m)return A.offsets[y]=$,$;const q=Pe(y+F,M),Y=Se(q.sub(h),E,F),de=h.add(Y),fe=q.add(Y);return A.offsets[y]=a.ak(v,$,de,fe)||$,A.offsets[y]}function je(y,o,h,p,m,v,E,M,A,F,$,q,Y,de){const fe=p?y-o:y+o;let ve=fe>0?1:-1,se=0;p&&(ve*=-1,se=Math.PI),ve<0&&(se+=Math.PI);let Ee,$e,we=ve>0?M+E:M+E+1,Le=m,Ge=m,Ze=0,Xe=0;const nt=Math.abs(fe),rt=[];let ft;for(;Ze+Xe<=nt;){if(we+=ve,we<M||we>=A)return null;Ze+=Xe,Ge=Le,$e=Ee;const yt={projectionCache:q,lineVertexArray:F,labelPlaneMatrix:$,tileAnchorPoint:v,distanceFromAnchor:Ze,getElevation:de,previousVertex:Ge,direction:ve,absOffsetX:nt};if(Le=Pe(we,yt),h===0)rt.push(Ge),ft=Le.sub(Ge);else{let Xt;const lr=Le.sub(Ge);Xt=lr.mag()===0?Se(Pe(we+ve,yt).sub(Le),h,ve):Se(lr,h,ve),$e||($e=Ge.add(Xt)),Ee=G(we,Xt,Le,M,A,$e,h,yt),rt.push($e),ft=Ee.sub($e)}Xe=ft.mag()}const gt=ft._mult((nt-Ze)/Xe)._add($e||Ge),ar=se+Math.atan2(Le.y-Ge.y,Le.x-Ge.x);return rt.push(gt),{point:gt,angle:Y?ar:0,path:rt}}const Ve=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function qe(y,o){for(let h=0;h<y;h++){const p=o.length;o.resize(p+4),o.float32.set(Ve,3*p)}}function Ke(y,o,h){const p=o[0],m=o[1];return y[0]=h[0]*p+h[4]*m+h[12],y[1]=h[1]*p+h[5]*m+h[13],y[3]=h[3]*p+h[7]*m+h[15],y}const ct=100;class Dt{constructor(o,h=new wi(o.width+200,o.height+200,25),p=new wi(o.width+200,o.height+200,25)){this.transform=o,this.grid=h,this.ignoredGrid=p,this.pitchfactor=Math.cos(o._pitch)*o.cameraToCenterDistance,this.screenRightBoundary=o.width+ct,this.screenBottomBoundary=o.height+ct,this.gridRightBoundary=o.width+200,this.gridBottomBoundary=o.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(o,h,p,m,v,E){const M=this.projectAndGetPerspectiveRatio(m,o.anchorPointX,o.anchorPointY,E),A=p*M.perspectiveRatio,F=o.x1*A+M.point.x,$=o.y1*A+M.point.y,q=o.x2*A+M.point.x,Y=o.y2*A+M.point.y;return!this.isInsideGrid(F,$,q,Y)||h!=="always"&&this.grid.hitTest(F,$,q,Y,h,v)||M.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[F,$,q,Y],offscreen:this.isOffscreen(F,$,q,Y)}}placeCollisionCircles(o,h,p,m,v,E,M,A,F,$,q,Y,de,fe){const ve=[],se=new a.P(h.anchorX,h.anchorY),Ee=cn(se,E,fe),$e=ge(this.transform.cameraToCenterDistance,Ee.signedDistanceFromCamera),we=($?v/$e:v*$e)/a.ao,Le=cn(se,M,fe).point,Ge=ee(we,m,h.lineOffsetX*we,h.lineOffsetY*we,!1,Le,se,h,p,M,{projections:{},offsets:{}},!1,fe);let Ze=!1,Xe=!1,nt=!0;if(Ge){const rt=.5*Y*$e+de,ft=new a.P(-100,-100),gt=new a.P(this.screenRightBoundary,this.screenBottomBoundary),ar=new Qt,yt=Ge.first,Xt=Ge.last;let lr=[];for(let hr=yt.path.length-1;hr>=1;hr--)lr.push(yt.path[hr]);for(let hr=1;hr<Xt.path.length;hr++)lr.push(Xt.path[hr]);const Sr=2.5*rt;if(A){const hr=lr.map(pr=>cn(pr,A,fe));lr=hr.some(pr=>pr.signedDistanceFromCamera<=0)?[]:hr.map(pr=>pr.point)}let er=[];if(lr.length>0){const hr=lr[0].clone(),pr=lr[0].clone();for(let dn=1;dn<lr.length;dn++)hr.x=Math.min(hr.x,lr[dn].x),hr.y=Math.min(hr.y,lr[dn].y),pr.x=Math.max(pr.x,lr[dn].x),pr.y=Math.max(pr.y,lr[dn].y);er=hr.x>=ft.x&&pr.x<=gt.x&&hr.y>=ft.y&&pr.y<=gt.y?[lr]:pr.x<ft.x||hr.x>gt.x||pr.y<ft.y||hr.y>gt.y?[]:a.al([lr],ft.x,ft.y,gt.x,gt.y)}for(const hr of er){ar.reset(hr,.25*rt);let pr=0;pr=ar.length<=.5*rt?1:Math.ceil(ar.paddedLength/Sr)+1;for(let dn=0;dn<pr;dn++){const Rr=dn/Math.max(pr-1,1),Oi=ar.lerp(Rr),On=Oi.x+ct,sn=Oi.y+ct;ve.push(On,sn,rt,0);const Nn=On-rt,Ni=sn-rt,xo=On+rt,rs=sn+rt;if(nt=nt&&this.isOffscreen(Nn,Ni,xo,rs),Xe=Xe||this.isInsideGrid(Nn,Ni,xo,rs),o!=="always"&&this.grid.hitTestCircle(On,sn,rt,o,q)&&(Ze=!0,!F))return{circles:[],offscreen:!1,collisionDetected:Ze}}}}return{circles:!F&&Ze||!Xe||$e<this.perspectiveRatioCutoff?[]:ve,offscreen:nt,collisionDetected:Ze}}queryRenderedSymbols(o){if(o.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const h=[];let p=1/0,m=1/0,v=-1/0,E=-1/0;for(const $ of o){const q=new a.P($.x+ct,$.y+ct);p=Math.min(p,q.x),m=Math.min(m,q.y),v=Math.max(v,q.x),E=Math.max(E,q.y),h.push(q)}const M=this.grid.query(p,m,v,E).concat(this.ignoredGrid.query(p,m,v,E)),A={},F={};for(const $ of M){const q=$.key;if(A[q.bucketInstanceId]===void 0&&(A[q.bucketInstanceId]={}),A[q.bucketInstanceId][q.featureIndex])continue;const Y=[new a.P($.x1,$.y1),new a.P($.x2,$.y1),new a.P($.x2,$.y2),new a.P($.x1,$.y2)];a.am(h,Y)&&(A[q.bucketInstanceId][q.featureIndex]=!0,F[q.bucketInstanceId]===void 0&&(F[q.bucketInstanceId]=[]),F[q.bucketInstanceId].push(q.featureIndex))}return F}insertCollisionBox(o,h,p,m,v,E){(p?this.ignoredGrid:this.grid).insert({bucketInstanceId:m,featureIndex:v,collisionGroupID:E,overlapMode:h},o[0],o[1],o[2],o[3])}insertCollisionCircles(o,h,p,m,v,E){const M=p?this.ignoredGrid:this.grid,A={bucketInstanceId:m,featureIndex:v,collisionGroupID:E,overlapMode:h};for(let F=0;F<o.length;F+=4)M.insertCircle(A,o[F],o[F+1],o[F+2])}projectAndGetPerspectiveRatio(o,h,p,m){let v;return m?(v=[h,p,m(h,p),1],a.af(v,v,o)):(v=[h,p,0,1],Ke(v,v,o)),{point:new a.P((v[0]/v[3]+1)/2*this.transform.width+ct,(-v[1]/v[3]+1)/2*this.transform.height+ct),perspectiveRatio:.5+this.transform.cameraToCenterDistance/v[3]*.5}}isOffscreen(o,h,p,m){return p<ct||o>=this.screenRightBoundary||m<ct||h>this.screenBottomBoundary}isInsideGrid(o,h,p,m){return p>=0&&o<this.gridRightBoundary&&m>=0&&h<this.gridBottomBoundary}getViewportMatrix(){const o=a.an([]);return a.H(o,o,[-100,-100,0]),o}}function Ht(y,o,h){return o*(a.W/(y.tileSize*Math.pow(2,h-y.tileID.overscaledZ)))}class cr{constructor(o,h,p,m){this.opacity=o?Math.max(0,Math.min(1,o.opacity+(o.placed?h:-h))):m&&p?1:0,this.placed=p}isHidden(){return this.opacity===0&&!this.placed}}class _r{constructor(o,h,p,m,v){this.text=new cr(o?o.text:null,h,p,v),this.icon=new cr(o?o.icon:null,h,m,v)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Yr{constructor(o,h,p){this.text=o,this.icon=h,this.skipFade=p}}class An{constructor(){this.invProjMatrix=a.F(),this.viewportMatrix=a.F(),this.circles=[]}}class ur{constructor(o,h,p,m,v){this.bucketInstanceId=o,this.featureIndex=h,this.sourceLayerIndex=p,this.bucketIndex=m,this.tileID=v}}class un{constructor(o){this.crossSourceCollisions=o,this.maxGroupID=0,this.collisionGroups={}}get(o){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[o]){const h=++this.maxGroupID;this.collisionGroups[o]={ID:h,predicate:p=>p.collisionGroupID===h}}return this.collisionGroups[o]}}function Fn(y,o,h,p,m){const{horizontalAlign:v,verticalAlign:E}=a.at(y);return new a.P(-(v-.5)*o+p[0]*m,-(E-.5)*h+p[1]*m)}function di(y,o,h,p,m,v){const{x1:E,x2:M,y1:A,y2:F,anchorPointX:$,anchorPointY:q}=y,Y=new a.P(o,h);return p&&Y._rotate(m?v:-v),{x1:E+Y.x,y1:A+Y.y,x2:M+Y.x,y2:F+Y.y,anchorPointX:$,anchorPointY:q}}class xi{constructor(o,h,p,m,v){this.transform=o.clone(),this.terrain=h,this.collisionIndex=new Dt(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=p,this.retainedQueryData={},this.collisionGroups=new un(m),this.collisionCircleArrays={},this.prevPlacement=v,v&&(v.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(o,h,p,m){const v=p.getBucket(h),E=p.latestFeatureIndex;if(!v||!E||h.id!==v.layerIds[0])return;const M=p.collisionBoxArray,A=v.layers[0].layout,F=Math.pow(2,this.transform.zoom-p.tileID.overscaledZ),$=p.tileSize/a.W,q=this.transform.calculatePosMatrix(p.tileID.toUnwrapped()),Y=A.get("text-pitch-alignment")==="map",de=A.get("text-rotation-alignment")==="map",fe=Ht(p,1,this.transform.zoom),ve=tr(q,Y,de,this.transform,fe);let se=null;if(Y){const $e=io(q,Y,de,this.transform,fe);se=a.K([],this.transform.labelPlaneMatrix,$e)}this.retainedQueryData[v.bucketInstanceId]=new ur(v.bucketInstanceId,E,v.sourceLayerIndex,v.index,p.tileID);const Ee={bucket:v,layout:A,posMatrix:q,textLabelPlaneMatrix:ve,labelToScreenMatrix:se,scale:F,textPixelRatio:$,holdingForFade:p.holdingForFade(),collisionBoxArray:M,partiallyEvaluatedTextSize:a.ag(v.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(v.sourceID)};if(m)for(const $e of v.sortKeyRanges){const{sortKey:we,symbolInstanceStart:Le,symbolInstanceEnd:Ge}=$e;o.push({sortKey:we,symbolInstanceStart:Le,symbolInstanceEnd:Ge,parameters:Ee})}else o.push({symbolInstanceStart:0,symbolInstanceEnd:v.symbolInstances.length,parameters:Ee})}attemptAnchorPlacement(o,h,p,m,v,E,M,A,F,$,q,Y,de,fe,ve,se){const Ee=a.ap[o.textAnchor],$e=[o.textOffset0,o.textOffset1],we=Fn(Ee,p,m,$e,v),Le=this.collisionIndex.placeCollisionBox(di(h,we.x,we.y,E,M,this.transform.angle),q,A,F,$.predicate,se);if((!ve||this.collisionIndex.placeCollisionBox(di(ve,we.x,we.y,E,M,this.transform.angle),q,A,F,$.predicate,se).box.length!==0)&&Le.box.length>0){let Ge;if(this.prevPlacement&&this.prevPlacement.variableOffsets[Y.crossTileID]&&this.prevPlacement.placements[Y.crossTileID]&&this.prevPlacement.placements[Y.crossTileID].text&&(Ge=this.prevPlacement.variableOffsets[Y.crossTileID].anchor),Y.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[Y.crossTileID]={textOffset:$e,width:p,height:m,anchor:Ee,textBoxScale:v,prevAnchor:Ge},this.markUsedJustification(de,Ee,Y,fe),de.allowVerticalPlacement&&(this.markUsedOrientation(de,fe,Y),this.placedOrientations[Y.crossTileID]=fe),{shift:we,placedGlyphBoxes:Le}}}placeLayerBucketPart(o,h,p){const{bucket:m,layout:v,posMatrix:E,textLabelPlaneMatrix:M,labelToScreenMatrix:A,textPixelRatio:F,holdingForFade:$,collisionBoxArray:q,partiallyEvaluatedTextSize:Y,collisionGroup:de}=o.parameters,fe=v.get("text-optional"),ve=v.get("icon-optional"),se=a.aq(v,"text-overlap","text-allow-overlap"),Ee=se==="always",$e=a.aq(v,"icon-overlap","icon-allow-overlap"),we=$e==="always",Le=v.get("text-rotation-alignment")==="map",Ge=v.get("text-pitch-alignment")==="map",Ze=v.get("icon-text-fit")!=="none",Xe=v.get("symbol-z-order")==="viewport-y",nt=Ee&&(we||!m.hasIconData()||ve),rt=we&&(Ee||!m.hasTextData()||fe);!m.collisionArrays&&q&&m.deserializeCollisionBoxes(q);const ft=this.retainedQueryData[m.bucketInstanceId].tileID,gt=this.terrain?(yt,Xt)=>this.terrain.getElevation(ft,yt,Xt):null,ar=(yt,Xt)=>{var lr,Sr;if(h[yt.crossTileID])return;if($)return void(this.placements[yt.crossTileID]=new Yr(!1,!1,!1));let er=!1,hr=!1,pr=!0,dn=null,Rr={box:null,offscreen:null},Oi={box:null,offscreen:null},On=null,sn=null,Nn=null,Ni=0,xo=0,rs=0;Xt.textFeatureIndex?Ni=Xt.textFeatureIndex:yt.useRuntimeCollisionCircles&&(Ni=yt.featureIndex),Xt.verticalTextFeatureIndex&&(xo=Xt.verticalTextFeatureIndex);const Za=Xt.textBox;if(Za){const Pn=zn=>{let ln=a.ah.horizontal;if(m.allowVerticalPlacement&&!zn&&this.prevPlacement){const Yi=this.prevPlacement.placedOrientations[yt.crossTileID];Yi&&(this.placedOrientations[yt.crossTileID]=Yi,ln=Yi,this.markUsedOrientation(m,ln,yt))}return ln},an=(zn,ln)=>{if(m.allowVerticalPlacement&&yt.numVerticalGlyphVertices>0&&Xt.verticalTextBox){for(const Yi of m.writingModes)if(Yi===a.ah.vertical?(Rr=ln(),Oi=Rr):Rr=zn(),Rr&&Rr.box&&Rr.box.length)break}else Rr=zn()},en=yt.textAnchorOffsetStartIndex,Ji=yt.textAnchorOffsetEndIndex;if(Ji===en){const zn=(ln,Yi)=>{const Dn=this.collisionIndex.placeCollisionBox(ln,se,F,E,de.predicate,gt);return Dn&&Dn.box&&Dn.box.length&&(this.markUsedOrientation(m,Yi,yt),this.placedOrientations[yt.crossTileID]=Yi),Dn};an(()=>zn(Za,a.ah.horizontal),()=>{const ln=Xt.verticalTextBox;return m.allowVerticalPlacement&&yt.numVerticalGlyphVertices>0&&ln?zn(ln,a.ah.vertical):{box:null,offscreen:null}}),Pn(Rr&&Rr.box&&Rr.box.length)}else{let zn=a.ap[(Sr=(lr=this.prevPlacement)===null||lr===void 0?void 0:lr.variableOffsets[yt.crossTileID])===null||Sr===void 0?void 0:Sr.anchor];const ln=(Dn,vn,mu)=>{const bf=Dn.x2-Dn.x1,Ss=Dn.y2-Dn.y1,ks=yt.textBoxScale,Zl=Ze&&$e==="never"?vn:null;let is={box:[],offscreen:!1},gu=se==="never"?1:2,wf="never";zn&&gu++;for(let _u=0;_u<gu;_u++){for(let yu=en;yu<Ji;yu++){const Hl=m.textAnchorOffsets.get(yu);if(zn&&Hl.textAnchor!==zn)continue;const vu=this.attemptAnchorPlacement(Hl,Dn,bf,Ss,ks,Le,Ge,F,E,de,wf,yt,m,mu,Zl,gt);if(vu&&(is=vu.placedGlyphBoxes,is&&is.box&&is.box.length))return er=!0,dn=vu.shift,is}zn?zn=null:wf=se}return is};an(()=>ln(Za,Xt.iconBox,a.ah.horizontal),()=>{const Dn=Xt.verticalTextBox;return m.allowVerticalPlacement&&!(Rr&&Rr.box&&Rr.box.length)&&yt.numVerticalGlyphVertices>0&&Dn?ln(Dn,Xt.verticalIconBox,a.ah.vertical):{box:null,offscreen:null}}),Rr&&(er=Rr.box,pr=Rr.offscreen);const Yi=Pn(Rr&&Rr.box);if(!er&&this.prevPlacement){const Dn=this.prevPlacement.variableOffsets[yt.crossTileID];Dn&&(this.variableOffsets[yt.crossTileID]=Dn,this.markUsedJustification(m,Dn.anchor,yt,Yi))}}}if(On=Rr,er=On&&On.box&&On.box.length>0,pr=On&&On.offscreen,yt.useRuntimeCollisionCircles){const Pn=m.text.placedSymbolArray.get(yt.centerJustifiedTextSymbolIndex),an=a.ai(m.textSizeData,Y,Pn),en=v.get("text-padding");sn=this.collisionIndex.placeCollisionCircles(se,Pn,m.lineVertexArray,m.glyphOffsetArray,an,E,M,A,p,Ge,de.predicate,yt.collisionCircleDiameter,en,gt),sn.circles.length&&sn.collisionDetected&&!p&&a.w("Collisions detected, but collision boxes are not shown"),er=Ee||sn.circles.length>0&&!sn.collisionDetected,pr=pr&&sn.offscreen}if(Xt.iconFeatureIndex&&(rs=Xt.iconFeatureIndex),Xt.iconBox){const Pn=an=>{const en=Ze&&dn?di(an,dn.x,dn.y,Le,Ge,this.transform.angle):an;return this.collisionIndex.placeCollisionBox(en,$e,F,E,de.predicate,gt)};Oi&&Oi.box&&Oi.box.length&&Xt.verticalIconBox?(Nn=Pn(Xt.verticalIconBox),hr=Nn.box.length>0):(Nn=Pn(Xt.iconBox),hr=Nn.box.length>0),pr=pr&&Nn.offscreen}const ns=fe||yt.numHorizontalGlyphVertices===0&&yt.numVerticalGlyphVertices===0,So=ve||yt.numIconVertices===0;if(ns||So?So?ns||(hr=hr&&er):er=hr&&er:hr=er=hr&&er,er&&On&&On.box&&this.collisionIndex.insertCollisionBox(On.box,se,v.get("text-ignore-placement"),m.bucketInstanceId,Oi&&Oi.box&&xo?xo:Ni,de.ID),hr&&Nn&&this.collisionIndex.insertCollisionBox(Nn.box,$e,v.get("icon-ignore-placement"),m.bucketInstanceId,rs,de.ID),sn&&(er&&this.collisionIndex.insertCollisionCircles(sn.circles,se,v.get("text-ignore-placement"),m.bucketInstanceId,Ni,de.ID),p)){const Pn=m.bucketInstanceId;let an=this.collisionCircleArrays[Pn];an===void 0&&(an=this.collisionCircleArrays[Pn]=new An);for(let en=0;en<sn.circles.length;en+=4)an.circles.push(sn.circles[en+0]),an.circles.push(sn.circles[en+1]),an.circles.push(sn.circles[en+2]),an.circles.push(sn.collisionDetected?1:0)}if(yt.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(m.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[yt.crossTileID]=new Yr(er||nt,hr||rt,pr||m.justReloaded),h[yt.crossTileID]=!0};if(Xe){if(o.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const yt=m.getSortedSymbolIndexes(this.transform.angle);for(let Xt=yt.length-1;Xt>=0;--Xt){const lr=yt[Xt];ar(m.symbolInstances.get(lr),m.collisionArrays[lr])}}else for(let yt=o.symbolInstanceStart;yt<o.symbolInstanceEnd;yt++)ar(m.symbolInstances.get(yt),m.collisionArrays[yt]);if(p&&m.bucketInstanceId in this.collisionCircleArrays){const yt=this.collisionCircleArrays[m.bucketInstanceId];a.ar(yt.invProjMatrix,E),yt.viewportMatrix=this.collisionIndex.getViewportMatrix()}m.justReloaded=!1}markUsedJustification(o,h,p,m){let v;v=m===a.ah.vertical?p.verticalPlacedTextSymbolIndex:{left:p.leftJustifiedTextSymbolIndex,center:p.centerJustifiedTextSymbolIndex,right:p.rightJustifiedTextSymbolIndex}[a.as(h)];const E=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex,p.verticalPlacedTextSymbolIndex];for(const M of E)M>=0&&(o.text.placedSymbolArray.get(M).crossTileID=v>=0&&M!==v?0:p.crossTileID)}markUsedOrientation(o,h,p){const m=h===a.ah.horizontal||h===a.ah.horizontalOnly?h:0,v=h===a.ah.vertical?h:0,E=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex];for(const M of E)o.text.placedSymbolArray.get(M).placedOrientation=m;p.verticalPlacedTextSymbolIndex&&(o.text.placedSymbolArray.get(p.verticalPlacedTextSymbolIndex).placedOrientation=v)}commit(o){this.commitTime=o,this.zoomAtLastRecencyCheck=this.transform.zoom;const h=this.prevPlacement;let p=!1;this.prevZoomAdjustment=h?h.zoomAdjustment(this.transform.zoom):0;const m=h?h.symbolFadeChange(o):1,v=h?h.opacities:{},E=h?h.variableOffsets:{},M=h?h.placedOrientations:{};for(const A in this.placements){const F=this.placements[A],$=v[A];$?(this.opacities[A]=new _r($,m,F.text,F.icon),p=p||F.text!==$.text.placed||F.icon!==$.icon.placed):(this.opacities[A]=new _r(null,m,F.text,F.icon,F.skipFade),p=p||F.text||F.icon)}for(const A in v){const F=v[A];if(!this.opacities[A]){const $=new _r(F,m,!1,!1);$.isHidden()||(this.opacities[A]=$,p=p||F.text.placed||F.icon.placed)}}for(const A in E)this.variableOffsets[A]||!this.opacities[A]||this.opacities[A].isHidden()||(this.variableOffsets[A]=E[A]);for(const A in M)this.placedOrientations[A]||!this.opacities[A]||this.opacities[A].isHidden()||(this.placedOrientations[A]=M[A]);if(h&&h.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");p?this.lastPlacementChangeTime=o:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=h?h.lastPlacementChangeTime:o)}updateLayerOpacities(o,h){const p={};for(const m of h){const v=m.getBucket(o);v&&m.latestFeatureIndex&&o.id===v.layerIds[0]&&this.updateBucketOpacities(v,p,m.collisionBoxArray)}}updateBucketOpacities(o,h,p){o.hasTextData()&&(o.text.opacityVertexArray.clear(),o.text.hasVisibleVertices=!1),o.hasIconData()&&(o.icon.opacityVertexArray.clear(),o.icon.hasVisibleVertices=!1),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexArray.clear(),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexArray.clear();const m=o.layers[0],v=m.layout,E=new _r(null,0,!1,!1,!0),M=v.get("text-allow-overlap"),A=v.get("icon-allow-overlap"),F=m._unevaluatedLayout.hasValue("text-variable-anchor")||m._unevaluatedLayout.hasValue("text-variable-anchor-offset"),$=v.get("text-rotation-alignment")==="map",q=v.get("text-pitch-alignment")==="map",Y=v.get("icon-text-fit")!=="none",de=new _r(null,0,M&&(A||!o.hasIconData()||v.get("icon-optional")),A&&(M||!o.hasTextData()||v.get("text-optional")),!0);!o.collisionArrays&&p&&(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData())&&o.deserializeCollisionBoxes(p);const fe=(ve,se,Ee)=>{for(let $e=0;$e<se/4;$e++)ve.opacityVertexArray.emplaceBack(Ee);ve.hasVisibleVertices=ve.hasVisibleVertices||Ee!==Ta};for(let ve=0;ve<o.symbolInstances.length;ve++){const se=o.symbolInstances.get(ve),{numHorizontalGlyphVertices:Ee,numVerticalGlyphVertices:$e,crossTileID:we}=se;let Le=this.opacities[we];h[we]?Le=E:Le||(Le=de,this.opacities[we]=Le),h[we]=!0;const Ge=se.numIconVertices>0,Ze=this.placedOrientations[se.crossTileID],Xe=Ze===a.ah.vertical,nt=Ze===a.ah.horizontal||Ze===a.ah.horizontalOnly;if(Ee>0||$e>0){const rt=Si(Le.text);fe(o.text,Ee,Xe?Ta:rt),fe(o.text,$e,nt?Ta:rt);const ft=Le.text.isHidden();[se.rightJustifiedTextSymbolIndex,se.centerJustifiedTextSymbolIndex,se.leftJustifiedTextSymbolIndex].forEach(yt=>{yt>=0&&(o.text.placedSymbolArray.get(yt).hidden=ft||Xe?1:0)}),se.verticalPlacedTextSymbolIndex>=0&&(o.text.placedSymbolArray.get(se.verticalPlacedTextSymbolIndex).hidden=ft||nt?1:0);const gt=this.variableOffsets[se.crossTileID];gt&&this.markUsedJustification(o,gt.anchor,se,Ze);const ar=this.placedOrientations[se.crossTileID];ar&&(this.markUsedJustification(o,"left",se,ar),this.markUsedOrientation(o,ar,se))}if(Ge){const rt=Si(Le.icon),ft=!(Y&&se.verticalPlacedIconSymbolIndex&&Xe);se.placedIconSymbolIndex>=0&&(fe(o.icon,se.numIconVertices,ft?rt:Ta),o.icon.placedSymbolArray.get(se.placedIconSymbolIndex).hidden=Le.icon.isHidden()),se.verticalPlacedIconSymbolIndex>=0&&(fe(o.icon,se.numVerticalIconVertices,ft?Ta:rt),o.icon.placedSymbolArray.get(se.verticalPlacedIconSymbolIndex).hidden=Le.icon.isHidden())}if(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData()){const rt=o.collisionArrays[ve];if(rt){let ft=new a.P(0,0);if(rt.textBox||rt.verticalTextBox){let ar=!0;if(F){const yt=this.variableOffsets[we];yt?(ft=Fn(yt.anchor,yt.width,yt.height,yt.textOffset,yt.textBoxScale),$&&ft._rotate(q?this.transform.angle:-this.transform.angle)):ar=!1}rt.textBox&&Kn(o.textCollisionBox.collisionVertexArray,Le.text.placed,!ar||Xe,ft.x,ft.y),rt.verticalTextBox&&Kn(o.textCollisionBox.collisionVertexArray,Le.text.placed,!ar||nt,ft.x,ft.y)}const gt=!!(!nt&&rt.verticalIconBox);rt.iconBox&&Kn(o.iconCollisionBox.collisionVertexArray,Le.icon.placed,gt,Y?ft.x:0,Y?ft.y:0),rt.verticalIconBox&&Kn(o.iconCollisionBox.collisionVertexArray,Le.icon.placed,!gt,Y?ft.x:0,Y?ft.y:0)}}}if(o.sortFeatures(this.transform.angle),this.retainedQueryData[o.bucketInstanceId]&&(this.retainedQueryData[o.bucketInstanceId].featureSortOrder=o.featureSortOrder),o.hasTextData()&&o.text.opacityVertexBuffer&&o.text.opacityVertexBuffer.updateData(o.text.opacityVertexArray),o.hasIconData()&&o.icon.opacityVertexBuffer&&o.icon.opacityVertexBuffer.updateData(o.icon.opacityVertexArray),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexBuffer&&o.iconCollisionBox.collisionVertexBuffer.updateData(o.iconCollisionBox.collisionVertexArray),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexBuffer&&o.textCollisionBox.collisionVertexBuffer.updateData(o.textCollisionBox.collisionVertexArray),o.text.opacityVertexArray.length!==o.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${o.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${o.text.layoutVertexArray.length}) / 4`);if(o.icon.opacityVertexArray.length!==o.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${o.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${o.icon.layoutVertexArray.length}) / 4`);if(o.bucketInstanceId in this.collisionCircleArrays){const ve=this.collisionCircleArrays[o.bucketInstanceId];o.placementInvProjMatrix=ve.invProjMatrix,o.placementViewportMatrix=ve.viewportMatrix,o.collisionCircleArray=ve.circles,delete this.collisionCircleArrays[o.bucketInstanceId]}}symbolFadeChange(o){return this.fadeDuration===0?1:(o-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(o){return Math.max(0,(this.transform.zoom-o)/1.5)}hasTransitions(o){return this.stale||o-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(o,h){const p=this.zoomAtLastRecencyCheck===h?1-this.zoomAdjustment(h):1;return this.zoomAtLastRecencyCheck=h,this.commitTime+this.fadeDuration*p>o}setStale(){this.stale=!0}}function Kn(y,o,h,p,m){y.emplaceBack(o?1:0,h?1:0,p||0,m||0),y.emplaceBack(o?1:0,h?1:0,p||0,m||0),y.emplaceBack(o?1:0,h?1:0,p||0,m||0),y.emplaceBack(o?1:0,h?1:0,p||0,m||0)}const _o=Math.pow(2,25),Bh=Math.pow(2,24),Kd=Math.pow(2,17),zr=Math.pow(2,16),Fc=Math.pow(2,9),Oc=Math.pow(2,8),Ri=Math.pow(2,1);function Si(y){if(y.opacity===0&&!y.placed)return 0;if(y.opacity===1&&y.placed)return 4294967295;const o=y.placed?1:0,h=Math.floor(127*y.opacity);return h*_o+o*Bh+h*Kd+o*zr+h*Fc+o*Oc+h*Ri+o}const Ta=0;class Xi{constructor(o){this._sortAcrossTiles=o.layout.get("symbol-z-order")!=="viewport-y"&&!o.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(o,h,p,m,v){const E=this._bucketParts;for(;this._currentTileIndex<o.length;)if(h.getBucketParts(E,m,o[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,v())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,E.sort((M,A)=>M.sortKey-A.sortKey));this._currentPartIndex<E.length;)if(h.placeLayerBucketPart(E[this._currentPartIndex],this._seenCrossTileIDs,p),this._currentPartIndex++,v())return!0;return!1}}class Ki{constructor(o,h,p,m,v,E,M,A){this.placement=new xi(o,h,E,M,A),this._currentPlacementIndex=p.length-1,this._forceFullPlacement=m,this._showCollisionBoxes=v,this._done=!1}isDone(){return this._done}continuePlacement(o,h,p){const m=S.now(),v=()=>!this._forceFullPlacement&&S.now()-m>2;for(;this._currentPlacementIndex>=0;){const E=h[o[this._currentPlacementIndex]],M=this.placement.collisionIndex.transform.zoom;if(E.type==="symbol"&&(!E.minzoom||E.minzoom<=M)&&(!E.maxzoom||E.maxzoom>M)){if(this._inProgressLayer||(this._inProgressLayer=new Xi(E)),this._inProgressLayer.continuePlacement(p[E.source],this.placement,this._showCollisionBoxes,E,v))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(o){return this.placement.commit(o),this.placement}}const Us=512/a.W/2;class ll{constructor(o,h,p){this.tileID=o,this.bucketInstanceId=p,this._symbolsByKey={};const m=new Map;for(let v=0;v<h.length;v++){const E=h.get(v),M=E.key,A=m.get(M);A?A.push(E):m.set(M,[E])}for(const[v,E]of m){const M={positions:E.map(A=>({x:Math.floor(A.anchorX*Us),y:Math.floor(A.anchorY*Us)})),crossTileIDs:E.map(A=>A.crossTileID)};if(M.positions.length>128){const A=new a.au(M.positions.length,16,Uint16Array);for(const{x:F,y:$}of M.positions)A.add(F,$);A.finish(),delete M.positions,M.index=A}this._symbolsByKey[v]=M}}getScaledCoordinates(o,h){const{x:p,y:m,z:v}=this.tileID.canonical,{x:E,y:M,z:A}=h.canonical,F=Us/Math.pow(2,A-v),$=(M*a.W+o.anchorY)*F,q=m*a.W*Us;return{x:Math.floor((E*a.W+o.anchorX)*F-p*a.W*Us),y:Math.floor($-q)}}findMatches(o,h,p){const m=this.tileID.canonical.z<h.canonical.z?1:Math.pow(2,this.tileID.canonical.z-h.canonical.z);for(let v=0;v<o.length;v++){const E=o.get(v);if(E.crossTileID)continue;const M=this._symbolsByKey[E.key];if(!M)continue;const A=this.getScaledCoordinates(E,h);if(M.index){const F=M.index.range(A.x-m,A.y-m,A.x+m,A.y+m).sort();for(const $ of F){const q=M.crossTileIDs[$];if(!p[q]){p[q]=!0,E.crossTileID=q;break}}}else if(M.positions)for(let F=0;F<M.positions.length;F++){const $=M.positions[F],q=M.crossTileIDs[F];if(Math.abs($.x-A.x)<=m&&Math.abs($.y-A.y)<=m&&!p[q]){p[q]=!0,E.crossTileID=q;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:o})=>o)}}class Ln{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Ea{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(o){const h=Math.round((o-this.lng)/360);if(h!==0)for(const p in this.indexes){const m=this.indexes[p],v={};for(const E in m){const M=m[E];M.tileID=M.tileID.unwrapTo(M.tileID.wrap+h),v[M.tileID.key]=M}this.indexes[p]=v}this.lng=o}addBucket(o,h,p){if(this.indexes[o.overscaledZ]&&this.indexes[o.overscaledZ][o.key]){if(this.indexes[o.overscaledZ][o.key].bucketInstanceId===h.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(o.overscaledZ,this.indexes[o.overscaledZ][o.key])}for(let v=0;v<h.symbolInstances.length;v++)h.symbolInstances.get(v).crossTileID=0;this.usedCrossTileIDs[o.overscaledZ]||(this.usedCrossTileIDs[o.overscaledZ]={});const m=this.usedCrossTileIDs[o.overscaledZ];for(const v in this.indexes){const E=this.indexes[v];if(Number(v)>o.overscaledZ)for(const M in E){const A=E[M];A.tileID.isChildOf(o)&&A.findMatches(h.symbolInstances,o,m)}else{const M=E[o.scaledTo(Number(v)).key];M&&M.findMatches(h.symbolInstances,o,m)}}for(let v=0;v<h.symbolInstances.length;v++){const E=h.symbolInstances.get(v);E.crossTileID||(E.crossTileID=p.generate(),m[E.crossTileID]=!0)}return this.indexes[o.overscaledZ]===void 0&&(this.indexes[o.overscaledZ]={}),this.indexes[o.overscaledZ][o.key]=new ll(o,h.symbolInstances,h.bucketInstanceId),!0}removeBucketCrossTileIDs(o,h){for(const p of h.getCrossTileIDsLists())for(const m of p)delete this.usedCrossTileIDs[o][m]}removeStaleBuckets(o){let h=!1;for(const p in this.indexes){const m=this.indexes[p];for(const v in m)o[m[v].bucketInstanceId]||(this.removeBucketCrossTileIDs(p,m[v]),delete m[v],h=!0)}return h}}class Ko{constructor(){this.layerIndexes={},this.crossTileIDs=new Ln,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(o,h,p){let m=this.layerIndexes[o.id];m===void 0&&(m=this.layerIndexes[o.id]=new Ea);let v=!1;const E={};m.handleWrapJump(p);for(const M of h){const A=M.getBucket(o);A&&o.id===A.layerIds[0]&&(A.bucketInstanceId||(A.bucketInstanceId=++this.maxBucketInstanceId),m.addBucket(M.tileID,A,this.crossTileIDs)&&(v=!0),E[A.bucketInstanceId]=!0)}return m.removeStaleBuckets(E)&&(v=!0),v}pruneUnusedLayers(o){const h={};o.forEach(p=>{h[p]=!0});for(const p in this.layerIndexes)h[p]||delete this.layerIndexes[p]}}const on=(y,o)=>a.t(y,o&&o.filter(h=>h.identifier!=="source.canvas")),cl=a.av();class Bi extends a.E{constructor(o,h={}){super(),this._rtlPluginLoaded=()=>{for(const p in this.sourceCaches){const m=this.sourceCaches[p].getSource().type;m!=="vector"&&m!=="geojson"||this.sourceCaches[p].reload()}},this.map=o,this.dispatcher=new wr(rr(),o._getMapId()),this.dispatcher.registerMessageHandler("GG",(p,m)=>this.getGlyphs(p,m)),this.dispatcher.registerMessageHandler("GI",(p,m)=>this.getImages(p,m)),this.imageManager=new He,this.imageManager.setEventedParent(this),this.glyphManager=new Ut(o._requestManager,h.localIdeographFontFamily),this.lineAtlas=new Ft(256,512),this.crossTileSymbolIndex=new Ko,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new a.aw,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",a.ax()),lt().on(oi,this._rtlPluginLoaded),this.on("data",p=>{if(p.dataType!=="source"||p.sourceDataType!=="metadata")return;const m=this.sourceCaches[p.sourceId];if(!m)return;const v=m.getSource();if(v&&v.vectorLayerIds)for(const E in this._layers){const M=this._layers[E];M.source===v.id&&this._validateLayer(M)}})}loadURL(o,h={},p){this.fire(new a.k("dataloading",{dataType:"style"})),h.validate=typeof h.validate!="boolean"||h.validate;const m=this.map._requestManager.transformRequest(o,"Style");this._loadStyleRequest=new AbortController,a.h(m,this._loadStyleRequest).then(v=>{this._loadStyleRequest=null,this._load(v.data,h,p)}).catch(v=>{this._loadStyleRequest=null,v&&this.fire(new a.j(v))})}loadJSON(o,h={},p){this.fire(new a.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,S.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,h.validate=h.validate!==!1,this._load(o,h,p)}).catch(()=>{})}loadEmpty(){this.fire(new a.k("dataloading",{dataType:"style"})),this._load(cl,{validate:!1})}_load(o,h,p){var m;const v=h.transformStyle?h.transformStyle(p,o):o;if(!h.validate||!on(this,a.x(v))){this._loaded=!0,this.stylesheet=v;for(const E in v.sources)this.addSource(E,v.sources[E],{validate:!1});v.sprite?this._loadSprite(v.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(v.glyphs),this._createLayers(),this.light=new Kt(this.stylesheet.light),this.map.setTerrain((m=this.stylesheet.terrain)!==null&&m!==void 0?m:null),this.fire(new a.k("data",{dataType:"style"})),this.fire(new a.k("style.load"))}}_createLayers(){const o=a.ay(this.stylesheet.layers);this.dispatcher.broadcast("SL",o),this._order=o.map(h=>h.id),this._layers={},this._serializedLayers=null;for(const h of o){const p=a.az(h);p.setEventedParent(this,{layer:{id:h.id}}),this._layers[h.id]=p}}_loadSprite(o,h=!1,p=void 0){let m;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(v,E,M,A){return a._(this,void 0,void 0,function*(){const F=ze(v),$=M>1?"@2x":"",q={},Y={};for(const{id:de,url:fe}of F){const ve=E.transformRequest(E.normalizeSpriteURL(fe,$,".json"),"SpriteJSON");q[de]=a.h(ve,A);const se=E.transformRequest(E.normalizeSpriteURL(fe,$,".png"),"SpriteImage");Y[de]=V.getImage(se,A)}return yield Promise.all([...Object.values(q),...Object.values(Y)]),function(de,fe){return a._(this,void 0,void 0,function*(){const ve={};for(const se in de){ve[se]={};const Ee=S.getImageCanvasContext((yield fe[se]).data),$e=(yield de[se]).data;for(const we in $e){const{width:Le,height:Ge,x:Ze,y:Xe,sdf:nt,pixelRatio:rt,stretchX:ft,stretchY:gt,content:ar}=$e[we];ve[se][we]={data:null,pixelRatio:rt,sdf:nt,stretchX:ft,stretchY:gt,content:ar,spriteData:{width:Le,height:Ge,x:Ze,y:Xe,context:Ee}}}}return ve})}(q,Y)})}(o,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(v=>{if(this._spriteRequest=null,v)for(const E in v){this._spritesImagesIds[E]=[];const M=this._spritesImagesIds[E]?this._spritesImagesIds[E].filter(A=>!(A in v)):[];for(const A of M)this.imageManager.removeImage(A),this._changedImages[A]=!0;for(const A in v[E]){const F=E==="default"?A:`${E}:${A}`;this._spritesImagesIds[E].push(F),F in this.imageManager.images?this.imageManager.updateImage(F,v[E][A],!1):this.imageManager.addImage(F,v[E][A]),h&&(this._changedImages[F]=!0)}}}).catch(v=>{this._spriteRequest=null,m=v,this.fire(new a.j(m))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),h&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.k("data",{dataType:"style"})),p&&p(m)})}_unloadSprite(){for(const o of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(o),this._changedImages[o]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.k("data",{dataType:"style"}))}_validateLayer(o){const h=this.sourceCaches[o.source];if(!h)return;const p=o.sourceLayer;if(!p)return;const m=h.getSource();(m.type==="geojson"||m.vectorLayerIds&&m.vectorLayerIds.indexOf(p)===-1)&&this.fire(new a.j(new Error(`Source layer "${p}" does not exist on source "${m.id}" as specified by style layer "${o.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const o in this.sourceCaches)if(!this.sourceCaches[o].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(o){const h=this._serializedAllLayers();if(!o||o.length===0)return Object.values(h);const p=[];for(const m of o)h[m]&&p.push(h[m]);return p}_serializedAllLayers(){let o=this._serializedLayers;if(o)return o;o=this._serializedLayers={};const h=Object.keys(this._layers);for(const p of h){const m=this._layers[p];m.type!=="custom"&&(o[p]=m.serialize())}return o}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const o in this.sourceCaches)if(this.sourceCaches[o].hasTransition())return!0;for(const o in this._layers)if(this._layers[o].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(o){if(!this._loaded)return;const h=this._changed;if(h){const m=Object.keys(this._updatedLayers),v=Object.keys(this._removedLayers);(m.length||v.length)&&this._updateWorkerLayers(m,v);for(const E in this._updatedSources){const M=this._updatedSources[E];if(M==="reload")this._reloadSource(E);else{if(M!=="clear")throw new Error(`Invalid action ${M}`);this._clearSource(E)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const E in this._updatedPaintProps)this._layers[E].updateTransitions(o);this.light.updateTransitions(o),this._resetUpdates()}const p={};for(const m in this.sourceCaches){const v=this.sourceCaches[m];p[m]=v.used,v.used=!1}for(const m of this._order){const v=this._layers[m];v.recalculate(o,this._availableImages),!v.isHidden(o.zoom)&&v.source&&(this.sourceCaches[v.source].used=!0)}for(const m in p){const v=this.sourceCaches[m];!!p[m]!=!!v.used&&v.fire(new a.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:m}))}this.light.recalculate(o),this.z=o.zoom,h&&this.fire(new a.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const o=Object.keys(this._changedImages);if(o.length){for(const h in this.sourceCaches)this.sourceCaches[h].reloadTilesForDependencies(["icons","patterns"],o);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const o in this.sourceCaches)this.sourceCaches[o].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(o,h){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(o),removedIds:h})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(o,h={}){var p;this._checkLoaded();const m=this.serialize();if(o=h.transformStyle?h.transformStyle(m,o):o,((p=h.validate)===null||p===void 0||p)&&on(this,a.x(o)))return!1;(o=a.aA(o)).layers=a.ay(o.layers);const v=a.aB(m,o),E=this._getOperationsToPerform(v);if(E.unimplemented.length>0)throw new Error(`Unimplemented: ${E.unimplemented.join(", ")}.`);if(E.operations.length===0)return!1;for(const M of E.operations)M();return this.stylesheet=o,this._serializedLayers=null,!0}_getOperationsToPerform(o){const h=[],p=[];for(const m of o)switch(m.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":h.push(()=>this.addLayer.apply(this,m.args));break;case"removeLayer":h.push(()=>this.removeLayer.apply(this,m.args));break;case"setPaintProperty":h.push(()=>this.setPaintProperty.apply(this,m.args));break;case"setLayoutProperty":h.push(()=>this.setLayoutProperty.apply(this,m.args));break;case"setFilter":h.push(()=>this.setFilter.apply(this,m.args));break;case"addSource":h.push(()=>this.addSource.apply(this,m.args));break;case"removeSource":h.push(()=>this.removeSource.apply(this,m.args));break;case"setLayerZoomRange":h.push(()=>this.setLayerZoomRange.apply(this,m.args));break;case"setLight":h.push(()=>this.setLight.apply(this,m.args));break;case"setGeoJSONSourceData":h.push(()=>this.setGeoJSONSourceData.apply(this,m.args));break;case"setGlyphs":h.push(()=>this.setGlyphs.apply(this,m.args));break;case"setSprite":h.push(()=>this.setSprite.apply(this,m.args));break;case"setTerrain":h.push(()=>this.map.setTerrain.apply(this,m.args));break;case"setTransition":h.push(()=>{});break;default:p.push(m.command)}return{operations:h,unimplemented:p}}addImage(o,h){if(this.getImage(o))return this.fire(new a.j(new Error(`An image named "${o}" already exists.`)));this.imageManager.addImage(o,h),this._afterImageUpdated(o)}updateImage(o,h){this.imageManager.updateImage(o,h)}getImage(o){return this.imageManager.getImage(o)}removeImage(o){if(!this.getImage(o))return this.fire(new a.j(new Error(`An image named "${o}" does not exist.`)));this.imageManager.removeImage(o),this._afterImageUpdated(o)}_afterImageUpdated(o){this._availableImages=this.imageManager.listImages(),this._changedImages[o]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(o,h,p={}){if(this._checkLoaded(),this.sourceCaches[o]!==void 0)throw new Error(`Source "${o}" already exists.`);if(!h.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(h).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(h.type)>=0&&this._validate(a.x.source,`sources.${o}`,h,null,p))return;this.map&&this.map._collectResourceTiming&&(h.collectResourceTiming=!0);const m=this.sourceCaches[o]=new Nr(o,h,this.dispatcher);m.style=this,m.setEventedParent(this,()=>({isSourceLoaded:m.loaded(),source:m.serialize(),sourceId:o})),m.onAdd(this.map),this._changed=!0}removeSource(o){if(this._checkLoaded(),this.sourceCaches[o]===void 0)throw new Error("There is no source with this ID");for(const p in this._layers)if(this._layers[p].source===o)return this.fire(new a.j(new Error(`Source "${o}" cannot be removed while layer "${p}" is using it.`)));const h=this.sourceCaches[o];delete this.sourceCaches[o],delete this._updatedSources[o],h.fire(new a.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:o})),h.setEventedParent(null),h.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(o,h){if(this._checkLoaded(),this.sourceCaches[o]===void 0)throw new Error(`There is no source with this ID=${o}`);const p=this.sourceCaches[o].getSource();if(p.type!=="geojson")throw new Error(`geojsonSource.type is ${p.type}, which is !== 'geojson`);p.setData(h),this._changed=!0}getSource(o){return this.sourceCaches[o]&&this.sourceCaches[o].getSource()}addLayer(o,h,p={}){this._checkLoaded();const m=o.id;if(this.getLayer(m))return void this.fire(new a.j(new Error(`Layer "${m}" already exists on this map.`)));let v;if(o.type==="custom"){if(on(this,a.aC(o)))return;v=a.az(o)}else{if("source"in o&&typeof o.source=="object"&&(this.addSource(m,o.source),o=a.aA(o),o=a.e(o,{source:m})),this._validate(a.x.layer,`layers.${m}`,o,{arrayIndex:-1},p))return;v=a.az(o),this._validateLayer(v),v.setEventedParent(this,{layer:{id:m}})}const E=h?this._order.indexOf(h):this._order.length;if(h&&E===-1)this.fire(new a.j(new Error(`Cannot add layer "${m}" before non-existing layer "${h}".`)));else{if(this._order.splice(E,0,m),this._layerOrderChanged=!0,this._layers[m]=v,this._removedLayers[m]&&v.source&&v.type!=="custom"){const M=this._removedLayers[m];delete this._removedLayers[m],M.type!==v.type?this._updatedSources[v.source]="clear":(this._updatedSources[v.source]="reload",this.sourceCaches[v.source].pause())}this._updateLayer(v),v.onAdd&&v.onAdd(this.map)}}moveLayer(o,h){if(this._checkLoaded(),this._changed=!0,!this._layers[o])return void this.fire(new a.j(new Error(`The layer '${o}' does not exist in the map's style and cannot be moved.`)));if(o===h)return;const p=this._order.indexOf(o);this._order.splice(p,1);const m=h?this._order.indexOf(h):this._order.length;h&&m===-1?this.fire(new a.j(new Error(`Cannot move layer "${o}" before non-existing layer "${h}".`))):(this._order.splice(m,0,o),this._layerOrderChanged=!0)}removeLayer(o){this._checkLoaded();const h=this._layers[o];if(!h)return void this.fire(new a.j(new Error(`Cannot remove non-existing layer "${o}".`)));h.setEventedParent(null);const p=this._order.indexOf(o);this._order.splice(p,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[o]=h,delete this._layers[o],this._serializedLayers&&delete this._serializedLayers[o],delete this._updatedLayers[o],delete this._updatedPaintProps[o],h.onRemove&&h.onRemove(this.map)}getLayer(o){return this._layers[o]}getLayersOrder(){return[...this._order]}hasLayer(o){return o in this._layers}setLayerZoomRange(o,h,p){this._checkLoaded();const m=this.getLayer(o);m?m.minzoom===h&&m.maxzoom===p||(h!=null&&(m.minzoom=h),p!=null&&(m.maxzoom=p),this._updateLayer(m)):this.fire(new a.j(new Error(`Cannot set the zoom range of non-existing layer "${o}".`)))}setFilter(o,h,p={}){this._checkLoaded();const m=this.getLayer(o);if(m){if(!a.aD(m.filter,h))return h==null?(m.filter=void 0,void this._updateLayer(m)):void(this._validate(a.x.filter,`layers.${m.id}.filter`,h,null,p)||(m.filter=a.aA(h),this._updateLayer(m)))}else this.fire(new a.j(new Error(`Cannot filter non-existing layer "${o}".`)))}getFilter(o){return a.aA(this.getLayer(o).filter)}setLayoutProperty(o,h,p,m={}){this._checkLoaded();const v=this.getLayer(o);v?a.aD(v.getLayoutProperty(h),p)||(v.setLayoutProperty(h,p,m),this._updateLayer(v)):this.fire(new a.j(new Error(`Cannot style non-existing layer "${o}".`)))}getLayoutProperty(o,h){const p=this.getLayer(o);if(p)return p.getLayoutProperty(h);this.fire(new a.j(new Error(`Cannot get style of non-existing layer "${o}".`)))}setPaintProperty(o,h,p,m={}){this._checkLoaded();const v=this.getLayer(o);v?a.aD(v.getPaintProperty(h),p)||(v.setPaintProperty(h,p,m)&&this._updateLayer(v),this._changed=!0,this._updatedPaintProps[o]=!0,this._serializedLayers=null):this.fire(new a.j(new Error(`Cannot style non-existing layer "${o}".`)))}getPaintProperty(o,h){return this.getLayer(o).getPaintProperty(h)}setFeatureState(o,h){this._checkLoaded();const p=o.source,m=o.sourceLayer,v=this.sourceCaches[p];if(v===void 0)return void this.fire(new a.j(new Error(`The source '${p}' does not exist in the map's style.`)));const E=v.getSource().type;E==="geojson"&&m?this.fire(new a.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):E!=="vector"||m?(o.id===void 0&&this.fire(new a.j(new Error("The feature id parameter must be provided."))),v.setFeatureState(m,o.id,h)):this.fire(new a.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(o,h){this._checkLoaded();const p=o.source,m=this.sourceCaches[p];if(m===void 0)return void this.fire(new a.j(new Error(`The source '${p}' does not exist in the map's style.`)));const v=m.getSource().type,E=v==="vector"?o.sourceLayer:void 0;v!=="vector"||E?h&&typeof o.id!="string"&&typeof o.id!="number"?this.fire(new a.j(new Error("A feature id is required to remove its specific state property."))):m.removeFeatureState(E,o.id,h):this.fire(new a.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(o){this._checkLoaded();const h=o.source,p=o.sourceLayer,m=this.sourceCaches[h];if(m!==void 0)return m.getSource().type!=="vector"||p?(o.id===void 0&&this.fire(new a.j(new Error("The feature id parameter must be provided."))),m.getFeatureState(p,o.id)):void this.fire(new a.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new a.j(new Error(`The source '${h}' does not exist in the map's style.`)))}getTransition(){return a.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const o=a.aE(this.sourceCaches,v=>v.serialize()),h=this._serializeByIds(this._order),p=this.map.getTerrain()||void 0,m=this.stylesheet;return a.aF({version:m.version,name:m.name,metadata:m.metadata,light:m.light,center:m.center,zoom:m.zoom,bearing:m.bearing,pitch:m.pitch,sprite:m.sprite,glyphs:m.glyphs,transition:m.transition,sources:o,layers:h,terrain:p},v=>v!==void 0)}_updateLayer(o){this._updatedLayers[o.id]=!0,o.source&&!this._updatedSources[o.source]&&this.sourceCaches[o.source].getSource().type!=="raster"&&(this._updatedSources[o.source]="reload",this.sourceCaches[o.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(o){const h=E=>this._layers[E].type==="fill-extrusion",p={},m=[];for(let E=this._order.length-1;E>=0;E--){const M=this._order[E];if(h(M)){p[M]=E;for(const A of o){const F=A[M];if(F)for(const $ of F)m.push($)}}}m.sort((E,M)=>M.intersectionZ-E.intersectionZ);const v=[];for(let E=this._order.length-1;E>=0;E--){const M=this._order[E];if(h(M))for(let A=m.length-1;A>=0;A--){const F=m[A].feature;if(p[F.layer.id]<E)break;v.push(F),m.pop()}else for(const A of o){const F=A[M];if(F)for(const $ of F)v.push($.feature)}}return v}queryRenderedFeatures(o,h,p){h&&h.filter&&this._validate(a.x.filter,"queryRenderedFeatures.filter",h.filter,null,h);const m={};if(h&&h.layers){if(!Array.isArray(h.layers))return this.fire(new a.j(new Error("parameters.layers must be an Array."))),[];for(const M of h.layers){const A=this._layers[M];if(!A)return this.fire(new a.j(new Error(`The layer '${M}' does not exist in the map's style and cannot be queried for features.`))),[];m[A.source]=!0}}const v=[];h.availableImages=this._availableImages;const E=this._serializedAllLayers();for(const M in this.sourceCaches)h.layers&&!m[M]||v.push(ht(this.sourceCaches[M],this._layers,E,o,h,p));return this.placement&&v.push(function(M,A,F,$,q,Y,de){const fe={},ve=Y.queryRenderedSymbols($),se=[];for(const Ee of Object.keys(ve).map(Number))se.push(de[Ee]);se.sort(Mt);for(const Ee of se){const $e=Ee.featureIndex.lookupSymbolFeatures(ve[Ee.bucketInstanceId],A,Ee.bucketIndex,Ee.sourceLayerIndex,q.filter,q.layers,q.availableImages,M);for(const we in $e){const Le=fe[we]=fe[we]||[],Ge=$e[we];Ge.sort((Ze,Xe)=>{const nt=Ee.featureSortOrder;if(nt){const rt=nt.indexOf(Ze.featureIndex);return nt.indexOf(Xe.featureIndex)-rt}return Xe.featureIndex-Ze.featureIndex});for(const Ze of Ge)Le.push(Ze)}}for(const Ee in fe)fe[Ee].forEach($e=>{const we=$e.feature,Le=F[M[Ee].source].getFeatureState(we.layer["source-layer"],we.id);we.source=we.layer.source,we.layer["source-layer"]&&(we.sourceLayer=we.layer["source-layer"]),we.state=Le});return fe}(this._layers,E,this.sourceCaches,o,h,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(v)}querySourceFeatures(o,h){h&&h.filter&&this._validate(a.x.filter,"querySourceFeatures.filter",h.filter,null,h);const p=this.sourceCaches[o];return p?function(m,v){const E=m.getRenderableIds().map(F=>m.getTileByID(F)),M=[],A={};for(let F=0;F<E.length;F++){const $=E[F],q=$.tileID.canonical.key;A[q]||(A[q]=!0,$.querySourceFeatures(M,v))}return M}(p,h):[]}getLight(){return this.light.getLight()}setLight(o,h={}){this._checkLoaded();const p=this.light.getLight();let m=!1;for(const E in o)if(!a.aD(o[E],p[E])){m=!0;break}if(!m)return;const v={now:S.now(),transition:a.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(o,h),this.light.updateTransitions(v)}_validate(o,h,p,m,v={}){return(!v||v.validate!==!1)&&on(this,o.call(a.x,a.e({key:h,style:this.serialize(),value:p,styleSpec:a.v},m)))}_remove(o=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),lt().off(oi,this._rtlPluginLoaded);for(const h in this._layers)this._layers[h].setEventedParent(null);for(const h in this.sourceCaches){const p=this.sourceCaches[h];p.setEventedParent(null),p.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),o&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(o)}_clearSource(o){this.sourceCaches[o].clearTiles()}_reloadSource(o){this.sourceCaches[o].resume(),this.sourceCaches[o].reload()}_updateSources(o){for(const h in this.sourceCaches)this.sourceCaches[h].update(o,this.map.terrain)}_generateCollisionBoxes(){for(const o in this.sourceCaches)this._reloadSource(o)}_updatePlacement(o,h,p,m,v=!1){let E=!1,M=!1;const A={};for(const F of this._order){const $=this._layers[F];if($.type!=="symbol")continue;if(!A[$.source]){const Y=this.sourceCaches[$.source];A[$.source]=Y.getRenderableIds(!0).map(de=>Y.getTileByID(de)).sort((de,fe)=>fe.tileID.overscaledZ-de.tileID.overscaledZ||(de.tileID.isLessThan(fe.tileID)?-1:1))}const q=this.crossTileSymbolIndex.addLayer($,A[$.source],o.center.lng);E=E||q}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((v=v||this._layerOrderChanged||p===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(S.now(),o.zoom))&&(this.pauseablePlacement=new Ki(o,this.map.terrain,this._order,v,h,p,m,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,A),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(S.now()),M=!0),E&&this.pauseablePlacement.placement.setStale()),M||E)for(const F of this._order){const $=this._layers[F];$.type==="symbol"&&this.placement.updateLayerOpacities($,A[$.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(S.now())}_releaseSymbolFadeTiles(){for(const o in this.sourceCaches)this.sourceCaches[o].releaseSymbolFadeTiles()}getImages(o,h){return a._(this,void 0,void 0,function*(){const p=yield this.imageManager.getImages(h.icons);this._updateTilesForChangedImages();const m=this.sourceCaches[h.source];return m&&m.setDependencies(h.tileID.key,h.type,h.icons),p})}getGlyphs(o,h){return a._(this,void 0,void 0,function*(){const p=yield this.glyphManager.getGlyphs(h.stacks),m=this.sourceCaches[h.source];return m&&m.setDependencies(h.tileID.key,h.type,[""]),p})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(o,h={}){this._checkLoaded(),o&&this._validate(a.x.glyphs,"glyphs",o,null,h)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=o,this.glyphManager.entries={},this.glyphManager.setURL(o))}addSprite(o,h,p={},m){this._checkLoaded();const v=[{id:o,url:h}],E=[...ze(this.stylesheet.sprite),...v];this._validate(a.x.sprite,"sprite",E,null,p)||(this.stylesheet.sprite=E,this._loadSprite(v,!0,m))}removeSprite(o){this._checkLoaded();const h=ze(this.stylesheet.sprite);if(h.find(p=>p.id===o)){if(this._spritesImagesIds[o])for(const p of this._spritesImagesIds[o])this.imageManager.removeImage(p),this._changedImages[p]=!0;h.splice(h.findIndex(p=>p.id===o),1),this.stylesheet.sprite=h.length>0?h:void 0,delete this._spritesImagesIds[o],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.k("data",{dataType:"style"}))}else this.fire(new a.j(new Error(`Sprite "${o}" doesn't exists on this map.`)))}getSprite(){return ze(this.stylesheet.sprite)}setSprite(o,h={},p){this._checkLoaded(),o&&this._validate(a.x.sprite,"sprite",o,null,h)||(this.stylesheet.sprite=o,o?this._loadSprite(o,!0,p):(this._unloadSprite(),p&&p(null)))}}var ul=a.X([{name:"a_pos",type:"Int16",components:2}]),yo="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const Ca={prelude:Dr(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:Dr(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Dr(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Dr(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Dr("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Dr(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:Dr(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Dr("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Dr("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Dr("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:Dr(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:Dr(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:Dr(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:Dr(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Dr(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Dr(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Dr(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Dr(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Dr(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Dr(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Dr(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Dr(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Dr(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Dr(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Dr(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Dr(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Dr("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",yo),terrainDepth:Dr("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",yo),terrainCoords:Dr("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",yo)};function Dr(y,o){const h=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,p=o.match(/attribute ([\w]+) ([\w]+)/g),m=y.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),v=o.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),E=v?v.concat(m):m,M={};return{fragmentSource:y=y.replace(h,(A,F,$,q,Y)=>(M[Y]=!0,F==="define"?`
#ifndef HAS_UNIFORM_u_${Y}
varying ${$} ${q} ${Y};
#else
uniform ${$} ${q} u_${Y};
#endif
`:`
#ifdef HAS_UNIFORM_u_${Y}
    ${$} ${q} ${Y} = u_${Y};
#endif
`)),vertexSource:o=o.replace(h,(A,F,$,q,Y)=>{const de=q==="float"?"vec2":"vec4",fe=Y.match(/color/)?"color":de;return M[Y]?F==="define"?`
#ifndef HAS_UNIFORM_u_${Y}
uniform lowp float u_${Y}_t;
attribute ${$} ${de} a_${Y};
varying ${$} ${q} ${Y};
#else
uniform ${$} ${q} u_${Y};
#endif
`:fe==="vec4"?`
#ifndef HAS_UNIFORM_u_${Y}
    ${Y} = a_${Y};
#else
    ${$} ${q} ${Y} = u_${Y};
#endif
`:`
#ifndef HAS_UNIFORM_u_${Y}
    ${Y} = unpack_mix_${fe}(a_${Y}, u_${Y}_t);
#else
    ${$} ${q} ${Y} = u_${Y};
#endif
`:F==="define"?`
#ifndef HAS_UNIFORM_u_${Y}
uniform lowp float u_${Y}_t;
attribute ${$} ${de} a_${Y};
#else
uniform ${$} ${q} u_${Y};
#endif
`:fe==="vec4"?`
#ifndef HAS_UNIFORM_u_${Y}
    ${$} ${q} ${Y} = a_${Y};
#else
    ${$} ${q} ${Y} = u_${Y};
#endif
`:`
#ifndef HAS_UNIFORM_u_${Y}
    ${$} ${q} ${Y} = unpack_mix_${fe}(a_${Y}, u_${Y}_t);
#else
    ${$} ${q} ${Y} = u_${Y};
#endif
`}),staticAttributes:p,staticUniforms:E}}class hl{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(o,h,p,m,v,E,M,A,F){this.context=o;let $=this.boundPaintVertexBuffers.length!==m.length;for(let q=0;!$&&q<m.length;q++)this.boundPaintVertexBuffers[q]!==m[q]&&($=!0);!this.vao||this.boundProgram!==h||this.boundLayoutVertexBuffer!==p||$||this.boundIndexBuffer!==v||this.boundVertexOffset!==E||this.boundDynamicVertexBuffer!==M||this.boundDynamicVertexBuffer2!==A||this.boundDynamicVertexBuffer3!==F?this.freshBind(h,p,m,v,E,M,A,F):(o.bindVertexArray.set(this.vao),M&&M.bind(),v&&v.dynamicDraw&&v.bind(),A&&A.bind(),F&&F.bind())}freshBind(o,h,p,m,v,E,M,A){const F=o.numAttributes,$=this.context,q=$.gl;this.vao&&this.destroy(),this.vao=$.createVertexArray(),$.bindVertexArray.set(this.vao),this.boundProgram=o,this.boundLayoutVertexBuffer=h,this.boundPaintVertexBuffers=p,this.boundIndexBuffer=m,this.boundVertexOffset=v,this.boundDynamicVertexBuffer=E,this.boundDynamicVertexBuffer2=M,this.boundDynamicVertexBuffer3=A,h.enableAttributes(q,o);for(const Y of p)Y.enableAttributes(q,o);E&&E.enableAttributes(q,o),M&&M.enableAttributes(q,o),A&&A.enableAttributes(q,o),h.bind(),h.setVertexAttribPointers(q,o,v);for(const Y of p)Y.bind(),Y.setVertexAttribPointers(q,o,v);E&&(E.bind(),E.setVertexAttribPointers(q,o,v)),m&&m.bind(),M&&(M.bind(),M.setVertexAttribPointers(q,o,v)),A&&(A.bind(),A.setVertexAttribPointers(q,o,v)),$.currentNumAttributes=F}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function Vs(y){const o=[];for(let h=0;h<y.length;h++){if(y[h]===null)continue;const p=y[h].split(" ");o.push(p.pop())}return o}class Jo{constructor(o,h,p,m,v,E){const M=o.gl;this.program=M.createProgram();const A=Vs(h.staticAttributes),F=p?p.getBinderAttributes():[],$=A.concat(F),q=Ca.prelude.staticUniforms?Vs(Ca.prelude.staticUniforms):[],Y=h.staticUniforms?Vs(h.staticUniforms):[],de=p?p.getBinderUniforms():[],fe=q.concat(Y).concat(de),ve=[];for(const Ze of fe)ve.indexOf(Ze)<0&&ve.push(Ze);const se=p?p.defines():[];v&&se.push("#define OVERDRAW_INSPECTOR;"),E&&se.push("#define TERRAIN3D;");const Ee=se.concat(Ca.prelude.fragmentSource,h.fragmentSource).join(`
`),$e=se.concat(Ca.prelude.vertexSource,h.vertexSource).join(`
`),we=M.createShader(M.FRAGMENT_SHADER);if(M.isContextLost())return void(this.failedToCreate=!0);if(M.shaderSource(we,Ee),M.compileShader(we),!M.getShaderParameter(we,M.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${M.getShaderInfoLog(we)}`);M.attachShader(this.program,we);const Le=M.createShader(M.VERTEX_SHADER);if(M.isContextLost())return void(this.failedToCreate=!0);if(M.shaderSource(Le,$e),M.compileShader(Le),!M.getShaderParameter(Le,M.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${M.getShaderInfoLog(Le)}`);M.attachShader(this.program,Le),this.attributes={};const Ge={};this.numAttributes=$.length;for(let Ze=0;Ze<this.numAttributes;Ze++)$[Ze]&&(M.bindAttribLocation(this.program,Ze,$[Ze]),this.attributes[$[Ze]]=Ze);if(M.linkProgram(this.program),!M.getProgramParameter(this.program,M.LINK_STATUS))throw new Error(`Program failed to link: ${M.getProgramInfoLog(this.program)}`);M.deleteShader(Le),M.deleteShader(we);for(let Ze=0;Ze<ve.length;Ze++){const Xe=ve[Ze];if(Xe&&!Ge[Xe]){const nt=M.getUniformLocation(this.program,Xe);nt&&(Ge[Xe]=nt)}}this.fixedUniforms=m(o,Ge),this.terrainUniforms=((Ze,Xe)=>({u_depth:new a.aG(Ze,Xe.u_depth),u_terrain:new a.aG(Ze,Xe.u_terrain),u_terrain_dim:new a.aH(Ze,Xe.u_terrain_dim),u_terrain_matrix:new a.aI(Ze,Xe.u_terrain_matrix),u_terrain_unpack:new a.aJ(Ze,Xe.u_terrain_unpack),u_terrain_exaggeration:new a.aH(Ze,Xe.u_terrain_exaggeration)}))(o,Ge),this.binderUniforms=p?p.getUniforms(o,Ge):[]}draw(o,h,p,m,v,E,M,A,F,$,q,Y,de,fe,ve,se,Ee,$e){const we=o.gl;if(this.failedToCreate)return;if(o.program.set(this.program),o.setDepthMode(p),o.setStencilMode(m),o.setColorMode(v),o.setCullFace(E),A){o.activeTexture.set(we.TEXTURE2),we.bindTexture(we.TEXTURE_2D,A.depthTexture),o.activeTexture.set(we.TEXTURE3),we.bindTexture(we.TEXTURE_2D,A.texture);for(const Ge in this.terrainUniforms)this.terrainUniforms[Ge].set(A[Ge])}for(const Ge in this.fixedUniforms)this.fixedUniforms[Ge].set(M[Ge]);ve&&ve.setUniforms(o,this.binderUniforms,de,{zoom:fe});let Le=0;switch(h){case we.LINES:Le=2;break;case we.TRIANGLES:Le=3;break;case we.LINE_STRIP:Le=1}for(const Ge of Y.get()){const Ze=Ge.vaos||(Ge.vaos={});(Ze[F]||(Ze[F]=new hl)).bind(o,this,$,ve?ve.getPaintVertexBuffers():[],q,Ge.vertexOffset,se,Ee,$e),we.drawElements(h,Ge.primitiveLength*Le,we.UNSIGNED_SHORT,Ge.primitiveOffset*Le*2)}}}function fl(y,o,h){const p=1/Ht(h,1,o.transform.tileZoom),m=Math.pow(2,h.tileID.overscaledZ),v=h.tileSize*Math.pow(2,o.transform.tileZoom)/m,E=v*(h.tileID.canonical.x+h.tileID.wrap*m),M=v*h.tileID.canonical.y;return{u_image:0,u_texsize:h.imageAtlasTexture.size,u_scale:[p,y.fromScale,y.toScale],u_fade:y.t,u_pixel_coord_upper:[E>>16,M>>16],u_pixel_coord_lower:[65535&E,65535&M]}}const Ma=(y,o,h,p)=>{const m=o.style.light,v=m.properties.get("position"),E=[v.x,v.y,v.z],M=function(){var F=new a.A(9);return a.A!=Float32Array&&(F[1]=0,F[2]=0,F[3]=0,F[5]=0,F[6]=0,F[7]=0),F[0]=1,F[4]=1,F[8]=1,F}();m.properties.get("anchor")==="viewport"&&function(F,$){var q=Math.sin($),Y=Math.cos($);F[0]=Y,F[1]=q,F[2]=0,F[3]=-q,F[4]=Y,F[5]=0,F[6]=0,F[7]=0,F[8]=1}(M,-o.transform.angle),function(F,$,q){var Y=$[0],de=$[1],fe=$[2];F[0]=Y*q[0]+de*q[3]+fe*q[6],F[1]=Y*q[1]+de*q[4]+fe*q[7],F[2]=Y*q[2]+de*q[5]+fe*q[8]}(E,E,M);const A=m.properties.get("color");return{u_matrix:y,u_lightpos:E,u_lightintensity:m.properties.get("intensity"),u_lightcolor:[A.r,A.g,A.b],u_vertical_gradient:+h,u_opacity:p}},Jd=(y,o,h,p,m,v,E)=>a.e(Ma(y,o,h,p),fl(v,o,E),{u_height_factor:-Math.pow(2,m.overscaledZ)/E.tileSize/8}),Fh=y=>({u_matrix:y}),dl=(y,o,h,p)=>a.e(Fh(y),fl(h,o,p)),Yd=(y,o)=>({u_matrix:y,u_world:o}),Oh=(y,o,h,p,m)=>a.e(dl(y,o,h,p),{u_world:m}),Qd=(y,o,h,p)=>{const m=y.transform;let v,E;if(p.paint.get("circle-pitch-alignment")==="map"){const M=Ht(h,1,m.zoom);v=!0,E=[M,M]}else v=!1,E=m.pixelsToGLUnits;return{u_camera_to_center_distance:m.cameraToCenterDistance,u_scale_with_map:+(p.paint.get("circle-pitch-scale")==="map"),u_matrix:y.translatePosMatrix(o.posMatrix,h,p.paint.get("circle-translate"),p.paint.get("circle-translate-anchor")),u_pitch_with_map:+v,u_device_pixel_ratio:y.pixelRatio,u_extrude_scale:E}},Nh=(y,o,h)=>{const p=Ht(h,1,o.zoom),m=Math.pow(2,o.zoom-h.tileID.overscaledZ),v=h.tileID.overscaleFactor();return{u_matrix:y,u_camera_to_center_distance:o.cameraToCenterDistance,u_pixels_to_tile_units:p,u_extrude_scale:[o.pixelsToGLUnits[0]/(p*m),o.pixelsToGLUnits[1]/(p*m)],u_overscale_factor:v}},jh=(y,o,h=1)=>({u_matrix:y,u_color:o,u_overlay:0,u_overlay_scale:h}),pl=y=>({u_matrix:y}),Uh=(y,o,h,p)=>({u_matrix:y,u_extrude_scale:Ht(o,1,h),u_intensity:p});function Vh(y,o){const h=Math.pow(2,o.canonical.z),p=o.canonical.y;return[new a.Y(0,p/h).toLngLat().lat,new a.Y(0,(p+1)/h).toLngLat().lat]}const ml=(y,o,h,p)=>{const m=y.transform;return{u_matrix:Ia(y,o,h,p),u_ratio:1/Ht(o,1,m.zoom),u_device_pixel_ratio:y.pixelRatio,u_units_to_pixels:[1/m.pixelsToGLUnits[0],1/m.pixelsToGLUnits[1]]}},$h=(y,o,h,p,m)=>a.e(ml(y,o,h,m),{u_image:0,u_image_height:p}),ms=(y,o,h,p,m)=>{const v=y.transform,E=Fi(o,v);return{u_matrix:Ia(y,o,h,m),u_texsize:o.imageAtlasTexture.size,u_ratio:1/Ht(o,1,v.zoom),u_device_pixel_ratio:y.pixelRatio,u_image:0,u_scale:[E,p.fromScale,p.toScale],u_fade:p.t,u_units_to_pixels:[1/v.pixelsToGLUnits[0],1/v.pixelsToGLUnits[1]]}},gl=(y,o,h,p,m,v)=>{const E=y.lineAtlas,M=Fi(o,y.transform),A=h.layout.get("line-cap")==="round",F=E.getDash(p.from,A),$=E.getDash(p.to,A),q=F.width*m.fromScale,Y=$.width*m.toScale;return a.e(ml(y,o,h,v),{u_patternscale_a:[M/q,-F.height/2],u_patternscale_b:[M/Y,-$.height/2],u_sdfgamma:E.width/(256*Math.min(q,Y)*y.pixelRatio)/2,u_image:0,u_tex_y_a:F.y,u_tex_y_b:$.y,u_mix:m.t})};function Fi(y,o){return 1/Ht(y,1,o.tileZoom)}function Ia(y,o,h,p){return y.translatePosMatrix(p?p.posMatrix:o.tileID.posMatrix,o,h.paint.get("line-translate"),h.paint.get("line-translate-anchor"))}const _l=(y,o,h,p,m)=>{return{u_matrix:y,u_tl_parent:o,u_scale_parent:h,u_buffer_scale:1,u_fade_t:p.mix,u_opacity:p.opacity*m.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:m.paint.get("raster-brightness-min"),u_brightness_high:m.paint.get("raster-brightness-max"),u_saturation_factor:(E=m.paint.get("raster-saturation"),E>0?1-1/(1.001-E):-E),u_contrast_factor:(v=m.paint.get("raster-contrast"),v>0?1/(1-v):1+v),u_spin_weights:Aa(m.paint.get("raster-hue-rotate"))};var v,E};function Aa(y){y*=Math.PI/180;const o=Math.sin(y),h=Math.cos(y);return[(2*h+1)/3,(-Math.sqrt(3)*o-h+1)/3,(Math.sqrt(3)*o-h+1)/3]}const La=(y,o,h,p,m,v,E,M,A,F)=>{const $=m.transform;return{u_is_size_zoom_constant:+(y==="constant"||y==="source"),u_is_size_feature_constant:+(y==="constant"||y==="camera"),u_size_t:o?o.uSizeT:0,u_size:o?o.uSize:0,u_camera_to_center_distance:$.cameraToCenterDistance,u_pitch:$.pitch/360*2*Math.PI,u_rotate_symbol:+h,u_aspect_ratio:$.width/$.height,u_fade_change:m.options.fadeDuration?m.symbolFadeChange:1,u_matrix:v,u_label_plane_matrix:E,u_coord_matrix:M,u_is_text:+A,u_pitch_with_map:+p,u_texsize:F,u_texture:0}},Pa=(y,o,h,p,m,v,E,M,A,F,$)=>{const q=m.transform;return a.e(La(y,o,h,p,m,v,E,M,A,F),{u_gamma_scale:p?Math.cos(q._pitch)*q.cameraToCenterDistance:1,u_device_pixel_ratio:m.pixelRatio,u_is_halo:+$})},za=(y,o,h,p,m,v,E,M,A,F)=>a.e(Pa(y,o,h,p,m,v,E,M,!0,A,!0),{u_texsize_icon:F,u_texture_icon:1}),ep=(y,o,h)=>({u_matrix:y,u_opacity:o,u_color:h}),tp=(y,o,h,p,m,v)=>a.e(function(E,M,A,F){const $=A.imageManager.getPattern(E.from.toString()),q=A.imageManager.getPattern(E.to.toString()),{width:Y,height:de}=A.imageManager.getPixelSize(),fe=Math.pow(2,F.tileID.overscaledZ),ve=F.tileSize*Math.pow(2,A.transform.tileZoom)/fe,se=ve*(F.tileID.canonical.x+F.tileID.wrap*fe),Ee=ve*F.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:$.tl,u_pattern_br_a:$.br,u_pattern_tl_b:q.tl,u_pattern_br_b:q.br,u_texsize:[Y,de],u_mix:M.t,u_pattern_size_a:$.displaySize,u_pattern_size_b:q.displaySize,u_scale_a:M.fromScale,u_scale_b:M.toScale,u_tile_units_to_pixels:1/Ht(F,1,A.transform.tileZoom),u_pixel_coord_upper:[se>>16,Ee>>16],u_pixel_coord_lower:[65535&se,65535&Ee]}}(p,v,h,m),{u_matrix:y,u_opacity:o}),qh={fillExtrusion:(y,o)=>({u_matrix:new a.aI(y,o.u_matrix),u_lightpos:new a.aK(y,o.u_lightpos),u_lightintensity:new a.aH(y,o.u_lightintensity),u_lightcolor:new a.aK(y,o.u_lightcolor),u_vertical_gradient:new a.aH(y,o.u_vertical_gradient),u_opacity:new a.aH(y,o.u_opacity)}),fillExtrusionPattern:(y,o)=>({u_matrix:new a.aI(y,o.u_matrix),u_lightpos:new a.aK(y,o.u_lightpos),u_lightintensity:new a.aH(y,o.u_lightintensity),u_lightcolor:new a.aK(y,o.u_lightcolor),u_vertical_gradient:new a.aH(y,o.u_vertical_gradient),u_height_factor:new a.aH(y,o.u_height_factor),u_image:new a.aG(y,o.u_image),u_texsize:new a.aL(y,o.u_texsize),u_pixel_coord_upper:new a.aL(y,o.u_pixel_coord_upper),u_pixel_coord_lower:new a.aL(y,o.u_pixel_coord_lower),u_scale:new a.aK(y,o.u_scale),u_fade:new a.aH(y,o.u_fade),u_opacity:new a.aH(y,o.u_opacity)}),fill:(y,o)=>({u_matrix:new a.aI(y,o.u_matrix)}),fillPattern:(y,o)=>({u_matrix:new a.aI(y,o.u_matrix),u_image:new a.aG(y,o.u_image),u_texsize:new a.aL(y,o.u_texsize),u_pixel_coord_upper:new a.aL(y,o.u_pixel_coord_upper),u_pixel_coord_lower:new a.aL(y,o.u_pixel_coord_lower),u_scale:new a.aK(y,o.u_scale),u_fade:new a.aH(y,o.u_fade)}),fillOutline:(y,o)=>({u_matrix:new a.aI(y,o.u_matrix),u_world:new a.aL(y,o.u_world)}),fillOutlinePattern:(y,o)=>({u_matrix:new a.aI(y,o.u_matrix),u_world:new a.aL(y,o.u_world),u_image:new a.aG(y,o.u_image),u_texsize:new a.aL(y,o.u_texsize),u_pixel_coord_upper:new a.aL(y,o.u_pixel_coord_upper),u_pixel_coord_lower:new a.aL(y,o.u_pixel_coord_lower),u_scale:new a.aK(y,o.u_scale),u_fade:new a.aH(y,o.u_fade)}),circle:(y,o)=>({u_camera_to_center_distance:new a.aH(y,o.u_camera_to_center_distance),u_scale_with_map:new a.aG(y,o.u_scale_with_map),u_pitch_with_map:new a.aG(y,o.u_pitch_with_map),u_extrude_scale:new a.aL(y,o.u_extrude_scale),u_device_pixel_ratio:new a.aH(y,o.u_device_pixel_ratio),u_matrix:new a.aI(y,o.u_matrix)}),collisionBox:(y,o)=>({u_matrix:new a.aI(y,o.u_matrix),u_camera_to_center_distance:new a.aH(y,o.u_camera_to_center_distance),u_pixels_to_tile_units:new a.aH(y,o.u_pixels_to_tile_units),u_extrude_scale:new a.aL(y,o.u_extrude_scale),u_overscale_factor:new a.aH(y,o.u_overscale_factor)}),collisionCircle:(y,o)=>({u_matrix:new a.aI(y,o.u_matrix),u_inv_matrix:new a.aI(y,o.u_inv_matrix),u_camera_to_center_distance:new a.aH(y,o.u_camera_to_center_distance),u_viewport_size:new a.aL(y,o.u_viewport_size)}),debug:(y,o)=>({u_color:new a.aM(y,o.u_color),u_matrix:new a.aI(y,o.u_matrix),u_overlay:new a.aG(y,o.u_overlay),u_overlay_scale:new a.aH(y,o.u_overlay_scale)}),clippingMask:(y,o)=>({u_matrix:new a.aI(y,o.u_matrix)}),heatmap:(y,o)=>({u_extrude_scale:new a.aH(y,o.u_extrude_scale),u_intensity:new a.aH(y,o.u_intensity),u_matrix:new a.aI(y,o.u_matrix)}),heatmapTexture:(y,o)=>({u_matrix:new a.aI(y,o.u_matrix),u_world:new a.aL(y,o.u_world),u_image:new a.aG(y,o.u_image),u_color_ramp:new a.aG(y,o.u_color_ramp),u_opacity:new a.aH(y,o.u_opacity)}),hillshade:(y,o)=>({u_matrix:new a.aI(y,o.u_matrix),u_image:new a.aG(y,o.u_image),u_latrange:new a.aL(y,o.u_latrange),u_light:new a.aL(y,o.u_light),u_shadow:new a.aM(y,o.u_shadow),u_highlight:new a.aM(y,o.u_highlight),u_accent:new a.aM(y,o.u_accent)}),hillshadePrepare:(y,o)=>({u_matrix:new a.aI(y,o.u_matrix),u_image:new a.aG(y,o.u_image),u_dimension:new a.aL(y,o.u_dimension),u_zoom:new a.aH(y,o.u_zoom),u_unpack:new a.aJ(y,o.u_unpack)}),line:(y,o)=>({u_matrix:new a.aI(y,o.u_matrix),u_ratio:new a.aH(y,o.u_ratio),u_device_pixel_ratio:new a.aH(y,o.u_device_pixel_ratio),u_units_to_pixels:new a.aL(y,o.u_units_to_pixels)}),lineGradient:(y,o)=>({u_matrix:new a.aI(y,o.u_matrix),u_ratio:new a.aH(y,o.u_ratio),u_device_pixel_ratio:new a.aH(y,o.u_device_pixel_ratio),u_units_to_pixels:new a.aL(y,o.u_units_to_pixels),u_image:new a.aG(y,o.u_image),u_image_height:new a.aH(y,o.u_image_height)}),linePattern:(y,o)=>({u_matrix:new a.aI(y,o.u_matrix),u_texsize:new a.aL(y,o.u_texsize),u_ratio:new a.aH(y,o.u_ratio),u_device_pixel_ratio:new a.aH(y,o.u_device_pixel_ratio),u_image:new a.aG(y,o.u_image),u_units_to_pixels:new a.aL(y,o.u_units_to_pixels),u_scale:new a.aK(y,o.u_scale),u_fade:new a.aH(y,o.u_fade)}),lineSDF:(y,o)=>({u_matrix:new a.aI(y,o.u_matrix),u_ratio:new a.aH(y,o.u_ratio),u_device_pixel_ratio:new a.aH(y,o.u_device_pixel_ratio),u_units_to_pixels:new a.aL(y,o.u_units_to_pixels),u_patternscale_a:new a.aL(y,o.u_patternscale_a),u_patternscale_b:new a.aL(y,o.u_patternscale_b),u_sdfgamma:new a.aH(y,o.u_sdfgamma),u_image:new a.aG(y,o.u_image),u_tex_y_a:new a.aH(y,o.u_tex_y_a),u_tex_y_b:new a.aH(y,o.u_tex_y_b),u_mix:new a.aH(y,o.u_mix)}),raster:(y,o)=>({u_matrix:new a.aI(y,o.u_matrix),u_tl_parent:new a.aL(y,o.u_tl_parent),u_scale_parent:new a.aH(y,o.u_scale_parent),u_buffer_scale:new a.aH(y,o.u_buffer_scale),u_fade_t:new a.aH(y,o.u_fade_t),u_opacity:new a.aH(y,o.u_opacity),u_image0:new a.aG(y,o.u_image0),u_image1:new a.aG(y,o.u_image1),u_brightness_low:new a.aH(y,o.u_brightness_low),u_brightness_high:new a.aH(y,o.u_brightness_high),u_saturation_factor:new a.aH(y,o.u_saturation_factor),u_contrast_factor:new a.aH(y,o.u_contrast_factor),u_spin_weights:new a.aK(y,o.u_spin_weights)}),symbolIcon:(y,o)=>({u_is_size_zoom_constant:new a.aG(y,o.u_is_size_zoom_constant),u_is_size_feature_constant:new a.aG(y,o.u_is_size_feature_constant),u_size_t:new a.aH(y,o.u_size_t),u_size:new a.aH(y,o.u_size),u_camera_to_center_distance:new a.aH(y,o.u_camera_to_center_distance),u_pitch:new a.aH(y,o.u_pitch),u_rotate_symbol:new a.aG(y,o.u_rotate_symbol),u_aspect_ratio:new a.aH(y,o.u_aspect_ratio),u_fade_change:new a.aH(y,o.u_fade_change),u_matrix:new a.aI(y,o.u_matrix),u_label_plane_matrix:new a.aI(y,o.u_label_plane_matrix),u_coord_matrix:new a.aI(y,o.u_coord_matrix),u_is_text:new a.aG(y,o.u_is_text),u_pitch_with_map:new a.aG(y,o.u_pitch_with_map),u_texsize:new a.aL(y,o.u_texsize),u_texture:new a.aG(y,o.u_texture)}),symbolSDF:(y,o)=>({u_is_size_zoom_constant:new a.aG(y,o.u_is_size_zoom_constant),u_is_size_feature_constant:new a.aG(y,o.u_is_size_feature_constant),u_size_t:new a.aH(y,o.u_size_t),u_size:new a.aH(y,o.u_size),u_camera_to_center_distance:new a.aH(y,o.u_camera_to_center_distance),u_pitch:new a.aH(y,o.u_pitch),u_rotate_symbol:new a.aG(y,o.u_rotate_symbol),u_aspect_ratio:new a.aH(y,o.u_aspect_ratio),u_fade_change:new a.aH(y,o.u_fade_change),u_matrix:new a.aI(y,o.u_matrix),u_label_plane_matrix:new a.aI(y,o.u_label_plane_matrix),u_coord_matrix:new a.aI(y,o.u_coord_matrix),u_is_text:new a.aG(y,o.u_is_text),u_pitch_with_map:new a.aG(y,o.u_pitch_with_map),u_texsize:new a.aL(y,o.u_texsize),u_texture:new a.aG(y,o.u_texture),u_gamma_scale:new a.aH(y,o.u_gamma_scale),u_device_pixel_ratio:new a.aH(y,o.u_device_pixel_ratio),u_is_halo:new a.aG(y,o.u_is_halo)}),symbolTextAndIcon:(y,o)=>({u_is_size_zoom_constant:new a.aG(y,o.u_is_size_zoom_constant),u_is_size_feature_constant:new a.aG(y,o.u_is_size_feature_constant),u_size_t:new a.aH(y,o.u_size_t),u_size:new a.aH(y,o.u_size),u_camera_to_center_distance:new a.aH(y,o.u_camera_to_center_distance),u_pitch:new a.aH(y,o.u_pitch),u_rotate_symbol:new a.aG(y,o.u_rotate_symbol),u_aspect_ratio:new a.aH(y,o.u_aspect_ratio),u_fade_change:new a.aH(y,o.u_fade_change),u_matrix:new a.aI(y,o.u_matrix),u_label_plane_matrix:new a.aI(y,o.u_label_plane_matrix),u_coord_matrix:new a.aI(y,o.u_coord_matrix),u_is_text:new a.aG(y,o.u_is_text),u_pitch_with_map:new a.aG(y,o.u_pitch_with_map),u_texsize:new a.aL(y,o.u_texsize),u_texsize_icon:new a.aL(y,o.u_texsize_icon),u_texture:new a.aG(y,o.u_texture),u_texture_icon:new a.aG(y,o.u_texture_icon),u_gamma_scale:new a.aH(y,o.u_gamma_scale),u_device_pixel_ratio:new a.aH(y,o.u_device_pixel_ratio),u_is_halo:new a.aG(y,o.u_is_halo)}),background:(y,o)=>({u_matrix:new a.aI(y,o.u_matrix),u_opacity:new a.aH(y,o.u_opacity),u_color:new a.aM(y,o.u_color)}),backgroundPattern:(y,o)=>({u_matrix:new a.aI(y,o.u_matrix),u_opacity:new a.aH(y,o.u_opacity),u_image:new a.aG(y,o.u_image),u_pattern_tl_a:new a.aL(y,o.u_pattern_tl_a),u_pattern_br_a:new a.aL(y,o.u_pattern_br_a),u_pattern_tl_b:new a.aL(y,o.u_pattern_tl_b),u_pattern_br_b:new a.aL(y,o.u_pattern_br_b),u_texsize:new a.aL(y,o.u_texsize),u_mix:new a.aH(y,o.u_mix),u_pattern_size_a:new a.aL(y,o.u_pattern_size_a),u_pattern_size_b:new a.aL(y,o.u_pattern_size_b),u_scale_a:new a.aH(y,o.u_scale_a),u_scale_b:new a.aH(y,o.u_scale_b),u_pixel_coord_upper:new a.aL(y,o.u_pixel_coord_upper),u_pixel_coord_lower:new a.aL(y,o.u_pixel_coord_lower),u_tile_units_to_pixels:new a.aH(y,o.u_tile_units_to_pixels)}),terrain:(y,o)=>({u_matrix:new a.aI(y,o.u_matrix),u_texture:new a.aG(y,o.u_texture),u_ele_delta:new a.aH(y,o.u_ele_delta)}),terrainDepth:(y,o)=>({u_matrix:new a.aI(y,o.u_matrix),u_ele_delta:new a.aH(y,o.u_ele_delta)}),terrainCoords:(y,o)=>({u_matrix:new a.aI(y,o.u_matrix),u_texture:new a.aG(y,o.u_texture),u_terrain_coords_id:new a.aH(y,o.u_terrain_coords_id),u_ele_delta:new a.aH(y,o.u_ele_delta)})};class rp{constructor(o,h,p){this.context=o;const m=o.gl;this.buffer=m.createBuffer(),this.dynamicDraw=!!p,this.context.unbindVAO(),o.bindElementBuffer.set(this.buffer),m.bufferData(m.ELEMENT_ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?m.DYNAMIC_DRAW:m.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(o){const h=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),h.bufferSubData(h.ELEMENT_ARRAY_BUFFER,0,o.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const gs={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class yl{constructor(o,h,p,m){this.length=h.length,this.attributes=p,this.itemSize=h.bytesPerElement,this.dynamicDraw=m,this.context=o;const v=o.gl;this.buffer=v.createBuffer(),o.bindVertexBuffer.set(this.buffer),v.bufferData(v.ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?v.DYNAMIC_DRAW:v.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(o){if(o.length!==this.length)throw new Error(`Length of new data is ${o.length}, which doesn't match current length of ${this.length}`);const h=this.context.gl;this.bind(),h.bufferSubData(h.ARRAY_BUFFER,0,o.arrayBuffer)}enableAttributes(o,h){for(let p=0;p<this.attributes.length;p++){const m=h.attributes[this.attributes[p].name];m!==void 0&&o.enableVertexAttribArray(m)}}setVertexAttribPointers(o,h,p){for(let m=0;m<this.attributes.length;m++){const v=this.attributes[m],E=h.attributes[v.name];E!==void 0&&o.vertexAttribPointer(E,v.components,o[gs[v.type]],!1,this.itemSize,v.offset+this.itemSize*(p||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const pi=new WeakMap;function si(y){var o;if(pi.has(y))return pi.get(y);{const h=(o=y.getParameter(y.VERSION))===null||o===void 0?void 0:o.startsWith("WebGL 2.0");return pi.set(y,h),h}}class Cr{constructor(o){this.gl=o.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(o){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class vl extends Cr{getDefault(){return a.aO.transparent}set(o){const h=this.current;(o.r!==h.r||o.g!==h.g||o.b!==h.b||o.a!==h.a||this.dirty)&&(this.gl.clearColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class bl extends Cr{getDefault(){return 1}set(o){(o!==this.current||this.dirty)&&(this.gl.clearDepth(o),this.current=o,this.dirty=!1)}}class Nc extends Cr{getDefault(){return 0}set(o){(o!==this.current||this.dirty)&&(this.gl.clearStencil(o),this.current=o,this.dirty=!1)}}class jc extends Cr{getDefault(){return[!0,!0,!0,!0]}set(o){const h=this.current;(o[0]!==h[0]||o[1]!==h[1]||o[2]!==h[2]||o[3]!==h[3]||this.dirty)&&(this.gl.colorMask(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class wl extends Cr{getDefault(){return!0}set(o){(o!==this.current||this.dirty)&&(this.gl.depthMask(o),this.current=o,this.dirty=!1)}}class Uc extends Cr{getDefault(){return 255}set(o){(o!==this.current||this.dirty)&&(this.gl.stencilMask(o),this.current=o,this.dirty=!1)}}class Vc extends Cr{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(o){const h=this.current;(o.func!==h.func||o.ref!==h.ref||o.mask!==h.mask||this.dirty)&&(this.gl.stencilFunc(o.func,o.ref,o.mask),this.current=o,this.dirty=!1)}}class xl extends Cr{getDefault(){const o=this.gl;return[o.KEEP,o.KEEP,o.KEEP]}set(o){const h=this.current;(o[0]!==h[0]||o[1]!==h[1]||o[2]!==h[2]||this.dirty)&&(this.gl.stencilOp(o[0],o[1],o[2]),this.current=o,this.dirty=!1)}}class Gh extends Cr{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;o?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),this.current=o,this.dirty=!1}}class Wh extends Cr{getDefault(){return[0,1]}set(o){const h=this.current;(o[0]!==h[0]||o[1]!==h[1]||this.dirty)&&(this.gl.depthRange(o[0],o[1]),this.current=o,this.dirty=!1)}}class $s extends Cr{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;o?h.enable(h.DEPTH_TEST):h.disable(h.DEPTH_TEST),this.current=o,this.dirty=!1}}class np extends Cr{getDefault(){return this.gl.LESS}set(o){(o!==this.current||this.dirty)&&(this.gl.depthFunc(o),this.current=o,this.dirty=!1)}}class ip extends Cr{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;o?h.enable(h.BLEND):h.disable(h.BLEND),this.current=o,this.dirty=!1}}class op extends Cr{getDefault(){const o=this.gl;return[o.ONE,o.ZERO]}set(o){const h=this.current;(o[0]!==h[0]||o[1]!==h[1]||this.dirty)&&(this.gl.blendFunc(o[0],o[1]),this.current=o,this.dirty=!1)}}class sp extends Cr{getDefault(){return a.aO.transparent}set(o){const h=this.current;(o.r!==h.r||o.g!==h.g||o.b!==h.b||o.a!==h.a||this.dirty)&&(this.gl.blendColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class ap extends Cr{getDefault(){return this.gl.FUNC_ADD}set(o){(o!==this.current||this.dirty)&&(this.gl.blendEquation(o),this.current=o,this.dirty=!1)}}class lp extends Cr{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;o?h.enable(h.CULL_FACE):h.disable(h.CULL_FACE),this.current=o,this.dirty=!1}}class $c extends Cr{getDefault(){return this.gl.BACK}set(o){(o!==this.current||this.dirty)&&(this.gl.cullFace(o),this.current=o,this.dirty=!1)}}class Sl extends Cr{getDefault(){return this.gl.CCW}set(o){(o!==this.current||this.dirty)&&(this.gl.frontFace(o),this.current=o,this.dirty=!1)}}class qc extends Cr{getDefault(){return null}set(o){(o!==this.current||this.dirty)&&(this.gl.useProgram(o),this.current=o,this.dirty=!1)}}class Gc extends Cr{getDefault(){return this.gl.TEXTURE0}set(o){(o!==this.current||this.dirty)&&(this.gl.activeTexture(o),this.current=o,this.dirty=!1)}}class qs extends Cr{getDefault(){const o=this.gl;return[0,0,o.drawingBufferWidth,o.drawingBufferHeight]}set(o){const h=this.current;(o[0]!==h[0]||o[1]!==h[1]||o[2]!==h[2]||o[3]!==h[3]||this.dirty)&&(this.gl.viewport(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class Zh extends Cr{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.bindFramebuffer(h.FRAMEBUFFER,o),this.current=o,this.dirty=!1}}class Hh extends Cr{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.bindRenderbuffer(h.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class Wc extends Cr{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.bindTexture(h.TEXTURE_2D,o),this.current=o,this.dirty=!1}}class _s extends Cr{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.bindBuffer(h.ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class Xh extends Cr{getDefault(){return null}set(o){const h=this.gl;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class Gs extends Cr{getDefault(){return null}set(o){var h;if(o===this.current&&!this.dirty)return;const p=this.gl;si(p)?p.bindVertexArray(o):(h=p.getExtension("OES_vertex_array_object"))===null||h===void 0||h.bindVertexArrayOES(o),this.current=o,this.dirty=!1}}class Ws extends Cr{getDefault(){return 4}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_ALIGNMENT,o),this.current=o,this.dirty=!1}}class Kh extends Cr{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o),this.current=o,this.dirty=!1}}class Zc extends Cr{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,o),this.current=o,this.dirty=!1}}class Er extends Cr{constructor(o,h){super(o),this.context=o,this.parent=h}getDefault(){return null}}class kl extends Er{setDirty(){this.dirty=!0}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,o,0),this.current=o,this.dirty=!1}}class cp extends Er{set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_ATTACHMENT,h.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class Jh extends Er{set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_STENCIL_ATTACHMENT,h.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class Da{constructor(o,h,p,m,v){this.context=o,this.width=h,this.height=p;const E=o.gl,M=this.framebuffer=E.createFramebuffer();if(this.colorAttachment=new kl(o,M),m)this.depthAttachment=v?new Jh(o,M):new cp(o,M);else if(v)throw new Error("Stencil cannot be set without depth");if(E.checkFramebufferStatus(E.FRAMEBUFFER)!==E.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const o=this.context.gl,h=this.colorAttachment.get();if(h&&o.deleteTexture(h),this.depthAttachment){const p=this.depthAttachment.get();p&&o.deleteRenderbuffer(p)}o.deleteFramebuffer(this.framebuffer)}}class Tn{constructor(o,h,p){this.blendFunction=o,this.blendColor=h,this.mask=p}}Tn.Replace=[1,0],Tn.disabled=new Tn(Tn.Replace,a.aO.transparent,[!1,!1,!1,!1]),Tn.unblended=new Tn(Tn.Replace,a.aO.transparent,[!0,!0,!0,!0]),Tn.alphaBlended=new Tn([1,771],a.aO.transparent,[!0,!0,!0,!0]);class up{constructor(o){var h,p;if(this.gl=o,this.clearColor=new vl(this),this.clearDepth=new bl(this),this.clearStencil=new Nc(this),this.colorMask=new jc(this),this.depthMask=new wl(this),this.stencilMask=new Uc(this),this.stencilFunc=new Vc(this),this.stencilOp=new xl(this),this.stencilTest=new Gh(this),this.depthRange=new Wh(this),this.depthTest=new $s(this),this.depthFunc=new np(this),this.blend=new ip(this),this.blendFunc=new op(this),this.blendColor=new sp(this),this.blendEquation=new ap(this),this.cullFace=new lp(this),this.cullFaceSide=new $c(this),this.frontFace=new Sl(this),this.program=new qc(this),this.activeTexture=new Gc(this),this.viewport=new qs(this),this.bindFramebuffer=new Zh(this),this.bindRenderbuffer=new Hh(this),this.bindTexture=new Wc(this),this.bindVertexBuffer=new _s(this),this.bindElementBuffer=new Xh(this),this.bindVertexArray=new Gs(this),this.pixelStoreUnpack=new Ws(this),this.pixelStoreUnpackPremultiplyAlpha=new Kh(this),this.pixelStoreUnpackFlipY=new Zc(this),this.extTextureFilterAnisotropic=o.getExtension("EXT_texture_filter_anisotropic")||o.getExtension("MOZ_EXT_texture_filter_anisotropic")||o.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=o.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=o.getParameter(o.MAX_TEXTURE_SIZE),si(o)){this.HALF_FLOAT=o.HALF_FLOAT;const m=o.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(h=o.RGBA16F)!==null&&h!==void 0?h:m==null?void 0:m.RGBA16F_EXT,this.RGB16F=(p=o.RGB16F)!==null&&p!==void 0?p:m==null?void 0:m.RGB16F_EXT,o.getExtension("EXT_color_buffer_float")}else{o.getExtension("EXT_color_buffer_half_float"),o.getExtension("OES_texture_half_float_linear");const m=o.getExtension("OES_texture_half_float");this.HALF_FLOAT=m==null?void 0:m.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(o,h){return new rp(this,o,h)}createVertexBuffer(o,h,p){return new yl(this,o,h,p)}createRenderbuffer(o,h,p){const m=this.gl,v=m.createRenderbuffer();return this.bindRenderbuffer.set(v),m.renderbufferStorage(m.RENDERBUFFER,o,h,p),this.bindRenderbuffer.set(null),v}createFramebuffer(o,h,p,m){return new Da(this,o,h,p,m)}clear({color:o,depth:h,stencil:p}){const m=this.gl;let v=0;o&&(v|=m.COLOR_BUFFER_BIT,this.clearColor.set(o),this.colorMask.set([!0,!0,!0,!0])),h!==void 0&&(v|=m.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(h),this.depthMask.set(!0)),p!==void 0&&(v|=m.STENCIL_BUFFER_BIT,this.clearStencil.set(p),this.stencilMask.set(255)),m.clear(v)}setCullFace(o){o.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(o.mode),this.frontFace.set(o.frontFace))}setDepthMode(o){o.func!==this.gl.ALWAYS||o.mask?(this.depthTest.set(!0),this.depthFunc.set(o.func),this.depthMask.set(o.mask),this.depthRange.set(o.range)):this.depthTest.set(!1)}setStencilMode(o){o.test.func!==this.gl.ALWAYS||o.mask?(this.stencilTest.set(!0),this.stencilMask.set(o.mask),this.stencilOp.set([o.fail,o.depthFail,o.pass]),this.stencilFunc.set({func:o.test.func,ref:o.ref,mask:o.test.mask})):this.stencilTest.set(!1)}setColorMode(o){a.aD(o.blendFunction,Tn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(o.blendFunction),this.blendColor.set(o.blendColor)),this.colorMask.set(o.mask)}createVertexArray(){var o;return si(this.gl)?this.gl.createVertexArray():(o=this.gl.getExtension("OES_vertex_array_object"))===null||o===void 0?void 0:o.createVertexArrayOES()}deleteVertexArray(o){var h;return si(this.gl)?this.gl.deleteVertexArray(o):(h=this.gl.getExtension("OES_vertex_array_object"))===null||h===void 0?void 0:h.deleteVertexArrayOES(o)}unbindVAO(){this.bindVertexArray.set(null)}}class xr{constructor(o,h,p){this.func=o,this.mask=h,this.range=p}}xr.ReadOnly=!1,xr.ReadWrite=!0,xr.disabled=new xr(519,xr.ReadOnly,[0,1]);const Hc=7680;class Hr{constructor(o,h,p,m,v,E){this.test=o,this.ref=h,this.mask=p,this.fail=m,this.depthFail=v,this.pass=E}}Hr.disabled=new Hr({func:519,mask:0},0,0,Hc,Hc,Hc);class Ur{constructor(o,h,p){this.enable=o,this.mode=h,this.frontFace=p}}let ys;function Tl(y,o,h,p,m,v,E){const M=y.context,A=M.gl,F=y.useProgram("collisionBox"),$=[];let q=0,Y=0;for(let we=0;we<p.length;we++){const Le=p[we],Ge=o.getTile(Le),Ze=Ge.getBucket(h);if(!Ze)continue;let Xe=Le.posMatrix;m[0]===0&&m[1]===0||(Xe=y.translatePosMatrix(Le.posMatrix,Ge,m,v));const nt=E?Ze.textCollisionBox:Ze.iconCollisionBox,rt=Ze.collisionCircleArray;if(rt.length>0){const ft=a.F(),gt=Xe;a.aP(ft,Ze.placementInvProjMatrix,y.transform.glCoordMatrix),a.aP(ft,ft,Ze.placementViewportMatrix),$.push({circleArray:rt,circleOffset:Y,transform:gt,invTransform:ft,coord:Le}),q+=rt.length/4,Y=q}nt&&F.draw(M,A.LINES,xr.disabled,Hr.disabled,y.colorModeForRenderPass(),Ur.disabled,Nh(Xe,y.transform,Ge),y.style.map.terrain&&y.style.map.terrain.getTerrainData(Le),h.id,nt.layoutVertexBuffer,nt.indexBuffer,nt.segments,null,y.transform.zoom,null,null,nt.collisionVertexBuffer)}if(!E||!$.length)return;const de=y.useProgram("collisionCircle"),fe=new a.aQ;fe.resize(4*q),fe._trim();let ve=0;for(const we of $)for(let Le=0;Le<we.circleArray.length/4;Le++){const Ge=4*Le,Ze=we.circleArray[Ge+0],Xe=we.circleArray[Ge+1],nt=we.circleArray[Ge+2],rt=we.circleArray[Ge+3];fe.emplace(ve++,Ze,Xe,nt,rt,0),fe.emplace(ve++,Ze,Xe,nt,rt,1),fe.emplace(ve++,Ze,Xe,nt,rt,2),fe.emplace(ve++,Ze,Xe,nt,rt,3)}(!ys||ys.length<2*q)&&(ys=function(we){const Le=2*we,Ge=new a.aS;Ge.resize(Le),Ge._trim();for(let Ze=0;Ze<Le;Ze++){const Xe=6*Ze;Ge.uint16[Xe+0]=4*Ze+0,Ge.uint16[Xe+1]=4*Ze+1,Ge.uint16[Xe+2]=4*Ze+2,Ge.uint16[Xe+3]=4*Ze+2,Ge.uint16[Xe+4]=4*Ze+3,Ge.uint16[Xe+5]=4*Ze+0}return Ge}(q));const se=M.createIndexBuffer(ys,!0),Ee=M.createVertexBuffer(fe,a.aR.members,!0);for(const we of $){const Le={u_matrix:we.transform,u_inv_matrix:we.invTransform,u_camera_to_center_distance:($e=y.transform).cameraToCenterDistance,u_viewport_size:[$e.width,$e.height]};de.draw(M,A.TRIANGLES,xr.disabled,Hr.disabled,y.colorModeForRenderPass(),Ur.disabled,Le,y.style.map.terrain&&y.style.map.terrain.getTerrainData(we.coord),h.id,Ee,se,a.$.simpleSegment(0,2*we.circleOffset,we.circleArray.length,we.circleArray.length/2),null,y.transform.zoom,null,null,null)}var $e;Ee.destroy(),se.destroy()}Ur.disabled=new Ur(!1,1029,2305),Ur.backCCW=new Ur(!0,1029,2305);const Xc=a.an(new Float32Array(16));function Yh(y,o,h,p,m,v){const{horizontalAlign:E,verticalAlign:M}=a.at(y);return new a.P((-(E-.5)*o/m+p[0])*v,(-(M-.5)*h/m+p[1])*v)}function El(y,o,h,p,m,v,E,M,A,F,$){const q=y.text.placedSymbolArray,Y=y.text.dynamicLayoutVertexArray,de=y.icon.dynamicLayoutVertexArray,fe={};Y.clear();for(let ve=0;ve<q.length;ve++){const se=q.get(ve),Ee=se.hidden||!se.crossTileID||y.allowVerticalPlacement&&!se.placedOrientation?null:p[se.crossTileID];if(Ee){const $e=new a.P(se.anchorX,se.anchorY),we=cn($e,h?E:v,$),Le=ge(m.cameraToCenterDistance,we.signedDistanceFromCamera);let Ge=a.ai(y.textSizeData,A,se)*Le/a.ao;h&&(Ge*=y.tilePixelRatio/M);const{width:Ze,height:Xe,anchor:nt,textOffset:rt,textBoxScale:ft}=Ee,gt=Yh(nt,Ze,Xe,rt,ft,Ge),ar=h?cn($e.add(gt),v,$).point:we.point.add(o?gt.rotate(-m.angle):gt),yt=y.allowVerticalPlacement&&se.placedOrientation===a.ah.vertical?Math.PI/2:0;for(let Xt=0;Xt<se.numGlyphs;Xt++)a.aj(Y,ar,yt);F&&se.associatedIconIndex>=0&&(fe[se.associatedIconIndex]={shiftedAnchor:ar,angle:yt})}else qe(se.numGlyphs,Y)}if(F){de.clear();const ve=y.icon.placedSymbolArray;for(let se=0;se<ve.length;se++){const Ee=ve.get(se);if(Ee.hidden)qe(Ee.numGlyphs,de);else{const $e=fe[se];if($e)for(let we=0;we<Ee.numGlyphs;we++)a.aj(de,$e.shiftedAnchor,$e.angle);else qe(Ee.numGlyphs,de)}}y.icon.dynamicLayoutVertexBuffer.updateData(de)}y.text.dynamicLayoutVertexBuffer.updateData(Y)}function Cl(y,o,h){return h.iconsInText&&o?"symbolTextAndIcon":y?"symbolSDF":"symbolIcon"}function Ml(y,o,h,p,m,v,E,M,A,F,$,q){const Y=y.context,de=Y.gl,fe=y.transform,ve=M==="map",se=A==="map",Ee=M!=="viewport"&&h.layout.get("symbol-placement")!=="point",$e=ve&&!se&&!Ee,we=!h.layout.get("symbol-sort-key").isConstant();let Le=!1;const Ge=y.depthModeForSublayer(0,xr.ReadOnly),Ze=h._unevaluatedLayout.hasValue("text-variable-anchor")||h._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Xe=[];for(const nt of p){const rt=o.getTile(nt),ft=rt.getBucket(h);if(!ft)continue;const gt=m?ft.text:ft.icon;if(!gt||!gt.segments.get().length||!gt.hasVisibleVertices)continue;const ar=gt.programConfigurations.get(h.id),yt=m||ft.sdfIcons,Xt=m?ft.textSizeData:ft.iconSizeData,lr=se||fe.pitch!==0,Sr=y.useProgram(Cl(yt,m,ft),ar),er=a.ag(Xt,fe.zoom),hr=y.style.map.terrain&&y.style.map.terrain.getTerrainData(nt);let pr,dn,Rr,Oi,On=[0,0],sn=null;if(m)dn=rt.glyphAtlasTexture,Rr=de.LINEAR,pr=rt.glyphAtlasTexture.size,ft.iconsInText&&(On=rt.imageAtlasTexture.size,sn=rt.imageAtlasTexture,Oi=lr||y.options.rotating||y.options.zooming||Xt.kind==="composite"||Xt.kind==="camera"?de.LINEAR:de.NEAREST);else{const zn=h.layout.get("icon-size").constantOr(0)!==1||ft.iconsNeedLinear;dn=rt.imageAtlasTexture,Rr=yt||y.options.rotating||y.options.zooming||zn||lr?de.LINEAR:de.NEAREST,pr=rt.imageAtlasTexture.size}const Nn=Ht(rt,1,y.transform.zoom),Ni=tr(nt.posMatrix,se,ve,y.transform,Nn),xo=io(nt.posMatrix,se,ve,y.transform,Nn),rs=Ze&&ft.hasTextData(),Za=h.layout.get("icon-text-fit")!=="none"&&rs&&ft.hasIconData();if(Ee){const zn=y.style.map.terrain?(Yi,Dn)=>y.style.map.terrain.getElevation(nt,Yi,Dn):null,ln=h.layout.get("text-rotation-alignment")==="map";X(ft,nt.posMatrix,y,m,Ni,xo,se,F,ln,zn)}const ns=y.translatePosMatrix(nt.posMatrix,rt,v,E),So=Ee||m&&Ze||Za?Xc:Ni,Pn=y.translatePosMatrix(xo,rt,v,E,!0),an=yt&&h.paint.get(m?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let en;en=yt?ft.iconsInText?za(Xt.kind,er,$e,se,y,ns,So,Pn,pr,On):Pa(Xt.kind,er,$e,se,y,ns,So,Pn,m,pr,!0):La(Xt.kind,er,$e,se,y,ns,So,Pn,m,pr);const Ji={program:Sr,buffers:gt,uniformValues:en,atlasTexture:dn,atlasTextureIcon:sn,atlasInterpolation:Rr,atlasInterpolationIcon:Oi,isSDF:yt,hasHalo:an};if(we&&ft.canOverlap){Le=!0;const zn=gt.segments.get();for(const ln of zn)Xe.push({segments:new a.$([ln]),sortKey:ln.sortKey,state:Ji,terrainData:hr})}else Xe.push({segments:gt.segments,sortKey:0,state:Ji,terrainData:hr})}Le&&Xe.sort((nt,rt)=>nt.sortKey-rt.sortKey);for(const nt of Xe){const rt=nt.state;if(Y.activeTexture.set(de.TEXTURE0),rt.atlasTexture.bind(rt.atlasInterpolation,de.CLAMP_TO_EDGE),rt.atlasTextureIcon&&(Y.activeTexture.set(de.TEXTURE1),rt.atlasTextureIcon&&rt.atlasTextureIcon.bind(rt.atlasInterpolationIcon,de.CLAMP_TO_EDGE)),rt.isSDF){const ft=rt.uniformValues;rt.hasHalo&&(ft.u_is_halo=1,Qh(rt.buffers,nt.segments,h,y,rt.program,Ge,$,q,ft,nt.terrainData)),ft.u_is_halo=0}Qh(rt.buffers,nt.segments,h,y,rt.program,Ge,$,q,rt.uniformValues,nt.terrainData)}}function Qh(y,o,h,p,m,v,E,M,A,F){const $=p.context;m.draw($,$.gl.TRIANGLES,v,E,M,Ur.disabled,A,F,h.id,y.layoutVertexBuffer,y.indexBuffer,o,h.paint,p.transform.zoom,y.programConfigurations.get(h.id),y.dynamicLayoutVertexBuffer,y.opacityVertexBuffer)}function Il(y,o,h,p,m){if(!h||!p||!p.imageAtlas)return;const v=p.imageAtlas.patternPositions;let E=v[h.to.toString()],M=v[h.from.toString()];if(!E&&M&&(E=M),!M&&E&&(M=E),!E||!M){const A=m.getPaintProperty(o);E=v[A],M=v[A]}E&&M&&y.setConstantPatternPositions(E,M)}function ef(y,o,h,p,m,v,E){const M=y.context.gl,A="fill-pattern",F=h.paint.get(A),$=F&&F.constantOr(1),q=h.getCrossfadeParameters();let Y,de,fe,ve,se;E?(de=$&&!h.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",Y=M.LINES):(de=$?"fillPattern":"fill",Y=M.TRIANGLES);const Ee=F.constantOr(null);for(const $e of p){const we=o.getTile($e);if($&&!we.patternsLoaded())continue;const Le=we.getBucket(h);if(!Le)continue;const Ge=Le.programConfigurations.get(h.id),Ze=y.useProgram(de,Ge),Xe=y.style.map.terrain&&y.style.map.terrain.getTerrainData($e);$&&(y.context.activeTexture.set(M.TEXTURE0),we.imageAtlasTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),Ge.updatePaintBuffers(q)),Il(Ge,A,Ee,we,h);const nt=Xe?$e:null,rt=y.translatePosMatrix(nt?nt.posMatrix:$e.posMatrix,we,h.paint.get("fill-translate"),h.paint.get("fill-translate-anchor"));if(E){ve=Le.indexBuffer2,se=Le.segments2;const ft=[M.drawingBufferWidth,M.drawingBufferHeight];fe=de==="fillOutlinePattern"&&$?Oh(rt,y,q,we,ft):Yd(rt,ft)}else ve=Le.indexBuffer,se=Le.segments,fe=$?dl(rt,y,q,we):Fh(rt);Ze.draw(y.context,Y,m,y.stencilModeForClipping($e),v,Ur.disabled,fe,Xe,h.id,Le.layoutVertexBuffer,ve,se,h.paint,y.transform.zoom,Ge)}}function Al(y,o,h,p,m,v,E){const M=y.context,A=M.gl,F="fill-extrusion-pattern",$=h.paint.get(F),q=$.constantOr(1),Y=h.getCrossfadeParameters(),de=h.paint.get("fill-extrusion-opacity"),fe=$.constantOr(null);for(const ve of p){const se=o.getTile(ve),Ee=se.getBucket(h);if(!Ee)continue;const $e=y.style.map.terrain&&y.style.map.terrain.getTerrainData(ve),we=Ee.programConfigurations.get(h.id),Le=y.useProgram(q?"fillExtrusionPattern":"fillExtrusion",we);q&&(y.context.activeTexture.set(A.TEXTURE0),se.imageAtlasTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),we.updatePaintBuffers(Y)),Il(we,F,fe,se,h);const Ge=y.translatePosMatrix(ve.posMatrix,se,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),Ze=h.paint.get("fill-extrusion-vertical-gradient"),Xe=q?Jd(Ge,y,Ze,de,ve,Y,se):Ma(Ge,y,Ze,de);Le.draw(M,M.gl.TRIANGLES,m,v,E,Ur.backCCW,Xe,$e,h.id,Ee.layoutVertexBuffer,Ee.indexBuffer,Ee.segments,h.paint,y.transform.zoom,we,y.style.map.terrain&&Ee.centroidVertexBuffer)}}function Ll(y,o,h,p,m,v,E){const M=y.context,A=M.gl,F=h.fbo;if(!F)return;const $=y.useProgram("hillshade"),q=y.style.map.terrain&&y.style.map.terrain.getTerrainData(o);M.activeTexture.set(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,F.colorAttachment.get()),$.draw(M,A.TRIANGLES,m,v,E,Ur.disabled,((Y,de,fe,ve)=>{const se=fe.paint.get("hillshade-shadow-color"),Ee=fe.paint.get("hillshade-highlight-color"),$e=fe.paint.get("hillshade-accent-color");let we=fe.paint.get("hillshade-illumination-direction")*(Math.PI/180);fe.paint.get("hillshade-illumination-anchor")==="viewport"&&(we-=Y.transform.angle);const Le=!Y.options.moving;return{u_matrix:ve?ve.posMatrix:Y.transform.calculatePosMatrix(de.tileID.toUnwrapped(),Le),u_image:0,u_latrange:Vh(0,de.tileID),u_light:[fe.paint.get("hillshade-exaggeration"),we],u_shadow:se,u_highlight:Ee,u_accent:$e}})(y,h,p,q?o:null),q,p.id,y.rasterBoundsBuffer,y.quadTriangleIndexBuffer,y.rasterBoundsSegments)}function Kc(y,o,h,p,m,v){const E=y.context,M=E.gl,A=o.dem;if(A&&A.data){const F=A.dim,$=A.stride,q=A.getPixels();if(E.activeTexture.set(M.TEXTURE1),E.pixelStoreUnpackPremultiplyAlpha.set(!1),o.demTexture=o.demTexture||y.getTileTexture($),o.demTexture){const de=o.demTexture;de.update(q,{premultiply:!1}),de.bind(M.NEAREST,M.CLAMP_TO_EDGE)}else o.demTexture=new ne(E,q,M.RGBA,{premultiply:!1}),o.demTexture.bind(M.NEAREST,M.CLAMP_TO_EDGE);E.activeTexture.set(M.TEXTURE0);let Y=o.fbo;if(!Y){const de=new ne(E,{width:F,height:F,data:null},M.RGBA);de.bind(M.LINEAR,M.CLAMP_TO_EDGE),Y=o.fbo=E.createFramebuffer(F,F,!0,!1),Y.colorAttachment.set(de.texture)}E.bindFramebuffer.set(Y.framebuffer),E.viewport.set([0,0,F,F]),y.useProgram("hillshadePrepare").draw(E,M.TRIANGLES,p,m,v,Ur.disabled,((de,fe)=>{const ve=fe.stride,se=a.F();return a.aN(se,0,a.W,-a.W,0,0,1),a.H(se,se,[0,-a.W,0]),{u_matrix:se,u_image:1,u_dimension:[ve,ve],u_zoom:de.overscaledZ,u_unpack:fe.getUnpackVector()}})(o.tileID,A),null,h.id,y.rasterBoundsBuffer,y.quadTriangleIndexBuffer,y.rasterBoundsSegments),o.needsHillshadePrepare=!1}}function tf(y,o,h,p,m,v){const E=p.paint.get("raster-fade-duration");if(!v&&E>0){const M=S.now(),A=(M-y.timeAdded)/E,F=o?(M-o.timeAdded)/E:-1,$=h.getSource(),q=m.coveringZoomLevel({tileSize:$.tileSize,roundZoom:$.roundZoom}),Y=!o||Math.abs(o.tileID.overscaledZ-q)>Math.abs(y.tileID.overscaledZ-q),de=Y&&y.refreshedUponExpiration?1:a.ac(Y?A:1-F,0,1);return y.refreshedUponExpiration&&A>=1&&(y.refreshedUponExpiration=!1),o?{opacity:1,mix:1-de}:{opacity:de,mix:0}}return{opacity:1,mix:0}}const rf=new a.aO(1,0,0,1),Pl=new a.aO(0,1,0,1),Jc=new a.aO(0,0,1,1),hp=new a.aO(1,0,1,1),nf=new a.aO(0,1,1,1);function hn(y,o,h,p){mi(y,0,o+h/2,y.transform.width,h,p)}function Yo(y,o,h,p){mi(y,o-h/2,0,h,y.transform.height,p)}function mi(y,o,h,p,m,v){const E=y.context,M=E.gl;M.enable(M.SCISSOR_TEST),M.scissor(o*y.pixelRatio,h*y.pixelRatio,p*y.pixelRatio,m*y.pixelRatio),E.clear({color:v}),M.disable(M.SCISSOR_TEST)}function Yc(y,o,h){const p=y.context,m=p.gl,v=h.posMatrix,E=y.useProgram("debug"),M=xr.disabled,A=Hr.disabled,F=y.colorModeForRenderPass(),$="$debug",q=y.style.map.terrain&&y.style.map.terrain.getTerrainData(h);p.activeTexture.set(m.TEXTURE0);const Y=o.getTileByID(h.key).latestRawTileData,de=Math.floor((Y&&Y.byteLength||0)/1024),fe=o.getTile(h).tileSize,ve=512/Math.min(fe,512)*(h.overscaledZ/y.transform.zoom)*.5;let se=h.canonical.toString();h.overscaledZ!==h.canonical.z&&(se+=` => ${h.overscaledZ}`),function(Ee,$e){Ee.initDebugOverlayCanvas();const we=Ee.debugOverlayCanvas,Le=Ee.context.gl,Ge=Ee.debugOverlayCanvas.getContext("2d");Ge.clearRect(0,0,we.width,we.height),Ge.shadowColor="white",Ge.shadowBlur=2,Ge.lineWidth=1.5,Ge.strokeStyle="white",Ge.textBaseline="top",Ge.font="bold 36px Open Sans, sans-serif",Ge.fillText($e,5,5),Ge.strokeText($e,5,5),Ee.debugOverlayTexture.update(we),Ee.debugOverlayTexture.bind(Le.LINEAR,Le.CLAMP_TO_EDGE)}(y,`${se} ${de}kB`),E.draw(p,m.TRIANGLES,M,A,Tn.alphaBlended,Ur.disabled,jh(v,a.aO.transparent,ve),null,$,y.debugBuffer,y.quadTriangleIndexBuffer,y.debugSegments),E.draw(p,m.LINE_STRIP,M,A,F,Ur.disabled,jh(v,a.aO.red),q,$,y.debugBuffer,y.tileBorderIndexBuffer,y.debugSegments)}function zl(y,o,h){const p=y.context,m=p.gl,v=y.colorModeForRenderPass(),E=new xr(m.LEQUAL,xr.ReadWrite,y.depthRangeFor3D),M=y.useProgram("terrain"),A=o.getTerrainMesh();p.bindFramebuffer.set(null),p.viewport.set([0,0,y.width,y.height]);for(const F of h){const $=y.renderToTexture.getTexture(F),q=o.getTerrainData(F.tileID);p.activeTexture.set(m.TEXTURE0),m.bindTexture(m.TEXTURE_2D,$.texture);const Y={u_matrix:y.transform.calculatePosMatrix(F.tileID.toUnwrapped()),u_texture:0,u_ele_delta:o.getMeshFrameDelta(y.transform.zoom)};M.draw(p,m.TRIANGLES,E,Hr.disabled,v,Ur.backCCW,Y,q,"terrain",A.vertexBuffer,A.indexBuffer,A.segments)}}class of{constructor(o,h){this.context=new up(o),this.transform=h,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:a.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Nr.maxUnderzooming+Nr.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Ko}resize(o,h,p){if(this.width=Math.floor(o*p),this.height=Math.floor(h*p),this.pixelRatio=p,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const m of this.style._order)this.style._layers[m].resize()}setup(){const o=this.context,h=new a.aV;h.emplaceBack(0,0),h.emplaceBack(a.W,0),h.emplaceBack(0,a.W),h.emplaceBack(a.W,a.W),this.tileExtentBuffer=o.createVertexBuffer(h,ul.members),this.tileExtentSegments=a.$.simpleSegment(0,0,4,2);const p=new a.aV;p.emplaceBack(0,0),p.emplaceBack(a.W,0),p.emplaceBack(0,a.W),p.emplaceBack(a.W,a.W),this.debugBuffer=o.createVertexBuffer(p,ul.members),this.debugSegments=a.$.simpleSegment(0,0,4,5);const m=new a.Z;m.emplaceBack(0,0,0,0),m.emplaceBack(a.W,0,a.W,0),m.emplaceBack(0,a.W,0,a.W),m.emplaceBack(a.W,a.W,a.W,a.W),this.rasterBoundsBuffer=o.createVertexBuffer(m,We.members),this.rasterBoundsSegments=a.$.simpleSegment(0,0,4,2);const v=new a.aV;v.emplaceBack(0,0),v.emplaceBack(1,0),v.emplaceBack(0,1),v.emplaceBack(1,1),this.viewportBuffer=o.createVertexBuffer(v,ul.members),this.viewportSegments=a.$.simpleSegment(0,0,4,2);const E=new a.aW;E.emplaceBack(0),E.emplaceBack(1),E.emplaceBack(3),E.emplaceBack(2),E.emplaceBack(0),this.tileBorderIndexBuffer=o.createIndexBuffer(E);const M=new a.aX;M.emplaceBack(0,1,2),M.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=o.createIndexBuffer(M);const A=this.context.gl;this.stencilClearMode=new Hr({func:A.ALWAYS,mask:0},0,255,A.ZERO,A.ZERO,A.ZERO)}clearStencil(){const o=this.context,h=o.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const p=a.F();a.aN(p,0,this.width,this.height,0,0,1),a.J(p,p,[h.drawingBufferWidth,h.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(o,h.TRIANGLES,xr.disabled,this.stencilClearMode,Tn.disabled,Ur.disabled,pl(p),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(o,h){if(this.currentStencilSource===o.source||!o.isTileClipped()||!h||!h.length)return;this.currentStencilSource=o.source;const p=this.context,m=p.gl;this.nextStencilID+h.length>256&&this.clearStencil(),p.setColorMode(Tn.disabled),p.setDepthMode(xr.disabled);const v=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const E of h){const M=this._tileClippingMaskIDs[E.key]=this.nextStencilID++,A=this.style.map.terrain&&this.style.map.terrain.getTerrainData(E);v.draw(p,m.TRIANGLES,xr.disabled,new Hr({func:m.ALWAYS,mask:0},M,255,m.KEEP,m.KEEP,m.REPLACE),Tn.disabled,Ur.disabled,pl(E.posMatrix),A,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const o=this.nextStencilID++,h=this.context.gl;return new Hr({func:h.NOTEQUAL,mask:255},o,255,h.KEEP,h.KEEP,h.REPLACE)}stencilModeForClipping(o){const h=this.context.gl;return new Hr({func:h.EQUAL,mask:255},this._tileClippingMaskIDs[o.key],0,h.KEEP,h.KEEP,h.REPLACE)}stencilConfigForOverlap(o){const h=this.context.gl,p=o.sort((E,M)=>M.overscaledZ-E.overscaledZ),m=p[p.length-1].overscaledZ,v=p[0].overscaledZ-m+1;if(v>1){this.currentStencilSource=void 0,this.nextStencilID+v>256&&this.clearStencil();const E={};for(let M=0;M<v;M++)E[M+m]=new Hr({func:h.GEQUAL,mask:255},M+this.nextStencilID,255,h.KEEP,h.KEEP,h.REPLACE);return this.nextStencilID+=v,[E,p]}return[{[m]:Hr.disabled},p]}colorModeForRenderPass(){const o=this.context.gl;return this._showOverdrawInspector?new Tn([o.CONSTANT_COLOR,o.ONE],new a.aO(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Tn.unblended:Tn.alphaBlended}depthModeForSublayer(o,h,p){if(!this.opaquePassEnabledForLayer())return xr.disabled;const m=1-((1+this.currentLayer)*this.numSublayers+o)*this.depthEpsilon;return new xr(p||this.context.gl.LEQUAL,h,[m,m])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(o,h){this.style=o,this.options=h,this.lineAtlas=o.lineAtlas,this.imageManager=o.imageManager,this.glyphManager=o.glyphManager,this.symbolFadeChange=o.placement.symbolFadeChange(S.now()),this.imageManager.beginFrame();const p=this.style._order,m=this.style.sourceCaches,v={},E={},M={};for(const A in m){const F=m[A];F.used&&F.prepare(this.context),v[A]=F.getVisibleCoordinates(),E[A]=v[A].slice().reverse(),M[A]=F.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let A=0;A<p.length;A++)if(this.style._layers[p[A]].is3D()){this.opaquePassCutoff=A;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const A of p){const F=this.style._layers[A];if(!F.hasOffscreenPass()||F.isHidden(this.transform.zoom))continue;const $=E[F.source];(F.type==="custom"||$.length)&&this.renderLayer(this,m[F.source],F,$)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:h.showOverdrawInspector?a.aO.black:a.aO.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=h.showOverdrawInspector,this.depthRangeFor3D=[0,1-(o._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=p.length-1;this.currentLayer>=0;this.currentLayer--){const A=this.style._layers[p[this.currentLayer]],F=m[A.source],$=v[A.source];this._renderTileClippingMasks(A,$),this.renderLayer(this,F,A,$)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<p.length;this.currentLayer++){const A=this.style._layers[p[this.currentLayer]],F=m[A.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(A))continue;const $=(A.type==="symbol"?M:E)[A.source];this._renderTileClippingMasks(A,v[A.source]),this.renderLayer(this,F,A,$)}if(this.options.showTileBoundaries){const A=function(F,$){let q=null;const Y=Object.values(F._layers).flatMap(se=>se.source&&!se.isHidden($)?[F.sourceCaches[se.source]]:[]),de=Y.filter(se=>se.getSource().type==="vector"),fe=Y.filter(se=>se.getSource().type!=="vector"),ve=se=>{(!q||q.getSource().maxzoom<se.getSource().maxzoom)&&(q=se)};return de.forEach(se=>ve(se)),q||fe.forEach(se=>ve(se)),q}(this.style,this.transform.zoom);A&&function(F,$,q){for(let Y=0;Y<q.length;Y++)Yc(F,$,q[Y])}(this,A,A.getVisibleCoordinates())}this.options.showPadding&&function(A){const F=A.transform.padding;hn(A,A.transform.height-(F.top||0),3,rf),hn(A,F.bottom||0,3,Pl),Yo(A,F.left||0,3,Jc),Yo(A,A.transform.width-(F.right||0),3,hp);const $=A.transform.centerPoint;(function(q,Y,de,fe){mi(q,Y-1,de-10,2,20,fe),mi(q,Y-10,de-1,20,2,fe)})(A,$.x,A.transform.height-$.y,nf)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(o){if(!this.style||!this.style.map||!this.style.map.terrain)return;const h=this.terrainFacilitator.matrix,p=this.transform.projMatrix;let m=this.terrainFacilitator.dirty;m||(m=o?!a.aY(h,p):!a.aZ(h,p)),m||(m=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),m&&(a.a_(h,p),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(v,E){const M=v.context,A=M.gl,F=Tn.unblended,$=new xr(A.LEQUAL,xr.ReadWrite,[0,1]),q=E.getTerrainMesh(),Y=E.sourceCache.getRenderableTiles(),de=v.useProgram("terrainDepth");M.bindFramebuffer.set(E.getFramebuffer("depth").framebuffer),M.viewport.set([0,0,v.width/devicePixelRatio,v.height/devicePixelRatio]),M.clear({color:a.aO.transparent,depth:1});for(const fe of Y){const ve=E.getTerrainData(fe.tileID),se={u_matrix:v.transform.calculatePosMatrix(fe.tileID.toUnwrapped()),u_ele_delta:E.getMeshFrameDelta(v.transform.zoom)};de.draw(M,A.TRIANGLES,$,Hr.disabled,F,Ur.backCCW,se,ve,"terrain",q.vertexBuffer,q.indexBuffer,q.segments)}M.bindFramebuffer.set(null),M.viewport.set([0,0,v.width,v.height])}(this,this.style.map.terrain),function(v,E){const M=v.context,A=M.gl,F=Tn.unblended,$=new xr(A.LEQUAL,xr.ReadWrite,[0,1]),q=E.getTerrainMesh(),Y=E.getCoordsTexture(),de=E.sourceCache.getRenderableTiles(),fe=v.useProgram("terrainCoords");M.bindFramebuffer.set(E.getFramebuffer("coords").framebuffer),M.viewport.set([0,0,v.width/devicePixelRatio,v.height/devicePixelRatio]),M.clear({color:a.aO.transparent,depth:1}),E.coordsIndex=[];for(const ve of de){const se=E.getTerrainData(ve.tileID);M.activeTexture.set(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,Y.texture);const Ee={u_matrix:v.transform.calculatePosMatrix(ve.tileID.toUnwrapped()),u_terrain_coords_id:(255-E.coordsIndex.length)/255,u_texture:0,u_ele_delta:E.getMeshFrameDelta(v.transform.zoom)};fe.draw(M,A.TRIANGLES,$,Hr.disabled,F,Ur.backCCW,Ee,se,"terrain",q.vertexBuffer,q.indexBuffer,q.segments),E.coordsIndex.push(ve.tileID.key)}M.bindFramebuffer.set(null),M.viewport.set([0,0,v.width,v.height])}(this,this.style.map.terrain))}renderLayer(o,h,p,m){if(!p.isHidden(this.transform.zoom)&&(p.type==="background"||p.type==="custom"||(m||[]).length))switch(this.id=p.id,p.type){case"symbol":(function(v,E,M,A,F){if(v.renderPass!=="translucent")return;const $=Hr.disabled,q=v.colorModeForRenderPass();(M._unevaluatedLayout.hasValue("text-variable-anchor")||M._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(Y,de,fe,ve,se,Ee,$e){const we=de.transform,Le=se==="map",Ge=Ee==="map";for(const Ze of Y){const Xe=ve.getTile(Ze),nt=Xe.getBucket(fe);if(!nt||!nt.text||!nt.text.segments.get().length)continue;const rt=a.ag(nt.textSizeData,we.zoom),ft=Ht(Xe,1,de.transform.zoom),gt=tr(Ze.posMatrix,Ge,Le,de.transform,ft),ar=fe.layout.get("icon-text-fit")!=="none"&&nt.hasIconData();if(rt){const yt=Math.pow(2,we.zoom-Xe.tileID.overscaledZ);El(nt,Le,Ge,$e,we,gt,Ze.posMatrix,yt,rt,ar,de.style.map.terrain?(Xt,lr)=>de.style.map.terrain.getElevation(Ze,Xt,lr):null)}}}(A,v,M,E,M.layout.get("text-rotation-alignment"),M.layout.get("text-pitch-alignment"),F),M.paint.get("icon-opacity").constantOr(1)!==0&&Ml(v,E,M,A,!1,M.paint.get("icon-translate"),M.paint.get("icon-translate-anchor"),M.layout.get("icon-rotation-alignment"),M.layout.get("icon-pitch-alignment"),M.layout.get("icon-keep-upright"),$,q),M.paint.get("text-opacity").constantOr(1)!==0&&Ml(v,E,M,A,!0,M.paint.get("text-translate"),M.paint.get("text-translate-anchor"),M.layout.get("text-rotation-alignment"),M.layout.get("text-pitch-alignment"),M.layout.get("text-keep-upright"),$,q),E.map.showCollisionBoxes&&(Tl(v,E,M,A,M.paint.get("text-translate"),M.paint.get("text-translate-anchor"),!0),Tl(v,E,M,A,M.paint.get("icon-translate"),M.paint.get("icon-translate-anchor"),!1))})(o,h,p,m,this.style.placement.variableOffsets);break;case"circle":(function(v,E,M,A){if(v.renderPass!=="translucent")return;const F=M.paint.get("circle-opacity"),$=M.paint.get("circle-stroke-width"),q=M.paint.get("circle-stroke-opacity"),Y=!M.layout.get("circle-sort-key").isConstant();if(F.constantOr(1)===0&&($.constantOr(1)===0||q.constantOr(1)===0))return;const de=v.context,fe=de.gl,ve=v.depthModeForSublayer(0,xr.ReadOnly),se=Hr.disabled,Ee=v.colorModeForRenderPass(),$e=[];for(let we=0;we<A.length;we++){const Le=A[we],Ge=E.getTile(Le),Ze=Ge.getBucket(M);if(!Ze)continue;const Xe=Ze.programConfigurations.get(M.id),nt=v.useProgram("circle",Xe),rt=Ze.layoutVertexBuffer,ft=Ze.indexBuffer,gt=v.style.map.terrain&&v.style.map.terrain.getTerrainData(Le),ar={programConfiguration:Xe,program:nt,layoutVertexBuffer:rt,indexBuffer:ft,uniformValues:Qd(v,Le,Ge,M),terrainData:gt};if(Y){const yt=Ze.segments.get();for(const Xt of yt)$e.push({segments:new a.$([Xt]),sortKey:Xt.sortKey,state:ar})}else $e.push({segments:Ze.segments,sortKey:0,state:ar})}Y&&$e.sort((we,Le)=>we.sortKey-Le.sortKey);for(const we of $e){const{programConfiguration:Le,program:Ge,layoutVertexBuffer:Ze,indexBuffer:Xe,uniformValues:nt,terrainData:rt}=we.state;Ge.draw(de,fe.TRIANGLES,ve,se,Ee,Ur.disabled,nt,rt,M.id,Ze,Xe,we.segments,M.paint,v.transform.zoom,Le)}})(o,h,p,m);break;case"heatmap":(function(v,E,M,A){if(M.paint.get("heatmap-opacity")!==0)if(v.renderPass==="offscreen"){const F=v.context,$=F.gl,q=Hr.disabled,Y=new Tn([$.ONE,$.ONE],a.aO.transparent,[!0,!0,!0,!0]);(function(de,fe,ve){const se=de.gl;de.activeTexture.set(se.TEXTURE1),de.viewport.set([0,0,fe.width/4,fe.height/4]);let Ee=ve.heatmapFbo;if(Ee)se.bindTexture(se.TEXTURE_2D,Ee.colorAttachment.get()),de.bindFramebuffer.set(Ee.framebuffer);else{const $e=se.createTexture();se.bindTexture(se.TEXTURE_2D,$e),se.texParameteri(se.TEXTURE_2D,se.TEXTURE_WRAP_S,se.CLAMP_TO_EDGE),se.texParameteri(se.TEXTURE_2D,se.TEXTURE_WRAP_T,se.CLAMP_TO_EDGE),se.texParameteri(se.TEXTURE_2D,se.TEXTURE_MIN_FILTER,se.LINEAR),se.texParameteri(se.TEXTURE_2D,se.TEXTURE_MAG_FILTER,se.LINEAR),Ee=ve.heatmapFbo=de.createFramebuffer(fe.width/4,fe.height/4,!1,!1),function(we,Le,Ge,Ze){var Xe,nt;const rt=we.gl,ft=(Xe=we.HALF_FLOAT)!==null&&Xe!==void 0?Xe:rt.UNSIGNED_BYTE,gt=(nt=we.RGBA16F)!==null&&nt!==void 0?nt:rt.RGBA;rt.texImage2D(rt.TEXTURE_2D,0,gt,Le.width/4,Le.height/4,0,rt.RGBA,ft,null),Ze.colorAttachment.set(Ge)}(de,fe,$e,Ee)}})(F,v,M),F.clear({color:a.aO.transparent});for(let de=0;de<A.length;de++){const fe=A[de];if(E.hasRenderableParent(fe))continue;const ve=E.getTile(fe),se=ve.getBucket(M);if(!se)continue;const Ee=se.programConfigurations.get(M.id),$e=v.useProgram("heatmap",Ee),{zoom:we}=v.transform;$e.draw(F,$.TRIANGLES,xr.disabled,q,Y,Ur.disabled,Uh(fe.posMatrix,ve,we,M.paint.get("heatmap-intensity")),null,M.id,se.layoutVertexBuffer,se.indexBuffer,se.segments,M.paint,v.transform.zoom,Ee)}F.viewport.set([0,0,v.width,v.height])}else v.renderPass==="translucent"&&(v.context.setColorMode(v.colorModeForRenderPass()),function(F,$){const q=F.context,Y=q.gl,de=$.heatmapFbo;if(!de)return;q.activeTexture.set(Y.TEXTURE0),Y.bindTexture(Y.TEXTURE_2D,de.colorAttachment.get()),q.activeTexture.set(Y.TEXTURE1);let fe=$.colorRampTexture;fe||(fe=$.colorRampTexture=new ne(q,$.colorRamp,Y.RGBA)),fe.bind(Y.LINEAR,Y.CLAMP_TO_EDGE),F.useProgram("heatmapTexture").draw(q,Y.TRIANGLES,xr.disabled,Hr.disabled,F.colorModeForRenderPass(),Ur.disabled,((ve,se,Ee,$e)=>{const we=a.F();a.aN(we,0,ve.width,ve.height,0,0,1);const Le=ve.context.gl;return{u_matrix:we,u_world:[Le.drawingBufferWidth,Le.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:se.paint.get("heatmap-opacity")}})(F,$),null,$.id,F.viewportBuffer,F.quadTriangleIndexBuffer,F.viewportSegments,$.paint,F.transform.zoom)}(v,M))})(o,h,p,m);break;case"line":(function(v,E,M,A){if(v.renderPass!=="translucent")return;const F=M.paint.get("line-opacity"),$=M.paint.get("line-width");if(F.constantOr(1)===0||$.constantOr(1)===0)return;const q=v.depthModeForSublayer(0,xr.ReadOnly),Y=v.colorModeForRenderPass(),de=M.paint.get("line-dasharray"),fe=M.paint.get("line-pattern"),ve=fe.constantOr(1),se=M.paint.get("line-gradient"),Ee=M.getCrossfadeParameters(),$e=ve?"linePattern":de?"lineSDF":se?"lineGradient":"line",we=v.context,Le=we.gl;let Ge=!0;for(const Ze of A){const Xe=E.getTile(Ze);if(ve&&!Xe.patternsLoaded())continue;const nt=Xe.getBucket(M);if(!nt)continue;const rt=nt.programConfigurations.get(M.id),ft=v.context.program.get(),gt=v.useProgram($e,rt),ar=Ge||gt.program!==ft,yt=v.style.map.terrain&&v.style.map.terrain.getTerrainData(Ze),Xt=fe.constantOr(null);if(Xt&&Xe.imageAtlas){const er=Xe.imageAtlas,hr=er.patternPositions[Xt.to.toString()],pr=er.patternPositions[Xt.from.toString()];hr&&pr&&rt.setConstantPatternPositions(hr,pr)}const lr=yt?Ze:null,Sr=ve?ms(v,Xe,M,Ee,lr):de?gl(v,Xe,M,de,Ee,lr):se?$h(v,Xe,M,nt.lineClipsArray.length,lr):ml(v,Xe,M,lr);if(ve)we.activeTexture.set(Le.TEXTURE0),Xe.imageAtlasTexture.bind(Le.LINEAR,Le.CLAMP_TO_EDGE),rt.updatePaintBuffers(Ee);else if(de&&(ar||v.lineAtlas.dirty))we.activeTexture.set(Le.TEXTURE0),v.lineAtlas.bind(we);else if(se){const er=nt.gradients[M.id];let hr=er.texture;if(M.gradientVersion!==er.version){let pr=256;if(M.stepInterpolant){const dn=E.getSource().maxzoom,Rr=Ze.canonical.z===dn?Math.ceil(1<<v.transform.maxZoom-Ze.canonical.z):1;pr=a.ac(a.aT(nt.maxLineLength/a.W*1024*Rr),256,we.maxTextureSize)}er.gradient=a.aU({expression:M.gradientExpression(),evaluationKey:"lineProgress",resolution:pr,image:er.gradient||void 0,clips:nt.lineClipsArray}),er.texture?er.texture.update(er.gradient):er.texture=new ne(we,er.gradient,Le.RGBA),er.version=M.gradientVersion,hr=er.texture}we.activeTexture.set(Le.TEXTURE0),hr.bind(M.stepInterpolant?Le.NEAREST:Le.LINEAR,Le.CLAMP_TO_EDGE)}gt.draw(we,Le.TRIANGLES,q,v.stencilModeForClipping(Ze),Y,Ur.disabled,Sr,yt,M.id,nt.layoutVertexBuffer,nt.indexBuffer,nt.segments,M.paint,v.transform.zoom,rt,nt.layoutVertexBuffer2),Ge=!1}})(o,h,p,m);break;case"fill":(function(v,E,M,A){const F=M.paint.get("fill-color"),$=M.paint.get("fill-opacity");if($.constantOr(1)===0)return;const q=v.colorModeForRenderPass(),Y=M.paint.get("fill-pattern"),de=v.opaquePassEnabledForLayer()&&!Y.constantOr(1)&&F.constantOr(a.aO.transparent).a===1&&$.constantOr(0)===1?"opaque":"translucent";if(v.renderPass===de){const fe=v.depthModeForSublayer(1,v.renderPass==="opaque"?xr.ReadWrite:xr.ReadOnly);ef(v,E,M,A,fe,q,!1)}if(v.renderPass==="translucent"&&M.paint.get("fill-antialias")){const fe=v.depthModeForSublayer(M.getPaintProperty("fill-outline-color")?2:0,xr.ReadOnly);ef(v,E,M,A,fe,q,!0)}})(o,h,p,m);break;case"fill-extrusion":(function(v,E,M,A){const F=M.paint.get("fill-extrusion-opacity");if(F!==0&&v.renderPass==="translucent"){const $=new xr(v.context.gl.LEQUAL,xr.ReadWrite,v.depthRangeFor3D);if(F!==1||M.paint.get("fill-extrusion-pattern").constantOr(1))Al(v,E,M,A,$,Hr.disabled,Tn.disabled),Al(v,E,M,A,$,v.stencilModeFor3D(),v.colorModeForRenderPass());else{const q=v.colorModeForRenderPass();Al(v,E,M,A,$,Hr.disabled,q)}}})(o,h,p,m);break;case"hillshade":(function(v,E,M,A){if(v.renderPass!=="offscreen"&&v.renderPass!=="translucent")return;const F=v.context,$=v.depthModeForSublayer(0,xr.ReadOnly),q=v.colorModeForRenderPass(),[Y,de]=v.renderPass==="translucent"?v.stencilConfigForOverlap(A):[{},A];for(const fe of de){const ve=E.getTile(fe);ve.needsHillshadePrepare!==void 0&&ve.needsHillshadePrepare&&v.renderPass==="offscreen"?Kc(v,ve,M,$,Hr.disabled,q):v.renderPass==="translucent"&&Ll(v,fe,ve,M,$,Y[fe.overscaledZ],q)}F.viewport.set([0,0,v.width,v.height])})(o,h,p,m);break;case"raster":(function(v,E,M,A){if(v.renderPass!=="translucent"||M.paint.get("raster-opacity")===0||!A.length)return;const F=v.context,$=F.gl,q=E.getSource(),Y=v.useProgram("raster"),de=v.colorModeForRenderPass(),[fe,ve]=q instanceof wt?[{},A]:v.stencilConfigForOverlap(A),se=ve[ve.length-1].overscaledZ,Ee=!v.options.moving;for(const $e of ve){const we=v.depthModeForSublayer($e.overscaledZ-se,M.paint.get("raster-opacity")===1?xr.ReadWrite:xr.ReadOnly,$.LESS),Le=E.getTile($e);Le.registerFadeDuration(M.paint.get("raster-fade-duration"));const Ge=E.findLoadedParent($e,0),Ze=tf(Le,Ge,E,M,v.transform,v.style.map.terrain);let Xe,nt;const rt=M.paint.get("raster-resampling")==="nearest"?$.NEAREST:$.LINEAR;F.activeTexture.set($.TEXTURE0),Le.texture.bind(rt,$.CLAMP_TO_EDGE,$.LINEAR_MIPMAP_NEAREST),F.activeTexture.set($.TEXTURE1),Ge?(Ge.texture.bind(rt,$.CLAMP_TO_EDGE,$.LINEAR_MIPMAP_NEAREST),Xe=Math.pow(2,Ge.tileID.overscaledZ-Le.tileID.overscaledZ),nt=[Le.tileID.canonical.x*Xe%1,Le.tileID.canonical.y*Xe%1]):Le.texture.bind(rt,$.CLAMP_TO_EDGE,$.LINEAR_MIPMAP_NEAREST);const ft=v.style.map.terrain&&v.style.map.terrain.getTerrainData($e),gt=ft?$e:null,ar=gt?gt.posMatrix:v.transform.calculatePosMatrix($e.toUnwrapped(),Ee),yt=_l(ar,nt||[0,0],Xe||1,Ze,M);q instanceof wt?Y.draw(F,$.TRIANGLES,we,Hr.disabled,de,Ur.disabled,yt,ft,M.id,q.boundsBuffer,v.quadTriangleIndexBuffer,q.boundsSegments):Y.draw(F,$.TRIANGLES,we,fe[$e.overscaledZ],de,Ur.disabled,yt,ft,M.id,v.rasterBoundsBuffer,v.quadTriangleIndexBuffer,v.rasterBoundsSegments)}})(o,h,p,m);break;case"background":(function(v,E,M,A){const F=M.paint.get("background-color"),$=M.paint.get("background-opacity");if($===0)return;const q=v.context,Y=q.gl,de=v.transform,fe=de.tileSize,ve=M.paint.get("background-pattern");if(v.isPatternMissing(ve))return;const se=!ve&&F.a===1&&$===1&&v.opaquePassEnabledForLayer()?"opaque":"translucent";if(v.renderPass!==se)return;const Ee=Hr.disabled,$e=v.depthModeForSublayer(0,se==="opaque"?xr.ReadWrite:xr.ReadOnly),we=v.colorModeForRenderPass(),Le=v.useProgram(ve?"backgroundPattern":"background"),Ge=A||de.coveringTiles({tileSize:fe,terrain:v.style.map.terrain});ve&&(q.activeTexture.set(Y.TEXTURE0),v.imageManager.bind(v.context));const Ze=M.getCrossfadeParameters();for(const Xe of Ge){const nt=A?Xe.posMatrix:v.transform.calculatePosMatrix(Xe.toUnwrapped()),rt=ve?tp(nt,$,v,ve,{tileID:Xe,tileSize:fe},Ze):ep(nt,$,F),ft=v.style.map.terrain&&v.style.map.terrain.getTerrainData(Xe);Le.draw(q,Y.TRIANGLES,$e,Ee,we,Ur.disabled,rt,ft,M.id,v.tileExtentBuffer,v.quadTriangleIndexBuffer,v.tileExtentSegments)}})(o,0,p,m);break;case"custom":(function(v,E,M){const A=v.context,F=M.implementation;if(v.renderPass==="offscreen"){const $=F.prerender;$&&(v.setCustomLayerDefaults(),A.setColorMode(v.colorModeForRenderPass()),$.call(F,A.gl,v.transform.customLayerMatrix()),A.setDirty(),v.setBaseState())}else if(v.renderPass==="translucent"){v.setCustomLayerDefaults(),A.setColorMode(v.colorModeForRenderPass()),A.setStencilMode(Hr.disabled);const $=F.renderingMode==="3d"?new xr(v.context.gl.LEQUAL,xr.ReadWrite,v.depthRangeFor3D):v.depthModeForSublayer(0,xr.ReadOnly);A.setDepthMode($),F.render(A.gl,v.transform.customLayerMatrix()),A.setDirty(),v.setBaseState(),A.bindFramebuffer.set(null)}})(o,0,p)}}translatePosMatrix(o,h,p,m,v){if(!p[0]&&!p[1])return o;const E=v?m==="map"?this.transform.angle:0:m==="viewport"?-this.transform.angle:0;if(E){const F=Math.sin(E),$=Math.cos(E);p=[p[0]*$-p[1]*F,p[0]*F+p[1]*$]}const M=[v?p[0]:Ht(h,p[0],this.transform.zoom),v?p[1]:Ht(h,p[1],this.transform.zoom),0],A=new Float32Array(16);return a.H(A,o,M),A}saveTileTexture(o){const h=this._tileTextures[o.size[0]];h?h.push(o):this._tileTextures[o.size[0]]=[o]}getTileTexture(o){const h=this._tileTextures[o];return h&&h.length>0?h.pop():null}isPatternMissing(o){if(!o)return!1;if(!o.from||!o.to)return!0;const h=this.imageManager.getPattern(o.from.toString()),p=this.imageManager.getPattern(o.to.toString());return!h||!p}useProgram(o,h){this.cache=this.cache||{};const p=o+(h?h.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[p]||(this.cache[p]=new Jo(this.context,Ca[o],h,qh[o],this._showOverdrawInspector,this.style.map.terrain)),this.cache[p]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const o=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(o.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new ne(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:o,drawingBufferHeight:h}=this.context.gl;return this.width!==o||this.height!==h}}class Qo{constructor(o,h){this.points=o,this.planes=h}static fromInvProjectionMatrix(o,h,p){const m=Math.pow(2,p),v=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(M=>{const A=1/(M=a.af([],M,o))[3]/h*m;return a.a$(M,M,[A,A,1/M[3],A])}),E=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(M=>{const A=function(Y,de){var fe=de[0],ve=de[1],se=de[2],Ee=fe*fe+ve*ve+se*se;return Ee>0&&(Ee=1/Math.sqrt(Ee)),Y[0]=de[0]*Ee,Y[1]=de[1]*Ee,Y[2]=de[2]*Ee,Y}([],function(Y,de,fe){var ve=de[0],se=de[1],Ee=de[2],$e=fe[0],we=fe[1],Le=fe[2];return Y[0]=se*Le-Ee*we,Y[1]=Ee*$e-ve*Le,Y[2]=ve*we-se*$e,Y}([],J([],v[M[0]],v[M[1]]),J([],v[M[2]],v[M[1]]))),F=-(($=A)[0]*(q=v[M[1]])[0]+$[1]*q[1]+$[2]*q[2]);var $,q;return A.concat(F)});return new Qo(v,E)}}class es{constructor(o,h){this.min=o,this.max=h,this.center=function(p,m,v){return p[0]=.5*m[0],p[1]=.5*m[1],p[2]=.5*m[2],p}([],function(p,m,v){return p[0]=m[0]+v[0],p[1]=m[1]+v[1],p[2]=m[2]+v[2],p}([],this.min,this.max))}quadrant(o){const h=[o%2==0,o<2],p=le(this.min),m=le(this.max);for(let v=0;v<h.length;v++)p[v]=h[v]?this.min[v]:this.center[v],m[v]=h[v]?this.center[v]:this.max[v];return m[2]=this.max[2],new es(p,m)}distanceX(o){return Math.max(Math.min(this.max[0],o[0]),this.min[0])-o[0]}distanceY(o){return Math.max(Math.min(this.max[1],o[1]),this.min[1])-o[1]}intersects(o){const h=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let p=!0;for(let m=0;m<o.planes.length;m++){const v=o.planes[m];let E=0;for(let M=0;M<h.length;M++)a.b0(v,h[M])>=0&&E++;if(E===0)return 0;E!==h.length&&(p=!1)}if(p)return 2;for(let m=0;m<3;m++){let v=Number.MAX_VALUE,E=-Number.MAX_VALUE;for(let M=0;M<o.points.length;M++){const A=o.points[M][m]-this.min[m];v=Math.min(v,A),E=Math.max(E,A)}if(E<0||v>this.max[m]-this.min[m])return 0}return 1}}class Zs{constructor(o=0,h=0,p=0,m=0){if(isNaN(o)||o<0||isNaN(h)||h<0||isNaN(p)||p<0||isNaN(m)||m<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=o,this.bottom=h,this.left=p,this.right=m}interpolate(o,h,p){return h.top!=null&&o.top!=null&&(this.top=a.z.number(o.top,h.top,p)),h.bottom!=null&&o.bottom!=null&&(this.bottom=a.z.number(o.bottom,h.bottom,p)),h.left!=null&&o.left!=null&&(this.left=a.z.number(o.left,h.left,p)),h.right!=null&&o.right!=null&&(this.right=a.z.number(o.right,h.right,p)),this}getCenter(o,h){const p=a.ac((this.left+o-this.right)/2,0,o),m=a.ac((this.top+h-this.bottom)/2,0,h);return new a.P(p,m)}equals(o){return this.top===o.top&&this.bottom===o.bottom&&this.left===o.left&&this.right===o.right}clone(){return new Zs(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const Qc=85.051129;class Dl{constructor(o,h,p,m,v){this.tileSize=512,this._renderWorldCopies=v===void 0||!!v,this._minZoom=o||0,this._maxZoom=h||22,this._minPitch=p??0,this._maxPitch=m??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new a.M(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Zs,this._posMatrixCache={},this._alignedPosMatrixCache={},this.minElevationForCurrentTile=0}clone(){const o=new Dl(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return o.apply(this),o}apply(o){this.tileSize=o.tileSize,this.latRange=o.latRange,this.width=o.width,this.height=o.height,this._center=o._center,this._elevation=o._elevation,this.minElevationForCurrentTile=o.minElevationForCurrentTile,this.zoom=o.zoom,this.angle=o.angle,this._fov=o._fov,this._pitch=o._pitch,this._unmodified=o._unmodified,this._edgeInsets=o._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(o){this._minZoom!==o&&(this._minZoom=o,this.zoom=Math.max(this.zoom,o))}get maxZoom(){return this._maxZoom}set maxZoom(o){this._maxZoom!==o&&(this._maxZoom=o,this.zoom=Math.min(this.zoom,o))}get minPitch(){return this._minPitch}set minPitch(o){this._minPitch!==o&&(this._minPitch=o,this.pitch=Math.max(this.pitch,o))}get maxPitch(){return this._maxPitch}set maxPitch(o){this._maxPitch!==o&&(this._maxPitch=o,this.pitch=Math.min(this.pitch,o))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(o){o===void 0?o=!0:o===null&&(o=!1),this._renderWorldCopies=o}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new a.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(o){const h=-a.b1(o,-180,180)*Math.PI/180;this.angle!==h&&(this._unmodified=!1,this.angle=h,this._calcMatrices(),this.rotationMatrix=function(){var p=new a.A(4);return a.A!=Float32Array&&(p[1]=0,p[2]=0),p[0]=1,p[3]=1,p}(),function(p,m,v){var E=m[0],M=m[1],A=m[2],F=m[3],$=Math.sin(v),q=Math.cos(v);p[0]=E*q+A*$,p[1]=M*q+F*$,p[2]=E*-$+A*q,p[3]=M*-$+F*q}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(o){const h=a.ac(o,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==h&&(this._unmodified=!1,this._pitch=h,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(o){o=Math.max(.01,Math.min(60,o)),this._fov!==o&&(this._unmodified=!1,this._fov=o/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(o){const h=Math.min(Math.max(o,this.minZoom),this.maxZoom);this._zoom!==h&&(this._unmodified=!1,this._zoom=h,this.tileZoom=Math.max(0,Math.floor(h)),this.scale=this.zoomScale(h),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(o){o.lat===this._center.lat&&o.lng===this._center.lng||(this._unmodified=!1,this._center=o,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(o){o!==this._elevation&&(this._elevation=o,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(o){this._edgeInsets.equals(o)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,o,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(o){return this._edgeInsets.equals(o)}interpolatePadding(o,h,p){this._unmodified=!1,this._edgeInsets.interpolate(o,h,p),this._constrain(),this._calcMatrices()}coveringZoomLevel(o){const h=(o.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/o.tileSize));return Math.max(0,h)}getVisibleUnwrappedCoordinates(o){const h=[new a.b2(0,o)];if(this._renderWorldCopies){const p=this.pointCoordinate(new a.P(0,0)),m=this.pointCoordinate(new a.P(this.width,0)),v=this.pointCoordinate(new a.P(this.width,this.height)),E=this.pointCoordinate(new a.P(0,this.height)),M=Math.floor(Math.min(p.x,m.x,v.x,E.x)),A=Math.floor(Math.max(p.x,m.x,v.x,E.x)),F=1;for(let $=M-F;$<=A+F;$++)$!==0&&h.push(new a.b2($,o))}return h}coveringTiles(o){var h,p;let m=this.coveringZoomLevel(o);const v=m;if(o.minzoom!==void 0&&m<o.minzoom)return[];o.maxzoom!==void 0&&m>o.maxzoom&&(m=o.maxzoom);const E=this.pointCoordinate(this.getCameraPoint()),M=a.Y.fromLngLat(this.center),A=Math.pow(2,m),F=[A*E.x,A*E.y,0],$=[A*M.x,A*M.y,0],q=Qo.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,m);let Y=o.minzoom||0;!o.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(Y=m);const de=o.terrain?2/Math.min(this.tileSize,o.tileSize)*this.tileSize:3,fe=we=>({aabb:new es([we*A,0,0],[(we+1)*A,A,0]),zoom:0,x:0,y:0,wrap:we,fullyVisible:!1}),ve=[],se=[],Ee=m,$e=o.reparseOverscaled?v:m;if(this._renderWorldCopies)for(let we=1;we<=3;we++)ve.push(fe(-we)),ve.push(fe(we));for(ve.push(fe(0));ve.length>0;){const we=ve.pop(),Le=we.x,Ge=we.y;let Ze=we.fullyVisible;if(!Ze){const gt=we.aabb.intersects(q);if(gt===0)continue;Ze=gt===2}const Xe=o.terrain?F:$,nt=we.aabb.distanceX(Xe),rt=we.aabb.distanceY(Xe),ft=Math.max(Math.abs(nt),Math.abs(rt));if(we.zoom===Ee||ft>de+(1<<Ee-we.zoom)-2&&we.zoom>=Y){const gt=Ee-we.zoom,ar=F[0]-.5-(Le<<gt),yt=F[1]-.5-(Ge<<gt);se.push({tileID:new a.Q(we.zoom===Ee?$e:we.zoom,we.wrap,we.zoom,Le,Ge),distanceSq:ye([$[0]-.5-Le,$[1]-.5-Ge]),tileDistanceToCamera:Math.sqrt(ar*ar+yt*yt)})}else for(let gt=0;gt<4;gt++){const ar=(Le<<1)+gt%2,yt=(Ge<<1)+(gt>>1),Xt=we.zoom+1;let lr=we.aabb.quadrant(gt);if(o.terrain){const Sr=new a.Q(Xt,we.wrap,Xt,ar,yt),er=o.terrain.getMinMaxElevation(Sr),hr=(h=er.minElevation)!==null&&h!==void 0?h:this.elevation,pr=(p=er.maxElevation)!==null&&p!==void 0?p:this.elevation;lr=new es([lr.min[0],lr.min[1],hr],[lr.max[0],lr.max[1],pr])}ve.push({aabb:lr,zoom:Xt,x:ar,y:yt,wrap:we.wrap,fullyVisible:Ze})}}return se.sort((we,Le)=>we.distanceSq-Le.distanceSq).map(we=>we.tileID)}resize(o,h){this.width=o,this.height=h,this.pixelsToGLUnits=[2/o,-2/h],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(o){return Math.pow(2,o)}scaleZoom(o){return Math.log(o)/Math.LN2}project(o){const h=a.ac(o.lat,-85.051129,Qc);return new a.P(a.N(o.lng)*this.worldSize,a.O(h)*this.worldSize)}unproject(o){return new a.Y(o.x/this.worldSize,o.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(o){const h=this.elevation,p=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,m=this.pointLocation(this.centerPoint,o),v=o.getElevationForLngLatZoom(m,this.tileZoom);if(!(this.elevation-v))return;const E=p+h-v,M=Math.cos(this._pitch)*this.cameraToCenterDistance/E/a.b3(1,m.lat),A=this.scaleZoom(M/this.tileSize);this._elevation=v,this._center=m,this.zoom=A}setLocationAtPoint(o,h){const p=this.pointCoordinate(h),m=this.pointCoordinate(this.centerPoint),v=this.locationCoordinate(o),E=new a.Y(v.x-(p.x-m.x),v.y-(p.y-m.y));this.center=this.coordinateLocation(E),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(o,h){return h?this.coordinatePoint(this.locationCoordinate(o),h.getElevationForLngLatZoom(o,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(o))}pointLocation(o,h){return this.coordinateLocation(this.pointCoordinate(o,h))}locationCoordinate(o){return a.Y.fromLngLat(o)}coordinateLocation(o){return o&&o.toLngLat()}pointCoordinate(o,h){if(h){const Y=h.pointCoordinate(o);if(Y!=null)return Y}const p=[o.x,o.y,0,1],m=[o.x,o.y,1,1];a.af(p,p,this.pixelMatrixInverse),a.af(m,m,this.pixelMatrixInverse);const v=p[3],E=m[3],M=p[1]/v,A=m[1]/E,F=p[2]/v,$=m[2]/E,q=F===$?0:(0-F)/($-F);return new a.Y(a.z.number(p[0]/v,m[0]/E,q)/this.worldSize,a.z.number(M,A,q)/this.worldSize)}coordinatePoint(o,h=0,p=this.pixelMatrix){const m=[o.x*this.worldSize,o.y*this.worldSize,h,1];return a.af(m,m,p),new a.P(m[0]/m[3],m[1]/m[3])}getBounds(){const o=Math.max(0,this.height/2-this.getHorizon());return new ut().extend(this.pointLocation(new a.P(0,o))).extend(this.pointLocation(new a.P(this.width,o))).extend(this.pointLocation(new a.P(this.width,this.height))).extend(this.pointLocation(new a.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new ut([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(o){o?(this.lngRange=[o.getWest(),o.getEast()],this.latRange=[o.getSouth(),o.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,Qc])}calculatePosMatrix(o,h=!1){const p=o.key,m=h?this._alignedPosMatrixCache:this._posMatrixCache;if(m[p])return m[p];const v=o.canonical,E=this.worldSize/this.zoomScale(v.z),M=v.x+Math.pow(2,v.z)*o.wrap,A=a.an(new Float64Array(16));return a.H(A,A,[M*E,v.y*E,0]),a.J(A,A,[E/a.W,E/a.W,1]),a.K(A,h?this.alignedProjMatrix:this.projMatrix,A),m[p]=new Float32Array(A),m[p]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(o,h){h=a.ac(+h,this.minZoom,this.maxZoom);const p={center:new a.M(o.lng,o.lat),zoom:h};let m=this.lngRange;if(!this._renderWorldCopies&&m===null){const we=179.9999999999;m=[-we,we]}const v=this.tileSize*this.zoomScale(p.zoom);let E=0,M=v,A=0,F=v,$=0,q=0;const{x:Y,y:de}=this.size;if(this.latRange){const we=this.latRange;E=a.O(we[1])*v,M=a.O(we[0])*v,M-E<de&&($=de/(M-E))}m&&(A=a.b1(a.N(m[0])*v,0,v),F=a.b1(a.N(m[1])*v,0,v),F<A&&(F+=v),F-A<Y&&(q=Y/(F-A)));const{x:fe,y:ve}=this.project.call({worldSize:v},o);let se,Ee;const $e=Math.max(q||0,$||0);if($e){const we=new a.P(q?(F+A)/2:fe,$?(M+E)/2:ve);return p.center=this.unproject.call({worldSize:v},we).wrap(),p.zoom+=this.scaleZoom($e),p}if(this.latRange){const we=de/2;ve-we<E&&(Ee=E+we),ve+we>M&&(Ee=M-we)}if(m){const we=(A+F)/2;let Le=fe;this._renderWorldCopies&&(Le=a.b1(fe,we-v/2,we+v/2));const Ge=Y/2;Le-Ge<A&&(se=A+Ge),Le+Ge>F&&(se=F-Ge)}if(se!==void 0||Ee!==void 0){const we=new a.P(se??fe,Ee??ve);p.center=this.unproject.call({worldSize:v},we).wrap()}return p}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const o=this._unmodified,{center:h,zoom:p}=this.getConstrained(this.center,this.zoom);this.center=h,this.zoom=p,this._unmodified=o,this._constraining=!1}_calcMatrices(){if(!this.height)return;const o=this.centerOffset,h=this.point.x,p=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=a.b3(1,this.center.lat)*this.worldSize;let m=a.an(new Float64Array(16));a.J(m,m,[this.width/2,-this.height/2,1]),a.H(m,m,[1,-1,0]),this.labelPlaneMatrix=m,m=a.an(new Float64Array(16)),a.J(m,m,[1,-1,1]),a.H(m,m,[-1,-1,0]),a.J(m,m,[2/this.width,2/this.height,1]),this.glCoordMatrix=m;const v=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),E=Math.min(this.elevation,this.minElevationForCurrentTile),M=v-E*this._pixelPerMeter/Math.cos(this._pitch),A=E<0?M:v,F=Math.PI/2+this._pitch,$=this._fov*(.5+o.y/this.height),q=Math.sin($)*A/Math.sin(a.ac(Math.PI-F-$,.01,Math.PI-.01)),Y=this.getHorizon(),de=2*Math.atan(Y/this.cameraToCenterDistance)*(.5+o.y/(2*Y)),fe=Math.sin(de)*A/Math.sin(a.ac(Math.PI-F-de,.01,Math.PI-.01)),ve=Math.min(q,fe),se=1.01*(Math.cos(Math.PI/2-this._pitch)*ve+A),Ee=this.height/50;m=new Float64Array(16),a.b4(m,this._fov,this.width/this.height,Ee,se),m[8]=2*-o.x/this.width,m[9]=2*o.y/this.height,a.J(m,m,[1,-1,1]),a.H(m,m,[0,0,-this.cameraToCenterDistance]),a.b5(m,m,this._pitch),a.ad(m,m,this.angle),a.H(m,m,[-h,-p,0]),this.mercatorMatrix=a.J([],m,[this.worldSize,this.worldSize,this.worldSize]),a.J(m,m,[1,1,this._pixelPerMeter]),this.pixelMatrix=a.K(new Float64Array(16),this.labelPlaneMatrix,m),a.H(m,m,[0,0,-this.elevation]),this.projMatrix=m,this.invProjMatrix=a.ar([],m),this.pixelMatrix3D=a.K(new Float64Array(16),this.labelPlaneMatrix,m);const $e=this.width%2/2,we=this.height%2/2,Le=Math.cos(this.angle),Ge=Math.sin(this.angle),Ze=h-Math.round(h)+Le*$e+Ge*we,Xe=p-Math.round(p)+Le*we+Ge*$e,nt=new Float64Array(m);if(a.H(nt,nt,[Ze>.5?Ze-1:Ze,Xe>.5?Xe-1:Xe,0]),this.alignedProjMatrix=nt,m=a.ar(new Float64Array(16),this.pixelMatrix),!m)throw new Error("failed to invert matrix");this.pixelMatrixInverse=m,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const o=this.pointCoordinate(new a.P(0,0)),h=[o.x*this.worldSize,o.y*this.worldSize,0,1];return a.af(h,h,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const o=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new a.P(0,o))}getCameraQueryGeometry(o){const h=this.getCameraPoint();if(o.length===1)return[o[0],h];{let p=h.x,m=h.y,v=h.x,E=h.y;for(const M of o)p=Math.min(p,M.x),m=Math.min(m,M.y),v=Math.max(v,M.x),E=Math.max(E,M.y);return[new a.P(p,m),new a.P(v,m),new a.P(v,E),new a.P(p,E),new a.P(p,m)]}}lngLatToCameraDepth(o,h){const p=this.locationCoordinate(o),m=[p.x*this.worldSize,p.y*this.worldSize,h,1];return a.af(m,m,this.projMatrix),m[2]/m[3]}}function eu(y,o){let h,p=!1,m=null,v=null;const E=()=>{m=null,p&&(y.apply(v,h),m=setTimeout(E,o),p=!1)};return(...M)=>(p=!0,v=this,h=M,m||E(),m)}class tu{constructor(o){this._getCurrentHash=()=>{const h=window.location.hash.replace("#","");if(this._hashName){let p;return h.split("&").map(m=>m.split("=")).forEach(m=>{m[0]===this._hashName&&(p=m)}),(p&&p[1]||"").split("/")}return h.split("/")},this._onHashChange=()=>{const h=this._getCurrentHash();if(h.length>=3&&!h.some(p=>isNaN(p))){const p=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(h[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+h[2],+h[1]],zoom:+h[0],bearing:p,pitch:+(h[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const h=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,h)}catch{}},this._updateHash=eu(this._updateHashUnthrottled,300),this._hashName=o&&encodeURIComponent(o)}addTo(o){return this._map=o,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(o){const h=this._map.getCenter(),p=Math.round(100*this._map.getZoom())/100,m=Math.ceil((p*Math.LN2+Math.log(512/360/.5))/Math.LN10),v=Math.pow(10,m),E=Math.round(h.lng*v)/v,M=Math.round(h.lat*v)/v,A=this._map.getBearing(),F=this._map.getPitch();let $="";if($+=o?`/${E}/${M}/${p}`:`${p}/${M}/${E}`,(A||F)&&($+="/"+Math.round(10*A)/10),F&&($+=`/${Math.round(F)}`),this._hashName){const q=this._hashName;let Y=!1;const de=window.location.hash.slice(1).split("&").map(fe=>{const ve=fe.split("=")[0];return ve===q?(Y=!0,`${ve}=${$}`):fe}).filter(fe=>fe);return Y||de.push(`${q}=${$}`),`#${de.join("&")}`}return`#${$}`}}const Ra={linearity:.3,easing:a.b6(0,0,.3,1)},vs=a.e({deceleration:2500,maxSpeed:1400},Ra),sf=a.e({deceleration:20,maxSpeed:1400},Ra),af=a.e({deceleration:1e3,maxSpeed:360},Ra),lf=a.e({deceleration:1e3,maxSpeed:90},Ra);class cf{constructor(o){this._map=o,this.clear()}clear(){this._inertiaBuffer=[]}record(o){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:S.now(),settings:o})}_drainInertiaBuffer(){const o=this._inertiaBuffer,h=S.now();for(;o.length>0&&h-o[0].time>160;)o.shift()}_onMoveEnd(o){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const h={zoom:0,bearing:0,pitch:0,pan:new a.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:v}of this._inertiaBuffer)h.zoom+=v.zoomDelta||0,h.bearing+=v.bearingDelta||0,h.pitch+=v.pitchDelta||0,v.panDelta&&h.pan._add(v.panDelta),v.around&&(h.around=v.around),v.pinchAround&&(h.pinchAround=v.pinchAround);const p=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,m={};if(h.pan.mag()){const v=Fa(h.pan.mag(),p,a.e({},vs,o||{}));m.offset=h.pan.mult(v.amount/h.pan.mag()),m.center=this._map.transform.center,Ba(m,v)}if(h.zoom){const v=Fa(h.zoom,p,sf);m.zoom=this._map.transform.zoom+v.amount,Ba(m,v)}if(h.bearing){const v=Fa(h.bearing,p,af);m.bearing=this._map.transform.bearing+a.ac(v.amount,-179,179),Ba(m,v)}if(h.pitch){const v=Fa(h.pitch,p,lf);m.pitch=this._map.transform.pitch+v.amount,Ba(m,v)}if(m.zoom||m.bearing){const v=h.pinchAround===void 0?h.around:h.pinchAround;m.around=v?this._map.unproject(v):this._map.getCenter()}return this.clear(),a.e(m,{noMoveStart:!0})}}function Ba(y,o){(!y.duration||y.duration<o.duration)&&(y.duration=o.duration,y.easing=o.easing)}function Fa(y,o,h){const{maxSpeed:p,linearity:m,deceleration:v}=h,E=a.ac(y*m/(o/1e3),-p,p),M=Math.abs(E)/(v*m);return{easing:h.easing,duration:1e3*M,amount:E*(M/2)}}class ki extends a.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,h,p,m={}){const v=C.mousePos(h.getCanvas(),p),E=h.unproject(v);super(o,a.e({point:v,lngLat:E,originalEvent:p},m)),this._defaultPrevented=!1,this.target=h}}class vo extends a.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,h,p){const m=o==="touchend"?p.changedTouches:p.touches,v=C.touchPos(h.getCanvasContainer(),m),E=v.map(A=>h.unproject(A)),M=v.reduce((A,F,$,q)=>A.add(F.div(q.length)),new a.P(0,0));super(o,{points:v,point:M,lngLats:E,lngLat:h.unproject(M),originalEvent:p}),this._defaultPrevented=!1}}class ru extends a.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,h,p){super(o,{originalEvent:p}),this._defaultPrevented=!1}}class oo{constructor(o,h){this._map=o,this._clickTolerance=h.clickTolerance}reset(){delete this._mousedownPos}wheel(o){return this._firePreventable(new ru(o.type,this._map,o))}mousedown(o,h){return this._mousedownPos=h,this._firePreventable(new ki(o.type,this._map,o))}mouseup(o){this._map.fire(new ki(o.type,this._map,o))}click(o,h){this._mousedownPos&&this._mousedownPos.dist(h)>=this._clickTolerance||this._map.fire(new ki(o.type,this._map,o))}dblclick(o){return this._firePreventable(new ki(o.type,this._map,o))}mouseover(o){this._map.fire(new ki(o.type,this._map,o))}mouseout(o){this._map.fire(new ki(o.type,this._map,o))}touchstart(o){return this._firePreventable(new vo(o.type,this._map,o))}touchmove(o){this._map.fire(new vo(o.type,this._map,o))}touchend(o){this._map.fire(new vo(o.type,this._map,o))}touchcancel(o){this._map.fire(new vo(o.type,this._map,o))}_firePreventable(o){if(this._map.fire(o),o.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class bo{constructor(o){this._map=o}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(o){this._map.fire(new ki(o.type,this._map,o))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new ki("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(o){this._delayContextMenu?this._contextMenuEvent=o:this._ignoreContextMenu||this._map.fire(new ki(o.type,this._map,o)),this._map.listens("contextmenu")&&o.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Hs{constructor(o){this._map=o}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(o){return this.transform.pointLocation(a.P.convert(o),this._map.terrain)}}class so{constructor(o,h){this._map=o,this._tr=new Hs(o),this._el=o.getCanvasContainer(),this._container=o.getContainer(),this._clickTolerance=h.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(o,h){this.isEnabled()&&o.shiftKey&&o.button===0&&(C.disableDrag(),this._startPos=this._lastPos=h,this._active=!0)}mousemoveWindow(o,h){if(!this._active)return;const p=h;if(this._lastPos.equals(p)||!this._box&&p.dist(this._startPos)<this._clickTolerance)return;const m=this._startPos;this._lastPos=p,this._box||(this._box=C.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",o));const v=Math.min(m.x,p.x),E=Math.max(m.x,p.x),M=Math.min(m.y,p.y),A=Math.max(m.y,p.y);C.setTransform(this._box,`translate(${v}px,${M}px)`),this._box.style.width=E-v+"px",this._box.style.height=A-M+"px"}mouseupWindow(o,h){if(!this._active||o.button!==0)return;const p=this._startPos,m=h;if(this.reset(),C.suppressClick(),p.x!==m.x||p.y!==m.y)return this._map.fire(new a.k("boxzoomend",{originalEvent:o})),{cameraAnimation:v=>v.fitScreenCoordinates(p,m,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",o)}keydown(o){this._active&&o.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",o))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(C.remove(this._box),this._box=null),C.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(o,h){return this._map.fire(new a.k(o,{originalEvent:h}))}}function bs(y,o){if(y.length!==o.length)throw new Error(`The number of touches and points are not equal - touches ${y.length}, points ${o.length}`);const h={};for(let p=0;p<y.length;p++)h[y[p].identifier]=o[p];return h}class fp{constructor(o){this.reset(),this.numTouches=o.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(o,h,p){(this.centroid||p.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=o.timeStamp),p.length===this.numTouches&&(this.centroid=function(m){const v=new a.P(0,0);for(const E of m)v._add(E);return v.div(m.length)}(h),this.touches=bs(p,h)))}touchmove(o,h,p){if(this.aborted||!this.centroid)return;const m=bs(p,h);for(const v in this.touches){const E=m[v];(!E||E.dist(this.touches[v])>30)&&(this.aborted=!0)}}touchend(o,h,p){if((!this.centroid||o.timeStamp-this.startTime>500)&&(this.aborted=!0),p.length===0){const m=!this.aborted&&this.centroid;if(this.reset(),m)return m}}}class nu{constructor(o){this.singleTap=new fp(o),this.numTaps=o.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(o,h,p){this.singleTap.touchstart(o,h,p)}touchmove(o,h,p){this.singleTap.touchmove(o,h,p)}touchend(o,h,p){const m=this.singleTap.touchend(o,h,p);if(m){const v=o.timeStamp-this.lastTime<500,E=!this.lastTap||this.lastTap.dist(m)<30;if(v&&E||this.reset(),this.count++,this.lastTime=o.timeStamp,this.lastTap=m,this.count===this.numTaps)return this.reset(),m}}}class dp{constructor(o){this._tr=new Hs(o),this._zoomIn=new nu({numTouches:1,numTaps:2}),this._zoomOut=new nu({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(o,h,p){this._zoomIn.touchstart(o,h,p),this._zoomOut.touchstart(o,h,p)}touchmove(o,h,p){this._zoomIn.touchmove(o,h,p),this._zoomOut.touchmove(o,h,p)}touchend(o,h,p){const m=this._zoomIn.touchend(o,h,p),v=this._zoomOut.touchend(o,h,p),E=this._tr;return m?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:M=>M.easeTo({duration:300,zoom:E.zoom+1,around:E.unproject(m)},{originalEvent:o})}):v?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:M=>M.easeTo({duration:300,zoom:E.zoom-1,around:E.unproject(v)},{originalEvent:o})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Xs{constructor(o){this._enabled=!!o.enable,this._moveStateManager=o.moveStateManager,this._clickTolerance=o.clickTolerance||1,this._moveFunction=o.move,this._activateOnStart=!!o.activateOnStart,o.assignEvents(this),this.reset()}reset(o){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(o)}_move(...o){const h=this._moveFunction(...o);if(h.bearingDelta||h.pitchDelta||h.around||h.panDelta)return this._active=!0,h}dragStart(o,h){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(o)&&(this._moveStateManager.startMove(o),this._lastPoint=h.length?h[0]:h,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(o,h){if(!this.isEnabled())return;const p=this._lastPoint;if(!p)return;if(o.preventDefault(),!this._moveStateManager.isValidMoveEvent(o))return void this.reset(o);const m=h.length?h[0]:h;return!this._moved&&m.dist(p)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=m,this._move(p,m))}dragEnd(o){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(o)&&(this._moved&&C.suppressClick(),this.reset(o))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Oa={0:1,2:2};class wo{constructor(o){this._correctEvent=o.checkCorrectEvent}startMove(o){const h=C.mouseButton(o);this._eventButton=h}endMove(o){delete this._eventButton}isValidStartEvent(o){return this._correctEvent(o)}isValidMoveEvent(o){return!function(h,p){const m=Oa[p];return h.buttons===void 0||(h.buttons&m)!==m}(o,this._eventButton)}isValidEndEvent(o){return C.mouseButton(o)===this._eventButton}}class At{constructor(){this._firstTouch=void 0}_isOneFingerTouch(o){return o.targetTouches.length===1}_isSameTouchEvent(o){return o.targetTouches[0].identifier===this._firstTouch}startMove(o){this._firstTouch=o.targetTouches[0].identifier}endMove(o){delete this._firstTouch}isValidStartEvent(o){return this._isOneFingerTouch(o)}isValidMoveEvent(o){return this._isOneFingerTouch(o)&&this._isSameTouchEvent(o)}isValidEndEvent(o){return this._isOneFingerTouch(o)&&this._isSameTouchEvent(o)}}const Rl=y=>{y.mousedown=y.dragStart,y.mousemoveWindow=y.dragMove,y.mouseup=y.dragEnd,y.contextmenu=function(o){o.preventDefault()}},Ks=({enable:y,clickTolerance:o,bearingDegreesPerPixelMoved:h=.8})=>{const p=new wo({checkCorrectEvent:m=>C.mouseButton(m)===0&&m.ctrlKey||C.mouseButton(m)===2});return new Xs({clickTolerance:o,move:(m,v)=>({bearingDelta:(v.x-m.x)*h}),moveStateManager:p,enable:y,assignEvents:Rl})},Js=({enable:y,clickTolerance:o,pitchDegreesPerPixelMoved:h=-.5})=>{const p=new wo({checkCorrectEvent:m=>C.mouseButton(m)===0&&m.ctrlKey||C.mouseButton(m)===2});return new Xs({clickTolerance:o,move:(m,v)=>({pitchDelta:(v.y-m.y)*h}),moveStateManager:p,enable:y,assignEvents:Rl})};class uf{constructor(o,h){this._clickTolerance=o.clickTolerance||1,this._map=h,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new a.P(0,0)}minTouchs(){return this._map.cooperativeGestures.isEnabled()?2:1}touchstart(o,h,p){return this._calculateTransform(o,h,p)}touchmove(o,h,p){if(this._active&&!(p.length<this.minTouchs()))return o.preventDefault(),this._calculateTransform(o,h,p)}touchend(o,h,p){this._calculateTransform(o,h,p),this._active&&p.length<this.minTouchs()&&this.reset()}touchcancel(){this.reset()}_calculateTransform(o,h,p){p.length>0&&(this._active=!0);const m=bs(p,h),v=new a.P(0,0),E=new a.P(0,0);let M=0;for(const F in m){const $=m[F],q=this._touches[F];q&&(v._add($),E._add($.sub(q)),M++,m[F]=$)}if(this._touches=m,M<this.minTouchs()||!E.mag())return;const A=E.div(M);return this._sum._add(A),this._sum.mag()<this._clickTolerance?void 0:{around:v.div(M),panDelta:A}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class St{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(o,h,p){this._firstTwoTouches||p.length<2||(this._firstTwoTouches=[p[0].identifier,p[1].identifier],this._start([h[0],h[1]]))}touchmove(o,h,p){if(!this._firstTwoTouches)return;o.preventDefault();const[m,v]=this._firstTwoTouches,E=Ys(p,h,m),M=Ys(p,h,v);if(!E||!M)return;const A=this._aroundCenter?null:E.add(M).div(2);return this._move([E,M],A,o)}touchend(o,h,p){if(!this._firstTwoTouches)return;const[m,v]=this._firstTwoTouches,E=Ys(p,h,m),M=Ys(p,h,v);E&&M||(this._active&&C.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(o){this._enabled=!0,this._aroundCenter=!!o&&o.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Ys(y,o,h){for(let p=0;p<y.length;p++)if(y[p].identifier===h)return o[p]}function hf(y,o){return Math.log(y/o)/Math.LN2}class ff extends St{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(o){this._startDistance=this._distance=o[0].dist(o[1])}_move(o,h){const p=this._distance;if(this._distance=o[0].dist(o[1]),this._active||!(Math.abs(hf(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:hf(this._distance,p),pinchAround:h}}}function Bl(y,o){return 180*y.angleWith(o)/Math.PI}class iu extends St{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(o){this._startVector=this._vector=o[0].sub(o[1]),this._minDiameter=o[0].dist(o[1])}_move(o,h,p){const m=this._vector;if(this._vector=o[0].sub(o[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Bl(this._vector,m),pinchAround:h}}_isBelowThreshold(o){this._minDiameter=Math.min(this._minDiameter,o.mag());const h=25/(Math.PI*this._minDiameter)*360,p=Bl(o,this._startVector);return Math.abs(p)<h}}function Fl(y){return Math.abs(y.y)>Math.abs(y.x)}class df extends St{constructor(o){super(),this._currentTouchCount=0,this._map=o}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(o,h,p){super.touchstart(o,h,p),this._currentTouchCount=p.length}_start(o){this._lastPoints=o,Fl(o[0].sub(o[1]))&&(this._valid=!1)}_move(o,h,p){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const m=o[0].sub(this._lastPoints[0]),v=o[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(m,v,p.timeStamp),this._valid?(this._lastPoints=o,this._active=!0,{pitchDelta:(m.y+v.y)/2*-.5}):void 0}gestureBeginsVertically(o,h,p){if(this._valid!==void 0)return this._valid;const m=o.mag()>=2,v=h.mag()>=2;if(!m&&!v)return;if(!m||!v)return this._firstMove===void 0&&(this._firstMove=p),p-this._firstMove<100&&void 0;const E=o.y>0==h.y>0;return Fl(o)&&Fl(h)&&E}}const pp={panStep:100,bearingStep:15,pitchStep:10};class ts{constructor(o){this._tr=new Hs(o);const h=pp;this._panStep=h.panStep,this._bearingStep=h.bearingStep,this._pitchStep=h.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(o){if(o.altKey||o.ctrlKey||o.metaKey)return;let h=0,p=0,m=0,v=0,E=0;switch(o.keyCode){case 61:case 107:case 171:case 187:h=1;break;case 189:case 109:case 173:h=-1;break;case 37:o.shiftKey?p=-1:(o.preventDefault(),v=-1);break;case 39:o.shiftKey?p=1:(o.preventDefault(),v=1);break;case 38:o.shiftKey?m=1:(o.preventDefault(),E=-1);break;case 40:o.shiftKey?m=-1:(o.preventDefault(),E=1);break;default:return}return this._rotationDisabled&&(p=0,m=0),{cameraAnimation:M=>{const A=this._tr;M.easeTo({duration:300,easeId:"keyboardHandler",easing:Qr,zoom:h?Math.round(A.zoom)+h*(o.shiftKey?2:1):A.zoom,bearing:A.bearing+p*this._bearingStep,pitch:A.pitch+m*this._pitchStep,offset:[-v*this._panStep,-E*this._panStep],center:A.center},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Qr(y){return y*(2-y)}const Na=4.000244140625;class Ol{constructor(o,h){this._onTimeout=p=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(p)},this._map=o,this._tr=new Hs(o),this._triggerRenderFrame=h,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(o){this._defaultZoomRate=o}setWheelZoomRate(o){this._wheelZoomRate=o}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(o){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!o&&o.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(o){if(!this.isEnabled()||this._map.cooperativeGestures.isEnabled()&&!o[this._map.cooperativeGestures._bypassKey])return;let h=o.deltaMode===WheelEvent.DOM_DELTA_LINE?40*o.deltaY:o.deltaY;const p=S.now(),m=p-(this._lastWheelEventTime||0);this._lastWheelEventTime=p,h!==0&&h%Na==0?this._type="wheel":h!==0&&Math.abs(h)<4?this._type="trackpad":m>400?(this._type=null,this._lastValue=h,this._timeout=setTimeout(this._onTimeout,40,o)):this._type||(this._type=Math.abs(m*h)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,h+=this._lastValue)),o.shiftKey&&h&&(h/=4),this._type&&(this._lastWheelEvent=o,this._delta-=h,this._active||this._start(o)),o.preventDefault()}_start(o){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const h=C.mousePos(this._map.getCanvas(),o),p=this._tr;this._around=h.y>p.transform.height/2-p.transform.getHorizon()?a.M.convert(this._aroundCenter?p.center:p.unproject(h)):a.M.convert(p.center),this._aroundPoint=p.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const o=this._tr.transform;if(this._delta!==0){const M=this._type==="wheel"&&Math.abs(this._delta)>Na?this._wheelZoomRate:this._defaultZoomRate;let A=2/(1+Math.exp(-Math.abs(this._delta*M)));this._delta<0&&A!==0&&(A=1/A);const F=typeof this._targetZoom=="number"?o.zoomScale(this._targetZoom):o.scale;this._targetZoom=Math.min(o.maxZoom,Math.max(o.minZoom,o.scaleZoom(F*A))),this._type==="wheel"&&(this._startZoom=o.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const h=typeof this._targetZoom=="number"?this._targetZoom:o.zoom,p=this._startZoom,m=this._easing;let v,E=!1;if(this._type==="wheel"&&p&&m){const M=Math.min((S.now()-this._lastWheelEventTime)/200,1),A=m(M);v=a.z.number(p,h,A),M<1?this._frameId||(this._frameId=!0):E=!0}else v=h,E=!0;return this._active=!0,E&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!E,zoomDelta:v-o.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(o){let h=a.b7;if(this._prevEase){const p=this._prevEase,m=(S.now()-p.start)/p.duration,v=p.easing(m+.01)-p.easing(m),E=.27/Math.sqrt(v*v+1e-4)*.01,M=Math.sqrt(.0729-E*E);h=a.b6(E,M,.25,1)}return this._prevEase={start:S.now(),duration:o,easing:h},h}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class ou{constructor(o,h){this._clickZoom=o,this._tapZoom=h}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class pf{constructor(o){this._tr=new Hs(o),this.reset()}reset(){this._active=!1}dblclick(o,h){return o.preventDefault(),{cameraAnimation:p=>{p.easeTo({duration:300,zoom:this._tr.zoom+(o.shiftKey?-1:1),around:this._tr.unproject(h)},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class mf{constructor(){this._tap=new nu({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(o,h,p){if(!this._swipePoint)if(this._tapTime){const m=h[0],v=o.timeStamp-this._tapTime<500,E=this._tapPoint.dist(m)<30;v&&E?p.length>0&&(this._swipePoint=m,this._swipeTouch=p[0].identifier):this.reset()}else this._tap.touchstart(o,h,p)}touchmove(o,h,p){if(this._tapTime){if(this._swipePoint){if(p[0].identifier!==this._swipeTouch)return;const m=h[0],v=m.y-this._swipePoint.y;return this._swipePoint=m,o.preventDefault(),this._active=!0,{zoomDelta:v/128}}}else this._tap.touchmove(o,h,p)}touchend(o,h,p){if(this._tapTime)this._swipePoint&&p.length===0&&this.reset();else{const m=this._tap.touchend(o,h,p);m&&(this._tapTime=o.timeStamp,this._tapPoint=m)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class gf{constructor(o,h,p){this._el=o,this._mousePan=h,this._touchPan=p}enable(o){this._inertiaOptions=o||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class ao{constructor(o,h,p){this._pitchWithRotate=o.pitchWithRotate,this._mouseRotate=h,this._mousePitch=p}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class ja{constructor(o,h,p,m){this._el=o,this._touchZoom=h,this._touchRotate=p,this._tapDragZoom=m,this._rotationDisabled=!1,this._enabled=!0}enable(o){this._touchZoom.enable(o),this._rotationDisabled||this._touchRotate.enable(o),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class Nt{constructor(o,h){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=o,this._options=h,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const o=this._map.getCanvasContainer();o.classList.add("maplibregl-cooperative-gestures"),this._container=C.create("div","maplibregl-cooperative-gesture-screen",o);let h=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(h=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const p=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),m=document.createElement("div");m.className="maplibregl-desktop-message",m.textContent=h,this._container.appendChild(m);const v=document.createElement("div");v.className="maplibregl-mobile-message",v.textContent=p,this._container.appendChild(v),this._container.setAttribute("aria-hidden","true")}_destoryUI(){this._container&&(C.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destoryUI()}isEnabled(){return this._enabled}touchmove(o){this._onCooperativeGesture(o.touches.length===1)}wheel(o){this._map.scrollZoom.isEnabled()&&this._onCooperativeGesture(!o[this._bypassKey])}_onCooperativeGesture(o){this._enabled&&o&&(this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const Gt=y=>y.zoom||y.drag||y.pitch||y.rotate;class Nl extends a.k{}function Ua(y){return y.panDelta&&y.panDelta.mag()||y.zoomDelta||y.bearingDelta||y.pitchDelta}class su{constructor(o,h){this.handleWindowEvent=m=>{this.handleEvent(m,`${m.type}Window`)},this.handleEvent=(m,v)=>{if(m.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const E=m.type==="renderFrame"?void 0:m,M={needsRenderFrame:!1},A={},F={},$=m.touches,q=$?this._getMapTouches($):void 0,Y=q?C.touchPos(this._map.getCanvas(),q):C.mousePos(this._map.getCanvas(),m);for(const{handlerName:ve,handler:se,allowed:Ee}of this._handlers){if(!se.isEnabled())continue;let $e;this._blockedByActive(F,Ee,ve)?se.reset():se[v||m.type]&&($e=se[v||m.type](m,Y,q),this.mergeHandlerResult(M,A,$e,ve,E),$e&&$e.needsRenderFrame&&this._triggerRenderFrame()),($e||se.isActive())&&(F[ve]=se)}const de={};for(const ve in this._previousActiveHandlers)F[ve]||(de[ve]=E);this._previousActiveHandlers=F,(Object.keys(de).length||Ua(M))&&(this._changes.push([M,A,de]),this._triggerRenderFrame()),(Object.keys(F).length||Ua(M))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:fe}=M;fe&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],fe(this._map))},this._map=o,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new cf(o),this._bearingSnap=h.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(h);const p=this._el;this._listeners=[[p,"touchstart",{passive:!0}],[p,"touchmove",{passive:!1}],[p,"touchend",void 0],[p,"touchcancel",void 0],[p,"mousedown",void 0],[p,"mousemove",void 0],[p,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[p,"mouseover",void 0],[p,"mouseout",void 0],[p,"dblclick",void 0],[p,"click",void 0],[p,"keydown",{capture:!1}],[p,"keyup",void 0],[p,"wheel",{passive:!1}],[p,"contextmenu",void 0],[window,"blur",void 0]];for(const[m,v,E]of this._listeners)C.addEventListener(m,v,m===document?this.handleWindowEvent:this.handleEvent,E)}destroy(){for(const[o,h,p]of this._listeners)C.removeEventListener(o,h,o===document?this.handleWindowEvent:this.handleEvent,p)}_addDefaultHandlers(o){const h=this._map,p=h.getCanvasContainer();this._add("mapEvent",new oo(h,o));const m=h.boxZoom=new so(h,o);this._add("boxZoom",m),o.interactive&&o.boxZoom&&m.enable();const v=h.cooperativeGestures=new Nt(h,o.cooperativeGestures);this._add("cooperativeGestures",v),o.cooperativeGestures&&v.enable();const E=new dp(h),M=new pf(h);h.doubleClickZoom=new ou(M,E),this._add("tapZoom",E),this._add("clickZoom",M),o.interactive&&o.doubleClickZoom&&h.doubleClickZoom.enable();const A=new mf;this._add("tapDragZoom",A);const F=h.touchPitch=new df(h);this._add("touchPitch",F),o.interactive&&o.touchPitch&&h.touchPitch.enable(o.touchPitch);const $=Ks(o),q=Js(o);h.dragRotate=new ao(o,$,q),this._add("mouseRotate",$,["mousePitch"]),this._add("mousePitch",q,["mouseRotate"]),o.interactive&&o.dragRotate&&h.dragRotate.enable();const Y=(({enable:$e,clickTolerance:we})=>{const Le=new wo({checkCorrectEvent:Ge=>C.mouseButton(Ge)===0&&!Ge.ctrlKey});return new Xs({clickTolerance:we,move:(Ge,Ze)=>({around:Ze,panDelta:Ze.sub(Ge)}),activateOnStart:!0,moveStateManager:Le,enable:$e,assignEvents:Rl})})(o),de=new uf(o,h);h.dragPan=new gf(p,Y,de),this._add("mousePan",Y),this._add("touchPan",de,["touchZoom","touchRotate"]),o.interactive&&o.dragPan&&h.dragPan.enable(o.dragPan);const fe=new iu,ve=new ff;h.touchZoomRotate=new ja(p,ve,fe,A),this._add("touchRotate",fe,["touchPan","touchZoom"]),this._add("touchZoom",ve,["touchPan","touchRotate"]),o.interactive&&o.touchZoomRotate&&h.touchZoomRotate.enable(o.touchZoomRotate);const se=h.scrollZoom=new Ol(h,()=>this._triggerRenderFrame());this._add("scrollZoom",se,["mousePan"]),o.interactive&&o.scrollZoom&&h.scrollZoom.enable(o.scrollZoom);const Ee=h.keyboard=new ts(h);this._add("keyboard",Ee),o.interactive&&o.keyboard&&h.keyboard.enable(),this._add("blockableMapEvent",new bo(h))}_add(o,h,p){this._handlers.push({handlerName:o,handler:h,allowed:p}),this._handlersById[o]=h}stop(o){if(!this._updatingCamera){for(const{handler:h}of this._handlers)h.reset();this._inertia.clear(),this._fireEvents({},{},o),this._changes=[]}}isActive(){for(const{handler:o}of this._handlers)if(o.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Gt(this._eventsInProgress)||this.isZooming()}_blockedByActive(o,h,p){for(const m in o)if(m!==p&&(!h||h.indexOf(m)<0))return!0;return!1}_getMapTouches(o){const h=[];for(const p of o)this._el.contains(p.target)&&h.push(p);return h}mergeHandlerResult(o,h,p,m,v){if(!p)return;a.e(o,p);const E={handlerName:m,originalEvent:p.originalEvent||v};p.zoomDelta!==void 0&&(h.zoom=E),p.panDelta!==void 0&&(h.drag=E),p.pitchDelta!==void 0&&(h.pitch=E),p.bearingDelta!==void 0&&(h.rotate=E)}_applyChanges(){const o={},h={},p={};for(const[m,v,E]of this._changes)m.panDelta&&(o.panDelta=(o.panDelta||new a.P(0,0))._add(m.panDelta)),m.zoomDelta&&(o.zoomDelta=(o.zoomDelta||0)+m.zoomDelta),m.bearingDelta&&(o.bearingDelta=(o.bearingDelta||0)+m.bearingDelta),m.pitchDelta&&(o.pitchDelta=(o.pitchDelta||0)+m.pitchDelta),m.around!==void 0&&(o.around=m.around),m.pinchAround!==void 0&&(o.pinchAround=m.pinchAround),m.noInertia&&(o.noInertia=m.noInertia),a.e(h,v),a.e(p,E);this._updateMapTransform(o,h,p),this._changes=[]}_updateMapTransform(o,h,p){const m=this._map,v=m._getTransformForUpdate(),E=m.terrain;if(!(Ua(o)||E&&this._terrainMovement))return this._fireEvents(h,p,!0);let{panDelta:M,zoomDelta:A,bearingDelta:F,pitchDelta:$,around:q,pinchAround:Y}=o;Y!==void 0&&(q=Y),m._stop(!0),q=q||m.transform.centerPoint;const de=v.pointLocation(M?q.sub(M):q);F&&(v.bearing+=F),$&&(v.pitch+=$),A&&(v.zoom+=A),E?this._terrainMovement||!h.drag&&!h.zoom?h.drag&&this._terrainMovement?v.center=v.pointLocation(v.centerPoint.sub(M)):v.setLocationAtPoint(de,q):(this._terrainMovement=!0,this._map._elevationFreeze=!0,v.setLocationAtPoint(de,q),this._map.once("moveend",()=>{this._map._elevationFreeze=!1,this._terrainMovement=!1,v.recalculateZoom(m.terrain)})):v.setLocationAtPoint(de,q),m._applyUpdatedTransform(v),this._map._update(),o.noInertia||this._inertia.record(o),this._fireEvents(h,p,!0)}_fireEvents(o,h,p){const m=Gt(this._eventsInProgress),v=Gt(o),E={};for(const $ in o){const{originalEvent:q}=o[$];this._eventsInProgress[$]||(E[`${$}start`]=q),this._eventsInProgress[$]=o[$]}!m&&v&&this._fireEvent("movestart",v.originalEvent);for(const $ in E)this._fireEvent($,E[$]);v&&this._fireEvent("move",v.originalEvent);for(const $ in o){const{originalEvent:q}=o[$];this._fireEvent($,q)}const M={};let A;for(const $ in this._eventsInProgress){const{handlerName:q,originalEvent:Y}=this._eventsInProgress[$];this._handlersById[q].isActive()||(delete this._eventsInProgress[$],A=h[q]||Y,M[`${$}end`]=A)}for(const $ in M)this._fireEvent($,M[$]);const F=Gt(this._eventsInProgress);if(p&&(m||v)&&!F){this._updatingCamera=!0;const $=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),q=Y=>Y!==0&&-this._bearingSnap<Y&&Y<this._bearingSnap;!$||!$.essential&&S.prefersReducedMotion?(this._map.fire(new a.k("moveend",{originalEvent:A})),q(this._map.getBearing())&&this._map.resetNorth()):(q($.bearing||this._map.getBearing())&&($.bearing=0),$.freezeElevation=!0,this._map.easeTo($,{originalEvent:A})),this._updatingCamera=!1}}_fireEvent(o,h){this._map.fire(new a.k(o,h?{originalEvent:h}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(o=>{delete this._frameId,this.handleEvent(new Nl("renderFrame",{timeStamp:o})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Ti extends a.E{constructor(o,h){super(),this._renderFrameCallback=()=>{const p=Math.min((S.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(p)),p<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=o,this._bearingSnap=h.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new a.M(this.transform.center.lng,this.transform.center.lat)}setCenter(o,h){return this.jumpTo({center:o},h)}panBy(o,h,p){return o=a.P.convert(o).mult(-1),this.panTo(this.transform.center,a.e({offset:o},h),p)}panTo(o,h,p){return this.easeTo(a.e({center:o},h),p)}getZoom(){return this.transform.zoom}setZoom(o,h){return this.jumpTo({zoom:o},h),this}zoomTo(o,h,p){return this.easeTo(a.e({zoom:o},h),p)}zoomIn(o,h){return this.zoomTo(this.getZoom()+1,o,h),this}zoomOut(o,h){return this.zoomTo(this.getZoom()-1,o,h),this}getBearing(){return this.transform.bearing}setBearing(o,h){return this.jumpTo({bearing:o},h),this}getPadding(){return this.transform.padding}setPadding(o,h){return this.jumpTo({padding:o},h),this}rotateTo(o,h,p){return this.easeTo(a.e({bearing:o},h),p)}resetNorth(o,h){return this.rotateTo(0,a.e({duration:1e3},o),h),this}resetNorthPitch(o,h){return this.easeTo(a.e({bearing:0,pitch:0,duration:1e3},o),h),this}snapToNorth(o,h){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(o,h):this}getPitch(){return this.transform.pitch}setPitch(o,h){return this.jumpTo({pitch:o},h),this}cameraForBounds(o,h){o=ut.convert(o);const p=h&&h.bearing||0;return this._cameraForBoxAndBearing(o.getNorthWest(),o.getSouthEast(),p,h)}_cameraForBoxAndBearing(o,h,p,m){const v={top:0,bottom:0,right:0,left:0};if(typeof(m=a.e({padding:v,offset:[0,0],maxZoom:this.transform.maxZoom},m)).padding=="number"){const gt=m.padding;m.padding={top:gt,bottom:gt,right:gt,left:gt}}m.padding=a.e(v,m.padding);const E=this.transform,M=E.padding,A=new ut(o,h),F=E.project(A.getNorthWest()),$=E.project(A.getNorthEast()),q=E.project(A.getSouthEast()),Y=E.project(A.getSouthWest()),de=a.b8(-p),fe=F.rotate(de),ve=$.rotate(de),se=q.rotate(de),Ee=Y.rotate(de),$e=new a.P(Math.max(fe.x,ve.x,Ee.x,se.x),Math.max(fe.y,ve.y,Ee.y,se.y)),we=new a.P(Math.min(fe.x,ve.x,Ee.x,se.x),Math.min(fe.y,ve.y,Ee.y,se.y)),Le=$e.sub(we),Ge=(E.width-(M.left+M.right+m.padding.left+m.padding.right))/Le.x,Ze=(E.height-(M.top+M.bottom+m.padding.top+m.padding.bottom))/Le.y;if(Ze<0||Ge<0)return void a.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const Xe=Math.min(E.scaleZoom(E.scale*Math.min(Ge,Ze)),m.maxZoom),nt=a.P.convert(m.offset),rt=new a.P((m.padding.left-m.padding.right)/2,(m.padding.top-m.padding.bottom)/2).rotate(a.b8(p)),ft=nt.add(rt).mult(E.scale/E.zoomScale(Xe));return{center:E.unproject(F.add(q).div(2).sub(ft)),zoom:Xe,bearing:p}}fitBounds(o,h,p){return this._fitInternal(this.cameraForBounds(o,h),h,p)}fitScreenCoordinates(o,h,p,m,v){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(a.P.convert(o)),this.transform.pointLocation(a.P.convert(h)),p,m),m,v)}_fitInternal(o,h,p){return o?(delete(h=a.e(o,h)).padding,h.linear?this.easeTo(h,p):this.flyTo(h,p)):this}jumpTo(o,h){this.stop();const p=this._getTransformForUpdate();let m=!1,v=!1,E=!1;return"zoom"in o&&p.zoom!==+o.zoom&&(m=!0,p.zoom=+o.zoom),o.center!==void 0&&(p.center=a.M.convert(o.center)),"bearing"in o&&p.bearing!==+o.bearing&&(v=!0,p.bearing=+o.bearing),"pitch"in o&&p.pitch!==+o.pitch&&(E=!0,p.pitch=+o.pitch),o.padding==null||p.isPaddingEqual(o.padding)||(p.padding=o.padding),this._applyUpdatedTransform(p),this.fire(new a.k("movestart",h)).fire(new a.k("move",h)),m&&this.fire(new a.k("zoomstart",h)).fire(new a.k("zoom",h)).fire(new a.k("zoomend",h)),v&&this.fire(new a.k("rotatestart",h)).fire(new a.k("rotate",h)).fire(new a.k("rotateend",h)),E&&this.fire(new a.k("pitchstart",h)).fire(new a.k("pitch",h)).fire(new a.k("pitchend",h)),this.fire(new a.k("moveend",h))}calculateCameraOptionsFromTo(o,h,p,m=0){const v=a.Y.fromLngLat(o,h),E=a.Y.fromLngLat(p,m),M=E.x-v.x,A=E.y-v.y,F=E.z-v.z,$=Math.hypot(M,A,F);if($===0)throw new Error("Can't calculate camera options with same From and To");const q=Math.hypot(M,A),Y=this.transform.scaleZoom(this.transform.cameraToCenterDistance/$/this.transform.tileSize),de=180*Math.atan2(M,-A)/Math.PI;let fe=180*Math.acos(q/$)/Math.PI;return fe=F<0?90-fe:90+fe,{center:E.toLngLat(),zoom:Y,pitch:fe,bearing:de}}easeTo(o,h){var p;this._stop(!1,o.easeId),((o=a.e({offset:[0,0],duration:500,easing:a.b7},o)).animate===!1||!o.essential&&S.prefersReducedMotion)&&(o.duration=0);const m=this._getTransformForUpdate(),v=this.getZoom(),E=this.getBearing(),M=this.getPitch(),A=this.getPadding(),F="bearing"in o?this._normalizeBearing(o.bearing,E):E,$="pitch"in o?+o.pitch:M,q="padding"in o?o.padding:m.padding,Y=a.P.convert(o.offset);let de=m.centerPoint.add(Y);const fe=m.pointLocation(de),{center:ve,zoom:se}=m.getConstrained(a.M.convert(o.center||fe),(p=o.zoom)!==null&&p!==void 0?p:v);this._normalizeCenter(ve);const Ee=m.project(fe),$e=m.project(ve).sub(Ee),we=m.zoomScale(se-v);let Le,Ge;o.around&&(Le=a.M.convert(o.around),Ge=m.locationPoint(Le));const Ze={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||se!==v,this._rotating=this._rotating||E!==F,this._pitching=this._pitching||$!==M,this._padding=!m.isPaddingEqual(q),this._easeId=o.easeId,this._prepareEase(h,o.noMoveStart,Ze),this.terrain&&this._prepareElevation(ve),this._ease(Xe=>{if(this._zooming&&(m.zoom=a.z.number(v,se,Xe)),this._rotating&&(m.bearing=a.z.number(E,F,Xe)),this._pitching&&(m.pitch=a.z.number(M,$,Xe)),this._padding&&(m.interpolatePadding(A,q,Xe),de=m.centerPoint.add(Y)),this.terrain&&!o.freezeElevation&&this._updateElevation(Xe),Le)m.setLocationAtPoint(Le,Ge);else{const nt=m.zoomScale(m.zoom-v),rt=se>v?Math.min(2,we):Math.max(.5,we),ft=Math.pow(rt,1-Xe),gt=m.unproject(Ee.add($e.mult(Xe*ft)).mult(nt));m.setLocationAtPoint(m.renderWorldCopies?gt.wrap():gt,de)}this._applyUpdatedTransform(m),this._fireMoveEvents(h)},Xe=>{this.terrain&&this._finalizeElevation(),this._afterEase(h,Xe)},o),this}_prepareEase(o,h,p={}){this._moving=!0,h||p.moving||this.fire(new a.k("movestart",o)),this._zooming&&!p.zooming&&this.fire(new a.k("zoomstart",o)),this._rotating&&!p.rotating&&this.fire(new a.k("rotatestart",o)),this._pitching&&!p.pitching&&this.fire(new a.k("pitchstart",o))}_prepareElevation(o){this._elevationCenter=o,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(o,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(o){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const h=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(o<1&&h!==this._elevationTarget){const p=this._elevationTarget-this._elevationStart;this._elevationStart+=o*(p-(h-(p*o+this._elevationStart))/(1-o)),this._elevationTarget=h}this.transform.elevation=a.z.number(this._elevationStart,this._elevationTarget,o)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(o){if(!this.transformCameraUpdate)return;const h=o.clone(),{center:p,zoom:m,pitch:v,bearing:E,elevation:M}=this.transformCameraUpdate(h);p&&(h.center=p),m!==void 0&&(h.zoom=m),v!==void 0&&(h.pitch=v),E!==void 0&&(h.bearing=E),M!==void 0&&(h.elevation=M),this.transform.apply(h)}_fireMoveEvents(o){this.fire(new a.k("move",o)),this._zooming&&this.fire(new a.k("zoom",o)),this._rotating&&this.fire(new a.k("rotate",o)),this._pitching&&this.fire(new a.k("pitch",o))}_afterEase(o,h){if(this._easeId&&h&&this._easeId===h)return;delete this._easeId;const p=this._zooming,m=this._rotating,v=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,p&&this.fire(new a.k("zoomend",o)),m&&this.fire(new a.k("rotateend",o)),v&&this.fire(new a.k("pitchend",o)),this.fire(new a.k("moveend",o))}flyTo(o,h){var p;if(!o.essential&&S.prefersReducedMotion){const Sr=a.L(o,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Sr,h)}this.stop(),o=a.e({offset:[0,0],speed:1.2,curve:1.42,easing:a.b7},o);const m=this._getTransformForUpdate(),v=this.getZoom(),E=this.getBearing(),M=this.getPitch(),A=this.getPadding(),F="bearing"in o?this._normalizeBearing(o.bearing,E):E,$="pitch"in o?+o.pitch:M,q="padding"in o?o.padding:m.padding,Y=a.P.convert(o.offset);let de=m.centerPoint.add(Y);const fe=m.pointLocation(de),{center:ve,zoom:se}=m.getConstrained(a.M.convert(o.center||fe),(p=o.zoom)!==null&&p!==void 0?p:v);this._normalizeCenter(ve);const Ee=m.zoomScale(se-v),$e=m.project(fe),we=m.project(ve).sub($e);let Le=o.curve;const Ge=Math.max(m.width,m.height),Ze=Ge/Ee,Xe=we.mag();if("minZoom"in o){const Sr=a.ac(Math.min(o.minZoom,v,se),m.minZoom,m.maxZoom),er=Ge/m.zoomScale(Sr-v);Le=Math.sqrt(er/Xe*2)}const nt=Le*Le;function rt(Sr){const er=(Ze*Ze-Ge*Ge+(Sr?-1:1)*nt*nt*Xe*Xe)/(2*(Sr?Ze:Ge)*nt*Xe);return Math.log(Math.sqrt(er*er+1)-er)}function ft(Sr){return(Math.exp(Sr)-Math.exp(-Sr))/2}function gt(Sr){return(Math.exp(Sr)+Math.exp(-Sr))/2}const ar=rt(!1);let yt=function(Sr){return gt(ar)/gt(ar+Le*Sr)},Xt=function(Sr){return Ge*((gt(ar)*(ft(er=ar+Le*Sr)/gt(er))-ft(ar))/nt)/Xe;var er},lr=(rt(!0)-ar)/Le;if(Math.abs(Xe)<1e-6||!isFinite(lr)){if(Math.abs(Ge-Ze)<1e-6)return this.easeTo(o,h);const Sr=Ze<Ge?-1:1;lr=Math.abs(Math.log(Ze/Ge))/Le,Xt=function(){return 0},yt=function(er){return Math.exp(Sr*Le*er)}}return o.duration="duration"in o?+o.duration:1e3*lr/("screenSpeed"in o?+o.screenSpeed/Le:+o.speed),o.maxDuration&&o.duration>o.maxDuration&&(o.duration=0),this._zooming=!0,this._rotating=E!==F,this._pitching=$!==M,this._padding=!m.isPaddingEqual(q),this._prepareEase(h,!1),this.terrain&&this._prepareElevation(ve),this._ease(Sr=>{const er=Sr*lr,hr=1/yt(er);m.zoom=Sr===1?se:v+m.scaleZoom(hr),this._rotating&&(m.bearing=a.z.number(E,F,Sr)),this._pitching&&(m.pitch=a.z.number(M,$,Sr)),this._padding&&(m.interpolatePadding(A,q,Sr),de=m.centerPoint.add(Y)),this.terrain&&!o.freezeElevation&&this._updateElevation(Sr);const pr=Sr===1?ve:m.unproject($e.add(we.mult(Xt(er))).mult(hr));m.setLocationAtPoint(m.renderWorldCopies?pr.wrap():pr,de),this._applyUpdatedTransform(m),this._fireMoveEvents(h)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(h)},o),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(o,h){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const p=this._onEaseEnd;delete this._onEaseEnd,p.call(this,h)}if(!o){const p=this.handlers;p&&p.stop(!1)}return this}_ease(o,h,p){p.animate===!1||p.duration===0?(o(1),h()):(this._easeStart=S.now(),this._easeOptions=p,this._onEaseFrame=o,this._onEaseEnd=h,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(o,h){o=a.b1(o,-180,180);const p=Math.abs(o-h);return Math.abs(o-360-h)<p&&(o-=360),Math.abs(o+360-h)<p&&(o+=360),o}_normalizeCenter(o){const h=this.transform;if(!h.renderWorldCopies||h.lngRange)return;const p=o.lng-h.center.lng;o.lng+=p>180?-360:p<-180?360:0}queryTerrainElevation(o){return this.terrain?this.terrain.getElevationForLngLatZoom(a.M.convert(o),this.transform.tileZoom)-this.transform.elevation:null}}const au={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class lo{constructor(o=au){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=h=>{!h||h.sourceDataType!=="metadata"&&h.sourceDataType!=="visibility"&&h.dataType!=="style"&&h.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=o}getDefaultPosition(){return"bottom-right"}onAdd(o){return this._map=o,this._compact=this.options.compact,this._container=C.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=C.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=C.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){C.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(o,h){const p=this._map._getUIString(`AttributionControl.${h}`);o.title=p,o.setAttribute("aria-label",p)}_updateAttributions(){if(!this._map.style)return;let o=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?o=o.concat(this.options.customAttribution.map(m=>typeof m!="string"?"":m)):typeof this.options.customAttribution=="string"&&o.push(this.options.customAttribution)),this._map.style.stylesheet){const m=this._map.style.stylesheet;this.styleOwner=m.owner,this.styleId=m.id}const h=this._map.style.sourceCaches;for(const m in h){const v=h[m];if(v.used||v.usedForTerrain){const E=v.getSource();E.attribution&&o.indexOf(E.attribution)<0&&o.push(E.attribution)}}o=o.filter(m=>String(m).trim()),o.sort((m,v)=>m.length-v.length),o=o.filter((m,v)=>{for(let E=v+1;E<o.length;E++)if(o[E].indexOf(m)>=0)return!1;return!0});const p=o.join(" | ");p!==this._attribHTML&&(this._attribHTML=p,o.length?(this._innerContainer.innerHTML=p,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class _f{constructor(o={}){this._updateCompact=()=>{const h=this._container.children;if(h.length){const p=h[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&p.classList.add("maplibregl-compact"):p.classList.remove("maplibregl-compact")}},this.options=o}getDefaultPosition(){return"bottom-left"}onAdd(o){this._map=o,this._compact=this.options&&this.options.compact,this._container=C.create("div","maplibregl-ctrl");const h=C.create("a","maplibregl-ctrl-logo");return h.target="_blank",h.rel="noopener nofollow",h.href="https://maplibre.org/",h.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),h.setAttribute("rel","noopener nofollow"),this._container.appendChild(h),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){C.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Va{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(o){const h=++this._id;return this._queue.push({callback:o,id:h,cancelled:!1}),h}remove(o){const h=this._currentlyRunning,p=h?this._queue.concat(h):this._queue;for(const m of p)if(m.id===o)return void(m.cancelled=!0)}run(o=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const h=this._currentlyRunning=this._queue;this._queue=[];for(const p of h)if(!p.cancelled&&(p.callback(o),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var fn=a.X([{name:"a_pos3d",type:"Int16",components:3}]);class En extends a.E{constructor(o){super(),this.sourceCache=o,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,o.usedForTerrain=!0,o.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(o,h){this.sourceCache.update(o,h),this._renderableTilesKeys=[];const p={};for(const m of o.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:h}))p[m.key]=!0,this._renderableTilesKeys.push(m.key),this._tiles[m.key]||(m.posMatrix=new Float64Array(16),a.aN(m.posMatrix,0,a.W,0,a.W,0,1),this._tiles[m.key]=new Xn(m,this.tileSize));for(const m in this._tiles)p[m]||delete this._tiles[m]}freeRtt(o){for(const h in this._tiles){const p=this._tiles[h];(!o||p.tileID.equals(o)||p.tileID.isChildOf(o)||o.isChildOf(p.tileID))&&(p.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(o=>this.getTileByID(o))}getTileByID(o){return this._tiles[o]}getTerrainCoords(o){const h={};for(const p of this._renderableTilesKeys){const m=this._tiles[p].tileID;if(m.canonical.equals(o.canonical)){const v=o.clone();v.posMatrix=new Float64Array(16),a.aN(v.posMatrix,0,a.W,0,a.W,0,1),h[p]=v}else if(m.canonical.isChildOf(o.canonical)){const v=o.clone();v.posMatrix=new Float64Array(16);const E=m.canonical.z-o.canonical.z,M=m.canonical.x-(m.canonical.x>>E<<E),A=m.canonical.y-(m.canonical.y>>E<<E),F=a.W>>E;a.aN(v.posMatrix,0,F,0,F,0,1),a.H(v.posMatrix,v.posMatrix,[-M*F,-A*F,0]),h[p]=v}else if(o.canonical.isChildOf(m.canonical)){const v=o.clone();v.posMatrix=new Float64Array(16);const E=o.canonical.z-m.canonical.z,M=o.canonical.x-(o.canonical.x>>E<<E),A=o.canonical.y-(o.canonical.y>>E<<E),F=a.W>>E;a.aN(v.posMatrix,0,a.W,0,a.W,0,1),a.H(v.posMatrix,v.posMatrix,[M*F,A*F,0]),a.J(v.posMatrix,v.posMatrix,[1/2**E,1/2**E,0]),h[p]=v}}return h}getSourceTile(o,h){const p=this.sourceCache._source;let m=o.overscaledZ-this.deltaZoom;if(m>p.maxzoom&&(m=p.maxzoom),m<p.minzoom)return null;this._sourceTileCache[o.key]||(this._sourceTileCache[o.key]=o.scaledTo(m).key);let v=this.sourceCache.getTileByID(this._sourceTileCache[o.key]);if((!v||!v.dem)&&h)for(;m>=p.minzoom&&(!v||!v.dem);)v=this.sourceCache.getTileByID(o.scaledTo(m--).key);return v}tilesAfterTime(o=Date.now()){return Object.values(this._tiles).filter(h=>h.timeAdded>=o)}}class yf{constructor(o,h,p){this.painter=o,this.sourceCache=new En(h),this.options=p,this.exaggeration=typeof p.exaggeration=="number"?p.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(o,h,p,m=a.W){var v;if(!(h>=0&&h<m&&p>=0&&p<m))return 0;const E=this.getTerrainData(o),M=(v=E.tile)===null||v===void 0?void 0:v.dem;if(!M)return 0;const A=function(fe,ve,se){var Ee=ve[0],$e=ve[1];return fe[0]=se[0]*Ee+se[4]*$e+se[12],fe[1]=se[1]*Ee+se[5]*$e+se[13],fe}([],[h/m*a.W,p/m*a.W],E.u_terrain_matrix),F=[A[0]*M.dim,A[1]*M.dim],$=Math.floor(F[0]),q=Math.floor(F[1]),Y=F[0]-$,de=F[1]-q;return M.get($,q)*(1-Y)*(1-de)+M.get($+1,q)*Y*(1-de)+M.get($,q+1)*(1-Y)*de+M.get($+1,q+1)*Y*de}getElevationForLngLatZoom(o,h){const{tileID:p,mercatorX:m,mercatorY:v}=this._getOverscaledTileIDFromLngLatZoom(o,h);return this.getElevation(p,m%a.W,v%a.W,a.W)}getElevation(o,h,p,m=a.W){return this.getDEMElevation(o,h,p,m)*this.exaggeration}getTerrainData(o){if(!this._emptyDemTexture){const m=this.painter.context,v=new a.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new ne(m,v,m.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new ne(m,new a.R({width:1,height:1}),m.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(m.gl.NEAREST,m.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=a.an([])}const h=this.sourceCache.getSourceTile(o,!0);if(h&&h.dem&&(!h.demTexture||h.needsTerrainPrepare)){const m=this.painter.context;h.demTexture=this.painter.getTileTexture(h.dem.stride),h.demTexture?h.demTexture.update(h.dem.getPixels(),{premultiply:!1}):h.demTexture=new ne(m,h.dem.getPixels(),m.gl.RGBA,{premultiply:!1}),h.demTexture.bind(m.gl.NEAREST,m.gl.CLAMP_TO_EDGE),h.needsTerrainPrepare=!1}const p=h&&h+h.tileID.key+o.key;if(p&&!this._demMatrixCache[p]){const m=this.sourceCache.sourceCache._source.maxzoom;let v=o.canonical.z-h.tileID.canonical.z;o.overscaledZ>o.canonical.z&&(o.canonical.z>=m?v=o.canonical.z-m:a.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const E=o.canonical.x-(o.canonical.x>>v<<v),M=o.canonical.y-(o.canonical.y>>v<<v),A=a.b9(new Float64Array(16),[1/(a.W<<v),1/(a.W<<v),0]);a.H(A,A,[E*a.W,M*a.W,0]),this._demMatrixCache[o.key]={matrix:A,coord:o}}return{u_depth:2,u_terrain:3,u_terrain_dim:h&&h.dem&&h.dem.dim||1,u_terrain_matrix:p?this._demMatrixCache[o.key].matrix:this._emptyDemMatrix,u_terrain_unpack:h&&h.dem&&h.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(h&&h.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:h}}getFramebuffer(o){const h=this.painter,p=h.width/devicePixelRatio,m=h.height/devicePixelRatio;return!this._fbo||this._fbo.width===p&&this._fbo.height===m||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new ne(h.context,{width:p,height:m,data:null},h.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(h.context.gl.NEAREST,h.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new ne(h.context,{width:p,height:m,data:null},h.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(h.context.gl.NEAREST,h.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=h.context.createFramebuffer(p,m,!0,!1),this._fbo.depthAttachment.set(h.context.createRenderbuffer(h.context.gl.DEPTH_COMPONENT16,p,m))),this._fbo.colorAttachment.set(o==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const o=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const h=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let v=0,E=0;v<this._coordsTextureSize;v++)for(let M=0;M<this._coordsTextureSize;M++,E+=4)h[E+0]=255&M,h[E+1]=255&v,h[E+2]=M>>8<<4|v>>8,h[E+3]=0;const p=new a.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(h.buffer)),m=new ne(o,p,o.gl.RGBA,{premultiply:!1});return m.bind(o.gl.NEAREST,o.gl.CLAMP_TO_EDGE),this._coordsTexture=m,m}pointCoordinate(o){this.painter.maybeDrawDepthAndCoords(!0);const h=new Uint8Array(4),p=this.painter.context,m=p.gl,v=Math.round(o.x*this.painter.pixelRatio/devicePixelRatio),E=Math.round(o.y*this.painter.pixelRatio/devicePixelRatio),M=Math.round(this.painter.height/devicePixelRatio);p.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),m.readPixels(v,M-E-1,1,1,m.RGBA,m.UNSIGNED_BYTE,h),p.bindFramebuffer.set(null);const A=h[0]+(h[2]>>4<<8),F=h[1]+((15&h[2])<<8),$=this.coordsIndex[255-h[3]],q=$&&this.sourceCache.getTileByID($);if(!q)return null;const Y=this._coordsTextureSize,de=(1<<q.tileID.canonical.z)*Y;return new a.Y((q.tileID.canonical.x*Y+A)/de+q.tileID.wrap,(q.tileID.canonical.y*Y+F)/de,this.getElevation(q.tileID,A,F,Y))}depthAtPoint(o){const h=new Uint8Array(4),p=this.painter.context,m=p.gl;return p.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),m.readPixels(o.x,this.painter.height/devicePixelRatio-o.y-1,1,1,m.RGBA,m.UNSIGNED_BYTE,h),p.bindFramebuffer.set(null),(h[0]/16777216+h[1]/65536+h[2]/256+h[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const o=this.painter.context,h=new a.ba,p=new a.aX,m=this.meshSize,v=a.W/m,E=m*m;for(let q=0;q<=m;q++)for(let Y=0;Y<=m;Y++)h.emplaceBack(Y*v,q*v,0);for(let q=0;q<E;q+=m+1)for(let Y=0;Y<m;Y++)p.emplaceBack(Y+q,m+Y+q+1,m+Y+q+2),p.emplaceBack(Y+q,m+Y+q+2,Y+q+1);const M=h.length,A=M+2*(m+1);for(const q of[0,1])for(let Y=0;Y<=m;Y++)for(const de of[0,1])h.emplaceBack(Y*v,q*a.W,de);for(let q=0;q<2*m;q+=2)p.emplaceBack(A+q,A+q+1,A+q+3),p.emplaceBack(A+q,A+q+3,A+q+2),p.emplaceBack(M+q,M+q+3,M+q+1),p.emplaceBack(M+q,M+q+2,M+q+3);const F=h.length,$=F+2*(m+1);for(const q of[0,1])for(let Y=0;Y<=m;Y++)for(const de of[0,1])h.emplaceBack(q*a.W,Y*v,de);for(let q=0;q<2*m;q+=2)p.emplaceBack(F+q,F+q+1,F+q+3),p.emplaceBack(F+q,F+q+3,F+q+2),p.emplaceBack($+q,$+q+3,$+q+1),p.emplaceBack($+q,$+q+2,$+q+3);return this._mesh={indexBuffer:o.createIndexBuffer(p),vertexBuffer:o.createVertexBuffer(h,fn.members),segments:a.$.simpleSegment(0,0,h.length,p.length)},this._mesh}getMeshFrameDelta(o){return 2*Math.PI*a.bb/Math.pow(2,o)/5}getMinTileElevationForLngLatZoom(o,h){var p;const{tileID:m}=this._getOverscaledTileIDFromLngLatZoom(o,h);return(p=this.getMinMaxElevation(m).minElevation)!==null&&p!==void 0?p:0}getMinMaxElevation(o){const h=this.getTerrainData(o).tile,p={minElevation:null,maxElevation:null};return h&&h.dem&&(p.minElevation=h.dem.min*this.exaggeration,p.maxElevation=h.dem.max*this.exaggeration),p}_getOverscaledTileIDFromLngLatZoom(o,h){const p=a.Y.fromLngLat(o.wrap()),m=(1<<h)*a.W,v=p.x*m,E=p.y*m,M=Math.floor(v/a.W),A=Math.floor(E/a.W);return{tileID:new a.Q(h,0,h,M,A),mercatorX:v,mercatorY:E}}}class $a{constructor(o,h,p){this._context=o,this._size=h,this._tileSize=p,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const o of this._objects)o.texture.destroy(),o.fbo.destroy()}_createObject(o){const h=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),p=new ne(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return p.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),h.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),h.colorAttachment.set(p.texture),{id:o,fbo:h,texture:p,stamp:-1,inUse:!1}}getObjectForId(o){return this._objects[o]}useObject(o){o.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(h=>o.id!==h),this._recentlyUsed.push(o.id)}stampObject(o){o.stamp=++this._stamp}getOrCreateFreeObject(){for(const h of this._recentlyUsed)if(!this._objects[h].inUse)return this._objects[h];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const o=this._createObject(this._objects.length);return this._objects.push(o),o}freeObject(o){o.inUse=!1}freeAllObjects(){for(const o of this._objects)this.freeObject(o)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(o=>!o.inUse)===!1}}const Oo={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class lu{constructor(o,h){this.painter=o,this.terrain=h,this.pool=new $a(o.context,30,h.sourceCache.tileSize*h.qualityFactor)}destruct(){this.pool.destruct()}getTexture(o){return this.pool.getObjectForId(o.rtt[this._stacks.length-1].id).texture}prepareForRender(o,h){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=o._order.filter(p=>!o._layers[p].isHidden(h)),this._coordsDescendingInv={};for(const p in o.sourceCaches){this._coordsDescendingInv[p]={};const m=o.sourceCaches[p].getVisibleCoordinates();for(const v of m){const E=this.terrain.sourceCache.getTerrainCoords(v);for(const M in E)this._coordsDescendingInv[p][M]||(this._coordsDescendingInv[p][M]=[]),this._coordsDescendingInv[p][M].push(E[M])}}this._coordsDescendingInvStr={};for(const p of o._order){const m=o._layers[p],v=m.source;if(Oo[m.type]&&!this._coordsDescendingInvStr[v]){this._coordsDescendingInvStr[v]={};for(const E in this._coordsDescendingInv[v])this._coordsDescendingInvStr[v][E]=this._coordsDescendingInv[v][E].map(M=>M.key).sort().join()}}for(const p of this._renderableTiles)for(const m in this._coordsDescendingInvStr){const v=this._coordsDescendingInvStr[m][p.tileID.key];v&&v!==p.rttCoords[m]&&(p.rtt=[])}}renderLayer(o){if(o.isHidden(this.painter.transform.zoom))return!1;const h=o.type,p=this.painter,m=this._renderableLayerIds[this._renderableLayerIds.length-1]===o.id;if(Oo[h]&&(this._prevType&&Oo[this._prevType]||this._stacks.push([]),this._prevType=h,this._stacks[this._stacks.length-1].push(o.id),!m))return!0;if(Oo[this._prevType]||Oo[h]&&m){this._prevType=h;const v=this._stacks.length-1,E=this._stacks[v]||[];for(const M of this._renderableTiles){if(this.pool.isFull()&&(zl(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(M),M.rtt[v]){const F=this.pool.getObjectForId(M.rtt[v].id);if(F.stamp===M.rtt[v].stamp){this.pool.useObject(F);continue}}const A=this.pool.getOrCreateFreeObject();this.pool.useObject(A),this.pool.stampObject(A),M.rtt[v]={id:A.id,stamp:A.stamp},p.context.bindFramebuffer.set(A.fbo.framebuffer),p.context.clear({color:a.aO.transparent,stencil:0}),p.currentStencilSource=void 0;for(let F=0;F<E.length;F++){const $=p.style._layers[E[F]],q=$.source?this._coordsDescendingInv[$.source][M.tileID.key]:[M.tileID];p.context.viewport.set([0,0,A.fbo.width,A.fbo.height]),p._renderTileClippingMasks($,q),p.renderLayer(p,p.style.sourceCaches[$.source],$,q),$.source&&(M.rttCoords[$.source]=this._coordsDescendingInvStr[$.source][M.tileID.key])}}return zl(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),Oo[h]}return!1}}const cu={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},uu=_,qa={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:au,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:a.a.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096]},jl=y=>{y.touchstart=y.dragStart,y.touchmoveWindow=y.dragMove,y.touchend=y.dragEnd},hu={showCompass:!0,showZoom:!0,visualizePitch:!1};class fu{constructor(o,h,p=!1){this.mousedown=E=>{this.startMouse(a.e({},E,{ctrlKey:!0,preventDefault:()=>E.preventDefault()}),C.mousePos(this.element,E)),C.addEventListener(window,"mousemove",this.mousemove),C.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=E=>{this.moveMouse(E,C.mousePos(this.element,E))},this.mouseup=E=>{this.mouseRotate.dragEnd(E),this.mousePitch&&this.mousePitch.dragEnd(E),this.offTemp()},this.touchstart=E=>{E.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=C.touchPos(this.element,E.targetTouches)[0],this.startTouch(E,this._startPos),C.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),C.addEventListener(window,"touchend",this.touchend))},this.touchmove=E=>{E.targetTouches.length!==1?this.reset():(this._lastPos=C.touchPos(this.element,E.targetTouches)[0],this.moveTouch(E,this._lastPos))},this.touchend=E=>{E.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const m=o.dragRotate._mouseRotate.getClickTolerance(),v=o.dragRotate._mousePitch.getClickTolerance();this.element=h,this.mouseRotate=Ks({clickTolerance:m,enable:!0}),this.touchRotate=(({enable:E,clickTolerance:M,bearingDegreesPerPixelMoved:A=.8})=>{const F=new At;return new Xs({clickTolerance:M,move:($,q)=>({bearingDelta:(q.x-$.x)*A}),moveStateManager:F,enable:E,assignEvents:jl})})({clickTolerance:m,enable:!0}),this.map=o,p&&(this.mousePitch=Js({clickTolerance:v,enable:!0}),this.touchPitch=(({enable:E,clickTolerance:M,pitchDegreesPerPixelMoved:A=-.5})=>{const F=new At;return new Xs({clickTolerance:M,move:($,q)=>({pitchDelta:(q.y-$.y)*A}),moveStateManager:F,enable:E,assignEvents:jl})})({clickTolerance:v,enable:!0})),C.addEventListener(h,"mousedown",this.mousedown),C.addEventListener(h,"touchstart",this.touchstart,{passive:!1}),C.addEventListener(h,"touchcancel",this.reset)}startMouse(o,h){this.mouseRotate.dragStart(o,h),this.mousePitch&&this.mousePitch.dragStart(o,h),C.disableDrag()}startTouch(o,h){this.touchRotate.dragStart(o,h),this.touchPitch&&this.touchPitch.dragStart(o,h),C.disableDrag()}moveMouse(o,h){const p=this.map,{bearingDelta:m}=this.mouseRotate.dragMove(o,h)||{};if(m&&p.setBearing(p.getBearing()+m),this.mousePitch){const{pitchDelta:v}=this.mousePitch.dragMove(o,h)||{};v&&p.setPitch(p.getPitch()+v)}}moveTouch(o,h){const p=this.map,{bearingDelta:m}=this.touchRotate.dragMove(o,h)||{};if(m&&p.setBearing(p.getBearing()+m),this.touchPitch){const{pitchDelta:v}=this.touchPitch.dragMove(o,h)||{};v&&p.setPitch(p.getPitch()+v)}}off(){const o=this.element;C.removeEventListener(o,"mousedown",this.mousedown),C.removeEventListener(o,"touchstart",this.touchstart,{passive:!1}),C.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),C.removeEventListener(window,"touchend",this.touchend),C.removeEventListener(o,"touchcancel",this.reset),this.offTemp()}offTemp(){C.enableDrag(),C.removeEventListener(window,"mousemove",this.mousemove),C.removeEventListener(window,"mouseup",this.mouseup),C.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),C.removeEventListener(window,"touchend",this.touchend)}}let No;function Ul(y,o,h){const p=new a.M(y.lng,y.lat);if(y=new a.M(y.lng,y.lat),o){const m=new a.M(y.lng-360,y.lat),v=new a.M(y.lng+360,y.lat),E=h.locationPoint(y).distSqr(o);h.locationPoint(m).distSqr(o)<E?y=m:h.locationPoint(v).distSqr(o)<E&&(y=v)}for(;Math.abs(y.lng-h.center.lng)>180;){const m=h.locationPoint(y);if(m.x>=0&&m.y>=0&&m.x<=h.width&&m.y<=h.height)break;y.lng>h.center.lng?y.lng-=360:y.lng+=360}return y.lng!==p.lng&&h.locationPoint(y).y>h.height/2-h.getHorizon()?y:p}const Ga={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Vl(y,o,h){const p=y.classList;for(const m in Ga)p.remove(`maplibregl-${h}-anchor-${m}`);p.add(`maplibregl-${h}-anchor-${o}`)}class Wa extends a.E{constructor(o){if(super(),this._onKeyPress=h=>{const p=h.code,m=h.charCode||h.keyCode;p!=="Space"&&p!=="Enter"&&m!==32&&m!==13||this.togglePopup()},this._onMapClick=h=>{const p=h.originalEvent.target,m=this._element;this._popup&&(p===m||m.contains(p))&&this.togglePopup()},this._update=h=>{var p;if(!this._map)return;const m=this._map.loaded()&&!this._map.isMoving();((h==null?void 0:h.type)==="terrain"||(h==null?void 0:h.type)==="render"&&!m)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?Ul(this._lngLat,this._flatPos,this._map.transform):(p=this._lngLat)===null||p===void 0?void 0:p.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let v="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?v=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(v=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let E="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?E="rotateX(0deg)":this._pitchAlignment==="map"&&(E=`rotateX(${this._map.getPitch()}deg)`),h&&h.type!=="moveend"||(this._pos=this._pos.round()),C.setTransform(this._element,`${Ga[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${E} ${v}`),S.frameAsync(new AbortController).then(()=>{this._updateOpacity(h&&h.type==="moveend")}).catch(()=>{})},this._onMove=h=>{if(!this._isDragging){const p=this._clickTolerance||this._map._clickTolerance;this._isDragging=h.point.dist(this._pointerdownPos)>=p}this._isDragging&&(this._pos=h.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new a.k("dragstart"))),this.fire(new a.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new a.k("dragend")),this._state="inactive"},this._addDragHandler=h=>{this._element.contains(h.originalEvent.target)&&(h.preventDefault(),this._positionDelta=h.point.sub(this._pos).add(this._offset),this._pointerdownPos=h.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=o&&o.anchor||"center",this._color=o&&o.color||"#3FB1CE",this._scale=o&&o.scale||1,this._draggable=o&&o.draggable||!1,this._clickTolerance=o&&o.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=o&&o.rotation||0,this._rotationAlignment=o&&o.rotationAlignment||"auto",this._pitchAlignment=o&&o.pitchAlignment&&o.pitchAlignment!=="auto"?o.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(o==null?void 0:o.opacity,o==null?void 0:o.opacityWhenCovered),o&&o.element)this._element=o.element,this._offset=a.P.convert(o&&o.offset||[0,0]);else{this._defaultMarker=!0,this._element=C.create("div"),this._element.setAttribute("aria-label","Map marker");const h=C.createNS("http://www.w3.org/2000/svg","svg"),p=41,m=27;h.setAttributeNS(null,"display","block"),h.setAttributeNS(null,"height",`${p}px`),h.setAttributeNS(null,"width",`${m}px`),h.setAttributeNS(null,"viewBox",`0 0 ${m} ${p}`);const v=C.createNS("http://www.w3.org/2000/svg","g");v.setAttributeNS(null,"stroke","none"),v.setAttributeNS(null,"stroke-width","1"),v.setAttributeNS(null,"fill","none"),v.setAttributeNS(null,"fill-rule","evenodd");const E=C.createNS("http://www.w3.org/2000/svg","g");E.setAttributeNS(null,"fill-rule","nonzero");const M=C.createNS("http://www.w3.org/2000/svg","g");M.setAttributeNS(null,"transform","translate(3.0, 29.0)"),M.setAttributeNS(null,"fill","#000000");const A=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const Ee of A){const $e=C.createNS("http://www.w3.org/2000/svg","ellipse");$e.setAttributeNS(null,"opacity","0.04"),$e.setAttributeNS(null,"cx","10.5"),$e.setAttributeNS(null,"cy","5.80029008"),$e.setAttributeNS(null,"rx",Ee.rx),$e.setAttributeNS(null,"ry",Ee.ry),M.appendChild($e)}const F=C.createNS("http://www.w3.org/2000/svg","g");F.setAttributeNS(null,"fill",this._color);const $=C.createNS("http://www.w3.org/2000/svg","path");$.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),F.appendChild($);const q=C.createNS("http://www.w3.org/2000/svg","g");q.setAttributeNS(null,"opacity","0.25"),q.setAttributeNS(null,"fill","#000000");const Y=C.createNS("http://www.w3.org/2000/svg","path");Y.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),q.appendChild(Y);const de=C.createNS("http://www.w3.org/2000/svg","g");de.setAttributeNS(null,"transform","translate(6.0, 7.0)"),de.setAttributeNS(null,"fill","#FFFFFF");const fe=C.createNS("http://www.w3.org/2000/svg","g");fe.setAttributeNS(null,"transform","translate(8.0, 8.0)");const ve=C.createNS("http://www.w3.org/2000/svg","circle");ve.setAttributeNS(null,"fill","#000000"),ve.setAttributeNS(null,"opacity","0.25"),ve.setAttributeNS(null,"cx","5.5"),ve.setAttributeNS(null,"cy","5.5"),ve.setAttributeNS(null,"r","5.4999962");const se=C.createNS("http://www.w3.org/2000/svg","circle");se.setAttributeNS(null,"fill","#FFFFFF"),se.setAttributeNS(null,"cx","5.5"),se.setAttributeNS(null,"cy","5.5"),se.setAttributeNS(null,"r","5.4999962"),fe.appendChild(ve),fe.appendChild(se),E.appendChild(M),E.appendChild(F),E.appendChild(q),E.appendChild(de),E.appendChild(fe),h.appendChild(E),h.setAttributeNS(null,"height",p*this._scale+"px"),h.setAttributeNS(null,"width",m*this._scale+"px"),this._element.appendChild(h),this._offset=a.P.convert(o&&o.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",h=>{h.preventDefault()}),this._element.addEventListener("mousedown",h=>{h.preventDefault()}),Vl(this._element,this._anchor,"marker"),o&&o.className)for(const h of o.className.split(" "))this._element.classList.add(h);this._popup=null}addTo(o){return this.remove(),this._map=o,o.getCanvasContainer().appendChild(this._element),o.on("move",this._update),o.on("moveend",this._update),o.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),C.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(o){return this._lngLat=a.M.convert(o),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(o){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),o){if(!("offset"in o.options)){const m=Math.abs(13.5)/Math.SQRT2;o.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[m,-1*(38.1-13.5+m)],"bottom-right":[-m,-1*(38.1-13.5+m)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=o,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){const o=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:o?(o.isOpen()?o.remove():(o.setLngLat(this._lngLat),o.addTo(this._map)),this):this}_updateOpacity(o=!1){var h,p;if(!(!((h=this._map)===null||h===void 0)&&h.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(o)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const m=this._map,v=m.terrain.depthAtPoint(this._pos),E=m.terrain.getElevationForLngLatZoom(this._lngLat,m.transform.tileZoom);if(m.transform.lngLatToCameraDepth(this._lngLat,E)-v<.006)return void(this._element.style.opacity=this._opacity);const M=-this._offset.y/m.transform._pixelPerMeter,A=Math.sin(m.getPitch()*Math.PI/180)*M,F=m.terrain.depthAtPoint(new a.P(this._pos.x,this._pos.y-this._offset.y)),$=m.transform.lngLatToCameraDepth(this._lngLat,E+A)-F>.006;!((p=this._popup)===null||p===void 0)&&p.isOpen()&&$&&this._popup.remove(),this._element.style.opacity=$?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(o){return this._offset=a.P.convert(o),this._update(),this}addClassName(o){this._element.classList.add(o)}removeClassName(o){this._element.classList.remove(o)}toggleClassName(o){return this._element.classList.toggle(o)}setDraggable(o){return this._draggable=!!o,this._map&&(o?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(o){return this._rotation=o||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(o){return this._rotationAlignment=o||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(o){return this._pitchAlignment=o&&o!=="auto"?o:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(o,h){return o===void 0&&h===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),o!==void 0&&(this._opacity=o),h!==void 0&&(this._opacityWhenCovered=h),this._map&&this._updateOpacity(!0),this}}const $l={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Qs=0,ws=!1;const ql={maxWidth:100,unit:"metric"};function Gl(y,o,h){const p=h&&h.maxWidth||100,m=y._container.clientHeight/2,v=y.unproject([0,m]),E=y.unproject([p,m]),M=v.distanceTo(E);if(h&&h.unit==="imperial"){const A=3.2808*M;A>5280?xs(o,p,A/5280,y._getUIString("ScaleControl.Miles")):xs(o,p,A,y._getUIString("ScaleControl.Feet"))}else h&&h.unit==="nautical"?xs(o,p,M/1852,y._getUIString("ScaleControl.NauticalMiles")):M>=1e3?xs(o,p,M/1e3,y._getUIString("ScaleControl.Kilometers")):xs(o,p,M,y._getUIString("ScaleControl.Meters"))}function xs(y,o,h,p){const m=function(v){const E=Math.pow(10,`${Math.floor(v)}`.length-1);let M=v/E;return M=M>=10?10:M>=5?5:M>=3?3:M>=2?2:M>=1?1:function(A){const F=Math.pow(10,Math.ceil(-Math.log(A)/Math.LN10));return Math.round(A*F)/F}(M),E*M}(h);y.style.width=o*(m/h)+"px",y.innerHTML=`${m}&nbsp;${p}`}const du={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},pu=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Wl(y){if(y){if(typeof y=="number"){const o=Math.round(Math.abs(y)/Math.SQRT2);return{center:new a.P(0,0),top:new a.P(0,y),"top-left":new a.P(o,o),"top-right":new a.P(-o,o),bottom:new a.P(0,-y),"bottom-left":new a.P(o,-o),"bottom-right":new a.P(-o,-o),left:new a.P(y,0),right:new a.P(-y,0)}}if(y instanceof a.P||Array.isArray(y)){const o=a.P.convert(y);return{center:o,top:o,"top-left":o,"top-right":o,bottom:o,"bottom-left":o,"bottom-right":o,left:o,right:o}}return{center:a.P.convert(y.center||[0,0]),top:a.P.convert(y.top||[0,0]),"top-left":a.P.convert(y["top-left"]||[0,0]),"top-right":a.P.convert(y["top-right"]||[0,0]),bottom:a.P.convert(y.bottom||[0,0]),"bottom-left":a.P.convert(y["bottom-left"]||[0,0]),"bottom-right":a.P.convert(y["bottom-right"]||[0,0]),left:a.P.convert(y.left||[0,0]),right:a.P.convert(y.right||[0,0])}}return Wl(new a.P(0,0))}const vf=_;f.AJAXError=a.be,f.Evented=a.E,f.LngLat=a.M,f.MercatorCoordinate=a.Y,f.Point=a.P,f.addProtocol=a.bf,f.config=a.a,f.removeProtocol=a.bg,f.AttributionControl=lo,f.BoxZoomHandler=so,f.CanvasSource=Sn,f.CooperativeGesturesHandler=Nt,f.DoubleClickZoomHandler=ou,f.DragPanHandler=gf,f.DragRotateHandler=ao,f.EdgeInsets=Zs,f.FullscreenControl=class extends a.E{constructor(y={}){super(),this._onFullscreenChange=()=>{var o;let h=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((o=h==null?void 0:h.shadowRoot)===null||o===void 0)&&o.fullscreenElement;)h=h.shadowRoot.fullscreenElement;h===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,y&&y.container&&(y.container instanceof HTMLElement?this._container=y.container:a.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(y){return this._map=y,this._container||(this._container=this._map.getContainer()),this._controlContainer=C.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){C.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const y=this._fullscreenButton=C.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);C.create("span","maplibregl-ctrl-icon",y).setAttribute("aria-hidden","true"),y.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const y=this._getTitle();this._fullscreenButton.setAttribute("aria-label",y),this._fullscreenButton.title=y}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new a.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new a.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},f.GeoJSONSource=Ne,f.GeolocateControl=class extends a.E{constructor(y){super(),this._onSuccess=o=>{if(this._map){if(this._isOutOfMapMaxBounds(o))return this._setErrorState(),this.fire(new a.k("outofmaxbounds",o)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=o,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(o),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(o),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new a.k("geolocate",o)),this._finish()}},this._updateCamera=o=>{const h=new a.M(o.coords.longitude,o.coords.latitude),p=o.coords.accuracy,m=this._map.getBearing(),v=a.e({bearing:m},this.options.fitBoundsOptions),E=ut.fromLngLat(h,p);this._map.fitBounds(E,v,{geolocateSource:!0})},this._updateMarker=o=>{if(o){const h=new a.M(o.coords.longitude,o.coords.latitude);this._accuracyCircleMarker.setLngLat(h).addTo(this._map),this._userLocationDotMarker.setLngLat(h).addTo(this._map),this._accuracy=o.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=o=>{if(this._map){if(this.options.trackUserLocation)if(o.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const h=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(o.code===3&&ws)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new a.k("error",o)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=o=>{if(this._map){if(this._container.addEventListener("contextmenu",h=>h.preventDefault()),this._geolocateButton=C.create("button","maplibregl-ctrl-geolocate",this._container),C.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",o===!1){a.w("Geolocation support is not available so the GeolocateControl will be disabled.");const h=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h)}else{const h=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=C.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Wa({element:this._dotElement}),this._circleElement=C.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Wa({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",h=>{h.geolocateSource||this._watchState!=="ACTIVE_LOCK"||h.originalEvent&&h.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new a.k("trackuserlocationend")))})}},this.options=a.e({},$l,y)}onAdd(y){return this._map=y,this._container=C.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(){return a._(this,arguments,void 0,function*(o=!1){if(No!==void 0&&!o)return No;if(window.navigator.permissions===void 0)return No=!!window.navigator.geolocation,No;try{No=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{No=!!window.navigator.geolocation}return No})}().then(o=>this._setupUI(o)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),C.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Qs=0,ws=!1}_isOutOfMapMaxBounds(y){const o=this._map.getMaxBounds(),h=y.coords;return o&&(h.longitude<o.getWest()||h.longitude>o.getEast()||h.latitude<o.getSouth()||h.latitude>o.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const y=this._map.getBounds(),o=y.getSouthEast(),h=y.getNorthEast(),p=o.distanceTo(h),m=Math.ceil(this._accuracy/(p/this._map._container.clientHeight)*2);this._circleElement.style.width=`${m}px`,this._circleElement.style.height=`${m}px`}trigger(){if(!this._setup)return a.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new a.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Qs--,ws=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new a.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new a.k("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let y;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Qs++,Qs>1?(y={maximumAge:6e5,timeout:0},ws=!0):(y=this.options.positionOptions,ws=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,y)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},f.Hash=tu,f.ImageSource=wt,f.KeyboardHandler=ts,f.LngLatBounds=ut,f.LogoControl=_f,f.Map=class extends Ti{constructor(y){if(a.bc.mark(a.bd.create),(y=a.e({},qa,y)).minZoom!=null&&y.maxZoom!=null&&y.minZoom>y.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(y.minPitch!=null&&y.maxPitch!=null&&y.minPitch>y.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(y.minPitch!=null&&y.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(y.maxPitch!=null&&y.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new Dl(y.minZoom,y.maxZoom,y.minPitch,y.maxPitch,y.renderWorldCopies),{bearingSnap:y.bearingSnap}),this._contextLost=o=>{o.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new a.k("webglcontextlost",{originalEvent:o}))},this._contextRestored=o=>{this._setupPainter(),this.resize(),this._update(),this.fire(new a.k("webglcontextrestored",{originalEvent:o}))},this._onMapScroll=o=>{if(o.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=y.interactive,this._maxTileCacheSize=y.maxTileCacheSize,this._maxTileCacheZoomLevels=y.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=y.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=y.preserveDrawingBuffer,this._antialias=y.antialias,this._trackResize=y.trackResize,this._bearingSnap=y.bearingSnap,this._refreshExpiredTiles=y.refreshExpiredTiles,this._fadeDuration=y.fadeDuration,this._crossSourceCollisions=y.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=y.collectResourceTiming,this._renderTaskQueue=new Va,this._controls=[],this._mapId=a.a3(),this._locale=a.e({},cu,y.locale),this._clickTolerance=y.clickTolerance,this._overridePixelRatio=y.pixelRatio,this._maxCanvasSize=y.maxCanvasSize,this.transformCameraUpdate=y.transformCameraUpdate,this._imageQueueHandle=V.addThrottleControl(()=>this.isMoving()),this._requestManager=new U(y.transformRequest),typeof y.container=="string"){if(this._container=document.getElementById(y.container),!this._container)throw new Error(`Container '${y.container}' not found.`)}else{if(!(y.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=y.container}if(y.maxBounds&&this.setMaxBounds(y.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let o=!1;const h=eu(p=>{this._trackResize&&!this._removed&&this.resize(p)._update()},50);this._resizeObserver=new ResizeObserver(p=>{o?h(p):o=!0}),this._resizeObserver.observe(this._container)}this.handlers=new su(this,y),this._hash=y.hash&&new tu(typeof y.hash=="string"&&y.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:y.center,zoom:y.zoom,bearing:y.bearing,pitch:y.pitch}),y.bounds&&(this.resize(),this.fitBounds(y.bounds,a.e({},y.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=y.localIdeographFontFamily,this._validateStyle=y.validateStyle,y.style&&this.setStyle(y.style,{localIdeographFontFamily:y.localIdeographFontFamily}),y.attributionControl&&this.addControl(new lo(typeof y.attributionControl=="boolean"?void 0:y.attributionControl)),y.maplibreLogo&&this.addControl(new _f,y.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",o=>{this._update(o.dataType==="style"),this.fire(new a.k(`${o.dataType}data`,o))}),this.on("dataloading",o=>{this.fire(new a.k(`${o.dataType}dataloading`,o))}),this.on("dataabort",o=>{this.fire(new a.k("sourcedataabort",o))})}_getMapId(){return this._mapId}addControl(y,o){if(o===void 0&&(o=y.getDefaultPosition?y.getDefaultPosition():"top-right"),!y||!y.onAdd)return this.fire(new a.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const h=y.onAdd(this);this._controls.push(y);const p=this._controlPositions[o];return o.indexOf("bottom")!==-1?p.insertBefore(h,p.firstChild):p.appendChild(h),this}removeControl(y){if(!y||!y.onRemove)return this.fire(new a.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const o=this._controls.indexOf(y);return o>-1&&this._controls.splice(o,1),y.onRemove(this),this}hasControl(y){return this._controls.indexOf(y)>-1}calculateCameraOptionsFromTo(y,o,h,p){return p==null&&this.terrain&&(p=this.terrain.getElevationForLngLatZoom(h,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(y,o,h,p)}resize(y){var o;const h=this._containerDimensions(),p=h[0],m=h[1],v=this._getClampedPixelRatio(p,m);if(this._resizeCanvas(p,m,v),this.painter.resize(p,m,v),this.painter.overLimit()){const M=this.painter.context.gl;this._maxCanvasSize=[M.drawingBufferWidth,M.drawingBufferHeight];const A=this._getClampedPixelRatio(p,m);this._resizeCanvas(p,m,A),this.painter.resize(p,m,A)}this.transform.resize(p,m),(o=this._requestedCameraState)===null||o===void 0||o.resize(p,m);const E=!this._moving;return E&&(this.stop(),this.fire(new a.k("movestart",y)).fire(new a.k("move",y))),this.fire(new a.k("resize",y)),E&&this.fire(new a.k("moveend",y)),this}_getClampedPixelRatio(y,o){const{0:h,1:p}=this._maxCanvasSize,m=this.getPixelRatio(),v=y*m,E=o*m;return Math.min(v>h?h/v:1,E>p?p/E:1)*m}getPixelRatio(){var y;return(y=this._overridePixelRatio)!==null&&y!==void 0?y:devicePixelRatio}setPixelRatio(y){this._overridePixelRatio=y,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(y){return this.transform.setMaxBounds(ut.convert(y)),this._update()}setMinZoom(y){if((y=y??-2)>=-2&&y<=this.transform.maxZoom)return this.transform.minZoom=y,this._update(),this.getZoom()<y&&this.setZoom(y),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(y){if((y=y??22)>=this.transform.minZoom)return this.transform.maxZoom=y,this._update(),this.getZoom()>y&&this.setZoom(y),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(y){if((y=y??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(y>=0&&y<=this.transform.maxPitch)return this.transform.minPitch=y,this._update(),this.getPitch()<y&&this.setPitch(y),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(y){if((y=y??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(y>=this.transform.minPitch)return this.transform.maxPitch=y,this._update(),this.getPitch()>y&&this.setPitch(y),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(y){return this.transform.renderWorldCopies=y,this._update()}project(y){return this.transform.locationPoint(a.M.convert(y),this.style&&this.terrain)}unproject(y){return this.transform.pointLocation(a.P.convert(y),this.terrain)}isMoving(){var y;return this._moving||((y=this.handlers)===null||y===void 0?void 0:y.isMoving())}isZooming(){var y;return this._zooming||((y=this.handlers)===null||y===void 0?void 0:y.isZooming())}isRotating(){var y;return this._rotating||((y=this.handlers)===null||y===void 0?void 0:y.isRotating())}_createDelegatedListener(y,o,h){if(y==="mouseenter"||y==="mouseover"){let p=!1;return{layer:o,listener:h,delegates:{mousemove:v=>{const E=this.getLayer(o)?this.queryRenderedFeatures(v.point,{layers:[o]}):[];E.length?p||(p=!0,h.call(this,new ki(y,this,v.originalEvent,{features:E}))):p=!1},mouseout:()=>{p=!1}}}}if(y==="mouseleave"||y==="mouseout"){let p=!1;return{layer:o,listener:h,delegates:{mousemove:E=>{(this.getLayer(o)?this.queryRenderedFeatures(E.point,{layers:[o]}):[]).length?p=!0:p&&(p=!1,h.call(this,new ki(y,this,E.originalEvent)))},mouseout:E=>{p&&(p=!1,h.call(this,new ki(y,this,E.originalEvent)))}}}}{const p=m=>{const v=this.getLayer(o)?this.queryRenderedFeatures(m.point,{layers:[o]}):[];v.length&&(m.features=v,h.call(this,m),delete m.features)};return{layer:o,listener:h,delegates:{[y]:p}}}}on(y,o,h){if(h===void 0)return super.on(y,o);const p=this._createDelegatedListener(y,o,h);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[y]=this._delegatedListeners[y]||[],this._delegatedListeners[y].push(p);for(const m in p.delegates)this.on(m,p.delegates[m]);return this}once(y,o,h){if(h===void 0)return super.once(y,o);const p=this._createDelegatedListener(y,o,h);for(const m in p.delegates)this.once(m,p.delegates[m]);return this}off(y,o,h){return h===void 0?super.off(y,o):(this._delegatedListeners&&this._delegatedListeners[y]&&(p=>{const m=this._delegatedListeners[y];for(let v=0;v<m.length;v++){const E=m[v];if(E.layer===o&&E.listener===h){for(const M in E.delegates)this.off(M,E.delegates[M]);return m.splice(v,1),this}}})(),this)}queryRenderedFeatures(y,o){if(!this.style)return[];let h;const p=y instanceof a.P||Array.isArray(y),m=p?y:[[0,0],[this.transform.width,this.transform.height]];if(o=o||(p?{}:y)||{},m instanceof a.P||typeof m[0]=="number")h=[a.P.convert(m)];else{const v=a.P.convert(m[0]),E=a.P.convert(m[1]);h=[v,new a.P(E.x,v.y),E,new a.P(v.x,E.y),v]}return this.style.queryRenderedFeatures(h,o,this.transform)}querySourceFeatures(y,o){return this.style.querySourceFeatures(y,o)}setStyle(y,o){return(o=a.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},o)).diff!==!1&&o.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&y?(this._diffStyle(y,o),this):(this._localIdeographFontFamily=o.localIdeographFontFamily,this._updateStyle(y,o))}setTransformRequest(y){return this._requestManager.setTransformRequest(y),this}_getUIString(y){const o=this._locale[y];if(o==null)throw new Error(`Missing UI string '${y}'`);return o}_updateStyle(y,o){if(o.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(y,o));const h=this.style&&o.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!y)),y?(this.style=new Bi(this,o||{}),this.style.setEventedParent(this,{style:this.style}),typeof y=="string"?this.style.loadURL(y,o,h):this.style.loadJSON(y,o,h),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Bi(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(y,o){if(typeof y=="string"){const h=this._requestManager.transformRequest(y,"Style");a.h(h,new AbortController).then(p=>{this._updateDiff(p.data,o)}).catch(p=>{p&&this.fire(new a.j(p))})}else typeof y=="object"&&this._updateDiff(y,o)}_updateDiff(y,o){try{this.style.setState(y,o)&&this._update(!0)}catch(h){a.w(`Unable to perform style diff: ${h.message||h.error||h}.  Rebuilding the style from scratch.`),this._updateStyle(y,o)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():a.w("There is no style added to the map.")}addSource(y,o){return this._lazyInitEmptyStyle(),this.style.addSource(y,o),this._update(!0)}isSourceLoaded(y){const o=this.style&&this.style.sourceCaches[y];if(o!==void 0)return o.loaded();this.fire(new a.j(new Error(`There is no source with ID '${y}'`)))}setTerrain(y){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),y){const o=this.style.sourceCaches[y.source];if(!o)throw new Error(`cannot load terrain, because there exists no source with ID: ${y.source}`);this.terrain===null&&o.reload();for(const h in this.style._layers){const p=this.style._layers[h];p.type==="hillshade"&&p.source===y.source&&a.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new yf(this.painter,o,y),this.painter.renderToTexture=new lu(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=h=>{h.dataType==="style"?this.terrain.sourceCache.freeRtt():h.dataType==="source"&&h.tile&&(h.sourceId!==y.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(h.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new a.k("terrain",{terrain:y})),this}getTerrain(){var y,o;return(o=(y=this.terrain)===null||y===void 0?void 0:y.options)!==null&&o!==void 0?o:null}areTilesLoaded(){const y=this.style&&this.style.sourceCaches;for(const o in y){const h=y[o]._tiles;for(const p in h){const m=h[p];if(m.state!=="loaded"&&m.state!=="errored")return!1}}return!0}removeSource(y){return this.style.removeSource(y),this._update(!0)}getSource(y){return this.style.getSource(y)}addImage(y,o,h={}){const{pixelRatio:p=1,sdf:m=!1,stretchX:v,stretchY:E,content:M}=h;if(this._lazyInitEmptyStyle(),!(o instanceof HTMLImageElement||a.b(o))){if(o.width===void 0||o.height===void 0)return this.fire(new a.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:A,height:F,data:$}=o,q=o;return this.style.addImage(y,{data:new a.R({width:A,height:F},new Uint8Array($)),pixelRatio:p,stretchX:v,stretchY:E,content:M,sdf:m,version:0,userImage:q}),q.onAdd&&q.onAdd(this,y),this}}{const{width:A,height:F,data:$}=S.getImageData(o);this.style.addImage(y,{data:new a.R({width:A,height:F},$),pixelRatio:p,stretchX:v,stretchY:E,content:M,sdf:m,version:0})}}updateImage(y,o){const h=this.style.getImage(y);if(!h)return this.fire(new a.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const p=o instanceof HTMLImageElement||a.b(o)?S.getImageData(o):o,{width:m,height:v,data:E}=p;if(m===void 0||v===void 0)return this.fire(new a.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(m!==h.data.width||v!==h.data.height)return this.fire(new a.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const M=!(o instanceof HTMLImageElement||a.b(o));return h.data.replace(E,M),this.style.updateImage(y,h),this}getImage(y){return this.style.getImage(y)}hasImage(y){return y?!!this.style.getImage(y):(this.fire(new a.j(new Error("Missing required image id"))),!1)}removeImage(y){this.style.removeImage(y)}loadImage(y){return V.getImage(this._requestManager.transformRequest(y,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(y,o){return this._lazyInitEmptyStyle(),this.style.addLayer(y,o),this._update(!0)}moveLayer(y,o){return this.style.moveLayer(y,o),this._update(!0)}removeLayer(y){return this.style.removeLayer(y),this._update(!0)}getLayer(y){return this.style.getLayer(y)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(y,o,h){return this.style.setLayerZoomRange(y,o,h),this._update(!0)}setFilter(y,o,h={}){return this.style.setFilter(y,o,h),this._update(!0)}getFilter(y){return this.style.getFilter(y)}setPaintProperty(y,o,h,p={}){return this.style.setPaintProperty(y,o,h,p),this._update(!0)}getPaintProperty(y,o){return this.style.getPaintProperty(y,o)}setLayoutProperty(y,o,h,p={}){return this.style.setLayoutProperty(y,o,h,p),this._update(!0)}getLayoutProperty(y,o){return this.style.getLayoutProperty(y,o)}setGlyphs(y,o={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(y,o),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(y,o,h={}){return this._lazyInitEmptyStyle(),this.style.addSprite(y,o,h,p=>{p||this._update(!0)}),this}removeSprite(y){return this._lazyInitEmptyStyle(),this.style.removeSprite(y),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(y,o={}){return this._lazyInitEmptyStyle(),this.style.setSprite(y,o,h=>{h||this._update(!0)}),this}setLight(y,o={}){return this._lazyInitEmptyStyle(),this.style.setLight(y,o),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(y,o){return this.style.setFeatureState(y,o),this._update()}removeFeatureState(y,o){return this.style.removeFeatureState(y,o),this._update()}getFeatureState(y){return this.style.getFeatureState(y)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let y=0,o=0;return this._container&&(y=this._container.clientWidth||400,o=this._container.clientHeight||300),[y,o]}_setupContainer(){const y=this._container;y.classList.add("maplibregl-map");const o=this._canvasContainer=C.create("div","maplibregl-canvas-container",y);this._interactive&&o.classList.add("maplibregl-interactive"),this._canvas=C.create("canvas","maplibregl-canvas",o),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const h=this._containerDimensions(),p=this._getClampedPixelRatio(h[0],h[1]);this._resizeCanvas(h[0],h[1],p);const m=this._controlContainer=C.create("div","maplibregl-control-container",y),v=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(E=>{v[E]=C.create("div",`maplibregl-ctrl-${E} `,m)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(y,o,h){this._canvas.width=Math.floor(h*y),this._canvas.height=Math.floor(h*o),this._canvas.style.width=`${y}px`,this._canvas.style.height=`${o}px`}_setupPainter(){const y={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let o=null;this._canvas.addEventListener("webglcontextcreationerror",p=>{o={requestedAttributes:y},p&&(o.statusMessage=p.statusMessage,o.type=p.type)},{once:!0});const h=this._canvas.getContext("webgl2",y)||this._canvas.getContext("webgl",y);if(!h){const p="Failed to initialize WebGL";throw o?(o.message=p,new Error(JSON.stringify(o))):new Error(p)}this.painter=new of(h,this.transform),z.testSupport(h)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(y){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||y,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(y){return this._update(),this._renderTaskQueue.add(y)}_cancelRenderFrame(y){this._renderTaskQueue.remove(y)}_render(y){const o=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(y),this._removed)return;let h=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const m=this.transform.zoom,v=S.now();this.style.zoomHistory.update(m,v);const E=new a.a8(m,{now:v,fadeDuration:o,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),M=E.crossFadingFactor();M===1&&M===this._crossFadingFactor||(h=!0,this._crossFadingFactor=M),this.style.update(E)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,o,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:o,showPadding:this.showPadding}),this.fire(new a.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,a.bc.mark(a.bd.load),this.fire(new a.k("load"))),this.style&&(this.style.hasTransitions()||h)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const p=this._sourcesDirty||this._styleDirty||this._placementDirty;return p||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new a.k("idle")),!this._loaded||this._fullyLoaded||p||(this._fullyLoaded=!0,a.bc.mark(a.bd.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var y;this._hash&&this._hash.remove();for(const h of this._controls)h.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),V.removeThrottleControl(this._imageQueueHandle),(y=this._resizeObserver)===null||y===void 0||y.disconnect();const o=this.painter.context.gl.getExtension("WEBGL_lose_context");o&&o.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),C.remove(this._canvasContainer),C.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),a.bc.clearMetrics(),this._removed=!0,this.fire(new a.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,S.frameAsync(this._frameRequest).then(y=>{a.bc.frame(y),this._frameRequest=null,this._render(y)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(y){this._showTileBoundaries!==y&&(this._showTileBoundaries=y,this._update())}get showPadding(){return!!this._showPadding}set showPadding(y){this._showPadding!==y&&(this._showPadding=y,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(y){this._showCollisionBoxes!==y&&(this._showCollisionBoxes=y,y?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(y){this._showOverdrawInspector!==y&&(this._showOverdrawInspector=y,this._update())}get repaint(){return!!this._repaint}set repaint(y){this._repaint!==y&&(this._repaint=y,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(y){this._vertices=y,this._update()}get version(){return uu}getCameraTargetElevation(){return this.transform.elevation}},f.MapMouseEvent=ki,f.MapTouchEvent=vo,f.MapWheelEvent=ru,f.Marker=Wa,f.NavigationControl=class{constructor(y){this._updateZoomButtons=()=>{const o=this._map.getZoom(),h=o===this._map.getMaxZoom(),p=o===this._map.getMinZoom();this._zoomInButton.disabled=h,this._zoomOutButton.disabled=p,this._zoomInButton.setAttribute("aria-disabled",h.toString()),this._zoomOutButton.setAttribute("aria-disabled",p.toString())},this._rotateCompassArrow=()=>{const o=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=o},this._setButtonTitle=(o,h)=>{const p=this._map._getUIString(`NavigationControl.${h}`);o.title=p,o.setAttribute("aria-label",p)},this.options=a.e({},hu,y),this._container=C.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",o=>o.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",o=>this._map.zoomIn({},{originalEvent:o})),C.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",o=>this._map.zoomOut({},{originalEvent:o})),C.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",o=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:o}):this._map.resetNorth({},{originalEvent:o})}),this._compassIcon=C.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(y){return this._map=y,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new fu(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){C.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(y,o){const h=C.create("button",y,this._container);return h.type="button",h.addEventListener("click",o),h}},f.Popup=class extends a.E{constructor(y){super(),this.remove=()=>(this._content&&C.remove(this._content),this._container&&(C.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new a.k("close"))),this),this._onMouseUp=o=>{this._update(o.point)},this._onMouseMove=o=>{this._update(o.point)},this._onDrag=o=>{this._update(o.point)},this._update=o=>{var h;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=C.create("div","maplibregl-popup",this._map.getContainer()),this._tip=C.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const M of this.options.className.split(" "))this._container.classList.add(M);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?Ul(this._lngLat,this._flatPos,this._map.transform):(h=this._lngLat)===null||h===void 0?void 0:h.wrap(),this._trackPointer&&!o)return;const p=this._flatPos=this._pos=this._trackPointer&&o?o:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&o?o:this._map.transform.locationPoint(this._lngLat));let m=this.options.anchor;const v=Wl(this.options.offset);if(!m){const M=this._container.offsetWidth,A=this._container.offsetHeight;let F;F=p.y+v.bottom.y<A?["top"]:p.y>this._map.transform.height-A?["bottom"]:[],p.x<M/2?F.push("left"):p.x>this._map.transform.width-M/2&&F.push("right"),m=F.length===0?"bottom":F.join("-")}let E=p.add(v[m]);this.options.subpixelPositioning||(E=E.round()),C.setTransform(this._container,`${Ga[m]} translate(${E.x}px,${E.y}px)`),Vl(this._container,m,"popup")},this._onClose=()=>{this.remove()},this.options=a.e(Object.create(du),y)}addTo(y){return this._map&&this.remove(),this._map=y,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new a.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(y){return this._lngLat=a.M.convert(y),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(y){return this.setDOMContent(document.createTextNode(y))}setHTML(y){const o=document.createDocumentFragment(),h=document.createElement("body");let p;for(h.innerHTML=y;p=h.firstChild,p;)o.appendChild(p);return this.setDOMContent(o)}getMaxWidth(){var y;return(y=this._container)===null||y===void 0?void 0:y.style.maxWidth}setMaxWidth(y){return this.options.maxWidth=y,this._update(),this}setDOMContent(y){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=C.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(y),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(y){this._container&&this._container.classList.add(y)}removeClassName(y){this._container&&this._container.classList.remove(y)}setOffset(y){return this.options.offset=y,this._update(),this}toggleClassName(y){if(this._container)return this._container.classList.toggle(y)}setSubpixelPositioning(y){this.options.subpixelPositioning=y}_createCloseButton(){this.options.closeButton&&(this._closeButton=C.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const y=this._container.querySelector(pu);y&&y.focus()}},f.RasterDEMTileSource=nr,f.RasterTileSource=ie,f.ScaleControl=class{constructor(y){this._onMove=()=>{Gl(this._map,this._container,this.options)},this.setUnit=o=>{this.options.unit=o,Gl(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},ql),y)}getDefaultPosition(){return"bottom-left"}onAdd(y){return this._map=y,this._container=C.create("div","maplibregl-ctrl maplibregl-ctrl-scale",y.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){C.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},f.ScrollZoomHandler=Ol,f.Style=Bi,f.TerrainControl=class{constructor(y){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=y}onAdd(y){return this._map=y,this._container=C.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=C.create("button","maplibregl-ctrl-terrain",this._container),C.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){C.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},f.TwoFingersTouchPitchHandler=df,f.TwoFingersTouchRotateHandler=iu,f.TwoFingersTouchZoomHandler=ff,f.TwoFingersTouchZoomRotateHandler=ja,f.VectorTileSource=xt,f.VideoSource=xn,f.addSourceType=(y,o)=>a._(void 0,void 0,void 0,function*(){if(ii(y))throw new Error(`A source type called "${y}" already exists.`);((h,p)=>{In[h]=p})(y,o)}),f.clearPrewarmedResources=function(){const y=sr;y&&(y.isPreloaded()&&y.numActive()===1?(y.release(Ot),sr=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},f.getMaxParallelImageRequests=function(){return a.a.MAX_PARALLEL_IMAGE_REQUESTS},f.getRTLTextPluginStatus=function(){return lt().getRTLTextPluginStatus()},f.getVersion=function(){return vf},f.getWorkerCount=function(){return Jt.workerCount},f.getWorkerUrl=function(){return a.a.WORKER_URL},f.importScriptInWorkers=function(y){return gr().broadcast("IS",y)},f.prewarm=function(){rr().acquire(Ot)},f.setMaxParallelImageRequests=function(y){a.a.MAX_PARALLEL_IMAGE_REQUESTS=y},f.setRTLTextPlugin=function(y,o){return lt().setRTLTextPlugin(y,o)},f.setWorkerCount=function(y){Jt.workerCount=y},f.setWorkerUrl=function(y){a.a.WORKER_URL=y}});var u=t;return u})})(Ub);var ga=Ub.exports;const to=Eg(ga),fk=NS({__proto__:null,default:to},[ga]),sc=[];function nm(r,e){return{subscribe:Tr(r,e).subscribe}}function Tr(r,e=It){let t;const n=new Set;function l(a){if(Vt(r,a)&&(r=a,t)){const _=!sc.length;for(const x of n)x[1](),sc.push(x,r);if(_){for(let x=0;x<sc.length;x+=2)sc[x][0](sc[x+1]);sc.length=0}}}function u(a){l(a(r))}function f(a,_=It){const x=[a,_];return n.add(x),n.size===1&&(t=e(l,u)||It),a(r),()=>{n.delete(x),n.size===0&&t&&(t(),t=null)}}return{set:l,update:u,subscribe:f}}let jt;const $b=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&$b.decode();let Ju=null;function nh(){return(Ju===null||Ju.byteLength===0)&&(Ju=new Uint8Array(jt.memory.buffer)),Ju}function Mo(r,e){return r=r>>>0,$b.decode(nh().subarray(r,r+e))}const zs=new Array(128).fill(void 0);zs.push(void 0,null,!0,!1);let ih=zs.length;function Bn(r){ih===zs.length&&zs.push(zs.length+1);const e=ih;return ih=zs[e],zs[e]=r,e}function kr(r){return zs[r]}function dk(r){r<132||(zs[r]=ih,ih=r)}function mc(r){const e=kr(r);return dk(r),e}function im(r){return r==null}let Yu=null;function pk(){return(Yu===null||Yu.byteLength===0)&&(Yu=new Float64Array(jt.memory.buffer)),Yu}let Qu=null;function Ir(){return(Qu===null||Qu.byteLength===0)&&(Qu=new Int32Array(jt.memory.buffer)),Qu}let la=0;const Yf=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},mk=typeof Yf.encodeInto=="function"?function(r,e){return Yf.encodeInto(r,e)}:function(r,e){const t=Yf.encode(r);return e.set(t),{read:r.length,written:t.length}};function $f(r,e,t){if(t===void 0){const a=Yf.encode(r),_=e(a.length,1)>>>0;return nh().subarray(_,_+a.length).set(a),la=a.length,_}let n=r.length,l=e(n,1)>>>0;const u=nh();let f=0;for(;f<n;f++){const a=r.charCodeAt(f);if(a>127)break;u[l+f]=a}if(f!==n){f!==0&&(r=r.slice(f)),l=t(l,n,n=f+r.length*3,1)>>>0;const a=nh().subarray(l+f,l+n),_=mk(r,a);f+=_.written}return la=f,l}function Fm(r){const e=typeof r;if(e=="number"||e=="boolean"||r==null)return`${r}`;if(e=="string")return`"${r}"`;if(e=="symbol"){const l=r.description;return l==null?"Symbol":`Symbol(${l})`}if(e=="function"){const l=r.name;return typeof l=="string"&&l.length>0?`Function(${l})`:"Function"}if(Array.isArray(r)){const l=r.length;let u="[";l>0&&(u+=Fm(r[0]));for(let f=1;f<l;f++)u+=", "+Fm(r[f]);return u+="]",u}const t=/\[object ([^\]]+)\]/.exec(toString.call(r));let n;if(t.length>1)n=t[1];else return toString.call(r);if(n=="Object")try{return"Object("+JSON.stringify(r)+")"}catch{return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:n}function gk(r,e){const t=e(r.length*1,1)>>>0;return nh().set(r,t/1),la=r.length,t}function om(r,e){try{return r.apply(this,e)}catch(t){jt.__wbindgen_exn_store(Bn(t))}}class gd{static __wrap(e){e=e>>>0;const t=Object.create(gd.prototype);return t.__wbg_ptr=e,t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();jt.__wbg_jsroutesnapper_free(e)}constructor(e){try{const u=jt.__wbindgen_add_to_stack_pointer(-16),f=gk(e,jt.__wbindgen_malloc),a=la;jt.jsroutesnapper_new(u,f,a);var t=Ir()[u/4+0],n=Ir()[u/4+1],l=Ir()[u/4+2];if(l)throw mc(n);return gd.__wrap(t)}finally{jt.__wbindgen_add_to_stack_pointer(16)}}setRouteConfig(e){jt.jsroutesnapper_setRouteConfig(this.__wbg_ptr,Bn(e))}setAreaMode(){jt.jsroutesnapper_setAreaMode(this.__wbg_ptr)}getConfig(){let e,t;try{const u=jt.__wbindgen_add_to_stack_pointer(-16);jt.jsroutesnapper_getConfig(u,this.__wbg_ptr);var n=Ir()[u/4+0],l=Ir()[u/4+1];return e=n,t=l,Mo(n,l)}finally{jt.__wbindgen_add_to_stack_pointer(16),jt.__wbindgen_free(e,t,1)}}toFinalFeature(){try{const n=jt.__wbindgen_add_to_stack_pointer(-16);jt.jsroutesnapper_toFinalFeature(n,this.__wbg_ptr);var e=Ir()[n/4+0],t=Ir()[n/4+1];let l;return e!==0&&(l=Mo(e,t).slice(),jt.__wbindgen_free(e,t*1)),l}finally{jt.__wbindgen_add_to_stack_pointer(16)}}renderGeojson(){let e,t;try{const u=jt.__wbindgen_add_to_stack_pointer(-16);jt.jsroutesnapper_renderGeojson(u,this.__wbg_ptr);var n=Ir()[u/4+0],l=Ir()[u/4+1];return e=n,t=l,Mo(n,l)}finally{jt.__wbindgen_add_to_stack_pointer(16),jt.__wbindgen_free(e,t,1)}}toggleSnapMode(){jt.jsroutesnapper_toggleSnapMode(this.__wbg_ptr)}onMouseMove(e,t,n){return jt.jsroutesnapper_onMouseMove(this.__wbg_ptr,e,t,n)!==0}onClick(){jt.jsroutesnapper_onClick(this.__wbg_ptr)}onDragStart(){return jt.jsroutesnapper_onDragStart(this.__wbg_ptr)!==0}onMouseUp(){return jt.jsroutesnapper_onMouseUp(this.__wbg_ptr)!==0}clearState(){jt.jsroutesnapper_clearState(this.__wbg_ptr)}editExisting(e){try{const l=jt.__wbindgen_add_to_stack_pointer(-16);jt.jsroutesnapper_editExisting(l,this.__wbg_ptr,Bn(e));var t=Ir()[l/4+0],n=Ir()[l/4+1];if(n)throw mc(t)}finally{jt.__wbindgen_add_to_stack_pointer(16)}}debugRenderGraph(){let e,t;try{const u=jt.__wbindgen_add_to_stack_pointer(-16);jt.jsroutesnapper_debugRenderGraph(u,this.__wbg_ptr);var n=Ir()[u/4+0],l=Ir()[u/4+1];return e=n,t=l,Mo(n,l)}finally{jt.__wbindgen_add_to_stack_pointer(16),jt.__wbindgen_free(e,t,1)}}debugSnappableNodes(){let e,t;try{const u=jt.__wbindgen_add_to_stack_pointer(-16);jt.jsroutesnapper_debugSnappableNodes(u,this.__wbg_ptr);var n=Ir()[u/4+0],l=Ir()[u/4+1];return e=n,t=l,Mo(n,l)}finally{jt.__wbindgen_add_to_stack_pointer(16),jt.__wbindgen_free(e,t,1)}}routeNameForWaypoints(e){let t,n;try{const k=jt.__wbindgen_add_to_stack_pointer(-16);jt.jsroutesnapper_routeNameForWaypoints(k,this.__wbg_ptr,Bn(e));var l=Ir()[k/4+0],u=Ir()[k/4+1],f=Ir()[k/4+2],a=Ir()[k/4+3],_=l,x=u;if(a)throw _=0,x=0,mc(f);return t=_,n=x,Mo(_,x)}finally{jt.__wbindgen_add_to_stack_pointer(16),jt.__wbindgen_free(t,n,1)}}addSnappedWaypoint(e,t){jt.jsroutesnapper_addSnappedWaypoint(this.__wbg_ptr,e,t)}undo(){jt.jsroutesnapper_undo(this.__wbg_ptr)}calculateRoute(e){let t,n;try{const k=jt.__wbindgen_add_to_stack_pointer(-16);jt.jsroutesnapper_calculateRoute(k,this.__wbg_ptr,Bn(e));var l=Ir()[k/4+0],u=Ir()[k/4+1],f=Ir()[k/4+2],a=Ir()[k/4+3],_=l,x=u;if(a)throw _=0,x=0,mc(f);return t=_,n=x,Mo(_,x)}finally{jt.__wbindgen_add_to_stack_pointer(16),jt.__wbindgen_free(t,n,1)}}getExtraNodes(e,t){let n,l;try{const S=jt.__wbindgen_add_to_stack_pointer(-16);jt.jsroutesnapper_getExtraNodes(S,this.__wbg_ptr,Bn(e),Bn(t));var u=Ir()[S/4+0],f=Ir()[S/4+1],a=Ir()[S/4+2],_=Ir()[S/4+3],x=u,k=f;if(_)throw x=0,k=0,mc(a);return n=x,l=k,Mo(x,k)}finally{jt.__wbindgen_add_to_stack_pointer(16),jt.__wbindgen_free(n,l,1)}}}async function _k(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(n){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const t=await r.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(r,e);return t instanceof WebAssembly.Instance?{instance:t,module:r}:t}}function yk(){const r={};return r.wbg={},r.wbg.__wbindgen_string_new=function(e,t){const n=Mo(e,t);return Bn(n)},r.wbg.__wbindgen_object_drop_ref=function(e){mc(e)},r.wbg.__wbindgen_error_new=function(e,t){const n=new Error(Mo(e,t));return Bn(n)},r.wbg.__wbindgen_number_get=function(e,t){const n=kr(t),l=typeof n=="number"?n:void 0;pk()[e/8+1]=im(l)?0:l,Ir()[e/4+0]=!im(l)},r.wbg.__wbindgen_is_object=function(e){const t=kr(e);return typeof t=="object"&&t!==null},r.wbg.__wbindgen_is_undefined=function(e){return kr(e)===void 0},r.wbg.__wbindgen_in=function(e,t){return kr(e)in kr(t)},r.wbg.__wbindgen_boolean_get=function(e){const t=kr(e);return typeof t=="boolean"?t?1:0:2},r.wbg.__wbindgen_jsval_loose_eq=function(e,t){return kr(e)==kr(t)},r.wbg.__wbindgen_string_get=function(e,t){const n=kr(t),l=typeof n=="string"?n:void 0;var u=im(l)?0:$f(l,jt.__wbindgen_malloc,jt.__wbindgen_realloc),f=la;Ir()[e/4+1]=f,Ir()[e/4+0]=u},r.wbg.__wbg_String_4370c5505c674d30=function(e,t){const n=String(kr(t)),l=$f(n,jt.__wbindgen_malloc,jt.__wbindgen_realloc),u=la;Ir()[e/4+1]=u,Ir()[e/4+0]=l},r.wbg.__wbindgen_object_clone_ref=function(e){const t=kr(e);return Bn(t)},r.wbg.__wbg_getwithrefkey_d1f0d12f1f1b63ea=function(e,t){const n=kr(e)[kr(t)];return Bn(n)},r.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return Bn(e)},r.wbg.__wbg_stack_658279fe44541cf6=function(e,t){const n=kr(t).stack,l=$f(n,jt.__wbindgen_malloc,jt.__wbindgen_realloc),u=la;Ir()[e/4+1]=u,Ir()[e/4+0]=l},r.wbg.__wbg_error_f851667af71bcfc6=function(e,t){let n,l;try{n=e,l=t,console.error(Mo(e,t))}finally{jt.__wbindgen_free(n,l,1)}},r.wbg.__wbg_debug_9a6b3243fbbebb61=function(e){console.debug(kr(e))},r.wbg.__wbg_error_788ae33f81d3b84b=function(e){console.error(kr(e))},r.wbg.__wbg_info_2e30e8204b29d91d=function(e){console.info(kr(e))},r.wbg.__wbg_log_1d3ae0273d8f4f8a=function(e){console.log(kr(e))},r.wbg.__wbg_warn_d60e832f9882c1b2=function(e){console.warn(kr(e))},r.wbg.__wbg_get_44be0491f933a435=function(e,t){const n=kr(e)[t>>>0];return Bn(n)},r.wbg.__wbg_length_fff51ee6522a1a18=function(e){return kr(e).length},r.wbg.__wbindgen_is_function=function(e){return typeof kr(e)=="function"},r.wbg.__wbg_next_526fc47e980da008=function(e){const t=kr(e).next;return Bn(t)},r.wbg.__wbg_next_ddb3312ca1c4e32a=function(){return om(function(e){const t=kr(e).next();return Bn(t)},arguments)},r.wbg.__wbg_done_5c1f01fb660d73b5=function(e){return kr(e).done},r.wbg.__wbg_value_1695675138684bd5=function(e){const t=kr(e).value;return Bn(t)},r.wbg.__wbg_iterator_97f0c81209c6c35a=function(){return Bn(Symbol.iterator)},r.wbg.__wbg_get_97b561fb56f034b5=function(){return om(function(e,t){const n=Reflect.get(kr(e),kr(t));return Bn(n)},arguments)},r.wbg.__wbg_call_cb65541d95d71282=function(){return om(function(e,t){const n=kr(e).call(kr(t));return Bn(n)},arguments)},r.wbg.__wbg_isArray_4c24b343cb13cfb1=function(e){return Array.isArray(kr(e))},r.wbg.__wbg_instanceof_ArrayBuffer_39ac22089b74fddb=function(e){let t;try{t=kr(e)instanceof ArrayBuffer}catch{t=!1}return t},r.wbg.__wbg_buffer_085ec1f694018c4f=function(e){const t=kr(e).buffer;return Bn(t)},r.wbg.__wbg_new_8125e318e6245eed=function(e){const t=new Uint8Array(kr(e));return Bn(t)},r.wbg.__wbg_set_5cf90238115182c3=function(e,t,n){kr(e).set(kr(t),n>>>0)},r.wbg.__wbg_length_72e2208bbc0efc61=function(e){return kr(e).length},r.wbg.__wbg_instanceof_Uint8Array_d8d9cb2b8e8ac1d4=function(e){let t;try{t=kr(e)instanceof Uint8Array}catch{t=!1}return t},r.wbg.__wbindgen_debug_string=function(e,t){const n=Fm(kr(t)),l=$f(n,jt.__wbindgen_malloc,jt.__wbindgen_realloc),u=la;Ir()[e/4+1]=u,Ir()[e/4+0]=l},r.wbg.__wbindgen_throw=function(e,t){throw new Error(Mo(e,t))},r.wbg.__wbindgen_memory=function(){const e=jt.memory;return Bn(e)},r}function vk(r,e){return jt=r.exports,qb.__wbindgen_wasm_module=e,Yu=null,Qu=null,Ju=null,jt}async function qb(r){if(jt!==void 0)return jt;typeof r>"u"&&(r="/ltn/assets/route_snapper_bg.wasm");const e=yk();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:t,module:n}=await _k(await r,e);return vk(t,n)}var Pi=63710088e-1,Cg={centimeters:Pi*100,centimetres:Pi*100,degrees:Pi/111325,feet:Pi*3.28084,inches:Pi*39.37,kilometers:Pi/1e3,kilometres:Pi/1e3,meters:Pi,metres:Pi,miles:Pi/1609.344,millimeters:Pi*1e3,millimetres:Pi*1e3,nauticalmiles:Pi/1852,radians:1,yards:Pi*1.0936},bk={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/Pi,yards:1.0936133},Om={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function Do(r,e,t){t===void 0&&(t={});var n={type:"Feature"};return(t.id===0||t.id)&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.properties=e||{},n.geometry=r,n}function wk(r,e,t){switch(r){case"Point":return eo(e).geometry;case"LineString":return Ao(e).geometry;case"Polygon":return Mg(e).geometry;case"MultiPoint":return Wb(e).geometry;case"MultiLineString":return Gb(e).geometry;case"MultiPolygon":return Zb(e).geometry;default:throw new Error(r+" is invalid")}}function eo(r,e,t){if(t===void 0&&(t={}),!r)throw new Error("coordinates is required");if(!Array.isArray(r))throw new Error("coordinates must be an Array");if(r.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!_d(r[0])||!_d(r[1]))throw new Error("coordinates must contain numbers");var n={type:"Point",coordinates:r};return Do(n,e,t)}function xk(r,e,t){return t===void 0&&(t={}),rl(r.map(function(n){return eo(n,e)}),t)}function Mg(r,e,t){t===void 0&&(t={});for(var n=0,l=r;n<l.length;n++){var u=l[n];if(u.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var f=0;f<u[u.length-1].length;f++)if(u[u.length-1][f]!==u[0][f])throw new Error("First and last Position are not equivalent.")}var a={type:"Polygon",coordinates:r};return Do(a,e,t)}function Sk(r,e,t){return t===void 0&&(t={}),rl(r.map(function(n){return Mg(n,e)}),t)}function Ao(r,e,t){if(t===void 0&&(t={}),r.length<2)throw new Error("coordinates must be an array of two or more positions");var n={type:"LineString",coordinates:r};return Do(n,e,t)}function kk(r,e,t){return t===void 0&&(t={}),rl(r.map(function(n){return Ao(n,e)}),t)}function rl(r,e){e===void 0&&(e={});var t={type:"FeatureCollection"};return e.id&&(t.id=e.id),e.bbox&&(t.bbox=e.bbox),t.features=r,t}function Gb(r,e,t){t===void 0&&(t={});var n={type:"MultiLineString",coordinates:r};return Do(n,e,t)}function Wb(r,e,t){t===void 0&&(t={});var n={type:"MultiPoint",coordinates:r};return Do(n,e,t)}function Zb(r,e,t){t===void 0&&(t={});var n={type:"MultiPolygon",coordinates:r};return Do(n,e,t)}function Tk(r,e,t){t===void 0&&(t={});var n={type:"GeometryCollection",geometries:r};return Do(n,e,t)}function Ek(r,e){if(e===void 0&&(e=0),e&&!(e>=0))throw new Error("precision must be a positive number");var t=Math.pow(10,e||0);return Math.round(r*t)/t}function Ig(r,e){e===void 0&&(e="kilometers");var t=Cg[e];if(!t)throw new Error(e+" units is invalid");return r*t}function Vd(r,e){e===void 0&&(e="kilometers");var t=Cg[e];if(!t)throw new Error(e+" units is invalid");return r/t}function Ck(r,e){return fh(Vd(r,e))}function Mk(r){var e=r%360;return e<0&&(e+=360),e}function fh(r){var e=r%(2*Math.PI);return e*180/Math.PI}function Lo(r){var e=r%360;return e*Math.PI/180}function Ik(r,e,t){if(e===void 0&&(e="kilometers"),t===void 0&&(t="kilometers"),!(r>=0))throw new Error("length must be a positive number");return Ig(Vd(r,e),t)}function Ak(r,e,t){if(e===void 0&&(e="meters"),t===void 0&&(t="kilometers"),!(r>=0))throw new Error("area must be a positive number");var n=Om[e];if(!n)throw new Error("invalid original units");var l=Om[t];if(!l)throw new Error("invalid final units");return r/n*l}function _d(r){return!isNaN(r)&&r!==null&&!Array.isArray(r)}function Ag(r){return!!r&&r.constructor===Object}function Lk(r){if(!r)throw new Error("bbox is required");if(!Array.isArray(r))throw new Error("bbox must be an Array");if(r.length!==4&&r.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");r.forEach(function(e){if(!_d(e))throw new Error("bbox must only contain numbers")})}function Pk(r){if(!r)throw new Error("id is required");if(["string","number"].indexOf(typeof r)===-1)throw new Error("id must be a number or a string")}const zk=Object.freeze(Object.defineProperty({__proto__:null,areaFactors:Om,bearingToAzimuth:Mk,convertArea:Ak,convertLength:Ik,degreesToRadians:Lo,earthRadius:Pi,factors:Cg,feature:Do,featureCollection:rl,geometry:wk,geometryCollection:Tk,isNumber:_d,isObject:Ag,lengthToDegrees:Ck,lengthToRadians:Vd,lineString:Ao,lineStrings:kk,multiLineString:Gb,multiPoint:Wb,multiPolygon:Zb,point:eo,points:xk,polygon:Mg,polygons:Sk,radiansToDegrees:fh,radiansToLength:Ig,round:Ek,unitsFactors:bk,validateBBox:Lk,validateId:Pk},Symbol.toStringTag,{value:"Module"}));function dh(r){if(!r)throw new Error("coord is required");if(!Array.isArray(r)){if(r.type==="Feature"&&r.geometry!==null&&r.geometry.type==="Point")return r.geometry.coordinates;if(r.type==="Point")return r.coordinates}if(Array.isArray(r)&&r.length>=2&&!Array.isArray(r[0])&&!Array.isArray(r[1]))return r;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function kc(r){if(Array.isArray(r))return r;if(r.type==="Feature"){if(r.geometry!==null)return r.geometry.coordinates}else if(r.coordinates)return r.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function Fu(r,e,t){t===void 0&&(t={});var n=dh(r),l=dh(e),u=Lo(l[1]-n[1]),f=Lo(l[0]-n[0]),a=Lo(n[1]),_=Lo(l[1]),x=Math.pow(Math.sin(u/2),2)+Math.pow(Math.sin(f/2),2)*Math.cos(a)*Math.cos(_);return Ig(2*Math.atan2(Math.sqrt(x),Math.sqrt(1-x)),t.units)}function Ih(r,e,t){if(r!==null)for(var n,l,u,f,a,_,x,k=0,S=0,C,z=r.type,R=z==="FeatureCollection",D=z==="Feature",P=R?r.features.length:1,B=0;B<P;B++){x=R?r.features[B].geometry:D?r.geometry:r,C=x?x.type==="GeometryCollection":!1,a=C?x.geometries.length:1;for(var N=0;N<a;N++){var V=0,U=0;if(f=C?x.geometries[N]:x,f!==null){_=f.coordinates;var te=f.type;switch(k=t&&(te==="Polygon"||te==="MultiPolygon")?1:0,te){case null:break;case"Point":if(e(_,S,B,V,U)===!1)return!1;S++,V++;break;case"LineString":case"MultiPoint":for(n=0;n<_.length;n++){if(e(_[n],S,B,V,U)===!1)return!1;S++,te==="MultiPoint"&&V++}te==="LineString"&&V++;break;case"Polygon":case"MultiLineString":for(n=0;n<_.length;n++){for(l=0;l<_[n].length-k;l++){if(e(_[n][l],S,B,V,U)===!1)return!1;S++}te==="MultiLineString"&&V++,te==="Polygon"&&U++}te==="Polygon"&&V++;break;case"MultiPolygon":for(n=0;n<_.length;n++){for(U=0,l=0;l<_[n].length;l++){for(u=0;u<_[n][l].length-k;u++){if(e(_[n][l][u],S,B,V,U)===!1)return!1;S++}U++}V++}break;case"GeometryCollection":for(n=0;n<f.geometries.length;n++)if(Ih(f.geometries[n],e,t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Dk(r,e,t,n){var l=t;return Ih(r,function(u,f,a,_,x){f===0&&t===void 0?l=u:l=e(l,u,f,a,_,x)},n),l}function Hb(r,e){var t;switch(r.type){case"FeatureCollection":for(t=0;t<r.features.length&&e(r.features[t].properties,t)!==!1;t++);break;case"Feature":e(r.properties,0);break}}function Rk(r,e,t){var n=t;return Hb(r,function(l,u){u===0&&t===void 0?n=l:n=e(n,l,u)}),n}function yd(r,e){if(r.type==="Feature")e(r,0);else if(r.type==="FeatureCollection")for(var t=0;t<r.features.length&&e(r.features[t],t)!==!1;t++);}function Bk(r,e,t){var n=t;return yd(r,function(l,u){u===0&&t===void 0?n=l:n=e(n,l,u)}),n}function Fk(r){var e=[];return Ih(r,function(t){e.push(t)}),e}function Lg(r,e){var t,n,l,u,f,a,_,x,k,S,C=0,z=r.type==="FeatureCollection",R=r.type==="Feature",D=z?r.features.length:1;for(t=0;t<D;t++){for(a=z?r.features[t].geometry:R?r.geometry:r,x=z?r.features[t].properties:R?r.properties:{},k=z?r.features[t].bbox:R?r.bbox:void 0,S=z?r.features[t].id:R?r.id:void 0,_=a?a.type==="GeometryCollection":!1,f=_?a.geometries.length:1,l=0;l<f;l++){if(u=_?a.geometries[l]:a,u===null){if(e(null,C,x,k,S)===!1)return!1;continue}switch(u.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(u,C,x,k,S)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<u.geometries.length;n++)if(e(u.geometries[n],C,x,k,S)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}C++}}function Ok(r,e,t){var n=t;return Lg(r,function(l,u,f,a,_){u===0&&t===void 0?n=l:n=e(n,l,u,f,a,_)}),n}function zc(r,e){Lg(r,function(t,n,l,u,f){var a=t===null?null:t.type;switch(a){case null:case"Point":case"LineString":case"Polygon":return e(Do(t,l,{bbox:u,id:f}),n,0)===!1?!1:void 0}var _;switch(a){case"MultiPoint":_="Point";break;case"MultiLineString":_="LineString";break;case"MultiPolygon":_="Polygon";break}for(var x=0;x<t.coordinates.length;x++){var k=t.coordinates[x],S={type:_,coordinates:k};if(e(Do(S,l),n,x)===!1)return!1}})}function Nk(r,e,t){var n=t;return zc(r,function(l,u,f){u===0&&f===0&&t===void 0?n=l:n=e(n,l,u,f)}),n}function Xb(r,e){zc(r,function(t,n,l){var u=0;if(t.geometry){var f=t.geometry.type;if(!(f==="Point"||f==="MultiPoint")){var a,_=0,x=0,k=0;if(Ih(t,function(S,C,z,R,D){if(a===void 0||n>_||R>x||D>k){a=S,_=n,x=R,k=D,u=0;return}var P=Ao([a,S],t.properties);if(e(P,n,l,D,u)===!1)return!1;u++,a=S})===!1)return!1}}})}function jk(r,e,t){var n=t,l=!1;return Xb(r,function(u,f,a,_,x){l===!1&&t===void 0?n=u:n=e(n,u,f,a,_,x),l=!0}),n}function Kb(r,e){if(!r)throw new Error("geojson is required");zc(r,function(t,n,l){if(t.geometry!==null){var u=t.geometry.type,f=t.geometry.coordinates;switch(u){case"LineString":if(e(t,n,l,0,0)===!1)return!1;break;case"Polygon":for(var a=0;a<f.length;a++)if(e(Ao(f[a],t.properties),n,l,a)===!1)return!1;break}}})}function Uk(r,e,t){var n=t;return Kb(r,function(l,u,f,a){u===0&&t===void 0?n=l:n=e(n,l,u,f,a)}),n}function Vk(r,e){if(e=e||{},!Ag(e))throw new Error("options is invalid");var t=e.featureIndex||0,n=e.multiFeatureIndex||0,l=e.geometryIndex||0,u=e.segmentIndex||0,f=e.properties,a;switch(r.type){case"FeatureCollection":t<0&&(t=r.features.length+t),f=f||r.features[t].properties,a=r.features[t].geometry;break;case"Feature":f=f||r.properties,a=r.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":a=r;break;default:throw new Error("geojson is invalid")}if(a===null)return null;var _=a.coordinates;switch(a.type){case"Point":case"MultiPoint":return null;case"LineString":return u<0&&(u=_.length+u-1),Ao([_[u],_[u+1]],f,e);case"Polygon":return l<0&&(l=_.length+l),u<0&&(u=_[l].length+u-1),Ao([_[l][u],_[l][u+1]],f,e);case"MultiLineString":return n<0&&(n=_.length+n),u<0&&(u=_[n].length+u-1),Ao([_[n][u],_[n][u+1]],f,e);case"MultiPolygon":return n<0&&(n=_.length+n),l<0&&(l=_[n].length+l),u<0&&(u=_[n][l].length-u-1),Ao([_[n][l][u],_[n][l][u+1]],f,e)}throw new Error("geojson is invalid")}function $k(r,e){if(e=e||{},!Ag(e))throw new Error("options is invalid");var t=e.featureIndex||0,n=e.multiFeatureIndex||0,l=e.geometryIndex||0,u=e.coordIndex||0,f=e.properties,a;switch(r.type){case"FeatureCollection":t<0&&(t=r.features.length+t),f=f||r.features[t].properties,a=r.features[t].geometry;break;case"Feature":f=f||r.properties,a=r.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":a=r;break;default:throw new Error("geojson is invalid")}if(a===null)return null;var _=a.coordinates;switch(a.type){case"Point":return eo(_,f,e);case"MultiPoint":return n<0&&(n=_.length+n),eo(_[n],f,e);case"LineString":return u<0&&(u=_.length+u),eo(_[u],f,e);case"Polygon":return l<0&&(l=_.length+l),u<0&&(u=_[l].length+u),eo(_[l][u],f,e);case"MultiLineString":return n<0&&(n=_.length+n),u<0&&(u=_[n].length+u),eo(_[n][u],f,e);case"MultiPolygon":return n<0&&(n=_.length+n),l<0&&(l=_[n].length+l),u<0&&(u=_[n][l].length-u),eo(_[n][l][u],f,e)}throw new Error("geojson is invalid")}const qk=Object.freeze(Object.defineProperty({__proto__:null,coordAll:Fk,coordEach:Ih,coordReduce:Dk,featureEach:yd,featureReduce:Bk,findPoint:$k,findSegment:Vk,flattenEach:zc,flattenReduce:Nk,geomEach:Lg,geomReduce:Ok,lineEach:Kb,lineReduce:Uk,propEach:Hb,propReduce:Rk,segmentEach:Xb,segmentReduce:jk},Symbol.toStringTag,{value:"Module"}));function Jb(r,e,t){if(t===void 0&&(t={}),t.final===!0)return Gk(r,e);var n=dh(r),l=dh(e),u=Lo(n[0]),f=Lo(l[0]),a=Lo(n[1]),_=Lo(l[1]),x=Math.sin(f-u)*Math.cos(_),k=Math.cos(a)*Math.sin(_)-Math.sin(a)*Math.cos(_)*Math.cos(f-u);return fh(Math.atan2(x,k))}function Gk(r,e){var t=Jb(e,r);return t=(t+180)%360,t}function qy(r,e,t,n){n===void 0&&(n={});var l=dh(r),u=Lo(l[0]),f=Lo(l[1]),a=Lo(t),_=Vd(e,n.units),x=Math.asin(Math.sin(f)*Math.cos(_)+Math.cos(f)*Math.sin(_)*Math.cos(a)),k=u+Math.atan2(Math.sin(a)*Math.sin(_)*Math.cos(f),Math.cos(_)-Math.sin(f)*Math.sin(x)),S=fh(k),C=fh(x);return eo([S,C],n.properties)}function Gy(r){if(!r)throw new Error("geojson is required");var e=[];return zc(r,function(t){Wk(t,e)}),rl(e)}function Wk(r,e){var t=[],n=r.geometry;if(n!==null){switch(n.type){case"Polygon":t=kc(n);break;case"LineString":t=[kc(n)]}t.forEach(function(l){var u=Zk(l,r.properties);u.forEach(function(f){f.id=e.length,e.push(f)})})}}function Zk(r,e){var t=[];return r.reduce(function(n,l){var u=Ao([n,l],e);return u.bbox=Hk(n,l),t.push(u),l}),t}function Hk(r,e){var t=r[0],n=r[1],l=e[0],u=e[1],f=t<l?t:l,a=n<u?n:u,_=t>l?t:l,x=n>u?n:u;return[f,a,_,x]}var Pg={exports:{}},Yb={exports:{}};(function(r,e){(function(t,n){r.exports=n()})(Mh,function(){function t(N,V,U,te,le){(function H(J,ye,ze,ne,be){for(;ne>ze;){if(ne-ze>600){var He=ne-ze+1,Ce=ye-ze+1,Qe=Math.log(He),_t=.5*Math.exp(2*Qe/3),Ut=.5*Math.sqrt(Qe*_t*(He-_t)/He)*(Ce-He/2<0?-1:1),Je=Math.max(ze,Math.floor(ye-Ce*_t/He+Ut)),Yt=Math.min(ne,Math.floor(ye+(He-Ce)*_t/He+Ut));H(J,ye,Je,Yt,be)}var Kt=J[ye],Ft=ze,Ot=ne;for(n(J,ze,ye),be(J[ne],Kt)>0&&n(J,ze,ne);Ft<Ot;){for(n(J,Ft,Ot),Ft++,Ot--;be(J[Ft],Kt)<0;)Ft++;for(;be(J[Ot],Kt)>0;)Ot--}be(J[ze],Kt)===0?n(J,ze,Ot):n(J,++Ot,ne),Ot<=ye&&(ze=Ot+1),ye<=Ot&&(ne=Ot-1)}})(N,V,U||0,te||N.length-1,le||l)}function n(N,V,U){var te=N[V];N[V]=N[U],N[U]=te}function l(N,V){return N<V?-1:N>V?1:0}var u=function(N){N===void 0&&(N=9),this._maxEntries=Math.max(4,N),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function f(N,V,U){if(!U)return V.indexOf(N);for(var te=0;te<V.length;te++)if(U(N,V[te]))return te;return-1}function a(N,V){_(N,0,N.children.length,V,N)}function _(N,V,U,te,le){le||(le=P(null)),le.minX=1/0,le.minY=1/0,le.maxX=-1/0,le.maxY=-1/0;for(var H=V;H<U;H++){var J=N.children[H];x(le,N.leaf?te(J):J)}return le}function x(N,V){return N.minX=Math.min(N.minX,V.minX),N.minY=Math.min(N.minY,V.minY),N.maxX=Math.max(N.maxX,V.maxX),N.maxY=Math.max(N.maxY,V.maxY),N}function k(N,V){return N.minX-V.minX}function S(N,V){return N.minY-V.minY}function C(N){return(N.maxX-N.minX)*(N.maxY-N.minY)}function z(N){return N.maxX-N.minX+(N.maxY-N.minY)}function R(N,V){return N.minX<=V.minX&&N.minY<=V.minY&&V.maxX<=N.maxX&&V.maxY<=N.maxY}function D(N,V){return V.minX<=N.maxX&&V.minY<=N.maxY&&V.maxX>=N.minX&&V.maxY>=N.minY}function P(N){return{children:N,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function B(N,V,U,te,le){for(var H=[V,U];H.length;)if(!((U=H.pop())-(V=H.pop())<=te)){var J=V+Math.ceil((U-V)/te/2)*te;t(N,J,V,U,le),H.push(V,J,J,U)}}return u.prototype.all=function(){return this._all(this.data,[])},u.prototype.search=function(N){var V=this.data,U=[];if(!D(N,V))return U;for(var te=this.toBBox,le=[];V;){for(var H=0;H<V.children.length;H++){var J=V.children[H],ye=V.leaf?te(J):J;D(N,ye)&&(V.leaf?U.push(J):R(N,ye)?this._all(J,U):le.push(J))}V=le.pop()}return U},u.prototype.collides=function(N){var V=this.data;if(!D(N,V))return!1;for(var U=[];V;){for(var te=0;te<V.children.length;te++){var le=V.children[te],H=V.leaf?this.toBBox(le):le;if(D(N,H)){if(V.leaf||R(N,H))return!0;U.push(le)}}V=U.pop()}return!1},u.prototype.load=function(N){if(!N||!N.length)return this;if(N.length<this._minEntries){for(var V=0;V<N.length;V++)this.insert(N[V]);return this}var U=this._build(N.slice(),0,N.length-1,0);if(this.data.children.length)if(this.data.height===U.height)this._splitRoot(this.data,U);else{if(this.data.height<U.height){var te=this.data;this.data=U,U=te}this._insert(U,this.data.height-U.height-1,!0)}else this.data=U;return this},u.prototype.insert=function(N){return N&&this._insert(N,this.data.height-1),this},u.prototype.clear=function(){return this.data=P([]),this},u.prototype.remove=function(N,V){if(!N)return this;for(var U,te,le,H=this.data,J=this.toBBox(N),ye=[],ze=[];H||ye.length;){if(H||(H=ye.pop(),te=ye[ye.length-1],U=ze.pop(),le=!0),H.leaf){var ne=f(N,H.children,V);if(ne!==-1)return H.children.splice(ne,1),ye.push(H),this._condense(ye),this}le||H.leaf||!R(H,J)?te?(U++,H=te.children[U],le=!1):H=null:(ye.push(H),ze.push(U),U=0,te=H,H=H.children[0])}return this},u.prototype.toBBox=function(N){return N},u.prototype.compareMinX=function(N,V){return N.minX-V.minX},u.prototype.compareMinY=function(N,V){return N.minY-V.minY},u.prototype.toJSON=function(){return this.data},u.prototype.fromJSON=function(N){return this.data=N,this},u.prototype._all=function(N,V){for(var U=[];N;)N.leaf?V.push.apply(V,N.children):U.push.apply(U,N.children),N=U.pop();return V},u.prototype._build=function(N,V,U,te){var le,H=U-V+1,J=this._maxEntries;if(H<=J)return a(le=P(N.slice(V,U+1)),this.toBBox),le;te||(te=Math.ceil(Math.log(H)/Math.log(J)),J=Math.ceil(H/Math.pow(J,te-1))),(le=P([])).leaf=!1,le.height=te;var ye=Math.ceil(H/J),ze=ye*Math.ceil(Math.sqrt(J));B(N,V,U,ze,this.compareMinX);for(var ne=V;ne<=U;ne+=ze){var be=Math.min(ne+ze-1,U);B(N,ne,be,ye,this.compareMinY);for(var He=ne;He<=be;He+=ye){var Ce=Math.min(He+ye-1,be);le.children.push(this._build(N,He,Ce,te-1))}}return a(le,this.toBBox),le},u.prototype._chooseSubtree=function(N,V,U,te){for(;te.push(V),!V.leaf&&te.length-1!==U;){for(var le=1/0,H=1/0,J=void 0,ye=0;ye<V.children.length;ye++){var ze=V.children[ye],ne=C(ze),be=(He=N,Ce=ze,(Math.max(Ce.maxX,He.maxX)-Math.min(Ce.minX,He.minX))*(Math.max(Ce.maxY,He.maxY)-Math.min(Ce.minY,He.minY))-ne);be<H?(H=be,le=ne<le?ne:le,J=ze):be===H&&ne<le&&(le=ne,J=ze)}V=J||V.children[0]}var He,Ce;return V},u.prototype._insert=function(N,V,U){var te=U?N:this.toBBox(N),le=[],H=this._chooseSubtree(te,this.data,V,le);for(H.children.push(N),x(H,te);V>=0&&le[V].children.length>this._maxEntries;)this._split(le,V),V--;this._adjustParentBBoxes(te,le,V)},u.prototype._split=function(N,V){var U=N[V],te=U.children.length,le=this._minEntries;this._chooseSplitAxis(U,le,te);var H=this._chooseSplitIndex(U,le,te),J=P(U.children.splice(H,U.children.length-H));J.height=U.height,J.leaf=U.leaf,a(U,this.toBBox),a(J,this.toBBox),V?N[V-1].children.push(J):this._splitRoot(U,J)},u.prototype._splitRoot=function(N,V){this.data=P([N,V]),this.data.height=N.height+1,this.data.leaf=!1,a(this.data,this.toBBox)},u.prototype._chooseSplitIndex=function(N,V,U){for(var te,le,H,J,ye,ze,ne,be=1/0,He=1/0,Ce=V;Ce<=U-V;Ce++){var Qe=_(N,0,Ce,this.toBBox),_t=_(N,Ce,U,this.toBBox),Ut=(le=Qe,H=_t,J=void 0,ye=void 0,ze=void 0,ne=void 0,J=Math.max(le.minX,H.minX),ye=Math.max(le.minY,H.minY),ze=Math.min(le.maxX,H.maxX),ne=Math.min(le.maxY,H.maxY),Math.max(0,ze-J)*Math.max(0,ne-ye)),Je=C(Qe)+C(_t);Ut<be?(be=Ut,te=Ce,He=Je<He?Je:He):Ut===be&&Je<He&&(He=Je,te=Ce)}return te||U-V},u.prototype._chooseSplitAxis=function(N,V,U){var te=N.leaf?this.compareMinX:k,le=N.leaf?this.compareMinY:S;this._allDistMargin(N,V,U,te)<this._allDistMargin(N,V,U,le)&&N.children.sort(te)},u.prototype._allDistMargin=function(N,V,U,te){N.children.sort(te);for(var le=this.toBBox,H=_(N,0,V,le),J=_(N,U-V,U,le),ye=z(H)+z(J),ze=V;ze<U-V;ze++){var ne=N.children[ze];x(H,N.leaf?le(ne):ne),ye+=z(H)}for(var be=U-V-1;be>=V;be--){var He=N.children[be];x(J,N.leaf?le(He):He),ye+=z(J)}return ye},u.prototype._adjustParentBBoxes=function(N,V,U){for(var te=U;te>=0;te--)x(V[te],N)},u.prototype._condense=function(N){for(var V=N.length-1,U=void 0;V>=0;V--)N[V].children.length===0?V>0?(U=N[V-1].children).splice(U.indexOf(N[V]),1):this.clear():a(N[V],this.toBBox)},u})})(Yb);var Xk=Yb.exports;const Kk=Ud(zk),Jk=Ud(qk);function Qb(r,e,t){if(r!==null)for(var n,l,u,f,a,_,x,k=0,S=0,C,z=r.type,R=z==="FeatureCollection",D=z==="Feature",P=R?r.features.length:1,B=0;B<P;B++){x=R?r.features[B].geometry:D?r.geometry:r,C=x?x.type==="GeometryCollection":!1,a=C?x.geometries.length:1;for(var N=0;N<a;N++){var V=0,U=0;if(f=C?x.geometries[N]:x,f!==null){_=f.coordinates;var te=f.type;switch(k=t&&(te==="Polygon"||te==="MultiPolygon")?1:0,te){case null:break;case"Point":if(e(_,S,B,V,U)===!1)return!1;S++,V++;break;case"LineString":case"MultiPoint":for(n=0;n<_.length;n++){if(e(_[n],S,B,V,U)===!1)return!1;S++,te==="MultiPoint"&&V++}te==="LineString"&&V++;break;case"Polygon":case"MultiLineString":for(n=0;n<_.length;n++){for(l=0;l<_[n].length-k;l++){if(e(_[n][l],S,B,V,U)===!1)return!1;S++}te==="MultiLineString"&&V++,te==="Polygon"&&U++}te==="Polygon"&&V++;break;case"MultiPolygon":for(n=0;n<_.length;n++){for(U=0,l=0;l<_[n].length;l++){for(u=0;u<_[n][l].length-k;u++){if(e(_[n][l][u],S,B,V,U)===!1)return!1;S++}U++}V++}break;case"GeometryCollection":for(n=0;n<f.geometries.length;n++)if(Qb(f.geometries[n],e,t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function ew(r,e={}){if(r.bbox!=null&&e.recompute!==!0)return r.bbox;const t=[1/0,1/0,-1/0,-1/0];return Qb(r,n=>{t[0]>n[0]&&(t[0]=n[0]),t[1]>n[1]&&(t[1]=n[1]),t[2]<n[0]&&(t[2]=n[0]),t[3]<n[1]&&(t[3]=n[1])}),t}var Yk=ew;const Qk=Object.freeze(Object.defineProperty({__proto__:null,bbox:ew,default:Yk},Symbol.toStringTag,{value:"Module"})),e4=Ud(Qk);var as=Xk,tw=Kk,rw=Jk,ac=e4.default,t4=rw.featureEach;rw.coordEach;tw.polygon;var Wy=tw.featureCollection;function nw(r){var e=new as(r);return e.insert=function(t){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:ac(t),as.prototype.insert.call(this,t)},e.load=function(t){var n=[];return Array.isArray(t)?t.forEach(function(l){if(l.type!=="Feature")throw new Error("invalid features");l.bbox=l.bbox?l.bbox:ac(l),n.push(l)}):t4(t,function(l){if(l.type!=="Feature")throw new Error("invalid features");l.bbox=l.bbox?l.bbox:ac(l),n.push(l)}),as.prototype.load.call(this,n)},e.remove=function(t,n){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:ac(t),as.prototype.remove.call(this,t,n)},e.clear=function(){return as.prototype.clear.call(this)},e.search=function(t){var n=as.prototype.search.call(this,this.toBBox(t));return Wy(n)},e.collides=function(t){return as.prototype.collides.call(this,this.toBBox(t))},e.all=function(){var t=as.prototype.all.call(this);return Wy(t)},e.toJSON=function(){return as.prototype.toJSON.call(this)},e.fromJSON=function(t){return as.prototype.fromJSON.call(this,t)},e.toBBox=function(t){var n;if(t.bbox)n=t.bbox;else if(Array.isArray(t)&&t.length===4)n=t;else if(Array.isArray(t)&&t.length===6)n=[t[0],t[1],t[3],t[4]];else if(t.type==="Feature")n=ac(t);else if(t.type==="FeatureCollection")n=ac(t);else throw new Error("invalid geojson");return{minX:n[0],minY:n[1],maxX:n[2],maxY:n[3]}},e}Pg.exports=nw;Pg.exports.default=nw;var r4=Pg.exports;const n4=Eg(r4);function i4(r,e){var t={},n=[];if(r.type==="LineString"&&(r=Do(r)),e.type==="LineString"&&(e=Do(e)),r.type==="Feature"&&e.type==="Feature"&&r.geometry!==null&&e.geometry!==null&&r.geometry.type==="LineString"&&e.geometry.type==="LineString"&&r.geometry.coordinates.length===2&&e.geometry.coordinates.length===2){var l=Zy(r,e);return l&&n.push(l),rl(n)}var u=n4();return u.load(Gy(e)),yd(Gy(r),function(f){yd(u.search(f),function(a){var _=Zy(f,a);if(_){var x=kc(_).join(",");t[x]||(t[x]=!0,n.push(_))}})}),rl(n)}function Zy(r,e){var t=kc(r),n=kc(e);if(t.length!==2)throw new Error("<intersects> line1 must only contain 2 coordinates");if(n.length!==2)throw new Error("<intersects> line2 must only contain 2 coordinates");var l=t[0][0],u=t[0][1],f=t[1][0],a=t[1][1],_=n[0][0],x=n[0][1],k=n[1][0],S=n[1][1],C=(S-x)*(f-l)-(k-_)*(a-u),z=(k-_)*(u-x)-(S-x)*(l-_),R=(f-l)*(u-x)-(a-u)*(l-_);if(C===0)return null;var D=z/C,P=R/C;if(D>=0&&D<=1&&P>=0&&P<=1){var B=l+D*(f-l),N=u+D*(a-u);return eo([B,N])}return null}function o4(r,e,t){t===void 0&&(t={});var n=eo([1/0,1/0],{dist:1/0}),l=0;return zc(r,function(u){for(var f=kc(u),a=0;a<f.length-1;a++){var _=eo(f[a]);_.properties.dist=Fu(e,_,t);var x=eo(f[a+1]);x.properties.dist=Fu(e,x,t);var k=Fu(_,x,t),S=Math.max(_.properties.dist,x.properties.dist),C=Jb(_,x),z=qy(e,S,C+90,t),R=qy(e,S,C-90,t),D=i4(Ao([z.geometry.coordinates,R.geometry.coordinates]),Ao([_.geometry.coordinates,x.geometry.coordinates])),P=null;D.features.length>0&&(P=D.features[0],P.properties.dist=Fu(e,P,t),P.properties.location=l+Fu(_,P,t)),_.properties.dist<n.properties.dist&&(n=_,n.properties.index=a,n.properties.location=l),x.properties.dist<n.properties.dist&&(n=x,n.properties.index=a+1,n.properties.location=l+k),P&&P.properties.dist<n.properties.dist&&(n=P,n.properties.index=a),l+=k}}),n}const s4=30;class a4{constructor(e,t,n,l,u){this.onMouseMove=f=>{if(!this.active)return;const a=[f.point.x-s4,f.point.y],_=this.map.unproject(f.point).distanceTo(this.map.unproject(a));this.inner.onMouseMove(f.lngLat.lng,f.lngLat.lat,_)&&(this.redraw(),this.dataUpdated())},this.onClick=()=>{this.active&&(this.inner.onClick(),this.redraw(),this.dataUpdated())},this.onDoubleClick=f=>{this.active&&(f.preventDefault(),this.inner.onClick(),this.finish())},this.onDragStart=()=>{this.active&&this.inner.onDragStart()&&this.map.dragPan.disable()},this.onMouseUp=()=>{this.active&&this.inner.onMouseUp()&&this.map.dragPan.enable()},this.onKeyDown=f=>{if(!this.active)return;let a=f.target.tagName;a=="INPUT"||a=="TEXTAREA"||f.key=="Escape"&&(f.stopPropagation(),this.cancel())},this.onKeyPress=f=>{if(!this.active)return;let a=f.target.tagName;a=="INPUT"||a=="TEXTAREA"||(f.key=="Enter"?(f.stopPropagation(),this.finish()):f.key=="s"||f.key=="S"?(f.stopPropagation(),this.inner.toggleSnapMode(),this.redraw()):f.key=="z"&&f.ctrlKey&&this.undo())},this.map=e,console.time("Deserialize and setup JsRouteSnapper"),this.inner=new gd(t),console.timeEnd("Deserialize and setup JsRouteSnapper"),this.active=!1,this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[],this.routeToolGj=n,this.snapMode=l,this.undoLength=u,this.map.on("mousemove",this.onMouseMove),this.map.on("click",this.onClick),this.map.on("dblclick",this.onDoubleClick),this.map.on("dragstart",this.onDragStart),this.map.on("mouseup",this.onMouseUp),document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keypress",this.onKeyPress)}tearDown(){this.map.off("mousemove",this.onMouseMove),this.map.off("click",this.onClick),this.map.off("dblclick",this.onDoubleClick),this.map.off("dragstart",this.onDragStart),this.map.off("mouseup",this.onMouseUp),document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keypress",this.onKeyPress)}startRoute(){this.active||(this.active=!0,this.map.boxZoom.disable(),this.map.doubleClickZoom.disable())}startArea(){this.active||(this.inner.setAreaMode(),this.active=!0,this.map.boxZoom.disable(),this.map.doubleClickZoom.disable())}stop(){this.active=!1,this.inner.clearState(),this.redraw(),this.map.boxZoom.enable(),this.map.doubleClickZoom.enable()}editExistingRoute(e){this.active&&window.alert("Bug: editExistingRoute called when tool is already active"),e.properties.waypoints||(e.properties.waypoints=[{lon:e.geometry.coordinates[0][0],lat:e.geometry.coordinates[0][1],snapped:!0},{lon:e.geometry.coordinates[e.geometry.coordinates.length-1][0],lat:e.geometry.coordinates[e.geometry.coordinates.length-1][1],snapped:!0}]),this.startRoute(),this.inner.editExisting(e.properties.waypoints),this.redraw()}editExistingArea(e){this.active&&window.alert("Bug: editExistingArea called when tool is already active"),e.properties.waypoints||window.alert("Bug: editExistingArea called for a polygon not produced by the route-snapper"),this.startArea(),this.inner.editExisting(e.properties.waypoints),this.redraw()}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerUpdated(e){this.eventListenersUpdated.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}clearEventListeners(){this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[]}isActive(){return this.active}finish(){let e=this.inner.toFinalFeature();if(e)for(let t of this.eventListenersSuccess)t(JSON.parse(e));else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){this.inner.clearState(),this.finish()}setRouteConfig(e){this.inner.setRouteConfig(e),this.redraw()}addSnappedWaypoint(e){this.inner.addSnappedWaypoint(e[0],e[1]),this.redraw()}undo(){this.inner.undo(),this.redraw()}toggleSnapMode(){this.inner.toggleSnapMode(),this.redraw()}redraw(){let e=JSON.parse(this.inner.renderGeojson());this.routeToolGj.set(e),this.map.getCanvas().style.cursor=e.cursor,this.snapMode.set(e.snap_mode),this.undoLength.set(e.undo_length)}dataUpdated(){let e=this.inner.toFinalFeature();if(e)for(let t of this.eventListenersUpdated)t(JSON.parse(e))}}const Nm="MZEJTanw3WpxRvt7qDfo";let cs=Tr(null),jm=Tr("streets-v2"),ph=Tr(!1),fa=Tr(""),vd=Tr(!0),Yn=Tr(null),mh=Tr(new ga.LngLat(0,0)),gh=Tr(new ga.LngLat(0,0)),Um=Tr(new ga.LngLat(0,0)),Hy=Tr(1),Ls=Tr(1),or=Tr({mode:"title"}),Vm=Tr("walk_cycle_only"),Xy=Tr(!1),_h=Tr(!1);function Tc(){let r=Hi(fa);r||window.alert("Autosave failed; no projectName set?!"),window.localStorage.setItem(r,Hi(Yn).toSavefile())}function Ky(r){let e,t;return e=new Nd({props:{$$slots:{default:[l4,({dialog:n})=>({3:n}),({dialog:n})=>n?8:0]},$$scope:{ctx:r}}}),e.$on("close",r[2]),{c(){Oe(e.$$.fragment)},m(n,l){Be(e,n,l),t=!0},p(n,l){const u={};l&24&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(oe(e.$$.fragment,n),t=!0)},o(n){ue(e.$$.fragment,n),t=!1},d(n){Fe(e,n)}}}function l4(r){let e,t,n,l,u,f,a,_,x,k,S,C,z,R;function D(){return r[1](r[3])}return{c(){e=ce("h1"),e.textContent="The low-traffic neighbourhood (LTN) tool, v2",t=Ue(),n=ce("p"),n.innerHTML=`This is an <b>experimental</b>
      version of the
      <a href="https://a-b-street.github.io/docs/software/ltn/index.html" target="_blank">A/B Street LTN tool</a>
      . Most parts of it do not work yet, and you should probably use the other version
      of the tool instead.`,l=Ue(),u=ce("p"),u.textContent="To use this tool, you need to:",f=Ue(),a=ce("ol"),a.innerHTML=`<li>Choose your study area to analyze</li> <li>Define one or more neighbourhood boundaries</li> <li>Optionally, fix the basemap data on existing modal filters, turn
        restrictions, one-ways, etc</li> <li>Create one or more proposals with new modal filters, and explore their
        effects</li>`,_=Ue(),x=ce("p"),x.innerHTML=`This tool is created by <a href="https://github.com/dabreegster/" target="_blank">Dustin Carlino</a>
      and relies heavily on
      <a href="https://www.openstreetmap.org/about" target="_blank">OpenStreetMap</a>
      data.`,k=Ue(),S=ce("center"),C=ce("button"),C.textContent="Start!"},m(P,B){me(P,e,B),me(P,t,B),me(P,n,B),me(P,l,B),me(P,u,B),me(P,f,B),me(P,a,B),me(P,_,B),me(P,x,B),me(P,k,B),me(P,S,B),re(S,C),z||(R=Ct(C,"click",D),z=!0)},p(P,B){r=P},d(P){P&&(pe(e),pe(t),pe(n),pe(l),pe(u),pe(f),pe(a),pe(_),pe(x),pe(k),pe(S)),z=!1,R()}}}function c4(r){let e,t,n=r[0]&&Ky(r);return{c(){n&&n.c(),e=Hn()},m(l,u){n&&n.m(l,u),me(l,e,u),t=!0},p(l,[u]){l[0]?n?(n.p(l,u),u&1&&oe(n,1)):(n=Ky(l),n.c(),oe(n,1),n.m(e.parentNode,e)):n&&(vr(),ue(n,1,1,()=>{n=null}),br())},i(l){t||(oe(n),t=!0)},o(l){ue(n),t=!1},d(l){l&&pe(e),n&&n.d(l)}}}function u4(r,e,t){let n;return pt(r,vd,f=>t(0,n=f)),[n,f=>rn(f).close(),()=>Lt(vd,n=!1,n)]}class h4 extends Zt{constructor(e){super(),Wt(this,e,u4,c4,Vt,{})}}const f4="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAk0lEQVRIS+3U0Q2AIAwEUNjMUXQydRJH0zZB0wjGuwJfSsKfuWfO1hg6n9g5P3wPWKTSXe6EVstUNEjoloIVghAG0OxR7swgLEAjHoBCvACM1AAQUgJ0DL0nm67WwJom7XrBlhVl4arUAHYniuE1ABTuBeBwD0CFs4D92T12fp9v9iPrnJ8LBu0KC0Ch9qEfeK3sAPceHxk8hJ17AAAAAElFTkSuQmCC",d4="/ltn/assets/logo-97f2d067.svg";let p4=Date.now();function Dc(r){return`${r}-${p4++}`}const zg=Symbol.for("svelte-maplibre");function ol(){return Lb(zg)}function m4(r){let e=new WeakMap;return t=>{var f;let n=e.get(t.originalEvent);if(n!==void 0)return n;let u=(f=t.target.queryRenderedFeatures(t.point).find(a=>{var _;return(_=r.get(a.layer.id))==null?void 0:_.interactive}))==null?void 0:f.layer.id;return e.set(t.originalEvent,u),u}}function g4(){let r=new Map;return Tg(zg,{map:Tr(null),source:nm(null),layer:nm(null),popupTarget:nm(null),cluster:Tr(),loadedImages:Tr(new Set),minzoom:Tr(0),maxzoom:Tr(24),layerEvent:Tr(null),layerInfo:r,eventTopMost:m4(r),markerClickManager:new w4})}function Jy(r){return{subscribe:r.subscribe}}function Dg({key:r,setPopupTarget:e=!1,setCluster:t=!1,setMouseEvent:n=!1}){let l=ol(),u=Tr(null),f=Jy(u),a={...l,[r]:Jy(u)};if(e&&(a.popupTarget=f),n){let _=Tr(null);a.layerEvent=_,l.layerEvent=_}return t&&(a.cluster=Tr()),Tg(zg,a),{...l,self:u}}function _4(){return Dg({key:"source",setCluster:!0})}function y4(r=!0){return Dg({key:"layer",setPopupTarget:r,setMouseEvent:r})}function v4(){return Dg({key:"popupTarget",setPopupTarget:!0,setMouseEvent:!0})}function b4(r){return"layerType"in r&&r.layerType==="deckgl"}class w4{constructor(){Wn(this,"_handlers",new Set)}add(e){this._handlers.add(e)}remove(e){this._handlers.delete(e)}handleClick(e){for(const t of this._handlers)t(e)}}function Yy(r){let e;return t=>{if(t)for(let n in t){let l=e==null?void 0:e[n],u=t[n];l!==u&&r(n,u,l)}else if(e)for(let n in e)r(n,void 0,e[n]);e=t}}function x4(r,...e){let t=[r];for(let n of e)if(n)Array.isArray(n)&&n[0]===r?t.push(...n.slice(1)):t.push(n);else continue;if(t.length!==1)return t.length===2?t[1]:t}function S4(r){return r===!0?["has","point_count"]:r===!1?["!",["has","point_count"]]:void 0}function nl(r,e){return["case",["boolean",["feature-state","hover"],!1],e,r]}var il=k4;function k4(r){var e,t,n;if(r){if(Array.isArray(r)){for(e=[],t=r.length,n=0;n<t;n++){var l=r[n];l!=null&&e.push(l)}return e}if(typeof r=="object"){e={};var u=Object.keys(r);for(t=u.length,n=0;n<t;n++){var f=u[n],a=r[f];a!=null&&(e[f]=a)}return e}}}function Qy(r){let e=r[0],t,n,l=e0(r);return{c(){l.c(),t=Hn()},m(u,f){l.m(u,f),me(u,t,f),n=!0},p(u,f){f[0]&1&&Vt(e,e=u[0])?(vr(),ue(l,1,1,It),br(),l=e0(u),l.c(),oe(l,1),l.m(t.parentNode,t)):l.p(u,f)},i(u){n||(oe(l),n=!0)},o(u){ue(l),n=!1},d(u){u&&pe(t),l.d(u)}}}function e0(r){let e;const t=r[36].default,n=$r(t,r,r[35],null);return{c(){n&&n.c()},m(l,u){n&&n.m(l,u),e=!0},p(l,u){n&&n.p&&(!e||u[1]&16)&&Gr(n,t,l,l[35],e?qr(t,l[35],u,null):Wr(l[35]),null)},i(l){e||(oe(n,l),e=!0)},o(l){ue(n,l),e=!1},d(l){n&&n.d(l)}}}function T4(r){let e,t,n=r[0]&&Qy(r);return{c(){n&&n.c(),e=Hn()},m(l,u){n&&n.m(l,u),me(l,e,u),t=!0},p(l,u){l[0]?n?(n.p(l,u),u[0]&1&&oe(n,1)):(n=Qy(l),n.c(),oe(n,1),n.m(e.parentNode,e)):n&&(vr(),ue(n,1,1,()=>{n=null}),br())},i(l){t||(oe(n),t=!0)},o(l){ue(n),t=!1},d(l){l&&pe(e),n&&n.d(l)}}}function E4(r,e,t){let n,l,u,f,a,_,x,k,S,C,z,R,{$$slots:D={},$$scope:P}=e,{id:B=Dc("layer")}=e,{source:N=void 0}=e,{sourceLayer:V=void 0}=e,{beforeId:U=void 0}=e,{beforeLayerType:te=void 0}=e,{type:le}=e,{paint:H=void 0}=e,{layout:J=void 0}=e,{filter:ye=void 0}=e,{applyToClusters:ze=void 0}=e,{minzoom:ne=void 0}=e,{maxzoom:be=void 0}=e,{manageHoverState:He=!1}=e,{hovered:Ce=null}=e,{interactive:Qe=!0}=e,{hoverCursor:_t=void 0}=e,{eventsIfTopMost:Ut=!1}=e;const Je=us(),{map:Yt,source:Kt,self:Ft,minzoom:Ot,maxzoom:Jt,eventTopMost:Et,layerInfo:sr}=y4();pt(r,Yt,De=>t(31,S=De)),pt(r,Kt,De=>t(32,C=De)),pt(r,Ft,De=>t(0,k=De)),pt(r,Ot,De=>t(34,R=De)),pt(r,Jt,De=>t(33,z=De)),ni(()=>{k&&S&&(sr.delete(k),S==null||S.removeLayer(k))});let zt;function rr(De){var ie,nr;if(!Qe||!k||!S||Ut&&Et(De)!==k)return;let ut=De.features??[],it=(nr=(ie=ut[0])==null?void 0:ie.properties)==null?void 0:nr.cluster_id,xt={event:De,map:S,clusterId:it,layer:k,source:a,features:ut};Je(De.type,xt)}function wr(De){var ie,nr;if(!Qe||!k||!S||Ut&&Et(De)!==k)return;_t&&(S.getCanvas().style.cursor=_t);let ut=De.features??[];t(6,Ce=ut[0]??null);let it=(nr=(ie=ut[0])==null?void 0:ie.properties)==null?void 0:nr.cluster_id;Je("mouseenter",{event:De,map:S,clusterId:it,layer:k,source:a,features:ut})}function gr(De){var ie,nr,Ne;if(!Qe||!S)return;if(Ut&&Et(De)!==k){t(6,Ce=null),He&&zt!==void 0&&(S==null||S.setFeatureState({source:a,sourceLayer:V,id:zt},{hover:!1}),zt=void 0);return}S.getCanvas().style.cursor=_t;let ut=De.features??[],it=(nr=(ie=ut[0])==null?void 0:ie.properties)==null?void 0:nr.cluster_id,xt=(Ne=ut[0])==null?void 0:Ne.id;xt!==zt&&(He&&(zt!==void 0&&(S==null||S.setFeatureState({source:a,id:zt,sourceLayer:V},{hover:!1})),S==null||S.setFeatureState({source:a,id:xt,sourceLayer:V},{hover:!0})),zt=xt,t(6,Ce=ut[0]??null)),Je("mousemove",{event:De,map:S,clusterId:it,layer:k,source:a,features:ut})}function Br(De){if(!(!Qe||!k||!S)){if(_t&&(S.getCanvas().style.cursor=""),t(6,Ce=null),He&&zt!==void 0){const ut={source:a,id:zt,sourceLayer:V};S==null||S.setFeatureState(ut,{hover:!1}),zt=void 0}Je("mouseleave",{map:S,layer:k,source:a})}}let ht=!0;function Mt(De){S&&(S.off("click",De,rr),S.off("dblclick",De,rr),S.off("contextmenu",De,rr),S.off("mouseenter",De,wr),S.off("mousemove",De,gr),S.off("mouseleave",De,Br))}return ni(()=>{S&&k&&Mt(k)}),r.$$set=De=>{"id"in De&&t(7,B=De.id),"source"in De&&t(8,N=De.source),"sourceLayer"in De&&t(9,V=De.sourceLayer),"beforeId"in De&&t(10,U=De.beforeId),"beforeLayerType"in De&&t(11,te=De.beforeLayerType),"type"in De&&t(12,le=De.type),"paint"in De&&t(13,H=De.paint),"layout"in De&&t(14,J=De.layout),"filter"in De&&t(15,ye=De.filter),"applyToClusters"in De&&t(16,ze=De.applyToClusters),"minzoom"in De&&t(17,ne=De.minzoom),"maxzoom"in De&&t(18,be=De.maxzoom),"manageHoverState"in De&&t(19,He=De.manageHoverState),"hovered"in De&&t(6,Ce=De.hovered),"interactive"in De&&t(20,Qe=De.interactive),"hoverCursor"in De&&t(21,_t=De.hoverCursor),"eventsIfTopMost"in De&&t(22,Ut=De.eventsIfTopMost),"$$scope"in De&&t(35,P=De.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&65536&&t(30,n=S4(ze)),r.$$.dirty[0]&1073774592&&t(24,l=x4("all",n,ye)),r.$$.dirty[0]&131072|r.$$.dirty[1]&8&&t(26,u=ne??R),r.$$.dirty[0]&262144|r.$$.dirty[1]&4&&t(25,f=be??z),r.$$.dirty[0]&256|r.$$.dirty[1]&2&&t(29,a=N||C),r.$$.dirty[0]&654343809|r.$$.dirty[1]&1&&S&&k!==B&&a){k&&(Mt(k),sr.delete(k));let De=U;if(!U&&te){let ut=S.getStyle().layers,it=typeof te=="function"?te:ie=>ie.type===te,xt=ut==null?void 0:ut.find(it);xt&&(De=xt.id)}Lt(Ft,k=B,k),S.addLayer(il({id:k,type:le,source:a,"source-layer":V,filter:l,paint:H,layout:J,minzoom:u,maxzoom:f}),De),t(23,ht=!0),S.on("click",k,rr),S.on("dblclick",k,rr),S.on("contextmenu",k,rr),S.on("mouseenter",k,wr),S.on("mousemove",k,gr),S.on("mouseleave",k,Br)}r.$$.dirty[0]&1048577&&k&&sr.set(k,{interactive:Qe}),r.$$.dirty[0]&1|r.$$.dirty[1]&1&&t(28,_=k?Yy((De,ut)=>{S!=null&&S.style._loaded?S.setPaintProperty(k,De,ut):S==null||S.once("styledata",()=>S==null?void 0:S.setPaintProperty(k,De,ut))}):void 0),r.$$.dirty[0]&1|r.$$.dirty[1]&1&&t(27,x=k?Yy((De,ut)=>{S!=null&&S.style._loaded?S.setLayoutProperty(k,De,ut):S==null||S.once("styledata",()=>S==null?void 0:S.setLayoutProperty(k,De,ut))}):void 0),r.$$.dirty[0]&268443648&&(_==null||_(H)),r.$$.dirty[0]&134234112&&(x==null||x(J)),r.$$.dirty[0]&100663297|r.$$.dirty[1]&1&&k&&(S==null||S.setLayerZoomRange(k,u,f)),r.$$.dirty[0]&25165825|r.$$.dirty[1]&1&&k&&(ht?t(23,ht=!1):S==null||S.setFilter(k,l))},[k,Yt,Kt,Ft,Ot,Jt,Ce,B,N,V,U,te,le,H,J,ye,ze,ne,be,He,Qe,_t,Ut,ht,l,f,u,x,_,a,n,S,C,z,R,P,D]}let $d=class extends Zt{constructor(e){super(),Wt(this,e,E4,T4,Vt,{id:7,source:8,sourceLayer:9,beforeId:10,beforeLayerType:11,type:12,paint:13,layout:14,filter:15,applyToClusters:16,minzoom:17,maxzoom:18,manageHoverState:19,hovered:6,interactive:20,hoverCursor:21,eventsIfTopMost:22},null,[-1,-1])}};function C4(r){let e;const t=r[16].default,n=$r(t,r,r[24],null);return{c(){n&&n.c()},m(l,u){n&&n.m(l,u),e=!0},p(l,u){n&&n.p&&(!e||u&16777216)&&Gr(n,t,l,l[24],e?qr(t,l[24],u,null):Wr(l[24]),null)},i(l){e||(oe(n,l),e=!0)},o(l){ue(n,l),e=!1},d(l){n&&n.d(l)}}}function M4(r){let e,t,n;function l(f){r[17](f)}let u={id:r[1],type:"circle",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],applyToClusters:r[9],minzoom:r[10],maxzoom:r[11],hoverCursor:r[12],manageHoverState:r[13],eventsIfTopMost:r[14],interactive:r[15],$$slots:{default:[C4]},$$scope:{ctx:r}};return r[0]!==void 0&&(u.hovered=r[0]),e=new $d({props:u}),nn.push(()=>no(e,"hovered",l)),e.$on("click",r[18]),e.$on("dblclick",r[19]),e.$on("contextmenu",r[20]),e.$on("mouseenter",r[21]),e.$on("mousemove",r[22]),e.$on("mouseleave",r[23]),{c(){Oe(e.$$.fragment)},m(f,a){Be(e,f,a),n=!0},p(f,[a]){const _={};a&2&&(_.id=f[1]),a&4&&(_.source=f[2]),a&8&&(_.sourceLayer=f[3]),a&16&&(_.beforeId=f[4]),a&32&&(_.beforeLayerType=f[5]),a&64&&(_.paint=f[6]),a&128&&(_.layout=f[7]),a&256&&(_.filter=f[8]),a&512&&(_.applyToClusters=f[9]),a&1024&&(_.minzoom=f[10]),a&2048&&(_.maxzoom=f[11]),a&4096&&(_.hoverCursor=f[12]),a&8192&&(_.manageHoverState=f[13]),a&16384&&(_.eventsIfTopMost=f[14]),a&32768&&(_.interactive=f[15]),a&16777216&&(_.$$scope={dirty:a,ctx:f}),!t&&a&1&&(t=!0,_.hovered=f[0],ro(()=>t=!1)),e.$set(_)},i(f){n||(oe(e.$$.fragment,f),n=!0)},o(f){ue(e.$$.fragment,f),n=!1},d(f){Fe(e,f)}}}function I4(r,e,t){let{$$slots:n={},$$scope:l}=e,{id:u=Dc("circle")}=e,{source:f=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:_=void 0}=e,{beforeLayerType:x=void 0}=e,{paint:k}=e,{layout:S=void 0}=e,{filter:C=void 0}=e,{applyToClusters:z=void 0}=e,{minzoom:R=void 0}=e,{maxzoom:D=void 0}=e,{hoverCursor:P=void 0}=e,{manageHoverState:B=!1}=e,{hovered:N=null}=e,{eventsIfTopMost:V=!1}=e,{interactive:U=!0}=e;function te(be){N=be,t(0,N)}function le(be){fr.call(this,r,be)}function H(be){fr.call(this,r,be)}function J(be){fr.call(this,r,be)}function ye(be){fr.call(this,r,be)}function ze(be){fr.call(this,r,be)}function ne(be){fr.call(this,r,be)}return r.$$set=be=>{"id"in be&&t(1,u=be.id),"source"in be&&t(2,f=be.source),"sourceLayer"in be&&t(3,a=be.sourceLayer),"beforeId"in be&&t(4,_=be.beforeId),"beforeLayerType"in be&&t(5,x=be.beforeLayerType),"paint"in be&&t(6,k=be.paint),"layout"in be&&t(7,S=be.layout),"filter"in be&&t(8,C=be.filter),"applyToClusters"in be&&t(9,z=be.applyToClusters),"minzoom"in be&&t(10,R=be.minzoom),"maxzoom"in be&&t(11,D=be.maxzoom),"hoverCursor"in be&&t(12,P=be.hoverCursor),"manageHoverState"in be&&t(13,B=be.manageHoverState),"hovered"in be&&t(0,N=be.hovered),"eventsIfTopMost"in be&&t(14,V=be.eventsIfTopMost),"interactive"in be&&t(15,U=be.interactive),"$$scope"in be&&t(24,l=be.$$scope)},[N,u,f,a,_,x,k,S,C,z,R,D,P,B,V,U,n,te,le,H,J,ye,ze,ne,l]}let Rg=class extends Zt{constructor(e){super(),Wt(this,e,I4,M4,Vt,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}};function A4(r){let e;const t=r[15].default,n=$r(t,r,r[23],null);return{c(){n&&n.c()},m(l,u){n&&n.m(l,u),e=!0},p(l,u){n&&n.p&&(!e||u&8388608)&&Gr(n,t,l,l[23],e?qr(t,l[23],u,null):Wr(l[23]),null)},i(l){e||(oe(n,l),e=!0)},o(l){ue(n,l),e=!1},d(l){n&&n.d(l)}}}function L4(r){let e,t,n;function l(f){r[16](f)}let u={id:r[1],type:"fill",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],minzoom:r[9],maxzoom:r[10],hoverCursor:r[11],manageHoverState:r[12],eventsIfTopMost:r[13],interactive:r[14],$$slots:{default:[A4]},$$scope:{ctx:r}};return r[0]!==void 0&&(u.hovered=r[0]),e=new $d({props:u}),nn.push(()=>no(e,"hovered",l)),e.$on("click",r[17]),e.$on("dblclick",r[18]),e.$on("contextmenu",r[19]),e.$on("mouseenter",r[20]),e.$on("mousemove",r[21]),e.$on("mouseleave",r[22]),{c(){Oe(e.$$.fragment)},m(f,a){Be(e,f,a),n=!0},p(f,[a]){const _={};a&2&&(_.id=f[1]),a&4&&(_.source=f[2]),a&8&&(_.sourceLayer=f[3]),a&16&&(_.beforeId=f[4]),a&32&&(_.beforeLayerType=f[5]),a&64&&(_.paint=f[6]),a&128&&(_.layout=f[7]),a&256&&(_.filter=f[8]),a&512&&(_.minzoom=f[9]),a&1024&&(_.maxzoom=f[10]),a&2048&&(_.hoverCursor=f[11]),a&4096&&(_.manageHoverState=f[12]),a&8192&&(_.eventsIfTopMost=f[13]),a&16384&&(_.interactive=f[14]),a&8388608&&(_.$$scope={dirty:a,ctx:f}),!t&&a&1&&(t=!0,_.hovered=f[0],ro(()=>t=!1)),e.$set(_)},i(f){n||(oe(e.$$.fragment,f),n=!0)},o(f){ue(e.$$.fragment,f),n=!1},d(f){Fe(e,f)}}}function P4(r,e,t){let{$$slots:n={},$$scope:l}=e,{id:u=Dc("fill")}=e,{source:f=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:_=void 0}=e,{beforeLayerType:x=void 0}=e,{paint:k}=e,{layout:S=void 0}=e,{filter:C=void 0}=e,{minzoom:z=void 0}=e,{maxzoom:R=void 0}=e,{hoverCursor:D=void 0}=e,{manageHoverState:P=!1}=e,{hovered:B=null}=e,{eventsIfTopMost:N=!1}=e,{interactive:V=!0}=e;function U(ne){B=ne,t(0,B)}function te(ne){fr.call(this,r,ne)}function le(ne){fr.call(this,r,ne)}function H(ne){fr.call(this,r,ne)}function J(ne){fr.call(this,r,ne)}function ye(ne){fr.call(this,r,ne)}function ze(ne){fr.call(this,r,ne)}return r.$$set=ne=>{"id"in ne&&t(1,u=ne.id),"source"in ne&&t(2,f=ne.source),"sourceLayer"in ne&&t(3,a=ne.sourceLayer),"beforeId"in ne&&t(4,_=ne.beforeId),"beforeLayerType"in ne&&t(5,x=ne.beforeLayerType),"paint"in ne&&t(6,k=ne.paint),"layout"in ne&&t(7,S=ne.layout),"filter"in ne&&t(8,C=ne.filter),"minzoom"in ne&&t(9,z=ne.minzoom),"maxzoom"in ne&&t(10,R=ne.maxzoom),"hoverCursor"in ne&&t(11,D=ne.hoverCursor),"manageHoverState"in ne&&t(12,P=ne.manageHoverState),"hovered"in ne&&t(0,B=ne.hovered),"eventsIfTopMost"in ne&&t(13,N=ne.eventsIfTopMost),"interactive"in ne&&t(14,V=ne.interactive),"$$scope"in ne&&t(23,l=ne.$$scope)},[B,u,f,a,_,x,k,S,C,z,R,D,P,N,V,n,U,te,le,H,J,ye,ze,l]}let Ns=class extends Zt{constructor(e){super(),Wt(this,e,P4,L4,Vt,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}};function z4(r,e,t){let n;const{map:l}=ol();pt(r,l,_=>t(4,n=_));let{position:u="top-left"}=e,{container:f=void 0}=e,a=null;return ni(()=>{n!=null&&n.loaded()&&a&&n.removeControl(a)}),r.$$set=_=>{"position"in _&&t(1,u=_.position),"container"in _&&t(2,f=_.container)},r.$$.update=()=>{if(r.$$.dirty&30&&n&&!a){let _;typeof f=="string"?_=document.querySelector(f)??void 0:_=f,t(3,a=new to.FullscreenControl({container:_})),n.addControl(a,u)}},[l,u,f,a,n]}class D4 extends Zt{constructor(e){super(),Wt(this,e,z4,null,Vt,{position:1,container:2})}}function R4(r,e,t,n,l){let u=!1;r.getSource(e)&&(u=!0,r.removeSource(e));const f=()=>{n(e)&&(r.addSource(e,t),l())};if(u){const a=()=>{e&&(r.getSource(e)?setTimeout(a,1):f())};a()}else f()}function B4(r,e,t){Db().then(()=>{let n=Hi(r);if(!n)return;n.getSource(e)===t&&n.removeSource(e)})}function t0(r){let e=r[0],t,n,l=r0(r);return{c(){l.c(),t=Hn()},m(u,f){l.m(u,f),me(u,t,f),n=!0},p(u,f){f&1&&Vt(e,e=u[0])?(vr(),ue(l,1,1,It),br(),l=r0(u),l.c(),oe(l,1),l.m(t.parentNode,t)):l.p(u,f)},i(u){n||(oe(l),n=!0)},o(u){ue(l),n=!1},d(u){u&&pe(t),l.d(u)}}}function r0(r){let e;const t=r[19].default,n=$r(t,r,r[18],null);return{c(){n&&n.c()},m(l,u){n&&n.m(l,u),e=!0},p(l,u){n&&n.p&&(!e||u&262144)&&Gr(n,t,l,l[18],e?qr(t,l[18],u,null):Wr(l[18]),null)},i(l){e||(oe(n,l),e=!0)},o(l){ue(n,l),e=!1},d(l){n&&n.d(l)}}}function F4(r){let e,t,n=r[0]&&t0(r);return{c(){n&&n.c(),e=Hn()},m(l,u){n&&n.m(l,u),me(l,e,u),t=!0},p(l,[u]){l[0]?n?(n.p(l,u),u&1&&oe(n,1)):(n=t0(l),n.c(),oe(n,1),n.m(e.parentNode,e)):n&&(vr(),ue(n,1,1,()=>{n=null}),br())},i(l){t||(oe(n),t=!0)},o(l){ue(n),t=!1},d(l){l&&pe(e),n&&n.d(l)}}}function O4(r,e,t){let n,l,u,{$$slots:f={},$$scope:a}=e,{id:_=Dc("geojson")}=e,{data:x}=e,{generateId:k=!1}=e,{promoteId:S=void 0}=e,{filter:C=void 0}=e,{lineMetrics:z=void 0}=e,{cluster:R=void 0}=e,{maxzoom:D=void 0}=e,{attribution:P=void 0}=e,{buffer:B=void 0}=e,{tolerance:N=void 0}=e;const{map:V,cluster:U,self:te}=_4();pt(r,V,J=>t(17,l=J)),pt(r,U,J=>t(20,u=J)),pt(r,te,J=>t(0,n=J));let le,H=!0;return ni(()=>{n&&le&&l&&(B4(V,n,le),Lt(te,n=null,n),t(15,le=void 0))}),r.$$set=J=>{"id"in J&&t(4,_=J.id),"data"in J&&t(5,x=J.data),"generateId"in J&&t(6,k=J.generateId),"promoteId"in J&&t(7,S=J.promoteId),"filter"in J&&t(8,C=J.filter),"lineMetrics"in J&&t(9,z=J.lineMetrics),"cluster"in J&&t(10,R=J.cluster),"maxzoom"in J&&t(11,D=J.maxzoom),"attribution"in J&&t(12,P=J.attribution),"buffer"in J&&t(13,B=J.buffer),"tolerance"in J&&t(14,N=J.tolerance),"$$scope"in J&&t(18,a=J.$$scope)},r.$$.update=()=>{r.$$.dirty&1024&&Lt(U,u=R,u),r.$$.dirty&196593&&l&&n!==_&&(Lt(te,n=_,n),R4(l,n,il({type:"geojson",data:x,filter:C,lineMetrics:z,generateId:k,promoteId:S,cluster:!!R,clusterMinPoints:R==null?void 0:R.minPoints,clusterMaxZoom:R==null?void 0:R.maxZoom,clusterRadius:R==null?void 0:R.radius,clusterProperties:R==null?void 0:R.properties,maxzoom:D,attribution:P,buffer:B,tolerance:N}),J=>l&&J===n,()=>{n&&(t(15,le=l==null?void 0:l.getSource(n)),t(16,H=!0))})),r.$$.dirty&131088&&(l==null||l.on("style.load",()=>{t(15,le=l==null?void 0:l.getSource(_))})),r.$$.dirty&98336&&le&&(H?t(16,H=!1):le.setData(x)),r.$$.dirty&33792&&(le==null||le.setClusterOptions(il({cluster:!!R,clusterMaxZoom:R==null?void 0:R.maxZoom,clusterRadius:R==null?void 0:R.radius})))},[n,V,U,te,_,x,k,S,C,z,R,D,P,B,N,le,H,l,a,f]}let ri=class extends Zt{constructor(e){super(),Wt(this,e,O4,F4,Vt,{id:4,data:5,generateId:6,promoteId:7,filter:8,lineMetrics:9,cluster:10,maxzoom:11,attribution:12,buffer:13,tolerance:14})}};function N4(r,e,t){let n;const{map:l}=ol();pt(r,l,C=>t(8,n=C));let{position:u="top-left"}=e,{positionOptions:f=void 0}=e,{fitBoundsOptions:a=void 0}=e,{trackUserLocation:_=!1}=e,{showAccuracyCircle:x=!0}=e,{showUserLocation:k=!0}=e,{control:S=null}=e;return ni(()=>{n!=null&&n.loaded()&&S&&n.removeControl(S)}),r.$$set=C=>{"position"in C&&t(2,u=C.position),"positionOptions"in C&&t(3,f=C.positionOptions),"fitBoundsOptions"in C&&t(4,a=C.fitBoundsOptions),"trackUserLocation"in C&&t(5,_=C.trackUserLocation),"showAccuracyCircle"in C&&t(6,x=C.showAccuracyCircle),"showUserLocation"in C&&t(7,k=C.showUserLocation),"control"in C&&t(1,S=C.control)},r.$$.update=()=>{r.$$.dirty&510&&n&&!S&&(t(1,S=new to.GeolocateControl({positionOptions:f,fitBoundsOptions:a,trackUserLocation:_,showAccuracyCircle:x,showUserLocation:k})),n.addControl(S,u))},[l,S,u,f,a,_,x,k,n]}class j4 extends Zt{constructor(e){super(),Wt(this,e,N4,null,Vt,{position:2,positionOptions:3,fitBoundsOptions:4,trackUserLocation:5,showAccuracyCircle:6,showUserLocation:7,control:1})}}function U4(r){let e;const t=r[15].default,n=$r(t,r,r[23],null);return{c(){n&&n.c()},m(l,u){n&&n.m(l,u),e=!0},p(l,u){n&&n.p&&(!e||u&8388608)&&Gr(n,t,l,l[23],e?qr(t,l[23],u,null):Wr(l[23]),null)},i(l){e||(oe(n,l),e=!0)},o(l){ue(n,l),e=!1},d(l){n&&n.d(l)}}}function V4(r){let e,t,n;function l(f){r[16](f)}let u={id:r[1],type:"line",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],minzoom:r[9],maxzoom:r[10],hoverCursor:r[11],manageHoverState:r[12],eventsIfTopMost:r[13],interactive:r[14],$$slots:{default:[U4]},$$scope:{ctx:r}};return r[0]!==void 0&&(u.hovered=r[0]),e=new $d({props:u}),nn.push(()=>no(e,"hovered",l)),e.$on("click",r[17]),e.$on("dblclick",r[18]),e.$on("contextmenu",r[19]),e.$on("mouseenter",r[20]),e.$on("mousemove",r[21]),e.$on("mouseleave",r[22]),{c(){Oe(e.$$.fragment)},m(f,a){Be(e,f,a),n=!0},p(f,[a]){const _={};a&2&&(_.id=f[1]),a&4&&(_.source=f[2]),a&8&&(_.sourceLayer=f[3]),a&16&&(_.beforeId=f[4]),a&32&&(_.beforeLayerType=f[5]),a&64&&(_.paint=f[6]),a&128&&(_.layout=f[7]),a&256&&(_.filter=f[8]),a&512&&(_.minzoom=f[9]),a&1024&&(_.maxzoom=f[10]),a&2048&&(_.hoverCursor=f[11]),a&4096&&(_.manageHoverState=f[12]),a&8192&&(_.eventsIfTopMost=f[13]),a&16384&&(_.interactive=f[14]),a&8388608&&(_.$$scope={dirty:a,ctx:f}),!t&&a&1&&(t=!0,_.hovered=f[0],ro(()=>t=!1)),e.$set(_)},i(f){n||(oe(e.$$.fragment,f),n=!0)},o(f){ue(e.$$.fragment,f),n=!1},d(f){Fe(e,f)}}}function $4(r,e,t){let{$$slots:n={},$$scope:l}=e,{id:u=Dc("line")}=e,{source:f=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:_=void 0}=e,{beforeLayerType:x=void 0}=e,{paint:k}=e,{layout:S=void 0}=e,{filter:C=void 0}=e,{minzoom:z=void 0}=e,{maxzoom:R=void 0}=e,{hoverCursor:D=void 0}=e,{manageHoverState:P=!1}=e,{hovered:B=null}=e,{eventsIfTopMost:N=!1}=e,{interactive:V=!0}=e;function U(ne){B=ne,t(0,B)}function te(ne){fr.call(this,r,ne)}function le(ne){fr.call(this,r,ne)}function H(ne){fr.call(this,r,ne)}function J(ne){fr.call(this,r,ne)}function ye(ne){fr.call(this,r,ne)}function ze(ne){fr.call(this,r,ne)}return r.$$set=ne=>{"id"in ne&&t(1,u=ne.id),"source"in ne&&t(2,f=ne.source),"sourceLayer"in ne&&t(3,a=ne.sourceLayer),"beforeId"in ne&&t(4,_=ne.beforeId),"beforeLayerType"in ne&&t(5,x=ne.beforeLayerType),"paint"in ne&&t(6,k=ne.paint),"layout"in ne&&t(7,S=ne.layout),"filter"in ne&&t(8,C=ne.filter),"minzoom"in ne&&t(9,z=ne.minzoom),"maxzoom"in ne&&t(10,R=ne.maxzoom),"hoverCursor"in ne&&t(11,D=ne.hoverCursor),"manageHoverState"in ne&&t(12,P=ne.manageHoverState),"hovered"in ne&&t(0,B=ne.hovered),"eventsIfTopMost"in ne&&t(13,N=ne.eventsIfTopMost),"interactive"in ne&&t(14,V=ne.interactive),"$$scope"in ne&&t(23,l=ne.$$scope)},[B,u,f,a,_,x,k,S,C,z,R,D,P,N,V,n,U,te,le,H,J,ye,ze,l]}let Ro=class extends Zt{constructor(e){super(),Wt(this,e,$4,V4,Vt,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}};function q4(r,e,t){let n;const l=us();let{layer:u=void 0}=e;const{map:f}=ol();pt(r,f,k=>t(2,n=k));function a(k){l(k.type,{...k,map:f})}const _=["click","dblclick","mousedown","mouseup","mousemove","mouseenter","mouseleave","contextmenu","mouseover","mouseout"],x=["click","dblclick","contextmenu","mousemove","movestart","moveend","zoomstart","zoom","zoomend"];return ni(()=>{if(n)if(u)for(const k of _)n.off(k,u,a);else for(const k of x)n.off(k,a)}),r.$$set=k=>{"layer"in k&&t(1,u=k.layer)},r.$$.update=()=>{if(r.$$.dirty&6&&n)if(u)for(const k of _)n.on(k,u,a);else for(const k of x)n.on(k,a)},[f,u,n]}class G4 extends Zt{constructor(e){super(),Wt(this,e,q4,null,Vt,{layer:1})}}function W4(r){let e=r.getCenter(),t=Math.round(r.getZoom()*100)/100,n=Math.ceil((t*Math.LN2+Math.log(512/360/.5))/Math.LN10),l=Math.pow(10,n),u=Math.round(e.lat*l)/l,f=Math.round(e.lng*l)/l,a=`${t}/${u}/${f}`,_=r.getBearing(),x=r.getPitch();return(_||x)&&(a+=`/${Math.round(_*10)/10}`),x&&(a+=`/${Math.round(x)}`),`#${a}`}function Z4(r){return r.replace("#","").split("/").map(parseFloat)}var lc=Bg;function Bg(r,e){return r===e||r!==r&&e!==e?!0:typeof r!=typeof e||{}.toString.call(r)!={}.toString.call(e)||r!==Object(r)||!r?!1:Array.isArray(r)?n0(r,e):{}.toString.call(r)=="[object Set]"?n0(Array.from(r),Array.from(e)):{}.toString.call(r)=="[object Object]"?X4(r,e):H4(r,e)}function H4(r,e){return r.toString()===e.toString()}function n0(r,e){var t=r.length;if(t!=e.length)return!1;for(var n=0;n<t;n++)if(!Bg(r[n],e[n]))return!1;return!0}function X4(r,e){var t=Object.keys(r),n=t.length;if(n!=Object.keys(e).length)return!1;for(var l=0;l<n;l++){var u=t[l];if(!(e.hasOwnProperty(u)&&Bg(r[u],e[u])))return!1}return!0}function K4(r,e,t){let n;const{map:l}=ol();pt(r,l,k=>t(6,n=k));let{position:u="top-left"}=e,{showCompass:f=!0}=e,{showZoom:a=!0}=e,{visualizePitch:_=!1}=e,x=null;return ni(()=>{n!=null&&n.loaded()&&x&&n.removeControl(x)}),r.$$set=k=>{"position"in k&&t(1,u=k.position),"showCompass"in k&&t(2,f=k.showCompass),"showZoom"in k&&t(3,a=k.showZoom),"visualizePitch"in k&&t(4,_=k.visualizePitch)},r.$$.update=()=>{r.$$.dirty&126&&n&&!x&&(t(5,x=new to.NavigationControl({showCompass:f,showZoom:a,visualizePitch:_})),n.addControl(x,u))},[l,u,f,a,_,x,n]}class J4 extends Zt{constructor(e){super(),Wt(this,e,K4,null,Vt,{position:1,showCompass:2,showZoom:3,visualizePitch:4})}}function Y4(r,e,t){let n;const{map:l}=ol();pt(r,l,x=>t(5,n=x));let{position:u="bottom-left"}=e,{maxWidth:f=void 0}=e,{unit:a="metric"}=e,_=null;return ni(()=>{n!=null&&n.loaded()&&_&&n.removeControl(_)}),r.$$set=x=>{"position"in x&&t(1,u=x.position),"maxWidth"in x&&t(2,f=x.maxWidth),"unit"in x&&t(3,a=x.unit)},r.$$.update=()=>{r.$$.dirty&62&&n&&!_&&(t(4,_=new to.ScaleControl({maxWidth:f,unit:a})),n.addControl(_,u))},[l,u,f,a,_,n]}class Q4 extends Zt{constructor(e){super(),Wt(this,e,Y4,null,Vt,{position:1,maxWidth:2,unit:3})}}const{window:e3}=Fd,t3=r=>({map:r[0]&16,loadedImages:r[0]&32,allImagesLoaded:r[0]&64}),i0=r=>({map:r[4],loadedImages:r[5],allImagesLoaded:r[6]});function o0(r){let e,t,n=r[3]&&s0(r);const l=r[46].default,u=$r(l,r,r[45],i0);return{c(){n&&n.c(),e=Ue(),u&&u.c()},m(f,a){n&&n.m(f,a),me(f,e,a),u&&u.m(f,a),t=!0},p(f,a){f[3]?n?(n.p(f,a),a[0]&8&&oe(n,1)):(n=s0(f),n.c(),oe(n,1),n.m(e.parentNode,e)):n&&(vr(),ue(n,1,1,()=>{n=null}),br()),u&&u.p&&(!t||a[0]&112|a[1]&16384)&&Gr(u,l,f,f[45],t?qr(l,f[45],a,t3):Wr(f[45]),i0)},i(f){t||(oe(n),oe(u,f),t=!0)},o(f){ue(n),ue(u,f),t=!1},d(f){f&&pe(e),n&&n.d(f),u&&u.d(f)}}}function s0(r){let e,t,n,l,u,f,a,_;return e=new J4({props:{position:r[7]}}),n=new j4({props:{position:r[7],fitBoundsOptions:{maxZoom:12}}}),u=new D4({props:{position:r[7]}}),a=new Q4({props:{position:r[7]}}),{c(){Oe(e.$$.fragment),t=Ue(),Oe(n.$$.fragment),l=Ue(),Oe(u.$$.fragment),f=Ue(),Oe(a.$$.fragment)},m(x,k){Be(e,x,k),me(x,t,k),Be(n,x,k),me(x,l,k),Be(u,x,k),me(x,f,k),Be(a,x,k),_=!0},p(x,k){const S={};k[0]&128&&(S.position=x[7]),e.$set(S);const C={};k[0]&128&&(C.position=x[7]),n.$set(C);const z={};k[0]&128&&(z.position=x[7]),u.$set(z);const R={};k[0]&128&&(R.position=x[7]),a.$set(R)},i(x){_||(oe(e.$$.fragment,x),oe(n.$$.fragment,x),oe(u.$$.fragment,x),oe(a.$$.fragment,x),_=!0)},o(x){ue(e.$$.fragment,x),ue(n.$$.fragment,x),ue(u.$$.fragment,x),ue(a.$$.fragment,x),_=!1},d(x){x&&(pe(t),pe(l),pe(f)),Fe(e,x),Fe(n,x),Fe(u,x),Fe(a,x)}}}function r3(r){let e,t,n,l,u,f=r[4]&&r[0]&&o0(r);return{c(){e=ce("div"),f&&f.c(),Te(e,"class",t=fd(r[2])+" svelte-p00lfq"),Te(e,"data-testid","map-container"),fi(e,"expand-map",!r[2])},m(a,_){me(a,e,_),f&&f.m(e,null),r[47](e),n=!0,l||(u=[Ct(e3,"hashchange",r[11]),zm(r[10].call(null,e))],l=!0)},p(a,_){a[4]&&a[0]?f?(f.p(a,_),_[0]&17&&oe(f,1)):(f=o0(a),f.c(),oe(f,1),f.m(e,null)):f&&(vr(),ue(f,1,1,()=>{f=null}),br()),(!n||_[0]&4&&t!==(t=fd(a[2])+" svelte-p00lfq"))&&Te(e,"class",t),(!n||_[0]&4)&&fi(e,"expand-map",!a[2])},i(a){n||(oe(f),n=!0)},o(a){ue(f),n=!1},d(a){a&&pe(e),f&&f.d(),r[47](null),l=!1,yn(u)}}}function n3(r,e,t){let n,l,u,f,{$$slots:a={},$$scope:_}=e,{map:x=null}=e,{mapContainer:k=void 0}=e,{class:S=void 0}=e,{style:C}=e,{diffStyleUpdates:z=!1}=e,{center:R=void 0}=e,{zoom:D=void 0}=e,{pitch:P=0}=e,{bearing:B=0}=e,{bounds:N=void 0}=e,{hash:V=!1}=e,{updateHash:U=Ne=>{window.history.replaceState(window.history.state,"",Ne)}}=e,{loaded:te=!1}=e,{minZoom:le=0}=e,{maxZoom:H=22}=e,{minPitch:J=0}=e,{maxPitch:ye=60}=e,{renderWorldCopies:ze=void 0}=e,{dragPan:ne=void 0}=e,{dragRotate:be=void 0}=e,{pitchWithRotate:He=void 0}=e,{antialias:Ce=void 0}=e,{zoomOnDoubleClick:Qe=!0}=e,{locale:_t=void 0}=e,{interactive:Ut=!0}=e,{attributionControl:Je=!0}=e,{cooperativeGestures:Yt=!1}=e,{preserveDrawingBuffer:Kt=!1}=e,{maxBounds:Ft=void 0}=e,{images:Ot=[]}=e,{standardControls:Jt=!1}=e,{filterLayers:Et=void 0}=e,{transformRequest:sr=void 0}=e;const zt=us(),{map:rr,loadedImages:wr}=g4();pt(r,rr,Ne=>t(4,u=Ne)),pt(r,wr,Ne=>t(5,f=Ne));let gr=new Set;async function Br(Ne,We=!1){if(u&&!(!u.loaded()&&!We))if("url"in Ne){gr.add(Ne.id);try{let wt=await u.loadImage(Ne.url);u==null||u.addImage(Ne.id,wt.data,Ne.options),f.add(Ne.id),wr.set(f)}catch(wt){zt("error",wt)}finally{gr.delete(Ne.id)}}else u.addImage(Ne.id,Ne.data,Ne.options),f.add(Ne.id),wr.set(f)}let ht,Mt,De,ut;function it(Ne){return ie(),Lt(rr,u=new to.Map(il({container:Ne,style:C,locale:_t,center:R,zoom:D,pitch:P,bearing:B,minZoom:le,maxZoom:H,minPitch:J,maxPitch:ye,renderWorldCopies:ze,dragPan:ne,dragRotate:be,pitchWithRotate:He,antialias:Ce,interactive:Ut,preserveDrawingBuffer:Kt,maxBounds:Ft,bounds:N,attributionControl:Je,transformRequest:sr,cooperativeGestures:Yt})),u),u.on("load",We=>{We.target.getContainer().setAttribute("data-testid","map"),We.target.getCanvas().setAttribute("data-testid","map-canvas"),t(0,te=!0),zt("load",u)}),u.on("error",We=>zt("error",{...We,map:u})),u.on("movestart",We=>zt("movestart",{...We,map:u})),u.on("moveend",We=>{if(t(12,R=We.target.getCenter()),t(13,D=We.target.getZoom()),t(14,P=We.target.getPitch()),t(15,B=We.target.getBearing()),t(16,N=We.target.getBounds()),zt("moveend",{...We,map:u}),V){let wt=new URL(window.location.href.replace(/(#.+)?$/,W4(u)));U(wt)}}),u.on("click",We=>zt("click",{...We,map:u})),u.on("dblclick",We=>zt("dblclick",{...We,map:u})),u.on("contextmenu",We=>zt("contextmenu",{...We,map:u})),u.on("zoomstart",We=>zt("zoomstart",{...We,map:u})),u.on("zoom",We=>{zt("zoom",{...We,map:u})}),u.on("zoomend",We=>{zt("zoomend",{...We,map:u})}),u.on("style.load",()=>{if(u){const We=u.getStyle();if(t(42,ht=We.layers.map(wt=>wt.id)),t(43,Mt=Object.keys(We.sources)),ut)for(const[wt,xn]of Object.entries(ut))u.addSource(wt,xn);if(De)for(const wt of De)u.addLayer(wt);for(const wt of Ot)Br(wt,!0)}}),u.on("styledata",We=>{if(u&&Et){const wt=u.getStyle().layers;if(wt)for(let xn of wt)Et(xn)||u.setLayoutProperty(xn.id,"visibility","none")}zt("styledata",{...We,map:u})}),{destroy(){t(0,te=!1),u==null||u.remove(),Lt(rr,u=null,u)}}}let xt=C;function ie(){if(V){let Ne=Z4(window.location.hash);Ne.length>=3&&(t(13,D=Ne[0]),t(12,R=[Ne[2],Ne[1]])),Ne.length==5&&(t(15,B=Ne[3]),t(14,P=Ne[4]))}}function nr(Ne){nn[Ne?"unshift":"push"](()=>{k=Ne,t(1,k)})}return r.$$set=Ne=>{"map"in Ne&&t(17,x=Ne.map),"mapContainer"in Ne&&t(1,k=Ne.mapContainer),"class"in Ne&&t(2,S=Ne.class),"style"in Ne&&t(18,C=Ne.style),"diffStyleUpdates"in Ne&&t(19,z=Ne.diffStyleUpdates),"center"in Ne&&t(12,R=Ne.center),"zoom"in Ne&&t(13,D=Ne.zoom),"pitch"in Ne&&t(14,P=Ne.pitch),"bearing"in Ne&&t(15,B=Ne.bearing),"bounds"in Ne&&t(16,N=Ne.bounds),"hash"in Ne&&t(20,V=Ne.hash),"updateHash"in Ne&&t(21,U=Ne.updateHash),"loaded"in Ne&&t(0,te=Ne.loaded),"minZoom"in Ne&&t(22,le=Ne.minZoom),"maxZoom"in Ne&&t(23,H=Ne.maxZoom),"minPitch"in Ne&&t(24,J=Ne.minPitch),"maxPitch"in Ne&&t(25,ye=Ne.maxPitch),"renderWorldCopies"in Ne&&t(26,ze=Ne.renderWorldCopies),"dragPan"in Ne&&t(27,ne=Ne.dragPan),"dragRotate"in Ne&&t(28,be=Ne.dragRotate),"pitchWithRotate"in Ne&&t(29,He=Ne.pitchWithRotate),"antialias"in Ne&&t(30,Ce=Ne.antialias),"zoomOnDoubleClick"in Ne&&t(31,Qe=Ne.zoomOnDoubleClick),"locale"in Ne&&t(32,_t=Ne.locale),"interactive"in Ne&&t(33,Ut=Ne.interactive),"attributionControl"in Ne&&t(34,Je=Ne.attributionControl),"cooperativeGestures"in Ne&&t(35,Yt=Ne.cooperativeGestures),"preserveDrawingBuffer"in Ne&&t(36,Kt=Ne.preserveDrawingBuffer),"maxBounds"in Ne&&t(37,Ft=Ne.maxBounds),"images"in Ne&&t(38,Ot=Ne.images),"standardControls"in Ne&&t(3,Jt=Ne.standardControls),"filterLayers"in Ne&&t(39,Et=Ne.filterLayers),"transformRequest"in Ne&&t(40,sr=Ne.transformRequest),"$$scope"in Ne&&t(45,_=Ne.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&8&&t(7,n=typeof Jt=="boolean"?void 0:Jt),r.$$.dirty[0]&16&&t(17,x=u),r.$$.dirty[0]&786448|r.$$.dirty[1]&14336&&u&&!lc(C,xt)){const Ne=u.getStyle();if(ht&&(De=Ne.layers.filter(We=>!ht.includes(We.id))),Mt){const We=Object.keys(Ne.sources).filter(wt=>!Mt.includes(wt));ut={};for(const wt of We)ut[wt]=Ne.sources[wt]}t(44,xt=C),u.setStyle(C,{diff:z}),Lt(wr,f=new Set,f),t(41,gr=new Set)}if(r.$$.dirty[0]&49|r.$$.dirty[1]&1152&&te&&u!=null&&u.loaded())for(let Ne of Ot)!f.has(Ne.id)&&!gr.has(Ne.id)&&!u.hasImage(Ne.id)&&Br(Ne);if(r.$$.dirty[0]&32|r.$$.dirty[1]&128&&t(6,l=Ot.every(Ne=>f.has(Ne.id))),r.$$.dirty[0]&61456&&u){let Ne={};R!=null&&!lc(R,u==null?void 0:u.getCenter())&&(Ne.center=R),D!=null&&!lc(D,u==null?void 0:u.getZoom())&&(Ne.zoom=D),B!=null&&!lc(B,u==null?void 0:u.getBearing())&&(Ne.bearing=B),P!=null&&!lc(P,u==null?void 0:u.getPitch())&&(Ne.pitch=P),Object.keys(Ne).length&&u.easeTo(Ne)}r.$$.dirty[0]&65552&&N&&!lc(N,u==null?void 0:u.getBounds())&&(u==null||u.fitBounds(N)),r.$$.dirty[0]&16|r.$$.dirty[1]&1&&(Qe?u==null||u.doubleClickZoom.enable():u==null||u.doubleClickZoom.disable())},[te,k,S,Jt,u,f,l,n,rr,wr,it,ie,R,D,P,B,N,x,C,z,V,U,le,H,J,ye,ze,ne,be,He,Ce,Qe,_t,Ut,Je,Yt,Kt,Ft,Ot,Et,sr,gr,ht,Mt,xt,_,a,nr]}class i3 extends Zt{constructor(e){super(),Wt(this,e,n3,r3,Vt,{map:17,mapContainer:1,class:2,style:18,diffStyleUpdates:19,center:12,zoom:13,pitch:14,bearing:15,bounds:16,hash:20,updateHash:21,loaded:0,minZoom:22,maxZoom:23,minPitch:24,maxPitch:25,renderWorldCopies:26,dragPan:27,dragRotate:28,pitchWithRotate:29,antialias:30,zoomOnDoubleClick:31,locale:32,interactive:33,attributionControl:34,cooperativeGestures:35,preserveDrawingBuffer:36,maxBounds:37,images:38,standardControls:3,filterLayers:39,transformRequest:40},null,[-1,-1])}}const o3=r=>({marker:r&8}),a0=r=>({marker:r[3]});function s3(r){let e,t,n,l,u,f,a;const _=r[19].default,x=$r(_,r,r[18],a0);return{c(){e=ce("div"),x&&x.c(),Te(e,"tabindex",t=r[1]?0:void 0),Te(e,"role",n=r[1]?"button":void 0),pn(e,"z-index",r[2])},m(k,S){me(k,e,S),x&&x.m(e,null),u=!0,f||(a=[zm(r[7].call(null,e)),zm(l=a3.call(null,e,r[0])),Ct(e,"click",tm(r[20])),Ct(e,"dblclick",tm(r[21])),Ct(e,"contextmenu",tm(Sg(r[22]))),Ct(e,"mouseenter",r[23]),Ct(e,"mouseleave",r[24]),Ct(e,"mousemove",r[25]),Ct(e,"keydown",r[8])],f=!0)},p(k,[S]){x&&x.p&&(!u||S&262152)&&Gr(x,_,k,k[18],u?qr(_,k[18],S,o3):Wr(k[18]),a0),(!u||S&2&&t!==(t=k[1]?0:void 0))&&Te(e,"tabindex",t),(!u||S&2&&n!==(n=k[1]?"button":void 0))&&Te(e,"role",n),l&&Sc(l.update)&&S&1&&l.update.call(null,k[0]),S&4&&pn(e,"z-index",k[2])},i(k){u||(oe(x,k),u=!0)},o(k){ue(x,k),u=!1},d(k){k&&pe(e),x&&x.d(k),f=!1,yn(a)}}}function a3(r,e){const t=r.className;function n(l){l?r.className=`${t} ${l}`:r.className=t}return n(e),{update:n}}function l3(r,e,t){let n,l,u,{$$slots:f={},$$scope:a}=e,{marker:_=void 0}=e,{lngLat:x}=e,{class:k=void 0}=e,{interactive:S=!0}=e,{asButton:C=!1}=e,{draggable:z=!1}=e,{feature:R=null}=e,{offset:D=void 0}=e,{zIndex:P=void 0}=e,{rotation:B=0}=e,{opacity:N=1}=e;const V=us(),{map:U,layerEvent:te,self:le,markerClickManager:H}=v4();pt(r,U,Je=>t(27,u=Je)),pt(r,te,Je=>t(26,n=Je)),pt(r,le,Je=>t(3,l=Je));function J(Je){Lt(le,l=new to.Marker({element:Je,rotation:B,draggable:z,offset:D,opacity:N.toString()}).setLngLat(x).addTo(u),l),t(11,_=l);const Yt=()=>ne("dragstart"),Kt=()=>{ye(),ne("drag")},Ft=()=>{ye(),ne("dragend")};return z&&(l.on("dragstart",Yt),l.on("drag",Kt),l.on("dragend",Ft)),{destroy(){z&&(l==null||l.off("dragstart",Yt),l==null||l.off("drag",Kt),l==null||l.off("dragend",Ft)),t(11,_=void 0),l==null||l.remove()}}}function ye(){let Je=l==null?void 0:l.getLngLat();Je&&(Array.isArray(x)?t(10,x=[Je.lng,Je.lat]):x&&"lon"in x?t(10,x={lon:Je.lng,lat:Je.lat}):t(10,x=Je))}function ze(Je){Je.key===" "&&(Je.preventDefault(),Je.stopPropagation(),ne("click"))}function ne(Je){if(!S)return;let Yt=l==null?void 0:l.getLngLat();if(!Yt)return;const Kt=[Yt.lng,Yt.lat];let Ft={map:u,marker:l,lngLat:Kt,features:[{type:"Feature",properties:(R==null?void 0:R.properties)??{},geometry:{type:"Point",coordinates:Kt}}]};(Je==="click"||Je==="contextmenu")&&H.handleClick(Ft),Lt(te,n={...Ft,layerType:"marker",type:Je},n),V(Je,Ft)}const be=()=>ne("click"),He=()=>ne("dblclick"),Ce=()=>{ne("contextmenu")},Qe=()=>{ne("mouseenter")},_t=()=>{ne("mouseleave")},Ut=()=>ne("mousemove");return r.$$set=Je=>{"marker"in Je&&t(11,_=Je.marker),"lngLat"in Je&&t(10,x=Je.lngLat),"class"in Je&&t(0,k=Je.class),"interactive"in Je&&t(12,S=Je.interactive),"asButton"in Je&&t(1,C=Je.asButton),"draggable"in Je&&t(13,z=Je.draggable),"feature"in Je&&t(14,R=Je.feature),"offset"in Je&&t(15,D=Je.offset),"zIndex"in Je&&t(2,P=Je.zIndex),"rotation"in Je&&t(16,B=Je.rotation),"opacity"in Je&&t(17,N=Je.opacity),"$$scope"in Je&&t(18,a=Je.$$scope)},r.$$.update=()=>{r.$$.dirty&1032&&(l==null||l.setLngLat(x)),r.$$.dirty&32776&&(l==null||l.setOffset(D??[0,0])),r.$$.dirty&65544&&(l==null||l.setRotation(B)),r.$$.dirty&131080&&(l==null||l.setOpacity(N.toString()))},[k,C,P,l,U,te,le,J,ze,ne,x,_,S,z,R,D,B,N,a,f,be,He,Ce,Qe,_t,Ut]}class yh extends Zt{constructor(e){super(),Wt(this,e,l3,s3,Vt,{marker:11,lngLat:10,class:0,interactive:12,asButton:1,draggable:13,feature:14,offset:15,zIndex:2,rotation:16,opacity:17})}}const c3=r=>({features:r[0]&16,data:r[0]&16,map:r[0]&4,close:r[0]&1}),l0=r=>{var e;return{features:r[4],data:((e=r[4])==null?void 0:e[0])??null,map:r[2],close:r[31]}};function c0(r){var l;let e,t,n=(((l=r[4])==null?void 0:l.length)||r[3]instanceof to.Marker)&&u0(r);return{c(){e=ce("div"),n&&n.c()},m(u,f){me(u,e,f),n&&n.m(e,null),r[32](e),t=!0},p(u,f){var a;(a=u[4])!=null&&a.length||u[3]instanceof to.Marker?n?(n.p(u,f),f[0]&24&&oe(n,1)):(n=u0(u),n.c(),oe(n,1),n.m(e,null)):n&&(vr(),ue(n,1,1,()=>{n=null}),br())},i(u){t||(oe(n),t=!0)},o(u){ue(n),t=!1},d(u){u&&pe(e),n&&n.d(),r[32](null)}}}function u0(r){let e;const t=r[30].default,n=$r(t,r,r[29],l0);return{c(){n&&n.c()},m(l,u){n&&n.m(l,u),e=!0},p(l,u){n&&n.p&&(!e||u[0]&536870933)&&Gr(n,t,l,l[29],e?qr(t,l[29],u,c3):Wr(l[29]),l0)},i(l){e||(oe(n,l),e=!0)},o(l){ue(n,l),e=!1},d(l){n&&n.d(l)}}}function u3(r){let e,t,n=r[9].default&&c0(r);return{c(){n&&n.c(),e=Hn()},m(l,u){n&&n.m(l,u),me(l,e,u),t=!0},p(l,u){l[9].default?n?(n.p(l,u),u[0]&512&&oe(n,1)):(n=c0(l),n.c(),oe(n,1),n.m(e.parentNode,e)):n&&(vr(),ue(n,1,1,()=>{n=null}),br())},i(l){t||(oe(n),t=!0)},o(l){ue(n),t=!1},d(l){l&&pe(e),n&&n.d(l)}}}function h3(r,e,t){let n,l,u,f,a,_,{$$slots:x={},$$scope:k}=e;const S=US(x);let{closeButton:C=void 0}=e,{closeOnClickOutside:z=!0}=e,{closeOnClickInside:R=!1}=e,{closeOnMove:D=!1}=e,{openOn:P="click"}=e,{openIfTopMost:B=!0}=e,{focusAfterOpen:N=!0}=e,{anchor:V=void 0}=e,{offset:U=void 0}=e,{popupClass:te=void 0}=e,{maxWidth:le=void 0}=e,{lngLat:H=void 0}=e,{html:J=void 0}=e,{open:ye=!1}=e;const ze=us(),{map:ne,popupTarget:be,layerEvent:He,layer:Ce,eventTopMost:Qe,markerClickManager:_t}=ol();pt(r,ne,ie=>t(2,u=ie)),pt(r,be,ie=>t(3,a=ie)),pt(r,He,ie=>t(28,f=ie)),pt(r,Ce,ie=>t(35,_=ie));const Ut=["click","dblclick","contextmenu"];let Je,Yt=!1,Kt;function Ft(){if(!Je)return;let ie=Je.getElement();!ie||ie===Kt||(Kt=ie,P==="hover"&&(Kt.style.pointerEvents="none"),Kt.addEventListener("mouseenter",()=>{t(24,Yt=!0)},{passive:!0}),Kt.addEventListener("mouseleave",()=>{t(24,Yt=!1)},{passive:!0}),Kt.addEventListener("click",()=>{R&&t(0,ye=!1)},{passive:!0}))}Od(()=>{if(u)return u.on("click",Mt),u.on("contextmenu",Mt),_t.add(De),typeof a=="string"&&(u.on("click",a,zt),u.on("dblclick",a,zt),u.on("contextmenu",a,zt),u.on("mousemove",a,ht),u.on("mouseleave",a,Br),u.on("touchstart",a,wr),u.on("touchend",a,gr)),()=>{u!=null&&u.loaded()&&(Je==null||Je.remove(),u.off("click",Mt),u.off("contextmenu",Mt),_t.remove(De),a instanceof to.Marker?a.getPopup()===Je&&a.setPopup(void 0):typeof a=="string"&&(u.off("click",a,zt),u.off("dblclick",a,zt),u.off("contextmenu",a,zt),u.off("mousemove",a,ht),u.off("mouseleave",a,Br),u.off("touchstart",a,wr),u.off("touchend",a,gr)))}});function Ot(ie){return B?!("marker"in ie)&&!b4(ie)&&Qe(ie)!==_:!1}let Jt=null,Et="normal";function sr(ie){"layerType"in ie&&ie.layerType==="deckgl"?(t(10,H=ie.coordinate),t(4,Jt=ie.object?[ie.object]:null)):(t(10,H=ie.lngLat),t(4,Jt=ie.features??[]))}function zt(ie){ie.type!==P||Ot(ie)||(sr(ie),setTimeout(()=>t(0,ye=!0)))}let rr=null;function wr(ie){rr=ie.point}function gr(ie){if(!rr||P!=="hover")return;let nr=rr.dist(ie.point);rr=null,nr<3&&(t(10,H=ie.lngLat),t(4,Jt=ie.features??[]),Je.isOpen()?t(25,Et="justOpened"):(t(25,Et="opening"),t(0,ye=!0)))}function Br(ie){P!=="hover"||rr||Et!=="normal"||(t(0,ye=!1),t(4,Jt=null))}function ht(ie){if(!(P!=="hover"||rr||Et!=="normal")){if(Ot(ie)){t(0,ye=!1),t(4,Jt=null);return}t(0,ye=!0),t(4,Jt=ie.features??[]),t(10,H=ie.lngLat)}}function Mt(ie){if(Et==="justOpened"){t(25,Et="normal");return}if(!z)return;let nr=[Kt,a instanceof to.Marker?a==null?void 0:a.getElement():null];ye&&Je.isOpen()&&!nr.some(Ne=>Ne==null?void 0:Ne.contains(ie.originalEvent.target))&&(ie.type==="contextmenu"&&P==="contextmenu"||ie.type!=="contextmenu")&&t(0,ye=!1)}function De(ie){z&&ye&&Je.isOpen()&&ie.marker!==a&&t(0,ye=!1)}ni(()=>{u&&(Je!=null&&Je.isOpen())&&Je.remove()});let ut;const it=()=>t(0,ye=!1);function xt(ie){nn[ie?"unshift":"push"](()=>{ut=ie,t(1,ut)})}return r.$$set=ie=>{"closeButton"in ie&&t(11,C=ie.closeButton),"closeOnClickOutside"in ie&&t(12,z=ie.closeOnClickOutside),"closeOnClickInside"in ie&&t(13,R=ie.closeOnClickInside),"closeOnMove"in ie&&t(14,D=ie.closeOnMove),"openOn"in ie&&t(15,P=ie.openOn),"openIfTopMost"in ie&&t(16,B=ie.openIfTopMost),"focusAfterOpen"in ie&&t(17,N=ie.focusAfterOpen),"anchor"in ie&&t(18,V=ie.anchor),"offset"in ie&&t(19,U=ie.offset),"popupClass"in ie&&t(20,te=ie.popupClass),"maxWidth"in ie&&t(21,le=ie.maxWidth),"lngLat"in ie&&t(10,H=ie.lngLat),"html"in ie&&t(22,J=ie.html),"open"in ie&&t(0,ye=ie.open),"$$scope"in ie&&t(29,k=ie.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&14336&&t(27,n=C??(!z&&!R)),r.$$.dirty[0]&146685952&&(Je||(t(23,Je=new to.Popup({closeButton:n,closeOnClick:!1,closeOnMove:D,focusAfterOpen:N,maxWidth:le,className:te,anchor:V,offset:U})),Kt=Je.getElement(),Je.on("open",()=>{t(0,ye=!0),Ft(),ze("open",Je)}),Je.on("close",()=>{t(0,ye=!1),ze("close",Je)}),Je.on("hover",()=>{ze("hover",Je)}))),r.$$.dirty[0]&8421384&&Je&&a instanceof to.Marker&&(P==="click"?a.setPopup(Je):a.getPopup()===Je&&a.setPopup(void 0)),r.$$.dirty[0]&268468224&&Ut.includes(P)&&(f==null?void 0:f.type)===P&&(zt(f),Lt(He,f=null,f)),r.$$.dirty[0]&268468224&&t(26,l=P==="hover"&&((f==null?void 0:f.type)==="mousemove"||(f==null?void 0:f.type)==="mouseenter")),r.$$.dirty[0]&352354304&&P==="hover"&&He&&(l&&f&&sr(f),t(0,ye=(l||Yt)??!1)),r.$$.dirty[0]&12582914&&(ut?Je.setDOMContent(ut):J&&Je.setHTML(J)),r.$$.dirty[0]&8389632&&H&&Je.setLngLat(H),r.$$.dirty[0]&41943045&&u){let ie=Je.isOpen();ye&&!ie?(Je.addTo(u),Et==="opening"&&t(25,Et="justOpened")):!ye&&ie&&Je.remove()}},[ye,ut,u,a,Jt,ne,be,He,Ce,S,H,C,z,R,D,P,B,N,V,U,te,le,J,Je,Yt,Et,l,n,f,k,x,it,xt]}class f3 extends Zt{constructor(e){super(),Wt(this,e,h3,u3,Vt,{closeButton:11,closeOnClickOutside:12,closeOnClickInside:13,closeOnMove:14,openOn:15,openIfTopMost:16,focusAfterOpen:17,anchor:18,offset:19,popupClass:20,maxWidth:21,lngLat:10,html:22,open:0},null,[-1,-1])}}var Ah=Uint8Array,iw=Uint16Array,d3=Int32Array,p3=new Ah([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),m3=new Ah([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),ow=function(r,e){for(var t=new iw(31),n=0;n<31;++n)t[n]=e+=1<<r[n-1];for(var l=new d3(t[30]),n=1;n<30;++n)for(var u=t[n];u<t[n+1];++u)l[u]=u-t[n]<<5|n;return{b:t,r:l}},sw=ow(p3,2),g3=sw.b,_3=sw.r;g3[28]=258,_3[258]=28;ow(m3,0);var y3=new iw(32768);for(Or=0;Or<32768;++Or)Is=(Or&43690)>>1|(Or&21845)<<1,Is=(Is&52428)>>2|(Is&13107)<<2,Is=(Is&61680)>>4|(Is&3855)<<4,y3[Or]=((Is&65280)>>8|(Is&255)<<8)>>1;var Is,Or,qd=new Ah(288);for(Or=0;Or<144;++Or)qd[Or]=8;var Or;for(Or=144;Or<256;++Or)qd[Or]=9;var Or;for(Or=256;Or<280;++Or)qd[Or]=7;var Or;for(Or=280;Or<288;++Or)qd[Or]=8;var Or,v3=new Ah(32);for(Or=0;Or<32;++Or)v3[Or]=5;var Or,b3=new Ah(0),w3=typeof TextDecoder<"u"&&new TextDecoder,x3=0;try{w3.decode(b3,{stream:!0}),x3=1}catch{}function S3(r){let e;const t=r[16].default,n=$r(t,r,r[24],null);return{c(){n&&n.c()},m(l,u){n&&n.m(l,u),e=!0},p(l,u){n&&n.p&&(!e||u&16777216)&&Gr(n,t,l,l[24],e?qr(t,l[24],u,null):Wr(l[24]),null)},i(l){e||(oe(n,l),e=!0)},o(l){ue(n,l),e=!1},d(l){n&&n.d(l)}}}function k3(r){let e,t,n;function l(f){r[17](f)}let u={id:r[1],type:"symbol",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],applyToClusters:r[9],minzoom:r[10],maxzoom:r[11],hoverCursor:r[12],manageHoverState:r[13],eventsIfTopMost:r[14],interactive:r[15],$$slots:{default:[S3]},$$scope:{ctx:r}};return r[0]!==void 0&&(u.hovered=r[0]),e=new $d({props:u}),nn.push(()=>no(e,"hovered",l)),e.$on("click",r[18]),e.$on("dblclick",r[19]),e.$on("contextmenu",r[20]),e.$on("mouseenter",r[21]),e.$on("mousemove",r[22]),e.$on("mouseleave",r[23]),{c(){Oe(e.$$.fragment)},m(f,a){Be(e,f,a),n=!0},p(f,[a]){const _={};a&2&&(_.id=f[1]),a&4&&(_.source=f[2]),a&8&&(_.sourceLayer=f[3]),a&16&&(_.beforeId=f[4]),a&32&&(_.beforeLayerType=f[5]),a&64&&(_.paint=f[6]),a&128&&(_.layout=f[7]),a&256&&(_.filter=f[8]),a&512&&(_.applyToClusters=f[9]),a&1024&&(_.minzoom=f[10]),a&2048&&(_.maxzoom=f[11]),a&4096&&(_.hoverCursor=f[12]),a&8192&&(_.manageHoverState=f[13]),a&16384&&(_.eventsIfTopMost=f[14]),a&32768&&(_.interactive=f[15]),a&16777216&&(_.$$scope={dirty:a,ctx:f}),!t&&a&1&&(t=!0,_.hovered=f[0],ro(()=>t=!1)),e.$set(_)},i(f){n||(oe(e.$$.fragment,f),n=!0)},o(f){ue(e.$$.fragment,f),n=!1},d(f){Fe(e,f)}}}function T3(r,e,t){let{$$slots:n={},$$scope:l}=e,{id:u=Dc("symbol")}=e,{source:f=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:_=void 0}=e,{beforeLayerType:x=void 0}=e,{paint:k=void 0}=e,{layout:S=void 0}=e,{filter:C=void 0}=e,{applyToClusters:z=void 0}=e,{minzoom:R=void 0}=e,{maxzoom:D=void 0}=e,{hoverCursor:P=void 0}=e,{manageHoverState:B=!1}=e,{hovered:N=null}=e,{eventsIfTopMost:V=!1}=e,{interactive:U=!0}=e;function te(be){N=be,t(0,N)}function le(be){fr.call(this,r,be)}function H(be){fr.call(this,r,be)}function J(be){fr.call(this,r,be)}function ye(be){fr.call(this,r,be)}function ze(be){fr.call(this,r,be)}function ne(be){fr.call(this,r,be)}return r.$$set=be=>{"id"in be&&t(1,u=be.id),"source"in be&&t(2,f=be.source),"sourceLayer"in be&&t(3,a=be.sourceLayer),"beforeId"in be&&t(4,_=be.beforeId),"beforeLayerType"in be&&t(5,x=be.beforeLayerType),"paint"in be&&t(6,k=be.paint),"layout"in be&&t(7,S=be.layout),"filter"in be&&t(8,C=be.filter),"applyToClusters"in be&&t(9,z=be.applyToClusters),"minzoom"in be&&t(10,R=be.minzoom),"maxzoom"in be&&t(11,D=be.maxzoom),"hoverCursor"in be&&t(12,P=be.hoverCursor),"manageHoverState"in be&&t(13,B=be.manageHoverState),"hovered"in be&&t(0,N=be.hovered),"eventsIfTopMost"in be&&t(14,V=be.eventsIfTopMost),"interactive"in be&&t(15,U=be.interactive),"$$scope"in be&&t(24,l=be.$$scope)},[N,u,f,a,_,x,k,S,C,z,R,D,P,B,V,U,n,te,le,H,J,ye,ze,ne,l]}class aw extends Zt{constructor(e){super(),Wt(this,e,T3,k3,Vt,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}var E3=Object.defineProperty,lw=r=>{throw TypeError(r)},C3=(r,e,t)=>e in r?E3(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,mo=(r,e,t)=>C3(r,typeof e!="symbol"?e+"":e,t),cw=(r,e,t)=>e.has(r)||lw("Cannot "+t),ei=(r,e,t)=>(cw(r,e,"read from private field"),t?t.call(r):e.get(r)),h0=(r,e,t)=>e.has(r)?lw("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(r):e.set(r,t),f0=(r,e,t,n)=>(cw(r,e,"write to private field"),n?n.call(r,t):e.set(r,t),t);function gn(){}function M3(r,e){for(const t in e)r[t]=e[t];return r}function uw(r){return r()}function d0(){return Object.create(null)}function js(r){r.forEach(uw)}function hw(r){return typeof r=="function"}function _a(r,e){return r!=r?e==e:r!==e||r&&typeof r=="object"||typeof r=="function"}let qf;function zi(r,e){return r===e?!0:(qf||(qf=document.createElement("a")),qf.href=e,r===qf.href)}function I3(r){return Object.keys(r).length===0}function A3(r,e,t,n){if(r){const l=fw(r,e,t,n);return r[0](l)}}function fw(r,e,t,n){return r[1]&&n?M3(t.ctx.slice(),r[1](n(e))):t.ctx}function L3(r,e,t,n){if(r[2]&&n){const l=r[2](n(t));if(e.dirty===void 0)return l;if(typeof l=="object"){const u=[],f=Math.max(e.dirty.length,l.length);for(let a=0;a<f;a+=1)u[a]=e.dirty[a]|l[a];return u}return e.dirty|l}return e.dirty}function P3(r,e,t,n,l,u){if(l){const f=fw(e,t,n,u);r.p(f,l)}}function z3(r){if(r.ctx.length>32){const e=[],t=r.ctx.length/32;for(let n=0;n<t;n++)e[n]=-1;return e}return-1}function p0(r){return r??""}function Lr(r,e){r.appendChild(e)}function wn(r,e,t){r.insertBefore(e,t||null)}function _n(r){r.parentNode&&r.parentNode.removeChild(r)}function Kr(r){return document.createElement(r)}function Zo(r){return document.createElementNS("http://www.w3.org/2000/svg",r)}function da(r){return document.createTextNode(r)}function go(){return da(" ")}function D3(){return da("")}function Zi(r,e,t,n){return r.addEventListener(e,t,n),()=>r.removeEventListener(e,t,n)}function R3(r){return function(e){return e.preventDefault(),r.call(this,e)}}function ot(r,e,t){t==null?r.removeAttribute(e):r.getAttribute(e)!==t&&r.setAttribute(e,t)}function B3(r){return Array.from(r.childNodes)}function vh(r,e){e=""+e,r.data!==e&&(r.data=e)}function m0(r,e){r.value=e??""}function Po(r,e,t){r.classList.toggle(e,!!t)}function F3(r,e,{bubbles:t=!1,cancelable:n=!1}={}){return new CustomEvent(r,{detail:e,bubbles:t,cancelable:n})}let bh;function oh(r){bh=r}function dw(){if(!bh)throw new Error("Function called outside component initialization");return bh}function O3(r){dw().$$.on_destroy.push(r)}function N3(){const r=dw();return(e,t,{cancelable:n=!1}={})=>{const l=r.$$.callbacks[e];if(l){const u=F3(e,t,{cancelable:n});return l.slice().forEach(f=>{f.call(r,u)}),!u.defaultPrevented}return!0}}function g0(r,e){const t=r.$$.callbacks[e.type];t&&t.slice().forEach(n=>n.call(this,e))}const gc=[],$m=[];let wc=[];const _0=[],j3=Promise.resolve();let qm=!1;function U3(){qm||(qm=!0,j3.then(pw))}function Gm(r){wc.push(r)}const sm=new Set;let cc=0;function pw(){if(cc!==0)return;const r=bh;do{try{for(;cc<gc.length;){const e=gc[cc];cc++,oh(e),V3(e.$$)}}catch(e){throw gc.length=0,cc=0,e}for(oh(null),gc.length=0,cc=0;$m.length;)$m.pop()();for(let e=0;e<wc.length;e+=1){const t=wc[e];sm.has(t)||(sm.add(t),t())}wc.length=0}while(gc.length);for(;_0.length;)_0.pop()();qm=!1,sm.clear(),oh(r)}function V3(r){if(r.fragment!==null){r.update(),js(r.before_update);const e=r.dirty;r.dirty=[-1],r.fragment&&r.fragment.p(r.ctx,e),r.after_update.forEach(Gm)}}function $3(r){const e=[],t=[];wc.forEach(n=>r.indexOf(n)===-1?e.push(n):t.push(n)),t.forEach(n=>n()),wc=e}const Qf=new Set;let Qa;function ed(){Qa={r:0,c:[],p:Qa}}function td(){Qa.r||js(Qa.c),Qa=Qa.p}function Zn(r,e){r&&r.i&&(Qf.delete(r),r.i(e))}function hi(r,e,t,n){if(r&&r.o){if(Qf.has(r))return;Qf.add(r),Qa.c.push(()=>{Qf.delete(r),n&&(t&&r.d(1),n())}),r.o(e)}else n&&n()}function y0(r){return(r==null?void 0:r.length)!==void 0?r:Array.from(r)}function q3(r,e){hi(r,1,1,()=>{e.delete(r.key)})}function G3(r,e,t,n,l,u,f,a,_,x,k,S){let C=r.length,z=u.length,R=C;const D={};for(;R--;)D[r[R].key]=R;const P=[],B=new Map,N=new Map,V=[];for(R=z;R--;){const H=S(l,u,R),J=t(H);let ye=f.get(J);ye?V.push(()=>ye.p(H,e)):(ye=x(J,H),ye.c()),B.set(J,P[R]=ye),J in D&&N.set(J,Math.abs(R-D[J]))}const U=new Set,te=new Set;function le(H){Zn(H,1),H.m(a,k),f.set(H.key,H),k=H.first,z--}for(;C&&z;){const H=P[z-1],J=r[C-1],ye=H.key,ze=J.key;H===J?(k=H.first,C--,z--):B.has(ze)?!f.has(ye)||U.has(ye)?le(H):te.has(ze)?C--:N.get(ye)>N.get(ze)?(te.add(ye),le(H)):(U.add(ze),C--):(_(J,f),C--)}for(;C--;){const H=r[C];B.has(H.key)||_(H,f)}for(;z;)le(P[z-1]);return js(V),P}function pa(r){r&&r.c()}function Fs(r,e,t){const{fragment:n,after_update:l}=r.$$;n&&n.m(e,t),Gm(()=>{const u=r.$$.on_mount.map(uw).filter(hw);r.$$.on_destroy?r.$$.on_destroy.push(...u):js(u),r.$$.on_mount=[]}),l.forEach(Gm)}function Os(r,e){const t=r.$$;t.fragment!==null&&($3(t.after_update),js(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function W3(r,e){r.$$.dirty[0]===-1&&(gc.push(r),U3(),r.$$.dirty.fill(0)),r.$$.dirty[e/31|0]|=1<<e%31}function ya(r,e,t,n,l,u,f=null,a=[-1]){const _=bh;oh(r);const x=r.$$={fragment:null,ctx:[],props:u,update:gn,not_equal:l,bound:d0(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(_?_.$$.context:[])),callbacks:d0(),dirty:a,skip_bound:!1,root:e.target||_.$$.root};f&&f(x.root);let k=!1;if(x.ctx=t?t(r,e.props||{},(S,C,...z)=>{const R=z.length?z[0]:C;return x.ctx&&l(x.ctx[S],x.ctx[S]=R)&&(!x.skip_bound&&x.bound[S]&&x.bound[S](R),k&&W3(r,S)),C}):[],x.update(),k=!0,js(x.before_update),x.fragment=n?n(x.ctx):!1,e.target){if(e.hydrate){const S=B3(e.target);x.fragment&&x.fragment.l(S),S.forEach(_n)}else x.fragment&&x.fragment.c();e.intro&&Zn(r.$$.fragment),Fs(r,e.target,e.anchor),pw()}oh(_)}class va{constructor(){mo(this,"$$"),mo(this,"$$set")}$destroy(){Os(this,1),this.$destroy=gn}$on(e,t){if(!hw(t))return gn;const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const l=n.indexOf(t);l!==-1&&n.splice(l,1)}}$set(e){this.$$set&&!I3(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const Z3="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(Z3);function H3(r){let e,t;return{c(){e=Zo("svg"),t=Zo("path"),ot(t,"d","M13.12.706a.982.982 0 0 0-1.391 0L6.907 5.517 2.087.696a.982.982 0 1 0-1.391 1.39l4.821 4.821L.696 11.73a.982.982 0 1 0 1.39 1.39l4.821-4.821 4.822 4.821a.982.982 0 1 0 1.39-1.39L8.298 6.908l4.821-4.822a.988.988 0 0 0 0-1.38Z"),ot(e,"viewBox","0 0 14 14"),ot(e,"width","13"),ot(e,"height","13"),ot(e,"class","svelte-en2qvf")},m(n,l){wn(n,e,l),Lr(e,t)},p:gn,i:gn,o:gn,d(n){n&&_n(e)}}}class mw extends va{constructor(e){super(),ya(this,e,null,H3,_a,{})}}function X3(r){let e,t;return{c(){e=Zo("svg"),t=Zo("path"),ot(t,"d","M15 0C6.705 0 0 6.705 0 15C0 23.295 6.705 30 15 30C23.295 30 30 23.295 30 15C30 6.705 23.295 0 15 0ZM22.5 20.385L20.385 22.5L15 17.115L9.615 22.5L7.5 20.385L12.885 15L7.5 9.615L9.615 7.5L15 12.885L20.385 7.5L22.5 9.615L17.115 15L22.5 20.385Z"),ot(e,"viewBox","0 0 30 30"),ot(e,"fill","none"),ot(e,"xmlns","http://www.w3.org/2000/svg"),ot(e,"class","svelte-d2loi5")},m(n,l){wn(n,e,l),Lr(e,t)},p:gn,i:gn,o:gn,d(n){n&&_n(e)}}}class gw extends va{constructor(e){super(),ya(this,e,null,X3,_a,{})}}function K3(r){let e,t;return{c(){e=Kr("img"),zi(e.src,t=r[3]+"area.svg")||ot(e,"src",t),ot(e,"alt",r[6]),ot(e,"class","svelte-ltkwvy")},m(n,l){wn(n,e,l)},p(n,l){l&8&&!zi(e.src,t=n[3]+"area.svg")&&ot(e,"src",t),l&64&&ot(e,"alt",n[6])},d(n){n&&_n(e)}}}function J3(r){let e,t;return{c(){e=Kr("img"),zi(e.src,t=r[3]+"reverse.svg")||ot(e,"src",t),ot(e,"alt",r[6]),ot(e,"class","svelte-ltkwvy")},m(n,l){wn(n,e,l)},p(n,l){l&8&&!zi(e.src,t=n[3]+"reverse.svg")&&ot(e,"src",t),l&64&&ot(e,"alt",n[6])},d(n){n&&_n(e)}}}function Y3(r){let e,t;return{c(){e=Kr("img"),zi(e.src,t=r[3]+"poi.svg")||ot(e,"src",t),ot(e,"alt",r[6]),ot(e,"class","svelte-ltkwvy")},m(n,l){wn(n,e,l)},p(n,l){l&8&&!zi(e.src,t=n[3]+"poi.svg")&&ot(e,"src",t),l&64&&ot(e,"alt",n[6])},d(n){n&&_n(e)}}}function Q3(r){let e,t;return{c(){e=Kr("img"),zi(e.src,t=r[3]+"postal_code.svg")||ot(e,"src",t),ot(e,"alt",r[6]),ot(e,"class","svelte-ltkwvy")},m(n,l){wn(n,e,l)},p(n,l){l&8&&!zi(e.src,t=n[3]+"postal_code.svg")&&ot(e,"src",t),l&64&&ot(e,"alt",n[6])},d(n){n&&_n(e)}}}function eT(r){let e,t;return{c(){e=Kr("img"),zi(e.src,t=r[3]+"street.svg")||ot(e,"src",t),ot(e,"alt",r[6]),ot(e,"class","svelte-ltkwvy")},m(n,l){wn(n,e,l)},p(n,l){l&8&&!zi(e.src,t=n[3]+"street.svg")&&ot(e,"src",t),l&64&&ot(e,"alt",n[6])},d(n){n&&_n(e)}}}function tT(r){let e,t;return{c(){e=Kr("img"),zi(e.src,t=r[3]+"road.svg")||ot(e,"src",t),ot(e,"alt",r[6]),ot(e,"class","svelte-ltkwvy")},m(n,l){wn(n,e,l)},p(n,l){l&8&&!zi(e.src,t=n[3]+"road.svg")&&ot(e,"src",t),l&64&&ot(e,"alt",n[6])},d(n){n&&_n(e)}}}function rT(r){let e,t;return{c(){e=Kr("img"),zi(e.src,t=r[3]+"housenumber.svg")||ot(e,"src",t),ot(e,"alt",r[6]),ot(e,"class","svelte-ltkwvy")},m(n,l){wn(n,e,l)},p(n,l){l&8&&!zi(e.src,t=n[3]+"housenumber.svg")&&ot(e,"src",t),l&64&&ot(e,"alt",n[6])},d(n){n&&_n(e)}}}function nT(r){let e,t,n,l;return{c(){e=Kr("img"),zi(e.src,t=r[5])||ot(e,"src",t),ot(e,"alt",r[4]),ot(e,"class","svelte-ltkwvy")},m(u,f){wn(u,e,f),n||(l=Zi(e,"error",r[14]),n=!0)},p(u,f){f&32&&!zi(e.src,t=u[5])&&ot(e,"src",t),f&16&&ot(e,"alt",u[4])},d(u){u&&_n(e),n=!1,l()}}}function v0(r){let e,t;return{c(){e=Kr("span"),t=da(r[6]),ot(e,"class","secondary svelte-ltkwvy")},m(n,l){wn(n,e,l),Lr(e,t)},p(n,l){l&64&&vh(t,n[6])},d(n){n&&_n(e)}}}function iT(r){let e,t,n,l,u,f,a,_,x,k=(r[7]?r[0].place_name:r[0].place_name.replace(/,.*/,""))+"",S,C,z=r[2]==="always"||r[2]!=="never"&&!r[0].address&&!r[0].id.startsWith("road.")&&!r[0].id.startsWith("address.")&&!r[0].id.startsWith("postal_code.")&&(!r[0].id.startsWith("poi.")||!r[5])&&!r[7],R,D,P=(r[7]?"":r[0].place_name.replace(/[^,]*,?\s*/,""))+"",B,N,V;function U(J,ye){return ye&1&&(t=null),ye&1&&(n=null),ye&1&&(l=null),ye&1&&(u=null),J[5]?nT:J[0].address?rT:(t==null&&(t=!!J[0].id.startsWith("road.")),t?tT:(n==null&&(n=!!J[0].id.startsWith("address.")),n?eT:(l==null&&(l=!!J[0].id.startsWith("postal_code.")),l?Q3:(u==null&&(u=!!J[0].id.startsWith("poi.")),u?Y3:J[7]?J3:K3))))}let te=U(r,-1),le=te(r),H=z&&v0(r);return{c(){e=Kr("li"),le.c(),f=go(),a=Kr("span"),_=Kr("span"),x=Kr("span"),S=da(k),C=go(),H&&H.c(),R=go(),D=Kr("span"),B=da(P),ot(x,"class","primary svelte-ltkwvy"),ot(_,"class","svelte-ltkwvy"),ot(D,"class","line2 svelte-ltkwvy"),ot(a,"class","texts svelte-ltkwvy"),ot(e,"tabindex","0"),ot(e,"data-selected",r[1]),ot(e,"class","svelte-ltkwvy"),Po(e,"selected",r[1])},m(J,ye){wn(J,e,ye),le.m(e,null),Lr(e,f),Lr(e,a),Lr(a,_),Lr(_,x),Lr(x,S),Lr(_,C),H&&H.m(_,null),Lr(a,R),Lr(a,D),Lr(D,B),N||(V=[Zi(e,"mouseenter",r[12]),Zi(e,"focus",r[13])],N=!0)},p(J,[ye]){te===(te=U(J,ye))&&le?le.p(J,ye):(le.d(1),le=te(J),le&&(le.c(),le.m(e,f))),ye&1&&k!==(k=(J[7]?J[0].place_name:J[0].place_name.replace(/,.*/,""))+"")&&vh(S,k),ye&37&&(z=J[2]==="always"||J[2]!=="never"&&!J[0].address&&!J[0].id.startsWith("road.")&&!J[0].id.startsWith("address.")&&!J[0].id.startsWith("postal_code.")&&(!J[0].id.startsWith("poi.")||!J[5])&&!J[7]),z?H?H.p(J,ye):(H=v0(J),H.c(),H.m(_,null)):H&&(H.d(1),H=null),ye&1&&P!==(P=(J[7]?"":J[0].place_name.replace(/[^,]*,?\s*/,""))+"")&&vh(B,P),ye&2&&ot(e,"data-selected",J[1]),ye&2&&Po(e,"selected",J[1])},i:gn,o:gn,d(J){J&&_n(e),le.d(),H&&H.d(),N=!1,js(V)}}}function oT(r,e,t){var n;let l,u,{feature:f}=e,{selected:a=!1}=e,{showPlaceType:_}=e,{missingIconsCache:x}=e,{iconsBaseUrl:k}=e;const S=(n=f.properties)==null?void 0:n.categories;let C,z,R=0,D=f.place_type[0]==="reverse";function P(){z&&x.add(z),t(10,R++,R)}function B(U){g0.call(this,r,U)}function N(U){g0.call(this,r,U)}const V=()=>P();return r.$$set=U=>{"feature"in U&&t(0,f=U.feature),"selected"in U&&t(1,a=U.selected),"showPlaceType"in U&&t(2,_=U.showPlaceType),"missingIconsCache"in U&&t(9,x=U.missingIconsCache),"iconsBaseUrl"in U&&t(3,k=U.iconsBaseUrl)},r.$$.update=()=>{var U,te,le,H;if(r.$$.dirty&3640)do t(11,l--,l),t(4,C=S==null?void 0:S[l]),t(5,z=C?k+C.replace(/ /g,"_")+".svg":void 0);while(l>-1&&(!z||x.has(z)));r.$$.dirty&1&&t(6,u=((te=(U=f.properties)==null?void 0:U.categories)==null?void 0:te.join(", "))??((H=(le=f.properties)==null?void 0:le.place_type_name)==null?void 0:H[0])??f.place_type[0])},t(11,l=(S==null?void 0:S.length)??0),[f,a,_,k,C,z,u,D,P,x,R,l,B,N,V]}class sT extends va{constructor(e){super(),ya(this,e,oT,iT,_a,{feature:0,selected:1,showPlaceType:2,missingIconsCache:9,iconsBaseUrl:3})}}function aT(r){let e;return{c(){e=Kr("div"),e.innerHTML='<svg viewBox="0 0 18 18" width="24" height="24" class="svelte-7cmwmc"><path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"></path><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"></path></svg>',ot(e,"class","svelte-7cmwmc")},m(t,n){wn(t,e,n)},p:gn,i:gn,o:gn,d(t){t&&_n(e)}}}class lT extends va{constructor(e){super(),ya(this,e,null,aT,_a,{})}}function cT(r){let e,t,n;return{c(){e=Zo("svg"),t=Zo("path"),ot(t,"stroke-width","4"),ot(t,"d","M 5,33.103579 C 5,17.607779 18.457,5 35,5 C 51.543,5 65,17.607779 65,33.103579 C 65,56.388679 40.4668,76.048179 36.6112,79.137779 C 36.3714,79.329879 36.2116,79.457979 36.1427,79.518879 C 35.8203,79.800879 35.4102,79.942779 35,79.942779 C 34.5899,79.942779 34.1797,79.800879 33.8575,79.518879 C 33.7886,79.457979 33.6289,79.330079 33.3893,79.138079 C 29.5346,76.049279 5,56.389379 5,33.103579 Z M 35.0001,49.386379 C 43.1917,49.386379 49.8323,42.646079 49.8323,34.331379 C 49.8323,26.016779 43.1917,19.276479 35.0001,19.276479 C 26.8085,19.276479 20.1679,26.016779 20.1679,34.331379 C 20.1679,42.646079 26.8085,49.386379 35.0001,49.386379 Z"),ot(t,"class","svelte-gzo3ar"),ot(e,"width",n=r[0]==="list"?20:void 0),ot(e,"viewBox","0 0 70 85"),ot(e,"fill","none"),ot(e,"class","svelte-gzo3ar"),Po(e,"in-map",r[0]!=="list"),Po(e,"list-icon",r[0]==="list")},m(l,u){wn(l,e,u),Lr(e,t)},p(l,[u]){u&1&&n!==(n=l[0]==="list"?20:void 0)&&ot(e,"width",n),u&1&&Po(e,"in-map",l[0]!=="list"),u&1&&Po(e,"list-icon",l[0]==="list")},i:gn,o:gn,d(l){l&&_n(e)}}}function uT(r,e,t){let{displayIn:n}=e;return r.$$set=l=>{"displayIn"in l&&t(0,n=l.displayIn)},[n]}class hT extends va{constructor(e){super(),ya(this,e,uT,cT,_a,{displayIn:0})}}function fT(r){let e,t;return{c(){e=Zo("svg"),t=Zo("path"),ot(t,"d","M30.003-26.765C13.46-26.765 0-14.158 0 1.337c0 23.286 24.535 42.952 28.39 46.04.24.192.402.316.471.376.323.282.732.424 1.142.424.41 0 .82-.142 1.142-.424.068-.06.231-.183.471-.376 3.856-3.09 28.39-22.754 28.39-46.04 0-15.495-13.46-28.102-30.003-28.102Zm1.757 12.469c4.38 0 7.858 1.052 10.431 3.158 2.595 2.105 3.89 4.913 3.89 8.422 0 2.34-.53 4.362-1.593 6.063-1.063 1.702-3.086 3.616-6.063 5.742-2.042 1.51-3.337 2.659-3.89 3.446-.532.787-.8 1.82-.8 3.096v1.914h-8.449V15.18c0-2.041.434-3.815 1.306-5.325.872-1.51 2.467-3.118 4.785-4.82 2.233-1.594 3.7-2.89 4.402-3.889a5.582 5.582 0 0 0 1.087-3.35c0-1.382-.51-2.435-1.531-3.158-1.02-.723-2.45-1.087-4.28-1.087-3.19 0-6.826 1.047-10.91 3.131l-3.472-6.986c4.742-2.659 9.77-3.992 15.087-3.992Zm-1.88 37.324c1.765 0 3.124.472 4.08 1.408.98.936 1.47 2.276 1.47 4.02 0 1.68-.49 3.007-1.47 3.985-.977.957-2.336 1.435-4.08 1.435-1.787 0-3.171-.465-4.15-1.4-.978-.958-1.47-2.298-1.47-4.02 0-1.787.48-3.14 1.436-4.054.957-.915 2.355-1.374 4.184-1.374Z"),ot(e,"viewBox","0 0 60.006 21.412"),ot(e,"width","14"),ot(e,"height","20"),ot(e,"class","svelte-en2qvf")},m(n,l){wn(n,e,l),Lr(e,t)},p:gn,i:gn,o:gn,d(n){n&&_n(e)}}}class dT extends va{constructor(e){super(),ya(this,e,null,fT,_a,{})}}function pT(r){let e,t,n;return{c(){e=Zo("svg"),t=Zo("circle"),n=Zo("path"),ot(t,"cx","4.789"),ot(t,"cy","4.787"),ot(t,"r","3.85"),ot(t,"class","svelte-1aq105l"),ot(n,"d","M12.063 12.063 7.635 7.635"),ot(n,"class","svelte-1aq105l"),ot(e,"xmlns","http://www.w3.org/2000/svg"),ot(e,"width","13"),ot(e,"height","13"),ot(e,"viewBox","0 0 13 13"),ot(e,"class","svelte-1aq105l")},m(l,u){wn(l,e,u),Lr(e,t),Lr(e,n)},p:gn,i:gn,o:gn,d(l){l&&_n(e)}}}class mT extends va{constructor(e){super(),ya(this,e,null,pT,_a,{})}}function gT(r,e,t){const n=e[1],l=e[0],u=n-l;return r===n&&t?r:((r-l)%u+u)%u+l}function bd(r){const e=[...r];return e[2]<e[0]&&(Math.abs((e[0]+e[2]+360)/2)>Math.abs((e[0]-360+e[2])/2)?e[0]-=360:e[2]+=360),e}let Ou;async function _T(r,e,t){const n=r==null?void 0:r.getCenterAndZoom();for(const l of e??[])if(!(n&&(l.minZoom!=null&&l.minZoom>n[0]||l.maxZoom!=null&&l.maxZoom<n[0]))){if(l.type==="fixed")return l.coordinates.join(",");e:if(l.type==="client-geolocation"){if(Ou&&l.cachedLocationExpiry&&Ou.time+l.cachedLocationExpiry>Date.now()){if(!Ou.coords)break e;return Ou.coords}let u;try{return u=await new Promise((f,a)=>{t.signal.addEventListener("abort",()=>{a(Error("aborted"))}),navigator.geolocation.getCurrentPosition(_=>{f([_.coords.longitude,_.coords.latitude].map(x=>x.toFixed(6)).join(","))},_=>{a(_)},l)}),u}catch{}finally{l.cachedLocationExpiry&&(Ou={time:Date.now(),coords:u})}if(t.signal.aborted)return}if(l.type==="server-geolocation")return"ip";if(n&&l.type==="map-center")return n[1].toFixed(6)+","+n[2].toFixed(6)}}const yT=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*(EAST|WEST|[EW])?$/i,b0=/^([+-]?[0-8]?[0-9])\s+([0-5]?[0-9]\.\d{3,})[\s,]{1,}([+-]?[0-1]?[0-9]?[0-9])\s+([0-5]?[0-9]\.\d{3,})$/,w0=/^(NORTH|SOUTH|[NS])?[\s]*([+-]?[0-8]?[0-9](?:[\.,]\d{3,}))[\s]*([]?)[\s]*(NORTH|SOUTH|[NS])?[\s]*[,/;]?[\s]*(EAST|WEST|[EW])?[\s]*([+-]?[0-1]?[0-9]?[0-9](?:[\.,]\d{3,}))[\s]*([]?)[\s]*(EAST|WEST|[EW])?$/i,x0=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(EAST|WEST|[EW])?$/i,S0=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)\s*(EAST|WEST|[EW])?$/i,k0=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''||||["\.])?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''||||["\.])?\s*(EAST|WEST|[EW])?$/i;function vT(r){if(!["DMS","DM","DD"].includes(r))throw new Error("invalid format specified");if(this.decimalCoordinates&&this.decimalCoordinates.trim()){const e=this.decimalCoordinates.split(",").map(z=>Number(z.trim())),t=Number(e[0]),n=Number(e[1]),l=Math.abs(t),u=Math.abs(n),f=t>0?"N":"S",a=n>0?"E":"W";let _;r=="DD"&&(_=`${l} ${f}, ${u} ${a}`);const x=Math.floor(l),k=Math.floor(u),S=(l-x)*60,C=(u-k)*60;if(r=="DM"){let z=T0(S,3).toFixed(3).padStart(6,"0"),R=T0(C,3).toFixed(3).padStart(6,"0");z.endsWith(".000")&&R.endsWith(".000")&&(z=z.replace(/\.000$/,""),R=R.replace(/\.000$/,"")),_=`${x} ${z}' ${f}, ${k} ${R}' ${a}`}if(r=="DMS"){const z=Math.floor(S),R=Math.floor(C);let D=((S-z)*60).toFixed(1).padStart(4,"0"),P=((C-R)*60).toFixed(1).padStart(4,"0");const B=z.toString().padStart(2,"0"),N=R.toString().padStart(2,"0");D.endsWith(".0")&&P.endsWith(".0")&&(D=D.replace(/\.0$/,""),P=P.replace(/\.0$/,"")),_=`${x} ${B}' ${D}" ${f}, ${k} ${N}' ${P}" ${a}`}return _}else throw new Error("no decimal coordinates to convert")}function T0(r,e){const t=Math.pow(10,e);return Math.round((r+Number.EPSILON)*t)/t}function Fg(r,e){e||(e=5),r=r.replace(/\s+/g," ").trim();let t=null,n=null,l="",u="",f=null,a=[],_=!1;if(yT.test(r))throw new Error("invalid coordinate value");if(b0.test(r))if(a=b0.exec(r),_=Nu(a),_)t=Math.abs(a[1])+a[2]/60,Number(a[1])<0&&(t*=-1),n=Math.abs(a[3])+a[4]/60,Number(a[3])<0&&(n*=-1),f="DM";else throw new Error("invalid coordinate format");else if(w0.test(r))if(a=w0.exec(r),_=Nu(a),_){if(t=a[2],n=a[6],t.includes(",")&&(t=t.replace(",",".")),n.includes(",")&&(n=n.replace(",",".")),f="DD",Number(Math.round(t))==Number(t))throw new Error("integer only coordinate provided");if(Number(Math.round(n))==Number(n))throw new Error("integer only coordinate provided");a[1]?(l=a[1],u=a[5]):a[4]&&(l=a[4],u=a[8])}else throw new Error("invalid decimal coordinate format");else if(x0.test(r))if(a=x0.exec(r),_=Nu(a),_)t=Math.abs(parseInt(a[2])),a[4]&&(t+=a[4]/60,f="DM"),a[6]&&(t+=a[6].replace(",",".")/3600,f="DMS"),parseInt(a[2])<0&&(t=-1*t),n=Math.abs(parseInt(a[9])),a[11]&&(n+=a[11]/60),a[13]&&(n+=a[13].replace(",",".")/3600),parseInt(a[9])<0&&(n=-1*n),a[1]?(l=a[1],u=a[8]):a[7]&&(l=a[7],u=a[14]);else throw new Error("invalid DMS coordinates format");else if(S0.test(r))if(a=S0.exec(r),_=Nu(a),_)t=Math.abs(parseInt(a[2])),a[4]&&(t+=a[4]/60,f="DM"),a[6]&&(t+=a[6]/3600,f="DMS"),parseInt(a[2])<0&&(t=-1*t),n=Math.abs(parseInt(a[10])),a[12]&&(n+=a[12]/60),a[14]&&(n+=a[14]/3600),parseInt(a[10])<0&&(n=-1*n),a[1]?(l=a[1],u=a[9]):a[8]&&(l=a[8],u=a[16]);else throw new Error("invalid DMS coordinates format");else if(k0.test(r)){if(a=k0.exec(r),_=Nu(a),a.filter(x=>x).length<=5)throw new Error("invalid coordinates format");if(_)t=Math.abs(parseInt(a[2])),a[4]&&(t+=a[4].replace(",",".")/60,f="DM"),a[6]&&(t+=a[6].replace(",",".")/3600,f="DMS"),parseInt(a[2])<0&&(t=-1*t),n=Math.abs(parseInt(a[10])),a[12]&&(n+=a[12].replace(",",".")/60),a[14]&&(n+=a[14].replace(",",".")/3600),parseInt(a[10])<0&&(n=-1*n),a[1]?(l=a[1],u=a[9]):a[8]&&(l=a[8],u=a[16]);else throw new Error("invalid coordinates format")}if(_){if(Math.abs(n)>=180)throw new Error("invalid longitude value");if(Math.abs(t)>=90)throw new Error("invalid latitude value");if(l&&!u||!l&&u)throw new Error("invalid coordinates value");if(l&&l==u)throw new Error("invalid coordinates format");t.toString().includes(",")&&(t=t.replace(",",".")),n.toString().includes(",")&&(n=n.replace(",","."));let x=/S|SOUTH/i;x.test(l)&&t>0&&(t=-1*t),x=/W|WEST/i,x.test(u)&&n>0&&(n=-1*n);const k=a[0].trim();let S,C;const z=/[,/;\u0020]/g,R=k.match(z);if(R==null){const B=Math.floor(r.length/2);S=k.substring(0,B).trim(),C=k.substring(B).trim()}else{let B;R.length%2==1?B=Math.floor(R.length/2):B=R.length/2-1;let N=0;if(B==0)N=k.indexOf(R[0]),S=k.substring(0,N).trim(),C=k.substring(N+1).trim();else{let V=0,U=0;for(;V<=B;)N=k.indexOf(R[V],U),U=N+1,V++;S=k.substring(0,N).trim(),C=k.substring(N+1).trim()}}const D=S.split(".");if(D.length==2&&D[1]==0&&D[1].length!=2)throw new Error("invalid coordinates format");const P=C.split(".");if(P.length==2&&P[1]==0&&P[1].length!=2)throw new Error("invalid coordinates format");if(/^\d+$/.test(S)||/^\d+$/.test(C))throw new Error("degree only coordinate/s provided");return t=Number(Number(t).toFixed(e)),n=Number(Number(n).toFixed(e)),Object.freeze({verbatimCoordinates:k,verbatimLatitude:S,verbatimLongitude:C,decimalLatitude:t,decimalLongitude:n,decimalCoordinates:`${t},${n}`,originalFormat:f,closeEnough:bT,toCoordinateFormat:vT})}else throw new Error("coordinates pattern match failed")}function Nu(r){if(!isNaN(r[0]))return!1;const e=[...r];if(e.shift(),e.length%2>0)return!1;const t=/^[-+]?\d+([\.,]\d+)?$/,n=/[eastsouthnorthwest]+/i,l=e.length/2;for(let u=0;u<l;u++){const f=e[u],a=e[u+l],_=t.test(f)&&t.test(a),x=n.test(f)&&n.test(a),k=f==a;if(!(f==null&&a==null)){if(f==null||a==null)return!1;if(_||x||k)continue;return!1}}return!0}function E0(r,e){const t=Math.abs(r-e);return Number(t.toFixed(6))<=1e-5}function bT(r){if(!r)throw new Error("coords must be provided");if(r.includes(",")){const e=r.split(",");if(Number(e[0])==NaN||Number(e[1])==NaN)throw new Error("coords are not valid decimals");return E0(this.decimalLatitude,Number(e[0]))&&E0(this.decimalLongitude,e[1])}else throw new Error("coords being tested must be separated by a comma")}const wT=Object.freeze({DMS:"DMS",DM:"DM",DD:"DD"});Fg.to=wT;const xT=[{verbatimCoordinates:"40.123, -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123 N 74.123 W",verbatimLatitude:"40.123 N",verbatimLongitude:"74.123 W"},{verbatimCoordinates:"40.123 N 74.123 W",verbatimLatitude:"40.123 N",verbatimLongitude:"74.123 W"},{verbatimCoordinates:'40 7 22.8" N 74 7 22.8" W',verbatimLatitude:'40 7 22.8" N',verbatimLongitude:'74 7 22.8" W'},{verbatimCoordinates:"40 7.38 , -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"N40722.8, W74722.8",verbatimLatitude:"N40722.8",verbatimLongitude:"W74722.8"},{verbatimCoordinates:'40722.8"N, 74722.8"W',verbatimLatitude:'40722.8"N',verbatimLongitude:'74722.8"W'},{verbatimCoordinates:`407'22.8"N, 747'22.8"W`,verbatimLatitude:`407'22.8"N`,verbatimLongitude:`747'22.8"W`},{verbatimCoordinates:"40 7 22.8, -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"},{verbatimCoordinates:"40.123 -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123,-74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123N74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"4007.38N7407.38W",verbatimLatitude:"4007.38N",verbatimLongitude:"7407.38W"},{verbatimCoordinates:'40722.8"N, 74722.8"W',verbatimLatitude:'40722.8"N',verbatimLongitude:'74722.8"W'},{verbatimCoordinates:"400722.8N740722.8W",verbatimLatitude:"400722.8N",verbatimLongitude:"740722.8W"},{verbatimCoordinates:"N 40 7.38 W 74 7.38",verbatimLatitude:"N 40 7.38",verbatimLongitude:"W 74 7.38"},{verbatimCoordinates:"40:7:22.8N 74:7:22.8W",verbatimLatitude:"40:7:22.8N",verbatimLongitude:"74:7:22.8W"},{verbatimCoordinates:"40:7:23N,74:7:23W",verbatimLatitude:"40:7:23N",verbatimLongitude:"74:7:23W",decimalLatitude:40.1230555555,decimalLongitude:-74.1230555555},{verbatimCoordinates:'40723"N 74723"W',verbatimLatitude:'40723"N',verbatimLongitude:'74723"W',decimalLatitude:40.1230555555,decimalLongitude:-74.12305555555555},{verbatimCoordinates:'40723"S 74723"E',verbatimLatitude:'40723"S',verbatimLongitude:'74723"E',decimalLatitude:-40.1230555555,decimalLongitude:74.12305555555555},{verbatimCoordinates:'40723" -74723"',verbatimLatitude:'40723"',verbatimLongitude:'-74723"',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:'40d 7 23" N 74d 7 23" W',verbatimLatitude:'40d 7 23" N',verbatimLongitude:'74d 7 23" W',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:"40.123N 74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"40 7.38, -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"40 7.38, -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"40 7 22.8; -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"}],ST={decimalLatitude:40.123,decimalLongitude:-74.123},kT=[{verbatimCoordinates:`504'17.698"south, 1424'2.826"east`,verbatimLatitude:`504'17.698"south`,verbatimLongitude:`1424'2.826"east`,decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"50d4m17.698S 14d24m2.826E",verbatimLatitude:"50d4m17.698S",verbatimLongitude:"14d24m2.826E",decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"40:26:46N,79:56:55W",verbatimLatitude:"40:26:46N",verbatimLongitude:"79:56:55W",decimalLatitude:40.44611111111111,decimalLongitude:-79.9486111111111},{verbatimCoordinates:"40:26:46.302N 79:56:55.903W",verbatimLatitude:"40:26:46.302N",verbatimLongitude:"79:56:55.903W",decimalLatitude:40.446195,decimalLongitude:-79.94886194444445},{verbatimCoordinates:"402647N 795836W",verbatimLatitude:"402647N",verbatimLongitude:"795836W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40d 26 47 N 79d 58 36 W",verbatimLatitude:"40d 26 47 N",verbatimLongitude:"79d 58 36 W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40.446195N 79.948862W",verbatimLatitude:"40.446195N",verbatimLongitude:"79.948862W",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40,446195 79,948862",verbatimLatitude:"40,446195",verbatimLongitude:"79,948862",decimalLatitude:40.446195,decimalLongitude:79.948862},{verbatimCoordinates:"40 26.7717, -79 56.93172",verbatimLatitude:"40 26.7717",verbatimLongitude:"-79 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.446195, -79.948862",verbatimLatitude:"40.446195",verbatimLongitude:"-79.948862",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.123256; -74.123256",verbatimLatitude:"40.123256",verbatimLongitude:"-74.123256",decimalLatitude:40.123256,decimalLongitude:-74.123256},{verbatimCoordinates:"1824S 2245E",verbatimLatitude:"1824S",verbatimLongitude:"2245E",decimalLatitude:-18.4,decimalLongitude:22.75}],TT=[{verbatimCoordinates:"10.432342S 10.6345345E",verbatimLatitude:"10.432342S",verbatimLongitude:"10.6345345E",decimalLatitude:-10.432342,decimalLongitude:10.6345345},{verbatimCoordinates:"10.00S 10.00E",verbatimLatitude:"10.00S",verbatimLongitude:"10.00E",decimalLatitude:-10,decimalLongitude:10},{verbatimCoordinates:"00.00S 01.00E",verbatimLatitude:"00.00S",verbatimLongitude:"01.00E",decimalLatitude:0,decimalLongitude:1},{verbatimCoordinates:"18.24S 22.45E",verbatimLatitude:"18.24S",verbatimLongitude:"22.45E",decimalLatitude:-18.4,decimalLongitude:22.75},{verbatimCoordinates:"27deg 15min 45.2sec S 18deg 32min 53.7sec E",verbatimLatitude:"27deg 15min 45.2sec S",verbatimLongitude:"18deg 32min 53.7sec E",decimalLatitude:-27.262555555555554,decimalLongitude:18.54825},{verbatimCoordinates:"-23.3245 S / 28.2344 E",verbatimLatitude:"-23.3245 S",verbatimLongitude:"28.2344 E",decimalLatitude:-23.3245,decimalLongitude:28.2344},{verbatimCoordinates:"40 26.7717 -79 56.93172",verbatimLatitude:"40 26.7717",verbatimLongitude:"-79 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"27.15.45S 18.32.53E",verbatimLatitude:"27.15.45S",verbatimLongitude:"18.32.53E",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"-27.15.45 18.32.53",verbatimLatitude:"-27.15.45",verbatimLongitude:"18.32.53",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"27.15.45.2S 18.32.53.4E",verbatimLatitude:"27.15.45.2S",verbatimLongitude:"18.32.53.4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"27.15.45,2S 18.32.53,4E",verbatimLatitude:"27.15.45,2S",verbatimLongitude:"18.32.53,4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"S23.43563   E22.45634 ",verbatimLatitude:"S23.43563 ",verbatimLongitude:"E22.45634 ",decimalLatitude:-23.43563,decimalLongitude:22.45634},{verbatimCoordinates:"27,71372 S 23,07771 E",verbatimLatitude:"27,71372 S",verbatimLongitude:"23,07771 E",decimalLatitude:-27.71372,decimalLongitude:23.07771},{verbatimCoordinates:"27.45.34 S 23.23.23 E",verbatimLatitude:"27.45.34 S",verbatimLongitude:"23.23.23 E",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"S 27.45.34 E 23.23.23",verbatimLatitude:"S 27.45.34",verbatimLongitude:"E 23.23.23",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"53 16.3863,4 52.8171",verbatimLatitude:"53 16.3863",verbatimLongitude:"4 52.8171",decimalLatitude:53.273105,decimalLongitude:4.88029},{verbatimCoordinates:"50 8.2914,-5 2.4447",verbatimLatitude:"50 8.2914",verbatimLongitude:"-5 2.4447",decimalLatitude:50.13819,decimalLongitude:-5.040745},{verbatimCoordinates:"N 48 30,6410', E 18 57,4583'",verbatimLatitude:"N 48 30,6410'",verbatimLongitude:"E 18 57,4583'",decimalLatitude:48.51068,decimalLongitude:18.95764},{verbatimCoordinates:"1.23456, 18.33453",verbatimLatitude:"1.23456",verbatimLongitude:"18.33453",decimalLatitude:1.23456,decimalLongitude:18.33453}];function ET(){const r=[];return xT.forEach(e=>{e.decimalLatitude?r.push(e):r.push({...e,...ST})}),[...r,...kT,...TT]}const CT=ET();Fg.formats=CT.map(r=>r.verbatimCoordinates);const MT=Fg;function C0(r,e,t){const n=r.slice();return n[84]=e[t],n[86]=t,n}function M0(r){let e,t;return e=new lT({}),{c(){pa(e.$$.fragment)},m(n,l){Fs(e,n,l),t=!0},i(n){t||(Zn(e.$$.fragment,n),t=!0)},o(n){hi(e.$$.fragment,n),t=!1},d(n){Os(e,n)}}}function I0(r){let e,t,n,l,u;return t=new dT({}),{c(){e=Kr("button"),pa(t.$$.fragment),ot(e,"type","button"),ot(e,"title",r[9]),ot(e,"class","svelte-bz0zu3"),Po(e,"active",r[0])},m(f,a){wn(f,e,a),Fs(t,e,null),n=!0,l||(u=Zi(e,"click",r[69]),l=!0)},p(f,a){(!n||a[0]&512)&&ot(e,"title",f[9]),(!n||a[0]&1)&&Po(e,"active",f[0])},i(f){n||(Zn(t.$$.fragment,f),n=!0)},o(f){hi(t.$$.fragment,f),n=!1},d(f){f&&_n(e),Os(t),l=!1,u()}}}function IT(r){let e,t=[],n=new Map,l,u,f,a=y0(r[14]);const _=x=>x[84].id+(x[84].address?","+x[84].address:"");for(let x=0;x<a.length;x+=1){let k=C0(r,a,x),S=_(k);n.set(S,t[x]=A0(S,k))}return{c(){e=Kr("ul");for(let x=0;x<t.length;x+=1)t[x].c();ot(e,"class","options svelte-bz0zu3")},m(x,k){wn(x,e,k);for(let S=0;S<t.length;S+=1)t[S]&&t[S].m(e,null);l=!0,u||(f=[Zi(e,"mouseleave",r[73]),Zi(e,"blur",r[74])],u=!0)},p(x,k){k[0]&17880064&&(a=y0(x[14]),ed(),t=G3(t,k,_,1,x,a,n,e,q3,A0,null,C0),td())},i(x){if(!l){for(let k=0;k<a.length;k+=1)Zn(t[k]);l=!0}},o(x){for(let k=0;k<t.length;k+=1)hi(t[k]);l=!1},d(x){x&&_n(e);for(let k=0;k<t.length;k+=1)t[k].d();u=!1,js(f)}}}function AT(r){let e,t,n,l,u,f;return t=new gw({}),{c(){e=Kr("div"),pa(t.$$.fragment),n=go(),l=Kr("div"),u=da(r[7]),ot(l,"class","svelte-bz0zu3"),ot(e,"class","no-results svelte-bz0zu3")},m(a,_){wn(a,e,_),Fs(t,e,null),Lr(e,n),Lr(e,l),Lr(l,u),f=!0},p(a,_){(!f||_[0]&128)&&vh(u,a[7])},i(a){f||(Zn(t.$$.fragment,a),f=!0)},o(a){hi(t.$$.fragment,a),f=!1},d(a){a&&_n(e),Os(t)}}}function LT(r){let e="",t;return{c(){t=da(e)},m(n,l){wn(n,t,l)},p:gn,i:gn,o:gn,d(n){n&&_n(t)}}}function PT(r){let e,t,n,l,u,f,a,_,x,k,S;return t=new gw({}),_=new mw({}),{c(){e=Kr("div"),pa(t.$$.fragment),n=go(),l=Kr("div"),u=da(r[6]),f=go(),a=Kr("button"),pa(_.$$.fragment),ot(l,"class","svelte-bz0zu3"),ot(a,"class","svelte-bz0zu3"),ot(e,"class","error svelte-bz0zu3")},m(C,z){wn(C,e,z),Fs(t,e,null),Lr(e,n),Lr(e,l),Lr(l,u),Lr(e,f),Lr(e,a),Fs(_,a,null),x=!0,k||(S=Zi(a,"click",r[70]),k=!0)},p(C,z){(!x||z[0]&64)&&vh(u,C[6])},i(C){x||(Zn(t.$$.fragment,C),Zn(_.$$.fragment,C),x=!0)},o(C){hi(t.$$.fragment,C),hi(_.$$.fragment,C),x=!1},d(C){C&&_n(e),Os(t),Os(_),k=!1,S()}}}function A0(r,e){let t,n,l;function u(){return e[71](e[86])}function f(){return e[72](e[84])}return n=new sT({props:{feature:e[84],showPlaceType:e[10],selected:e[15]===e[86],missingIconsCache:e[20],iconsBaseUrl:e[12]}}),n.$on("mouseenter",u),n.$on("focus",f),{key:r,first:null,c(){t=D3(),pa(n.$$.fragment),this.first=t},m(a,_){wn(a,t,_),Fs(n,a,_),l=!0},p(a,_){e=a;const x={};_[0]&16384&&(x.feature=e[84]),_[0]&1024&&(x.showPlaceType=e[10]),_[0]&49152&&(x.selected=e[15]===e[86]),_[0]&4096&&(x.iconsBaseUrl=e[12]),n.$set(x)},i(a){l||(Zn(n.$$.fragment,a),l=!0)},o(a){hi(n.$$.fragment,a),l=!1},d(a){a&&_n(t),Os(n,a)}}}function zT(r){let e,t,n,l,u,f,a,_,x,k,S,C,z,R,D,P,B,N,V,U,te,le=!1;u=new mT({}),S=new mw({});let H=r[19]&&M0(),J=r[5]==="button"&&I0(r);const ye=r[61].default,ze=A3(ye,r,r[60],null),ne=[PT,LT,AT,IT],be=[];function He(Ce,Qe){var _t,Ut;return Ce[18]?0:Ce[16]?((_t=Ce[14])==null?void 0:_t.length)===0?2:Ce[16]&&(Ut=Ce[14])!=null&&Ut.length?3:-1:1}return~(P=He(r))&&(B=be[P]=ne[P](r)),{c(){e=go(),t=Kr("form"),n=Kr("div"),l=Kr("button"),pa(u.$$.fragment),f=go(),a=Kr("input"),_=go(),x=Kr("div"),k=Kr("button"),pa(S.$$.fragment),C=go(),H&&H.c(),z=go(),J&&J.c(),R=go(),ze&&ze.c(),D=go(),B&&B.c(),ot(l,"class","search-button svelte-bz0zu3"),ot(l,"type","button"),ot(a,"placeholder",r[8]),ot(a,"aria-label",r[8]),ot(a,"class","svelte-bz0zu3"),ot(k,"type","button"),ot(k,"title",r[3]),ot(k,"class","svelte-bz0zu3"),ot(x,"class","clear-button-container svelte-bz0zu3"),Po(x,"displayable",r[1]!==""),ot(n,"class","input-group svelte-bz0zu3"),ot(t,"tabindex","0"),ot(t,"class",N=p0(r[2])+" svelte-bz0zu3"),Po(t,"can-collapse",r[4]&&r[1]==="")},m(Ce,Qe){wn(Ce,e,Qe),wn(Ce,t,Qe),Lr(t,n),Lr(n,l),Fs(u,l,null),Lr(n,f),Lr(n,a),r[63](a),m0(a,r[1]),Lr(n,_),Lr(n,x),Lr(x,k),Fs(S,k,null),Lr(x,C),H&&H.m(x,null),Lr(n,z),J&&J.m(n,null),Lr(n,R),ze&&ze.m(n,null),Lr(t,D),~P&&be[P].m(t,null),V=!0,U||(te=[Zi(l,"click",r[62]),Zi(a,"input",r[64]),Zi(a,"focus",r[65]),Zi(a,"blur",r[66]),Zi(a,"keydown",r[22]),Zi(a,"input",r[67]),Zi(k,"click",r[68]),Zi(t,"submit",R3(r[21]))],U=!0)},p(Ce,Qe){(!V||Qe[0]&256)&&ot(a,"placeholder",Ce[8]),(!V||Qe[0]&256)&&ot(a,"aria-label",Ce[8]),Qe[0]&2&&a.value!==Ce[1]&&m0(a,Ce[1]),(!V||Qe[0]&8)&&ot(k,"title",Ce[3]),Ce[19]?H?Qe[0]&524288&&Zn(H,1):(H=M0(),H.c(),Zn(H,1),H.m(x,null)):H&&(ed(),hi(H,1,1,()=>{H=null}),td()),(!V||Qe[0]&2)&&Po(x,"displayable",Ce[1]!==""),Ce[5]==="button"?J?(J.p(Ce,Qe),Qe[0]&32&&Zn(J,1)):(J=I0(Ce),J.c(),Zn(J,1),J.m(n,R)):J&&(ed(),hi(J,1,1,()=>{J=null}),td()),ze&&ze.p&&(!V||Qe[1]&536870912)&&P3(ze,ye,Ce,Ce[60],V?L3(ye,Ce[60],Qe,null):z3(Ce[60]),null);let _t=P;P=He(Ce),P===_t?~P&&be[P].p(Ce,Qe):(B&&(ed(),hi(be[_t],1,1,()=>{be[_t]=null}),td()),~P?(B=be[P],B?B.p(Ce,Qe):(B=be[P]=ne[P](Ce),B.c()),Zn(B,1),B.m(t,null)):B=null),(!V||Qe[0]&4&&N!==(N=p0(Ce[2])+" svelte-bz0zu3"))&&ot(t,"class",N),(!V||Qe[0]&22)&&Po(t,"can-collapse",Ce[4]&&Ce[1]==="")},i(Ce){V||(Zn(le),Zn(u.$$.fragment,Ce),Zn(S.$$.fragment,Ce),Zn(H),Zn(J),Zn(ze,Ce),Zn(B),V=!0)},o(Ce){hi(le),hi(u.$$.fragment,Ce),hi(S.$$.fragment,Ce),hi(H),hi(J),hi(ze,Ce),hi(B),V=!1},d(Ce){Ce&&(_n(e),_n(t)),Os(u),r[63](null),Os(S),H&&H.d(),J&&J.d(),ze&&ze.d(Ce),~P&&be[P].d(),U=!1,js(te)}}}function DT(r,e,t){let n,l,{$$slots:u={},$$scope:f}=e;const a={continental_marine:4,country:4,major_landform:8,region:5,subregion:6,county:7,joint_municipality:8,joint_submunicipality:9,municipality:10,municipal_district:11,locality:12,neighbourhood:13,place:14,postal_code:14,road:16,poi:17,address:18,"poi.peak":15,"poi.shop":18,"poi.cafe":18,"poi.restaurant":18,"poi.aerodrome":13};let{class:_=void 0}=e,{apiKey:x}=e,{bbox:k=void 0}=e,{clearButtonTitle:S="clear"}=e,{clearOnBlur:C=!1}=e,{collapsed:z=!1}=e,{country:R=void 0}=e,{debounceSearch:D=200}=e,{enableReverse:P="never"}=e,{errorMessage:B="Something went wrong"}=e,{filter:N=()=>!0}=e,{flyTo:V=!0}=e,{fuzzyMatch:U=!0}=e,{language:te=void 0}=e,{limit:le=void 0}=e,{mapController:H=void 0}=e,{minLength:J=2}=e,{noResultsMessage:ye="Oops! Looks like you're trying to predict something that's not quite right. We can't seem to find what you're looking for. Maybe try double-checking your spelling or try a different search term. Keep on typing - we'll do our best to get you where you need to go!"}=e,{placeholder:ze="Search"}=e,{proximity:ne=[{type:"server-geolocation"}]}=e,{reverseActive:be=P==="always"}=e,{reverseButtonTitle:He="toggle reverse geocoding"}=e,{searchValue:Ce=""}=e,{pickedResultStyle:Qe="full-geometry"}=e,{showPlaceType:_t="if-needed"}=e,{showResultsWhileTyping:Ut=!0}=e,{selectFirst:Je=!0}=e,{flyToSelected:Yt=!1}=e,{markerOnSelected:Kt=!0}=e,{types:Ft=void 0}=e,{exhaustiveReverseGeocoding:Ot=!1}=e,{excludeTypes:Jt=!1}=e,{zoom:Et=a}=e,{apiUrl:sr="https://api.maptiler.com/geocoding"}=e,{fetchParameters:zt={}}=e,{iconsBaseUrl:rr="https://cdn.maptiler.com/maptiler-geocoding-control/v2.0.1/icons/"}=e,{adjustUrlQuery:wr=()=>{}}=e;function gr(){Ne.focus()}function Br(){Ne.blur()}function ht(G,je=!0,Ve=!1){t(1,Ce=G),je?(t(15,We=-1),lt()):(Qt(!Ve,Ve),setTimeout(()=>{Ne.focus(),Ne.select()}))}function Mt(){t(14,it=void 0),t(56,ie=void 0),t(15,We=-1)}function De(){t(55,xt=[]),t(56,ie=void 0)}let ut=!1,it,xt,ie,nr="",Ne,We=-1,wt,xn=[],Sn,In,ii,oi;const Xo=new Set,Jr=N3();O3(()=>{H&&(H.setEventHandler(void 0),H.indicateReverse(!1),H.setSelectedMarker(-1),H.setFeatures(void 0,void 0,!1))});function lt(G){if(In&&(clearTimeout(In),In=void 0),We>-1&&it)t(56,ie=it[We]),t(1,Ce=ie.place_type[0]==="reverse"?ie.place_name:ie.place_name.replace(/,.*/,"")),t(18,wt=void 0),t(55,xt=void 0),t(15,We=-1);else if(Ce){const je=G||!Xn(Ce);kn(Ce,{exact:!0}).then(()=>{t(55,xt=it),t(56,ie=void 0),je&&Fo()}).catch(Ve=>t(18,wt=Ve))}}function Xn(G){try{return MT(G,6)}catch{return!1}}async function kn(G,{byId:je=!1,exact:Ve=!1}={}){t(18,wt=void 0),Sn==null||Sn.abort();const qe=new AbortController;t(19,Sn=qe);try{const Ke=Xn(G),ct=new URLSearchParams;if(te!==void 0&&ct.set("language",Array.isArray(te)?te.join(","):te??""),Ft&&ct.set("types",Ft.join(",")),Jt&&ct.set("excludeTypes",String(Jt)),k&&ct.set("bbox",k.map(_r=>_r.toFixed(6)).join(",")),R&&ct.set("country",Array.isArray(R)?R.join(","):R),!je&&!Ke){const _r=await _T(H,ne,qe);_r&&ct.set("proximity",_r),(Ve||!Ut)&&ct.set("autocomplete","false"),ct.set("fuzzyMatch",String(U))}le!==void 0&&(Ot||!Ke||(Ft==null?void 0:Ft.length)===1)&&ct.set("limit",String(le)),ct.set("key",x),wr(ct);const Dt=sr+"/"+encodeURIComponent(Ke?Ke.decimalLongitude+","+Ke.decimalLatitude:G)+".json?"+ct.toString();if(Dt===nr){je?(t(14,it=void 0),t(56,ie=xn[0])):t(14,it=xn);return}nr=Dt;const Ht=await fetch(Dt,{signal:qe.signal,...zt});if(!Ht.ok)throw new Error(await Ht.text());const cr=await Ht.json();Jr("response",{url:Dt,featureCollection:cr}),je?(t(14,it=void 0),t(56,ie=cr.features[0]),xn=[ie]):(t(14,it=cr.features.filter(N)),Ke&&it.unshift({type:"Feature",properties:{},id:"reverse_"+Ke.decimalLongitude+"_"+Ke.decimalLatitude,text:Ke.decimalLatitude+", "+Ke.decimalLongitude,place_name:Ke.decimalLatitude+", "+Ke.decimalLongitude,place_type:["reverse"],center:[Ke.decimalLongitude,Ke.decimalLatitude],bbox:[Ke.decimalLongitude,Ke.decimalLatitude,Ke.decimalLongitude,Ke.decimalLatitude],geometry:{type:"Point",coordinates:[Ke.decimalLongitude,Ke.decimalLatitude]}}),xn=it,Ke&&Ne.focus())}catch(Ke){if(Ke&&typeof Ke=="object"&&"name"in Ke&&Ke.name==="AbortError")return;throw Ke}finally{qe===Sn&&t(19,Sn=void 0)}}function Fo(){var G;if(!(xt!=null&&xt.length)||!V)return;const je=[180,90,-180,-90],Ve=!xt.some(Ke=>!Ke.matching_text);let qe;for(const Ke of xt){const ct=Nr(Ke);if(qe=qe===void 0?ct:ct===void 0?qe:Math.max(qe,ct),Ve||!Ke.matching_text)for(const Dt of[0,1,2,3])je[Dt]=Math[Dt<2?"min":"max"](je[Dt],((G=Ke.bbox)==null?void 0:G[Dt])??Ke.center[Dt%2])}H&&xt.length>0&&(ie&&je[0]===je[2]&&je[1]===je[3]?H.flyTo(ie.center,Nr(ie)):H.fitBounds(bd(je),50,qe))}function Nr(G){var je;if(!G.bbox||G.bbox[0]!==G.bbox[2]&&G.bbox[1]!==G.bbox[3])return;const Ve=G.id.replace(/\..*/,"");return(Array.isArray((je=G.properties)==null?void 0:je.categories)?G.properties.categories.reduce((qe,Ke)=>{const ct=Et[Ve+"."+Ke];return qe===void 0?ct:ct===void 0?qe:Math.max(qe,ct)},void 0):void 0)??Et[Ve]}function mt(G){t(0,be=P==="always"),t(14,it=void 0),t(56,ie=void 0),t(15,We=-1),ht(G[1].toFixed(6)+", "+gT(G[0],[-180,180],!0).toFixed(6),!1,!0)}function ir(G){if(!it)return;let je=G.key==="ArrowDown"?1:G.key==="ArrowUp"?-1:0;je&&(We===(Je?0:-1)&&je===-1&&t(15,We=it.length),t(15,We+=je),We>=it.length&&t(15,We=-1),We<0&&Je&&t(15,We=0),G.preventDefault())}function Qt(G=!0,je=!1){if(t(18,wt=void 0),Ut||je){if(In&&clearTimeout(In),Ce.length<J)return;const Ve=Ce;In=window.setTimeout(()=>{kn(Ve).catch(qe=>t(18,wt=qe))},G?D:0)}else t(14,it=void 0),t(18,wt=void 0)}function jr(G){t(56,ie=G),t(1,Ce=G.place_name),t(15,We=-1)}const wi=()=>Ne.focus();function tr(G){$m[G?"unshift":"push"](()=>{Ne=G,t(17,Ne)})}function io(){Ce=this.value,t(1,Ce),t(13,ut),t(28,C)}const cn=()=>t(13,ut=!0),ge=()=>t(13,ut=!1),W=()=>Qt(),X=()=>{t(1,Ce=""),Ne.focus()},ee=()=>t(0,be=!be),he=()=>t(18,wt=void 0),Me=G=>t(15,We=G),Ie=G=>jr(G),Pe=()=>{Je||t(15,We=-1)},Se=()=>{};return r.$$set=G=>{"class"in G&&t(2,_=G.class),"apiKey"in G&&t(26,x=G.apiKey),"bbox"in G&&t(27,k=G.bbox),"clearButtonTitle"in G&&t(3,S=G.clearButtonTitle),"clearOnBlur"in G&&t(28,C=G.clearOnBlur),"collapsed"in G&&t(4,z=G.collapsed),"country"in G&&t(29,R=G.country),"debounceSearch"in G&&t(30,D=G.debounceSearch),"enableReverse"in G&&t(5,P=G.enableReverse),"errorMessage"in G&&t(6,B=G.errorMessage),"filter"in G&&t(31,N=G.filter),"flyTo"in G&&t(32,V=G.flyTo),"fuzzyMatch"in G&&t(33,U=G.fuzzyMatch),"language"in G&&t(34,te=G.language),"limit"in G&&t(35,le=G.limit),"mapController"in G&&t(36,H=G.mapController),"minLength"in G&&t(37,J=G.minLength),"noResultsMessage"in G&&t(7,ye=G.noResultsMessage),"placeholder"in G&&t(8,ze=G.placeholder),"proximity"in G&&t(38,ne=G.proximity),"reverseActive"in G&&t(0,be=G.reverseActive),"reverseButtonTitle"in G&&t(9,He=G.reverseButtonTitle),"searchValue"in G&&t(1,Ce=G.searchValue),"pickedResultStyle"in G&&t(39,Qe=G.pickedResultStyle),"showPlaceType"in G&&t(10,_t=G.showPlaceType),"showResultsWhileTyping"in G&&t(40,Ut=G.showResultsWhileTyping),"selectFirst"in G&&t(11,Je=G.selectFirst),"flyToSelected"in G&&t(41,Yt=G.flyToSelected),"markerOnSelected"in G&&t(42,Kt=G.markerOnSelected),"types"in G&&t(43,Ft=G.types),"exhaustiveReverseGeocoding"in G&&t(44,Ot=G.exhaustiveReverseGeocoding),"excludeTypes"in G&&t(45,Jt=G.excludeTypes),"zoom"in G&&t(46,Et=G.zoom),"apiUrl"in G&&t(47,sr=G.apiUrl),"fetchParameters"in G&&t(48,zt=G.fetchParameters),"iconsBaseUrl"in G&&t(12,rr=G.iconsBaseUrl),"adjustUrlQuery"in G&&t(49,wr=G.adjustUrlQuery),"$$scope"in G&&t(60,f=G.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&32&&t(0,be=P==="always"),r.$$.dirty[0]&268443648&&setTimeout(()=>{t(16,ii=ut),C&&!ut&&t(1,Ce="")}),r.$$.dirty[0]&16386|r.$$.dirty[1]&64&&Ce.length<J&&(t(56,ie=void 0),t(14,it=void 0),t(18,wt=void 0),t(55,xt=it)),r.$$.dirty[1]&33554688&&Qe!=="marker-only"&&ie&&!ie.address&&ie.geometry.type==="Point"&&ie.place_type[0]!=="reverse"&&kn(ie.id,{byId:!0}).catch(G=>t(18,wt=G)),r.$$.dirty[1]&100663330&&(H&&ie&&ie.id!==oi&&V&&(!ie.bbox||ie.bbox[0]===ie.bbox[2]&&ie.bbox[1]===ie.bbox[3]?H.flyTo(ie.center,Nr(ie)):H.fitBounds(bd(ie.bbox),50,Nr(ie)),t(14,it=void 0),t(55,xt=void 0),t(15,We=-1)),t(57,oi=ie==null?void 0:ie.id)),r.$$.dirty[0]&18432&&Je&&it!=null&&it.length&&t(15,We=0),r.$$.dirty[0]&2&&t(15,We=-1),r.$$.dirty[0]&16384|r.$$.dirty[1]&16777216&&xt!==it&&t(55,xt=void 0),r.$$.dirty[0]&81921|r.$$.dirty[1]&16777248&&H&&H.setEventHandler(G=>{switch(G.type){case"mapClick":be&&mt(G.coordinates);break;case"markerClick":{const je=it==null?void 0:it.find(Ve=>Ve.id===G.id);je&&jr(je)}break;case"markerMouseEnter":xt&&t(15,We=ii?(it==null?void 0:it.findIndex(je=>je.id===G.id))??-1:-1);break;case"markerMouseLeave":xt&&t(15,We=-1);break}}),r.$$.dirty[0]&49152&&t(58,l=it==null?void 0:it[We]),r.$$.dirty[1]&134218786&&H&&l&&V&&Yt&&H.flyTo(l.center,Nr(l)),r.$$.dirty[1]&256&&t(59,n=Qe==="full-geometry-including-polygon-center-marker"),r.$$.dirty[1]&268437536&&(Kt||H==null||H.setFeatures(void 0,void 0,n)),r.$$.dirty[1]&419432480&&H&&Kt&&!xt&&(H.setFeatures(l?[l]:void 0,void 0,n),H.setSelectedMarker(l?0:-1)),r.$$.dirty[1]&318767136&&H&&H.setFeatures(xt,ie,n),r.$$.dirty[0]&32768|r.$$.dirty[1]&16777248&&xt&&H&&H.setSelectedMarker(We),r.$$.dirty[0]&2|r.$$.dirty[1]&32&&H){const G=Xn(Ce);H.setReverseMarker(G?[G.decimalLongitude,G.decimalLatitude]:void 0)}r.$$.dirty[1]&134217728&&Jr("select",{feature:l}),r.$$.dirty[1]&33554432&&Jr("pick",{feature:ie}),r.$$.dirty[0]&81920&&Jr("optionsvisibilitychange",{optionsVisible:ii&&!!it}),r.$$.dirty[0]&16384&&Jr("featureslisted",{features:it}),r.$$.dirty[1]&16777216&&Jr("featuresmarked",{features:xt}),r.$$.dirty[0]&1&&Jr("reversetoggle",{reverse:be}),r.$$.dirty[0]&2&&Jr("querychange",{query:Ce}),r.$$.dirty[0]&1|r.$$.dirty[1]&32&&H&&H.indicateReverse(be)},[be,Ce,_,S,z,P,B,ye,ze,He,_t,Je,rr,ut,it,We,ii,Ne,wt,Sn,Xo,lt,ir,Qt,jr,a,x,k,C,R,D,N,V,U,te,le,H,J,ne,Qe,Ut,Yt,Kt,Ft,Ot,Jt,Et,sr,zt,wr,gr,Br,ht,Mt,De,xt,ie,oi,l,n,f,u,wi,tr,io,cn,ge,W,X,ee,he,Me,Ie,Pe,Se]}let RT=class extends va{constructor(r){super(),ya(this,r,DT,zT,_a,{ZOOM_DEFAULTS:25,class:2,apiKey:26,bbox:27,clearButtonTitle:3,clearOnBlur:28,collapsed:4,country:29,debounceSearch:30,enableReverse:5,errorMessage:6,filter:31,flyTo:32,fuzzyMatch:33,language:34,limit:35,mapController:36,minLength:37,noResultsMessage:7,placeholder:8,proximity:38,reverseActive:0,reverseButtonTitle:9,searchValue:1,pickedResultStyle:39,showPlaceType:10,showResultsWhileTyping:40,selectFirst:11,flyToSelected:41,markerOnSelected:42,types:43,exhaustiveReverseGeocoding:44,excludeTypes:45,zoom:46,apiUrl:47,fetchParameters:48,iconsBaseUrl:12,adjustUrlQuery:49,focus:50,blur:51,setQuery:52,clearList:53,clearMap:54},null,[-1,-1,-1])}get ZOOM_DEFAULTS(){return this.$$.ctx[25]}get focus(){return this.$$.ctx[50]}get blur(){return this.$$.ctx[51]}get setQuery(){return this.$$.ctx[52]}get clearList(){return this.$$.ctx[53]}get clearMap(){return this.$$.ctx[54]}};function wh(r,e,t={}){const n={type:"Feature"};return(t.id===0||t.id)&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.properties=e||{},n.geometry=r,n}function Og(r,e,t={}){for(const n of r){if(n.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(n[n.length-1].length!==n[0].length)throw new Error("First and last Position are not equivalent.");for(let l=0;l<n[n.length-1].length;l++)if(n[n.length-1][l]!==n[0][l])throw new Error("First and last Position are not equivalent.")}return wh({type:"Polygon",coordinates:r},e,t)}function xh(r,e={}){const t={type:"FeatureCollection"};return e.id&&(t.id=e.id),e.bbox&&(t.bbox=e.bbox),t.features=r,t}function _w(r,e,t={}){return wh({type:"MultiPolygon",coordinates:r},e,t)}/**
 * splaytree v3.1.2
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function BT(r,e){var t={label:0,sent:function(){if(u[0]&1)throw u[1];return u[1]},trys:[],ops:[]},n,l,u,f;return f={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(f[Symbol.iterator]=function(){return this}),f;function a(x){return function(k){return _([x,k])}}function _(x){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,l&&(u=x[0]&2?l.return:x[0]?l.throw||((u=l.return)&&u.call(l),0):l.next)&&!(u=u.call(l,x[1])).done)return u;switch(l=0,u&&(x=[x[0]&2,u.value]),x[0]){case 0:case 1:u=x;break;case 4:return t.label++,{value:x[1],done:!1};case 5:t.label++,l=x[1],x=[0];continue;case 7:x=t.ops.pop(),t.trys.pop();continue;default:if(u=t.trys,!(u=u.length>0&&u[u.length-1])&&(x[0]===6||x[0]===2)){t=0;continue}if(x[0]===3&&(!u||x[1]>u[0]&&x[1]<u[3])){t.label=x[1];break}if(x[0]===6&&t.label<u[1]){t.label=u[1],u=x;break}if(u&&t.label<u[2]){t.label=u[2],t.ops.push(x);break}u[2]&&t.ops.pop(),t.trys.pop();continue}x=e.call(r,t)}catch(k){x=[6,k],l=0}finally{n=u=0}if(x[0]&5)throw x[1];return{value:x[0]?x[1]:void 0,done:!0}}}var ma=function(){function r(e,t){this.next=null,this.key=e,this.data=t,this.left=null,this.right=null}return r}();function FT(r,e){return r>e?1:r<e?-1:0}function aa(r,e,t){for(var n=new ma(null,null),l=n,u=n;;){var f=t(r,e.key);if(f<0){if(e.left===null)break;if(t(r,e.left.key)<0){var a=e.left;if(e.left=a.right,a.right=e,e=a,e.left===null)break}u.left=e,u=e,e=e.left}else if(f>0){if(e.right===null)break;if(t(r,e.right.key)>0){var a=e.right;if(e.right=a.left,a.left=e,e=a,e.right===null)break}l.right=e,l=e,e=e.right}else break}return l.right=e.left,u.left=e.right,e.left=n.right,e.right=n.left,e}function am(r,e,t,n){var l=new ma(r,e);if(t===null)return l.left=l.right=null,l;t=aa(r,t,n);var u=n(r,t.key);return u<0?(l.left=t.left,l.right=t,t.left=null):u>=0&&(l.right=t.right,l.left=t,t.right=null),l}function L0(r,e,t){var n=null,l=null;if(e){e=aa(r,e,t);var u=t(e.key,r);u===0?(n=e.left,l=e.right):u<0?(l=e.right,e.right=null,n=e):(n=e.left,e.left=null,l=e)}return{left:n,right:l}}function OT(r,e,t){return e===null?r:(r===null||(e=aa(r.key,e,t),e.left=r),e)}function Wm(r,e,t,n,l){if(r){n(""+e+(t?" ":" ")+l(r)+`
`);var u=e+(t?"    ":"   ");r.left&&Wm(r.left,u,!1,n,l),r.right&&Wm(r.right,u,!0,n,l)}}var Ng=function(){function r(e){e===void 0&&(e=FT),this._root=null,this._size=0,this._comparator=e}return r.prototype.insert=function(e,t){return this._size++,this._root=am(e,t,this._root,this._comparator)},r.prototype.add=function(e,t){var n=new ma(e,t);this._root===null&&(n.left=n.right=null,this._size++,this._root=n);var l=this._comparator,u=aa(e,this._root,l),f=l(e,u.key);return f===0?this._root=u:(f<0?(n.left=u.left,n.right=u,u.left=null):f>0&&(n.right=u.right,n.left=u,u.right=null),this._size++,this._root=n),this._root},r.prototype.remove=function(e){this._root=this._remove(e,this._root,this._comparator)},r.prototype._remove=function(e,t,n){var l;if(t===null)return null;t=aa(e,t,n);var u=n(e,t.key);return u===0?(t.left===null?l=t.right:(l=aa(e,t.left,n),l.right=t.right),this._size--,l):t},r.prototype.pop=function(){var e=this._root;if(e){for(;e.left;)e=e.left;return this._root=aa(e.key,this._root,this._comparator),this._root=this._remove(e.key,this._root,this._comparator),{key:e.key,data:e.data}}return null},r.prototype.findStatic=function(e){for(var t=this._root,n=this._comparator;t;){var l=n(e,t.key);if(l===0)return t;l<0?t=t.left:t=t.right}return null},r.prototype.find=function(e){return this._root&&(this._root=aa(e,this._root,this._comparator),this._comparator(e,this._root.key)!==0)?null:this._root},r.prototype.contains=function(e){for(var t=this._root,n=this._comparator;t;){var l=n(e,t.key);if(l===0)return!0;l<0?t=t.left:t=t.right}return!1},r.prototype.forEach=function(e,t){for(var n=this._root,l=[],u=!1;!u;)n!==null?(l.push(n),n=n.left):l.length!==0?(n=l.pop(),e.call(t,n),n=n.right):u=!0;return this},r.prototype.range=function(e,t,n,l){for(var u=[],f=this._comparator,a=this._root,_;u.length!==0||a;)if(a)u.push(a),a=a.left;else{if(a=u.pop(),_=f(a.key,t),_>0)break;if(f(a.key,e)>=0&&n.call(l,a))return this;a=a.right}return this},r.prototype.keys=function(){var e=[];return this.forEach(function(t){var n=t.key;return e.push(n)}),e},r.prototype.values=function(){var e=[];return this.forEach(function(t){var n=t.data;return e.push(n)}),e},r.prototype.min=function(){return this._root?this.minNode(this._root).key:null},r.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},r.prototype.minNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.left;)e=e.left;return e},r.prototype.maxNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.right;)e=e.right;return e},r.prototype.at=function(e){for(var t=this._root,n=!1,l=0,u=[];!n;)if(t)u.push(t),t=t.left;else if(u.length>0){if(t=u.pop(),l===e)return t;l++,t=t.right}else n=!0;return null},r.prototype.next=function(e){var t=this._root,n=null;if(e.right){for(n=e.right;n.left;)n=n.left;return n}for(var l=this._comparator;t;){var u=l(e.key,t.key);if(u===0)break;u<0?(n=t,t=t.left):t=t.right}return n},r.prototype.prev=function(e){var t=this._root,n=null;if(e.left!==null){for(n=e.left;n.right;)n=n.right;return n}for(var l=this._comparator;t;){var u=l(e.key,t.key);if(u===0)break;u<0?t=t.left:(n=t,t=t.right)}return n},r.prototype.clear=function(){return this._root=null,this._size=0,this},r.prototype.toList=function(){return jT(this._root)},r.prototype.load=function(e,t,n){t===void 0&&(t=[]),n===void 0&&(n=!1);var l=e.length,u=this._comparator;if(n&&Xm(e,t,0,l-1,u),this._root===null)this._root=Zm(e,t,0,l),this._size=l;else{var f=UT(this.toList(),NT(e,t),u);l=this._size+l,this._root=Hm({head:f},0,l)}return this},r.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(r.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),r.prototype.toString=function(e){e===void 0&&(e=function(n){return String(n.key)});var t=[];return Wm(this._root,"",!0,function(n){return t.push(n)},e),t.join("")},r.prototype.update=function(e,t,n){var l=this._comparator,u=L0(e,this._root,l),f=u.left,a=u.right;l(e,t)<0?a=am(t,n,a,l):f=am(t,n,f,l),this._root=OT(f,a,l)},r.prototype.split=function(e){return L0(e,this._root,this._comparator)},r.prototype[Symbol.iterator]=function(){var e,t,n;return BT(this,function(l){switch(l.label){case 0:e=this._root,t=[],n=!1,l.label=1;case 1:return n?[3,6]:e===null?[3,2]:(t.push(e),e=e.left,[3,5]);case 2:return t.length===0?[3,4]:(e=t.pop(),[4,e]);case 3:return l.sent(),e=e.right,[3,5];case 4:n=!0,l.label=5;case 5:return[3,1];case 6:return[2]}})},r}();function Zm(r,e,t,n){var l=n-t;if(l>0){var u=t+Math.floor(l/2),f=r[u],a=e[u],_=new ma(f,a);return _.left=Zm(r,e,t,u),_.right=Zm(r,e,u+1,n),_}return null}function NT(r,e){for(var t=new ma(null,null),n=t,l=0;l<r.length;l++)n=n.next=new ma(r[l],e[l]);return n.next=null,t.next}function jT(r){for(var e=r,t=[],n=!1,l=new ma(null,null),u=l;!n;)e?(t.push(e),e=e.left):t.length>0?(e=u=u.next=t.pop(),e=e.right):n=!0;return u.next=null,l.next}function Hm(r,e,t){var n=t-e;if(n>0){var l=e+Math.floor(n/2),u=Hm(r,e,l),f=r.head;return f.left=u,r.head=r.head.next,f.right=Hm(r,l+1,t),f}return null}function UT(r,e,t){for(var n=new ma(null,null),l=n,u=r,f=e;u!==null&&f!==null;)t(u.key,f.key)<0?(l.next=u,u=u.next):(l.next=f,f=f.next),l=l.next;return u!==null?l.next=u:f!==null&&(l.next=f),n.next}function Xm(r,e,t,n,l){if(!(t>=n)){for(var u=r[t+n>>1],f=t-1,a=n+1;;){do f++;while(l(r[f],u)<0);do a--;while(l(r[a],u)>0);if(f>=a)break;var _=r[f];r[f]=r[a],r[a]=_,_=e[f],e[f]=e[a],e[a]=_}Xm(r,e,t,a,l),Xm(r,e,a+1,n,l)}}const Rs=11102230246251565e-32,Li=134217729,VT=(3+8*Rs)*Rs;function lm(r,e,t,n,l){let u,f,a,_,x=e[0],k=n[0],S=0,C=0;k>x==k>-x?(u=x,x=e[++S]):(u=k,k=n[++C]);let z=0;if(S<r&&C<t)for(k>x==k>-x?(f=x+u,a=u-(f-x),x=e[++S]):(f=k+u,a=u-(f-k),k=n[++C]),u=f,a!==0&&(l[z++]=a);S<r&&C<t;)k>x==k>-x?(f=u+x,_=f-u,a=u-(f-_)+(x-_),x=e[++S]):(f=u+k,_=f-u,a=u-(f-_)+(k-_),k=n[++C]),u=f,a!==0&&(l[z++]=a);for(;S<r;)f=u+x,_=f-u,a=u-(f-_)+(x-_),x=e[++S],u=f,a!==0&&(l[z++]=a);for(;C<t;)f=u+k,_=f-u,a=u-(f-_)+(k-_),k=n[++C],u=f,a!==0&&(l[z++]=a);return(u!==0||z===0)&&(l[z++]=u),z}function $T(r,e){let t=e[0];for(let n=1;n<r;n++)t+=e[n];return t}function Lh(r){return new Float64Array(r)}const qT=(3+16*Rs)*Rs,GT=(2+12*Rs)*Rs,WT=(9+64*Rs)*Rs*Rs,uc=Lh(4),P0=Lh(8),z0=Lh(12),D0=Lh(16),qi=Lh(4);function ZT(r,e,t,n,l,u,f){let a,_,x,k,S,C,z,R,D,P,B,N,V,U,te,le,H,J;const ye=r-l,ze=t-l,ne=e-u,be=n-u;U=ye*be,C=Li*ye,z=C-(C-ye),R=ye-z,C=Li*be,D=C-(C-be),P=be-D,te=R*P-(U-z*D-R*D-z*P),le=ne*ze,C=Li*ne,z=C-(C-ne),R=ne-z,C=Li*ze,D=C-(C-ze),P=ze-D,H=R*P-(le-z*D-R*D-z*P),B=te-H,S=te-B,uc[0]=te-(B+S)+(S-H),N=U+B,S=N-U,V=U-(N-S)+(B-S),B=V-le,S=V-B,uc[1]=V-(B+S)+(S-le),J=N+B,S=J-N,uc[2]=N-(J-S)+(B-S),uc[3]=J;let He=$T(4,uc),Ce=GT*f;if(He>=Ce||-He>=Ce||(S=r-ye,a=r-(ye+S)+(S-l),S=t-ze,x=t-(ze+S)+(S-l),S=e-ne,_=e-(ne+S)+(S-u),S=n-be,k=n-(be+S)+(S-u),a===0&&_===0&&x===0&&k===0)||(Ce=WT*f+VT*Math.abs(He),He+=ye*k+be*a-(ne*x+ze*_),He>=Ce||-He>=Ce))return He;U=a*be,C=Li*a,z=C-(C-a),R=a-z,C=Li*be,D=C-(C-be),P=be-D,te=R*P-(U-z*D-R*D-z*P),le=_*ze,C=Li*_,z=C-(C-_),R=_-z,C=Li*ze,D=C-(C-ze),P=ze-D,H=R*P-(le-z*D-R*D-z*P),B=te-H,S=te-B,qi[0]=te-(B+S)+(S-H),N=U+B,S=N-U,V=U-(N-S)+(B-S),B=V-le,S=V-B,qi[1]=V-(B+S)+(S-le),J=N+B,S=J-N,qi[2]=N-(J-S)+(B-S),qi[3]=J;const Qe=lm(4,uc,4,qi,P0);U=ye*k,C=Li*ye,z=C-(C-ye),R=ye-z,C=Li*k,D=C-(C-k),P=k-D,te=R*P-(U-z*D-R*D-z*P),le=ne*x,C=Li*ne,z=C-(C-ne),R=ne-z,C=Li*x,D=C-(C-x),P=x-D,H=R*P-(le-z*D-R*D-z*P),B=te-H,S=te-B,qi[0]=te-(B+S)+(S-H),N=U+B,S=N-U,V=U-(N-S)+(B-S),B=V-le,S=V-B,qi[1]=V-(B+S)+(S-le),J=N+B,S=J-N,qi[2]=N-(J-S)+(B-S),qi[3]=J;const _t=lm(Qe,P0,4,qi,z0);U=a*k,C=Li*a,z=C-(C-a),R=a-z,C=Li*k,D=C-(C-k),P=k-D,te=R*P-(U-z*D-R*D-z*P),le=_*x,C=Li*_,z=C-(C-_),R=_-z,C=Li*x,D=C-(C-x),P=x-D,H=R*P-(le-z*D-R*D-z*P),B=te-H,S=te-B,qi[0]=te-(B+S)+(S-H),N=U+B,S=N-U,V=U-(N-S)+(B-S),B=V-le,S=V-B,qi[1]=V-(B+S)+(S-le),J=N+B,S=J-N,qi[2]=N-(J-S)+(B-S),qi[3]=J;const Ut=lm(_t,z0,4,qi,D0);return D0[Ut-1]}function HT(r,e,t,n,l,u){const f=(e-u)*(t-l),a=(r-l)*(n-u),_=f-a,x=Math.abs(f+a);return Math.abs(_)>=qT*x?_:-ZT(r,e,t,n,l,u,x)}const ju=(r,e)=>r.ll.x<=e.x&&e.x<=r.ur.x&&r.ll.y<=e.y&&e.y<=r.ur.y,Km=(r,e)=>{if(e.ur.x<r.ll.x||r.ur.x<e.ll.x||e.ur.y<r.ll.y||r.ur.y<e.ll.y)return null;const t=r.ll.x<e.ll.x?e.ll.x:r.ll.x,n=r.ur.x<e.ur.x?r.ur.x:e.ur.x,l=r.ll.y<e.ll.y?e.ll.y:r.ll.y,u=r.ur.y<e.ur.y?r.ur.y:e.ur.y;return{ll:{x:t,y:l},ur:{x:n,y:u}}};let ca=Number.EPSILON;ca===void 0&&(ca=Math.pow(2,-52));const XT=ca*ca,R0=(r,e)=>{if(-ca<r&&r<ca&&-ca<e&&e<ca)return 0;const t=r-e;return t*t<XT*r*e?0:r<e?-1:1};class KT{constructor(){this.reset()}reset(){this.xRounder=new B0,this.yRounder=new B0}round(e,t){return{x:this.xRounder.round(e),y:this.yRounder.round(t)}}}class B0{constructor(){this.tree=new Ng,this.round(0)}round(e){const t=this.tree.add(e),n=this.tree.prev(t);if(n!==null&&R0(t.key,n.key)===0)return this.tree.remove(e),n.key;const l=this.tree.next(t);return l!==null&&R0(t.key,l.key)===0?(this.tree.remove(e),l.key):e}}const Sh=new KT,rd=(r,e)=>r.x*e.y-r.y*e.x,yw=(r,e)=>r.x*e.x+r.y*e.y,F0=(r,e,t)=>{const n=HT(r.x,r.y,e.x,e.y,t.x,t.y);return n>0?-1:n<0?1:0},wd=r=>Math.sqrt(yw(r,r)),JT=(r,e,t)=>{const n={x:e.x-r.x,y:e.y-r.y},l={x:t.x-r.x,y:t.y-r.y};return rd(l,n)/wd(l)/wd(n)},YT=(r,e,t)=>{const n={x:e.x-r.x,y:e.y-r.y},l={x:t.x-r.x,y:t.y-r.y};return yw(l,n)/wd(l)/wd(n)},O0=(r,e,t)=>e.y===0?null:{x:r.x+e.x/e.y*(t-r.y),y:t},N0=(r,e,t)=>e.x===0?null:{x:t,y:r.y+e.y/e.x*(t-r.x)},QT=(r,e,t,n)=>{if(e.x===0)return N0(t,n,r.x);if(n.x===0)return N0(r,e,t.x);if(e.y===0)return O0(t,n,r.y);if(n.y===0)return O0(r,e,t.y);const l=rd(e,n);if(l==0)return null;const u={x:t.x-r.x,y:t.y-r.y},f=rd(u,e)/l,a=rd(u,n)/l,_=r.x+a*e.x,x=t.x+f*n.x,k=r.y+a*e.y,S=t.y+f*n.y,C=(_+x)/2,z=(k+S)/2;return{x:C,y:z}};class Io{static compare(e,t){const n=Io.comparePoints(e.point,t.point);return n!==0?n:(e.point!==t.point&&e.link(t),e.isLeft!==t.isLeft?e.isLeft?1:-1:ha.compare(e.segment,t.segment))}static comparePoints(e,t){return e.x<t.x?-1:e.x>t.x?1:e.y<t.y?-1:e.y>t.y?1:0}constructor(e,t){e.events===void 0?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=t}link(e){if(e.point===this.point)throw new Error("Tried to link already linked events");const t=e.point.events;for(let n=0,l=t.length;n<l;n++){const u=t[n];this.point.events.push(u),u.point=this.point}this.checkForConsuming()}checkForConsuming(){const e=this.point.events.length;for(let t=0;t<e;t++){const n=this.point.events[t];if(n.segment.consumedBy===void 0)for(let l=t+1;l<e;l++){const u=this.point.events[l];u.consumedBy===void 0&&n.otherSE.point.events===u.otherSE.point.events&&n.segment.consume(u.segment)}}}getAvailableLinkedEvents(){const e=[];for(let t=0,n=this.point.events.length;t<n;t++){const l=this.point.events[t];l!==this&&!l.segment.ringOut&&l.segment.isInResult()&&e.push(l)}return e}getLeftmostComparator(e){const t=new Map,n=l=>{const u=l.otherSE;t.set(l,{sine:JT(this.point,e.point,u.point),cosine:YT(this.point,e.point,u.point)})};return(l,u)=>{t.has(l)||n(l),t.has(u)||n(u);const{sine:f,cosine:a}=t.get(l),{sine:_,cosine:x}=t.get(u);return f>=0&&_>=0?a<x?1:a>x?-1:0:f<0&&_<0?a<x?-1:a>x?1:0:_<f?-1:_>f?1:0}}}let eE=0;class ha{static compare(e,t){const n=e.leftSE.point.x,l=t.leftSE.point.x,u=e.rightSE.point.x,f=t.rightSE.point.x;if(f<n)return 1;if(u<l)return-1;const a=e.leftSE.point.y,_=t.leftSE.point.y,x=e.rightSE.point.y,k=t.rightSE.point.y;if(n<l){if(_<a&&_<x)return 1;if(_>a&&_>x)return-1;const S=e.comparePoint(t.leftSE.point);if(S<0)return 1;if(S>0)return-1;const C=t.comparePoint(e.rightSE.point);return C!==0?C:-1}if(n>l){if(a<_&&a<k)return-1;if(a>_&&a>k)return 1;const S=t.comparePoint(e.leftSE.point);if(S!==0)return S;const C=e.comparePoint(t.rightSE.point);return C<0?1:C>0?-1:1}if(a<_)return-1;if(a>_)return 1;if(u<f){const S=t.comparePoint(e.rightSE.point);if(S!==0)return S}if(u>f){const S=e.comparePoint(t.rightSE.point);if(S<0)return 1;if(S>0)return-1}if(u!==f){const S=x-a,C=u-n,z=k-_,R=f-l;if(S>C&&z<R)return 1;if(S<C&&z>R)return-1}return u>f?1:u<f||x<k?-1:x>k?1:e.id<t.id?-1:e.id>t.id?1:0}constructor(e,t,n,l){this.id=++eE,this.leftSE=e,e.segment=this,e.otherSE=t,this.rightSE=t,t.segment=this,t.otherSE=e,this.rings=n,this.windings=l}static fromRing(e,t,n){let l,u,f;const a=Io.comparePoints(e,t);if(a<0)l=e,u=t,f=1;else if(a>0)l=t,u=e,f=-1;else throw new Error(`Tried to create degenerate segment at [${e.x}, ${e.y}]`);const _=new Io(l,!0),x=new Io(u,!1);return new ha(_,x,[n],[f])}replaceRightSE(e){this.rightSE=e,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}bbox(){const e=this.leftSE.point.y,t=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:e<t?e:t},ur:{x:this.rightSE.point.x,y:e>t?e:t}}}vector(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}isAnEndpoint(e){return e.x===this.leftSE.point.x&&e.y===this.leftSE.point.y||e.x===this.rightSE.point.x&&e.y===this.rightSE.point.y}comparePoint(e){if(this.isAnEndpoint(e))return 0;const t=this.leftSE.point,n=this.rightSE.point,l=this.vector();if(t.x===n.x)return e.x===t.x?0:e.x<t.x?1:-1;const u=(e.y-t.y)/l.y,f=t.x+u*l.x;if(e.x===f)return 0;const a=(e.x-t.x)/l.x,_=t.y+a*l.y;return e.y===_?0:e.y<_?-1:1}getIntersection(e){const t=this.bbox(),n=e.bbox(),l=Km(t,n);if(l===null)return null;const u=this.leftSE.point,f=this.rightSE.point,a=e.leftSE.point,_=e.rightSE.point,x=ju(t,a)&&this.comparePoint(a)===0,k=ju(n,u)&&e.comparePoint(u)===0,S=ju(t,_)&&this.comparePoint(_)===0,C=ju(n,f)&&e.comparePoint(f)===0;if(k&&x)return C&&!S?f:!C&&S?_:null;if(k)return S&&u.x===_.x&&u.y===_.y?null:u;if(x)return C&&f.x===a.x&&f.y===a.y?null:a;if(C&&S)return null;if(C)return f;if(S)return _;const z=QT(u,this.vector(),a,e.vector());return z===null||!ju(l,z)?null:Sh.round(z.x,z.y)}split(e){const t=[],n=e.events!==void 0,l=new Io(e,!0),u=new Io(e,!1),f=this.rightSE;this.replaceRightSE(u),t.push(u),t.push(l);const a=new ha(l,f,this.rings.slice(),this.windings.slice());return Io.comparePoints(a.leftSE.point,a.rightSE.point)>0&&a.swapEvents(),Io.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),n&&(l.checkForConsuming(),u.checkForConsuming()),t}swapEvents(){const e=this.rightSE;this.rightSE=this.leftSE,this.leftSE=e,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(let t=0,n=this.windings.length;t<n;t++)this.windings[t]*=-1}consume(e){let t=this,n=e;for(;t.consumedBy;)t=t.consumedBy;for(;n.consumedBy;)n=n.consumedBy;const l=ha.compare(t,n);if(l!==0){if(l>0){const u=t;t=n,n=u}if(t.prev===n){const u=t;t=n,n=u}for(let u=0,f=n.rings.length;u<f;u++){const a=n.rings[u],_=n.windings[u],x=t.rings.indexOf(a);x===-1?(t.rings.push(a),t.windings.push(_)):t.windings[x]+=_}n.rings=null,n.windings=null,n.consumedBy=t,n.leftSE.consumedBy=t.leftSE,n.rightSE.consumedBy=t.rightSE}}prevInResult(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}beforeState(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{const e=this.prev.consumedBy||this.prev;this._beforeState=e.afterState()}return this._beforeState}afterState(){if(this._afterState!==void 0)return this._afterState;const e=this.beforeState();this._afterState={rings:e.rings.slice(0),windings:e.windings.slice(0),multiPolys:[]};const t=this._afterState.rings,n=this._afterState.windings,l=this._afterState.multiPolys;for(let a=0,_=this.rings.length;a<_;a++){const x=this.rings[a],k=this.windings[a],S=t.indexOf(x);S===-1?(t.push(x),n.push(k)):n[S]+=k}const u=[],f=[];for(let a=0,_=t.length;a<_;a++){if(n[a]===0)continue;const x=t[a],k=x.poly;if(f.indexOf(k)===-1)if(x.isExterior)u.push(k);else{f.indexOf(k)===-1&&f.push(k);const S=u.indexOf(x.poly);S!==-1&&u.splice(S,1)}}for(let a=0,_=u.length;a<_;a++){const x=u[a].multiPoly;l.indexOf(x)===-1&&l.push(x)}return this._afterState}isInResult(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;const e=this.beforeState().multiPolys,t=this.afterState().multiPolys;switch(Wo.type){case"union":{const n=e.length===0,l=t.length===0;this._isInResult=n!==l;break}case"intersection":{let n,l;e.length<t.length?(n=e.length,l=t.length):(n=t.length,l=e.length),this._isInResult=l===Wo.numMultiPolys&&n<l;break}case"xor":{const n=Math.abs(e.length-t.length);this._isInResult=n%2===1;break}case"difference":{const n=l=>l.length===1&&l[0].isSubject;this._isInResult=n(e)!==n(t);break}default:throw new Error(`Unrecognized operation type found ${Wo.type}`)}return this._isInResult}}class j0{constructor(e,t,n){if(!Array.isArray(e)||e.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=t,this.isExterior=n,this.segments=[],typeof e[0][0]!="number"||typeof e[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const l=Sh.round(e[0][0],e[0][1]);this.bbox={ll:{x:l.x,y:l.y},ur:{x:l.x,y:l.y}};let u=l;for(let f=1,a=e.length;f<a;f++){if(typeof e[f][0]!="number"||typeof e[f][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");let _=Sh.round(e[f][0],e[f][1]);_.x===u.x&&_.y===u.y||(this.segments.push(ha.fromRing(u,_,this)),_.x<this.bbox.ll.x&&(this.bbox.ll.x=_.x),_.y<this.bbox.ll.y&&(this.bbox.ll.y=_.y),_.x>this.bbox.ur.x&&(this.bbox.ur.x=_.x),_.y>this.bbox.ur.y&&(this.bbox.ur.y=_.y),u=_)}(l.x!==u.x||l.y!==u.y)&&this.segments.push(ha.fromRing(u,l,this))}getSweepEvents(){const e=[];for(let t=0,n=this.segments.length;t<n;t++){const l=this.segments[t];e.push(l.leftSE),e.push(l.rightSE)}return e}}class tE{constructor(e,t){if(!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new j0(e[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(let n=1,l=e.length;n<l;n++){const u=new j0(e[n],this,!1);u.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=u.bbox.ll.x),u.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=u.bbox.ll.y),u.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=u.bbox.ur.x),u.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=u.bbox.ur.y),this.interiorRings.push(u)}this.multiPoly=t}getSweepEvents(){const e=this.exteriorRing.getSweepEvents();for(let t=0,n=this.interiorRings.length;t<n;t++){const l=this.interiorRings[t].getSweepEvents();for(let u=0,f=l.length;u<f;u++)e.push(l[u])}return e}}class U0{constructor(e,t){if(!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof e[0][0][0]=="number"&&(e=[e])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(let n=0,l=e.length;n<l;n++){const u=new tE(e[n],this);u.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=u.bbox.ll.x),u.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=u.bbox.ll.y),u.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=u.bbox.ur.x),u.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=u.bbox.ur.y),this.polys.push(u)}this.isSubject=t}getSweepEvents(){const e=[];for(let t=0,n=this.polys.length;t<n;t++){const l=this.polys[t].getSweepEvents();for(let u=0,f=l.length;u<f;u++)e.push(l[u])}return e}}class xd{static factory(e){const t=[];for(let n=0,l=e.length;n<l;n++){const u=e[n];if(!u.isInResult()||u.ringOut)continue;let f=null,a=u.leftSE,_=u.rightSE;const x=[a],k=a.point,S=[];for(;f=a,a=_,x.push(a),a.point!==k;)for(;;){const C=a.getAvailableLinkedEvents();if(C.length===0){const D=x[0].point,P=x[x.length-1].point;throw new Error(`Unable to complete output ring starting at [${D.x}, ${D.y}]. Last matching segment found ends at [${P.x}, ${P.y}].`)}if(C.length===1){_=C[0].otherSE;break}let z=null;for(let D=0,P=S.length;D<P;D++)if(S[D].point===a.point){z=D;break}if(z!==null){const D=S.splice(z)[0],P=x.splice(D.index);P.unshift(P[0].otherSE),t.push(new xd(P.reverse()));continue}S.push({index:x.length,point:a.point});const R=a.getLeftmostComparator(f);_=C.sort(R)[0].otherSE;break}t.push(new xd(x))}return t}constructor(e){this.events=e;for(let t=0,n=e.length;t<n;t++)e[t].segment.ringOut=this;this.poly=null}getGeom(){let e=this.events[0].point;const t=[e];for(let x=1,k=this.events.length-1;x<k;x++){const S=this.events[x].point,C=this.events[x+1].point;F0(S,e,C)!==0&&(t.push(S),e=S)}if(t.length===1)return null;const n=t[0],l=t[1];F0(n,e,l)===0&&t.shift(),t.push(t[0]);const u=this.isExteriorRing()?1:-1,f=this.isExteriorRing()?0:t.length-1,a=this.isExteriorRing()?t.length:-1,_=[];for(let x=f;x!=a;x+=u)_.push([t[x].x,t[x].y]);return _}isExteriorRing(){if(this._isExteriorRing===void 0){const e=this.enclosingRing();this._isExteriorRing=e?!e.isExteriorRing():!0}return this._isExteriorRing}enclosingRing(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}_calcEnclosingRing(){let e=this.events[0];for(let l=1,u=this.events.length;l<u;l++){const f=this.events[l];Io.compare(e,f)>0&&(e=f)}let t=e.segment.prevInResult(),n=t?t.prevInResult():null;for(;;){if(!t)return null;if(!n)return t.ringOut;if(n.ringOut!==t.ringOut)return n.ringOut.enclosingRing()!==t.ringOut?t.ringOut:t.ringOut.enclosingRing();t=n.prevInResult(),n=t?t.prevInResult():null}}}class V0{constructor(e){this.exteriorRing=e,e.poly=this,this.interiorRings=[]}addInterior(e){this.interiorRings.push(e),e.poly=this}getGeom(){const e=[this.exteriorRing.getGeom()];if(e[0]===null)return null;for(let t=0,n=this.interiorRings.length;t<n;t++){const l=this.interiorRings[t].getGeom();l!==null&&e.push(l)}return e}}class rE{constructor(e){this.rings=e,this.polys=this._composePolys(e)}getGeom(){const e=[];for(let t=0,n=this.polys.length;t<n;t++){const l=this.polys[t].getGeom();l!==null&&e.push(l)}return e}_composePolys(e){const t=[];for(let n=0,l=e.length;n<l;n++){const u=e[n];if(!u.poly)if(u.isExteriorRing())t.push(new V0(u));else{const f=u.enclosingRing();f.poly||t.push(new V0(f)),f.poly.addInterior(u)}}return t}}class nE{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:ha.compare;this.queue=e,this.tree=new Ng(t),this.segments=[]}process(e){const t=e.segment,n=[];if(e.consumedBy)return e.isLeft?this.queue.remove(e.otherSE):this.tree.remove(t),n;const l=e.isLeft?this.tree.add(t):this.tree.find(t);if(!l)throw new Error(`Unable to find segment #${t.id} [${t.leftSE.point.x}, ${t.leftSE.point.y}] -> [${t.rightSE.point.x}, ${t.rightSE.point.y}] in SweepLine tree.`);let u=l,f=l,a,_;for(;a===void 0;)u=this.tree.prev(u),u===null?a=null:u.key.consumedBy===void 0&&(a=u.key);for(;_===void 0;)f=this.tree.next(f),f===null?_=null:f.key.consumedBy===void 0&&(_=f.key);if(e.isLeft){let x=null;if(a){const S=a.getIntersection(t);if(S!==null&&(t.isAnEndpoint(S)||(x=S),!a.isAnEndpoint(S))){const C=this._splitSafely(a,S);for(let z=0,R=C.length;z<R;z++)n.push(C[z])}}let k=null;if(_){const S=_.getIntersection(t);if(S!==null&&(t.isAnEndpoint(S)||(k=S),!_.isAnEndpoint(S))){const C=this._splitSafely(_,S);for(let z=0,R=C.length;z<R;z++)n.push(C[z])}}if(x!==null||k!==null){let S=null;x===null?S=k:k===null?S=x:S=Io.comparePoints(x,k)<=0?x:k,this.queue.remove(t.rightSE),n.push(t.rightSE);const C=t.split(S);for(let z=0,R=C.length;z<R;z++)n.push(C[z])}n.length>0?(this.tree.remove(t),n.push(e)):(this.segments.push(t),t.prev=a)}else{if(a&&_){const x=a.getIntersection(_);if(x!==null){if(!a.isAnEndpoint(x)){const k=this._splitSafely(a,x);for(let S=0,C=k.length;S<C;S++)n.push(k[S])}if(!_.isAnEndpoint(x)){const k=this._splitSafely(_,x);for(let S=0,C=k.length;S<C;S++)n.push(k[S])}}}this.tree.remove(t)}return n}_splitSafely(e,t){this.tree.remove(e);const n=e.rightSE;this.queue.remove(n);const l=e.split(t);return l.push(n),e.consumedBy===void 0&&this.tree.add(e),l}}const $0=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,iE=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6;class oE{run(e,t,n){Wo.type=e,Sh.reset();const l=[new U0(t,!0)];for(let k=0,S=n.length;k<S;k++)l.push(new U0(n[k],!1));if(Wo.numMultiPolys=l.length,Wo.type==="difference"){const k=l[0];let S=1;for(;S<l.length;)Km(l[S].bbox,k.bbox)!==null?S++:l.splice(S,1)}if(Wo.type==="intersection")for(let k=0,S=l.length;k<S;k++){const C=l[k];for(let z=k+1,R=l.length;z<R;z++)if(Km(C.bbox,l[z].bbox)===null)return[]}const u=new Ng(Io.compare);for(let k=0,S=l.length;k<S;k++){const C=l[k].getSweepEvents();for(let z=0,R=C.length;z<R;z++)if(u.insert(C[z]),u.size>$0)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big).")}const f=new nE(u);let a=u.size,_=u.pop();for(;_;){const k=_.key;if(u.size===a){const C=k.segment;throw new Error(`Unable to pop() ${k.isLeft?"left":"right"} SweepEvent [${k.point.x}, ${k.point.y}] from segment #${C.id} [${C.leftSE.point.x}, ${C.leftSE.point.y}] -> [${C.rightSE.point.x}, ${C.rightSE.point.y}] from queue.`)}if(u.size>$0)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big).");if(f.segments.length>iE)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments).");const S=f.process(k);for(let C=0,z=S.length;C<z;C++){const R=S[C];R.consumedBy===void 0&&u.insert(R)}a=u.size,_=u.pop()}Sh.reset();const x=xd.factory(f.segments);return new rE(x).getGeom()}}const Wo=new oE,sE=function(r){for(var e=arguments.length,t=new Array(e>1?e-1:0),n=1;n<e;n++)t[n-1]=arguments[n];return Wo.run("union",r,t)},aE=function(r){for(var e=arguments.length,t=new Array(e>1?e-1:0),n=1;n<e;n++)t[n-1]=arguments[n];return Wo.run("intersection",r,t)},lE=function(r){for(var e=arguments.length,t=new Array(e>1?e-1:0),n=1;n<e;n++)t[n-1]=arguments[n];return Wo.run("xor",r,t)},cE=function(r){for(var e=arguments.length,t=new Array(e>1?e-1:0),n=1;n<e;n++)t[n-1]=arguments[n];return Wo.run("difference",r,t)};var vw={union:sE,intersection:aE,xor:lE,difference:cE};function bw(r,e,t){if(r!==null)for(var n,l,u,f,a,_,x,k=0,S=0,C,z=r.type,R=z==="FeatureCollection",D=z==="Feature",P=R?r.features.length:1,B=0;B<P;B++){x=R?r.features[B].geometry:D?r.geometry:r,C=x?x.type==="GeometryCollection":!1,a=C?x.geometries.length:1;for(var N=0;N<a;N++){var V=0,U=0;if(f=C?x.geometries[N]:x,f!==null){_=f.coordinates;var te=f.type;switch(k=0,te){case null:break;case"Point":if(e(_,S,B,V,U)===!1)return!1;S++,V++;break;case"LineString":case"MultiPoint":for(n=0;n<_.length;n++){if(e(_[n],S,B,V,U)===!1)return!1;S++,te==="MultiPoint"&&V++}te==="LineString"&&V++;break;case"Polygon":case"MultiLineString":for(n=0;n<_.length;n++){for(l=0;l<_[n].length-k;l++){if(e(_[n][l],S,B,V,U)===!1)return!1;S++}te==="MultiLineString"&&V++,te==="Polygon"&&U++}te==="Polygon"&&V++;break;case"MultiPolygon":for(n=0;n<_.length;n++){for(U=0,l=0;l<_[n].length;l++){for(u=0;u<_[n][l].length-k;u++){if(e(_[n][l][u],S,B,V,U)===!1)return!1;S++}U++}V++}break;case"GeometryCollection":for(n=0;n<f.geometries.length;n++)if(bw(f.geometries[n],e)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function jg(r,e){var t,n,l,u,f,a,_,x,k,S,C=0,z=r.type==="FeatureCollection",R=r.type==="Feature",D=z?r.features.length:1;for(t=0;t<D;t++){for(a=z?r.features[t].geometry:R?r.geometry:r,x=z?r.features[t].properties:R?r.properties:{},k=z?r.features[t].bbox:R?r.bbox:void 0,S=z?r.features[t].id:R?r.id:void 0,_=a?a.type==="GeometryCollection":!1,f=_?a.geometries.length:1,l=0;l<f;l++){if(u=_?a.geometries[l]:a,u===null){if(e(null,C,x,k,S)===!1)return!1;continue}switch(u.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(u,C,x,k,S)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<u.geometries.length;n++)if(e(u.geometries[n],C,x,k,S)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}C++}}function uE(r,e){jg(r,function(t,n,l,u,f){var a=t===null?null:t.type;switch(a){case null:case"Point":case"LineString":case"Polygon":return e(wh(t,l,{bbox:u,id:f}),n,0)===!1?!1:void 0}var _;switch(a){case"MultiPoint":_="Point";break;case"MultiLineString":_="LineString";break;case"MultiPolygon":_="Polygon";break}for(var x=0;x<t.coordinates.length;x++){var k=t.coordinates[x],S={type:_,coordinates:k};if(e(wh(S,l),n,x)===!1)return!1}})}function hE(r,e={}){const t=[];if(jg(r,l=>{t.push(l.coordinates)}),t.length<2)throw new Error("Must have at least 2 geometries");const n=vw.union(t[0],...t.slice(1));return n.length===0?null:n.length===1?Og(n[0],e.properties):_w(n,e.properties)}var ww=hE;function fE(r,e={}){if(r.bbox!=null&&e.recompute!==!0)return r.bbox;const t=[1/0,1/0,-1/0,-1/0];return bw(r,n=>{t[0]>n[0]&&(t[0]=n[0]),t[1]>n[1]&&(t[1]=n[1]),t[2]<n[0]&&(t[2]=n[0]),t[3]<n[1]&&(t[3]=n[1])}),t}var q0=fE;function dE(r){const e=[];if(jg(r,l=>{e.push(l.coordinates)}),e.length<2)throw new Error("Must have at least two features");const t=r.features[0].properties||{},n=vw.difference(e[0],...e.slice(1));return n.length===0?null:n.length===1?Og(n[0],t):_w(n,t)}var pE=dE;function mE(r){if(!r)throw new Error("geojson is required");var e=[];return uE(r,function(t){e.push(t)}),xh(e)}var gE=mE;function G0(r,e){const t=pE(xh([Og([[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]]),r]));if(!t)return;t.properties={isMask:!0};const n=bd(q0(r)),l=(n[2]-n[0])/360/1e3,u=n[0]<-180,f=n[2]>180,a=gE(r);if(a.features.length>1&&(u||f))for(const _ of a.features){const x=bd(q0(_));if(f&&x[0]<-180+l)for(const k of _.geometry.coordinates)for(const S of k)S[0]+=360-l;if(u&&x[2]>180-l)for(const k of _.geometry.coordinates)for(const S of k)S[0]-=360-l}e(xh([a.features.length<2?r:ww(a)??r,t]))}const W0={fill:{paint:{"fill-color":"#000","fill-opacity":.1},filter:["all",["==",["geometry-type"],"Polygon"],["has","isMask"]]},line:{layout:{"line-cap":"square"},paint:{"line-width":["case",["==",["geometry-type"],"Polygon"],2,3],"line-dasharray":[1,1],"line-color":"#3170fe"},filter:["!",["has","isMask"]]}},Gf="mtlr-gc-full-geom",Z0="mtlr-gc-full-geom-fill",H0="mtlr-gc-full-geom-line";function xw(r,e,t=!0,n=!0,l={},u={},f=W0){let a;const _=[];let x,k,S;function C(){if(!r.loaded){r.once("load",C);return}const P=f?f===!0?W0:f:void 0;if(!(P!=null&&P.fill)&&!(P!=null&&P.line))return;const B=r.getSource(Gf);if(B)B.setData(S??xh([]));else if(S)r.addSource(Gf,{type:"geojson",data:S});else return;!r.getLayer(Z0)&&P!=null&&P.fill&&r.addLayer({...P==null?void 0:P.fill,id:Z0,type:"fill",source:Gf}),!r.getLayer(H0)&&P!=null&&P.line&&r.addLayer({...P==null?void 0:P.line,id:H0,type:"line",source:Gf})}function z(P){S=P,C()}r.on("styledata",()=>{setTimeout(()=>{S&&C()})});const R=P=>{a==null||a({type:"mapClick",coordinates:[P.lngLat.lng,P.lngLat.lat]})};function D(P=!1){if(!e)throw new Error;const B=document.createElement("div");return P&&B.classList.add("marker-interactive"),new hT({props:{displayIn:"maplibre"},target:B}),new e.Marker({element:B,offset:[1,-13]})}return{setEventHandler(P){P?(a=P,r.on("click",R)):(a=void 0,r.off("click",R))},flyTo(P,B){r.flyTo({center:P,...B?{zoom:B}:{},...l})},fitBounds(P,B,N){r.fitBounds([[P[0],P[1]],[P[2],P[3]]],{padding:B,...N?{maxZoom:N}:{},...u})},indicateReverse(P){r.getCanvasContainer().style.cursor=P?"crosshair":""},setReverseMarker(P){!e||!t||(k?P?k.setLngLat(P):(k.remove(),k=void 0):P&&(t instanceof Function?k=t(r)??void 0:(k=(typeof t=="object"?new e.Marker(t):D()).setLngLat(P).addTo(r),k.getElement().classList.add("marker-reverse"))))},setFeatures(P,B,N){for(const V of _)V.remove();if(_.length=0,z(void 0),!!e){if(B){let V=!1;if(B.geometry.type==="GeometryCollection"){const U=B.geometry.geometries.filter(te=>te.type==="Polygon"||te.type==="MultiPolygon");e:if(U.length>0){const te=ww(xh(U.map(le=>wh(le))));if(!te)break e;G0({...B,geometry:te.geometry},z),V=!0}else{const te=B.geometry.geometries.filter(le=>le.type==="LineString"||le.type==="MultiLineString");te.length>0&&(z({...B,geometry:{type:"GeometryCollection",geometries:te}}),V=!0)}}if(!V){if(B.geometry.type==="Polygon"||B.geometry.type==="MultiPolygon")G0(B,z);else if(B.geometry.type==="LineString"||B.geometry.type==="MultiLineString"){z(B);return}}if(!N&&B.geometry.type!=="Point")return;if(t instanceof Function){const U=t(r,B);U&&_.push(U)}else t&&_.push(typeof t=="object"?new e.Marker(t):D().setLngLat(B.center).addTo(r))}if(n)for(const V of P??[]){if(V===B)continue;let U;if(n instanceof Function){if(U=n(r,V),!U)continue}else U=(typeof n=="object"?new e.Marker(n):D(!0)).setLngLat(V.center).setPopup(new e.Popup({offset:[1,-27],closeButton:!1,closeOnMove:!0,className:"maptiler-gc-popup"}).setText(V.place_type[0]==="reverse"?V.place_name:V.place_name.replace(/,.*/,""))).addTo(r);const te=U.getElement();te.addEventListener("click",le=>{le.stopPropagation(),a==null||a({type:"markerClick",id:V.id})}),te.addEventListener("mouseenter",()=>{a==null||a({type:"markerMouseEnter",id:V.id}),U.togglePopup()}),te.addEventListener("mouseleave",()=>{a==null||a({type:"markerMouseLeave",id:V.id}),U.togglePopup()}),_.push(U)}}},setSelectedMarker(P){x&&x.getElement().classList.toggle("marker-selected",!1),x=P>-1?_[P]:void 0,x==null||x.getElement().classList.toggle("marker-selected",!0)},getCenterAndZoom(){const P=r.getCenter();return[r.getZoom(),P.lng,P.lat]}}}function _E(r,e,t){var n,l;class u{constructor(P,B){mo(this,"type"),mo(this,"target"),this.type=B,this.target=P}}class f extends u{constructor(P,B){super(P,"select"),mo(this,"feature"),Object.assign(this,B)}}class a extends u{constructor(P,B){super(P,"featureslisted"),mo(this,"features"),this.features=B}}class _ extends u{constructor(P,B){super(P,"featuresmarked"),mo(this,"features"),this.features=B}}class x extends u{constructor(P,B){super(P,"optionsvisibilitychange"),mo(this,"optionsVisible"),this.optionsVisible=B}}class k extends u{constructor(P,B){super(P,"pick"),mo(this,"feature"),this.feature=B}}class S extends u{constructor(P,B){super(P,"querychange"),mo(this,"query"),this.query=B}}class C extends u{constructor(P,B,N){super(P,"response"),mo(this,"url"),mo(this,"featureCollection"),this.url=B,this.featureCollection=N}}class z extends u{constructor(P,B){super(P,"reversetoggle"),mo(this,"reverse"),this.reverse=B}}class R extends r{constructor(P={}){super(),h0(this,n),h0(this,l),f0(this,l,P)}onAddInt(P){const B=document.createElement("div");B.className="mapboxgl-ctrl-geocoder mapboxgl-ctrl maplibregl-ctrl-geocoder maplibregl-ctrl mapboxgl-ctrl-group";const{marker:N,showResultMarkers:V,flyTo:U,fullGeometryStyle:te,...le}=ei(this,l),H=typeof U=="boolean"?{}:U,J={mapController:xw(P,e,N,V,H,H,te),flyTo:U===void 0?!0:!!U,apiKey:"",...t==null?void 0:t(P,B),...le};if(!J.apiKey)throw new Error("no apiKey provided");return f0(this,n,new RT({target:B,props:J})),ei(this,n).$on("select",ye=>{this.fire(new f(this,ye.detail))}),ei(this,n).$on("pick",ye=>{this.fire(new k(this,ye.detail.feature))}),ei(this,n).$on("featureslisted",ye=>{this.fire(new a(this,ye.detail.features))}),ei(this,n).$on("featuresmarked",ye=>{this.fire(new _(this,ye.detail.features))}),ei(this,n).$on("response",ye=>{this.fire(new C(this,ye.detail.url,ye.detail.featureCollection))}),ei(this,n).$on("optionsvisibilitychange",ye=>{this.fire(new x(this,ye.detail.optionsVisible))}),ei(this,n).$on("reversetoggle",ye=>{this.fire(new z(this,ye.detail.reverse))}),ei(this,n).$on("querychange",ye=>{this.fire(new S(this,ye.detail.query))}),B}on(P,B){return super.on(P,B)}once(P,B){return super.once(P,B)}off(P,B){return super.off(P,B)}listens(P){return super.listens(P)}setOptions(P){var B;Object.assign(ei(this,l),P);const{marker:N,showResultMarkers:V,flyTo:U,fullGeometryStyle:te,...le}=ei(this,l);(B=ei(this,n))==null||B.$set(le)}setQuery(P,B=!0){var N;(N=ei(this,n))==null||N.setQuery(P,B)}clearMap(){var P;(P=ei(this,n))==null||P.clearMap()}clearList(){var P;(P=ei(this,n))==null||P.clearList()}setReverseMode(P){var B;(B=ei(this,n))==null||B.$set({reverseActive:P})}focus(){var P;(P=ei(this,n))==null||P.focus()}blur(){var P;(P=ei(this,n))==null||P.blur()}onRemove(){var P;(P=ei(this,n))==null||P.$destroy()}}return n=new WeakMap,l=new WeakMap,{MapLibreBasedGeocodingControl:R,events:{SelectEvent:f,FeaturesListedEvent:a,FeaturesMarkedEvent:_,OptionsVisibilityChangeEvent:x,PickEvent:k,QueryChangeEvent:S,ResponseEvent:C,ReverseToggleEvent:z}}}const{MapLibreBasedGeocodingControl:nR,events:ba}=_E(ga.Evented,fk);ba.SelectEvent;ba.FeaturesListedEvent;ba.FeaturesMarkedEvent;ba.OptionsVisibilityChangeEvent;ba.PickEvent;ba.QueryChangeEvent;ba.ResponseEvent;ba.ReverseToggleEvent;function yE(r){let e,t;return{c(){e=Ds("svg"),t=Ds("path"),Te(t,"d","M13.12.706a.982.982 0 0 0-1.391 0L6.907 5.517 2.087.696a.982.982 0 1 0-1.391 1.39l4.821 4.821L.696 11.73a.982.982 0 1 0 1.39 1.39l4.821-4.821 4.822 4.821a.982.982 0 1 0 1.39-1.39L8.298 6.908l4.821-4.822a.988.988 0 0 0 0-1.38Z"),Te(e,"viewBox","0 0 14 14"),Te(e,"width","13"),Te(e,"height","13"),Te(e,"class","svelte-en2qvf")},m(n,l){me(n,e,l),re(e,t)},p:It,i:It,o:It,d(n){n&&pe(e)}}}class Sw extends Zt{constructor(e){super(),Wt(this,e,null,yE,Vt,{})}}function vE(r){let e,t;return{c(){e=Ds("svg"),t=Ds("path"),Te(t,"d","M15 0C6.705 0 0 6.705 0 15C0 23.295 6.705 30 15 30C23.295 30 30 23.295 30 15C30 6.705 23.295 0 15 0ZM22.5 20.385L20.385 22.5L15 17.115L9.615 22.5L7.5 20.385L12.885 15L7.5 9.615L9.615 7.5L15 12.885L20.385 7.5L22.5 9.615L17.115 15L22.5 20.385Z"),Te(e,"viewBox","0 0 30 30"),Te(e,"fill","none"),Te(e,"xmlns","http://www.w3.org/2000/svg"),Te(e,"class","svelte-d2loi5")},m(n,l){me(n,e,l),re(e,t)},p:It,i:It,o:It,d(n){n&&pe(e)}}}class kw extends Zt{constructor(e){super(),Wt(this,e,null,vE,Vt,{})}}function bE(r){let e,t;return{c(){e=ce("img"),Mn(e.src,t=r[3]+"area.svg")||Te(e,"src",t),Te(e,"alt",r[6]),Te(e,"class","svelte-ltkwvy")},m(n,l){me(n,e,l)},p(n,l){l&8&&!Mn(e.src,t=n[3]+"area.svg")&&Te(e,"src",t),l&64&&Te(e,"alt",n[6])},d(n){n&&pe(e)}}}function wE(r){let e,t;return{c(){e=ce("img"),Mn(e.src,t=r[3]+"reverse.svg")||Te(e,"src",t),Te(e,"alt",r[6]),Te(e,"class","svelte-ltkwvy")},m(n,l){me(n,e,l)},p(n,l){l&8&&!Mn(e.src,t=n[3]+"reverse.svg")&&Te(e,"src",t),l&64&&Te(e,"alt",n[6])},d(n){n&&pe(e)}}}function xE(r){let e,t;return{c(){e=ce("img"),Mn(e.src,t=r[3]+"poi.svg")||Te(e,"src",t),Te(e,"alt",r[6]),Te(e,"class","svelte-ltkwvy")},m(n,l){me(n,e,l)},p(n,l){l&8&&!Mn(e.src,t=n[3]+"poi.svg")&&Te(e,"src",t),l&64&&Te(e,"alt",n[6])},d(n){n&&pe(e)}}}function SE(r){let e,t;return{c(){e=ce("img"),Mn(e.src,t=r[3]+"postal_code.svg")||Te(e,"src",t),Te(e,"alt",r[6]),Te(e,"class","svelte-ltkwvy")},m(n,l){me(n,e,l)},p(n,l){l&8&&!Mn(e.src,t=n[3]+"postal_code.svg")&&Te(e,"src",t),l&64&&Te(e,"alt",n[6])},d(n){n&&pe(e)}}}function kE(r){let e,t;return{c(){e=ce("img"),Mn(e.src,t=r[3]+"street.svg")||Te(e,"src",t),Te(e,"alt",r[6]),Te(e,"class","svelte-ltkwvy")},m(n,l){me(n,e,l)},p(n,l){l&8&&!Mn(e.src,t=n[3]+"street.svg")&&Te(e,"src",t),l&64&&Te(e,"alt",n[6])},d(n){n&&pe(e)}}}function TE(r){let e,t;return{c(){e=ce("img"),Mn(e.src,t=r[3]+"road.svg")||Te(e,"src",t),Te(e,"alt",r[6]),Te(e,"class","svelte-ltkwvy")},m(n,l){me(n,e,l)},p(n,l){l&8&&!Mn(e.src,t=n[3]+"road.svg")&&Te(e,"src",t),l&64&&Te(e,"alt",n[6])},d(n){n&&pe(e)}}}function EE(r){let e,t;return{c(){e=ce("img"),Mn(e.src,t=r[3]+"housenumber.svg")||Te(e,"src",t),Te(e,"alt",r[6]),Te(e,"class","svelte-ltkwvy")},m(n,l){me(n,e,l)},p(n,l){l&8&&!Mn(e.src,t=n[3]+"housenumber.svg")&&Te(e,"src",t),l&64&&Te(e,"alt",n[6])},d(n){n&&pe(e)}}}function CE(r){let e,t,n,l;return{c(){e=ce("img"),Mn(e.src,t=r[5])||Te(e,"src",t),Te(e,"alt",r[4]),Te(e,"class","svelte-ltkwvy")},m(u,f){me(u,e,f),n||(l=Ct(e,"error",r[14]),n=!0)},p(u,f){f&32&&!Mn(e.src,t=u[5])&&Te(e,"src",t),f&16&&Te(e,"alt",u[4])},d(u){u&&pe(e),n=!1,l()}}}function X0(r){let e,t;return{c(){e=ce("span"),t=tt(r[6]),Te(e,"class","secondary svelte-ltkwvy")},m(n,l){me(n,e,l),re(e,t)},p(n,l){l&64&&Ar(t,n[6])},d(n){n&&pe(e)}}}function ME(r){let e,t,n,l,u,f,a,_,x,k=(r[7]?r[0].place_name:r[0].place_name.replace(/,.*/,""))+"",S,C,z=r[2]==="always"||r[2]!=="never"&&!r[0].address&&!r[0].id.startsWith("road.")&&!r[0].id.startsWith("address.")&&!r[0].id.startsWith("postal_code.")&&(!r[0].id.startsWith("poi.")||!r[5])&&!r[7],R,D,P=(r[7]?"":r[0].place_name.replace(/[^,]*,?\s*/,""))+"",B,N,V;function U(J,ye){return ye&1&&(t=null),ye&1&&(n=null),ye&1&&(l=null),ye&1&&(u=null),J[5]?CE:J[0].address?EE:(t==null&&(t=!!J[0].id.startsWith("road.")),t?TE:(n==null&&(n=!!J[0].id.startsWith("address.")),n?kE:(l==null&&(l=!!J[0].id.startsWith("postal_code.")),l?SE:(u==null&&(u=!!J[0].id.startsWith("poi.")),u?xE:J[7]?wE:bE))))}let te=U(r,-1),le=te(r),H=z&&X0(r);return{c(){e=ce("li"),le.c(),f=Ue(),a=ce("span"),_=ce("span"),x=ce("span"),S=tt(k),C=Ue(),H&&H.c(),R=Ue(),D=ce("span"),B=tt(P),Te(x,"class","primary svelte-ltkwvy"),Te(_,"class","svelte-ltkwvy"),Te(D,"class","line2 svelte-ltkwvy"),Te(a,"class","texts svelte-ltkwvy"),Te(e,"tabindex","0"),Te(e,"data-selected",r[1]),Te(e,"class","svelte-ltkwvy"),fi(e,"selected",r[1])},m(J,ye){me(J,e,ye),le.m(e,null),re(e,f),re(e,a),re(a,_),re(_,x),re(x,S),re(_,C),H&&H.m(_,null),re(a,R),re(a,D),re(D,B),N||(V=[Ct(e,"mouseenter",r[12]),Ct(e,"focus",r[13])],N=!0)},p(J,[ye]){te===(te=U(J,ye))&&le?le.p(J,ye):(le.d(1),le=te(J),le&&(le.c(),le.m(e,f))),ye&1&&k!==(k=(J[7]?J[0].place_name:J[0].place_name.replace(/,.*/,""))+"")&&Ar(S,k),ye&37&&(z=J[2]==="always"||J[2]!=="never"&&!J[0].address&&!J[0].id.startsWith("road.")&&!J[0].id.startsWith("address.")&&!J[0].id.startsWith("postal_code.")&&(!J[0].id.startsWith("poi.")||!J[5])&&!J[7]),z?H?H.p(J,ye):(H=X0(J),H.c(),H.m(_,null)):H&&(H.d(1),H=null),ye&1&&P!==(P=(J[7]?"":J[0].place_name.replace(/[^,]*,?\s*/,""))+"")&&Ar(B,P),ye&2&&Te(e,"data-selected",J[1]),ye&2&&fi(e,"selected",J[1])},i:It,o:It,d(J){J&&pe(e),le.d(),H&&H.d(),N=!1,yn(V)}}}function IE(r,e,t){var V;let n,l,{feature:u}=e,{selected:f=!1}=e,{showPlaceType:a}=e,{missingIconsCache:_}=e,{iconsBaseUrl:x}=e;const k=(V=u.properties)==null?void 0:V.categories;let S,C,z=0,R=u.place_type[0]==="reverse";function D(){C&&_.add(C),t(10,z++,z)}function P(U){fr.call(this,r,U)}function B(U){fr.call(this,r,U)}const N=()=>D();return r.$$set=U=>{"feature"in U&&t(0,u=U.feature),"selected"in U&&t(1,f=U.selected),"showPlaceType"in U&&t(2,a=U.showPlaceType),"missingIconsCache"in U&&t(9,_=U.missingIconsCache),"iconsBaseUrl"in U&&t(3,x=U.iconsBaseUrl)},r.$$.update=()=>{var U,te,le,H;if(r.$$.dirty&3640)do t(11,n--,n),t(4,S=k==null?void 0:k[n]),t(5,C=S?x+S.replace(/ /g,"_")+".svg":void 0);while(n>-1&&(!C||_.has(C)));r.$$.dirty&1&&t(6,l=((te=(U=u.properties)==null?void 0:U.categories)==null?void 0:te.join(", "))??((H=(le=u.properties)==null?void 0:le.place_type_name)==null?void 0:H[0])??u.place_type[0])},t(11,n=(k==null?void 0:k.length)??0),[u,f,a,x,S,C,l,R,D,_,z,n,P,B,N]}class AE extends Zt{constructor(e){super(),Wt(this,e,IE,ME,Vt,{feature:0,selected:1,showPlaceType:2,missingIconsCache:9,iconsBaseUrl:3})}}function LE(r){let e;return{c(){e=ce("div"),e.innerHTML='<svg viewBox="0 0 18 18" width="24" height="24" class="svelte-7cmwmc"><path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"></path><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"></path></svg>',Te(e,"class","svelte-7cmwmc")},m(t,n){me(t,e,n)},p:It,i:It,o:It,d(t){t&&pe(e)}}}class PE extends Zt{constructor(e){super(),Wt(this,e,null,LE,Vt,{})}}function zE(r){let e,t;return{c(){e=Ds("svg"),t=Ds("path"),Te(t,"d","M30.003-26.765C13.46-26.765 0-14.158 0 1.337c0 23.286 24.535 42.952 28.39 46.04.24.192.402.316.471.376.323.282.732.424 1.142.424.41 0 .82-.142 1.142-.424.068-.06.231-.183.471-.376 3.856-3.09 28.39-22.754 28.39-46.04 0-15.495-13.46-28.102-30.003-28.102Zm1.757 12.469c4.38 0 7.858 1.052 10.431 3.158 2.595 2.105 3.89 4.913 3.89 8.422 0 2.34-.53 4.362-1.593 6.063-1.063 1.702-3.086 3.616-6.063 5.742-2.042 1.51-3.337 2.659-3.89 3.446-.532.787-.8 1.82-.8 3.096v1.914h-8.449V15.18c0-2.041.434-3.815 1.306-5.325.872-1.51 2.467-3.118 4.785-4.82 2.233-1.594 3.7-2.89 4.402-3.889a5.582 5.582 0 0 0 1.087-3.35c0-1.382-.51-2.435-1.531-3.158-1.02-.723-2.45-1.087-4.28-1.087-3.19 0-6.826 1.047-10.91 3.131l-3.472-6.986c4.742-2.659 9.77-3.992 15.087-3.992Zm-1.88 37.324c1.765 0 3.124.472 4.08 1.408.98.936 1.47 2.276 1.47 4.02 0 1.68-.49 3.007-1.47 3.985-.977.957-2.336 1.435-4.08 1.435-1.787 0-3.171-.465-4.15-1.4-.978-.958-1.47-2.298-1.47-4.02 0-1.787.48-3.14 1.436-4.054.957-.915 2.355-1.374 4.184-1.374Z"),Te(e,"viewBox","0 0 60.006 21.412"),Te(e,"width","14"),Te(e,"height","20"),Te(e,"class","svelte-en2qvf")},m(n,l){me(n,e,l),re(e,t)},p:It,i:It,o:It,d(n){n&&pe(e)}}}class DE extends Zt{constructor(e){super(),Wt(this,e,null,zE,Vt,{})}}function RE(r){let e,t,n;return{c(){e=Ds("svg"),t=Ds("circle"),n=Ds("path"),Te(t,"cx","4.789"),Te(t,"cy","4.787"),Te(t,"r","3.85"),Te(t,"class","svelte-1aq105l"),Te(n,"d","M12.063 12.063 7.635 7.635"),Te(n,"class","svelte-1aq105l"),Te(e,"xmlns","http://www.w3.org/2000/svg"),Te(e,"width","13"),Te(e,"height","13"),Te(e,"viewBox","0 0 13 13"),Te(e,"class","svelte-1aq105l")},m(l,u){me(l,e,u),re(e,t),re(e,n)},p:It,i:It,o:It,d(l){l&&pe(e)}}}class BE extends Zt{constructor(e){super(),Wt(this,e,null,RE,Vt,{})}}function FE(r,e,t){const n=e[1],l=e[0],u=n-l;return r===n&&t?r:((r-l)%u+u)%u+l}function K0(r){const e=[...r];return e[2]<e[0]&&(Math.abs((e[0]+e[2]+360)/2)>Math.abs((e[0]-360+e[2])/2)?e[0]-=360:e[2]+=360),e}let Uu;async function OE(r,e,t){const n=r==null?void 0:r.getCenterAndZoom();for(const l of e??[])if(!(n&&(l.minZoom!=null&&l.minZoom>n[0]||l.maxZoom!=null&&l.maxZoom<n[0]))){if(l.type==="fixed")return l.coordinates.join(",");e:if(l.type==="client-geolocation"){if(Uu&&l.cachedLocationExpiry&&Uu.time+l.cachedLocationExpiry>Date.now()){if(!Uu.coords)break e;return Uu.coords}let u;try{return u=await new Promise((f,a)=>{t.signal.addEventListener("abort",()=>{a(Error("aborted"))}),navigator.geolocation.getCurrentPosition(_=>{f([_.coords.longitude,_.coords.latitude].map(x=>x.toFixed(6)).join(","))},_=>{a(_)},l)}),u}catch{}finally{l.cachedLocationExpiry&&(Uu={time:Date.now(),coords:u})}if(t.signal.aborted)return}if(l.type==="server-geolocation")return"ip";if(n&&l.type==="map-center")return n[1].toFixed(6)+","+n[2].toFixed(6)}}const NE=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*(EAST|WEST|[EW])?$/i,J0=/^([+-]?[0-8]?[0-9])\s+([0-5]?[0-9]\.\d{3,})[\s,]{1,}([+-]?[0-1]?[0-9]?[0-9])\s+([0-5]?[0-9]\.\d{3,})$/,Y0=/^(NORTH|SOUTH|[NS])?[\s]*([+-]?[0-8]?[0-9](?:[\.,]\d{3,}))[\s]*([]?)[\s]*(NORTH|SOUTH|[NS])?[\s]*[,/;]?[\s]*(EAST|WEST|[EW])?[\s]*([+-]?[0-1]?[0-9]?[0-9](?:[\.,]\d{3,}))[\s]*([]?)[\s]*(EAST|WEST|[EW])?$/i,Q0=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(EAST|WEST|[EW])?$/i,e1=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)\s*(EAST|WEST|[EW])?$/i,t1=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''||||["\.])?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''||||["\.])?\s*(EAST|WEST|[EW])?$/i;function jE(r){if(!["DMS","DM","DD"].includes(r))throw new Error("invalid format specified");if(this.decimalCoordinates&&this.decimalCoordinates.trim()){const e=this.decimalCoordinates.split(",").map(z=>Number(z.trim())),t=Number(e[0]),n=Number(e[1]),l=Math.abs(t),u=Math.abs(n),f=t>0?"N":"S",a=n>0?"E":"W";let _;r=="DD"&&(_=`${l} ${f}, ${u} ${a}`);const x=Math.floor(l),k=Math.floor(u),S=(l-x)*60,C=(u-k)*60;if(r=="DM"){let z=r1(S,3).toFixed(3).padStart(6,"0"),R=r1(C,3).toFixed(3).padStart(6,"0");z.endsWith(".000")&&R.endsWith(".000")&&(z=z.replace(/\.000$/,""),R=R.replace(/\.000$/,"")),_=`${x} ${z}' ${f}, ${k} ${R}' ${a}`}if(r=="DMS"){const z=Math.floor(S),R=Math.floor(C);let D=((S-z)*60).toFixed(1).padStart(4,"0"),P=((C-R)*60).toFixed(1).padStart(4,"0");const B=z.toString().padStart(2,"0"),N=R.toString().padStart(2,"0");D.endsWith(".0")&&P.endsWith(".0")&&(D=D.replace(/\.0$/,""),P=P.replace(/\.0$/,"")),_=`${x} ${B}' ${D}" ${f}, ${k} ${N}' ${P}" ${a}`}return _}else throw new Error("no decimal coordinates to convert")}function r1(r,e){const t=Math.pow(10,e);return Math.round((r+Number.EPSILON)*t)/t}function Ug(r,e){e||(e=5),r=r.replace(/\s+/g," ").trim();let t=null,n=null,l="",u="",f=null,a=[],_=!1;if(NE.test(r))throw new Error("invalid coordinate value");if(J0.test(r))if(a=J0.exec(r),_=Vu(a),_)t=Math.abs(a[1])+a[2]/60,Number(a[1])<0&&(t*=-1),n=Math.abs(a[3])+a[4]/60,Number(a[3])<0&&(n*=-1),f="DM";else throw new Error("invalid coordinate format");else if(Y0.test(r))if(a=Y0.exec(r),_=Vu(a),_){if(t=a[2],n=a[6],t.includes(",")&&(t=t.replace(",",".")),n.includes(",")&&(n=n.replace(",",".")),f="DD",Number(Math.round(t))==Number(t))throw new Error("integer only coordinate provided");if(Number(Math.round(n))==Number(n))throw new Error("integer only coordinate provided");a[1]?(l=a[1],u=a[5]):a[4]&&(l=a[4],u=a[8])}else throw new Error("invalid decimal coordinate format");else if(Q0.test(r))if(a=Q0.exec(r),_=Vu(a),_)t=Math.abs(parseInt(a[2])),a[4]&&(t+=a[4]/60,f="DM"),a[6]&&(t+=a[6].replace(",",".")/3600,f="DMS"),parseInt(a[2])<0&&(t=-1*t),n=Math.abs(parseInt(a[9])),a[11]&&(n+=a[11]/60),a[13]&&(n+=a[13].replace(",",".")/3600),parseInt(a[9])<0&&(n=-1*n),a[1]?(l=a[1],u=a[8]):a[7]&&(l=a[7],u=a[14]);else throw new Error("invalid DMS coordinates format");else if(e1.test(r))if(a=e1.exec(r),_=Vu(a),_)t=Math.abs(parseInt(a[2])),a[4]&&(t+=a[4]/60,f="DM"),a[6]&&(t+=a[6]/3600,f="DMS"),parseInt(a[2])<0&&(t=-1*t),n=Math.abs(parseInt(a[10])),a[12]&&(n+=a[12]/60),a[14]&&(n+=a[14]/3600),parseInt(a[10])<0&&(n=-1*n),a[1]?(l=a[1],u=a[9]):a[8]&&(l=a[8],u=a[16]);else throw new Error("invalid DMS coordinates format");else if(t1.test(r)){if(a=t1.exec(r),_=Vu(a),a.filter(x=>x).length<=5)throw new Error("invalid coordinates format");if(_)t=Math.abs(parseInt(a[2])),a[4]&&(t+=a[4].replace(",",".")/60,f="DM"),a[6]&&(t+=a[6].replace(",",".")/3600,f="DMS"),parseInt(a[2])<0&&(t=-1*t),n=Math.abs(parseInt(a[10])),a[12]&&(n+=a[12].replace(",",".")/60),a[14]&&(n+=a[14].replace(",",".")/3600),parseInt(a[10])<0&&(n=-1*n),a[1]?(l=a[1],u=a[9]):a[8]&&(l=a[8],u=a[16]);else throw new Error("invalid coordinates format")}if(_){if(Math.abs(n)>=180)throw new Error("invalid longitude value");if(Math.abs(t)>=90)throw new Error("invalid latitude value");if(l&&!u||!l&&u)throw new Error("invalid coordinates value");if(l&&l==u)throw new Error("invalid coordinates format");t.toString().includes(",")&&(t=t.replace(",",".")),n.toString().includes(",")&&(n=n.replace(",","."));let x=/S|SOUTH/i;x.test(l)&&t>0&&(t=-1*t),x=/W|WEST/i,x.test(u)&&n>0&&(n=-1*n);const k=a[0].trim();let S,C;const z=/[,/;\u0020]/g,R=k.match(z);if(R==null){const B=Math.floor(r.length/2);S=k.substring(0,B).trim(),C=k.substring(B).trim()}else{let B;R.length%2==1?B=Math.floor(R.length/2):B=R.length/2-1;let N=0;if(B==0)N=k.indexOf(R[0]),S=k.substring(0,N).trim(),C=k.substring(N+1).trim();else{let V=0,U=0;for(;V<=B;)N=k.indexOf(R[V],U),U=N+1,V++;S=k.substring(0,N).trim(),C=k.substring(N+1).trim()}}const D=S.split(".");if(D.length==2&&D[1]==0&&D[1].length!=2)throw new Error("invalid coordinates format");const P=C.split(".");if(P.length==2&&P[1]==0&&P[1].length!=2)throw new Error("invalid coordinates format");if(/^\d+$/.test(S)||/^\d+$/.test(C))throw new Error("degree only coordinate/s provided");return t=Number(Number(t).toFixed(e)),n=Number(Number(n).toFixed(e)),Object.freeze({verbatimCoordinates:k,verbatimLatitude:S,verbatimLongitude:C,decimalLatitude:t,decimalLongitude:n,decimalCoordinates:`${t},${n}`,originalFormat:f,closeEnough:UE,toCoordinateFormat:jE})}else throw new Error("coordinates pattern match failed")}function Vu(r){if(!isNaN(r[0]))return!1;const e=[...r];if(e.shift(),e.length%2>0)return!1;const t=/^[-+]?\d+([\.,]\d+)?$/,n=/[eastsouthnorthwest]+/i,l=e.length/2;for(let u=0;u<l;u++){const f=e[u],a=e[u+l],_=t.test(f)&&t.test(a),x=n.test(f)&&n.test(a),k=f==a;if(!(f==null&&a==null)){if(f==null||a==null)return!1;if(_||x||k)continue;return!1}}return!0}function n1(r,e){const t=Math.abs(r-e);return Number(t.toFixed(6))<=1e-5}function UE(r){if(!r)throw new Error("coords must be provided");if(r.includes(",")){const e=r.split(",");if(Number(e[0])==NaN||Number(e[1])==NaN)throw new Error("coords are not valid decimals");return n1(this.decimalLatitude,Number(e[0]))&&n1(this.decimalLongitude,e[1])}else throw new Error("coords being tested must be separated by a comma")}const VE=Object.freeze({DMS:"DMS",DM:"DM",DD:"DD"});Ug.to=VE;const $E=[{verbatimCoordinates:"40.123, -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123 N 74.123 W",verbatimLatitude:"40.123 N",verbatimLongitude:"74.123 W"},{verbatimCoordinates:"40.123 N 74.123 W",verbatimLatitude:"40.123 N",verbatimLongitude:"74.123 W"},{verbatimCoordinates:'40 7 22.8" N 74 7 22.8" W',verbatimLatitude:'40 7 22.8" N',verbatimLongitude:'74 7 22.8" W'},{verbatimCoordinates:"40 7.38 , -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"N40722.8, W74722.8",verbatimLatitude:"N40722.8",verbatimLongitude:"W74722.8"},{verbatimCoordinates:'40722.8"N, 74722.8"W',verbatimLatitude:'40722.8"N',verbatimLongitude:'74722.8"W'},{verbatimCoordinates:`407'22.8"N, 747'22.8"W`,verbatimLatitude:`407'22.8"N`,verbatimLongitude:`747'22.8"W`},{verbatimCoordinates:"40 7 22.8, -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"},{verbatimCoordinates:"40.123 -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123,-74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123N74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"4007.38N7407.38W",verbatimLatitude:"4007.38N",verbatimLongitude:"7407.38W"},{verbatimCoordinates:'40722.8"N, 74722.8"W',verbatimLatitude:'40722.8"N',verbatimLongitude:'74722.8"W'},{verbatimCoordinates:"400722.8N740722.8W",verbatimLatitude:"400722.8N",verbatimLongitude:"740722.8W"},{verbatimCoordinates:"N 40 7.38 W 74 7.38",verbatimLatitude:"N 40 7.38",verbatimLongitude:"W 74 7.38"},{verbatimCoordinates:"40:7:22.8N 74:7:22.8W",verbatimLatitude:"40:7:22.8N",verbatimLongitude:"74:7:22.8W"},{verbatimCoordinates:"40:7:23N,74:7:23W",verbatimLatitude:"40:7:23N",verbatimLongitude:"74:7:23W",decimalLatitude:40.1230555555,decimalLongitude:-74.1230555555},{verbatimCoordinates:'40723"N 74723"W',verbatimLatitude:'40723"N',verbatimLongitude:'74723"W',decimalLatitude:40.1230555555,decimalLongitude:-74.12305555555555},{verbatimCoordinates:'40723"S 74723"E',verbatimLatitude:'40723"S',verbatimLongitude:'74723"E',decimalLatitude:-40.1230555555,decimalLongitude:74.12305555555555},{verbatimCoordinates:'40723" -74723"',verbatimLatitude:'40723"',verbatimLongitude:'-74723"',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:'40d 7 23" N 74d 7 23" W',verbatimLatitude:'40d 7 23" N',verbatimLongitude:'74d 7 23" W',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:"40.123N 74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"40 7.38, -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"40 7.38, -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"40 7 22.8; -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"}],qE={decimalLatitude:40.123,decimalLongitude:-74.123},GE=[{verbatimCoordinates:`504'17.698"south, 1424'2.826"east`,verbatimLatitude:`504'17.698"south`,verbatimLongitude:`1424'2.826"east`,decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"50d4m17.698S 14d24m2.826E",verbatimLatitude:"50d4m17.698S",verbatimLongitude:"14d24m2.826E",decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"40:26:46N,79:56:55W",verbatimLatitude:"40:26:46N",verbatimLongitude:"79:56:55W",decimalLatitude:40.44611111111111,decimalLongitude:-79.9486111111111},{verbatimCoordinates:"40:26:46.302N 79:56:55.903W",verbatimLatitude:"40:26:46.302N",verbatimLongitude:"79:56:55.903W",decimalLatitude:40.446195,decimalLongitude:-79.94886194444445},{verbatimCoordinates:"402647N 795836W",verbatimLatitude:"402647N",verbatimLongitude:"795836W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40d 26 47 N 79d 58 36 W",verbatimLatitude:"40d 26 47 N",verbatimLongitude:"79d 58 36 W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40.446195N 79.948862W",verbatimLatitude:"40.446195N",verbatimLongitude:"79.948862W",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40,446195 79,948862",verbatimLatitude:"40,446195",verbatimLongitude:"79,948862",decimalLatitude:40.446195,decimalLongitude:79.948862},{verbatimCoordinates:"40 26.7717, -79 56.93172",verbatimLatitude:"40 26.7717",verbatimLongitude:"-79 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.446195, -79.948862",verbatimLatitude:"40.446195",verbatimLongitude:"-79.948862",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.123256; -74.123256",verbatimLatitude:"40.123256",verbatimLongitude:"-74.123256",decimalLatitude:40.123256,decimalLongitude:-74.123256},{verbatimCoordinates:"1824S 2245E",verbatimLatitude:"1824S",verbatimLongitude:"2245E",decimalLatitude:-18.4,decimalLongitude:22.75}],WE=[{verbatimCoordinates:"10.432342S 10.6345345E",verbatimLatitude:"10.432342S",verbatimLongitude:"10.6345345E",decimalLatitude:-10.432342,decimalLongitude:10.6345345},{verbatimCoordinates:"10.00S 10.00E",verbatimLatitude:"10.00S",verbatimLongitude:"10.00E",decimalLatitude:-10,decimalLongitude:10},{verbatimCoordinates:"00.00S 01.00E",verbatimLatitude:"00.00S",verbatimLongitude:"01.00E",decimalLatitude:0,decimalLongitude:1},{verbatimCoordinates:"18.24S 22.45E",verbatimLatitude:"18.24S",verbatimLongitude:"22.45E",decimalLatitude:-18.4,decimalLongitude:22.75},{verbatimCoordinates:"27deg 15min 45.2sec S 18deg 32min 53.7sec E",verbatimLatitude:"27deg 15min 45.2sec S",verbatimLongitude:"18deg 32min 53.7sec E",decimalLatitude:-27.262555555555554,decimalLongitude:18.54825},{verbatimCoordinates:"-23.3245 S / 28.2344 E",verbatimLatitude:"-23.3245 S",verbatimLongitude:"28.2344 E",decimalLatitude:-23.3245,decimalLongitude:28.2344},{verbatimCoordinates:"40 26.7717 -79 56.93172",verbatimLatitude:"40 26.7717",verbatimLongitude:"-79 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"27.15.45S 18.32.53E",verbatimLatitude:"27.15.45S",verbatimLongitude:"18.32.53E",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"-27.15.45 18.32.53",verbatimLatitude:"-27.15.45",verbatimLongitude:"18.32.53",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"27.15.45.2S 18.32.53.4E",verbatimLatitude:"27.15.45.2S",verbatimLongitude:"18.32.53.4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"27.15.45,2S 18.32.53,4E",verbatimLatitude:"27.15.45,2S",verbatimLongitude:"18.32.53,4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"S23.43563   E22.45634 ",verbatimLatitude:"S23.43563 ",verbatimLongitude:"E22.45634 ",decimalLatitude:-23.43563,decimalLongitude:22.45634},{verbatimCoordinates:"27,71372 S 23,07771 E",verbatimLatitude:"27,71372 S",verbatimLongitude:"23,07771 E",decimalLatitude:-27.71372,decimalLongitude:23.07771},{verbatimCoordinates:"27.45.34 S 23.23.23 E",verbatimLatitude:"27.45.34 S",verbatimLongitude:"23.23.23 E",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"S 27.45.34 E 23.23.23",verbatimLatitude:"S 27.45.34",verbatimLongitude:"E 23.23.23",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"53 16.3863,4 52.8171",verbatimLatitude:"53 16.3863",verbatimLongitude:"4 52.8171",decimalLatitude:53.273105,decimalLongitude:4.88029},{verbatimCoordinates:"50 8.2914,-5 2.4447",verbatimLatitude:"50 8.2914",verbatimLongitude:"-5 2.4447",decimalLatitude:50.13819,decimalLongitude:-5.040745},{verbatimCoordinates:"N 48 30,6410', E 18 57,4583'",verbatimLatitude:"N 48 30,6410'",verbatimLongitude:"E 18 57,4583'",decimalLatitude:48.51068,decimalLongitude:18.95764},{verbatimCoordinates:"1.23456, 18.33453",verbatimLatitude:"1.23456",verbatimLongitude:"18.33453",decimalLatitude:1.23456,decimalLongitude:18.33453}];function ZE(){const r=[];return $E.forEach(e=>{e.decimalLatitude?r.push(e):r.push({...e,...qE})}),[...r,...GE,...WE]}const HE=ZE();Ug.formats=HE.map(r=>r.verbatimCoordinates);const XE=Ug;function i1(r,e,t){const n=r.slice();return n[84]=e[t],n[86]=t,n}function o1(r){let e,t;return e=new PE({}),{c(){Oe(e.$$.fragment)},m(n,l){Be(e,n,l),t=!0},i(n){t||(oe(e.$$.fragment,n),t=!0)},o(n){ue(e.$$.fragment,n),t=!1},d(n){Fe(e,n)}}}function s1(r){let e,t,n,l,u;return t=new DE({}),{c(){e=ce("button"),Oe(t.$$.fragment),Te(e,"type","button"),Te(e,"title",r[9]),Te(e,"class","svelte-bz0zu3"),fi(e,"active",r[0])},m(f,a){me(f,e,a),Be(t,e,null),n=!0,l||(u=Ct(e,"click",r[69]),l=!0)},p(f,a){(!n||a[0]&512)&&Te(e,"title",f[9]),(!n||a[0]&1)&&fi(e,"active",f[0])},i(f){n||(oe(t.$$.fragment,f),n=!0)},o(f){ue(t.$$.fragment,f),n=!1},d(f){f&&pe(e),Fe(t),l=!1,u()}}}function KE(r){let e,t=[],n=new Map,l,u,f,a=Jn(r[14]);const _=x=>x[84].id+(x[84].address?","+x[84].address:"");for(let x=0;x<a.length;x+=1){let k=i1(r,a,x),S=_(k);n.set(S,t[x]=a1(S,k))}return{c(){e=ce("ul");for(let x=0;x<t.length;x+=1)t[x].c();Te(e,"class","options svelte-bz0zu3")},m(x,k){me(x,e,k);for(let S=0;S<t.length;S+=1)t[S]&&t[S].m(e,null);l=!0,u||(f=[Ct(e,"mouseleave",r[73]),Ct(e,"blur",r[74])],u=!0)},p(x,k){k[0]&17880064&&(a=Jn(x[14]),vr(),t=ZS(t,k,_,1,x,a,n,e,WS,a1,null,i1),br())},i(x){if(!l){for(let k=0;k<a.length;k+=1)oe(t[k]);l=!0}},o(x){for(let k=0;k<t.length;k+=1)ue(t[k]);l=!1},d(x){x&&pe(e);for(let k=0;k<t.length;k+=1)t[k].d();u=!1,yn(f)}}}function JE(r){let e,t,n,l,u,f;return t=new kw({}),{c(){e=ce("div"),Oe(t.$$.fragment),n=Ue(),l=ce("div"),u=tt(r[7]),Te(l,"class","svelte-bz0zu3"),Te(e,"class","no-results svelte-bz0zu3")},m(a,_){me(a,e,_),Be(t,e,null),re(e,n),re(e,l),re(l,u),f=!0},p(a,_){(!f||_[0]&128)&&Ar(u,a[7])},i(a){f||(oe(t.$$.fragment,a),f=!0)},o(a){ue(t.$$.fragment,a),f=!1},d(a){a&&pe(e),Fe(t)}}}function YE(r){let e="",t;return{c(){t=tt(e)},m(n,l){me(n,t,l)},p:It,i:It,o:It,d(n){n&&pe(t)}}}function QE(r){let e,t,n,l,u,f,a,_,x,k,S;return t=new kw({}),_=new Sw({}),{c(){e=ce("div"),Oe(t.$$.fragment),n=Ue(),l=ce("div"),u=tt(r[6]),f=Ue(),a=ce("button"),Oe(_.$$.fragment),Te(l,"class","svelte-bz0zu3"),Te(a,"class","svelte-bz0zu3"),Te(e,"class","error svelte-bz0zu3")},m(C,z){me(C,e,z),Be(t,e,null),re(e,n),re(e,l),re(l,u),re(e,f),re(e,a),Be(_,a,null),x=!0,k||(S=Ct(a,"click",r[70]),k=!0)},p(C,z){(!x||z[0]&64)&&Ar(u,C[6])},i(C){x||(oe(t.$$.fragment,C),oe(_.$$.fragment,C),x=!0)},o(C){ue(t.$$.fragment,C),ue(_.$$.fragment,C),x=!1},d(C){C&&pe(e),Fe(t),Fe(_),k=!1,S()}}}function a1(r,e){let t,n,l;function u(){return e[71](e[86])}function f(){return e[72](e[84])}return n=new AE({props:{feature:e[84],showPlaceType:e[10],selected:e[15]===e[86],missingIconsCache:e[20],iconsBaseUrl:e[12]}}),n.$on("mouseenter",u),n.$on("focus",f),{key:r,first:null,c(){t=Hn(),Oe(n.$$.fragment),this.first=t},m(a,_){me(a,t,_),Be(n,a,_),l=!0},p(a,_){e=a;const x={};_[0]&16384&&(x.feature=e[84]),_[0]&1024&&(x.showPlaceType=e[10]),_[0]&49152&&(x.selected=e[15]===e[86]),_[0]&4096&&(x.iconsBaseUrl=e[12]),n.$set(x)},i(a){l||(oe(n.$$.fragment,a),l=!0)},o(a){ue(n.$$.fragment,a),l=!1},d(a){a&&pe(t),Fe(n,a)}}}function e5(r){let e,t,n,l,u,f,a,_,x,k,S,C,z,R,D,P,B,N,V,U,te,le=!1;u=new BE({}),S=new Sw({});let H=r[19]&&o1(),J=r[5]==="button"&&s1(r);const ye=r[61].default,ze=$r(ye,r,r[60],null),ne=[QE,YE,JE,KE],be=[];function He(Ce,Qe){var _t,Ut;return Ce[18]?0:Ce[16]?((_t=Ce[14])==null?void 0:_t.length)===0?2:Ce[16]&&((Ut=Ce[14])!=null&&Ut.length)?3:-1:1}return~(P=He(r))&&(B=be[P]=ne[P](r)),{c(){e=Ue(),t=ce("form"),n=ce("div"),l=ce("button"),Oe(u.$$.fragment),f=Ue(),a=ce("input"),_=Ue(),x=ce("div"),k=ce("button"),Oe(S.$$.fragment),C=Ue(),H&&H.c(),z=Ue(),J&&J.c(),R=Ue(),ze&&ze.c(),D=Ue(),B&&B.c(),Te(l,"class","search-button svelte-bz0zu3"),Te(l,"type","button"),Te(a,"placeholder",r[8]),Te(a,"aria-label",r[8]),Te(a,"class","svelte-bz0zu3"),Te(k,"type","button"),Te(k,"title",r[3]),Te(k,"class","svelte-bz0zu3"),Te(x,"class","clear-button-container svelte-bz0zu3"),fi(x,"displayable",r[1]!==""),Te(n,"class","input-group svelte-bz0zu3"),Te(t,"tabindex","0"),Te(t,"class",N=fd(r[2])+" svelte-bz0zu3"),fi(t,"can-collapse",r[4]&&r[1]==="")},m(Ce,Qe){me(Ce,e,Qe),me(Ce,t,Qe),re(t,n),re(n,l),Be(u,l,null),re(n,f),re(n,a),r[63](a),ti(a,r[1]),re(n,_),re(n,x),re(x,k),Be(S,k,null),re(x,C),H&&H.m(x,null),re(n,z),J&&J.m(n,null),re(n,R),ze&&ze.m(n,null),re(t,D),~P&&be[P].m(t,null),V=!0,U||(te=[Ct(l,"click",r[62]),Ct(a,"input",r[64]),Ct(a,"focus",r[65]),Ct(a,"blur",r[66]),Ct(a,"keydown",r[22]),Ct(a,"input",r[67]),Ct(k,"click",r[68]),Ct(t,"submit",Sg(r[21]))],U=!0)},p(Ce,Qe){(!V||Qe[0]&256)&&Te(a,"placeholder",Ce[8]),(!V||Qe[0]&256)&&Te(a,"aria-label",Ce[8]),Qe[0]&2&&a.value!==Ce[1]&&ti(a,Ce[1]),(!V||Qe[0]&8)&&Te(k,"title",Ce[3]),Ce[19]?H?Qe[0]&524288&&oe(H,1):(H=o1(),H.c(),oe(H,1),H.m(x,null)):H&&(vr(),ue(H,1,1,()=>{H=null}),br()),(!V||Qe[0]&2)&&fi(x,"displayable",Ce[1]!==""),Ce[5]==="button"?J?(J.p(Ce,Qe),Qe[0]&32&&oe(J,1)):(J=s1(Ce),J.c(),oe(J,1),J.m(n,R)):J&&(vr(),ue(J,1,1,()=>{J=null}),br()),ze&&ze.p&&(!V||Qe[1]&536870912)&&Gr(ze,ye,Ce,Ce[60],V?qr(ye,Ce[60],Qe,null):Wr(Ce[60]),null);let _t=P;P=He(Ce),P===_t?~P&&be[P].p(Ce,Qe):(B&&(vr(),ue(be[_t],1,1,()=>{be[_t]=null}),br()),~P?(B=be[P],B?B.p(Ce,Qe):(B=be[P]=ne[P](Ce),B.c()),oe(B,1),B.m(t,null)):B=null),(!V||Qe[0]&4&&N!==(N=fd(Ce[2])+" svelte-bz0zu3"))&&Te(t,"class",N),(!V||Qe[0]&22)&&fi(t,"can-collapse",Ce[4]&&Ce[1]==="")},i(Ce){V||(oe(le),oe(u.$$.fragment,Ce),oe(S.$$.fragment,Ce),oe(H),oe(J),oe(ze,Ce),oe(B),V=!0)},o(Ce){ue(le),ue(u.$$.fragment,Ce),ue(S.$$.fragment,Ce),ue(H),ue(J),ue(ze,Ce),ue(B),V=!1},d(Ce){Ce&&(pe(e),pe(t)),Fe(u),r[63](null),Fe(S),H&&H.d(),J&&J.d(),ze&&ze.d(Ce),~P&&be[P].d(),U=!1,yn(te)}}}function t5(r,e,t){let n,l,{$$slots:u={},$$scope:f}=e;const a={continental_marine:4,country:4,major_landform:8,region:5,subregion:6,county:7,joint_municipality:8,joint_submunicipality:9,municipality:10,municipal_district:11,locality:12,neighbourhood:13,place:14,postal_code:14,road:16,poi:17,address:18,"poi.peak":15,"poi.shop":18,"poi.cafe":18,"poi.restaurant":18,"poi.aerodrome":13};let{class:_=void 0}=e,{apiKey:x}=e,{bbox:k=void 0}=e,{clearButtonTitle:S="clear"}=e,{clearOnBlur:C=!1}=e,{collapsed:z=!1}=e,{country:R=void 0}=e,{debounceSearch:D=200}=e,{enableReverse:P="never"}=e,{errorMessage:B="Something went wrong"}=e,{filter:N=()=>!0}=e,{flyTo:V=!0}=e,{fuzzyMatch:U=!0}=e,{language:te=void 0}=e,{limit:le=void 0}=e,{mapController:H=void 0}=e,{minLength:J=2}=e,{noResultsMessage:ye="Oops! Looks like you're trying to predict something that's not quite right. We can't seem to find what you're looking for. Maybe try double-checking your spelling or try a different search term. Keep on typing - we'll do our best to get you where you need to go!"}=e,{placeholder:ze="Search"}=e,{proximity:ne=[{type:"server-geolocation"}]}=e,{reverseActive:be=P==="always"}=e,{reverseButtonTitle:He="toggle reverse geocoding"}=e,{searchValue:Ce=""}=e,{pickedResultStyle:Qe="full-geometry"}=e,{showPlaceType:_t="if-needed"}=e,{showResultsWhileTyping:Ut=!0}=e,{selectFirst:Je=!0}=e,{flyToSelected:Yt=!1}=e,{markerOnSelected:Kt=!0}=e,{types:Ft=void 0}=e,{exhaustiveReverseGeocoding:Ot=!1}=e,{excludeTypes:Jt=!1}=e,{zoom:Et=a}=e,{apiUrl:sr="https://api.maptiler.com/geocoding"}=e,{fetchParameters:zt={}}=e,{iconsBaseUrl:rr="https://cdn.maptiler.com/maptiler-geocoding-control/v2.0.1/icons/"}=e,{adjustUrlQuery:wr=()=>{}}=e;function gr(){Ne.focus()}function Br(){Ne.blur()}function ht(G,je=!0,Ve=!1){t(1,Ce=G),je?(t(15,We=-1),lt()):(Qt(!Ve,Ve),setTimeout(()=>{Ne.focus(),Ne.select()}))}function Mt(){t(14,it=void 0),t(56,ie=void 0),t(15,We=-1)}function De(){t(55,xt=[]),t(56,ie=void 0)}let ut=!1,it,xt,ie,nr="",Ne,We=-1,wt,xn=[],Sn,In,ii,oi;const Xo=new Set,Jr=us();ni(()=>{H&&(H.setEventHandler(void 0),H.indicateReverse(!1),H.setSelectedMarker(-1),H.setFeatures(void 0,void 0,!1))});function lt(G){if(In&&(clearTimeout(In),In=void 0),We>-1&&it)t(56,ie=it[We]),t(1,Ce=ie.place_type[0]==="reverse"?ie.place_name:ie.place_name.replace(/,.*/,"")),t(18,wt=void 0),t(55,xt=void 0),t(15,We=-1);else if(Ce){const je=G||!Xn(Ce);kn(Ce,{exact:!0}).then(()=>{t(55,xt=it),t(56,ie=void 0),je&&Fo()}).catch(Ve=>t(18,wt=Ve))}}function Xn(G){try{return XE(G,6)}catch{return!1}}async function kn(G,{byId:je=!1,exact:Ve=!1}={}){t(18,wt=void 0),Sn==null||Sn.abort();const qe=new AbortController;t(19,Sn=qe);try{const Ke=Xn(G),ct=new URLSearchParams;if(te!==void 0&&ct.set("language",Array.isArray(te)?te.join(","):te??""),Ft&&ct.set("types",Ft.join(",")),Jt&&ct.set("excludeTypes",String(Jt)),k&&ct.set("bbox",k.map(_r=>_r.toFixed(6)).join(",")),R&&ct.set("country",Array.isArray(R)?R.join(","):R),!je&&!Ke){const _r=await OE(H,ne,qe);_r&&ct.set("proximity",_r),(Ve||!Ut)&&ct.set("autocomplete","false"),ct.set("fuzzyMatch",String(U))}le!==void 0&&(Ot||!Ke||(Ft==null?void 0:Ft.length)===1)&&ct.set("limit",String(le)),ct.set("key",x),wr(ct);const Dt=sr+"/"+encodeURIComponent(Ke?Ke.decimalLongitude+","+Ke.decimalLatitude:G)+".json?"+ct.toString();if(Dt===nr){je?(t(14,it=void 0),t(56,ie=xn[0])):t(14,it=xn);return}nr=Dt;const Ht=await fetch(Dt,{signal:qe.signal,...zt});if(!Ht.ok)throw new Error(await Ht.text());const cr=await Ht.json();Jr("response",{url:Dt,featureCollection:cr}),je?(t(14,it=void 0),t(56,ie=cr.features[0]),xn=[ie]):(t(14,it=cr.features.filter(N)),Ke&&it.unshift({type:"Feature",properties:{},id:"reverse_"+Ke.decimalLongitude+"_"+Ke.decimalLatitude,text:Ke.decimalLatitude+", "+Ke.decimalLongitude,place_name:Ke.decimalLatitude+", "+Ke.decimalLongitude,place_type:["reverse"],center:[Ke.decimalLongitude,Ke.decimalLatitude],bbox:[Ke.decimalLongitude,Ke.decimalLatitude,Ke.decimalLongitude,Ke.decimalLatitude],geometry:{type:"Point",coordinates:[Ke.decimalLongitude,Ke.decimalLatitude]}}),xn=it,Ke&&Ne.focus())}catch(Ke){if(Ke&&typeof Ke=="object"&&"name"in Ke&&Ke.name==="AbortError")return;throw Ke}finally{qe===Sn&&t(19,Sn=void 0)}}function Fo(){var qe;if(!(xt!=null&&xt.length)||!V)return;const G=[180,90,-180,-90],je=!xt.some(Ke=>!Ke.matching_text);let Ve;for(const Ke of xt){const ct=Nr(Ke);if(Ve=Ve===void 0?ct:ct===void 0?Ve:Math.max(Ve,ct),je||!Ke.matching_text)for(const Dt of[0,1,2,3])G[Dt]=Math[Dt<2?"min":"max"](G[Dt],((qe=Ke.bbox)==null?void 0:qe[Dt])??Ke.center[Dt%2])}H&&xt.length>0&&(ie&&G[0]===G[2]&&G[1]===G[3]?H.flyTo(ie.center,Nr(ie)):H.fitBounds(K0(G),50,Ve))}function Nr(G){var Ve;if(!G.bbox||G.bbox[0]!==G.bbox[2]&&G.bbox[1]!==G.bbox[3])return;const je=G.id.replace(/\..*/,"");return(Array.isArray((Ve=G.properties)==null?void 0:Ve.categories)?G.properties.categories.reduce((qe,Ke)=>{const ct=Et[je+"."+Ke];return qe===void 0?ct:ct===void 0?qe:Math.max(qe,ct)},void 0):void 0)??Et[je]}function mt(G){t(0,be=P==="always"),t(14,it=void 0),t(56,ie=void 0),t(15,We=-1),ht(G[1].toFixed(6)+", "+FE(G[0],[-180,180],!0).toFixed(6),!1,!0)}function ir(G){if(!it)return;let je=G.key==="ArrowDown"?1:G.key==="ArrowUp"?-1:0;je&&(We===(Je?0:-1)&&je===-1&&t(15,We=it.length),t(15,We+=je),We>=it.length&&t(15,We=-1),We<0&&Je&&t(15,We=0),G.preventDefault())}function Qt(G=!0,je=!1){if(t(18,wt=void 0),Ut||je){if(In&&clearTimeout(In),Ce.length<J)return;const Ve=Ce;In=window.setTimeout(()=>{kn(Ve).catch(qe=>t(18,wt=qe))},G?D:0)}else t(14,it=void 0),t(18,wt=void 0)}function jr(G){t(56,ie=G),t(1,Ce=G.place_name),t(15,We=-1)}const wi=()=>Ne.focus();function tr(G){nn[G?"unshift":"push"](()=>{Ne=G,t(17,Ne)})}function io(){Ce=this.value,t(1,Ce),t(13,ut),t(28,C)}const cn=()=>t(13,ut=!0),ge=()=>t(13,ut=!1),W=()=>Qt(),X=()=>{t(1,Ce=""),Ne.focus()},ee=()=>t(0,be=!be),he=()=>t(18,wt=void 0),Me=G=>t(15,We=G),Ie=G=>jr(G),Pe=()=>{Je||t(15,We=-1)},Se=()=>{};return r.$$set=G=>{"class"in G&&t(2,_=G.class),"apiKey"in G&&t(26,x=G.apiKey),"bbox"in G&&t(27,k=G.bbox),"clearButtonTitle"in G&&t(3,S=G.clearButtonTitle),"clearOnBlur"in G&&t(28,C=G.clearOnBlur),"collapsed"in G&&t(4,z=G.collapsed),"country"in G&&t(29,R=G.country),"debounceSearch"in G&&t(30,D=G.debounceSearch),"enableReverse"in G&&t(5,P=G.enableReverse),"errorMessage"in G&&t(6,B=G.errorMessage),"filter"in G&&t(31,N=G.filter),"flyTo"in G&&t(32,V=G.flyTo),"fuzzyMatch"in G&&t(33,U=G.fuzzyMatch),"language"in G&&t(34,te=G.language),"limit"in G&&t(35,le=G.limit),"mapController"in G&&t(36,H=G.mapController),"minLength"in G&&t(37,J=G.minLength),"noResultsMessage"in G&&t(7,ye=G.noResultsMessage),"placeholder"in G&&t(8,ze=G.placeholder),"proximity"in G&&t(38,ne=G.proximity),"reverseActive"in G&&t(0,be=G.reverseActive),"reverseButtonTitle"in G&&t(9,He=G.reverseButtonTitle),"searchValue"in G&&t(1,Ce=G.searchValue),"pickedResultStyle"in G&&t(39,Qe=G.pickedResultStyle),"showPlaceType"in G&&t(10,_t=G.showPlaceType),"showResultsWhileTyping"in G&&t(40,Ut=G.showResultsWhileTyping),"selectFirst"in G&&t(11,Je=G.selectFirst),"flyToSelected"in G&&t(41,Yt=G.flyToSelected),"markerOnSelected"in G&&t(42,Kt=G.markerOnSelected),"types"in G&&t(43,Ft=G.types),"exhaustiveReverseGeocoding"in G&&t(44,Ot=G.exhaustiveReverseGeocoding),"excludeTypes"in G&&t(45,Jt=G.excludeTypes),"zoom"in G&&t(46,Et=G.zoom),"apiUrl"in G&&t(47,sr=G.apiUrl),"fetchParameters"in G&&t(48,zt=G.fetchParameters),"iconsBaseUrl"in G&&t(12,rr=G.iconsBaseUrl),"adjustUrlQuery"in G&&t(49,wr=G.adjustUrlQuery),"$$scope"in G&&t(60,f=G.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&32&&t(0,be=P==="always"),r.$$.dirty[0]&268443648&&setTimeout(()=>{t(16,ii=ut),C&&!ut&&t(1,Ce="")}),r.$$.dirty[0]&16386|r.$$.dirty[1]&64&&Ce.length<J&&(t(56,ie=void 0),t(14,it=void 0),t(18,wt=void 0),t(55,xt=it)),r.$$.dirty[1]&33554688&&Qe!=="marker-only"&&ie&&!ie.address&&ie.geometry.type==="Point"&&ie.place_type[0]!=="reverse"&&kn(ie.id,{byId:!0}).catch(G=>t(18,wt=G)),r.$$.dirty[1]&100663330&&(H&&ie&&ie.id!==oi&&V&&(!ie.bbox||ie.bbox[0]===ie.bbox[2]&&ie.bbox[1]===ie.bbox[3]?H.flyTo(ie.center,Nr(ie)):H.fitBounds(K0(ie.bbox),50,Nr(ie)),t(14,it=void 0),t(55,xt=void 0),t(15,We=-1)),t(57,oi=ie==null?void 0:ie.id)),r.$$.dirty[0]&18432&&Je&&it!=null&&it.length&&t(15,We=0),r.$$.dirty[0]&2&&t(15,We=-1),r.$$.dirty[0]&16384|r.$$.dirty[1]&16777216&&xt!==it&&t(55,xt=void 0),r.$$.dirty[0]&81921|r.$$.dirty[1]&16777248&&H&&H.setEventHandler(G=>{switch(G.type){case"mapClick":be&&mt(G.coordinates);break;case"markerClick":{const je=it==null?void 0:it.find(Ve=>Ve.id===G.id);je&&jr(je)}break;case"markerMouseEnter":xt&&t(15,We=ii?(it==null?void 0:it.findIndex(je=>je.id===G.id))??-1:-1);break;case"markerMouseLeave":xt&&t(15,We=-1);break}}),r.$$.dirty[0]&49152&&t(58,l=it==null?void 0:it[We]),r.$$.dirty[1]&134218786&&H&&l&&V&&Yt&&H.flyTo(l.center,Nr(l)),r.$$.dirty[1]&256&&t(59,n=Qe==="full-geometry-including-polygon-center-marker"),r.$$.dirty[1]&268437536&&(Kt||H==null||H.setFeatures(void 0,void 0,n)),r.$$.dirty[1]&419432480&&H&&Kt&&!xt&&(H.setFeatures(l?[l]:void 0,void 0,n),H.setSelectedMarker(l?0:-1)),r.$$.dirty[1]&318767136&&H&&H.setFeatures(xt,ie,n),r.$$.dirty[0]&32768|r.$$.dirty[1]&16777248&&xt&&H&&H.setSelectedMarker(We),r.$$.dirty[0]&2|r.$$.dirty[1]&32&&H){const G=Xn(Ce);H.setReverseMarker(G?[G.decimalLongitude,G.decimalLatitude]:void 0)}r.$$.dirty[1]&134217728&&Jr("select",{feature:l}),r.$$.dirty[1]&33554432&&Jr("pick",{feature:ie}),r.$$.dirty[0]&81920&&Jr("optionsvisibilitychange",{optionsVisible:ii&&!!it}),r.$$.dirty[0]&16384&&Jr("featureslisted",{features:it}),r.$$.dirty[1]&16777216&&Jr("featuresmarked",{features:xt}),r.$$.dirty[0]&1&&Jr("reversetoggle",{reverse:be}),r.$$.dirty[0]&2&&Jr("querychange",{query:Ce}),r.$$.dirty[0]&1|r.$$.dirty[1]&32&&H&&H.indicateReverse(be)},[be,Ce,_,S,z,P,B,ye,ze,He,_t,Je,rr,ut,it,We,ii,Ne,wt,Sn,Xo,lt,ir,Qt,jr,a,x,k,C,R,D,N,V,U,te,le,H,J,ne,Qe,Ut,Yt,Kt,Ft,Ot,Jt,Et,sr,zt,wr,gr,Br,ht,Mt,De,xt,ie,oi,l,n,f,u,wi,tr,io,cn,ge,W,X,ee,he,Me,Ie,Pe,Se]}class r5 extends Zt{constructor(e){super(),Wt(this,e,t5,e5,Vt,{ZOOM_DEFAULTS:25,class:2,apiKey:26,bbox:27,clearButtonTitle:3,clearOnBlur:28,collapsed:4,country:29,debounceSearch:30,enableReverse:5,errorMessage:6,filter:31,flyTo:32,fuzzyMatch:33,language:34,limit:35,mapController:36,minLength:37,noResultsMessage:7,placeholder:8,proximity:38,reverseActive:0,reverseButtonTitle:9,searchValue:1,pickedResultStyle:39,showPlaceType:10,showResultsWhileTyping:40,selectFirst:11,flyToSelected:41,markerOnSelected:42,types:43,exhaustiveReverseGeocoding:44,excludeTypes:45,zoom:46,apiUrl:47,fetchParameters:48,iconsBaseUrl:12,adjustUrlQuery:49,focus:50,blur:51,setQuery:52,clearList:53,clearMap:54},null,[-1,-1,-1])}get ZOOM_DEFAULTS(){return this.$$.ctx[25]}get focus(){return this.$$.ctx[50]}get blur(){return this.$$.ctx[51]}get setQuery(){return this.$$.ctx[52]}get clearList(){return this.$$.ctx[53]}get clearMap(){return this.$$.ctx[54]}}function l1(r){let e,t,n;return t=new r5({props:{mapController:r[1],apiKey:r[0],proximity:[{type:"map-center"}]}}),{c(){e=ce("div"),Oe(t.$$.fragment),Te(e,"class","svelte-ixhnie")},m(l,u){me(l,e,u),Be(t,e,null),n=!0},p(l,u){const f={};u&2&&(f.mapController=l[1]),u&1&&(f.apiKey=l[0]),t.$set(f)},i(l){n||(oe(t.$$.fragment,l),n=!0)},o(l){ue(t.$$.fragment,l),n=!1},d(l){l&&pe(e),Fe(t)}}}function n5(r){let e,t,n=r[1]&&l1(r);return{c(){n&&n.c(),e=Hn()},m(l,u){n&&n.m(l,u),me(l,e,u),t=!0},p(l,[u]){l[1]?n?(n.p(l,u),u&2&&oe(n,1)):(n=l1(l),n.c(),oe(n,1),n.m(e.parentNode,e)):n&&(vr(),ue(n,1,1,()=>{n=null}),br())},i(l){t||(oe(n),t=!0)},o(l){ue(n),t=!1},d(l){l&&pe(e),n&&n.d(l)}}}function i5(r,e,t){let n,{apiKey:l}=e,{map:u}=e;function f(a){return a?xw(a,to,!0,!0,{duration:1e3},{duration:1e3}):null}return r.$$set=a=>{"apiKey"in a&&t(0,l=a.apiKey),"map"in a&&t(2,u=a.map)},r.$$.update=()=>{r.$$.dirty&4&&t(1,n=f(u))},[l,n,u]}class o5 extends Zt{constructor(e){super(),Wt(this,e,i5,n5,Vt,{apiKey:0,map:2})}}const s5=["==",["geometry-type"],"Polygon"],a5=["==",["geometry-type"],"LineString"];function Tw(r,e,t){let n=["match",r];for(let[l,u]of Object.entries(e))n.push(l),n.push(u);return n.push(t),n}function sh(){return{type:"FeatureCollection",features:[]}}const l5=r=>({}),c1=r=>({}),c5=r=>({}),u1=r=>({}),u5=r=>({}),h1=r=>({});function h5(r){let e,t,n,l,u,f;const a=r[1].top,_=$r(a,r,r[0],h1),x=r[1].left,k=$r(x,r,r[0],u1),S=r[1].main,C=$r(S,r,r[0],c1);return{c(){e=ce("div"),_&&_.c(),t=Ue(),n=ce("div"),k&&k.c(),l=Ue(),u=ce("div"),C&&C.c(),Te(e,"class","top svelte-mpick2"),Te(n,"class","left svelte-mpick2"),Te(u,"class","main svelte-mpick2")},m(z,R){me(z,e,R),_&&_.m(e,null),me(z,t,R),me(z,n,R),k&&k.m(n,null),me(z,l,R),me(z,u,R),C&&C.m(u,null),f=!0},p(z,[R]){_&&_.p&&(!f||R&1)&&Gr(_,a,z,z[0],f?qr(a,z[0],R,u5):Wr(z[0]),h1),k&&k.p&&(!f||R&1)&&Gr(k,x,z,z[0],f?qr(x,z[0],R,c5):Wr(z[0]),u1),C&&C.p&&(!f||R&1)&&Gr(C,S,z,z[0],f?qr(S,z[0],R,l5):Wr(z[0]),c1)},i(z){f||(oe(_,z),oe(k,z),oe(C,z),f=!0)},o(z){ue(_,z),ue(k,z),ue(C,z),f=!1},d(z){z&&(pe(e),pe(t),pe(n),pe(l),pe(u)),_&&_.d(z),k&&k.d(z),C&&C.d(z)}}}function f5(r,e,t){let{$$slots:n={},$$scope:l}=e;return r.$$set=u=>{"$$scope"in u&&t(0,l=u.$$scope)},[l,n]}class d5 extends Zt{constructor(e){super(),Wt(this,e,f5,h5,Vt,{})}}const p5=r=>({}),f1=r=>({}),m5=r=>({}),d1=r=>({}),g5=r=>({}),p1=r=>({});function _5(r){let e,t,n,l,u,f;const a=r[4].top,_=$r(a,r,r[3],p1),x=r[4].sidebar,k=$r(x,r,r[3],d1),S=r[4].map,C=$r(S,r,r[3],f1);return{c(){e=ce("div"),_&&_.c(),t=Ue(),n=ce("div"),k&&k.c(),l=Ue(),u=ce("div"),C&&C.c()},m(z,R){me(z,e,R),_&&_.m(e,null),r[5](e),me(z,t,R),me(z,n,R),k&&k.m(n,null),r[6](n),me(z,l,R),me(z,u,R),C&&C.m(u,null),r[7](u),f=!0},p(z,[R]){_&&_.p&&(!f||R&8)&&Gr(_,a,z,z[3],f?qr(a,z[3],R,g5):Wr(z[3]),p1),k&&k.p&&(!f||R&8)&&Gr(k,x,z,z[3],f?qr(x,z[3],R,m5):Wr(z[3]),d1),C&&C.p&&(!f||R&8)&&Gr(C,S,z,z[3],f?qr(S,z[3],R,p5):Wr(z[3]),f1)},i(z){f||(oe(_,z),oe(k,z),oe(C,z),f=!0)},o(z){ue(_,z),ue(k,z),ue(C,z),f=!1},d(z){z&&(pe(e),pe(t),pe(n),pe(l),pe(u)),_&&_.d(z),r[5](null),k&&k.d(z),r[6](null),C&&C.d(z),r[7](null)}}}function y5(r,e,t){let n,l,u;pt(r,Jm,S=>t(0,n=S)),pt(r,Ym,S=>t(1,l=S)),pt(r,Qm,S=>t(2,u=S));let{$$slots:f={},$$scope:a}=e;function _(S){nn[S?"unshift":"push"](()=>{n=S,Jm.set(n)})}function x(S){nn[S?"unshift":"push"](()=>{l=S,Ym.set(l)})}function k(S){nn[S?"unshift":"push"](()=>{u=S,Qm.set(u)})}return r.$$set=S=>{"$$scope"in S&&t(3,a=S.$$scope)},[n,l,u,a,f,_,x,k]}class hs extends Zt{constructor(e){super(),Wt(this,e,y5,_5,Vt,{})}}let Jm=Tr(null),Ym=Tr(null),Qm=Tr(null);function v5(r){let e,t,n,l,u,f,a,_,x;return{c(){e=ce("label"),t=tt(`Basemap:
  `),n=ce("select"),l=ce("option"),l.textContent="MapTiler Dataviz",u=ce("option"),u.textContent="MapTiler Streets",f=ce("option"),f.textContent="MapTiler Satellite",a=ce("option"),a.textContent="OS Open Zoomstack",l.__value="dataviz",ti(l,l.__value),u.__value="streets-v2",ti(u,u.__value),f.__value="hybrid",ti(f,f.__value),a.__value="uk-openzoomstack-light",ti(a,a.__value),r[0]===void 0&&hh(()=>r[1].call(n))},m(k,S){me(k,e,S),re(e,t),re(e,n),re(n,l),re(n,u),re(n,f),re(n,a),dd(n,r[0],!0),_||(x=Ct(n,"change",r[1]),_=!0)},p(k,[S]){S&1&&dd(n,k[0])},i:It,o:It,d(k){k&&pe(e),_=!1,x()}}}function b5(r,e,t){let n;pt(r,jm,u=>t(0,n=u));function l(){n=Ab(this),jm.set(n)}return[n,l]}class w5 extends Zt{constructor(e){super(),Wt(this,e,b5,v5,Vt,{})}}let nd=Tr(!0);function x5(r){let e,t;return e=new Ns({props:{paint:{"fill-color":"black","fill-opacity":0},layout:{visibility:r[0]?"none":"visible"}}}),{c(){Oe(e.$$.fragment)},m(n,l){Be(e,n,l),t=!0},p(n,l){const u={};l&1&&(u.layout={visibility:n[0]?"none":"visible"}),e.$set(u)},i(n){t||(oe(e.$$.fragment,n),t=!0)},o(n){ue(e.$$.fragment,n),t=!1},d(n){Fe(e,n)}}}function S5(r){let e,t;return e=new ri({props:{data:r[1],$$slots:{default:[x5]},$$scope:{ctx:r}}}),{c(){Oe(e.$$.fragment)},m(n,l){Be(e,n,l),t=!0},p(n,[l]){const u={};l&5&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(oe(e.$$.fragment,n),t=!0)},o(n){ue(e.$$.fragment,n),t=!1},d(n){Fe(e,n)}}}function k5(r,e,t){let n;return pt(r,nd,u=>t(0,n=u)),[n,{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]]}}]}class T5 extends Zt{constructor(e){super(),Wt(this,e,k5,S5,Vt,{})}}const E5="/ltn/assets/help-d011708a.svg";function m1(r){let e,t;return e=new Nd({props:{$$slots:{default:[C5]},$$scope:{ctx:r}}}),e.$on("close",r[3]),{c(){Oe(e.$$.fragment)},m(n,l){Be(e,n,l),t=!0},p(n,l){const u={};l&16&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(oe(e.$$.fragment,n),t=!0)},o(n){ue(e.$$.fragment,n),t=!1},d(n){Fe(e,n)}}}function C5(r){let e,t,n;const l=r[1].default,u=$r(l,r,r[4],null);return{c(){e=ce("h2"),e.textContent="Help",t=Ue(),u&&u.c()},m(f,a){me(f,e,a),me(f,t,a),u&&u.m(f,a),n=!0},p(f,a){u&&u.p&&(!n||a&16)&&Gr(u,l,f,f[4],n?qr(l,f[4],a,null):Wr(f[4]),null)},i(f){n||(oe(u,f),n=!0)},o(f){ue(u,f),n=!1},d(f){f&&(pe(e),pe(t)),u&&u.d(f)}}}function M5(r){let e,t,n,l,u,f,a=r[0]&&m1(r);return{c(){e=ce("button"),e.innerHTML=`<img src="${E5}" title="Help" alt="Help"/>`,t=Ue(),a&&a.c(),n=Hn(),Te(e,"class","svelte-gb6dzm")},m(_,x){me(_,e,x),me(_,t,x),a&&a.m(_,x),me(_,n,x),l=!0,u||(f=Ct(e,"click",r[2]),u=!0)},p(_,[x]){_[0]?a?(a.p(_,x),x&1&&oe(a,1)):(a=m1(_),a.c(),oe(a,1),a.m(n.parentNode,n)):a&&(vr(),ue(a,1,1,()=>{a=null}),br())},i(_){l||(oe(a),l=!0)},o(_){ue(a),l=!1},d(_){_&&(pe(e),pe(t),pe(n)),a&&a.d(_),u=!1,f()}}}function I5(r,e,t){let{$$slots:n={},$$scope:l}=e,u=!1;const f=()=>t(0,u=!0),a=()=>t(0,u=!1);return r.$$set=_=>{"$$scope"in _&&t(4,l=_.$$scope)},[u,n,f,a,l]}class Vg extends Zt{constructor(e){super(),Wt(this,e,I5,M5,Vt,{})}}function A5(r){let e,t,n,l;const u=r[1].default,f=$r(u,r,r[0],null);return{c(){e=ce("a"),f&&f.c(),Te(e,"href","#")},m(a,_){me(a,e,_),f&&f.m(e,null),t=!0,n||(l=Ct(e,"click",Sg(r[2])),n=!0)},p(a,[_]){f&&f.p&&(!t||_&1)&&Gr(f,u,a,a[0],t?qr(u,a[0],_,null):Wr(a[0]),null)},i(a){t||(oe(f,a),t=!0)},o(a){ue(f,a),t=!1},d(a){a&&pe(e),f&&f.d(a),n=!1,l()}}}function L5(r,e,t){let{$$slots:n={},$$scope:l}=e;function u(f){fr.call(this,r,f)}return r.$$set=f=>{"$$scope"in f&&t(0,l=f.$$scope)},[l,n,u]}class Pr extends Zt{constructor(e){super(),Wt(this,e,L5,A5,Vt,{})}}const P5=r=>({props:r&8}),g1=r=>({props:R5(r[3])});function z5(r){let e;const t=r[1].default,n=$r(t,r,r[2],g1);return{c(){n&&n.c()},m(l,u){n&&n.m(l,u),e=!0},p(l,u){n&&n.p&&(!e||u&12)&&Gr(n,t,l,l[2],e?qr(t,l[2],u,P5):Wr(l[2]),g1)},i(l){e||(oe(n,l),e=!0)},o(l){ue(n,l),e=!1},d(l){n&&n.d(l)}}}function D5(r){let e,t;return e=new f3({props:{openOn:r[0],popupClass:"popup",$$slots:{default:[z5,({features:n})=>({3:n}),({features:n})=>n?8:0]},$$scope:{ctx:r}}}),{c(){Oe(e.$$.fragment)},m(n,l){Be(e,n,l),t=!0},p(n,[l]){const u={};l&1&&(u.openOn=n[0]),l&12&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(oe(e.$$.fragment,n),t=!0)},o(n){ue(e.$$.fragment,n),t=!1},d(n){Fe(e,n)}}}function R5(r){return r?r[0].properties??{}:(console.log("A Popup with null features should be impossible"),{})}function B5(r,e,t){let{$$slots:n={},$$scope:l}=e,{openOn:u="hover"}=e;return r.$$set=f=>{"openOn"in f&&t(0,u=f.openOn),"$$scope"in f&&t(2,l=f.$$scope)},[u,n,l]}class fs extends Zt{constructor(e){super(),Wt(this,e,B5,D5,Vt,{openOn:0})}}function F5(r,e){let t=new Set(r.getStyle().layers.filter(n=>n.type=="line").map(n=>n.id));return e=="dataviz"?["Road network","Path"].filter(n=>t.has(n)):e=="hybrid"?["Path","Road","Tunnel"].filter(n=>t.has(n)):e=="streets-v2"?r.getStyle().layers.filter(n=>n["source-layer"]=="transportation"&&n.type=="line").map(n=>n.id):e=="uk-openzoomstack-light"?r.getStyle().layers.filter(n=>n["source-layer"]=="roads"&&n.type=="line").map(n=>n.id):[]}const{window:O5}=Fd;function N5(r){let e,t,n,l,u,f,a,_,x,k,S,C,z,R,D;return z=Ib(r[8][0]),{c(){e=ce("button"),e.textContent="Stop StreetView",t=Ue(),n=ce("fieldset"),l=ce("legend"),l.textContent="Source:",u=Ue(),f=ce("label"),a=ce("input"),_=tt(`
      Google Street View`),x=Ue(),k=ce("label"),S=ce("input"),C=tt(`
      Bing Streetside`),Te(e,"class","secondary"),Te(a,"type","radio"),a.__value="google",ti(a,a.__value),Te(S,"type","radio"),S.__value="bing",ti(S,S.__value),z.p(a,S)},m(P,B){me(P,e,B),me(P,t,B),me(P,n,B),re(n,l),re(n,u),re(n,f),re(f,a),a.checked=a.__value===r[0],re(f,_),re(n,x),re(n,k),re(k,S),S.checked=S.__value===r[0],re(k,C),R||(D=[Ct(e,"click",r[3]),Ct(a,"change",r[7]),Ct(S,"change",r[9])],R=!0)},p(P,B){B&1&&(a.checked=a.__value===P[0]),B&1&&(S.checked=S.__value===P[0])},d(P){P&&(pe(e),pe(t),pe(n)),z.r(),R=!1,yn(D)}}}function j5(r){let e,t,n;return{c(){e=ce("button"),e.textContent="StreetView",Te(e,"class","secondary")},m(l,u){me(l,e,u),t||(n=Ct(e,"click",r[2]),t=!0)},p:It,d(l){l&&pe(e),t=!1,n()}}}function U5(r){let e,t,n;function l(a,_){return a[1]?j5:N5}let u=l(r),f=u(r);return{c(){f.c(),e=Hn()},m(a,_){f.m(a,_),me(a,e,_),t||(n=Ct(O5,"keydown",r[4]),t=!0)},p(a,[_]){u===(u=l(a))&&f?f.p(a,_):(f.d(1),f=u(a),f&&(f.c(),f.m(e.parentNode,e)))},i:It,o:It,d(a){a&&pe(e),f.d(a),t=!1,n()}}}function V5(r,e,t){let n;pt(r,nd,D=>t(1,n=D));let{map:l}=e,{maptilerBasemap:u}=e,f="google",a=[];function _(){Lt(nd,n=!1,n),l.on("click",k),l.getCanvas().style.cursor="crosshair";for(let D of F5(l,u))a.push([D,l.getPaintProperty(D,"line-color")]),l.setPaintProperty(D,"line-color","cyan")}function x(){Lt(nd,n=!0,n),l.off("click",k),l.getCanvas().style.cursor="inherit";for(let[D,P]of a)l.setPaintProperty(D,"line-color",P);a=[]}ni(x);function k(D){let P=D.lngLat.lng,B=D.lngLat.lat;f=="google"?window.open(`http://maps.google.com/maps?q=&layer=c&cbll=${B},${P}&cbp=11,0,0,0,0`,"_blank"):f=="bing"&&window.open(`https://www.bing.com/maps?cp=${B}~${P}&style=x`,"_blank")}function S(D){!n&&D.key=="Escape"&&(D.stopPropagation(),x())}const C=[[]];function z(){f=this.__value,t(0,f)}function R(){f=this.__value,t(0,f)}return r.$$set=D=>{"map"in D&&t(5,l=D.map),"maptilerBasemap"in D&&t(6,u=D.maptilerBasemap)},[f,n,_,x,S,l,u,z,C,R]}class $5 extends Zt{constructor(e){super(),Wt(this,e,V5,U5,Vt,{map:5,maptilerBasemap:6})}}function bn(r,e=!0){return{id:r,beforeId:q5(r),eventsIfTopMost:e}}function q5(r){let e=Hi(cs);if(!e){console.warn(`getBeforeId(${r}) called before map is ready. Z-ordering may be incorrect.`);return}let t,n=!1;for(let l=_1.length-1;l>=0;l--){let u=_1[l];if(u==r){n=!0;break}e.getLayer(u)&&(t=u)}if(!n)throw new Error(`Layer ID ${r} not defined in layerZorder`);return t}let cm=r=>r,um=r=>r;const _1=[cm(um("Background")),"neighbourhood-boundaries",cm("Ferry line"),"debug-borders","debug-crosses","debug-filters","cells","interior-roads-outlines","interior-roads","compare-route","shortcuts","shortcuts-focus",um("Building"),"draw-area-lines","draw-area-preview","one-ways",um("Road labels"),cm("road_label"),"animate-shortcuts","modal-filters","boundary","neighbourhood-boundary","auto-boundaries-areas","auto-boundaries-severances","freehand-line","edit-polygon-fill","edit-polygon-lines","edit-polygon-vertices"];function G5(r){let e;return{c(){e=tt("Back")},m(t,n){me(t,e,n)},d(t){t&&pe(e)}}}function W5(r){let e,t,n,l;return e=new Pr({props:{$$slots:{default:[G5]},$$scope:{ctx:r}}}),e.$on("click",r[2]),{c(){Oe(e.$$.fragment)},m(u,f){Be(e,u,f),t=!0,n||(l=Ct(window,"keydown",r[1]),n=!0)},p(u,[f]){const a={};f&8&&(a.$$scope={dirty:f,ctx:u}),e.$set(a)},i(u){t||(oe(e.$$.fragment,u),t=!0)},o(u){ue(e.$$.fragment,u),t=!1},d(u){Fe(e,u),n=!1,l()}}}function Z5(r){let e=us();function t(l){l.key=="Escape"&&(l.stopPropagation(),e("click"))}return[e,t,()=>e("click")]}class Ph extends Zt{constructor(e){super(),Wt(this,e,Z5,W5,Vt,{})}}function H5(r){let e,t;const n=[bn("one-ways"),{filter:["all",["==",["get","kind"],"interior_road"],["!=",["get","direction"],"both"]]},{layout:{"icon-image":"oneway-arrow","icon-size":1,"symbol-placement":"line","symbol-spacing":50,"icon-allow-overlap":!0,"icon-rotate":["case",["==",["get","direction"],"forwards"],0,180]}},{paint:{"icon-opacity":["case",["get","direction_edited"],1,.5]}}];let l={};for(let u=0;u<n.length;u+=1)l=mn(l,n[u]);return e=new aw({props:l}),{c(){Oe(e.$$.fragment)},m(u,f){Be(e,u,f),t=!0},p(u,[f]){const a={};e.$set(a)},i(u){t||(oe(e.$$.fragment,u),t=!0)},o(u){ue(e.$$.fragment,u),t=!1},d(u){Fe(e,u)}}}class X5 extends Zt{constructor(e){super(),Wt(this,e,null,H5,Vt,{})}}function kh(r){let e=["#8dd3c7","#ffffb3","#bebada","#80b1d3","#fdb462","#b3de69","#fccde5","#bc80bd","#ccebc5","#ffed6f"];for(let t of r.features)t.properties.kind=="cell"&&(t.properties.cell_color=="disconnected"?t.properties.color="red":t.properties.color=e[t.properties.cell_color%e.length]);return r}const K5=r=>({}),y1=r=>({}),J5=r=>({}),v1=r=>({});function Y5(r){let e,t;const n=[bn("neighbourhood-boundary"),{paint:{"fill-color":"black","fill-opacity":.3}}];let l={};for(let u=0;u<n.length;u+=1)l=mn(l,n[u]);return e=new Ns({props:l}),{c(){Oe(e.$$.fragment)},m(u,f){Be(e,u,f),t=!0},p(u,f){const a={};e.$set(a)},i(u){t||(oe(e.$$.fragment,u),t=!0)},o(u){ue(e.$$.fragment,u),t=!1},d(u){Fe(e,u)}}}function b1(r){let e;const t=r[6]["line-popup"],n=$r(t,r,r[8],v1);return{c(){n&&n.c()},m(l,u){n&&n.m(l,u),e=!0},p(l,u){n&&n.p&&(!e||u&256)&&Gr(n,t,l,l[8],e?qr(t,l[8],u,J5):Wr(l[8]),v1)},i(l){e||(oe(n,l),e=!0)},o(l){ue(n,l),e=!1},d(l){n&&n.d(l)}}}function Q5(r){let e,t,n=r[0]&&b1(r);return{c(){n&&n.c(),e=Hn()},m(l,u){n&&n.m(l,u),me(l,e,u),t=!0},p(l,u){l[0]?n?(n.p(l,u),u&1&&oe(n,1)):(n=b1(l),n.c(),oe(n,1),n.m(e.parentNode,e)):n&&(vr(),ue(n,1,1,()=>{n=null}),br())},i(l){t||(oe(n),t=!0)},o(l){ue(n),t=!1},d(l){l&&pe(e),n&&n.d(l)}}}function eC(r){let e,t,n,l,u,f,a,_,x,k,S;e=new ri({props:{data:w1(r[3]),$$slots:{default:[Y5]},$$scope:{ctx:r}}});const C=[bn("cells"),{filter:["==",["get","kind"],"cell"]},{paint:{"fill-color":["get","color"],"fill-opacity":.8}}];let z={};for(let U=0;U<C.length;U+=1)z=mn(z,C[U]);n=new Ns({props:z});const R=[bn("interior-roads-outlines"),{filter:["==",["get","kind"],"interior_road"]},{paint:{"line-width":["interpolate",["linear"],["zoom"],5,.5+Eo,10,1+Eo,12,1.5+Eo,14,4+Eo,16,7+Eo,20,24+Eo],"line-color":"black"}}];let D={};for(let U=0;U<R.length;U+=1)D=mn(D,R[U]);u=new Ro({props:D});const P=[bn("interior-roads"),{filter:["==",["get","kind"],"interior_road"]},{paint:{"line-width":["interpolate",["linear"],["zoom"],5,.5,10,1,12,1.5,14,4,16,7,20,24],"line-color":r[2],"line-opacity":nl(1,.5)}},{manageHoverState:r[0]},{hoverCursor:r[0]?"pointer":void 0}];let B={$$slots:{default:[Q5]},$$scope:{ctx:r}};for(let U=0;U<P.length;U+=1)B=mn(B,P[U]);a=new Ro({props:B}),a.$on("click",r[7]),x=new X5({});const N=r[6]["more-layers"],V=$r(N,r,r[8],y1);return{c(){Oe(e.$$.fragment),t=Ue(),Oe(n.$$.fragment),l=Ue(),Oe(u.$$.fragment),f=Ue(),Oe(a.$$.fragment),_=Ue(),Oe(x.$$.fragment),k=Ue(),V&&V.c()},m(U,te){Be(e,U,te),me(U,t,te),Be(n,U,te),me(U,l,te),Be(u,U,te),me(U,f,te),Be(a,U,te),me(U,_,te),Be(x,U,te),me(U,k,te),V&&V.m(U,te),S=!0},p(U,te){const le={};te&8&&(le.data=w1(U[3])),te&256&&(le.$$scope={dirty:te,ctx:U}),e.$set(le);const H={};n.$set(H);const J=te&0?pd(R,[R[0],R[1],{paint:{"line-width":["interpolate",["linear"],["zoom"],5,.5+Eo,10,1+Eo,12,1.5+Eo,14,4+Eo,16,7+Eo,20,24+Eo],"line-color":"black"}}]):{};u.$set(J);const ye=te&5?pd(P,[P[0],P[1],te&4&&{paint:{"line-width":["interpolate",["linear"],["zoom"],5,.5,10,1,12,1.5,14,4,16,7,20,24],"line-color":U[2],"line-opacity":nl(1,.5)}},te&1&&{manageHoverState:U[0]},te&1&&{hoverCursor:U[0]?"pointer":void 0}]):{};te&257&&(ye.$$scope={dirty:te,ctx:U}),a.$set(ye),V&&V.p&&(!S||te&256)&&Gr(V,N,U,U[8],S?qr(N,U[8],te,K5):Wr(U[8]),y1)},i(U){S||(oe(e.$$.fragment,U),oe(n.$$.fragment,U),oe(u.$$.fragment,U),oe(a.$$.fragment,U),oe(x.$$.fragment,U),oe(V,U),S=!0)},o(U){ue(e.$$.fragment,U),ue(n.$$.fragment,U),ue(u.$$.fragment,U),ue(a.$$.fragment,U),ue(x.$$.fragment,U),ue(V,U),S=!1},d(U){U&&(pe(t),pe(l),pe(f),pe(_),pe(k)),Fe(e,U),Fe(n,U),Fe(u,U),Fe(a,U),Fe(x,U),V&&V.d(U)}}}function tC(r){let e,t;return e=new ri({props:{data:r[3],generateId:!0,$$slots:{default:[eC]},$$scope:{ctx:r}}}),{c(){Oe(e.$$.fragment)},m(n,l){Be(e,n,l),t=!0},p(n,[l]){const u={};l&8&&(u.data=n[3]),l&271&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(oe(e.$$.fragment,n),t=!0)},o(n){ue(e.$$.fragment,n),t=!1},d(n){Fe(e,n)}}}let Eo=2;function w1(r){let e=r.features.find(t=>t.properties.kind=="boundary");return{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]],e.geometry.coordinates[0]]}}}function rC(r,e,t){let n,l,u,{$$slots:f={},$$scope:a}=e,{gjInput:_}=e,{interactive:x=!0}=e,{onClickLine:k=(C,z)=>{}}=e;const S=C=>x&&k(C.detail.features[0],C.detail.event.lngLat);return r.$$set=C=>{"gjInput"in C&&t(4,_=C.gjInput),"interactive"in C&&t(0,x=C.interactive),"onClickLine"in C&&t(1,k=C.onClickLine),"$$scope"in C&&t(8,a=C.$$scope)},r.$$.update=()=>{r.$$.dirty&16&&t(3,n=kh(_)),r.$$.dirty&16&&t(5,l=Math.max(..._.features.map(C=>C.properties.kind=="interior_road"?C.properties.shortcuts:0))??0),r.$$.dirty&32&&t(2,u=l>2?nl(["interpolate-hcl",["linear"],["get","shortcuts"],0,"white",1,"#F19A93",l,"#A32015"],"blue"):nl("white","blue"))},[x,k,u,n,_,l,f,S,a]}class Gd extends Zt{constructor(e){super(),Wt(this,e,rC,tC,Vt,{gjInput:4,interactive:0,onClickLine:1})}}function nC(r){let e;return{c(){e=tt("Choose project")},m(t,n){me(t,e,n)},d(t){t&&pe(e)}}}function iC(r){let e;return{c(){e=tt("Pick neighbourhood")},m(t,n){me(t,e,n)},d(t){t&&pe(e)}}}function oC(r){let e;return{c(){e=tt("Editing")},m(t,n){me(t,e,n)},d(t){t&&pe(e)}}}function sC(r){let e,t,n,l,u,f,a,_,x,k,S,C,z,R;return u=new Pr({props:{$$slots:{default:[nC]},$$scope:{ctx:r}}}),u.$on("click",r[4]),_=new Pr({props:{$$slots:{default:[iC]},$$scope:{ctx:r}}}),_.$on("click",r[5]),S=new Pr({props:{$$slots:{default:[oC]},$$scope:{ctx:r}}}),S.$on("click",r[6]),{c(){e=ce("div"),t=ce("nav"),n=ce("ul"),l=ce("li"),Oe(u.$$.fragment),f=Ue(),a=ce("li"),Oe(_.$$.fragment),x=Ue(),k=ce("li"),Oe(S.$$.fragment),C=Ue(),z=ce("li"),z.textContent="Debug mode",Te(t,"aria-label","breadcrumb"),Te(e,"slot","top")},m(D,P){me(D,e,P),re(e,t),re(t,n),re(n,l),Be(u,l,null),re(n,f),re(n,a),Be(_,a,null),re(n,x),re(n,k),Be(S,k,null),re(n,C),re(n,z),R=!0},p(D,P){const B={};P&256&&(B.$$scope={dirty:P,ctx:D}),u.$set(B);const N={};P&256&&(N.$$scope={dirty:P,ctx:D}),_.$set(N);const V={};P&256&&(V.$$scope={dirty:P,ctx:D}),S.$set(V)},i(D){R||(oe(u.$$.fragment,D),oe(_.$$.fragment,D),oe(S.$$.fragment,D),R=!0)},o(D){ue(u.$$.fragment,D),ue(_.$$.fragment,D),ue(S.$$.fragment,D),R=!1},d(D){D&&pe(e),Fe(u),Fe(_),Fe(S)}}}function aC(r){let e,t,n;return t=new Ph({}),t.$on("click",r[3]),{c(){e=ce("div"),Oe(t.$$.fragment),Te(e,"slot","sidebar")},m(l,u){me(l,e,u),Be(t,e,null),n=!0},p:It,i(l){n||(oe(t.$$.fragment,l),n=!0)},o(l){ue(t.$$.fragment,l),n=!1},d(l){l&&pe(e),Fe(t)}}}function lC(r){let e,t;return e=new jd({props:{properties:r[7]}}),{c(){Oe(e.$$.fragment)},m(n,l){Be(e,n,l),t=!0},p(n,l){const u={};l&128&&(u.properties=n[7]),e.$set(u)},i(n){t||(oe(e.$$.fragment,n),t=!0)},o(n){ue(e.$$.fragment,n),t=!1},d(n){Fe(e,n)}}}function cC(r){let e,t,n;return t=new fs({props:{openOn:"hover",$$slots:{default:[lC,({props:l})=>({7:l}),({props:l})=>l?128:0]},$$scope:{ctx:r}}}),{c(){e=ce("div"),Oe(t.$$.fragment),Te(e,"slot","line-popup")},m(l,u){me(l,e,u),Be(t,e,null),n=!0},p(l,u){const f={};u&384&&(f.$$scope={dirty:u,ctx:l}),t.$set(f)},i(l){n||(oe(t.$$.fragment,l),n=!0)},o(l){ue(t.$$.fragment,l),n=!1},d(l){l&&pe(e),Fe(t)}}}function uC(r){let e,t;return e=new jd({props:{properties:r[7]}}),{c(){Oe(e.$$.fragment)},m(n,l){Be(e,n,l),t=!0},p(n,l){const u={};l&128&&(u.properties=n[7]),e.$set(u)},i(n){t||(oe(e.$$.fragment,n),t=!0)},o(n){ue(e.$$.fragment,n),t=!1},d(n){Fe(e,n)}}}function hC(r){let e,t;return e=new fs({props:{openOn:"hover",$$slots:{default:[uC,({props:n})=>({7:n}),({props:n})=>n?128:0]},$$scope:{ctx:r}}}),{c(){Oe(e.$$.fragment)},m(n,l){Be(e,n,l),t=!0},p(n,l){const u={};l&384&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(oe(e.$$.fragment,n),t=!0)},o(n){ue(e.$$.fragment,n),t=!1},d(n){Fe(e,n)}}}function fC(r){let e,t;return e=new jd({props:{properties:r[7]}}),{c(){Oe(e.$$.fragment)},m(n,l){Be(e,n,l),t=!0},p(n,l){const u={};l&128&&(u.properties=n[7]),e.$set(u)},i(n){t||(oe(e.$$.fragment,n),t=!0)},o(n){ue(e.$$.fragment,n),t=!1},d(n){Fe(e,n)}}}function dC(r){let e,t;return e=new fs({props:{openOn:"hover",$$slots:{default:[fC,({props:n})=>({7:n}),({props:n})=>n?128:0]},$$scope:{ctx:r}}}),{c(){Oe(e.$$.fragment)},m(n,l){Be(e,n,l),t=!0},p(n,l){const u={};l&384&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(oe(e.$$.fragment,n),t=!0)},o(n){ue(e.$$.fragment,n),t=!1},d(n){Fe(e,n)}}}function pC(r){let e,t,n,l;const u=[bn("debug-borders"),{filter:["==",["get","kind"],"border_intersection"]},{paint:{"circle-radius":15,"circle-color":"green"}}];let f={$$slots:{default:[hC]},$$scope:{ctx:r}};for(let x=0;x<u.length;x+=1)f=mn(f,u[x]);e=new Rg({props:f});const a=[bn("debug-crosses"),{filter:["==",["get","kind"],"crosses"]},{paint:{"line-width":5,"line-color":"blue"}}];let _={$$slots:{default:[dC]},$$scope:{ctx:r}};for(let x=0;x<a.length;x+=1)_=mn(_,a[x]);return n=new Ro({props:_}),{c(){Oe(e.$$.fragment),t=Ue(),Oe(n.$$.fragment)},m(x,k){Be(e,x,k),me(x,t,k),Be(n,x,k),l=!0},p(x,k){const S={};k&256&&(S.$$scope={dirty:k,ctx:x}),e.$set(S);const C={};k&256&&(C.$$scope={dirty:k,ctx:x}),n.$set(C)},i(x){l||(oe(e.$$.fragment,x),oe(n.$$.fragment,x),l=!0)},o(x){ue(e.$$.fragment,x),ue(n.$$.fragment,x),l=!1},d(x){x&&pe(t),Fe(e,x),Fe(n,x)}}}function mC(r){let e,t;return e=new jd({props:{properties:r[7]}}),{c(){Oe(e.$$.fragment)},m(n,l){Be(e,n,l),t=!0},p(n,l){const u={};l&128&&(u.properties=n[7]),e.$set(u)},i(n){t||(oe(e.$$.fragment,n),t=!0)},o(n){ue(e.$$.fragment,n),t=!1},d(n){Fe(e,n)}}}function gC(r){let e,t;return e=new fs({props:{openOn:"hover",$$slots:{default:[mC,({props:n})=>({7:n}),({props:n})=>n?128:0]},$$scope:{ctx:r}}}),{c(){Oe(e.$$.fragment)},m(n,l){Be(e,n,l),t=!0},p(n,l){const u={};l&384&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(oe(e.$$.fragment,n),t=!0)},o(n){ue(e.$$.fragment,n),t=!1},d(n){Fe(e,n)}}}function _C(r){let e,t;const n=[bn("debug-filters"),{paint:{"circle-radius":15,"circle-color":"black"}}];let l={$$slots:{default:[gC]},$$scope:{ctx:r}};for(let u=0;u<n.length;u+=1)l=mn(l,n[u]);return e=new Rg({props:l}),{c(){Oe(e.$$.fragment)},m(u,f){Be(e,u,f),t=!0},p(u,f){const a={};f&256&&(a.$$scope={dirty:f,ctx:u}),e.$set(a)},i(u){t||(oe(e.$$.fragment,u),t=!0)},o(u){ue(e.$$.fragment,u),t=!1},d(u){Fe(e,u)}}}function yC(r){let e,t,n,l,u;return t=new Gd({props:{gjInput:JSON.parse(rn(r[0]).renderNeighbourhood()),interactive:!0,onClickLine:r[2],$$slots:{"more-layers":[pC],"line-popup":[cC]},$$scope:{ctx:r}}}),l=new ri({props:{data:JSON.parse(rn(r[0]).renderModalFilters()),generateId:!0,$$slots:{default:[_C]},$$scope:{ctx:r}}}),{c(){e=ce("div"),Oe(t.$$.fragment),n=Ue(),Oe(l.$$.fragment),Te(e,"slot","map")},m(f,a){me(f,e,a),Be(t,e,null),re(e,n),Be(l,e,null),u=!0},p(f,a){const _={};a&1&&(_.gjInput=JSON.parse(rn(f[0]).renderNeighbourhood())),a&256&&(_.$$scope={dirty:a,ctx:f}),t.$set(_);const x={};a&1&&(x.data=JSON.parse(rn(f[0]).renderModalFilters())),a&256&&(x.$$scope={dirty:a,ctx:f}),l.$set(x)},i(f){u||(oe(t.$$.fragment,f),oe(l.$$.fragment,f),u=!0)},o(f){ue(t.$$.fragment,f),ue(l.$$.fragment,f),u=!1},d(f){f&&pe(e),Fe(t),Fe(l)}}}function vC(r){let e,t;return e=new hs({props:{$$slots:{map:[yC],sidebar:[aC],top:[sC]},$$scope:{ctx:r}}}),{c(){Oe(e.$$.fragment)},m(n,l){Be(e,n,l),t=!0},p(n,[l]){const u={};l&259&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(oe(e.$$.fragment,n),t=!0)},o(n){ue(e.$$.fragment,n),t=!1},d(n){Fe(e,n)}}}function bC(r,e,t){let n,l;return pt(r,Yn,k=>t(0,n=k)),pt(r,or,k=>t(1,l=k)),[n,l,(k,S)=>window.open(rn(k.properties).way,"_blank"),()=>Lt(or,l={mode:"neighbourhood"},l),()=>Lt(or,l={mode:"title"},l),()=>Lt(or,l={mode:"network"},l),()=>Lt(or,l={mode:"neighbourhood"},l)]}class wC extends Zt{constructor(e){super(),Wt(this,e,bC,vC,Vt,{})}}function x1(r,e,t){const n=r.slice();return n[7]=e[t][0],n[8]=e[t][1],n[9]=e[t][2],n}function S1(r){let e,t,n,l,u,f,a=r[8]+"",_,x,k,S,C;function z(){return r[3](r[7])}return{c(){e=ce("button"),t=ce("img"),l=Ue(),u=ce("br"),f=Ue(),_=tt(a),x=Ue(),Mn(t.src,n=`/ltn//filters/${r[7]}_icon.gif`)||Te(t,"src",n),Te(t,"width","80"),Te(t,"alt",r[8]),Te(e,"class","outline"),pn(e,"width","100%"),e.disabled=k=r[0]==r[7]},m(R,D){me(R,e,D),re(e,t),re(e,l),re(e,u),re(e,f),re(e,_),re(e,x),S||(C=Ct(e,"click",z),S=!0)},p(R,D){r=R,D&1&&k!==(k=r[0]==r[7])&&(e.disabled=k)},d(R){R&&pe(e),S=!1,C()}}}function xC(r){let e,t,n,l,u,f,a,_,x,k,S,C,z=r[1][2]+"",R,D,P,B,N,V,U=Jn(r[2]),te=[];for(let H=0;H<U.length;H+=1)te[H]=S1(x1(r,U,H));function le(){return r[4](r[6])}return{c(){e=ce("h3"),e.textContent="Choose a modal filter to place on streets",t=Ue(),n=ce("table"),l=ce("tr"),u=ce("td");for(let H=0;H<te.length;H+=1)te[H].c();f=Ue(),a=ce("td"),_=ce("img"),S=Ue(),C=ce("p"),R=tt(z),D=Ue(),P=ce("center"),B=ce("button"),B.textContent="Confirm",Mn(_.src,x=`/ltn//filters/${r[0]}.gif`)||Te(_,"src",x),Te(_,"height","300"),Te(_,"alt",k=r[1][1])},m(H,J){me(H,e,J),me(H,t,J),me(H,n,J),re(n,l),re(l,u);for(let ye=0;ye<te.length;ye+=1)te[ye]&&te[ye].m(u,null);re(l,f),re(l,a),re(a,_),re(a,S),re(a,C),re(C,R),me(H,D,J),me(H,P,J),re(P,B),N||(V=Ct(B,"click",le),N=!0)},p(H,J){if(r=H,J&5){U=Jn(r[2]);let ye;for(ye=0;ye<U.length;ye+=1){const ze=x1(r,U,ye);te[ye]?te[ye].p(ze,J):(te[ye]=S1(ze),te[ye].c(),te[ye].m(u,null))}for(;ye<te.length;ye+=1)te[ye].d(1);te.length=U.length}J&1&&!Mn(_.src,x=`/ltn//filters/${r[0]}.gif`)&&Te(_,"src",x),J&2&&k!==(k=r[1][1])&&Te(_,"alt",k),J&2&&z!==(z=r[1][2]+"")&&Ar(R,z)},d(H){H&&(pe(e),pe(t),pe(n),pe(D),pe(P)),Bs(te,H),N=!1,V()}}}function SC(r){let e,t;return e=new Nd({props:{$$slots:{default:[xC,({dialog:n})=>({6:n}),({dialog:n})=>n?64:0]},$$scope:{ctx:r}}}),e.$on("close",r[5]),{c(){Oe(e.$$.fragment)},m(n,l){Be(e,n,l),t=!0},p(n,[l]){const u={};l&4163&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(oe(e.$$.fragment,n),t=!0)},o(n){ue(e.$$.fragment,n),t=!1},d(n){Fe(e,n)}}}function kC(r,e,t){let n,l;pt(r,Vm,x=>t(0,l=x));let u=[["walk_cycle_only","Walking/cycling only","A physical barrier that only allows people walking, cycling, and rolling to pass. Often planters or bollards. Larger vehicles cannot enter."],["no_entry","No entry","An alternative sign to indicate vehicles are not allowed to enter the street. Only people walking, cycling, and rolling may pass through."],["bus_gate","Bus gate","A bus gate sign and traffic cameras are installed to allow buses, pedestrians, and cyclists to pass. There is no physical barrier."],["school_street","School street","A closure during school hours only. The barrier usually allows teachers and staff to access the school."]];const f=x=>Lt(Vm,l=x,l),a=x=>rn(x).close();function _(x){fr.call(this,r,x)}return r.$$.update=()=>{r.$$.dirty&1&&t(1,n=u.find(x=>x[0]==l))},[l,n,u,f,a,_]}class TC extends Zt{constructor(e){super(),Wt(this,e,kC,SC,Vt,{})}}function k1(r){let e,t;return e=new ri({props:{data:r[0],$$slots:{default:[EC]},$$scope:{ctx:r}}}),{c(){Oe(e.$$.fragment)},m(n,l){Be(e,n,l),t=!0},p(n,l){const u={};l&1&&(u.data=n[0]),l&64&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(oe(e.$$.fragment,n),t=!0)},o(n){ue(e.$$.fragment,n),t=!1},d(n){Fe(e,n)}}}function EC(r){let e,t;const n=[bn("freehand-line"),{paint:{"line-width":5,"line-color":"red"}}];let l={};for(let u=0;u<n.length;u+=1)l=mn(l,n[u]);return e=new Ro({props:l}),{c(){Oe(e.$$.fragment)},m(u,f){Be(e,u,f),t=!0},p(u,f){const a={};e.$set(a)},i(u){t||(oe(e.$$.fragment,u),t=!0)},o(u){ue(e.$$.fragment,u),t=!1},d(u){Fe(e,u)}}}function CC(r){let e,t,n=r[0]&&k1(r);return{c(){n&&n.c(),e=Hn()},m(l,u){n&&n.m(l,u),me(l,e,u),t=!0},p(l,[u]){l[0]?n?(n.p(l,u),u&1&&oe(n,1)):(n=k1(l),n.c(),oe(n,1),n.m(e.parentNode,e)):n&&(vr(),ue(n,1,1,()=>{n=null}),br())},i(l){t||(oe(n),t=!0)},o(l){ue(n),t=!1},d(l){l&&pe(e),n&&n.d(l)}}}function MC(r,e,t){let{map:n}=e,l=null;const u=us();n.on("dragstart",f),n.on("mousemove",a),n.on("mouseup",_),ni(()=>{n.dragPan.enable(),n.off("dragstart",f),n.off("mousemove",a),n.off("mouseup",_)});function f(){n.dragPan.disable(),t(0,l={type:"Feature",properties:{},geometry:{type:"LineString",coordinates:[]}})}function a(x){l&&(l.geometry.coordinates.push(x.lngLat.toArray()),t(0,l))}function _(){l&&(u("done",l),t(0,l=null))}return r.$$set=x=>{"map"in x&&t(1,n=x.map)},[l,n]}class IC extends Zt{constructor(e){super(),Wt(this,e,MC,CC,Vt,{map:1})}}function AC(r){let e;const t=r[3].default,n=$r(t,r,r[5],null);return{c(){n&&n.c()},m(l,u){n&&n.m(l,u),e=!0},p(l,u){n&&n.p&&(!e||u&32)&&Gr(n,t,l,l[5],e?qr(t,l[5],u,null):Wr(l[5]),null)},i(l){e||(oe(n,l),e=!0)},o(l){ue(n,l),e=!1},d(l){n&&n.d(l)}}}function LC(r){let e,t;const n=[bn("modal-filters"),{layout:{"icon-image":["get","filter_kind"],"icon-rotate":["get","angle"],"icon-allow-overlap":!0,"icon-size":.1}},{paint:{"icon-opacity":["case",["get","edited"],1,.5]}}];let l={$$slots:{default:[AC]},$$scope:{ctx:r}};for(let u=0;u<n.length;u+=1)l=mn(l,n[u]);return e=new aw({props:l}),e.$on("click",r[4]),{c(){Oe(e.$$.fragment)},m(u,f){Be(e,u,f),t=!0},p(u,f){const a={};f&32&&(a.$$scope={dirty:f,ctx:u}),e.$set(a)},i(u){t||(oe(e.$$.fragment,u),t=!0)},o(u){ue(e.$$.fragment,u),t=!1},d(u){Fe(e,u)}}}function PC(r){let e,t;return e=new ri({props:{data:r[0],generateId:!0,$$slots:{default:[LC]},$$scope:{ctx:r}}}),{c(){Oe(e.$$.fragment)},m(n,l){Be(e,n,l),t=!0},p(n,[l]){const u={};l&1&&(u.data=n[0]),l&32&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(oe(e.$$.fragment,n),t=!0)},o(n){ue(e.$$.fragment,n),t=!1},d(n){Fe(e,n)}}}function zC(r,e,t){let n,l,u;pt(r,Yn,x=>t(1,l=x)),pt(r,Ls,x=>t(2,u=x));let{$$slots:f={},$$scope:a}=e;function _(x){fr.call(this,r,x)}return r.$$set=x=>{"$$scope"in x&&t(5,a=x.$$scope)},r.$$.update=()=>{r.$$.dirty&6&&t(0,n=u>0?JSON.parse(l.renderModalFilters()):null)},[n,l,u,f,_,a]}class zh extends Zt{constructor(e){super(),Wt(this,e,zC,PC,Vt,{})}}var T1=Object.prototype.toString,Ew=function(e){var t=T1.call(e),n=t==="[object Arguments]";return n||(n=t!=="[object Array]"&&e!==null&&typeof e=="object"&&typeof e.length=="number"&&e.length>=0&&T1.call(e.callee)==="[object Function]"),n},hm,E1;function DC(){if(E1)return hm;E1=1;var r;if(!Object.keys){var e=Object.prototype.hasOwnProperty,t=Object.prototype.toString,n=Ew,l=Object.prototype.propertyIsEnumerable,u=!l.call({toString:null},"toString"),f=l.call(function(){},"prototype"),a=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],_=function(C){var z=C.constructor;return z&&z.prototype===C},x={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},k=function(){if(typeof window>"u")return!1;for(var C in window)try{if(!x["$"+C]&&e.call(window,C)&&window[C]!==null&&typeof window[C]=="object")try{_(window[C])}catch{return!0}}catch{return!0}return!1}(),S=function(C){if(typeof window>"u"||!k)return _(C);try{return _(C)}catch{return!1}};r=function(z){var R=z!==null&&typeof z=="object",D=t.call(z)==="[object Function]",P=n(z),B=R&&t.call(z)==="[object String]",N=[];if(!R&&!D&&!P)throw new TypeError("Object.keys called on a non-object");var V=f&&D;if(B&&z.length>0&&!e.call(z,0))for(var U=0;U<z.length;++U)N.push(String(U));if(P&&z.length>0)for(var te=0;te<z.length;++te)N.push(String(te));else for(var le in z)!(V&&le==="prototype")&&e.call(z,le)&&N.push(String(le));if(u)for(var H=S(z),J=0;J<a.length;++J)!(H&&a[J]==="constructor")&&e.call(z,a[J])&&N.push(a[J]);return N}}return hm=r,hm}var RC=Array.prototype.slice,BC=Ew,C1=Object.keys,id=C1?function(e){return C1(e)}:DC(),M1=Object.keys;id.shim=function(){if(Object.keys){var e=function(){var t=Object.keys(arguments);return t&&t.length===arguments.length}(1,2);e||(Object.keys=function(n){return BC(n)?M1(RC.call(n)):M1(n)})}else Object.keys=id;return Object.keys||id};var $g=id,FC=Error,OC=EvalError,NC=RangeError,jC=ReferenceError,Cw=SyntaxError,wa=TypeError,UC=URIError,Wd=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var e={},t=Symbol("test"),n=Object(t);if(typeof t=="string"||Object.prototype.toString.call(t)!=="[object Symbol]"||Object.prototype.toString.call(n)!=="[object Symbol]")return!1;var l=42;e[t]=l;for(t in e)return!1;if(typeof Object.keys=="function"&&Object.keys(e).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(e).length!==0)return!1;var u=Object.getOwnPropertySymbols(e);if(u.length!==1||u[0]!==t||!Object.prototype.propertyIsEnumerable.call(e,t))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var f=Object.getOwnPropertyDescriptor(e,t);if(f.value!==l||f.enumerable!==!0)return!1}return!0},I1=typeof Symbol<"u"&&Symbol,VC=Wd,qg=function(){return typeof I1!="function"||typeof Symbol!="function"||typeof I1("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:VC()},fm={__proto__:null,foo:{}},$C=Object,qC=function(){return{__proto__:fm}.foo===fm.foo&&!(fm instanceof $C)},GC="Function.prototype.bind called on incompatible ",WC=Object.prototype.toString,ZC=Math.max,HC="[object Function]",A1=function(e,t){for(var n=[],l=0;l<e.length;l+=1)n[l]=e[l];for(var u=0;u<t.length;u+=1)n[u+e.length]=t[u];return n},XC=function(e,t){for(var n=[],l=t||0,u=0;l<e.length;l+=1,u+=1)n[u]=e[l];return n},KC=function(r,e){for(var t="",n=0;n<r.length;n+=1)t+=r[n],n+1<r.length&&(t+=e);return t},JC=function(e){var t=this;if(typeof t!="function"||WC.apply(t)!==HC)throw new TypeError(GC+t);for(var n=XC(arguments,1),l,u=function(){if(this instanceof l){var k=t.apply(this,A1(n,arguments));return Object(k)===k?k:this}return t.apply(e,A1(n,arguments))},f=ZC(0,t.length-n.length),a=[],_=0;_<f;_++)a[_]="$"+_;if(l=Function("binder","return function ("+KC(a,",")+"){ return binder.apply(this,arguments); }")(u),t.prototype){var x=function(){};x.prototype=t.prototype,l.prototype=new x,x.prototype=null}return l},YC=JC,Gg=Function.prototype.bind||YC,QC=Function.prototype.call,eM=Object.prototype.hasOwnProperty,tM=Gg,Mw=tM.call(QC,eM),Mr,rM=FC,nM=OC,iM=NC,oM=jC,Ec=Cw,xc=wa,sM=UC,Iw=Function,dm=function(r){try{return Iw('"use strict"; return ('+r+").constructor;")()}catch{}},el=Object.getOwnPropertyDescriptor;if(el)try{el({},"")}catch{el=null}var pm=function(){throw new xc},aM=el?function(){try{return arguments.callee,pm}catch{try{return el(arguments,"callee").get}catch{return pm}}}():pm,hc=qg(),lM=qC(),ui=Object.getPrototypeOf||(lM?function(r){return r.__proto__}:null),_c={},cM=typeof Uint8Array>"u"||!ui?Mr:ui(Uint8Array),tl={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?Mr:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?Mr:ArrayBuffer,"%ArrayIteratorPrototype%":hc&&ui?ui([][Symbol.iterator]()):Mr,"%AsyncFromSyncIteratorPrototype%":Mr,"%AsyncFunction%":_c,"%AsyncGenerator%":_c,"%AsyncGeneratorFunction%":_c,"%AsyncIteratorPrototype%":_c,"%Atomics%":typeof Atomics>"u"?Mr:Atomics,"%BigInt%":typeof BigInt>"u"?Mr:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?Mr:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?Mr:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?Mr:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":rM,"%eval%":eval,"%EvalError%":nM,"%Float32Array%":typeof Float32Array>"u"?Mr:Float32Array,"%Float64Array%":typeof Float64Array>"u"?Mr:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?Mr:FinalizationRegistry,"%Function%":Iw,"%GeneratorFunction%":_c,"%Int8Array%":typeof Int8Array>"u"?Mr:Int8Array,"%Int16Array%":typeof Int16Array>"u"?Mr:Int16Array,"%Int32Array%":typeof Int32Array>"u"?Mr:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":hc&&ui?ui(ui([][Symbol.iterator]())):Mr,"%JSON%":typeof JSON=="object"?JSON:Mr,"%Map%":typeof Map>"u"?Mr:Map,"%MapIteratorPrototype%":typeof Map>"u"||!hc||!ui?Mr:ui(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?Mr:Promise,"%Proxy%":typeof Proxy>"u"?Mr:Proxy,"%RangeError%":iM,"%ReferenceError%":oM,"%Reflect%":typeof Reflect>"u"?Mr:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?Mr:Set,"%SetIteratorPrototype%":typeof Set>"u"||!hc||!ui?Mr:ui(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?Mr:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":hc&&ui?ui(""[Symbol.iterator]()):Mr,"%Symbol%":hc?Symbol:Mr,"%SyntaxError%":Ec,"%ThrowTypeError%":aM,"%TypedArray%":cM,"%TypeError%":xc,"%Uint8Array%":typeof Uint8Array>"u"?Mr:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?Mr:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?Mr:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?Mr:Uint32Array,"%URIError%":sM,"%WeakMap%":typeof WeakMap>"u"?Mr:WeakMap,"%WeakRef%":typeof WeakRef>"u"?Mr:WeakRef,"%WeakSet%":typeof WeakSet>"u"?Mr:WeakSet};if(ui)try{null.error}catch(r){var uM=ui(ui(r));tl["%Error.prototype%"]=uM}var hM=function r(e){var t;if(e==="%AsyncFunction%")t=dm("async function () {}");else if(e==="%GeneratorFunction%")t=dm("function* () {}");else if(e==="%AsyncGeneratorFunction%")t=dm("async function* () {}");else if(e==="%AsyncGenerator%"){var n=r("%AsyncGeneratorFunction%");n&&(t=n.prototype)}else if(e==="%AsyncIteratorPrototype%"){var l=r("%AsyncGenerator%");l&&ui&&(t=ui(l.prototype))}return tl[e]=t,t},L1={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},Dh=Gg,Sd=Mw,fM=Dh.call(Function.call,Array.prototype.concat),dM=Dh.call(Function.apply,Array.prototype.splice),P1=Dh.call(Function.call,String.prototype.replace),kd=Dh.call(Function.call,String.prototype.slice),pM=Dh.call(Function.call,RegExp.prototype.exec),mM=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,gM=/\\(\\)?/g,_M=function(e){var t=kd(e,0,1),n=kd(e,-1);if(t==="%"&&n!=="%")throw new Ec("invalid intrinsic syntax, expected closing `%`");if(n==="%"&&t!=="%")throw new Ec("invalid intrinsic syntax, expected opening `%`");var l=[];return P1(e,mM,function(u,f,a,_){l[l.length]=a?P1(_,gM,"$1"):f||u}),l},yM=function(e,t){var n=e,l;if(Sd(L1,n)&&(l=L1[n],n="%"+l[0]+"%"),Sd(tl,n)){var u=tl[n];if(u===_c&&(u=hM(n)),typeof u>"u"&&!t)throw new xc("intrinsic "+e+" exists, but is not available. Please file an issue!");return{alias:l,name:n,value:u}}throw new Ec("intrinsic "+e+" does not exist!")},ds=function(e,t){if(typeof e!="string"||e.length===0)throw new xc("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof t!="boolean")throw new xc('"allowMissing" argument must be a boolean');if(pM(/^%?[^%]*%?$/,e)===null)throw new Ec("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var n=_M(e),l=n.length>0?n[0]:"",u=yM("%"+l+"%",t),f=u.name,a=u.value,_=!1,x=u.alias;x&&(l=x[0],dM(n,fM([0,1],x)));for(var k=1,S=!0;k<n.length;k+=1){var C=n[k],z=kd(C,0,1),R=kd(C,-1);if((z==='"'||z==="'"||z==="`"||R==='"'||R==="'"||R==="`")&&z!==R)throw new Ec("property names with quotes must have matching quotes");if((C==="constructor"||!S)&&(_=!0),l+="."+C,f="%"+l+"%",Sd(tl,f))a=tl[f];else if(a!=null){if(!(C in a)){if(!t)throw new xc("base intrinsic for "+e+" exists, but the property is not available.");return}if(el&&k+1>=n.length){var D=el(a,C);S=!!D,S&&"get"in D&&!("originalValue"in D.get)?a=D.get:a=a[C]}else S=Sd(a,C),a=a[C];S&&!_&&(tl[f]=a)}}return a},mm,z1;function Wg(){if(z1)return mm;z1=1;var r=ds,e=r("%Object.defineProperty%",!0)||!1;if(e)try{e({},"a",{value:1})}catch{e=!1}return mm=e,mm}var vM=ds,od=vM("%Object.getOwnPropertyDescriptor%",!0);if(od)try{od([],"length")}catch{od=null}var Zg=od,D1=Wg(),bM=Cw,fc=wa,R1=Zg,Hg=function(e,t,n){if(!e||typeof e!="object"&&typeof e!="function")throw new fc("`obj` must be an object or a function`");if(typeof t!="string"&&typeof t!="symbol")throw new fc("`property` must be a string or a symbol`");if(arguments.length>3&&typeof arguments[3]!="boolean"&&arguments[3]!==null)throw new fc("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&typeof arguments[4]!="boolean"&&arguments[4]!==null)throw new fc("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&typeof arguments[5]!="boolean"&&arguments[5]!==null)throw new fc("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&typeof arguments[6]!="boolean")throw new fc("`loose`, if provided, must be a boolean");var l=arguments.length>3?arguments[3]:null,u=arguments.length>4?arguments[4]:null,f=arguments.length>5?arguments[5]:null,a=arguments.length>6?arguments[6]:!1,_=!!R1&&R1(e,t);if(D1)D1(e,t,{configurable:f===null&&_?_.configurable:!f,enumerable:l===null&&_?_.enumerable:!l,value:n,writable:u===null&&_?_.writable:!u});else if(a||!l&&!u&&!f)e[t]=n;else throw new bM("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.")},eg=Wg(),Aw=function(){return!!eg};Aw.hasArrayLengthDefineBug=function(){if(!eg)return null;try{return eg([],"length",{value:1}).length!==1}catch{return!0}};var Xg=Aw,wM=$g,xM=typeof Symbol=="function"&&typeof Symbol("foo")=="symbol",SM=Object.prototype.toString,kM=Array.prototype.concat,B1=Hg,TM=function(r){return typeof r=="function"&&SM.call(r)==="[object Function]"},Lw=Xg(),EM=function(r,e,t,n){if(e in r){if(n===!0){if(r[e]===t)return}else if(!TM(n)||!n())return}Lw?B1(r,e,t,!0):B1(r,e,t)},Pw=function(r,e){var t=arguments.length>2?arguments[2]:{},n=wM(e);xM&&(n=kM.call(n,Object.getOwnPropertySymbols(e)));for(var l=0;l<n.length;l+=1)EM(r,n[l],e[n[l]],t[n[l]])};Pw.supportsDescriptors=!!Lw;var sl=Pw,zw={exports:{}},CM=ds,F1=Hg,MM=Xg(),O1=Zg,N1=wa,IM=CM("%Math.floor%"),AM=function(e,t){if(typeof e!="function")throw new N1("`fn` is not a function");if(typeof t!="number"||t<0||t>4294967295||IM(t)!==t)throw new N1("`length` must be a positive 32-bit integer");var n=arguments.length>2&&!!arguments[2],l=!0,u=!0;if("length"in e&&O1){var f=O1(e,"length");f&&!f.configurable&&(l=!1),f&&!f.writable&&(u=!1)}return(l||u||!n)&&(MM?F1(e,"length",t,!0,!0):F1(e,"length",t)),e};(function(r){var e=Gg,t=ds,n=AM,l=wa,u=t("%Function.prototype.apply%"),f=t("%Function.prototype.call%"),a=t("%Reflect.apply%",!0)||e.call(f,u),_=Wg(),x=t("%Math.max%");r.exports=function(C){if(typeof C!="function")throw new l("a function is required");var z=a(e,f,arguments);return n(z,1+x(0,C.length-(arguments.length-1)),!0)};var k=function(){return a(e,u,arguments)};_?_(r.exports,"apply",{value:k}):r.exports.apply=k})(zw);var Rc=zw.exports,Dw=ds,Rw=Rc,LM=Rw(Dw("String.prototype.indexOf")),Bo=function(e,t){var n=Dw(e,!!t);return typeof n=="function"&&LM(e,".prototype.")>-1?Rw(n):n},PM=$g,Bw=Wd(),Fw=Bo,j1=Object,zM=Fw("Array.prototype.push"),U1=Fw("Object.prototype.propertyIsEnumerable"),DM=Bw?Object.getOwnPropertySymbols:null,Ow=function(e,t){if(e==null)throw new TypeError("target must be an object");var n=j1(e);if(arguments.length===1)return n;for(var l=1;l<arguments.length;++l){var u=j1(arguments[l]),f=PM(u),a=Bw&&(Object.getOwnPropertySymbols||DM);if(a)for(var _=a(u),x=0;x<_.length;++x){var k=_[x];U1(u,k)&&zM(f,k)}for(var S=0;S<f.length;++S){var C=f[S];if(U1(u,C)){var z=u[C];n[C]=z}}}return n},gm=Ow,RM=function(){if(!Object.assign)return!1;for(var r="abcdefghijklmnopqrst",e=r.split(""),t={},n=0;n<e.length;++n)t[e[n]]=e[n];var l=Object.assign({},t),u="";for(var f in l)u+=f;return r!==u},BM=function(){if(!Object.assign||!Object.preventExtensions)return!1;var r=Object.preventExtensions({1:2});try{Object.assign(r,"xy")}catch{return r[1]==="y"}return!1},Nw=function(){return!Object.assign||RM()||BM()?gm:Object.assign},FM=sl,OM=Nw,NM=function(){var e=OM();return FM(Object,{assign:e},{assign:function(){return Object.assign!==e}}),e},jM=sl,UM=Rc,VM=Ow,jw=Nw,$M=NM,qM=UM.apply(jw()),Uw=function(e,t){return qM(Object,arguments)};jM(Uw,{getPolyfill:jw,implementation:VM,shim:$M});var GM=Uw,Th=function(){return typeof(function(){}).name=="string"},ah=Object.getOwnPropertyDescriptor;if(ah)try{ah([],"length")}catch{ah=null}Th.functionsHaveConfigurableNames=function(){if(!Th()||!ah)return!1;var e=ah(function(){},"name");return!!e&&!!e.configurable};var WM=Function.prototype.bind;Th.boundFunctionsHaveNames=function(){return Th()&&typeof WM=="function"&&(function(){}).bind().name!==""};var ZM=Th,V1=Hg,HM=Xg(),XM=ZM.functionsHaveConfigurableNames(),KM=wa,JM=function(e,t){if(typeof e!="function")throw new KM("`fn` is not a function");var n=arguments.length>2&&!!arguments[2];return(!n||XM)&&(HM?V1(e,"name",t,!0,!0):V1(e,"name",t)),e},YM=JM,QM=wa,eI=Object,Vw=YM(function(){if(this==null||this!==eI(this))throw new QM("RegExp.prototype.flags getter called on non-object");var e="";return this.hasIndices&&(e+="d"),this.global&&(e+="g"),this.ignoreCase&&(e+="i"),this.multiline&&(e+="m"),this.dotAll&&(e+="s"),this.unicode&&(e+="u"),this.unicodeSets&&(e+="v"),this.sticky&&(e+="y"),e},"get flags",!0),tI=Vw,rI=sl.supportsDescriptors,nI=Object.getOwnPropertyDescriptor,$w=function(){if(rI&&/a/mig.flags==="gim"){var e=nI(RegExp.prototype,"flags");if(e&&typeof e.get=="function"&&typeof RegExp.prototype.dotAll=="boolean"&&typeof RegExp.prototype.hasIndices=="boolean"){var t="",n={};if(Object.defineProperty(n,"hasIndices",{get:function(){t+="d"}}),Object.defineProperty(n,"sticky",{get:function(){t+="y"}}),t==="dy")return e.get}}return tI},iI=sl.supportsDescriptors,oI=$w,sI=Object.getOwnPropertyDescriptor,aI=Object.defineProperty,lI=TypeError,$1=Object.getPrototypeOf,cI=/a/,uI=function(){if(!iI||!$1)throw new lI("RegExp.prototype.flags requires a true ES5 environment that supports property descriptors");var e=oI(),t=$1(cI),n=sI(t,"flags");return(!n||n.get!==e)&&aI(t,"flags",{configurable:!0,enumerable:!1,get:e}),e},hI=sl,fI=Rc,dI=Vw,qw=$w,pI=uI,Gw=fI(qw());hI(Gw,{getPolyfill:qw,implementation:dI,shim:pI});var mI=Gw,sd={exports:{}},gI=Wd,al=function(){return gI()&&!!Symbol.toStringTag},_I=al(),yI=Bo,tg=yI("Object.prototype.toString"),Zd=function(e){return _I&&e&&typeof e=="object"&&Symbol.toStringTag in e?!1:tg(e)==="[object Arguments]"},Ww=function(e){return Zd(e)?!0:e!==null&&typeof e=="object"&&typeof e.length=="number"&&e.length>=0&&tg(e)!=="[object Array]"&&tg(e.callee)==="[object Function]"},vI=function(){return Zd(arguments)}();Zd.isLegacyArguments=Ww;var Zw=vI?Zd:Ww;const bI={},wI=Object.freeze(Object.defineProperty({__proto__:null,default:bI},Symbol.toStringTag,{value:"Module"})),xI=Ud(wI);var Kg=typeof Map=="function"&&Map.prototype,_m=Object.getOwnPropertyDescriptor&&Kg?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,Td=Kg&&_m&&typeof _m.get=="function"?_m.get:null,q1=Kg&&Map.prototype.forEach,Jg=typeof Set=="function"&&Set.prototype,ym=Object.getOwnPropertyDescriptor&&Jg?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,Ed=Jg&&ym&&typeof ym.get=="function"?ym.get:null,G1=Jg&&Set.prototype.forEach,SI=typeof WeakMap=="function"&&WeakMap.prototype,lh=SI?WeakMap.prototype.has:null,kI=typeof WeakSet=="function"&&WeakSet.prototype,ch=kI?WeakSet.prototype.has:null,TI=typeof WeakRef=="function"&&WeakRef.prototype,W1=TI?WeakRef.prototype.deref:null,EI=Boolean.prototype.valueOf,CI=Object.prototype.toString,MI=Function.prototype.toString,II=String.prototype.match,Yg=String.prototype.slice,ua=String.prototype.replace,AI=String.prototype.toUpperCase,Z1=String.prototype.toLowerCase,Hw=RegExp.prototype.test,H1=Array.prototype.concat,ls=Array.prototype.join,LI=Array.prototype.slice,X1=Math.floor,rg=typeof BigInt=="function"?BigInt.prototype.valueOf:null,vm=Object.getOwnPropertySymbols,ng=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol.prototype.toString:null,Cc=typeof Symbol=="function"&&typeof Symbol.iterator=="object",Di=typeof Symbol=="function"&&Symbol.toStringTag&&(typeof Symbol.toStringTag===Cc||"symbol")?Symbol.toStringTag:null,Xw=Object.prototype.propertyIsEnumerable,K1=(typeof Reflect=="function"?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(r){return r.__proto__}:null);function J1(r,e){if(r===1/0||r===-1/0||r!==r||r&&r>-1e3&&r<1e3||Hw.call(/e/,e))return e;var t=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if(typeof r=="number"){var n=r<0?-X1(-r):X1(r);if(n!==r){var l=String(n),u=Yg.call(e,l.length+1);return ua.call(l,t,"$&_")+"."+ua.call(ua.call(u,/([0-9]{3})/g,"$&_"),/_$/,"")}}return ua.call(e,t,"$&_")}var ig=xI,Y1=ig.custom,Q1=Jw(Y1)?Y1:null,PI=function r(e,t,n,l){var u=t||{};if(sa(u,"quoteStyle")&&u.quoteStyle!=="single"&&u.quoteStyle!=="double")throw new TypeError('option "quoteStyle" must be "single" or "double"');if(sa(u,"maxStringLength")&&(typeof u.maxStringLength=="number"?u.maxStringLength<0&&u.maxStringLength!==1/0:u.maxStringLength!==null))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var f=sa(u,"customInspect")?u.customInspect:!0;if(typeof f!="boolean"&&f!=="symbol")throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(sa(u,"indent")&&u.indent!==null&&u.indent!=="	"&&!(parseInt(u.indent,10)===u.indent&&u.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(sa(u,"numericSeparator")&&typeof u.numericSeparator!="boolean")throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var a=u.numericSeparator;if(typeof e>"u")return"undefined";if(e===null)return"null";if(typeof e=="boolean")return e?"true":"false";if(typeof e=="string")return Qw(e,u);if(typeof e=="number"){if(e===0)return 1/0/e>0?"0":"-0";var _=String(e);return a?J1(e,_):_}if(typeof e=="bigint"){var x=String(e)+"n";return a?J1(e,x):x}var k=typeof u.depth>"u"?5:u.depth;if(typeof n>"u"&&(n=0),n>=k&&k>0&&typeof e=="object")return og(e)?"[Array]":"[Object]";var S=KI(u,n);if(typeof l>"u")l=[];else if(Yw(l,e)>=0)return"[Circular]";function C(He,Ce,Qe){if(Ce&&(l=LI.call(l),l.push(Ce)),Qe){var _t={depth:u.depth};return sa(u,"quoteStyle")&&(_t.quoteStyle=u.quoteStyle),r(He,_t,n+1,l)}return r(He,u,n+1,l)}if(typeof e=="function"&&!ev(e)){var z=UI(e),R=Wf(e,C);return"[Function"+(z?": "+z:" (anonymous)")+"]"+(R.length>0?" { "+ls.call(R,", ")+" }":"")}if(Jw(e)){var D=Cc?ua.call(String(e),/^(Symbol\(.*\))_[^)]*$/,"$1"):ng.call(e);return typeof e=="object"&&!Cc?$u(D):D}if(ZI(e)){for(var P="<"+Z1.call(String(e.nodeName)),B=e.attributes||[],N=0;N<B.length;N++)P+=" "+B[N].name+"="+Kw(zI(B[N].value),"double",u);return P+=">",e.childNodes&&e.childNodes.length&&(P+="..."),P+="</"+Z1.call(String(e.nodeName))+">",P}if(og(e)){if(e.length===0)return"[]";var V=Wf(e,C);return S&&!XI(V)?"["+sg(V,S)+"]":"[ "+ls.call(V,", ")+" ]"}if(RI(e)){var U=Wf(e,C);return!("cause"in Error.prototype)&&"cause"in e&&!Xw.call(e,"cause")?"{ ["+String(e)+"] "+ls.call(H1.call("[cause]: "+C(e.cause),U),", ")+" }":U.length===0?"["+String(e)+"]":"{ ["+String(e)+"] "+ls.call(U,", ")+" }"}if(typeof e=="object"&&f){if(Q1&&typeof e[Q1]=="function"&&ig)return ig(e,{depth:k-n});if(f!=="symbol"&&typeof e.inspect=="function")return e.inspect()}if(VI(e)){var te=[];return q1&&q1.call(e,function(He,Ce){te.push(C(Ce,e,!0)+" => "+C(He,e))}),tv("Map",Td.call(e),te,S)}if(GI(e)){var le=[];return G1&&G1.call(e,function(He){le.push(C(He,e))}),tv("Set",Ed.call(e),le,S)}if($I(e))return bm("WeakMap");if(WI(e))return bm("WeakSet");if(qI(e))return bm("WeakRef");if(FI(e))return $u(C(Number(e)));if(NI(e))return $u(C(rg.call(e)));if(OI(e))return $u(EI.call(e));if(BI(e))return $u(C(String(e)));if(typeof window<"u"&&e===window)return"{ [object Window] }";if(e===Mh)return"{ [object globalThis] }";if(!DI(e)&&!ev(e)){var H=Wf(e,C),J=K1?K1(e)===Object.prototype:e instanceof Object||e.constructor===Object,ye=e instanceof Object?"":"null prototype",ze=!J&&Di&&Object(e)===e&&Di in e?Yg.call(xa(e),8,-1):ye?"Object":"",ne=J||typeof e.constructor!="function"?"":e.constructor.name?e.constructor.name+" ":"",be=ne+(ze||ye?"["+ls.call(H1.call([],ze||[],ye||[]),": ")+"] ":"");return H.length===0?be+"{}":S?be+"{"+sg(H,S)+"}":be+"{ "+ls.call(H,", ")+" }"}return String(e)};function Kw(r,e,t){var n=(t.quoteStyle||e)==="double"?'"':"'";return n+r+n}function zI(r){return ua.call(String(r),/"/g,"&quot;")}function og(r){return xa(r)==="[object Array]"&&(!Di||!(typeof r=="object"&&Di in r))}function DI(r){return xa(r)==="[object Date]"&&(!Di||!(typeof r=="object"&&Di in r))}function ev(r){return xa(r)==="[object RegExp]"&&(!Di||!(typeof r=="object"&&Di in r))}function RI(r){return xa(r)==="[object Error]"&&(!Di||!(typeof r=="object"&&Di in r))}function BI(r){return xa(r)==="[object String]"&&(!Di||!(typeof r=="object"&&Di in r))}function FI(r){return xa(r)==="[object Number]"&&(!Di||!(typeof r=="object"&&Di in r))}function OI(r){return xa(r)==="[object Boolean]"&&(!Di||!(typeof r=="object"&&Di in r))}function Jw(r){if(Cc)return r&&typeof r=="object"&&r instanceof Symbol;if(typeof r=="symbol")return!0;if(!r||typeof r!="object"||!ng)return!1;try{return ng.call(r),!0}catch{}return!1}function NI(r){if(!r||typeof r!="object"||!rg)return!1;try{return rg.call(r),!0}catch{}return!1}var jI=Object.prototype.hasOwnProperty||function(r){return r in this};function sa(r,e){return jI.call(r,e)}function xa(r){return CI.call(r)}function UI(r){if(r.name)return r.name;var e=II.call(MI.call(r),/^function\s*([\w$]+)/);return e?e[1]:null}function Yw(r,e){if(r.indexOf)return r.indexOf(e);for(var t=0,n=r.length;t<n;t++)if(r[t]===e)return t;return-1}function VI(r){if(!Td||!r||typeof r!="object")return!1;try{Td.call(r);try{Ed.call(r)}catch{return!0}return r instanceof Map}catch{}return!1}function $I(r){if(!lh||!r||typeof r!="object")return!1;try{lh.call(r,lh);try{ch.call(r,ch)}catch{return!0}return r instanceof WeakMap}catch{}return!1}function qI(r){if(!W1||!r||typeof r!="object")return!1;try{return W1.call(r),!0}catch{}return!1}function GI(r){if(!Ed||!r||typeof r!="object")return!1;try{Ed.call(r);try{Td.call(r)}catch{return!0}return r instanceof Set}catch{}return!1}function WI(r){if(!ch||!r||typeof r!="object")return!1;try{ch.call(r,ch);try{lh.call(r,lh)}catch{return!0}return r instanceof WeakSet}catch{}return!1}function ZI(r){return!r||typeof r!="object"?!1:typeof HTMLElement<"u"&&r instanceof HTMLElement?!0:typeof r.nodeName=="string"&&typeof r.getAttribute=="function"}function Qw(r,e){if(r.length>e.maxStringLength){var t=r.length-e.maxStringLength,n="... "+t+" more character"+(t>1?"s":"");return Qw(Yg.call(r,0,e.maxStringLength),e)+n}var l=ua.call(ua.call(r,/(['\\])/g,"\\$1"),/[\x00-\x1f]/g,HI);return Kw(l,"single",e)}function HI(r){var e=r.charCodeAt(0),t={8:"b",9:"t",10:"n",12:"f",13:"r"}[e];return t?"\\"+t:"\\x"+(e<16?"0":"")+AI.call(e.toString(16))}function $u(r){return"Object("+r+")"}function bm(r){return r+" { ? }"}function tv(r,e,t,n){var l=n?sg(t,n):ls.call(t,", ");return r+" ("+e+") {"+l+"}"}function XI(r){for(var e=0;e<r.length;e++)if(Yw(r[e],`
`)>=0)return!1;return!0}function KI(r,e){var t;if(r.indent==="	")t="	";else if(typeof r.indent=="number"&&r.indent>0)t=ls.call(Array(r.indent+1)," ");else return null;return{base:t,prev:ls.call(Array(e+1),t)}}function sg(r,e){if(r.length===0)return"";var t=`
`+e.prev+e.base;return t+ls.call(r,","+t)+`
`+e.prev}function Wf(r,e){var t=og(r),n=[];if(t){n.length=r.length;for(var l=0;l<r.length;l++)n[l]=sa(r,l)?e(r[l],r):""}var u=typeof vm=="function"?vm(r):[],f;if(Cc){f={};for(var a=0;a<u.length;a++)f["$"+u[a]]=u[a]}for(var _ in r)sa(r,_)&&(t&&String(Number(_))===_&&_<r.length||Cc&&f["$"+_]instanceof Symbol||(Hw.call(/[^\w$]/,_)?n.push(e(_,r)+": "+e(r[_],r)):n.push(_+": "+e(r[_],r))));if(typeof vm=="function")for(var x=0;x<u.length;x++)Xw.call(r,u[x])&&n.push("["+e(u[x])+"]: "+e(r[u[x]],r));return n}var ex=ds,Bc=Bo,JI=PI,YI=wa,Zf=ex("%WeakMap%",!0),Hf=ex("%Map%",!0),QI=Bc("WeakMap.prototype.get",!0),eA=Bc("WeakMap.prototype.set",!0),tA=Bc("WeakMap.prototype.has",!0),rA=Bc("Map.prototype.get",!0),nA=Bc("Map.prototype.set",!0),iA=Bc("Map.prototype.has",!0),Qg=function(r,e){for(var t=r,n;(n=t.next)!==null;t=n)if(n.key===e)return t.next=n.next,n.next=r.next,r.next=n,n},oA=function(r,e){var t=Qg(r,e);return t&&t.value},sA=function(r,e,t){var n=Qg(r,e);n?n.value=t:r.next={key:e,next:r.next,value:t}},aA=function(r,e){return!!Qg(r,e)},tx=function(){var e,t,n,l={assert:function(u){if(!l.has(u))throw new YI("Side channel does not contain "+JI(u))},get:function(u){if(Zf&&u&&(typeof u=="object"||typeof u=="function")){if(e)return QI(e,u)}else if(Hf){if(t)return rA(t,u)}else if(n)return oA(n,u)},has:function(u){if(Zf&&u&&(typeof u=="object"||typeof u=="function")){if(e)return tA(e,u)}else if(Hf){if(t)return iA(t,u)}else if(n)return aA(n,u);return!1},set:function(u,f){Zf&&u&&(typeof u=="object"||typeof u=="function")?(e||(e=new Zf),eA(e,u,f)):Hf?(t||(t=new Hf),nA(t,u,f)):(n||(n={key:{},next:null}),sA(n,u,f))}};return l},lA=Mw,qu=tx(),As=wa,e_={assert:function(r,e){if(!r||typeof r!="object"&&typeof r!="function")throw new As("`O` is not an object");if(typeof e!="string")throw new As("`slot` must be a string");if(qu.assert(r),!e_.has(r,e))throw new As("`"+e+"` is not present on `O`")},get:function(r,e){if(!r||typeof r!="object"&&typeof r!="function")throw new As("`O` is not an object");if(typeof e!="string")throw new As("`slot` must be a string");var t=qu.get(r);return t&&t["$"+e]},has:function(r,e){if(!r||typeof r!="object"&&typeof r!="function")throw new As("`O` is not an object");if(typeof e!="string")throw new As("`slot` must be a string");var t=qu.get(r);return!!t&&lA(t,"$"+e)},set:function(r,e,t){if(!r||typeof r!="object"&&typeof r!="function")throw new As("`O` is not an object");if(typeof e!="string")throw new As("`slot` must be a string");var n=qu.get(r);n||(n={},qu.set(r,n)),n["$"+e]=t}};Object.freeze&&Object.freeze(e_);var cA=e_,Gu=cA,uA=SyntaxError,rv=typeof StopIteration=="object"?StopIteration:null,hA=function(e){if(!rv)throw new uA("this environment lacks StopIteration");Gu.set(e,"[[Done]]",!1);var t={next:function(){var l=Gu.get(this,"[[Iterator]]"),u=Gu.get(l,"[[Done]]");try{return{done:u,value:u?void 0:l.next()}}catch(f){if(Gu.set(l,"[[Done]]",!0),f!==rv)throw f;return{done:!0,value:void 0}}}};return Gu.set(t,"[[Iterator]]",e),t},fA={}.toString,rx=Array.isArray||function(r){return fA.call(r)=="[object Array]"},dA=String.prototype.valueOf,pA=function(e){try{return dA.call(e),!0}catch{return!1}},mA=Object.prototype.toString,gA="[object String]",_A=al(),nx=function(e){return typeof e=="string"?!0:typeof e!="object"?!1:_A?pA(e):mA.call(e)===gA},t_=typeof Map=="function"&&Map.prototype?Map:null,yA=typeof Set=="function"&&Set.prototype?Set:null,Cd;t_||(Cd=function(e){return!1});var ix=t_?Map.prototype.has:null,nv=yA?Set.prototype.has:null;!Cd&&!ix&&(Cd=function(e){return!1});var ox=Cd||function(e){if(!e||typeof e!="object")return!1;try{if(ix.call(e),nv)try{nv.call(e)}catch{return!0}return e instanceof t_}catch{}return!1},vA=typeof Map=="function"&&Map.prototype?Map:null,r_=typeof Set=="function"&&Set.prototype?Set:null,Md;r_||(Md=function(e){return!1});var iv=vA?Map.prototype.has:null,sx=r_?Set.prototype.has:null;!Md&&!sx&&(Md=function(e){return!1});var ax=Md||function(e){if(!e||typeof e!="object")return!1;try{if(sx.call(e),iv)try{iv.call(e)}catch{return!0}return e instanceof r_}catch{}return!1},ov=Zw,sv=hA;if(qg()||Wd()){var wm=Symbol.iterator;sd.exports=function(e){if(e!=null&&typeof e[wm]<"u")return e[wm]();if(ov(e))return Array.prototype[wm].call(e)}}else{var bA=rx,wA=nx,av=ds,xA=av("%Map%",!0),SA=av("%Set%",!0),qo=Bo,lv=qo("Array.prototype.push"),cv=qo("String.prototype.charCodeAt"),kA=qo("String.prototype.slice"),TA=function(e,t){var n=e.length;if(t+1>=n)return t+1;var l=cv(e,t);if(l<55296||l>56319)return t+1;var u=cv(e,t+1);return u<56320||u>57343?t+1:t+2},xm=function(e){var t=0;return{next:function(){var l=t>=e.length,u;return l||(u=e[t],t+=1),{done:l,value:u}}}},uv=function(e,t){if(bA(e)||ov(e))return xm(e);if(wA(e)){var n=0;return{next:function(){var u=TA(e,n),f=kA(e,n,u);return n=u,{done:u>e.length,value:f}}}}if(t&&typeof e["_es6-shim iterator_"]<"u")return e["_es6-shim iterator_"]()};if(!xA&&!SA)sd.exports=function(e){if(e!=null)return uv(e,!0)};else{var EA=ox,CA=ax,hv=qo("Map.prototype.forEach",!0),fv=qo("Set.prototype.forEach",!0);if(typeof process>"u"||!process.versions||!process.versions.node)var dv=qo("Map.prototype.iterator",!0),pv=qo("Set.prototype.iterator",!0);var mv=qo("Map.prototype.@@iterator",!0)||qo("Map.prototype._es6-shim iterator_",!0),gv=qo("Set.prototype.@@iterator",!0)||qo("Set.prototype._es6-shim iterator_",!0),MA=function(e){if(EA(e)){if(dv)return sv(dv(e));if(mv)return mv(e);if(hv){var t=[];return hv(e,function(l,u){lv(t,[u,l])}),xm(t)}}if(CA(e)){if(pv)return sv(pv(e));if(gv)return gv(e);if(fv){var n=[];return fv(e,function(l){lv(n,l)}),xm(n)}}};sd.exports=function(e){return MA(e)||uv(e)}}}var IA=sd.exports,_v=function(r){return r!==r},lx=function(e,t){return e===0&&t===0?1/e===1/t:!!(e===t||_v(e)&&_v(t))},AA=lx,cx=function(){return typeof Object.is=="function"?Object.is:AA},LA=cx,PA=sl,zA=function(){var e=LA();return PA(Object,{is:e},{is:function(){return Object.is!==e}}),e},DA=sl,RA=Rc,BA=lx,ux=cx,FA=zA,hx=RA(ux(),Object);DA(hx,{getPolyfill:ux,implementation:BA,shim:FA});var OA=hx,NA=Rc,fx=Bo,jA=ds,ag=jA("%ArrayBuffer%",!0),ad=fx("ArrayBuffer.prototype.byteLength",!0),UA=fx("Object.prototype.toString"),yv=!!ag&&!ad&&new ag(0).slice,vv=!!yv&&NA(yv),dx=ad||vv?function(e){if(!e||typeof e!="object")return!1;try{return ad?ad(e):vv(e,0),!0}catch{return!1}}:ag?function(e){return UA(e)==="[object ArrayBuffer]"}:function(e){return!1},VA=Date.prototype.getDay,$A=function(e){try{return VA.call(e),!0}catch{return!1}},qA=Object.prototype.toString,GA="[object Date]",WA=al(),ZA=function(e){return typeof e!="object"||e===null?!1:WA?$A(e):qA.call(e)===GA},lg=Bo,px=al(),mx,gx,cg,ug;if(px){mx=lg("Object.prototype.hasOwnProperty"),gx=lg("RegExp.prototype.exec"),cg={};var Sm=function(){throw cg};ug={toString:Sm,valueOf:Sm},typeof Symbol.toPrimitive=="symbol"&&(ug[Symbol.toPrimitive]=Sm)}var HA=lg("Object.prototype.toString"),XA=Object.getOwnPropertyDescriptor,KA="[object RegExp]",JA=px?function(e){if(!e||typeof e!="object")return!1;var t=XA(e,"lastIndex"),n=t&&mx(t,"value");if(!n)return!1;try{gx(e,ug)}catch(l){return l===cg}}:function(e){return!e||typeof e!="object"&&typeof e!="function"?!1:HA(e)===KA},YA=Bo,bv=YA("SharedArrayBuffer.prototype.byteLength",!0),QA=bv?function(e){if(!e||typeof e!="object")return!1;try{return bv(e),!0}catch{return!1}}:function(e){return!1},eL=Number.prototype.toString,tL=function(e){try{return eL.call(e),!0}catch{return!1}},rL=Object.prototype.toString,nL="[object Number]",iL=al(),oL=function(e){return typeof e=="number"?!0:typeof e!="object"?!1:iL?tL(e):rL.call(e)===nL},_x=Bo,sL=_x("Boolean.prototype.toString"),aL=_x("Object.prototype.toString"),lL=function(e){try{return sL(e),!0}catch{return!1}},cL="[object Boolean]",uL=al(),hL=function(e){return typeof e=="boolean"?!0:e===null||typeof e!="object"?!1:uL&&Symbol.toStringTag in e?lL(e):aL(e)===cL},hg={exports:{}},fL=Object.prototype.toString,dL=qg();if(dL){var pL=Symbol.prototype.toString,mL=/^Symbol\(.*\)$/,gL=function(e){return typeof e.valueOf()!="symbol"?!1:mL.test(pL.call(e))};hg.exports=function(e){if(typeof e=="symbol")return!0;if(fL.call(e)!=="[object Symbol]")return!1;try{return gL(e)}catch{return!1}}}else hg.exports=function(e){return!1};var _L=hg.exports,fg={exports:{}},wv=typeof BigInt<"u"&&BigInt,yL=function(){return typeof wv=="function"&&typeof BigInt=="function"&&typeof wv(42)=="bigint"&&typeof BigInt(42)=="bigint"},vL=yL();if(vL){var bL=BigInt.prototype.valueOf,wL=function(e){try{return bL.call(e),!0}catch{}return!1};fg.exports=function(e){return e===null||typeof e>"u"||typeof e=="boolean"||typeof e=="string"||typeof e=="number"||typeof e=="symbol"||typeof e=="function"?!1:typeof e=="bigint"?!0:wL(e)}}else fg.exports=function(e){return!1};var xL=fg.exports,SL=nx,kL=oL,TL=hL,EL=_L,CL=xL,ML=function(e){if(e==null||typeof e!="object"&&typeof e!="function")return null;if(SL(e))return"String";if(kL(e))return"Number";if(TL(e))return"Boolean";if(EL(e))return"Symbol";if(CL(e))return"BigInt"},Id=typeof WeakMap=="function"&&WeakMap.prototype?WeakMap:null,xv=typeof WeakSet=="function"&&WeakSet.prototype?WeakSet:null,Ad;Id||(Ad=function(e){return!1});var dg=Id?Id.prototype.has:null,km=xv?xv.prototype.has:null;!Ad&&!dg&&(Ad=function(e){return!1});var IL=Ad||function(e){if(!e||typeof e!="object")return!1;try{if(dg.call(e,dg),km)try{km.call(e,km)}catch{return!0}return e instanceof Id}catch{}return!1},pg={exports:{}},AL=ds,yx=Bo,LL=AL("%WeakSet%",!0),Tm=yx("WeakSet.prototype.has",!0);if(Tm){var Em=yx("WeakMap.prototype.has",!0);pg.exports=function(e){if(!e||typeof e!="object")return!1;try{if(Tm(e,Tm),Em)try{Em(e,Em)}catch{return!0}return e instanceof LL}catch{}return!1}}else pg.exports=function(e){return!1};var PL=pg.exports,zL=ox,DL=ax,RL=IL,BL=PL,FL=function(e){if(e&&typeof e=="object"){if(zL(e))return"Map";if(DL(e))return"Set";if(RL(e))return"WeakMap";if(BL(e))return"WeakSet"}return!1},vx=Function.prototype.toString,yc=typeof Reflect=="object"&&Reflect!==null&&Reflect.apply,mg,ld;if(typeof yc=="function"&&typeof Object.defineProperty=="function")try{mg=Object.defineProperty({},"length",{get:function(){throw ld}}),ld={},yc(function(){throw 42},null,mg)}catch(r){r!==ld&&(yc=null)}else yc=null;var OL=/^\s*class\b/,gg=function(e){try{var t=vx.call(e);return OL.test(t)}catch{return!1}},Cm=function(e){try{return gg(e)?!1:(vx.call(e),!0)}catch{return!1}},cd=Object.prototype.toString,NL="[object Object]",jL="[object Function]",UL="[object GeneratorFunction]",VL="[object HTMLAllCollection]",$L="[object HTML document.all class]",qL="[object HTMLCollection]",GL=typeof Symbol=="function"&&!!Symbol.toStringTag,WL=!(0 in[,]),_g=function(){return!1};if(typeof document=="object"){var ZL=document.all;cd.call(ZL)===cd.call(document.all)&&(_g=function(e){if((WL||!e)&&(typeof e>"u"||typeof e=="object"))try{var t=cd.call(e);return(t===VL||t===$L||t===qL||t===NL)&&e("")==null}catch{}return!1})}var HL=yc?function(e){if(_g(e))return!0;if(!e||typeof e!="function"&&typeof e!="object")return!1;try{yc(e,null,mg)}catch(t){if(t!==ld)return!1}return!gg(e)&&Cm(e)}:function(e){if(_g(e))return!0;if(!e||typeof e!="function"&&typeof e!="object")return!1;if(GL)return Cm(e);if(gg(e))return!1;var t=cd.call(e);return t!==jL&&t!==UL&&!/^\[object HTML/.test(t)?!1:Cm(e)},XL=HL,KL=Object.prototype.toString,bx=Object.prototype.hasOwnProperty,JL=function(e,t,n){for(var l=0,u=e.length;l<u;l++)bx.call(e,l)&&(n==null?t(e[l],l,e):t.call(n,e[l],l,e))},YL=function(e,t,n){for(var l=0,u=e.length;l<u;l++)n==null?t(e.charAt(l),l,e):t.call(n,e.charAt(l),l,e)},QL=function(e,t,n){for(var l in e)bx.call(e,l)&&(n==null?t(e[l],l,e):t.call(n,e[l],l,e))},eP=function(e,t,n){if(!XL(t))throw new TypeError("iterator must be a function");var l;arguments.length>=3&&(l=n),KL.call(e)==="[object Array]"?JL(e,t,l):typeof e=="string"?YL(e,t,l):QL(e,t,l)},tP=eP,rP=["Float32Array","Float64Array","Int8Array","Int16Array","Int32Array","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","BigInt64Array","BigUint64Array"],Mm=rP,nP=typeof globalThis>"u"?Mh:globalThis,iP=function(){for(var e=[],t=0;t<Mm.length;t++)typeof nP[Mm[t]]=="function"&&(e[e.length]=Mm[t]);return e},Ld=tP,oP=iP,Sv=Rc,n_=Bo,ud=Zg,sP=n_("Object.prototype.toString"),wx=al(),kv=typeof globalThis>"u"?Mh:globalThis,yg=oP(),i_=n_("String.prototype.slice"),Im=Object.getPrototypeOf,aP=n_("Array.prototype.indexOf",!0)||function(e,t){for(var n=0;n<e.length;n+=1)if(e[n]===t)return n;return-1},Pd={__proto__:null};wx&&ud&&Im?Ld(yg,function(r){var e=new kv[r];if(Symbol.toStringTag in e){var t=Im(e),n=ud(t,Symbol.toStringTag);if(!n){var l=Im(t);n=ud(l,Symbol.toStringTag)}Pd["$"+r]=Sv(n.get)}}):Ld(yg,function(r){var e=new kv[r],t=e.slice||e.set;t&&(Pd["$"+r]=Sv(t))});var lP=function(e){var t=!1;return Ld(Pd,function(n,l){if(!t)try{"$"+n(e)===l&&(t=i_(l,1))}catch{}}),t},cP=function(e){var t=!1;return Ld(Pd,function(n,l){if(!t)try{n(e),t=i_(l,1)}catch{}}),t},uP=function(e){if(!e||typeof e!="object")return!1;if(!wx){var t=i_(sP(e),8,-1);return aP(yg,t)>-1?t:t!=="Object"?!1:cP(e)}return ud?lP(e):null},hP=Bo,Tv=hP("ArrayBuffer.prototype.byteLength",!0),fP=dx,dP=function(e){return fP(e)?Tv?Tv(e):e.byteLength:NaN},xx=GM,ps=Bo,Ev=mI,pP=ds,Mc=IA,mP=tx,Cv=OA,Mv=Zw,Iv=rx,Av=dx,Lv=ZA,Pv=JA,zv=QA,Dv=$g,Rv=ML,Bv=FL,Fv=uP,Ov=dP,Nv=ps("SharedArrayBuffer.prototype.byteLength",!0),jv=ps("Date.prototype.getTime"),Am=Object.getPrototypeOf,Uv=ps("Object.prototype.toString"),zd=pP("%Set%",!0),vg=ps("Map.prototype.has",!0),Dd=ps("Map.prototype.get",!0),Vv=ps("Map.prototype.size",!0),Rd=ps("Set.prototype.add",!0),Sx=ps("Set.prototype.delete",!0),Bd=ps("Set.prototype.has",!0),hd=ps("Set.prototype.size",!0);function $v(r,e,t,n){for(var l=Mc(r),u;(u=l.next())&&!u.done;)if(Ho(e,u.value,t,n))return Sx(r,u.value),!0;return!1}function kx(r){if(typeof r>"u")return null;if(typeof r!="object")return typeof r=="symbol"?!1:typeof r=="string"||typeof r=="number"?+r==+r:!0}function gP(r,e,t,n,l,u){var f=kx(t);if(f!=null)return f;var a=Dd(e,f),_=xx({},l,{strict:!1});return typeof a>"u"&&!vg(e,f)||!Ho(n,a,_,u)?!1:!vg(r,f)&&Ho(n,a,_,u)}function _P(r,e,t){var n=kx(t);return n??(Bd(e,n)&&!Bd(r,n))}function qv(r,e,t,n,l,u){for(var f=Mc(r),a,_;(a=f.next())&&!a.done;)if(_=a.value,Ho(t,_,l,u)&&Ho(n,Dd(e,_),l,u))return Sx(r,_),!0;return!1}function Ho(r,e,t,n){var l=t||{};if(l.strict?Cv(r,e):r===e)return!0;var u=Rv(r),f=Rv(e);if(u!==f)return!1;if(!r||!e||typeof r!="object"&&typeof e!="object")return l.strict?Cv(r,e):r==e;var a=n.has(r),_=n.has(e),x;if(a&&_){if(n.get(r)===n.get(e))return!0}else x={};return a||n.set(r,x),_||n.set(e,x),bP(r,e,l,n)}function Gv(r){return!r||typeof r!="object"||typeof r.length!="number"||typeof r.copy!="function"||typeof r.slice!="function"||r.length>0&&typeof r[0]!="number"?!1:!!(r.constructor&&r.constructor.isBuffer&&r.constructor.isBuffer(r))}function yP(r,e,t,n){if(hd(r)!==hd(e))return!1;for(var l=Mc(r),u=Mc(e),f,a,_;(f=l.next())&&!f.done;)if(f.value&&typeof f.value=="object")_||(_=new zd),Rd(_,f.value);else if(!Bd(e,f.value)){if(t.strict||!_P(r,e,f.value))return!1;_||(_=new zd),Rd(_,f.value)}if(_){for(;(a=u.next())&&!a.done;)if(a.value&&typeof a.value=="object"){if(!$v(_,a.value,t.strict,n))return!1}else if(!t.strict&&!Bd(r,a.value)&&!$v(_,a.value,t.strict,n))return!1;return hd(_)===0}return!0}function vP(r,e,t,n){if(Vv(r)!==Vv(e))return!1;for(var l=Mc(r),u=Mc(e),f,a,_,x,k,S;(f=l.next())&&!f.done;)if(x=f.value[0],k=f.value[1],x&&typeof x=="object")_||(_=new zd),Rd(_,x);else if(S=Dd(e,x),typeof S>"u"&&!vg(e,x)||!Ho(k,S,t,n)){if(t.strict||!gP(r,e,x,k,t,n))return!1;_||(_=new zd),Rd(_,x)}if(_){for(;(a=u.next())&&!a.done;)if(x=a.value[0],S=a.value[1],x&&typeof x=="object"){if(!qv(_,r,x,S,t,n))return!1}else if(!t.strict&&(!r.has(x)||!Ho(Dd(r,x),S,t,n))&&!qv(_,r,x,S,xx({},t,{strict:!1}),n))return!1;return hd(_)===0}return!0}function bP(r,e,t,n){var l,u;if(typeof r!=typeof e||r==null||e==null||Uv(r)!==Uv(e)||Mv(r)!==Mv(e))return!1;var f=Iv(r),a=Iv(e);if(f!==a)return!1;var _=r instanceof Error,x=e instanceof Error;if(_!==x||(_||x)&&(r.name!==e.name||r.message!==e.message))return!1;var k=Pv(r),S=Pv(e);if(k!==S||(k||S)&&(r.source!==e.source||Ev(r)!==Ev(e)))return!1;var C=Lv(r),z=Lv(e);if(C!==z||(C||z)&&jv(r)!==jv(e)||t.strict&&Am&&Am(r)!==Am(e))return!1;var R=Fv(r),D=Fv(e);if(R!==D)return!1;if(R||D){if(r.length!==e.length)return!1;for(l=0;l<r.length;l++)if(r[l]!==e[l])return!1;return!0}var P=Gv(r),B=Gv(e);if(P!==B)return!1;if(P||B){if(r.length!==e.length)return!1;for(l=0;l<r.length;l++)if(r[l]!==e[l])return!1;return!0}var N=Av(r),V=Av(e);if(N!==V)return!1;if(N||V)return Ov(r)!==Ov(e)?!1:typeof Uint8Array=="function"&&Ho(new Uint8Array(r),new Uint8Array(e),t,n);var U=zv(r),te=zv(e);if(U!==te)return!1;if(U||te)return Nv(r)!==Nv(e)?!1:typeof Uint8Array=="function"&&Ho(new Uint8Array(r),new Uint8Array(e),t,n);if(typeof r!=typeof e)return!1;var le=Dv(r),H=Dv(e);if(le.length!==H.length)return!1;for(le.sort(),H.sort(),l=le.length-1;l>=0;l--)if(le[l]!=H[l])return!1;for(l=le.length-1;l>=0;l--)if(u=le[l],!Ho(r[u],e[u],t,n))return!1;var J=Bv(r),ye=Bv(e);return J!==ye?!1:J==="Set"||ye==="Set"?yP(r,e,t,n):J==="Map"?vP(r,e,t,n):!0}var wP=function(e,t,n){return Ho(e,t,n,mP())};const xP=Eg(wP);var SP=Object.defineProperty,Zr=(r,e)=>SP(r,"name",{value:e,configurable:!0}),kP=class{constructor(e){this.direction=!1,this.compareProperties=!0;var t,n,l;this.precision=10**-((t=e==null?void 0:e.precision)!=null?t:17),this.direction=(n=e==null?void 0:e.direction)!=null?n:!1,this.compareProperties=(l=e==null?void 0:e.compareProperties)!=null?l:!0}compare(e,t){if(e.type!==t.type||!eh(e,t))return!1;switch(e.type){case"Point":return this.compareCoord(e.coordinates,t.coordinates);case"LineString":return this.compareLine(e.coordinates,t.coordinates);case"Polygon":return this.comparePolygon(e,t);case"GeometryCollection":return this.compareGeometryCollection(e,t);case"Feature":return this.compareFeature(e,t);case"FeatureCollection":return this.compareFeatureCollection(e,t);default:if(e.type.startsWith("Multi")){const n=bg(e),l=bg(t);return n.every(u=>l.some(f=>this.compare(u,f)))}}return!1}compareCoord(e,t){return e.length===t.length&&e.every((n,l)=>Math.abs(n-t[l])<this.precision)}compareLine(e,t,n=0,l=!1){if(!eh(e,t))return!1;const u=e;let f=t;if(l&&!this.compareCoord(u[0],f[0])){const _=this.fixStartIndex(f,u);if(_)f=_;else return!1}const a=this.compareCoord(u[n],f[n]);return this.direction||a?this.comparePath(u,f):this.compareCoord(u[n],f[f.length-(1+n)])?this.comparePath(u.slice().reverse(),f):!1}fixStartIndex(e,t){let n,l=-1;for(let u=0;u<e.length;u++)if(this.compareCoord(e[u],t[0])){l=u;break}return l>=0&&(n=[].concat(e.slice(l,e.length),e.slice(1,l+1))),n}comparePath(e,t){return e.every((n,l)=>this.compareCoord(n,t[l]))}comparePolygon(e,t){if(this.compareLine(e.coordinates[0],t.coordinates[0],1,!0)){const n=e.coordinates.slice(1,e.coordinates.length),l=t.coordinates.slice(1,t.coordinates.length);return n.every(u=>l.some(f=>this.compareLine(u,f,1,!0)))}return!1}compareGeometryCollection(e,t){return eh(e.geometries,t.geometries)&&this.compareBBox(e,t)&&e.geometries.every((n,l)=>this.compare(n,t.geometries[l]))}compareFeature(e,t){return e.id===t.id&&(this.compareProperties?xP(e.properties,t.properties):!0)&&this.compareBBox(e,t)&&this.compare(e.geometry,t.geometry)}compareFeatureCollection(e,t){return eh(e.features,t.features)&&this.compareBBox(e,t)&&e.features.every((n,l)=>this.compare(n,t.features[l]))}compareBBox(e,t){return!e.bbox&&!t.bbox||(e.bbox&&t.bbox?this.compareCoord(e.bbox,t.bbox):!1)}};Zr(kP,"GeojsonEquality");function eh(r,e){return r.coordinates?r.coordinates.length===e.coordinates.length:r.length===e.length}Zr(eh,"sameLength");function bg(r){return r.coordinates.map(e=>({type:r.type.replace("Multi",""),coordinates:e}))}Zr(bg,"explode");var po=63710088e-1,Tx={centimeters:po*100,centimetres:po*100,degrees:360/(2*Math.PI),feet:po*3.28084,inches:po*39.37,kilometers:po/1e3,kilometres:po/1e3,meters:po,metres:po,miles:po/1609.344,millimeters:po*1e3,millimetres:po*1e3,nauticalmiles:po/1852,radians:1,yards:po*1.0936},Wv={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,nauticalmiles:29155334959812285e-23,millimeters:1e6,millimetres:1e6,yards:1.195990046};function Sa(r,e,t={}){const n={type:"Feature"};return(t.id===0||t.id)&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.properties=e||{},n.geometry=r,n}Zr(Sa,"feature");function TP(r,e,t={}){switch(r){case"Point":return Ic(e).geometry;case"LineString":return s_(e).geometry;case"Polygon":return o_(e).geometry;case"MultiPoint":return Cx(e).geometry;case"MultiLineString":return Ex(e).geometry;case"MultiPolygon":return Mx(e).geometry;default:throw new Error(r+" is invalid")}}Zr(TP,"geometry");function Ic(r,e,t={}){if(!r)throw new Error("coordinates is required");if(!Array.isArray(r))throw new Error("coordinates must be an Array");if(r.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Ac(r[0])||!Ac(r[1]))throw new Error("coordinates must contain numbers");return Sa({type:"Point",coordinates:r},e,t)}Zr(Ic,"point");function EP(r,e,t={}){return Hd(r.map(n=>Ic(n,e)),t)}Zr(EP,"points");function o_(r,e,t={}){for(const l of r){if(l.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(l[l.length-1].length!==l[0].length)throw new Error("First and last Position are not equivalent.");for(let u=0;u<l[l.length-1].length;u++)if(l[l.length-1][u]!==l[0][u])throw new Error("First and last Position are not equivalent.")}return Sa({type:"Polygon",coordinates:r},e,t)}Zr(o_,"polygon");function CP(r,e,t={}){return Hd(r.map(n=>o_(n,e)),t)}Zr(CP,"polygons");function s_(r,e,t={}){if(r.length<2)throw new Error("coordinates must be an array of two or more positions");return Sa({type:"LineString",coordinates:r},e,t)}Zr(s_,"lineString");function MP(r,e,t={}){return Hd(r.map(n=>s_(n,e)),t)}Zr(MP,"lineStrings");function Hd(r,e={}){const t={type:"FeatureCollection"};return e.id&&(t.id=e.id),e.bbox&&(t.bbox=e.bbox),t.features=r,t}Zr(Hd,"featureCollection");function Ex(r,e,t={}){return Sa({type:"MultiLineString",coordinates:r},e,t)}Zr(Ex,"multiLineString");function Cx(r,e,t={}){return Sa({type:"MultiPoint",coordinates:r},e,t)}Zr(Cx,"multiPoint");function Mx(r,e,t={}){return Sa({type:"MultiPolygon",coordinates:r},e,t)}Zr(Mx,"multiPolygon");function IP(r,e,t={}){return Sa({type:"GeometryCollection",geometries:r},e,t)}Zr(IP,"geometryCollection");function AP(r,e=0){if(e&&!(e>=0))throw new Error("precision must be a positive number");const t=Math.pow(10,e||0);return Math.round(r*t)/t}Zr(AP,"round");function a_(r,e="kilometers"){const t=Tx[e];if(!t)throw new Error(e+" units is invalid");return r*t}Zr(a_,"radiansToLength");function Xd(r,e="kilometers"){const t=Tx[e];if(!t)throw new Error(e+" units is invalid");return r/t}Zr(Xd,"lengthToRadians");function LP(r,e){return Eh(Xd(r,e))}Zr(LP,"lengthToDegrees");function PP(r){let e=r%360;return e<0&&(e+=360),e}Zr(PP,"bearingToAzimuth");function Eh(r){return r%(2*Math.PI)*180/Math.PI}Zr(Eh,"radiansToDegrees");function zo(r){return r%360*Math.PI/180}Zr(zo,"degreesToRadians");function zP(r,e="kilometers",t="kilometers"){if(!(r>=0))throw new Error("length must be a positive number");return a_(Xd(r,e),t)}Zr(zP,"convertLength");function DP(r,e="meters",t="kilometers"){if(!(r>=0))throw new Error("area must be a positive number");const n=Wv[e];if(!n)throw new Error("invalid original units");const l=Wv[t];if(!l)throw new Error("invalid final units");return r/n*l}Zr(DP,"convertArea");function Ac(r){return!isNaN(r)&&r!==null&&!Array.isArray(r)}Zr(Ac,"isNumber");function RP(r){return r!==null&&typeof r=="object"&&!Array.isArray(r)}Zr(RP,"isObject");function BP(r){if(!r)throw new Error("bbox is required");if(!Array.isArray(r))throw new Error("bbox must be an Array");if(r.length!==4&&r.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");r.forEach(e=>{if(!Ac(e))throw new Error("bbox must only contain numbers")})}Zr(BP,"validateBBox");function FP(r){if(!r)throw new Error("id is required");if(["string","number"].indexOf(typeof r)===-1)throw new Error("id must be a number or a string")}Zr(FP,"validateId");var OP=Object.defineProperty,ka=(r,e)=>OP(r,"name",{value:e,configurable:!0});function Lc(r){if(!r)throw new Error("coord is required");if(!Array.isArray(r)){if(r.type==="Feature"&&r.geometry!==null&&r.geometry.type==="Point")return[...r.geometry.coordinates];if(r.type==="Point")return[...r.coordinates]}if(Array.isArray(r)&&r.length>=2&&!Array.isArray(r[0])&&!Array.isArray(r[1]))return[...r];throw new Error("coord must be GeoJSON Point or an Array of numbers")}ka(Lc,"getCoord");function NP(r){if(Array.isArray(r))return r;if(r.type==="Feature"){if(r.geometry!==null)return r.geometry.coordinates}else if(r.coordinates)return r.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}ka(NP,"getCoords");function Ix(r){if(r.length>1&&Ac(r[0])&&Ac(r[1]))return!0;if(Array.isArray(r[0])&&r[0].length)return Ix(r[0]);throw new Error("coordinates must only contain numbers")}ka(Ix,"containsNumber");function jP(r,e,t){if(!e||!t)throw new Error("type and name required");if(!r||r.type!==e)throw new Error("Invalid input to "+t+": must be a "+e+", given "+r.type)}ka(jP,"geojsonType");function UP(r,e,t){if(!r)throw new Error("No feature passed");if(!t)throw new Error(".featureOf() requires a name");if(!r||r.type!=="Feature"||!r.geometry)throw new Error("Invalid input to "+t+", Feature with geometry required");if(!r.geometry||r.geometry.type!==e)throw new Error("Invalid input to "+t+": must be a "+e+", given "+r.geometry.type)}ka(UP,"featureOf");function VP(r,e,t){if(!r)throw new Error("No featureCollection passed");if(!t)throw new Error(".collectionOf() requires a name");if(!r||r.type!=="FeatureCollection")throw new Error("Invalid input to "+t+", FeatureCollection required");for(const n of r.features){if(!n||n.type!=="Feature"||!n.geometry)throw new Error("Invalid input to "+t+", Feature with geometry required");if(!n.geometry||n.geometry.type!==e)throw new Error("Invalid input to "+t+": must be a "+e+", given "+n.geometry.type)}}ka(VP,"collectionOf");function Ax(r){return r.type==="Feature"?r.geometry:r}ka(Ax,"getGeom");function $P(r,e){return r.type==="FeatureCollection"?"FeatureCollection":r.type==="GeometryCollection"?"GeometryCollection":r.type==="Feature"&&r.geometry!==null?r.geometry.type:r.type}ka($P,"getType");var qP=Object.defineProperty,Lx=(r,e)=>qP(r,"name",{value:e,configurable:!0});function l_(r,e,t={}){if(t.final===!0)return Px(r,e);const n=Lc(r),l=Lc(e),u=zo(n[0]),f=zo(l[0]),a=zo(n[1]),_=zo(l[1]),x=Math.sin(f-u)*Math.cos(_),k=Math.cos(a)*Math.sin(_)-Math.sin(a)*Math.cos(_)*Math.cos(f-u);return Eh(Math.atan2(x,k))}Lx(l_,"bearing");function Px(r,e){let t=l_(e,r);return t=(t+180)%360,t}Lx(Px,"calculateFinalBearing");var GP=Object.defineProperty,WP=(r,e)=>GP(r,"name",{value:e,configurable:!0});function zx(r,e,t,n={}){const l=Lc(r),u=zo(l[0]),f=zo(l[1]),a=zo(t),_=Xd(e,n.units),x=Math.asin(Math.sin(f)*Math.cos(_)+Math.cos(f)*Math.sin(_)*Math.cos(a)),k=u+Math.atan2(Math.sin(a)*Math.sin(_)*Math.cos(f),Math.cos(_)-Math.sin(f)*Math.sin(x)),S=Eh(k),C=Eh(x);return Ic([S,C],n.properties)}WP(zx,"destination");var ZP=Object.defineProperty,HP=(r,e)=>ZP(r,"name",{value:e,configurable:!0});function Dx(r,e,t={}){var n=Lc(r),l=Lc(e),u=zo(l[1]-n[1]),f=zo(l[0]-n[0]),a=zo(n[1]),_=zo(l[1]),x=Math.pow(Math.sin(u/2),2)+Math.pow(Math.sin(f/2),2)*Math.cos(a)*Math.cos(_);return a_(2*Math.atan2(Math.sqrt(x),Math.sqrt(1-x)),t.units)}HP(Dx,"distance");var XP=Object.defineProperty,KP=(r,e)=>XP(r,"name",{value:e,configurable:!0});function Rx(r,e,t={}){const l=Ax(r).coordinates;let u=0;for(let f=0;f<l.length&&!(e>=u&&f===l.length-1);f++)if(u>=e){const a=e-u;if(a){const _=l_(l[f],l[f-1])-180;return zx(l[f],a,_,t)}else return Ic(l[f])}else u+=Dx(l[f],l[f+1],t);return Ic(l[l.length-1])}KP(Rx,"along");var JP=Rx;function YP(r){let e,t;const n=[bn("animate-shortcuts"),{paint:{"circle-radius":10,"circle-color":"purple","circle-stroke-color":"black","circle-stroke-width":1}}];let l={};for(let u=0;u<n.length;u+=1)l=mn(l,n[u]);return e=new Rg({props:l}),{c(){Oe(e.$$.fragment)},m(u,f){Be(e,u,f),t=!0},p(u,f){const a={};e.$set(a)},i(u){t||(oe(e.$$.fragment,u),t=!0)},o(u){ue(e.$$.fragment,u),t=!1},d(u){Fe(e,u)}}}function QP(r){let e,t;return e=new ri({props:{data:r[0],$$slots:{default:[YP]},$$scope:{ctx:r}}}),{c(){Oe(e.$$.fragment)},m(n,l){Be(e,n,l),t=!0},p(n,[l]){const u={};l&1&&(u.data=n[0]),l&1024&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(oe(e.$$.fragment,n),t=!0)},o(n){ue(e.$$.fragment,n),t=!1},d(n){Fe(e,n)}}}let e6=50,t6=100,r6=.01;function n6(r,e,t){let{paths:n}=e,l=_(),u=x(),f=S(),a=setInterval(C,t6);ni(()=>clearInterval(a));function _(){return n.features.map(z=>1/z.properties.directness).reduce((z,R)=>z+R,0)}function x(){return n.features.length==0?[]:Array.from({length:e6},k)}function k(){let z=Math.random()*l,R=0;for(let[D,P]of n.features.entries())if(R+=1/P.properties.directness,z<R)return{idx:D,distance:0};throw new Error(`didnt pick dot, totalDirectness is ${l}`)}function S(){return{type:"FeatureCollection",features:u.map(({idx:z,distance:R})=>JP(n.features[z],R,{units:"kilometers"}))}}function C(){for(let[z,R]of u.entries())R.distance+=r6,R.distance>=n.features[R.idx].properties.length_meters/1e3&&(u[z]=k());t(0,f=S())}return r.$$set=z=>{"paths"in z&&t(1,n=z.paths)},r.$$.update=()=>{r.$$.dirty&2&&n&&(l=_(),u=x())},[f,n]}class i6 extends Zt{constructor(e){super(),Wt(this,e,n6,QP,Vt,{paths:1})}}function o6(r){let e;return{c(){e=tt("Choose project")},m(t,n){me(t,e,n)},d(t){t&&pe(e)}}}function s6(r){let e;return{c(){e=tt("Pick neighbourhood")},m(t,n){me(t,e,n)},d(t){t&&pe(e)}}}function a6(r){let e;return{c(){e=ce("p"),e.textContent=`Now that you've defined a neighbourhood boundary, you can see the
              possible shortcuts that vehicles are currently able to take
              through it. You can add a new modal filter to try and solve this.
              The colored "cell" areas show what's reachable for drivers without
              leaving the boundary you've drawn.`},m(t,n){me(t,e,n)},p:It,d(t){t&&pe(e)}}}function l6(r){let e;return{c(){e=tt("View shortcuts")},m(t,n){me(t,e,n)},d(t){t&&pe(e)}}}function c6(r){let e;return{c(){e=tt("Route")},m(t,n){me(t,e,n)},d(t){t&&pe(e)}}}function u6(r){let e;return{c(){e=tt("Impact routing to one destination")},m(t,n){me(t,e,n)},d(t){t&&pe(e)}}}function h6(r){let e;return{c(){e=tt("Change this boundary")},m(t,n){me(t,e,n)},d(t){t&&pe(e)}}}function f6(r){let e;return{c(){e=tt("Debug")},m(t,n){me(t,e,n)},d(t){t&&pe(e)}}}function d6(r){let e,t,n,l,u,f,a,_,x,k,S,C,z,R,D,P,B,N,V,U,te,le,H,J,ye,ze,ne,be,He,Ce;return u=new Pr({props:{$$slots:{default:[o6]},$$scope:{ctx:r}}}),u.$on("click",r[28]),_=new Pr({props:{$$slots:{default:[s6]},$$scope:{ctx:r}}}),_.$on("click",r[29]),C=new Vg({props:{$$slots:{default:[a6]},$$scope:{ctx:r}}}),B=new Pr({props:{$$slots:{default:[l6]},$$scope:{ctx:r}}}),B.$on("click",r[30]),U=new Pr({props:{$$slots:{default:[c6]},$$scope:{ctx:r}}}),U.$on("click",r[31]),H=new Pr({props:{$$slots:{default:[u6]},$$scope:{ctx:r}}}),H.$on("click",r[32]),ze=new Pr({props:{$$slots:{default:[h6]},$$scope:{ctx:r}}}),ze.$on("click",r[33]),He=new Pr({props:{$$slots:{default:[f6]},$$scope:{ctx:r}}}),He.$on("click",r[34]),{c(){e=ce("div"),t=ce("nav"),n=ce("ul"),l=ce("li"),Oe(u.$$.fragment),f=Ue(),a=ce("li"),Oe(_.$$.fragment),x=Ue(),k=ce("li"),S=tt(`Editing
          `),Oe(C.$$.fragment),z=Ue(),R=ce("nav"),D=ce("ul"),P=ce("li"),Oe(B.$$.fragment),N=Ue(),V=ce("li"),Oe(U.$$.fragment),te=Ue(),le=ce("li"),Oe(H.$$.fragment),J=Ue(),ye=ce("li"),Oe(ze.$$.fragment),ne=Ue(),be=ce("li"),Oe(He.$$.fragment),Te(t,"aria-label","breadcrumb"),Te(e,"slot","top"),pn(e,"display","flex"),pn(e,"justify-content","space-between")},m(Qe,_t){me(Qe,e,_t),re(e,t),re(t,n),re(n,l),Be(u,l,null),re(n,f),re(n,a),Be(_,a,null),re(n,x),re(n,k),re(k,S),Be(C,k,null),re(e,z),re(e,R),re(R,D),re(D,P),Be(B,P,null),re(D,N),re(D,V),Be(U,V,null),re(D,te),re(D,le),Be(H,le,null),re(D,J),re(D,ye),Be(ze,ye,null),re(D,ne),re(D,be),Be(He,be,null),Ce=!0},p(Qe,_t){const Ut={};_t[1]&128&&(Ut.$$scope={dirty:_t,ctx:Qe}),u.$set(Ut);const Je={};_t[1]&128&&(Je.$$scope={dirty:_t,ctx:Qe}),_.$set(Je);const Yt={};_t[1]&128&&(Yt.$$scope={dirty:_t,ctx:Qe}),C.$set(Yt);const Kt={};_t[1]&128&&(Kt.$$scope={dirty:_t,ctx:Qe}),B.$set(Kt);const Ft={};_t[1]&128&&(Ft.$$scope={dirty:_t,ctx:Qe}),U.$set(Ft);const Ot={};_t[1]&128&&(Ot.$$scope={dirty:_t,ctx:Qe}),H.$set(Ot);const Jt={};_t[1]&128&&(Jt.$$scope={dirty:_t,ctx:Qe}),ze.$set(Jt);const Et={};_t[1]&128&&(Et.$$scope={dirty:_t,ctx:Qe}),He.$set(Et)},i(Qe){Ce||(oe(u.$$.fragment,Qe),oe(_.$$.fragment,Qe),oe(C.$$.fragment,Qe),oe(B.$$.fragment,Qe),oe(U.$$.fragment,Qe),oe(H.$$.fragment,Qe),oe(ze.$$.fragment,Qe),oe(He.$$.fragment,Qe),Ce=!0)},o(Qe){ue(u.$$.fragment,Qe),ue(_.$$.fragment,Qe),ue(C.$$.fragment,Qe),ue(B.$$.fragment,Qe),ue(U.$$.fragment,Qe),ue(H.$$.fragment,Qe),ue(ze.$$.fragment,Qe),ue(He.$$.fragment,Qe),Ce=!1},d(Qe){Qe&&pe(e),Fe(u),Fe(_),Fe(C),Fe(B),Fe(U),Fe(H),Fe(ze),Fe(He)}}}function Zv(r){let e;return{c(){e=ce("mark"),e.textContent=`Some parts of the neighbourhood aren't reachable by drivers, shown in
        red`},m(t,n){me(t,e,n)},d(t){t&&pe(e)}}}function p6(r){let e,t,n;return{c(){e=tt("Undo ("),t=tt(r[4]),n=tt(")")},m(l,u){me(l,e,u),me(l,t,u),me(l,n,u)},p(l,u){u[0]&16&&Ar(t,l[4])},d(l){l&&(pe(e),pe(t),pe(n))}}}function m6(r){let e;return{c(){e=tt("Undo")},m(t,n){me(t,e,n)},p:It,d(t){t&&pe(e)}}}function g6(r){let e,t,n;return{c(){e=tt("Redo ("),t=tt(r[5]),n=tt(")")},m(l,u){me(l,e,u),me(l,t,u),me(l,n,u)},p(l,u){u[0]&32&&Ar(t,l[5])},d(l){l&&(pe(e),pe(t),pe(n))}}}function _6(r){let e;return{c(){e=tt("Redo")},m(t,n){me(t,e,n)},p:It,d(t){t&&pe(e)}}}function Hv(r){let e,t;return e=new TC({}),e.$on("close",r[27]),{c(){Oe(e.$$.fragment)},m(n,l){Be(e,n,l),t=!0},p:It,i(n){t||(oe(e.$$.fragment,n),t=!0)},o(n){ue(e.$$.fragment,n),t=!1},d(n){Fe(e,n)}}}function y6(r){let e,t,n,l,u=rn(r[6]).properties.name+"",f,a,_=r[1].area_km2.toFixed(1)+"",x,k,S,C,z,R,D,P,B,N,V,U,te,le,H,J,ye,ze,ne,be,He,Ce,Qe,_t,Ut,Je,Yt,Kt,Ft,Ot,Jt,Et,sr,zt,rr,wr,gr,Br,ht,Mt=r[8]>0&&Zv();function De(We,wt){return We[4]==0?m6:p6}let ut=De(r),it=ut(r);function xt(We,wt){return We[5]==0?_6:g6}let ie=xt(r),nr=ie(r),Ne=r[3]&&Hv(r);return{c(){e=ce("div"),t=ce("p"),n=tt("Editing neighbourhood "),l=ce("u"),f=tt(u),a=tt(`
      , with an area of `),x=tt(_),k=tt(" km"),S=Ue(),Mt&&Mt.c(),C=Ue(),z=ce("div"),R=ce("button"),D=ce("img"),B=tt(`
        Add a modal filter`),V=Ue(),U=ce("button"),te=tt("Add many modal filters along line"),H=Ue(),J=ce("button"),ye=tt("Reverse directions"),ne=Ue(),be=ce("button"),be.textContent="Change modal filter type",He=Ue(),Ce=ce("label"),Qe=ce("input"),_t=tt(`
      Animate shortcuts`),Ut=Ue(),Je=ce("label"),Yt=ce("input"),Kt=tt(`
      Include perimeter roads`),Ft=Ue(),Ot=ce("div"),Jt=ce("button"),it.c(),sr=Ue(),zt=ce("button"),nr.c(),wr=Ue(),Ne&&Ne.c(),Mn(D.src,P=`/ltn//filters/${r[9]}_icon.gif`)||Te(D,"src",P),Te(D,"width","30"),Te(D,"alt","Add a modal filter"),R.disabled=N=r[0]=="filter",Te(R,"data-tooltip","hotkey 1"),U.disabled=le=r[0]=="freehand-filters",Te(U,"data-tooltip","hotkey 2"),J.disabled=ze=r[0]=="oneway",Te(J,"data-tooltip","hotkey 3"),pn(z,"display","flex"),pn(z,"justify-content","space-between"),Te(Qe,"type","checkbox"),Te(Yt,"type","checkbox"),Jt.disabled=Et=r[4]==0,Te(Jt,"data-tooltip","Ctrl+Z"),zt.disabled=rr=r[5]==0,Te(zt,"data-tooltip","Ctrl+Y"),pn(Ot,"display","flex"),pn(Ot,"justify-content","space-between"),Te(e,"slot","sidebar")},m(We,wt){me(We,e,wt),re(e,t),re(t,n),re(t,l),re(l,f),re(t,a),re(t,x),re(t,k),re(e,S),Mt&&Mt.m(e,null),re(e,C),re(e,z),re(z,R),re(R,D),re(R,B),re(z,V),re(z,U),re(U,te),re(z,H),re(z,J),re(J,ye),re(e,ne),re(e,be),re(e,He),re(e,Ce),re(Ce,Qe),Qe.checked=r[11],re(Ce,_t),re(e,Ut),re(e,Je),re(Je,Yt),Yt.checked=r[10],re(Je,Kt),re(e,Ft),re(e,Ot),re(Ot,Jt),it.m(Jt,null),re(Ot,sr),re(Ot,zt),nr.m(zt,null),re(e,wr),Ne&&Ne.m(e,null),gr=!0,Br||(ht=[Ct(R,"click",r[21]),Ct(U,"click",r[22]),Ct(J,"click",r[23]),Ct(be,"click",r[24]),Ct(Qe,"change",r[25]),Ct(Yt,"change",r[26]),Ct(Yt,"change",r[13]),Ct(Jt,"click",r[17]),Ct(zt,"click",r[18])],Br=!0)},p(We,wt){(!gr||wt[0]&64)&&u!==(u=rn(We[6]).properties.name+"")&&Ar(f,u),(!gr||wt[0]&2)&&_!==(_=We[1].area_km2.toFixed(1)+"")&&Ar(x,_),We[8]>0?Mt||(Mt=Zv(),Mt.c(),Mt.m(e,C)):Mt&&(Mt.d(1),Mt=null),(!gr||wt[0]&512&&!Mn(D.src,P=`/ltn//filters/${We[9]}_icon.gif`))&&Te(D,"src",P),(!gr||wt[0]&1&&N!==(N=We[0]=="filter"))&&(R.disabled=N),(!gr||wt[0]&1&&le!==(le=We[0]=="freehand-filters"))&&(U.disabled=le),(!gr||wt[0]&1&&ze!==(ze=We[0]=="oneway"))&&(J.disabled=ze),wt[0]&2048&&(Qe.checked=We[11]),wt[0]&1024&&(Yt.checked=We[10]),ut===(ut=De(We))&&it?it.p(We,wt):(it.d(1),it=ut(We),it&&(it.c(),it.m(Jt,null))),(!gr||wt[0]&16&&Et!==(Et=We[4]==0))&&(Jt.disabled=Et),ie===(ie=xt(We))&&nr?nr.p(We,wt):(nr.d(1),nr=ie(We),nr&&(nr.c(),nr.m(zt,null))),(!gr||wt[0]&32&&rr!==(rr=We[5]==0))&&(zt.disabled=rr),We[3]?Ne?(Ne.p(We,wt),wt[0]&8&&oe(Ne,1)):(Ne=Hv(We),Ne.c(),oe(Ne,1),Ne.m(e,null)):Ne&&(vr(),ue(Ne,1,1,()=>{Ne=null}),br())},i(We){gr||(oe(Ne),gr=!0)},o(We){ue(Ne),gr=!1},d(We){We&&pe(e),Mt&&Mt.d(),it.d(),nr.d(),Ne&&Ne.d(),Br=!1,yn(ht)}}}function v6(r){let e;return{c(){e=ce("p"),e.textContent="Click to change direction"},m(t,n){me(t,e,n)},p:It,d(t){t&&pe(e)}}}function b6(r){let e,t,n,l;return{c(){e=ce("div"),t=ce("img"),l=tt(`
              Click to add modal filter`),Mn(t.src,n=`/ltn//filters/${r[9]}_icon.gif`)||Te(t,"src",n),Te(t,"width","20"),Te(t,"alt","Add modal filter")},m(u,f){me(u,e,f),re(e,t),re(e,l)},p(u,f){f[0]&512&&!Mn(t.src,n=`/ltn//filters/${u[9]}_icon.gif`)&&Te(t,"src",n)},d(u){u&&pe(e)}}}function w6(r){let e,t=r[37].shortcuts+"",n,l,u=(r[37].name??"unnamed road")+"",f,a,_;function x(C,z){return C[0]=="filter"?b6:v6}let k=x(r),S=k(r);return{c(){e=ce("p"),n=tt(t),l=tt(" shortcuts through "),f=tt(u),a=Ue(),S.c(),_=Hn()},m(C,z){me(C,e,z),re(e,n),re(e,l),re(e,f),me(C,a,z),S.m(C,z),me(C,_,z)},p(C,z){z[1]&64&&t!==(t=C[37].shortcuts+"")&&Ar(n,t),z[1]&64&&u!==(u=(C[37].name??"unnamed road")+"")&&Ar(f,u),k===(k=x(C))&&S?S.p(C,z):(S.d(1),S=k(C),S&&(S.c(),S.m(_.parentNode,_)))},d(C){C&&(pe(e),pe(a),pe(_)),S.d(C)}}}function x6(r){let e,t,n;return t=new fs({props:{openOn:"hover",$$slots:{default:[w6,({props:l})=>({37:l}),({props:l})=>[0,l?64:0]]},$$scope:{ctx:r}}}),{c(){e=ce("div"),Oe(t.$$.fragment),Te(e,"slot","line-popup")},m(l,u){me(l,e,u),Be(t,e,null),n=!0},p(l,u){const f={};u[0]&513|u[1]&192&&(f.$$scope={dirty:u,ctx:l}),t.$set(f)},i(l){n||(oe(t.$$.fragment,l),n=!0)},o(l){ue(t.$$.fragment,l),n=!1},d(l){l&&pe(e),Fe(t)}}}function Xv(r){let e,t;return e=new i6({props:{paths:r[7]}}),{c(){Oe(e.$$.fragment)},m(n,l){Be(e,n,l),t=!0},p(n,l){const u={};l[0]&128&&(u.paths=n[7]),e.$set(u)},i(n){t||(oe(e.$$.fragment,n),t=!0)},o(n){ue(e.$$.fragment,n),t=!1},d(n){Fe(e,n)}}}function S6(r){let e;return{c(){e=tt("Click to delete")},m(t,n){me(t,e,n)},d(t){t&&pe(e)}}}function k6(r){let e,t;return e=new fs({props:{openOn:"hover",$$slots:{default:[S6]},$$scope:{ctx:r}}}),{c(){Oe(e.$$.fragment)},m(n,l){Be(e,n,l),t=!0},p(n,l){const u={};l[1]&128&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(oe(e.$$.fragment,n),t=!0)},o(n){ue(e.$$.fragment,n),t=!1},d(n){Fe(e,n)}}}function Kv(r){let e,t;return e=new IC({props:{map:rn(r[2])}}),e.$on("done",r[19]),{c(){Oe(e.$$.fragment)},m(n,l){Be(e,n,l),t=!0},p(n,l){const u={};l[0]&4&&(u.map=rn(n[2])),e.$set(u)},i(n){t||(oe(e.$$.fragment,n),t=!0)},o(n){ue(e.$$.fragment,n),t=!1},d(n){Fe(e,n)}}}function T6(r){let e,t,n,l,u,f,a;t=new Gd({props:{gjInput:r[1],interactive:r[0]=="filter"||r[0]=="oneway",onClickLine:r[14],$$slots:{"line-popup":[x6]},$$scope:{ctx:r}}});let _=r[11]&&Xv(r);u=new zh({props:{$$slots:{default:[k6]},$$scope:{ctx:r}}}),u.$on("click",r[15]);let x=r[0]=="freehand-filters"&&Kv(r);return{c(){e=ce("div"),Oe(t.$$.fragment),n=Ue(),_&&_.c(),l=Ue(),Oe(u.$$.fragment),f=Ue(),x&&x.c(),Te(e,"slot","map")},m(k,S){me(k,e,S),Be(t,e,null),re(e,n),_&&_.m(e,null),re(e,l),Be(u,e,null),re(e,f),x&&x.m(e,null),a=!0},p(k,S){const C={};S[0]&2&&(C.gjInput=k[1]),S[0]&1&&(C.interactive=k[0]=="filter"||k[0]=="oneway"),S[0]&513|S[1]&128&&(C.$$scope={dirty:S,ctx:k}),t.$set(C),k[11]?_?(_.p(k,S),S[0]&2048&&oe(_,1)):(_=Xv(k),_.c(),oe(_,1),_.m(e,l)):_&&(vr(),ue(_,1,1,()=>{_=null}),br());const z={};S[1]&128&&(z.$$scope={dirty:S,ctx:k}),u.$set(z),k[0]=="freehand-filters"?x?(x.p(k,S),S[0]&1&&oe(x,1)):(x=Kv(k),x.c(),oe(x,1),x.m(e,null)):x&&(vr(),ue(x,1,1,()=>{x=null}),br())},i(k){a||(oe(t.$$.fragment,k),oe(_),oe(u.$$.fragment,k),oe(x),a=!0)},o(k){ue(t.$$.fragment,k),ue(_),ue(u.$$.fragment,k),ue(x),a=!1},d(k){k&&pe(e),Fe(t),_&&_.d(),Fe(u),x&&x.d()}}}function E6(r){let e,t,n,l;return e=new hs({props:{$$slots:{map:[T6],sidebar:[y6],top:[d6]},$$scope:{ctx:r}}}),{c(){Oe(e.$$.fragment)},m(u,f){Be(e,u,f),t=!0,n||(l=Ct(window,"keydown",r[16]),n=!0)},p(u,f){const a={};f[0]&8191|f[1]&128&&(a.$$scope={dirty:f,ctx:u}),e.$set(a)},i(u){t||(oe(e.$$.fragment,u),t=!0)},o(u){ue(e.$$.fragment,u),t=!1},d(u){Fe(e,u),n=!1,l()}}}function C6(r,e,t){let n,l,u,f,a,_,x,k;pt(r,Ls,Et=>t(20,l=Et)),pt(r,Vm,Et=>t(9,u=Et)),pt(r,Yn,Et=>t(35,f=Et)),pt(r,_h,Et=>t(10,a=Et)),pt(r,cs,Et=>t(2,_=Et)),pt(r,Xy,Et=>t(11,x=Et)),pt(r,or,Et=>t(12,k=Et));let S="filter",C=!1,z=0,R=0,D,P,B=JSON.parse(f.getAllShortcuts());ni(()=>{_.doubleClickZoom.enable()});function N(Et){t(1,P=JSON.parse(f.renderNeighbourhood())),t(6,D=P.features.find(sr=>sr.properties.kind=="boundary")),t(4,z=P.undo_length),t(5,R=P.redo_length),t(7,B=JSON.parse(f.getAllShortcuts())),Tc()}function V(){f.setCurrentNeighbourhood(D.properties.name,a),Lt(Ls,l++,l)}function U(Et,sr){S=="filter"?(f.addModalFilter(sr,u),Lt(Ls,l++,l)):S=="oneway"&&(f.toggleDirection(Et.properties.road),Lt(Ls,l++,l))}function te(Et){let sr=Et.detail.features[0];f.deleteModalFilter(sr.properties.road),Lt(Ls,l++,l)}function le(Et){Et.target.tagName!="INPUT"&&(Et.ctrlKey&&Et.key=="z"&&H(),Et.ctrlKey&&Et.key=="y"&&J(),Et.key=="1"&&t(0,S="filter"),Et.key=="2"&&t(0,S="freehand-filters"),Et.key=="3"&&t(0,S="oneway"))}function H(){f.undo(),Lt(Ls,l++,l)}function J(){f.redo(),Lt(Ls,l++,l)}function ye(Et){let sr=Et.detail;sr&&(f.addManyModalFilters(sr,u),Lt(Ls,l++,l)),t(0,S="filter")}const ze=()=>t(0,S="filter"),ne=()=>t(0,S="freehand-filters"),be=()=>t(0,S="oneway"),He=()=>t(3,C=!0);function Ce(){x=this.checked,Xy.set(x)}function Qe(){a=this.checked,_h.set(a)}const _t=()=>t(3,C=!1),Ut=()=>Lt(or,k={mode:"title"},k),Je=()=>Lt(or,k={mode:"network"},k),Yt=()=>Lt(or,k={mode:"view-shortcuts"},k),Kt=()=>Lt(or,k={mode:"route",prevMode:"neighbourhood"},k),Ft=()=>Lt(or,k={mode:"impact-one-destination"},k),Ot=()=>Lt(or,k={mode:"set-boundary",name:rn(D).properties.name,existing:D},k),Jt=()=>Lt(or,k={mode:"debug"},k);return r.$$.update=()=>{r.$$.dirty[0]&5&&(S=="oneway"?_.doubleClickZoom.disable():_.doubleClickZoom.enable()),r.$$.dirty[0]&1048576&&N(),r.$$.dirty[0]&2&&t(8,n=P.features.filter(Et=>Et.properties.kind=="cell"&&Et.properties.cell_color=="disconnected").length)},[S,P,_,C,z,R,D,B,n,u,a,x,k,V,U,te,le,H,J,ye,l,ze,ne,be,He,Ce,Qe,_t,Ut,Je,Yt,Kt,Ft,Ot,Jt]}class M6 extends Zt{constructor(e){super(),Wt(this,e,C6,E6,Vt,{},null,[-1,-1])}}const Bx="/ltn/assets/delete-ec75e756.svg",Fx="/ltn/assets/edit-f3f51206.svg";function wg(r,e,t){let n=new Set(JSON.parse(r.toSavefile()).features.filter(l=>l.properties.kind=="boundary").map(l=>l.properties.name));for(;;){let l=window.prompt(e,t);if(!l)return null;if(n.has(l))window.alert(`There is already a neighbourhood called ${l}; please pick another name`);else return l}}function Jv(r,e,t){const n=r.slice();return n[20]=e[t],n}function I6(r){let e;return{c(){e=tt("Choose project")},m(t,n){me(t,e,n)},d(t){t&&pe(e)}}}function A6(r){let e;return{c(){e=ce("p"),e.textContent=`Inside the neighbourhood you define, the goal is to eliminate (or
              deliberately permit) through-traffic. An appropriate neighbourhood
              boundary depends on many factors. The simplest approach is to find
              the area bounded on all sides by "main" roads, which are designed
              for higher traffic volumes. There are many other considerations,
              though -- maybe severances like rivers or rail should be part of a
              boundary. Bridges and tunnels near a boundary may be confusing as
              well. And note that your boundary may not match the conventional
              definition of "neighbourhood."`},m(t,n){me(t,e,n)},p:It,d(t){t&&pe(e)}}}function L6(r){let e;return{c(){e=tt("Route")},m(t,n){me(t,e,n)},d(t){t&&pe(e)}}}function P6(r){let e,t,n,l,u,f,a,_,x,k,S,C,z,R,D;return u=new Pr({props:{$$slots:{default:[I6]},$$scope:{ctx:r}}}),u.$on("click",r[16]),x=new Vg({props:{$$slots:{default:[A6]},$$scope:{ctx:r}}}),R=new Pr({props:{$$slots:{default:[L6]},$$scope:{ctx:r}}}),R.$on("click",r[17]),{c(){e=ce("div"),t=ce("nav"),n=ce("ul"),l=ce("li"),Oe(u.$$.fragment),f=Ue(),a=ce("li"),_=tt(`Pick neighbourhood
          `),Oe(x.$$.fragment),k=Ue(),S=ce("nav"),C=ce("ul"),z=ce("li"),Oe(R.$$.fragment),Te(t,"aria-label","breadcrumb"),Te(e,"slot","top"),pn(e,"display","flex"),pn(e,"justify-content","space-between")},m(P,B){me(P,e,B),re(e,t),re(t,n),re(n,l),Be(u,l,null),re(n,f),re(n,a),re(a,_),Be(x,a,null),re(e,k),re(e,S),re(S,C),re(C,z),Be(R,z,null),D=!0},p(P,B){const N={};B&8388608&&(N.$$scope={dirty:B,ctx:P}),u.$set(N);const V={};B&8388608&&(V.$$scope={dirty:B,ctx:P}),x.$set(V);const U={};B&8388608&&(U.$$scope={dirty:B,ctx:P}),R.$set(U)},i(P){D||(oe(u.$$.fragment,P),oe(x.$$.fragment,P),oe(R.$$.fragment,P),D=!0)},o(P){ue(u.$$.fragment,P),ue(x.$$.fragment,P),ue(R.$$.fragment,P),D=!1},d(P){P&&pe(e),Fe(u),Fe(x),Fe(R)}}}function z6(r){let e;return{c(){e=tt("Draw a new boundary")},m(t,n){me(t,e,n)},d(t){t&&pe(e)}}}function D6(r){let e;return{c(){e=tt("Use an auto-generated boundary")},m(t,n){me(t,e,n)},d(t){t&&pe(e)}}}function R6(r){let e=r[20]+"",t;return{c(){t=tt(e)},m(n,l){me(n,t,l)},p(n,l){l&2&&e!==(e=n[20]+"")&&Ar(t,e)},d(n){n&&pe(t)}}}function Yv(r){let e,t,n,l,u,f,a,_,x,k,S;function C(){return r[13](r[20])}n=new Pr({props:{$$slots:{default:[R6]},$$scope:{ctx:r}}}),n.$on("click",C);function z(){return r[14](r[20])}function R(){return r[15](r[20])}return{c(){e=ce("li"),t=ce("span"),Oe(n.$$.fragment),l=Ue(),u=ce("button"),u.innerHTML=`<img src="${Fx}" alt="Rename neighbourhood"/>`,f=Ue(),a=ce("button"),a.innerHTML=`<img src="${Bx}" alt="Delete neighbourhood"/>`,_=Ue(),Te(u,"class","secondary"),Te(a,"class","secondary"),pn(t,"display","flex"),pn(t,"justify-content","space-between")},m(D,P){me(D,e,P),re(e,t),Be(n,t,null),re(t,l),re(t,u),re(t,f),re(t,a),re(e,_),x=!0,k||(S=[Ct(u,"click",z),Ct(a,"click",R)],k=!0)},p(D,P){r=D;const B={};P&8388610&&(B.$$scope={dirty:P,ctx:r}),n.$set(B)},i(D){x||(oe(n.$$.fragment,D),x=!0)},o(D){ue(n.$$.fragment,D),x=!1},d(D){D&&pe(e),Fe(n),k=!1,yn(S)}}}function B6(r){let e,t,n,l,u,f,a,_,x,k,S,C,z,R,D,P,B,N,V,U,te;n=new Pr({props:{$$slots:{default:[z6]},$$scope:{ctx:r}}}),n.$on("click",r[7]),f=new Pr({props:{$$slots:{default:[D6]},$$scope:{ctx:r}}}),f.$on("click",r[12]);let le=Jn(r[1]),H=[];for(let ye=0;ye<le.length;ye+=1)H[ye]=Yv(Jv(r,le,ye));const J=ye=>ue(H[ye],1,1,()=>{H[ye]=null});return{c(){e=ce("div"),t=ce("div"),Oe(n.$$.fragment),l=Ue(),u=ce("div"),Oe(f.$$.fragment),a=Ue(),_=ce("ul");for(let ye=0;ye<H.length;ye+=1)H[ye].c();x=Ue(),k=ce("hr"),S=Ue(),C=ce("p"),z=tt("Current project: "),R=tt(r[2]),D=Ue(),P=ce("button"),P.textContent="Export project to GeoJSON",B=Ue(),N=ce("button"),N.textContent="Debug route-snapper",Te(N,"class","secondary"),Te(e,"slot","sidebar")},m(ye,ze){me(ye,e,ze),re(e,t),Be(n,t,null),re(e,l),re(e,u),Be(f,u,null),re(e,a),re(e,_);for(let ne=0;ne<H.length;ne+=1)H[ne]&&H[ne].m(_,null);re(e,x),re(e,k),re(e,S),re(e,C),re(C,z),re(C,R),re(e,D),re(e,P),re(e,B),re(e,N),V=!0,U||(te=[Ct(P,"click",r[8]),Ct(N,"click",r[9])],U=!0)},p(ye,ze){const ne={};ze&8388608&&(ne.$$scope={dirty:ze,ctx:ye}),n.$set(ne);const be={};if(ze&8388608&&(be.$$scope={dirty:ze,ctx:ye}),f.$set(be),ze&114){le=Jn(ye[1]);let He;for(He=0;He<le.length;He+=1){const Ce=Jv(ye,le,He);H[He]?(H[He].p(Ce,ze),oe(H[He],1)):(H[He]=Yv(Ce),H[He].c(),oe(H[He],1),H[He].m(_,null))}for(vr(),He=le.length;He<H.length;He+=1)J(He);br()}(!V||ze&4)&&Ar(R,ye[2])},i(ye){if(!V){oe(n.$$.fragment,ye),oe(f.$$.fragment,ye);for(let ze=0;ze<le.length;ze+=1)oe(H[ze]);V=!0}},o(ye){ue(n.$$.fragment,ye),ue(f.$$.fragment,ye),H=H.filter(Boolean);for(let ze=0;ze<H.length;ze+=1)ue(H[ze]);V=!1},d(ye){ye&&pe(e),Fe(n),Fe(f),Bs(H,ye),U=!1,yn(te)}}}function F6(r){let e,t=r[19].name+"",n;return{c(){e=ce("p"),n=tt(t)},m(l,u){me(l,e,u),re(e,n)},p(l,u){u&524288&&t!==(t=l[19].name+"")&&Ar(n,t)},d(l){l&&pe(e)}}}function O6(r){let e,t;return e=new fs({props:{openOn:"hover",$$slots:{default:[F6,({props:n})=>({19:n}),({props:n})=>n?524288:0]},$$scope:{ctx:r}}}),{c(){Oe(e.$$.fragment)},m(n,l){Be(e,n,l),t=!0},p(n,l){const u={};l&8912896&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(oe(e.$$.fragment,n),t=!0)},o(n){ue(e.$$.fragment,n),t=!1},d(n){Fe(e,n)}}}function N6(r){let e,t;const n=[bn("neighbourhood-boundaries",!1),{filter:["==",["get","kind"],"boundary"]},{paint:{"fill-color":"red","fill-opacity":nl(.3,.5)}},{manageHoverState:!0},{hoverCursor:"pointer"}];let l={$$slots:{default:[O6]},$$scope:{ctx:r}};for(let u=0;u<n.length;u+=1)l=mn(l,n[u]);return e=new Ns({props:l}),e.$on("click",r[11]),{c(){Oe(e.$$.fragment)},m(u,f){Be(e,u,f),t=!0},p(u,f){const a={};f&8388608&&(a.$$scope={dirty:f,ctx:u}),e.$set(a)},i(u){t||(oe(e.$$.fragment,u),t=!0)},o(u){ue(e.$$.fragment,u),t=!1},d(u){Fe(e,u)}}}function j6(r){let e,t,n,l,u;return t=new ri({props:{data:r[0],generateId:!0,$$slots:{default:[N6]},$$scope:{ctx:r}}}),l=new zh({}),{c(){e=ce("div"),Oe(t.$$.fragment),n=Ue(),Oe(l.$$.fragment),Te(e,"slot","map")},m(f,a){me(f,e,a),Be(t,e,null),re(e,n),Be(l,e,null),u=!0},p(f,a){const _={};a&1&&(_.data=f[0]),a&8388608&&(_.$$scope={dirty:a,ctx:f}),t.$set(_)},i(f){u||(oe(t.$$.fragment,f),oe(l.$$.fragment,f),u=!0)},o(f){ue(t.$$.fragment,f),ue(l.$$.fragment,f),u=!1},d(f){f&&pe(e),Fe(t),Fe(l)}}}function U6(r){let e,t;return e=new hs({props:{$$slots:{map:[j6],sidebar:[B6],top:[P6]},$$scope:{ctx:r}}}),{c(){Oe(e.$$.fragment)},m(n,l){Be(e,n,l),t=!0},p(n,[l]){const u={};l&8388623&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(oe(e.$$.fragment,n),t=!0)},o(n){ue(e.$$.fragment,n),t=!1},d(n){Fe(e,n)}}}function V6(r,e,t){let n,l,u,f,a,_;pt(r,Yn,le=>t(10,u=le)),pt(r,fa,le=>t(2,f=le)),pt(r,or,le=>t(3,a=le)),pt(r,_h,le=>t(18,_=le));function x(le){u.setCurrentNeighbourhood(le,_),Lt(or,a={mode:"neighbourhood"},a)}function k(le){window.confirm(`Really delete neighbourhood ${le}? You can't undo this.`)&&(u.deleteNeighbourhoodBoundary(le),Tc(),t(0,n=JSON.parse(u.toSavefile())))}function S(le){let H=wg(u,`Rename neighbourhood ${le} to what?`,le);H&&(u.renameNeighbourhoodBoundary(le,H),Tc(),t(0,n=JSON.parse(u.toSavefile())))}function C(){let le=wg(u,"What do you want to name the neighbourhood?","");le&&Lt(or,a={mode:"set-boundary",name:le,existing:null},a)}function z(){md(f+".geojson",u.toSavefile())}function R(){md("debug_route_snapper.geojson",u.toRouteSnapperGj())}const D=le=>x(rn(le.detail.features[0].properties).name),P=()=>Lt(or,a={mode:"auto-boundaries"},a),B=le=>x(le),N=le=>S(le),V=le=>k(le),U=()=>Lt(or,a={mode:"title"},a),te=()=>Lt(or,a={mode:"route",prevMode:"network"},a);return r.$$.update=()=>{r.$$.dirty&1024&&t(0,n=JSON.parse(u.toSavefile())),r.$$.dirty&1&&t(1,l=n.features.filter(le=>le.properties.kind=="boundary").map(le=>le.properties.name))},[n,l,f,a,x,k,S,C,z,R,u,D,P,B,N,V,U,te]}class $6 extends Zt{constructor(e){super(),Wt(this,e,V6,U6,Vt,{})}}function q6(r){let e;return{c(){e=tt("Choose project")},m(t,n){me(t,e,n)},d(t){t&&pe(e)}}}function G6(r){let e;return{c(){e=tt("Pick neighbourhood")},m(t,n){me(t,e,n)},d(t){t&&pe(e)}}}function Qv(r){let e,t,n;return t=new Pr({props:{$$slots:{default:[W6]},$$scope:{ctx:r}}}),t.$on("click",r[13]),{c(){e=ce("li"),Oe(t.$$.fragment)},m(l,u){me(l,e,u),Be(t,e,null),n=!0},p(l,u){const f={};u&16384&&(f.$$scope={dirty:u,ctx:l}),t.$set(f)},i(l){n||(oe(t.$$.fragment,l),n=!0)},o(l){ue(t.$$.fragment,l),n=!1},d(l){l&&pe(e),Fe(t)}}}function W6(r){let e;return{c(){e=tt("Editing")},m(t,n){me(t,e,n)},d(t){t&&pe(e)}}}function Z6(r){let e,t,n,l,u,f,a,_,x,k,S,C;u=new Pr({props:{$$slots:{default:[q6]},$$scope:{ctx:r}}}),u.$on("click",r[11]),_=new Pr({props:{$$slots:{default:[G6]},$$scope:{ctx:r}}}),_.$on("click",r[12]);let z=r[0]=="neighbourhood"&&Qv(r);return{c(){e=ce("div"),t=ce("nav"),n=ce("ul"),l=ce("li"),Oe(u.$$.fragment),f=Ue(),a=ce("li"),Oe(_.$$.fragment),x=Ue(),z&&z.c(),k=Ue(),S=ce("li"),S.textContent="Routing",Te(t,"aria-label","breadcrumb"),Te(e,"slot","top")},m(R,D){me(R,e,D),re(e,t),re(t,n),re(n,l),Be(u,l,null),re(n,f),re(n,a),Be(_,a,null),re(n,x),z&&z.m(n,null),re(n,k),re(n,S),C=!0},p(R,D){const P={};D&16384&&(P.$$scope={dirty:D,ctx:R}),u.$set(P);const B={};D&16384&&(B.$$scope={dirty:D,ctx:R}),_.$set(B),R[0]=="neighbourhood"?z?(z.p(R,D),D&1&&oe(z,1)):(z=Qv(R),z.c(),oe(z,1),z.m(n,k)):z&&(vr(),ue(z,1,1,()=>{z=null}),br())},i(R){C||(oe(u.$$.fragment,R),oe(_.$$.fragment,R),oe(z),C=!0)},o(R){ue(u.$$.fragment,R),ue(_.$$.fragment,R),ue(z),C=!1},d(R){R&&pe(e),Fe(u),Fe(_),z&&z.d()}}}function H6(r){let e,t,n,l,u,f,a,_,x,k,S,C,z,R,D,P,B;return t=new Ph({}),t.$on("click",r[7]),{c(){e=ce("div"),Oe(t.$$.fragment),n=Ue(),l=ce("p"),l.textContent="Drag markers for a route",u=Ue(),f=ce("p"),f.innerHTML=`<span style="color: red">Route before</span>
      ,
      <span style="color: blue">route after</span>`,a=Ue(),_=ce("label"),x=tt("Slow-down factor for main roads: "),k=tt(r[1]),S=Ue(),C=ce("input"),z=Ue(),R=ce("i"),R.textContent=`Increase to see how drivers may detour in heavy traffic. 1 means
      free-flow.`,Te(C,"type","range"),Te(C,"min","1.0"),Te(C,"max","5.0"),Te(C,"step","0.1"),Te(e,"slot","sidebar")},m(N,V){me(N,e,V),Be(t,e,null),re(e,n),re(e,l),re(e,u),re(e,f),re(e,a),re(e,_),re(_,x),re(_,k),re(_,S),re(_,C),ti(C,r[1]),re(e,z),re(e,R),D=!0,P||(B=[Ct(C,"change",r[10]),Ct(C,"input",r[10])],P=!0)},p(N,V){(!D||V&2)&&Ar(k,N[1]),V&2&&ti(C,N[1])},i(N){D||(oe(t.$$.fragment,N),D=!0)},o(N){ue(t.$$.fragment,N),D=!1},d(N){N&&pe(e),Fe(t),P=!1,yn(B)}}}function eb(r){let e,t;return e=new Gd({props:{gjInput:JSON.parse(rn(r[4]).renderNeighbourhood()),interactive:!1}}),{c(){Oe(e.$$.fragment)},m(n,l){Be(e,n,l),t=!0},p(n,l){const u={};l&16&&(u.gjInput=JSON.parse(rn(n[4]).renderNeighbourhood())),e.$set(u)},i(n){t||(oe(e.$$.fragment,n),t=!0)},o(n){ue(e.$$.fragment,n),t=!1},d(n){Fe(e,n)}}}function X6(r){let e,t;const n=[bn("compare-route"),{paint:{"line-width":10,"line-color":Tw(["get","kind"],{before:"red",after:"blue"},"red")}}];let l={};for(let u=0;u<n.length;u+=1)l=mn(l,n[u]);return e=new Ro({props:l}),{c(){Oe(e.$$.fragment)},m(u,f){Be(e,u,f),t=!0},p(u,f){const a={};e.$set(a)},i(u){t||(oe(e.$$.fragment,u),t=!0)},o(u){ue(e.$$.fragment,u),t=!1},d(u){Fe(e,u)}}}function K6(r){let e;return{c(){e=ce("span"),e.textContent="A",Te(e,"class","dot svelte-1gcxp27")},m(t,n){me(t,e,n)},p:It,d(t){t&&pe(e)}}}function J6(r){let e;return{c(){e=ce("span"),e.textContent="B",Te(e,"class","dot svelte-1gcxp27")},m(t,n){me(t,e,n)},p:It,d(t){t&&pe(e)}}}function Y6(r){let e,t,n,l,u,f,a,_,x,k,S,C,z=r[0]=="neighbourhood"&&eb(r);n=new zh({}),u=new ri({props:{data:r[5],$$slots:{default:[X6]},$$scope:{ctx:r}}});function R(N){r[8](N)}let D={draggable:!0,$$slots:{default:[K6]},$$scope:{ctx:r}};r[3]!==void 0&&(D.lngLat=r[3]),a=new yh({props:D}),nn.push(()=>no(a,"lngLat",R));function P(N){r[9](N)}let B={draggable:!0,$$slots:{default:[J6]},$$scope:{ctx:r}};return r[2]!==void 0&&(B.lngLat=r[2]),k=new yh({props:B}),nn.push(()=>no(k,"lngLat",P)),{c(){e=ce("div"),z&&z.c(),t=Ue(),Oe(n.$$.fragment),l=Ue(),Oe(u.$$.fragment),f=Ue(),Oe(a.$$.fragment),x=Ue(),Oe(k.$$.fragment),Te(e,"slot","map")},m(N,V){me(N,e,V),z&&z.m(e,null),re(e,t),Be(n,e,null),re(e,l),Be(u,e,null),re(e,f),Be(a,e,null),re(e,x),Be(k,e,null),C=!0},p(N,V){N[0]=="neighbourhood"?z?(z.p(N,V),V&1&&oe(z,1)):(z=eb(N),z.c(),oe(z,1),z.m(e,t)):z&&(vr(),ue(z,1,1,()=>{z=null}),br());const U={};V&32&&(U.data=N[5]),V&16384&&(U.$$scope={dirty:V,ctx:N}),u.$set(U);const te={};V&16384&&(te.$$scope={dirty:V,ctx:N}),!_&&V&8&&(_=!0,te.lngLat=N[3],ro(()=>_=!1)),a.$set(te);const le={};V&16384&&(le.$$scope={dirty:V,ctx:N}),!S&&V&4&&(S=!0,le.lngLat=N[2],ro(()=>S=!1)),k.$set(le)},i(N){C||(oe(z),oe(n.$$.fragment,N),oe(u.$$.fragment,N),oe(a.$$.fragment,N),oe(k.$$.fragment,N),C=!0)},o(N){ue(z),ue(n.$$.fragment,N),ue(u.$$.fragment,N),ue(a.$$.fragment,N),ue(k.$$.fragment,N),C=!1},d(N){N&&pe(e),z&&z.d(),Fe(n),Fe(u),Fe(a),Fe(k)}}}function Q6(r){let e,t;return e=new hs({props:{$$slots:{map:[Y6],sidebar:[H6],top:[Z6]},$$scope:{ctx:r}}}),{c(){Oe(e.$$.fragment)},m(n,l){Be(e,n,l),t=!0},p(n,[l]){const u={};l&16511&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(oe(e.$$.fragment,n),t=!0)},o(n){ue(e.$$.fragment,n),t=!1},d(n){Fe(e,n)}}}function ez(r,e,t){let n,l,u,f,a,_;pt(r,or,B=>t(6,l=B)),pt(r,Hy,B=>t(1,u=B)),pt(r,gh,B=>t(2,f=B)),pt(r,mh,B=>t(3,a=B)),pt(r,Yn,B=>t(4,_=B));let{prevMode:x}=e;function k(){Lt(or,l={mode:x},l)}function S(B){a=B,mh.set(a)}function C(B){f=B,gh.set(f)}function z(){u=kg(this.value),Hy.set(u)}const R=()=>Lt(or,l={mode:"title"},l),D=()=>Lt(or,l={mode:"network"},l),P=()=>Lt(or,l={mode:"neighbourhood"},l);return r.$$set=B=>{"prevMode"in B&&t(0,x=B.prevMode)},r.$$.update=()=>{r.$$.dirty&30&&t(5,n=JSON.parse(_.compareRoute(a.lng,a.lat,f.lng,f.lat,u)))},[x,u,f,a,_,n,l,k,S,C,z,R,D,P]}class tz extends Zt{constructor(e){super(),Wt(this,e,ez,Q6,Vt,{prevMode:0})}}const rz="/ltn/assets/settings-342fb430.svg";function tb(r){let e,t;return e=new Nd({props:{$$slots:{default:[nz]},$$scope:{ctx:r}}}),e.$on("close",r[3]),{c(){Oe(e.$$.fragment)},m(n,l){Be(e,n,l),t=!0},p(n,l){const u={};l&17&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(oe(e.$$.fragment,n),t=!0)},o(n){ue(e.$$.fragment,n),t=!1},d(n){Fe(e,n)}}}function nz(r){let e,t,n,l,u,f,a,_,x;return n=new w5({}),{c(){e=ce("h1"),e.textContent="Settings",t=Ue(),Oe(n.$$.fragment),l=Ue(),u=ce("center"),f=ce("button"),f.textContent="Confirm"},m(k,S){me(k,e,S),me(k,t,S),Be(n,k,S),me(k,l,S),me(k,u,S),re(u,f),a=!0,_||(x=Ct(f,"click",r[2]),_=!0)},p:It,i(k){a||(oe(n.$$.fragment,k),a=!0)},o(k){ue(n.$$.fragment,k),a=!1},d(k){k&&(pe(e),pe(t),pe(l),pe(u)),Fe(n,k),_=!1,x()}}}function iz(r){let e,t,n,l,u,f,a=r[0]&&tb(r);return{c(){e=ce("button"),e.innerHTML=`<img src="${rz}" alt="Settings"/>`,t=Ue(),a&&a.c(),n=Hn(),Te(e,"class","outline")},m(_,x){me(_,e,x),me(_,t,x),a&&a.m(_,x),me(_,n,x),l=!0,u||(f=Ct(e,"click",r[1]),u=!0)},p(_,[x]){_[0]?a?(a.p(_,x),x&1&&oe(a,1)):(a=tb(_),a.c(),oe(a,1),a.m(n.parentNode,n)):a&&(vr(),ue(a,1,1,()=>{a=null}),br())},i(_){l||(oe(a),l=!0)},o(_){ue(a),l=!1},d(_){_&&(pe(e),pe(t),pe(n)),a&&a.d(_),u=!1,f()}}}function oz(r,e,t){let n=!1;return[n,()=>t(0,n=!0),()=>t(0,n=!1),()=>t(0,n=!1)]}class sz extends Zt{constructor(e){super(),Wt(this,e,oz,iz,Vt,{})}}let Pc=Tr(null);const Co=Tr([]);function Ox(r){if(r.length<3)return JSON.parse(Hi(Pc).inner.calculateRoute(r));let e=JSON.parse(JSON.stringify(r));e.push(e[0]);let t=JSON.parse(Hi(Pc).inner.calculateRoute(e));return t.properties.waypoints.pop(),t.geometry.type="Polygon",t.geometry.coordinates=[t.geometry.coordinates],t}const{window:az}=Fd,lz=r=>({}),rb=r=>({}),cz=r=>({}),nb=r=>({});function ib(r,e,t){const n=r.slice();return n[44]=e[t],n[45]=e,n[46]=t,n}function ob(r,e,t){const n=r.slice();return n[47]=e[t],n[48]=e,n[49]=t,n}function uz(r){let e,t;const n=r[24]["extra-top"],l=$r(n,r,r[38],rb);return{c(){e=ce("div"),l&&l.c(),Te(e,"slot","top")},m(u,f){me(u,e,f),l&&l.m(e,null),t=!0},p(u,f){l&&l.p&&(!t||f[1]&128)&&Gr(l,n,u,u[38],t?qr(n,u[38],f,lz):Wr(u[38]),rb)},i(u){t||(oe(l,u),t=!0)},o(u){ue(l,u),t=!1},d(u){u&&pe(e),l&&l.d(u)}}}function hz(r){let e,t,n,l,u;return{c(){e=ce("ul"),e.innerHTML=`<li><b>Click</b>
            the map to add new points, until there are at least 3 points</li> <li><b>Click and drag</b>
            any point to move it</li> <li><b>Click</b>
            a waypoint to toggle snapping</li> <li><b>Right click</b>
            a waypoint to delete it</li>`,t=Ue(),n=ce("p"),n.textContent="Keyboard shortcuts:",l=Ue(),u=ce("ul"),u.innerHTML=`<li><b>s</b>
            to switch between snapping to roads and drawing anywhere</li> <li><b>Control+Z</b>
            to undo your last change</li> <li><b>Enter</b>
            or
            <b>Escape</b>
            to finish</li> <li>From the main mode, <b>3</b>
            to draw a new area</li>`},m(f,a){me(f,e,a),me(f,t,a),me(f,n,a),me(f,l,a),me(f,u,a)},p:It,d(f){f&&(pe(e),pe(t),pe(n),pe(l),pe(u))}}}function fz(r){let e,t=r[8].length+"",n,l;return{c(){e=tt("Undo ("),n=tt(t),l=tt(")")},m(u,f){me(u,e,f),me(u,n,f),me(u,l,f)},p(u,f){f[0]&256&&t!==(t=u[8].length+"")&&Ar(n,t)},d(u){u&&(pe(e),pe(n),pe(l))}}}function dz(r){let e;return{c(){e=tt("Undo")},m(t,n){me(t,e,n)},p:It,d(t){t&&pe(e)}}}function pz(r){let e;return{c(){e=ce("p"),e.textContent="Drag to adjust. Click to toggle snapped. Right click to delete."},m(t,n){me(t,e,n)},p:It,d(t){t&&pe(e)}}}function mz(r){let e,t,n,l,u,f,a,_,x,k,S,C,z;return S=Ib(r[36][0]),{c(){e=ce("fieldset"),t=ce("label"),n=ce("input"),l=tt(`
          Snap to roads`),u=Ue(),f=ce("label"),a=ce("input"),_=tt(`
          Draw anywhere`),x=Ue(),k=ce("p"),k.textContent="Click to add at least 3 points",Te(n,"type","radio"),n.__value="snap",ti(n,n.__value),Te(a,"type","radio"),a.__value="free",ti(a,a.__value),S.p(n,a)},m(R,D){me(R,e,D),re(e,t),re(t,n),n.checked=n.__value===r[7],re(t,l),re(e,u),re(e,f),re(f,a),a.checked=a.__value===r[7],re(f,_),me(R,x,D),me(R,k,D),C||(z=[Ct(n,"change",r[35]),Ct(a,"change",r[37])],C=!0)},p(R,D){D[0]&128&&(n.checked=n.__value===R[7]),D[0]&128&&(a.checked=a.__value===R[7])},d(R){R&&(pe(e),pe(x),pe(k)),S.r(),C=!1,yn(z)}}}function gz(r){let e,t,n,l,u,f,a,_,x,k,S,C,z,R,D,P,B;const N=r[24]["extra-sidebar"],V=$r(N,r,r[38],nb);k=new Vg({props:{$$slots:{default:[hz]},$$scope:{ctx:r}}});function U(ze,ne){return ze[8].length==0?dz:fz}let te=U(r),le=te(r);function H(ze,ne){return ze[5].length<3?mz:pz}let J=H(r),ye=J(r);return{c(){e=ce("div"),V&&V.c(),t=Ue(),n=ce("div"),l=ce("button"),u=tt("Finish"),a=Ue(),_=ce("button"),_.textContent="Cancel",x=Ue(),Oe(k.$$.fragment),S=Ue(),C=ce("button"),le.c(),R=Ue(),ye.c(),l.disabled=f=r[5].length<3,Te(_,"class","secondary"),pn(n,"display","flex"),Te(C,"class","secondary"),C.disabled=z=r[8].length==0,Te(e,"slot","sidebar")},m(ze,ne){me(ze,e,ne),V&&V.m(e,null),re(e,t),re(e,n),re(n,l),re(l,u),re(n,a),re(n,_),re(n,x),Be(k,n,null),re(e,S),re(e,C),le.m(C,null),re(e,R),ye.m(e,null),D=!0,P||(B=[Ct(l,"click",function(){Sc(r[0])&&r[0].apply(this,arguments)}),Ct(_,"click",function(){Sc(r[1])&&r[1].apply(this,arguments)}),Ct(C,"click",r[11])],P=!0)},p(ze,ne){r=ze,V&&V.p&&(!D||ne[1]&128)&&Gr(V,N,r,r[38],D?qr(N,r[38],ne,cz):Wr(r[38]),nb),(!D||ne[0]&32&&f!==(f=r[5].length<3))&&(l.disabled=f);const be={};ne[1]&128&&(be.$$scope={dirty:ne,ctx:r}),k.$set(be),te===(te=U(r))&&le?le.p(r,ne):(le.d(1),le=te(r),le&&(le.c(),le.m(C,null))),(!D||ne[0]&256&&z!==(z=r[8].length==0))&&(C.disabled=z),J===(J=H(r))&&ye?ye.p(r,ne):(ye.d(1),ye=J(r),ye&&(ye.c(),ye.m(e,null)))},i(ze){D||(oe(V,ze),oe(k.$$.fragment,ze),D=!0)},o(ze){ue(V,ze),ue(k.$$.fragment,ze),D=!1},d(ze){ze&&pe(e),V&&V.d(ze),Fe(k),le.d(),ye.d(),P=!1,yn(B)}}}function _z(r){let e;return{c(){e=ce("span"),Te(e,"class","dot svelte-1cj4rwq"),fi(e,"snapped-node",r[47].snapped),fi(e,"free-node",!r[47].snapped),fi(e,"hide",r[4])},m(t,n){me(t,e,n)},p(t,n){n[0]&512&&fi(e,"snapped-node",t[47].snapped),n[0]&512&&fi(e,"free-node",!t[47].snapped),n[0]&16&&fi(e,"hide",t[4])},d(t){t&&pe(e)}}}function sb(r){let e,t,n;function l(x){r[25](x,r[47])}function u(){return r[26](r[47])}function f(){return r[27](r[47])}function a(){return r[28](r[47])}let _={draggable:!0,zIndex:0,$$slots:{default:[_z]},$$scope:{ctx:r}};return r[47].point!==void 0&&(_.lngLat=r[47].point),e=new yh({props:_}),nn.push(()=>no(e,"lngLat",l)),e.$on("dragstart",u),e.$on("drag",f),e.$on("dragend",r[19]),e.$on("click",a),{c(){Oe(e.$$.fragment)},m(x,k){Be(e,x,k),n=!0},p(x,k){r=x;const S={};k[0]&528|k[1]&128&&(S.$$scope={dirty:k,ctx:r}),!t&&k[0]&512&&(t=!0,S.lngLat=r[47].point,ro(()=>t=!1)),e.$set(S)},i(x){n||(oe(e.$$.fragment,x),n=!0)},o(x){ue(e.$$.fragment,x),n=!1},d(x){Fe(e,x)}}}function yz(r){let e;return{c(){e=ce("span"),e.textContent=`${r[46]+1}`,Te(e,"class","dot svelte-1cj4rwq"),fi(e,"snapped",r[44].snapped)},m(t,n){me(t,e,n)},p(t,n){n[0]&32&&fi(e,"snapped",t[44].snapped)},d(t){t&&pe(e)}}}function ab(r){let e,t,n;function l(_){r[29](_,r[44])}function u(){return r[30](r[46])}function f(){return r[31](r[46])}let a={draggable:!0,zIndex:1,$$slots:{default:[yz]},$$scope:{ctx:r}};return r[44].point!==void 0&&(a.lngLat=r[44].point),e=new yh({props:a}),nn.push(()=>no(e,"lngLat",l)),e.$on("click",u),e.$on("contextmenu",f),e.$on("mouseenter",r[32]),e.$on("mouseleave",r[33]),e.$on("dragstart",r[21]),e.$on("dragend",r[34]),{c(){Oe(e.$$.fragment)},m(_,x){Be(e,_,x),n=!0},p(_,x){r=_;const k={};x[0]&32|x[1]&128&&(k.$$scope={dirty:x,ctx:r}),!t&&x[0]&32&&(t=!0,k.lngLat=r[44].point,ro(()=>t=!1)),e.$set(k)},i(_){n||(oe(e.$$.fragment,_),n=!0)},o(_){ue(e.$$.fragment,_),n=!1},d(_){Fe(e,_)}}}function vz(r){let e,t,n,l;const u=[bn("draw-area-lines"),{paint:{"line-color":"black","line-width":10}}];let f={};for(let x=0;x<u.length;x+=1)f=mn(f,u[x]);e=new Ro({props:f});const a=[bn("draw-area-preview"),{paint:{"fill-color":"grey","fill-opacity":.5}}];let _={};for(let x=0;x<a.length;x+=1)_=mn(_,a[x]);return n=new Ns({props:_}),{c(){Oe(e.$$.fragment),t=Ue(),Oe(n.$$.fragment)},m(x,k){Be(e,x,k),me(x,t,k),Be(n,x,k),l=!0},p(x,k){const S={};e.$set(S);const C={};n.$set(C)},i(x){l||(oe(e.$$.fragment,x),oe(n.$$.fragment,x),l=!0)},o(x){ue(e.$$.fragment,x),ue(n.$$.fragment,x),l=!1},d(x){x&&pe(t),Fe(e,x),Fe(n,x)}}}function bz(r){let e,t;return e=new Ro({props:{paint:{"line-color":"black","line-width":3}}}),{c(){Oe(e.$$.fragment)},m(n,l){Be(e,n,l),t=!0},p:It,i(n){t||(oe(e.$$.fragment,n),t=!0)},o(n){ue(e.$$.fragment,n),t=!1},d(n){Fe(e,n)}}}function wz(r){let e,t,n,l,u,f,a,_,x;t=new G4({}),t.$on("click",r[12]),t.$on("mousemove",r[13]);let k=Jn(r[9]),S=[];for(let P=0;P<k.length;P+=1)S[P]=sb(ob(r,k,P));const C=P=>ue(S[P],1,1,()=>{S[P]=null});let z=Jn(r[5]),R=[];for(let P=0;P<z.length;P+=1)R[P]=ab(ib(r,z,P));const D=P=>ue(R[P],1,1,()=>{R[P]=null});return f=new ri({props:{data:r[16](r[6],r[5]),generateId:!0,$$slots:{default:[vz]},$$scope:{ctx:r}}}),_=new ri({props:{data:r[10],$$slots:{default:[bz]},$$scope:{ctx:r}}}),{c(){e=ce("div"),Oe(t.$$.fragment),n=Ue();for(let P=0;P<S.length;P+=1)S[P].c();l=Ue();for(let P=0;P<R.length;P+=1)R[P].c();u=Ue(),Oe(f.$$.fragment),a=Ue(),Oe(_.$$.fragment),Te(e,"slot","map")},m(P,B){me(P,e,B),Be(t,e,null),re(e,n);for(let N=0;N<S.length;N+=1)S[N]&&S[N].m(e,null);re(e,l);for(let N=0;N<R.length;N+=1)R[N]&&R[N].m(e,null);re(e,u),Be(f,e,null),re(e,a),Be(_,e,null),x=!0},p(P,B){if(B[0]&918032){k=Jn(P[9]);let U;for(U=0;U<k.length;U+=1){const te=ob(P,k,U);S[U]?(S[U].p(te,B),oe(S[U],1)):(S[U]=sb(te),S[U].c(),oe(S[U],1),S[U].m(e,l))}for(vr(),U=k.length;U<S.length;U+=1)C(U);br()}if(B[0]&2146348){z=Jn(P[5]);let U;for(U=0;U<z.length;U+=1){const te=ib(P,z,U);R[U]?(R[U].p(te,B),oe(R[U],1)):(R[U]=ab(te),R[U].c(),oe(R[U],1),R[U].m(e,u))}for(vr(),U=z.length;U<R.length;U+=1)D(U);br()}const N={};B[0]&96&&(N.data=P[16](P[6],P[5])),B[1]&128&&(N.$$scope={dirty:B,ctx:P}),f.$set(N);const V={};B[0]&1024&&(V.data=P[10]),B[1]&128&&(V.$$scope={dirty:B,ctx:P}),_.$set(V)},i(P){if(!x){oe(t.$$.fragment,P);for(let B=0;B<k.length;B+=1)oe(S[B]);for(let B=0;B<z.length;B+=1)oe(R[B]);oe(f.$$.fragment,P),oe(_.$$.fragment,P),x=!0}},o(P){ue(t.$$.fragment,P),S=S.filter(Boolean);for(let B=0;B<S.length;B+=1)ue(S[B]);R=R.filter(Boolean);for(let B=0;B<R.length;B+=1)ue(R[B]);ue(f.$$.fragment,P),ue(_.$$.fragment,P),x=!1},d(P){P&&pe(e),Fe(t),Bs(S,P),Bs(R,P),Fe(f),Fe(_)}}}function xz(r){let e,t,n,l;return e=new hs({props:{$$slots:{map:[wz],sidebar:[gz],top:[uz]},$$scope:{ctx:r}}}),{c(){Oe(e.$$.fragment)},m(u,f){Be(e,u,f),t=!0,n||(l=Ct(az,"keydown",r[20]),n=!0)},p(u,f){const a={};f[0]&2047|f[1]&128&&(a.$$scope={dirty:f,ctx:u}),e.$set(a)},i(u){t||(oe(e.$$.fragment,u),t=!0)},o(u){ue(e.$$.fragment,u),t=!1},d(u){Fe(e,u),n=!1,l()}}}function Sz(r,e,t){let n,l,u;pt(r,Co,ht=>t(5,l=ht)),pt(r,Pc,ht=>t(6,u=ht));let{$$slots:f={},$$scope:a}=e,{map:_}=e,{finish:x}=e,{cancel:k}=e;ni(()=>{Lt(Co,l=[],l),u==null||u.stop(),_.getCanvas().style.cursor="inherit"});let S="snap",C=[],z=[],R=null,D=!1,P=!1,B=!1;function N(ht){let Mt=ht.length==0?"crosshair":"inherit";_.getCanvas().style.cursor=Mt}function V(){let ht=C.pop();t(8,C),ht&&Lt(Co,l=ht,l)}function U(){C.length==100&&C.shift(),t(8,C=[...C,JSON.parse(JSON.stringify(l))])}function te(){t(7,S=S=="snap"?"free":"snap"),R&&t(23,R.snapped=S=="snap",R)}function le(ht){l.length>=3||(U(),Co.update(Mt=>(Mt.push({point:ht.detail.lngLat.toArray(),snapped:S=="snap"}),Mt)))}function H(ht){t(23,R={point:ht.detail.lngLat.toArray(),snapped:S=="snap"})}function J(ht){U(),Co.update(Mt=>(Mt[ht].snapped=!Mt[ht].snapped,Mt))}function ye(ht){U(),Co.update(Mt=>(Mt.splice(ht,1),Mt)),t(2,D=!1)}function ze(ht,Mt){try{if(ht)return Ox(Mt)}catch{}return sh()}function ne(ht,Mt,De,ut){if(ut||Mt.length>=3)return sh();try{if(ht&&Mt.length>0&&De)return JSON.parse(ht.inner.calculateRoute([Mt[Mt.length-1],De]))}catch{}return sh()}function be(ht,Mt,De){if(De)return;if(!ht||Mt.length<3){t(9,z=[]);return}let ut=[],it=1,xt=JSON.parse(JSON.stringify(Mt));xt.push(xt[0]);for(let ie=0;ie<xt.length-1;ie++){let nr=JSON.parse(ht.inner.getExtraNodes(xt[ie],xt[ie+1]));for(let[Ne,We,wt]of nr)ut.push({point:[Ne,We],snapped:wt,insertIdx:it});it++}t(9,z=ut)}function He(ht){U(),Co.update(Mt=>(Mt.splice(ht.insertIdx,0,{point:ht.point,snapped:ht.snapped}),Mt)),t(4,B=!0)}function Ce(ht){Co.update(Mt=>(Mt[ht.insertIdx].point=ht.point,Mt))}function Qe(){t(4,B=!1)}function _t(ht){let Mt=ht.target.tagName,De=Mt=="INPUT"||Mt=="TEXTAREA";ht.key=="Enter"&&!De||ht.key=="Escape"?(ht.stopPropagation(),l.length>=3?x():window.alert("You can't save this area unless it has at least three points. Press 'Cancel' to discard these changes.")):ht.key=="s"&&!De?te():ht.key=="z"&&ht.ctrlKey&&(ht.stopPropagation(),V())}function Ut(){U(),t(3,P=!0)}const Je=[[]];function Yt(ht,Mt){r.$$.not_equal(Mt.point,ht)&&(Mt.point=ht,t(9,z))}const Kt=ht=>He(ht),Ft=ht=>Ce(ht),Ot=ht=>{He(ht),t(4,B=!1)};function Jt(ht,Mt){r.$$.not_equal(Mt.point,ht)&&(Mt.point=ht,Co.set(l))}const Et=ht=>J(ht),sr=ht=>ye(ht),zt=()=>t(2,D=!0),rr=()=>t(2,D=!1),wr=()=>t(3,P=!1);function gr(){S=this.__value,t(7,S)}function Br(){S=this.__value,t(7,S)}return r.$$set=ht=>{"map"in ht&&t(22,_=ht.map),"finish"in ht&&t(0,x=ht.finish),"cancel"in ht&&t(1,k=ht.cancel),"$$scope"in ht&&t(38,a=ht.$$scope)},r.$$.update=()=>{r.$$.dirty[0]&112&&be(u,l,B),r.$$.dirty[0]&8388716&&t(10,n=ne(u,l,R,D||P)),r.$$.dirty[0]&32&&N(l)},[x,k,D,P,B,l,u,S,C,z,n,V,le,H,J,ye,ze,He,Ce,Qe,_t,Ut,_,R,f,Yt,Kt,Ft,Ot,Jt,Et,sr,zt,rr,wr,gr,Je,Br,a]}class kz extends Zt{constructor(e){super(),Wt(this,e,Sz,xz,Vt,{map:22,finish:0,cancel:1},null,[-1,-1])}}function Tz(r){let e;return{c(){e=tt("Choose project")},m(t,n){me(t,e,n)},d(t){t&&pe(e)}}}function Ez(r){let e;return{c(){e=tt("Pick neighbourhood")},m(t,n){me(t,e,n)},d(t){t&&pe(e)}}}function Cz(r){let e;return{c(){e=ce("li"),e.textContent="Creating new neighbourhood boundary"},m(t,n){me(t,e,n)},p:It,i:It,o:It,d(t){t&&pe(e)}}}function Mz(r){let e,t,n,l,u;return t=new Pr({props:{$$slots:{default:[Iz]},$$scope:{ctx:r}}}),t.$on("click",r[8]),{c(){e=ce("li"),Oe(t.$$.fragment),n=Ue(),l=ce("li"),l.textContent="Changing neighbourhood boundary"},m(f,a){me(f,e,a),Be(t,e,null),me(f,n,a),me(f,l,a),u=!0},p(f,a){const _={};a&4096&&(_.$$scope={dirty:a,ctx:f}),t.$set(_)},i(f){u||(oe(t.$$.fragment,f),u=!0)},o(f){ue(t.$$.fragment,f),u=!1},d(f){f&&(pe(e),pe(n),pe(l)),Fe(t)}}}function Iz(r){let e;return{c(){e=tt("Editing")},m(t,n){me(t,e,n)},d(t){t&&pe(e)}}}function Az(r){let e,t,n,l,u,f,a,_,x,k,S,C;u=new Pr({props:{$$slots:{default:[Tz]},$$scope:{ctx:r}}}),u.$on("click",r[6]),_=new Pr({props:{$$slots:{default:[Ez]},$$scope:{ctx:r}}}),_.$on("click",r[7]);const z=[Mz,Cz],R=[];function D(P,B){return P[1]?0:1}return k=D(r),S=R[k]=z[k](r),{c(){e=ce("div"),t=ce("nav"),n=ce("ul"),l=ce("li"),Oe(u.$$.fragment),f=Ue(),a=ce("li"),Oe(_.$$.fragment),x=Ue(),S.c(),Te(t,"aria-label","breadcrumb"),Te(e,"slot","extra-top")},m(P,B){me(P,e,B),re(e,t),re(t,n),re(n,l),Be(u,l,null),re(n,f),re(n,a),Be(_,a,null),re(n,x),R[k].m(n,null),C=!0},p(P,B){const N={};B&4096&&(N.$$scope={dirty:B,ctx:P}),u.$set(N);const V={};B&4096&&(V.$$scope={dirty:B,ctx:P}),_.$set(V);let U=k;k=D(P),k===U?R[k].p(P,B):(vr(),ue(R[U],1,1,()=>{R[U]=null}),br(),S=R[k],S?S.p(P,B):(S=R[k]=z[k](P),S.c()),oe(S,1),S.m(n,null))},i(P){C||(oe(u.$$.fragment,P),oe(_.$$.fragment,P),oe(S),C=!0)},o(P){ue(u.$$.fragment,P),ue(_.$$.fragment,P),ue(S),C=!1},d(P){P&&pe(e),Fe(u),Fe(_),R[k].d()}}}function Lz(r){let e,t,n,l;return{c(){e=ce("div"),t=ce("h1"),n=tt("Draw your neighbourhood boundary for "),l=tt(r[0]),Te(e,"slot","extra-sidebar")},m(u,f){me(u,e,f),re(e,t),re(t,n),re(t,l)},p(u,f){f&1&&Ar(l,u[0])},d(u){u&&pe(e)}}}function Pz(r){let e,t;return e=new kz({props:{map:rn(r[3]),finish:r[4],cancel:r[5],$$slots:{"extra-sidebar":[Lz],"extra-top":[Az]},$$scope:{ctx:r}}}),{c(){Oe(e.$$.fragment)},m(n,l){Be(e,n,l),t=!0},p(n,[l]){const u={};l&8&&(u.map=rn(n[3])),l&4103&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(oe(e.$$.fragment,n),t=!0)},o(n){ue(e.$$.fragment,n),t=!1},d(n){Fe(e,n)}}}function zz(r,e,t){let n,l,u,f,a;pt(r,or,D=>t(2,n=D)),pt(r,_h,D=>t(9,l=D)),pt(r,Yn,D=>t(10,u=D)),pt(r,Co,D=>t(11,f=D)),pt(r,cs,D=>t(3,a=D));let{name:_}=e,{existing:x}=e;x&&(x.properties.waypoints?Lt(Co,f=x.properties.waypoints.map(D=>({point:[D.lon,D.lat],snapped:D.snapped})),f):Lt(Co,f=x.geometry.coordinates[0].slice(1).map(D=>({point:D,snapped:!1})),f));function k(){if(f.length>=3)try{let D=Ox(f);u.setNeighbourhoodBoundary(_,D),Tc(),u.setCurrentNeighbourhood(_,l),Lt(or,n={mode:"neighbourhood"},n)}catch{window.alert("Known georust bug hit, sorry. You may need to just refresh the page now."),S()}}function S(){x?Lt(or,n={mode:"neighbourhood"},n):Lt(or,n={mode:"network"},n)}const C=()=>Lt(or,n={mode:"title"},n),z=()=>Lt(or,n={mode:"network"},n),R=()=>Lt(or,n={mode:"neighbourhood"},n);return r.$$set=D=>{"name"in D&&t(0,_=D.name),"existing"in D&&t(1,x=D.existing)},[_,x,n,a,k,S,C,z,R]}class Dz extends Zt{constructor(e){super(),Wt(this,e,zz,Pz,Vt,{name:0,existing:1})}}function Rz(r){let e;return{c(){e=tt("Choose project")},m(t,n){me(t,e,n)},d(t){t&&pe(e)}}}function Bz(r){let e;return{c(){e=tt("Pick neighbourhood")},m(t,n){me(t,e,n)},d(t){t&&pe(e)}}}function Fz(r){let e,t,n,l,u,f,a,_,x,k,S;return u=new Pr({props:{$$slots:{default:[Rz]},$$scope:{ctx:r}}}),u.$on("click",r[10]),_=new Pr({props:{$$slots:{default:[Bz]},$$scope:{ctx:r}}}),_.$on("click",r[11]),{c(){e=ce("div"),t=ce("nav"),n=ce("ul"),l=ce("li"),Oe(u.$$.fragment),f=Ue(),a=ce("li"),Oe(_.$$.fragment),x=Ue(),k=ce("li"),k.textContent="Use an auto-generated boundary",Te(t,"aria-label","breadcrumb"),Te(e,"slot","top")},m(C,z){me(C,e,z),re(e,t),re(t,n),re(n,l),Be(u,l,null),re(n,f),re(n,a),Be(_,a,null),re(n,x),re(n,k),S=!0},p(C,z){const R={};z&32768&&(R.$$scope={dirty:z,ctx:C}),u.$set(R);const D={};z&32768&&(D.$$scope={dirty:z,ctx:C}),_.$set(D)},i(C){S||(oe(u.$$.fragment,C),oe(_.$$.fragment,C),S=!0)},o(C){ue(u.$$.fragment,C),ue(_.$$.fragment,C),S=!1},d(C){C&&pe(e),Fe(u),Fe(_)}}}function Oz(r){let e,t,n,l,u,f,a,_,x,k,S,C,z,R,D,P,B;return t=new Ph({}),t.$on("click",r[7]),{c(){e=ce("div"),Oe(t.$$.fragment),n=Ue(),l=ce("p"),l.textContent=`Click an area to use it as a neighbourhood. These are generated by finding
      roads, railways, and water that form severances. There are many bugs; this
      is experimental. The colors are arbitrary, just to distinguish better.`,u=Ue(),f=ce("button"),f.textContent="Export to GeoJSON",a=Ue(),_=ce("label"),x=tt(`Minimum area (km)
      `),k=ce("input"),S=Ue(),C=ce("label"),z=ce("input"),R=tt(`
      Remove areas not touching a big road`),Te(f,"class","secondary"),Te(k,"type","number"),Te(k,"min","0"),Te(k,"max","1"),Te(k,"step","0.01"),Te(z,"type","checkbox"),Te(e,"slot","sidebar")},m(N,V){me(N,e,V),Be(t,e,null),re(e,n),re(e,l),re(e,u),re(e,f),re(e,a),re(e,_),re(_,x),re(_,k),ti(k,r[0]),re(e,S),re(e,C),re(C,z),z.checked=r[1],re(C,R),D=!0,P||(B=[Ct(f,"click",r[5]),Ct(k,"input",r[8]),Ct(z,"change",r[9])],P=!0)},p(N,V){V&1&&kg(k.value)!==N[0]&&ti(k,N[0]),V&2&&(z.checked=N[1])},i(N){D||(oe(t.$$.fragment,N),D=!0)},o(N){ue(t.$$.fragment,N),D=!1},d(N){N&&pe(e),Fe(t),P=!1,yn(B)}}}function Nz(r){let e,t,n=r[14].area_km2.toFixed(1)+"",l,u,f,a,_,x=r[14].touches_big_road+"",k,S,C=r[14].touches_railway+"",z,R,D=r[14].touches_waterway+"",P;return{c(){e=ce("p"),t=tt("Area: "),l=tt(n),u=tt(" km"),f=Ue(),a=ce("p"),_=tt("Borders roads = "),k=tt(x),S=tt(", railway = "),z=tt(C),R=tt(`,
            water = `),P=tt(D)},m(B,N){me(B,e,N),re(e,t),re(e,l),re(e,u),me(B,f,N),me(B,a,N),re(a,_),re(a,k),re(a,S),re(a,z),re(a,R),re(a,P)},p(B,N){N&16384&&n!==(n=B[14].area_km2.toFixed(1)+"")&&Ar(l,n),N&16384&&x!==(x=B[14].touches_big_road+"")&&Ar(k,x),N&16384&&C!==(C=B[14].touches_railway+"")&&Ar(z,C),N&16384&&D!==(D=B[14].touches_waterway+"")&&Ar(P,D)},d(B){B&&(pe(e),pe(f),pe(a))}}}function jz(r){let e,t;return e=new fs({props:{openOn:"hover",$$slots:{default:[Nz,({props:n})=>({14:n}),({props:n})=>n?16384:0]},$$scope:{ctx:r}}}),{c(){Oe(e.$$.fragment)},m(n,l){Be(e,n,l),t=!0},p(n,l){const u={};l&49152&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(oe(e.$$.fragment,n),t=!0)},o(n){ue(e.$$.fragment,n),t=!1},d(n){Fe(e,n)}}}function Uz(r){let e,t,n,l;const u=[bn("auto-boundaries-areas"),{filter:r[6](r[0],r[1])},{manageHoverState:!0},{paint:{"fill-color":["match",["%",["id"],5],0,"blue",1,"yellow",2,"green",3,"purple",4,"orange","black"],"fill-opacity":nl(.3,.7)}},{hoverCursor:"pointer"}];let f={$$slots:{default:[jz]},$$scope:{ctx:r}};for(let x=0;x<u.length;x+=1)f=mn(f,u[x]);e=new Ns({props:f}),e.$on("click",r[4]);const a=[bn("auto-boundaries-severances"),{filter:a5},{manageHoverState:!0},{paint:{"line-color":nl("black","red"),"line-width":3}}];let _={};for(let x=0;x<a.length;x+=1)_=mn(_,a[x]);return n=new Ro({props:_}),{c(){Oe(e.$$.fragment),t=Ue(),Oe(n.$$.fragment)},m(x,k){Be(e,x,k),me(x,t,k),Be(n,x,k),l=!0},p(x,k){const S=k&67?pd(u,[u[0],{filter:x[6](x[0],x[1])},u[2],u[3],u[4]]):{};k&32768&&(S.$$scope={dirty:k,ctx:x}),e.$set(S);const C={};n.$set(C)},i(x){l||(oe(e.$$.fragment,x),oe(n.$$.fragment,x),l=!0)},o(x){ue(e.$$.fragment,x),ue(n.$$.fragment,x),l=!1},d(x){x&&pe(t),Fe(e,x),Fe(n,x)}}}function Vz(r){let e,t,n;return t=new ri({props:{data:r[3],generateId:!0,$$slots:{default:[Uz]},$$scope:{ctx:r}}}),{c(){e=ce("div"),Oe(t.$$.fragment),Te(e,"slot","map")},m(l,u){me(l,e,u),Be(t,e,null),n=!0},p(l,u){const f={};u&32771&&(f.$$scope={dirty:u,ctx:l}),t.$set(f)},i(l){n||(oe(t.$$.fragment,l),n=!0)},o(l){ue(t.$$.fragment,l),n=!1},d(l){l&&pe(e),Fe(t)}}}function $z(r){let e,t;return e=new hs({props:{$$slots:{map:[Vz],sidebar:[Oz],top:[Fz]},$$scope:{ctx:r}}}),{c(){Oe(e.$$.fragment)},m(n,l){Be(e,n,l),t=!0},p(n,[l]){const u={};l&32775&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(oe(e.$$.fragment,n),t=!0)},o(n){ue(e.$$.fragment,n),t=!1},d(n){Fe(e,n)}}}function qz(r,e,t){let n,l,u;pt(r,or,B=>t(2,n=B)),pt(r,_h,B=>t(12,l=B)),pt(r,Yn,B=>t(13,u=B));let f=JSON.parse(u.renderAutoBoundaries()),a=0,_=!0;function x(B){let N=wg(u,"What do you want to name the neighbourhood?","");if(N)try{let V={type:"Feature",properties:{},geometry:f.features[B.detail.features[0].id].geometry};u.setNeighbourhoodBoundary(N,V),Tc(),u.setCurrentNeighbourhood(N,l),Lt(or,n={mode:"neighbourhood"},n)}catch(V){console.log(V),window.alert("Known georust bug hit, sorry. You may need to just refresh the page now.")}}function k(){md("auto_boundaries.geojson",JSON.stringify(f,null,"  "))}function S(B,N){let V=["all",s5,[">=",["get","area_km2"],B]];return N&&V.push(["get","touches_big_road"]),V}const C=()=>Lt(or,n={mode:"network"},n);function z(){a=kg(this.value),t(0,a)}function R(){_=this.checked,t(1,_)}return[a,_,n,f,x,k,S,C,z,R,()=>Lt(or,n={mode:"title"},n),()=>Lt(or,n={mode:"network"},n)]}class Gz extends Zt{constructor(e){super(),Wt(this,e,qz,$z,Vt,{})}}const Wz=["==",["geometry-type"],"Polygon"],Zz=["==",["geometry-type"],"LineString"],Hz=["==",["geometry-type"],"Point"];function Nx(){return{type:"FeatureCollection",features:[]}}function Lm(r){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:jx(r)}}}function jx(r){return[Math.round(r[0]*1e7)/1e7,Math.round(r[1]*1e7)/1e7]}const Ux=Tr(Nx()),Vx=Tr(0),Xz=100;class Kz{constructor(e){Wn(this,"map");Wn(this,"active");Wn(this,"eventListenersSuccess");Wn(this,"eventListenersUpdated");Wn(this,"eventListenersFailure");Wn(this,"points");Wn(this,"cursor");Wn(this,"hover");Wn(this,"dragFrom");Wn(this,"previousStates");Wn(this,"onMouseMove",e=>{if(this.active&&!this.dragFrom)this.recalculateHovering(e);else if(this.active&&this.dragFrom){if(this.hover=="polygon"){let t=this.dragFrom[0]-e.lngLat.lng,n=this.dragFrom[1]-e.lngLat.lat;for(let l of this.points)l[0]-=t,l[1]-=n}else this.points[this.hover]=e.lngLat.toArray();this.dragFrom=e.lngLat.toArray(),this.redraw()}});Wn(this,"onClick",e=>{if(this.beforeUpdate(),this.active&&this.cursor){let t=[];if(lb(this.points).forEach((n,l)=>{t.push([l+1,o4(n,this.cursor).properties.dist])}),t.sort((n,l)=>n[1]-l[1]),t.length>0){let n=t[0][0];this.points.splice(n,0,this.cursor.geometry.coordinates),this.hover=n}else this.points.push(this.cursor.geometry.coordinates),this.hover=this.points.length-1;this.redraw(),this.pointsUpdated()}else this.active&&typeof this.hover=="number"&&(this.points.splice(this.hover,1),this.hover=null,this.redraw(),this.pointsUpdated(),this.recalculateHovering(e))});Wn(this,"onDoubleClick",e=>{this.active&&(e.preventDefault(),this.cursor=Lm(e.lngLat.toArray()),this.onClick(e),this.finish())});Wn(this,"onMouseDown",e=>{this.active&&!this.dragFrom&&this.hover!=null&&(e.preventDefault(),this.cursor=null,this.dragFrom=e.lngLat.toArray(),this.beforeUpdate(),this.redraw())});Wn(this,"onMouseUp",()=>{this.active&&this.dragFrom&&(this.dragFrom=null,this.redraw(),this.pointsUpdated())});Wn(this,"onKeypress",e=>{this.active&&(e.key=="Enter"?(e.stopPropagation(),this.finish()):e.key=="z"&&e.ctrlKey&&this.undo())});Wn(this,"onKeyDown",e=>{this.active&&e.key=="Escape"&&(e.stopPropagation(),this.cancel())});this.map=e,this.active=!1,this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[],this.points=[],this.cursor=null,this.hover=null,this.dragFrom=null,this.previousStates=[],this.map.on("mousemove",this.onMouseMove),this.map.on("click",this.onClick),this.map.on("dblclick",this.onDoubleClick),this.map.on("mousedown",this.onMouseDown),this.map.on("mouseup",this.onMouseUp),document.addEventListener("keypress",this.onKeypress),document.addEventListener("keydown",this.onKeyDown)}tearDown(){this.map.off("mousemove",this.onMouseMove),this.map.off("click",this.onClick),this.map.off("dblclick",this.onDoubleClick),this.map.off("mousedown",this.onMouseDown),this.map.off("mouseup",this.onMouseUp),document.removeEventListener("keypress",this.onKeypress),document.removeEventListener("keydown",this.onKeyDown)}finish(){let e=this.polygonFeature();if(e)for(let t of this.eventListenersSuccess)t(e);else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){for(let e of this.eventListenersFailure)e();this.stop()}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerUpdated(e){this.eventListenersUpdated.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}clearEventListeners(){this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[]}startNew(){this.active=!0,this.map.doubleClickZoom.disable()}editExisting(e){this.active=!0,this.map.doubleClickZoom.disable(),this.points=JSON.parse(JSON.stringify(e.geometry.coordinates[0])),this.points.pop(),this.redraw()}stop(){this.map.doubleClickZoom.enable(),this.points=[],this.cursor=null,this.active=!1,this.hover=null,this.dragFrom=null,this.previousStates=[],this.redraw(),this.map.getCanvas().style.cursor="inherit"}undo(){this.dragFrom!=null||this.previousStates.length==0||(this.points=this.previousStates.pop(),this.hover=null,this.redraw())}redraw(){let e=Nx();this.points.forEach((l,u)=>{let f=Lm(l);f.properties.hover=this.hover==u,f.properties.idx=u,e.features.push(f)}),e.features=e.features.concat(lb(this.points));let t=this.polygonFeature();t&&(t.properties.hover=this.hover=="polygon",e.features.push(t)),Ux.set(e);let n="crosshair";this.hover!=null&&(n=this.dragFrom?"grabbing":"pointer"),this.map.getCanvas().style.cursor=n,Vx.set(this.previousStates.length)}pointsUpdated(){let e=this.polygonFeature();if(e)for(let t of this.eventListenersUpdated)t(e)}recalculateHovering(e){this.cursor=null,this.hover=null;for(let t of this.map.queryRenderedFeatures(e.point,{layers:["edit-polygon-fill","edit-polygon-vertices"]}))if(t.geometry.type=="Polygon"){this.hover="polygon";break}else if(t.geometry.type=="Point"&&Object.hasOwn(t.properties,"idx")){this.hover=t.properties.idx;break}this.hover==null&&(this.cursor=Lm(e.lngLat.toArray())),this.redraw()}polygonFeature(){if(this.points.length<3)return null;let e=this.points.map(jx),t=[JSON.parse(JSON.stringify(e))];return t[0].push(JSON.parse(JSON.stringify(t[0][0]))),{type:"Feature",geometry:{type:"Polygon",coordinates:t},properties:{}}}beforeUpdate(){this.previousStates.push(JSON.parse(JSON.stringify(this.points))),this.previousStates.length>Xz&&this.previousStates.shift()}}function lb(r){let e=[];for(let t=0;t<r.length-1;t++)e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[t],r[t+1]]},properties:{}});return r.length>=3&&e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[r.length-1],r[0]]},properties:{}}),e}function Jz(r){let e,t,n;return{c(){e=tt("Undo ("),t=tt(r[1]),n=tt(")")},m(l,u){me(l,e,u),me(l,t,u),me(l,n,u)},p(l,u){u&2&&Ar(t,l[1])},d(l){l&&(pe(e),pe(t),pe(n))}}}function Yz(r){let e;return{c(){e=tt("Undo")},m(t,n){me(t,e,n)},p:It,d(t){t&&pe(e)}}}function Qz(r){let e,t,n,l,u,f,a,_,x,k,S;function C(D,P){return D[1]==0?Yz:Jz}let z=C(r),R=z(r);return{c(){e=ce("div"),t=ce("button"),t.textContent="Finish",n=Ue(),l=ce("button"),l.textContent="Cancel",u=Ue(),f=ce("button"),R.c(),_=Ue(),x=ce("ul"),x.innerHTML=`<li><b>Click</b>
    the map to add a vertex</li> <li><b>Click</b>
    a vertex to delete it</li> <li><b>Drag</b>
    a vertex or the polygon to move it</li> <li>Press <b>Control+Z</b>
    to undo your last change</li> <li>Press <b>Enter</b>
    or
    <b>double click</b>
    to finish</li> <li>Press <b>Escape</b>
    to cancel</li>`,f.disabled=a=r[1]==0,pn(e,"display","flex"),pn(e,"justify-content","space-between")},m(D,P){me(D,e,P),re(e,t),re(e,n),re(e,l),re(e,u),re(e,f),R.m(f,null),me(D,_,P),me(D,x,P),k||(S=[Ct(t,"click",r[2]),Ct(l,"click",r[3]),Ct(f,"click",r[4])],k=!0)},p(D,[P]){z===(z=C(D))&&R?R.p(D,P):(R.d(1),R=z(D),R&&(R.c(),R.m(f,null))),P&2&&a!==(a=D[1]==0)&&(f.disabled=a)},i:It,o:It,d(D){D&&(pe(e),pe(_),pe(x)),R.d(),k=!1,yn(S)}}}function e8(r,e,t){let n;pt(r,Vx,_=>t(1,n=_));let{polygonTool:l}=e;const u=()=>l.finish(),f=()=>l.cancel(),a=()=>l.undo();return r.$$set=_=>{"polygonTool"in _&&t(0,l=_.polygonTool)},[l,n,u,f,a]}class t8 extends Zt{constructor(e){super(),Wt(this,e,e8,Qz,Vt,{polygonTool:0})}}let r8=Date.now();function Rh(r){return`${r}-${r8++}`}const $x=Symbol.for("svelte-maplibre");function n8(){return Lb($x)}function cb(r){return{subscribe:r.subscribe}}function qx({key:r,setPopupTarget:e=!1,setCluster:t=!1,setMouseEvent:n=!1}){let l=n8(),u=Tr(null),f=cb(u),a={...l,[r]:cb(u)};if(e&&(a.popupTarget=f),n){let _=Tr(null);a.layerEvent=_,l.layerEvent=_}return t&&(a.cluster=Tr()),Tg($x,a),{...l,self:u}}function i8(){return qx({key:"source",setCluster:!0})}function o8(r=!0){return qx({key:"layer",setPopupTarget:r,setMouseEvent:r})}function ub(r){let e;return t=>{if(t)for(let n in t){let l=e==null?void 0:e[n],u=t[n];l!==u&&r(n,u,l)}else if(e)for(let n in e)r(n,void 0,e[n]);e=t}}function s8(r,...e){let t=[r];for(let n of e)if(n)Array.isArray(n)&&n[0]===r?t.push(...n.slice(1)):t.push(n);else continue;if(t.length!==1)return t.length===2?t[1]:t}function a8(r){return r===!0?["has","point_count"]:r===!1?["!",["has","point_count"]]:void 0}function hb(r){let e=r[0],t,n,l=fb(r);return{c(){l.c(),t=Hn()},m(u,f){l.m(u,f),me(u,t,f),n=!0},p(u,f){f[0]&1&&Vt(e,e=u[0])?(vr(),ue(l,1,1,It),br(),l=fb(u),l.c(),oe(l,1),l.m(t.parentNode,t)):l.p(u,f)},i(u){n||(oe(l),n=!0)},o(u){ue(l),n=!1},d(u){u&&pe(t),l.d(u)}}}function fb(r){let e;const t=r[36].default,n=$r(t,r,r[35],null);return{c(){n&&n.c()},m(l,u){n&&n.m(l,u),e=!0},p(l,u){n&&n.p&&(!e||u[1]&16)&&Gr(n,t,l,l[35],e?qr(t,l[35],u,null):Wr(l[35]),null)},i(l){e||(oe(n,l),e=!0)},o(l){ue(n,l),e=!1},d(l){n&&n.d(l)}}}function l8(r){let e,t,n=r[0]&&hb(r);return{c(){n&&n.c(),e=Hn()},m(l,u){n&&n.m(l,u),me(l,e,u),t=!0},p(l,u){l[0]?n?(n.p(l,u),u[0]&1&&oe(n,1)):(n=hb(l),n.c(),oe(n,1),n.m(e.parentNode,e)):n&&(vr(),ue(n,1,1,()=>{n=null}),br())},i(l){t||(oe(n),t=!0)},o(l){ue(n),t=!1},d(l){l&&pe(e),n&&n.d(l)}}}function c8(r,e,t){let n,l,u,f,a,_,x,k,S,C,z,R,{$$slots:D={},$$scope:P}=e,{id:B=Rh("layer")}=e,{source:N=void 0}=e,{sourceLayer:V=void 0}=e,{beforeId:U=void 0}=e,{beforeLayerType:te=void 0}=e,{type:le}=e,{paint:H=void 0}=e,{layout:J=void 0}=e,{filter:ye=void 0}=e,{applyToClusters:ze=void 0}=e,{minzoom:ne=void 0}=e,{maxzoom:be=void 0}=e,{manageHoverState:He=!1}=e,{hovered:Ce=null}=e,{interactive:Qe=!0}=e,{hoverCursor:_t=void 0}=e,{eventsIfTopMost:Ut=!1}=e;const Je=us(),{map:Yt,source:Kt,self:Ft,minzoom:Ot,maxzoom:Jt,eventTopMost:Et,layerInfo:sr}=o8();pt(r,Yt,De=>t(31,S=De)),pt(r,Kt,De=>t(32,C=De)),pt(r,Ft,De=>t(0,k=De)),pt(r,Ot,De=>t(34,R=De)),pt(r,Jt,De=>t(33,z=De)),ni(()=>{k&&S&&(sr.delete(k),S==null||S.removeLayer(k))});let zt;function rr(De){var ie,nr;if(!Qe||!k||!S||Ut&&Et(De)!==k)return;let ut=De.features??[],it=(nr=(ie=ut[0])==null?void 0:ie.properties)==null?void 0:nr.cluster_id,xt={event:De,map:S,clusterId:it,layer:k,source:a,features:ut};Je(De.type,xt)}function wr(De){var ie,nr;if(!Qe||!k||!S||Ut&&Et(De)!==k)return;_t&&(S.getCanvas().style.cursor=_t);let ut=De.features??[];t(6,Ce=ut[0]??null);let it=(nr=(ie=ut[0])==null?void 0:ie.properties)==null?void 0:nr.cluster_id;Je("mouseenter",{event:De,map:S,clusterId:it,layer:k,source:a,features:ut})}function gr(De){var ie,nr,Ne;if(!Qe||!S)return;if(Ut&&Et(De)!==k){t(6,Ce=null),He&&zt!==void 0&&(S==null||S.setFeatureState({source:a,sourceLayer:V,id:zt},{hover:!1}),zt=void 0);return}S.getCanvas().style.cursor=_t;let ut=De.features??[],it=(nr=(ie=ut[0])==null?void 0:ie.properties)==null?void 0:nr.cluster_id,xt=(Ne=ut[0])==null?void 0:Ne.id;xt!==zt&&(He&&(zt!==void 0&&(S==null||S.setFeatureState({source:a,id:zt,sourceLayer:V},{hover:!1})),S==null||S.setFeatureState({source:a,id:xt,sourceLayer:V},{hover:!0})),zt=xt,t(6,Ce=ut[0]??null)),Je("mousemove",{event:De,map:S,clusterId:it,layer:k,source:a,features:ut})}function Br(De){if(!(!Qe||!k||!S)){if(_t&&(S.getCanvas().style.cursor=""),t(6,Ce=null),He&&zt!==void 0){const ut={source:a,id:zt,sourceLayer:V};S==null||S.setFeatureState(ut,{hover:!1}),zt=void 0}Je("mouseleave",{map:S,layer:k,source:a})}}let ht=!0;function Mt(De){S&&(S.off("click",De,rr),S.off("dblclick",De,rr),S.off("contextmenu",De,rr),S.off("mouseenter",De,wr),S.off("mousemove",De,gr),S.off("mouseleave",De,Br))}return ni(()=>{S&&k&&Mt(k)}),r.$$set=De=>{"id"in De&&t(7,B=De.id),"source"in De&&t(8,N=De.source),"sourceLayer"in De&&t(9,V=De.sourceLayer),"beforeId"in De&&t(10,U=De.beforeId),"beforeLayerType"in De&&t(11,te=De.beforeLayerType),"type"in De&&t(12,le=De.type),"paint"in De&&t(13,H=De.paint),"layout"in De&&t(14,J=De.layout),"filter"in De&&t(15,ye=De.filter),"applyToClusters"in De&&t(16,ze=De.applyToClusters),"minzoom"in De&&t(17,ne=De.minzoom),"maxzoom"in De&&t(18,be=De.maxzoom),"manageHoverState"in De&&t(19,He=De.manageHoverState),"hovered"in De&&t(6,Ce=De.hovered),"interactive"in De&&t(20,Qe=De.interactive),"hoverCursor"in De&&t(21,_t=De.hoverCursor),"eventsIfTopMost"in De&&t(22,Ut=De.eventsIfTopMost),"$$scope"in De&&t(35,P=De.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&65536&&t(30,n=a8(ze)),r.$$.dirty[0]&1073774592&&t(24,l=s8("all",n,ye)),r.$$.dirty[0]&131072|r.$$.dirty[1]&8&&t(26,u=ne??R),r.$$.dirty[0]&262144|r.$$.dirty[1]&4&&t(25,f=be??z),r.$$.dirty[0]&256|r.$$.dirty[1]&2&&t(29,a=N||C),r.$$.dirty[0]&654343809|r.$$.dirty[1]&1&&S&&k!==B&&a){k&&(Mt(k),sr.delete(k));let De=U;if(!U&&te){let ut=S.getStyle().layers,it=typeof te=="function"?te:ie=>ie.type===te,xt=ut==null?void 0:ut.find(it);xt&&(De=xt.id)}Lt(Ft,k=B,k),S.addLayer(il({id:k,type:le,source:a,"source-layer":V,filter:l,paint:H,layout:J,minzoom:u,maxzoom:f}),De),t(23,ht=!0),S.on("click",k,rr),S.on("dblclick",k,rr),S.on("contextmenu",k,rr),S.on("mouseenter",k,wr),S.on("mousemove",k,gr),S.on("mouseleave",k,Br)}r.$$.dirty[0]&1048577&&k&&sr.set(k,{interactive:Qe}),r.$$.dirty[0]&1|r.$$.dirty[1]&1&&t(28,_=k?ub((De,ut)=>S==null?void 0:S.setPaintProperty(k,De,ut)):void 0),r.$$.dirty[0]&1|r.$$.dirty[1]&1&&t(27,x=k?ub((De,ut)=>S==null?void 0:S.setLayoutProperty(k,De,ut)):void 0),r.$$.dirty[0]&268443648&&(_==null||_(H)),r.$$.dirty[0]&134234112&&(x==null||x(J)),r.$$.dirty[0]&100663297|r.$$.dirty[1]&1&&k&&(S==null||S.setLayerZoomRange(k,u,f)),r.$$.dirty[0]&25165825|r.$$.dirty[1]&1&&k&&(ht?t(23,ht=!1):S==null||S.setFilter(k,l))},[k,Yt,Kt,Ft,Ot,Jt,Ce,B,N,V,U,te,le,H,J,ye,ze,ne,be,He,Qe,_t,Ut,ht,l,f,u,x,_,a,n,S,C,z,R,P,D]}class c_ extends Zt{constructor(e){super(),Wt(this,e,c8,l8,Vt,{id:7,source:8,sourceLayer:9,beforeId:10,beforeLayerType:11,type:12,paint:13,layout:14,filter:15,applyToClusters:16,minzoom:17,maxzoom:18,manageHoverState:19,hovered:6,interactive:20,hoverCursor:21,eventsIfTopMost:22},null,[-1,-1])}}function u8(r){let e;const t=r[16].default,n=$r(t,r,r[24],null);return{c(){n&&n.c()},m(l,u){n&&n.m(l,u),e=!0},p(l,u){n&&n.p&&(!e||u&16777216)&&Gr(n,t,l,l[24],e?qr(t,l[24],u,null):Wr(l[24]),null)},i(l){e||(oe(n,l),e=!0)},o(l){ue(n,l),e=!1},d(l){n&&n.d(l)}}}function h8(r){let e,t,n;function l(f){r[17](f)}let u={id:r[1],type:"circle",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],applyToClusters:r[9],minzoom:r[10],maxzoom:r[11],hoverCursor:r[12],manageHoverState:r[13],eventsIfTopMost:r[14],interactive:r[15],$$slots:{default:[u8]},$$scope:{ctx:r}};return r[0]!==void 0&&(u.hovered=r[0]),e=new c_({props:u}),nn.push(()=>no(e,"hovered",l)),e.$on("click",r[18]),e.$on("dblclick",r[19]),e.$on("contextmenu",r[20]),e.$on("mouseenter",r[21]),e.$on("mousemove",r[22]),e.$on("mouseleave",r[23]),{c(){Oe(e.$$.fragment)},m(f,a){Be(e,f,a),n=!0},p(f,[a]){const _={};a&2&&(_.id=f[1]),a&4&&(_.source=f[2]),a&8&&(_.sourceLayer=f[3]),a&16&&(_.beforeId=f[4]),a&32&&(_.beforeLayerType=f[5]),a&64&&(_.paint=f[6]),a&128&&(_.layout=f[7]),a&256&&(_.filter=f[8]),a&512&&(_.applyToClusters=f[9]),a&1024&&(_.minzoom=f[10]),a&2048&&(_.maxzoom=f[11]),a&4096&&(_.hoverCursor=f[12]),a&8192&&(_.manageHoverState=f[13]),a&16384&&(_.eventsIfTopMost=f[14]),a&32768&&(_.interactive=f[15]),a&16777216&&(_.$$scope={dirty:a,ctx:f}),!t&&a&1&&(t=!0,_.hovered=f[0],ro(()=>t=!1)),e.$set(_)},i(f){n||(oe(e.$$.fragment,f),n=!0)},o(f){ue(e.$$.fragment,f),n=!1},d(f){Fe(e,f)}}}function f8(r,e,t){let{$$slots:n={},$$scope:l}=e,{id:u=Rh("circle")}=e,{source:f=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:_=void 0}=e,{beforeLayerType:x=void 0}=e,{paint:k}=e,{layout:S=void 0}=e,{filter:C=void 0}=e,{applyToClusters:z=void 0}=e,{minzoom:R=void 0}=e,{maxzoom:D=void 0}=e,{hoverCursor:P=void 0}=e,{manageHoverState:B=!1}=e,{hovered:N=null}=e,{eventsIfTopMost:V=!1}=e,{interactive:U=!0}=e;function te(be){N=be,t(0,N)}function le(be){fr.call(this,r,be)}function H(be){fr.call(this,r,be)}function J(be){fr.call(this,r,be)}function ye(be){fr.call(this,r,be)}function ze(be){fr.call(this,r,be)}function ne(be){fr.call(this,r,be)}return r.$$set=be=>{"id"in be&&t(1,u=be.id),"source"in be&&t(2,f=be.source),"sourceLayer"in be&&t(3,a=be.sourceLayer),"beforeId"in be&&t(4,_=be.beforeId),"beforeLayerType"in be&&t(5,x=be.beforeLayerType),"paint"in be&&t(6,k=be.paint),"layout"in be&&t(7,S=be.layout),"filter"in be&&t(8,C=be.filter),"applyToClusters"in be&&t(9,z=be.applyToClusters),"minzoom"in be&&t(10,R=be.minzoom),"maxzoom"in be&&t(11,D=be.maxzoom),"hoverCursor"in be&&t(12,P=be.hoverCursor),"manageHoverState"in be&&t(13,B=be.manageHoverState),"hovered"in be&&t(0,N=be.hovered),"eventsIfTopMost"in be&&t(14,V=be.eventsIfTopMost),"interactive"in be&&t(15,U=be.interactive),"$$scope"in be&&t(24,l=be.$$scope)},[N,u,f,a,_,x,k,S,C,z,R,D,P,B,V,U,n,te,le,H,J,ye,ze,ne,l]}class d8 extends Zt{constructor(e){super(),Wt(this,e,f8,h8,Vt,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}function p8(r){let e;const t=r[15].default,n=$r(t,r,r[23],null);return{c(){n&&n.c()},m(l,u){n&&n.m(l,u),e=!0},p(l,u){n&&n.p&&(!e||u&8388608)&&Gr(n,t,l,l[23],e?qr(t,l[23],u,null):Wr(l[23]),null)},i(l){e||(oe(n,l),e=!0)},o(l){ue(n,l),e=!1},d(l){n&&n.d(l)}}}function m8(r){let e,t,n;function l(f){r[16](f)}let u={id:r[1],type:"fill",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],minzoom:r[9],maxzoom:r[10],hoverCursor:r[11],manageHoverState:r[12],eventsIfTopMost:r[13],interactive:r[14],$$slots:{default:[p8]},$$scope:{ctx:r}};return r[0]!==void 0&&(u.hovered=r[0]),e=new c_({props:u}),nn.push(()=>no(e,"hovered",l)),e.$on("click",r[17]),e.$on("dblclick",r[18]),e.$on("contextmenu",r[19]),e.$on("mouseenter",r[20]),e.$on("mousemove",r[21]),e.$on("mouseleave",r[22]),{c(){Oe(e.$$.fragment)},m(f,a){Be(e,f,a),n=!0},p(f,[a]){const _={};a&2&&(_.id=f[1]),a&4&&(_.source=f[2]),a&8&&(_.sourceLayer=f[3]),a&16&&(_.beforeId=f[4]),a&32&&(_.beforeLayerType=f[5]),a&64&&(_.paint=f[6]),a&128&&(_.layout=f[7]),a&256&&(_.filter=f[8]),a&512&&(_.minzoom=f[9]),a&1024&&(_.maxzoom=f[10]),a&2048&&(_.hoverCursor=f[11]),a&4096&&(_.manageHoverState=f[12]),a&8192&&(_.eventsIfTopMost=f[13]),a&16384&&(_.interactive=f[14]),a&8388608&&(_.$$scope={dirty:a,ctx:f}),!t&&a&1&&(t=!0,_.hovered=f[0],ro(()=>t=!1)),e.$set(_)},i(f){n||(oe(e.$$.fragment,f),n=!0)},o(f){ue(e.$$.fragment,f),n=!1},d(f){Fe(e,f)}}}function g8(r,e,t){let{$$slots:n={},$$scope:l}=e,{id:u=Rh("fill")}=e,{source:f=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:_=void 0}=e,{beforeLayerType:x=void 0}=e,{paint:k}=e,{layout:S=void 0}=e,{filter:C=void 0}=e,{minzoom:z=void 0}=e,{maxzoom:R=void 0}=e,{hoverCursor:D=void 0}=e,{manageHoverState:P=!1}=e,{hovered:B=null}=e,{eventsIfTopMost:N=!1}=e,{interactive:V=!0}=e;function U(ne){B=ne,t(0,B)}function te(ne){fr.call(this,r,ne)}function le(ne){fr.call(this,r,ne)}function H(ne){fr.call(this,r,ne)}function J(ne){fr.call(this,r,ne)}function ye(ne){fr.call(this,r,ne)}function ze(ne){fr.call(this,r,ne)}return r.$$set=ne=>{"id"in ne&&t(1,u=ne.id),"source"in ne&&t(2,f=ne.source),"sourceLayer"in ne&&t(3,a=ne.sourceLayer),"beforeId"in ne&&t(4,_=ne.beforeId),"beforeLayerType"in ne&&t(5,x=ne.beforeLayerType),"paint"in ne&&t(6,k=ne.paint),"layout"in ne&&t(7,S=ne.layout),"filter"in ne&&t(8,C=ne.filter),"minzoom"in ne&&t(9,z=ne.minzoom),"maxzoom"in ne&&t(10,R=ne.maxzoom),"hoverCursor"in ne&&t(11,D=ne.hoverCursor),"manageHoverState"in ne&&t(12,P=ne.manageHoverState),"hovered"in ne&&t(0,B=ne.hovered),"eventsIfTopMost"in ne&&t(13,N=ne.eventsIfTopMost),"interactive"in ne&&t(14,V=ne.interactive),"$$scope"in ne&&t(23,l=ne.$$scope)},[B,u,f,a,_,x,k,S,C,z,R,D,P,N,V,n,U,te,le,H,J,ye,ze,l]}class _8 extends Zt{constructor(e){super(),Wt(this,e,g8,m8,Vt,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}function y8(r,e,t,n,l){let u=!1;r.getSource(e)&&(u=!0,r.removeSource(e));const f=()=>{n(e)&&(r.addSource(e,t),l())};if(u){const a=()=>{e&&(r.getSource(e)?setTimeout(a,1):f())};a()}else f()}function v8(r,e,t){Db().then(()=>{let n=Hi(r);if(!n)return;n.getSource(e)===t&&n.removeSource(e)})}function db(r){let e=r[0],t,n,l=pb(r);return{c(){l.c(),t=Hn()},m(u,f){l.m(u,f),me(u,t,f),n=!0},p(u,f){f&1&&Vt(e,e=u[0])?(vr(),ue(l,1,1,It),br(),l=pb(u),l.c(),oe(l,1),l.m(t.parentNode,t)):l.p(u,f)},i(u){n||(oe(l),n=!0)},o(u){ue(l),n=!1},d(u){u&&pe(t),l.d(u)}}}function pb(r){let e;const t=r[15].default,n=$r(t,r,r[14],null);return{c(){n&&n.c()},m(l,u){n&&n.m(l,u),e=!0},p(l,u){n&&n.p&&(!e||u&16384)&&Gr(n,t,l,l[14],e?qr(t,l[14],u,null):Wr(l[14]),null)},i(l){e||(oe(n,l),e=!0)},o(l){ue(n,l),e=!1},d(l){n&&n.d(l)}}}function b8(r){let e,t,n=r[0]&&db(r);return{c(){n&&n.c(),e=Hn()},m(l,u){n&&n.m(l,u),me(l,e,u),t=!0},p(l,[u]){l[0]?n?(n.p(l,u),u&1&&oe(n,1)):(n=db(l),n.c(),oe(n,1),n.m(e.parentNode,e)):n&&(vr(),ue(n,1,1,()=>{n=null}),br())},i(l){t||(oe(n),t=!0)},o(l){ue(n),t=!1},d(l){l&&pe(e),n&&n.d(l)}}}function w8(r,e,t){let n,l,u,{$$slots:f={},$$scope:a}=e,{id:_=Rh("geojson")}=e,{data:x}=e,{generateId:k=!1}=e,{promoteId:S=void 0}=e,{filter:C=void 0}=e,{lineMetrics:z=void 0}=e,{cluster:R=void 0}=e;const{map:D,cluster:P,self:B}=i8();pt(r,D,U=>t(13,l=U)),pt(r,P,U=>t(16,u=U)),pt(r,B,U=>t(0,n=U));let N,V=!0;return ni(()=>{n&&N&&l&&(v8(D,n,N),Lt(B,n=null,n),t(11,N=void 0))}),r.$$set=U=>{"id"in U&&t(4,_=U.id),"data"in U&&t(5,x=U.data),"generateId"in U&&t(6,k=U.generateId),"promoteId"in U&&t(7,S=U.promoteId),"filter"in U&&t(8,C=U.filter),"lineMetrics"in U&&t(9,z=U.lineMetrics),"cluster"in U&&t(10,R=U.cluster),"$$scope"in U&&t(14,a=U.$$scope)},r.$$.update=()=>{r.$$.dirty&1024&&Lt(P,u=R,u),r.$$.dirty&12273&&l&&n!==_&&(Lt(B,n=_,n),y8(l,n,il({type:"geojson",data:x,filter:C,lineMetrics:z,generateId:k,promoteId:S,cluster:!!R,clusterMinPoints:R==null?void 0:R.minPoints,clusterMaxZoom:R==null?void 0:R.maxZoom,clusterRadius:R==null?void 0:R.radius,clusterProperties:R==null?void 0:R.properties}),U=>l&&U===n,()=>{n&&(t(11,N=l==null?void 0:l.getSource(n)),t(12,V=!0))})),r.$$.dirty&8208&&(l==null||l.on("style.load",()=>{t(11,N=l==null?void 0:l.getSource(_))})),r.$$.dirty&6176&&N&&(V?t(12,V=!1):N.setData(x)),r.$$.dirty&3072&&(N==null||N.setClusterOptions(il({cluster:!!R,clusterMaxZoom:R==null?void 0:R.maxZoom,clusterRadius:R==null?void 0:R.radius})))},[n,D,P,B,_,x,k,S,C,z,R,N,V,l,a,f]}class x8 extends Zt{constructor(e){super(),Wt(this,e,w8,b8,Vt,{id:4,data:5,generateId:6,promoteId:7,filter:8,lineMetrics:9,cluster:10})}}function S8(r){let e;const t=r[15].default,n=$r(t,r,r[23],null);return{c(){n&&n.c()},m(l,u){n&&n.m(l,u),e=!0},p(l,u){n&&n.p&&(!e||u&8388608)&&Gr(n,t,l,l[23],e?qr(t,l[23],u,null):Wr(l[23]),null)},i(l){e||(oe(n,l),e=!0)},o(l){ue(n,l),e=!1},d(l){n&&n.d(l)}}}function k8(r){let e,t,n;function l(f){r[16](f)}let u={id:r[1],type:"line",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],minzoom:r[9],maxzoom:r[10],hoverCursor:r[11],manageHoverState:r[12],eventsIfTopMost:r[13],interactive:r[14],$$slots:{default:[S8]},$$scope:{ctx:r}};return r[0]!==void 0&&(u.hovered=r[0]),e=new c_({props:u}),nn.push(()=>no(e,"hovered",l)),e.$on("click",r[17]),e.$on("dblclick",r[18]),e.$on("contextmenu",r[19]),e.$on("mouseenter",r[20]),e.$on("mousemove",r[21]),e.$on("mouseleave",r[22]),{c(){Oe(e.$$.fragment)},m(f,a){Be(e,f,a),n=!0},p(f,[a]){const _={};a&2&&(_.id=f[1]),a&4&&(_.source=f[2]),a&8&&(_.sourceLayer=f[3]),a&16&&(_.beforeId=f[4]),a&32&&(_.beforeLayerType=f[5]),a&64&&(_.paint=f[6]),a&128&&(_.layout=f[7]),a&256&&(_.filter=f[8]),a&512&&(_.minzoom=f[9]),a&1024&&(_.maxzoom=f[10]),a&2048&&(_.hoverCursor=f[11]),a&4096&&(_.manageHoverState=f[12]),a&8192&&(_.eventsIfTopMost=f[13]),a&16384&&(_.interactive=f[14]),a&8388608&&(_.$$scope={dirty:a,ctx:f}),!t&&a&1&&(t=!0,_.hovered=f[0],ro(()=>t=!1)),e.$set(_)},i(f){n||(oe(e.$$.fragment,f),n=!0)},o(f){ue(e.$$.fragment,f),n=!1},d(f){Fe(e,f)}}}function T8(r,e,t){let{$$slots:n={},$$scope:l}=e,{id:u=Rh("line")}=e,{source:f=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:_=void 0}=e,{beforeLayerType:x=void 0}=e,{paint:k}=e,{layout:S=void 0}=e,{filter:C=void 0}=e,{minzoom:z=void 0}=e,{maxzoom:R=void 0}=e,{hoverCursor:D=void 0}=e,{manageHoverState:P=!1}=e,{hovered:B=null}=e,{eventsIfTopMost:N=!1}=e,{interactive:V=!0}=e;function U(ne){B=ne,t(0,B)}function te(ne){fr.call(this,r,ne)}function le(ne){fr.call(this,r,ne)}function H(ne){fr.call(this,r,ne)}function J(ne){fr.call(this,r,ne)}function ye(ne){fr.call(this,r,ne)}function ze(ne){fr.call(this,r,ne)}return r.$$set=ne=>{"id"in ne&&t(1,u=ne.id),"source"in ne&&t(2,f=ne.source),"sourceLayer"in ne&&t(3,a=ne.sourceLayer),"beforeId"in ne&&t(4,_=ne.beforeId),"beforeLayerType"in ne&&t(5,x=ne.beforeLayerType),"paint"in ne&&t(6,k=ne.paint),"layout"in ne&&t(7,S=ne.layout),"filter"in ne&&t(8,C=ne.filter),"minzoom"in ne&&t(9,z=ne.minzoom),"maxzoom"in ne&&t(10,R=ne.maxzoom),"hoverCursor"in ne&&t(11,D=ne.hoverCursor),"manageHoverState"in ne&&t(12,P=ne.manageHoverState),"hovered"in ne&&t(0,B=ne.hovered),"eventsIfTopMost"in ne&&t(13,N=ne.eventsIfTopMost),"interactive"in ne&&t(14,V=ne.interactive),"$$scope"in ne&&t(23,l=ne.$$scope)},[B,u,f,a,_,x,k,S,C,z,R,D,P,N,V,n,U,te,le,H,J,ye,ze,l]}class E8 extends Zt{constructor(e){super(),Wt(this,e,T8,k8,Vt,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}function C8(r){let e,t,n,l,u,f;return e=new _8({props:{id:"edit-polygon-fill",filter:Wz,paint:{"fill-color":"red","fill-opacity":["case",["boolean",["get","hover"],"false"],1,.5]}}}),n=new E8({props:{id:"edit-polygon-lines",filter:Zz,paint:{"line-color":"black","line-width":8,"line-opacity":.5}}}),u=new d8({props:{id:"edit-polygon-vertices",filter:Hz,paint:{"circle-color":"black","circle-opacity":["case",["has","hovered"],1,.5],"circle-radius":10}}}),{c(){Oe(e.$$.fragment),t=Ue(),Oe(n.$$.fragment),l=Ue(),Oe(u.$$.fragment)},m(a,_){Be(e,a,_),me(a,t,_),Be(n,a,_),me(a,l,_),Be(u,a,_),f=!0},p:It,i(a){f||(oe(e.$$.fragment,a),oe(n.$$.fragment,a),oe(u.$$.fragment,a),f=!0)},o(a){ue(e.$$.fragment,a),ue(n.$$.fragment,a),ue(u.$$.fragment,a),f=!1},d(a){a&&(pe(t),pe(l)),Fe(e,a),Fe(n,a),Fe(u,a)}}}function M8(r){let e,t;return e=new x8({props:{data:r[0],$$slots:{default:[C8]},$$scope:{ctx:r}}}),{c(){Oe(e.$$.fragment)},m(n,l){Be(e,n,l),t=!0},p(n,[l]){const u={};l&1&&(u.data=n[0]),l&2&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(oe(e.$$.fragment,n),t=!0)},o(n){ue(e.$$.fragment,n),t=!1},d(n){Fe(e,n)}}}function I8(r,e,t){let n;return pt(r,Ux,l=>t(0,n=l)),[n]}class A8 extends Zt{constructor(e){super(),Wt(this,e,I8,M8,Vt,{})}}function L8(r){let e,t,n,l,u,f,a;return{c(){e=ce("button"),e.textContent="Import current view",t=Ue(),n=ce("i"),n.textContent="or...",l=Ue(),u=ce("button"),u.textContent="Draw an area to import on the map",Te(e,"type","button"),Te(u,"type","button")},m(_,x){me(_,e,x),me(_,t,x),me(_,n,x),me(_,l,x),me(_,u,x),f||(a=[Ct(e,"click",r[2]),Ct(u,"click",r[3])],f=!0)},p:It,i:It,o:It,d(_){_&&(pe(e),pe(t),pe(n),pe(l),pe(u)),f=!1,yn(a)}}}function P8(r){let e,t;return e=new t8({props:{polygonTool:r[0]}}),{c(){Oe(e.$$.fragment)},m(n,l){Be(e,n,l),t=!0},p(n,l){const u={};l&1&&(u.polygonTool=n[0]),e.$set(u)},i(n){t||(oe(e.$$.fragment,n),t=!0)},o(n){ue(e.$$.fragment,n),t=!1},d(n){Fe(e,n)}}}function z8(r){let e,t,n,l,u,f,a,_,x;const k=[P8,L8],S=[];function C(z,R){return z[0]?0:1}return e=C(r),t=S[e]=k[e](r),{c(){t.c(),n=Ue(),l=ce("label"),u=ce("input"),f=tt(`Save a copy of the osm.xml
  after importing`),Te(u,"type","checkbox")},m(z,R){S[e].m(z,R),me(z,n,R),me(z,l,R),re(l,u),u.checked=r[1],re(l,f),a=!0,_||(x=Ct(u,"change",r[5]),_=!0)},p(z,[R]){let D=e;e=C(z),e===D?S[e].p(z,R):(vr(),ue(S[D],1,1,()=>{S[D]=null}),br(),t=S[e],t?t.p(z,R):(t=S[e]=k[e](z),t.c()),oe(t,1),t.m(n.parentNode,n)),R&2&&(u.checked=z[1])},i(z){a||(oe(t),a=!0)},o(z){ue(t),a=!1},d(z){z&&(pe(n),pe(l)),S[e].d(z),_=!1,x()}}}function Wu(r){return[r.lng,r.lat]}function D8(r,e,t){let{map:n}=e;const l=us();let u=null,f=!1;async function a(C){try{l("loading","Loading from Overpass");let R=await(await fetch(Gx(C))).text();f&&md("osm.xml",R),l("gotXml",{xml:R,boundary:C})}catch(z){l("error",z.toString())}}function _(){let C=n.getBounds();return{type:"Feature",properties:{},geometry:{coordinates:[[Wu(C.getSouthWest()),Wu(C.getNorthWest()),Wu(C.getNorthEast()),Wu(C.getSouthEast()),Wu(C.getSouthWest())]],type:"Polygon"}}}async function x(){if(n){if(n.getZoom()<13){l("error","Zoom in more to import");return}await a(_())}}function k(){n&&(t(0,u=new Kz(n)),u.startNew(),u.addEventListenerSuccess(async C=>{t(0,u=null),await a(C)}),u.addEventListenerFailure(()=>{t(0,u=null)}))}function S(){f=this.checked,t(1,f)}return r.$$set=C=>{"map"in C&&t(4,n=C.map)},[u,f,x,k,n,S]}class R8 extends Zt{constructor(e){super(),Wt(this,e,D8,z8,Vt,{map:4})}}function Gx(r){let e='poly:"';for(let[n,l]of r.geometry.coordinates[0])e+=`${l} ${n} `;return e=e.slice(0,-1)+'"',`https://overpass-api.de/api/interpreter?data=${`(nwr(${e}); node(w)->.x; <;); out meta;`}`}async function xg(r){fa.set(r);try{let e=JSON.parse(window.localStorage.getItem(r));console.time("get OSM input");let[t,n]=await B8(e);console.timeEnd("get OSM input"),console.time("load"),Yn.set(new Nb(new Uint8Array(t),n,e.study_area_name||void 0)),Hi(Yn).loadSavefile(e),console.timeEnd("load"),Wx()}catch(e){window.alert(`Couldn't open project: ${e}`),fa.set("")}}async function B8(r){if(r.study_area_name){let e=Hi(ph)?`/osm/${r.study_area_name}.pbf`:`https://assets.od2net.org/severance_pbfs/${r.study_area_name}.pbf`;console.log(`Grabbing ${e}`);let n=await(await fetch(e)).arrayBuffer(),l=Hi(ph)?`/boundaries/${r.study_area_name}.geojson`:`https://assets.od2net.org/boundaries/${r.study_area_name}.geojson`,f=await(await fetch(l)).json();return[n,f]}else{console.log("Grabbing from Overpass");let e=r.features.find(l=>l.properties.kind=="study_area_boundary");return[await(await fetch(Gx(e))).arrayBuffer(),e]}}function Wx(){or.set({mode:"network"}),Pc.set(new a4(Hi(cs),Hi(Yn).toRouteSnapper(),Tr(sh()),Tr(!0),Tr(0))),Hi(cs).fitBounds(Array.from(Hi(Yn).getBounds()),{animate:!1}),mh.set(Pm()),gh.set(Pm()),Um.set(Pm())}function Pm(){let r=Hi(Yn).getBounds(),e=r[0]+Math.random()*(r[2]-r[0]),t=r[1]+Math.random()*(r[3]-r[1]);return new ga.LngLat(e,t)}function mb(r,e,t){const n=r.slice();return n[18]=e[t][0],n[19]=e[t][1],n}function gb(r,e,t){const n=r.slice();return n[22]=e[t],n}function F8(r){let e;return{c(){e=ce("div"),e.innerHTML='<nav aria-label="breadcrumb"><ul><li>Choose project</li></ul></nav>',Te(e,"slot","top")},m(t,n){me(t,e,n)},p:It,d(t){t&&pe(e)}}}function O8(r){let e;return{c(){e=ce("p"),e.textContent="Waiting for MapLibre and WASM to load..."},m(t,n){me(t,e,n)},p:It,i:It,o:It,d(t){t&&pe(e)}}}function N8(r){let e,t,n,l,u,f,a,_,x,k,S,C,z;t=new Pr({props:{$$slots:{default:[j8]},$$scope:{ctx:r}}}),t.$on("click",r[10]);let R=Jn(r[2].entries()),D=[];for(let B=0;B<R.length;B+=1)D[B]=yb(mb(r,R,B));const P=B=>ue(D[B],1,1,()=>{D[B]=null});return{c(){e=ce("div"),Oe(t.$$.fragment),n=Ue(),l=ce("p"),l.textContent="Load a saved project:",u=Ue(),f=ce("ul");for(let B=0;B<D.length;B+=1)D[B].c();a=Ue(),_=ce("label"),x=tt(`Load a project from a file
        `),k=ce("input"),Te(k,"type","file")},m(B,N){me(B,e,N),Be(t,e,null),me(B,n,N),me(B,l,N),me(B,u,N),me(B,f,N);for(let V=0;V<D.length;V+=1)D[V]&&D[V].m(f,null);me(B,a,N),me(B,_,N),re(_,x),re(_,k),r[14](k),S=!0,C||(z=Ct(k,"change",r[6]),C=!0)},p(B,N){const V={};if(N&33554432&&(V.$$scope={dirty:N,ctx:B}),t.$set(V),N&900){R=Jn(B[2].entries());let U;for(U=0;U<R.length;U+=1){const te=mb(B,R,U);D[U]?(D[U].p(te,N),oe(D[U],1)):(D[U]=yb(te),D[U].c(),oe(D[U],1),D[U].m(f,null))}for(vr(),U=R.length;U<D.length;U+=1)P(U);br()}},i(B){if(!S){oe(t.$$.fragment,B);for(let N=0;N<R.length;N+=1)oe(D[N]);S=!0}},o(B){ue(t.$$.fragment,B),D=D.filter(Boolean);for(let N=0;N<D.length;N+=1)ue(D[N]);S=!1},d(B){B&&(pe(e),pe(n),pe(l),pe(u),pe(f),pe(a),pe(_)),Fe(t),Bs(D,B),r[14](null),C=!1,z()}}}function j8(r){let e;return{c(){e=tt("New project")},m(t,n){me(t,e,n)},d(t){t&&pe(e)}}}function U8(r){let e=r[22].slice(4)+"",t;return{c(){t=tt(e)},m(n,l){me(n,t,l)},p(n,l){l&4&&e!==(e=n[22].slice(4)+"")&&Ar(t,e)},d(n){n&&pe(t)}}}function _b(r){let e,t,n,l,u,f,a,_,x,k,S;function C(){return r[11](r[22])}n=new Pr({props:{$$slots:{default:[U8]},$$scope:{ctx:r}}}),n.$on("click",C);function z(){return r[12](r[22])}function R(){return r[13](r[22])}return{c(){e=ce("li"),t=ce("span"),Oe(n.$$.fragment),l=Ue(),u=ce("button"),u.innerHTML=`<img src="${Fx}" alt="Rename project"/>`,f=Ue(),a=ce("button"),a.innerHTML=`<img src="${Bx}" alt="Delete project"/>`,_=Ue(),Te(u,"class","secondary"),Te(a,"class","secondary"),pn(t,"display","flex"),pn(t,"justify-content","space-between")},m(D,P){me(D,e,P),re(e,t),Be(n,t,null),re(t,l),re(t,u),re(t,f),re(t,a),re(e,_),x=!0,k||(S=[Ct(u,"click",z),Ct(a,"click",R)],k=!0)},p(D,P){r=D;const B={};P&33554436&&(B.$$scope={dirty:P,ctx:r}),n.$set(B)},i(D){x||(oe(n.$$.fragment,D),x=!0)},o(D){ue(n.$$.fragment,D),x=!1},d(D){D&&pe(e),Fe(n),k=!1,yn(S)}}}function yb(r){let e,t=(r[18]??"custom area")+"",n,l,u,f,a=Jn(r[19]),_=[];for(let k=0;k<a.length;k+=1)_[k]=_b(gb(r,a,k));const x=k=>ue(_[k],1,1,()=>{_[k]=null});return{c(){e=ce("u"),n=tt(t),l=Ue();for(let k=0;k<_.length;k+=1)_[k].c();u=Hn()},m(k,S){me(k,e,S),re(e,n),me(k,l,S);for(let C=0;C<_.length;C+=1)_[C]&&_[C].m(k,S);me(k,u,S),f=!0},p(k,S){if((!f||S&4)&&t!==(t=(k[18]??"custom area")+"")&&Ar(n,t),S&900){a=Jn(k[19]);let C;for(C=0;C<a.length;C+=1){const z=gb(k,a,C);_[C]?(_[C].p(z,S),oe(_[C],1)):(_[C]=_b(z),_[C].c(),oe(_[C],1),_[C].m(u.parentNode,u))}for(vr(),C=a.length;C<_.length;C+=1)x(C);br()}},i(k){if(!f){for(let S=0;S<a.length;S+=1)oe(_[S]);f=!0}},o(k){_=_.filter(Boolean);for(let S=0;S<_.length;S+=1)ue(_[S]);f=!1},d(k){k&&(pe(e),pe(l),pe(u)),Bs(_,k)}}}function V8(r){let e,t,n,l;const u=[N8,O8],f=[];function a(_,x){return _[4]&&_[0]?0:1}return t=a(r),n=f[t]=u[t](r),{c(){e=ce("div"),n.c(),Te(e,"slot","sidebar")},m(_,x){me(_,e,x),f[t].m(e,null),l=!0},p(_,x){let k=t;t=a(_),t===k?f[t].p(_,x):(vr(),ue(f[k],1,1,()=>{f[k]=null}),br(),n=f[t],n?n.p(_,x):(n=f[t]=u[t](_),n.c()),oe(n,1),n.m(e,null))},i(_){l||(oe(n),l=!0)},o(_){ue(n),l=!1},d(_){_&&pe(e),f[t].d()}}}function $8(r){let e,t,n,l;return e=new Bb({props:{loading:r[1]}}),n=new hs({props:{$$slots:{sidebar:[V8],top:[F8]},$$scope:{ctx:r}}}),{c(){Oe(e.$$.fragment),t=Ue(),Oe(n.$$.fragment)},m(u,f){Be(e,u,f),me(u,t,f),Be(n,u,f),l=!0},p(u,[f]){const a={};f&2&&(a.loading=u[1]),e.$set(a);const _={};f&33554493&&(_.$$scope={dirty:f,ctx:u}),n.$set(_)},i(u){l||(oe(e.$$.fragment,u),oe(n.$$.fragment,u),l=!0)},o(u){ue(e.$$.fragment,u),ue(n.$$.fragment,u),l=!1},d(u){u&&pe(t),Fe(e,u),Fe(n,u)}}}function Xf(){let r=new Map;for(let e=0;e<window.localStorage.length;e++){let t=window.localStorage.key(e);if(t.startsWith("ltn_")){let n="";try{n=JSON.parse(window.localStorage.getItem(t)).study_area_name}catch{}r.has(n)||r.set(n,[]),r.get(n).push(t)}}return r}function q8(r,e,t){let n,l,u,f,a;pt(r,fa,te=>t(15,n=te)),pt(r,Pc,te=>t(16,l=te)),pt(r,Yn,te=>t(17,u=te)),pt(r,cs,te=>t(4,f=te)),pt(r,or,te=>t(5,a=te));let{wasmReady:_}=e,x="";Lt(Yn,u=null,u),Lt(Pc,l=null,l),Lt(fa,n="",n);let k=Xf(),S;async function C(te){let le="ltn_"+S.files[0].name;t(1,x=`Loading from file ${le}`),window.localStorage.setItem(le,await S.files[0].text()),t(2,k=Xf()),await xg(le),t(1,x="")}function z(te){window.confirm(`Really delete project ${te}? You can't undo this.`)&&(window.localStorage.removeItem(te),t(2,k=Xf()))}function R(te){let le=window.prompt(`Rename project ${te} to what?`,te);if(le){le.startsWith("ltn_")||(le=`ltn_${le}`);let H=window.localStorage.getItem(te);window.localStorage.setItem(le,H),window.localStorage.removeItem(te),t(2,k=Xf())}}async function D(te){t(1,x=`Loading project ${te}`),await xg(te),t(1,x="")}const P=()=>Lt(or,a={mode:"new-project"},a),B=te=>D(te),N=te=>R(te),V=te=>z(te);function U(te){nn[te?"unshift":"push"](()=>{S=te,t(3,S)})}return r.$$set=te=>{"wasmReady"in te&&t(0,_=te.wasmReady)},[_,x,k,S,f,a,C,z,R,D,P,B,N,V,U]}class G8 extends Zt{constructor(e){super(),Wt(this,e,q8,$8,Vt,{wasmReady:0})}}function vb(r,e,t){const n=r.slice();return n[17]=e[t][0],n[18]=e[t][1],n}function bb(r,e,t){const n=r.slice();return n[21]=e[t][0],n[22]=e[t][1],n}function W8(r){let e;return{c(){e=tt("Choose project")},m(t,n){me(t,e,n)},d(t){t&&pe(e)}}}function Z8(r){let e,t,n,l,u,f,a,_;return u=new Pr({props:{$$slots:{default:[W8]},$$scope:{ctx:r}}}),u.$on("click",r[13]),{c(){e=ce("div"),t=ce("nav"),n=ce("ul"),l=ce("li"),Oe(u.$$.fragment),f=Ue(),a=ce("li"),a.textContent="New project",Te(t,"aria-label","breadcrumb"),Te(e,"slot","top")},m(x,k){me(x,e,k),re(e,t),re(t,n),re(n,l),Be(u,l,null),re(n,f),re(n,a),_=!0},p(x,k){const S={};k&33554432&&(S.$$scope={dirty:k,ctx:x}),u.$set(S)},i(x){_||(oe(u.$$.fragment,x),_=!0)},o(x){ue(u.$$.fragment,x),_=!1},d(x){x&&pe(e),Fe(u)}}}function wb(r){let e,t,n,l,u,f,a,_,x,k,S,C,z,R;e=new Bb({props:{loading:r[4]}});let D=Jn(r[3]),P=[];for(let B=0;B<D.length;B+=1)P[B]=Sb(vb(r,D,B));return S=new R8({props:{map:r[5]}}),S.$on("gotXml",r[7]),S.$on("loading",r[11]),S.$on("error",r[12]),{c(){Oe(e.$$.fragment),t=Ue(),n=ce("label"),l=tt(`Load a built-in area:
        `),u=ce("select"),f=ce("option");for(let B=0;B<P.length;B+=1)P[B].c();a=Ue(),_=ce("i"),_.textContent="or...",x=Ue(),k=ce("div"),Oe(S.$$.fragment),f.__value="",ti(f,f.__value),r[2]===void 0&&hh(()=>r[9].call(u))},m(B,N){Be(e,B,N),me(B,t,N),me(B,n,N),re(n,l),re(n,u),re(u,f);for(let V=0;V<P.length;V+=1)P[V]&&P[V].m(u,null);dd(u,r[2],!0),me(B,a,N),me(B,_,N),me(B,x,N),me(B,k,N),Be(S,k,null),C=!0,z||(R=[Ct(u,"change",r[9]),Ct(u,"change",r[10])],z=!0)},p(B,N){const V={};if(N&16&&(V.loading=B[4]),e.$set(V),N&8){D=Jn(B[3]);let te;for(te=0;te<D.length;te+=1){const le=vb(B,D,te);P[te]?P[te].p(le,N):(P[te]=Sb(le),P[te].c(),P[te].m(u,null))}for(;te<P.length;te+=1)P[te].d(1);P.length=D.length}N&12&&dd(u,B[2]);const U={};N&32&&(U.map=B[5]),S.$set(U)},i(B){C||(oe(e.$$.fragment,B),oe(S.$$.fragment,B),C=!0)},o(B){ue(e.$$.fragment,B),ue(S.$$.fragment,B),C=!1},d(B){B&&(pe(t),pe(n),pe(a),pe(_),pe(x),pe(k)),Fe(e,B),Bs(P,B),Fe(S),z=!1,yn(R)}}}function xb(r){let e,t=r[22]+"",n,l;return{c(){e=ce("option"),n=tt(t),e.__value=l=r[21],ti(e,e.__value)},m(u,f){me(u,e,f),re(e,n)},p(u,f){f&8&&t!==(t=u[22]+"")&&Ar(n,t),f&8&&l!==(l=u[21])&&(e.__value=l,ti(e,e.__value))},d(u){u&&pe(e)}}}function Sb(r){let e,t,n=Jn(r[18]),l=[];for(let u=0;u<n.length;u+=1)l[u]=xb(bb(r,n,u));return{c(){e=ce("optgroup");for(let u=0;u<l.length;u+=1)l[u].c();Te(e,"label",t=r[17])},m(u,f){me(u,e,f);for(let a=0;a<l.length;a+=1)l[a]&&l[a].m(e,null)},p(u,f){if(f&8){n=Jn(u[18]);let a;for(a=0;a<n.length;a+=1){const _=bb(u,n,a);l[a]?l[a].p(_,f):(l[a]=xb(_),l[a].c(),l[a].m(e,null))}for(;a<l.length;a+=1)l[a].d(1);l.length=n.length}f&8&&t!==(t=u[17])&&Te(e,"label",t)},d(u){u&&pe(e),Bs(l,u)}}}function H8(r){let e,t,n,l,u,f,a,_,x,k=r[1]&&wb(r);return{c(){e=ce("div"),t=ce("div"),n=ce("label"),l=tt(`Project name:
        `),u=ce("input"),f=Ue(),k&&k.c(),Te(u,"type","text"),Te(e,"slot","sidebar")},m(S,C){me(S,e,C),re(e,t),re(t,n),re(n,l),re(n,u),ti(u,r[1]),re(e,f),k&&k.m(e,null),a=!0,_||(x=Ct(u,"input",r[8]),_=!0)},p(S,C){C&2&&u.value!==S[1]&&ti(u,S[1]),S[1]?k?(k.p(S,C),C&2&&oe(k,1)):(k=wb(S),k.c(),oe(k,1),k.m(e,null)):k&&(vr(),ue(k,1,1,()=>{k=null}),br())},i(S){a||(oe(k),a=!0)},o(S){ue(k),a=!1},d(S){S&&pe(e),k&&k.d(),_=!1,x()}}}function X8(r){let e,t,n;return t=new A8({}),{c(){e=ce("div"),Oe(t.$$.fragment),Te(e,"slot","map")},m(l,u){me(l,e,u),Be(t,e,null),n=!0},p:It,i(l){n||(oe(t.$$.fragment,l),n=!0)},o(l){ue(t.$$.fragment,l),n=!1},d(l){l&&pe(e),Fe(t)}}}function K8(r){let e,t;return e=new hs({props:{$$slots:{map:[X8],sidebar:[H8],top:[Z8]},$$scope:{ctx:r}}}),{c(){Oe(e.$$.fragment)},m(n,l){Be(e,n,l),t=!0},p(n,[l]){const u={};l&33554558&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(oe(e.$$.fragment,n),t=!0)},o(n){ue(e.$$.fragment,n),t=!1},d(n){Fe(e,n)}}}function J8(r,e,t){let n,l,u,f,a;pt(r,fa,U=>t(14,n=U)),pt(r,Yn,U=>t(15,l=U)),pt(r,ph,U=>t(16,u=U)),pt(r,cs,U=>t(5,f=U)),pt(r,or,U=>t(6,a=U));let _="",x="",k=[],S="";Od(async()=>{let U=await fetch(u?"/osm/areas.json":"https://assets.od2net.org/severance_pbfs/areas.json");t(3,k=await U.json())});function C(U){t(4,S="Loading OSM");try{Lt(Yn,l=new Nb(new TextEncoder().encode(U.detail.xml),U.detail.boundary,void 0),l),Lt(fa,n=`ltn_${_}`,n),Wx(),Tc()}catch(te){window.alert(`Couldn't import from Overpass: ${te}`)}t(4,S="")}async function z(){if(x=="")return;let U=`ltn_${_}`;window.localStorage.setItem(U,JSON.stringify({type:"FeatureCollection",features:[],study_area_name:x})),t(4,S=`Loading pre-clipped OSM area ${x}`),await xg(U),t(4,S="")}function R(){_=this.value,t(1,_)}function D(){x=Ab(this),t(2,x),t(3,k)}return[z,_,x,k,S,f,a,C,R,D,()=>z(),U=>t(4,S=U.detail),U=>window.alert(U.detail),()=>Lt(or,a={mode:"title"},a)]}class Y8 extends Zt{constructor(e){super(),Wt(this,e,J8,K8,Vt,{loadExample:0})}get loadExample(){return this.$$.ctx[0]}}const{window:Q8}=Fd;function eD(r){let e;return{c(){e=tt("Choose project")},m(t,n){me(t,e,n)},d(t){t&&pe(e)}}}function tD(r){let e;return{c(){e=tt("Pick neighbourhood")},m(t,n){me(t,e,n)},d(t){t&&pe(e)}}}function rD(r){let e;return{c(){e=tt("Editing")},m(t,n){me(t,e,n)},d(t){t&&pe(e)}}}function nD(r){let e,t,n,l,u,f,a,_,x,k,S,C,z,R;return u=new Pr({props:{$$slots:{default:[eD]},$$scope:{ctx:r}}}),u.$on("click",r[9]),_=new Pr({props:{$$slots:{default:[tD]},$$scope:{ctx:r}}}),_.$on("click",r[10]),S=new Pr({props:{$$slots:{default:[rD]},$$scope:{ctx:r}}}),S.$on("click",r[5]),{c(){e=ce("div"),t=ce("nav"),n=ce("ul"),l=ce("li"),Oe(u.$$.fragment),f=Ue(),a=ce("li"),Oe(_.$$.fragment),x=Ue(),k=ce("li"),Oe(S.$$.fragment),C=Ue(),z=ce("li"),z.textContent="Viewing shortcuts",Te(t,"aria-label","breadcrumb"),Te(e,"slot","top")},m(D,P){me(D,e,P),re(e,t),re(t,n),re(n,l),Be(u,l,null),re(n,f),re(n,a),Be(_,a,null),re(n,x),re(n,k),Be(S,k,null),re(n,C),re(n,z),R=!0},p(D,P){const B={};P&8192&&(B.$$scope={dirty:P,ctx:D}),u.$set(B);const N={};P&8192&&(N.$$scope={dirty:P,ctx:D}),_.$set(N);const V={};P&8192&&(V.$$scope={dirty:P,ctx:D}),S.$set(V)},i(D){R||(oe(u.$$.fragment,D),oe(_.$$.fragment,D),oe(S.$$.fragment,D),R=!0)},o(D){ue(u.$$.fragment,D),ue(_.$$.fragment,D),ue(S.$$.fragment,D),R=!1},d(D){D&&pe(e),Fe(u),Fe(_),Fe(S)}}}function iD(r){let e,t,n,l,u,f,a,_,x,k=r[0].shortcutIndex+1+"",S,C,z=r[0].gj.features.length+"",R,D,P,B,N,V,U,te,le,H=rn(r[0].gj.features[r[0].shortcutIndex].properties).directness.toFixed(1)+"",J,ye,ze,ne,be;return{c(){e=ce("p"),e.textContent=`This shows all possible shortcuts crossing the blue road you've chosen.
        A shortcut is defined as a route starting and ending outside the
        neighbourhood, but cutting through it. It might not actually be
        considered a "good shortcut" in practice -- this tool doesn't know any
        real traffic patterns; it's just looking for any possible path. This
        view lets you understand the limits of this assumption.`,t=Ue(),n=ce("button"),n.textContent="Pick a different road",l=Ue(),u=ce("div"),f=ce("button"),a=tt("Previous"),x=Ue(),S=tt(k),C=tt(" / "),R=tt(z),D=Ue(),P=ce("button"),B=tt("Next"),V=Ue(),U=ce("p"),te=tt("This shortcut is "),le=ce("b"),J=tt(H),ye=tt("x"),ze=tt(`
        the length of the shortest route using all roads, not just this neighbourhood`),f.disabled=_=r[0].shortcutIndex==0,Te(f,"data-tooltip","Left"),P.disabled=N=r[0].shortcutIndex==r[0].gj.features.length-1,Te(P,"data-tooltip","Right"),pn(u,"display","flex"),pn(u,"justify-content","space-between")},m(He,Ce){me(He,e,Ce),me(He,t,Ce),me(He,n,Ce),me(He,l,Ce),me(He,u,Ce),re(u,f),re(f,a),re(u,x),re(u,S),re(u,C),re(u,R),re(u,D),re(u,P),re(P,B),me(He,V,Ce),me(He,U,Ce),re(U,te),re(U,le),re(le,J),re(le,ye),re(U,ze),ne||(be=[Ct(n,"click",r[8]),Ct(f,"click",r[6]),Ct(P,"click",r[7])],ne=!0)},p(He,Ce){Ce&1&&_!==(_=He[0].shortcutIndex==0)&&(f.disabled=_),Ce&1&&k!==(k=He[0].shortcutIndex+1+"")&&Ar(S,k),Ce&1&&z!==(z=He[0].gj.features.length+"")&&Ar(R,z),Ce&1&&N!==(N=He[0].shortcutIndex==He[0].gj.features.length-1)&&(P.disabled=N),Ce&1&&H!==(H=rn(He[0].gj.features[He[0].shortcutIndex].properties).directness.toFixed(1)+"")&&Ar(J,H)},d(He){He&&(pe(e),pe(t),pe(n),pe(l),pe(u),pe(V),pe(U)),ne=!1,yn(be)}}}function oD(r){let e;return{c(){e=ce("p"),e.textContent="Click a road to see shortcuts"},m(t,n){me(t,e,n)},p:It,d(t){t&&pe(e)}}}function sD(r){let e,t,n,l;t=new Ph({}),t.$on("click",r[5]);function u(_,x){if(_[0].state=="neutral")return oD;if(_[0].state=="chose-road")return iD}let f=u(r),a=f&&f(r);return{c(){e=ce("div"),Oe(t.$$.fragment),n=Ue(),a&&a.c(),Te(e,"slot","sidebar")},m(_,x){me(_,e,x),Be(t,e,null),re(e,n),a&&a.m(e,null),l=!0},p(_,x){f===(f=u(_))&&a?a.p(_,x):(a&&a.d(1),a=f&&f(_),a&&(a.c(),a.m(e,null)))},i(_){l||(oe(t.$$.fragment,_),l=!0)},o(_){ue(t.$$.fragment,_),l=!1},d(_){_&&pe(e),Fe(t),a&&a.d()}}}function aD(r){let e,t,n,l,u,f;return e=new ri({props:{data:kh(JSON.parse(rn(r[2]).renderNeighbourhood())),$$slots:{default:[cD]},$$scope:{ctx:r}}}),n=new ri({props:{data:r[0].gj.features[r[0].shortcutIndex],$$slots:{default:[uD]},$$scope:{ctx:r}}}),u=new ri({props:{data:r[0].roadGj,$$slots:{default:[hD]},$$scope:{ctx:r}}}),{c(){Oe(e.$$.fragment),t=Ue(),Oe(n.$$.fragment),l=Ue(),Oe(u.$$.fragment)},m(a,_){Be(e,a,_),me(a,t,_),Be(n,a,_),me(a,l,_),Be(u,a,_),f=!0},p(a,_){const x={};_&4&&(x.data=kh(JSON.parse(rn(a[2]).renderNeighbourhood()))),_&8192&&(x.$$scope={dirty:_,ctx:a}),e.$set(x);const k={};_&1&&(k.data=a[0].gj.features[a[0].shortcutIndex]),_&8192&&(k.$$scope={dirty:_,ctx:a}),n.$set(k);const S={};_&1&&(S.data=a[0].roadGj),_&8192&&(S.$$scope={dirty:_,ctx:a}),u.$set(S)},i(a){f||(oe(e.$$.fragment,a),oe(n.$$.fragment,a),oe(u.$$.fragment,a),f=!0)},o(a){ue(e.$$.fragment,a),ue(n.$$.fragment,a),ue(u.$$.fragment,a),f=!1},d(a){a&&(pe(t),pe(l)),Fe(e,a),Fe(n,a),Fe(u,a)}}}function lD(r){let e,t;return e=new Gd({props:{gjInput:JSON.parse(rn(r[2]).renderNeighbourhood()),onClickLine:r[3],$$slots:{"line-popup":[dD]},$$scope:{ctx:r}}}),{c(){Oe(e.$$.fragment)},m(n,l){Be(e,n,l),t=!0},p(n,l){const u={};l&4&&(u.gjInput=JSON.parse(rn(n[2]).renderNeighbourhood())),l&8192&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(oe(e.$$.fragment,n),t=!0)},o(n){ue(e.$$.fragment,n),t=!1},d(n){Fe(e,n)}}}function cD(r){let e,t;const n=[bn("cells"),{filter:["==",["get","kind"],"cell"]},{paint:{"fill-color":["get","color"],"fill-opacity":.3}}];let l={};for(let u=0;u<n.length;u+=1)l=mn(l,n[u]);return e=new Ns({props:l}),{c(){Oe(e.$$.fragment)},m(u,f){Be(e,u,f),t=!0},p(u,f){const a={};e.$set(a)},i(u){t||(oe(e.$$.fragment,u),t=!0)},o(u){ue(e.$$.fragment,u),t=!1},d(u){Fe(e,u)}}}function uD(r){let e,t;const n=[bn("shortcuts"),{paint:{"line-width":5,"line-color":"red"}}];let l={};for(let u=0;u<n.length;u+=1)l=mn(l,n[u]);return e=new Ro({props:l}),{c(){Oe(e.$$.fragment)},m(u,f){Be(e,u,f),t=!0},p(u,f){const a={};e.$set(a)},i(u){t||(oe(e.$$.fragment,u),t=!0)},o(u){ue(e.$$.fragment,u),t=!1},d(u){Fe(e,u)}}}function hD(r){let e,t;const n=[bn("shortcuts-focus"),{paint:{"line-width":5,"line-color":"blue"}}];let l={};for(let u=0;u<n.length;u+=1)l=mn(l,n[u]);return e=new Ro({props:l}),{c(){Oe(e.$$.fragment)},m(u,f){Be(e,u,f),t=!0},p(u,f){const a={};e.$set(a)},i(u){t||(oe(e.$$.fragment,u),t=!0)},o(u){ue(e.$$.fragment,u),t=!1},d(u){Fe(e,u)}}}function fD(r){let e,t=r[12].shortcuts+"",n,l,u=(r[12].name??"unnamed road")+"",f;return{c(){e=ce("p"),n=tt(t),l=tt(" shortcuts through "),f=tt(u)},m(a,_){me(a,e,_),re(e,n),re(e,l),re(e,f)},p(a,_){_&4096&&t!==(t=a[12].shortcuts+"")&&Ar(n,t),_&4096&&u!==(u=(a[12].name??"unnamed road")+"")&&Ar(f,u)},d(a){a&&pe(e)}}}function dD(r){let e,t,n;return t=new fs({props:{openOn:"hover",$$slots:{default:[fD,({props:l})=>({12:l}),({props:l})=>l?4096:0]},$$scope:{ctx:r}}}),{c(){e=ce("div"),Oe(t.$$.fragment),Te(e,"slot","line-popup")},m(l,u){me(l,e,u),Be(t,e,null),n=!0},p(l,u){const f={};u&12288&&(f.$$scope={dirty:u,ctx:l}),t.$set(f)},i(l){n||(oe(t.$$.fragment,l),n=!0)},o(l){ue(t.$$.fragment,l),n=!1},d(l){l&&pe(e),Fe(t)}}}function pD(r){let e,t,n,l,u,f;const a=[lD,aD],_=[];function x(k,S){return k[0].state=="neutral"?0:k[0].state=="chose-road"?1:-1}return~(t=x(r))&&(n=_[t]=a[t](r)),u=new zh({}),{c(){e=ce("div"),n&&n.c(),l=Ue(),Oe(u.$$.fragment),Te(e,"slot","map")},m(k,S){me(k,e,S),~t&&_[t].m(e,null),re(e,l),Be(u,e,null),f=!0},p(k,S){let C=t;t=x(k),t===C?~t&&_[t].p(k,S):(n&&(vr(),ue(_[C],1,1,()=>{_[C]=null}),br()),~t?(n=_[t],n?n.p(k,S):(n=_[t]=a[t](k),n.c()),oe(n,1),n.m(e,l)):n=null)},i(k){f||(oe(n),oe(u.$$.fragment,k),f=!0)},o(k){ue(n),ue(u.$$.fragment,k),f=!1},d(k){k&&pe(e),~t&&_[t].d(),Fe(u)}}}function mD(r){let e,t,n,l;return e=new hs({props:{$$slots:{map:[pD],sidebar:[sD],top:[nD]},$$scope:{ctx:r}}}),{c(){Oe(e.$$.fragment)},m(u,f){Be(e,u,f),t=!0,n||(l=Ct(Q8,"keydown",r[4]),n=!0)},p(u,[f]){const a={};f&8199&&(a.$$scope={dirty:f,ctx:u}),e.$set(a)},i(u){t||(oe(e.$$.fragment,u),t=!0)},o(u){ue(e.$$.fragment,u),t=!1},d(u){Fe(e,u),n=!1,l()}}}function gD(r,e,t){let n,l,u;pt(r,or,D=>t(1,n=D)),pt(r,cs,D=>t(11,l=D)),pt(r,Yn,D=>t(2,u=D));let f={state:"neutral"};function a(D,P){let B=JSON.parse(u.getShortcutsCrossingRoad(D.properties.id));if(B.features.length==0){window.alert("No shortcuts here");return}t(0,f={state:"chose-road",roadGj:D,gj:B,shortcutIndex:0})}Od(()=>{l==null||l.keyboard.disable()}),ni(()=>{l==null||l.keyboard.enable()});function _(D){f.state=="chose-road"&&(D.key=="ArrowLeft"&&f.shortcutIndex>0&&(D.stopPropagation(),t(0,f.shortcutIndex--,f)),D.key=="ArrowRight"&&(D.stopPropagation(),f.shortcutIndex!=f.gj.features.length-1&&t(0,f.shortcutIndex++,f)))}function x(){Lt(or,n={mode:"neighbourhood"},n)}function k(){f.state=="chose-road"&&t(0,f.shortcutIndex--,f)}function S(){f.state=="chose-road"&&t(0,f.shortcutIndex++,f)}return[f,n,u,a,_,x,k,S,()=>t(0,f={state:"neutral"}),()=>Lt(or,n={mode:"title"},n),()=>Lt(or,n={mode:"network"},n)]}class _D extends Zt{constructor(e){super(),Wt(this,e,gD,mD,Vt,{})}}function yD(r){let e;return{c(){e=tt("Choose project")},m(t,n){me(t,e,n)},d(t){t&&pe(e)}}}function vD(r){let e;return{c(){e=tt("Pick neighbourhood")},m(t,n){me(t,e,n)},d(t){t&&pe(e)}}}function bD(r){let e;return{c(){e=tt("Editing")},m(t,n){me(t,e,n)},d(t){t&&pe(e)}}}function wD(r){let e,t,n,l,u,f,a,_,x,k,S,C,z,R;return u=new Pr({props:{$$slots:{default:[yD]},$$scope:{ctx:r}}}),u.$on("click",r[11]),_=new Pr({props:{$$slots:{default:[vD]},$$scope:{ctx:r}}}),_.$on("click",r[12]),S=new Pr({props:{$$slots:{default:[bD]},$$scope:{ctx:r}}}),S.$on("click",r[6]),{c(){e=ce("div"),t=ce("nav"),n=ce("ul"),l=ce("li"),Oe(u.$$.fragment),f=Ue(),a=ce("li"),Oe(_.$$.fragment),x=Ue(),k=ce("li"),Oe(S.$$.fragment),C=Ue(),z=ce("li"),z.textContent="Impact routing to one destination",Te(t,"aria-label","breadcrumb"),Te(e,"slot","top")},m(D,P){me(D,e,P),re(e,t),re(t,n),re(n,l),Be(u,l,null),re(n,f),re(n,a),Be(_,a,null),re(n,x),re(n,k),Be(S,k,null),re(n,C),re(n,z),R=!0},p(D,P){const B={};P&131072&&(B.$$scope={dirty:P,ctx:D}),u.$set(B);const N={};P&131072&&(N.$$scope={dirty:P,ctx:D}),_.$set(N);const V={};P&131072&&(V.$$scope={dirty:P,ctx:D}),S.$set(V)},i(D){R||(oe(u.$$.fragment,D),oe(_.$$.fragment,D),oe(S.$$.fragment,D),R=!0)},o(D){ue(u.$$.fragment,D),ue(_.$$.fragment,D),ue(S.$$.fragment,D),R=!1},d(D){D&&pe(e),Fe(u),Fe(_),Fe(S)}}}function xD(r){let e,t,n,l,u,f,a,_,x,k=r[4].highest_ratio.toFixed(1)+"",S,C;return t=new Ph({}),t.$on("click",r[6]),{c(){e=ce("div"),Oe(t.$$.fragment),n=Ue(),l=ce("p"),l.textContent=`This shows the change in driving time to one destination from everywhere
      within the neighbourhood. Drag the pin aroun to change that destination.`,u=Ue(),f=ce("p"),f.textContent="TODO: It's just distance right now, not time",a=Ue(),_=ce("p"),x=tt("Highest ratio is "),S=tt(k),Te(e,"slot","sidebar")},m(z,R){me(z,e,R),Be(t,e,null),re(e,n),re(e,l),re(e,u),re(e,f),re(e,a),re(e,_),re(_,x),re(_,S),C=!0},p(z,R){(!C||R&16)&&k!==(k=z[4].highest_ratio.toFixed(1)+"")&&Ar(S,k)},i(z){C||(oe(t.$$.fragment,z),C=!0)},o(z){ue(t.$$.fragment,z),C=!1},d(z){z&&pe(e),Fe(t)}}}function SD(r){let e,t;const n=[bn("cells"),{filter:["==",["get","kind"],"cell"]},{paint:{"fill-color":["get","color"],"fill-opacity":.6}}];let l={};for(let u=0;u<n.length;u+=1)l=mn(l,n[u]);return e=new Ns({props:l}),{c(){Oe(e.$$.fragment)},m(u,f){Be(e,u,f),t=!0},p(u,f){const a={};e.$set(a)},i(u){t||(oe(e.$$.fragment,u),t=!0)},o(u){ue(e.$$.fragment,u),t=!1},d(u){Fe(e,u)}}}function kD(r){let e,t=(r[16].distance_after/r[16].distance_before).toFixed(1)+"",n;return{c(){e=tt("Ratio "),n=tt(t)},m(l,u){me(l,e,u),me(l,n,u)},p(l,u){u&65536&&t!==(t=(l[16].distance_after/l[16].distance_before).toFixed(1)+"")&&Ar(n,t)},d(l){l&&(pe(e),pe(n))}}}function TD(r){let e,t;return e=new fs({props:{openOn:"hover",$$slots:{default:[kD,({props:n})=>({16:n}),({props:n})=>n?65536:0]},$$scope:{ctx:r}}}),{c(){Oe(e.$$.fragment)},m(n,l){Be(e,n,l),t=!0},p(n,l){const u={};l&196608&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(oe(e.$$.fragment,n),t=!0)},o(n){ue(e.$$.fragment,n),t=!1},d(n){Fe(e,n)}}}function ED(r){let e,t,n;const l=[bn("interior-roads"),{paint:{"line-color":["interpolate-hcl",["linear"],["/",["get","distance_after"],["get","distance_before"]],1,"white",r[4].highest_ratio,"red"],"line-width":5}},{manageHoverState:!0}];function u(a){r[8](a)}let f={$$slots:{default:[TD]},$$scope:{ctx:r}};for(let a=0;a<l.length;a+=1)f=mn(f,l[a]);return r[0]!==void 0&&(f.hovered=r[0]),e=new Ro({props:f}),nn.push(()=>no(e,"hovered",u)),e.$on("click",r[9]),{c(){Oe(e.$$.fragment)},m(a,_){Be(e,a,_),n=!0},p(a,_){const x=_&16?pd(l,[l[0],{paint:{"line-color":["interpolate-hcl",["linear"],["/",["get","distance_after"],["get","distance_before"]],1,"white",a[4].highest_ratio,"red"],"line-width":5}},l[2]]):{};_&131072&&(x.$$scope={dirty:_,ctx:a}),!t&&_&1&&(t=!0,x.hovered=a[0],ro(()=>t=!1)),e.$set(x)},i(a){n||(oe(e.$$.fragment,a),n=!0)},o(a){ue(e.$$.fragment,a),n=!1},d(a){Fe(e,a)}}}function CD(r){let e,t;const n=[bn("compare-route"),{paint:{"line-width":10,"line-color":Tw(["get","kind"],{before:"red",after:"blue"},"red")}}];let l={};for(let u=0;u<n.length;u+=1)l=mn(l,n[u]);return e=new Ro({props:l}),{c(){Oe(e.$$.fragment)},m(u,f){Be(e,u,f),t=!0},p(u,f){const a={};e.$set(a)},i(u){t||(oe(e.$$.fragment,u),t=!0)},o(u){ue(e.$$.fragment,u),t=!1},d(u){Fe(e,u)}}}function MD(r){let e;return{c(){e=ce("span"),e.textContent="X",Te(e,"class","dot svelte-1gcxp27")},m(t,n){me(t,e,n)},p:It,d(t){t&&pe(e)}}}function ID(r){let e,t,n,l,u,f,a,_,x,k,S,C;t=new ri({props:{data:kh(JSON.parse(rn(r[2]).renderNeighbourhood())),$$slots:{default:[SD]},$$scope:{ctx:r}}}),l=new ri({props:{data:r[4],generateId:!0,$$slots:{default:[ED]},$$scope:{ctx:r}}}),f=new ri({props:{data:r[3],$$slots:{default:[CD]},$$scope:{ctx:r}}}),_=new zh({});function z(D){r[10](D)}let R={draggable:!0,$$slots:{default:[MD]},$$scope:{ctx:r}};return r[1]!==void 0&&(R.lngLat=r[1]),k=new yh({props:R}),nn.push(()=>no(k,"lngLat",z)),{c(){e=ce("div"),Oe(t.$$.fragment),n=Ue(),Oe(l.$$.fragment),u=Ue(),Oe(f.$$.fragment),a=Ue(),Oe(_.$$.fragment),x=Ue(),Oe(k.$$.fragment),Te(e,"slot","map")},m(D,P){me(D,e,P),Be(t,e,null),re(e,n),Be(l,e,null),re(e,u),Be(f,e,null),re(e,a),Be(_,e,null),re(e,x),Be(k,e,null),C=!0},p(D,P){const B={};P&4&&(B.data=kh(JSON.parse(rn(D[2]).renderNeighbourhood()))),P&131072&&(B.$$scope={dirty:P,ctx:D}),t.$set(B);const N={};P&16&&(N.data=D[4]),P&131089&&(N.$$scope={dirty:P,ctx:D}),l.$set(N);const V={};P&8&&(V.data=D[3]),P&131072&&(V.$$scope={dirty:P,ctx:D}),f.$set(V);const U={};P&131072&&(U.$$scope={dirty:P,ctx:D}),!S&&P&2&&(S=!0,U.lngLat=D[1],ro(()=>S=!1)),k.$set(U)},i(D){C||(oe(t.$$.fragment,D),oe(l.$$.fragment,D),oe(f.$$.fragment,D),oe(_.$$.fragment,D),oe(k.$$.fragment,D),C=!0)},o(D){ue(t.$$.fragment,D),ue(l.$$.fragment,D),ue(f.$$.fragment,D),ue(_.$$.fragment,D),ue(k.$$.fragment,D),C=!1},d(D){D&&pe(e),Fe(t),Fe(l),Fe(f),Fe(_),Fe(k)}}}function AD(r){let e,t;return e=new hs({props:{$$slots:{map:[ID],sidebar:[xD],top:[wD]},$$scope:{ctx:r}}}),{c(){Oe(e.$$.fragment)},m(n,l){Be(e,n,l),t=!0},p(n,[l]){const u={};l&131135&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(oe(e.$$.fragment,n),t=!0)},o(n){ue(e.$$.fragment,n),t=!1},d(n){Fe(e,n)}}}function LD(r,e,t){let n,l,u,f,a,_,x;pt(r,or,V=>t(5,u=V)),pt(r,Um,V=>t(1,f=V)),pt(r,gh,V=>t(13,a=V)),pt(r,mh,V=>t(14,_=V)),pt(r,Yn,V=>t(2,x=V));function k(){Lt(or,u={mode:"neighbourhood"},u)}let S=null;function C(V){return V?JSON.parse(x.compareRoute(V.properties.pt1_x,V.properties.pt1_y,f.lng,f.lat,1)):sh()}function z(V){Lt(mh,_=new ga.LngLat(V.properties.pt1_x,V.properties.pt1_y),_),Lt(gh,a=f,a),Lt(or,u={mode:"route",prevMode:"impact-one-destination"},u)}function R(V){S=V,t(0,S)}const D=V=>z(V.detail.features[0]);function P(V){f=V,Um.set(f)}const B=()=>Lt(or,u={mode:"title"},u),N=()=>Lt(or,u={mode:"network"},u);return r.$$.update=()=>{r.$$.dirty&6&&t(4,n=JSON.parse(x.impactToOneDestination(f.lng,f.lat))),r.$$.dirty&1&&t(3,l=C(S))},[S,f,x,l,n,u,k,z,R,D,P,B,N]}class PD extends Zt{constructor(e){super(),Wt(this,e,LD,AD,Vt,{})}}function zD(r){let e,t,n,l,u,f,a,_,x;return l=new sz({}),{c(){e=ce("div"),t=ce("button"),t.innerHTML=`<img src="${d4}" style="height: 6vh;" alt="A/B Street logo"/>`,n=Ue(),Oe(l.$$.fragment),u=Ue(),f=ce("span"),Te(t,"class","outline"),pn(f,"width","100%"),Te(e,"slot","top"),pn(e,"display","flex")},m(k,S){me(k,e,S),re(e,t),re(e,n),Be(l,e,null),re(e,u),re(e,f),r[19](f),a=!0,_||(x=Ct(t,"click",r[18]),_=!0)},p:It,i(k){a||(oe(l.$$.fragment,k),a=!0)},o(k){ue(l.$$.fragment,k),a=!1},d(k){k&&pe(e),Fe(l),r[19](null),_=!1,x()}}}function kb(r){let e,t,n,l,u,f;return n=new $5({props:{map:rn(r[6]),maptilerBasemap:r[7]}}),{c(){e=ce("button"),e.textContent="Zoom to fit study area",t=Ue(),Oe(n.$$.fragment),Te(e,"class","secondary")},m(a,_){me(a,e,_),me(a,t,_),Be(n,a,_),l=!0,u||(f=Ct(e,"click",r[10]),u=!0)},p(a,_){const x={};_&64&&(x.map=rn(a[6])),_&128&&(x.maptilerBasemap=a[7]),n.$set(x)},i(a){l||(oe(n.$$.fragment,a),l=!0)},o(a){ue(n.$$.fragment,a),l=!1},d(a){a&&(pe(e),pe(t)),Fe(n,a),u=!1,f()}}}function DD(r){let e,t,n,l,u,f,a=r[5]&&kb(r);return{c(){e=ce("div"),t=ce("div"),n=Ue(),l=ce("hr"),u=Ue(),a&&a.c(),Te(e,"slot","left")},m(_,x){me(_,e,x),re(e,t),r[17](t),re(e,n),re(e,l),re(e,u),a&&a.m(e,null),f=!0},p(_,x){_[5]?a?(a.p(_,x),x&32&&oe(a,1)):(a=kb(_),a.c(),oe(a,1),a.m(e,null)):a&&(vr(),ue(a,1,1,()=>{a=null}),br())},i(_){f||(oe(a),f=!0)},o(_){ue(a),f=!1},d(_){_&&pe(e),r[17](null),a&&a.d()}}}function RD(r){let e,t;return e=new Y8({}),{c(){Oe(e.$$.fragment)},m(n,l){Be(e,n,l),t=!0},p:It,i(n){t||(oe(e.$$.fragment,n),t=!0)},o(n){ue(e.$$.fragment,n),t=!1},d(n){Fe(e,n)}}}function BD(r){let e,t;return e=new G8({props:{wasmReady:r[4]}}),{c(){Oe(e.$$.fragment)},m(n,l){Be(e,n,l),t=!0},p(n,l){const u={};l&16&&(u.wasmReady=n[4]),e.$set(u)},i(n){t||(oe(e.$$.fragment,n),t=!0)},o(n){ue(e.$$.fragment,n),t=!1},d(n){Fe(e,n)}}}function Tb(r){let e,t,n,l,u,f;e=new ri({props:{data:JSON.parse(r[5].getInvertedBoundary()),$$slots:{default:[FD]},$$scope:{ctx:r}}});const a=[GD,qD,$D,VD,UD,jD,ND,OD],_=[];function x(k,S){return k[8].mode=="network"?0:k[8].mode=="set-boundary"?1:k[8].mode=="auto-boundaries"?2:k[8].mode=="neighbourhood"?3:k[8].mode=="view-shortcuts"?4:k[8].mode=="impact-one-destination"?5:k[8].mode=="route"?6:k[8].mode=="debug"?7:-1}return~(n=x(r))&&(l=_[n]=a[n](r)),{c(){Oe(e.$$.fragment),t=Ue(),l&&l.c(),u=Hn()},m(k,S){Be(e,k,S),me(k,t,S),~n&&_[n].m(k,S),me(k,u,S),f=!0},p(k,S){const C={};S&32&&(C.data=JSON.parse(k[5].getInvertedBoundary())),S&2097152&&(C.$$scope={dirty:S,ctx:k}),e.$set(C);let z=n;n=x(k),n===z?~n&&_[n].p(k,S):(l&&(vr(),ue(_[z],1,1,()=>{_[z]=null}),br()),~n?(l=_[n],l?l.p(k,S):(l=_[n]=a[n](k),l.c()),oe(l,1),l.m(u.parentNode,u)):l=null)},i(k){f||(oe(e.$$.fragment,k),oe(l),f=!0)},o(k){ue(e.$$.fragment,k),ue(l),f=!1},d(k){k&&(pe(t),pe(u)),Fe(e,k),~n&&_[n].d(k)}}}function FD(r){let e,t;const n=[bn("boundary"),{paint:{"fill-color":"black","fill-opacity":.3}}];let l={};for(let u=0;u<n.length;u+=1)l=mn(l,n[u]);return e=new Ns({props:l}),{c(){Oe(e.$$.fragment)},m(u,f){Be(e,u,f),t=!0},p(u,f){const a={};e.$set(a)},i(u){t||(oe(e.$$.fragment,u),t=!0)},o(u){ue(e.$$.fragment,u),t=!1},d(u){Fe(e,u)}}}function OD(r){let e,t;return e=new wC({}),{c(){Oe(e.$$.fragment)},m(n,l){Be(e,n,l),t=!0},p:It,i(n){t||(oe(e.$$.fragment,n),t=!0)},o(n){ue(e.$$.fragment,n),t=!1},d(n){Fe(e,n)}}}function ND(r){let e,t;return e=new tz({props:{prevMode:r[8].prevMode}}),{c(){Oe(e.$$.fragment)},m(n,l){Be(e,n,l),t=!0},p(n,l){const u={};l&256&&(u.prevMode=n[8].prevMode),e.$set(u)},i(n){t||(oe(e.$$.fragment,n),t=!0)},o(n){ue(e.$$.fragment,n),t=!1},d(n){Fe(e,n)}}}function jD(r){let e,t;return e=new PD({}),{c(){Oe(e.$$.fragment)},m(n,l){Be(e,n,l),t=!0},p:It,i(n){t||(oe(e.$$.fragment,n),t=!0)},o(n){ue(e.$$.fragment,n),t=!1},d(n){Fe(e,n)}}}function UD(r){let e,t;return e=new _D({}),{c(){Oe(e.$$.fragment)},m(n,l){Be(e,n,l),t=!0},p:It,i(n){t||(oe(e.$$.fragment,n),t=!0)},o(n){ue(e.$$.fragment,n),t=!1},d(n){Fe(e,n)}}}function VD(r){let e,t;return e=new M6({}),{c(){Oe(e.$$.fragment)},m(n,l){Be(e,n,l),t=!0},p:It,i(n){t||(oe(e.$$.fragment,n),t=!0)},o(n){ue(e.$$.fragment,n),t=!1},d(n){Fe(e,n)}}}function $D(r){let e,t;return e=new Gz({}),{c(){Oe(e.$$.fragment)},m(n,l){Be(e,n,l),t=!0},p:It,i(n){t||(oe(e.$$.fragment,n),t=!0)},o(n){ue(e.$$.fragment,n),t=!1},d(n){Fe(e,n)}}}function qD(r){let e,t;return e=new Dz({props:{name:r[8].name,existing:r[8].existing}}),{c(){Oe(e.$$.fragment)},m(n,l){Be(e,n,l),t=!0},p(n,l){const u={};l&256&&(u.name=n[8].name),l&256&&(u.existing=n[8].existing),e.$set(u)},i(n){t||(oe(e.$$.fragment,n),t=!0)},o(n){ue(e.$$.fragment,n),t=!1},d(n){Fe(e,n)}}}function GD(r){let e,t;return e=new $6({}),{c(){Oe(e.$$.fragment)},m(n,l){Be(e,n,l),t=!0},p:It,i(n){t||(oe(e.$$.fragment,n),t=!0)},o(n){ue(e.$$.fragment,n),t=!1},d(n){Fe(e,n)}}}function WD(r){let e,t,n,l,u,f,a,_,x,k;e=new o5({props:{map:r[0],apiKey:Nm}});const S=[BD,RD],C=[];function z(D,P){return D[8].mode=="title"?0:D[8].mode=="new-project"?1:-1}~(u=z(r))&&(f=C[u]=S[u](r));let R=r[5]&&Tb(r);return x=new T5({}),{c(){Oe(e.$$.fragment),t=Ue(),n=ce("div"),l=Ue(),f&&f.c(),a=Ue(),R&&R.c(),_=Ue(),Oe(x.$$.fragment)},m(D,P){Be(e,D,P),me(D,t,P),me(D,n,P),r[14](n),me(D,l,P),~u&&C[u].m(D,P),me(D,a,P),R&&R.m(D,P),me(D,_,P),Be(x,D,P),k=!0},p(D,P){const B={};P&1&&(B.map=D[0]),e.$set(B);let N=u;u=z(D),u===N?~u&&C[u].p(D,P):(f&&(vr(),ue(C[N],1,1,()=>{C[N]=null}),br()),~u?(f=C[u],f?f.p(D,P):(f=C[u]=S[u](D),f.c()),oe(f,1),f.m(a.parentNode,a)):f=null),D[5]?R?(R.p(D,P),P&32&&oe(R,1)):(R=Tb(D),R.c(),oe(R,1),R.m(_.parentNode,_)):R&&(vr(),ue(R,1,1,()=>{R=null}),br())},i(D){k||(oe(e.$$.fragment,D),oe(f),oe(R),oe(x.$$.fragment,D),k=!0)},o(D){ue(e.$$.fragment,D),ue(f),ue(R),ue(x.$$.fragment,D),k=!1},d(D){D&&(pe(t),pe(n),pe(l),pe(a),pe(_)),Fe(e,D),r[14](null),~u&&C[u].d(D),R&&R.d(D),Fe(x,D)}}}function ZD(r){let e,t,n,l;function u(a){r[15](a)}let f={style:`https://api.maptiler.com/maps/${r[7]}/style.json?key=${Nm}`,standardControls:!0,hash:!0,images:[{id:"walk_cycle_only",url:"/ltn//filters/walk_cycle_only_icon.gif"},{id:"no_entry",url:"/ltn//filters/no_entry_icon.gif"},{id:"bus_gate",url:"/ltn//filters/bus_gate_icon.gif"},{id:"school_street",url:"/ltn//filters/school_street_icon.gif"},{id:"oneway-arrow",url:f4}],$$slots:{default:[WD]},$$scope:{ctx:r}};return r[0]!==void 0&&(f.map=r[0]),t=new i3({props:f}),nn.push(()=>no(t,"map",u)),t.$on("error",r[16]),{c(){e=ce("div"),Oe(t.$$.fragment),Te(e,"slot","main"),pn(e,"position","relative"),pn(e,"width","100%"),pn(e,"height","100%")},m(a,_){me(a,e,_),Be(t,e,null),l=!0},p(a,_){const x={};_&128&&(x.style=`https://api.maptiler.com/maps/${a[7]}/style.json?key=${Nm}`),_&2097465&&(x.$$scope={dirty:_,ctx:a}),!n&&_&1&&(n=!0,x.map=a[0],ro(()=>n=!1)),t.$set(x)},i(a){l||(oe(t.$$.fragment,a),l=!0)},o(a){ue(t.$$.fragment,a),l=!1},d(a){a&&pe(e),Fe(t)}}}function HD(r){let e,t,n,l;return e=new h4({}),n=new d5({props:{$$slots:{main:[ZD],left:[DD],top:[zD]},$$scope:{ctx:r}}}),{c(){Oe(e.$$.fragment),t=Ue(),Oe(n.$$.fragment)},m(u,f){Be(e,u,f),me(u,t,f),Be(n,u,f),l=!0},p(u,[f]){const a={};f&2098175&&(a.$$scope={dirty:f,ctx:u}),n.$set(a)},i(u){l||(oe(e.$$.fragment,u),oe(n.$$.fragment,u),l=!0)},o(u){ue(e.$$.fragment,u),ue(n.$$.fragment,u),l=!1},d(u){u&&pe(t),Fe(e,u),Fe(n,u)}}}function XD(r,e,t){let n,l,u,f,a,_,x,k,S;pt(r,Qm,J=>t(11,n=J)),pt(r,Ym,J=>t(12,l=J)),pt(r,Jm,J=>t(13,u=J)),pt(r,Yn,J=>t(5,f=J)),pt(r,cs,J=>t(6,a=J)),pt(r,ph,J=>t(20,_=J)),pt(r,jm,J=>t(7,x=J)),pt(r,or,J=>t(8,k=J)),pt(r,vd,J=>t(9,S=J));let C=!1;Od(async()=>{await jb(),await qb(),t(4,C=!0);try{(await fetch("/osm/areas.json")).ok&&(Lt(ph,_=!0,_),console.log("Using local cache, not od2net.org"))}catch{}});let z;function R(){a.fitBounds(Array.from(f.getBounds()),{animate:!1})}let D,P,B;function N(J){nn[J?"unshift":"push"](()=>{B=J,t(3,B),t(11,n)})}function V(J){z=J,t(0,z)}const U=J=>{console.log(J.detail.error)};function te(J){nn[J?"unshift":"push"](()=>{P=J,t(2,P),t(12,l)})}const le=()=>Lt(vd,S=!0,S);function H(J){nn[J?"unshift":"push"](()=>{D=J,t(1,D),t(13,u)})}return r.$$.update=()=>{r.$$.dirty&1&&z&&cs.set(z),r.$$.dirty&8194&&D&&u&&(t(1,D.innerHTML="",D),D.appendChild(u)),r.$$.dirty&4100&&P&&l&&(t(2,P.innerHTML="",P),P.appendChild(l)),r.$$.dirty&2056&&B&&n&&(t(3,B.innerHTML="",B),B.appendChild(n))},[z,D,P,B,C,f,a,x,k,S,R,n,l,u,N,V,U,te,le,H]}class KD extends Zt{constructor(e){super(),Wt(this,e,XD,HD,Vt,{})}}new KD({target:document.getElementById("app")});
