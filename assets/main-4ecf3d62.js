var rb=Object.defineProperty;var ob=(r,e,t)=>e in r?rb(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var Un=(r,e,t)=>(ob(r,typeof e!="symbol"?e+"":e,t),t);function sb(r,e){for(var t=0;t<e.length;t++){const i=e[t];if(typeof i!="string"&&!Array.isArray(i)){for(const l in i)if(l!=="default"&&!(l in r)){const u=Object.getOwnPropertyDescriptor(i,l);u&&Object.defineProperty(r,l,u.get?u:{enumerable:!0,get:()=>i[l]})}}}return Object.freeze(Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))i(l);new MutationObserver(l=>{for(const u of l)if(u.type==="childList")for(const d of u.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&i(d)}).observe(document,{childList:!0,subtree:!0});function t(l){const u={};return l.integrity&&(u.integrity=l.integrity),l.referrerPolicy&&(u.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?u.credentials="include":l.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function i(l){if(l.ep)return;l.ep=!0;const u=t(l);fetch(l.href,u)}})();function It(){}function rn(r,e){for(const t in e)r[t]=e[t];return r}function Jy(r){return r()}function Sg(){return Object.create(null)}function hn(r){r.forEach(Jy)}function ec(r){return typeof r=="function"}function zt(r,e){return r!=r?e==e:r!==e||r&&typeof r=="object"||typeof r=="function"}let nd;function zn(r,e){return r===e?!0:(nd||(nd=document.createElement("a")),nd.href=e,r===nd.href)}function ab(r){return Object.keys(r).length===0}function Yy(r,...e){if(r==null){for(const i of e)i(void 0);return It}const t=r.subscribe(...e);return t.unsubscribe?()=>t.unsubscribe():t}function Pr(r){let e;return Yy(r,t=>e=t)(),e}function lt(r,e,t){r.$$.on_destroy.push(Yy(e,t))}function $i(r,e,t,i){if(r){const l=Qy(r,e,t,i);return r[0](l)}}function Qy(r,e,t,i){return r[1]&&i?rn(t.ctx.slice(),r[1](i(e))):t.ctx}function qi(r,e,t,i){if(r[2]&&i){const l=r[2](i(t));if(e.dirty===void 0)return l;if(typeof l=="object"){const u=[],d=Math.max(e.dirty.length,l.length);for(let a=0;a<d;a+=1)u[a]=e.dirty[a]|l[a];return u}return e.dirty|l}return e.dirty}function Zi(r,e,t,i,l,u){if(l){const d=Qy(e,t,i,u);r.p(d,l)}}function Gi(r){if(r.ctx.length>32){const e=[],t=r.ctx.length/32;for(let i=0;i<t;i++)e[i]=-1;return e}return-1}function lb(r){const e={};for(const t in r)e[t]=!0;return e}function yd(r){return r??""}function Tt(r,e,t){return r.set(t),e}function rp(r){return r&&ec(r.destroy)?r.destroy:It}const Md=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function G(r,e){r.appendChild(e)}function ae(r,e,t){r.insertBefore(e,t||null)}function se(r){r.parentNode&&r.parentNode.removeChild(r)}function $o(r,e){for(let t=0;t<r.length;t+=1)r[t]&&r[t].d(e)}function oe(r){return document.createElement(r)}function ks(r){return document.createElementNS("http://www.w3.org/2000/svg",r)}function Ve(r){return document.createTextNode(r)}function Ae(){return Ve(" ")}function En(){return Ve("")}function St(r,e,t,i){return r.addEventListener(e,t,i),()=>r.removeEventListener(e,t,i)}function Mp(r){return function(e){return e.preventDefault(),r.call(this,e)}}function Gf(r){return function(e){return e.stopPropagation(),r.call(this,e)}}function ke(r,e,t){t==null?r.removeAttribute(e):r.getAttribute(e)!==t&&r.setAttribute(e,t)}function e0(r){let e;return{p(...t){e=t,e.forEach(i=>r.push(i))},r(){e.forEach(t=>r.splice(r.indexOf(t),1))}}}function Ip(r){return r===""?null:+r}function cb(r){return Array.from(r.childNodes)}function si(r,e){e=""+e,r.data!==e&&(r.data=e)}function Pn(r,e){r.value=e??""}function Ai(r,e,t,i){t==null?r.style.removeProperty(e):r.style.setProperty(e,t,i?"important":"")}function tc(r,e,t){for(let i=0;i<r.options.length;i+=1){const l=r.options[i];if(l.__value===e){l.selected=!0;return}}(!t||e!==void 0)&&(r.selectedIndex=-1)}function Lp(r){const e=r.querySelector(":checked");return e&&e.__value}function cr(r,e,t){r.classList.toggle(e,!!t)}function ub(r,e,{bubbles:t=!1,cancelable:i=!1}={}){return new CustomEvent(r,{detail:e,bubbles:t,cancelable:i})}let Au;function Tu(r){Au=r}function qu(){if(!Au)throw new Error("Function called outside component initialization");return Au}function Zu(r){qu().$$.on_mount.push(r)}function er(r){qu().$$.on_destroy.push(r)}function rs(){const r=qu();return(e,t,{cancelable:i=!1}={})=>{const l=r.$$.callbacks[e];if(l){const u=ub(e,t,{cancelable:i});return l.slice().forEach(d=>{d.call(r,u)}),!u.defaultPrevented}return!0}}function Id(r,e){return qu().$$.context.set(r,e),e}function Ld(r){return qu().$$.context.get(r)}function fi(r,e){const t=r.$$.callbacks[e.type];t&&t.slice().forEach(i=>i.call(this,e))}const Gl=[],on=[];let Kl=[];const op=[],t0=Promise.resolve();let sp=!1;function i0(){sp||(sp=!0,t0.then(r0))}function n0(){return i0(),t0}function ic(r){Kl.push(r)}function Gr(r){op.push(r)}const Wf=new Set;let jl=0;function r0(){if(jl!==0)return;const r=Au;do{try{for(;jl<Gl.length;){const e=Gl[jl];jl++,Tu(e),hb(e.$$)}}catch(e){throw Gl.length=0,jl=0,e}for(Tu(null),Gl.length=0,jl=0;on.length;)on.pop()();for(let e=0;e<Kl.length;e+=1){const t=Kl[e];Wf.has(t)||(Wf.add(t),t())}Kl.length=0}while(Gl.length);for(;op.length;)op.pop()();sp=!1,Wf.clear(),Tu(r)}function hb(r){if(r.fragment!==null){r.update(),hn(r.before_update);const e=r.dirty;r.dirty=[-1],r.fragment&&r.fragment.p(r.ctx,e),r.after_update.forEach(ic)}}function db(r){const e=[],t=[];Kl.forEach(i=>r.indexOf(i)===-1?e.push(i):t.push(i)),t.forEach(i=>i()),Kl=e}const ld=new Set;let Ba;function yi(){Ba={r:0,c:[],p:Ba}}function vi(){Ba.r||hn(Ba.c),Ba=Ba.p}function J(r,e){r&&r.i&&(ld.delete(r),r.i(e))}function ne(r,e,t,i){if(r&&r.o){if(ld.has(r))return;ld.add(r),Ba.c.push(()=>{ld.delete(r),i&&(t&&r.d(1),i())}),r.o(e)}else i&&i()}function Tn(r){return(r==null?void 0:r.length)!==void 0?r:Array.from(r)}function fb(r,e){ne(r,1,1,()=>{e.delete(r.key)})}function pb(r,e,t,i,l,u,d,a,_,v,k,S){let E=r.length,A=u.length,D=E;const B={};for(;D--;)B[r[D].key]=D;const P=[],R=new Map,F=new Map,j=[];for(D=A;D--;){const Z=S(l,u,D),Q=t(Z);let ye=d.get(Q);ye?i&&j.push(()=>ye.p(Z,e)):(ye=v(Q,Z),ye.c()),R.set(Q,P[D]=ye),Q in B&&F.set(Q,Math.abs(D-B[Q]))}const U=new Set,le=new Set;function he(Z){J(Z,1),Z.m(a,k),d.set(Z.key,Z),k=Z.first,A--}for(;E&&A;){const Z=P[A-1],Q=r[E-1],ye=Z.key,Ne=Q.key;Z===Q?(k=Z.first,E--,A--):R.has(Ne)?!d.has(ye)||U.has(ye)?he(Z):le.has(Ne)?E--:F.get(ye)>F.get(Ne)?(le.add(ye),he(Z)):(U.add(Ne),E--):(_(Q,d),E--)}for(;E--;){const Z=r[E];R.has(Z.key)||_(Z,d)}for(;A;)he(P[A-1]);return hn(j),P}function nc(r,e){const t={},i={},l={$$scope:1};let u=r.length;for(;u--;){const d=r[u],a=e[u];if(a){for(const _ in d)_ in a||(i[_]=1);for(const _ in a)l[_]||(t[_]=a[_],l[_]=1);r[u]=a}else for(const _ in d)l[_]=1}for(const d in i)d in t||(t[d]=void 0);return t}function Wr(r,e,t){const i=r.$$.props[e];i!==void 0&&(r.$$.bound[i]=t,t(r.$$.ctx[i]))}function Ie(r){r&&r.c()}function Ee(r,e,t){const{fragment:i,after_update:l}=r.$$;i&&i.m(e,t),ic(()=>{const u=r.$$.on_mount.map(Jy).filter(ec);r.$$.on_destroy?r.$$.on_destroy.push(...u):hn(u),r.$$.on_mount=[]}),l.forEach(ic)}function Me(r,e){const t=r.$$;t.fragment!==null&&(db(t.after_update),hn(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function mb(r,e){r.$$.dirty[0]===-1&&(Gl.push(r),i0(),r.$$.dirty.fill(0)),r.$$.dirty[e/31|0]|=1<<e%31}function Ut(r,e,t,i,l,u,d=null,a=[-1]){const _=Au;Tu(r);const v=r.$$={fragment:null,ctx:[],props:u,update:It,not_equal:l,bound:Sg(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(_?_.$$.context:[])),callbacks:Sg(),dirty:a,skip_bound:!1,root:e.target||_.$$.root};d&&d(v.root);let k=!1;if(v.ctx=t?t(r,e.props||{},(S,E,...A)=>{const D=A.length?A[0]:E;return v.ctx&&l(v.ctx[S],v.ctx[S]=D)&&(!v.skip_bound&&v.bound[S]&&v.bound[S](D),k&&mb(r,S)),E}):[],v.update(),k=!0,hn(v.before_update),v.fragment=i?i(v.ctx):!1,e.target){if(e.hydrate){const S=cb(e.target);v.fragment&&v.fragment.l(S),S.forEach(se)}else v.fragment&&v.fragment.c();e.intro&&J(r.$$.fragment),Ee(r,e.target,e.anchor),r0()}Tu(_)}class Vt{constructor(){Un(this,"$$");Un(this,"$$set")}$destroy(){Me(this,1),this.$destroy=It}$on(e,t){if(!ec(t))return It;const i=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return i.push(t),()=>{const l=i.indexOf(t);l!==-1&&i.splice(l,1)}}$set(e){this.$$set&&!ab(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const gb="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(gb);const _b="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAk0lEQVRIS+3U0Q2AIAwEUNjMUXQydRJH0zZB0wjGuwJfSsKfuWfO1hg6n9g5P3wPWKTSXe6EVstUNEjoloIVghAG0OxR7swgLEAjHoBCvACM1AAQUgJ0DL0nm67WwJom7XrBlhVl4arUAHYniuE1ABTuBeBwD0CFs4D92T12fp9v9iPrnJ8LBu0KC0Ch9qEfeK3sAPceHxk8hJ17AAAAAElFTkSuQmCC",yb="/ltn/assets/logo-97f2d067.svg";function Tg(r){let e,t;return{c(){e=oe("div"),t=Ve(r[0]),ke(e,"class","svelte-1uuov7f")},m(i,l){ae(i,e,l),G(e,t)},p(i,l){l&1&&si(t,i[0])},d(i){i&&se(e)}}}function vb(r){let e,t=r[0]&&Tg(r);return{c(){t&&t.c(),e=En()},m(i,l){t&&t.m(i,l),ae(i,e,l)},p(i,[l]){i[0]?t?t.p(i,l):(t=Tg(i),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:It,o:It,d(i){i&&se(e),t&&t.d(i)}}}function bb(r,e,t){let{loading:i}=e;return r.$$set=l=>{"loading"in l&&t(0,i=l.loading)},[i]}class o0 extends Vt{constructor(e){super(),Ut(this,e,bb,vb,zt,{loading:0})}}const wb=r=>({dialog:r&1}),Cg=r=>({dialog:r[0]});function xb(r){let e,t,i,l,u;const d=r[4].default,a=$i(d,r,r[3],Cg);return{c(){e=oe("dialog"),t=oe("article"),a&&a.c(),e.open=!0},m(_,v){ae(_,e,v),G(e,t),a&&a.m(t,null),r[6](e),i=!0,l||(u=[St(window,"click",r[1]),St(window,"keydown",r[2]),St(e,"close",r[5])],l=!0)},p(_,[v]){a&&a.p&&(!i||v&9)&&Zi(a,d,_,_[3],i?qi(d,_[3],v,wb):Gi(_[3]),Cg)},i(_){i||(J(a,_),i=!0)},o(_){ne(a,_),i=!1},d(_){_&&se(e),a&&a.d(_),r[6](null),l=!1,hn(u)}}}function kb(r,e,t){let{$$slots:i={},$$scope:l}=e,u;function d(k){u.open&&k.target==u&&u.close()}function a(k){(k.key=="Escape"||k.key=="Enter")&&(k.stopPropagation(),u.close())}function _(k){fi.call(this,r,k)}function v(k){on[k?"unshift":"push"](()=>{u=k,t(0,u)})}return r.$$set=k=>{"$$scope"in k&&t(3,l=k.$$scope)},[u,d,a,l,i,_,v]}class Ad extends Vt{constructor(e){super(),Ut(this,e,kb,xb,zt,{})}}function Eg(r,e,t){const i=r.slice();return i[1]=e[t][0],i[2]=e[t][1],i}function Mg(r){let e,t,i=r[1]+"",l,u,d,a=r[2]+"",_,v;return{c(){e=oe("tr"),t=oe("td"),l=Ve(i),u=Ae(),d=oe("td"),_=Ve(a),v=Ae()},m(k,S){ae(k,e,S),G(e,t),G(t,l),G(e,u),G(e,d),G(d,_),G(e,v)},p(k,S){S&1&&i!==(i=k[1]+"")&&si(l,i),S&1&&a!==(a=k[2]+"")&&si(_,a)},d(k){k&&se(e)}}}function Sb(r){let e,t,i=Tn(Object.entries(r[0])),l=[];for(let u=0;u<i.length;u+=1)l[u]=Mg(Eg(r,i,u));return{c(){e=oe("table"),t=oe("tbody");for(let u=0;u<l.length;u+=1)l[u].c();ke(e,"class","svelte-lh2o9l")},m(u,d){ae(u,e,d),G(e,t);for(let a=0;a<l.length;a+=1)l[a]&&l[a].m(t,null)},p(u,[d]){if(d&1){i=Tn(Object.entries(u[0]));let a;for(a=0;a<i.length;a+=1){const _=Eg(u,i,a);l[a]?l[a].p(_,d):(l[a]=Mg(_),l[a].c(),l[a].m(t,null))}for(;a<l.length;a+=1)l[a].d(1);l.length=i.length}},i:It,o:It,d(u){u&&se(e),$o(l,u)}}}function Tb(r,e,t){let{properties:i}=e;return r.$$set=l=>{"properties"in l&&t(0,i=l.properties)},[i]}class Pd extends Vt{constructor(e){super(),Ut(this,e,Tb,Sb,zt,{properties:0})}}function Ig(r,e,t){const i=r.slice();return i[3]=e[t],i}function Lg(r,e,t){const i=r.slice();return i[6]=e[t],i}function Ag(r){let e,t;return{c(){e=oe("span"),t=Ve(`Â 
    `),Ai(e,"background",r[6]),Ai(e,"width","100%"),Ai(e,"border","1px solid black")},m(i,l){ae(i,e,l),G(e,t)},p(i,l){l&1&&Ai(e,"background",i[6])},d(i){i&&se(e)}}}function Cb(r){let e,t=r[3]+"",i;return{c(){e=oe("span"),i=Ve(t)},m(l,u){ae(l,e,u),G(e,i)},p(l,u){u&2&&t!==(t=l[3]+"")&&si(i,t)},d(l){l&&se(e)}}}function Eb(r){let e,t=r[3].toFixed(r[2])+"",i;return{c(){e=oe("span"),i=Ve(t)},m(l,u){ae(l,e,u),G(e,i)},p(l,u){u&6&&t!==(t=l[3].toFixed(l[2])+"")&&si(i,t)},d(l){l&&se(e)}}}function Pg(r){let e;function t(u,d){return u[2]>0?Eb:Cb}let i=t(r),l=i(r);return{c(){l.c(),e=En()},m(u,d){l.m(u,d),ae(u,e,d)},p(u,d){i===(i=t(u))&&l?l.p(u,d):(l.d(1),l=i(u),l&&(l.c(),l.m(e.parentNode,e)))},d(u){u&&se(e),l.d(u)}}}function Mb(r){let e,t,i,l=Tn(r[0]),u=[];for(let _=0;_<l.length;_+=1)u[_]=Ag(Lg(r,l,_));let d=Tn(r[1]),a=[];for(let _=0;_<d.length;_+=1)a[_]=Pg(Ig(r,d,_));return{c(){e=oe("div");for(let _=0;_<u.length;_+=1)u[_].c();t=Ae(),i=oe("div");for(let _=0;_<a.length;_+=1)a[_].c();Ai(e,"display","flex"),Ai(i,"display","flex"),Ai(i,"justify-content","space-between")},m(_,v){ae(_,e,v);for(let k=0;k<u.length;k+=1)u[k]&&u[k].m(e,null);ae(_,t,v),ae(_,i,v);for(let k=0;k<a.length;k+=1)a[k]&&a[k].m(i,null)},p(_,[v]){if(v&1){l=Tn(_[0]);let k;for(k=0;k<l.length;k+=1){const S=Lg(_,l,k);u[k]?u[k].p(S,v):(u[k]=Ag(S),u[k].c(),u[k].m(e,null))}for(;k<u.length;k+=1)u[k].d(1);u.length=l.length}if(v&6){d=Tn(_[1]);let k;for(k=0;k<d.length;k+=1){const S=Ig(_,d,k);a[k]?a[k].p(S,v):(a[k]=Pg(S),a[k].c(),a[k].m(i,null))}for(;k<a.length;k+=1)a[k].d(1);a.length=d.length}},i:It,o:It,d(_){_&&(se(e),se(t),se(i)),$o(u,_),$o(a,_)}}}function Ib(r,e,t){let{colorScale:i}=e,{limits:l}=e,{decimalPlaces:u=0}=e;return r.$$set=d=>{"colorScale"in d&&t(0,i=d.colorScale),"limits"in d&&t(1,l=d.limits),"decimalPlaces"in d&&t(2,u=d.decimalPlaces)},[i,l,u]}class Lb extends Vt{constructor(e){super(),Ut(this,e,Ib,Mb,zt,{colorScale:0,limits:1,decimalPlaces:2})}}function vd(r,e){let t=document.createElement("a");t.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(e)),t.setAttribute("download",r),document.body.appendChild(t),t.click(),document.body.removeChild(t)}function vr(r){if(r==null||r==null)throw new Error("Oops, notNull given something null");return r}var s0=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function a0(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function Ap(r){if(r.__esModule)return r;var e=r.default;if(typeof e=="function"){var t=function i(){return this instanceof i?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(r).forEach(function(i){var l=Object.getOwnPropertyDescriptor(r,i);Object.defineProperty(t,i,l.get?l:{enumerable:!0,get:function(){return r[i]}})}),t}var l0={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v4.1.3/LICENSE.txt
 */(function(r,e){(function(t,i){r.exports=i()})(s0,function(){var t={},i={};function l(d,a,_){if(i[d]=_,d==="index"){var v="var sharedModule = {}; ("+i.shared+")(sharedModule); ("+i.worker+")(sharedModule);",k={};return i.shared(k),i.index(t,k),typeof window<"u"&&t.setWorkerUrl(window.URL.createObjectURL(new Blob([v],{type:"text/javascript"}))),t}}l("shared",["exports"],function(d){function a(s,n,c,f){return new(c||(c=Promise))(function(g,w){function x(z){try{I(f.next(z))}catch(N){w(N)}}function T(z){try{I(f.throw(z))}catch(N){w(N)}}function I(z){var N;z.done?g(z.value):(N=z.value,N instanceof c?N:new c(function(V){V(N)})).then(x,T)}I((f=f.apply(s,n||[])).next())})}function _(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}typeof SuppressedError=="function"&&SuppressedError;var v=k;function k(s,n){this.x=s,this.y=n}k.prototype={clone:function(){return new k(this.x,this.y)},add:function(s){return this.clone()._add(s)},sub:function(s){return this.clone()._sub(s)},multByPoint:function(s){return this.clone()._multByPoint(s)},divByPoint:function(s){return this.clone()._divByPoint(s)},mult:function(s){return this.clone()._mult(s)},div:function(s){return this.clone()._div(s)},rotate:function(s){return this.clone()._rotate(s)},rotateAround:function(s,n){return this.clone()._rotateAround(s,n)},matMult:function(s){return this.clone()._matMult(s)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(s){return this.x===s.x&&this.y===s.y},dist:function(s){return Math.sqrt(this.distSqr(s))},distSqr:function(s){var n=s.x-this.x,c=s.y-this.y;return n*n+c*c},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(s){return Math.atan2(this.y-s.y,this.x-s.x)},angleWith:function(s){return this.angleWithSep(s.x,s.y)},angleWithSep:function(s,n){return Math.atan2(this.x*n-this.y*s,this.x*s+this.y*n)},_matMult:function(s){var n=s[2]*this.x+s[3]*this.y;return this.x=s[0]*this.x+s[1]*this.y,this.y=n,this},_add:function(s){return this.x+=s.x,this.y+=s.y,this},_sub:function(s){return this.x-=s.x,this.y-=s.y,this},_mult:function(s){return this.x*=s,this.y*=s,this},_div:function(s){return this.x/=s,this.y/=s,this},_multByPoint:function(s){return this.x*=s.x,this.y*=s.y,this},_divByPoint:function(s){return this.x/=s.x,this.y/=s.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var s=this.y;return this.y=this.x,this.x=-s,this},_rotate:function(s){var n=Math.cos(s),c=Math.sin(s),f=c*this.x+n*this.y;return this.x=n*this.x-c*this.y,this.y=f,this},_rotateAround:function(s,n){var c=Math.cos(s),f=Math.sin(s),g=n.y+f*(this.x-n.x)+c*(this.y-n.y);return this.x=n.x+c*(this.x-n.x)-f*(this.y-n.y),this.y=g,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},k.convert=function(s){return s instanceof k?s:Array.isArray(s)?new k(s[0],s[1]):s};var S=_(v),E=A;function A(s,n,c,f){this.cx=3*s,this.bx=3*(c-s)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*n,this.by=3*(f-n)-this.cy,this.ay=1-this.cy-this.by,this.p1x=s,this.p1y=n,this.p2x=c,this.p2y=f}A.prototype={sampleCurveX:function(s){return((this.ax*s+this.bx)*s+this.cx)*s},sampleCurveY:function(s){return((this.ay*s+this.by)*s+this.cy)*s},sampleCurveDerivativeX:function(s){return(3*this.ax*s+2*this.bx)*s+this.cx},solveCurveX:function(s,n){if(n===void 0&&(n=1e-6),s<0)return 0;if(s>1)return 1;for(var c=s,f=0;f<8;f++){var g=this.sampleCurveX(c)-s;if(Math.abs(g)<n)return c;var w=this.sampleCurveDerivativeX(c);if(Math.abs(w)<1e-6)break;c-=g/w}var x=0,T=1;for(c=s,f=0;f<20&&(g=this.sampleCurveX(c),!(Math.abs(g-s)<n));f++)s>g?x=c:T=c,c=.5*(T-x)+x;return c},solve:function(s,n){return this.sampleCurveY(this.solveCurveX(s,n))}};var D=_(E);let B,P;function R(){return B==null&&(B=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),B}function F(){if(P==null&&(P=!1,R())){const n=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(n){for(let f=0;f<5*5;f++){const g=4*f;n.fillStyle=`rgb(${g},${g+1},${g+2})`,n.fillRect(f%5,Math.floor(f/5),1,1)}const c=n.getImageData(0,0,5,5).data;for(let f=0;f<5*5*4;f++)if(f%4!=3&&c[f]!==f){P=!0;break}}}return P||!1}function j(s,n,c,f){const g=new D(s,n,c,f);return function(w){return g.solve(w)}}const U=j(.25,.1,.25,1);function le(s,n,c){return Math.min(c,Math.max(n,s))}function he(s,n,c){const f=c-n,g=((s-n)%f+f)%f+n;return g===n?c:g}function Z(s,...n){for(const c of n)for(const f in c)s[f]=c[f];return s}let Q=1;function ye(s,n,c){const f={};for(const g in s)f[g]=n.call(c||this,s[g],g,s);return f}function Ne(s,n,c){const f={};for(const g in s)n.call(c||this,s[g],g,s)&&(f[g]=s[g]);return f}function re(s){return Array.isArray(s)?s.map(re):typeof s=="object"&&s?ye(s,re):s}const ve={};function Ke(s){ve[s]||(typeof console<"u"&&console.warn(s),ve[s]=!0)}function Le(s,n,c){return(c.y-s.y)*(n.x-s.x)>(n.y-s.y)*(c.x-s.x)}function et(s){let n=0;for(let c,f,g=0,w=s.length,x=w-1;g<w;x=g++)c=s[g],f=s[x],n+=(f.x-c.x)*(c.y+f.y);return n}function xt(s){return typeof WorkerGlobalScope<"u"&&s!==void 0&&s instanceof WorkerGlobalScope}let mt=null;function at(s){return typeof ImageBitmap<"u"&&s instanceof ImageBitmap}const Ht="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function ri(s,n,c,f,g){return a(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const w=new VideoFrame(s,{timestamp:0});try{const x=w==null?void 0:w.format;if(!x||!x.startsWith("BGR")&&!x.startsWith("RGB"))throw new Error(`Unrecognized format ${x}`);const T=x.startsWith("BGR"),I=new Uint8ClampedArray(f*g*4);if(yield w.copyTo(I,function(z,N,V,X,Y){const te=4*Math.max(-N,0),ue=(Math.max(0,V)-V)*X*4+te,ge=4*X,xe=Math.max(0,N),Oe=Math.max(0,V);return{rect:{x:xe,y:Oe,width:Math.min(z.width,N+X)-xe,height:Math.min(z.height,V+Y)-Oe},layout:[{offset:ue,stride:ge}]}}(s,n,c,f,g)),T)for(let z=0;z<I.length;z+=4){const N=I[z];I[z]=I[z+2],I[z+2]=N}return I}finally{w.close()}})}let Nt,At;const ei="AbortError";function ci(){return new Error(ei)}const ti={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function ft(s){return ti.REGISTERED_PROTOCOLS[s.substring(0,s.indexOf("://"))]}const Jt="global-dispatcher";class gi extends Error{constructor(n,c,f,g){super(`AJAXError: ${c} (${n}): ${f}`),this.status=n,this.statusText=c,this.url=f,this.body=g}}const zi=()=>xt(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Fi=function(s,n){if(/:\/\//.test(s.url)&&!/^https?:|^file:/.test(s.url)){const f=ft(s.url);if(f)return f(s,n);if(xt(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:s,targetMapId:Jt},n)}if(!(/^file:/.test(c=s.url)||/^file:/.test(zi())&&!/^\w+:/.test(c))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(f,g){return a(this,void 0,void 0,function*(){const w=new Request(f.url,{method:f.method||"GET",body:f.body,credentials:f.credentials,headers:f.headers,cache:f.cache,referrer:zi(),signal:g.signal});f.type==="json"&&w.headers.set("Accept","application/json");const x=yield fetch(w);if(!x.ok){const z=yield x.blob();throw new gi(x.status,x.statusText,f.url,z)}let T;T=f.type==="arrayBuffer"||f.type==="image"?x.arrayBuffer():f.type==="json"?x.json():x.text();const I=yield T;if(g.signal.aborted)throw ci();return{data:I,cacheControl:x.headers.get("Cache-Control"),expires:x.headers.get("Expires")}})}(s,n);if(xt(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:s,mustQueue:!0,targetMapId:Jt},n)}var c;return function(f,g){return new Promise((w,x)=>{const T=new XMLHttpRequest;T.open(f.method||"GET",f.url,!0),f.type!=="arrayBuffer"&&f.type!=="image"||(T.responseType="arraybuffer");for(const I in f.headers)T.setRequestHeader(I,f.headers[I]);f.type==="json"&&(T.responseType="text",T.setRequestHeader("Accept","application/json")),T.withCredentials=f.credentials==="include",T.onerror=()=>{x(new Error(T.statusText))},T.onload=()=>{if(!g.signal.aborted)if((T.status>=200&&T.status<300||T.status===0)&&T.response!==null){let I=T.response;if(f.type==="json")try{I=JSON.parse(T.response)}catch(z){return void x(z)}w({data:I,cacheControl:T.getResponseHeader("Cache-Control"),expires:T.getResponseHeader("Expires")})}else{const I=new Blob([T.response],{type:T.getResponseHeader("Content-Type")});x(new gi(T.status,T.statusText,f.url,I))}},g.signal.addEventListener("abort",()=>{T.abort(),x(ci())}),T.send(f.body)})}(s,n)};function ut(s){if(!s||s.indexOf("://")<=0||s.indexOf("data:image/")===0||s.indexOf("blob:")===0)return!0;const n=new URL(s),c=window.location;return n.protocol===c.protocol&&n.host===c.host}function Dt(s,n,c){c[s]&&c[s].indexOf(n)!==-1||(c[s]=c[s]||[],c[s].push(n))}function Fe(s,n,c){if(c&&c[s]){const f=c[s].indexOf(n);f!==-1&&c[s].splice(f,1)}}class je{constructor(n,c={}){Z(this,c),this.type=n}}class ht extends je{constructor(n,c={}){super("error",Z({error:n},c))}}class vt{on(n,c){return this._listeners=this._listeners||{},Dt(n,c,this._listeners),this}off(n,c){return Fe(n,c,this._listeners),Fe(n,c,this._oneTimeListeners),this}once(n,c){return c?(this._oneTimeListeners=this._oneTimeListeners||{},Dt(n,c,this._oneTimeListeners),this):new Promise(f=>this.once(n,f))}fire(n,c){typeof n=="string"&&(n=new je(n,c||{}));const f=n.type;if(this.listens(f)){n.target=this;const g=this._listeners&&this._listeners[f]?this._listeners[f].slice():[];for(const T of g)T.call(this,n);const w=this._oneTimeListeners&&this._oneTimeListeners[f]?this._oneTimeListeners[f].slice():[];for(const T of w)Fe(f,T,this._oneTimeListeners),T.call(this,n);const x=this._eventedParent;x&&(Z(n,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),x.fire(n))}else n instanceof ht&&console.error(n.error);return this}listens(n){return this._listeners&&this._listeners[n]&&this._listeners[n].length>0||this._oneTimeListeners&&this._oneTimeListeners[n]&&this._oneTimeListeners[n].length>0||this._eventedParent&&this._eventedParent.listens(n)}setEventedParent(n,c){return this._eventedParent=n,this._eventedParentData=c,this}}var we={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const Ei=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function qe(s,n){const c={};for(const f in s)f!=="ref"&&(c[f]=s[f]);return Ei.forEach(f=>{f in n&&(c[f]=n[f])}),c}function Ye(s,n){if(Array.isArray(s)){if(!Array.isArray(n)||s.length!==n.length)return!1;for(let c=0;c<s.length;c++)if(!Ye(s[c],n[c]))return!1;return!0}if(typeof s=="object"&&s!==null&&n!==null){if(typeof n!="object"||Object.keys(s).length!==Object.keys(n).length)return!1;for(const c in s)if(!Ye(s[c],n[c]))return!1;return!0}return s===n}function Ot(s,n){s.push(n)}function Pi(s,n,c){Ot(c,{command:"addSource",args:[s,n[s]]})}function bi(s,n,c){Ot(n,{command:"removeSource",args:[s]}),c[s]=!0}function gn(s,n,c,f){bi(s,c,f),Pi(s,n,c)}function Mn(s,n,c){let f;for(f in s[c])if(Object.prototype.hasOwnProperty.call(s[c],f)&&f!=="data"&&!Ye(s[c][f],n[c][f]))return!1;for(f in n[c])if(Object.prototype.hasOwnProperty.call(n[c],f)&&f!=="data"&&!Ye(s[c][f],n[c][f]))return!1;return!0}function Qi(s,n,c,f,g,w){s=s||{},n=n||{};for(const x in s)Object.prototype.hasOwnProperty.call(s,x)&&(Ye(s[x],n[x])||c.push({command:w,args:[f,x,n[x],g]}));for(const x in n)Object.prototype.hasOwnProperty.call(n,x)&&!Object.prototype.hasOwnProperty.call(s,x)&&(Ye(s[x],n[x])||c.push({command:w,args:[f,x,n[x],g]}))}function io(s){return s.id}function Oi(s,n){return s[n.id]=n,s}class nt{constructor(n,c,f,g){this.message=(n?`${n}: `:"")+f,g&&(this.identifier=g),c!=null&&c.__line__&&(this.line=c.__line__)}}function Mi(s,...n){for(const c of n)for(const f in c)s[f]=c[f];return s}class Yt extends Error{constructor(n,c){super(c),this.message=c,this.key=n}}class Ni{constructor(n,c=[]){this.parent=n,this.bindings={};for(const[f,g]of c)this.bindings[f]=g}concat(n){return new Ni(this,n)}get(n){if(this.bindings[n])return this.bindings[n];if(this.parent)return this.parent.get(n);throw new Error(`${n} not found in scope.`)}has(n){return!!this.bindings[n]||!!this.parent&&this.parent.has(n)}}const Xi={kind:"null"},_t={kind:"number"},oi={kind:"string"},Qt={kind:"boolean"},Ki={kind:"color"},br={kind:"object"},ni={kind:"value"},no={kind:"collator"},_n={kind:"formatted"},me={kind:"padding"},H={kind:"resolvedImage"},K={kind:"variableAnchorOffsetCollection"};function ie(s,n){return{kind:"array",itemType:s,N:n}}function de(s){if(s.kind==="array"){const n=de(s.itemType);return typeof s.N=="number"?`array<${n}, ${s.N}>`:s.itemType.kind==="value"?"array":`array<${n}>`}return s.kind}const Pe=[Xi,_t,oi,Qt,Ki,_n,br,ie(ni),me,H,K];function ze(s,n){if(n.kind==="error")return null;if(s.kind==="array"){if(n.kind==="array"&&(n.N===0&&n.itemType.kind==="value"||!ze(s.itemType,n.itemType))&&(typeof s.N!="number"||s.N===n.N))return null}else{if(s.kind===n.kind)return null;if(s.kind==="value"){for(const c of Pe)if(!ze(c,n))return null}}return`Expected ${de(s)} but found ${de(n)} instead.`}function Be(s,n){return n.some(c=>c.kind===s.kind)}function Se(s,n){return n.some(c=>c==="null"?s===null:c==="array"?Array.isArray(s):c==="object"?s&&!Array.isArray(s)&&typeof s=="object":c===typeof s)}function W(s,n){return s.kind==="array"&&n.kind==="array"?s.itemType.kind===n.itemType.kind&&typeof s.N=="number":s.kind===n.kind}const Ue=.96422,$e=.82521,Ge=4/29,Je=6/29,dt=3*Je*Je,Bt=Je*Je*Je,Xt=Math.PI/180,ui=180/Math.PI;function wi(s){return(s%=360)<0&&(s+=360),s}function sn([s,n,c,f]){let g,w;const x=hi((.2225045*(s=Rn(s))+.7168786*(n=Rn(n))+.0606169*(c=Rn(c)))/1);s===n&&n===c?g=w=x:(g=hi((.4360747*s+.3850649*n+.1430804*c)/Ue),w=hi((.0139322*s+.0971045*n+.7141733*c)/$e));const T=116*x-16;return[T<0?0:T,500*(g-x),200*(x-w),f]}function Rn(s){return s<=.04045?s/12.92:Math.pow((s+.055)/1.055,2.4)}function hi(s){return s>Bt?Math.pow(s,1/3):s/dt+Ge}function yn([s,n,c,f]){let g=(s+16)/116,w=isNaN(n)?g:g+n/500,x=isNaN(c)?g:g-c/200;return g=1*hr(g),w=Ue*hr(w),x=$e*hr(x),[$n(3.1338561*w-1.6168667*g-.4906146*x),$n(-.9787684*w+1.9161415*g+.033454*x),$n(.0719453*w-.2289914*g+1.4052427*x),f]}function $n(s){return(s=s<=.00304?12.92*s:1.055*Math.pow(s,1/2.4)-.055)<0?0:s>1?1:s}function hr(s){return s>Je?s*s*s:dt*(s-Ge)}function wr(s){return parseInt(s.padEnd(2,s),16)/255}function Qn(s,n){return go(n?s/100:s,0,1)}function go(s,n,c){return Math.min(Math.max(n,s),c)}function Yu(s){return!s.some(Number.isNaN)}const jd={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class ji{constructor(n,c,f,g=1,w=!0){this.r=n,this.g=c,this.b=f,this.a=g,w||(this.r*=g,this.g*=g,this.b*=g,g||this.overwriteGetter("rgb",[n,c,f,g]))}static parse(n){if(n instanceof ji)return n;if(typeof n!="string")return;const c=function(f){if((f=f.toLowerCase().trim())==="transparent")return[0,0,0,0];const g=jd[f];if(g){const[x,T,I]=g;return[x/255,T/255,I/255,1]}if(f.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(f)){const x=f.length<6?1:2;let T=1;return[wr(f.slice(T,T+=x)),wr(f.slice(T,T+=x)),wr(f.slice(T,T+=x)),wr(f.slice(T,T+x)||"ff")]}if(f.startsWith("rgb")){const x=f.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(x){const[T,I,z,N,V,X,Y,te,ue,ge,xe,Oe]=x,Te=[N||" ",Y||" ",ge].join("");if(Te==="  "||Te==="  /"||Te===",,"||Te===",,,"){const De=[z,X,ue].join(""),Qe=De==="%%%"?100:De===""?255:0;if(Qe){const tt=[go(+I/Qe,0,1),go(+V/Qe,0,1),go(+te/Qe,0,1),xe?Qn(+xe,Oe):1];if(Yu(tt))return tt}}return}}const w=f.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(w){const[x,T,I,z,N,V,X,Y,te]=w,ue=[I||" ",N||" ",X].join("");if(ue==="  "||ue==="  /"||ue===",,"||ue===",,,"){const ge=[+T,go(+z,0,100),go(+V,0,100),Y?Qn(+Y,te):1];if(Yu(ge))return function([xe,Oe,Te,De]){function Qe(tt){const Mt=(tt+xe/30)%12,Ft=Oe*Math.min(Te,1-Te);return Te-Ft*Math.max(-1,Math.min(Mt-3,9-Mt,1))}return xe=wi(xe),Oe/=100,Te/=100,[Qe(0),Qe(8),Qe(4),De]}(ge)}}}(n);return c?new ji(...c,!1):void 0}get rgb(){const{r:n,g:c,b:f,a:g}=this,w=g||1/0;return this.overwriteGetter("rgb",[n/w,c/w,f/w,g])}get hcl(){return this.overwriteGetter("hcl",function(n){const[c,f,g,w]=sn(n),x=Math.sqrt(f*f+g*g);return[Math.round(1e4*x)?wi(Math.atan2(g,f)*ui):NaN,x,c,w]}(this.rgb))}get lab(){return this.overwriteGetter("lab",sn(this.rgb))}overwriteGetter(n,c){return Object.defineProperty(this,n,{value:c}),c}toString(){const[n,c,f,g]=this.rgb;return`rgba(${[n,c,f].map(w=>Math.round(255*w)).join(",")},${g})`}}ji.black=new ji(0,0,0,1),ji.white=new ji(1,1,1,1),ji.transparent=new ji(0,0,0,0),ji.red=new ji(1,0,0,1);class hc{constructor(n,c,f){this.sensitivity=n?c?"variant":"case":c?"accent":"base",this.locale=f,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(n,c){return this.collator.compare(n,c)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class dc{constructor(n,c,f,g,w){this.text=n,this.image=c,this.scale=f,this.fontStack=g,this.textColor=w}}class Dr{constructor(n){this.sections=n}static fromString(n){return new Dr([new dc(n,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(n=>n.text.length!==0||n.image&&n.image.name.length!==0)}static factory(n){return n instanceof Dr?n:Dr.fromString(n)}toString(){return this.sections.length===0?"":this.sections.map(n=>n.text).join("")}}class xr{constructor(n){this.values=n.slice()}static parse(n){if(n instanceof xr)return n;if(typeof n=="number")return new xr([n,n,n,n]);if(Array.isArray(n)&&!(n.length<1||n.length>4)){for(const c of n)if(typeof c!="number")return;switch(n.length){case 1:n=[n[0],n[0],n[0],n[0]];break;case 2:n=[n[0],n[1],n[0],n[1]];break;case 3:n=[n[0],n[1],n[2],n[1]]}return new xr(n)}}toString(){return JSON.stringify(this.values)}}const ca=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Xr{constructor(n){this.values=n.slice()}static parse(n){if(n instanceof Xr)return n;if(Array.isArray(n)&&!(n.length<1)&&n.length%2==0){for(let c=0;c<n.length;c+=2){const f=n[c],g=n[c+1];if(typeof f!="string"||!ca.has(f)||!Array.isArray(g)||g.length!==2||typeof g[0]!="number"||typeof g[1]!="number")return}return new Xr(n)}}toString(){return JSON.stringify(this.values)}}class Kr{constructor(n){this.name=n.name,this.available=n.available}toString(){return this.name}static fromString(n){return n?new Kr({name:n,available:!1}):null}}function As(s,n,c,f){return typeof s=="number"&&s>=0&&s<=255&&typeof n=="number"&&n>=0&&n<=255&&typeof c=="number"&&c>=0&&c<=255?f===void 0||typeof f=="number"&&f>=0&&f<=1?null:`Invalid rgba value [${[s,n,c,f].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof f=="number"?[s,n,c,f]:[s,n,c]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function $a(s){if(s===null||typeof s=="string"||typeof s=="boolean"||typeof s=="number"||s instanceof ji||s instanceof hc||s instanceof Dr||s instanceof xr||s instanceof Xr||s instanceof Kr)return!0;if(Array.isArray(s)){for(const n of s)if(!$a(n))return!1;return!0}if(typeof s=="object"){for(const n in s)if(!$a(s[n]))return!1;return!0}return!1}function Bn(s){if(s===null)return Xi;if(typeof s=="string")return oi;if(typeof s=="boolean")return Qt;if(typeof s=="number")return _t;if(s instanceof ji)return Ki;if(s instanceof hc)return no;if(s instanceof Dr)return _n;if(s instanceof xr)return me;if(s instanceof Xr)return K;if(s instanceof Kr)return H;if(Array.isArray(s)){const n=s.length;let c;for(const f of s){const g=Bn(f);if(c){if(c===g)continue;c=ni;break}c=g}return ie(c||ni,n)}return br}function ua(s){const n=typeof s;return s===null?"":n==="string"||n==="number"||n==="boolean"?String(s):s instanceof ji||s instanceof Dr||s instanceof xr||s instanceof Xr||s instanceof Kr?s.toString():JSON.stringify(s)}class Go{constructor(n,c){this.type=n,this.value=c}static parse(n,c){if(n.length!==2)return c.error(`'literal' expression requires exactly one argument, but found ${n.length-1} instead.`);if(!$a(n[1]))return c.error("invalid value");const f=n[1];let g=Bn(f);const w=c.expectedType;return g.kind!=="array"||g.N!==0||!w||w.kind!=="array"||typeof w.N=="number"&&w.N!==0||(g=w),new Go(g,f)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class dn{constructor(n){this.name="ExpressionEvaluationError",this.message=n}toJSON(){return this.message}}const qa={string:oi,number:_t,boolean:Qt,object:br};class Rr{constructor(n,c){this.type=n,this.args=c}static parse(n,c){if(n.length<2)return c.error("Expected at least one argument.");let f,g=1;const w=n[0];if(w==="array"){let T,I;if(n.length>2){const z=n[1];if(typeof z!="string"||!(z in qa)||z==="object")return c.error('The item type argument of "array" must be one of string, number, boolean',1);T=qa[z],g++}else T=ni;if(n.length>3){if(n[2]!==null&&(typeof n[2]!="number"||n[2]<0||n[2]!==Math.floor(n[2])))return c.error('The length argument to "array" must be a positive integer literal',2);I=n[2],g++}f=ie(T,I)}else{if(!qa[w])throw new Error(`Types doesn't contain name = ${w}`);f=qa[w]}const x=[];for(;g<n.length;g++){const T=c.parse(n[g],g,ni);if(!T)return null;x.push(T)}return new Rr(f,x)}evaluate(n){for(let c=0;c<this.args.length;c++){const f=this.args[c].evaluate(n);if(!ze(this.type,Bn(f)))return f;if(c===this.args.length-1)throw new dn(`Expected value to be of type ${de(this.type)}, but found ${de(Bn(f))} instead.`)}throw new Error}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}}const Za={"to-boolean":Qt,"to-color":Ki,"to-number":_t,"to-string":oi};class _o{constructor(n,c){this.type=n,this.args=c}static parse(n,c){if(n.length<2)return c.error("Expected at least one argument.");const f=n[0];if(!Za[f])throw new Error(`Can't parse ${f} as it is not part of the known types`);if((f==="to-boolean"||f==="to-string")&&n.length!==2)return c.error("Expected one argument.");const g=Za[f],w=[];for(let x=1;x<n.length;x++){const T=c.parse(n[x],x,ni);if(!T)return null;w.push(T)}return new _o(g,w)}evaluate(n){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(n);case"color":{let c,f;for(const g of this.args){if(c=g.evaluate(n),f=null,c instanceof ji)return c;if(typeof c=="string"){const w=n.parseColor(c);if(w)return w}else if(Array.isArray(c)&&(f=c.length<3||c.length>4?`Invalid rbga value ${JSON.stringify(c)}: expected an array containing either three or four numeric values.`:As(c[0],c[1],c[2],c[3]),!f))return new ji(c[0]/255,c[1]/255,c[2]/255,c[3])}throw new dn(f||`Could not parse color from value '${typeof c=="string"?c:JSON.stringify(c)}'`)}case"padding":{let c;for(const f of this.args){c=f.evaluate(n);const g=xr.parse(c);if(g)return g}throw new dn(`Could not parse padding from value '${typeof c=="string"?c:JSON.stringify(c)}'`)}case"variableAnchorOffsetCollection":{let c;for(const f of this.args){c=f.evaluate(n);const g=Xr.parse(c);if(g)return g}throw new dn(`Could not parse variableAnchorOffsetCollection from value '${typeof c=="string"?c:JSON.stringify(c)}'`)}case"number":{let c=null;for(const f of this.args){if(c=f.evaluate(n),c===null)return 0;const g=Number(c);if(!isNaN(g))return g}throw new dn(`Could not convert ${JSON.stringify(c)} to number.`)}case"formatted":return Dr.fromString(ua(this.args[0].evaluate(n)));case"resolvedImage":return Kr.fromString(ua(this.args[0].evaluate(n)));default:return ua(this.args[0].evaluate(n))}}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}}const ha=["Unknown","Point","LineString","Polygon"];class Ui{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?ha[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(n){let c=this._parseColorCache[n];return c||(c=this._parseColorCache[n]=ji.parse(n)),c}}class Ga{constructor(n,c,f=[],g,w=new Ni,x=[]){this.registry=n,this.path=f,this.key=f.map(T=>`[${T}]`).join(""),this.scope=w,this.errors=x,this.expectedType=g,this._isConstant=c}parse(n,c,f,g,w={}){return c?this.concat(c,f,g)._parse(n,w):this._parse(n,w)}_parse(n,c){function f(g,w,x){return x==="assert"?new Rr(w,[g]):x==="coerce"?new _o(w,[g]):g}if(n!==null&&typeof n!="string"&&typeof n!="boolean"&&typeof n!="number"||(n=["literal",n]),Array.isArray(n)){if(n.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const g=n[0];if(typeof g!="string")return this.error(`Expression name must be a string, but found ${typeof g} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const w=this.registry[g];if(w){let x=w.parse(n,this);if(!x)return null;if(this.expectedType){const T=this.expectedType,I=x.type;if(T.kind!=="string"&&T.kind!=="number"&&T.kind!=="boolean"&&T.kind!=="object"&&T.kind!=="array"||I.kind!=="value")if(T.kind!=="color"&&T.kind!=="formatted"&&T.kind!=="resolvedImage"||I.kind!=="value"&&I.kind!=="string")if(T.kind!=="padding"||I.kind!=="value"&&I.kind!=="number"&&I.kind!=="array")if(T.kind!=="variableAnchorOffsetCollection"||I.kind!=="value"&&I.kind!=="array"){if(this.checkSubtype(T,I))return null}else x=f(x,T,c.typeAnnotation||"coerce");else x=f(x,T,c.typeAnnotation||"coerce");else x=f(x,T,c.typeAnnotation||"coerce");else x=f(x,T,c.typeAnnotation||"assert")}if(!(x instanceof Go)&&x.type.kind!=="resolvedImage"&&this._isConstant(x)){const T=new Ui;try{x=new Go(x.type,x.evaluate(T))}catch(I){return this.error(I.message),null}}return x}return this.error(`Unknown expression "${g}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(n===void 0?"'undefined' value invalid. Use null instead.":typeof n=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof n} instead.`)}concat(n,c,f){const g=typeof n=="number"?this.path.concat(n):this.path,w=f?this.scope.concat(f):this.scope;return new Ga(this.registry,this._isConstant,g,c||null,w,this.errors)}error(n,...c){const f=`${this.key}${c.map(g=>`[${g}]`).join("")}`;this.errors.push(new Yt(f,n))}checkSubtype(n,c){const f=ze(n,c);return f&&this.error(f),f}}class Ps{constructor(n,c,f){this.type=no,this.locale=f,this.caseSensitive=n,this.diacriticSensitive=c}static parse(n,c){if(n.length!==2)return c.error("Expected one argument.");const f=n[1];if(typeof f!="object"||Array.isArray(f))return c.error("Collator options argument must be an object.");const g=c.parse(f["case-sensitive"]!==void 0&&f["case-sensitive"],1,Qt);if(!g)return null;const w=c.parse(f["diacritic-sensitive"]!==void 0&&f["diacritic-sensitive"],1,Qt);if(!w)return null;let x=null;return f.locale&&(x=c.parse(f.locale,1,oi),!x)?null:new Ps(g,w,x)}evaluate(n){return new hc(this.caseSensitive.evaluate(n),this.diacriticSensitive.evaluate(n),this.locale?this.locale.evaluate(n):null)}eachChild(n){n(this.caseSensitive),n(this.diacriticSensitive),this.locale&&n(this.locale)}outputDefined(){return!1}}const Wo=8192;function Wa(s,n){s[0]=Math.min(s[0],n[0]),s[1]=Math.min(s[1],n[1]),s[2]=Math.max(s[2],n[0]),s[3]=Math.max(s[3],n[1])}function da(s,n){return!(s[0]<=n[0]||s[2]>=n[2]||s[1]<=n[1]||s[3]>=n[3])}function Ud(s,n){const c=(180+s[0])/360,f=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s[1]*Math.PI/360)))/360,g=Math.pow(2,n.z);return[Math.round(c*g*Wo),Math.round(f*g*Wo)]}function Qu(s,n,c){const f=s[0]-n[0],g=s[1]-n[1],w=s[0]-c[0],x=s[1]-c[1];return f*x-w*g==0&&f*w<=0&&g*x<=0}function Ha(s,n){let c=!1;for(let x=0,T=n.length;x<T;x++){const I=n[x];for(let z=0,N=I.length;z<N-1;z++){if(Qu(s,I[z],I[z+1]))return!1;(g=I[z])[1]>(f=s)[1]!=(w=I[z+1])[1]>f[1]&&f[0]<(w[0]-g[0])*(f[1]-g[1])/(w[1]-g[1])+g[0]&&(c=!c)}}var f,g,w;return c}function Vd(s,n){for(let c=0;c<n.length;c++)if(Ha(s,n[c]))return!0;return!1}function eh(s,n,c,f){const g=f[0]-c[0],w=f[1]-c[1],x=(s[0]-c[0])*w-g*(s[1]-c[1]),T=(n[0]-c[0])*w-g*(n[1]-c[1]);return x>0&&T<0||x<0&&T>0}function $d(s,n,c){for(const z of c)for(let N=0;N<z.length-1;++N)if((T=[(x=z[N+1])[0]-(w=z[N])[0],x[1]-w[1]])[0]*(I=[(g=n)[0]-(f=s)[0],g[1]-f[1]])[1]-T[1]*I[0]!=0&&eh(f,g,w,x)&&eh(w,x,f,g))return!0;var f,g,w,x,T,I;return!1}function th(s,n){for(let c=0;c<s.length;++c)if(!Ha(s[c],n))return!1;for(let c=0;c<s.length-1;++c)if($d(s[c],s[c+1],n))return!1;return!0}function ih(s,n){for(let c=0;c<n.length;c++)if(th(s,n[c]))return!0;return!1}function Xa(s,n,c){const f=[];for(let g=0;g<s.length;g++){const w=[];for(let x=0;x<s[g].length;x++){const T=Ud(s[g][x],c);Wa(n,T),w.push(T)}f.push(w)}return f}function nh(s,n,c){const f=[];for(let g=0;g<s.length;g++){const w=Xa(s[g],n,c);f.push(w)}return f}function rh(s,n,c,f){if(s[0]<c[0]||s[0]>c[2]){const g=.5*f;let w=s[0]-c[0]>g?-f:c[0]-s[0]>g?f:0;w===0&&(w=s[0]-c[2]>g?-f:c[2]-s[0]>g?f:0),s[0]+=w}Wa(n,s)}function Ka(s,n,c,f){const g=Math.pow(2,f.z)*Wo,w=[f.x*Wo,f.y*Wo],x=[];for(const T of s)for(const I of T){const z=[I.x+w[0],I.y+w[1]];rh(z,n,c,g),x.push(z)}return x}function oh(s,n,c,f){const g=Math.pow(2,f.z)*Wo,w=[f.x*Wo,f.y*Wo],x=[];for(const I of s){const z=[];for(const N of I){const V=[N.x+w[0],N.y+w[1]];Wa(n,V),z.push(V)}x.push(z)}if(n[2]-n[0]<=g/2){(T=n)[0]=T[1]=1/0,T[2]=T[3]=-1/0;for(const I of x)for(const z of I)rh(z,n,c,g)}var T;return x}class os{constructor(n,c){this.type=Qt,this.geojson=n,this.geometries=c}static parse(n,c){if(n.length!==2)return c.error(`'within' expression requires exactly one argument, but found ${n.length-1} instead.`);if($a(n[1])){const f=n[1];if(f.type==="FeatureCollection"){const g=[];for(const w of f.features){const{type:x,coordinates:T}=w.geometry;x==="Polygon"&&g.push(T),x==="MultiPolygon"&&g.push(...T)}if(g.length)return new os(f,{type:"MultiPolygon",coordinates:g})}else if(f.type==="Feature"){const g=f.geometry.type;if(g==="Polygon"||g==="MultiPolygon")return new os(f,f.geometry)}else if(f.type==="Polygon"||f.type==="MultiPolygon")return new os(f,f)}return c.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(n){if(n.geometry()!=null&&n.canonicalID()!=null){if(n.geometryType()==="Point")return function(c,f){const g=[1/0,1/0,-1/0,-1/0],w=[1/0,1/0,-1/0,-1/0],x=c.canonicalID();if(f.type==="Polygon"){const T=Xa(f.coordinates,w,x),I=Ka(c.geometry(),g,w,x);if(!da(g,w))return!1;for(const z of I)if(!Ha(z,T))return!1}if(f.type==="MultiPolygon"){const T=nh(f.coordinates,w,x),I=Ka(c.geometry(),g,w,x);if(!da(g,w))return!1;for(const z of I)if(!Vd(z,T))return!1}return!0}(n,this.geometries);if(n.geometryType()==="LineString")return function(c,f){const g=[1/0,1/0,-1/0,-1/0],w=[1/0,1/0,-1/0,-1/0],x=c.canonicalID();if(f.type==="Polygon"){const T=Xa(f.coordinates,w,x),I=oh(c.geometry(),g,w,x);if(!da(g,w))return!1;for(const z of I)if(!th(z,T))return!1}if(f.type==="MultiPolygon"){const T=nh(f.coordinates,w,x),I=oh(c.geometry(),g,w,x);if(!da(g,w))return!1;for(const z of I)if(!ih(z,T))return!1}return!0}(n,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class Ja{constructor(n,c){this.type=c.type,this.name=n,this.boundExpression=c}static parse(n,c){if(n.length!==2||typeof n[1]!="string")return c.error("'var' expression requires exactly one string literal argument.");const f=n[1];return c.scope.has(f)?new Ja(f,c.scope.get(f)):c.error(`Unknown variable "${f}". Make sure "${f}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(n){return this.boundExpression.evaluate(n)}eachChild(){}outputDefined(){return!1}}class Br{constructor(n,c,f,g){this.name=n,this.type=c,this._evaluate=f,this.args=g}evaluate(n){return this._evaluate(n,this.args)}eachChild(n){this.args.forEach(n)}outputDefined(){return!1}static parse(n,c){const f=n[0],g=Br.definitions[f];if(!g)return c.error(`Unknown expression "${f}". If you wanted a literal array, use ["literal", [...]].`,0);const w=Array.isArray(g)?g[0]:g.type,x=Array.isArray(g)?[[g[1],g[2]]]:g.overloads,T=x.filter(([z])=>!Array.isArray(z)||z.length===n.length-1);let I=null;for(const[z,N]of T){I=new Ga(c.registry,fa,c.path,null,c.scope);const V=[];let X=!1;for(let Y=1;Y<n.length;Y++){const te=n[Y],ue=Array.isArray(z)?z[Y-1]:z.type,ge=I.parse(te,1+V.length,ue);if(!ge){X=!0;break}V.push(ge)}if(!X)if(Array.isArray(z)&&z.length!==V.length)I.error(`Expected ${z.length} arguments, but found ${V.length} instead.`);else{for(let Y=0;Y<V.length;Y++){const te=Array.isArray(z)?z[Y]:z.type,ue=V[Y];I.concat(Y+1).checkSubtype(te,ue.type)}if(I.errors.length===0)return new Br(f,w,N,V)}}if(T.length===1)c.errors.push(...I.errors);else{const z=(T.length?T:x).map(([V])=>{return X=V,Array.isArray(X)?`(${X.map(de).join(", ")})`:`(${de(X.type)}...)`;var X}).join(" | "),N=[];for(let V=1;V<n.length;V++){const X=c.parse(n[V],1+N.length);if(!X)return null;N.push(de(X.type))}c.error(`Expected arguments of type ${z}, but found (${N.join(", ")}) instead.`)}return null}static register(n,c){Br.definitions=c;for(const f in c)n[f]=Br}}function fa(s){if(s instanceof Ja)return fa(s.boundExpression);if(s instanceof Br&&s.name==="error"||s instanceof Ps||s instanceof os)return!1;const n=s instanceof _o||s instanceof Rr;let c=!0;return s.eachChild(f=>{c=n?c&&fa(f):c&&f instanceof Go}),!!c&&Ya(s)&&ma(s,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Ya(s){if(s instanceof Br&&(s.name==="get"&&s.args.length===1||s.name==="feature-state"||s.name==="has"&&s.args.length===1||s.name==="properties"||s.name==="geometry-type"||s.name==="id"||/^filter-/.test(s.name))||s instanceof os)return!1;let n=!0;return s.eachChild(c=>{n&&!Ya(c)&&(n=!1)}),n}function pa(s){if(s instanceof Br&&s.name==="feature-state")return!1;let n=!0;return s.eachChild(c=>{n&&!pa(c)&&(n=!1)}),n}function ma(s,n){if(s instanceof Br&&n.indexOf(s.name)>=0)return!1;let c=!0;return s.eachChild(f=>{c&&!ma(f,n)&&(c=!1)}),c}function ga(s,n){const c=s.length-1;let f,g,w=0,x=c,T=0;for(;w<=x;)if(T=Math.floor((w+x)/2),f=s[T],g=s[T+1],f<=n){if(T===c||n<g)return T;w=T+1}else{if(!(f>n))throw new dn("Input is not a number.");x=T-1}return 0}class _a{constructor(n,c,f){this.type=n,this.input=c,this.labels=[],this.outputs=[];for(const[g,w]of f)this.labels.push(g),this.outputs.push(w)}static parse(n,c){if(n.length-1<4)return c.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if((n.length-1)%2!=0)return c.error("Expected an even number of arguments.");const f=c.parse(n[1],1,_t);if(!f)return null;const g=[];let w=null;c.expectedType&&c.expectedType.kind!=="value"&&(w=c.expectedType);for(let x=1;x<n.length;x+=2){const T=x===1?-1/0:n[x],I=n[x+1],z=x,N=x+1;if(typeof T!="number")return c.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',z);if(g.length&&g[g.length-1][0]>=T)return c.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',z);const V=c.parse(I,N,w);if(!V)return null;w=w||V.type,g.push([T,V])}return new _a(w,f,g)}evaluate(n){const c=this.labels,f=this.outputs;if(c.length===1)return f[0].evaluate(n);const g=this.input.evaluate(n);if(g<=c[0])return f[0].evaluate(n);const w=c.length;return g>=c[w-1]?f[w-1].evaluate(n):f[ga(c,g)].evaluate(n)}eachChild(n){n(this.input);for(const c of this.outputs)n(c)}outputDefined(){return this.outputs.every(n=>n.outputDefined())}}function qd(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var Zd=sh;function sh(s,n,c,f){this.cx=3*s,this.bx=3*(c-s)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*n,this.by=3*(f-n)-this.cy,this.ay=1-this.cy-this.by,this.p1x=s,this.p1y=n,this.p2x=c,this.p2y=f}sh.prototype={sampleCurveX:function(s){return((this.ax*s+this.bx)*s+this.cx)*s},sampleCurveY:function(s){return((this.ay*s+this.by)*s+this.cy)*s},sampleCurveDerivativeX:function(s){return(3*this.ax*s+2*this.bx)*s+this.cx},solveCurveX:function(s,n){if(n===void 0&&(n=1e-6),s<0)return 0;if(s>1)return 1;for(var c=s,f=0;f<8;f++){var g=this.sampleCurveX(c)-s;if(Math.abs(g)<n)return c;var w=this.sampleCurveDerivativeX(c);if(Math.abs(w)<1e-6)break;c-=g/w}var x=0,T=1;for(c=s,f=0;f<20&&(g=this.sampleCurveX(c),!(Math.abs(g-s)<n));f++)s>g?x=c:T=c,c=.5*(T-x)+x;return c},solve:function(s,n){return this.sampleCurveY(this.solveCurveX(s,n))}};var Gd=qd(Zd);function ss(s,n,c){return s+c*(n-s)}function Qa(s,n,c){return s.map((f,g)=>ss(f,n[g],c))}const dr={number:ss,color:function(s,n,c,f="rgb"){switch(f){case"rgb":{const[g,w,x,T]=Qa(s.rgb,n.rgb,c);return new ji(g,w,x,T,!1)}case"hcl":{const[g,w,x,T]=s.hcl,[I,z,N,V]=n.hcl;let X,Y;if(isNaN(g)||isNaN(I))isNaN(g)?isNaN(I)?X=NaN:(X=I,x!==1&&x!==0||(Y=z)):(X=g,N!==1&&N!==0||(Y=w));else{let Oe=I-g;I>g&&Oe>180?Oe-=360:I<g&&g-I>180&&(Oe+=360),X=g+c*Oe}const[te,ue,ge,xe]=function([Oe,Te,De,Qe]){return Oe=isNaN(Oe)?0:Oe*Xt,yn([De,Math.cos(Oe)*Te,Math.sin(Oe)*Te,Qe])}([X,Y??ss(w,z,c),ss(x,N,c),ss(T,V,c)]);return new ji(te,ue,ge,xe,!1)}case"lab":{const[g,w,x,T]=yn(Qa(s.lab,n.lab,c));return new ji(g,w,x,T,!1)}}},array:Qa,padding:function(s,n,c){return new xr(Qa(s.values,n.values,c))},variableAnchorOffsetCollection:function(s,n,c){const f=s.values,g=n.values;if(f.length!==g.length)throw new dn(`Cannot interpolate values of different length. from: ${s.toString()}, to: ${n.toString()}`);const w=[];for(let x=0;x<f.length;x+=2){if(f[x]!==g[x])throw new dn(`Cannot interpolate values containing mismatched anchors. from[${x}]: ${f[x]}, to[${x}]: ${g[x]}`);w.push(f[x]);const[T,I]=f[x+1],[z,N]=g[x+1];w.push([ss(T,z,c),ss(I,N,c)])}return new Xr(w)}};class rr{constructor(n,c,f,g,w){this.type=n,this.operator=c,this.interpolation=f,this.input=g,this.labels=[],this.outputs=[];for(const[x,T]of w)this.labels.push(x),this.outputs.push(T)}static interpolationFactor(n,c,f,g){let w=0;if(n.name==="exponential")w=Di(c,n.base,f,g);else if(n.name==="linear")w=Di(c,1,f,g);else if(n.name==="cubic-bezier"){const x=n.controlPoints;w=new Gd(x[0],x[1],x[2],x[3]).solve(Di(c,1,f,g))}return w}static parse(n,c){let[f,g,w,...x]=n;if(!Array.isArray(g)||g.length===0)return c.error("Expected an interpolation type expression.",1);if(g[0]==="linear")g={name:"linear"};else if(g[0]==="exponential"){const z=g[1];if(typeof z!="number")return c.error("Exponential interpolation requires a numeric base.",1,1);g={name:"exponential",base:z}}else{if(g[0]!=="cubic-bezier")return c.error(`Unknown interpolation type ${String(g[0])}`,1,0);{const z=g.slice(1);if(z.length!==4||z.some(N=>typeof N!="number"||N<0||N>1))return c.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);g={name:"cubic-bezier",controlPoints:z}}}if(n.length-1<4)return c.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if((n.length-1)%2!=0)return c.error("Expected an even number of arguments.");if(w=c.parse(w,2,_t),!w)return null;const T=[];let I=null;f==="interpolate-hcl"||f==="interpolate-lab"?I=Ki:c.expectedType&&c.expectedType.kind!=="value"&&(I=c.expectedType);for(let z=0;z<x.length;z+=2){const N=x[z],V=x[z+1],X=z+3,Y=z+4;if(typeof N!="number")return c.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',X);if(T.length&&T[T.length-1][0]>=N)return c.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',X);const te=c.parse(V,Y,I);if(!te)return null;I=I||te.type,T.push([N,te])}return W(I,_t)||W(I,Ki)||W(I,me)||W(I,K)||W(I,ie(_t))?new rr(I,f,g,w,T):c.error(`Type ${de(I)} is not interpolatable.`)}evaluate(n){const c=this.labels,f=this.outputs;if(c.length===1)return f[0].evaluate(n);const g=this.input.evaluate(n);if(g<=c[0])return f[0].evaluate(n);const w=c.length;if(g>=c[w-1])return f[w-1].evaluate(n);const x=ga(c,g),T=rr.interpolationFactor(this.interpolation,g,c[x],c[x+1]),I=f[x].evaluate(n),z=f[x+1].evaluate(n);switch(this.operator){case"interpolate":return dr[this.type.kind](I,z,T);case"interpolate-hcl":return dr.color(I,z,T,"hcl");case"interpolate-lab":return dr.color(I,z,T,"lab")}}eachChild(n){n(this.input);for(const c of this.outputs)n(c)}outputDefined(){return this.outputs.every(n=>n.outputDefined())}}function Di(s,n,c,f){const g=f-c,w=s-c;return g===0?0:n===1?w/g:(Math.pow(n,w)-1)/(Math.pow(n,g)-1)}class el{constructor(n,c){this.type=n,this.args=c}static parse(n,c){if(n.length<2)return c.error("Expectected at least one argument.");let f=null;const g=c.expectedType;g&&g.kind!=="value"&&(f=g);const w=[];for(const T of n.slice(1)){const I=c.parse(T,1+w.length,f,void 0,{typeAnnotation:"omit"});if(!I)return null;f=f||I.type,w.push(I)}if(!f)throw new Error("No output type");const x=g&&w.some(T=>ze(g,T.type));return new el(x?ni:f,w)}evaluate(n){let c,f=null,g=0;for(const w of this.args)if(g++,f=w.evaluate(n),f&&f instanceof Kr&&!f.available&&(c||(c=f.name),f=null,g===this.args.length&&(f=c)),f!==null)break;return f}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}}class tl{constructor(n,c){this.type=c.type,this.bindings=[].concat(n),this.result=c}evaluate(n){return this.result.evaluate(n)}eachChild(n){for(const c of this.bindings)n(c[1]);n(this.result)}static parse(n,c){if(n.length<4)return c.error(`Expected at least 3 arguments, but found ${n.length-1} instead.`);const f=[];for(let w=1;w<n.length-1;w+=2){const x=n[w];if(typeof x!="string")return c.error(`Expected string, but found ${typeof x} instead.`,w);if(/[^a-zA-Z0-9_]/.test(x))return c.error("Variable names must contain only alphanumeric characters or '_'.",w);const T=c.parse(n[w+1],w+1);if(!T)return null;f.push([x,T])}const g=c.parse(n[n.length-1],n.length-1,c.expectedType,f);return g?new tl(f,g):null}outputDefined(){return this.result.outputDefined()}}class fc{constructor(n,c,f){this.type=n,this.index=c,this.input=f}static parse(n,c){if(n.length!==3)return c.error(`Expected 2 arguments, but found ${n.length-1} instead.`);const f=c.parse(n[1],1,_t),g=c.parse(n[2],2,ie(c.expectedType||ni));return f&&g?new fc(g.type.itemType,f,g):null}evaluate(n){const c=this.index.evaluate(n),f=this.input.evaluate(n);if(c<0)throw new dn(`Array index out of bounds: ${c} < 0.`);if(c>=f.length)throw new dn(`Array index out of bounds: ${c} > ${f.length-1}.`);if(c!==Math.floor(c))throw new dn(`Array index must be an integer, but found ${c} instead.`);return f[c]}eachChild(n){n(this.index),n(this.input)}outputDefined(){return!1}}class pc{constructor(n,c){this.type=Qt,this.needle=n,this.haystack=c}static parse(n,c){if(n.length!==3)return c.error(`Expected 2 arguments, but found ${n.length-1} instead.`);const f=c.parse(n[1],1,ni),g=c.parse(n[2],2,ni);return f&&g?Be(f.type,[Qt,oi,_t,Xi,ni])?new pc(f,g):c.error(`Expected first argument to be of type boolean, string, number or null, but found ${de(f.type)} instead`):null}evaluate(n){const c=this.needle.evaluate(n),f=this.haystack.evaluate(n);if(!f)return!1;if(!Se(c,["boolean","string","number","null"]))throw new dn(`Expected first argument to be of type boolean, string, number or null, but found ${de(Bn(c))} instead.`);if(!Se(f,["string","array"]))throw new dn(`Expected second argument to be of type array or string, but found ${de(Bn(f))} instead.`);return f.indexOf(c)>=0}eachChild(n){n(this.needle),n(this.haystack)}outputDefined(){return!0}}class il{constructor(n,c,f){this.type=_t,this.needle=n,this.haystack=c,this.fromIndex=f}static parse(n,c){if(n.length<=2||n.length>=5)return c.error(`Expected 3 or 4 arguments, but found ${n.length-1} instead.`);const f=c.parse(n[1],1,ni),g=c.parse(n[2],2,ni);if(!f||!g)return null;if(!Be(f.type,[Qt,oi,_t,Xi,ni]))return c.error(`Expected first argument to be of type boolean, string, number or null, but found ${de(f.type)} instead`);if(n.length===4){const w=c.parse(n[3],3,_t);return w?new il(f,g,w):null}return new il(f,g)}evaluate(n){const c=this.needle.evaluate(n),f=this.haystack.evaluate(n);if(!Se(c,["boolean","string","number","null"]))throw new dn(`Expected first argument to be of type boolean, string, number or null, but found ${de(Bn(c))} instead.`);if(!Se(f,["string","array"]))throw new dn(`Expected second argument to be of type array or string, but found ${de(Bn(f))} instead.`);if(this.fromIndex){const g=this.fromIndex.evaluate(n);return f.indexOf(c,g)}return f.indexOf(c)}eachChild(n){n(this.needle),n(this.haystack),this.fromIndex&&n(this.fromIndex)}outputDefined(){return!1}}class mc{constructor(n,c,f,g,w,x){this.inputType=n,this.type=c,this.input=f,this.cases=g,this.outputs=w,this.otherwise=x}static parse(n,c){if(n.length<5)return c.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if(n.length%2!=1)return c.error("Expected an even number of arguments.");let f,g;c.expectedType&&c.expectedType.kind!=="value"&&(g=c.expectedType);const w={},x=[];for(let z=2;z<n.length-1;z+=2){let N=n[z];const V=n[z+1];Array.isArray(N)||(N=[N]);const X=c.concat(z);if(N.length===0)return X.error("Expected at least one branch label.");for(const te of N){if(typeof te!="number"&&typeof te!="string")return X.error("Branch labels must be numbers or strings.");if(typeof te=="number"&&Math.abs(te)>Number.MAX_SAFE_INTEGER)return X.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof te=="number"&&Math.floor(te)!==te)return X.error("Numeric branch labels must be integer values.");if(f){if(X.checkSubtype(f,Bn(te)))return null}else f=Bn(te);if(w[String(te)]!==void 0)return X.error("Branch labels must be unique.");w[String(te)]=x.length}const Y=c.parse(V,z,g);if(!Y)return null;g=g||Y.type,x.push(Y)}const T=c.parse(n[1],1,ni);if(!T)return null;const I=c.parse(n[n.length-1],n.length-1,g);return I?T.type.kind!=="value"&&c.concat(1).checkSubtype(f,T.type)?null:new mc(f,g,T,w,x,I):null}evaluate(n){const c=this.input.evaluate(n);return(Bn(c)===this.inputType&&this.outputs[this.cases[c]]||this.otherwise).evaluate(n)}eachChild(n){n(this.input),this.outputs.forEach(n),n(this.otherwise)}outputDefined(){return this.outputs.every(n=>n.outputDefined())&&this.otherwise.outputDefined()}}class gc{constructor(n,c,f){this.type=n,this.branches=c,this.otherwise=f}static parse(n,c){if(n.length<4)return c.error(`Expected at least 3 arguments, but found only ${n.length-1}.`);if(n.length%2!=0)return c.error("Expected an odd number of arguments.");let f;c.expectedType&&c.expectedType.kind!=="value"&&(f=c.expectedType);const g=[];for(let x=1;x<n.length-1;x+=2){const T=c.parse(n[x],x,Qt);if(!T)return null;const I=c.parse(n[x+1],x+1,f);if(!I)return null;g.push([T,I]),f=f||I.type}const w=c.parse(n[n.length-1],n.length-1,f);if(!w)return null;if(!f)throw new Error("Can't infer output type");return new gc(f,g,w)}evaluate(n){for(const[c,f]of this.branches)if(c.evaluate(n))return f.evaluate(n);return this.otherwise.evaluate(n)}eachChild(n){for(const[c,f]of this.branches)n(c),n(f);n(this.otherwise)}outputDefined(){return this.branches.every(([n,c])=>c.outputDefined())&&this.otherwise.outputDefined()}}class nl{constructor(n,c,f,g){this.type=n,this.input=c,this.beginIndex=f,this.endIndex=g}static parse(n,c){if(n.length<=2||n.length>=5)return c.error(`Expected 3 or 4 arguments, but found ${n.length-1} instead.`);const f=c.parse(n[1],1,ni),g=c.parse(n[2],2,_t);if(!f||!g)return null;if(!Be(f.type,[ie(ni),oi,ni]))return c.error(`Expected first argument to be of type array or string, but found ${de(f.type)} instead`);if(n.length===4){const w=c.parse(n[3],3,_t);return w?new nl(f.type,f,g,w):null}return new nl(f.type,f,g)}evaluate(n){const c=this.input.evaluate(n),f=this.beginIndex.evaluate(n);if(!Se(c,["string","array"]))throw new dn(`Expected first argument to be of type array or string, but found ${de(Bn(c))} instead.`);if(this.endIndex){const g=this.endIndex.evaluate(n);return c.slice(f,g)}return c.slice(f)}eachChild(n){n(this.input),n(this.beginIndex),this.endIndex&&n(this.endIndex)}outputDefined(){return!1}}function ah(s,n){return s==="=="||s==="!="?n.kind==="boolean"||n.kind==="string"||n.kind==="number"||n.kind==="null"||n.kind==="value":n.kind==="string"||n.kind==="number"||n.kind==="value"}function lh(s,n,c,f){return f.compare(n,c)===0}function zs(s,n,c){const f=s!=="=="&&s!=="!=";return class c0{constructor(w,x,T){this.type=Qt,this.lhs=w,this.rhs=x,this.collator=T,this.hasUntypedArgument=w.type.kind==="value"||x.type.kind==="value"}static parse(w,x){if(w.length!==3&&w.length!==4)return x.error("Expected two or three arguments.");const T=w[0];let I=x.parse(w[1],1,ni);if(!I)return null;if(!ah(T,I.type))return x.concat(1).error(`"${T}" comparisons are not supported for type '${de(I.type)}'.`);let z=x.parse(w[2],2,ni);if(!z)return null;if(!ah(T,z.type))return x.concat(2).error(`"${T}" comparisons are not supported for type '${de(z.type)}'.`);if(I.type.kind!==z.type.kind&&I.type.kind!=="value"&&z.type.kind!=="value")return x.error(`Cannot compare types '${de(I.type)}' and '${de(z.type)}'.`);f&&(I.type.kind==="value"&&z.type.kind!=="value"?I=new Rr(z.type,[I]):I.type.kind!=="value"&&z.type.kind==="value"&&(z=new Rr(I.type,[z])));let N=null;if(w.length===4){if(I.type.kind!=="string"&&z.type.kind!=="string"&&I.type.kind!=="value"&&z.type.kind!=="value")return x.error("Cannot use collator to compare non-string types.");if(N=x.parse(w[3],3,no),!N)return null}return new c0(I,z,N)}evaluate(w){const x=this.lhs.evaluate(w),T=this.rhs.evaluate(w);if(f&&this.hasUntypedArgument){const I=Bn(x),z=Bn(T);if(I.kind!==z.kind||I.kind!=="string"&&I.kind!=="number")throw new dn(`Expected arguments for "${s}" to be (string, string) or (number, number), but found (${I.kind}, ${z.kind}) instead.`)}if(this.collator&&!f&&this.hasUntypedArgument){const I=Bn(x),z=Bn(T);if(I.kind!=="string"||z.kind!=="string")return n(w,x,T)}return this.collator?c(w,x,T,this.collator.evaluate(w)):n(w,x,T)}eachChild(w){w(this.lhs),w(this.rhs),this.collator&&w(this.collator)}outputDefined(){return!0}}}const Wd=zs("==",function(s,n,c){return n===c},lh),Hd=zs("!=",function(s,n,c){return n!==c},function(s,n,c,f){return!lh(0,n,c,f)}),Xd=zs("<",function(s,n,c){return n<c},function(s,n,c,f){return f.compare(n,c)<0}),Kd=zs(">",function(s,n,c){return n>c},function(s,n,c,f){return f.compare(n,c)>0}),Jd=zs("<=",function(s,n,c){return n<=c},function(s,n,c,f){return f.compare(n,c)<=0}),Yd=zs(">=",function(s,n,c){return n>=c},function(s,n,c,f){return f.compare(n,c)>=0});class _c{constructor(n,c,f,g,w){this.type=oi,this.number=n,this.locale=c,this.currency=f,this.minFractionDigits=g,this.maxFractionDigits=w}static parse(n,c){if(n.length!==3)return c.error("Expected two arguments.");const f=c.parse(n[1],1,_t);if(!f)return null;const g=n[2];if(typeof g!="object"||Array.isArray(g))return c.error("NumberFormat options argument must be an object.");let w=null;if(g.locale&&(w=c.parse(g.locale,1,oi),!w))return null;let x=null;if(g.currency&&(x=c.parse(g.currency,1,oi),!x))return null;let T=null;if(g["min-fraction-digits"]&&(T=c.parse(g["min-fraction-digits"],1,_t),!T))return null;let I=null;return g["max-fraction-digits"]&&(I=c.parse(g["max-fraction-digits"],1,_t),!I)?null:new _c(f,w,x,T,I)}evaluate(n){return new Intl.NumberFormat(this.locale?this.locale.evaluate(n):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(n):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(n):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(n):void 0}).format(this.number.evaluate(n))}eachChild(n){n(this.number),this.locale&&n(this.locale),this.currency&&n(this.currency),this.minFractionDigits&&n(this.minFractionDigits),this.maxFractionDigits&&n(this.maxFractionDigits)}outputDefined(){return!1}}class rl{constructor(n){this.type=_n,this.sections=n}static parse(n,c){if(n.length<2)return c.error("Expected at least one argument.");const f=n[1];if(!Array.isArray(f)&&typeof f=="object")return c.error("First argument must be an image or text section.");const g=[];let w=!1;for(let x=1;x<=n.length-1;++x){const T=n[x];if(w&&typeof T=="object"&&!Array.isArray(T)){w=!1;let I=null;if(T["font-scale"]&&(I=c.parse(T["font-scale"],1,_t),!I))return null;let z=null;if(T["text-font"]&&(z=c.parse(T["text-font"],1,ie(oi)),!z))return null;let N=null;if(T["text-color"]&&(N=c.parse(T["text-color"],1,Ki),!N))return null;const V=g[g.length-1];V.scale=I,V.font=z,V.textColor=N}else{const I=c.parse(n[x],1,ni);if(!I)return null;const z=I.type.kind;if(z!=="string"&&z!=="value"&&z!=="null"&&z!=="resolvedImage")return c.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");w=!0,g.push({content:I,scale:null,font:null,textColor:null})}}return new rl(g)}evaluate(n){return new Dr(this.sections.map(c=>{const f=c.content.evaluate(n);return Bn(f)===H?new dc("",f,null,null,null):new dc(ua(f),null,c.scale?c.scale.evaluate(n):null,c.font?c.font.evaluate(n).join(","):null,c.textColor?c.textColor.evaluate(n):null)}))}eachChild(n){for(const c of this.sections)n(c.content),c.scale&&n(c.scale),c.font&&n(c.font),c.textColor&&n(c.textColor)}outputDefined(){return!1}}class yc{constructor(n){this.type=H,this.input=n}static parse(n,c){if(n.length!==2)return c.error("Expected two arguments.");const f=c.parse(n[1],1,oi);return f?new yc(f):c.error("No image name provided.")}evaluate(n){const c=this.input.evaluate(n),f=Kr.fromString(c);return f&&n.availableImages&&(f.available=n.availableImages.indexOf(c)>-1),f}eachChild(n){n(this.input)}outputDefined(){return!1}}class vc{constructor(n){this.type=_t,this.input=n}static parse(n,c){if(n.length!==2)return c.error(`Expected 1 argument, but found ${n.length-1} instead.`);const f=c.parse(n[1],1);return f?f.type.kind!=="array"&&f.type.kind!=="string"&&f.type.kind!=="value"?c.error(`Expected argument of type string or array, but found ${de(f.type)} instead.`):new vc(f):null}evaluate(n){const c=this.input.evaluate(n);if(typeof c=="string"||Array.isArray(c))return c.length;throw new dn(`Expected value to be of type string or array, but found ${de(Bn(c))} instead.`)}eachChild(n){n(this.input)}outputDefined(){return!1}}const Ds={"==":Wd,"!=":Hd,">":Kd,"<":Xd,">=":Yd,"<=":Jd,array:Rr,at:fc,boolean:Rr,case:gc,coalesce:el,collator:Ps,format:rl,image:yc,in:pc,"index-of":il,interpolate:rr,"interpolate-hcl":rr,"interpolate-lab":rr,length:vc,let:tl,literal:Go,match:mc,number:Rr,"number-format":_c,object:Rr,slice:nl,step:_a,string:Rr,"to-boolean":_o,"to-color":_o,"to-number":_o,"to-string":_o,var:Ja,within:os};function ch(s,[n,c,f,g]){n=n.evaluate(s),c=c.evaluate(s),f=f.evaluate(s);const w=g?g.evaluate(s):1,x=As(n,c,f,w);if(x)throw new dn(x);return new ji(n/255,c/255,f/255,w,!1)}function uh(s,n){return s in n}function bc(s,n){const c=n[s];return c===void 0?null:c}function as(s){return{type:s}}function hh(s){return{result:"success",value:s}}function Rs(s){return{result:"error",value:s}}function Bs(s){return s["property-type"]==="data-driven"||s["property-type"]==="cross-faded-data-driven"}function dh(s){return!!s.expression&&s.expression.parameters.indexOf("zoom")>-1}function wc(s){return!!s.expression&&s.expression.interpolated}function Li(s){return s instanceof Number?"number":s instanceof String?"string":s instanceof Boolean?"boolean":Array.isArray(s)?"array":s===null?"null":typeof s}function ol(s){return typeof s=="object"&&s!==null&&!Array.isArray(s)}function Qd(s){return s}function fh(s,n){const c=n.type==="color",f=s.stops&&typeof s.stops[0][0]=="object",g=f||!(f||s.property!==void 0),w=s.type||(wc(n)?"exponential":"interval");if(c||n.type==="padding"){const N=c?ji.parse:xr.parse;(s=Mi({},s)).stops&&(s.stops=s.stops.map(V=>[V[0],N(V[1])])),s.default=N(s.default?s.default:n.default)}if(s.colorSpace&&(x=s.colorSpace)!=="rgb"&&x!=="hcl"&&x!=="lab")throw new Error(`Unknown color space: "${s.colorSpace}"`);var x;let T,I,z;if(w==="exponential")T=Si;else if(w==="interval")T=ef;else if(w==="categorical"){T=In,I=Object.create(null);for(const N of s.stops)I[N[0]]=N[1];z=typeof s.stops[0][0]}else{if(w!=="identity")throw new Error(`Unknown function type "${w}"`);T=xc}if(f){const N={},V=[];for(let te=0;te<s.stops.length;te++){const ue=s.stops[te],ge=ue[0].zoom;N[ge]===void 0&&(N[ge]={zoom:ge,type:s.type,property:s.property,default:s.default,stops:[]},V.push(ge)),N[ge].stops.push([ue[0].value,ue[1]])}const X=[];for(const te of V)X.push([N[te].zoom,fh(N[te],n)]);const Y={name:"linear"};return{kind:"composite",interpolationType:Y,interpolationFactor:rr.interpolationFactor.bind(void 0,Y),zoomStops:X.map(te=>te[0]),evaluate:({zoom:te},ue)=>Si({stops:X,base:s.base},n,te).evaluate(te,ue)}}if(g){const N=w==="exponential"?{name:"exponential",base:s.base!==void 0?s.base:1}:null;return{kind:"camera",interpolationType:N,interpolationFactor:rr.interpolationFactor.bind(void 0,N),zoomStops:s.stops.map(V=>V[0]),evaluate:({zoom:V})=>T(s,n,V,I,z)}}return{kind:"source",evaluate(N,V){const X=V&&V.properties?V.properties[s.property]:void 0;return X===void 0?ya(s.default,n.default):T(s,n,X,I,z)}}}function ya(s,n,c){return s!==void 0?s:n!==void 0?n:c!==void 0?c:void 0}function In(s,n,c,f,g){return ya(typeof c===g?f[c]:void 0,s.default,n.default)}function ef(s,n,c){if(Li(c)!=="number")return ya(s.default,n.default);const f=s.stops.length;if(f===1||c<=s.stops[0][0])return s.stops[0][1];if(c>=s.stops[f-1][0])return s.stops[f-1][1];const g=ga(s.stops.map(w=>w[0]),c);return s.stops[g][1]}function Si(s,n,c){const f=s.base!==void 0?s.base:1;if(Li(c)!=="number")return ya(s.default,n.default);const g=s.stops.length;if(g===1||c<=s.stops[0][0])return s.stops[0][1];if(c>=s.stops[g-1][0])return s.stops[g-1][1];const w=ga(s.stops.map(N=>N[0]),c),x=function(N,V,X,Y){const te=Y-X,ue=N-X;return te===0?0:V===1?ue/te:(Math.pow(V,ue)-1)/(Math.pow(V,te)-1)}(c,f,s.stops[w][0],s.stops[w+1][0]),T=s.stops[w][1],I=s.stops[w+1][1],z=dr[n.type]||Qd;return typeof T.evaluate=="function"?{evaluate(...N){const V=T.evaluate.apply(void 0,N),X=I.evaluate.apply(void 0,N);if(V!==void 0&&X!==void 0)return z(V,X,x,s.colorSpace)}}:z(T,I,x,s.colorSpace)}function xc(s,n,c){switch(n.type){case"color":c=ji.parse(c);break;case"formatted":c=Dr.fromString(c.toString());break;case"resolvedImage":c=Kr.fromString(c.toString());break;case"padding":c=xr.parse(c);break;default:Li(c)===n.type||n.type==="enum"&&n.values[c]||(c=void 0)}return ya(c,s.default,n.default)}Br.register(Ds,{error:[{kind:"error"},[oi],(s,[n])=>{throw new dn(n.evaluate(s))}],typeof:[oi,[ni],(s,[n])=>de(Bn(n.evaluate(s)))],"to-rgba":[ie(_t,4),[Ki],(s,[n])=>{const[c,f,g,w]=n.evaluate(s).rgb;return[255*c,255*f,255*g,w]}],rgb:[Ki,[_t,_t,_t],ch],rgba:[Ki,[_t,_t,_t,_t],ch],has:{type:Qt,overloads:[[[oi],(s,[n])=>uh(n.evaluate(s),s.properties())],[[oi,br],(s,[n,c])=>uh(n.evaluate(s),c.evaluate(s))]]},get:{type:ni,overloads:[[[oi],(s,[n])=>bc(n.evaluate(s),s.properties())],[[oi,br],(s,[n,c])=>bc(n.evaluate(s),c.evaluate(s))]]},"feature-state":[ni,[oi],(s,[n])=>bc(n.evaluate(s),s.featureState||{})],properties:[br,[],s=>s.properties()],"geometry-type":[oi,[],s=>s.geometryType()],id:[ni,[],s=>s.id()],zoom:[_t,[],s=>s.globals.zoom],"heatmap-density":[_t,[],s=>s.globals.heatmapDensity||0],"line-progress":[_t,[],s=>s.globals.lineProgress||0],accumulated:[ni,[],s=>s.globals.accumulated===void 0?null:s.globals.accumulated],"+":[_t,as(_t),(s,n)=>{let c=0;for(const f of n)c+=f.evaluate(s);return c}],"*":[_t,as(_t),(s,n)=>{let c=1;for(const f of n)c*=f.evaluate(s);return c}],"-":{type:_t,overloads:[[[_t,_t],(s,[n,c])=>n.evaluate(s)-c.evaluate(s)],[[_t],(s,[n])=>-n.evaluate(s)]]},"/":[_t,[_t,_t],(s,[n,c])=>n.evaluate(s)/c.evaluate(s)],"%":[_t,[_t,_t],(s,[n,c])=>n.evaluate(s)%c.evaluate(s)],ln2:[_t,[],()=>Math.LN2],pi:[_t,[],()=>Math.PI],e:[_t,[],()=>Math.E],"^":[_t,[_t,_t],(s,[n,c])=>Math.pow(n.evaluate(s),c.evaluate(s))],sqrt:[_t,[_t],(s,[n])=>Math.sqrt(n.evaluate(s))],log10:[_t,[_t],(s,[n])=>Math.log(n.evaluate(s))/Math.LN10],ln:[_t,[_t],(s,[n])=>Math.log(n.evaluate(s))],log2:[_t,[_t],(s,[n])=>Math.log(n.evaluate(s))/Math.LN2],sin:[_t,[_t],(s,[n])=>Math.sin(n.evaluate(s))],cos:[_t,[_t],(s,[n])=>Math.cos(n.evaluate(s))],tan:[_t,[_t],(s,[n])=>Math.tan(n.evaluate(s))],asin:[_t,[_t],(s,[n])=>Math.asin(n.evaluate(s))],acos:[_t,[_t],(s,[n])=>Math.acos(n.evaluate(s))],atan:[_t,[_t],(s,[n])=>Math.atan(n.evaluate(s))],min:[_t,as(_t),(s,n)=>Math.min(...n.map(c=>c.evaluate(s)))],max:[_t,as(_t),(s,n)=>Math.max(...n.map(c=>c.evaluate(s)))],abs:[_t,[_t],(s,[n])=>Math.abs(n.evaluate(s))],round:[_t,[_t],(s,[n])=>{const c=n.evaluate(s);return c<0?-Math.round(-c):Math.round(c)}],floor:[_t,[_t],(s,[n])=>Math.floor(n.evaluate(s))],ceil:[_t,[_t],(s,[n])=>Math.ceil(n.evaluate(s))],"filter-==":[Qt,[oi,ni],(s,[n,c])=>s.properties()[n.value]===c.value],"filter-id-==":[Qt,[ni],(s,[n])=>s.id()===n.value],"filter-type-==":[Qt,[oi],(s,[n])=>s.geometryType()===n.value],"filter-<":[Qt,[oi,ni],(s,[n,c])=>{const f=s.properties()[n.value],g=c.value;return typeof f==typeof g&&f<g}],"filter-id-<":[Qt,[ni],(s,[n])=>{const c=s.id(),f=n.value;return typeof c==typeof f&&c<f}],"filter->":[Qt,[oi,ni],(s,[n,c])=>{const f=s.properties()[n.value],g=c.value;return typeof f==typeof g&&f>g}],"filter-id->":[Qt,[ni],(s,[n])=>{const c=s.id(),f=n.value;return typeof c==typeof f&&c>f}],"filter-<=":[Qt,[oi,ni],(s,[n,c])=>{const f=s.properties()[n.value],g=c.value;return typeof f==typeof g&&f<=g}],"filter-id-<=":[Qt,[ni],(s,[n])=>{const c=s.id(),f=n.value;return typeof c==typeof f&&c<=f}],"filter->=":[Qt,[oi,ni],(s,[n,c])=>{const f=s.properties()[n.value],g=c.value;return typeof f==typeof g&&f>=g}],"filter-id->=":[Qt,[ni],(s,[n])=>{const c=s.id(),f=n.value;return typeof c==typeof f&&c>=f}],"filter-has":[Qt,[ni],(s,[n])=>n.value in s.properties()],"filter-has-id":[Qt,[],s=>s.id()!==null&&s.id()!==void 0],"filter-type-in":[Qt,[ie(oi)],(s,[n])=>n.value.indexOf(s.geometryType())>=0],"filter-id-in":[Qt,[ie(ni)],(s,[n])=>n.value.indexOf(s.id())>=0],"filter-in-small":[Qt,[oi,ie(ni)],(s,[n,c])=>c.value.indexOf(s.properties()[n.value])>=0],"filter-in-large":[Qt,[oi,ie(ni)],(s,[n,c])=>function(f,g,w,x){for(;w<=x;){const T=w+x>>1;if(g[T]===f)return!0;g[T]>f?x=T-1:w=T+1}return!1}(s.properties()[n.value],c.value,0,c.value.length-1)],all:{type:Qt,overloads:[[[Qt,Qt],(s,[n,c])=>n.evaluate(s)&&c.evaluate(s)],[as(Qt),(s,n)=>{for(const c of n)if(!c.evaluate(s))return!1;return!0}]]},any:{type:Qt,overloads:[[[Qt,Qt],(s,[n,c])=>n.evaluate(s)||c.evaluate(s)],[as(Qt),(s,n)=>{for(const c of n)if(c.evaluate(s))return!0;return!1}]]},"!":[Qt,[Qt],(s,[n])=>!n.evaluate(s)],"is-supported-script":[Qt,[oi],(s,[n])=>{const c=s.globals&&s.globals.isSupportedScript;return!c||c(n.evaluate(s))}],upcase:[oi,[oi],(s,[n])=>n.evaluate(s).toUpperCase()],downcase:[oi,[oi],(s,[n])=>n.evaluate(s).toLowerCase()],concat:[oi,as(ni),(s,n)=>n.map(c=>ua(c.evaluate(s))).join("")],"resolved-locale":[oi,[no],(s,[n])=>n.evaluate(s).resolvedLocale()]});class en{constructor(n,c){var f;this.expression=n,this._warningHistory={},this._evaluator=new Ui,this._defaultValue=c?(f=c).type==="color"&&ol(f.default)?new ji(0,0,0,0):f.type==="color"?ji.parse(f.default)||null:f.type==="padding"?xr.parse(f.default)||null:f.type==="variableAnchorOffsetCollection"?Xr.parse(f.default)||null:f.default===void 0?null:f.default:null,this._enumValues=c&&c.type==="enum"?c.values:null}evaluateWithoutErrorHandling(n,c,f,g,w,x){return this._evaluator.globals=n,this._evaluator.feature=c,this._evaluator.featureState=f,this._evaluator.canonical=g,this._evaluator.availableImages=w||null,this._evaluator.formattedSection=x,this.expression.evaluate(this._evaluator)}evaluate(n,c,f,g,w,x){this._evaluator.globals=n,this._evaluator.feature=c||null,this._evaluator.featureState=f||null,this._evaluator.canonical=g,this._evaluator.availableImages=w||null,this._evaluator.formattedSection=x||null;try{const T=this.expression.evaluate(this._evaluator);if(T==null||typeof T=="number"&&T!=T)return this._defaultValue;if(this._enumValues&&!(T in this._enumValues))throw new dn(`Expected value to be one of ${Object.keys(this._enumValues).map(I=>JSON.stringify(I)).join(", ")}, but found ${JSON.stringify(T)} instead.`);return T}catch(T){return this._warningHistory[T.message]||(this._warningHistory[T.message]=!0,typeof console<"u"&&console.warn(T.message)),this._defaultValue}}}function Ji(s){return Array.isArray(s)&&s.length>0&&typeof s[0]=="string"&&s[0]in Ds}function ls(s,n){const c=new Ga(Ds,fa,[],n?function(g){const w={color:Ki,string:oi,number:_t,enum:oi,boolean:Qt,formatted:_n,padding:me,resolvedImage:H,variableAnchorOffsetCollection:K};return g.type==="array"?ie(w[g.value]||ni,g.length):w[g.type]}(n):void 0),f=c.parse(s,void 0,void 0,void 0,n&&n.type==="string"?{typeAnnotation:"coerce"}:void 0);return f?hh(new en(f,n)):Rs(c.errors)}class sl{constructor(n,c){this.kind=n,this._styleExpression=c,this.isStateDependent=n!=="constant"&&!pa(c.expression)}evaluateWithoutErrorHandling(n,c,f,g,w,x){return this._styleExpression.evaluateWithoutErrorHandling(n,c,f,g,w,x)}evaluate(n,c,f,g,w,x){return this._styleExpression.evaluate(n,c,f,g,w,x)}}class kc{constructor(n,c,f,g){this.kind=n,this.zoomStops=f,this._styleExpression=c,this.isStateDependent=n!=="camera"&&!pa(c.expression),this.interpolationType=g}evaluateWithoutErrorHandling(n,c,f,g,w,x){return this._styleExpression.evaluateWithoutErrorHandling(n,c,f,g,w,x)}evaluate(n,c,f,g,w,x){return this._styleExpression.evaluate(n,c,f,g,w,x)}interpolationFactor(n,c,f){return this.interpolationType?rr.interpolationFactor(this.interpolationType,n,c,f):0}}function ph(s,n){const c=ls(s,n);if(c.result==="error")return c;const f=c.value.expression,g=Ya(f);if(!g&&!Bs(n))return Rs([new Yt("","data expressions not supported")]);const w=ma(f,["zoom"]);if(!w&&!dh(n))return Rs([new Yt("","zoom expressions not supported")]);const x=ll(f);return x||w?x instanceof Yt?Rs([x]):x instanceof rr&&!wc(n)?Rs([new Yt("",'"interpolate" expressions cannot be used with this property')]):hh(x?new kc(g?"camera":"composite",c.value,x.labels,x instanceof rr?x.interpolation:void 0):new sl(g?"constant":"source",c.value)):Rs([new Yt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class al{constructor(n,c){this._parameters=n,this._specification=c,Mi(this,fh(this._parameters,this._specification))}static deserialize(n){return new al(n._parameters,n._specification)}static serialize(n){return{_parameters:n._parameters,_specification:n._specification}}}function ll(s){let n=null;if(s instanceof tl)n=ll(s.result);else if(s instanceof el){for(const c of s.args)if(n=ll(c),n)break}else(s instanceof _a||s instanceof rr)&&s.input instanceof Br&&s.input.name==="zoom"&&(n=s);return n instanceof Yt||s.eachChild(c=>{const f=ll(c);f instanceof Yt?n=f:!n&&f?n=new Yt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):n&&f&&n!==f&&(n=new Yt("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),n}function cl(s){if(s===!0||s===!1)return!0;if(!Array.isArray(s)||s.length===0)return!1;switch(s[0]){case"has":return s.length>=2&&s[1]!=="$id"&&s[1]!=="$type";case"in":return s.length>=3&&(typeof s[1]!="string"||Array.isArray(s[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return s.length!==3||Array.isArray(s[1])||Array.isArray(s[2]);case"any":case"all":for(const n of s.slice(1))if(!cl(n)&&typeof n!="boolean")return!1;return!0;default:return!0}}const mh={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function ul(s){if(s==null)return{filter:()=>!0,needGeometry:!1};cl(s)||(s=dl(s));const n=ls(s,mh);if(n.result==="error")throw new Error(n.value.map(c=>`${c.key}: ${c.message}`).join(", "));return{filter:(c,f,g)=>n.value.evaluate(c,f,{},g),needGeometry:hl(s)}}function gh(s,n){return s<n?-1:s>n?1:0}function hl(s){if(!Array.isArray(s))return!1;if(s[0]==="within")return!0;for(let n=1;n<s.length;n++)if(hl(s[n]))return!0;return!1}function dl(s){if(!s)return!0;const n=s[0];return s.length<=1?n!=="any":n==="=="?Sc(s[1],s[2],"=="):n==="!="?fl(Sc(s[1],s[2],"==")):n==="<"||n===">"||n==="<="||n===">="?Sc(s[1],s[2],n):n==="any"?(c=s.slice(1),["any"].concat(c.map(dl))):n==="all"?["all"].concat(s.slice(1).map(dl)):n==="none"?["all"].concat(s.slice(1).map(dl).map(fl)):n==="in"?_h(s[1],s.slice(2)):n==="!in"?fl(_h(s[1],s.slice(2))):n==="has"?yh(s[1]):n==="!has"?fl(yh(s[1])):n!=="within"||s;var c}function Sc(s,n,c){switch(s){case"$type":return[`filter-type-${c}`,n];case"$id":return[`filter-id-${c}`,n];default:return[`filter-${c}`,s,n]}}function _h(s,n){if(n.length===0)return!1;switch(s){case"$type":return["filter-type-in",["literal",n]];case"$id":return["filter-id-in",["literal",n]];default:return n.length>200&&!n.some(c=>typeof c!=typeof n[0])?["filter-in-large",s,["literal",n.sort(gh)]]:["filter-in-small",s,["literal",n]]}}function yh(s){switch(s){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",s]}}function fl(s){return["!",s]}function Tc(s){const n=typeof s;if(n==="number"||n==="boolean"||n==="string"||s==null)return JSON.stringify(s);if(Array.isArray(s)){let g="[";for(const w of s)g+=`${Tc(w)},`;return`${g}]`}const c=Object.keys(s).sort();let f="{";for(let g=0;g<c.length;g++)f+=`${JSON.stringify(c[g])}:${Tc(s[c[g]])},`;return`${f}}`}function tf(s){let n="";for(const c of Ei)n+=`/${Tc(s[c])}`;return n}function vh(s){const n=s.value;return n?[new nt(s.key,n,"constants have been deprecated as of v8")]:[]}function vn(s){return s instanceof Number||s instanceof String||s instanceof Boolean?s.valueOf():s}function Ho(s){if(Array.isArray(s))return s.map(Ho);if(s instanceof Object&&!(s instanceof Number||s instanceof String||s instanceof Boolean)){const n={};for(const c in s)n[c]=Ho(s[c]);return n}return vn(s)}function fr(s){const n=s.key,c=s.value,f=s.valueSpec||{},g=s.objectElementValidators||{},w=s.style,x=s.styleSpec,T=s.validateSpec;let I=[];const z=Li(c);if(z!=="object")return[new nt(n,c,`object expected, ${z} found`)];for(const N in c){const V=N.split(".")[0],X=f[V]||f["*"];let Y;if(g[V])Y=g[V];else if(f[V])Y=T;else if(g["*"])Y=g["*"];else{if(!f["*"]){I.push(new nt(n,c[N],`unknown property "${N}"`));continue}Y=T}I=I.concat(Y({key:(n&&`${n}.`)+N,value:c[N],valueSpec:X,style:w,styleSpec:x,object:c,objectKey:N,validateSpec:T},c))}for(const N in f)g[N]||f[N].required&&f[N].default===void 0&&c[N]===void 0&&I.push(new nt(n,c,`missing required property "${N}"`));return I}function Cc(s){const n=s.value,c=s.valueSpec,f=s.style,g=s.styleSpec,w=s.key,x=s.arrayElementValidator||s.validateSpec;if(Li(n)!=="array")return[new nt(w,n,`array expected, ${Li(n)} found`)];if(c.length&&n.length!==c.length)return[new nt(w,n,`array length ${c.length} expected, length ${n.length} found`)];if(c["min-length"]&&n.length<c["min-length"])return[new nt(w,n,`array length at least ${c["min-length"]} expected, length ${n.length} found`)];let T={type:c.value,values:c.values};g.$version<7&&(T.function=c.function),Li(c.value)==="object"&&(T=c.value);let I=[];for(let z=0;z<n.length;z++)I=I.concat(x({array:n,arrayIndex:z,value:n[z],valueSpec:T,validateSpec:s.validateSpec,style:f,styleSpec:g,key:`${w}[${z}]`}));return I}function pl(s){const n=s.key,c=s.value,f=s.valueSpec;let g=Li(c);return g==="number"&&c!=c&&(g="NaN"),g!=="number"?[new nt(n,c,`number expected, ${g} found`)]:"minimum"in f&&c<f.minimum?[new nt(n,c,`${c} is less than the minimum value ${f.minimum}`)]:"maximum"in f&&c>f.maximum?[new nt(n,c,`${c} is greater than the maximum value ${f.maximum}`)]:[]}function bh(s){const n=s.valueSpec,c=vn(s.value.type);let f,g,w,x={};const T=c!=="categorical"&&s.value.property===void 0,I=!T,z=Li(s.value.stops)==="array"&&Li(s.value.stops[0])==="array"&&Li(s.value.stops[0][0])==="object",N=fr({key:s.key,value:s.value,valueSpec:s.styleSpec.function,validateSpec:s.validateSpec,style:s.style,styleSpec:s.styleSpec,objectElementValidators:{stops:function(Y){if(c==="identity")return[new nt(Y.key,Y.value,'identity function may not have a "stops" property')];let te=[];const ue=Y.value;return te=te.concat(Cc({key:Y.key,value:ue,valueSpec:Y.valueSpec,validateSpec:Y.validateSpec,style:Y.style,styleSpec:Y.styleSpec,arrayElementValidator:V})),Li(ue)==="array"&&ue.length===0&&te.push(new nt(Y.key,ue,"array must have at least one stop")),te},default:function(Y){return Y.validateSpec({key:Y.key,value:Y.value,valueSpec:n,validateSpec:Y.validateSpec,style:Y.style,styleSpec:Y.styleSpec})}}});return c==="identity"&&T&&N.push(new nt(s.key,s.value,'missing required property "property"')),c==="identity"||s.value.stops||N.push(new nt(s.key,s.value,'missing required property "stops"')),c==="exponential"&&s.valueSpec.expression&&!wc(s.valueSpec)&&N.push(new nt(s.key,s.value,"exponential functions not supported")),s.styleSpec.$version>=8&&(I&&!Bs(s.valueSpec)?N.push(new nt(s.key,s.value,"property functions not supported")):T&&!dh(s.valueSpec)&&N.push(new nt(s.key,s.value,"zoom functions not supported"))),c!=="categorical"&&!z||s.value.property!==void 0||N.push(new nt(s.key,s.value,'"property" property is required')),N;function V(Y){let te=[];const ue=Y.value,ge=Y.key;if(Li(ue)!=="array")return[new nt(ge,ue,`array expected, ${Li(ue)} found`)];if(ue.length!==2)return[new nt(ge,ue,`array length 2 expected, length ${ue.length} found`)];if(z){if(Li(ue[0])!=="object")return[new nt(ge,ue,`object expected, ${Li(ue[0])} found`)];if(ue[0].zoom===void 0)return[new nt(ge,ue,"object stop key must have zoom")];if(ue[0].value===void 0)return[new nt(ge,ue,"object stop key must have value")];if(w&&w>vn(ue[0].zoom))return[new nt(ge,ue[0].zoom,"stop zoom values must appear in ascending order")];vn(ue[0].zoom)!==w&&(w=vn(ue[0].zoom),g=void 0,x={}),te=te.concat(fr({key:`${ge}[0]`,value:ue[0],valueSpec:{zoom:{}},validateSpec:Y.validateSpec,style:Y.style,styleSpec:Y.styleSpec,objectElementValidators:{zoom:pl,value:X}}))}else te=te.concat(X({key:`${ge}[0]`,value:ue[0],valueSpec:{},validateSpec:Y.validateSpec,style:Y.style,styleSpec:Y.styleSpec},ue));return Ji(Ho(ue[1]))?te.concat([new nt(`${ge}[1]`,ue[1],"expressions are not allowed in function stops.")]):te.concat(Y.validateSpec({key:`${ge}[1]`,value:ue[1],valueSpec:n,validateSpec:Y.validateSpec,style:Y.style,styleSpec:Y.styleSpec}))}function X(Y,te){const ue=Li(Y.value),ge=vn(Y.value),xe=Y.value!==null?Y.value:te;if(f){if(ue!==f)return[new nt(Y.key,xe,`${ue} stop domain type must match previous stop domain type ${f}`)]}else f=ue;if(ue!=="number"&&ue!=="string"&&ue!=="boolean")return[new nt(Y.key,xe,"stop domain value must be a number, string, or boolean")];if(ue!=="number"&&c!=="categorical"){let Oe=`number expected, ${ue} found`;return Bs(n)&&c===void 0&&(Oe+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new nt(Y.key,xe,Oe)]}return c!=="categorical"||ue!=="number"||isFinite(ge)&&Math.floor(ge)===ge?c!=="categorical"&&ue==="number"&&g!==void 0&&ge<g?[new nt(Y.key,xe,"stop domain values must appear in ascending order")]:(g=ge,c==="categorical"&&ge in x?[new nt(Y.key,xe,"stop domain values must be unique")]:(x[ge]=!0,[])):[new nt(Y.key,xe,`integer expected, found ${ge}`)]}}function Xo(s){const n=(s.expressionContext==="property"?ph:ls)(Ho(s.value),s.valueSpec);if(n.result==="error")return n.value.map(f=>new nt(`${s.key}${f.key}`,s.value,f.message));const c=n.value.expression||n.value._styleExpression.expression;if(s.expressionContext==="property"&&s.propertyKey==="text-font"&&!c.outputDefined())return[new nt(s.key,s.value,`Invalid data expression for "${s.propertyKey}". Output values must be contained as literals within the expression.`)];if(s.expressionContext==="property"&&s.propertyType==="layout"&&!pa(c))return[new nt(s.key,s.value,'"feature-state" data expressions are not supported with layout properties.')];if(s.expressionContext==="filter"&&!pa(c))return[new nt(s.key,s.value,'"feature-state" data expressions are not supported with filters.')];if(s.expressionContext&&s.expressionContext.indexOf("cluster")===0){if(!ma(c,["zoom","feature-state"]))return[new nt(s.key,s.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(s.expressionContext==="cluster-initial"&&!Ya(c))return[new nt(s.key,s.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Ko(s){const n=s.key,c=s.value,f=s.valueSpec,g=[];return Array.isArray(f.values)?f.values.indexOf(vn(c))===-1&&g.push(new nt(n,c,`expected one of [${f.values.join(", ")}], ${JSON.stringify(c)} found`)):Object.keys(f.values).indexOf(vn(c))===-1&&g.push(new nt(n,c,`expected one of [${Object.keys(f.values).join(", ")}], ${JSON.stringify(c)} found`)),g}function Fs(s){return cl(Ho(s.value))?Xo(Mi({},s,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Ec(s)}function Ec(s){const n=s.value,c=s.key;if(Li(n)!=="array")return[new nt(c,n,`array expected, ${Li(n)} found`)];const f=s.styleSpec;let g,w=[];if(n.length<1)return[new nt(c,n,"filter array must have at least 1 element")];switch(w=w.concat(Ko({key:`${c}[0]`,value:n[0],valueSpec:f.filter_operator,style:s.style,styleSpec:s.styleSpec})),vn(n[0])){case"<":case"<=":case">":case">=":n.length>=2&&vn(n[1])==="$type"&&w.push(new nt(c,n,`"$type" cannot be use with operator "${n[0]}"`));case"==":case"!=":n.length!==3&&w.push(new nt(c,n,`filter array for operator "${n[0]}" must have 3 elements`));case"in":case"!in":n.length>=2&&(g=Li(n[1]),g!=="string"&&w.push(new nt(`${c}[1]`,n[1],`string expected, ${g} found`)));for(let x=2;x<n.length;x++)g=Li(n[x]),vn(n[1])==="$type"?w=w.concat(Ko({key:`${c}[${x}]`,value:n[x],valueSpec:f.geometry_type,style:s.style,styleSpec:s.styleSpec})):g!=="string"&&g!=="number"&&g!=="boolean"&&w.push(new nt(`${c}[${x}]`,n[x],`string, number, or boolean expected, ${g} found`));break;case"any":case"all":case"none":for(let x=1;x<n.length;x++)w=w.concat(Ec({key:`${c}[${x}]`,value:n[x],style:s.style,styleSpec:s.styleSpec}));break;case"has":case"!has":g=Li(n[1]),n.length!==2?w.push(new nt(c,n,`filter array for "${n[0]}" operator must have 2 elements`)):g!=="string"&&w.push(new nt(`${c}[1]`,n[1],`string expected, ${g} found`));break;case"within":g=Li(n[1]),n.length!==2?w.push(new nt(c,n,`filter array for "${n[0]}" operator must have 2 elements`)):g!=="object"&&w.push(new nt(`${c}[1]`,n[1],`object expected, ${g} found`))}return w}function ml(s,n){const c=s.key,f=s.validateSpec,g=s.style,w=s.styleSpec,x=s.value,T=s.objectKey,I=w[`${n}_${s.layerType}`];if(!I)return[];const z=T.match(/^(.*)-transition$/);if(n==="paint"&&z&&I[z[1]]&&I[z[1]].transition)return f({key:c,value:x,valueSpec:w.transition,style:g,styleSpec:w});const N=s.valueSpec||I[T];if(!N)return[new nt(c,x,`unknown property "${T}"`)];let V;if(Li(x)==="string"&&Bs(N)&&!N.tokens&&(V=/^{([^}]+)}$/.exec(x)))return[new nt(c,x,`"${T}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(V[1])} }\`.`)];const X=[];return s.layerType==="symbol"&&(T==="text-field"&&g&&!g.glyphs&&X.push(new nt(c,x,'use of "text-field" requires a style "glyphs" property')),T==="text-font"&&ol(Ho(x))&&vn(x.type)==="identity"&&X.push(new nt(c,x,'"text-font" does not support identity functions'))),X.concat(f({key:s.key,value:x,valueSpec:N,style:g,styleSpec:w,expressionContext:"property",propertyType:n,propertyKey:T}))}function Mc(s){return ml(s,"paint")}function Ic(s){return ml(s,"layout")}function va(s){let n=[];const c=s.value,f=s.key,g=s.style,w=s.styleSpec;c.type||c.ref||n.push(new nt(f,c,'either "type" or "ref" is required'));let x=vn(c.type);const T=vn(c.ref);if(c.id){const I=vn(c.id);for(let z=0;z<s.arrayIndex;z++){const N=g.layers[z];vn(N.id)===I&&n.push(new nt(f,c.id,`duplicate layer id "${c.id}", previously used at line ${N.id.__line__}`))}}if("ref"in c){let I;["type","source","source-layer","filter","layout"].forEach(z=>{z in c&&n.push(new nt(f,c[z],`"${z}" is prohibited for ref layers`))}),g.layers.forEach(z=>{vn(z.id)===T&&(I=z)}),I?I.ref?n.push(new nt(f,c.ref,"ref cannot reference another ref layer")):x=vn(I.type):n.push(new nt(f,c.ref,`ref layer "${T}" not found`))}else if(x!=="background")if(c.source){const I=g.sources&&g.sources[c.source],z=I&&vn(I.type);I?z==="vector"&&x==="raster"?n.push(new nt(f,c.source,`layer "${c.id}" requires a raster source`)):z!=="raster-dem"&&x==="hillshade"?n.push(new nt(f,c.source,`layer "${c.id}" requires a raster-dem source`)):z==="raster"&&x!=="raster"?n.push(new nt(f,c.source,`layer "${c.id}" requires a vector source`)):z!=="vector"||c["source-layer"]?z==="raster-dem"&&x!=="hillshade"?n.push(new nt(f,c.source,"raster-dem source can only be used with layer type 'hillshade'.")):x!=="line"||!c.paint||!c.paint["line-gradient"]||z==="geojson"&&I.lineMetrics||n.push(new nt(f,c,`layer "${c.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):n.push(new nt(f,c,`layer "${c.id}" must specify a "source-layer"`)):n.push(new nt(f,c.source,`source "${c.source}" not found`))}else n.push(new nt(f,c,'missing required property "source"'));return n=n.concat(fr({key:f,value:c,valueSpec:w.layer,style:s.style,styleSpec:s.styleSpec,validateSpec:s.validateSpec,objectElementValidators:{"*":()=>[],type:()=>s.validateSpec({key:`${f}.type`,value:c.type,valueSpec:w.layer.type,style:s.style,styleSpec:s.styleSpec,validateSpec:s.validateSpec,object:c,objectKey:"type"}),filter:Fs,layout:I=>fr({layer:c,key:I.key,value:I.value,style:I.style,styleSpec:I.styleSpec,validateSpec:I.validateSpec,objectElementValidators:{"*":z=>Ic(Mi({layerType:x},z))}}),paint:I=>fr({layer:c,key:I.key,value:I.value,style:I.style,styleSpec:I.styleSpec,validateSpec:I.validateSpec,objectElementValidators:{"*":z=>Mc(Mi({layerType:x},z))}})}})),n}function cs(s){const n=s.value,c=s.key,f=Li(n);return f!=="string"?[new nt(c,n,`string expected, ${f} found`)]:[]}const wh={promoteId:function({key:s,value:n}){if(Li(n)==="string")return cs({key:s,value:n});{const c=[];for(const f in n)c.push(...cs({key:`${s}.${f}`,value:n[f]}));return c}}};function xh(s){const n=s.value,c=s.key,f=s.styleSpec,g=s.style,w=s.validateSpec;if(!n.type)return[new nt(c,n,'"type" is required')];const x=vn(n.type);let T;switch(x){case"vector":case"raster":return T=fr({key:c,value:n,valueSpec:f[`source_${x.replace("-","_")}`],style:s.style,styleSpec:f,objectElementValidators:wh,validateSpec:w}),T;case"raster-dem":return T=function(I){var z;const N=(z=I.sourceName)!==null&&z!==void 0?z:"",V=I.value,X=I.styleSpec,Y=X.source_raster_dem,te=I.style;let ue=[];const ge=Li(V);if(V===void 0)return ue;if(ge!=="object")return ue.push(new nt("source_raster_dem",V,`object expected, ${ge} found`)),ue;const xe=vn(V.encoding)==="custom",Oe=["redFactor","greenFactor","blueFactor","baseShift"],Te=I.value.encoding?`"${I.value.encoding}"`:"Default";for(const De in V)!xe&&Oe.includes(De)?ue.push(new nt(De,V[De],`In "${N}": "${De}" is only valid when "encoding" is set to "custom". ${Te} encoding found`)):Y[De]?ue=ue.concat(I.validateSpec({key:De,value:V[De],valueSpec:Y[De],validateSpec:I.validateSpec,style:te,styleSpec:X})):ue.push(new nt(De,V[De],`unknown property "${De}"`));return ue}({sourceName:c,value:n,style:s.style,styleSpec:f,validateSpec:w}),T;case"geojson":if(T=fr({key:c,value:n,valueSpec:f.source_geojson,style:g,styleSpec:f,validateSpec:w,objectElementValidators:wh}),n.cluster)for(const I in n.clusterProperties){const[z,N]=n.clusterProperties[I],V=typeof z=="string"?[z,["accumulated"],["get",I]]:z;T.push(...Xo({key:`${c}.${I}.map`,value:N,validateSpec:w,expressionContext:"cluster-map"})),T.push(...Xo({key:`${c}.${I}.reduce`,value:V,validateSpec:w,expressionContext:"cluster-reduce"}))}return T;case"video":return fr({key:c,value:n,valueSpec:f.source_video,style:g,validateSpec:w,styleSpec:f});case"image":return fr({key:c,value:n,valueSpec:f.source_image,style:g,validateSpec:w,styleSpec:f});case"canvas":return[new nt(c,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Ko({key:`${c}.type`,value:n.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:g,validateSpec:w,styleSpec:f})}}function kh(s){const n=s.value,c=s.styleSpec,f=c.light,g=s.style;let w=[];const x=Li(n);if(n===void 0)return w;if(x!=="object")return w=w.concat([new nt("light",n,`object expected, ${x} found`)]),w;for(const T in n){const I=T.match(/^(.*)-transition$/);w=w.concat(I&&f[I[1]]&&f[I[1]].transition?s.validateSpec({key:T,value:n[T],valueSpec:c.transition,validateSpec:s.validateSpec,style:g,styleSpec:c}):f[T]?s.validateSpec({key:T,value:n[T],valueSpec:f[T],validateSpec:s.validateSpec,style:g,styleSpec:c}):[new nt(T,n[T],`unknown property "${T}"`)])}return w}function Sh(s){const n=s.value,c=s.styleSpec,f=c.sky,g=s.style,w=Li(n);if(n===void 0)return[];if(w!=="object")return[new nt("sky",n,`object expected, ${w} found`)];let x=[];for(const T in n)x=x.concat(f[T]?yo({key:T,value:n[T],valueSpec:f[T],style:g,styleSpec:c}):[new nt(T,n[T],`unknown property "${T}"`)]);return x}function ba(s){const n=s.value,c=s.styleSpec,f=c.terrain,g=s.style;let w=[];const x=Li(n);if(n===void 0)return w;if(x!=="object")return w=w.concat([new nt("terrain",n,`object expected, ${x} found`)]),w;for(const T in n)w=w.concat(f[T]?s.validateSpec({key:T,value:n[T],valueSpec:f[T],validateSpec:s.validateSpec,style:g,styleSpec:c}):[new nt(T,n[T],`unknown property "${T}"`)]);return w}function wa(s){let n=[];const c=s.value,f=s.key;if(Array.isArray(c)){const g=[],w=[];for(const x in c)c[x].id&&g.includes(c[x].id)&&n.push(new nt(f,c,`all the sprites' ids must be unique, but ${c[x].id} is duplicated`)),g.push(c[x].id),c[x].url&&w.includes(c[x].url)&&n.push(new nt(f,c,`all the sprites' URLs must be unique, but ${c[x].url} is duplicated`)),w.push(c[x].url),n=n.concat(fr({key:`${f}[${x}]`,value:c[x],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:s.validateSpec}));return n}return cs({key:f,value:c})}const kr={"*":()=>[],array:Cc,boolean:function(s){const n=s.value,c=s.key,f=Li(n);return f!=="boolean"?[new nt(c,n,`boolean expected, ${f} found`)]:[]},number:pl,color:function(s){const n=s.key,c=s.value,f=Li(c);return f!=="string"?[new nt(n,c,`color expected, ${f} found`)]:ji.parse(String(c))?[]:[new nt(n,c,`color expected, "${c}" found`)]},constants:vh,enum:Ko,filter:Fs,function:bh,layer:va,object:fr,source:xh,light:kh,sky:Sh,terrain:ba,string:cs,formatted:function(s){return cs(s).length===0?[]:Xo(s)},resolvedImage:function(s){return cs(s).length===0?[]:Xo(s)},padding:function(s){const n=s.key,c=s.value;if(Li(c)==="array"){if(c.length<1||c.length>4)return[new nt(n,c,`padding requires 1 to 4 values; ${c.length} values found`)];const f={type:"number"};let g=[];for(let w=0;w<c.length;w++)g=g.concat(s.validateSpec({key:`${n}[${w}]`,value:c[w],validateSpec:s.validateSpec,valueSpec:f}));return g}return pl({key:n,value:c,valueSpec:{}})},variableAnchorOffsetCollection:function(s){const n=s.key,c=s.value,f=Li(c),g=s.styleSpec;if(f!=="array"||c.length<1||c.length%2!=0)return[new nt(n,c,"variableAnchorOffsetCollection requires a non-empty array of even length")];let w=[];for(let x=0;x<c.length;x+=2)w=w.concat(Ko({key:`${n}[${x}]`,value:c[x],valueSpec:g.layout_symbol["text-anchor"]})),w=w.concat(Cc({key:`${n}[${x+1}]`,value:c[x+1],valueSpec:{length:2,value:"number"},validateSpec:s.validateSpec,style:s.style,styleSpec:g}));return w},sprite:wa};function yo(s){const n=s.value,c=s.valueSpec,f=s.styleSpec;return s.validateSpec=yo,c.expression&&ol(vn(n))?bh(s):c.expression&&Ji(Ho(n))?Xo(s):c.type&&kr[c.type]?kr[c.type](s):fr(Mi({},s,{valueSpec:c.type?f[c.type]:c}))}function Lc(s){const n=s.value,c=s.key,f=cs(s);return f.length||(n.indexOf("{fontstack}")===-1&&f.push(new nt(c,n,'"glyphs" url must include a "{fontstack}" token')),n.indexOf("{range}")===-1&&f.push(new nt(c,n,'"glyphs" url must include a "{range}" token'))),f}function ro(s,n=we){let c=[];return c=c.concat(yo({key:"",value:s,valueSpec:n.$root,styleSpec:n,style:s,validateSpec:yo,objectElementValidators:{glyphs:Lc,"*":()=>[]}})),s.constants&&(c=c.concat(vh({key:"constants",value:s.constants,style:s,styleSpec:n,validateSpec:yo}))),Os(c)}function vo(s){return function(n){return s({...n,validateSpec:yo})}}function Os(s){return[].concat(s).sort((n,c)=>n.line-c.line)}function oo(s){return function(...n){return Os(s.apply(this,n))}}ro.source=oo(vo(xh)),ro.sprite=oo(vo(wa)),ro.glyphs=oo(vo(Lc)),ro.light=oo(vo(kh)),ro.sky=oo(vo(Sh)),ro.terrain=oo(vo(ba)),ro.layer=oo(vo(va)),ro.filter=oo(vo(Fs)),ro.paintProperty=oo(vo(Mc)),ro.layoutProperty=oo(vo(Ic));const us=ro,nf=us.light,Ac=us.paintProperty,rf=us.layoutProperty;function Ns(s,n){let c=!1;if(n&&n.length)for(const f of n)s.fire(new ht(new Error(f.message))),c=!0;return c}class xa{constructor(n,c,f){const g=this.cells=[];if(n instanceof ArrayBuffer){this.arrayBuffer=n;const x=new Int32Array(this.arrayBuffer);n=x[0],this.d=(c=x[1])+2*(f=x[2]);for(let I=0;I<this.d*this.d;I++){const z=x[3+I],N=x[3+I+1];g.push(z===N?null:x.subarray(z,N))}const T=x[3+g.length+1];this.keys=x.subarray(x[3+g.length],T),this.bboxes=x.subarray(T),this.insert=this._insertReadonly}else{this.d=c+2*f;for(let x=0;x<this.d*this.d;x++)g.push([]);this.keys=[],this.bboxes=[]}this.n=c,this.extent=n,this.padding=f,this.scale=c/n,this.uid=0;const w=f/c*n;this.min=-w,this.max=n+w}insert(n,c,f,g,w){this._forEachCell(c,f,g,w,this._insertCell,this.uid++,void 0,void 0),this.keys.push(n),this.bboxes.push(c),this.bboxes.push(f),this.bboxes.push(g),this.bboxes.push(w)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(n,c,f,g,w,x){this.cells[w].push(x)}query(n,c,f,g,w){const x=this.min,T=this.max;if(n<=x&&c<=x&&T<=f&&T<=g&&!w)return Array.prototype.slice.call(this.keys);{const I=[];return this._forEachCell(n,c,f,g,this._queryCell,I,{},w),I}}_queryCell(n,c,f,g,w,x,T,I){const z=this.cells[w];if(z!==null){const N=this.keys,V=this.bboxes;for(let X=0;X<z.length;X++){const Y=z[X];if(T[Y]===void 0){const te=4*Y;(I?I(V[te+0],V[te+1],V[te+2],V[te+3]):n<=V[te+2]&&c<=V[te+3]&&f>=V[te+0]&&g>=V[te+1])?(T[Y]=!0,x.push(N[Y])):T[Y]=!1}}}}_forEachCell(n,c,f,g,w,x,T,I){const z=this._convertToCellCoord(n),N=this._convertToCellCoord(c),V=this._convertToCellCoord(f),X=this._convertToCellCoord(g);for(let Y=z;Y<=V;Y++)for(let te=N;te<=X;te++){const ue=this.d*te+Y;if((!I||I(this._convertFromCellCoord(Y),this._convertFromCellCoord(te),this._convertFromCellCoord(Y+1),this._convertFromCellCoord(te+1)))&&w.call(this,n,c,f,g,ue,x,T,I))return}}_convertFromCellCoord(n){return(n-this.padding)/this.scale}_convertToCellCoord(n){return Math.max(0,Math.min(this.d-1,Math.floor(n*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const n=this.cells,c=3+this.cells.length+1+1;let f=0;for(let x=0;x<this.cells.length;x++)f+=this.cells[x].length;const g=new Int32Array(c+f+this.keys.length+this.bboxes.length);g[0]=this.extent,g[1]=this.n,g[2]=this.padding;let w=c;for(let x=0;x<n.length;x++){const T=n[x];g[3+x]=w,g.set(T,w),w+=T.length}return g[3+n.length]=w,g.set(this.keys,w),w+=this.keys.length,g[3+n.length+1]=w,g.set(this.bboxes,w),w+=this.bboxes.length,g.buffer}static serialize(n,c){const f=n.toArrayBuffer();return c&&c.push(f),{buffer:f}}static deserialize(n){return new xa(n.buffer)}}const bo={};function Lt(s,n,c={}){if(bo[s])throw new Error(`${s} is already registered.`);Object.defineProperty(n,"_classRegistryKey",{value:s,writeable:!1}),bo[s]={klass:n,omit:c.omit||[],shallow:c.shallow||[]}}Lt("Object",Object),Lt("TransferableGridIndex",xa),Lt("Color",ji),Lt("Error",Error),Lt("AJAXError",gi),Lt("ResolvedImage",Kr),Lt("StylePropertyFunction",al),Lt("StyleExpression",en,{omit:["_evaluator"]}),Lt("ZoomDependentExpression",kc),Lt("ZoomConstantExpression",sl),Lt("CompoundExpression",Br,{omit:["_evaluate"]});for(const s in Ds)Ds[s]._classRegistryKey||Lt(`Expression_${s}`,Ds[s]);function gl(s){return s&&typeof ArrayBuffer<"u"&&(s instanceof ArrayBuffer||s.constructor&&s.constructor.name==="ArrayBuffer")}function js(s,n){if(s==null||typeof s=="boolean"||typeof s=="number"||typeof s=="string"||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp||s instanceof Blob||s instanceof Error)return s;if(gl(s)||at(s))return n&&n.push(s),s;if(ArrayBuffer.isView(s)){const c=s;return n&&n.push(c.buffer),c}if(s instanceof ImageData)return n&&n.push(s.data.buffer),s;if(Array.isArray(s)){const c=[];for(const f of s)c.push(js(f,n));return c}if(typeof s=="object"){const c=s.constructor,f=c._classRegistryKey;if(!f)throw new Error(`can't serialize object of unregistered class ${c.name}`);if(!bo[f])throw new Error(`${f} is not registered.`);const g=c.serialize?c.serialize(s,n):{};if(c.serialize){if(n&&g===n[n.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const w in s){if(!s.hasOwnProperty(w)||bo[f].omit.indexOf(w)>=0)continue;const x=s[w];g[w]=bo[f].shallow.indexOf(w)>=0?x:js(x,n)}s instanceof Error&&(g.message=s.message)}if(g.$name)throw new Error("$name property is reserved for worker serialization logic.");return f!=="Object"&&(g.$name=f),g}throw new Error("can't serialize object of type "+typeof s)}function Us(s){if(s==null||typeof s=="boolean"||typeof s=="number"||typeof s=="string"||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp||s instanceof Blob||s instanceof Error||gl(s)||at(s)||ArrayBuffer.isView(s)||s instanceof ImageData)return s;if(Array.isArray(s))return s.map(Us);if(typeof s=="object"){const n=s.$name||"Object";if(!bo[n])throw new Error(`can't deserialize unregistered class ${n}`);const{klass:c}=bo[n];if(!c)throw new Error(`can't deserialize unregistered class ${n}`);if(c.deserialize)return c.deserialize(s);const f=Object.create(c.prototype);for(const g of Object.keys(s)){if(g==="$name")continue;const w=s[g];f[g]=bo[n].shallow.indexOf(g)>=0?w:Us(w)}return f}throw new Error("can't deserialize object of type "+typeof s)}class Th{constructor(){this.first=!0}update(n,c){const f=Math.floor(n);return this.first?(this.first=!1,this.lastIntegerZoom=f,this.lastIntegerZoomTime=0,this.lastZoom=n,this.lastFloorZoom=f,!0):(this.lastFloorZoom>f?(this.lastIntegerZoom=f+1,this.lastIntegerZoomTime=c):this.lastFloorZoom<f&&(this.lastIntegerZoom=f,this.lastIntegerZoomTime=c),n!==this.lastZoom&&(this.lastZoom=n,this.lastFloorZoom=f,!0))}}const Ct={"Latin-1 Supplement":s=>s>=128&&s<=255,Arabic:s=>s>=1536&&s<=1791,"Arabic Supplement":s=>s>=1872&&s<=1919,"Arabic Extended-A":s=>s>=2208&&s<=2303,"Hangul Jamo":s=>s>=4352&&s<=4607,"Unified Canadian Aboriginal Syllabics":s=>s>=5120&&s<=5759,Khmer:s=>s>=6016&&s<=6143,"Unified Canadian Aboriginal Syllabics Extended":s=>s>=6320&&s<=6399,"General Punctuation":s=>s>=8192&&s<=8303,"Letterlike Symbols":s=>s>=8448&&s<=8527,"Number Forms":s=>s>=8528&&s<=8591,"Miscellaneous Technical":s=>s>=8960&&s<=9215,"Control Pictures":s=>s>=9216&&s<=9279,"Optical Character Recognition":s=>s>=9280&&s<=9311,"Enclosed Alphanumerics":s=>s>=9312&&s<=9471,"Geometric Shapes":s=>s>=9632&&s<=9727,"Miscellaneous Symbols":s=>s>=9728&&s<=9983,"Miscellaneous Symbols and Arrows":s=>s>=11008&&s<=11263,"CJK Radicals Supplement":s=>s>=11904&&s<=12031,"Kangxi Radicals":s=>s>=12032&&s<=12255,"Ideographic Description Characters":s=>s>=12272&&s<=12287,"CJK Symbols and Punctuation":s=>s>=12288&&s<=12351,Hiragana:s=>s>=12352&&s<=12447,Katakana:s=>s>=12448&&s<=12543,Bopomofo:s=>s>=12544&&s<=12591,"Hangul Compatibility Jamo":s=>s>=12592&&s<=12687,Kanbun:s=>s>=12688&&s<=12703,"Bopomofo Extended":s=>s>=12704&&s<=12735,"CJK Strokes":s=>s>=12736&&s<=12783,"Katakana Phonetic Extensions":s=>s>=12784&&s<=12799,"Enclosed CJK Letters and Months":s=>s>=12800&&s<=13055,"CJK Compatibility":s=>s>=13056&&s<=13311,"CJK Unified Ideographs Extension A":s=>s>=13312&&s<=19903,"Yijing Hexagram Symbols":s=>s>=19904&&s<=19967,"CJK Unified Ideographs":s=>s>=19968&&s<=40959,"Yi Syllables":s=>s>=40960&&s<=42127,"Yi Radicals":s=>s>=42128&&s<=42191,"Hangul Jamo Extended-A":s=>s>=43360&&s<=43391,"Hangul Syllables":s=>s>=44032&&s<=55215,"Hangul Jamo Extended-B":s=>s>=55216&&s<=55295,"Private Use Area":s=>s>=57344&&s<=63743,"CJK Compatibility Ideographs":s=>s>=63744&&s<=64255,"Arabic Presentation Forms-A":s=>s>=64336&&s<=65023,"Vertical Forms":s=>s>=65040&&s<=65055,"CJK Compatibility Forms":s=>s>=65072&&s<=65103,"Small Form Variants":s=>s>=65104&&s<=65135,"Arabic Presentation Forms-B":s=>s>=65136&&s<=65279,"Halfwidth and Fullwidth Forms":s=>s>=65280&&s<=65519};function Vs(s){for(const n of s)if(_l(n.charCodeAt(0)))return!0;return!1}function Ch(s){for(const n of s)if(!Eh(n.charCodeAt(0)))return!1;return!0}function Eh(s){return!(Ct.Arabic(s)||Ct["Arabic Supplement"](s)||Ct["Arabic Extended-A"](s)||Ct["Arabic Presentation Forms-A"](s)||Ct["Arabic Presentation Forms-B"](s))}function _l(s){return!(s!==746&&s!==747&&(s<4352||!(Ct["Bopomofo Extended"](s)||Ct.Bopomofo(s)||Ct["CJK Compatibility Forms"](s)&&!(s>=65097&&s<=65103)||Ct["CJK Compatibility Ideographs"](s)||Ct["CJK Compatibility"](s)||Ct["CJK Radicals Supplement"](s)||Ct["CJK Strokes"](s)||!(!Ct["CJK Symbols and Punctuation"](s)||s>=12296&&s<=12305||s>=12308&&s<=12319||s===12336)||Ct["CJK Unified Ideographs Extension A"](s)||Ct["CJK Unified Ideographs"](s)||Ct["Enclosed CJK Letters and Months"](s)||Ct["Hangul Compatibility Jamo"](s)||Ct["Hangul Jamo Extended-A"](s)||Ct["Hangul Jamo Extended-B"](s)||Ct["Hangul Jamo"](s)||Ct["Hangul Syllables"](s)||Ct.Hiragana(s)||Ct["Ideographic Description Characters"](s)||Ct.Kanbun(s)||Ct["Kangxi Radicals"](s)||Ct["Katakana Phonetic Extensions"](s)||Ct.Katakana(s)&&s!==12540||!(!Ct["Halfwidth and Fullwidth Forms"](s)||s===65288||s===65289||s===65293||s>=65306&&s<=65310||s===65339||s===65341||s===65343||s>=65371&&s<=65503||s===65507||s>=65512&&s<=65519)||!(!Ct["Small Form Variants"](s)||s>=65112&&s<=65118||s>=65123&&s<=65126)||Ct["Unified Canadian Aboriginal Syllabics"](s)||Ct["Unified Canadian Aboriginal Syllabics Extended"](s)||Ct["Vertical Forms"](s)||Ct["Yijing Hexagram Symbols"](s)||Ct["Yi Syllables"](s)||Ct["Yi Radicals"](s))))}function Pc(s){return!(_l(s)||function(n){return!!(Ct["Latin-1 Supplement"](n)&&(n===167||n===169||n===174||n===177||n===188||n===189||n===190||n===215||n===247)||Ct["General Punctuation"](n)&&(n===8214||n===8224||n===8225||n===8240||n===8241||n===8251||n===8252||n===8258||n===8263||n===8264||n===8265||n===8273)||Ct["Letterlike Symbols"](n)||Ct["Number Forms"](n)||Ct["Miscellaneous Technical"](n)&&(n>=8960&&n<=8967||n>=8972&&n<=8991||n>=8996&&n<=9e3||n===9003||n>=9085&&n<=9114||n>=9150&&n<=9165||n===9167||n>=9169&&n<=9179||n>=9186&&n<=9215)||Ct["Control Pictures"](n)&&n!==9251||Ct["Optical Character Recognition"](n)||Ct["Enclosed Alphanumerics"](n)||Ct["Geometric Shapes"](n)||Ct["Miscellaneous Symbols"](n)&&!(n>=9754&&n<=9759)||Ct["Miscellaneous Symbols and Arrows"](n)&&(n>=11026&&n<=11055||n>=11088&&n<=11097||n>=11192&&n<=11243)||Ct["CJK Symbols and Punctuation"](n)||Ct.Katakana(n)||Ct["Private Use Area"](n)||Ct["CJK Compatibility Forms"](n)||Ct["Small Form Variants"](n)||Ct["Halfwidth and Fullwidth Forms"](n)||n===8734||n===8756||n===8757||n>=9984&&n<=10087||n>=10102&&n<=10131||n===65532||n===65533)}(s))}function yl(s){return s>=1424&&s<=2303||Ct["Arabic Presentation Forms-A"](s)||Ct["Arabic Presentation Forms-B"](s)}function Mh(s,n){return!(!n&&yl(s)||s>=2304&&s<=3583||s>=3840&&s<=4255||Ct.Khmer(s))}function of(s){for(const n of s)if(yl(n.charCodeAt(0)))return!0;return!1}const Jo=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(s){this.pluginStatus=s.pluginStatus,this.pluginURL=s.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(s){this.applyArabicShaping=s.applyArabicShaping,this.processBidirectionalText=s.processBidirectionalText,this.processStyledBidirectionalText=s.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class an{constructor(n,c){this.zoom=n,c?(this.now=c.now,this.fadeDuration=c.fadeDuration,this.zoomHistory=c.zoomHistory,this.transition=c.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Th,this.transition={})}isSupportedScript(n){return function(c,f){for(const g of c)if(!Mh(g.charCodeAt(0),f))return!1;return!0}(n,Jo.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const n=this.zoom,c=n-Math.floor(n),f=this.crossFadingFactor();return n>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:c+(1-c)*f}:{fromScale:.5,toScale:1,t:1-(1-f)*c}}}class ka{constructor(n,c){this.property=n,this.value=c,this.expression=function(f,g){if(ol(f))return new al(f,g);if(Ji(f)){const w=ph(f,g);if(w.result==="error")throw new Error(w.value.map(x=>`${x.key}: ${x.message}`).join(", "));return w.value}{let w=f;return g.type==="color"&&typeof f=="string"?w=ji.parse(f):g.type!=="padding"||typeof f!="number"&&!Array.isArray(f)?g.type==="variableAnchorOffsetCollection"&&Array.isArray(f)&&(w=Xr.parse(f)):w=xr.parse(f),{kind:"constant",evaluate:()=>w}}}(c===void 0?n.specification.default:c,n.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(n,c,f){return this.property.possiblyEvaluate(this,n,c,f)}}class vl{constructor(n){this.property=n,this.value=new ka(n,void 0)}transitioned(n,c){return new Ih(this.property,this.value,c,Z({},n.transition,this.transition),n.now)}untransitioned(){return new Ih(this.property,this.value,null,{},0)}}class zc{constructor(n){this._properties=n,this._values=Object.create(n.defaultTransitionablePropertyValues)}getValue(n){return re(this._values[n].value.value)}setValue(n,c){Object.prototype.hasOwnProperty.call(this._values,n)||(this._values[n]=new vl(this._values[n].property)),this._values[n].value=new ka(this._values[n].property,c===null?void 0:re(c))}getTransition(n){return re(this._values[n].transition)}setTransition(n,c){Object.prototype.hasOwnProperty.call(this._values,n)||(this._values[n]=new vl(this._values[n].property)),this._values[n].transition=re(c)||void 0}serialize(){const n={};for(const c of Object.keys(this._values)){const f=this.getValue(c);f!==void 0&&(n[c]=f);const g=this.getTransition(c);g!==void 0&&(n[`${c}-transition`]=g)}return n}transitioned(n,c){const f=new Lh(this._properties);for(const g of Object.keys(this._values))f._values[g]=this._values[g].transitioned(n,c._values[g]);return f}untransitioned(){const n=new Lh(this._properties);for(const c of Object.keys(this._values))n._values[c]=this._values[c].untransitioned();return n}}class Ih{constructor(n,c,f,g,w){this.property=n,this.value=c,this.begin=w+g.delay||0,this.end=this.begin+g.duration||0,n.specification.transition&&(g.delay||g.duration)&&(this.prior=f)}possiblyEvaluate(n,c,f){const g=n.now||0,w=this.value.possiblyEvaluate(n,c,f),x=this.prior;if(x){if(g>this.end)return this.prior=null,w;if(this.value.isDataDriven())return this.prior=null,w;if(g<this.begin)return x.possiblyEvaluate(n,c,f);{const T=(g-this.begin)/(this.end-this.begin);return this.property.interpolate(x.possiblyEvaluate(n,c,f),w,function(I){if(I<=0)return 0;if(I>=1)return 1;const z=I*I,N=z*I;return 4*(I<.5?N:3*(I-z)+N-.75)}(T))}}return w}}class Lh{constructor(n){this._properties=n,this._values=Object.create(n.defaultTransitioningPropertyValues)}possiblyEvaluate(n,c,f){const g=new Sa(this._properties);for(const w of Object.keys(this._values))g._values[w]=this._values[w].possiblyEvaluate(n,c,f);return g}hasTransition(){for(const n of Object.keys(this._values))if(this._values[n].prior)return!0;return!1}}class Ah{constructor(n){this._properties=n,this._values=Object.create(n.defaultPropertyValues)}hasValue(n){return this._values[n].value!==void 0}getValue(n){return re(this._values[n].value)}setValue(n,c){this._values[n]=new ka(this._values[n].property,c===null?void 0:re(c))}serialize(){const n={};for(const c of Object.keys(this._values)){const f=this.getValue(c);f!==void 0&&(n[c]=f)}return n}possiblyEvaluate(n,c,f){const g=new Sa(this._properties);for(const w of Object.keys(this._values))g._values[w]=this._values[w].possiblyEvaluate(n,c,f);return g}}class so{constructor(n,c,f){this.property=n,this.value=c,this.parameters=f}isConstant(){return this.value.kind==="constant"}constantOr(n){return this.value.kind==="constant"?this.value.value:n}evaluate(n,c,f,g){return this.property.evaluate(this.value,this.parameters,n,c,f,g)}}class Sa{constructor(n){this._properties=n,this._values=Object.create(n.defaultPossiblyEvaluatedValues)}get(n){return this._values[n]}}class $t{constructor(n){this.specification=n}possiblyEvaluate(n,c){if(n.isDataDriven())throw new Error("Value should not be data driven");return n.expression.evaluate(c)}interpolate(n,c,f){const g=dr[this.specification.type];return g?g(n,c,f):n}}class Gt{constructor(n,c){this.specification=n,this.overrides=c}possiblyEvaluate(n,c,f,g){return new so(this,n.expression.kind==="constant"||n.expression.kind==="camera"?{kind:"constant",value:n.expression.evaluate(c,null,{},f,g)}:n.expression,c)}interpolate(n,c,f){if(n.value.kind!=="constant"||c.value.kind!=="constant")return n;if(n.value.value===void 0||c.value.value===void 0)return new so(this,{kind:"constant",value:void 0},n.parameters);const g=dr[this.specification.type];if(g){const w=g(n.value.value,c.value.value,f);return new so(this,{kind:"constant",value:w},n.parameters)}return n}evaluate(n,c,f,g,w,x){return n.kind==="constant"?n.value:n.evaluate(c,f,g,w,x)}}class bl extends Gt{possiblyEvaluate(n,c,f,g){if(n.value===void 0)return new so(this,{kind:"constant",value:void 0},c);if(n.expression.kind==="constant"){const w=n.expression.evaluate(c,null,{},f,g),x=n.property.specification.type==="resolvedImage"&&typeof w!="string"?w.name:w,T=this._calculate(x,x,x,c);return new so(this,{kind:"constant",value:T},c)}if(n.expression.kind==="camera"){const w=this._calculate(n.expression.evaluate({zoom:c.zoom-1}),n.expression.evaluate({zoom:c.zoom}),n.expression.evaluate({zoom:c.zoom+1}),c);return new so(this,{kind:"constant",value:w},c)}return new so(this,n.expression,c)}evaluate(n,c,f,g,w,x){if(n.kind==="source"){const T=n.evaluate(c,f,g,w,x);return this._calculate(T,T,T,c)}return n.kind==="composite"?this._calculate(n.evaluate({zoom:Math.floor(c.zoom)-1},f,g),n.evaluate({zoom:Math.floor(c.zoom)},f,g),n.evaluate({zoom:Math.floor(c.zoom)+1},f,g),c):n.value}_calculate(n,c,f,g){return g.zoom>g.zoomHistory.lastIntegerZoom?{from:n,to:c}:{from:f,to:c}}interpolate(n){return n}}class Ta{constructor(n){this.specification=n}possiblyEvaluate(n,c,f,g){if(n.value!==void 0){if(n.expression.kind==="constant"){const w=n.expression.evaluate(c,null,{},f,g);return this._calculate(w,w,w,c)}return this._calculate(n.expression.evaluate(new an(Math.floor(c.zoom-1),c)),n.expression.evaluate(new an(Math.floor(c.zoom),c)),n.expression.evaluate(new an(Math.floor(c.zoom+1),c)),c)}}_calculate(n,c,f,g){return g.zoom>g.zoomHistory.lastIntegerZoom?{from:n,to:c}:{from:f,to:c}}interpolate(n){return n}}class Dc{constructor(n){this.specification=n}possiblyEvaluate(n,c,f,g){return!!n.expression.evaluate(c,null,{},f,g)}interpolate(){return!1}}class Sr{constructor(n){this.properties=n,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const c in n){const f=n[c];f.specification.overridable&&this.overridableProperties.push(c);const g=this.defaultPropertyValues[c]=new ka(f,void 0),w=this.defaultTransitionablePropertyValues[c]=new vl(f);this.defaultTransitioningPropertyValues[c]=w.untransitioned(),this.defaultPossiblyEvaluatedValues[c]=g.possiblyEvaluate({})}}}Lt("DataDrivenProperty",Gt),Lt("DataConstantProperty",$t),Lt("CrossFadedDataDrivenProperty",bl),Lt("CrossFadedProperty",Ta),Lt("ColorRampProperty",Dc);const Rc="-transition";class ao extends vt{constructor(n,c){if(super(),this.id=n.id,this.type=n.type,this._featureFilter={filter:()=>!0,needGeometry:!1},n.type!=="custom"&&(this.metadata=n.metadata,this.minzoom=n.minzoom,this.maxzoom=n.maxzoom,n.type!=="background"&&(this.source=n.source,this.sourceLayer=n["source-layer"],this.filter=n.filter),c.layout&&(this._unevaluatedLayout=new Ah(c.layout)),c.paint)){this._transitionablePaint=new zc(c.paint);for(const f in n.paint)this.setPaintProperty(f,n.paint[f],{validate:!1});for(const f in n.layout)this.setLayoutProperty(f,n.layout[f],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Sa(c.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(n){return n==="visibility"?this.visibility:this._unevaluatedLayout.getValue(n)}setLayoutProperty(n,c,f={}){c!=null&&this._validate(rf,`layers.${this.id}.layout.${n}`,n,c,f)||(n!=="visibility"?this._unevaluatedLayout.setValue(n,c):this.visibility=c)}getPaintProperty(n){return n.endsWith(Rc)?this._transitionablePaint.getTransition(n.slice(0,-11)):this._transitionablePaint.getValue(n)}setPaintProperty(n,c,f={}){if(c!=null&&this._validate(Ac,`layers.${this.id}.paint.${n}`,n,c,f))return!1;if(n.endsWith(Rc))return this._transitionablePaint.setTransition(n.slice(0,-11),c||void 0),!1;{const g=this._transitionablePaint._values[n],w=g.property.specification["property-type"]==="cross-faded-data-driven",x=g.value.isDataDriven(),T=g.value;this._transitionablePaint.setValue(n,c),this._handleSpecialPaintPropertyUpdate(n);const I=this._transitionablePaint._values[n].value;return I.isDataDriven()||x||w||this._handleOverridablePaintPropertyUpdate(n,T,I)}}_handleSpecialPaintPropertyUpdate(n){}_handleOverridablePaintPropertyUpdate(n,c,f){return!1}isHidden(n){return!!(this.minzoom&&n<this.minzoom)||!!(this.maxzoom&&n>=this.maxzoom)||this.visibility==="none"}updateTransitions(n){this._transitioningPaint=this._transitionablePaint.transitioned(n,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(n,c){n.getCrossfadeParameters&&(this._crossfadeParameters=n.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(n,void 0,c)),this.paint=this._transitioningPaint.possiblyEvaluate(n,void 0,c)}serialize(){const n={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(n.layout=n.layout||{},n.layout.visibility=this.visibility),Ne(n,(c,f)=>!(c===void 0||f==="layout"&&!Object.keys(c).length||f==="paint"&&!Object.keys(c).length))}_validate(n,c,f,g,w={}){return(!w||w.validate!==!1)&&Ns(this,n.call(us,{key:c,layerType:this.type,objectKey:f,value:g,styleSpec:we,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const n in this.paint._values){const c=this.paint.get(n);if(c instanceof so&&Bs(c.property.specification)&&(c.value.kind==="source"||c.value.kind==="composite")&&c.value.isStateDependent)return!0}return!1}}const Ph={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Ca{constructor(n,c){this._structArray=n,this._pos1=c*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class bn{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(n,c){return n._trim(),c&&(n.isTransferred=!0,c.push(n.arrayBuffer)),{length:n.length,arrayBuffer:n.arrayBuffer}}static deserialize(n){const c=Object.create(this.prototype);return c.arrayBuffer=n.arrayBuffer,c.length=n.length,c.capacity=n.arrayBuffer.byteLength/c.bytesPerElement,c._refreshViews(),c}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(n){this.reserve(n),this.length=n}reserve(n){if(n>this.capacity){this.capacity=Math.max(n,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const c=this.uint8;this._refreshViews(),c&&this.uint8.set(c)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Ln(s,n=1){let c=0,f=0;return{members:s.map(g=>{const w=Ph[g.type].BYTES_PER_ELEMENT,x=c=zh(c,Math.max(n,w)),T=g.components||1;return f=Math.max(f,w),c+=w*T,{name:g.name,type:g.type,components:T,offset:x}}),size:zh(c,Math.max(f,n)),alignment:n}}function zh(s,n){return Math.ceil(s/n)*n}class Ea extends bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,c){const f=this.length;return this.resize(f+1),this.emplace(f,n,c)}emplace(n,c,f){const g=2*n;return this.int16[g+0]=c,this.int16[g+1]=f,n}}Ea.prototype.bytesPerElement=4,Lt("StructArrayLayout2i4",Ea);class zo extends bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,c,f){const g=this.length;return this.resize(g+1),this.emplace(g,n,c,f)}emplace(n,c,f,g){const w=3*n;return this.int16[w+0]=c,this.int16[w+1]=f,this.int16[w+2]=g,n}}zo.prototype.bytesPerElement=6,Lt("StructArrayLayout3i6",zo);class Bc extends bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,c,f,g){const w=this.length;return this.resize(w+1),this.emplace(w,n,c,f,g)}emplace(n,c,f,g,w){const x=4*n;return this.int16[x+0]=c,this.int16[x+1]=f,this.int16[x+2]=g,this.int16[x+3]=w,n}}Bc.prototype.bytesPerElement=8,Lt("StructArrayLayout4i8",Bc);class Fc extends bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,c,f,g,w,x){const T=this.length;return this.resize(T+1),this.emplace(T,n,c,f,g,w,x)}emplace(n,c,f,g,w,x,T){const I=6*n;return this.int16[I+0]=c,this.int16[I+1]=f,this.int16[I+2]=g,this.int16[I+3]=w,this.int16[I+4]=x,this.int16[I+5]=T,n}}Fc.prototype.bytesPerElement=12,Lt("StructArrayLayout2i4i12",Fc);class Oc extends bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,c,f,g,w,x){const T=this.length;return this.resize(T+1),this.emplace(T,n,c,f,g,w,x)}emplace(n,c,f,g,w,x,T){const I=4*n,z=8*n;return this.int16[I+0]=c,this.int16[I+1]=f,this.uint8[z+4]=g,this.uint8[z+5]=w,this.uint8[z+6]=x,this.uint8[z+7]=T,n}}Oc.prototype.bytesPerElement=8,Lt("StructArrayLayout2i4ub8",Oc);class Ma extends bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,c){const f=this.length;return this.resize(f+1),this.emplace(f,n,c)}emplace(n,c,f){const g=2*n;return this.float32[g+0]=c,this.float32[g+1]=f,n}}Ma.prototype.bytesPerElement=8,Lt("StructArrayLayout2f8",Ma);class wl extends bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,c,f,g,w,x,T,I,z,N){const V=this.length;return this.resize(V+1),this.emplace(V,n,c,f,g,w,x,T,I,z,N)}emplace(n,c,f,g,w,x,T,I,z,N,V){const X=10*n;return this.uint16[X+0]=c,this.uint16[X+1]=f,this.uint16[X+2]=g,this.uint16[X+3]=w,this.uint16[X+4]=x,this.uint16[X+5]=T,this.uint16[X+6]=I,this.uint16[X+7]=z,this.uint16[X+8]=N,this.uint16[X+9]=V,n}}wl.prototype.bytesPerElement=20,Lt("StructArrayLayout10ui20",wl);class Nc extends bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,c,f,g,w,x,T,I,z,N,V,X){const Y=this.length;return this.resize(Y+1),this.emplace(Y,n,c,f,g,w,x,T,I,z,N,V,X)}emplace(n,c,f,g,w,x,T,I,z,N,V,X,Y){const te=12*n;return this.int16[te+0]=c,this.int16[te+1]=f,this.int16[te+2]=g,this.int16[te+3]=w,this.uint16[te+4]=x,this.uint16[te+5]=T,this.uint16[te+6]=I,this.uint16[te+7]=z,this.int16[te+8]=N,this.int16[te+9]=V,this.int16[te+10]=X,this.int16[te+11]=Y,n}}Nc.prototype.bytesPerElement=24,Lt("StructArrayLayout4i4ui4i24",Nc);class jc extends bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,c,f){const g=this.length;return this.resize(g+1),this.emplace(g,n,c,f)}emplace(n,c,f,g){const w=3*n;return this.float32[w+0]=c,this.float32[w+1]=f,this.float32[w+2]=g,n}}jc.prototype.bytesPerElement=12,Lt("StructArrayLayout3f12",jc);class Do extends bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(n){const c=this.length;return this.resize(c+1),this.emplace(c,n)}emplace(n,c){return this.uint32[1*n+0]=c,n}}Do.prototype.bytesPerElement=4,Lt("StructArrayLayout1ul4",Do);class xl extends bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,c,f,g,w,x,T,I,z){const N=this.length;return this.resize(N+1),this.emplace(N,n,c,f,g,w,x,T,I,z)}emplace(n,c,f,g,w,x,T,I,z,N){const V=10*n,X=5*n;return this.int16[V+0]=c,this.int16[V+1]=f,this.int16[V+2]=g,this.int16[V+3]=w,this.int16[V+4]=x,this.int16[V+5]=T,this.uint32[X+3]=I,this.uint16[V+8]=z,this.uint16[V+9]=N,n}}xl.prototype.bytesPerElement=20,Lt("StructArrayLayout6i1ul2ui20",xl);class Ia extends bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,c,f,g,w,x){const T=this.length;return this.resize(T+1),this.emplace(T,n,c,f,g,w,x)}emplace(n,c,f,g,w,x,T){const I=6*n;return this.int16[I+0]=c,this.int16[I+1]=f,this.int16[I+2]=g,this.int16[I+3]=w,this.int16[I+4]=x,this.int16[I+5]=T,n}}Ia.prototype.bytesPerElement=12,Lt("StructArrayLayout2i2i2i12",Ia);class kl extends bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,c,f,g,w){const x=this.length;return this.resize(x+1),this.emplace(x,n,c,f,g,w)}emplace(n,c,f,g,w,x){const T=4*n,I=8*n;return this.float32[T+0]=c,this.float32[T+1]=f,this.float32[T+2]=g,this.int16[I+6]=w,this.int16[I+7]=x,n}}kl.prototype.bytesPerElement=16,Lt("StructArrayLayout2f1f2i16",kl);class La extends bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,c,f,g){const w=this.length;return this.resize(w+1),this.emplace(w,n,c,f,g)}emplace(n,c,f,g,w){const x=12*n,T=3*n;return this.uint8[x+0]=c,this.uint8[x+1]=f,this.float32[T+1]=g,this.float32[T+2]=w,n}}La.prototype.bytesPerElement=12,Lt("StructArrayLayout2ub2f12",La);class Sl extends bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,c,f){const g=this.length;return this.resize(g+1),this.emplace(g,n,c,f)}emplace(n,c,f,g){const w=3*n;return this.uint16[w+0]=c,this.uint16[w+1]=f,this.uint16[w+2]=g,n}}Sl.prototype.bytesPerElement=6,Lt("StructArrayLayout3ui6",Sl);class $s extends bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,c,f,g,w,x,T,I,z,N,V,X,Y,te,ue,ge,xe){const Oe=this.length;return this.resize(Oe+1),this.emplace(Oe,n,c,f,g,w,x,T,I,z,N,V,X,Y,te,ue,ge,xe)}emplace(n,c,f,g,w,x,T,I,z,N,V,X,Y,te,ue,ge,xe,Oe){const Te=24*n,De=12*n,Qe=48*n;return this.int16[Te+0]=c,this.int16[Te+1]=f,this.uint16[Te+2]=g,this.uint16[Te+3]=w,this.uint32[De+2]=x,this.uint32[De+3]=T,this.uint32[De+4]=I,this.uint16[Te+10]=z,this.uint16[Te+11]=N,this.uint16[Te+12]=V,this.float32[De+7]=X,this.float32[De+8]=Y,this.uint8[Qe+36]=te,this.uint8[Qe+37]=ue,this.uint8[Qe+38]=ge,this.uint32[De+10]=xe,this.int16[Te+22]=Oe,n}}$s.prototype.bytesPerElement=48,Lt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",$s);class hs extends bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,c,f,g,w,x,T,I,z,N,V,X,Y,te,ue,ge,xe,Oe,Te,De,Qe,tt,Mt,Ft,Et,kt,gt,Pt){const wt=this.length;return this.resize(wt+1),this.emplace(wt,n,c,f,g,w,x,T,I,z,N,V,X,Y,te,ue,ge,xe,Oe,Te,De,Qe,tt,Mt,Ft,Et,kt,gt,Pt)}emplace(n,c,f,g,w,x,T,I,z,N,V,X,Y,te,ue,ge,xe,Oe,Te,De,Qe,tt,Mt,Ft,Et,kt,gt,Pt,wt){const ct=32*n,Zt=16*n;return this.int16[ct+0]=c,this.int16[ct+1]=f,this.int16[ct+2]=g,this.int16[ct+3]=w,this.int16[ct+4]=x,this.int16[ct+5]=T,this.int16[ct+6]=I,this.int16[ct+7]=z,this.uint16[ct+8]=N,this.uint16[ct+9]=V,this.uint16[ct+10]=X,this.uint16[ct+11]=Y,this.uint16[ct+12]=te,this.uint16[ct+13]=ue,this.uint16[ct+14]=ge,this.uint16[ct+15]=xe,this.uint16[ct+16]=Oe,this.uint16[ct+17]=Te,this.uint16[ct+18]=De,this.uint16[ct+19]=Qe,this.uint16[ct+20]=tt,this.uint16[ct+21]=Mt,this.uint16[ct+22]=Ft,this.uint32[Zt+12]=Et,this.float32[Zt+13]=kt,this.float32[Zt+14]=gt,this.uint16[ct+30]=Pt,this.uint16[ct+31]=wt,n}}hs.prototype.bytesPerElement=64,Lt("StructArrayLayout8i15ui1ul2f2ui64",hs);class Tl extends bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n){const c=this.length;return this.resize(c+1),this.emplace(c,n)}emplace(n,c){return this.float32[1*n+0]=c,n}}Tl.prototype.bytesPerElement=4,Lt("StructArrayLayout1f4",Tl);class Cl extends bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,c,f){const g=this.length;return this.resize(g+1),this.emplace(g,n,c,f)}emplace(n,c,f,g){const w=3*n;return this.uint16[6*n+0]=c,this.float32[w+1]=f,this.float32[w+2]=g,n}}Cl.prototype.bytesPerElement=12,Lt("StructArrayLayout1ui2f12",Cl);class ds extends bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,c,f){const g=this.length;return this.resize(g+1),this.emplace(g,n,c,f)}emplace(n,c,f,g){const w=4*n;return this.uint32[2*n+0]=c,this.uint16[w+2]=f,this.uint16[w+3]=g,n}}ds.prototype.bytesPerElement=8,Lt("StructArrayLayout1ul2ui8",ds);class Uc extends bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,c){const f=this.length;return this.resize(f+1),this.emplace(f,n,c)}emplace(n,c,f){const g=2*n;return this.uint16[g+0]=c,this.uint16[g+1]=f,n}}Uc.prototype.bytesPerElement=4,Lt("StructArrayLayout2ui4",Uc);class Vc extends bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n){const c=this.length;return this.resize(c+1),this.emplace(c,n)}emplace(n,c){return this.uint16[1*n+0]=c,n}}Vc.prototype.bytesPerElement=2,Lt("StructArrayLayout1ui2",Vc);class El extends bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,c,f,g){const w=this.length;return this.resize(w+1),this.emplace(w,n,c,f,g)}emplace(n,c,f,g,w){const x=4*n;return this.float32[x+0]=c,this.float32[x+1]=f,this.float32[x+2]=g,this.float32[x+3]=w,n}}El.prototype.bytesPerElement=16,Lt("StructArrayLayout4f16",El);class Dh extends Ca{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new S(this.anchorPointX,this.anchorPointY)}}Dh.prototype.size=20;class y extends xl{get(n){return new Dh(this,n)}}Lt("CollisionBoxArray",y);class o extends Ca{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(n){this._structArray.uint8[this._pos1+37]=n}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(n){this._structArray.uint8[this._pos1+38]=n}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(n){this._structArray.uint32[this._pos4+10]=n}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}o.prototype.size=48;class h extends $s{get(n){return new o(this,n)}}Lt("PlacedSymbolArray",h);class p extends Ca{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(n){this._structArray.uint32[this._pos4+12]=n}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}p.prototype.size=64;class m extends hs{get(n){return new p(this,n)}}Lt("SymbolInstanceArray",m);class b extends Tl{getoffsetX(n){return this.float32[1*n+0]}}Lt("GlyphOffsetArray",b);class C extends zo{getx(n){return this.int16[3*n+0]}gety(n){return this.int16[3*n+1]}gettileUnitDistanceFromAnchor(n){return this.int16[3*n+2]}}Lt("SymbolLineVertexArray",C);class M extends Ca{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}M.prototype.size=12;class L extends Cl{get(n){return new M(this,n)}}Lt("TextAnchorOffsetArray",L);class O extends Ca{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}O.prototype.size=8;class $ extends ds{get(n){return new O(this,n)}}Lt("FeatureIndexArray",$);class q extends Ea{}class ee extends Ea{}class pe extends Ea{}class fe extends Fc{}class _e extends Oc{}class ce extends Ma{}class Ce extends wl{}class Ze extends Nc{}class be extends jc{}class Re extends Do{}class We extends Ia{}class He extends La{}class Xe extends Sl{}class rt extends Uc{}const it=Ln([{name:"a_pos",components:2,type:"Int16"}],4),{members:pt}=it;class yt{constructor(n=[]){this.segments=n}prepareSegment(n,c,f,g){let w=this.segments[this.segments.length-1];return n>yt.MAX_VERTEX_ARRAY_LENGTH&&Ke(`Max vertices per segment is ${yt.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${n}`),(!w||w.vertexLength+n>yt.MAX_VERTEX_ARRAY_LENGTH||w.sortKey!==g)&&(w={vertexOffset:c.length,primitiveOffset:f.length,vertexLength:0,primitiveLength:0},g!==void 0&&(w.sortKey=g),this.segments.push(w)),w}get(){return this.segments}destroy(){for(const n of this.segments)for(const c in n.vaos)n.vaos[c].destroy()}static simpleSegment(n,c,f,g){return new yt([{vertexOffset:n,primitiveOffset:c,vertexLength:f,primitiveLength:g,vaos:{},sortKey:0}])}}function ai(s,n){return 256*(s=le(Math.floor(s),0,255))+le(Math.floor(n),0,255)}yt.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Lt("SegmentVector",yt);const bt=Ln([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Kt={exports:{}},li={exports:{}};li.exports=function(s,n){var c,f,g,w,x,T,I,z;for(f=s.length-(c=3&s.length),g=n,x=3432918353,T=461845907,z=0;z<f;)I=255&s.charCodeAt(z)|(255&s.charCodeAt(++z))<<8|(255&s.charCodeAt(++z))<<16|(255&s.charCodeAt(++z))<<24,++z,g=27492+(65535&(w=5*(65535&(g=(g^=I=(65535&(I=(I=(65535&I)*x+(((I>>>16)*x&65535)<<16)&4294967295)<<15|I>>>17))*T+(((I>>>16)*T&65535)<<16)&4294967295)<<13|g>>>19))+((5*(g>>>16)&65535)<<16)&4294967295))+((58964+(w>>>16)&65535)<<16);switch(I=0,c){case 3:I^=(255&s.charCodeAt(z+2))<<16;case 2:I^=(255&s.charCodeAt(z+1))<<8;case 1:g^=I=(65535&(I=(I=(65535&(I^=255&s.charCodeAt(z)))*x+(((I>>>16)*x&65535)<<16)&4294967295)<<15|I>>>17))*T+(((I>>>16)*T&65535)<<16)&4294967295}return g^=s.length,g=2246822507*(65535&(g^=g>>>16))+((2246822507*(g>>>16)&65535)<<16)&4294967295,g=3266489909*(65535&(g^=g>>>13))+((3266489909*(g>>>16)&65535)<<16)&4294967295,(g^=g>>>16)>>>0};var Ti=li.exports,ii={exports:{}};ii.exports=function(s,n){for(var c,f=s.length,g=n^f,w=0;f>=4;)c=1540483477*(65535&(c=255&s.charCodeAt(w)|(255&s.charCodeAt(++w))<<8|(255&s.charCodeAt(++w))<<16|(255&s.charCodeAt(++w))<<24))+((1540483477*(c>>>16)&65535)<<16),g=1540483477*(65535&g)+((1540483477*(g>>>16)&65535)<<16)^(c=1540483477*(65535&(c^=c>>>24))+((1540483477*(c>>>16)&65535)<<16)),f-=4,++w;switch(f){case 3:g^=(255&s.charCodeAt(w+2))<<16;case 2:g^=(255&s.charCodeAt(w+1))<<8;case 1:g=1540483477*(65535&(g^=255&s.charCodeAt(w)))+((1540483477*(g>>>16)&65535)<<16)}return g=1540483477*(65535&(g^=g>>>13))+((1540483477*(g>>>16)&65535)<<16),(g^=g>>>15)>>>0};var di=Ti,mi=ii.exports;Kt.exports=di,Kt.exports.murmur3=di,Kt.exports.murmur2=mi;var wn=_(Kt.exports);class Vi{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(n,c,f,g){this.ids.push(Fr(n)),this.positions.push(c,f,g)}getPositions(n){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const c=Fr(n);let f=0,g=this.ids.length-1;for(;f<g;){const x=f+g>>1;this.ids[x]>=c?g=x:f=x+1}const w=[];for(;this.ids[f]===c;)w.push({index:this.positions[3*f],start:this.positions[3*f+1],end:this.positions[3*f+2]}),f++;return w}static serialize(n,c){const f=new Float64Array(n.ids),g=new Uint32Array(n.positions);return qn(f,g,0,f.length-1),c&&c.push(f.buffer,g.buffer),{ids:f,positions:g}}static deserialize(n){const c=new Vi;return c.ids=n.ids,c.positions=n.positions,c.indexed=!0,c}}function Fr(s){const n=+s;return!isNaN(n)&&n<=Number.MAX_SAFE_INTEGER?n:wn(String(s))}function qn(s,n,c,f){for(;c<f;){const g=s[c+f>>1];let w=c-1,x=f+1;for(;;){do w++;while(s[w]<g);do x--;while(s[x]>g);if(w>=x)break;fn(s,w,x),fn(n,3*w,3*x),fn(n,3*w+1,3*x+1),fn(n,3*w+2,3*x+2)}x-c<f-x?(qn(s,n,c,x),c=x+1):(qn(s,n,x+1,f),f=x)}}function fn(s,n,c){const f=s[n];s[n]=s[c],s[c]=f}Lt("FeaturePositionMap",Vi);class Zn{constructor(n,c){this.gl=n.gl,this.location=c}}class Or extends Zn{constructor(n,c){super(n,c),this.current=0}set(n){this.current!==n&&(this.current=n,this.gl.uniform1f(this.location,n))}}class wo extends Zn{constructor(n,c){super(n,c),this.current=[0,0,0,0]}set(n){n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]&&n[3]===this.current[3]||(this.current=n,this.gl.uniform4f(this.location,n[0],n[1],n[2],n[3]))}}class Yo extends Zn{constructor(n,c){super(n,c),this.current=ji.transparent}set(n){n.r===this.current.r&&n.g===this.current.g&&n.b===this.current.b&&n.a===this.current.a||(this.current=n,this.gl.uniform4f(this.location,n.r,n.g,n.b,n.a))}}const Aa=new Float32Array(16);function Qo(s){return[ai(255*s.r,255*s.g),ai(255*s.b,255*s.a)]}class xo{constructor(n,c,f){this.value=n,this.uniformNames=c.map(g=>`u_${g}`),this.type=f}setUniform(n,c,f){n.set(f.constantOr(this.value))}getBinding(n,c,f){return this.type==="color"?new Yo(n,c):new Or(n,c)}}class Fn{constructor(n,c){this.uniformNames=c.map(f=>`u_${f}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(n,c){this.pixelRatioFrom=c.pixelRatio,this.pixelRatioTo=n.pixelRatio,this.patternFrom=c.tlbr,this.patternTo=n.tlbr}setUniform(n,c,f,g){const w=g==="u_pattern_to"?this.patternTo:g==="u_pattern_from"?this.patternFrom:g==="u_pixel_ratio_to"?this.pixelRatioTo:g==="u_pixel_ratio_from"?this.pixelRatioFrom:null;w&&n.set(w)}getBinding(n,c,f){return f.substr(0,9)==="u_pattern"?new wo(n,c):new Or(n,c)}}class pn{constructor(n,c,f,g){this.expression=n,this.type=f,this.maxValue=0,this.paintVertexAttributes=c.map(w=>({name:`a_${w}`,type:"Float32",components:f==="color"?2:1,offset:0})),this.paintVertexArray=new g}populatePaintArray(n,c,f,g,w){const x=this.paintVertexArray.length,T=this.expression.evaluate(new an(0),c,{},g,[],w);this.paintVertexArray.resize(n),this._setPaintValue(x,n,T)}updatePaintArray(n,c,f,g){const w=this.expression.evaluate({zoom:0},f,g);this._setPaintValue(n,c,w)}_setPaintValue(n,c,f){if(this.type==="color"){const g=Qo(f);for(let w=n;w<c;w++)this.paintVertexArray.emplace(w,g[0],g[1])}else{for(let g=n;g<c;g++)this.paintVertexArray.emplace(g,f);this.maxValue=Math.max(this.maxValue,Math.abs(f))}}upload(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ln{constructor(n,c,f,g,w,x){this.expression=n,this.uniformNames=c.map(T=>`u_${T}_t`),this.type=f,this.useIntegerZoom=g,this.zoom=w,this.maxValue=0,this.paintVertexAttributes=c.map(T=>({name:`a_${T}`,type:"Float32",components:f==="color"?4:2,offset:0})),this.paintVertexArray=new x}populatePaintArray(n,c,f,g,w){const x=this.expression.evaluate(new an(this.zoom),c,{},g,[],w),T=this.expression.evaluate(new an(this.zoom+1),c,{},g,[],w),I=this.paintVertexArray.length;this.paintVertexArray.resize(n),this._setPaintValue(I,n,x,T)}updatePaintArray(n,c,f,g){const w=this.expression.evaluate({zoom:this.zoom},f,g),x=this.expression.evaluate({zoom:this.zoom+1},f,g);this._setPaintValue(n,c,w,x)}_setPaintValue(n,c,f,g){if(this.type==="color"){const w=Qo(f),x=Qo(g);for(let T=n;T<c;T++)this.paintVertexArray.emplace(T,w[0],w[1],x[0],x[1])}else{for(let w=n;w<c;w++)this.paintVertexArray.emplace(w,f,g);this.maxValue=Math.max(this.maxValue,Math.abs(f),Math.abs(g))}}upload(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(n,c){const f=this.useIntegerZoom?Math.floor(c.zoom):c.zoom,g=le(this.expression.interpolationFactor(f,this.zoom,this.zoom+1),0,1);n.set(g)}getBinding(n,c,f){return new Or(n,c)}}class Jr{constructor(n,c,f,g,w,x){this.expression=n,this.type=c,this.useIntegerZoom=f,this.zoom=g,this.layerId=x,this.zoomInPaintVertexArray=new w,this.zoomOutPaintVertexArray=new w}populatePaintArray(n,c,f){const g=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(n),this.zoomOutPaintVertexArray.resize(n),this._setPaintValues(g,n,c.patterns&&c.patterns[this.layerId],f)}updatePaintArray(n,c,f,g,w){this._setPaintValues(n,c,f.patterns&&f.patterns[this.layerId],w)}_setPaintValues(n,c,f,g){if(!g||!f)return;const{min:w,mid:x,max:T}=f,I=g[w],z=g[x],N=g[T];if(I&&z&&N)for(let V=n;V<c;V++)this.zoomInPaintVertexArray.emplace(V,z.tl[0],z.tl[1],z.br[0],z.br[1],I.tl[0],I.tl[1],I.br[0],I.br[1],z.pixelRatio,I.pixelRatio),this.zoomOutPaintVertexArray.emplace(V,z.tl[0],z.tl[1],z.br[0],z.br[1],N.tl[0],N.tl[1],N.br[0],N.br[1],z.pixelRatio,N.pixelRatio)}upload(n){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=n.createVertexBuffer(this.zoomInPaintVertexArray,bt.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=n.createVertexBuffer(this.zoomOutPaintVertexArray,bt.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class On{constructor(n,c,f){this.binders={},this._buffers=[];const g=[];for(const w in n.paint._values){if(!f(w))continue;const x=n.paint.get(w);if(!(x instanceof so&&Bs(x.property.specification)))continue;const T=Yr(w,n.type),I=x.value,z=x.property.specification.type,N=x.property.useIntegerZoom,V=x.property.specification["property-type"],X=V==="cross-faded"||V==="cross-faded-data-driven";if(I.kind==="constant")this.binders[w]=X?new Fn(I.value,T):new xo(I.value,T,z),g.push(`/u_${w}`);else if(I.kind==="source"||X){const Y=Nn(w,z,"source");this.binders[w]=X?new Jr(I,z,N,c,Y,n.id):new pn(I,T,z,Y),g.push(`/a_${w}`)}else{const Y=Nn(w,z,"composite");this.binders[w]=new ln(I,T,z,N,c,Y),g.push(`/z_${w}`)}}this.cacheKey=g.sort().join("")}getMaxValue(n){const c=this.binders[n];return c instanceof pn||c instanceof ln?c.maxValue:0}populatePaintArrays(n,c,f,g,w){for(const x in this.binders){const T=this.binders[x];(T instanceof pn||T instanceof ln||T instanceof Jr)&&T.populatePaintArray(n,c,f,g,w)}}setConstantPatternPositions(n,c){for(const f in this.binders){const g=this.binders[f];g instanceof Fn&&g.setConstantPatternPositions(n,c)}}updatePaintArrays(n,c,f,g,w){let x=!1;for(const T in n){const I=c.getPositions(T);for(const z of I){const N=f.feature(z.index);for(const V in this.binders){const X=this.binders[V];if((X instanceof pn||X instanceof ln||X instanceof Jr)&&X.expression.isStateDependent===!0){const Y=g.paint.get(V);X.expression=Y.value,X.updatePaintArray(z.start,z.end,N,n[T],w),x=!0}}}}return x}defines(){const n=[];for(const c in this.binders){const f=this.binders[c];(f instanceof xo||f instanceof Fn)&&n.push(...f.uniformNames.map(g=>`#define HAS_UNIFORM_${g}`))}return n}getBinderAttributes(){const n=[];for(const c in this.binders){const f=this.binders[c];if(f instanceof pn||f instanceof ln)for(let g=0;g<f.paintVertexAttributes.length;g++)n.push(f.paintVertexAttributes[g].name);else if(f instanceof Jr)for(let g=0;g<bt.members.length;g++)n.push(bt.members[g].name)}return n}getBinderUniforms(){const n=[];for(const c in this.binders){const f=this.binders[c];if(f instanceof xo||f instanceof Fn||f instanceof ln)for(const g of f.uniformNames)n.push(g)}return n}getPaintVertexBuffers(){return this._buffers}getUniforms(n,c){const f=[];for(const g in this.binders){const w=this.binders[g];if(w instanceof xo||w instanceof Fn||w instanceof ln){for(const x of w.uniformNames)if(c[x]){const T=w.getBinding(n,c[x],x);f.push({name:x,property:g,binding:T})}}}return f}setUniforms(n,c,f,g){for(const{name:w,property:x,binding:T}of c)this.binders[x].setUniform(T,g,f.get(x),w)}updatePaintBuffers(n){this._buffers=[];for(const c in this.binders){const f=this.binders[c];if(n&&f instanceof Jr){const g=n.fromScale===2?f.zoomInPaintVertexBuffer:f.zoomOutPaintVertexBuffer;g&&this._buffers.push(g)}else(f instanceof pn||f instanceof ln)&&f.paintVertexBuffer&&this._buffers.push(f.paintVertexBuffer)}}upload(n){for(const c in this.binders){const f=this.binders[c];(f instanceof pn||f instanceof ln||f instanceof Jr)&&f.upload(n)}this.updatePaintBuffers()}destroy(){for(const n in this.binders){const c=this.binders[n];(c instanceof pn||c instanceof ln||c instanceof Jr)&&c.destroy()}}}class mn{constructor(n,c,f=()=>!0){this.programConfigurations={};for(const g of n)this.programConfigurations[g.id]=new On(g,c,f);this.needsUpload=!1,this._featureMap=new Vi,this._bufferOffset=0}populatePaintArrays(n,c,f,g,w,x){for(const T in this.programConfigurations)this.programConfigurations[T].populatePaintArrays(n,c,g,w,x);c.id!==void 0&&this._featureMap.add(c.id,f,this._bufferOffset,n),this._bufferOffset=n,this.needsUpload=!0}updatePaintArrays(n,c,f,g){for(const w of f)this.needsUpload=this.programConfigurations[w.id].updatePaintArrays(n,this._featureMap,c,w,g)||this.needsUpload}get(n){return this.programConfigurations[n]}upload(n){if(this.needsUpload){for(const c in this.programConfigurations)this.programConfigurations[c].upload(n);this.needsUpload=!1}}destroy(){for(const n in this.programConfigurations)this.programConfigurations[n].destroy()}}function Yr(s,n){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[s]||[s.replace(`${n}-`,"").replace(/-/g,"_")]}function Nn(s,n,c){const f={color:{source:Ma,composite:El},number:{source:Tl,composite:Ma}},g=function(w){return{"line-pattern":{source:Ce,composite:Ce},"fill-pattern":{source:Ce,composite:Ce},"fill-extrusion-pattern":{source:Ce,composite:Ce}}[w]}(s);return g&&g[c]||f[n][c]}Lt("ConstantBinder",xo),Lt("CrossFadedConstantBinder",Fn),Lt("SourceExpressionBinder",pn),Lt("CrossFadedCompositeBinder",Jr),Lt("CompositeExpressionBinder",ln),Lt("ProgramConfiguration",On,{omit:["_buffers"]}),Lt("ProgramConfigurationSet",mn);const Sn=8192,$c=Math.pow(2,14)-1,Rh=-$c-1;function fs(s){const n=Sn/s.extent,c=s.loadGeometry();for(let f=0;f<c.length;f++){const g=c[f];for(let w=0;w<g.length;w++){const x=g[w],T=Math.round(x.x*n),I=Math.round(x.y*n);x.x=le(T,Rh,$c),x.y=le(I,Rh,$c),(T<x.x||T>x.x+1||I<x.y||I>x.y+1)&&Ke("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return c}function ps(s,n){return{type:s.type,id:s.id,properties:s.properties,geometry:n?fs(s):[]}}function Ml(s,n,c,f,g){s.emplaceBack(2*n+(f+1)/2,2*c+(g+1)/2)}class es{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(c=>c.id),this.index=n.index,this.hasPattern=!1,this.layoutVertexArray=new ee,this.indexArray=new Xe,this.segments=new yt,this.programConfigurations=new mn(n.layers,n.zoom),this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id)}populate(n,c,f){const g=this.layers[0],w=[];let x=null,T=!1;g.type==="circle"&&(x=g.layout.get("circle-sort-key"),T=!x.isConstant());for(const{feature:I,id:z,index:N,sourceLayerIndex:V}of n){const X=this.layers[0]._featureFilter.needGeometry,Y=ps(I,X);if(!this.layers[0]._featureFilter.filter(new an(this.zoom),Y,f))continue;const te=T?x.evaluate(Y,{},f):void 0,ue={id:z,properties:I.properties,type:I.type,sourceLayerIndex:V,index:N,geometry:X?Y.geometry:fs(I),patterns:{},sortKey:te};w.push(ue)}T&&w.sort((I,z)=>I.sortKey-z.sortKey);for(const I of w){const{geometry:z,index:N,sourceLayerIndex:V}=I,X=n[N].feature;this.addFeature(I,z,N,f),c.featureIndex.insert(X,z,N,V,this.index)}}update(n,c,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,c,this.stateDependentLayers,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,pt),this.indexBuffer=n.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(n,c,f,g){for(const w of c)for(const x of w){const T=x.x,I=x.y;if(T<0||T>=Sn||I<0||I>=Sn)continue;const z=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,n.sortKey),N=z.vertexLength;Ml(this.layoutVertexArray,T,I,-1,-1),Ml(this.layoutVertexArray,T,I,1,-1),Ml(this.layoutVertexArray,T,I,1,1),Ml(this.layoutVertexArray,T,I,-1,1),this.indexArray.emplaceBack(N,N+1,N+2),this.indexArray.emplaceBack(N,N+3,N+2),z.vertexLength+=4,z.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,f,{},g)}}function qc(s,n){for(let c=0;c<s.length;c++)if(Ll(n,s[c]))return!0;for(let c=0;c<n.length;c++)if(Ll(s,n[c]))return!0;return!!Il(s,n)}function Bh(s,n,c){return!!Ll(s,n)||!!sf(n,s,c)}function Zc(s,n){if(s.length===1)return Kp(n,s[0]);for(let c=0;c<n.length;c++){const f=n[c];for(let g=0;g<f.length;g++)if(Ll(s,f[g]))return!0}for(let c=0;c<s.length;c++)if(Kp(n,s[c]))return!0;for(let c=0;c<n.length;c++)if(Il(s,n[c]))return!0;return!1}function Gc(s,n,c){if(s.length>1){if(Il(s,n))return!0;for(let f=0;f<n.length;f++)if(sf(n[f],s,c))return!0}for(let f=0;f<s.length;f++)if(sf(s[f],n,c))return!0;return!1}function Il(s,n){if(s.length===0||n.length===0)return!1;for(let c=0;c<s.length-1;c++){const f=s[c],g=s[c+1];for(let w=0;w<n.length-1;w++)if(Wc(f,g,n[w],n[w+1]))return!0}return!1}function Wc(s,n,c,f){return Le(s,c,f)!==Le(n,c,f)&&Le(s,n,c)!==Le(s,n,f)}function sf(s,n,c){const f=c*c;if(n.length===1)return s.distSqr(n[0])<f;for(let g=1;g<n.length;g++)if(Xp(s,n[g-1],n[g])<f)return!0;return!1}function Xp(s,n,c){const f=n.distSqr(c);if(f===0)return s.distSqr(n);const g=((s.x-n.x)*(c.x-n.x)+(s.y-n.y)*(c.y-n.y))/f;return s.distSqr(g<0?n:g>1?c:c.sub(n)._mult(g)._add(n))}function Kp(s,n){let c,f,g,w=!1;for(let x=0;x<s.length;x++){c=s[x];for(let T=0,I=c.length-1;T<c.length;I=T++)f=c[T],g=c[I],f.y>n.y!=g.y>n.y&&n.x<(g.x-f.x)*(n.y-f.y)/(g.y-f.y)+f.x&&(w=!w)}return w}function Ll(s,n){let c=!1;for(let f=0,g=s.length-1;f<s.length;g=f++){const w=s[f],x=s[g];w.y>n.y!=x.y>n.y&&n.x<(x.x-w.x)*(n.y-w.y)/(x.y-w.y)+w.x&&(c=!c)}return c}function p1(s,n,c){const f=c[0],g=c[2];if(s.x<f.x&&n.x<f.x||s.x>g.x&&n.x>g.x||s.y<f.y&&n.y<f.y||s.y>g.y&&n.y>g.y)return!1;const w=Le(s,n,c[0]);return w!==Le(s,n,c[1])||w!==Le(s,n,c[2])||w!==Le(s,n,c[3])}function Hc(s,n,c){const f=n.paint.get(s).value;return f.kind==="constant"?f.value:c.programConfigurations.get(n.id).getMaxValue(s)}function Fh(s){return Math.sqrt(s[0]*s[0]+s[1]*s[1])}function Oh(s,n,c,f,g){if(!n[0]&&!n[1])return s;const w=S.convert(n)._mult(g);c==="viewport"&&w._rotate(-f);const x=[];for(let T=0;T<s.length;T++)x.push(s[T].sub(w));return x}let Jp,Yp;Lt("CircleBucket",es,{omit:["layers"]});var m1={get paint(){return Yp=Yp||new Sr({"circle-radius":new Gt(we.paint_circle["circle-radius"]),"circle-color":new Gt(we.paint_circle["circle-color"]),"circle-blur":new Gt(we.paint_circle["circle-blur"]),"circle-opacity":new Gt(we.paint_circle["circle-opacity"]),"circle-translate":new $t(we.paint_circle["circle-translate"]),"circle-translate-anchor":new $t(we.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new $t(we.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new $t(we.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Gt(we.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Gt(we.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Gt(we.paint_circle["circle-stroke-opacity"])})},get layout(){return Jp=Jp||new Sr({"circle-sort-key":new Gt(we.layout_circle["circle-sort-key"])})}},Tr=1e-6,Al=typeof Float32Array<"u"?Float32Array:Array;function af(s){return s[0]=1,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=1,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}function Qp(s,n,c){var f=n[0],g=n[1],w=n[2],x=n[3],T=n[4],I=n[5],z=n[6],N=n[7],V=n[8],X=n[9],Y=n[10],te=n[11],ue=n[12],ge=n[13],xe=n[14],Oe=n[15],Te=c[0],De=c[1],Qe=c[2],tt=c[3];return s[0]=Te*f+De*T+Qe*V+tt*ue,s[1]=Te*g+De*I+Qe*X+tt*ge,s[2]=Te*w+De*z+Qe*Y+tt*xe,s[3]=Te*x+De*N+Qe*te+tt*Oe,s[4]=(Te=c[4])*f+(De=c[5])*T+(Qe=c[6])*V+(tt=c[7])*ue,s[5]=Te*g+De*I+Qe*X+tt*ge,s[6]=Te*w+De*z+Qe*Y+tt*xe,s[7]=Te*x+De*N+Qe*te+tt*Oe,s[8]=(Te=c[8])*f+(De=c[9])*T+(Qe=c[10])*V+(tt=c[11])*ue,s[9]=Te*g+De*I+Qe*X+tt*ge,s[10]=Te*w+De*z+Qe*Y+tt*xe,s[11]=Te*x+De*N+Qe*te+tt*Oe,s[12]=(Te=c[12])*f+(De=c[13])*T+(Qe=c[14])*V+(tt=c[15])*ue,s[13]=Te*g+De*I+Qe*X+tt*ge,s[14]=Te*w+De*z+Qe*Y+tt*xe,s[15]=Te*x+De*N+Qe*te+tt*Oe,s}Math.hypot||(Math.hypot=function(){for(var s=0,n=arguments.length;n--;)s+=arguments[n]*arguments[n];return Math.sqrt(s)});var Xc,g1=Qp;function Nh(s,n,c){var f=n[0],g=n[1],w=n[2],x=n[3];return s[0]=c[0]*f+c[4]*g+c[8]*w+c[12]*x,s[1]=c[1]*f+c[5]*g+c[9]*w+c[13]*x,s[2]=c[2]*f+c[6]*g+c[10]*w+c[14]*x,s[3]=c[3]*f+c[7]*g+c[11]*w+c[15]*x,s}Xc=new Al(4),Al!=Float32Array&&(Xc[0]=0,Xc[1]=0,Xc[2]=0,Xc[3]=0);class _1 extends ao{constructor(n){super(n,m1)}createBucket(n){return new es(n)}queryRadius(n){const c=n;return Hc("circle-radius",this,c)+Hc("circle-stroke-width",this,c)+Fh(this.paint.get("circle-translate"))}queryIntersectsFeature(n,c,f,g,w,x,T,I){const z=Oh(n,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),x.angle,T),N=this.paint.get("circle-radius").evaluate(c,f)+this.paint.get("circle-stroke-width").evaluate(c,f),V=this.paint.get("circle-pitch-alignment")==="map",X=V?z:function(te,ue){return te.map(ge=>em(ge,ue))}(z,I),Y=V?N*T:N;for(const te of g)for(const ue of te){const ge=V?ue:em(ue,I);let xe=Y;const Oe=Nh([],[ue.x,ue.y,0,1],I);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?xe*=Oe[3]/x.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(xe*=x.cameraToCenterDistance/Oe[3]),Bh(X,ge,xe))return!0}return!1}}function em(s,n){const c=Nh([],[s.x,s.y,0,1],n);return new S(c[0]/c[3],c[1]/c[3])}class tm extends es{}let im;Lt("HeatmapBucket",tm,{omit:["layers"]});var y1={get paint(){return im=im||new Sr({"heatmap-radius":new Gt(we.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Gt(we.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new $t(we.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Dc(we.paint_heatmap["heatmap-color"]),"heatmap-opacity":new $t(we.paint_heatmap["heatmap-opacity"])})}};function lf(s,{width:n,height:c},f,g){if(g){if(g instanceof Uint8ClampedArray)g=new Uint8Array(g.buffer);else if(g.length!==n*c*f)throw new RangeError(`mismatched image size. expected: ${g.length} but got: ${n*c*f}`)}else g=new Uint8Array(n*c*f);return s.width=n,s.height=c,s.data=g,s}function nm(s,{width:n,height:c},f){if(n===s.width&&c===s.height)return;const g=lf({},{width:n,height:c},f);cf(s,g,{x:0,y:0},{x:0,y:0},{width:Math.min(s.width,n),height:Math.min(s.height,c)},f),s.width=n,s.height=c,s.data=g.data}function cf(s,n,c,f,g,w){if(g.width===0||g.height===0)return n;if(g.width>s.width||g.height>s.height||c.x>s.width-g.width||c.y>s.height-g.height)throw new RangeError("out of range source coordinates for image copy");if(g.width>n.width||g.height>n.height||f.x>n.width-g.width||f.y>n.height-g.height)throw new RangeError("out of range destination coordinates for image copy");const x=s.data,T=n.data;if(x===T)throw new Error("srcData equals dstData, so image is already copied");for(let I=0;I<g.height;I++){const z=((c.y+I)*s.width+c.x)*w,N=((f.y+I)*n.width+f.x)*w;for(let V=0;V<g.width*w;V++)T[N+V]=x[z+V]}return n}class Kc{constructor(n,c){lf(this,n,1,c)}resize(n){nm(this,n,1)}clone(){return new Kc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(n,c,f,g,w){cf(n,c,f,g,w,1)}}class lo{constructor(n,c){lf(this,n,4,c)}resize(n){nm(this,n,4)}replace(n,c){c?this.data.set(n):this.data=n instanceof Uint8ClampedArray?new Uint8Array(n.buffer):n}clone(){return new lo({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(n,c,f,g,w){cf(n,c,f,g,w,4)}}function rm(s){const n={},c=s.resolution||256,f=s.clips?s.clips.length:1,g=s.image||new lo({width:c,height:f});if(Math.log(c)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${c}`);const w=(x,T,I)=>{n[s.evaluationKey]=I;const z=s.expression.evaluate(n);g.data[x+T+0]=Math.floor(255*z.r/z.a),g.data[x+T+1]=Math.floor(255*z.g/z.a),g.data[x+T+2]=Math.floor(255*z.b/z.a),g.data[x+T+3]=Math.floor(255*z.a)};if(s.clips)for(let x=0,T=0;x<f;++x,T+=4*c)for(let I=0,z=0;I<c;I++,z+=4){const N=I/(c-1),{start:V,end:X}=s.clips[x];w(T,z,V*(1-N)+X*N)}else for(let x=0,T=0;x<c;x++,T+=4)w(0,T,x/(c-1));return g}Lt("AlphaImage",Kc),Lt("RGBAImage",lo);class v1 extends ao{createBucket(n){return new tm(n)}constructor(n){super(n,y1),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(n){n==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=rm({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let om;var b1={get paint(){return om=om||new Sr({"hillshade-illumination-direction":new $t(we.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new $t(we.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new $t(we.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new $t(we.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new $t(we.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new $t(we.paint_hillshade["hillshade-accent-color"])})}};class w1 extends ao{constructor(n){super(n,b1)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const x1=Ln([{name:"a_pos",components:2,type:"Int16"}],4),{members:k1}=x1;var uf={exports:{}};function jh(s,n,c){c=c||2;var f,g,w,x,T,I,z,N=n&&n.length,V=N?n[0]*c:s.length,X=sm(s,0,V,c,!0),Y=[];if(!X||X.next===X.prev)return Y;if(N&&(X=function(ue,ge,xe,Oe){var Te,De,Qe,tt=[];for(Te=0,De=ge.length;Te<De;Te++)(Qe=sm(ue,ge[Te]*Oe,Te<De-1?ge[Te+1]*Oe:ue.length,Oe,!1))===Qe.next&&(Qe.steiner=!0),tt.push(A1(Qe));for(tt.sort(M1),Te=0;Te<tt.length;Te++)xe=I1(tt[Te],xe);return xe}(s,n,X,c)),s.length>80*c){f=w=s[0],g=x=s[1];for(var te=c;te<V;te+=c)(T=s[te])<f&&(f=T),(I=s[te+1])<g&&(g=I),T>w&&(w=T),I>x&&(x=I);z=(z=Math.max(w-f,x-g))!==0?32767/z:0}return Jc(X,Y,c,f,g,z,0),Y}function sm(s,n,c,f,g){var w,x;if(g===ff(s,n,c,f)>0)for(w=n;w<c;w+=f)x=cm(w,s[w],s[w+1],x);else for(w=c-f;w>=n;w-=f)x=cm(w,s[w],s[w+1],x);return x&&Uh(x,x.next)&&(Qc(x),x=x.next),x}function Pa(s,n){if(!s)return s;n||(n=s);var c,f=s;do if(c=!1,f.steiner||!Uh(f,f.next)&&An(f.prev,f,f.next)!==0)f=f.next;else{if(Qc(f),(f=n=f.prev)===f.next)break;c=!0}while(c||f!==n);return n}function Jc(s,n,c,f,g,w,x){if(s){!x&&w&&function(N,V,X,Y){var te=N;do te.z===0&&(te.z=hf(te.x,te.y,V,X,Y)),te.prevZ=te.prev,te.nextZ=te.next,te=te.next;while(te!==N);te.prevZ.nextZ=null,te.prevZ=null,function(ue){var ge,xe,Oe,Te,De,Qe,tt,Mt,Ft=1;do{for(xe=ue,ue=null,De=null,Qe=0;xe;){for(Qe++,Oe=xe,tt=0,ge=0;ge<Ft&&(tt++,Oe=Oe.nextZ);ge++);for(Mt=Ft;tt>0||Mt>0&&Oe;)tt!==0&&(Mt===0||!Oe||xe.z<=Oe.z)?(Te=xe,xe=xe.nextZ,tt--):(Te=Oe,Oe=Oe.nextZ,Mt--),De?De.nextZ=Te:ue=Te,Te.prevZ=De,De=Te;xe=Oe}De.nextZ=null,Ft*=2}while(Qe>1)}(te)}(s,f,g,w);for(var T,I,z=s;s.prev!==s.next;)if(T=s.prev,I=s.next,w?T1(s,f,g,w):S1(s))n.push(T.i/c|0),n.push(s.i/c|0),n.push(I.i/c|0),Qc(s),s=I.next,z=I.next;else if((s=I)===z){x?x===1?Jc(s=C1(Pa(s),n,c),n,c,f,g,w,2):x===2&&E1(s,n,c,f,g,w):Jc(Pa(s),n,c,f,g,w,1);break}}}function S1(s){var n=s.prev,c=s,f=s.next;if(An(n,c,f)>=0)return!1;for(var g=n.x,w=c.x,x=f.x,T=n.y,I=c.y,z=f.y,N=g<w?g<x?g:x:w<x?w:x,V=T<I?T<z?T:z:I<z?I:z,X=g>w?g>x?g:x:w>x?w:x,Y=T>I?T>z?T:z:I>z?I:z,te=f.next;te!==n;){if(te.x>=N&&te.x<=X&&te.y>=V&&te.y<=Y&&Pl(g,T,w,I,x,z,te.x,te.y)&&An(te.prev,te,te.next)>=0)return!1;te=te.next}return!0}function T1(s,n,c,f){var g=s.prev,w=s,x=s.next;if(An(g,w,x)>=0)return!1;for(var T=g.x,I=w.x,z=x.x,N=g.y,V=w.y,X=x.y,Y=T<I?T<z?T:z:I<z?I:z,te=N<V?N<X?N:X:V<X?V:X,ue=T>I?T>z?T:z:I>z?I:z,ge=N>V?N>X?N:X:V>X?V:X,xe=hf(Y,te,n,c,f),Oe=hf(ue,ge,n,c,f),Te=s.prevZ,De=s.nextZ;Te&&Te.z>=xe&&De&&De.z<=Oe;){if(Te.x>=Y&&Te.x<=ue&&Te.y>=te&&Te.y<=ge&&Te!==g&&Te!==x&&Pl(T,N,I,V,z,X,Te.x,Te.y)&&An(Te.prev,Te,Te.next)>=0||(Te=Te.prevZ,De.x>=Y&&De.x<=ue&&De.y>=te&&De.y<=ge&&De!==g&&De!==x&&Pl(T,N,I,V,z,X,De.x,De.y)&&An(De.prev,De,De.next)>=0))return!1;De=De.nextZ}for(;Te&&Te.z>=xe;){if(Te.x>=Y&&Te.x<=ue&&Te.y>=te&&Te.y<=ge&&Te!==g&&Te!==x&&Pl(T,N,I,V,z,X,Te.x,Te.y)&&An(Te.prev,Te,Te.next)>=0)return!1;Te=Te.prevZ}for(;De&&De.z<=Oe;){if(De.x>=Y&&De.x<=ue&&De.y>=te&&De.y<=ge&&De!==g&&De!==x&&Pl(T,N,I,V,z,X,De.x,De.y)&&An(De.prev,De,De.next)>=0)return!1;De=De.nextZ}return!0}function C1(s,n,c){var f=s;do{var g=f.prev,w=f.next.next;!Uh(g,w)&&am(g,f,f.next,w)&&Yc(g,w)&&Yc(w,g)&&(n.push(g.i/c|0),n.push(f.i/c|0),n.push(w.i/c|0),Qc(f),Qc(f.next),f=s=w),f=f.next}while(f!==s);return Pa(f)}function E1(s,n,c,f,g,w){var x=s;do{for(var T=x.next.next;T!==x.prev;){if(x.i!==T.i&&P1(x,T)){var I=lm(x,T);return x=Pa(x,x.next),I=Pa(I,I.next),Jc(x,n,c,f,g,w,0),void Jc(I,n,c,f,g,w,0)}T=T.next}x=x.next}while(x!==s)}function M1(s,n){return s.x-n.x}function I1(s,n){var c=function(g,w){var x,T=w,I=g.x,z=g.y,N=-1/0;do{if(z<=T.y&&z>=T.next.y&&T.next.y!==T.y){var V=T.x+(z-T.y)*(T.next.x-T.x)/(T.next.y-T.y);if(V<=I&&V>N&&(N=V,x=T.x<T.next.x?T:T.next,V===I))return x}T=T.next}while(T!==w);if(!x)return null;var X,Y=x,te=x.x,ue=x.y,ge=1/0;T=x;do I>=T.x&&T.x>=te&&I!==T.x&&Pl(z<ue?I:N,z,te,ue,z<ue?N:I,z,T.x,T.y)&&(X=Math.abs(z-T.y)/(I-T.x),Yc(T,g)&&(X<ge||X===ge&&(T.x>x.x||T.x===x.x&&L1(x,T)))&&(x=T,ge=X)),T=T.next;while(T!==Y);return x}(s,n);if(!c)return n;var f=lm(c,s);return Pa(f,f.next),Pa(c,c.next)}function L1(s,n){return An(s.prev,s,n.prev)<0&&An(n.next,s,s.next)<0}function hf(s,n,c,f,g){return(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s=(s-c)*g|0)|s<<8))|s<<4))|s<<2))|s<<1))|(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-f)*g|0)|n<<8))|n<<4))|n<<2))|n<<1))<<1}function A1(s){var n=s,c=s;do(n.x<c.x||n.x===c.x&&n.y<c.y)&&(c=n),n=n.next;while(n!==s);return c}function Pl(s,n,c,f,g,w,x,T){return(g-x)*(n-T)>=(s-x)*(w-T)&&(s-x)*(f-T)>=(c-x)*(n-T)&&(c-x)*(w-T)>=(g-x)*(f-T)}function P1(s,n){return s.next.i!==n.i&&s.prev.i!==n.i&&!function(c,f){var g=c;do{if(g.i!==c.i&&g.next.i!==c.i&&g.i!==f.i&&g.next.i!==f.i&&am(g,g.next,c,f))return!0;g=g.next}while(g!==c);return!1}(s,n)&&(Yc(s,n)&&Yc(n,s)&&function(c,f){var g=c,w=!1,x=(c.x+f.x)/2,T=(c.y+f.y)/2;do g.y>T!=g.next.y>T&&g.next.y!==g.y&&x<(g.next.x-g.x)*(T-g.y)/(g.next.y-g.y)+g.x&&(w=!w),g=g.next;while(g!==c);return w}(s,n)&&(An(s.prev,s,n.prev)||An(s,n.prev,n))||Uh(s,n)&&An(s.prev,s,s.next)>0&&An(n.prev,n,n.next)>0)}function An(s,n,c){return(n.y-s.y)*(c.x-n.x)-(n.x-s.x)*(c.y-n.y)}function Uh(s,n){return s.x===n.x&&s.y===n.y}function am(s,n,c,f){var g=$h(An(s,n,c)),w=$h(An(s,n,f)),x=$h(An(c,f,s)),T=$h(An(c,f,n));return g!==w&&x!==T||!(g!==0||!Vh(s,c,n))||!(w!==0||!Vh(s,f,n))||!(x!==0||!Vh(c,s,f))||!(T!==0||!Vh(c,n,f))}function Vh(s,n,c){return n.x<=Math.max(s.x,c.x)&&n.x>=Math.min(s.x,c.x)&&n.y<=Math.max(s.y,c.y)&&n.y>=Math.min(s.y,c.y)}function $h(s){return s>0?1:s<0?-1:0}function Yc(s,n){return An(s.prev,s,s.next)<0?An(s,n,s.next)>=0&&An(s,s.prev,n)>=0:An(s,n,s.prev)<0||An(s,s.next,n)<0}function lm(s,n){var c=new df(s.i,s.x,s.y),f=new df(n.i,n.x,n.y),g=s.next,w=n.prev;return s.next=n,n.prev=s,c.next=g,g.prev=c,f.next=c,c.prev=f,w.next=f,f.prev=w,f}function cm(s,n,c,f){var g=new df(s,n,c);return f?(g.next=f.next,g.prev=f,f.next.prev=g,f.next=g):(g.prev=g,g.next=g),g}function Qc(s){s.next.prev=s.prev,s.prev.next=s.next,s.prevZ&&(s.prevZ.nextZ=s.nextZ),s.nextZ&&(s.nextZ.prevZ=s.prevZ)}function df(s,n,c){this.i=s,this.x=n,this.y=c,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function ff(s,n,c,f){for(var g=0,w=n,x=c-f;w<c;w+=f)g+=(s[x]-s[w])*(s[w+1]+s[x+1]),x=w;return g}uf.exports=jh,uf.exports.default=jh,jh.deviation=function(s,n,c,f){var g=n&&n.length,w=Math.abs(ff(s,0,g?n[0]*c:s.length,c));if(g)for(var x=0,T=n.length;x<T;x++)w-=Math.abs(ff(s,n[x]*c,x<T-1?n[x+1]*c:s.length,c));var I=0;for(x=0;x<f.length;x+=3){var z=f[x]*c,N=f[x+1]*c,V=f[x+2]*c;I+=Math.abs((s[z]-s[V])*(s[N+1]-s[z+1])-(s[z]-s[N])*(s[V+1]-s[z+1]))}return w===0&&I===0?0:Math.abs((I-w)/w)},jh.flatten=function(s){for(var n=s[0][0].length,c={vertices:[],holes:[],dimensions:n},f=0,g=0;g<s.length;g++){for(var w=0;w<s[g].length;w++)for(var x=0;x<n;x++)c.vertices.push(s[g][w][x]);g>0&&c.holes.push(f+=s[g-1].length)}return c};var um=_(uf.exports);function z1(s,n,c,f,g){hm(s,n,c||0,f||s.length-1,g||D1)}function hm(s,n,c,f,g){for(;f>c;){if(f-c>600){var w=f-c+1,x=n-c+1,T=Math.log(w),I=.5*Math.exp(2*T/3),z=.5*Math.sqrt(T*I*(w-I)/w)*(x-w/2<0?-1:1);hm(s,n,Math.max(c,Math.floor(n-x*I/w+z)),Math.min(f,Math.floor(n+(w-x)*I/w+z)),g)}var N=s[n],V=c,X=f;for(eu(s,c,n),g(s[f],N)>0&&eu(s,c,f);V<X;){for(eu(s,V,X),V++,X--;g(s[V],N)<0;)V++;for(;g(s[X],N)>0;)X--}g(s[c],N)===0?eu(s,c,X):eu(s,++X,f),X<=n&&(c=X+1),n<=X&&(f=X-1)}}function eu(s,n,c){var f=s[n];s[n]=s[c],s[c]=f}function D1(s,n){return s<n?-1:s>n?1:0}function pf(s,n){const c=s.length;if(c<=1)return[s];const f=[];let g,w;for(let x=0;x<c;x++){const T=et(s[x]);T!==0&&(s[x].area=Math.abs(T),w===void 0&&(w=T<0),w===T<0?(g&&f.push(g),g=[s[x]]):g.push(s[x]))}if(g&&f.push(g),n>1)for(let x=0;x<f.length;x++)f[x].length<=n||(z1(f[x],n,1,f[x].length-1,R1),f[x]=f[x].slice(0,n));return f}function R1(s,n){return n.area-s.area}function mf(s,n,c){const f=c.patternDependencies;let g=!1;for(const w of n){const x=w.paint.get(`${s}-pattern`);x.isConstant()||(g=!0);const T=x.constantOr(null);T&&(g=!0,f[T.to]=!0,f[T.from]=!0)}return g}function gf(s,n,c,f,g){const w=g.patternDependencies;for(const x of n){const T=x.paint.get(`${s}-pattern`).value;if(T.kind!=="constant"){let I=T.evaluate({zoom:f-1},c,{},g.availableImages),z=T.evaluate({zoom:f},c,{},g.availableImages),N=T.evaluate({zoom:f+1},c,{},g.availableImages);I=I&&I.name?I.name:I,z=z&&z.name?z.name:z,N=N&&N.name?N.name:N,w[I]=!0,w[z]=!0,w[N]=!0,c.patterns[x.id]={min:I,mid:z,max:N}}}return c}class _f{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(c=>c.id),this.index=n.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new pe,this.indexArray=new Xe,this.indexArray2=new rt,this.programConfigurations=new mn(n.layers,n.zoom),this.segments=new yt,this.segments2=new yt,this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id)}populate(n,c,f){this.hasPattern=mf("fill",this.layers,c);const g=this.layers[0].layout.get("fill-sort-key"),w=!g.isConstant(),x=[];for(const{feature:T,id:I,index:z,sourceLayerIndex:N}of n){const V=this.layers[0]._featureFilter.needGeometry,X=ps(T,V);if(!this.layers[0]._featureFilter.filter(new an(this.zoom),X,f))continue;const Y=w?g.evaluate(X,{},f,c.availableImages):void 0,te={id:I,properties:T.properties,type:T.type,sourceLayerIndex:N,index:z,geometry:V?X.geometry:fs(T),patterns:{},sortKey:Y};x.push(te)}w&&x.sort((T,I)=>T.sortKey-I.sortKey);for(const T of x){const{geometry:I,index:z,sourceLayerIndex:N}=T;if(this.hasPattern){const V=gf("fill",this.layers,T,this.zoom,c);this.patternFeatures.push(V)}else this.addFeature(T,I,z,f,{});c.featureIndex.insert(n[z].feature,I,z,N,this.index)}}update(n,c,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,c,this.stateDependentLayers,f)}addFeatures(n,c,f){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,c,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,k1),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.indexBuffer2=n.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(n,c,f,g,w){for(const x of pf(c,500)){let T=0;for(const Y of x)T+=Y.length;const I=this.segments.prepareSegment(T,this.layoutVertexArray,this.indexArray),z=I.vertexLength,N=[],V=[];for(const Y of x){if(Y.length===0)continue;Y!==x[0]&&V.push(N.length/2);const te=this.segments2.prepareSegment(Y.length,this.layoutVertexArray,this.indexArray2),ue=te.vertexLength;this.layoutVertexArray.emplaceBack(Y[0].x,Y[0].y),this.indexArray2.emplaceBack(ue+Y.length-1,ue),N.push(Y[0].x),N.push(Y[0].y);for(let ge=1;ge<Y.length;ge++)this.layoutVertexArray.emplaceBack(Y[ge].x,Y[ge].y),this.indexArray2.emplaceBack(ue+ge-1,ue+ge),N.push(Y[ge].x),N.push(Y[ge].y);te.vertexLength+=Y.length,te.primitiveLength+=Y.length}const X=um(N,V);for(let Y=0;Y<X.length;Y+=3)this.indexArray.emplaceBack(z+X[Y],z+X[Y+1],z+X[Y+2]);I.vertexLength+=T,I.primitiveLength+=X.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,f,w,g)}}let dm,fm;Lt("FillBucket",_f,{omit:["layers","patternFeatures"]});var B1={get paint(){return fm=fm||new Sr({"fill-antialias":new $t(we.paint_fill["fill-antialias"]),"fill-opacity":new Gt(we.paint_fill["fill-opacity"]),"fill-color":new Gt(we.paint_fill["fill-color"]),"fill-outline-color":new Gt(we.paint_fill["fill-outline-color"]),"fill-translate":new $t(we.paint_fill["fill-translate"]),"fill-translate-anchor":new $t(we.paint_fill["fill-translate-anchor"]),"fill-pattern":new bl(we.paint_fill["fill-pattern"])})},get layout(){return dm=dm||new Sr({"fill-sort-key":new Gt(we.layout_fill["fill-sort-key"])})}};class F1 extends ao{constructor(n){super(n,B1)}recalculate(n,c){super.recalculate(n,c);const f=this.paint._values["fill-outline-color"];f.value.kind==="constant"&&f.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(n){return new _f(n)}queryRadius(){return Fh(this.paint.get("fill-translate"))}queryIntersectsFeature(n,c,f,g,w,x,T){return Zc(Oh(n,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),x.angle,T),g)}isTileClipped(){return!0}}const O1=Ln([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),N1=Ln([{name:"a_centroid",components:2,type:"Int16"}],4),{members:j1}=O1;var qs={},U1=v,pm=zl;function zl(s,n,c,f,g){this.properties={},this.extent=c,this.type=0,this._pbf=s,this._geometry=-1,this._keys=f,this._values=g,s.readFields(V1,this,n)}function V1(s,n,c){s==1?n.id=c.readVarint():s==2?function(f,g){for(var w=f.readVarint()+f.pos;f.pos<w;){var x=g._keys[f.readVarint()],T=g._values[f.readVarint()];g.properties[x]=T}}(c,n):s==3?n.type=c.readVarint():s==4&&(n._geometry=c.pos)}function $1(s){for(var n,c,f=0,g=0,w=s.length,x=w-1;g<w;x=g++)f+=((c=s[x]).x-(n=s[g]).x)*(n.y+c.y);return f}zl.types=["Unknown","Point","LineString","Polygon"],zl.prototype.loadGeometry=function(){var s=this._pbf;s.pos=this._geometry;for(var n,c=s.readVarint()+s.pos,f=1,g=0,w=0,x=0,T=[];s.pos<c;){if(g<=0){var I=s.readVarint();f=7&I,g=I>>3}if(g--,f===1||f===2)w+=s.readSVarint(),x+=s.readSVarint(),f===1&&(n&&T.push(n),n=[]),n.push(new U1(w,x));else{if(f!==7)throw new Error("unknown command "+f);n&&n.push(n[0].clone())}}return n&&T.push(n),T},zl.prototype.bbox=function(){var s=this._pbf;s.pos=this._geometry;for(var n=s.readVarint()+s.pos,c=1,f=0,g=0,w=0,x=1/0,T=-1/0,I=1/0,z=-1/0;s.pos<n;){if(f<=0){var N=s.readVarint();c=7&N,f=N>>3}if(f--,c===1||c===2)(g+=s.readSVarint())<x&&(x=g),g>T&&(T=g),(w+=s.readSVarint())<I&&(I=w),w>z&&(z=w);else if(c!==7)throw new Error("unknown command "+c)}return[x,I,T,z]},zl.prototype.toGeoJSON=function(s,n,c){var f,g,w=this.extent*Math.pow(2,c),x=this.extent*s,T=this.extent*n,I=this.loadGeometry(),z=zl.types[this.type];function N(Y){for(var te=0;te<Y.length;te++){var ue=Y[te];Y[te]=[360*(ue.x+x)/w-180,360/Math.PI*Math.atan(Math.exp((180-360*(ue.y+T)/w)*Math.PI/180))-90]}}switch(this.type){case 1:var V=[];for(f=0;f<I.length;f++)V[f]=I[f][0];N(I=V);break;case 2:for(f=0;f<I.length;f++)N(I[f]);break;case 3:for(I=function(Y){var te=Y.length;if(te<=1)return[Y];for(var ue,ge,xe=[],Oe=0;Oe<te;Oe++){var Te=$1(Y[Oe]);Te!==0&&(ge===void 0&&(ge=Te<0),ge===Te<0?(ue&&xe.push(ue),ue=[Y[Oe]]):ue.push(Y[Oe]))}return ue&&xe.push(ue),xe}(I),f=0;f<I.length;f++)for(g=0;g<I[f].length;g++)N(I[f][g])}I.length===1?I=I[0]:z="Multi"+z;var X={type:"Feature",geometry:{type:z,coordinates:I},properties:this.properties};return"id"in this&&(X.id=this.id),X};var q1=pm,mm=gm;function gm(s,n){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=s,this._keys=[],this._values=[],this._features=[],s.readFields(Z1,this,n),this.length=this._features.length}function Z1(s,n,c){s===15?n.version=c.readVarint():s===1?n.name=c.readString():s===5?n.extent=c.readVarint():s===2?n._features.push(c.pos):s===3?n._keys.push(c.readString()):s===4&&n._values.push(function(f){for(var g=null,w=f.readVarint()+f.pos;f.pos<w;){var x=f.readVarint()>>3;g=x===1?f.readString():x===2?f.readFloat():x===3?f.readDouble():x===4?f.readVarint64():x===5?f.readVarint():x===6?f.readSVarint():x===7?f.readBoolean():null}return g}(c))}gm.prototype.feature=function(s){if(s<0||s>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[s];var n=this._pbf.readVarint()+this._pbf.pos;return new q1(this._pbf,n,this.extent,this._keys,this._values)};var G1=mm;function W1(s,n,c){if(s===3){var f=new G1(c,c.readVarint()+c.pos);f.length&&(n[f.name]=f)}}qs.VectorTile=function(s,n){this.layers=s.readFields(W1,{},n)},qs.VectorTileFeature=pm,qs.VectorTileLayer=mm;const H1=qs.VectorTileFeature.types,yf=Math.pow(2,13);function tu(s,n,c,f,g,w,x,T){s.emplaceBack(n,c,2*Math.floor(f*yf)+x,g*yf*2,w*yf*2,Math.round(T))}class vf{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(c=>c.id),this.index=n.index,this.hasPattern=!1,this.layoutVertexArray=new fe,this.centroidVertexArray=new q,this.indexArray=new Xe,this.programConfigurations=new mn(n.layers,n.zoom),this.segments=new yt,this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id)}populate(n,c,f){this.features=[],this.hasPattern=mf("fill-extrusion",this.layers,c);for(const{feature:g,id:w,index:x,sourceLayerIndex:T}of n){const I=this.layers[0]._featureFilter.needGeometry,z=ps(g,I);if(!this.layers[0]._featureFilter.filter(new an(this.zoom),z,f))continue;const N={id:w,sourceLayerIndex:T,index:x,geometry:I?z.geometry:fs(g),properties:g.properties,type:g.type,patterns:{}};this.hasPattern?this.features.push(gf("fill-extrusion",this.layers,N,this.zoom,c)):this.addFeature(N,N.geometry,x,f,{}),c.featureIndex.insert(g,N.geometry,x,T,this.index,!0)}}addFeatures(n,c,f){for(const g of this.features){const{geometry:w}=g;this.addFeature(g,w,g.index,c,f)}}update(n,c,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,c,this.stateDependentLayers,f)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,j1),this.centroidVertexBuffer=n.createVertexBuffer(this.centroidVertexArray,N1.members,!0),this.indexBuffer=n.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(n,c,f,g,w){const x={x:0,y:0,vertexCount:0};for(const T of pf(c,500)){let I=0;for(const te of T)I+=te.length;let z=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const te of T){if(te.length===0||K1(te))continue;let ue=0;for(let ge=0;ge<te.length;ge++){const xe=te[ge];if(ge>=1){const Oe=te[ge-1];if(!X1(xe,Oe)){z.vertexLength+4>yt.MAX_VERTEX_ARRAY_LENGTH&&(z=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const Te=xe.sub(Oe)._perp()._unit(),De=Oe.dist(xe);ue+De>32768&&(ue=0),tu(this.layoutVertexArray,xe.x,xe.y,Te.x,Te.y,0,0,ue),tu(this.layoutVertexArray,xe.x,xe.y,Te.x,Te.y,0,1,ue),x.x+=2*xe.x,x.y+=2*xe.y,x.vertexCount+=2,ue+=De,tu(this.layoutVertexArray,Oe.x,Oe.y,Te.x,Te.y,0,0,ue),tu(this.layoutVertexArray,Oe.x,Oe.y,Te.x,Te.y,0,1,ue),x.x+=2*Oe.x,x.y+=2*Oe.y,x.vertexCount+=2;const Qe=z.vertexLength;this.indexArray.emplaceBack(Qe,Qe+2,Qe+1),this.indexArray.emplaceBack(Qe+1,Qe+2,Qe+3),z.vertexLength+=4,z.primitiveLength+=2}}}}if(z.vertexLength+I>yt.MAX_VERTEX_ARRAY_LENGTH&&(z=this.segments.prepareSegment(I,this.layoutVertexArray,this.indexArray)),H1[n.type]!=="Polygon")continue;const N=[],V=[],X=z.vertexLength;for(const te of T)if(te.length!==0){te!==T[0]&&V.push(N.length/2);for(let ue=0;ue<te.length;ue++){const ge=te[ue];tu(this.layoutVertexArray,ge.x,ge.y,0,0,1,1,0),x.x+=ge.x,x.y+=ge.y,x.vertexCount+=1,N.push(ge.x),N.push(ge.y)}}const Y=um(N,V);for(let te=0;te<Y.length;te+=3)this.indexArray.emplaceBack(X+Y[te],X+Y[te+2],X+Y[te+1]);z.primitiveLength+=Y.length/3,z.vertexLength+=I}for(let T=0;T<x.vertexCount;T++)this.centroidVertexArray.emplaceBack(Math.floor(x.x/x.vertexCount),Math.floor(x.y/x.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,f,w,g)}}function X1(s,n){return s.x===n.x&&(s.x<0||s.x>Sn)||s.y===n.y&&(s.y<0||s.y>Sn)}function K1(s){return s.every(n=>n.x<0)||s.every(n=>n.x>Sn)||s.every(n=>n.y<0)||s.every(n=>n.y>Sn)}let _m;Lt("FillExtrusionBucket",vf,{omit:["layers","features"]});var J1={get paint(){return _m=_m||new Sr({"fill-extrusion-opacity":new $t(we["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Gt(we["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new $t(we["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new $t(we["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new bl(we["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Gt(we["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Gt(we["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new $t(we["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class Y1 extends ao{constructor(n){super(n,J1)}createBucket(n){return new vf(n)}queryRadius(){return Fh(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(n,c,f,g,w,x,T,I){const z=Oh(n,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),x.angle,T),N=this.paint.get("fill-extrusion-height").evaluate(c,f),V=this.paint.get("fill-extrusion-base").evaluate(c,f),X=function(te,ue,ge,xe){const Oe=[];for(const Te of te){const De=[Te.x,Te.y,0,1];Nh(De,De,ue),Oe.push(new S(De[0]/De[3],De[1]/De[3]))}return Oe}(z,I),Y=function(te,ue,ge,xe){const Oe=[],Te=[],De=xe[8]*ue,Qe=xe[9]*ue,tt=xe[10]*ue,Mt=xe[11]*ue,Ft=xe[8]*ge,Et=xe[9]*ge,kt=xe[10]*ge,gt=xe[11]*ge;for(const Pt of te){const wt=[],ct=[];for(const Zt of Pt){const jt=Zt.x,_i=Zt.y,tn=xe[0]*jt+xe[4]*_i+xe[12],cn=xe[1]*jt+xe[5]*_i+xe[13],Wn=xe[2]*jt+xe[6]*_i+xe[14],Qr=xe[3]*jt+xe[7]*_i+xe[15],Cr=Wn+tt,jn=Qr+Mt,tr=tn+Ft,sr=cn+Et,Er=Wn+kt,Mr=Qr+gt,Hn=new S((tn+De)/jn,(cn+Qe)/jn);Hn.z=Cr/jn,wt.push(Hn);const Xn=new S(tr/Mr,sr/Mr);Xn.z=Er/Mr,ct.push(Xn)}Oe.push(wt),Te.push(ct)}return[Oe,Te]}(g,V,N,I);return function(te,ue,ge){let xe=1/0;Zc(ge,ue)&&(xe=ym(ge,ue[0]));for(let Oe=0;Oe<ue.length;Oe++){const Te=ue[Oe],De=te[Oe];for(let Qe=0;Qe<Te.length-1;Qe++){const tt=Te[Qe],Mt=[tt,Te[Qe+1],De[Qe+1],De[Qe],tt];qc(ge,Mt)&&(xe=Math.min(xe,ym(ge,Mt)))}}return xe!==1/0&&xe}(Y[0],Y[1],X)}}function iu(s,n){return s.x*n.x+s.y*n.y}function ym(s,n){if(s.length===1){let c=0;const f=n[c++];let g;for(;!g||f.equals(g);)if(g=n[c++],!g)return 1/0;for(;c<n.length;c++){const w=n[c],x=s[0],T=g.sub(f),I=w.sub(f),z=x.sub(f),N=iu(T,T),V=iu(T,I),X=iu(I,I),Y=iu(z,T),te=iu(z,I),ue=N*X-V*V,ge=(X*Y-V*te)/ue,xe=(N*te-V*Y)/ue,Oe=f.z*(1-ge-xe)+g.z*ge+w.z*xe;if(isFinite(Oe))return Oe}return 1/0}{let c=1/0;for(const f of n)c=Math.min(c,f.z);return c}}const Q1=Ln([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:ev}=Q1,tv=Ln([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:iv}=tv,nv=qs.VectorTileFeature.types,rv=Math.cos(Math.PI/180*37.5),vm=Math.pow(2,14)/.5;class bf{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(c=>c.id),this.index=n.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(c=>{this.gradients[c.id]={}}),this.layoutVertexArray=new _e,this.layoutVertexArray2=new ce,this.indexArray=new Xe,this.programConfigurations=new mn(n.layers,n.zoom),this.segments=new yt,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id)}populate(n,c,f){this.hasPattern=mf("line",this.layers,c);const g=this.layers[0].layout.get("line-sort-key"),w=!g.isConstant(),x=[];for(const{feature:T,id:I,index:z,sourceLayerIndex:N}of n){const V=this.layers[0]._featureFilter.needGeometry,X=ps(T,V);if(!this.layers[0]._featureFilter.filter(new an(this.zoom),X,f))continue;const Y=w?g.evaluate(X,{},f):void 0,te={id:I,properties:T.properties,type:T.type,sourceLayerIndex:N,index:z,geometry:V?X.geometry:fs(T),patterns:{},sortKey:Y};x.push(te)}w&&x.sort((T,I)=>T.sortKey-I.sortKey);for(const T of x){const{geometry:I,index:z,sourceLayerIndex:N}=T;if(this.hasPattern){const V=gf("line",this.layers,T,this.zoom,c);this.patternFeatures.push(V)}else this.addFeature(T,I,z,f,{});c.featureIndex.insert(n[z].feature,I,z,N,this.index)}}update(n,c,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,c,this.stateDependentLayers,f)}addFeatures(n,c,f){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,c,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=n.createVertexBuffer(this.layoutVertexArray2,iv)),this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,ev),this.indexBuffer=n.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(n){if(n.properties&&Object.prototype.hasOwnProperty.call(n.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(n.properties,"mapbox_clip_end"))return{start:+n.properties.mapbox_clip_start,end:+n.properties.mapbox_clip_end}}addFeature(n,c,f,g,w){const x=this.layers[0].layout,T=x.get("line-join").evaluate(n,{}),I=x.get("line-cap"),z=x.get("line-miter-limit"),N=x.get("line-round-limit");this.lineClips=this.lineFeatureClips(n);for(const V of c)this.addLine(V,n,T,I,z,N);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,f,w,g)}addLine(n,c,f,g,w,x){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let xe=0;xe<n.length-1;xe++)this.totalDistance+=n[xe].dist(n[xe+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const T=nv[c.type]==="Polygon";let I=n.length;for(;I>=2&&n[I-1].equals(n[I-2]);)I--;let z=0;for(;z<I-1&&n[z].equals(n[z+1]);)z++;if(I<(T?3:2))return;f==="bevel"&&(w=1.05);const N=this.overscaling<=16?15*Sn/(512*this.overscaling):0,V=this.segments.prepareSegment(10*I,this.layoutVertexArray,this.indexArray);let X,Y,te,ue,ge;this.e1=this.e2=-1,T&&(X=n[I-2],ge=n[z].sub(X)._unit()._perp());for(let xe=z;xe<I;xe++){if(te=xe===I-1?T?n[z+1]:void 0:n[xe+1],te&&n[xe].equals(te))continue;ge&&(ue=ge),X&&(Y=X),X=n[xe],ge=te?te.sub(X)._unit()._perp():ue,ue=ue||ge;let Oe=ue.add(ge);Oe.x===0&&Oe.y===0||Oe._unit();const Te=ue.x*ge.x+ue.y*ge.y,De=Oe.x*ge.x+Oe.y*ge.y,Qe=De!==0?1/De:1/0,tt=2*Math.sqrt(2-2*De),Mt=De<rv&&Y&&te,Ft=ue.x*ge.y-ue.y*ge.x>0;if(Mt&&xe>z){const gt=X.dist(Y);if(gt>2*N){const Pt=X.sub(X.sub(Y)._mult(N/gt)._round());this.updateDistance(Y,Pt),this.addCurrentVertex(Pt,ue,0,0,V),Y=Pt}}const Et=Y&&te;let kt=Et?f:T?"butt":g;if(Et&&kt==="round"&&(Qe<x?kt="miter":Qe<=2&&(kt="fakeround")),kt==="miter"&&Qe>w&&(kt="bevel"),kt==="bevel"&&(Qe>2&&(kt="flipbevel"),Qe<w&&(kt="miter")),Y&&this.updateDistance(Y,X),kt==="miter")Oe._mult(Qe),this.addCurrentVertex(X,Oe,0,0,V);else if(kt==="flipbevel"){if(Qe>100)Oe=ge.mult(-1);else{const gt=Qe*ue.add(ge).mag()/ue.sub(ge).mag();Oe._perp()._mult(gt*(Ft?-1:1))}this.addCurrentVertex(X,Oe,0,0,V),this.addCurrentVertex(X,Oe.mult(-1),0,0,V)}else if(kt==="bevel"||kt==="fakeround"){const gt=-Math.sqrt(Qe*Qe-1),Pt=Ft?gt:0,wt=Ft?0:gt;if(Y&&this.addCurrentVertex(X,ue,Pt,wt,V),kt==="fakeround"){const ct=Math.round(180*tt/Math.PI/20);for(let Zt=1;Zt<ct;Zt++){let jt=Zt/ct;if(jt!==.5){const tn=jt-.5;jt+=jt*tn*(jt-1)*((1.0904+Te*(Te*(3.55645-1.43519*Te)-3.2452))*tn*tn+(.848013+Te*(.215638*Te-1.06021)))}const _i=ge.sub(ue)._mult(jt)._add(ue)._unit()._mult(Ft?-1:1);this.addHalfVertex(X,_i.x,_i.y,!1,Ft,0,V)}}te&&this.addCurrentVertex(X,ge,-Pt,-wt,V)}else if(kt==="butt")this.addCurrentVertex(X,Oe,0,0,V);else if(kt==="square"){const gt=Y?1:-1;this.addCurrentVertex(X,Oe,gt,gt,V)}else kt==="round"&&(Y&&(this.addCurrentVertex(X,ue,0,0,V),this.addCurrentVertex(X,ue,1,1,V,!0)),te&&(this.addCurrentVertex(X,ge,-1,-1,V,!0),this.addCurrentVertex(X,ge,0,0,V)));if(Mt&&xe<I-1){const gt=X.dist(te);if(gt>2*N){const Pt=X.add(te.sub(X)._mult(N/gt)._round());this.updateDistance(X,Pt),this.addCurrentVertex(Pt,ge,0,0,V),X=Pt}}}}addCurrentVertex(n,c,f,g,w,x=!1){const T=c.y*g-c.x,I=-c.y-c.x*g;this.addHalfVertex(n,c.x+c.y*f,c.y-c.x*f,x,!1,f,w),this.addHalfVertex(n,T,I,x,!0,-g,w),this.distance>vm/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(n,c,f,g,w,x))}addHalfVertex({x:n,y:c},f,g,w,x,T,I){const z=.5*(this.lineClips?this.scaledDistance*(vm-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((n<<1)+(w?1:0),(c<<1)+(x?1:0),Math.round(63*f)+128,Math.round(63*g)+128,1+(T===0?0:T<0?-1:1)|(63&z)<<2,z>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const N=I.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,N),I.primitiveLength++),x?this.e2=N:this.e1=N}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(n,c){this.distance+=n.dist(c),this.updateScaledDistance()}}let bm,wm;Lt("LineBucket",bf,{omit:["layers","patternFeatures"]});var xm={get paint(){return wm=wm||new Sr({"line-opacity":new Gt(we.paint_line["line-opacity"]),"line-color":new Gt(we.paint_line["line-color"]),"line-translate":new $t(we.paint_line["line-translate"]),"line-translate-anchor":new $t(we.paint_line["line-translate-anchor"]),"line-width":new Gt(we.paint_line["line-width"]),"line-gap-width":new Gt(we.paint_line["line-gap-width"]),"line-offset":new Gt(we.paint_line["line-offset"]),"line-blur":new Gt(we.paint_line["line-blur"]),"line-dasharray":new Ta(we.paint_line["line-dasharray"]),"line-pattern":new bl(we.paint_line["line-pattern"]),"line-gradient":new Dc(we.paint_line["line-gradient"])})},get layout(){return bm=bm||new Sr({"line-cap":new $t(we.layout_line["line-cap"]),"line-join":new Gt(we.layout_line["line-join"]),"line-miter-limit":new $t(we.layout_line["line-miter-limit"]),"line-round-limit":new $t(we.layout_line["line-round-limit"]),"line-sort-key":new Gt(we.layout_line["line-sort-key"])})}};class ov extends Gt{possiblyEvaluate(n,c){return c=new an(Math.floor(c.zoom),{now:c.now,fadeDuration:c.fadeDuration,zoomHistory:c.zoomHistory,transition:c.transition}),super.possiblyEvaluate(n,c)}evaluate(n,c,f,g){return c=Z({},c,{zoom:Math.floor(c.zoom)}),super.evaluate(n,c,f,g)}}let qh;class sv extends ao{constructor(n){super(n,xm),this.gradientVersion=0,qh||(qh=new ov(xm.paint.properties["line-width"].specification),qh.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(n){if(n==="line-gradient"){const c=this.gradientExpression();this.stepInterpolant=!!function(f){return f._styleExpression!==void 0}(c)&&c._styleExpression.expression instanceof _a,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(n,c){super.recalculate(n,c),this.paint._values["line-floorwidth"]=qh.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,n)}createBucket(n){return new bf(n)}queryRadius(n){const c=n,f=km(Hc("line-width",this,c),Hc("line-gap-width",this,c)),g=Hc("line-offset",this,c);return f/2+Math.abs(g)+Fh(this.paint.get("line-translate"))}queryIntersectsFeature(n,c,f,g,w,x,T){const I=Oh(n,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),x.angle,T),z=T/2*km(this.paint.get("line-width").evaluate(c,f),this.paint.get("line-gap-width").evaluate(c,f)),N=this.paint.get("line-offset").evaluate(c,f);return N&&(g=function(V,X){const Y=[];for(let te=0;te<V.length;te++){const ue=V[te],ge=[];for(let xe=0;xe<ue.length;xe++){const Oe=ue[xe-1],Te=ue[xe],De=ue[xe+1],Qe=xe===0?new S(0,0):Te.sub(Oe)._unit()._perp(),tt=xe===ue.length-1?new S(0,0):De.sub(Te)._unit()._perp(),Mt=Qe._add(tt)._unit(),Ft=Mt.x*tt.x+Mt.y*tt.y;Ft!==0&&Mt._mult(1/Ft),ge.push(Mt._mult(X)._add(Te))}Y.push(ge)}return Y}(g,N*T)),function(V,X,Y){for(let te=0;te<X.length;te++){const ue=X[te];if(V.length>=3){for(let ge=0;ge<ue.length;ge++)if(Ll(V,ue[ge]))return!0}if(Gc(V,ue,Y))return!0}return!1}(I,g,z)}isTileClipped(){return!0}}function km(s,n){return n>0?n+2*s:s}const av=Ln([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),lv=Ln([{name:"a_projected_pos",components:3,type:"Float32"}],4);Ln([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const cv=Ln([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);Ln([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Sm=Ln([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),uv=Ln([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function hv(s,n,c){return s.sections.forEach(f=>{f.text=function(g,w,x){const T=w.layout.get("text-transform").evaluate(x,{});return T==="uppercase"?g=g.toLocaleUpperCase():T==="lowercase"&&(g=g.toLocaleLowerCase()),Jo.applyArabicShaping&&(g=Jo.applyArabicShaping(g)),g}(f.text,n,c)}),s}Ln([{name:"triangle",components:3,type:"Uint16"}]),Ln([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Ln([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Ln([{type:"Float32",name:"offsetX"}]),Ln([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Ln([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const nu={"!":"ï¸","#":"ï¼",$:"ï¼","%":"ï¼","&":"ï¼","(":"ï¸µ",")":"ï¸¶","*":"ï¼","+":"ï¼",",":"ï¸","-":"ï¸²",".":"ã»","/":"ï¼",":":"ï¸",";":"ï¸","<":"ï¸¿","=":"ï¼",">":"ï¹","?":"ï¸","@":"ï¼ ","[":"ï¹","\\":"ï¼¼","]":"ï¹","^":"ï¼¾",_:"ï¸³","`":"ï½","{":"ï¸·","|":"â","}":"ï¸¸","~":"ï½","Â¢":"ï¿ ","Â£":"ï¿¡","Â¥":"ï¿¥","Â¦":"ï¿¤","Â¬":"ï¿¢","Â¯":"ï¿£","â":"ï¸²","â":"ï¸±","â":"ï¹","â":"ï¹","â":"ï¹","â":"ï¹","â¦":"ï¸","â§":"ã»","â©":"ï¿¦","ã":"ï¸","ã":"ï¸","ã":"ï¸¿","ã":"ï¹","ã":"ï¸½","ã":"ï¸¾","ã":"ï¹","ã":"ï¹","ã":"ï¹","ã":"ï¹","ã":"ï¸»","ã":"ï¸¼","ã":"ï¸¹","ã":"ï¸º","ã":"ï¸","ã":"ï¸","ï¼":"ï¸","ï¼":"ï¸µ","ï¼":"ï¸¶","ï¼":"ï¸","ï¼":"ï¸²","ï¼":"ã»","ï¼":"ï¸","ï¼":"ï¸","ï¼":"ï¸¿","ï¼":"ï¹","ï¼":"ï¸","ï¼»":"ï¹","ï¼½":"ï¹","ï¼¿":"ï¸³","ï½":"ï¸·","ï½":"â","ï½":"ï¸¸","ï½":"ï¸µ","ï½ ":"ï¸¶","ï½¡":"ï¸","ï½¢":"ï¹","ï½£":"ï¹"};var Gn=24,Tm=Wi,Cm=function(s,n,c,f,g){var w,x,T=8*g-f-1,I=(1<<T)-1,z=I>>1,N=-7,V=c?g-1:0,X=c?-1:1,Y=s[n+V];for(V+=X,w=Y&(1<<-N)-1,Y>>=-N,N+=T;N>0;w=256*w+s[n+V],V+=X,N-=8);for(x=w&(1<<-N)-1,w>>=-N,N+=f;N>0;x=256*x+s[n+V],V+=X,N-=8);if(w===0)w=1-z;else{if(w===I)return x?NaN:1/0*(Y?-1:1);x+=Math.pow(2,f),w-=z}return(Y?-1:1)*x*Math.pow(2,w-f)},Em=function(s,n,c,f,g,w){var x,T,I,z=8*w-g-1,N=(1<<z)-1,V=N>>1,X=g===23?Math.pow(2,-24)-Math.pow(2,-77):0,Y=f?0:w-1,te=f?1:-1,ue=n<0||n===0&&1/n<0?1:0;for(n=Math.abs(n),isNaN(n)||n===1/0?(T=isNaN(n)?1:0,x=N):(x=Math.floor(Math.log(n)/Math.LN2),n*(I=Math.pow(2,-x))<1&&(x--,I*=2),(n+=x+V>=1?X/I:X*Math.pow(2,1-V))*I>=2&&(x++,I/=2),x+V>=N?(T=0,x=N):x+V>=1?(T=(n*I-1)*Math.pow(2,g),x+=V):(T=n*Math.pow(2,V-1)*Math.pow(2,g),x=0));g>=8;s[c+Y]=255&T,Y+=te,T/=256,g-=8);for(x=x<<g|T,z+=g;z>0;s[c+Y]=255&x,Y+=te,x/=256,z-=8);s[c+Y-te]|=128*ue};function Wi(s){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(s)?s:new Uint8Array(s||0),this.pos=0,this.type=0,this.length=this.buf.length}Wi.Varint=0,Wi.Fixed64=1,Wi.Bytes=2,Wi.Fixed32=5;var wf=4294967296,Mm=1/wf,Im=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function ms(s){return s.type===Wi.Bytes?s.readVarint()+s.pos:s.pos+1}function Dl(s,n,c){return c?4294967296*n+(s>>>0):4294967296*(n>>>0)+(s>>>0)}function Lm(s,n,c){var f=n<=16383?1:n<=2097151?2:n<=268435455?3:Math.floor(Math.log(n)/(7*Math.LN2));c.realloc(f);for(var g=c.pos-1;g>=s;g--)c.buf[g+f]=c.buf[g]}function dv(s,n){for(var c=0;c<s.length;c++)n.writeVarint(s[c])}function fv(s,n){for(var c=0;c<s.length;c++)n.writeSVarint(s[c])}function pv(s,n){for(var c=0;c<s.length;c++)n.writeFloat(s[c])}function mv(s,n){for(var c=0;c<s.length;c++)n.writeDouble(s[c])}function gv(s,n){for(var c=0;c<s.length;c++)n.writeBoolean(s[c])}function _v(s,n){for(var c=0;c<s.length;c++)n.writeFixed32(s[c])}function yv(s,n){for(var c=0;c<s.length;c++)n.writeSFixed32(s[c])}function vv(s,n){for(var c=0;c<s.length;c++)n.writeFixed64(s[c])}function bv(s,n){for(var c=0;c<s.length;c++)n.writeSFixed64(s[c])}function Zh(s,n){return(s[n]|s[n+1]<<8|s[n+2]<<16)+16777216*s[n+3]}function Rl(s,n,c){s[c]=n,s[c+1]=n>>>8,s[c+2]=n>>>16,s[c+3]=n>>>24}function Am(s,n){return(s[n]|s[n+1]<<8|s[n+2]<<16)+(s[n+3]<<24)}Wi.prototype={destroy:function(){this.buf=null},readFields:function(s,n,c){for(c=c||this.length;this.pos<c;){var f=this.readVarint(),g=f>>3,w=this.pos;this.type=7&f,s(g,n,this),this.pos===w&&this.skip(f)}return n},readMessage:function(s,n){return this.readFields(s,n,this.readVarint()+this.pos)},readFixed32:function(){var s=Zh(this.buf,this.pos);return this.pos+=4,s},readSFixed32:function(){var s=Am(this.buf,this.pos);return this.pos+=4,s},readFixed64:function(){var s=Zh(this.buf,this.pos)+Zh(this.buf,this.pos+4)*wf;return this.pos+=8,s},readSFixed64:function(){var s=Zh(this.buf,this.pos)+Am(this.buf,this.pos+4)*wf;return this.pos+=8,s},readFloat:function(){var s=Cm(this.buf,this.pos,!0,23,4);return this.pos+=4,s},readDouble:function(){var s=Cm(this.buf,this.pos,!0,52,8);return this.pos+=8,s},readVarint:function(s){var n,c,f=this.buf;return n=127&(c=f[this.pos++]),c<128?n:(n|=(127&(c=f[this.pos++]))<<7,c<128?n:(n|=(127&(c=f[this.pos++]))<<14,c<128?n:(n|=(127&(c=f[this.pos++]))<<21,c<128?n:function(g,w,x){var T,I,z=x.buf;if(T=(112&(I=z[x.pos++]))>>4,I<128||(T|=(127&(I=z[x.pos++]))<<3,I<128)||(T|=(127&(I=z[x.pos++]))<<10,I<128)||(T|=(127&(I=z[x.pos++]))<<17,I<128)||(T|=(127&(I=z[x.pos++]))<<24,I<128)||(T|=(1&(I=z[x.pos++]))<<31,I<128))return Dl(g,T,w);throw new Error("Expected varint not more than 10 bytes")}(n|=(15&(c=f[this.pos]))<<28,s,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var s=this.readVarint();return s%2==1?(s+1)/-2:s/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var s=this.readVarint()+this.pos,n=this.pos;return this.pos=s,s-n>=12&&Im?function(c,f,g){return Im.decode(c.subarray(f,g))}(this.buf,n,s):function(c,f,g){for(var w="",x=f;x<g;){var T,I,z,N=c[x],V=null,X=N>239?4:N>223?3:N>191?2:1;if(x+X>g)break;X===1?N<128&&(V=N):X===2?(192&(T=c[x+1]))==128&&(V=(31&N)<<6|63&T)<=127&&(V=null):X===3?(I=c[x+2],(192&(T=c[x+1]))==128&&(192&I)==128&&((V=(15&N)<<12|(63&T)<<6|63&I)<=2047||V>=55296&&V<=57343)&&(V=null)):X===4&&(I=c[x+2],z=c[x+3],(192&(T=c[x+1]))==128&&(192&I)==128&&(192&z)==128&&((V=(15&N)<<18|(63&T)<<12|(63&I)<<6|63&z)<=65535||V>=1114112)&&(V=null)),V===null?(V=65533,X=1):V>65535&&(V-=65536,w+=String.fromCharCode(V>>>10&1023|55296),V=56320|1023&V),w+=String.fromCharCode(V),x+=X}return w}(this.buf,n,s)},readBytes:function(){var s=this.readVarint()+this.pos,n=this.buf.subarray(this.pos,s);return this.pos=s,n},readPackedVarint:function(s,n){if(this.type!==Wi.Bytes)return s.push(this.readVarint(n));var c=ms(this);for(s=s||[];this.pos<c;)s.push(this.readVarint(n));return s},readPackedSVarint:function(s){if(this.type!==Wi.Bytes)return s.push(this.readSVarint());var n=ms(this);for(s=s||[];this.pos<n;)s.push(this.readSVarint());return s},readPackedBoolean:function(s){if(this.type!==Wi.Bytes)return s.push(this.readBoolean());var n=ms(this);for(s=s||[];this.pos<n;)s.push(this.readBoolean());return s},readPackedFloat:function(s){if(this.type!==Wi.Bytes)return s.push(this.readFloat());var n=ms(this);for(s=s||[];this.pos<n;)s.push(this.readFloat());return s},readPackedDouble:function(s){if(this.type!==Wi.Bytes)return s.push(this.readDouble());var n=ms(this);for(s=s||[];this.pos<n;)s.push(this.readDouble());return s},readPackedFixed32:function(s){if(this.type!==Wi.Bytes)return s.push(this.readFixed32());var n=ms(this);for(s=s||[];this.pos<n;)s.push(this.readFixed32());return s},readPackedSFixed32:function(s){if(this.type!==Wi.Bytes)return s.push(this.readSFixed32());var n=ms(this);for(s=s||[];this.pos<n;)s.push(this.readSFixed32());return s},readPackedFixed64:function(s){if(this.type!==Wi.Bytes)return s.push(this.readFixed64());var n=ms(this);for(s=s||[];this.pos<n;)s.push(this.readFixed64());return s},readPackedSFixed64:function(s){if(this.type!==Wi.Bytes)return s.push(this.readSFixed64());var n=ms(this);for(s=s||[];this.pos<n;)s.push(this.readSFixed64());return s},skip:function(s){var n=7&s;if(n===Wi.Varint)for(;this.buf[this.pos++]>127;);else if(n===Wi.Bytes)this.pos=this.readVarint()+this.pos;else if(n===Wi.Fixed32)this.pos+=4;else{if(n!==Wi.Fixed64)throw new Error("Unimplemented type: "+n);this.pos+=8}},writeTag:function(s,n){this.writeVarint(s<<3|n)},realloc:function(s){for(var n=this.length||16;n<this.pos+s;)n*=2;if(n!==this.length){var c=new Uint8Array(n);c.set(this.buf),this.buf=c,this.length=n}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(s){this.realloc(4),Rl(this.buf,s,this.pos),this.pos+=4},writeSFixed32:function(s){this.realloc(4),Rl(this.buf,s,this.pos),this.pos+=4},writeFixed64:function(s){this.realloc(8),Rl(this.buf,-1&s,this.pos),Rl(this.buf,Math.floor(s*Mm),this.pos+4),this.pos+=8},writeSFixed64:function(s){this.realloc(8),Rl(this.buf,-1&s,this.pos),Rl(this.buf,Math.floor(s*Mm),this.pos+4),this.pos+=8},writeVarint:function(s){(s=+s||0)>268435455||s<0?function(n,c){var f,g;if(n>=0?(f=n%4294967296|0,g=n/4294967296|0):(g=~(-n/4294967296),4294967295^(f=~(-n%4294967296))?f=f+1|0:(f=0,g=g+1|0)),n>=18446744073709552e3||n<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");c.realloc(10),function(w,x,T){T.buf[T.pos++]=127&w|128,w>>>=7,T.buf[T.pos++]=127&w|128,w>>>=7,T.buf[T.pos++]=127&w|128,w>>>=7,T.buf[T.pos++]=127&w|128,T.buf[T.pos]=127&(w>>>=7)}(f,0,c),function(w,x){var T=(7&w)<<4;x.buf[x.pos++]|=T|((w>>>=3)?128:0),w&&(x.buf[x.pos++]=127&w|((w>>>=7)?128:0),w&&(x.buf[x.pos++]=127&w|((w>>>=7)?128:0),w&&(x.buf[x.pos++]=127&w|((w>>>=7)?128:0),w&&(x.buf[x.pos++]=127&w|((w>>>=7)?128:0),w&&(x.buf[x.pos++]=127&w)))))}(g,c)}(s,this):(this.realloc(4),this.buf[this.pos++]=127&s|(s>127?128:0),s<=127||(this.buf[this.pos++]=127&(s>>>=7)|(s>127?128:0),s<=127||(this.buf[this.pos++]=127&(s>>>=7)|(s>127?128:0),s<=127||(this.buf[this.pos++]=s>>>7&127))))},writeSVarint:function(s){this.writeVarint(s<0?2*-s-1:2*s)},writeBoolean:function(s){this.writeVarint(!!s)},writeString:function(s){s=String(s),this.realloc(4*s.length),this.pos++;var n=this.pos;this.pos=function(f,g,w){for(var x,T,I=0;I<g.length;I++){if((x=g.charCodeAt(I))>55295&&x<57344){if(!T){x>56319||I+1===g.length?(f[w++]=239,f[w++]=191,f[w++]=189):T=x;continue}if(x<56320){f[w++]=239,f[w++]=191,f[w++]=189,T=x;continue}x=T-55296<<10|x-56320|65536,T=null}else T&&(f[w++]=239,f[w++]=191,f[w++]=189,T=null);x<128?f[w++]=x:(x<2048?f[w++]=x>>6|192:(x<65536?f[w++]=x>>12|224:(f[w++]=x>>18|240,f[w++]=x>>12&63|128),f[w++]=x>>6&63|128),f[w++]=63&x|128)}return w}(this.buf,s,this.pos);var c=this.pos-n;c>=128&&Lm(n,c,this),this.pos=n-1,this.writeVarint(c),this.pos+=c},writeFloat:function(s){this.realloc(4),Em(this.buf,s,this.pos,!0,23,4),this.pos+=4},writeDouble:function(s){this.realloc(8),Em(this.buf,s,this.pos,!0,52,8),this.pos+=8},writeBytes:function(s){var n=s.length;this.writeVarint(n),this.realloc(n);for(var c=0;c<n;c++)this.buf[this.pos++]=s[c]},writeRawMessage:function(s,n){this.pos++;var c=this.pos;s(n,this);var f=this.pos-c;f>=128&&Lm(c,f,this),this.pos=c-1,this.writeVarint(f),this.pos+=f},writeMessage:function(s,n,c){this.writeTag(s,Wi.Bytes),this.writeRawMessage(n,c)},writePackedVarint:function(s,n){n.length&&this.writeMessage(s,dv,n)},writePackedSVarint:function(s,n){n.length&&this.writeMessage(s,fv,n)},writePackedBoolean:function(s,n){n.length&&this.writeMessage(s,gv,n)},writePackedFloat:function(s,n){n.length&&this.writeMessage(s,pv,n)},writePackedDouble:function(s,n){n.length&&this.writeMessage(s,mv,n)},writePackedFixed32:function(s,n){n.length&&this.writeMessage(s,_v,n)},writePackedSFixed32:function(s,n){n.length&&this.writeMessage(s,yv,n)},writePackedFixed64:function(s,n){n.length&&this.writeMessage(s,vv,n)},writePackedSFixed64:function(s,n){n.length&&this.writeMessage(s,bv,n)},writeBytesField:function(s,n){this.writeTag(s,Wi.Bytes),this.writeBytes(n)},writeFixed32Field:function(s,n){this.writeTag(s,Wi.Fixed32),this.writeFixed32(n)},writeSFixed32Field:function(s,n){this.writeTag(s,Wi.Fixed32),this.writeSFixed32(n)},writeFixed64Field:function(s,n){this.writeTag(s,Wi.Fixed64),this.writeFixed64(n)},writeSFixed64Field:function(s,n){this.writeTag(s,Wi.Fixed64),this.writeSFixed64(n)},writeVarintField:function(s,n){this.writeTag(s,Wi.Varint),this.writeVarint(n)},writeSVarintField:function(s,n){this.writeTag(s,Wi.Varint),this.writeSVarint(n)},writeStringField:function(s,n){this.writeTag(s,Wi.Bytes),this.writeString(n)},writeFloatField:function(s,n){this.writeTag(s,Wi.Fixed32),this.writeFloat(n)},writeDoubleField:function(s,n){this.writeTag(s,Wi.Fixed64),this.writeDouble(n)},writeBooleanField:function(s,n){this.writeVarintField(s,!!n)}};var xf=_(Tm);const kf=3;function wv(s,n,c){s===1&&c.readMessage(xv,n)}function xv(s,n,c){if(s===3){const{id:f,bitmap:g,width:w,height:x,left:T,top:I,advance:z}=c.readMessage(kv,{});n.push({id:f,bitmap:new Kc({width:w+2*kf,height:x+2*kf},g),metrics:{width:w,height:x,left:T,top:I,advance:z}})}}function kv(s,n,c){s===1?n.id=c.readVarint():s===2?n.bitmap=c.readBytes():s===3?n.width=c.readVarint():s===4?n.height=c.readVarint():s===5?n.left=c.readSVarint():s===6?n.top=c.readSVarint():s===7&&(n.advance=c.readVarint())}const Pm=kf;function zm(s){let n=0,c=0;for(const x of s)n+=x.w*x.h,c=Math.max(c,x.w);s.sort((x,T)=>T.h-x.h);const f=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(n/.95)),c),h:1/0}];let g=0,w=0;for(const x of s)for(let T=f.length-1;T>=0;T--){const I=f[T];if(!(x.w>I.w||x.h>I.h)){if(x.x=I.x,x.y=I.y,w=Math.max(w,x.y+x.h),g=Math.max(g,x.x+x.w),x.w===I.w&&x.h===I.h){const z=f.pop();T<f.length&&(f[T]=z)}else x.h===I.h?(I.x+=x.w,I.w-=x.w):x.w===I.w?(I.y+=x.h,I.h-=x.h):(f.push({x:I.x+x.w,y:I.y,w:I.w-x.w,h:x.h}),I.y+=x.h,I.h-=x.h);break}}return{w:g,h:w,fill:n/(g*w)||0}}const Nr=1;class Sf{constructor(n,{pixelRatio:c,version:f,stretchX:g,stretchY:w,content:x}){this.paddedRect=n,this.pixelRatio=c,this.stretchX=g,this.stretchY=w,this.content=x,this.version=f}get tl(){return[this.paddedRect.x+Nr,this.paddedRect.y+Nr]}get br(){return[this.paddedRect.x+this.paddedRect.w-Nr,this.paddedRect.y+this.paddedRect.h-Nr]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*Nr)/this.pixelRatio,(this.paddedRect.h-2*Nr)/this.pixelRatio]}}class Dm{constructor(n,c){const f={},g={};this.haveRenderCallbacks=[];const w=[];this.addImages(n,f,w),this.addImages(c,g,w);const{w:x,h:T}=zm(w),I=new lo({width:x||1,height:T||1});for(const z in n){const N=n[z],V=f[z].paddedRect;lo.copy(N.data,I,{x:0,y:0},{x:V.x+Nr,y:V.y+Nr},N.data)}for(const z in c){const N=c[z],V=g[z].paddedRect,X=V.x+Nr,Y=V.y+Nr,te=N.data.width,ue=N.data.height;lo.copy(N.data,I,{x:0,y:0},{x:X,y:Y},N.data),lo.copy(N.data,I,{x:0,y:ue-1},{x:X,y:Y-1},{width:te,height:1}),lo.copy(N.data,I,{x:0,y:0},{x:X,y:Y+ue},{width:te,height:1}),lo.copy(N.data,I,{x:te-1,y:0},{x:X-1,y:Y},{width:1,height:ue}),lo.copy(N.data,I,{x:0,y:0},{x:X+te,y:Y},{width:1,height:ue})}this.image=I,this.iconPositions=f,this.patternPositions=g}addImages(n,c,f){for(const g in n){const w=n[g],x={x:0,y:0,w:w.data.width+2*Nr,h:w.data.height+2*Nr};f.push(x),c[g]=new Sf(x,w),w.hasRenderCallback&&this.haveRenderCallbacks.push(g)}}patchUpdatedImages(n,c){n.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const f in n.updatedImages)this.patchUpdatedImage(this.iconPositions[f],n.getImage(f),c),this.patchUpdatedImage(this.patternPositions[f],n.getImage(f),c)}patchUpdatedImage(n,c,f){if(!n||!c||n.version===c.version)return;n.version=c.version;const[g,w]=n.tl;f.update(c.data,void 0,{x:g,y:w})}}var Zs;Lt("ImagePosition",Sf),Lt("ImageAtlas",Dm),d.ah=void 0,(Zs=d.ah||(d.ah={}))[Zs.none=0]="none",Zs[Zs.horizontal=1]="horizontal",Zs[Zs.vertical=2]="vertical",Zs[Zs.horizontalOnly=3]="horizontalOnly";const ru=-17;class ou{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(n,c){const f=new ou;return f.scale=n||1,f.fontStack=c,f}static forImage(n){const c=new ou;return c.imageName=n,c}}class Bl{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(n,c){const f=new Bl;for(let g=0;g<n.sections.length;g++){const w=n.sections[g];w.image?f.addImageSection(w):f.addTextSection(w,c)}return f}length(){return this.text.length}getSection(n){return this.sections[this.sectionIndex[n]]}getSectionIndex(n){return this.sectionIndex[n]}getCharCode(n){return this.text.charCodeAt(n)}verticalizePunctuation(){this.text=function(n){let c="";for(let f=0;f<n.length;f++){const g=n.charCodeAt(f+1)||null,w=n.charCodeAt(f-1)||null;c+=g&&Pc(g)&&!nu[n[f+1]]||w&&Pc(w)&&!nu[n[f-1]]||!nu[n[f]]?n[f]:nu[n[f]]}return c}(this.text)}trim(){let n=0;for(let f=0;f<this.text.length&&Wh[this.text.charCodeAt(f)];f++)n++;let c=this.text.length;for(let f=this.text.length-1;f>=0&&f>=n&&Wh[this.text.charCodeAt(f)];f--)c--;this.text=this.text.substring(n,c),this.sectionIndex=this.sectionIndex.slice(n,c)}substring(n,c){const f=new Bl;return f.text=this.text.substring(n,c),f.sectionIndex=this.sectionIndex.slice(n,c),f.sections=this.sections,f}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((n,c)=>Math.max(n,this.sections[c].scale),0)}addTextSection(n,c){this.text+=n.text,this.sections.push(ou.forText(n.scale,n.fontStack||c));const f=this.sections.length-1;for(let g=0;g<n.text.length;++g)this.sectionIndex.push(f)}addImageSection(n){const c=n.image?n.image.name:"";if(c.length===0)return void Ke("Can't add FormattedSection with an empty image.");const f=this.getNextImageSectionCharCode();f?(this.text+=String.fromCharCode(f),this.sections.push(ou.forImage(c)),this.sectionIndex.push(this.sections.length-1)):Ke("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Gh(s,n,c,f,g,w,x,T,I,z,N,V,X,Y,te,ue){const ge=Bl.fromFeature(s,g);let xe;V===d.ah.vertical&&ge.verticalizePunctuation();const{processBidirectionalText:Oe,processStyledBidirectionalText:Te}=Jo;if(Oe&&ge.sections.length===1){xe=[];const tt=Oe(ge.toString(),Tf(ge,z,w,n,f,Y,te));for(const Mt of tt){const Ft=new Bl;Ft.text=Mt,Ft.sections=ge.sections;for(let Et=0;Et<Mt.length;Et++)Ft.sectionIndex.push(0);xe.push(Ft)}}else if(Te){xe=[];const tt=Te(ge.text,ge.sectionIndex,Tf(ge,z,w,n,f,Y,te));for(const Mt of tt){const Ft=new Bl;Ft.text=Mt[0],Ft.sectionIndex=Mt[1],Ft.sections=ge.sections,xe.push(Ft)}}else xe=function(tt,Mt){const Ft=[],Et=tt.text;let kt=0;for(const gt of Mt)Ft.push(tt.substring(kt,gt)),kt=gt;return kt<Et.length&&Ft.push(tt.substring(kt,Et.length)),Ft}(ge,Tf(ge,z,w,n,f,Y,te));const De=[],Qe={positionedLines:De,text:ge.toString(),top:N[1],bottom:N[1],left:N[0],right:N[0],writingMode:V,iconsInText:!1,verticalizable:!1};return function(tt,Mt,Ft,Et,kt,gt,Pt,wt,ct,Zt,jt,_i){let tn=0,cn=ru,Wn=0,Qr=0;const Cr=wt==="right"?1:wt==="left"?0:.5;let jn=0;for(const Hn of kt){Hn.trim();const Xn=Hn.getMaxScale(),pr=(Xn-1)*Gn,Ir={positionedGlyphs:[],lineOffset:0};tt.positionedLines[jn]=Ir;const mr=Ir.positionedGlyphs;let jr=0;if(!Hn.length()){cn+=gt,++jn;continue}for(let Kn=0;Kn<Hn.length();Kn++){const xi=Hn.getSection(Kn),gr=Hn.getSectionIndex(Kn),ar=Hn.getCharCode(Kn);let Jn=0,ko=null,Ro=null,Bo=null,gs=Gn;const So=!(ct===d.ah.horizontal||!jt&&!_l(ar)||jt&&(Wh[ar]||(tr=ar,Ct.Arabic(tr)||Ct["Arabic Supplement"](tr)||Ct["Arabic Extended-A"](tr)||Ct["Arabic Presentation Forms-A"](tr)||Ct["Arabic Presentation Forms-B"](tr))));if(xi.imageName){const uo=Et[xi.imageName];if(!uo)continue;Bo=xi.imageName,tt.iconsInText=tt.iconsInText||!0,Ro=uo.paddedRect;const Vr=uo.displaySize;xi.scale=xi.scale*Gn/_i,ko={width:Vr[0],height:Vr[1],left:Nr,top:-Pm,advance:So?Vr[1]:Vr[0]},Jn=pr+(Gn-Vr[1]*xi.scale),gs=ko.advance;const _s=So?Vr[0]*xi.scale-Gn*Xn:Vr[1]*xi.scale-Gn*Xn;_s>0&&_s>jr&&(jr=_s)}else{const uo=Ft[xi.fontStack],Vr=uo&&uo[ar];if(Vr&&Vr.rect)Ro=Vr.rect,ko=Vr.metrics;else{const _s=Mt[xi.fontStack],uu=_s&&_s[ar];if(!uu)continue;ko=uu.metrics}Jn=(Xn-xi.scale)*Gn}So?(tt.verticalizable=!0,mr.push({glyph:ar,imageName:Bo,x:tn,y:cn+Jn,vertical:So,scale:xi.scale,fontStack:xi.fontStack,sectionIndex:gr,metrics:ko,rect:Ro}),tn+=gs*xi.scale+Zt):(mr.push({glyph:ar,imageName:Bo,x:tn,y:cn+Jn,vertical:So,scale:xi.scale,fontStack:xi.fontStack,sectionIndex:gr,metrics:ko,rect:Ro}),tn+=ko.advance*xi.scale+Zt)}mr.length!==0&&(Wn=Math.max(tn-Zt,Wn),Cv(mr,0,mr.length-1,Cr,jr)),tn=0;const Ur=gt*Xn+jr;Ir.lineOffset=Math.max(jr,pr),cn+=Ur,Qr=Math.max(Ur,Qr),++jn}var tr;const sr=cn-ru,{horizontalAlign:Er,verticalAlign:Mr}=Cf(Pt);(function(Hn,Xn,pr,Ir,mr,jr,Ur,Kn,xi){const gr=(Xn-pr)*mr;let ar=0;ar=jr!==Ur?-Kn*Ir-ru:(-Ir*xi+.5)*Ur;for(const Jn of Hn)for(const ko of Jn.positionedGlyphs)ko.x+=gr,ko.y+=ar})(tt.positionedLines,Cr,Er,Mr,Wn,Qr,gt,sr,kt.length),tt.top+=-Mr*sr,tt.bottom=tt.top+sr,tt.left+=-Er*Wn,tt.right=tt.left+Wn}(Qe,n,c,f,xe,x,T,I,V,z,X,ue),!function(tt){for(const Mt of tt)if(Mt.positionedGlyphs.length!==0)return!1;return!0}(De)&&Qe}const Wh={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Sv={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Rm(s,n,c,f,g,w){if(n.imageName){const x=f[n.imageName];return x?x.displaySize[0]*n.scale*Gn/w+g:0}{const x=c[n.fontStack],T=x&&x[s];return T?T.metrics.advance*n.scale+g:0}}function Bm(s,n,c,f){const g=Math.pow(s-n,2);return f?s<n?g/2:2*g:g+Math.abs(c)*c}function Tv(s,n,c){let f=0;return s===10&&(f-=1e4),c&&(f+=150),s!==40&&s!==65288||(f+=50),n!==41&&n!==65289||(f+=50),f}function Fm(s,n,c,f,g,w){let x=null,T=Bm(n,c,g,w);for(const I of f){const z=Bm(n-I.x,c,g,w)+I.badness;z<=T&&(x=I,T=z)}return{index:s,x:n,priorBreak:x,badness:T}}function Om(s){return s?Om(s.priorBreak).concat(s.index):[]}function Tf(s,n,c,f,g,w,x){if(w!=="point")return[];if(!s)return[];const T=[],I=function(X,Y,te,ue,ge,xe){let Oe=0;for(let Te=0;Te<X.length();Te++){const De=X.getSection(Te);Oe+=Rm(X.getCharCode(Te),De,ue,ge,Y,xe)}return Oe/Math.max(1,Math.ceil(Oe/te))}(s,n,c,f,g,x),z=s.text.indexOf("â")>=0;let N=0;for(let X=0;X<s.length();X++){const Y=s.getSection(X),te=s.getCharCode(X);if(Wh[te]||(N+=Rm(te,Y,f,g,n,x)),X<s.length()-1){const ue=!((V=te)<11904||!(Ct["Bopomofo Extended"](V)||Ct.Bopomofo(V)||Ct["CJK Compatibility Forms"](V)||Ct["CJK Compatibility Ideographs"](V)||Ct["CJK Compatibility"](V)||Ct["CJK Radicals Supplement"](V)||Ct["CJK Strokes"](V)||Ct["CJK Symbols and Punctuation"](V)||Ct["CJK Unified Ideographs Extension A"](V)||Ct["CJK Unified Ideographs"](V)||Ct["Enclosed CJK Letters and Months"](V)||Ct["Halfwidth and Fullwidth Forms"](V)||Ct.Hiragana(V)||Ct["Ideographic Description Characters"](V)||Ct["Kangxi Radicals"](V)||Ct["Katakana Phonetic Extensions"](V)||Ct.Katakana(V)||Ct["Vertical Forms"](V)||Ct["Yi Radicals"](V)||Ct["Yi Syllables"](V)));(Sv[te]||ue||Y.imageName)&&T.push(Fm(X+1,N,I,T,Tv(te,s.getCharCode(X+1),ue&&z),!1))}}var V;return Om(Fm(s.length(),N,I,T,0,!0))}function Cf(s){let n=.5,c=.5;switch(s){case"right":case"top-right":case"bottom-right":n=1;break;case"left":case"top-left":case"bottom-left":n=0}switch(s){case"bottom":case"bottom-right":case"bottom-left":c=1;break;case"top":case"top-right":case"top-left":c=0}return{horizontalAlign:n,verticalAlign:c}}function Cv(s,n,c,f,g){if(!f&&!g)return;const w=s[c],x=(s[c].x+w.metrics.advance*w.scale)*f;for(let T=n;T<=c;T++)s[T].x-=x,s[T].y+=g}function Ev(s,n,c){const{horizontalAlign:f,verticalAlign:g}=Cf(c),w=n[0]-s.displaySize[0]*f,x=n[1]-s.displaySize[1]*g;return{image:s,top:x,bottom:x+s.displaySize[1],left:w,right:w+s.displaySize[0]}}function Nm(s,n,c,f,g,w){const x=s.image;let T;if(x.content){const ge=x.content,xe=x.pixelRatio||1;T=[ge[0]/xe,ge[1]/xe,x.displaySize[0]-ge[2]/xe,x.displaySize[1]-ge[3]/xe]}const I=n.left*w,z=n.right*w;let N,V,X,Y;c==="width"||c==="both"?(Y=g[0]+I-f[3],V=g[0]+z+f[1]):(Y=g[0]+(I+z-x.displaySize[0])/2,V=Y+x.displaySize[0]);const te=n.top*w,ue=n.bottom*w;return c==="height"||c==="both"?(N=g[1]+te-f[0],X=g[1]+ue+f[2]):(N=g[1]+(te+ue-x.displaySize[1])/2,X=N+x.displaySize[1]),{image:x,top:N,right:V,bottom:X,left:Y,collisionPadding:T}}const su=255,ts=128,Gs=su*ts;function jm(s,n){const{expression:c}=n;if(c.kind==="constant")return{kind:"constant",layoutSize:c.evaluate(new an(s+1))};if(c.kind==="source")return{kind:"source"};{const{zoomStops:f,interpolationType:g}=c;let w=0;for(;w<f.length&&f[w]<=s;)w++;w=Math.max(0,w-1);let x=w;for(;x<f.length&&f[x]<s+1;)x++;x=Math.min(f.length-1,x);const T=f[w],I=f[x];return c.kind==="composite"?{kind:"composite",minZoom:T,maxZoom:I,interpolationType:g}:{kind:"camera",minZoom:T,maxZoom:I,minSize:c.evaluate(new an(T)),maxSize:c.evaluate(new an(I)),interpolationType:g}}}function Ef(s,n,c){let f="never";const g=s.get(n);return g?f=g:s.get(c)&&(f="always"),f}const Mv=qs.VectorTileFeature.types,Iv=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Hh(s,n,c,f,g,w,x,T,I,z,N,V,X){const Y=T?Math.min(Gs,Math.round(T[0])):0,te=T?Math.min(Gs,Math.round(T[1])):0;s.emplaceBack(n,c,Math.round(32*f),Math.round(32*g),w,x,(Y<<1)+(I?1:0),te,16*z,16*N,256*V,256*X)}function Mf(s,n,c){s.emplaceBack(n.x,n.y,c),s.emplaceBack(n.x,n.y,c),s.emplaceBack(n.x,n.y,c),s.emplaceBack(n.x,n.y,c)}function Lv(s){for(const n of s.sections)if(of(n.text))return!0;return!1}class If{constructor(n){this.layoutVertexArray=new Ze,this.indexArray=new Xe,this.programConfigurations=n,this.segments=new yt,this.dynamicLayoutVertexArray=new be,this.opacityVertexArray=new Re,this.hasVisibleVertices=!1,this.placedSymbolArray=new h}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(n,c,f,g){this.isEmpty()||(f&&(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,av.members),this.indexBuffer=n.createIndexBuffer(this.indexArray,c),this.dynamicLayoutVertexBuffer=n.createVertexBuffer(this.dynamicLayoutVertexArray,lv.members,!0),this.opacityVertexBuffer=n.createVertexBuffer(this.opacityVertexArray,Iv,!0),this.opacityVertexBuffer.itemSize=1),(f||g)&&this.programConfigurations.upload(n))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Lt("SymbolBuffers",If);class Lf{constructor(n,c,f){this.layoutVertexArray=new n,this.layoutAttributes=c,this.indexArray=new f,this.segments=new yt,this.collisionVertexArray=new He}upload(n){this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=n.createVertexBuffer(this.collisionVertexArray,cv.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Lt("CollisionBuffers",Lf);class Fl{constructor(n){this.collisionBoxArray=n.collisionBoxArray,this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(x=>x.id),this.index=n.index,this.pixelRatio=n.pixelRatio,this.sourceLayerIndex=n.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=af([]),this.placementViewportMatrix=af([]);const c=this.layers[0]._unevaluatedLayout._values;this.textSizeData=jm(this.zoom,c["text-size"]),this.iconSizeData=jm(this.zoom,c["icon-size"]);const f=this.layers[0].layout,g=f.get("symbol-sort-key"),w=f.get("symbol-z-order");this.canOverlap=Ef(f,"text-overlap","text-allow-overlap")!=="never"||Ef(f,"icon-overlap","icon-allow-overlap")!=="never"||f.get("text-ignore-placement")||f.get("icon-ignore-placement"),this.sortFeaturesByKey=w!=="viewport-y"&&!g.isConstant(),this.sortFeaturesByY=(w==="viewport-y"||w==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,f.get("symbol-placement")==="point"&&(this.writingModes=f.get("text-writing-mode").map(x=>d.ah[x])),this.stateDependentLayerIds=this.layers.filter(x=>x.isStateDependent()).map(x=>x.id),this.sourceID=n.sourceID}createArrays(){this.text=new If(new mn(this.layers,this.zoom,n=>/^text/.test(n))),this.icon=new If(new mn(this.layers,this.zoom,n=>/^icon/.test(n))),this.glyphOffsetArray=new b,this.lineVertexArray=new C,this.symbolInstances=new m,this.textAnchorOffsets=new L}calculateGlyphDependencies(n,c,f,g,w){for(let x=0;x<n.length;x++)if(c[n.charCodeAt(x)]=!0,(f||g)&&w){const T=nu[n.charAt(x)];T&&(c[T.charCodeAt(0)]=!0)}}populate(n,c,f){const g=this.layers[0],w=g.layout,x=w.get("text-font"),T=w.get("text-field"),I=w.get("icon-image"),z=(T.value.kind!=="constant"||T.value.value instanceof Dr&&!T.value.value.isEmpty()||T.value.value.toString().length>0)&&(x.value.kind!=="constant"||x.value.value.length>0),N=I.value.kind!=="constant"||!!I.value.value||Object.keys(I.parameters).length>0,V=w.get("symbol-sort-key");if(this.features=[],!z&&!N)return;const X=c.iconDependencies,Y=c.glyphDependencies,te=c.availableImages,ue=new an(this.zoom);for(const{feature:ge,id:xe,index:Oe,sourceLayerIndex:Te}of n){const De=g._featureFilter.needGeometry,Qe=ps(ge,De);if(!g._featureFilter.filter(ue,Qe,f))continue;let tt,Mt;if(De||(Qe.geometry=fs(ge)),z){const Et=g.getValueAndResolveTokens("text-field",Qe,f,te),kt=Dr.factory(Et),gt=this.hasRTLText=this.hasRTLText||Lv(kt);(!gt||Jo.getRTLTextPluginStatus()==="unavailable"||gt&&Jo.isParsed())&&(tt=hv(kt,g,Qe))}if(N){const Et=g.getValueAndResolveTokens("icon-image",Qe,f,te);Mt=Et instanceof Kr?Et:Kr.fromString(Et)}if(!tt&&!Mt)continue;const Ft=this.sortFeaturesByKey?V.evaluate(Qe,{},f):void 0;if(this.features.push({id:xe,text:tt,icon:Mt,index:Oe,sourceLayerIndex:Te,geometry:Qe.geometry,properties:ge.properties,type:Mv[ge.type],sortKey:Ft}),Mt&&(X[Mt.name]=!0),tt){const Et=x.evaluate(Qe,{},f).join(","),kt=w.get("text-rotation-alignment")!=="viewport"&&w.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(d.ah.vertical)>=0;for(const gt of tt.sections)if(gt.image)X[gt.image.name]=!0;else{const Pt=Vs(tt.toString()),wt=gt.fontStack||Et,ct=Y[wt]=Y[wt]||{};this.calculateGlyphDependencies(gt.text,ct,kt,this.allowVerticalPlacement,Pt)}}}w.get("symbol-placement")==="line"&&(this.features=function(ge){const xe={},Oe={},Te=[];let De=0;function Qe(Et){Te.push(ge[Et]),De++}function tt(Et,kt,gt){const Pt=Oe[Et];return delete Oe[Et],Oe[kt]=Pt,Te[Pt].geometry[0].pop(),Te[Pt].geometry[0]=Te[Pt].geometry[0].concat(gt[0]),Pt}function Mt(Et,kt,gt){const Pt=xe[kt];return delete xe[kt],xe[Et]=Pt,Te[Pt].geometry[0].shift(),Te[Pt].geometry[0]=gt[0].concat(Te[Pt].geometry[0]),Pt}function Ft(Et,kt,gt){const Pt=gt?kt[0][kt[0].length-1]:kt[0][0];return`${Et}:${Pt.x}:${Pt.y}`}for(let Et=0;Et<ge.length;Et++){const kt=ge[Et],gt=kt.geometry,Pt=kt.text?kt.text.toString():null;if(!Pt){Qe(Et);continue}const wt=Ft(Pt,gt),ct=Ft(Pt,gt,!0);if(wt in Oe&&ct in xe&&Oe[wt]!==xe[ct]){const Zt=Mt(wt,ct,gt),jt=tt(wt,ct,Te[Zt].geometry);delete xe[wt],delete Oe[ct],Oe[Ft(Pt,Te[jt].geometry,!0)]=jt,Te[Zt].geometry=null}else wt in Oe?tt(wt,ct,gt):ct in xe?Mt(wt,ct,gt):(Qe(Et),xe[wt]=De-1,Oe[ct]=De-1)}return Te.filter(Et=>Et.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((ge,xe)=>ge.sortKey-xe.sortKey)}update(n,c,f){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(n,c,this.layers,f),this.icon.programConfigurations.updatePaintArrays(n,c,this.layers,f))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(n){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(n),this.iconCollisionBox.upload(n)),this.text.upload(n,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(n,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(n,c){const f=this.lineVertexArray.length;if(n.segment!==void 0){let g=n.dist(c[n.segment+1]),w=n.dist(c[n.segment]);const x={};for(let T=n.segment+1;T<c.length;T++)x[T]={x:c[T].x,y:c[T].y,tileUnitDistanceFromAnchor:g},T<c.length-1&&(g+=c[T+1].dist(c[T]));for(let T=n.segment||0;T>=0;T--)x[T]={x:c[T].x,y:c[T].y,tileUnitDistanceFromAnchor:w},T>0&&(w+=c[T-1].dist(c[T]));for(let T=0;T<c.length;T++){const I=x[T];this.lineVertexArray.emplaceBack(I.x,I.y,I.tileUnitDistanceFromAnchor)}}return{lineStartIndex:f,lineLength:this.lineVertexArray.length-f}}addSymbols(n,c,f,g,w,x,T,I,z,N,V,X){const Y=n.indexArray,te=n.layoutVertexArray,ue=n.segments.prepareSegment(4*c.length,te,Y,this.canOverlap?x.sortKey:void 0),ge=this.glyphOffsetArray.length,xe=ue.vertexLength,Oe=this.allowVerticalPlacement&&T===d.ah.vertical?Math.PI/2:0,Te=x.text&&x.text.sections;for(let De=0;De<c.length;De++){const{tl:Qe,tr:tt,bl:Mt,br:Ft,tex:Et,pixelOffsetTL:kt,pixelOffsetBR:gt,minFontScaleX:Pt,minFontScaleY:wt,glyphOffset:ct,isSDF:Zt,sectionIndex:jt}=c[De],_i=ue.vertexLength,tn=ct[1];Hh(te,I.x,I.y,Qe.x,tn+Qe.y,Et.x,Et.y,f,Zt,kt.x,kt.y,Pt,wt),Hh(te,I.x,I.y,tt.x,tn+tt.y,Et.x+Et.w,Et.y,f,Zt,gt.x,kt.y,Pt,wt),Hh(te,I.x,I.y,Mt.x,tn+Mt.y,Et.x,Et.y+Et.h,f,Zt,kt.x,gt.y,Pt,wt),Hh(te,I.x,I.y,Ft.x,tn+Ft.y,Et.x+Et.w,Et.y+Et.h,f,Zt,gt.x,gt.y,Pt,wt),Mf(n.dynamicLayoutVertexArray,I,Oe),Y.emplaceBack(_i,_i+1,_i+2),Y.emplaceBack(_i+1,_i+2,_i+3),ue.vertexLength+=4,ue.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(ct[0]),De!==c.length-1&&jt===c[De+1].sectionIndex||n.programConfigurations.populatePaintArrays(te.length,x,x.index,{},X,Te&&Te[jt])}n.placedSymbolArray.emplaceBack(I.x,I.y,ge,this.glyphOffsetArray.length-ge,xe,z,N,I.segment,f?f[0]:0,f?f[1]:0,g[0],g[1],T,0,!1,0,V)}_addCollisionDebugVertex(n,c,f,g,w,x){return c.emplaceBack(0,0),n.emplaceBack(f.x,f.y,g,w,Math.round(x.x),Math.round(x.y))}addCollisionDebugVertices(n,c,f,g,w,x,T){const I=w.segments.prepareSegment(4,w.layoutVertexArray,w.indexArray),z=I.vertexLength,N=w.layoutVertexArray,V=w.collisionVertexArray,X=T.anchorX,Y=T.anchorY;this._addCollisionDebugVertex(N,V,x,X,Y,new S(n,c)),this._addCollisionDebugVertex(N,V,x,X,Y,new S(f,c)),this._addCollisionDebugVertex(N,V,x,X,Y,new S(f,g)),this._addCollisionDebugVertex(N,V,x,X,Y,new S(n,g)),I.vertexLength+=4;const te=w.indexArray;te.emplaceBack(z,z+1),te.emplaceBack(z+1,z+2),te.emplaceBack(z+2,z+3),te.emplaceBack(z+3,z),I.primitiveLength+=4}addDebugCollisionBoxes(n,c,f,g){for(let w=n;w<c;w++){const x=this.collisionBoxArray.get(w);this.addCollisionDebugVertices(x.x1,x.y1,x.x2,x.y2,g?this.textCollisionBox:this.iconCollisionBox,x.anchorPoint,f)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Lf(We,Sm.members,rt),this.iconCollisionBox=new Lf(We,Sm.members,rt);for(let n=0;n<this.symbolInstances.length;n++){const c=this.symbolInstances.get(n);this.addDebugCollisionBoxes(c.textBoxStartIndex,c.textBoxEndIndex,c,!0),this.addDebugCollisionBoxes(c.verticalTextBoxStartIndex,c.verticalTextBoxEndIndex,c,!0),this.addDebugCollisionBoxes(c.iconBoxStartIndex,c.iconBoxEndIndex,c,!1),this.addDebugCollisionBoxes(c.verticalIconBoxStartIndex,c.verticalIconBoxEndIndex,c,!1)}}_deserializeCollisionBoxesForSymbol(n,c,f,g,w,x,T,I,z){const N={};for(let V=c;V<f;V++){const X=n.get(V);N.textBox={x1:X.x1,y1:X.y1,x2:X.x2,y2:X.y2,anchorPointX:X.anchorPointX,anchorPointY:X.anchorPointY},N.textFeatureIndex=X.featureIndex;break}for(let V=g;V<w;V++){const X=n.get(V);N.verticalTextBox={x1:X.x1,y1:X.y1,x2:X.x2,y2:X.y2,anchorPointX:X.anchorPointX,anchorPointY:X.anchorPointY},N.verticalTextFeatureIndex=X.featureIndex;break}for(let V=x;V<T;V++){const X=n.get(V);N.iconBox={x1:X.x1,y1:X.y1,x2:X.x2,y2:X.y2,anchorPointX:X.anchorPointX,anchorPointY:X.anchorPointY},N.iconFeatureIndex=X.featureIndex;break}for(let V=I;V<z;V++){const X=n.get(V);N.verticalIconBox={x1:X.x1,y1:X.y1,x2:X.x2,y2:X.y2,anchorPointX:X.anchorPointX,anchorPointY:X.anchorPointY},N.verticalIconFeatureIndex=X.featureIndex;break}return N}deserializeCollisionBoxes(n){this.collisionArrays=[];for(let c=0;c<this.symbolInstances.length;c++){const f=this.symbolInstances.get(c);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(n,f.textBoxStartIndex,f.textBoxEndIndex,f.verticalTextBoxStartIndex,f.verticalTextBoxEndIndex,f.iconBoxStartIndex,f.iconBoxEndIndex,f.verticalIconBoxStartIndex,f.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(n,c){const f=n.placedSymbolArray.get(c),g=f.vertexStartIndex+4*f.numGlyphs;for(let w=f.vertexStartIndex;w<g;w+=4)n.indexArray.emplaceBack(w,w+1,w+2),n.indexArray.emplaceBack(w+1,w+2,w+3)}getSortedSymbolIndexes(n){if(this.sortedAngle===n&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const c=Math.sin(n),f=Math.cos(n),g=[],w=[],x=[];for(let T=0;T<this.symbolInstances.length;++T){x.push(T);const I=this.symbolInstances.get(T);g.push(0|Math.round(c*I.anchorX+f*I.anchorY)),w.push(I.featureIndex)}return x.sort((T,I)=>g[T]-g[I]||w[I]-w[T]),x}addToSortKeyRanges(n,c){const f=this.sortKeyRanges[this.sortKeyRanges.length-1];f&&f.sortKey===c?f.symbolInstanceEnd=n+1:this.sortKeyRanges.push({sortKey:c,symbolInstanceStart:n,symbolInstanceEnd:n+1})}sortFeatures(n){if(this.sortFeaturesByY&&this.sortedAngle!==n&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(n),this.sortedAngle=n,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const c of this.symbolInstanceIndexes){const f=this.symbolInstances.get(c);this.featureSortOrder.push(f.featureIndex),[f.rightJustifiedTextSymbolIndex,f.centerJustifiedTextSymbolIndex,f.leftJustifiedTextSymbolIndex].forEach((g,w,x)=>{g>=0&&x.indexOf(g)===w&&this.addIndicesForPlacedSymbol(this.text,g)}),f.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,f.verticalPlacedTextSymbolIndex),f.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,f.placedIconSymbolIndex),f.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,f.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let Um,Vm;Lt("SymbolBucket",Fl,{omit:["layers","collisionBoxArray","features","compareText"]}),Fl.MAX_GLYPHS=65535,Fl.addDynamicAttributes=Mf;var Af={get paint(){return Vm=Vm||new Sr({"icon-opacity":new Gt(we.paint_symbol["icon-opacity"]),"icon-color":new Gt(we.paint_symbol["icon-color"]),"icon-halo-color":new Gt(we.paint_symbol["icon-halo-color"]),"icon-halo-width":new Gt(we.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Gt(we.paint_symbol["icon-halo-blur"]),"icon-translate":new $t(we.paint_symbol["icon-translate"]),"icon-translate-anchor":new $t(we.paint_symbol["icon-translate-anchor"]),"text-opacity":new Gt(we.paint_symbol["text-opacity"]),"text-color":new Gt(we.paint_symbol["text-color"],{runtimeType:Ki,getOverride:s=>s.textColor,hasOverride:s=>!!s.textColor}),"text-halo-color":new Gt(we.paint_symbol["text-halo-color"]),"text-halo-width":new Gt(we.paint_symbol["text-halo-width"]),"text-halo-blur":new Gt(we.paint_symbol["text-halo-blur"]),"text-translate":new $t(we.paint_symbol["text-translate"]),"text-translate-anchor":new $t(we.paint_symbol["text-translate-anchor"])})},get layout(){return Um=Um||new Sr({"symbol-placement":new $t(we.layout_symbol["symbol-placement"]),"symbol-spacing":new $t(we.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new $t(we.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Gt(we.layout_symbol["symbol-sort-key"]),"symbol-z-order":new $t(we.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new $t(we.layout_symbol["icon-allow-overlap"]),"icon-overlap":new $t(we.layout_symbol["icon-overlap"]),"icon-ignore-placement":new $t(we.layout_symbol["icon-ignore-placement"]),"icon-optional":new $t(we.layout_symbol["icon-optional"]),"icon-rotation-alignment":new $t(we.layout_symbol["icon-rotation-alignment"]),"icon-size":new Gt(we.layout_symbol["icon-size"]),"icon-text-fit":new $t(we.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new $t(we.layout_symbol["icon-text-fit-padding"]),"icon-image":new Gt(we.layout_symbol["icon-image"]),"icon-rotate":new Gt(we.layout_symbol["icon-rotate"]),"icon-padding":new Gt(we.layout_symbol["icon-padding"]),"icon-keep-upright":new $t(we.layout_symbol["icon-keep-upright"]),"icon-offset":new Gt(we.layout_symbol["icon-offset"]),"icon-anchor":new Gt(we.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new $t(we.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new $t(we.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new $t(we.layout_symbol["text-rotation-alignment"]),"text-field":new Gt(we.layout_symbol["text-field"]),"text-font":new Gt(we.layout_symbol["text-font"]),"text-size":new Gt(we.layout_symbol["text-size"]),"text-max-width":new Gt(we.layout_symbol["text-max-width"]),"text-line-height":new $t(we.layout_symbol["text-line-height"]),"text-letter-spacing":new Gt(we.layout_symbol["text-letter-spacing"]),"text-justify":new Gt(we.layout_symbol["text-justify"]),"text-radial-offset":new Gt(we.layout_symbol["text-radial-offset"]),"text-variable-anchor":new $t(we.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Gt(we.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Gt(we.layout_symbol["text-anchor"]),"text-max-angle":new $t(we.layout_symbol["text-max-angle"]),"text-writing-mode":new $t(we.layout_symbol["text-writing-mode"]),"text-rotate":new Gt(we.layout_symbol["text-rotate"]),"text-padding":new $t(we.layout_symbol["text-padding"]),"text-keep-upright":new $t(we.layout_symbol["text-keep-upright"]),"text-transform":new Gt(we.layout_symbol["text-transform"]),"text-offset":new Gt(we.layout_symbol["text-offset"]),"text-allow-overlap":new $t(we.layout_symbol["text-allow-overlap"]),"text-overlap":new $t(we.layout_symbol["text-overlap"]),"text-ignore-placement":new $t(we.layout_symbol["text-ignore-placement"]),"text-optional":new $t(we.layout_symbol["text-optional"])})}};class $m{constructor(n){if(n.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=n.property.overrides?n.property.overrides.runtimeType:Xi,this.defaultValue=n}evaluate(n){if(n.formattedSection){const c=this.defaultValue.property.overrides;if(c&&c.hasOverride(n.formattedSection))return c.getOverride(n.formattedSection)}return n.feature&&n.featureState?this.defaultValue.evaluate(n.feature,n.featureState):this.defaultValue.property.specification.default}eachChild(n){this.defaultValue.isConstant()||n(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Lt("FormatSectionOverride",$m,{omit:["defaultValue"]});class Xh extends ao{constructor(n){super(n,Af)}recalculate(n,c){if(super.recalculate(n,c),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const f=this.layout.get("text-writing-mode");if(f){const g=[];for(const w of f)g.indexOf(w)<0&&g.push(w);this.layout._values["text-writing-mode"]=g}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(n,c,f,g){const w=this.layout.get(n).evaluate(c,{},f,g),x=this._unevaluatedLayout._values[n];return x.isDataDriven()||Ji(x.value)||!w?w:function(T,I){return I.replace(/{([^{}]+)}/g,(z,N)=>T&&N in T?String(T[N]):"")}(c.properties,w)}createBucket(n){return new Fl(n)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const n of Af.paint.overridableProperties){if(!Xh.hasPaintOverride(this.layout,n))continue;const c=this.paint.get(n),f=new $m(c),g=new en(f,c.property.specification);let w=null;w=c.value.kind==="constant"||c.value.kind==="source"?new sl("source",g):new kc("composite",g,c.value.zoomStops),this.paint._values[n]=new so(c.property,w,c.parameters)}}_handleOverridablePaintPropertyUpdate(n,c,f){return!(!this.layout||c.isDataDriven()||f.isDataDriven())&&Xh.hasPaintOverride(this.layout,n)}static hasPaintOverride(n,c){const f=n.get("text-field"),g=Af.paint.properties[c];let w=!1;const x=T=>{for(const I of T)if(g.overrides&&g.overrides.hasOverride(I))return void(w=!0)};if(f.value.kind==="constant"&&f.value.value instanceof Dr)x(f.value.value.sections);else if(f.value.kind==="source"){const T=z=>{w||(z instanceof Go&&Bn(z.value)===_n?x(z.value.sections):z instanceof rl?x(z.sections):z.eachChild(T))},I=f.value;I._styleExpression&&T(I._styleExpression.expression)}return w}}let qm;var Av={get paint(){return qm=qm||new Sr({"background-color":new $t(we.paint_background["background-color"]),"background-pattern":new Ta(we.paint_background["background-pattern"]),"background-opacity":new $t(we.paint_background["background-opacity"])})}};class Pv extends ao{constructor(n){super(n,Av)}}let Zm;var zv={get paint(){return Zm=Zm||new Sr({"raster-opacity":new $t(we.paint_raster["raster-opacity"]),"raster-hue-rotate":new $t(we.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new $t(we.paint_raster["raster-brightness-min"]),"raster-brightness-max":new $t(we.paint_raster["raster-brightness-max"]),"raster-saturation":new $t(we.paint_raster["raster-saturation"]),"raster-contrast":new $t(we.paint_raster["raster-contrast"]),"raster-resampling":new $t(we.paint_raster["raster-resampling"]),"raster-fade-duration":new $t(we.paint_raster["raster-fade-duration"])})}};class Dv extends ao{constructor(n){super(n,zv)}}class Rv extends ao{constructor(n){super(n,{}),this.onAdd=c=>{this.implementation.onAdd&&this.implementation.onAdd(c,c.painter.context.gl)},this.onRemove=c=>{this.implementation.onRemove&&this.implementation.onRemove(c,c.painter.context.gl)},this.implementation=n}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class Bv{constructor(n){this._methodToThrottle=n,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const Pf=63710088e-1;class Ws{constructor(n,c){if(isNaN(n)||isNaN(c))throw new Error(`Invalid LngLat object: (${n}, ${c})`);if(this.lng=+n,this.lat=+c,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Ws(he(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(n){const c=Math.PI/180,f=this.lat*c,g=n.lat*c,w=Math.sin(f)*Math.sin(g)+Math.cos(f)*Math.cos(g)*Math.cos((n.lng-this.lng)*c);return Pf*Math.acos(Math.min(w,1))}static convert(n){if(n instanceof Ws)return n;if(Array.isArray(n)&&(n.length===2||n.length===3))return new Ws(Number(n[0]),Number(n[1]));if(!Array.isArray(n)&&typeof n=="object"&&n!==null)return new Ws(Number("lng"in n?n.lng:n.lon),Number(n.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Gm=2*Math.PI*Pf;function Wm(s){return Gm*Math.cos(s*Math.PI/180)}function Hm(s){return(180+s)/360}function Xm(s){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s*Math.PI/360)))/360}function Km(s,n){return s/Wm(n)}function zf(s){return 360/Math.PI*Math.atan(Math.exp((180-360*s)*Math.PI/180))-90}class Kh{constructor(n,c,f=0){this.x=+n,this.y=+c,this.z=+f}static fromLngLat(n,c=0){const f=Ws.convert(n);return new Kh(Hm(f.lng),Xm(f.lat),Km(c,f.lat))}toLngLat(){return new Ws(360*this.x-180,zf(this.y))}toAltitude(){return this.z*Wm(zf(this.y))}meterInMercatorCoordinateUnits(){return 1/Gm*(n=zf(this.y),1/Math.cos(n*Math.PI/180));var n}}function Jm(s,n,c){var f=2*Math.PI*6378137/256/Math.pow(2,c);return[s*f-2*Math.PI*6378137/2,n*f-2*Math.PI*6378137/2]}class Df{constructor(n,c,f){if(n<0||n>25||f<0||f>=Math.pow(2,n)||c<0||c>=Math.pow(2,n))throw new Error(`x=${c}, y=${f}, z=${n} outside of bounds. 0<=x<${Math.pow(2,n)}, 0<=y<${Math.pow(2,n)} 0<=z<=25 `);this.z=n,this.x=c,this.y=f,this.key=au(0,n,n,c,f)}equals(n){return this.z===n.z&&this.x===n.x&&this.y===n.y}url(n,c,f){const g=(x=this.y,T=this.z,I=Jm(256*(w=this.x),256*(x=Math.pow(2,T)-x-1),T),z=Jm(256*(w+1),256*(x+1),T),I[0]+","+I[1]+","+z[0]+","+z[1]);var w,x,T,I,z;const N=function(V,X,Y){let te,ue="";for(let ge=V;ge>0;ge--)te=1<<ge-1,ue+=(X&te?1:0)+(Y&te?2:0);return ue}(this.z,this.x,this.y);return n[(this.x+this.y)%n.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(f==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,c>1?"@2x":"").replace(/{quadkey}/g,N).replace(/{bbox-epsg-3857}/g,g)}isChildOf(n){const c=this.z-n.z;return c>0&&n.x===this.x>>c&&n.y===this.y>>c}getTilePoint(n){const c=Math.pow(2,this.z);return new S((n.x*c-this.x)*Sn,(n.y*c-this.y)*Sn)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Ym{constructor(n,c){this.wrap=n,this.canonical=c,this.key=au(n,c.z,c.z,c.x,c.y)}}class co{constructor(n,c,f,g,w){if(n<f)throw new Error(`overscaledZ should be >= z; overscaledZ = ${n}; z = ${f}`);this.overscaledZ=n,this.wrap=c,this.canonical=new Df(f,+g,+w),this.key=au(c,n,f,g,w)}clone(){return new co(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(n){return this.overscaledZ===n.overscaledZ&&this.wrap===n.wrap&&this.canonical.equals(n.canonical)}scaledTo(n){if(n>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${n}; overscaledZ = ${this.overscaledZ}`);const c=this.canonical.z-n;return n>this.canonical.z?new co(n,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new co(n,this.wrap,n,this.canonical.x>>c,this.canonical.y>>c)}calculateScaledKey(n,c){if(n>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${n}; overscaledZ = ${this.overscaledZ}`);const f=this.canonical.z-n;return n>this.canonical.z?au(this.wrap*+c,n,this.canonical.z,this.canonical.x,this.canonical.y):au(this.wrap*+c,n,n,this.canonical.x>>f,this.canonical.y>>f)}isChildOf(n){if(n.wrap!==this.wrap)return!1;const c=this.canonical.z-n.canonical.z;return n.overscaledZ===0||n.overscaledZ<this.overscaledZ&&n.canonical.x===this.canonical.x>>c&&n.canonical.y===this.canonical.y>>c}children(n){if(this.overscaledZ>=n)return[new co(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const c=this.canonical.z+1,f=2*this.canonical.x,g=2*this.canonical.y;return[new co(c,this.wrap,c,f,g),new co(c,this.wrap,c,f+1,g),new co(c,this.wrap,c,f,g+1),new co(c,this.wrap,c,f+1,g+1)]}isLessThan(n){return this.wrap<n.wrap||!(this.wrap>n.wrap)&&(this.overscaledZ<n.overscaledZ||!(this.overscaledZ>n.overscaledZ)&&(this.canonical.x<n.canonical.x||!(this.canonical.x>n.canonical.x)&&this.canonical.y<n.canonical.y))}wrapped(){return new co(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(n){return new co(this.overscaledZ,n,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Ym(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(n){return this.canonical.getTilePoint(new Kh(n.x-this.wrap,n.y))}}function au(s,n,c,f,g){(s*=2)<0&&(s=-1*s-1);const w=1<<c;return(w*w*s+w*g+f).toString(36)+c.toString(36)+n.toString(36)}Lt("CanonicalTileID",Df),Lt("OverscaledTileID",co,{omit:["posMatrix"]});class Qm{constructor(n,c,f,g=1,w=1,x=1,T=0){if(this.uid=n,c.height!==c.width)throw new RangeError("DEM tiles must be square");if(f&&!["mapbox","terrarium","custom"].includes(f))return void Ke(`"${f}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=c.height;const I=this.dim=c.height-2;switch(this.data=new Uint32Array(c.data.buffer),f){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=g,this.greenFactor=w,this.blueFactor=x,this.baseShift=T;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let z=0;z<I;z++)this.data[this._idx(-1,z)]=this.data[this._idx(0,z)],this.data[this._idx(I,z)]=this.data[this._idx(I-1,z)],this.data[this._idx(z,-1)]=this.data[this._idx(z,0)],this.data[this._idx(z,I)]=this.data[this._idx(z,I-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(I,-1)]=this.data[this._idx(I-1,0)],this.data[this._idx(-1,I)]=this.data[this._idx(0,I-1)],this.data[this._idx(I,I)]=this.data[this._idx(I-1,I-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let z=0;z<I;z++)for(let N=0;N<I;N++){const V=this.get(z,N);V>this.max&&(this.max=V),V<this.min&&(this.min=V)}}get(n,c){const f=new Uint8Array(this.data.buffer),g=4*this._idx(n,c);return this.unpack(f[g],f[g+1],f[g+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(n,c){if(n<-1||n>=this.dim+1||c<-1||c>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(c+1)*this.stride+(n+1)}unpack(n,c,f){return n*this.redFactor+c*this.greenFactor+f*this.blueFactor-this.baseShift}getPixels(){return new lo({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(n,c,f){if(this.dim!==n.dim)throw new Error("dem dimension mismatch");let g=c*this.dim,w=c*this.dim+this.dim,x=f*this.dim,T=f*this.dim+this.dim;switch(c){case-1:g=w-1;break;case 1:w=g+1}switch(f){case-1:x=T-1;break;case 1:T=x+1}const I=-c*this.dim,z=-f*this.dim;for(let N=x;N<T;N++)for(let V=g;V<w;V++)this.data[this._idx(V,N)]=n.data[this._idx(V+I,N+z)]}}Lt("DEMData",Qm);class eg{constructor(n){this._stringToNumber={},this._numberToString=[];for(let c=0;c<n.length;c++){const f=n[c];this._stringToNumber[f]=c,this._numberToString[c]=f}}encode(n){return this._stringToNumber[n]}decode(n){if(n>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${n} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[n]}}class tg{constructor(n,c,f,g,w){this.type="Feature",this._vectorTileFeature=n,n._z=c,n._x=f,n._y=g,this.properties=n.properties,this.id=w}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(n){this._geometry=n}toJSON(){const n={geometry:this.geometry};for(const c in this)c!=="_geometry"&&c!=="_vectorTileFeature"&&(n[c]=this[c]);return n}}class ig{constructor(n,c){this.tileID=n,this.x=n.canonical.x,this.y=n.canonical.y,this.z=n.canonical.z,this.grid=new xa(Sn,16,0),this.grid3D=new xa(Sn,16,0),this.featureIndexArray=new $,this.promoteId=c}insert(n,c,f,g,w,x){const T=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(f,g,w);const I=x?this.grid3D:this.grid;for(let z=0;z<c.length;z++){const N=c[z],V=[1/0,1/0,-1/0,-1/0];for(let X=0;X<N.length;X++){const Y=N[X];V[0]=Math.min(V[0],Y.x),V[1]=Math.min(V[1],Y.y),V[2]=Math.max(V[2],Y.x),V[3]=Math.max(V[3],Y.y)}V[0]<Sn&&V[1]<Sn&&V[2]>=0&&V[3]>=0&&I.insert(T,V[0],V[1],V[2],V[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new qs.VectorTile(new xf(this.rawTileData)).layers,this.sourceLayerCoder=new eg(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(n,c,f,g){this.loadVTLayers();const w=n.params||{},x=Sn/n.tileSize/n.scale,T=ul(w.filter),I=n.queryGeometry,z=n.queryPadding*x,N=rg(I),V=this.grid.query(N.minX-z,N.minY-z,N.maxX+z,N.maxY+z),X=rg(n.cameraQueryGeometry),Y=this.grid3D.query(X.minX-z,X.minY-z,X.maxX+z,X.maxY+z,(ge,xe,Oe,Te)=>function(De,Qe,tt,Mt,Ft){for(const kt of De)if(Qe<=kt.x&&tt<=kt.y&&Mt>=kt.x&&Ft>=kt.y)return!0;const Et=[new S(Qe,tt),new S(Qe,Ft),new S(Mt,Ft),new S(Mt,tt)];if(De.length>2){for(const kt of Et)if(Ll(De,kt))return!0}for(let kt=0;kt<De.length-1;kt++)if(p1(De[kt],De[kt+1],Et))return!0;return!1}(n.cameraQueryGeometry,ge-z,xe-z,Oe+z,Te+z));for(const ge of Y)V.push(ge);V.sort(Fv);const te={};let ue;for(let ge=0;ge<V.length;ge++){const xe=V[ge];if(xe===ue)continue;ue=xe;const Oe=this.featureIndexArray.get(xe);let Te=null;this.loadMatchingFeature(te,Oe.bucketIndex,Oe.sourceLayerIndex,Oe.featureIndex,T,w.layers,w.availableImages,c,f,g,(De,Qe,tt)=>(Te||(Te=fs(De)),Qe.queryIntersectsFeature(I,De,tt,Te,this.z,n.transform,x,n.pixelPosMatrix)))}return te}loadMatchingFeature(n,c,f,g,w,x,T,I,z,N,V){const X=this.bucketLayerIDs[c];if(x&&!function(ge,xe){for(let Oe=0;Oe<ge.length;Oe++)if(xe.indexOf(ge[Oe])>=0)return!0;return!1}(x,X))return;const Y=this.sourceLayerCoder.decode(f),te=this.vtLayers[Y].feature(g);if(w.needGeometry){const ge=ps(te,!0);if(!w.filter(new an(this.tileID.overscaledZ),ge,this.tileID.canonical))return}else if(!w.filter(new an(this.tileID.overscaledZ),te))return;const ue=this.getId(te,Y);for(let ge=0;ge<X.length;ge++){const xe=X[ge];if(x&&x.indexOf(xe)<0)continue;const Oe=I[xe];if(!Oe)continue;let Te={};ue&&N&&(Te=N.getState(Oe.sourceLayer||"_geojsonTileLayer",ue));const De=Z({},z[xe]);De.paint=ng(De.paint,Oe.paint,te,Te,T),De.layout=ng(De.layout,Oe.layout,te,Te,T);const Qe=!V||V(te,Oe,Te);if(!Qe)continue;const tt=new tg(te,this.z,this.x,this.y,ue);tt.layer=De;let Mt=n[xe];Mt===void 0&&(Mt=n[xe]=[]),Mt.push({featureIndex:g,feature:tt,intersectionZ:Qe})}}lookupSymbolFeatures(n,c,f,g,w,x,T,I){const z={};this.loadVTLayers();const N=ul(w);for(const V of n)this.loadMatchingFeature(z,f,g,V,N,x,T,I,c);return z}hasLayer(n){for(const c of this.bucketLayerIDs)for(const f of c)if(n===f)return!0;return!1}getId(n,c){let f=n.id;return this.promoteId&&(f=n.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[c]],typeof f=="boolean"&&(f=Number(f))),f}}function ng(s,n,c,f,g){return ye(s,(w,x)=>{const T=n instanceof Sa?n.get(x):null;return T&&T.evaluate?T.evaluate(c,f,g):T})}function rg(s){let n=1/0,c=1/0,f=-1/0,g=-1/0;for(const w of s)n=Math.min(n,w.x),c=Math.min(c,w.y),f=Math.max(f,w.x),g=Math.max(g,w.y);return{minX:n,minY:c,maxX:f,maxY:g}}function Fv(s,n){return n-s}function og(s,n,c,f,g){const w=[];for(let x=0;x<s.length;x++){const T=s[x];let I;for(let z=0;z<T.length-1;z++){let N=T[z],V=T[z+1];N.x<n&&V.x<n||(N.x<n?N=new S(n,N.y+(n-N.x)/(V.x-N.x)*(V.y-N.y))._round():V.x<n&&(V=new S(n,N.y+(n-N.x)/(V.x-N.x)*(V.y-N.y))._round()),N.y<c&&V.y<c||(N.y<c?N=new S(N.x+(c-N.y)/(V.y-N.y)*(V.x-N.x),c)._round():V.y<c&&(V=new S(N.x+(c-N.y)/(V.y-N.y)*(V.x-N.x),c)._round()),N.x>=f&&V.x>=f||(N.x>=f?N=new S(f,N.y+(f-N.x)/(V.x-N.x)*(V.y-N.y))._round():V.x>=f&&(V=new S(f,N.y+(f-N.x)/(V.x-N.x)*(V.y-N.y))._round()),N.y>=g&&V.y>=g||(N.y>=g?N=new S(N.x+(g-N.y)/(V.y-N.y)*(V.x-N.x),g)._round():V.y>=g&&(V=new S(N.x+(g-N.y)/(V.y-N.y)*(V.x-N.x),g)._round()),I&&N.equals(I[I.length-1])||(I=[N],w.push(I)),I.push(V)))))}}return w}Lt("FeatureIndex",ig,{omit:["rawTileData","sourceLayerCoder"]});class Hs extends S{constructor(n,c,f,g){super(n,c),this.angle=f,g!==void 0&&(this.segment=g)}clone(){return new Hs(this.x,this.y,this.angle,this.segment)}}function sg(s,n,c,f,g){if(n.segment===void 0||c===0)return!0;let w=n,x=n.segment+1,T=0;for(;T>-c/2;){if(x--,x<0)return!1;T-=s[x].dist(w),w=s[x]}T+=s[x].dist(s[x+1]),x++;const I=[];let z=0;for(;T<c/2;){const N=s[x],V=s[x+1];if(!V)return!1;let X=s[x-1].angleTo(N)-N.angleTo(V);for(X=Math.abs((X+3*Math.PI)%(2*Math.PI)-Math.PI),I.push({distance:T,angleDelta:X}),z+=X;T-I[0].distance>f;)z-=I.shift().angleDelta;if(z>g)return!1;x++,T+=N.dist(V)}return!0}function ag(s){let n=0;for(let c=0;c<s.length-1;c++)n+=s[c].dist(s[c+1]);return n}function lg(s,n,c){return s?.6*n*c:0}function cg(s,n){return Math.max(s?s.right-s.left:0,n?n.right-n.left:0)}function Ov(s,n,c,f,g,w){const x=lg(c,g,w),T=cg(c,f)*w;let I=0;const z=ag(s)/2;for(let N=0;N<s.length-1;N++){const V=s[N],X=s[N+1],Y=V.dist(X);if(I+Y>z){const te=(z-I)/Y,ue=dr.number(V.x,X.x,te),ge=dr.number(V.y,X.y,te),xe=new Hs(ue,ge,X.angleTo(V),N);return xe._round(),!x||sg(s,xe,T,x,n)?xe:void 0}I+=Y}}function Nv(s,n,c,f,g,w,x,T,I){const z=lg(f,w,x),N=cg(f,g),V=N*x,X=s[0].x===0||s[0].x===I||s[0].y===0||s[0].y===I;return n-V<n/4&&(n=V+n/4),ug(s,X?n/2*T%n:(N/2+2*w)*x*T%n,n,z,c,V,X,!1,I)}function ug(s,n,c,f,g,w,x,T,I){const z=w/2,N=ag(s);let V=0,X=n-c,Y=[];for(let te=0;te<s.length-1;te++){const ue=s[te],ge=s[te+1],xe=ue.dist(ge),Oe=ge.angleTo(ue);for(;X+c<V+xe;){X+=c;const Te=(X-V)/xe,De=dr.number(ue.x,ge.x,Te),Qe=dr.number(ue.y,ge.y,Te);if(De>=0&&De<I&&Qe>=0&&Qe<I&&X-z>=0&&X+z<=N){const tt=new Hs(De,Qe,Oe,te);tt._round(),f&&!sg(s,tt,w,f,g)||Y.push(tt)}}V+=xe}return T||Y.length||x||(Y=ug(s,V/2,c,f,g,w,x,!0,I)),Y}Lt("Anchor",Hs);const Ol=Nr;function hg(s,n,c,f){const g=[],w=s.image,x=w.pixelRatio,T=w.paddedRect.w-2*Ol,I=w.paddedRect.h-2*Ol,z=s.right-s.left,N=s.bottom-s.top,V=w.stretchX||[[0,T]],X=w.stretchY||[[0,I]],Y=(gt,Pt)=>gt+Pt[1]-Pt[0],te=V.reduce(Y,0),ue=X.reduce(Y,0),ge=T-te,xe=I-ue;let Oe=0,Te=te,De=0,Qe=ue,tt=0,Mt=ge,Ft=0,Et=xe;if(w.content&&f){const gt=w.content;Oe=Jh(V,0,gt[0]),De=Jh(X,0,gt[1]),Te=Jh(V,gt[0],gt[2]),Qe=Jh(X,gt[1],gt[3]),tt=gt[0]-Oe,Ft=gt[1]-De,Mt=gt[2]-gt[0]-Te,Et=gt[3]-gt[1]-Qe}const kt=(gt,Pt,wt,ct)=>{const Zt=Yh(gt.stretch-Oe,Te,z,s.left),jt=Qh(gt.fixed-tt,Mt,gt.stretch,te),_i=Yh(Pt.stretch-De,Qe,N,s.top),tn=Qh(Pt.fixed-Ft,Et,Pt.stretch,ue),cn=Yh(wt.stretch-Oe,Te,z,s.left),Wn=Qh(wt.fixed-tt,Mt,wt.stretch,te),Qr=Yh(ct.stretch-De,Qe,N,s.top),Cr=Qh(ct.fixed-Ft,Et,ct.stretch,ue),jn=new S(Zt,_i),tr=new S(cn,_i),sr=new S(cn,Qr),Er=new S(Zt,Qr),Mr=new S(jt/x,tn/x),Hn=new S(Wn/x,Cr/x),Xn=n*Math.PI/180;if(Xn){const mr=Math.sin(Xn),jr=Math.cos(Xn),Ur=[jr,-mr,mr,jr];jn._matMult(Ur),tr._matMult(Ur),Er._matMult(Ur),sr._matMult(Ur)}const pr=gt.stretch+gt.fixed,Ir=Pt.stretch+Pt.fixed;return{tl:jn,tr,bl:Er,br:sr,tex:{x:w.paddedRect.x+Ol+pr,y:w.paddedRect.y+Ol+Ir,w:wt.stretch+wt.fixed-pr,h:ct.stretch+ct.fixed-Ir},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Mr,pixelOffsetBR:Hn,minFontScaleX:Mt/x/z,minFontScaleY:Et/x/N,isSDF:c}};if(f&&(w.stretchX||w.stretchY)){const gt=dg(V,ge,te),Pt=dg(X,xe,ue);for(let wt=0;wt<gt.length-1;wt++){const ct=gt[wt],Zt=gt[wt+1];for(let jt=0;jt<Pt.length-1;jt++)g.push(kt(ct,Pt[jt],Zt,Pt[jt+1]))}}else g.push(kt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:T+1},{fixed:0,stretch:I+1}));return g}function Jh(s,n,c){let f=0;for(const g of s)f+=Math.max(n,Math.min(c,g[1]))-Math.max(n,Math.min(c,g[0]));return f}function dg(s,n,c){const f=[{fixed:-Ol,stretch:0}];for(const[g,w]of s){const x=f[f.length-1];f.push({fixed:g-x.stretch,stretch:x.stretch}),f.push({fixed:g-x.stretch,stretch:x.stretch+(w-g)})}return f.push({fixed:n+Ol,stretch:c}),f}function Yh(s,n,c,f){return s/n*c+f}function Qh(s,n,c,f){return s-n*c/f}class ed{constructor(n,c,f,g,w,x,T,I,z,N){if(this.boxStartIndex=n.length,z){let V=x.top,X=x.bottom;const Y=x.collisionPadding;Y&&(V-=Y[1],X+=Y[3]);let te=X-V;te>0&&(te=Math.max(10,te),this.circleDiameter=te)}else{let V=x.top*T-I[0],X=x.bottom*T+I[2],Y=x.left*T-I[3],te=x.right*T+I[1];const ue=x.collisionPadding;if(ue&&(Y-=ue[0]*T,V-=ue[1]*T,te+=ue[2]*T,X+=ue[3]*T),N){const ge=new S(Y,V),xe=new S(te,V),Oe=new S(Y,X),Te=new S(te,X),De=N*Math.PI/180;ge._rotate(De),xe._rotate(De),Oe._rotate(De),Te._rotate(De),Y=Math.min(ge.x,xe.x,Oe.x,Te.x),te=Math.max(ge.x,xe.x,Oe.x,Te.x),V=Math.min(ge.y,xe.y,Oe.y,Te.y),X=Math.max(ge.y,xe.y,Oe.y,Te.y)}n.emplaceBack(c.x,c.y,Y,V,te,X,f,g,w)}this.boxEndIndex=n.length}}class jv{constructor(n=[],c=Uv){if(this.data=n,this.length=this.data.length,this.compare=c,this.length>0)for(let f=(this.length>>1)-1;f>=0;f--)this._down(f)}push(n){this.data.push(n),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const n=this.data[0],c=this.data.pop();return this.length--,this.length>0&&(this.data[0]=c,this._down(0)),n}peek(){return this.data[0]}_up(n){const{data:c,compare:f}=this,g=c[n];for(;n>0;){const w=n-1>>1,x=c[w];if(f(g,x)>=0)break;c[n]=x,n=w}c[n]=g}_down(n){const{data:c,compare:f}=this,g=this.length>>1,w=c[n];for(;n<g;){let x=1+(n<<1),T=c[x];const I=x+1;if(I<this.length&&f(c[I],T)<0&&(x=I,T=c[I]),f(T,w)>=0)break;c[n]=T,n=x}c[n]=w}}function Uv(s,n){return s<n?-1:s>n?1:0}function Vv(s,n=1,c=!1){let f=1/0,g=1/0,w=-1/0,x=-1/0;const T=s[0];for(let Y=0;Y<T.length;Y++){const te=T[Y];(!Y||te.x<f)&&(f=te.x),(!Y||te.y<g)&&(g=te.y),(!Y||te.x>w)&&(w=te.x),(!Y||te.y>x)&&(x=te.y)}const I=Math.min(w-f,x-g);let z=I/2;const N=new jv([],$v);if(I===0)return new S(f,g);for(let Y=f;Y<w;Y+=I)for(let te=g;te<x;te+=I)N.push(new Nl(Y+z,te+z,z,s));let V=function(Y){let te=0,ue=0,ge=0;const xe=Y[0];for(let Oe=0,Te=xe.length,De=Te-1;Oe<Te;De=Oe++){const Qe=xe[Oe],tt=xe[De],Mt=Qe.x*tt.y-tt.x*Qe.y;ue+=(Qe.x+tt.x)*Mt,ge+=(Qe.y+tt.y)*Mt,te+=3*Mt}return new Nl(ue/te,ge/te,0,Y)}(s),X=N.length;for(;N.length;){const Y=N.pop();(Y.d>V.d||!V.d)&&(V=Y,c&&console.log("found best %d after %d probes",Math.round(1e4*Y.d)/1e4,X)),Y.max-V.d<=n||(z=Y.h/2,N.push(new Nl(Y.p.x-z,Y.p.y-z,z,s)),N.push(new Nl(Y.p.x+z,Y.p.y-z,z,s)),N.push(new Nl(Y.p.x-z,Y.p.y+z,z,s)),N.push(new Nl(Y.p.x+z,Y.p.y+z,z,s)),X+=4)}return c&&(console.log(`num probes: ${X}`),console.log(`best distance: ${V.d}`)),V.p}function $v(s,n){return n.max-s.max}function Nl(s,n,c,f){this.p=new S(s,n),this.h=c,this.d=function(g,w){let x=!1,T=1/0;for(let I=0;I<w.length;I++){const z=w[I];for(let N=0,V=z.length,X=V-1;N<V;X=N++){const Y=z[N],te=z[X];Y.y>g.y!=te.y>g.y&&g.x<(te.x-Y.x)*(g.y-Y.y)/(te.y-Y.y)+Y.x&&(x=!x),T=Math.min(T,Xp(g,Y,te))}}return(x?1:-1)*Math.sqrt(T)}(this.p,f),this.max=this.d+this.h*Math.SQRT2}var or;d.ap=void 0,(or=d.ap||(d.ap={}))[or.center=1]="center",or[or.left=2]="left",or[or.right=3]="right",or[or.top=4]="top",or[or.bottom=5]="bottom",or[or["top-left"]=6]="top-left",or[or["top-right"]=7]="top-right",or[or["bottom-left"]=8]="bottom-left",or[or["bottom-right"]=9]="bottom-right";const Xs=7,Rf=Number.POSITIVE_INFINITY;function fg(s,n){return n[1]!==Rf?function(c,f,g){let w=0,x=0;switch(f=Math.abs(f),g=Math.abs(g),c){case"top-right":case"top-left":case"top":x=g-Xs;break;case"bottom-right":case"bottom-left":case"bottom":x=-g+Xs}switch(c){case"top-right":case"bottom-right":case"right":w=-f;break;case"top-left":case"bottom-left":case"left":w=f}return[w,x]}(s,n[0],n[1]):function(c,f){let g=0,w=0;f<0&&(f=0);const x=f/Math.SQRT2;switch(c){case"top-right":case"top-left":w=x-Xs;break;case"bottom-right":case"bottom-left":w=-x+Xs;break;case"bottom":w=-f+Xs;break;case"top":w=f-Xs}switch(c){case"top-right":case"bottom-right":g=-x;break;case"top-left":case"bottom-left":g=x;break;case"left":g=f;break;case"right":g=-f}return[g,w]}(s,n[0])}function pg(s,n,c){var f;const g=s.layout,w=(f=g.get("text-variable-anchor-offset"))===null||f===void 0?void 0:f.evaluate(n,{},c);if(w){const T=w.values,I=[];for(let z=0;z<T.length;z+=2){const N=I[z]=T[z],V=T[z+1].map(X=>X*Gn);N.startsWith("top")?V[1]-=Xs:N.startsWith("bottom")&&(V[1]+=Xs),I[z+1]=V}return new Xr(I)}const x=g.get("text-variable-anchor");if(x){let T;T=s._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[g.get("text-radial-offset").evaluate(n,{},c)*Gn,Rf]:g.get("text-offset").evaluate(n,{},c).map(z=>z*Gn);const I=[];for(const z of x)I.push(z,fg(z,T));return new Xr(I)}return null}function Bf(s){switch(s){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function qv(s,n,c,f,g,w,x,T,I,z,N){let V=w.textMaxSize.evaluate(n,{});V===void 0&&(V=x);const X=s.layers[0].layout,Y=X.get("icon-offset").evaluate(n,{},N),te=gg(c.horizontal),ue=x/24,ge=s.tilePixelRatio*ue,xe=s.tilePixelRatio*V/24,Oe=s.tilePixelRatio*T,Te=s.tilePixelRatio*X.get("symbol-spacing"),De=X.get("text-padding")*s.tilePixelRatio,Qe=function(ct,Zt,jt,_i=1){const tn=ct.get("icon-padding").evaluate(Zt,{},jt),cn=tn&&tn.values;return[cn[0]*_i,cn[1]*_i,cn[2]*_i,cn[3]*_i]}(X,n,N,s.tilePixelRatio),tt=X.get("text-max-angle")/180*Math.PI,Mt=X.get("text-rotation-alignment")!=="viewport"&&X.get("symbol-placement")!=="point",Ft=X.get("icon-rotation-alignment")==="map"&&X.get("symbol-placement")!=="point",Et=X.get("symbol-placement"),kt=Te/2,gt=X.get("icon-text-fit");let Pt;f&&gt!=="none"&&(s.allowVerticalPlacement&&c.vertical&&(Pt=Nm(f,c.vertical,gt,X.get("icon-text-fit-padding"),Y,ue)),te&&(f=Nm(f,te,gt,X.get("icon-text-fit-padding"),Y,ue)));const wt=(ct,Zt)=>{Zt.x<0||Zt.x>=Sn||Zt.y<0||Zt.y>=Sn||function(jt,_i,tn,cn,Wn,Qr,Cr,jn,tr,sr,Er,Mr,Hn,Xn,pr,Ir,mr,jr,Ur,Kn,xi,gr,ar,Jn,ko){const Ro=jt.addToLineVertexArray(_i,tn);let Bo,gs,So,uo,Vr=0,_s=0,uu=0,bg=0,qf=-1,Zf=-1;const ys={};let wg=wn("");if(jt.allowVerticalPlacement&&cn.vertical){const _r=jn.layout.get("text-rotate").evaluate(xi,{},Jn)+90;So=new ed(tr,_i,sr,Er,Mr,cn.vertical,Hn,Xn,pr,_r),Cr&&(uo=new ed(tr,_i,sr,Er,Mr,Cr,mr,jr,pr,_r))}if(Wn){const _r=jn.layout.get("icon-rotate").evaluate(xi,{}),ho=jn.layout.get("icon-text-fit")!=="none",za=hg(Wn,_r,ar,ho),Oo=Cr?hg(Cr,_r,ar,ho):void 0;gs=new ed(tr,_i,sr,Er,Mr,Wn,mr,jr,!1,_r),Vr=4*za.length;const Da=jt.iconSizeData;let is=null;Da.kind==="source"?(is=[ts*jn.layout.get("icon-size").evaluate(xi,{})],is[0]>Gs&&Ke(`${jt.layerIds[0]}: Value for "icon-size" is >= ${su}. Reduce your "icon-size".`)):Da.kind==="composite"&&(is=[ts*gr.compositeIconSizes[0].evaluate(xi,{},Jn),ts*gr.compositeIconSizes[1].evaluate(xi,{},Jn)],(is[0]>Gs||is[1]>Gs)&&Ke(`${jt.layerIds[0]}: Value for "icon-size" is >= ${su}. Reduce your "icon-size".`)),jt.addSymbols(jt.icon,za,is,Kn,Ur,xi,d.ah.none,_i,Ro.lineStartIndex,Ro.lineLength,-1,Jn),qf=jt.icon.placedSymbolArray.length-1,Oo&&(_s=4*Oo.length,jt.addSymbols(jt.icon,Oo,is,Kn,Ur,xi,d.ah.vertical,_i,Ro.lineStartIndex,Ro.lineLength,-1,Jn),Zf=jt.icon.placedSymbolArray.length-1)}const xg=Object.keys(cn.horizontal);for(const _r of xg){const ho=cn.horizontal[_r];if(!Bo){wg=wn(ho.text);const Oo=jn.layout.get("text-rotate").evaluate(xi,{},Jn);Bo=new ed(tr,_i,sr,Er,Mr,ho,Hn,Xn,pr,Oo)}const za=ho.positionedLines.length===1;if(uu+=mg(jt,_i,ho,Qr,jn,pr,xi,Ir,Ro,cn.vertical?d.ah.horizontal:d.ah.horizontalOnly,za?xg:[_r],ys,qf,gr,Jn),za)break}cn.vertical&&(bg+=mg(jt,_i,cn.vertical,Qr,jn,pr,xi,Ir,Ro,d.ah.vertical,["vertical"],ys,Zf,gr,Jn));const Wv=Bo?Bo.boxStartIndex:jt.collisionBoxArray.length,Hv=Bo?Bo.boxEndIndex:jt.collisionBoxArray.length,Xv=So?So.boxStartIndex:jt.collisionBoxArray.length,Kv=So?So.boxEndIndex:jt.collisionBoxArray.length,Jv=gs?gs.boxStartIndex:jt.collisionBoxArray.length,Yv=gs?gs.boxEndIndex:jt.collisionBoxArray.length,Qv=uo?uo.boxStartIndex:jt.collisionBoxArray.length,eb=uo?uo.boxEndIndex:jt.collisionBoxArray.length;let Fo=-1;const id=(_r,ho)=>_r&&_r.circleDiameter?Math.max(_r.circleDiameter,ho):ho;Fo=id(Bo,Fo),Fo=id(So,Fo),Fo=id(gs,Fo),Fo=id(uo,Fo);const kg=Fo>-1?1:0;kg&&(Fo*=ko/Gn),jt.glyphOffsetArray.length>=Fl.MAX_GLYPHS&&Ke("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),xi.sortKey!==void 0&&jt.addToSortKeyRanges(jt.symbolInstances.length,xi.sortKey);const tb=pg(jn,xi,Jn),[ib,nb]=function(_r,ho){const za=_r.length,Oo=ho==null?void 0:ho.values;if((Oo==null?void 0:Oo.length)>0)for(let Da=0;Da<Oo.length;Da+=2){const is=Oo[Da+1];_r.emplaceBack(d.ap[Oo[Da]],is[0],is[1])}return[za,_r.length]}(jt.textAnchorOffsets,tb);jt.symbolInstances.emplaceBack(_i.x,_i.y,ys.right>=0?ys.right:-1,ys.center>=0?ys.center:-1,ys.left>=0?ys.left:-1,ys.vertical||-1,qf,Zf,wg,Wv,Hv,Xv,Kv,Jv,Yv,Qv,eb,sr,uu,bg,Vr,_s,kg,0,Hn,Fo,ib,nb)}(s,Zt,ct,c,f,g,Pt,s.layers[0],s.collisionBoxArray,n.index,n.sourceLayerIndex,s.index,ge,[De,De,De,De],Mt,I,Oe,Qe,Ft,Y,n,w,z,N,x)};if(Et==="line")for(const ct of og(n.geometry,0,0,Sn,Sn)){const Zt=Nv(ct,Te,tt,c.vertical||te,f,24,xe,s.overscaling,Sn);for(const jt of Zt)te&&Zv(s,te.text,kt,jt)||wt(ct,jt)}else if(Et==="line-center"){for(const ct of n.geometry)if(ct.length>1){const Zt=Ov(ct,tt,c.vertical||te,f,24,xe);Zt&&wt(ct,Zt)}}else if(n.type==="Polygon")for(const ct of pf(n.geometry,0)){const Zt=Vv(ct,16);wt(ct[0],new Hs(Zt.x,Zt.y,0))}else if(n.type==="LineString")for(const ct of n.geometry)wt(ct,new Hs(ct[0].x,ct[0].y,0));else if(n.type==="Point")for(const ct of n.geometry)for(const Zt of ct)wt([Zt],new Hs(Zt.x,Zt.y,0))}function mg(s,n,c,f,g,w,x,T,I,z,N,V,X,Y,te){const ue=function(Oe,Te,De,Qe,tt,Mt,Ft,Et){const kt=Qe.layout.get("text-rotate").evaluate(Mt,{})*Math.PI/180,gt=[];for(const Pt of Te.positionedLines)for(const wt of Pt.positionedGlyphs){if(!wt.rect)continue;const ct=wt.rect||{};let Zt=Pm+1,jt=!0,_i=1,tn=0;const cn=(tt||Et)&&wt.vertical,Wn=wt.metrics.advance*wt.scale/2;if(Et&&Te.verticalizable&&(tn=Pt.lineOffset/2-(wt.imageName?-(Gn-wt.metrics.width*wt.scale)/2:(wt.scale-1)*Gn)),wt.imageName){const Kn=Ft[wt.imageName];jt=Kn.sdf,_i=Kn.pixelRatio,Zt=Nr/_i}const Qr=tt?[wt.x+Wn,wt.y]:[0,0];let Cr=tt?[0,0]:[wt.x+Wn+De[0],wt.y+De[1]-tn],jn=[0,0];cn&&(jn=Cr,Cr=[0,0]);const tr=wt.metrics.isDoubleResolution?2:1,sr=(wt.metrics.left-Zt)*wt.scale-Wn+Cr[0],Er=(-wt.metrics.top-Zt)*wt.scale+Cr[1],Mr=sr+ct.w/tr*wt.scale/_i,Hn=Er+ct.h/tr*wt.scale/_i,Xn=new S(sr,Er),pr=new S(Mr,Er),Ir=new S(sr,Hn),mr=new S(Mr,Hn);if(cn){const Kn=new S(-Wn,Wn-ru),xi=-Math.PI/2,gr=Gn/2-Wn,ar=new S(5-ru-gr,-(wt.imageName?gr:0)),Jn=new S(...jn);Xn._rotateAround(xi,Kn)._add(ar)._add(Jn),pr._rotateAround(xi,Kn)._add(ar)._add(Jn),Ir._rotateAround(xi,Kn)._add(ar)._add(Jn),mr._rotateAround(xi,Kn)._add(ar)._add(Jn)}if(kt){const Kn=Math.sin(kt),xi=Math.cos(kt),gr=[xi,-Kn,Kn,xi];Xn._matMult(gr),pr._matMult(gr),Ir._matMult(gr),mr._matMult(gr)}const jr=new S(0,0),Ur=new S(0,0);gt.push({tl:Xn,tr:pr,bl:Ir,br:mr,tex:ct,writingMode:Te.writingMode,glyphOffset:Qr,sectionIndex:wt.sectionIndex,isSDF:jt,pixelOffsetTL:jr,pixelOffsetBR:Ur,minFontScaleX:0,minFontScaleY:0})}return gt}(0,c,T,g,w,x,f,s.allowVerticalPlacement),ge=s.textSizeData;let xe=null;ge.kind==="source"?(xe=[ts*g.layout.get("text-size").evaluate(x,{})],xe[0]>Gs&&Ke(`${s.layerIds[0]}: Value for "text-size" is >= ${su}. Reduce your "text-size".`)):ge.kind==="composite"&&(xe=[ts*Y.compositeTextSizes[0].evaluate(x,{},te),ts*Y.compositeTextSizes[1].evaluate(x,{},te)],(xe[0]>Gs||xe[1]>Gs)&&Ke(`${s.layerIds[0]}: Value for "text-size" is >= ${su}. Reduce your "text-size".`)),s.addSymbols(s.text,ue,xe,T,w,x,z,n,I.lineStartIndex,I.lineLength,X,te);for(const Oe of N)V[Oe]=s.text.placedSymbolArray.length-1;return 4*ue.length}function gg(s){for(const n in s)return s[n];return null}function Zv(s,n,c,f){const g=s.compareText;if(n in g){const w=g[n];for(let x=w.length-1;x>=0;x--)if(f.dist(w[x])<c)return!0}else g[n]=[];return g[n].push(f),!1}const _g=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Ff{static from(n){if(!(n instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[c,f]=new Uint8Array(n,0,2);if(c!==219)throw new Error("Data does not appear to be in a KDBush format.");const g=f>>4;if(g!==1)throw new Error(`Got v${g} data when expected v1.`);const w=_g[15&f];if(!w)throw new Error("Unrecognized array type.");const[x]=new Uint16Array(n,2,1),[T]=new Uint32Array(n,4,1);return new Ff(T,x,w,n)}constructor(n,c=64,f=Float64Array,g){if(isNaN(n)||n<0)throw new Error(`Unpexpected numItems value: ${n}.`);this.numItems=+n,this.nodeSize=Math.min(Math.max(+c,2),65535),this.ArrayType=f,this.IndexArrayType=n<65536?Uint16Array:Uint32Array;const w=_g.indexOf(this.ArrayType),x=2*n*this.ArrayType.BYTES_PER_ELEMENT,T=n*this.IndexArrayType.BYTES_PER_ELEMENT,I=(8-T%8)%8;if(w<0)throw new Error(`Unexpected typed array class: ${f}.`);g&&g instanceof ArrayBuffer?(this.data=g,this.ids=new this.IndexArrayType(this.data,8,n),this.coords=new this.ArrayType(this.data,8+T+I,2*n),this._pos=2*n,this._finished=!0):(this.data=new ArrayBuffer(8+x+T+I),this.ids=new this.IndexArrayType(this.data,8,n),this.coords=new this.ArrayType(this.data,8+T+I,2*n),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+w]),new Uint16Array(this.data,2,1)[0]=c,new Uint32Array(this.data,4,1)[0]=n)}add(n,c){const f=this._pos>>1;return this.ids[f]=f,this.coords[this._pos++]=n,this.coords[this._pos++]=c,f}finish(){const n=this._pos>>1;if(n!==this.numItems)throw new Error(`Added ${n} items when expected ${this.numItems}.`);return Of(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(n,c,f,g){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:w,coords:x,nodeSize:T}=this,I=[0,w.length-1,0],z=[];for(;I.length;){const N=I.pop()||0,V=I.pop()||0,X=I.pop()||0;if(V-X<=T){for(let ge=X;ge<=V;ge++){const xe=x[2*ge],Oe=x[2*ge+1];xe>=n&&xe<=f&&Oe>=c&&Oe<=g&&z.push(w[ge])}continue}const Y=X+V>>1,te=x[2*Y],ue=x[2*Y+1];te>=n&&te<=f&&ue>=c&&ue<=g&&z.push(w[Y]),(N===0?n<=te:c<=ue)&&(I.push(X),I.push(Y-1),I.push(1-N)),(N===0?f>=te:g>=ue)&&(I.push(Y+1),I.push(V),I.push(1-N))}return z}within(n,c,f){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:g,coords:w,nodeSize:x}=this,T=[0,g.length-1,0],I=[],z=f*f;for(;T.length;){const N=T.pop()||0,V=T.pop()||0,X=T.pop()||0;if(V-X<=x){for(let ge=X;ge<=V;ge++)vg(w[2*ge],w[2*ge+1],n,c)<=z&&I.push(g[ge]);continue}const Y=X+V>>1,te=w[2*Y],ue=w[2*Y+1];vg(te,ue,n,c)<=z&&I.push(g[Y]),(N===0?n-f<=te:c-f<=ue)&&(T.push(X),T.push(Y-1),T.push(1-N)),(N===0?n+f>=te:c+f>=ue)&&(T.push(Y+1),T.push(V),T.push(1-N))}return I}}function Of(s,n,c,f,g,w){if(g-f<=c)return;const x=f+g>>1;yg(s,n,x,f,g,w),Of(s,n,c,f,x-1,1-w),Of(s,n,c,x+1,g,1-w)}function yg(s,n,c,f,g,w){for(;g>f;){if(g-f>600){const z=g-f+1,N=c-f+1,V=Math.log(z),X=.5*Math.exp(2*V/3),Y=.5*Math.sqrt(V*X*(z-X)/z)*(N-z/2<0?-1:1);yg(s,n,c,Math.max(f,Math.floor(c-N*X/z+Y)),Math.min(g,Math.floor(c+(z-N)*X/z+Y)),w)}const x=n[2*c+w];let T=f,I=g;for(lu(s,n,f,c),n[2*g+w]>x&&lu(s,n,f,g);T<I;){for(lu(s,n,T,I),T++,I--;n[2*T+w]<x;)T++;for(;n[2*I+w]>x;)I--}n[2*f+w]===x?lu(s,n,f,I):(I++,lu(s,n,I,g)),I<=c&&(f=I+1),c<=I&&(g=I-1)}}function lu(s,n,c,f){Nf(s,c,f),Nf(n,2*c,2*f),Nf(n,2*c+1,2*f+1)}function Nf(s,n,c){const f=s[n];s[n]=s[c],s[c]=f}function vg(s,n,c,f){const g=s-c,w=n-f;return g*g+w*w}var jf;d.bd=void 0,(jf=d.bd||(d.bd={})).create="create",jf.load="load",jf.fullLoad="fullLoad";let td=null,cu=[];const Uf=1e3/60,Vf="loadTime",$f="fullLoadTime",Gv={mark(s){performance.mark(s)},frame(s){const n=s;td!=null&&cu.push(n-td),td=n},clearMetrics(){td=null,cu=[],performance.clearMeasures(Vf),performance.clearMeasures($f);for(const s in d.bd)performance.clearMarks(d.bd[s])},getPerformanceMetrics(){performance.measure(Vf,d.bd.create,d.bd.load),performance.measure($f,d.bd.create,d.bd.fullLoad);const s=performance.getEntriesByName(Vf)[0].duration,n=performance.getEntriesByName($f)[0].duration,c=cu.length,f=1/(cu.reduce((w,x)=>w+x,0)/c/1e3),g=cu.filter(w=>w>Uf).reduce((w,x)=>w+(x-Uf)/Uf,0);return{loadTime:s,fullLoadTime:n,fps:f,percentDroppedFrames:g/(c+g)*100,totalFrames:c}}};d.$=yt,d.A=Al,d.B=function(s){if(mt==null){const n=s.navigator?s.navigator.userAgent:null;mt=!!s.safari||!(!n||!(/\b(iPad|iPhone|iPod)\b/.test(n)||n.match("Safari")&&!n.match("Chrome")))}return mt},d.C=class{constructor(s,n){this.target=s,this.mapId=n,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new Bv(()=>this.process()),this.subscription=function(c,f,g,w){return c.addEventListener(f,g,!1),{unsubscribe:()=>{c.removeEventListener(f,g,!1)}}}(this.target,"message",c=>this.receive(c)),this.globalScope=xt(self)?s:window}registerMessageHandler(s,n){this.messageHandlers[s]=n}sendAsync(s,n){return new Promise((c,f)=>{const g=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[g]={resolve:c,reject:f},n&&n.signal.addEventListener("abort",()=>{delete this.resolveRejects[g];const T={id:g,type:"<cancel>",origin:location.origin,targetMapId:s.targetMapId,sourceMapId:this.mapId};this.target.postMessage(T)},{once:!0});const w=[],x=Object.assign(Object.assign({},s),{id:g,sourceMapId:this.mapId,origin:location.origin,data:js(s.data,w)});this.target.postMessage(x,{transfer:w})})}receive(s){const n=s.data,c=n.id;if(!(n.origin!=="file://"&&location.origin!=="file://"&&n.origin!==location.origin||n.targetMapId&&this.mapId!==n.targetMapId)){if(n.type==="<cancel>"){delete this.tasks[c];const f=this.abortControllers[c];return delete this.abortControllers[c],void(f&&f.abort())}if(xt(self)||n.mustQueue)return this.tasks[c]=n,this.taskQueue.push(c),void this.invoker.trigger();this.processTask(c,n)}}process(){if(this.taskQueue.length===0)return;const s=this.taskQueue.shift(),n=this.tasks[s];delete this.tasks[s],this.taskQueue.length>0&&this.invoker.trigger(),n&&this.processTask(s,n)}processTask(s,n){return a(this,void 0,void 0,function*(){if(n.type==="<response>"){const g=this.resolveRejects[s];return delete this.resolveRejects[s],g?void(n.error?g.reject(Us(n.error)):g.resolve(Us(n.data))):void 0}if(!this.messageHandlers[n.type])return void this.completeTask(s,new Error(`Could not find a registered handler for ${n.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const c=Us(n.data),f=new AbortController;this.abortControllers[s]=f;try{const g=yield this.messageHandlers[n.type](n.sourceMapId,c,f);this.completeTask(s,null,g)}catch(g){this.completeTask(s,g)}})}completeTask(s,n,c){const f=[];delete this.abortControllers[s];const g={id:s,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:n?js(n):null,data:js(c,f)};this.target.postMessage(g,{transfer:f})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},d.D=$t,d.E=vt,d.F=function(){var s=new Al(16);return Al!=Float32Array&&(s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=0,s[12]=0,s[13]=0,s[14]=0),s[0]=1,s[5]=1,s[10]=1,s[15]=1,s},d.G=Jt,d.H=function(s,n,c){var f,g,w,x,T,I,z,N,V,X,Y,te,ue=c[0],ge=c[1],xe=c[2];return n===s?(s[12]=n[0]*ue+n[4]*ge+n[8]*xe+n[12],s[13]=n[1]*ue+n[5]*ge+n[9]*xe+n[13],s[14]=n[2]*ue+n[6]*ge+n[10]*xe+n[14],s[15]=n[3]*ue+n[7]*ge+n[11]*xe+n[15]):(g=n[1],w=n[2],x=n[3],T=n[4],I=n[5],z=n[6],N=n[7],V=n[8],X=n[9],Y=n[10],te=n[11],s[0]=f=n[0],s[1]=g,s[2]=w,s[3]=x,s[4]=T,s[5]=I,s[6]=z,s[7]=N,s[8]=V,s[9]=X,s[10]=Y,s[11]=te,s[12]=f*ue+T*ge+V*xe+n[12],s[13]=g*ue+I*ge+X*xe+n[13],s[14]=w*ue+z*ge+Y*xe+n[14],s[15]=x*ue+N*ge+te*xe+n[15]),s},d.I=Sf,d.J=function(s,n,c){var f=c[0],g=c[1],w=c[2];return s[0]=n[0]*f,s[1]=n[1]*f,s[2]=n[2]*f,s[3]=n[3]*f,s[4]=n[4]*g,s[5]=n[5]*g,s[6]=n[6]*g,s[7]=n[7]*g,s[8]=n[8]*w,s[9]=n[9]*w,s[10]=n[10]*w,s[11]=n[11]*w,s[12]=n[12],s[13]=n[13],s[14]=n[14],s[15]=n[15],s},d.K=Qp,d.L=function(s,n){const c={};for(let f=0;f<n.length;f++){const g=n[f];g in s&&(c[g]=s[g])}return c},d.M=Ws,d.N=Hm,d.O=Xm,d.P=S,d.Q=co,d.R=lo,d.S=R,d.T=zc,d.U=F,d.V=ri,d.W=Sn,d.X=Ln,d.Y=Kh,d.Z=class extends Bc{},d._=a,d.a=ti,d.a$=function(s,n,c){return s[0]=n[0]*c[0],s[1]=n[1]*c[1],s[2]=n[2]*c[2],s[3]=n[3]*c[3],s},d.a0=Df,d.a1=nt,d.a2=s=>{const n=window.document.createElement("video");return n.muted=!0,new Promise(c=>{n.onloadstart=()=>{c(n)};for(const f of s){const g=window.document.createElement("source");ut(f)||(n.crossOrigin="Anonymous"),g.src=f,n.appendChild(g)}})},d.a3=function(){return Q++},d.a4=y,d.a5=Fl,d.a6=ul,d.a7=ps,d.a8=an,d.a9=tg,d.aA=re,d.aB=function(s,n){if(!s)return[{command:"setStyle",args:[n]}];let c=[];try{if(!Ye(s.version,n.version))return[{command:"setStyle",args:[n]}];Ye(s.center,n.center)||c.push({command:"setCenter",args:[n.center]}),Ye(s.zoom,n.zoom)||c.push({command:"setZoom",args:[n.zoom]}),Ye(s.bearing,n.bearing)||c.push({command:"setBearing",args:[n.bearing]}),Ye(s.pitch,n.pitch)||c.push({command:"setPitch",args:[n.pitch]}),Ye(s.sprite,n.sprite)||c.push({command:"setSprite",args:[n.sprite]}),Ye(s.glyphs,n.glyphs)||c.push({command:"setGlyphs",args:[n.glyphs]}),Ye(s.transition,n.transition)||c.push({command:"setTransition",args:[n.transition]}),Ye(s.light,n.light)||c.push({command:"setLight",args:[n.light]}),Ye(s.terrain,n.terrain)||c.push({command:"setTerrain",args:[n.terrain]}),Ye(s.sky,n.sky)||c.push({command:"setSky",args:[n.sky]});const f={},g=[];(function(x,T,I,z){let N;for(N in T=T||{},x=x||{})Object.prototype.hasOwnProperty.call(x,N)&&(Object.prototype.hasOwnProperty.call(T,N)||bi(N,I,z));for(N in T)Object.prototype.hasOwnProperty.call(T,N)&&(Object.prototype.hasOwnProperty.call(x,N)?Ye(x[N],T[N])||(x[N].type==="geojson"&&T[N].type==="geojson"&&Mn(x,T,N)?Ot(I,{command:"setGeoJSONSourceData",args:[N,T[N].data]}):gn(N,T,I,z)):Pi(N,T,I))})(s.sources,n.sources,g,f);const w=[];s.layers&&s.layers.forEach(x=>{"source"in x&&f[x.source]?c.push({command:"removeLayer",args:[x.id]}):w.push(x)}),c=c.concat(g),function(x,T,I){T=T||[];const z=(x=x||[]).map(io),N=T.map(io),V=x.reduce(Oi,{}),X=T.reduce(Oi,{}),Y=z.slice(),te=Object.create(null);let ue,ge,xe,Oe,Te;for(let De=0,Qe=0;De<z.length;De++)ue=z[De],Object.prototype.hasOwnProperty.call(X,ue)?Qe++:(Ot(I,{command:"removeLayer",args:[ue]}),Y.splice(Y.indexOf(ue,Qe),1));for(let De=0,Qe=0;De<N.length;De++)ue=N[N.length-1-De],Y[Y.length-1-De]!==ue&&(Object.prototype.hasOwnProperty.call(V,ue)?(Ot(I,{command:"removeLayer",args:[ue]}),Y.splice(Y.lastIndexOf(ue,Y.length-Qe),1)):Qe++,Oe=Y[Y.length-De],Ot(I,{command:"addLayer",args:[X[ue],Oe]}),Y.splice(Y.length-De,0,ue),te[ue]=!0);for(let De=0;De<N.length;De++)if(ue=N[De],ge=V[ue],xe=X[ue],!te[ue]&&!Ye(ge,xe))if(Ye(ge.source,xe.source)&&Ye(ge["source-layer"],xe["source-layer"])&&Ye(ge.type,xe.type)){for(Te in Qi(ge.layout,xe.layout,I,ue,null,"setLayoutProperty"),Qi(ge.paint,xe.paint,I,ue,null,"setPaintProperty"),Ye(ge.filter,xe.filter)||Ot(I,{command:"setFilter",args:[ue,xe.filter]}),Ye(ge.minzoom,xe.minzoom)&&Ye(ge.maxzoom,xe.maxzoom)||Ot(I,{command:"setLayerZoomRange",args:[ue,xe.minzoom,xe.maxzoom]}),ge)Object.prototype.hasOwnProperty.call(ge,Te)&&Te!=="layout"&&Te!=="paint"&&Te!=="filter"&&Te!=="metadata"&&Te!=="minzoom"&&Te!=="maxzoom"&&(Te.indexOf("paint.")===0?Qi(ge[Te],xe[Te],I,ue,Te.slice(6),"setPaintProperty"):Ye(ge[Te],xe[Te])||Ot(I,{command:"setLayerProperty",args:[ue,Te,xe[Te]]}));for(Te in xe)Object.prototype.hasOwnProperty.call(xe,Te)&&!Object.prototype.hasOwnProperty.call(ge,Te)&&Te!=="layout"&&Te!=="paint"&&Te!=="filter"&&Te!=="metadata"&&Te!=="minzoom"&&Te!=="maxzoom"&&(Te.indexOf("paint.")===0?Qi(ge[Te],xe[Te],I,ue,Te.slice(6),"setPaintProperty"):Ye(ge[Te],xe[Te])||Ot(I,{command:"setLayerProperty",args:[ue,Te,xe[Te]]}))}else Ot(I,{command:"removeLayer",args:[ue]}),Oe=Y[Y.lastIndexOf(ue)+1],Ot(I,{command:"addLayer",args:[xe,Oe]})}(w,n.layers,c)}catch(f){console.warn("Unable to compute style diff:",f),c=[{command:"setStyle",args:[n]}]}return c},d.aC=function(s){const n=[],c=s.id;return c===void 0&&n.push({message:`layers.${c}: missing required property "id"`}),s.render===void 0&&n.push({message:`layers.${c}: missing required method "render"`}),s.renderingMode&&s.renderingMode!=="2d"&&s.renderingMode!=="3d"&&n.push({message:`layers.${c}: property "renderingMode" must be either "2d" or "3d"`}),n},d.aD=function s(n,c){if(Array.isArray(n)){if(!Array.isArray(c)||n.length!==c.length)return!1;for(let f=0;f<n.length;f++)if(!s(n[f],c[f]))return!1;return!0}if(typeof n=="object"&&n!==null&&c!==null){if(typeof c!="object"||Object.keys(n).length!==Object.keys(c).length)return!1;for(const f in n)if(!s(n[f],c[f]))return!1;return!0}return n===c},d.aE=ye,d.aF=Ne,d.aG=class extends Zn{constructor(s,n){super(s,n),this.current=0}set(s){this.current!==s&&(this.current=s,this.gl.uniform1i(this.location,s))}},d.aH=Or,d.aI=class extends Zn{constructor(s,n){super(s,n),this.current=Aa}set(s){if(s[12]!==this.current[12]||s[0]!==this.current[0])return this.current=s,void this.gl.uniformMatrix4fv(this.location,!1,s);for(let n=1;n<16;n++)if(s[n]!==this.current[n]){this.current=s,this.gl.uniformMatrix4fv(this.location,!1,s);break}}},d.aJ=wo,d.aK=class extends Zn{constructor(s,n){super(s,n),this.current=[0,0,0]}set(s){s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]||(this.current=s,this.gl.uniform3f(this.location,s[0],s[1],s[2]))}},d.aL=class extends Zn{constructor(s,n){super(s,n),this.current=[0,0]}set(s){s[0]===this.current[0]&&s[1]===this.current[1]||(this.current=s,this.gl.uniform2f(this.location,s[0],s[1]))}},d.aM=Yo,d.aN=function(s,n,c,f,g,w,x){var T=1/(n-c),I=1/(f-g),z=1/(w-x);return s[0]=-2*T,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=-2*I,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=2*z,s[11]=0,s[12]=(n+c)*T,s[13]=(g+f)*I,s[14]=(x+w)*z,s[15]=1,s},d.aO=ji,d.aP=g1,d.aQ=class extends kl{},d.aR=uv,d.aS=class extends Sl{},d.aT=function(s){return s<=1?1:Math.pow(2,Math.ceil(Math.log(s)/Math.LN2))},d.aU=rm,d.aV=q,d.aW=class extends Vc{},d.aX=Xe,d.aY=function(s,n){return s[0]===n[0]&&s[1]===n[1]&&s[2]===n[2]&&s[3]===n[3]&&s[4]===n[4]&&s[5]===n[5]&&s[6]===n[6]&&s[7]===n[7]&&s[8]===n[8]&&s[9]===n[9]&&s[10]===n[10]&&s[11]===n[11]&&s[12]===n[12]&&s[13]===n[13]&&s[14]===n[14]&&s[15]===n[15]},d.aZ=function(s,n){var c=s[0],f=s[1],g=s[2],w=s[3],x=s[4],T=s[5],I=s[6],z=s[7],N=s[8],V=s[9],X=s[10],Y=s[11],te=s[12],ue=s[13],ge=s[14],xe=s[15],Oe=n[0],Te=n[1],De=n[2],Qe=n[3],tt=n[4],Mt=n[5],Ft=n[6],Et=n[7],kt=n[8],gt=n[9],Pt=n[10],wt=n[11],ct=n[12],Zt=n[13],jt=n[14],_i=n[15];return Math.abs(c-Oe)<=Tr*Math.max(1,Math.abs(c),Math.abs(Oe))&&Math.abs(f-Te)<=Tr*Math.max(1,Math.abs(f),Math.abs(Te))&&Math.abs(g-De)<=Tr*Math.max(1,Math.abs(g),Math.abs(De))&&Math.abs(w-Qe)<=Tr*Math.max(1,Math.abs(w),Math.abs(Qe))&&Math.abs(x-tt)<=Tr*Math.max(1,Math.abs(x),Math.abs(tt))&&Math.abs(T-Mt)<=Tr*Math.max(1,Math.abs(T),Math.abs(Mt))&&Math.abs(I-Ft)<=Tr*Math.max(1,Math.abs(I),Math.abs(Ft))&&Math.abs(z-Et)<=Tr*Math.max(1,Math.abs(z),Math.abs(Et))&&Math.abs(N-kt)<=Tr*Math.max(1,Math.abs(N),Math.abs(kt))&&Math.abs(V-gt)<=Tr*Math.max(1,Math.abs(V),Math.abs(gt))&&Math.abs(X-Pt)<=Tr*Math.max(1,Math.abs(X),Math.abs(Pt))&&Math.abs(Y-wt)<=Tr*Math.max(1,Math.abs(Y),Math.abs(wt))&&Math.abs(te-ct)<=Tr*Math.max(1,Math.abs(te),Math.abs(ct))&&Math.abs(ue-Zt)<=Tr*Math.max(1,Math.abs(ue),Math.abs(Zt))&&Math.abs(ge-jt)<=Tr*Math.max(1,Math.abs(ge),Math.abs(jt))&&Math.abs(xe-_i)<=Tr*Math.max(1,Math.abs(xe),Math.abs(_i))},d.a_=function(s,n){return s[0]=n[0],s[1]=n[1],s[2]=n[2],s[3]=n[3],s[4]=n[4],s[5]=n[5],s[6]=n[6],s[7]=n[7],s[8]=n[8],s[9]=n[9],s[10]=n[10],s[11]=n[11],s[12]=n[12],s[13]=n[13],s[14]=n[14],s[15]=n[15],s},d.aa=function(s){const n={};if(s.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(c,f,g,w)=>{const x=g||w;return n[f]=!x||x.toLowerCase(),""}),n["max-age"]){const c=parseInt(n["max-age"],10);isNaN(c)?delete n["max-age"]:n["max-age"]=c}return n},d.ab=function(s,n){const c=[];for(const f in s)f in n||c.push(f);return c},d.ac=le,d.ad=function(s,n,c){var f=Math.sin(c),g=Math.cos(c),w=n[0],x=n[1],T=n[2],I=n[3],z=n[4],N=n[5],V=n[6],X=n[7];return n!==s&&(s[8]=n[8],s[9]=n[9],s[10]=n[10],s[11]=n[11],s[12]=n[12],s[13]=n[13],s[14]=n[14],s[15]=n[15]),s[0]=w*g+z*f,s[1]=x*g+N*f,s[2]=T*g+V*f,s[3]=I*g+X*f,s[4]=z*g-w*f,s[5]=N*g-x*f,s[6]=V*g-T*f,s[7]=X*g-I*f,s},d.ae=function(s){var n=new Al(16);return n[0]=s[0],n[1]=s[1],n[2]=s[2],n[3]=s[3],n[4]=s[4],n[5]=s[5],n[6]=s[6],n[7]=s[7],n[8]=s[8],n[9]=s[9],n[10]=s[10],n[11]=s[11],n[12]=s[12],n[13]=s[13],n[14]=s[14],n[15]=s[15],n},d.af=Nh,d.ag=function(s,n){let c=0,f=0;if(s.kind==="constant")f=s.layoutSize;else if(s.kind!=="source"){const{interpolationType:g,minZoom:w,maxZoom:x}=s,T=g?le(rr.interpolationFactor(g,n,w,x),0,1):0;s.kind==="camera"?f=dr.number(s.minSize,s.maxSize,T):c=T}return{uSizeT:c,uSize:f}},d.ai=function(s,{uSize:n,uSizeT:c},{lowerSize:f,upperSize:g}){return s.kind==="source"?f/ts:s.kind==="composite"?dr.number(f/ts,g/ts,c):n},d.aj=Mf,d.ak=function(s,n,c,f){const g=n.y-s.y,w=n.x-s.x,x=f.y-c.y,T=f.x-c.x,I=x*w-T*g;if(I===0)return null;const z=(T*(s.y-c.y)-x*(s.x-c.x))/I;return new S(s.x+z*w,s.y+z*g)},d.al=og,d.am=qc,d.an=af,d.ao=Gn,d.aq=Ef,d.ar=function(s,n){var c=n[0],f=n[1],g=n[2],w=n[3],x=n[4],T=n[5],I=n[6],z=n[7],N=n[8],V=n[9],X=n[10],Y=n[11],te=n[12],ue=n[13],ge=n[14],xe=n[15],Oe=c*T-f*x,Te=c*I-g*x,De=c*z-w*x,Qe=f*I-g*T,tt=f*z-w*T,Mt=g*z-w*I,Ft=N*ue-V*te,Et=N*ge-X*te,kt=N*xe-Y*te,gt=V*ge-X*ue,Pt=V*xe-Y*ue,wt=X*xe-Y*ge,ct=Oe*wt-Te*Pt+De*gt+Qe*kt-tt*Et+Mt*Ft;return ct?(s[0]=(T*wt-I*Pt+z*gt)*(ct=1/ct),s[1]=(g*Pt-f*wt-w*gt)*ct,s[2]=(ue*Mt-ge*tt+xe*Qe)*ct,s[3]=(X*tt-V*Mt-Y*Qe)*ct,s[4]=(I*kt-x*wt-z*Et)*ct,s[5]=(c*wt-g*kt+w*Et)*ct,s[6]=(ge*De-te*Mt-xe*Te)*ct,s[7]=(N*Mt-X*De+Y*Te)*ct,s[8]=(x*Pt-T*kt+z*Ft)*ct,s[9]=(f*kt-c*Pt-w*Ft)*ct,s[10]=(te*tt-ue*De+xe*Oe)*ct,s[11]=(V*De-N*tt-Y*Oe)*ct,s[12]=(T*Et-x*gt-I*Ft)*ct,s[13]=(c*gt-f*Et+g*Ft)*ct,s[14]=(ue*Te-te*Qe-ge*Oe)*ct,s[15]=(N*Qe-V*Te+X*Oe)*ct,s):null},d.as=Bf,d.at=Cf,d.au=Ff,d.av=function(){const s={},n=we.$version;for(const c in we.$root){const f=we.$root[c];if(f.required){let g=null;g=c==="version"?n:f.type==="array"?[]:{},g!=null&&(s[c]=g)}}return s},d.aw=Th,d.ax=zi,d.ay=function(s){s=s.slice();const n=Object.create(null);for(let c=0;c<s.length;c++)n[s[c].id]=s[c];for(let c=0;c<s.length;c++)"ref"in s[c]&&(s[c]=qe(s[c],n[s[c].ref]));return s},d.az=function(s){if(s.type==="custom")return new Rv(s);switch(s.type){case"background":return new Pv(s);case"circle":return new _1(s);case"fill":return new F1(s);case"fill-extrusion":return new Y1(s);case"heatmap":return new v1(s);case"hillshade":return new w1(s);case"line":return new sv(s);case"raster":return new Dv(s);case"symbol":return new Xh(s)}},d.b=at,d.b0=function(s,n){return s[0]*n[0]+s[1]*n[1]+s[2]*n[2]+s[3]*n[3]},d.b1=he,d.b2=Ym,d.b3=Km,d.b4=function(s,n,c,f,g){var w,x=1/Math.tan(n/2);return s[0]=x/c,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=x,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=-1,s[12]=0,s[13]=0,s[15]=0,g!=null&&g!==1/0?(s[10]=(g+f)*(w=1/(f-g)),s[14]=2*g*f*w):(s[10]=-1,s[14]=-2*f),s},d.b5=function(s,n,c){var f=Math.sin(c),g=Math.cos(c),w=n[4],x=n[5],T=n[6],I=n[7],z=n[8],N=n[9],V=n[10],X=n[11];return n!==s&&(s[0]=n[0],s[1]=n[1],s[2]=n[2],s[3]=n[3],s[12]=n[12],s[13]=n[13],s[14]=n[14],s[15]=n[15]),s[4]=w*g+z*f,s[5]=x*g+N*f,s[6]=T*g+V*f,s[7]=I*g+X*f,s[8]=z*g-w*f,s[9]=N*g-x*f,s[10]=V*g-T*f,s[11]=X*g-I*f,s},d.b6=j,d.b7=U,d.b8=function(s){return s*Math.PI/180},d.b9=function(s,n){return s[0]=n[0],s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=n[1],s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=n[2],s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s},d.bA=Jo,d.ba=class extends zo{},d.bb=Pf,d.bc=Gv,d.be=gi,d.bf=function(s,n){ti.REGISTERED_PROTOCOLS[s]=n},d.bg=function(s){delete ti.REGISTERED_PROTOCOLS[s]},d.bh=function(s,n){const c={};for(let g=0;g<s.length;g++){const w=n&&n[s[g].id]||tf(s[g]);n&&(n[s[g].id]=w);let x=c[w];x||(x=c[w]=[]),x.push(s[g])}const f=[];for(const g in c)f.push(c[g]);return f},d.bi=Lt,d.bj=eg,d.bk=ig,d.bl=Dm,d.bm=function(s){s.bucket.createArrays(),s.bucket.tilePixelRatio=Sn/(512*s.bucket.overscaling),s.bucket.compareText={},s.bucket.iconsNeedLinear=!1;const n=s.bucket.layers[0],c=n.layout,f=n._unevaluatedLayout._values,g={layoutIconSize:f["icon-size"].possiblyEvaluate(new an(s.bucket.zoom+1),s.canonical),layoutTextSize:f["text-size"].possiblyEvaluate(new an(s.bucket.zoom+1),s.canonical),textMaxSize:f["text-size"].possiblyEvaluate(new an(18))};if(s.bucket.textSizeData.kind==="composite"){const{minZoom:z,maxZoom:N}=s.bucket.textSizeData;g.compositeTextSizes=[f["text-size"].possiblyEvaluate(new an(z),s.canonical),f["text-size"].possiblyEvaluate(new an(N),s.canonical)]}if(s.bucket.iconSizeData.kind==="composite"){const{minZoom:z,maxZoom:N}=s.bucket.iconSizeData;g.compositeIconSizes=[f["icon-size"].possiblyEvaluate(new an(z),s.canonical),f["icon-size"].possiblyEvaluate(new an(N),s.canonical)]}const w=c.get("text-line-height")*Gn,x=c.get("text-rotation-alignment")!=="viewport"&&c.get("symbol-placement")!=="point",T=c.get("text-keep-upright"),I=c.get("text-size");for(const z of s.bucket.features){const N=c.get("text-font").evaluate(z,{},s.canonical).join(","),V=I.evaluate(z,{},s.canonical),X=g.layoutTextSize.evaluate(z,{},s.canonical),Y=g.layoutIconSize.evaluate(z,{},s.canonical),te={horizontal:{},vertical:void 0},ue=z.text;let ge,xe=[0,0];if(ue){const De=ue.toString(),Qe=c.get("text-letter-spacing").evaluate(z,{},s.canonical)*Gn,tt=Ch(De)?Qe:0,Mt=c.get("text-anchor").evaluate(z,{},s.canonical),Ft=pg(n,z,s.canonical);if(!Ft){const wt=c.get("text-radial-offset").evaluate(z,{},s.canonical);xe=wt?fg(Mt,[wt*Gn,Rf]):c.get("text-offset").evaluate(z,{},s.canonical).map(ct=>ct*Gn)}let Et=x?"center":c.get("text-justify").evaluate(z,{},s.canonical);const kt=c.get("symbol-placement"),gt=kt==="point"?c.get("text-max-width").evaluate(z,{},s.canonical)*Gn:0,Pt=()=>{s.bucket.allowVerticalPlacement&&Vs(De)&&(te.vertical=Gh(ue,s.glyphMap,s.glyphPositions,s.imagePositions,N,gt,w,Mt,"left",tt,xe,d.ah.vertical,!0,kt,X,V))};if(!x&&Ft){const wt=new Set;if(Et==="auto")for(let Zt=0;Zt<Ft.values.length;Zt+=2)wt.add(Bf(Ft.values[Zt]));else wt.add(Et);let ct=!1;for(const Zt of wt)if(!te.horizontal[Zt])if(ct)te.horizontal[Zt]=te.horizontal[0];else{const jt=Gh(ue,s.glyphMap,s.glyphPositions,s.imagePositions,N,gt,w,"center",Zt,tt,xe,d.ah.horizontal,!1,kt,X,V);jt&&(te.horizontal[Zt]=jt,ct=jt.positionedLines.length===1)}Pt()}else{Et==="auto"&&(Et=Bf(Mt));const wt=Gh(ue,s.glyphMap,s.glyphPositions,s.imagePositions,N,gt,w,Mt,Et,tt,xe,d.ah.horizontal,!1,kt,X,V);wt&&(te.horizontal[Et]=wt),Pt(),Vs(De)&&x&&T&&(te.vertical=Gh(ue,s.glyphMap,s.glyphPositions,s.imagePositions,N,gt,w,Mt,Et,tt,xe,d.ah.vertical,!1,kt,X,V))}}let Oe=!1;if(z.icon&&z.icon.name){const De=s.imageMap[z.icon.name];De&&(ge=Ev(s.imagePositions[z.icon.name],c.get("icon-offset").evaluate(z,{},s.canonical),c.get("icon-anchor").evaluate(z,{},s.canonical)),Oe=!!De.sdf,s.bucket.sdfIcons===void 0?s.bucket.sdfIcons=Oe:s.bucket.sdfIcons!==Oe&&Ke("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(De.pixelRatio!==s.bucket.pixelRatio||c.get("icon-rotate").constantOr(1)!==0)&&(s.bucket.iconsNeedLinear=!0))}const Te=gg(te.horizontal)||te.vertical;s.bucket.iconsInText=!!Te&&Te.iconsInText,(Te||ge)&&qv(s.bucket,z,te,ge,s.imageMap,g,X,Y,xe,Oe,s.canonical)}s.showCollisionBoxes&&s.bucket.generateCollisionDebugBuffers()},d.bn=bf,d.bo=_f,d.bp=vf,d.bq=qs,d.br=xf,d.bs=class{constructor(s){this._marks={start:[s.url,"start"].join("#"),end:[s.url,"end"].join("#"),measure:s.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let s=performance.getEntriesByName(this._marks.measure);return s.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),s=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),s}},d.bt=function(s,n,c,f,g){return a(this,void 0,void 0,function*(){if(F())try{return yield ri(s,n,c,f,g)}catch{}return function(w,x,T,I,z){const N=w.width,V=w.height;Nt&&At||(Nt=new OffscreenCanvas(N,V),At=Nt.getContext("2d",{willReadFrequently:!0})),Nt.width=N,Nt.height=V,At.drawImage(w,0,0,N,V);const X=At.getImageData(x,T,I,z);return At.clearRect(0,0,N,V),X.data}(s,n,c,f,g)})},d.bu=Qm,d.bv=_,d.bw=v,d.bx=Tm,d.by=ls,d.bz=function(s){return s.message===ei},d.c=ci,d.d=s=>a(void 0,void 0,void 0,function*(){if(s.byteLength===0)return createImageBitmap(new ImageData(1,1));const n=new Blob([new Uint8Array(s)],{type:"image/png"});try{return createImageBitmap(n)}catch(c){throw new Error(`Could not load image because of ${c.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),d.e=Z,d.f=s=>new Promise((n,c)=>{const f=new Image;f.onload=()=>{n(f),URL.revokeObjectURL(f.src),f.onload=null,window.requestAnimationFrame(()=>{f.src=Ht})},f.onerror=()=>c(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const g=new Blob([new Uint8Array(s)],{type:"image/png"});f.src=s.byteLength?URL.createObjectURL(g):Ht}),d.g=ft,d.h=(s,n)=>Fi(Z(s,{type:"json"}),n),d.i=xt,d.j=ht,d.k=je,d.l=(s,n)=>Fi(Z(s,{type:"arrayBuffer"}),n),d.m=Fi,d.n=function(s){return new xf(s).readFields(wv,[])},d.o=Kc,d.p=zm,d.q=Sr,d.r=nf,d.s=ut,d.t=Ns,d.u=Ct,d.v=we,d.w=Ke,d.x=us,d.y=function([s,n,c]){return n+=90,n*=Math.PI/180,c*=Math.PI/180,{x:s*Math.cos(n)*Math.sin(c),y:s*Math.sin(n)*Math.sin(c),z:s*Math.cos(c)}},d.z=dr}),l("worker",["./shared"],function(d){class a{constructor(H){this.keyCache={},H&&this.replace(H)}replace(H){this._layerConfigs={},this._layers={},this.update(H,[])}update(H,K){for(const de of H){this._layerConfigs[de.id]=de;const Pe=this._layers[de.id]=d.az(de);Pe._featureFilter=d.a6(Pe.filter),this.keyCache[de.id]&&delete this.keyCache[de.id]}for(const de of K)delete this.keyCache[de],delete this._layerConfigs[de],delete this._layers[de];this.familiesBySource={};const ie=d.bh(Object.values(this._layerConfigs),this.keyCache);for(const de of ie){const Pe=de.map($e=>this._layers[$e.id]),ze=Pe[0];if(ze.visibility==="none")continue;const Be=ze.source||"";let Se=this.familiesBySource[Be];Se||(Se=this.familiesBySource[Be]={});const W=ze.sourceLayer||"_geojsonTileLayer";let Ue=Se[W];Ue||(Ue=Se[W]=[]),Ue.push(Pe)}}}class _{constructor(H){const K={},ie=[];for(const Be in H){const Se=H[Be],W=K[Be]={};for(const Ue in Se){const $e=Se[+Ue];if(!$e||$e.bitmap.width===0||$e.bitmap.height===0)continue;const Ge={x:0,y:0,w:$e.bitmap.width+2,h:$e.bitmap.height+2};ie.push(Ge),W[Ue]={rect:Ge,metrics:$e.metrics}}}const{w:de,h:Pe}=d.p(ie),ze=new d.o({width:de||1,height:Pe||1});for(const Be in H){const Se=H[Be];for(const W in Se){const Ue=Se[+W];if(!Ue||Ue.bitmap.width===0||Ue.bitmap.height===0)continue;const $e=K[Be][W].rect;d.o.copy(Ue.bitmap,ze,{x:0,y:0},{x:$e.x+1,y:$e.y+1},Ue.bitmap)}}this.image=ze,this.positions=K}}d.bi("GlyphAtlas",_);class v{constructor(H){this.tileID=new d.Q(H.tileID.overscaledZ,H.tileID.wrap,H.tileID.canonical.z,H.tileID.canonical.x,H.tileID.canonical.y),this.uid=H.uid,this.zoom=H.zoom,this.pixelRatio=H.pixelRatio,this.tileSize=H.tileSize,this.source=H.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=H.showCollisionBoxes,this.collectResourceTiming=!!H.collectResourceTiming,this.returnDependencies=!!H.returnDependencies,this.promoteId=H.promoteId,this.inFlightDependencies=[]}parse(H,K,ie,de){return d._(this,void 0,void 0,function*(){this.status="parsing",this.data=H,this.collisionBoxArray=new d.a4;const Pe=new d.bj(Object.keys(H.layers).sort()),ze=new d.bk(this.tileID,this.promoteId);ze.bucketLayerIDs=[];const Be={},Se={featureIndex:ze,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:ie},W=K.familiesBySource[this.source];for(const hi in W){const yn=H.layers[hi];if(!yn)continue;yn.version===1&&d.w(`Vector tile source "${this.source}" layer "${hi}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const $n=Pe.encode(hi),hr=[];for(let wr=0;wr<yn.length;wr++){const Qn=yn.feature(wr),go=ze.getId(Qn,hi);hr.push({feature:Qn,id:go,index:wr,sourceLayerIndex:$n})}for(const wr of W[hi]){const Qn=wr[0];Qn.source!==this.source&&d.w(`layer.source = ${Qn.source} does not equal this.source = ${this.source}`),Qn.minzoom&&this.zoom<Math.floor(Qn.minzoom)||Qn.maxzoom&&this.zoom>=Qn.maxzoom||Qn.visibility!=="none"&&(k(wr,this.zoom,ie),(Be[Qn.id]=Qn.createBucket({index:ze.bucketLayerIDs.length,layers:wr,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:$n,sourceID:this.source})).populate(hr,Se,this.tileID.canonical),ze.bucketLayerIDs.push(wr.map(go=>go.id)))}}const Ue=d.aE(Se.glyphDependencies,hi=>Object.keys(hi).map(Number));this.inFlightDependencies.forEach(hi=>hi==null?void 0:hi.abort()),this.inFlightDependencies=[];let $e=Promise.resolve({});if(Object.keys(Ue).length){const hi=new AbortController;this.inFlightDependencies.push(hi),$e=de.sendAsync({type:"GG",data:{stacks:Ue,source:this.source,tileID:this.tileID,type:"glyphs"}},hi)}const Ge=Object.keys(Se.iconDependencies);let Je=Promise.resolve({});if(Ge.length){const hi=new AbortController;this.inFlightDependencies.push(hi),Je=de.sendAsync({type:"GI",data:{icons:Ge,source:this.source,tileID:this.tileID,type:"icons"}},hi)}const dt=Object.keys(Se.patternDependencies);let Bt=Promise.resolve({});if(dt.length){const hi=new AbortController;this.inFlightDependencies.push(hi),Bt=de.sendAsync({type:"GI",data:{icons:dt,source:this.source,tileID:this.tileID,type:"patterns"}},hi)}const[Xt,ui,wi]=yield Promise.all([$e,Je,Bt]),sn=new _(Xt),Rn=new d.bl(ui,wi);for(const hi in Be){const yn=Be[hi];yn instanceof d.a5?(k(yn.layers,this.zoom,ie),d.bm({bucket:yn,glyphMap:Xt,glyphPositions:sn.positions,imageMap:ui,imagePositions:Rn.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):yn.hasPattern&&(yn instanceof d.bn||yn instanceof d.bo||yn instanceof d.bp)&&(k(yn.layers,this.zoom,ie),yn.addFeatures(Se,this.tileID.canonical,Rn.patternPositions))}return this.status="done",{buckets:Object.values(Be).filter(hi=>!hi.isEmpty()),featureIndex:ze,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:sn.image,imageAtlas:Rn,glyphMap:this.returnDependencies?Xt:null,iconMap:this.returnDependencies?ui:null,glyphPositions:this.returnDependencies?sn.positions:null}})}}function k(me,H,K){const ie=new d.a8(H);for(const de of me)de.recalculate(ie,K)}class S{constructor(H,K,ie){this.actor=H,this.layerIndex=K,this.availableImages=ie,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(H,K){return d._(this,void 0,void 0,function*(){const ie=yield d.l(H.request,K);try{return{vectorTile:new d.bq.VectorTile(new d.br(ie.data)),rawData:ie.data,cacheControl:ie.cacheControl,expires:ie.expires}}catch(de){const Pe=new Uint8Array(ie.data);let ze=`Unable to parse the tile at ${H.request.url}, `;throw ze+=Pe[0]===31&&Pe[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${de.messge}`,new Error(ze)}})}loadTile(H){return d._(this,void 0,void 0,function*(){const K=H.uid,ie=!!(H&&H.request&&H.request.collectResourceTiming)&&new d.bs(H.request),de=new v(H);this.loading[K]=de;const Pe=new AbortController;de.abort=Pe;try{const ze=yield this.loadVectorTile(H,Pe);if(delete this.loading[K],!ze)return null;const Be=ze.rawData,Se={};ze.expires&&(Se.expires=ze.expires),ze.cacheControl&&(Se.cacheControl=ze.cacheControl);const W={};if(ie){const $e=ie.finish();$e&&(W.resourceTiming=JSON.parse(JSON.stringify($e)))}de.vectorTile=ze.vectorTile;const Ue=de.parse(ze.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[K]=de,this.fetching[K]={rawTileData:Be,cacheControl:Se,resourceTiming:W};try{const $e=yield Ue;return d.e({rawTileData:Be.slice(0)},$e,Se,W)}finally{delete this.fetching[K]}}catch(ze){throw delete this.loading[K],de.status="done",this.loaded[K]=de,ze}})}reloadTile(H){return d._(this,void 0,void 0,function*(){const K=H.uid;if(!this.loaded||!this.loaded[K])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const ie=this.loaded[K];if(ie.showCollisionBoxes=H.showCollisionBoxes,ie.status==="parsing"){const de=yield ie.parse(ie.vectorTile,this.layerIndex,this.availableImages,this.actor);let Pe;if(this.fetching[K]){const{rawTileData:ze,cacheControl:Be,resourceTiming:Se}=this.fetching[K];delete this.fetching[K],Pe=d.e({rawTileData:ze.slice(0)},de,Be,Se)}else Pe=de;return Pe}if(ie.status==="done"&&ie.vectorTile)return ie.parse(ie.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(H){return d._(this,void 0,void 0,function*(){const K=this.loading,ie=H.uid;K&&K[ie]&&K[ie].abort&&(K[ie].abort.abort(),delete K[ie])})}removeTile(H){return d._(this,void 0,void 0,function*(){this.loaded&&this.loaded[H.uid]&&delete this.loaded[H.uid]})}}class E{constructor(){this.loaded={}}loadTile(H){return d._(this,void 0,void 0,function*(){const{uid:K,encoding:ie,rawImageData:de,redFactor:Pe,greenFactor:ze,blueFactor:Be,baseShift:Se}=H,W=de.width+2,Ue=de.height+2,$e=d.b(de)?new d.R({width:W,height:Ue},yield d.bt(de,-1,-1,W,Ue)):de,Ge=new d.bu(K,$e,ie,Pe,ze,Be,Se);return this.loaded=this.loaded||{},this.loaded[K]=Ge,Ge})}removeTile(H){const K=this.loaded,ie=H.uid;K&&K[ie]&&delete K[ie]}}function A(me,H){if(me.length!==0){D(me[0],H);for(var K=1;K<me.length;K++)D(me[K],!H)}}function D(me,H){for(var K=0,ie=0,de=0,Pe=me.length,ze=Pe-1;de<Pe;ze=de++){var Be=(me[de][0]-me[ze][0])*(me[ze][1]+me[de][1]),Se=K+Be;ie+=Math.abs(K)>=Math.abs(Be)?K-Se+Be:Be-Se+K,K=Se}K+ie>=0!=!!H&&me.reverse()}var B=d.bv(function me(H,K){var ie,de=H&&H.type;if(de==="FeatureCollection")for(ie=0;ie<H.features.length;ie++)me(H.features[ie],K);else if(de==="GeometryCollection")for(ie=0;ie<H.geometries.length;ie++)me(H.geometries[ie],K);else if(de==="Feature")me(H.geometry,K);else if(de==="Polygon")A(H.coordinates,K);else if(de==="MultiPolygon")for(ie=0;ie<H.coordinates.length;ie++)A(H.coordinates[ie],K);return H});const P=d.bq.VectorTileFeature.prototype.toGeoJSON;var R={exports:{}},F=d.bw,j=d.bq.VectorTileFeature,U=le;function le(me,H){this.options=H||{},this.features=me,this.length=me.length}function he(me,H){this.id=typeof me.id=="number"?me.id:void 0,this.type=me.type,this.rawGeometry=me.type===1?[me.geometry]:me.geometry,this.properties=me.tags,this.extent=H||4096}le.prototype.feature=function(me){return new he(this.features[me],this.options.extent)},he.prototype.loadGeometry=function(){var me=this.rawGeometry;this.geometry=[];for(var H=0;H<me.length;H++){for(var K=me[H],ie=[],de=0;de<K.length;de++)ie.push(new F(K[de][0],K[de][1]));this.geometry.push(ie)}return this.geometry},he.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var me=this.geometry,H=1/0,K=-1/0,ie=1/0,de=-1/0,Pe=0;Pe<me.length;Pe++)for(var ze=me[Pe],Be=0;Be<ze.length;Be++){var Se=ze[Be];H=Math.min(H,Se.x),K=Math.max(K,Se.x),ie=Math.min(ie,Se.y),de=Math.max(de,Se.y)}return[H,ie,K,de]},he.prototype.toGeoJSON=j.prototype.toGeoJSON;var Z=d.bx,Q=U;function ye(me){var H=new Z;return function(K,ie){for(var de in K.layers)ie.writeMessage(3,Ne,K.layers[de])}(me,H),H.finish()}function Ne(me,H){var K;H.writeVarintField(15,me.version||1),H.writeStringField(1,me.name||""),H.writeVarintField(5,me.extent||4096);var ie={keys:[],values:[],keycache:{},valuecache:{}};for(K=0;K<me.length;K++)ie.feature=me.feature(K),H.writeMessage(2,re,ie);var de=ie.keys;for(K=0;K<de.length;K++)H.writeStringField(3,de[K]);var Pe=ie.values;for(K=0;K<Pe.length;K++)H.writeMessage(4,xt,Pe[K])}function re(me,H){var K=me.feature;K.id!==void 0&&H.writeVarintField(1,K.id),H.writeMessage(2,ve,me),H.writeVarintField(3,K.type),H.writeMessage(4,et,K)}function ve(me,H){var K=me.feature,ie=me.keys,de=me.values,Pe=me.keycache,ze=me.valuecache;for(var Be in K.properties){var Se=K.properties[Be],W=Pe[Be];if(Se!==null){W===void 0&&(ie.push(Be),Pe[Be]=W=ie.length-1),H.writeVarint(W);var Ue=typeof Se;Ue!=="string"&&Ue!=="boolean"&&Ue!=="number"&&(Se=JSON.stringify(Se));var $e=Ue+":"+Se,Ge=ze[$e];Ge===void 0&&(de.push(Se),ze[$e]=Ge=de.length-1),H.writeVarint(Ge)}}}function Ke(me,H){return(H<<3)+(7&me)}function Le(me){return me<<1^me>>31}function et(me,H){for(var K=me.loadGeometry(),ie=me.type,de=0,Pe=0,ze=K.length,Be=0;Be<ze;Be++){var Se=K[Be],W=1;ie===1&&(W=Se.length),H.writeVarint(Ke(1,W));for(var Ue=ie===3?Se.length-1:Se.length,$e=0;$e<Ue;$e++){$e===1&&ie!==1&&H.writeVarint(Ke(2,Ue-1));var Ge=Se[$e].x-de,Je=Se[$e].y-Pe;H.writeVarint(Le(Ge)),H.writeVarint(Le(Je)),de+=Ge,Pe+=Je}ie===3&&H.writeVarint(Ke(7,1))}}function xt(me,H){var K=typeof me;K==="string"?H.writeStringField(1,me):K==="boolean"?H.writeBooleanField(7,me):K==="number"&&(me%1!=0?H.writeDoubleField(3,me):me<0?H.writeSVarintField(6,me):H.writeVarintField(5,me))}R.exports=ye,R.exports.fromVectorTileJs=ye,R.exports.fromGeojsonVt=function(me,H){H=H||{};var K={};for(var ie in me)K[ie]=new Q(me[ie].features,H),K[ie].name=ie,K[ie].version=H.version,K[ie].extent=H.extent;return ye({layers:K})},R.exports.GeoJSONWrapper=Q;var mt=d.bv(R.exports);const at={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:me=>me},Ht=Math.fround||(ri=new Float32Array(1),me=>(ri[0]=+me,ri[0]));var ri;const Nt=3,At=5,ei=6;class ci{constructor(H){this.options=Object.assign(Object.create(at),H),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(H){const{log:K,minZoom:ie,maxZoom:de}=this.options;K&&console.time("total time");const Pe=`prepare ${H.length} points`;K&&console.time(Pe),this.points=H;const ze=[];for(let Se=0;Se<H.length;Se++){const W=H[Se];if(!W.geometry)continue;const[Ue,$e]=W.geometry.coordinates,Ge=Ht(Jt(Ue)),Je=Ht(gi($e));ze.push(Ge,Je,1/0,Se,-1,1),this.options.reduce&&ze.push(0)}let Be=this.trees[de+1]=this._createTree(ze);K&&console.timeEnd(Pe);for(let Se=de;Se>=ie;Se--){const W=+Date.now();Be=this.trees[Se]=this._createTree(this._cluster(Be,Se)),K&&console.log("z%d: %d clusters in %dms",Se,Be.numItems,+Date.now()-W)}return K&&console.timeEnd("total time"),this}getClusters(H,K){let ie=((H[0]+180)%360+360)%360-180;const de=Math.max(-90,Math.min(90,H[1]));let Pe=H[2]===180?180:((H[2]+180)%360+360)%360-180;const ze=Math.max(-90,Math.min(90,H[3]));if(H[2]-H[0]>=360)ie=-180,Pe=180;else if(ie>Pe){const $e=this.getClusters([ie,de,180,ze],K),Ge=this.getClusters([-180,de,Pe,ze],K);return $e.concat(Ge)}const Be=this.trees[this._limitZoom(K)],Se=Be.range(Jt(ie),gi(ze),Jt(Pe),gi(de)),W=Be.data,Ue=[];for(const $e of Se){const Ge=this.stride*$e;Ue.push(W[Ge+At]>1?ti(W,Ge,this.clusterProps):this.points[W[Ge+Nt]])}return Ue}getChildren(H){const K=this._getOriginId(H),ie=this._getOriginZoom(H),de="No cluster with the specified id.",Pe=this.trees[ie];if(!Pe)throw new Error(de);const ze=Pe.data;if(K*this.stride>=ze.length)throw new Error(de);const Be=this.options.radius/(this.options.extent*Math.pow(2,ie-1)),Se=Pe.within(ze[K*this.stride],ze[K*this.stride+1],Be),W=[];for(const Ue of Se){const $e=Ue*this.stride;ze[$e+4]===H&&W.push(ze[$e+At]>1?ti(ze,$e,this.clusterProps):this.points[ze[$e+Nt]])}if(W.length===0)throw new Error(de);return W}getLeaves(H,K,ie){const de=[];return this._appendLeaves(de,H,K=K||10,ie=ie||0,0),de}getTile(H,K,ie){const de=this.trees[this._limitZoom(H)],Pe=Math.pow(2,H),{extent:ze,radius:Be}=this.options,Se=Be/ze,W=(ie-Se)/Pe,Ue=(ie+1+Se)/Pe,$e={features:[]};return this._addTileFeatures(de.range((K-Se)/Pe,W,(K+1+Se)/Pe,Ue),de.data,K,ie,Pe,$e),K===0&&this._addTileFeatures(de.range(1-Se/Pe,W,1,Ue),de.data,Pe,ie,Pe,$e),K===Pe-1&&this._addTileFeatures(de.range(0,W,Se/Pe,Ue),de.data,-1,ie,Pe,$e),$e.features.length?$e:null}getClusterExpansionZoom(H){let K=this._getOriginZoom(H)-1;for(;K<=this.options.maxZoom;){const ie=this.getChildren(H);if(K++,ie.length!==1)break;H=ie[0].properties.cluster_id}return K}_appendLeaves(H,K,ie,de,Pe){const ze=this.getChildren(K);for(const Be of ze){const Se=Be.properties;if(Se&&Se.cluster?Pe+Se.point_count<=de?Pe+=Se.point_count:Pe=this._appendLeaves(H,Se.cluster_id,ie,de,Pe):Pe<de?Pe++:H.push(Be),H.length===ie)break}return Pe}_createTree(H){const K=new d.au(H.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ie=0;ie<H.length;ie+=this.stride)K.add(H[ie],H[ie+1]);return K.finish(),K.data=H,K}_addTileFeatures(H,K,ie,de,Pe,ze){for(const Be of H){const Se=Be*this.stride,W=K[Se+At]>1;let Ue,$e,Ge;if(W)Ue=ft(K,Se,this.clusterProps),$e=K[Se],Ge=K[Se+1];else{const Bt=this.points[K[Se+Nt]];Ue=Bt.properties;const[Xt,ui]=Bt.geometry.coordinates;$e=Jt(Xt),Ge=gi(ui)}const Je={type:1,geometry:[[Math.round(this.options.extent*($e*Pe-ie)),Math.round(this.options.extent*(Ge*Pe-de))]],tags:Ue};let dt;dt=W||this.options.generateId?K[Se+Nt]:this.points[K[Se+Nt]].id,dt!==void 0&&(Je.id=dt),ze.features.push(Je)}}_limitZoom(H){return Math.max(this.options.minZoom,Math.min(Math.floor(+H),this.options.maxZoom+1))}_cluster(H,K){const{radius:ie,extent:de,reduce:Pe,minPoints:ze}=this.options,Be=ie/(de*Math.pow(2,K)),Se=H.data,W=[],Ue=this.stride;for(let $e=0;$e<Se.length;$e+=Ue){if(Se[$e+2]<=K)continue;Se[$e+2]=K;const Ge=Se[$e],Je=Se[$e+1],dt=H.within(Se[$e],Se[$e+1],Be),Bt=Se[$e+At];let Xt=Bt;for(const ui of dt){const wi=ui*Ue;Se[wi+2]>K&&(Xt+=Se[wi+At])}if(Xt>Bt&&Xt>=ze){let ui,wi=Ge*Bt,sn=Je*Bt,Rn=-1;const hi=(($e/Ue|0)<<5)+(K+1)+this.points.length;for(const yn of dt){const $n=yn*Ue;if(Se[$n+2]<=K)continue;Se[$n+2]=K;const hr=Se[$n+At];wi+=Se[$n]*hr,sn+=Se[$n+1]*hr,Se[$n+4]=hi,Pe&&(ui||(ui=this._map(Se,$e,!0),Rn=this.clusterProps.length,this.clusterProps.push(ui)),Pe(ui,this._map(Se,$n)))}Se[$e+4]=hi,W.push(wi/Xt,sn/Xt,1/0,hi,-1,Xt),Pe&&W.push(Rn)}else{for(let ui=0;ui<Ue;ui++)W.push(Se[$e+ui]);if(Xt>1)for(const ui of dt){const wi=ui*Ue;if(!(Se[wi+2]<=K)){Se[wi+2]=K;for(let sn=0;sn<Ue;sn++)W.push(Se[wi+sn])}}}}return W}_getOriginId(H){return H-this.points.length>>5}_getOriginZoom(H){return(H-this.points.length)%32}_map(H,K,ie){if(H[K+At]>1){const ze=this.clusterProps[H[K+ei]];return ie?Object.assign({},ze):ze}const de=this.points[H[K+Nt]].properties,Pe=this.options.map(de);return ie&&Pe===de?Object.assign({},Pe):Pe}}function ti(me,H,K){return{type:"Feature",id:me[H+Nt],properties:ft(me,H,K),geometry:{type:"Point",coordinates:[(ie=me[H],360*(ie-.5)),zi(me[H+1])]}};var ie}function ft(me,H,K){const ie=me[H+At],de=ie>=1e4?`${Math.round(ie/1e3)}k`:ie>=1e3?Math.round(ie/100)/10+"k":ie,Pe=me[H+ei],ze=Pe===-1?{}:Object.assign({},K[Pe]);return Object.assign(ze,{cluster:!0,cluster_id:me[H+Nt],point_count:ie,point_count_abbreviated:de})}function Jt(me){return me/360+.5}function gi(me){const H=Math.sin(me*Math.PI/180),K=.5-.25*Math.log((1+H)/(1-H))/Math.PI;return K<0?0:K>1?1:K}function zi(me){const H=(180-360*me)*Math.PI/180;return 360*Math.atan(Math.exp(H))/Math.PI-90}function Fi(me,H,K,ie){for(var de,Pe=ie,ze=K-H>>1,Be=K-H,Se=me[H],W=me[H+1],Ue=me[K],$e=me[K+1],Ge=H+3;Ge<K;Ge+=3){var Je=ut(me[Ge],me[Ge+1],Se,W,Ue,$e);if(Je>Pe)de=Ge,Pe=Je;else if(Je===Pe){var dt=Math.abs(Ge-ze);dt<Be&&(de=Ge,Be=dt)}}Pe>ie&&(de-H>3&&Fi(me,H,de,ie),me[de+2]=Pe,K-de>3&&Fi(me,de,K,ie))}function ut(me,H,K,ie,de,Pe){var ze=de-K,Be=Pe-ie;if(ze!==0||Be!==0){var Se=((me-K)*ze+(H-ie)*Be)/(ze*ze+Be*Be);Se>1?(K=de,ie=Pe):Se>0&&(K+=ze*Se,ie+=Be*Se)}return(ze=me-K)*ze+(Be=H-ie)*Be}function Dt(me,H,K,ie){var de={id:me===void 0?null:me,type:H,geometry:K,tags:ie,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Pe){var ze=Pe.geometry,Be=Pe.type;if(Be==="Point"||Be==="MultiPoint"||Be==="LineString")Fe(Pe,ze);else if(Be==="Polygon"||Be==="MultiLineString")for(var Se=0;Se<ze.length;Se++)Fe(Pe,ze[Se]);else if(Be==="MultiPolygon")for(Se=0;Se<ze.length;Se++)for(var W=0;W<ze[Se].length;W++)Fe(Pe,ze[Se][W])}(de),de}function Fe(me,H){for(var K=0;K<H.length;K+=3)me.minX=Math.min(me.minX,H[K]),me.minY=Math.min(me.minY,H[K+1]),me.maxX=Math.max(me.maxX,H[K]),me.maxY=Math.max(me.maxY,H[K+1])}function je(me,H,K,ie){if(H.geometry){var de=H.geometry.coordinates,Pe=H.geometry.type,ze=Math.pow(K.tolerance/((1<<K.maxZoom)*K.extent),2),Be=[],Se=H.id;if(K.promoteId?Se=H.properties[K.promoteId]:K.generateId&&(Se=ie||0),Pe==="Point")ht(de,Be);else if(Pe==="MultiPoint")for(var W=0;W<de.length;W++)ht(de[W],Be);else if(Pe==="LineString")vt(de,Be,ze,!1);else if(Pe==="MultiLineString"){if(K.lineMetrics){for(W=0;W<de.length;W++)vt(de[W],Be=[],ze,!1),me.push(Dt(Se,"LineString",Be,H.properties));return}we(de,Be,ze,!1)}else if(Pe==="Polygon")we(de,Be,ze,!0);else{if(Pe!=="MultiPolygon"){if(Pe==="GeometryCollection"){for(W=0;W<H.geometry.geometries.length;W++)je(me,{id:Se,geometry:H.geometry.geometries[W],properties:H.properties},K,ie);return}throw new Error("Input data is not a valid GeoJSON object.")}for(W=0;W<de.length;W++){var Ue=[];we(de[W],Ue,ze,!0),Be.push(Ue)}}me.push(Dt(Se,Pe,Be,H.properties))}}function ht(me,H){H.push(Ei(me[0])),H.push(qe(me[1])),H.push(0)}function vt(me,H,K,ie){for(var de,Pe,ze=0,Be=0;Be<me.length;Be++){var Se=Ei(me[Be][0]),W=qe(me[Be][1]);H.push(Se),H.push(W),H.push(0),Be>0&&(ze+=ie?(de*W-Se*Pe)/2:Math.sqrt(Math.pow(Se-de,2)+Math.pow(W-Pe,2))),de=Se,Pe=W}var Ue=H.length-3;H[2]=1,Fi(H,0,Ue,K),H[Ue+2]=1,H.size=Math.abs(ze),H.start=0,H.end=H.size}function we(me,H,K,ie){for(var de=0;de<me.length;de++){var Pe=[];vt(me[de],Pe,K,ie),H.push(Pe)}}function Ei(me){return me/360+.5}function qe(me){var H=Math.sin(me*Math.PI/180),K=.5-.25*Math.log((1+H)/(1-H))/Math.PI;return K<0?0:K>1?1:K}function Ye(me,H,K,ie,de,Pe,ze,Be){if(ie/=H,Pe>=(K/=H)&&ze<ie)return me;if(ze<K||Pe>=ie)return null;for(var Se=[],W=0;W<me.length;W++){var Ue=me[W],$e=Ue.geometry,Ge=Ue.type,Je=de===0?Ue.minX:Ue.minY,dt=de===0?Ue.maxX:Ue.maxY;if(Je>=K&&dt<ie)Se.push(Ue);else if(!(dt<K||Je>=ie)){var Bt=[];if(Ge==="Point"||Ge==="MultiPoint")Ot($e,Bt,K,ie,de);else if(Ge==="LineString")Pi($e,Bt,K,ie,de,!1,Be.lineMetrics);else if(Ge==="MultiLineString")gn($e,Bt,K,ie,de,!1);else if(Ge==="Polygon")gn($e,Bt,K,ie,de,!0);else if(Ge==="MultiPolygon")for(var Xt=0;Xt<$e.length;Xt++){var ui=[];gn($e[Xt],ui,K,ie,de,!0),ui.length&&Bt.push(ui)}if(Bt.length){if(Be.lineMetrics&&Ge==="LineString"){for(Xt=0;Xt<Bt.length;Xt++)Se.push(Dt(Ue.id,Ge,Bt[Xt],Ue.tags));continue}Ge!=="LineString"&&Ge!=="MultiLineString"||(Bt.length===1?(Ge="LineString",Bt=Bt[0]):Ge="MultiLineString"),Ge!=="Point"&&Ge!=="MultiPoint"||(Ge=Bt.length===3?"Point":"MultiPoint"),Se.push(Dt(Ue.id,Ge,Bt,Ue.tags))}}}return Se.length?Se:null}function Ot(me,H,K,ie,de){for(var Pe=0;Pe<me.length;Pe+=3){var ze=me[Pe+de];ze>=K&&ze<=ie&&(H.push(me[Pe]),H.push(me[Pe+1]),H.push(me[Pe+2]))}}function Pi(me,H,K,ie,de,Pe,ze){for(var Be,Se,W=bi(me),Ue=de===0?Qi:io,$e=me.start,Ge=0;Ge<me.length-3;Ge+=3){var Je=me[Ge],dt=me[Ge+1],Bt=me[Ge+2],Xt=me[Ge+3],ui=me[Ge+4],wi=de===0?Je:dt,sn=de===0?Xt:ui,Rn=!1;ze&&(Be=Math.sqrt(Math.pow(Je-Xt,2)+Math.pow(dt-ui,2))),wi<K?sn>K&&(Se=Ue(W,Je,dt,Xt,ui,K),ze&&(W.start=$e+Be*Se)):wi>ie?sn<ie&&(Se=Ue(W,Je,dt,Xt,ui,ie),ze&&(W.start=$e+Be*Se)):Mn(W,Je,dt,Bt),sn<K&&wi>=K&&(Se=Ue(W,Je,dt,Xt,ui,K),Rn=!0),sn>ie&&wi<=ie&&(Se=Ue(W,Je,dt,Xt,ui,ie),Rn=!0),!Pe&&Rn&&(ze&&(W.end=$e+Be*Se),H.push(W),W=bi(me)),ze&&($e+=Be)}var hi=me.length-3;Je=me[hi],dt=me[hi+1],Bt=me[hi+2],(wi=de===0?Je:dt)>=K&&wi<=ie&&Mn(W,Je,dt,Bt),hi=W.length-3,Pe&&hi>=3&&(W[hi]!==W[0]||W[hi+1]!==W[1])&&Mn(W,W[0],W[1],W[2]),W.length&&H.push(W)}function bi(me){var H=[];return H.size=me.size,H.start=me.start,H.end=me.end,H}function gn(me,H,K,ie,de,Pe){for(var ze=0;ze<me.length;ze++)Pi(me[ze],H,K,ie,de,Pe,!1)}function Mn(me,H,K,ie){me.push(H),me.push(K),me.push(ie)}function Qi(me,H,K,ie,de,Pe){var ze=(Pe-H)/(ie-H);return me.push(Pe),me.push(K+(de-K)*ze),me.push(1),ze}function io(me,H,K,ie,de,Pe){var ze=(Pe-K)/(de-K);return me.push(H+(ie-H)*ze),me.push(Pe),me.push(1),ze}function Oi(me,H){for(var K=[],ie=0;ie<me.length;ie++){var de,Pe=me[ie],ze=Pe.type;if(ze==="Point"||ze==="MultiPoint"||ze==="LineString")de=nt(Pe.geometry,H);else if(ze==="MultiLineString"||ze==="Polygon"){de=[];for(var Be=0;Be<Pe.geometry.length;Be++)de.push(nt(Pe.geometry[Be],H))}else if(ze==="MultiPolygon")for(de=[],Be=0;Be<Pe.geometry.length;Be++){for(var Se=[],W=0;W<Pe.geometry[Be].length;W++)Se.push(nt(Pe.geometry[Be][W],H));de.push(Se)}K.push(Dt(Pe.id,ze,de,Pe.tags))}return K}function nt(me,H){var K=[];K.size=me.size,me.start!==void 0&&(K.start=me.start,K.end=me.end);for(var ie=0;ie<me.length;ie+=3)K.push(me[ie]+H,me[ie+1],me[ie+2]);return K}function Mi(me,H){if(me.transformed)return me;var K,ie,de,Pe=1<<me.z,ze=me.x,Be=me.y;for(K=0;K<me.features.length;K++){var Se=me.features[K],W=Se.geometry,Ue=Se.type;if(Se.geometry=[],Ue===1)for(ie=0;ie<W.length;ie+=2)Se.geometry.push(Yt(W[ie],W[ie+1],H,Pe,ze,Be));else for(ie=0;ie<W.length;ie++){var $e=[];for(de=0;de<W[ie].length;de+=2)$e.push(Yt(W[ie][de],W[ie][de+1],H,Pe,ze,Be));Se.geometry.push($e)}}return me.transformed=!0,me}function Yt(me,H,K,ie,de,Pe){return[Math.round(K*(me*ie-de)),Math.round(K*(H*ie-Pe))]}function Ni(me,H,K,ie,de){for(var Pe=H===de.maxZoom?0:de.tolerance/((1<<H)*de.extent),ze={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:K,y:ie,z:H,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Be=0;Be<me.length;Be++){ze.numFeatures++,Xi(ze,me[Be],Pe,de);var Se=me[Be].minX,W=me[Be].minY,Ue=me[Be].maxX,$e=me[Be].maxY;Se<ze.minX&&(ze.minX=Se),W<ze.minY&&(ze.minY=W),Ue>ze.maxX&&(ze.maxX=Ue),$e>ze.maxY&&(ze.maxY=$e)}return ze}function Xi(me,H,K,ie){var de=H.geometry,Pe=H.type,ze=[];if(Pe==="Point"||Pe==="MultiPoint")for(var Be=0;Be<de.length;Be+=3)ze.push(de[Be]),ze.push(de[Be+1]),me.numPoints++,me.numSimplified++;else if(Pe==="LineString")_t(ze,de,me,K,!1,!1);else if(Pe==="MultiLineString"||Pe==="Polygon")for(Be=0;Be<de.length;Be++)_t(ze,de[Be],me,K,Pe==="Polygon",Be===0);else if(Pe==="MultiPolygon")for(var Se=0;Se<de.length;Se++){var W=de[Se];for(Be=0;Be<W.length;Be++)_t(ze,W[Be],me,K,!0,Be===0)}if(ze.length){var Ue=H.tags||null;if(Pe==="LineString"&&ie.lineMetrics){for(var $e in Ue={},H.tags)Ue[$e]=H.tags[$e];Ue.mapbox_clip_start=de.start/de.size,Ue.mapbox_clip_end=de.end/de.size}var Ge={geometry:ze,type:Pe==="Polygon"||Pe==="MultiPolygon"?3:Pe==="LineString"||Pe==="MultiLineString"?2:1,tags:Ue};H.id!==null&&(Ge.id=H.id),me.features.push(Ge)}}function _t(me,H,K,ie,de,Pe){var ze=ie*ie;if(ie>0&&H.size<(de?ze:ie))K.numPoints+=H.length/3;else{for(var Be=[],Se=0;Se<H.length;Se+=3)(ie===0||H[Se+2]>ze)&&(K.numSimplified++,Be.push(H[Se]),Be.push(H[Se+1])),K.numPoints++;de&&function(W,Ue){for(var $e=0,Ge=0,Je=W.length,dt=Je-2;Ge<Je;dt=Ge,Ge+=2)$e+=(W[Ge]-W[dt])*(W[Ge+1]+W[dt+1]);if($e>0===Ue)for(Ge=0,Je=W.length;Ge<Je/2;Ge+=2){var Bt=W[Ge],Xt=W[Ge+1];W[Ge]=W[Je-2-Ge],W[Ge+1]=W[Je-1-Ge],W[Je-2-Ge]=Bt,W[Je-1-Ge]=Xt}}(Be,Pe),me.push(Be)}}function oi(me,H){var K=(H=this.options=function(de,Pe){for(var ze in Pe)de[ze]=Pe[ze];return de}(Object.create(this.options),H)).debug;if(K&&console.time("preprocess data"),H.maxZoom<0||H.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(H.promoteId&&H.generateId)throw new Error("promoteId and generateId cannot be used together.");var ie=function(de,Pe){var ze=[];if(de.type==="FeatureCollection")for(var Be=0;Be<de.features.length;Be++)je(ze,de.features[Be],Pe,Be);else je(ze,de.type==="Feature"?de:{geometry:de},Pe);return ze}(me,H);this.tiles={},this.tileCoords=[],K&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",H.indexMaxZoom,H.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ie=function(de,Pe){var ze=Pe.buffer/Pe.extent,Be=de,Se=Ye(de,1,-1-ze,ze,0,-1,2,Pe),W=Ye(de,1,1-ze,2+ze,0,-1,2,Pe);return(Se||W)&&(Be=Ye(de,1,-ze,1+ze,0,-1,2,Pe)||[],Se&&(Be=Oi(Se,1).concat(Be)),W&&(Be=Be.concat(Oi(W,-1)))),Be}(ie,H),ie.length&&this.splitTile(ie,0,0,0),K&&(ie.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Qt(me,H,K){return 32*((1<<me)*K+H)+me}function Ki(me,H){return H?me.properties[H]:me.id}function br(me,H){if(me==null)return!0;if(me.type==="Feature")return Ki(me,H)!=null;if(me.type==="FeatureCollection"){const K=new Set;for(const ie of me.features){const de=Ki(ie,H);if(de==null||K.has(de))return!1;K.add(de)}return!0}return!1}function ni(me,H){const K=new Map;if(me!=null)if(me.type==="Feature")K.set(Ki(me,H),me);else for(const ie of me.features)K.set(Ki(ie,H),ie);return K}oi.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},oi.prototype.splitTile=function(me,H,K,ie,de,Pe,ze){for(var Be=[me,H,K,ie],Se=this.options,W=Se.debug;Be.length;){ie=Be.pop(),K=Be.pop(),H=Be.pop(),me=Be.pop();var Ue=1<<H,$e=Qt(H,K,ie),Ge=this.tiles[$e];if(!Ge&&(W>1&&console.time("creation"),Ge=this.tiles[$e]=Ni(me,H,K,ie,Se),this.tileCoords.push({z:H,x:K,y:ie}),W)){W>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",H,K,ie,Ge.numFeatures,Ge.numPoints,Ge.numSimplified),console.timeEnd("creation"));var Je="z"+H;this.stats[Je]=(this.stats[Je]||0)+1,this.total++}if(Ge.source=me,de){if(H===Se.maxZoom||H===de)continue;var dt=1<<de-H;if(K!==Math.floor(Pe/dt)||ie!==Math.floor(ze/dt))continue}else if(H===Se.indexMaxZoom||Ge.numPoints<=Se.indexMaxPoints)continue;if(Ge.source=null,me.length!==0){W>1&&console.time("clipping");var Bt,Xt,ui,wi,sn,Rn,hi=.5*Se.buffer/Se.extent,yn=.5-hi,$n=.5+hi,hr=1+hi;Bt=Xt=ui=wi=null,sn=Ye(me,Ue,K-hi,K+$n,0,Ge.minX,Ge.maxX,Se),Rn=Ye(me,Ue,K+yn,K+hr,0,Ge.minX,Ge.maxX,Se),me=null,sn&&(Bt=Ye(sn,Ue,ie-hi,ie+$n,1,Ge.minY,Ge.maxY,Se),Xt=Ye(sn,Ue,ie+yn,ie+hr,1,Ge.minY,Ge.maxY,Se),sn=null),Rn&&(ui=Ye(Rn,Ue,ie-hi,ie+$n,1,Ge.minY,Ge.maxY,Se),wi=Ye(Rn,Ue,ie+yn,ie+hr,1,Ge.minY,Ge.maxY,Se),Rn=null),W>1&&console.timeEnd("clipping"),Be.push(Bt||[],H+1,2*K,2*ie),Be.push(Xt||[],H+1,2*K,2*ie+1),Be.push(ui||[],H+1,2*K+1,2*ie),Be.push(wi||[],H+1,2*K+1,2*ie+1)}}},oi.prototype.getTile=function(me,H,K){var ie=this.options,de=ie.extent,Pe=ie.debug;if(me<0||me>24)return null;var ze=1<<me,Be=Qt(me,H=(H%ze+ze)%ze,K);if(this.tiles[Be])return Mi(this.tiles[Be],de);Pe>1&&console.log("drilling down to z%d-%d-%d",me,H,K);for(var Se,W=me,Ue=H,$e=K;!Se&&W>0;)W--,Ue=Math.floor(Ue/2),$e=Math.floor($e/2),Se=this.tiles[Qt(W,Ue,$e)];return Se&&Se.source?(Pe>1&&console.log("found parent tile z%d-%d-%d",W,Ue,$e),Pe>1&&console.time("drilling down"),this.splitTile(Se.source,W,Ue,$e,me,H,K),Pe>1&&console.timeEnd("drilling down"),this.tiles[Be]?Mi(this.tiles[Be],de):null):null};class no extends S{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(H,K){return d._(this,void 0,void 0,function*(){const ie=H.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const de=this._geoJSONIndex.getTile(ie.z,ie.x,ie.y);if(!de)return null;const Pe=new class{constructor(Be){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=d.W,this.length=Be.length,this._features=Be}feature(Be){return new class{constructor(Se){this._feature=Se,this.extent=d.W,this.type=Se.type,this.properties=Se.tags,"id"in Se&&!isNaN(Se.id)&&(this.id=parseInt(Se.id,10))}loadGeometry(){if(this._feature.type===1){const Se=[];for(const W of this._feature.geometry)Se.push([new d.P(W[0],W[1])]);return Se}{const Se=[];for(const W of this._feature.geometry){const Ue=[];for(const $e of W)Ue.push(new d.P($e[0],$e[1]));Se.push(Ue)}return Se}}toGeoJSON(Se,W,Ue){return P.call(this,Se,W,Ue)}}(this._features[Be])}}(de.features);let ze=mt(Pe);return ze.byteOffset===0&&ze.byteLength===ze.buffer.byteLength||(ze=new Uint8Array(ze)),{vectorTile:Pe,rawData:ze.buffer}})}loadData(H){return d._(this,void 0,void 0,function*(){var K;(K=this._pendingRequest)===null||K===void 0||K.abort();const ie=!!(H&&H.request&&H.request.collectResourceTiming)&&new d.bs(H.request);this._pendingRequest=new AbortController;try{let de=yield this.loadGeoJSON(H,this._pendingRequest);if(delete this._pendingRequest,typeof de!="object")throw new Error(`Input data given to '${H.source}' is not a valid GeoJSON object.`);if(B(de,!0),H.filter){const ze=d.by(H.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ze.result==="error")throw new Error(ze.value.map(Se=>`${Se.key}: ${Se.message}`).join(", "));de={type:"FeatureCollection",features:de.features.filter(Se=>ze.value.evaluate({zoom:0},Se))}}this._geoJSONIndex=H.cluster?new ci(function({superclusterOptions:ze,clusterProperties:Be}){if(!Be||!ze)return ze;const Se={},W={},Ue={accumulated:null,zoom:0},$e={properties:null},Ge=Object.keys(Be);for(const Je of Ge){const[dt,Bt]=Be[Je],Xt=d.by(Bt),ui=d.by(typeof dt=="string"?[dt,["accumulated"],["get",Je]]:dt);Se[Je]=Xt.value,W[Je]=ui.value}return ze.map=Je=>{$e.properties=Je;const dt={};for(const Bt of Ge)dt[Bt]=Se[Bt].evaluate(Ue,$e);return dt},ze.reduce=(Je,dt)=>{$e.properties=dt;for(const Bt of Ge)Ue.accumulated=Je[Bt],Je[Bt]=W[Bt].evaluate(Ue,$e)},ze}(H)).load(de.features):function(ze,Be){return new oi(ze,Be)}(de,H.geojsonVtOptions),this.loaded={};const Pe={};if(ie){const ze=ie.finish();ze&&(Pe.resourceTiming={},Pe.resourceTiming[H.source]=JSON.parse(JSON.stringify(ze)))}return Pe}catch(de){if(delete this._pendingRequest,d.bz(de))return{abandoned:!0};throw de}})}reloadTile(H){const K=this.loaded;return K&&K[H.uid]?super.reloadTile(H):this.loadTile(H)}loadGeoJSON(H,K){return d._(this,void 0,void 0,function*(){const{promoteId:ie}=H;if(H.request){const de=yield d.h(H.request,K);return this._dataUpdateable=br(de.data,ie)?ni(de.data,ie):void 0,de.data}if(typeof H.data=="string")try{const de=JSON.parse(H.data);return this._dataUpdateable=br(de,ie)?ni(de,ie):void 0,de}catch{throw new Error(`Input data given to '${H.source}' is not a valid GeoJSON object.`)}if(!H.dataDiff)throw new Error(`Input data given to '${H.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${H.source}`);return function(de,Pe,ze){var Be,Se,W,Ue;if(Pe.removeAll&&de.clear(),Pe.remove)for(const $e of Pe.remove)de.delete($e);if(Pe.add)for(const $e of Pe.add){const Ge=Ki($e,ze);Ge!=null&&de.set(Ge,$e)}if(Pe.update)for(const $e of Pe.update){let Ge=de.get($e.id);if(Ge==null)continue;const Je=!$e.removeAllProperties&&(((Be=$e.removeProperties)===null||Be===void 0?void 0:Be.length)>0||((Se=$e.addOrUpdateProperties)===null||Se===void 0?void 0:Se.length)>0);if(($e.newGeometry||$e.removeAllProperties||Je)&&(Ge=Object.assign({},Ge),de.set($e.id,Ge),Je&&(Ge.properties=Object.assign({},Ge.properties))),$e.newGeometry&&(Ge.geometry=$e.newGeometry),$e.removeAllProperties)Ge.properties={};else if(((W=$e.removeProperties)===null||W===void 0?void 0:W.length)>0)for(const dt of $e.removeProperties)Object.prototype.hasOwnProperty.call(Ge.properties,dt)&&delete Ge.properties[dt];if(((Ue=$e.addOrUpdateProperties)===null||Ue===void 0?void 0:Ue.length)>0)for(const{key:dt,value:Bt}of $e.addOrUpdateProperties)Ge.properties[dt]=Bt}}(this._dataUpdateable,H.dataDiff,ie),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(H){return d._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(H){return this._geoJSONIndex.getClusterExpansionZoom(H.clusterId)}getClusterChildren(H){return this._geoJSONIndex.getChildren(H.clusterId)}getClusterLeaves(H){return this._geoJSONIndex.getLeaves(H.clusterId,H.limit,H.offset)}}class _n{constructor(H){this.self=H,this.actor=new d.C(H),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(K,ie)=>{if(this.externalWorkerSourceTypes[K])throw new Error(`Worker source with name "${K}" already registered.`);this.externalWorkerSourceTypes[K]=ie},this.self.addProtocol=d.bf,this.self.removeProtocol=d.bg,this.self.registerRTLTextPlugin=K=>{if(d.bA.isParsed())throw new Error("RTL text plugin already registered.");d.bA.setMethods(K)},this.actor.registerMessageHandler("LDT",(K,ie)=>this._getDEMWorkerSource(K,ie.source).loadTile(ie)),this.actor.registerMessageHandler("RDT",(K,ie)=>d._(this,void 0,void 0,function*(){this._getDEMWorkerSource(K,ie.source).removeTile(ie)})),this.actor.registerMessageHandler("GCEZ",(K,ie)=>d._(this,void 0,void 0,function*(){return this._getWorkerSource(K,ie.type,ie.source).getClusterExpansionZoom(ie)})),this.actor.registerMessageHandler("GCC",(K,ie)=>d._(this,void 0,void 0,function*(){return this._getWorkerSource(K,ie.type,ie.source).getClusterChildren(ie)})),this.actor.registerMessageHandler("GCL",(K,ie)=>d._(this,void 0,void 0,function*(){return this._getWorkerSource(K,ie.type,ie.source).getClusterLeaves(ie)})),this.actor.registerMessageHandler("LD",(K,ie)=>this._getWorkerSource(K,ie.type,ie.source).loadData(ie)),this.actor.registerMessageHandler("LT",(K,ie)=>this._getWorkerSource(K,ie.type,ie.source).loadTile(ie)),this.actor.registerMessageHandler("RT",(K,ie)=>this._getWorkerSource(K,ie.type,ie.source).reloadTile(ie)),this.actor.registerMessageHandler("AT",(K,ie)=>this._getWorkerSource(K,ie.type,ie.source).abortTile(ie)),this.actor.registerMessageHandler("RMT",(K,ie)=>this._getWorkerSource(K,ie.type,ie.source).removeTile(ie)),this.actor.registerMessageHandler("RS",(K,ie)=>d._(this,void 0,void 0,function*(){if(!this.workerSources[K]||!this.workerSources[K][ie.type]||!this.workerSources[K][ie.type][ie.source])return;const de=this.workerSources[K][ie.type][ie.source];delete this.workerSources[K][ie.type][ie.source],de.removeSource!==void 0&&de.removeSource(ie)})),this.actor.registerMessageHandler("RM",K=>d._(this,void 0,void 0,function*(){delete this.layerIndexes[K],delete this.availableImages[K],delete this.workerSources[K],delete this.demWorkerSources[K]})),this.actor.registerMessageHandler("SR",(K,ie)=>d._(this,void 0,void 0,function*(){this.referrer=ie})),this.actor.registerMessageHandler("SRPS",(K,ie)=>this._syncRTLPluginState(K,ie)),this.actor.registerMessageHandler("IS",(K,ie)=>d._(this,void 0,void 0,function*(){this.self.importScripts(ie)})),this.actor.registerMessageHandler("SI",(K,ie)=>this._setImages(K,ie)),this.actor.registerMessageHandler("UL",(K,ie)=>d._(this,void 0,void 0,function*(){this._getLayerIndex(K).update(ie.layers,ie.removedIds)})),this.actor.registerMessageHandler("SL",(K,ie)=>d._(this,void 0,void 0,function*(){this._getLayerIndex(K).replace(ie)}))}_setImages(H,K){return d._(this,void 0,void 0,function*(){this.availableImages[H]=K;for(const ie in this.workerSources[H]){const de=this.workerSources[H][ie];for(const Pe in de)de[Pe].availableImages=K}})}_syncRTLPluginState(H,K){return d._(this,void 0,void 0,function*(){if(d.bA.isParsed())return d.bA.getState();if(K.pluginStatus!=="loading")return d.bA.setState(K),K;const ie=K.pluginURL;if(this.self.importScripts(ie),d.bA.isParsed()){const de={pluginStatus:"loaded",pluginURL:ie};return d.bA.setState(de),de}throw d.bA.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${ie}`)})}_getAvailableImages(H){let K=this.availableImages[H];return K||(K=[]),K}_getLayerIndex(H){let K=this.layerIndexes[H];return K||(K=this.layerIndexes[H]=new a),K}_getWorkerSource(H,K,ie){if(this.workerSources[H]||(this.workerSources[H]={}),this.workerSources[H][K]||(this.workerSources[H][K]={}),!this.workerSources[H][K][ie]){const de={sendAsync:(Pe,ze)=>(Pe.targetMapId=H,this.actor.sendAsync(Pe,ze))};switch(K){case"vector":this.workerSources[H][K][ie]=new S(de,this._getLayerIndex(H),this._getAvailableImages(H));break;case"geojson":this.workerSources[H][K][ie]=new no(de,this._getLayerIndex(H),this._getAvailableImages(H));break;default:this.workerSources[H][K][ie]=new this.externalWorkerSourceTypes[K](de,this._getLayerIndex(H),this._getAvailableImages(H))}}return this.workerSources[H][K][ie]}_getDEMWorkerSource(H,K){return this.demWorkerSources[H]||(this.demWorkerSources[H]={}),this.demWorkerSources[H][K]||(this.demWorkerSources[H][K]=new E),this.demWorkerSources[H][K]}}return d.i(self)&&(self.worker=new _n(self)),_n}),l("index",["exports","./shared"],function(d,a){var _="4.1.3";let v,k;const S={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:y=>new Promise((o,h)=>{const p=requestAnimationFrame(o);y.signal.addEventListener("abort",()=>{cancelAnimationFrame(p),h(a.c())})}),getImageData(y,o=0){return this.getImageCanvasContext(y).getImageData(-o,-o,y.width+2*o,y.height+2*o)},getImageCanvasContext(y){const o=window.document.createElement("canvas"),h=o.getContext("2d",{willReadFrequently:!0});if(!h)throw new Error("failed to create canvas 2d context");return o.width=y.width,o.height=y.height,h.drawImage(y,0,0,y.width,y.height),h},resolveURL:y=>(v||(v=document.createElement("a")),v.href=y,v.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(k==null&&(k=matchMedia("(prefers-reduced-motion: reduce)")),k.matches)}};class E{static testProp(o){if(!E.docStyle)return o[0];for(let h=0;h<o.length;h++)if(o[h]in E.docStyle)return o[h];return o[0]}static create(o,h,p){const m=window.document.createElement(o);return h!==void 0&&(m.className=h),p&&p.appendChild(m),m}static createNS(o,h){return window.document.createElementNS(o,h)}static disableDrag(){E.docStyle&&E.selectProp&&(E.userSelect=E.docStyle[E.selectProp],E.docStyle[E.selectProp]="none")}static enableDrag(){E.docStyle&&E.selectProp&&(E.docStyle[E.selectProp]=E.userSelect)}static setTransform(o,h){o.style[E.transformProp]=h}static addEventListener(o,h,p,m={}){o.addEventListener(h,p,"passive"in m?m:m.capture)}static removeEventListener(o,h,p,m={}){o.removeEventListener(h,p,"passive"in m?m:m.capture)}static suppressClickInternal(o){o.preventDefault(),o.stopPropagation(),window.removeEventListener("click",E.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",E.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",E.suppressClickInternal,!0)},0)}static getScale(o){const h=o.getBoundingClientRect();return{x:h.width/o.offsetWidth||1,y:h.height/o.offsetHeight||1,boundingClientRect:h}}static getPoint(o,h,p){const m=h.boundingClientRect;return new a.P((p.clientX-m.left)/h.x-o.clientLeft,(p.clientY-m.top)/h.y-o.clientTop)}static mousePos(o,h){const p=E.getScale(o);return E.getPoint(o,p,h)}static touchPos(o,h){const p=[],m=E.getScale(o);for(let b=0;b<h.length;b++)p.push(E.getPoint(o,m,h[b]));return p}static mouseButton(o){return o.button}static remove(o){o.parentNode&&o.parentNode.removeChild(o)}}E.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,E.selectProp=E.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),E.transformProp=E.testProp(["transform","WebkitTransform"]);const A={supported:!1,testSupport:function(y){!P&&B&&(R?F(y):D=y)}};let D,B,P=!1,R=!1;function F(y){const o=y.createTexture();y.bindTexture(y.TEXTURE_2D,o);try{if(y.texImage2D(y.TEXTURE_2D,0,y.RGBA,y.RGBA,y.UNSIGNED_BYTE,B),y.isContextLost())return;A.supported=!0}catch{}y.deleteTexture(o),P=!0}var j;typeof document<"u"&&(B=document.createElement("img"),B.onload=function(){D&&F(D),D=null,R=!0},B.onerror=function(){P=!0,D=null},B.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(y){let o,h,p,m;y.resetRequestQueue=()=>{o=[],h=0,p=0,m={}},y.addThrottleControl=L=>{const O=p++;return m[O]=L,O},y.removeThrottleControl=L=>{delete m[L],C()},y.getImage=(L,O,$=!0)=>new Promise((q,ee)=>{A.supported&&(L.headers||(L.headers={}),L.headers.accept="image/webp,*/*"),a.e(L,{type:"image"}),o.push({abortController:O,requestParameters:L,supportImageRefresh:$,state:"queued",onError:pe=>{ee(pe)},onSuccess:pe=>{q(pe)}}),C()});const b=L=>a._(this,void 0,void 0,function*(){L.state="running";const{requestParameters:O,supportImageRefresh:$,onError:q,onSuccess:ee,abortController:pe}=L,fe=$===!1&&!a.i(self)&&!a.g(O.url)&&(!O.headers||Object.keys(O.headers).reduce((Ce,Ze)=>Ce&&Ze==="accept",!0));h++;const _e=fe?M(O,pe):a.m(O,pe);try{const Ce=yield _e;delete L.abortController,L.state="completed",Ce.data instanceof HTMLImageElement||a.b(Ce.data)?ee(Ce):Ce.data&&ee({data:yield(ce=Ce.data,typeof createImageBitmap=="function"?a.d(ce):a.f(ce)),cacheControl:Ce.cacheControl,expires:Ce.expires})}catch(Ce){delete L.abortController,q(Ce)}finally{h--,C()}var ce}),C=()=>{const L=(()=>{for(const O of Object.keys(m))if(m[O]())return!0;return!1})()?a.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:a.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let O=h;O<L&&o.length>0;O++){const $=o.shift();$.abortController.signal.aborted?O--:b($)}},M=(L,O)=>new Promise(($,q)=>{const ee=new Image,pe=L.url,fe=L.credentials;fe&&fe==="include"?ee.crossOrigin="use-credentials":(fe&&fe==="same-origin"||!a.s(pe))&&(ee.crossOrigin="anonymous"),O.signal.addEventListener("abort",()=>{ee.src="",q(a.c())}),ee.fetchPriority="high",ee.onload=()=>{ee.onerror=ee.onload=null,$({data:ee})},ee.onerror=()=>{ee.onerror=ee.onload=null,O.signal.aborted||q(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},ee.src=pe})}(j||(j={})),j.resetRequestQueue();class U{constructor(o){this._transformRequestFn=o}transformRequest(o,h){return this._transformRequestFn&&this._transformRequestFn(o,h)||{url:o}}normalizeSpriteURL(o,h,p){const m=function(b){const C=b.match(le);if(!C)throw new Error(`Unable to parse URL "${b}"`);return{protocol:C[1],authority:C[2],path:C[3]||"/",params:C[4]?C[4].split("&"):[]}}(o);return m.path+=`${h}${p}`,function(b){const C=b.params.length?`?${b.params.join("&")}`:"";return`${b.protocol}://${b.authority}${b.path}${C}`}(m)}setTransformRequest(o){this._transformRequestFn=o}}const le=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function he(y){var o=new a.A(3);return o[0]=y[0],o[1]=y[1],o[2]=y[2],o}var Z,Q=function(y,o,h){return y[0]=o[0]-h[0],y[1]=o[1]-h[1],y[2]=o[2]-h[2],y};Z=new a.A(3),a.A!=Float32Array&&(Z[0]=0,Z[1]=0,Z[2]=0);var ye=function(y){var o=y[0],h=y[1];return o*o+h*h};function Ne(y){const o=[];if(typeof y=="string")o.push({id:"default",url:y});else if(y&&y.length>0){const h=[];for(const{id:p,url:m}of y){const b=`${p}${m}`;h.indexOf(b)===-1&&(h.push(b),o.push({id:p,url:m}))}}return o}(function(){var y=new a.A(2);a.A!=Float32Array&&(y[0]=0,y[1]=0)})();class re{constructor(o,h,p,m){this.context=o,this.format=p,this.texture=o.gl.createTexture(),this.update(h,m)}update(o,h,p){const{width:m,height:b}=o,C=!(this.size&&this.size[0]===m&&this.size[1]===b||p),{context:M}=this,{gl:L}=M;if(this.useMipmap=!!(h&&h.useMipmap),L.bindTexture(L.TEXTURE_2D,this.texture),M.pixelStoreUnpackFlipY.set(!1),M.pixelStoreUnpack.set(1),M.pixelStoreUnpackPremultiplyAlpha.set(this.format===L.RGBA&&(!h||h.premultiply!==!1)),C)this.size=[m,b],o instanceof HTMLImageElement||o instanceof HTMLCanvasElement||o instanceof HTMLVideoElement||o instanceof ImageData||a.b(o)?L.texImage2D(L.TEXTURE_2D,0,this.format,this.format,L.UNSIGNED_BYTE,o):L.texImage2D(L.TEXTURE_2D,0,this.format,m,b,0,this.format,L.UNSIGNED_BYTE,o.data);else{const{x:O,y:$}=p||{x:0,y:0};o instanceof HTMLImageElement||o instanceof HTMLCanvasElement||o instanceof HTMLVideoElement||o instanceof ImageData||a.b(o)?L.texSubImage2D(L.TEXTURE_2D,0,O,$,L.RGBA,L.UNSIGNED_BYTE,o):L.texSubImage2D(L.TEXTURE_2D,0,O,$,m,b,L.RGBA,L.UNSIGNED_BYTE,o.data)}this.useMipmap&&this.isSizePowerOfTwo()&&L.generateMipmap(L.TEXTURE_2D)}bind(o,h,p){const{context:m}=this,{gl:b}=m;b.bindTexture(b.TEXTURE_2D,this.texture),p!==b.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(p=b.LINEAR),o!==this.filter&&(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,o),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,p||o),this.filter=o),h!==this.wrap&&(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,h),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,h),this.wrap=h)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:o}=this.context;o.deleteTexture(this.texture),this.texture=null}}function ve(y){const{userImage:o}=y;return!!(o&&o.render&&o.render())&&(y.data.replace(new Uint8Array(o.data.buffer)),!0)}class Ke extends a.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new a.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(o){if(this.loaded!==o&&(this.loaded=o,o)){for(const{ids:h,promiseResolve:p}of this.requestors)p(this._getImagesForIds(h));this.requestors=[]}}getImage(o){const h=this.images[o];if(h&&!h.data&&h.spriteData){const p=h.spriteData;h.data=new a.R({width:p.width,height:p.height},p.context.getImageData(p.x,p.y,p.width,p.height).data),h.spriteData=null}return h}addImage(o,h){if(this.images[o])throw new Error(`Image id ${o} already exist, use updateImage instead`);this._validate(o,h)&&(this.images[o]=h)}_validate(o,h){let p=!0;const m=h.data||h.spriteData;return this._validateStretch(h.stretchX,m&&m.width)||(this.fire(new a.j(new Error(`Image "${o}" has invalid "stretchX" value`))),p=!1),this._validateStretch(h.stretchY,m&&m.height)||(this.fire(new a.j(new Error(`Image "${o}" has invalid "stretchY" value`))),p=!1),this._validateContent(h.content,h)||(this.fire(new a.j(new Error(`Image "${o}" has invalid "content" value`))),p=!1),p}_validateStretch(o,h){if(!o)return!0;let p=0;for(const m of o){if(m[0]<p||m[1]<m[0]||h<m[1])return!1;p=m[1]}return!0}_validateContent(o,h){if(!o)return!0;if(o.length!==4)return!1;const p=h.spriteData,m=p&&p.width||h.data.width,b=p&&p.height||h.data.height;return!(o[0]<0||m<o[0]||o[1]<0||b<o[1]||o[2]<0||m<o[2]||o[3]<0||b<o[3]||o[2]<o[0]||o[3]<o[1])}updateImage(o,h,p=!0){const m=this.getImage(o);if(p&&(m.data.width!==h.data.width||m.data.height!==h.data.height))throw new Error(`size mismatch between old image (${m.data.width}x${m.data.height}) and new image (${h.data.width}x${h.data.height}).`);h.version=m.version+1,this.images[o]=h,this.updatedImages[o]=!0}removeImage(o){const h=this.images[o];delete this.images[o],delete this.patterns[o],h.userImage&&h.userImage.onRemove&&h.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(o){return new Promise((h,p)=>{let m=!0;if(!this.isLoaded())for(const b of o)this.images[b]||(m=!1);this.isLoaded()||m?h(this._getImagesForIds(o)):this.requestors.push({ids:o,promiseResolve:h})})}_getImagesForIds(o){const h={};for(const p of o){let m=this.getImage(p);m||(this.fire(new a.k("styleimagemissing",{id:p})),m=this.getImage(p)),m?h[p]={data:m.data.clone(),pixelRatio:m.pixelRatio,sdf:m.sdf,version:m.version,stretchX:m.stretchX,stretchY:m.stretchY,content:m.content,hasRenderCallback:!!(m.userImage&&m.userImage.render)}:a.w(`Image "${p}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return h}getPixelSize(){const{width:o,height:h}=this.atlasImage;return{width:o,height:h}}getPattern(o){const h=this.patterns[o],p=this.getImage(o);if(!p)return null;if(h&&h.position.version===p.version)return h.position;if(h)h.position.version=p.version;else{const m={w:p.data.width+2,h:p.data.height+2,x:0,y:0},b=new a.I(m,p);this.patterns[o]={bin:m,position:b}}return this._updatePatternAtlas(),this.patterns[o].position}bind(o){const h=o.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new re(o,this.atlasImage,h.RGBA),this.atlasTexture.bind(h.LINEAR,h.CLAMP_TO_EDGE)}_updatePatternAtlas(){const o=[];for(const b in this.patterns)o.push(this.patterns[b].bin);const{w:h,h:p}=a.p(o),m=this.atlasImage;m.resize({width:h||1,height:p||1});for(const b in this.patterns){const{bin:C}=this.patterns[b],M=C.x+1,L=C.y+1,O=this.getImage(b).data,$=O.width,q=O.height;a.R.copy(O,m,{x:0,y:0},{x:M,y:L},{width:$,height:q}),a.R.copy(O,m,{x:0,y:q-1},{x:M,y:L-1},{width:$,height:1}),a.R.copy(O,m,{x:0,y:0},{x:M,y:L+q},{width:$,height:1}),a.R.copy(O,m,{x:$-1,y:0},{x:M-1,y:L},{width:1,height:q}),a.R.copy(O,m,{x:0,y:0},{x:M+$,y:L},{width:1,height:q})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(o){for(const h of o){if(this.callbackDispatchedThisFrame[h])continue;this.callbackDispatchedThisFrame[h]=!0;const p=this.getImage(h);p||a.w(`Image with ID: "${h}" was not found`),ve(p)&&this.updateImage(h,p)}}}const Le=1e20;function et(y,o,h,p,m,b,C,M,L){for(let O=o;O<o+p;O++)xt(y,h*b+O,b,m,C,M,L);for(let O=h;O<h+m;O++)xt(y,O*b+o,1,p,C,M,L)}function xt(y,o,h,p,m,b,C){b[0]=0,C[0]=-Le,C[1]=Le,m[0]=y[o];for(let M=1,L=0,O=0;M<p;M++){m[M]=y[o+M*h];const $=M*M;do{const q=b[L];O=(m[M]-m[q]+$-q*q)/(M-q)/2}while(O<=C[L]&&--L>-1);L++,b[L]=M,C[L]=O,C[L+1]=Le}for(let M=0,L=0;M<p;M++){for(;C[L+1]<M;)L++;const O=b[L],$=M-O;y[o+M*h]=m[O]+$*$}}class mt{constructor(o,h){this.requestManager=o,this.localIdeographFontFamily=h,this.entries={}}setURL(o){this.url=o}getGlyphs(o){return a._(this,void 0,void 0,function*(){const h=[];for(const b in o)for(const C of o[b])h.push(this._getAndCacheGlyphsPromise(b,C));const p=yield Promise.all(h),m={};for(const{stack:b,id:C,glyph:M}of p)m[b]||(m[b]={}),m[b][C]=M&&{id:M.id,bitmap:M.bitmap.clone(),metrics:M.metrics};return m})}_getAndCacheGlyphsPromise(o,h){return a._(this,void 0,void 0,function*(){let p=this.entries[o];p||(p=this.entries[o]={glyphs:{},requests:{},ranges:{}});let m=p.glyphs[h];if(m!==void 0)return{stack:o,id:h,glyph:m};if(m=this._tinySDF(p,o,h),m)return p.glyphs[h]=m,{stack:o,id:h,glyph:m};const b=Math.floor(h/256);if(256*b>65535)throw new Error("glyphs > 65535 not supported");if(p.ranges[b])return{stack:o,id:h,glyph:m};if(!this.url)throw new Error("glyphsUrl is not set");if(!p.requests[b]){const M=mt.loadGlyphRange(o,b,this.url,this.requestManager);p.requests[b]=M}const C=yield p.requests[b];for(const M in C)this._doesCharSupportLocalGlyph(+M)||(p.glyphs[+M]=C[+M]);return p.ranges[b]=!0,{stack:o,id:h,glyph:C[h]||null}})}_doesCharSupportLocalGlyph(o){return!!this.localIdeographFontFamily&&(a.u["CJK Unified Ideographs"](o)||a.u["Hangul Syllables"](o)||a.u.Hiragana(o)||a.u.Katakana(o))}_tinySDF(o,h,p){const m=this.localIdeographFontFamily;if(!m||!this._doesCharSupportLocalGlyph(p))return;let b=o.tinySDF;if(!b){let M="400";/bold/i.test(h)?M="900":/medium/i.test(h)?M="500":/light/i.test(h)&&(M="200"),b=o.tinySDF=new mt.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:m,fontWeight:M})}const C=b.draw(String.fromCharCode(p));return{id:p,bitmap:new a.o({width:C.width||60,height:C.height||60},C.data),metrics:{width:C.glyphWidth/2||24,height:C.glyphHeight/2||24,left:C.glyphLeft/2+.5||0,top:C.glyphTop/2-27.5||-8,advance:C.glyphAdvance/2||24,isDoubleResolution:!0}}}}mt.loadGlyphRange=function(y,o,h,p){return a._(this,void 0,void 0,function*(){const m=256*o,b=m+255,C=p.transformRequest(h.replace("{fontstack}",y).replace("{range}",`${m}-${b}`),"Glyphs"),M=yield a.l(C,new AbortController);if(!M||!M.data)throw new Error(`Could not load glyph range. range: ${o}, ${m}-${b}`);const L={};for(const O of a.n(M.data))L[O.id]=O;return L})},mt.TinySDF=class{constructor({fontSize:y=24,buffer:o=3,radius:h=8,cutoff:p=.25,fontFamily:m="sans-serif",fontWeight:b="normal",fontStyle:C="normal"}={}){this.buffer=o,this.cutoff=p,this.radius=h;const M=this.size=y+4*o,L=this._createCanvas(M),O=this.ctx=L.getContext("2d",{willReadFrequently:!0});O.font=`${C} ${b} ${y}px ${m}`,O.textBaseline="alphabetic",O.textAlign="left",O.fillStyle="black",this.gridOuter=new Float64Array(M*M),this.gridInner=new Float64Array(M*M),this.f=new Float64Array(M),this.z=new Float64Array(M+1),this.v=new Uint16Array(M)}_createCanvas(y){const o=document.createElement("canvas");return o.width=o.height=y,o}draw(y){const{width:o,actualBoundingBoxAscent:h,actualBoundingBoxDescent:p,actualBoundingBoxLeft:m,actualBoundingBoxRight:b}=this.ctx.measureText(y),C=Math.ceil(h),M=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(b-m))),L=Math.min(this.size-this.buffer,C+Math.ceil(p)),O=M+2*this.buffer,$=L+2*this.buffer,q=Math.max(O*$,0),ee=new Uint8ClampedArray(q),pe={data:ee,width:O,height:$,glyphWidth:M,glyphHeight:L,glyphTop:C,glyphLeft:0,glyphAdvance:o};if(M===0||L===0)return pe;const{ctx:fe,buffer:_e,gridInner:ce,gridOuter:Ce}=this;fe.clearRect(_e,_e,M,L),fe.fillText(y,_e,_e+C);const Ze=fe.getImageData(_e,_e,M,L);Ce.fill(Le,0,q),ce.fill(0,0,q);for(let be=0;be<L;be++)for(let Re=0;Re<M;Re++){const We=Ze.data[4*(be*M+Re)+3]/255;if(We===0)continue;const He=(be+_e)*O+Re+_e;if(We===1)Ce[He]=0,ce[He]=Le;else{const Xe=.5-We;Ce[He]=Xe>0?Xe*Xe:0,ce[He]=Xe<0?Xe*Xe:0}}et(Ce,0,0,O,$,O,this.f,this.v,this.z),et(ce,_e,_e,M,L,O,this.f,this.v,this.z);for(let be=0;be<q;be++){const Re=Math.sqrt(Ce[be])-Math.sqrt(ce[be]);ee[be]=Math.round(255-255*(Re/this.radius+this.cutoff))}return pe}};class at{constructor(){this.specification=a.v.light.position}possiblyEvaluate(o,h){return a.y(o.expression.evaluate(h))}interpolate(o,h,p){return{x:a.z.number(o.x,h.x,p),y:a.z.number(o.y,h.y,p),z:a.z.number(o.z,h.z,p)}}}let Ht;class ri extends a.E{constructor(o){super(),Ht=Ht||new a.q({anchor:new a.D(a.v.light.anchor),position:new at,color:new a.D(a.v.light.color),intensity:new a.D(a.v.light.intensity)}),this._transitionable=new a.T(Ht),this.setLight(o),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(o,h={}){if(!this._validate(a.r,o,h))for(const p in o){const m=o[p];p.endsWith("-transition")?this._transitionable.setTransition(p.slice(0,-11),m):this._transitionable.setValue(p,m)}}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,h,p){return(!p||p.validate!==!1)&&a.t(this,o.call(a.x,{value:h,style:{glyphs:!0,sprite:!0},styleSpec:a.v}))}}class Nt{constructor(o,h){this.width=o,this.height=h,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(o,h){const p=o.join(",")+String(h);return this.dashEntry[p]||(this.dashEntry[p]=this.addDash(o,h)),this.dashEntry[p]}getDashRanges(o,h,p){const m=[];let b=o.length%2==1?-o[o.length-1]*p:0,C=o[0]*p,M=!0;m.push({left:b,right:C,isDash:M,zeroLength:o[0]===0});let L=o[0];for(let O=1;O<o.length;O++){M=!M;const $=o[O];b=L*p,L+=$,C=L*p,m.push({left:b,right:C,isDash:M,zeroLength:$===0})}return m}addRoundDash(o,h,p){const m=h/2;for(let b=-p;b<=p;b++){const C=this.width*(this.nextRow+p+b);let M=0,L=o[M];for(let O=0;O<this.width;O++){O/L.right>1&&(L=o[++M]);const $=Math.abs(O-L.left),q=Math.abs(O-L.right),ee=Math.min($,q);let pe;const fe=b/p*(m+1);if(L.isDash){const _e=m-Math.abs(fe);pe=Math.sqrt(ee*ee+_e*_e)}else pe=m-Math.sqrt(ee*ee+fe*fe);this.data[C+O]=Math.max(0,Math.min(255,pe+128))}}}addRegularDash(o){for(let M=o.length-1;M>=0;--M){const L=o[M],O=o[M+1];L.zeroLength?o.splice(M,1):O&&O.isDash===L.isDash&&(O.left=L.left,o.splice(M,1))}const h=o[0],p=o[o.length-1];h.isDash===p.isDash&&(h.left=p.left-this.width,p.right=h.right+this.width);const m=this.width*this.nextRow;let b=0,C=o[b];for(let M=0;M<this.width;M++){M/C.right>1&&(C=o[++b]);const L=Math.abs(M-C.left),O=Math.abs(M-C.right),$=Math.min(L,O);this.data[m+M]=Math.max(0,Math.min(255,(C.isDash?$:-$)+128))}}addDash(o,h){const p=h?7:0,m=2*p+1;if(this.nextRow+m>this.height)return a.w("LineAtlas out of space"),null;let b=0;for(let M=0;M<o.length;M++)b+=o[M];if(b!==0){const M=this.width/b,L=this.getDashRanges(o,this.width,M);h?this.addRoundDash(L,M,p):this.addRegularDash(L)}const C={y:(this.nextRow+p+.5)/this.height,height:2*p/this.height,width:b};return this.nextRow+=m,this.dirty=!0,C}bind(o){const h=o.gl;this.texture?(h.bindTexture(h.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,h.texSubImage2D(h.TEXTURE_2D,0,0,0,this.width,this.height,h.ALPHA,h.UNSIGNED_BYTE,this.data))):(this.texture=h.createTexture(),h.bindTexture(h.TEXTURE_2D,this.texture),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.LINEAR),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.LINEAR),h.texImage2D(h.TEXTURE_2D,0,h.ALPHA,this.width,this.height,0,h.ALPHA,h.UNSIGNED_BYTE,this.data))}}const At="maplibre_preloaded_worker_pool";class ei{constructor(){this.active={}}acquire(o){if(!this.workers)for(this.workers=[];this.workers.length<ei.workerCount;)this.workers.push(new Worker(a.a.WORKER_URL));return this.active[o]=!0,this.workers.slice()}release(o){delete this.active[o],this.numActive()===0&&(this.workers.forEach(h=>{h.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[At]}numActive(){return Object.keys(this.active).length}}const ci=Math.floor(S.hardwareConcurrency/2);let ti,ft;function Jt(){return ti||(ti=new ei),ti}ei.workerCount=a.B(globalThis)?Math.max(Math.min(ci,3),1):1;class gi{constructor(o,h){this.workerPool=o,this.actors=[],this.currentActor=0,this.id=h;const p=this.workerPool.acquire(h);for(let m=0;m<p.length;m++){const b=new a.C(p[m],h);b.name=`Worker ${m}`,this.actors.push(b)}if(!this.actors.length)throw new Error("No actors found")}broadcast(o,h){const p=[];for(const m of this.actors)p.push(m.sendAsync({type:o,data:h}));return Promise.all(p)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(o=!0){this.actors.forEach(h=>{h.remove()}),this.actors=[],o&&this.workerPool.release(this.id)}registerMessageHandler(o,h){for(const p of this.actors)p.registerMessageHandler(o,h)}}function zi(){return ft||(ft=new gi(Jt(),a.G),ft.registerMessageHandler("GR",(y,o,h)=>a.m(o,h))),ft}function Fi(y,o){const h=a.F();return a.H(h,h,[1,1,0]),a.J(h,h,[.5*y.width,.5*y.height,1]),a.K(h,h,y.calculatePosMatrix(o.toUnwrapped()))}function ut(y,o,h,p,m,b){const C=function(q,ee,pe){if(q)for(const fe of q){const _e=ee[fe];if(_e&&_e.source===pe&&_e.type==="fill-extrusion")return!0}else for(const fe in ee){const _e=ee[fe];if(_e.source===pe&&_e.type==="fill-extrusion")return!0}return!1}(m&&m.layers,o,y.id),M=b.maxPitchScaleFactor(),L=y.tilesIn(p,M,C);L.sort(Dt);const O=[];for(const q of L)O.push({wrappedTileID:q.tileID.wrapped().key,queryResults:q.tile.queryRenderedFeatures(o,h,y._state,q.queryGeometry,q.cameraQueryGeometry,q.scale,m,b,M,Fi(y.transform,q.tileID))});const $=function(q){const ee={},pe={};for(const fe of q){const _e=fe.queryResults,ce=fe.wrappedTileID,Ce=pe[ce]=pe[ce]||{};for(const Ze in _e){const be=_e[Ze],Re=Ce[Ze]=Ce[Ze]||{},We=ee[Ze]=ee[Ze]||[];for(const He of be)Re[He.featureIndex]||(Re[He.featureIndex]=!0,We.push(He))}}return ee}(O);for(const q in $)$[q].forEach(ee=>{const pe=ee.feature,fe=y.getFeatureState(pe.layer["source-layer"],pe.id);pe.source=pe.layer.source,pe.layer["source-layer"]&&(pe.sourceLayer=pe.layer["source-layer"]),pe.state=fe});return $}function Dt(y,o){const h=y.tileID,p=o.tileID;return h.overscaledZ-p.overscaledZ||h.canonical.y-p.canonical.y||h.wrap-p.wrap||h.canonical.x-p.canonical.x}function Fe(y,o,h){return a._(this,void 0,void 0,function*(){let p=y;if(y.url?p=(yield a.h(o.transformRequest(y.url,"Source"),h)).data:yield S.frameAsync(h),!p)return null;const m=a.L(a.e(p,y),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in p&&p.vector_layers&&(m.vectorLayerIds=p.vector_layers.map(b=>b.id)),m})}class je{constructor(o,h){o&&(h?this.setSouthWest(o).setNorthEast(h):Array.isArray(o)&&(o.length===4?this.setSouthWest([o[0],o[1]]).setNorthEast([o[2],o[3]]):this.setSouthWest(o[0]).setNorthEast(o[1])))}setNorthEast(o){return this._ne=o instanceof a.M?new a.M(o.lng,o.lat):a.M.convert(o),this}setSouthWest(o){return this._sw=o instanceof a.M?new a.M(o.lng,o.lat):a.M.convert(o),this}extend(o){const h=this._sw,p=this._ne;let m,b;if(o instanceof a.M)m=o,b=o;else{if(!(o instanceof je))return Array.isArray(o)?o.length===4||o.every(Array.isArray)?this.extend(je.convert(o)):this.extend(a.M.convert(o)):o&&("lng"in o||"lon"in o)&&"lat"in o?this.extend(a.M.convert(o)):this;if(m=o._sw,b=o._ne,!m||!b)return this}return h||p?(h.lng=Math.min(m.lng,h.lng),h.lat=Math.min(m.lat,h.lat),p.lng=Math.max(b.lng,p.lng),p.lat=Math.max(b.lat,p.lat)):(this._sw=new a.M(m.lng,m.lat),this._ne=new a.M(b.lng,b.lat)),this}getCenter(){return new a.M((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new a.M(this.getWest(),this.getNorth())}getSouthEast(){return new a.M(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(o){const{lng:h,lat:p}=a.M.convert(o);let m=this._sw.lng<=h&&h<=this._ne.lng;return this._sw.lng>this._ne.lng&&(m=this._sw.lng>=h&&h>=this._ne.lng),this._sw.lat<=p&&p<=this._ne.lat&&m}static convert(o){return o instanceof je?o:o&&new je(o)}static fromLngLat(o,h=0){const p=360*h/40075017,m=p/Math.cos(Math.PI/180*o.lat);return new je(new a.M(o.lng-m,o.lat-p),new a.M(o.lng+m,o.lat+p))}}class ht{constructor(o,h,p){this.bounds=je.convert(this.validateBounds(o)),this.minzoom=h||0,this.maxzoom=p||24}validateBounds(o){return Array.isArray(o)&&o.length===4?[Math.max(-180,o[0]),Math.max(-90,o[1]),Math.min(180,o[2]),Math.min(90,o[3])]:[-180,-90,180,90]}contains(o){const h=Math.pow(2,o.z),p=Math.floor(a.N(this.bounds.getWest())*h),m=Math.floor(a.O(this.bounds.getNorth())*h),b=Math.ceil(a.N(this.bounds.getEast())*h),C=Math.ceil(a.O(this.bounds.getSouth())*h);return o.x>=p&&o.x<b&&o.y>=m&&o.y<C}}class vt extends a.E{constructor(o,h,p,m){if(super(),this.id=o,this.dispatcher=p,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,a.e(this,a.L(h,["url","scheme","tileSize","promoteId"])),this._options=a.e({type:"vector"},h),this._collectResourceTiming=h.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(m)}load(){return a._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new a.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const o=yield Fe(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),o&&(a.e(this,o),o.bounds&&(this.tileBounds=new ht(o.bounds,this.minzoom,this.maxzoom)),this.fire(new a.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.k("data",{dataType:"source",sourceDataType:"content"})))}catch(o){this._tileJSONRequest=null,this.fire(new a.j(o))}})}loaded(){return this._loaded}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}onAdd(o){this.map=o,this.load()}setSourceProperty(o){this._tileJSONRequest&&this._tileJSONRequest.abort(),o(),this.load()}setTiles(o){return this.setSourceProperty(()=>{this._options.tiles=o}),this}setUrl(o){return this.setSourceProperty(()=>{this.url=o,this._options.url=o}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return a.e({},this._options)}loadTile(o){return a._(this,void 0,void 0,function*(){const h=o.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),p={request:this.map._requestManager.transformRequest(h,"Tile"),uid:o.uid,tileID:o.tileID,zoom:o.tileID.overscaledZ,tileSize:this.tileSize*o.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};p.request.collectResourceTiming=this._collectResourceTiming;let m="RT";if(o.actor&&o.state!=="expired"){if(o.state==="loading")return new Promise((b,C)=>{o.reloadPromise={resolve:b,reject:C}})}else o.actor=this.dispatcher.getActor(),m="LT";o.abortController=new AbortController;try{const b=yield o.actor.sendAsync({type:m,data:p},o.abortController);if(delete o.abortController,o.aborted)return;this._afterTileLoadWorkerResponse(o,b)}catch(b){if(delete o.abortController,o.aborted)return;if(b&&b.status!==404)throw b;this._afterTileLoadWorkerResponse(o,null)}})}_afterTileLoadWorkerResponse(o,h){if(h&&h.resourceTiming&&(o.resourceTiming=h.resourceTiming),h&&this.map._refreshExpiredTiles&&o.setExpiryData(h),o.loadVectorData(h,this.map.painter),o.reloadPromise){const p=o.reloadPromise;o.reloadPromise=null,this.loadTile(o).then(p.resolve).catch(p.reject)}}abortTile(o){return a._(this,void 0,void 0,function*(){o.abortController&&(o.abortController.abort(),delete o.abortController),o.actor&&(yield o.actor.sendAsync({type:"AT",data:{uid:o.uid,type:this.type,source:this.id}}))})}unloadTile(o){return a._(this,void 0,void 0,function*(){o.unloadVectorData(),o.actor&&(yield o.actor.sendAsync({type:"RMT",data:{uid:o.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class we extends a.E{constructor(o,h,p,m){super(),this.id=o,this.dispatcher=p,this.setEventedParent(m),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=a.e({type:"raster"},h),a.e(this,a.L(h,["url","scheme","tileSize"]))}load(){return a._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new a.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const o=yield Fe(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,o&&(a.e(this,o),o.bounds&&(this.tileBounds=new ht(o.bounds,this.minzoom,this.maxzoom)),this.fire(new a.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.k("data",{dataType:"source",sourceDataType:"content"})))}catch(o){this._tileJSONRequest=null,this.fire(new a.j(o))}})}loaded(){return this._loaded}onAdd(o){this.map=o,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(o){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),o(),this.load()}setTiles(o){return this.setSourceProperty(()=>{this._options.tiles=o}),this}setUrl(o){return this.setSourceProperty(()=>{this.url=o,this._options.url=o}),this}serialize(){return a.e({},this._options)}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}loadTile(o){return a._(this,void 0,void 0,function*(){const h=o.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);o.abortController=new AbortController;try{const p=yield j.getImage(this.map._requestManager.transformRequest(h,"Tile"),o.abortController,this.map._refreshExpiredTiles);if(delete o.abortController,o.aborted)return void(o.state="unloaded");if(p&&p.data){this.map._refreshExpiredTiles&&p.cacheControl&&p.expires&&o.setExpiryData({cacheControl:p.cacheControl,expires:p.expires});const m=this.map.painter.context,b=m.gl,C=p.data;o.texture=this.map.painter.getTileTexture(C.width),o.texture?o.texture.update(C,{useMipmap:!0}):(o.texture=new re(m,C,b.RGBA,{useMipmap:!0}),o.texture.bind(b.LINEAR,b.CLAMP_TO_EDGE,b.LINEAR_MIPMAP_NEAREST),m.extTextureFilterAnisotropic&&b.texParameterf(b.TEXTURE_2D,m.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,m.extTextureFilterAnisotropicMax)),o.state="loaded"}}catch(p){if(delete o.abortController,o.aborted)o.state="unloaded";else if(p)throw o.state="errored",p}})}abortTile(o){return a._(this,void 0,void 0,function*(){o.abortController&&(o.abortController.abort(),delete o.abortController)})}unloadTile(o){return a._(this,void 0,void 0,function*(){o.texture&&this.map.painter.saveTileTexture(o.texture)})}hasTransition(){return!1}}class Ei extends we{constructor(o,h,p,m){super(o,h,p,m),this.type="raster-dem",this.maxzoom=22,this._options=a.e({type:"raster-dem"},h),this.encoding=h.encoding||"mapbox",this.redFactor=h.redFactor,this.greenFactor=h.greenFactor,this.blueFactor=h.blueFactor,this.baseShift=h.baseShift}loadTile(o){return a._(this,void 0,void 0,function*(){const h=o.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),p=this.map._requestManager.transformRequest(h,"Tile");o.neighboringTiles=this._getNeighboringTiles(o.tileID),o.abortController=new AbortController;try{const m=yield j.getImage(p,o.abortController,this.map._refreshExpiredTiles);if(delete o.abortController,o.aborted)return void(o.state="unloaded");if(m&&m.data){const b=m.data;this.map._refreshExpiredTiles&&m.cacheControl&&m.expires&&o.setExpiryData({cacheControl:m.cacheControl,expires:m.expires});const C=a.b(b)&&a.S()?b:yield this.readImageNow(b),M={type:this.type,uid:o.uid,source:this.id,rawImageData:C,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!o.actor||o.state==="expired"){o.actor=this.dispatcher.getActor();const L=yield o.actor.sendAsync({type:"LDT",data:M});o.dem=L,o.needsHillshadePrepare=!0,o.needsTerrainPrepare=!0,o.state="loaded"}}}catch(m){if(delete o.abortController,o.aborted)o.state="unloaded";else if(m)throw o.state="errored",m}})}readImageNow(o){return a._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&a.U()){const h=o.width+2,p=o.height+2;try{return new a.R({width:h,height:p},yield a.V(o,-1,-1,h,p))}catch{}}return S.getImageData(o,1)})}_getNeighboringTiles(o){const h=o.canonical,p=Math.pow(2,h.z),m=(h.x-1+p)%p,b=h.x===0?o.wrap-1:o.wrap,C=(h.x+1+p)%p,M=h.x+1===p?o.wrap+1:o.wrap,L={};return L[new a.Q(o.overscaledZ,b,h.z,m,h.y).key]={backfilled:!1},L[new a.Q(o.overscaledZ,M,h.z,C,h.y).key]={backfilled:!1},h.y>0&&(L[new a.Q(o.overscaledZ,b,h.z,m,h.y-1).key]={backfilled:!1},L[new a.Q(o.overscaledZ,o.wrap,h.z,h.x,h.y-1).key]={backfilled:!1},L[new a.Q(o.overscaledZ,M,h.z,C,h.y-1).key]={backfilled:!1}),h.y+1<p&&(L[new a.Q(o.overscaledZ,b,h.z,m,h.y+1).key]={backfilled:!1},L[new a.Q(o.overscaledZ,o.wrap,h.z,h.x,h.y+1).key]={backfilled:!1},L[new a.Q(o.overscaledZ,M,h.z,C,h.y+1).key]={backfilled:!1}),L}unloadTile(o){return a._(this,void 0,void 0,function*(){o.demTexture&&this.map.painter.saveTileTexture(o.demTexture),o.fbo&&(o.fbo.destroy(),delete o.fbo),o.dem&&delete o.dem,delete o.neighboringTiles,o.state="unloaded",o.actor&&(yield o.actor.sendAsync({type:"RDT",data:{type:this.type,uid:o.uid,source:this.id}}))})}}class qe extends a.E{constructor(o,h,p,m){super(),this.id=o,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=p.getActor(),this.setEventedParent(m),this._data=h.data,this._options=a.e({},h),this._collectResourceTiming=h.collectResourceTiming,h.maxzoom!==void 0&&(this.maxzoom=h.maxzoom),h.type&&(this.type=h.type),h.attribution&&(this.attribution=h.attribution),this.promoteId=h.promoteId;const b=a.W/this.tileSize;this.workerOptions=a.e({source:this.id,cluster:h.cluster||!1,geojsonVtOptions:{buffer:(h.buffer!==void 0?h.buffer:128)*b,tolerance:(h.tolerance!==void 0?h.tolerance:.375)*b,extent:a.W,maxZoom:this.maxzoom,lineMetrics:h.lineMetrics||!1,generateId:h.generateId||!1},superclusterOptions:{maxZoom:h.clusterMaxZoom!==void 0?h.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,h.clusterMinPoints||2),extent:a.W,radius:(h.clusterRadius||50)*b,log:!1,generateId:h.generateId||!1},clusterProperties:h.clusterProperties,filter:h.filter},h.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return a._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(o){this.map=o,this.load()}setData(o){return this._data=o,this._updateWorkerData(),this}updateData(o){return this._updateWorkerData(o),this}setClusterOptions(o){return this.workerOptions.cluster=o.cluster,o&&(o.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=o.clusterRadius),o.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=o.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(o){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:o,source:this.id}})}getClusterChildren(o){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:o,source:this.id}})}getClusterLeaves(o,h,p){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:o,limit:h,offset:p}})}_updateWorkerData(o){return a._(this,void 0,void 0,function*(){const h=a.e({type:this.type},this.workerOptions);o?h.dataDiff=o:typeof this._data=="string"?(h.request=this.map._requestManager.transformRequest(S.resolveURL(this._data),"Source"),h.request.collectResourceTiming=this._collectResourceTiming):h.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new a.k("dataloading",{dataType:"source"}));try{const p=yield this.actor.sendAsync({type:"LD",data:h});if(this._pendingLoads--,this._removed||p.abandoned)return void this.fire(new a.k("dataabort",{dataType:"source"}));let m=null;p.resourceTiming&&p.resourceTiming[this.id]&&(m=p.resourceTiming[this.id].slice(0));const b={dataType:"source"};this._collectResourceTiming&&m&&m.length>0&&a.e(b,{resourceTiming:m}),this.fire(new a.k("data",Object.assign(Object.assign({},b),{sourceDataType:"metadata"}))),this.fire(new a.k("data",Object.assign(Object.assign({},b),{sourceDataType:"content"})))}catch(p){if(this._pendingLoads--,this._removed)return void this.fire(new a.k("dataabort",{dataType:"source"}));this.fire(new a.j(p))}})}loaded(){return this._pendingLoads===0}loadTile(o){return a._(this,void 0,void 0,function*(){const h=o.actor?"RT":"LT";o.actor=this.actor;const p={type:this.type,uid:o.uid,tileID:o.tileID,zoom:o.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};o.abortController=new AbortController;const m=yield this.actor.sendAsync({type:h,data:p},o.abortController);delete o.abortController,o.unloadVectorData(),o.aborted||o.loadVectorData(m,this.map.painter,h==="RT")})}abortTile(o){return a._(this,void 0,void 0,function*(){o.abortController&&(o.abortController.abort(),delete o.abortController),o.aborted=!0})}unloadTile(o){return a._(this,void 0,void 0,function*(){o.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:o.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return a.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var Ye=a.X([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Ot extends a.E{constructor(o,h,p,m){super(),this.id=o,this.dispatcher=p,this.coordinates=h.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(m),this.options=h}load(o){return a._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new a.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const h=yield j.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,h&&h.data&&(this.image=h.data,o&&(this.coordinates=o),this._finishLoading())}catch(h){this._request=null,this._loaded=!0,this.fire(new a.j(h))}})}loaded(){return this._loaded}updateImage(o){return o.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=o.url,this.load(o.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new a.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(o){this.map=o,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(o){this.coordinates=o;const h=o.map(a.Y.fromLngLat);this.tileID=function(m){let b=1/0,C=1/0,M=-1/0,L=-1/0;for(const ee of m)b=Math.min(b,ee.x),C=Math.min(C,ee.y),M=Math.max(M,ee.x),L=Math.max(L,ee.y);const O=Math.max(M-b,L-C),$=Math.max(0,Math.floor(-Math.log(O)/Math.LN2)),q=Math.pow(2,$);return new a.a0($,Math.floor((b+M)/2*q),Math.floor((C+L)/2*q))}(h),this.minzoom=this.maxzoom=this.tileID.z;const p=h.map(m=>this.tileID.getTilePoint(m)._round());return this._boundsArray=new a.Z,this._boundsArray.emplaceBack(p[0].x,p[0].y,0,0),this._boundsArray.emplaceBack(p[1].x,p[1].y,a.W,0),this._boundsArray.emplaceBack(p[3].x,p[3].y,0,a.W),this._boundsArray.emplaceBack(p[2].x,p[2].y,a.W,a.W),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new a.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const o=this.map.painter.context,h=o.gl;this.boundsBuffer||(this.boundsBuffer=o.createVertexBuffer(this._boundsArray,Ye.members)),this.boundsSegments||(this.boundsSegments=a.$.simpleSegment(0,0,4,2)),this.texture||(this.texture=new re(o,this.image,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE));let p=!1;for(const m in this.tiles){const b=this.tiles[m];b.state!=="loaded"&&(b.state="loaded",b.texture=this.texture,p=!0)}p&&this.fire(new a.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(o){return a._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(o.tileID.canonical)?(this.tiles[String(o.tileID.wrap)]=o,o.buckets={}):o.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class Pi extends Ot{constructor(o,h,p,m){super(o,h,p,m),this.roundZoom=!0,this.type="video",this.options=h}load(){return a._(this,void 0,void 0,function*(){this._loaded=!1;const o=this.options;this.urls=[];for(const h of o.urls)this.urls.push(this.map._requestManager.transformRequest(h,"Source").url);try{const h=yield a.a2(this.urls);if(this._loaded=!0,!h)return;this.video=h,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(h){this.fire(new a.j(h))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(o){if(this.video){const h=this.video.seekable;o<h.start(0)||o>h.end(0)?this.fire(new a.j(new a.a1(`sources.${this.id}`,null,`Playback for this video can be set only between the ${h.start(0)} and ${h.end(0)}-second mark.`))):this.video.currentTime=o}}getVideo(){return this.video}onAdd(o){this.map||(this.map=o,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const o=this.map.painter.context,h=o.gl;this.boundsBuffer||(this.boundsBuffer=o.createVertexBuffer(this._boundsArray,Ye.members)),this.boundsSegments||(this.boundsSegments=a.$.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE),h.texSubImage2D(h.TEXTURE_2D,0,0,0,h.RGBA,h.UNSIGNED_BYTE,this.video)):(this.texture=new re(o,this.video,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE));let p=!1;for(const m in this.tiles){const b=this.tiles[m];b.state!=="loaded"&&(b.state="loaded",b.texture=this.texture,p=!0)}p&&this.fire(new a.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class bi extends Ot{constructor(o,h,p,m){super(o,h,p,m),h.coordinates?Array.isArray(h.coordinates)&&h.coordinates.length===4&&!h.coordinates.some(b=>!Array.isArray(b)||b.length!==2||b.some(C=>typeof C!="number"))||this.fire(new a.j(new a.a1(`sources.${o}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new a.j(new a.a1(`sources.${o}`,null,'missing required property "coordinates"'))),h.animate&&typeof h.animate!="boolean"&&this.fire(new a.j(new a.a1(`sources.${o}`,null,'optional "animate" property must be a boolean value'))),h.canvas?typeof h.canvas=="string"||h.canvas instanceof HTMLCanvasElement||this.fire(new a.j(new a.a1(`sources.${o}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new a.j(new a.a1(`sources.${o}`,null,'missing required property "canvas"'))),this.options=h,this.animate=h.animate===void 0||h.animate}load(){return a._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new a.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(o){this.map=o,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let o=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,o=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,o=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const h=this.map.painter.context,p=h.gl;this.boundsBuffer||(this.boundsBuffer=h.createVertexBuffer(this._boundsArray,Ye.members)),this.boundsSegments||(this.boundsSegments=a.$.simpleSegment(0,0,4,2)),this.texture?(o||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new re(h,this.canvas,p.RGBA,{premultiply:!0});let m=!1;for(const b in this.tiles){const C=this.tiles[b];C.state!=="loaded"&&(C.state="loaded",C.texture=this.texture,m=!0)}m&&this.fire(new a.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const o of[this.canvas.width,this.canvas.height])if(isNaN(o)||o<=0)return!0;return!1}}const gn={},Mn=y=>{switch(y){case"geojson":return qe;case"image":return Ot;case"raster":return we;case"raster-dem":return Ei;case"vector":return vt;case"video":return Pi;case"canvas":return bi}return gn[y]},Qi="RTLPluginLoaded";class io extends a.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=zi()}_syncState(o){return this.status=o,this.dispatcher.broadcast("SRPS",{pluginStatus:o,pluginURL:this.url}).catch(h=>{throw this.status="error",h})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(o){return a._(this,arguments,void 0,function*(h,p=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=S.resolveURL(h),!this.url)throw new Error(`requested url ${h} is invalid`);if(this.status==="unavailable"){if(!p)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return a._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new a.k(Qi))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Oi=null;function nt(){return Oi||(Oi=new io),Oi}class Mi{constructor(o,h){this.timeAdded=0,this.fadeEndTime=0,this.tileID=o,this.uid=a.a3(),this.uses=0,this.tileSize=h,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(o){const h=o+this.timeAdded;h<this.fadeEndTime||(this.fadeEndTime=h)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(o){this.demTexture&&o.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(o,h,p){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",o){o.featureIndex&&(this.latestFeatureIndex=o.featureIndex,o.rawTileData?(this.latestRawTileData=o.rawTileData,this.latestFeatureIndex.rawTileData=o.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=o.collisionBoxArray,this.buckets=function(m,b){const C={};if(!b)return C;for(const M of m){const L=M.layerIds.map(O=>b.getLayer(O)).filter(Boolean);if(L.length!==0){M.layers=L,M.stateDependentLayerIds&&(M.stateDependentLayers=M.stateDependentLayerIds.map(O=>L.filter($=>$.id===O)[0]));for(const O of L)C[O.id]=M}}return C}(o.buckets,h.style),this.hasSymbolBuckets=!1;for(const m in this.buckets){const b=this.buckets[m];if(b instanceof a.a5){if(this.hasSymbolBuckets=!0,!p)break;b.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const m in this.buckets){const b=this.buckets[m];if(b instanceof a.a5&&b.hasRTLText){this.hasRTLText=!0,nt().lazyLoad();break}}this.queryPadding=0;for(const m in this.buckets){const b=this.buckets[m];this.queryPadding=Math.max(this.queryPadding,h.style.getLayer(m).queryRadius(b))}o.imageAtlas&&(this.imageAtlas=o.imageAtlas),o.glyphAtlasImage&&(this.glyphAtlasImage=o.glyphAtlasImage)}else this.collisionBoxArray=new a.a4}unloadVectorData(){for(const o in this.buckets)this.buckets[o].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(o){return this.buckets[o.id]}upload(o){for(const p in this.buckets){const m=this.buckets[p];m.uploadPending()&&m.upload(o)}const h=o.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new re(o,this.imageAtlas.image,h.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new re(o,this.glyphAtlasImage,h.ALPHA),this.glyphAtlasImage=null)}prepare(o){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(o,this.imageAtlasTexture)}queryRenderedFeatures(o,h,p,m,b,C,M,L,O,$){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:m,cameraQueryGeometry:b,scale:C,tileSize:this.tileSize,pixelPosMatrix:$,transform:L,params:M,queryPadding:this.queryPadding*O},o,h,p):{}}querySourceFeatures(o,h){const p=this.latestFeatureIndex;if(!p||!p.rawTileData)return;const m=p.loadVTLayers(),b=h&&h.sourceLayer?h.sourceLayer:"",C=m._geojsonTileLayer||m[b];if(!C)return;const M=a.a6(h&&h.filter),{z:L,x:O,y:$}=this.tileID.canonical,q={z:L,x:O,y:$};for(let ee=0;ee<C.length;ee++){const pe=C.feature(ee);if(M.needGeometry){const ce=a.a7(pe,!0);if(!M.filter(new a.a8(this.tileID.overscaledZ),ce,this.tileID.canonical))continue}else if(!M.filter(new a.a8(this.tileID.overscaledZ),pe))continue;const fe=p.getId(pe,b),_e=new a.a9(pe,L,O,$,fe);_e.tile=q,o.push(_e)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(o){const h=this.expirationTime;if(o.cacheControl){const p=a.aa(o.cacheControl);p["max-age"]&&(this.expirationTime=Date.now()+1e3*p["max-age"])}else o.expires&&(this.expirationTime=new Date(o.expires).getTime());if(this.expirationTime){const p=Date.now();let m=!1;if(this.expirationTime>p)m=!1;else if(h)if(this.expirationTime<h)m=!0;else{const b=this.expirationTime-h;b?this.expirationTime=p+Math.max(b,3e4):m=!0}else m=!0;m?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(o,h){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(o).length===0)return;const p=this.latestFeatureIndex.loadVTLayers();for(const m in this.buckets){if(!h.style.hasLayer(m))continue;const b=this.buckets[m],C=b.layers[0].sourceLayer||"_geojsonTileLayer",M=p[C],L=o[C];if(!M||!L||Object.keys(L).length===0)continue;b.update(L,M,this.imageAtlas&&this.imageAtlas.patternPositions||{});const O=h&&h.style&&h.style.getLayer(m);O&&(this.queryPadding=Math.max(this.queryPadding,O.queryRadius(b)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<S.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(o){this.symbolFadeHoldUntil=S.now()+o}setDependencies(o,h){const p={};for(const m of h)p[m]=!0;this.dependencies[o]=p}hasDependency(o,h){for(const p of o){const m=this.dependencies[p];if(m){for(const b of h)if(m[b])return!0}}return!1}}class Yt{constructor(o,h){this.max=o,this.onRemove=h,this.reset()}reset(){for(const o in this.data)for(const h of this.data[o])h.timeout&&clearTimeout(h.timeout),this.onRemove(h.value);return this.data={},this.order=[],this}add(o,h,p){const m=o.wrapped().key;this.data[m]===void 0&&(this.data[m]=[]);const b={value:h,timeout:void 0};if(p!==void 0&&(b.timeout=setTimeout(()=>{this.remove(o,b)},p)),this.data[m].push(b),this.order.push(m),this.order.length>this.max){const C=this._getAndRemoveByKey(this.order[0]);C&&this.onRemove(C)}return this}has(o){return o.wrapped().key in this.data}getAndRemove(o){return this.has(o)?this._getAndRemoveByKey(o.wrapped().key):null}_getAndRemoveByKey(o){const h=this.data[o].shift();return h.timeout&&clearTimeout(h.timeout),this.data[o].length===0&&delete this.data[o],this.order.splice(this.order.indexOf(o),1),h.value}getByKey(o){const h=this.data[o];return h?h[0].value:null}get(o){return this.has(o)?this.data[o.wrapped().key][0].value:null}remove(o,h){if(!this.has(o))return this;const p=o.wrapped().key,m=h===void 0?0:this.data[p].indexOf(h),b=this.data[p][m];return this.data[p].splice(m,1),b.timeout&&clearTimeout(b.timeout),this.data[p].length===0&&delete this.data[p],this.onRemove(b.value),this.order.splice(this.order.indexOf(p),1),this}setMaxSize(o){for(this.max=o;this.order.length>this.max;){const h=this._getAndRemoveByKey(this.order[0]);h&&this.onRemove(h)}return this}filter(o){const h=[];for(const p in this.data)for(const m of this.data[p])o(m.value)||h.push(m);for(const p of h)this.remove(p.value.tileID,p)}}class Ni{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(o,h,p){const m=String(h);if(this.stateChanges[o]=this.stateChanges[o]||{},this.stateChanges[o][m]=this.stateChanges[o][m]||{},a.e(this.stateChanges[o][m],p),this.deletedStates[o]===null){this.deletedStates[o]={};for(const b in this.state[o])b!==m&&(this.deletedStates[o][b]=null)}else if(this.deletedStates[o]&&this.deletedStates[o][m]===null){this.deletedStates[o][m]={};for(const b in this.state[o][m])p[b]||(this.deletedStates[o][m][b]=null)}else for(const b in p)this.deletedStates[o]&&this.deletedStates[o][m]&&this.deletedStates[o][m][b]===null&&delete this.deletedStates[o][m][b]}removeFeatureState(o,h,p){if(this.deletedStates[o]===null)return;const m=String(h);if(this.deletedStates[o]=this.deletedStates[o]||{},p&&h!==void 0)this.deletedStates[o][m]!==null&&(this.deletedStates[o][m]=this.deletedStates[o][m]||{},this.deletedStates[o][m][p]=null);else if(h!==void 0)if(this.stateChanges[o]&&this.stateChanges[o][m])for(p in this.deletedStates[o][m]={},this.stateChanges[o][m])this.deletedStates[o][m][p]=null;else this.deletedStates[o][m]=null;else this.deletedStates[o]=null}getState(o,h){const p=String(h),m=a.e({},(this.state[o]||{})[p],(this.stateChanges[o]||{})[p]);if(this.deletedStates[o]===null)return{};if(this.deletedStates[o]){const b=this.deletedStates[o][h];if(b===null)return{};for(const C in b)delete m[C]}return m}initializeTileState(o,h){o.setFeatureState(this.state,h)}coalesceChanges(o,h){const p={};for(const m in this.stateChanges){this.state[m]=this.state[m]||{};const b={};for(const C in this.stateChanges[m])this.state[m][C]||(this.state[m][C]={}),a.e(this.state[m][C],this.stateChanges[m][C]),b[C]=this.state[m][C];p[m]=b}for(const m in this.deletedStates){this.state[m]=this.state[m]||{};const b={};if(this.deletedStates[m]===null)for(const C in this.state[m])b[C]={},this.state[m][C]={};else for(const C in this.deletedStates[m]){if(this.deletedStates[m][C]===null)this.state[m][C]={};else for(const M of Object.keys(this.deletedStates[m][C]))delete this.state[m][C][M];b[C]=this.state[m][C]}p[m]=p[m]||{},a.e(p[m],b)}if(this.stateChanges={},this.deletedStates={},Object.keys(p).length!==0)for(const m in o)o[m].setFeatureState(p,h)}}class Xi extends a.E{constructor(o,h,p){super(),this.id=o,this.dispatcher=p,this.on("data",m=>this._dataHandler(m)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((m,b,C,M)=>{const L=new(Mn(b.type))(m,b,C,M);if(L.id!==m)throw new Error(`Expected Source id to be ${m} instead of ${L.id}`);return L})(o,h,p,this),this._tiles={},this._cache=new Yt(0,m=>this._unloadTile(m)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Ni,this._didEmitContent=!1,this._updated=!1}onAdd(o){this.map=o,this._maxTileCacheSize=o?o._maxTileCacheSize:null,this._maxTileCacheZoomLevels=o?o._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(o)}onRemove(o){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(o)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const o in this._tiles){const h=this._tiles[o];if(h.state!=="loaded"&&h.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const o=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,o&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(o,h,p){return a._(this,void 0,void 0,function*(){try{yield this._source.loadTile(o),this._tileLoaded(o,h,p)}catch(m){o.state="errored",m.status!==404?this._source.fire(new a.j(m,{tile:o})):this.update(this.transform,this.terrain)}})}_unloadTile(o){this._source.unloadTile&&this._source.unloadTile(o)}_abortTile(o){this._source.abortTile&&this._source.abortTile(o),this._source.fire(new a.k("dataabort",{tile:o,coord:o.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(o){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const h in this._tiles){const p=this._tiles[h];p.upload(o),p.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(o=>o.tileID).sort(_t).map(o=>o.key)}getRenderableIds(o){const h=[];for(const p in this._tiles)this._isIdRenderable(p,o)&&h.push(this._tiles[p]);return o?h.sort((p,m)=>{const b=p.tileID,C=m.tileID,M=new a.P(b.canonical.x,b.canonical.y)._rotate(this.transform.angle),L=new a.P(C.canonical.x,C.canonical.y)._rotate(this.transform.angle);return b.overscaledZ-C.overscaledZ||L.y-M.y||L.x-M.x}).map(p=>p.tileID.key):h.map(p=>p.tileID).sort(_t).map(p=>p.key)}hasRenderableParent(o){const h=this.findLoadedParent(o,0);return!!h&&this._isIdRenderable(h.tileID.key)}_isIdRenderable(o,h){return this._tiles[o]&&this._tiles[o].hasData()&&!this._coveredTiles[o]&&(h||!this._tiles[o].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const o in this._tiles)this._tiles[o].state!=="errored"&&this._reloadTile(o,"reloading")}}_reloadTile(o,h){return a._(this,void 0,void 0,function*(){const p=this._tiles[o];p&&(p.state!=="loading"&&(p.state=h),yield this._loadTile(p,o,h))})}_tileLoaded(o,h,p){o.timeAdded=S.now(),p==="expired"&&(o.refreshedUponExpiration=!0),this._setTileReloadTimer(h,o),this.getSource().type==="raster-dem"&&o.dem&&this._backfillDEM(o),this._state.initializeTileState(o,this.map?this.map.painter:null),o.aborted||this._source.fire(new a.k("data",{dataType:"source",tile:o,coord:o.tileID}))}_backfillDEM(o){const h=this.getRenderableIds();for(let m=0;m<h.length;m++){const b=h[m];if(o.neighboringTiles&&o.neighboringTiles[b]){const C=this.getTileByID(b);p(o,C),p(C,o)}}function p(m,b){m.needsHillshadePrepare=!0,m.needsTerrainPrepare=!0;let C=b.tileID.canonical.x-m.tileID.canonical.x;const M=b.tileID.canonical.y-m.tileID.canonical.y,L=Math.pow(2,m.tileID.canonical.z),O=b.tileID.key;C===0&&M===0||Math.abs(M)>1||(Math.abs(C)>1&&(Math.abs(C+L)===1?C+=L:Math.abs(C-L)===1&&(C-=L)),b.dem&&m.dem&&(m.dem.backfillBorder(b.dem,C,M),m.neighboringTiles&&m.neighboringTiles[O]&&(m.neighboringTiles[O].backfilled=!0)))}}getTile(o){return this.getTileByID(o.key)}getTileByID(o){return this._tiles[o]}_retainLoadedChildren(o,h,p,m){for(const b in this._tiles){let C=this._tiles[b];if(m[b]||!C.hasData()||C.tileID.overscaledZ<=h||C.tileID.overscaledZ>p)continue;let M=C.tileID;for(;C&&C.tileID.overscaledZ>h+1;){const O=C.tileID.scaledTo(C.tileID.overscaledZ-1);C=this._tiles[O.key],C&&C.hasData()&&(M=O)}let L=M;for(;L.overscaledZ>h;)if(L=L.scaledTo(L.overscaledZ-1),o[L.key]){m[M.key]=M;break}}}findLoadedParent(o,h){if(o.key in this._loadedParentTiles){const p=this._loadedParentTiles[o.key];return p&&p.tileID.overscaledZ>=h?p:null}for(let p=o.overscaledZ-1;p>=h;p--){const m=o.scaledTo(p),b=this._getLoadedTile(m);if(b)return b}}_getLoadedTile(o){const h=this._tiles[o.key];return h&&h.hasData()?h:this._cache.getByKey(o.wrapped().key)}updateCacheSize(o){const h=Math.ceil(o.width/this._source.tileSize)+1,p=Math.ceil(o.height/this._source.tileSize)+1,m=Math.floor(h*p*(this._maxTileCacheZoomLevels===null?a.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),b=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,m):m;this._cache.setMaxSize(b)}handleWrapJump(o){const h=Math.round((o-(this._prevLng===void 0?o:this._prevLng))/360);if(this._prevLng=o,h){const p={};for(const m in this._tiles){const b=this._tiles[m];b.tileID=b.tileID.unwrapTo(b.tileID.wrap+h),p[b.tileID.key]=b}this._tiles=p;for(const m in this._timers)clearTimeout(this._timers[m]),delete this._timers[m];for(const m in this._tiles)this._setTileReloadTimer(m,this._tiles[m])}}update(o,h){if(!this._sourceLoaded||this._paused)return;let p;this.transform=o,this.terrain=h,this.updateCacheSize(o),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?p=o.getVisibleUnwrappedCoordinates(this._source.tileID).map($=>new a.Q($.canonical.z,$.wrap,$.canonical.z,$.canonical.x,$.canonical.y)):(p=o.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:h}),this._source.hasTile&&(p=p.filter($=>this._source.hasTile($)))):p=[];const m=o.coveringZoomLevel(this._source),b=Math.max(m-Xi.maxOverzooming,this._source.minzoom),C=Math.max(m+Xi.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const $={};for(const q of p)if(q.canonical.z>this._source.minzoom){const ee=q.scaledTo(q.canonical.z-1);$[ee.key]=ee;const pe=q.scaledTo(Math.max(this._source.minzoom,Math.min(q.canonical.z,5)));$[pe.key]=pe}p=p.concat(Object.values($))}const M=p.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,M&&this.fire(new a.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const L=this._updateRetainedTiles(p,m);if(oi(this._source.type)){const $={},q={},ee=Object.keys(L),pe=S.now();for(const fe of ee){const _e=L[fe],ce=this._tiles[fe];if(!ce||ce.fadeEndTime!==0&&ce.fadeEndTime<=pe)continue;const Ce=this.findLoadedParent(_e,b);Ce&&(this._addTile(Ce.tileID),$[Ce.tileID.key]=Ce.tileID),q[fe]=_e}this._retainLoadedChildren(q,m,C,L);for(const fe in $)L[fe]||(this._coveredTiles[fe]=!0,L[fe]=$[fe]);if(h){const fe={},_e={};for(const ce of p)this._tiles[ce.key].hasData()?fe[ce.key]=ce:_e[ce.key]=ce;for(const ce in _e){const Ce=_e[ce].children(this._source.maxzoom);this._tiles[Ce[0].key]&&this._tiles[Ce[1].key]&&this._tiles[Ce[2].key]&&this._tiles[Ce[3].key]&&(fe[Ce[0].key]=L[Ce[0].key]=Ce[0],fe[Ce[1].key]=L[Ce[1].key]=Ce[1],fe[Ce[2].key]=L[Ce[2].key]=Ce[2],fe[Ce[3].key]=L[Ce[3].key]=Ce[3],delete _e[ce])}for(const ce in _e){const Ce=this.findLoadedParent(_e[ce],this._source.minzoom);if(Ce){fe[Ce.tileID.key]=L[Ce.tileID.key]=Ce.tileID;for(const Ze in fe)fe[Ze].isChildOf(Ce.tileID)&&delete fe[Ze]}}for(const ce in this._tiles)fe[ce]||(this._coveredTiles[ce]=!0)}}for(const $ in L)this._tiles[$].clearFadeHold();const O=a.ab(this._tiles,L);for(const $ of O){const q=this._tiles[$];q.hasSymbolBuckets&&!q.holdingForFade()?q.setHoldDuration(this.map._fadeDuration):q.hasSymbolBuckets&&!q.symbolFadeFinished()||this._removeTile($)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const o in this._tiles)this._tiles[o].holdingForFade()&&this._removeTile(o)}_updateRetainedTiles(o,h){const p={},m={},b=Math.max(h-Xi.maxOverzooming,this._source.minzoom),C=Math.max(h+Xi.maxUnderzooming,this._source.minzoom),M={};for(const L of o){const O=this._addTile(L);p[L.key]=L,O.hasData()||h<this._source.maxzoom&&(M[L.key]=L)}this._retainLoadedChildren(M,h,C,p);for(const L of o){let O=this._tiles[L.key];if(O.hasData())continue;if(h+1>this._source.maxzoom){const q=L.children(this._source.maxzoom)[0],ee=this.getTile(q);if(ee&&ee.hasData()){p[q.key]=q;continue}}else{const q=L.children(this._source.maxzoom);if(p[q[0].key]&&p[q[1].key]&&p[q[2].key]&&p[q[3].key])continue}let $=O.wasRequested();for(let q=L.overscaledZ-1;q>=b;--q){const ee=L.scaledTo(q);if(m[ee.key])break;if(m[ee.key]=!0,O=this.getTile(ee),!O&&$&&(O=this._addTile(ee)),O){const pe=O.hasData();if(($||pe)&&(p[ee.key]=ee),$=O.wasRequested(),pe)break}}}return p}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const o in this._tiles){const h=[];let p,m=this._tiles[o].tileID;for(;m.overscaledZ>0;){if(m.key in this._loadedParentTiles){p=this._loadedParentTiles[m.key];break}h.push(m.key);const b=m.scaledTo(m.overscaledZ-1);if(p=this._getLoadedTile(b),p)break;m=b}for(const b of h)this._loadedParentTiles[b]=p}}_addTile(o){let h=this._tiles[o.key];if(h)return h;h=this._cache.getAndRemove(o),h&&(this._setTileReloadTimer(o.key,h),h.tileID=o,this._state.initializeTileState(h,this.map?this.map.painter:null),this._cacheTimers[o.key]&&(clearTimeout(this._cacheTimers[o.key]),delete this._cacheTimers[o.key],this._setTileReloadTimer(o.key,h)));const p=h;return h||(h=new Mi(o,this._source.tileSize*o.overscaleFactor()),this._loadTile(h,o.key,h.state)),h.uses++,this._tiles[o.key]=h,p||this._source.fire(new a.k("dataloading",{tile:h,coord:h.tileID,dataType:"source"})),h}_setTileReloadTimer(o,h){o in this._timers&&(clearTimeout(this._timers[o]),delete this._timers[o]);const p=h.getExpiryTimeout();p&&(this._timers[o]=setTimeout(()=>{this._reloadTile(o,"expired"),delete this._timers[o]},p))}_removeTile(o){const h=this._tiles[o];h&&(h.uses--,delete this._tiles[o],this._timers[o]&&(clearTimeout(this._timers[o]),delete this._timers[o]),h.uses>0||(h.hasData()&&h.state!=="reloading"?this._cache.add(h.tileID,h,h.getExpiryTimeout()):(h.aborted=!0,this._abortTile(h),this._unloadTile(h))))}_dataHandler(o){const h=o.sourceDataType;o.dataType==="source"&&h==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&o.dataType==="source"&&h==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const o in this._tiles)this._removeTile(o);this._cache.reset()}tilesIn(o,h,p){const m=[],b=this.transform;if(!b)return m;const C=p?b.getCameraQueryGeometry(o):o,M=o.map(fe=>b.pointCoordinate(fe,this.terrain)),L=C.map(fe=>b.pointCoordinate(fe,this.terrain)),O=this.getIds();let $=1/0,q=1/0,ee=-1/0,pe=-1/0;for(const fe of L)$=Math.min($,fe.x),q=Math.min(q,fe.y),ee=Math.max(ee,fe.x),pe=Math.max(pe,fe.y);for(let fe=0;fe<O.length;fe++){const _e=this._tiles[O[fe]];if(_e.holdingForFade())continue;const ce=_e.tileID,Ce=Math.pow(2,b.zoom-_e.tileID.overscaledZ),Ze=h*_e.queryPadding*a.W/_e.tileSize/Ce,be=[ce.getTilePoint(new a.Y($,q)),ce.getTilePoint(new a.Y(ee,pe))];if(be[0].x-Ze<a.W&&be[0].y-Ze<a.W&&be[1].x+Ze>=0&&be[1].y+Ze>=0){const Re=M.map(He=>ce.getTilePoint(He)),We=L.map(He=>ce.getTilePoint(He));m.push({tile:_e,tileID:ce,queryGeometry:Re,cameraQueryGeometry:We,scale:Ce})}}return m}getVisibleCoordinates(o){const h=this.getRenderableIds(o).map(p=>this._tiles[p].tileID);for(const p of h)p.posMatrix=this.transform.calculatePosMatrix(p.toUnwrapped());return h}hasTransition(){if(this._source.hasTransition())return!0;if(oi(this._source.type)){const o=S.now();for(const h in this._tiles)if(this._tiles[h].fadeEndTime>=o)return!0}return!1}setFeatureState(o,h,p){this._state.updateState(o=o||"_geojsonTileLayer",h,p)}removeFeatureState(o,h,p){this._state.removeFeatureState(o=o||"_geojsonTileLayer",h,p)}getFeatureState(o,h){return this._state.getState(o=o||"_geojsonTileLayer",h)}setDependencies(o,h,p){const m=this._tiles[o];m&&m.setDependencies(h,p)}reloadTilesForDependencies(o,h){for(const p in this._tiles)this._tiles[p].hasDependency(o,h)&&this._reloadTile(p,"reloading");this._cache.filter(p=>!p.hasDependency(o,h))}}function _t(y,o){const h=Math.abs(2*y.wrap)-+(y.wrap<0),p=Math.abs(2*o.wrap)-+(o.wrap<0);return y.overscaledZ-o.overscaledZ||p-h||o.canonical.y-y.canonical.y||o.canonical.x-y.canonical.x}function oi(y){return y==="raster"||y==="image"||y==="video"}Xi.maxOverzooming=10,Xi.maxUnderzooming=3;class Qt{constructor(o,h){this.reset(o,h)}reset(o,h){this.points=o||[],this._distances=[0];for(let p=1;p<this.points.length;p++)this._distances[p]=this._distances[p-1]+this.points[p].dist(this.points[p-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(h||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(o){if(this.points.length===1)return this.points[0];o=a.ac(o,0,1);let h=1,p=this._distances[h];const m=o*this.paddedLength+this.padding;for(;p<m&&h<this._distances.length;)p=this._distances[++h];const b=h-1,C=this._distances[b],M=p-C,L=M>0?(m-C)/M:0;return this.points[b].mult(1-L).add(this.points[h].mult(L))}}function Ki(y,o){let h=!0;return y==="always"||y!=="never"&&o!=="never"||(h=!1),h}class br{constructor(o,h,p){const m=this.boxCells=[],b=this.circleCells=[];this.xCellCount=Math.ceil(o/p),this.yCellCount=Math.ceil(h/p);for(let C=0;C<this.xCellCount*this.yCellCount;C++)m.push([]),b.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=o,this.height=h,this.xScale=this.xCellCount/o,this.yScale=this.yCellCount/h,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(o,h,p,m,b){this._forEachCell(h,p,m,b,this._insertBoxCell,this.boxUid++),this.boxKeys.push(o),this.bboxes.push(h),this.bboxes.push(p),this.bboxes.push(m),this.bboxes.push(b)}insertCircle(o,h,p,m){this._forEachCell(h-m,p-m,h+m,p+m,this._insertCircleCell,this.circleUid++),this.circleKeys.push(o),this.circles.push(h),this.circles.push(p),this.circles.push(m)}_insertBoxCell(o,h,p,m,b,C){this.boxCells[b].push(C)}_insertCircleCell(o,h,p,m,b,C){this.circleCells[b].push(C)}_query(o,h,p,m,b,C,M){if(p<0||o>this.width||m<0||h>this.height)return[];const L=[];if(o<=0&&h<=0&&this.width<=p&&this.height<=m){if(b)return[{key:null,x1:o,y1:h,x2:p,y2:m}];for(let O=0;O<this.boxKeys.length;O++)L.push({key:this.boxKeys[O],x1:this.bboxes[4*O],y1:this.bboxes[4*O+1],x2:this.bboxes[4*O+2],y2:this.bboxes[4*O+3]});for(let O=0;O<this.circleKeys.length;O++){const $=this.circles[3*O],q=this.circles[3*O+1],ee=this.circles[3*O+2];L.push({key:this.circleKeys[O],x1:$-ee,y1:q-ee,x2:$+ee,y2:q+ee})}}else this._forEachCell(o,h,p,m,this._queryCell,L,{hitTest:b,overlapMode:C,seenUids:{box:{},circle:{}}},M);return L}query(o,h,p,m){return this._query(o,h,p,m,!1,null)}hitTest(o,h,p,m,b,C){return this._query(o,h,p,m,!0,b,C).length>0}hitTestCircle(o,h,p,m,b){const C=o-p,M=o+p,L=h-p,O=h+p;if(M<0||C>this.width||O<0||L>this.height)return!1;const $=[];return this._forEachCell(C,L,M,O,this._queryCellCircle,$,{hitTest:!0,overlapMode:m,circle:{x:o,y:h,radius:p},seenUids:{box:{},circle:{}}},b),$.length>0}_queryCell(o,h,p,m,b,C,M,L){const{seenUids:O,hitTest:$,overlapMode:q}=M,ee=this.boxCells[b];if(ee!==null){const fe=this.bboxes;for(const _e of ee)if(!O.box[_e]){O.box[_e]=!0;const ce=4*_e,Ce=this.boxKeys[_e];if(o<=fe[ce+2]&&h<=fe[ce+3]&&p>=fe[ce+0]&&m>=fe[ce+1]&&(!L||L(Ce))&&(!$||!Ki(q,Ce.overlapMode))&&(C.push({key:Ce,x1:fe[ce],y1:fe[ce+1],x2:fe[ce+2],y2:fe[ce+3]}),$))return!0}}const pe=this.circleCells[b];if(pe!==null){const fe=this.circles;for(const _e of pe)if(!O.circle[_e]){O.circle[_e]=!0;const ce=3*_e,Ce=this.circleKeys[_e];if(this._circleAndRectCollide(fe[ce],fe[ce+1],fe[ce+2],o,h,p,m)&&(!L||L(Ce))&&(!$||!Ki(q,Ce.overlapMode))){const Ze=fe[ce],be=fe[ce+1],Re=fe[ce+2];if(C.push({key:Ce,x1:Ze-Re,y1:be-Re,x2:Ze+Re,y2:be+Re}),$)return!0}}}return!1}_queryCellCircle(o,h,p,m,b,C,M,L){const{circle:O,seenUids:$,overlapMode:q}=M,ee=this.boxCells[b];if(ee!==null){const fe=this.bboxes;for(const _e of ee)if(!$.box[_e]){$.box[_e]=!0;const ce=4*_e,Ce=this.boxKeys[_e];if(this._circleAndRectCollide(O.x,O.y,O.radius,fe[ce+0],fe[ce+1],fe[ce+2],fe[ce+3])&&(!L||L(Ce))&&!Ki(q,Ce.overlapMode))return C.push(!0),!0}}const pe=this.circleCells[b];if(pe!==null){const fe=this.circles;for(const _e of pe)if(!$.circle[_e]){$.circle[_e]=!0;const ce=3*_e,Ce=this.circleKeys[_e];if(this._circlesCollide(fe[ce],fe[ce+1],fe[ce+2],O.x,O.y,O.radius)&&(!L||L(Ce))&&!Ki(q,Ce.overlapMode))return C.push(!0),!0}}}_forEachCell(o,h,p,m,b,C,M,L){const O=this._convertToXCellCoord(o),$=this._convertToYCellCoord(h),q=this._convertToXCellCoord(p),ee=this._convertToYCellCoord(m);for(let pe=O;pe<=q;pe++)for(let fe=$;fe<=ee;fe++)if(b.call(this,o,h,p,m,this.xCellCount*fe+pe,C,M,L))return}_convertToXCellCoord(o){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(o*this.xScale)))}_convertToYCellCoord(o){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(o*this.yScale)))}_circlesCollide(o,h,p,m,b,C){const M=m-o,L=b-h,O=p+C;return O*O>M*M+L*L}_circleAndRectCollide(o,h,p,m,b,C,M){const L=(C-m)/2,O=Math.abs(o-(m+L));if(O>L+p)return!1;const $=(M-b)/2,q=Math.abs(h-(b+$));if(q>$+p)return!1;if(O<=L||q<=$)return!0;const ee=O-L,pe=q-$;return ee*ee+pe*pe<=p*p}}function ni(y,o,h,p,m){const b=a.F();return o?(a.J(b,b,[1/m,1/m,1]),h||a.ad(b,b,p.angle)):a.K(b,p.labelPlaneMatrix,y),b}function no(y,o,h,p,m){if(o){const b=a.ae(y);return a.J(b,b,[m,m,1]),h||a.ad(b,b,-p.angle),b}return p.glCoordMatrix}function _n(y,o,h){let p;h?(p=[y.x,y.y,h(y.x,y.y),1],a.af(p,p,o)):(p=[y.x,y.y,0,1],Je(p,p,o));const m=p[3];return{point:new a.P(p[0]/m,p[1]/m),signedDistanceFromCamera:m}}function me(y,o){return .5+y/o*.5}function H(y,o){const h=y[0]/y[3],p=y[1]/y[3];return h>=-o[0]&&h<=o[0]&&p>=-o[1]&&p<=o[1]}function K(y,o,h,p,m,b,C,M,L,O){const $=p?y.textSizeData:y.iconSizeData,q=a.ag($,h.transform.zoom),ee=[256/h.width*2+1,256/h.height*2+1],pe=p?y.text.dynamicLayoutVertexArray:y.icon.dynamicLayoutVertexArray;pe.clear();const fe=y.lineVertexArray,_e=p?y.text.placedSymbolArray:y.icon.placedSymbolArray,ce=h.transform.width/h.transform.height;let Ce=!1;for(let Ze=0;Ze<_e.length;Ze++){const be=_e.get(Ze);if(be.hidden||be.writingMode===a.ah.vertical&&!Ce){Ge(be.numGlyphs,pe);continue}let Re;if(Ce=!1,O?(Re=[be.anchorX,be.anchorY,O(be.anchorX,be.anchorY),1],a.af(Re,Re,o)):(Re=[be.anchorX,be.anchorY,0,1],Je(Re,Re,o)),!H(Re,ee)){Ge(be.numGlyphs,pe);continue}const We=me(h.transform.cameraToCenterDistance,Re[3]),He=a.ai($,q,be),Xe=C?He/We:He*We,rt=new a.P(be.anchorX,be.anchorY),it=_n(rt,m,O).point,pt={projections:{},offsets:{}},yt=Pe(be,Xe,!1,M,o,m,b,y.glyphOffsetArray,fe,pe,it,rt,pt,ce,L,O);Ce=yt.useVertical,(yt.notEnoughRoom||Ce||yt.needsFlipping&&Pe(be,Xe,!0,M,o,m,b,y.glyphOffsetArray,fe,pe,it,rt,pt,ce,L,O).notEnoughRoom)&&Ge(be.numGlyphs,pe)}p?y.text.dynamicLayoutVertexBuffer.updateData(pe):y.icon.dynamicLayoutVertexBuffer.updateData(pe)}function ie(y,o,h,p,m,b,C,M,L,O,$,q,ee){const pe=M.glyphStartIndex+M.numGlyphs,fe=M.lineStartIndex,_e=M.lineStartIndex+M.lineLength,ce=o.getoffsetX(M.glyphStartIndex),Ce=o.getoffsetX(pe-1),Ze=Ue(y*ce,h,p,m,b,C,M.segment,fe,_e,L,O,$,q,ee);if(!Ze)return null;const be=Ue(y*Ce,h,p,m,b,C,M.segment,fe,_e,L,O,$,q,ee);return be?{first:Ze,last:be}:null}function de(y,o,h,p){return y===a.ah.horizontal&&Math.abs(h.y-o.y)>Math.abs(h.x-o.x)*p?{useVertical:!0}:(y===a.ah.vertical?o.y<h.y:o.x>h.x)?{needsFlipping:!0}:null}function Pe(y,o,h,p,m,b,C,M,L,O,$,q,ee,pe,fe,_e){const ce=o/24,Ce=y.lineOffsetX*ce,Ze=y.lineOffsetY*ce;let be;if(y.numGlyphs>1){const Re=y.glyphStartIndex+y.numGlyphs,We=y.lineStartIndex,He=y.lineStartIndex+y.lineLength,Xe=ie(ce,M,Ce,Ze,h,$,q,y,L,b,ee,fe,_e);if(!Xe)return{notEnoughRoom:!0};const rt=_n(Xe.first.point,C,_e).point,it=_n(Xe.last.point,C,_e).point;if(p&&!h){const pt=de(y.writingMode,rt,it,pe);if(pt)return pt}be=[Xe.first];for(let pt=y.glyphStartIndex+1;pt<Re-1;pt++)be.push(Ue(ce*M.getoffsetX(pt),Ce,Ze,h,$,q,y.segment,We,He,L,b,ee,fe,_e));be.push(Xe.last)}else{if(p&&!h){const We=_n(q,m,_e).point,He=y.lineStartIndex+y.segment+1,Xe=new a.P(L.getx(He),L.gety(He)),rt=_n(Xe,m,_e),it=rt.signedDistanceFromCamera>0?rt.point:ze(q,Xe,We,1,m,_e),pt=de(y.writingMode,We,it,pe);if(pt)return pt}const Re=Ue(ce*M.getoffsetX(y.glyphStartIndex),Ce,Ze,h,$,q,y.segment,y.lineStartIndex,y.lineStartIndex+y.lineLength,L,b,ee,fe,_e);if(!Re)return{notEnoughRoom:!0};be=[Re]}for(const Re of be)a.aj(O,Re.point,Re.angle);return{}}function ze(y,o,h,p,m,b){const C=_n(y.add(y.sub(o)._unit()),m,b).point,M=h.sub(C);return h.add(M._mult(p/M.mag()))}function Be(y,o){const{projectionCache:h,lineVertexArray:p,labelPlaneMatrix:m,tileAnchorPoint:b,distanceFromAnchor:C,getElevation:M,previousVertex:L,direction:O,absOffsetX:$}=o;if(h.projections[y])return h.projections[y];const q=new a.P(p.getx(y),p.gety(y)),ee=_n(q,m,M);if(ee.signedDistanceFromCamera>0)return h.projections[y]=ee.point,ee.point;const pe=y-O;return ze(C===0?b:new a.P(p.getx(pe),p.gety(pe)),q,L,$-C+1,m,M)}function Se(y,o,h){return y._unit()._perp()._mult(o*h)}function W(y,o,h,p,m,b,C,M){const{projectionCache:L,direction:O}=M;if(L.offsets[y])return L.offsets[y];const $=h.add(o);if(y+O<p||y+O>=m)return L.offsets[y]=$,$;const q=Be(y+O,M),ee=Se(q.sub(h),C,O),pe=h.add(ee),fe=q.add(ee);return L.offsets[y]=a.ak(b,$,pe,fe)||$,L.offsets[y]}function Ue(y,o,h,p,m,b,C,M,L,O,$,q,ee,pe){const fe=p?y-o:y+o;let _e=fe>0?1:-1,ce=0;p&&(_e*=-1,ce=Math.PI),_e<0&&(ce+=Math.PI);let Ce,Ze,be=_e>0?M+C:M+C+1,Re=m,We=m,He=0,Xe=0;const rt=Math.abs(fe),it=[];let pt;for(;He+Xe<=rt;){if(be+=_e,be<M||be>=L)return null;He+=Xe,We=Re,Ze=Ce;const bt={projectionCache:q,lineVertexArray:O,labelPlaneMatrix:$,tileAnchorPoint:b,distanceFromAnchor:He,getElevation:pe,previousVertex:We,direction:_e,absOffsetX:rt};if(Re=Be(be,bt),h===0)it.push(We),pt=Re.sub(We);else{let Kt;const li=Re.sub(We);Kt=li.mag()===0?Se(Be(be+_e,bt).sub(Re),h,_e):Se(li,h,_e),Ze||(Ze=We.add(Kt)),Ce=W(be,Kt,Re,M,L,Ze,h,bt),it.push(Ze),pt=Ce.sub(Ze)}Xe=pt.mag()}const yt=pt._mult((rt-He)/Xe)._add(Ze||We),ai=ce+Math.atan2(Re.y-We.y,Re.x-We.x);return it.push(yt),{point:yt,angle:ee?ai:0,path:it}}const $e=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Ge(y,o){for(let h=0;h<y;h++){const p=o.length;o.resize(p+4),o.float32.set($e,3*p)}}function Je(y,o,h){const p=o[0],m=o[1];return y[0]=h[0]*p+h[4]*m+h[12],y[1]=h[1]*p+h[5]*m+h[13],y[3]=h[3]*p+h[7]*m+h[15],y}const dt=100;class Bt{constructor(o,h=new br(o.width+200,o.height+200,25),p=new br(o.width+200,o.height+200,25)){this.transform=o,this.grid=h,this.ignoredGrid=p,this.pitchfactor=Math.cos(o._pitch)*o.cameraToCenterDistance,this.screenRightBoundary=o.width+dt,this.screenBottomBoundary=o.height+dt,this.gridRightBoundary=o.width+200,this.gridBottomBoundary=o.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(o,h,p,m,b,C){const M=this.projectAndGetPerspectiveRatio(m,o.anchorPointX,o.anchorPointY,C),L=p*M.perspectiveRatio,O=o.x1*L+M.point.x,$=o.y1*L+M.point.y,q=o.x2*L+M.point.x,ee=o.y2*L+M.point.y;return!this.isInsideGrid(O,$,q,ee)||h!=="always"&&this.grid.hitTest(O,$,q,ee,h,b)||M.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[O,$,q,ee],offscreen:this.isOffscreen(O,$,q,ee)}}placeCollisionCircles(o,h,p,m,b,C,M,L,O,$,q,ee,pe,fe){const _e=[],ce=new a.P(h.anchorX,h.anchorY),Ce=_n(ce,C,fe),Ze=me(this.transform.cameraToCenterDistance,Ce.signedDistanceFromCamera),be=($?b/Ze:b*Ze)/a.ao,Re=_n(ce,M,fe).point,We=ie(be,m,h.lineOffsetX*be,h.lineOffsetY*be,!1,Re,ce,h,p,M,{projections:{},offsets:{}},!1,fe);let He=!1,Xe=!1,rt=!0;if(We){const it=.5*ee*Ze+pe,pt=new a.P(-100,-100),yt=new a.P(this.screenRightBoundary,this.screenBottomBoundary),ai=new Qt,bt=We.first,Kt=We.last;let li=[];for(let di=bt.path.length-1;di>=1;di--)li.push(bt.path[di]);for(let di=1;di<Kt.path.length;di++)li.push(Kt.path[di]);const Ti=2.5*it;if(L){const di=li.map(mi=>_n(mi,L,fe));li=di.some(mi=>mi.signedDistanceFromCamera<=0)?[]:di.map(mi=>mi.point)}let ii=[];if(li.length>0){const di=li[0].clone(),mi=li[0].clone();for(let wn=1;wn<li.length;wn++)di.x=Math.min(di.x,li[wn].x),di.y=Math.min(di.y,li[wn].y),mi.x=Math.max(mi.x,li[wn].x),mi.y=Math.max(mi.y,li[wn].y);ii=di.x>=pt.x&&mi.x<=yt.x&&di.y>=pt.y&&mi.y<=yt.y?[li]:mi.x<pt.x||di.x>yt.x||mi.y<pt.y||di.y>yt.y?[]:a.al([li],pt.x,pt.y,yt.x,yt.y)}for(const di of ii){ai.reset(di,.25*it);let mi=0;mi=ai.length<=.5*it?1:Math.ceil(ai.paddedLength/Ti)+1;for(let wn=0;wn<mi;wn++){const Vi=wn/Math.max(mi-1,1),Fr=ai.lerp(Vi),qn=Fr.x+dt,fn=Fr.y+dt;_e.push(qn,fn,it,0);const Zn=qn-it,Or=fn-it,wo=qn+it,Yo=fn+it;if(rt=rt&&this.isOffscreen(Zn,Or,wo,Yo),Xe=Xe||this.isInsideGrid(Zn,Or,wo,Yo),o!=="always"&&this.grid.hitTestCircle(qn,fn,it,o,q)&&(He=!0,!O))return{circles:[],offscreen:!1,collisionDetected:He}}}}return{circles:!O&&He||!Xe||Ze<this.perspectiveRatioCutoff?[]:_e,offscreen:rt,collisionDetected:He}}queryRenderedSymbols(o){if(o.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const h=[];let p=1/0,m=1/0,b=-1/0,C=-1/0;for(const $ of o){const q=new a.P($.x+dt,$.y+dt);p=Math.min(p,q.x),m=Math.min(m,q.y),b=Math.max(b,q.x),C=Math.max(C,q.y),h.push(q)}const M=this.grid.query(p,m,b,C).concat(this.ignoredGrid.query(p,m,b,C)),L={},O={};for(const $ of M){const q=$.key;if(L[q.bucketInstanceId]===void 0&&(L[q.bucketInstanceId]={}),L[q.bucketInstanceId][q.featureIndex])continue;const ee=[new a.P($.x1,$.y1),new a.P($.x2,$.y1),new a.P($.x2,$.y2),new a.P($.x1,$.y2)];a.am(h,ee)&&(L[q.bucketInstanceId][q.featureIndex]=!0,O[q.bucketInstanceId]===void 0&&(O[q.bucketInstanceId]=[]),O[q.bucketInstanceId].push(q.featureIndex))}return O}insertCollisionBox(o,h,p,m,b,C){(p?this.ignoredGrid:this.grid).insert({bucketInstanceId:m,featureIndex:b,collisionGroupID:C,overlapMode:h},o[0],o[1],o[2],o[3])}insertCollisionCircles(o,h,p,m,b,C){const M=p?this.ignoredGrid:this.grid,L={bucketInstanceId:m,featureIndex:b,collisionGroupID:C,overlapMode:h};for(let O=0;O<o.length;O+=4)M.insertCircle(L,o[O],o[O+1],o[O+2])}projectAndGetPerspectiveRatio(o,h,p,m){let b;return m?(b=[h,p,m(h,p),1],a.af(b,b,o)):(b=[h,p,0,1],Je(b,b,o)),{point:new a.P((b[0]/b[3]+1)/2*this.transform.width+dt,(-b[1]/b[3]+1)/2*this.transform.height+dt),perspectiveRatio:.5+this.transform.cameraToCenterDistance/b[3]*.5}}isOffscreen(o,h,p,m){return p<dt||o>=this.screenRightBoundary||m<dt||h>this.screenBottomBoundary}isInsideGrid(o,h,p,m){return p>=0&&o<this.gridRightBoundary&&m>=0&&h<this.gridBottomBoundary}getViewportMatrix(){const o=a.an([]);return a.H(o,o,[-100,-100,0]),o}}function Xt(y,o,h){return o*(a.W/(y.tileSize*Math.pow(2,h-y.tileID.overscaledZ)))}class ui{constructor(o,h,p,m){this.opacity=o?Math.max(0,Math.min(1,o.opacity+(o.placed?h:-h))):m&&p?1:0,this.placed=p}isHidden(){return this.opacity===0&&!this.placed}}class wi{constructor(o,h,p,m,b){this.text=new ui(o?o.text:null,h,p,b),this.icon=new ui(o?o.icon:null,h,m,b)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class sn{constructor(o,h,p){this.text=o,this.icon=h,this.skipFade=p}}class Rn{constructor(){this.invProjMatrix=a.F(),this.viewportMatrix=a.F(),this.circles=[]}}class hi{constructor(o,h,p,m,b){this.bucketInstanceId=o,this.featureIndex=h,this.sourceLayerIndex=p,this.bucketIndex=m,this.tileID=b}}class yn{constructor(o){this.crossSourceCollisions=o,this.maxGroupID=0,this.collisionGroups={}}get(o){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[o]){const h=++this.maxGroupID;this.collisionGroups[o]={ID:h,predicate:p=>p.collisionGroupID===h}}return this.collisionGroups[o]}}function $n(y,o,h,p,m){const{horizontalAlign:b,verticalAlign:C}=a.at(y);return new a.P(-(b-.5)*o+p[0]*m,-(C-.5)*h+p[1]*m)}function hr(y,o,h,p,m,b){const{x1:C,x2:M,y1:L,y2:O,anchorPointX:$,anchorPointY:q}=y,ee=new a.P(o,h);return p&&ee._rotate(m?b:-b),{x1:C+ee.x,y1:L+ee.y,x2:M+ee.x,y2:O+ee.y,anchorPointX:$,anchorPointY:q}}class wr{constructor(o,h,p,m,b){this.transform=o.clone(),this.terrain=h,this.collisionIndex=new Bt(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=p,this.retainedQueryData={},this.collisionGroups=new yn(m),this.collisionCircleArrays={},this.prevPlacement=b,b&&(b.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(o,h,p,m){const b=p.getBucket(h),C=p.latestFeatureIndex;if(!b||!C||h.id!==b.layerIds[0])return;const M=p.collisionBoxArray,L=b.layers[0].layout,O=Math.pow(2,this.transform.zoom-p.tileID.overscaledZ),$=p.tileSize/a.W,q=this.transform.calculatePosMatrix(p.tileID.toUnwrapped()),ee=L.get("text-pitch-alignment")==="map",pe=L.get("text-rotation-alignment")==="map",fe=Xt(p,1,this.transform.zoom),_e=ni(q,ee,pe,this.transform,fe);let ce=null;if(ee){const Ze=no(q,ee,pe,this.transform,fe);ce=a.K([],this.transform.labelPlaneMatrix,Ze)}this.retainedQueryData[b.bucketInstanceId]=new hi(b.bucketInstanceId,C,b.sourceLayerIndex,b.index,p.tileID);const Ce={bucket:b,layout:L,posMatrix:q,textLabelPlaneMatrix:_e,labelToScreenMatrix:ce,scale:O,textPixelRatio:$,holdingForFade:p.holdingForFade(),collisionBoxArray:M,partiallyEvaluatedTextSize:a.ag(b.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(b.sourceID)};if(m)for(const Ze of b.sortKeyRanges){const{sortKey:be,symbolInstanceStart:Re,symbolInstanceEnd:We}=Ze;o.push({sortKey:be,symbolInstanceStart:Re,symbolInstanceEnd:We,parameters:Ce})}else o.push({symbolInstanceStart:0,symbolInstanceEnd:b.symbolInstances.length,parameters:Ce})}attemptAnchorPlacement(o,h,p,m,b,C,M,L,O,$,q,ee,pe,fe,_e,ce){const Ce=a.ap[o.textAnchor],Ze=[o.textOffset0,o.textOffset1],be=$n(Ce,p,m,Ze,b),Re=this.collisionIndex.placeCollisionBox(hr(h,be.x,be.y,C,M,this.transform.angle),q,L,O,$.predicate,ce);if((!_e||this.collisionIndex.placeCollisionBox(hr(_e,be.x,be.y,C,M,this.transform.angle),q,L,O,$.predicate,ce).box.length!==0)&&Re.box.length>0){let We;if(this.prevPlacement&&this.prevPlacement.variableOffsets[ee.crossTileID]&&this.prevPlacement.placements[ee.crossTileID]&&this.prevPlacement.placements[ee.crossTileID].text&&(We=this.prevPlacement.variableOffsets[ee.crossTileID].anchor),ee.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[ee.crossTileID]={textOffset:Ze,width:p,height:m,anchor:Ce,textBoxScale:b,prevAnchor:We},this.markUsedJustification(pe,Ce,ee,fe),pe.allowVerticalPlacement&&(this.markUsedOrientation(pe,fe,ee),this.placedOrientations[ee.crossTileID]=fe),{shift:be,placedGlyphBoxes:Re}}}placeLayerBucketPart(o,h,p){const{bucket:m,layout:b,posMatrix:C,textLabelPlaneMatrix:M,labelToScreenMatrix:L,textPixelRatio:O,holdingForFade:$,collisionBoxArray:q,partiallyEvaluatedTextSize:ee,collisionGroup:pe}=o.parameters,fe=b.get("text-optional"),_e=b.get("icon-optional"),ce=a.aq(b,"text-overlap","text-allow-overlap"),Ce=ce==="always",Ze=a.aq(b,"icon-overlap","icon-allow-overlap"),be=Ze==="always",Re=b.get("text-rotation-alignment")==="map",We=b.get("text-pitch-alignment")==="map",He=b.get("icon-text-fit")!=="none",Xe=b.get("symbol-z-order")==="viewport-y",rt=Ce&&(be||!m.hasIconData()||_e),it=be&&(Ce||!m.hasTextData()||fe);!m.collisionArrays&&q&&m.deserializeCollisionBoxes(q);const pt=this.retainedQueryData[m.bucketInstanceId].tileID,yt=this.terrain?(bt,Kt)=>this.terrain.getElevation(pt,bt,Kt):null,ai=(bt,Kt)=>{var li,Ti;if(h[bt.crossTileID])return;if($)return void(this.placements[bt.crossTileID]=new sn(!1,!1,!1));let ii=!1,di=!1,mi=!0,wn=null,Vi={box:null,offscreen:null},Fr={box:null,offscreen:null},qn=null,fn=null,Zn=null,Or=0,wo=0,Yo=0;Kt.textFeatureIndex?Or=Kt.textFeatureIndex:bt.useRuntimeCollisionCircles&&(Or=bt.featureIndex),Kt.verticalTextFeatureIndex&&(wo=Kt.verticalTextFeatureIndex);const Aa=Kt.textBox;if(Aa){const Fn=On=>{let mn=a.ah.horizontal;if(m.allowVerticalPlacement&&!On&&this.prevPlacement){const Yr=this.prevPlacement.placedOrientations[bt.crossTileID];Yr&&(this.placedOrientations[bt.crossTileID]=Yr,mn=Yr,this.markUsedOrientation(m,mn,bt))}return mn},pn=(On,mn)=>{if(m.allowVerticalPlacement&&bt.numVerticalGlyphVertices>0&&Kt.verticalTextBox){for(const Yr of m.writingModes)if(Yr===a.ah.vertical?(Vi=mn(),Fr=Vi):Vi=On(),Vi&&Vi.box&&Vi.box.length)break}else Vi=On()},ln=bt.textAnchorOffsetStartIndex,Jr=bt.textAnchorOffsetEndIndex;if(Jr===ln){const On=(mn,Yr)=>{const Nn=this.collisionIndex.placeCollisionBox(mn,ce,O,C,pe.predicate,yt);return Nn&&Nn.box&&Nn.box.length&&(this.markUsedOrientation(m,Yr,bt),this.placedOrientations[bt.crossTileID]=Yr),Nn};pn(()=>On(Aa,a.ah.horizontal),()=>{const mn=Kt.verticalTextBox;return m.allowVerticalPlacement&&bt.numVerticalGlyphVertices>0&&mn?On(mn,a.ah.vertical):{box:null,offscreen:null}}),Fn(Vi&&Vi.box&&Vi.box.length)}else{let On=a.ap[(Ti=(li=this.prevPlacement)===null||li===void 0?void 0:li.variableOffsets[bt.crossTileID])===null||Ti===void 0?void 0:Ti.anchor];const mn=(Nn,Sn,$c)=>{const Rh=Nn.x2-Nn.x1,fs=Nn.y2-Nn.y1,ps=bt.textBoxScale,Ml=He&&Ze==="never"?Sn:null;let es={box:[],offscreen:!1},qc=ce==="never"?1:2,Bh="never";On&&qc++;for(let Zc=0;Zc<qc;Zc++){for(let Gc=ln;Gc<Jr;Gc++){const Il=m.textAnchorOffsets.get(Gc);if(On&&Il.textAnchor!==On)continue;const Wc=this.attemptAnchorPlacement(Il,Nn,Rh,fs,ps,Re,We,O,C,pe,Bh,bt,m,$c,Ml,yt);if(Wc&&(es=Wc.placedGlyphBoxes,es&&es.box&&es.box.length))return ii=!0,wn=Wc.shift,es}On?On=null:Bh=ce}return es};pn(()=>mn(Aa,Kt.iconBox,a.ah.horizontal),()=>{const Nn=Kt.verticalTextBox;return m.allowVerticalPlacement&&!(Vi&&Vi.box&&Vi.box.length)&&bt.numVerticalGlyphVertices>0&&Nn?mn(Nn,Kt.verticalIconBox,a.ah.vertical):{box:null,offscreen:null}}),Vi&&(ii=Vi.box,mi=Vi.offscreen);const Yr=Fn(Vi&&Vi.box);if(!ii&&this.prevPlacement){const Nn=this.prevPlacement.variableOffsets[bt.crossTileID];Nn&&(this.variableOffsets[bt.crossTileID]=Nn,this.markUsedJustification(m,Nn.anchor,bt,Yr))}}}if(qn=Vi,ii=qn&&qn.box&&qn.box.length>0,mi=qn&&qn.offscreen,bt.useRuntimeCollisionCircles){const Fn=m.text.placedSymbolArray.get(bt.centerJustifiedTextSymbolIndex),pn=a.ai(m.textSizeData,ee,Fn),ln=b.get("text-padding");fn=this.collisionIndex.placeCollisionCircles(ce,Fn,m.lineVertexArray,m.glyphOffsetArray,pn,C,M,L,p,We,pe.predicate,bt.collisionCircleDiameter,ln,yt),fn.circles.length&&fn.collisionDetected&&!p&&a.w("Collisions detected, but collision boxes are not shown"),ii=Ce||fn.circles.length>0&&!fn.collisionDetected,mi=mi&&fn.offscreen}if(Kt.iconFeatureIndex&&(Yo=Kt.iconFeatureIndex),Kt.iconBox){const Fn=pn=>{const ln=He&&wn?hr(pn,wn.x,wn.y,Re,We,this.transform.angle):pn;return this.collisionIndex.placeCollisionBox(ln,Ze,O,C,pe.predicate,yt)};Fr&&Fr.box&&Fr.box.length&&Kt.verticalIconBox?(Zn=Fn(Kt.verticalIconBox),di=Zn.box.length>0):(Zn=Fn(Kt.iconBox),di=Zn.box.length>0),mi=mi&&Zn.offscreen}const Qo=fe||bt.numHorizontalGlyphVertices===0&&bt.numVerticalGlyphVertices===0,xo=_e||bt.numIconVertices===0;if(Qo||xo?xo?Qo||(di=di&&ii):ii=di&&ii:di=ii=di&&ii,ii&&qn&&qn.box&&this.collisionIndex.insertCollisionBox(qn.box,ce,b.get("text-ignore-placement"),m.bucketInstanceId,Fr&&Fr.box&&wo?wo:Or,pe.ID),di&&Zn&&this.collisionIndex.insertCollisionBox(Zn.box,Ze,b.get("icon-ignore-placement"),m.bucketInstanceId,Yo,pe.ID),fn&&(ii&&this.collisionIndex.insertCollisionCircles(fn.circles,ce,b.get("text-ignore-placement"),m.bucketInstanceId,Or,pe.ID),p)){const Fn=m.bucketInstanceId;let pn=this.collisionCircleArrays[Fn];pn===void 0&&(pn=this.collisionCircleArrays[Fn]=new Rn);for(let ln=0;ln<fn.circles.length;ln+=4)pn.circles.push(fn.circles[ln+0]),pn.circles.push(fn.circles[ln+1]),pn.circles.push(fn.circles[ln+2]),pn.circles.push(fn.collisionDetected?1:0)}if(bt.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(m.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[bt.crossTileID]=new sn(ii||rt,di||it,mi||m.justReloaded),h[bt.crossTileID]=!0};if(Xe){if(o.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const bt=m.getSortedSymbolIndexes(this.transform.angle);for(let Kt=bt.length-1;Kt>=0;--Kt){const li=bt[Kt];ai(m.symbolInstances.get(li),m.collisionArrays[li])}}else for(let bt=o.symbolInstanceStart;bt<o.symbolInstanceEnd;bt++)ai(m.symbolInstances.get(bt),m.collisionArrays[bt]);if(p&&m.bucketInstanceId in this.collisionCircleArrays){const bt=this.collisionCircleArrays[m.bucketInstanceId];a.ar(bt.invProjMatrix,C),bt.viewportMatrix=this.collisionIndex.getViewportMatrix()}m.justReloaded=!1}markUsedJustification(o,h,p,m){let b;b=m===a.ah.vertical?p.verticalPlacedTextSymbolIndex:{left:p.leftJustifiedTextSymbolIndex,center:p.centerJustifiedTextSymbolIndex,right:p.rightJustifiedTextSymbolIndex}[a.as(h)];const C=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex,p.verticalPlacedTextSymbolIndex];for(const M of C)M>=0&&(o.text.placedSymbolArray.get(M).crossTileID=b>=0&&M!==b?0:p.crossTileID)}markUsedOrientation(o,h,p){const m=h===a.ah.horizontal||h===a.ah.horizontalOnly?h:0,b=h===a.ah.vertical?h:0,C=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex];for(const M of C)o.text.placedSymbolArray.get(M).placedOrientation=m;p.verticalPlacedTextSymbolIndex&&(o.text.placedSymbolArray.get(p.verticalPlacedTextSymbolIndex).placedOrientation=b)}commit(o){this.commitTime=o,this.zoomAtLastRecencyCheck=this.transform.zoom;const h=this.prevPlacement;let p=!1;this.prevZoomAdjustment=h?h.zoomAdjustment(this.transform.zoom):0;const m=h?h.symbolFadeChange(o):1,b=h?h.opacities:{},C=h?h.variableOffsets:{},M=h?h.placedOrientations:{};for(const L in this.placements){const O=this.placements[L],$=b[L];$?(this.opacities[L]=new wi($,m,O.text,O.icon),p=p||O.text!==$.text.placed||O.icon!==$.icon.placed):(this.opacities[L]=new wi(null,m,O.text,O.icon,O.skipFade),p=p||O.text||O.icon)}for(const L in b){const O=b[L];if(!this.opacities[L]){const $=new wi(O,m,!1,!1);$.isHidden()||(this.opacities[L]=$,p=p||O.text.placed||O.icon.placed)}}for(const L in C)this.variableOffsets[L]||!this.opacities[L]||this.opacities[L].isHidden()||(this.variableOffsets[L]=C[L]);for(const L in M)this.placedOrientations[L]||!this.opacities[L]||this.opacities[L].isHidden()||(this.placedOrientations[L]=M[L]);if(h&&h.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");p?this.lastPlacementChangeTime=o:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=h?h.lastPlacementChangeTime:o)}updateLayerOpacities(o,h){const p={};for(const m of h){const b=m.getBucket(o);b&&m.latestFeatureIndex&&o.id===b.layerIds[0]&&this.updateBucketOpacities(b,p,m.collisionBoxArray)}}updateBucketOpacities(o,h,p){o.hasTextData()&&(o.text.opacityVertexArray.clear(),o.text.hasVisibleVertices=!1),o.hasIconData()&&(o.icon.opacityVertexArray.clear(),o.icon.hasVisibleVertices=!1),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexArray.clear(),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexArray.clear();const m=o.layers[0],b=m.layout,C=new wi(null,0,!1,!1,!0),M=b.get("text-allow-overlap"),L=b.get("icon-allow-overlap"),O=m._unevaluatedLayout.hasValue("text-variable-anchor")||m._unevaluatedLayout.hasValue("text-variable-anchor-offset"),$=b.get("text-rotation-alignment")==="map",q=b.get("text-pitch-alignment")==="map",ee=b.get("icon-text-fit")!=="none",pe=new wi(null,0,M&&(L||!o.hasIconData()||b.get("icon-optional")),L&&(M||!o.hasTextData()||b.get("text-optional")),!0);!o.collisionArrays&&p&&(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData())&&o.deserializeCollisionBoxes(p);const fe=(_e,ce,Ce)=>{for(let Ze=0;Ze<ce/4;Ze++)_e.opacityVertexArray.emplaceBack(Ce);_e.hasVisibleVertices=_e.hasVisibleVertices||Ce!==ca};for(let _e=0;_e<o.symbolInstances.length;_e++){const ce=o.symbolInstances.get(_e),{numHorizontalGlyphVertices:Ce,numVerticalGlyphVertices:Ze,crossTileID:be}=ce;let Re=this.opacities[be];h[be]?Re=C:Re||(Re=pe,this.opacities[be]=Re),h[be]=!0;const We=ce.numIconVertices>0,He=this.placedOrientations[ce.crossTileID],Xe=He===a.ah.vertical,rt=He===a.ah.horizontal||He===a.ah.horizontalOnly;if(Ce>0||Ze>0){const it=xr(Re.text);fe(o.text,Ce,Xe?ca:it),fe(o.text,Ze,rt?ca:it);const pt=Re.text.isHidden();[ce.rightJustifiedTextSymbolIndex,ce.centerJustifiedTextSymbolIndex,ce.leftJustifiedTextSymbolIndex].forEach(bt=>{bt>=0&&(o.text.placedSymbolArray.get(bt).hidden=pt||Xe?1:0)}),ce.verticalPlacedTextSymbolIndex>=0&&(o.text.placedSymbolArray.get(ce.verticalPlacedTextSymbolIndex).hidden=pt||rt?1:0);const yt=this.variableOffsets[ce.crossTileID];yt&&this.markUsedJustification(o,yt.anchor,ce,He);const ai=this.placedOrientations[ce.crossTileID];ai&&(this.markUsedJustification(o,"left",ce,ai),this.markUsedOrientation(o,ai,ce))}if(We){const it=xr(Re.icon),pt=!(ee&&ce.verticalPlacedIconSymbolIndex&&Xe);ce.placedIconSymbolIndex>=0&&(fe(o.icon,ce.numIconVertices,pt?it:ca),o.icon.placedSymbolArray.get(ce.placedIconSymbolIndex).hidden=Re.icon.isHidden()),ce.verticalPlacedIconSymbolIndex>=0&&(fe(o.icon,ce.numVerticalIconVertices,pt?ca:it),o.icon.placedSymbolArray.get(ce.verticalPlacedIconSymbolIndex).hidden=Re.icon.isHidden())}if(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData()){const it=o.collisionArrays[_e];if(it){let pt=new a.P(0,0);if(it.textBox||it.verticalTextBox){let ai=!0;if(O){const bt=this.variableOffsets[be];bt?(pt=$n(bt.anchor,bt.width,bt.height,bt.textOffset,bt.textBoxScale),$&&pt._rotate(q?this.transform.angle:-this.transform.angle)):ai=!1}it.textBox&&Qn(o.textCollisionBox.collisionVertexArray,Re.text.placed,!ai||Xe,pt.x,pt.y),it.verticalTextBox&&Qn(o.textCollisionBox.collisionVertexArray,Re.text.placed,!ai||rt,pt.x,pt.y)}const yt=!!(!rt&&it.verticalIconBox);it.iconBox&&Qn(o.iconCollisionBox.collisionVertexArray,Re.icon.placed,yt,ee?pt.x:0,ee?pt.y:0),it.verticalIconBox&&Qn(o.iconCollisionBox.collisionVertexArray,Re.icon.placed,!yt,ee?pt.x:0,ee?pt.y:0)}}}if(o.sortFeatures(this.transform.angle),this.retainedQueryData[o.bucketInstanceId]&&(this.retainedQueryData[o.bucketInstanceId].featureSortOrder=o.featureSortOrder),o.hasTextData()&&o.text.opacityVertexBuffer&&o.text.opacityVertexBuffer.updateData(o.text.opacityVertexArray),o.hasIconData()&&o.icon.opacityVertexBuffer&&o.icon.opacityVertexBuffer.updateData(o.icon.opacityVertexArray),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexBuffer&&o.iconCollisionBox.collisionVertexBuffer.updateData(o.iconCollisionBox.collisionVertexArray),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexBuffer&&o.textCollisionBox.collisionVertexBuffer.updateData(o.textCollisionBox.collisionVertexArray),o.text.opacityVertexArray.length!==o.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${o.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${o.text.layoutVertexArray.length}) / 4`);if(o.icon.opacityVertexArray.length!==o.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${o.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${o.icon.layoutVertexArray.length}) / 4`);if(o.bucketInstanceId in this.collisionCircleArrays){const _e=this.collisionCircleArrays[o.bucketInstanceId];o.placementInvProjMatrix=_e.invProjMatrix,o.placementViewportMatrix=_e.viewportMatrix,o.collisionCircleArray=_e.circles,delete this.collisionCircleArrays[o.bucketInstanceId]}}symbolFadeChange(o){return this.fadeDuration===0?1:(o-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(o){return Math.max(0,(this.transform.zoom-o)/1.5)}hasTransitions(o){return this.stale||o-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(o,h){const p=this.zoomAtLastRecencyCheck===h?1-this.zoomAdjustment(h):1;return this.zoomAtLastRecencyCheck=h,this.commitTime+this.fadeDuration*p>o}setStale(){this.stale=!0}}function Qn(y,o,h,p,m){y.emplaceBack(o?1:0,h?1:0,p||0,m||0),y.emplaceBack(o?1:0,h?1:0,p||0,m||0),y.emplaceBack(o?1:0,h?1:0,p||0,m||0),y.emplaceBack(o?1:0,h?1:0,p||0,m||0)}const go=Math.pow(2,25),Yu=Math.pow(2,24),jd=Math.pow(2,17),ji=Math.pow(2,16),hc=Math.pow(2,9),dc=Math.pow(2,8),Dr=Math.pow(2,1);function xr(y){if(y.opacity===0&&!y.placed)return 0;if(y.opacity===1&&y.placed)return 4294967295;const o=y.placed?1:0,h=Math.floor(127*y.opacity);return h*go+o*Yu+h*jd+o*ji+h*hc+o*dc+h*Dr+o}const ca=0;class Xr{constructor(o){this._sortAcrossTiles=o.layout.get("symbol-z-order")!=="viewport-y"&&!o.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(o,h,p,m,b){const C=this._bucketParts;for(;this._currentTileIndex<o.length;)if(h.getBucketParts(C,m,o[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,b())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,C.sort((M,L)=>M.sortKey-L.sortKey));this._currentPartIndex<C.length;)if(h.placeLayerBucketPart(C[this._currentPartIndex],this._seenCrossTileIDs,p),this._currentPartIndex++,b())return!0;return!1}}class Kr{constructor(o,h,p,m,b,C,M,L){this.placement=new wr(o,h,C,M,L),this._currentPlacementIndex=p.length-1,this._forceFullPlacement=m,this._showCollisionBoxes=b,this._done=!1}isDone(){return this._done}continuePlacement(o,h,p){const m=S.now(),b=()=>!this._forceFullPlacement&&S.now()-m>2;for(;this._currentPlacementIndex>=0;){const C=h[o[this._currentPlacementIndex]],M=this.placement.collisionIndex.transform.zoom;if(C.type==="symbol"&&(!C.minzoom||C.minzoom<=M)&&(!C.maxzoom||C.maxzoom>M)){if(this._inProgressLayer||(this._inProgressLayer=new Xr(C)),this._inProgressLayer.continuePlacement(p[C.source],this.placement,this._showCollisionBoxes,C,b))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(o){return this.placement.commit(o),this.placement}}const As=512/a.W/2;class $a{constructor(o,h,p){this.tileID=o,this.bucketInstanceId=p,this._symbolsByKey={};const m=new Map;for(let b=0;b<h.length;b++){const C=h.get(b),M=C.key,L=m.get(M);L?L.push(C):m.set(M,[C])}for(const[b,C]of m){const M={positions:C.map(L=>({x:Math.floor(L.anchorX*As),y:Math.floor(L.anchorY*As)})),crossTileIDs:C.map(L=>L.crossTileID)};if(M.positions.length>128){const L=new a.au(M.positions.length,16,Uint16Array);for(const{x:O,y:$}of M.positions)L.add(O,$);L.finish(),delete M.positions,M.index=L}this._symbolsByKey[b]=M}}getScaledCoordinates(o,h){const{x:p,y:m,z:b}=this.tileID.canonical,{x:C,y:M,z:L}=h.canonical,O=As/Math.pow(2,L-b),$=(M*a.W+o.anchorY)*O,q=m*a.W*As;return{x:Math.floor((C*a.W+o.anchorX)*O-p*a.W*As),y:Math.floor($-q)}}findMatches(o,h,p){const m=this.tileID.canonical.z<h.canonical.z?1:Math.pow(2,this.tileID.canonical.z-h.canonical.z);for(let b=0;b<o.length;b++){const C=o.get(b);if(C.crossTileID)continue;const M=this._symbolsByKey[C.key];if(!M)continue;const L=this.getScaledCoordinates(C,h);if(M.index){const O=M.index.range(L.x-m,L.y-m,L.x+m,L.y+m).sort();for(const $ of O){const q=M.crossTileIDs[$];if(!p[q]){p[q]=!0,C.crossTileID=q;break}}}else if(M.positions)for(let O=0;O<M.positions.length;O++){const $=M.positions[O],q=M.crossTileIDs[O];if(Math.abs($.x-L.x)<=m&&Math.abs($.y-L.y)<=m&&!p[q]){p[q]=!0,C.crossTileID=q;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:o})=>o)}}class Bn{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class ua{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(o){const h=Math.round((o-this.lng)/360);if(h!==0)for(const p in this.indexes){const m=this.indexes[p],b={};for(const C in m){const M=m[C];M.tileID=M.tileID.unwrapTo(M.tileID.wrap+h),b[M.tileID.key]=M}this.indexes[p]=b}this.lng=o}addBucket(o,h,p){if(this.indexes[o.overscaledZ]&&this.indexes[o.overscaledZ][o.key]){if(this.indexes[o.overscaledZ][o.key].bucketInstanceId===h.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(o.overscaledZ,this.indexes[o.overscaledZ][o.key])}for(let b=0;b<h.symbolInstances.length;b++)h.symbolInstances.get(b).crossTileID=0;this.usedCrossTileIDs[o.overscaledZ]||(this.usedCrossTileIDs[o.overscaledZ]={});const m=this.usedCrossTileIDs[o.overscaledZ];for(const b in this.indexes){const C=this.indexes[b];if(Number(b)>o.overscaledZ)for(const M in C){const L=C[M];L.tileID.isChildOf(o)&&L.findMatches(h.symbolInstances,o,m)}else{const M=C[o.scaledTo(Number(b)).key];M&&M.findMatches(h.symbolInstances,o,m)}}for(let b=0;b<h.symbolInstances.length;b++){const C=h.symbolInstances.get(b);C.crossTileID||(C.crossTileID=p.generate(),m[C.crossTileID]=!0)}return this.indexes[o.overscaledZ]===void 0&&(this.indexes[o.overscaledZ]={}),this.indexes[o.overscaledZ][o.key]=new $a(o,h.symbolInstances,h.bucketInstanceId),!0}removeBucketCrossTileIDs(o,h){for(const p of h.getCrossTileIDsLists())for(const m of p)delete this.usedCrossTileIDs[o][m]}removeStaleBuckets(o){let h=!1;for(const p in this.indexes){const m=this.indexes[p];for(const b in m)o[m[b].bucketInstanceId]||(this.removeBucketCrossTileIDs(p,m[b]),delete m[b],h=!0)}return h}}class Go{constructor(){this.layerIndexes={},this.crossTileIDs=new Bn,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(o,h,p){let m=this.layerIndexes[o.id];m===void 0&&(m=this.layerIndexes[o.id]=new ua);let b=!1;const C={};m.handleWrapJump(p);for(const M of h){const L=M.getBucket(o);L&&o.id===L.layerIds[0]&&(L.bucketInstanceId||(L.bucketInstanceId=++this.maxBucketInstanceId),m.addBucket(M.tileID,L,this.crossTileIDs)&&(b=!0),C[L.bucketInstanceId]=!0)}return m.removeStaleBuckets(C)&&(b=!0),b}pruneUnusedLayers(o){const h={};o.forEach(p=>{h[p]=!0});for(const p in this.layerIndexes)h[p]||delete this.layerIndexes[p]}}const dn=(y,o)=>a.t(y,o&&o.filter(h=>h.identifier!=="source.canvas")),qa=a.av();class Rr extends a.E{constructor(o,h={}){super(),this._rtlPluginLoaded=()=>{for(const p in this.sourceCaches){const m=this.sourceCaches[p].getSource().type;m!=="vector"&&m!=="geojson"||this.sourceCaches[p].reload()}},this.map=o,this.dispatcher=new gi(Jt(),o._getMapId()),this.dispatcher.registerMessageHandler("GG",(p,m)=>this.getGlyphs(p,m)),this.dispatcher.registerMessageHandler("GI",(p,m)=>this.getImages(p,m)),this.imageManager=new Ke,this.imageManager.setEventedParent(this),this.glyphManager=new mt(o._requestManager,h.localIdeographFontFamily),this.lineAtlas=new Nt(256,512),this.crossTileSymbolIndex=new Go,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new a.aw,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",a.ax()),nt().on(Qi,this._rtlPluginLoaded),this.on("data",p=>{if(p.dataType!=="source"||p.sourceDataType!=="metadata")return;const m=this.sourceCaches[p.sourceId];if(!m)return;const b=m.getSource();if(b&&b.vectorLayerIds)for(const C in this._layers){const M=this._layers[C];M.source===b.id&&this._validateLayer(M)}})}loadURL(o,h={},p){this.fire(new a.k("dataloading",{dataType:"style"})),h.validate=typeof h.validate!="boolean"||h.validate;const m=this.map._requestManager.transformRequest(o,"Style");this._loadStyleRequest=new AbortController,a.h(m,this._loadStyleRequest).then(b=>{this._loadStyleRequest=null,this._load(b.data,h,p)}).catch(b=>{this._loadStyleRequest=null,b&&this.fire(new a.j(b))})}loadJSON(o,h={},p){this.fire(new a.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,S.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,h.validate=h.validate!==!1,this._load(o,h,p)}).catch(()=>{})}loadEmpty(){this.fire(new a.k("dataloading",{dataType:"style"})),this._load(qa,{validate:!1})}_load(o,h,p){var m;const b=h.transformStyle?h.transformStyle(p,o):o;if(!h.validate||!dn(this,a.x(b))){this._loaded=!0,this.stylesheet=b;for(const C in b.sources)this.addSource(C,b.sources[C],{validate:!1});b.sprite?this._loadSprite(b.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(b.glyphs),this._createLayers(),this.light=new ri(this.stylesheet.light),this.map.setTerrain((m=this.stylesheet.terrain)!==null&&m!==void 0?m:null),this.fire(new a.k("data",{dataType:"style"})),this.fire(new a.k("style.load"))}}_createLayers(){const o=a.ay(this.stylesheet.layers);this.dispatcher.broadcast("SL",o),this._order=o.map(h=>h.id),this._layers={},this._serializedLayers=null;for(const h of o){const p=a.az(h);p.setEventedParent(this,{layer:{id:h.id}}),this._layers[h.id]=p}}_loadSprite(o,h=!1,p=void 0){let m;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(b,C,M,L){return a._(this,void 0,void 0,function*(){const O=Ne(b),$=M>1?"@2x":"",q={},ee={};for(const{id:pe,url:fe}of O){const _e=C.transformRequest(C.normalizeSpriteURL(fe,$,".json"),"SpriteJSON");q[pe]=a.h(_e,L);const ce=C.transformRequest(C.normalizeSpriteURL(fe,$,".png"),"SpriteImage");ee[pe]=j.getImage(ce,L)}return yield Promise.all([...Object.values(q),...Object.values(ee)]),function(pe,fe){return a._(this,void 0,void 0,function*(){const _e={};for(const ce in pe){_e[ce]={};const Ce=S.getImageCanvasContext((yield fe[ce]).data),Ze=(yield pe[ce]).data;for(const be in Ze){const{width:Re,height:We,x:He,y:Xe,sdf:rt,pixelRatio:it,stretchX:pt,stretchY:yt,content:ai}=Ze[be];_e[ce][be]={data:null,pixelRatio:it,sdf:rt,stretchX:pt,stretchY:yt,content:ai,spriteData:{width:Re,height:We,x:He,y:Xe,context:Ce}}}}return _e})}(q,ee)})}(o,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(b=>{if(this._spriteRequest=null,b)for(const C in b){this._spritesImagesIds[C]=[];const M=this._spritesImagesIds[C]?this._spritesImagesIds[C].filter(L=>!(L in b)):[];for(const L of M)this.imageManager.removeImage(L),this._changedImages[L]=!0;for(const L in b[C]){const O=C==="default"?L:`${C}:${L}`;this._spritesImagesIds[C].push(O),O in this.imageManager.images?this.imageManager.updateImage(O,b[C][L],!1):this.imageManager.addImage(O,b[C][L]),h&&(this._changedImages[O]=!0)}}}).catch(b=>{this._spriteRequest=null,m=b,this.fire(new a.j(m))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),h&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.k("data",{dataType:"style"})),p&&p(m)})}_unloadSprite(){for(const o of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(o),this._changedImages[o]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.k("data",{dataType:"style"}))}_validateLayer(o){const h=this.sourceCaches[o.source];if(!h)return;const p=o.sourceLayer;if(!p)return;const m=h.getSource();(m.type==="geojson"||m.vectorLayerIds&&m.vectorLayerIds.indexOf(p)===-1)&&this.fire(new a.j(new Error(`Source layer "${p}" does not exist on source "${m.id}" as specified by style layer "${o.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const o in this.sourceCaches)if(!this.sourceCaches[o].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(o){const h=this._serializedAllLayers();if(!o||o.length===0)return Object.values(h);const p=[];for(const m of o)h[m]&&p.push(h[m]);return p}_serializedAllLayers(){let o=this._serializedLayers;if(o)return o;o=this._serializedLayers={};const h=Object.keys(this._layers);for(const p of h){const m=this._layers[p];m.type!=="custom"&&(o[p]=m.serialize())}return o}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const o in this.sourceCaches)if(this.sourceCaches[o].hasTransition())return!0;for(const o in this._layers)if(this._layers[o].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(o){if(!this._loaded)return;const h=this._changed;if(h){const m=Object.keys(this._updatedLayers),b=Object.keys(this._removedLayers);(m.length||b.length)&&this._updateWorkerLayers(m,b);for(const C in this._updatedSources){const M=this._updatedSources[C];if(M==="reload")this._reloadSource(C);else{if(M!=="clear")throw new Error(`Invalid action ${M}`);this._clearSource(C)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const C in this._updatedPaintProps)this._layers[C].updateTransitions(o);this.light.updateTransitions(o),this._resetUpdates()}const p={};for(const m in this.sourceCaches){const b=this.sourceCaches[m];p[m]=b.used,b.used=!1}for(const m of this._order){const b=this._layers[m];b.recalculate(o,this._availableImages),!b.isHidden(o.zoom)&&b.source&&(this.sourceCaches[b.source].used=!0)}for(const m in p){const b=this.sourceCaches[m];!!p[m]!=!!b.used&&b.fire(new a.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:m}))}this.light.recalculate(o),this.z=o.zoom,h&&this.fire(new a.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const o=Object.keys(this._changedImages);if(o.length){for(const h in this.sourceCaches)this.sourceCaches[h].reloadTilesForDependencies(["icons","patterns"],o);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const o in this.sourceCaches)this.sourceCaches[o].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(o,h){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(o),removedIds:h})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(o,h={}){var p;this._checkLoaded();const m=this.serialize();if(o=h.transformStyle?h.transformStyle(m,o):o,((p=h.validate)===null||p===void 0||p)&&dn(this,a.x(o)))return!1;(o=a.aA(o)).layers=a.ay(o.layers);const b=a.aB(m,o),C=this._getOperationsToPerform(b);if(C.unimplemented.length>0)throw new Error(`Unimplemented: ${C.unimplemented.join(", ")}.`);if(C.operations.length===0)return!1;for(const M of C.operations)M();return this.stylesheet=o,this._serializedLayers=null,!0}_getOperationsToPerform(o){const h=[],p=[];for(const m of o)switch(m.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":h.push(()=>this.addLayer.apply(this,m.args));break;case"removeLayer":h.push(()=>this.removeLayer.apply(this,m.args));break;case"setPaintProperty":h.push(()=>this.setPaintProperty.apply(this,m.args));break;case"setLayoutProperty":h.push(()=>this.setLayoutProperty.apply(this,m.args));break;case"setFilter":h.push(()=>this.setFilter.apply(this,m.args));break;case"addSource":h.push(()=>this.addSource.apply(this,m.args));break;case"removeSource":h.push(()=>this.removeSource.apply(this,m.args));break;case"setLayerZoomRange":h.push(()=>this.setLayerZoomRange.apply(this,m.args));break;case"setLight":h.push(()=>this.setLight.apply(this,m.args));break;case"setGeoJSONSourceData":h.push(()=>this.setGeoJSONSourceData.apply(this,m.args));break;case"setGlyphs":h.push(()=>this.setGlyphs.apply(this,m.args));break;case"setSprite":h.push(()=>this.setSprite.apply(this,m.args));break;case"setTerrain":h.push(()=>this.map.setTerrain.apply(this,m.args));break;case"setTransition":h.push(()=>{});break;default:p.push(m.command)}return{operations:h,unimplemented:p}}addImage(o,h){if(this.getImage(o))return this.fire(new a.j(new Error(`An image named "${o}" already exists.`)));this.imageManager.addImage(o,h),this._afterImageUpdated(o)}updateImage(o,h){this.imageManager.updateImage(o,h)}getImage(o){return this.imageManager.getImage(o)}removeImage(o){if(!this.getImage(o))return this.fire(new a.j(new Error(`An image named "${o}" does not exist.`)));this.imageManager.removeImage(o),this._afterImageUpdated(o)}_afterImageUpdated(o){this._availableImages=this.imageManager.listImages(),this._changedImages[o]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(o,h,p={}){if(this._checkLoaded(),this.sourceCaches[o]!==void 0)throw new Error(`Source "${o}" already exists.`);if(!h.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(h).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(h.type)>=0&&this._validate(a.x.source,`sources.${o}`,h,null,p))return;this.map&&this.map._collectResourceTiming&&(h.collectResourceTiming=!0);const m=this.sourceCaches[o]=new Xi(o,h,this.dispatcher);m.style=this,m.setEventedParent(this,()=>({isSourceLoaded:m.loaded(),source:m.serialize(),sourceId:o})),m.onAdd(this.map),this._changed=!0}removeSource(o){if(this._checkLoaded(),this.sourceCaches[o]===void 0)throw new Error("There is no source with this ID");for(const p in this._layers)if(this._layers[p].source===o)return this.fire(new a.j(new Error(`Source "${o}" cannot be removed while layer "${p}" is using it.`)));const h=this.sourceCaches[o];delete this.sourceCaches[o],delete this._updatedSources[o],h.fire(new a.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:o})),h.setEventedParent(null),h.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(o,h){if(this._checkLoaded(),this.sourceCaches[o]===void 0)throw new Error(`There is no source with this ID=${o}`);const p=this.sourceCaches[o].getSource();if(p.type!=="geojson")throw new Error(`geojsonSource.type is ${p.type}, which is !== 'geojson`);p.setData(h),this._changed=!0}getSource(o){return this.sourceCaches[o]&&this.sourceCaches[o].getSource()}addLayer(o,h,p={}){this._checkLoaded();const m=o.id;if(this.getLayer(m))return void this.fire(new a.j(new Error(`Layer "${m}" already exists on this map.`)));let b;if(o.type==="custom"){if(dn(this,a.aC(o)))return;b=a.az(o)}else{if("source"in o&&typeof o.source=="object"&&(this.addSource(m,o.source),o=a.aA(o),o=a.e(o,{source:m})),this._validate(a.x.layer,`layers.${m}`,o,{arrayIndex:-1},p))return;b=a.az(o),this._validateLayer(b),b.setEventedParent(this,{layer:{id:m}})}const C=h?this._order.indexOf(h):this._order.length;if(h&&C===-1)this.fire(new a.j(new Error(`Cannot add layer "${m}" before non-existing layer "${h}".`)));else{if(this._order.splice(C,0,m),this._layerOrderChanged=!0,this._layers[m]=b,this._removedLayers[m]&&b.source&&b.type!=="custom"){const M=this._removedLayers[m];delete this._removedLayers[m],M.type!==b.type?this._updatedSources[b.source]="clear":(this._updatedSources[b.source]="reload",this.sourceCaches[b.source].pause())}this._updateLayer(b),b.onAdd&&b.onAdd(this.map)}}moveLayer(o,h){if(this._checkLoaded(),this._changed=!0,!this._layers[o])return void this.fire(new a.j(new Error(`The layer '${o}' does not exist in the map's style and cannot be moved.`)));if(o===h)return;const p=this._order.indexOf(o);this._order.splice(p,1);const m=h?this._order.indexOf(h):this._order.length;h&&m===-1?this.fire(new a.j(new Error(`Cannot move layer "${o}" before non-existing layer "${h}".`))):(this._order.splice(m,0,o),this._layerOrderChanged=!0)}removeLayer(o){this._checkLoaded();const h=this._layers[o];if(!h)return void this.fire(new a.j(new Error(`Cannot remove non-existing layer "${o}".`)));h.setEventedParent(null);const p=this._order.indexOf(o);this._order.splice(p,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[o]=h,delete this._layers[o],this._serializedLayers&&delete this._serializedLayers[o],delete this._updatedLayers[o],delete this._updatedPaintProps[o],h.onRemove&&h.onRemove(this.map)}getLayer(o){return this._layers[o]}getLayersOrder(){return[...this._order]}hasLayer(o){return o in this._layers}setLayerZoomRange(o,h,p){this._checkLoaded();const m=this.getLayer(o);m?m.minzoom===h&&m.maxzoom===p||(h!=null&&(m.minzoom=h),p!=null&&(m.maxzoom=p),this._updateLayer(m)):this.fire(new a.j(new Error(`Cannot set the zoom range of non-existing layer "${o}".`)))}setFilter(o,h,p={}){this._checkLoaded();const m=this.getLayer(o);if(m){if(!a.aD(m.filter,h))return h==null?(m.filter=void 0,void this._updateLayer(m)):void(this._validate(a.x.filter,`layers.${m.id}.filter`,h,null,p)||(m.filter=a.aA(h),this._updateLayer(m)))}else this.fire(new a.j(new Error(`Cannot filter non-existing layer "${o}".`)))}getFilter(o){return a.aA(this.getLayer(o).filter)}setLayoutProperty(o,h,p,m={}){this._checkLoaded();const b=this.getLayer(o);b?a.aD(b.getLayoutProperty(h),p)||(b.setLayoutProperty(h,p,m),this._updateLayer(b)):this.fire(new a.j(new Error(`Cannot style non-existing layer "${o}".`)))}getLayoutProperty(o,h){const p=this.getLayer(o);if(p)return p.getLayoutProperty(h);this.fire(new a.j(new Error(`Cannot get style of non-existing layer "${o}".`)))}setPaintProperty(o,h,p,m={}){this._checkLoaded();const b=this.getLayer(o);b?a.aD(b.getPaintProperty(h),p)||(b.setPaintProperty(h,p,m)&&this._updateLayer(b),this._changed=!0,this._updatedPaintProps[o]=!0,this._serializedLayers=null):this.fire(new a.j(new Error(`Cannot style non-existing layer "${o}".`)))}getPaintProperty(o,h){return this.getLayer(o).getPaintProperty(h)}setFeatureState(o,h){this._checkLoaded();const p=o.source,m=o.sourceLayer,b=this.sourceCaches[p];if(b===void 0)return void this.fire(new a.j(new Error(`The source '${p}' does not exist in the map's style.`)));const C=b.getSource().type;C==="geojson"&&m?this.fire(new a.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):C!=="vector"||m?(o.id===void 0&&this.fire(new a.j(new Error("The feature id parameter must be provided."))),b.setFeatureState(m,o.id,h)):this.fire(new a.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(o,h){this._checkLoaded();const p=o.source,m=this.sourceCaches[p];if(m===void 0)return void this.fire(new a.j(new Error(`The source '${p}' does not exist in the map's style.`)));const b=m.getSource().type,C=b==="vector"?o.sourceLayer:void 0;b!=="vector"||C?h&&typeof o.id!="string"&&typeof o.id!="number"?this.fire(new a.j(new Error("A feature id is required to remove its specific state property."))):m.removeFeatureState(C,o.id,h):this.fire(new a.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(o){this._checkLoaded();const h=o.source,p=o.sourceLayer,m=this.sourceCaches[h];if(m!==void 0)return m.getSource().type!=="vector"||p?(o.id===void 0&&this.fire(new a.j(new Error("The feature id parameter must be provided."))),m.getFeatureState(p,o.id)):void this.fire(new a.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new a.j(new Error(`The source '${h}' does not exist in the map's style.`)))}getTransition(){return a.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const o=a.aE(this.sourceCaches,b=>b.serialize()),h=this._serializeByIds(this._order),p=this.map.getTerrain()||void 0,m=this.stylesheet;return a.aF({version:m.version,name:m.name,metadata:m.metadata,light:m.light,center:m.center,zoom:m.zoom,bearing:m.bearing,pitch:m.pitch,sprite:m.sprite,glyphs:m.glyphs,transition:m.transition,sources:o,layers:h,terrain:p},b=>b!==void 0)}_updateLayer(o){this._updatedLayers[o.id]=!0,o.source&&!this._updatedSources[o.source]&&this.sourceCaches[o.source].getSource().type!=="raster"&&(this._updatedSources[o.source]="reload",this.sourceCaches[o.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(o){const h=C=>this._layers[C].type==="fill-extrusion",p={},m=[];for(let C=this._order.length-1;C>=0;C--){const M=this._order[C];if(h(M)){p[M]=C;for(const L of o){const O=L[M];if(O)for(const $ of O)m.push($)}}}m.sort((C,M)=>M.intersectionZ-C.intersectionZ);const b=[];for(let C=this._order.length-1;C>=0;C--){const M=this._order[C];if(h(M))for(let L=m.length-1;L>=0;L--){const O=m[L].feature;if(p[O.layer.id]<C)break;b.push(O),m.pop()}else for(const L of o){const O=L[M];if(O)for(const $ of O)b.push($.feature)}}return b}queryRenderedFeatures(o,h,p){h&&h.filter&&this._validate(a.x.filter,"queryRenderedFeatures.filter",h.filter,null,h);const m={};if(h&&h.layers){if(!Array.isArray(h.layers))return this.fire(new a.j(new Error("parameters.layers must be an Array."))),[];for(const M of h.layers){const L=this._layers[M];if(!L)return this.fire(new a.j(new Error(`The layer '${M}' does not exist in the map's style and cannot be queried for features.`))),[];m[L.source]=!0}}const b=[];h.availableImages=this._availableImages;const C=this._serializedAllLayers();for(const M in this.sourceCaches)h.layers&&!m[M]||b.push(ut(this.sourceCaches[M],this._layers,C,o,h,p));return this.placement&&b.push(function(M,L,O,$,q,ee,pe){const fe={},_e=ee.queryRenderedSymbols($),ce=[];for(const Ce of Object.keys(_e).map(Number))ce.push(pe[Ce]);ce.sort(Dt);for(const Ce of ce){const Ze=Ce.featureIndex.lookupSymbolFeatures(_e[Ce.bucketInstanceId],L,Ce.bucketIndex,Ce.sourceLayerIndex,q.filter,q.layers,q.availableImages,M);for(const be in Ze){const Re=fe[be]=fe[be]||[],We=Ze[be];We.sort((He,Xe)=>{const rt=Ce.featureSortOrder;if(rt){const it=rt.indexOf(He.featureIndex);return rt.indexOf(Xe.featureIndex)-it}return Xe.featureIndex-He.featureIndex});for(const He of We)Re.push(He)}}for(const Ce in fe)fe[Ce].forEach(Ze=>{const be=Ze.feature,Re=O[M[Ce].source].getFeatureState(be.layer["source-layer"],be.id);be.source=be.layer.source,be.layer["source-layer"]&&(be.sourceLayer=be.layer["source-layer"]),be.state=Re});return fe}(this._layers,C,this.sourceCaches,o,h,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(b)}querySourceFeatures(o,h){h&&h.filter&&this._validate(a.x.filter,"querySourceFeatures.filter",h.filter,null,h);const p=this.sourceCaches[o];return p?function(m,b){const C=m.getRenderableIds().map(O=>m.getTileByID(O)),M=[],L={};for(let O=0;O<C.length;O++){const $=C[O],q=$.tileID.canonical.key;L[q]||(L[q]=!0,$.querySourceFeatures(M,b))}return M}(p,h):[]}getLight(){return this.light.getLight()}setLight(o,h={}){this._checkLoaded();const p=this.light.getLight();let m=!1;for(const C in o)if(!a.aD(o[C],p[C])){m=!0;break}if(!m)return;const b={now:S.now(),transition:a.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(o,h),this.light.updateTransitions(b)}_validate(o,h,p,m,b={}){return(!b||b.validate!==!1)&&dn(this,o.call(a.x,a.e({key:h,style:this.serialize(),value:p,styleSpec:a.v},m)))}_remove(o=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),nt().off(Qi,this._rtlPluginLoaded);for(const h in this._layers)this._layers[h].setEventedParent(null);for(const h in this.sourceCaches){const p=this.sourceCaches[h];p.setEventedParent(null),p.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),o&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(o)}_clearSource(o){this.sourceCaches[o].clearTiles()}_reloadSource(o){this.sourceCaches[o].resume(),this.sourceCaches[o].reload()}_updateSources(o){for(const h in this.sourceCaches)this.sourceCaches[h].update(o,this.map.terrain)}_generateCollisionBoxes(){for(const o in this.sourceCaches)this._reloadSource(o)}_updatePlacement(o,h,p,m,b=!1){let C=!1,M=!1;const L={};for(const O of this._order){const $=this._layers[O];if($.type!=="symbol")continue;if(!L[$.source]){const ee=this.sourceCaches[$.source];L[$.source]=ee.getRenderableIds(!0).map(pe=>ee.getTileByID(pe)).sort((pe,fe)=>fe.tileID.overscaledZ-pe.tileID.overscaledZ||(pe.tileID.isLessThan(fe.tileID)?-1:1))}const q=this.crossTileSymbolIndex.addLayer($,L[$.source],o.center.lng);C=C||q}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((b=b||this._layerOrderChanged||p===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(S.now(),o.zoom))&&(this.pauseablePlacement=new Kr(o,this.map.terrain,this._order,b,h,p,m,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,L),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(S.now()),M=!0),C&&this.pauseablePlacement.placement.setStale()),M||C)for(const O of this._order){const $=this._layers[O];$.type==="symbol"&&this.placement.updateLayerOpacities($,L[$.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(S.now())}_releaseSymbolFadeTiles(){for(const o in this.sourceCaches)this.sourceCaches[o].releaseSymbolFadeTiles()}getImages(o,h){return a._(this,void 0,void 0,function*(){const p=yield this.imageManager.getImages(h.icons);this._updateTilesForChangedImages();const m=this.sourceCaches[h.source];return m&&m.setDependencies(h.tileID.key,h.type,h.icons),p})}getGlyphs(o,h){return a._(this,void 0,void 0,function*(){const p=yield this.glyphManager.getGlyphs(h.stacks),m=this.sourceCaches[h.source];return m&&m.setDependencies(h.tileID.key,h.type,[""]),p})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(o,h={}){this._checkLoaded(),o&&this._validate(a.x.glyphs,"glyphs",o,null,h)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=o,this.glyphManager.entries={},this.glyphManager.setURL(o))}addSprite(o,h,p={},m){this._checkLoaded();const b=[{id:o,url:h}],C=[...Ne(this.stylesheet.sprite),...b];this._validate(a.x.sprite,"sprite",C,null,p)||(this.stylesheet.sprite=C,this._loadSprite(b,!0,m))}removeSprite(o){this._checkLoaded();const h=Ne(this.stylesheet.sprite);if(h.find(p=>p.id===o)){if(this._spritesImagesIds[o])for(const p of this._spritesImagesIds[o])this.imageManager.removeImage(p),this._changedImages[p]=!0;h.splice(h.findIndex(p=>p.id===o),1),this.stylesheet.sprite=h.length>0?h:void 0,delete this._spritesImagesIds[o],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.k("data",{dataType:"style"}))}else this.fire(new a.j(new Error(`Sprite "${o}" doesn't exists on this map.`)))}getSprite(){return Ne(this.stylesheet.sprite)}setSprite(o,h={},p){this._checkLoaded(),o&&this._validate(a.x.sprite,"sprite",o,null,h)||(this.stylesheet.sprite=o,o?this._loadSprite(o,!0,p):(this._unloadSprite(),p&&p(null)))}}var Za=a.X([{name:"a_pos",type:"Int16",components:2}]),_o="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const ha={prelude:Ui(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:Ui(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Ui(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Ui(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Ui("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Ui(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:Ui(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Ui("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Ui("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Ui("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:Ui(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:Ui(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:Ui(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:Ui(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Ui(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Ui(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Ui(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Ui(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Ui(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Ui(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Ui(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Ui(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Ui(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Ui(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Ui(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Ui(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Ui("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",_o),terrainDepth:Ui("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",_o),terrainCoords:Ui("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",_o)};function Ui(y,o){const h=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,p=o.match(/attribute ([\w]+) ([\w]+)/g),m=y.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),b=o.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),C=b?b.concat(m):m,M={};return{fragmentSource:y=y.replace(h,(L,O,$,q,ee)=>(M[ee]=!0,O==="define"?`
#ifndef HAS_UNIFORM_u_${ee}
varying ${$} ${q} ${ee};
#else
uniform ${$} ${q} u_${ee};
#endif
`:`
#ifdef HAS_UNIFORM_u_${ee}
    ${$} ${q} ${ee} = u_${ee};
#endif
`)),vertexSource:o=o.replace(h,(L,O,$,q,ee)=>{const pe=q==="float"?"vec2":"vec4",fe=ee.match(/color/)?"color":pe;return M[ee]?O==="define"?`
#ifndef HAS_UNIFORM_u_${ee}
uniform lowp float u_${ee}_t;
attribute ${$} ${pe} a_${ee};
varying ${$} ${q} ${ee};
#else
uniform ${$} ${q} u_${ee};
#endif
`:fe==="vec4"?`
#ifndef HAS_UNIFORM_u_${ee}
    ${ee} = a_${ee};
#else
    ${$} ${q} ${ee} = u_${ee};
#endif
`:`
#ifndef HAS_UNIFORM_u_${ee}
    ${ee} = unpack_mix_${fe}(a_${ee}, u_${ee}_t);
#else
    ${$} ${q} ${ee} = u_${ee};
#endif
`:O==="define"?`
#ifndef HAS_UNIFORM_u_${ee}
uniform lowp float u_${ee}_t;
attribute ${$} ${pe} a_${ee};
#else
uniform ${$} ${q} u_${ee};
#endif
`:fe==="vec4"?`
#ifndef HAS_UNIFORM_u_${ee}
    ${$} ${q} ${ee} = a_${ee};
#else
    ${$} ${q} ${ee} = u_${ee};
#endif
`:`
#ifndef HAS_UNIFORM_u_${ee}
    ${$} ${q} ${ee} = unpack_mix_${fe}(a_${ee}, u_${ee}_t);
#else
    ${$} ${q} ${ee} = u_${ee};
#endif
`}),staticAttributes:p,staticUniforms:C}}class Ga{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(o,h,p,m,b,C,M,L,O){this.context=o;let $=this.boundPaintVertexBuffers.length!==m.length;for(let q=0;!$&&q<m.length;q++)this.boundPaintVertexBuffers[q]!==m[q]&&($=!0);!this.vao||this.boundProgram!==h||this.boundLayoutVertexBuffer!==p||$||this.boundIndexBuffer!==b||this.boundVertexOffset!==C||this.boundDynamicVertexBuffer!==M||this.boundDynamicVertexBuffer2!==L||this.boundDynamicVertexBuffer3!==O?this.freshBind(h,p,m,b,C,M,L,O):(o.bindVertexArray.set(this.vao),M&&M.bind(),b&&b.dynamicDraw&&b.bind(),L&&L.bind(),O&&O.bind())}freshBind(o,h,p,m,b,C,M,L){const O=o.numAttributes,$=this.context,q=$.gl;this.vao&&this.destroy(),this.vao=$.createVertexArray(),$.bindVertexArray.set(this.vao),this.boundProgram=o,this.boundLayoutVertexBuffer=h,this.boundPaintVertexBuffers=p,this.boundIndexBuffer=m,this.boundVertexOffset=b,this.boundDynamicVertexBuffer=C,this.boundDynamicVertexBuffer2=M,this.boundDynamicVertexBuffer3=L,h.enableAttributes(q,o);for(const ee of p)ee.enableAttributes(q,o);C&&C.enableAttributes(q,o),M&&M.enableAttributes(q,o),L&&L.enableAttributes(q,o),h.bind(),h.setVertexAttribPointers(q,o,b);for(const ee of p)ee.bind(),ee.setVertexAttribPointers(q,o,b);C&&(C.bind(),C.setVertexAttribPointers(q,o,b)),m&&m.bind(),M&&(M.bind(),M.setVertexAttribPointers(q,o,b)),L&&(L.bind(),L.setVertexAttribPointers(q,o,b)),$.currentNumAttributes=O}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function Ps(y){const o=[];for(let h=0;h<y.length;h++){if(y[h]===null)continue;const p=y[h].split(" ");o.push(p.pop())}return o}class Wo{constructor(o,h,p,m,b,C){const M=o.gl;this.program=M.createProgram();const L=Ps(h.staticAttributes),O=p?p.getBinderAttributes():[],$=L.concat(O),q=ha.prelude.staticUniforms?Ps(ha.prelude.staticUniforms):[],ee=h.staticUniforms?Ps(h.staticUniforms):[],pe=p?p.getBinderUniforms():[],fe=q.concat(ee).concat(pe),_e=[];for(const He of fe)_e.indexOf(He)<0&&_e.push(He);const ce=p?p.defines():[];b&&ce.push("#define OVERDRAW_INSPECTOR;"),C&&ce.push("#define TERRAIN3D;");const Ce=ce.concat(ha.prelude.fragmentSource,h.fragmentSource).join(`
`),Ze=ce.concat(ha.prelude.vertexSource,h.vertexSource).join(`
`),be=M.createShader(M.FRAGMENT_SHADER);if(M.isContextLost())return void(this.failedToCreate=!0);if(M.shaderSource(be,Ce),M.compileShader(be),!M.getShaderParameter(be,M.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${M.getShaderInfoLog(be)}`);M.attachShader(this.program,be);const Re=M.createShader(M.VERTEX_SHADER);if(M.isContextLost())return void(this.failedToCreate=!0);if(M.shaderSource(Re,Ze),M.compileShader(Re),!M.getShaderParameter(Re,M.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${M.getShaderInfoLog(Re)}`);M.attachShader(this.program,Re),this.attributes={};const We={};this.numAttributes=$.length;for(let He=0;He<this.numAttributes;He++)$[He]&&(M.bindAttribLocation(this.program,He,$[He]),this.attributes[$[He]]=He);if(M.linkProgram(this.program),!M.getProgramParameter(this.program,M.LINK_STATUS))throw new Error(`Program failed to link: ${M.getProgramInfoLog(this.program)}`);M.deleteShader(Re),M.deleteShader(be);for(let He=0;He<_e.length;He++){const Xe=_e[He];if(Xe&&!We[Xe]){const rt=M.getUniformLocation(this.program,Xe);rt&&(We[Xe]=rt)}}this.fixedUniforms=m(o,We),this.terrainUniforms=((He,Xe)=>({u_depth:new a.aG(He,Xe.u_depth),u_terrain:new a.aG(He,Xe.u_terrain),u_terrain_dim:new a.aH(He,Xe.u_terrain_dim),u_terrain_matrix:new a.aI(He,Xe.u_terrain_matrix),u_terrain_unpack:new a.aJ(He,Xe.u_terrain_unpack),u_terrain_exaggeration:new a.aH(He,Xe.u_terrain_exaggeration)}))(o,We),this.binderUniforms=p?p.getUniforms(o,We):[]}draw(o,h,p,m,b,C,M,L,O,$,q,ee,pe,fe,_e,ce,Ce,Ze){const be=o.gl;if(this.failedToCreate)return;if(o.program.set(this.program),o.setDepthMode(p),o.setStencilMode(m),o.setColorMode(b),o.setCullFace(C),L){o.activeTexture.set(be.TEXTURE2),be.bindTexture(be.TEXTURE_2D,L.depthTexture),o.activeTexture.set(be.TEXTURE3),be.bindTexture(be.TEXTURE_2D,L.texture);for(const We in this.terrainUniforms)this.terrainUniforms[We].set(L[We])}for(const We in this.fixedUniforms)this.fixedUniforms[We].set(M[We]);_e&&_e.setUniforms(o,this.binderUniforms,pe,{zoom:fe});let Re=0;switch(h){case be.LINES:Re=2;break;case be.TRIANGLES:Re=3;break;case be.LINE_STRIP:Re=1}for(const We of ee.get()){const He=We.vaos||(We.vaos={});(He[O]||(He[O]=new Ga)).bind(o,this,$,_e?_e.getPaintVertexBuffers():[],q,We.vertexOffset,ce,Ce,Ze),be.drawElements(h,We.primitiveLength*Re,be.UNSIGNED_SHORT,We.primitiveOffset*Re*2)}}}function Wa(y,o,h){const p=1/Xt(h,1,o.transform.tileZoom),m=Math.pow(2,h.tileID.overscaledZ),b=h.tileSize*Math.pow(2,o.transform.tileZoom)/m,C=b*(h.tileID.canonical.x+h.tileID.wrap*m),M=b*h.tileID.canonical.y;return{u_image:0,u_texsize:h.imageAtlasTexture.size,u_scale:[p,y.fromScale,y.toScale],u_fade:y.t,u_pixel_coord_upper:[C>>16,M>>16],u_pixel_coord_lower:[65535&C,65535&M]}}const da=(y,o,h,p)=>{const m=o.style.light,b=m.properties.get("position"),C=[b.x,b.y,b.z],M=function(){var O=new a.A(9);return a.A!=Float32Array&&(O[1]=0,O[2]=0,O[3]=0,O[5]=0,O[6]=0,O[7]=0),O[0]=1,O[4]=1,O[8]=1,O}();m.properties.get("anchor")==="viewport"&&function(O,$){var q=Math.sin($),ee=Math.cos($);O[0]=ee,O[1]=q,O[2]=0,O[3]=-q,O[4]=ee,O[5]=0,O[6]=0,O[7]=0,O[8]=1}(M,-o.transform.angle),function(O,$,q){var ee=$[0],pe=$[1],fe=$[2];O[0]=ee*q[0]+pe*q[3]+fe*q[6],O[1]=ee*q[1]+pe*q[4]+fe*q[7],O[2]=ee*q[2]+pe*q[5]+fe*q[8]}(C,C,M);const L=m.properties.get("color");return{u_matrix:y,u_lightpos:C,u_lightintensity:m.properties.get("intensity"),u_lightcolor:[L.r,L.g,L.b],u_vertical_gradient:+h,u_opacity:p}},Ud=(y,o,h,p,m,b,C)=>a.e(da(y,o,h,p),Wa(b,o,C),{u_height_factor:-Math.pow(2,m.overscaledZ)/C.tileSize/8}),Qu=y=>({u_matrix:y}),Ha=(y,o,h,p)=>a.e(Qu(y),Wa(h,o,p)),Vd=(y,o)=>({u_matrix:y,u_world:o}),eh=(y,o,h,p,m)=>a.e(Ha(y,o,h,p),{u_world:m}),$d=(y,o,h,p)=>{const m=y.transform;let b,C;if(p.paint.get("circle-pitch-alignment")==="map"){const M=Xt(h,1,m.zoom);b=!0,C=[M,M]}else b=!1,C=m.pixelsToGLUnits;return{u_camera_to_center_distance:m.cameraToCenterDistance,u_scale_with_map:+(p.paint.get("circle-pitch-scale")==="map"),u_matrix:y.translatePosMatrix(o.posMatrix,h,p.paint.get("circle-translate"),p.paint.get("circle-translate-anchor")),u_pitch_with_map:+b,u_device_pixel_ratio:y.pixelRatio,u_extrude_scale:C}},th=(y,o,h)=>{const p=Xt(h,1,o.zoom),m=Math.pow(2,o.zoom-h.tileID.overscaledZ),b=h.tileID.overscaleFactor();return{u_matrix:y,u_camera_to_center_distance:o.cameraToCenterDistance,u_pixels_to_tile_units:p,u_extrude_scale:[o.pixelsToGLUnits[0]/(p*m),o.pixelsToGLUnits[1]/(p*m)],u_overscale_factor:b}},ih=(y,o,h=1)=>({u_matrix:y,u_color:o,u_overlay:0,u_overlay_scale:h}),Xa=y=>({u_matrix:y}),nh=(y,o,h,p)=>({u_matrix:y,u_extrude_scale:Xt(o,1,h),u_intensity:p});function rh(y,o){const h=Math.pow(2,o.canonical.z),p=o.canonical.y;return[new a.Y(0,p/h).toLngLat().lat,new a.Y(0,(p+1)/h).toLngLat().lat]}const Ka=(y,o,h,p)=>{const m=y.transform;return{u_matrix:fa(y,o,h,p),u_ratio:1/Xt(o,1,m.zoom),u_device_pixel_ratio:y.pixelRatio,u_units_to_pixels:[1/m.pixelsToGLUnits[0],1/m.pixelsToGLUnits[1]]}},oh=(y,o,h,p,m)=>a.e(Ka(y,o,h,m),{u_image:0,u_image_height:p}),os=(y,o,h,p,m)=>{const b=y.transform,C=Br(o,b);return{u_matrix:fa(y,o,h,m),u_texsize:o.imageAtlasTexture.size,u_ratio:1/Xt(o,1,b.zoom),u_device_pixel_ratio:y.pixelRatio,u_image:0,u_scale:[C,p.fromScale,p.toScale],u_fade:p.t,u_units_to_pixels:[1/b.pixelsToGLUnits[0],1/b.pixelsToGLUnits[1]]}},Ja=(y,o,h,p,m,b)=>{const C=y.lineAtlas,M=Br(o,y.transform),L=h.layout.get("line-cap")==="round",O=C.getDash(p.from,L),$=C.getDash(p.to,L),q=O.width*m.fromScale,ee=$.width*m.toScale;return a.e(Ka(y,o,h,b),{u_patternscale_a:[M/q,-O.height/2],u_patternscale_b:[M/ee,-$.height/2],u_sdfgamma:C.width/(256*Math.min(q,ee)*y.pixelRatio)/2,u_image:0,u_tex_y_a:O.y,u_tex_y_b:$.y,u_mix:m.t})};function Br(y,o){return 1/Xt(y,1,o.tileZoom)}function fa(y,o,h,p){return y.translatePosMatrix(p?p.posMatrix:o.tileID.posMatrix,o,h.paint.get("line-translate"),h.paint.get("line-translate-anchor"))}const Ya=(y,o,h,p,m)=>{return{u_matrix:y,u_tl_parent:o,u_scale_parent:h,u_buffer_scale:1,u_fade_t:p.mix,u_opacity:p.opacity*m.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:m.paint.get("raster-brightness-min"),u_brightness_high:m.paint.get("raster-brightness-max"),u_saturation_factor:(C=m.paint.get("raster-saturation"),C>0?1-1/(1.001-C):-C),u_contrast_factor:(b=m.paint.get("raster-contrast"),b>0?1/(1-b):1+b),u_spin_weights:pa(m.paint.get("raster-hue-rotate"))};var b,C};function pa(y){y*=Math.PI/180;const o=Math.sin(y),h=Math.cos(y);return[(2*h+1)/3,(-Math.sqrt(3)*o-h+1)/3,(Math.sqrt(3)*o-h+1)/3]}const ma=(y,o,h,p,m,b,C,M,L,O)=>{const $=m.transform;return{u_is_size_zoom_constant:+(y==="constant"||y==="source"),u_is_size_feature_constant:+(y==="constant"||y==="camera"),u_size_t:o?o.uSizeT:0,u_size:o?o.uSize:0,u_camera_to_center_distance:$.cameraToCenterDistance,u_pitch:$.pitch/360*2*Math.PI,u_rotate_symbol:+h,u_aspect_ratio:$.width/$.height,u_fade_change:m.options.fadeDuration?m.symbolFadeChange:1,u_matrix:b,u_label_plane_matrix:C,u_coord_matrix:M,u_is_text:+L,u_pitch_with_map:+p,u_texsize:O,u_texture:0}},ga=(y,o,h,p,m,b,C,M,L,O,$)=>{const q=m.transform;return a.e(ma(y,o,h,p,m,b,C,M,L,O),{u_gamma_scale:p?Math.cos(q._pitch)*q.cameraToCenterDistance:1,u_device_pixel_ratio:m.pixelRatio,u_is_halo:+$})},_a=(y,o,h,p,m,b,C,M,L,O)=>a.e(ga(y,o,h,p,m,b,C,M,!0,L,!0),{u_texsize_icon:O,u_texture_icon:1}),qd=(y,o,h)=>({u_matrix:y,u_opacity:o,u_color:h}),Zd=(y,o,h,p,m,b)=>a.e(function(C,M,L,O){const $=L.imageManager.getPattern(C.from.toString()),q=L.imageManager.getPattern(C.to.toString()),{width:ee,height:pe}=L.imageManager.getPixelSize(),fe=Math.pow(2,O.tileID.overscaledZ),_e=O.tileSize*Math.pow(2,L.transform.tileZoom)/fe,ce=_e*(O.tileID.canonical.x+O.tileID.wrap*fe),Ce=_e*O.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:$.tl,u_pattern_br_a:$.br,u_pattern_tl_b:q.tl,u_pattern_br_b:q.br,u_texsize:[ee,pe],u_mix:M.t,u_pattern_size_a:$.displaySize,u_pattern_size_b:q.displaySize,u_scale_a:M.fromScale,u_scale_b:M.toScale,u_tile_units_to_pixels:1/Xt(O,1,L.transform.tileZoom),u_pixel_coord_upper:[ce>>16,Ce>>16],u_pixel_coord_lower:[65535&ce,65535&Ce]}}(p,b,h,m),{u_matrix:y,u_opacity:o}),sh={fillExtrusion:(y,o)=>({u_matrix:new a.aI(y,o.u_matrix),u_lightpos:new a.aK(y,o.u_lightpos),u_lightintensity:new a.aH(y,o.u_lightintensity),u_lightcolor:new a.aK(y,o.u_lightcolor),u_vertical_gradient:new a.aH(y,o.u_vertical_gradient),u_opacity:new a.aH(y,o.u_opacity)}),fillExtrusionPattern:(y,o)=>({u_matrix:new a.aI(y,o.u_matrix),u_lightpos:new a.aK(y,o.u_lightpos),u_lightintensity:new a.aH(y,o.u_lightintensity),u_lightcolor:new a.aK(y,o.u_lightcolor),u_vertical_gradient:new a.aH(y,o.u_vertical_gradient),u_height_factor:new a.aH(y,o.u_height_factor),u_image:new a.aG(y,o.u_image),u_texsize:new a.aL(y,o.u_texsize),u_pixel_coord_upper:new a.aL(y,o.u_pixel_coord_upper),u_pixel_coord_lower:new a.aL(y,o.u_pixel_coord_lower),u_scale:new a.aK(y,o.u_scale),u_fade:new a.aH(y,o.u_fade),u_opacity:new a.aH(y,o.u_opacity)}),fill:(y,o)=>({u_matrix:new a.aI(y,o.u_matrix)}),fillPattern:(y,o)=>({u_matrix:new a.aI(y,o.u_matrix),u_image:new a.aG(y,o.u_image),u_texsize:new a.aL(y,o.u_texsize),u_pixel_coord_upper:new a.aL(y,o.u_pixel_coord_upper),u_pixel_coord_lower:new a.aL(y,o.u_pixel_coord_lower),u_scale:new a.aK(y,o.u_scale),u_fade:new a.aH(y,o.u_fade)}),fillOutline:(y,o)=>({u_matrix:new a.aI(y,o.u_matrix),u_world:new a.aL(y,o.u_world)}),fillOutlinePattern:(y,o)=>({u_matrix:new a.aI(y,o.u_matrix),u_world:new a.aL(y,o.u_world),u_image:new a.aG(y,o.u_image),u_texsize:new a.aL(y,o.u_texsize),u_pixel_coord_upper:new a.aL(y,o.u_pixel_coord_upper),u_pixel_coord_lower:new a.aL(y,o.u_pixel_coord_lower),u_scale:new a.aK(y,o.u_scale),u_fade:new a.aH(y,o.u_fade)}),circle:(y,o)=>({u_camera_to_center_distance:new a.aH(y,o.u_camera_to_center_distance),u_scale_with_map:new a.aG(y,o.u_scale_with_map),u_pitch_with_map:new a.aG(y,o.u_pitch_with_map),u_extrude_scale:new a.aL(y,o.u_extrude_scale),u_device_pixel_ratio:new a.aH(y,o.u_device_pixel_ratio),u_matrix:new a.aI(y,o.u_matrix)}),collisionBox:(y,o)=>({u_matrix:new a.aI(y,o.u_matrix),u_camera_to_center_distance:new a.aH(y,o.u_camera_to_center_distance),u_pixels_to_tile_units:new a.aH(y,o.u_pixels_to_tile_units),u_extrude_scale:new a.aL(y,o.u_extrude_scale),u_overscale_factor:new a.aH(y,o.u_overscale_factor)}),collisionCircle:(y,o)=>({u_matrix:new a.aI(y,o.u_matrix),u_inv_matrix:new a.aI(y,o.u_inv_matrix),u_camera_to_center_distance:new a.aH(y,o.u_camera_to_center_distance),u_viewport_size:new a.aL(y,o.u_viewport_size)}),debug:(y,o)=>({u_color:new a.aM(y,o.u_color),u_matrix:new a.aI(y,o.u_matrix),u_overlay:new a.aG(y,o.u_overlay),u_overlay_scale:new a.aH(y,o.u_overlay_scale)}),clippingMask:(y,o)=>({u_matrix:new a.aI(y,o.u_matrix)}),heatmap:(y,o)=>({u_extrude_scale:new a.aH(y,o.u_extrude_scale),u_intensity:new a.aH(y,o.u_intensity),u_matrix:new a.aI(y,o.u_matrix)}),heatmapTexture:(y,o)=>({u_matrix:new a.aI(y,o.u_matrix),u_world:new a.aL(y,o.u_world),u_image:new a.aG(y,o.u_image),u_color_ramp:new a.aG(y,o.u_color_ramp),u_opacity:new a.aH(y,o.u_opacity)}),hillshade:(y,o)=>({u_matrix:new a.aI(y,o.u_matrix),u_image:new a.aG(y,o.u_image),u_latrange:new a.aL(y,o.u_latrange),u_light:new a.aL(y,o.u_light),u_shadow:new a.aM(y,o.u_shadow),u_highlight:new a.aM(y,o.u_highlight),u_accent:new a.aM(y,o.u_accent)}),hillshadePrepare:(y,o)=>({u_matrix:new a.aI(y,o.u_matrix),u_image:new a.aG(y,o.u_image),u_dimension:new a.aL(y,o.u_dimension),u_zoom:new a.aH(y,o.u_zoom),u_unpack:new a.aJ(y,o.u_unpack)}),line:(y,o)=>({u_matrix:new a.aI(y,o.u_matrix),u_ratio:new a.aH(y,o.u_ratio),u_device_pixel_ratio:new a.aH(y,o.u_device_pixel_ratio),u_units_to_pixels:new a.aL(y,o.u_units_to_pixels)}),lineGradient:(y,o)=>({u_matrix:new a.aI(y,o.u_matrix),u_ratio:new a.aH(y,o.u_ratio),u_device_pixel_ratio:new a.aH(y,o.u_device_pixel_ratio),u_units_to_pixels:new a.aL(y,o.u_units_to_pixels),u_image:new a.aG(y,o.u_image),u_image_height:new a.aH(y,o.u_image_height)}),linePattern:(y,o)=>({u_matrix:new a.aI(y,o.u_matrix),u_texsize:new a.aL(y,o.u_texsize),u_ratio:new a.aH(y,o.u_ratio),u_device_pixel_ratio:new a.aH(y,o.u_device_pixel_ratio),u_image:new a.aG(y,o.u_image),u_units_to_pixels:new a.aL(y,o.u_units_to_pixels),u_scale:new a.aK(y,o.u_scale),u_fade:new a.aH(y,o.u_fade)}),lineSDF:(y,o)=>({u_matrix:new a.aI(y,o.u_matrix),u_ratio:new a.aH(y,o.u_ratio),u_device_pixel_ratio:new a.aH(y,o.u_device_pixel_ratio),u_units_to_pixels:new a.aL(y,o.u_units_to_pixels),u_patternscale_a:new a.aL(y,o.u_patternscale_a),u_patternscale_b:new a.aL(y,o.u_patternscale_b),u_sdfgamma:new a.aH(y,o.u_sdfgamma),u_image:new a.aG(y,o.u_image),u_tex_y_a:new a.aH(y,o.u_tex_y_a),u_tex_y_b:new a.aH(y,o.u_tex_y_b),u_mix:new a.aH(y,o.u_mix)}),raster:(y,o)=>({u_matrix:new a.aI(y,o.u_matrix),u_tl_parent:new a.aL(y,o.u_tl_parent),u_scale_parent:new a.aH(y,o.u_scale_parent),u_buffer_scale:new a.aH(y,o.u_buffer_scale),u_fade_t:new a.aH(y,o.u_fade_t),u_opacity:new a.aH(y,o.u_opacity),u_image0:new a.aG(y,o.u_image0),u_image1:new a.aG(y,o.u_image1),u_brightness_low:new a.aH(y,o.u_brightness_low),u_brightness_high:new a.aH(y,o.u_brightness_high),u_saturation_factor:new a.aH(y,o.u_saturation_factor),u_contrast_factor:new a.aH(y,o.u_contrast_factor),u_spin_weights:new a.aK(y,o.u_spin_weights)}),symbolIcon:(y,o)=>({u_is_size_zoom_constant:new a.aG(y,o.u_is_size_zoom_constant),u_is_size_feature_constant:new a.aG(y,o.u_is_size_feature_constant),u_size_t:new a.aH(y,o.u_size_t),u_size:new a.aH(y,o.u_size),u_camera_to_center_distance:new a.aH(y,o.u_camera_to_center_distance),u_pitch:new a.aH(y,o.u_pitch),u_rotate_symbol:new a.aG(y,o.u_rotate_symbol),u_aspect_ratio:new a.aH(y,o.u_aspect_ratio),u_fade_change:new a.aH(y,o.u_fade_change),u_matrix:new a.aI(y,o.u_matrix),u_label_plane_matrix:new a.aI(y,o.u_label_plane_matrix),u_coord_matrix:new a.aI(y,o.u_coord_matrix),u_is_text:new a.aG(y,o.u_is_text),u_pitch_with_map:new a.aG(y,o.u_pitch_with_map),u_texsize:new a.aL(y,o.u_texsize),u_texture:new a.aG(y,o.u_texture)}),symbolSDF:(y,o)=>({u_is_size_zoom_constant:new a.aG(y,o.u_is_size_zoom_constant),u_is_size_feature_constant:new a.aG(y,o.u_is_size_feature_constant),u_size_t:new a.aH(y,o.u_size_t),u_size:new a.aH(y,o.u_size),u_camera_to_center_distance:new a.aH(y,o.u_camera_to_center_distance),u_pitch:new a.aH(y,o.u_pitch),u_rotate_symbol:new a.aG(y,o.u_rotate_symbol),u_aspect_ratio:new a.aH(y,o.u_aspect_ratio),u_fade_change:new a.aH(y,o.u_fade_change),u_matrix:new a.aI(y,o.u_matrix),u_label_plane_matrix:new a.aI(y,o.u_label_plane_matrix),u_coord_matrix:new a.aI(y,o.u_coord_matrix),u_is_text:new a.aG(y,o.u_is_text),u_pitch_with_map:new a.aG(y,o.u_pitch_with_map),u_texsize:new a.aL(y,o.u_texsize),u_texture:new a.aG(y,o.u_texture),u_gamma_scale:new a.aH(y,o.u_gamma_scale),u_device_pixel_ratio:new a.aH(y,o.u_device_pixel_ratio),u_is_halo:new a.aG(y,o.u_is_halo)}),symbolTextAndIcon:(y,o)=>({u_is_size_zoom_constant:new a.aG(y,o.u_is_size_zoom_constant),u_is_size_feature_constant:new a.aG(y,o.u_is_size_feature_constant),u_size_t:new a.aH(y,o.u_size_t),u_size:new a.aH(y,o.u_size),u_camera_to_center_distance:new a.aH(y,o.u_camera_to_center_distance),u_pitch:new a.aH(y,o.u_pitch),u_rotate_symbol:new a.aG(y,o.u_rotate_symbol),u_aspect_ratio:new a.aH(y,o.u_aspect_ratio),u_fade_change:new a.aH(y,o.u_fade_change),u_matrix:new a.aI(y,o.u_matrix),u_label_plane_matrix:new a.aI(y,o.u_label_plane_matrix),u_coord_matrix:new a.aI(y,o.u_coord_matrix),u_is_text:new a.aG(y,o.u_is_text),u_pitch_with_map:new a.aG(y,o.u_pitch_with_map),u_texsize:new a.aL(y,o.u_texsize),u_texsize_icon:new a.aL(y,o.u_texsize_icon),u_texture:new a.aG(y,o.u_texture),u_texture_icon:new a.aG(y,o.u_texture_icon),u_gamma_scale:new a.aH(y,o.u_gamma_scale),u_device_pixel_ratio:new a.aH(y,o.u_device_pixel_ratio),u_is_halo:new a.aG(y,o.u_is_halo)}),background:(y,o)=>({u_matrix:new a.aI(y,o.u_matrix),u_opacity:new a.aH(y,o.u_opacity),u_color:new a.aM(y,o.u_color)}),backgroundPattern:(y,o)=>({u_matrix:new a.aI(y,o.u_matrix),u_opacity:new a.aH(y,o.u_opacity),u_image:new a.aG(y,o.u_image),u_pattern_tl_a:new a.aL(y,o.u_pattern_tl_a),u_pattern_br_a:new a.aL(y,o.u_pattern_br_a),u_pattern_tl_b:new a.aL(y,o.u_pattern_tl_b),u_pattern_br_b:new a.aL(y,o.u_pattern_br_b),u_texsize:new a.aL(y,o.u_texsize),u_mix:new a.aH(y,o.u_mix),u_pattern_size_a:new a.aL(y,o.u_pattern_size_a),u_pattern_size_b:new a.aL(y,o.u_pattern_size_b),u_scale_a:new a.aH(y,o.u_scale_a),u_scale_b:new a.aH(y,o.u_scale_b),u_pixel_coord_upper:new a.aL(y,o.u_pixel_coord_upper),u_pixel_coord_lower:new a.aL(y,o.u_pixel_coord_lower),u_tile_units_to_pixels:new a.aH(y,o.u_tile_units_to_pixels)}),terrain:(y,o)=>({u_matrix:new a.aI(y,o.u_matrix),u_texture:new a.aG(y,o.u_texture),u_ele_delta:new a.aH(y,o.u_ele_delta)}),terrainDepth:(y,o)=>({u_matrix:new a.aI(y,o.u_matrix),u_ele_delta:new a.aH(y,o.u_ele_delta)}),terrainCoords:(y,o)=>({u_matrix:new a.aI(y,o.u_matrix),u_texture:new a.aG(y,o.u_texture),u_terrain_coords_id:new a.aH(y,o.u_terrain_coords_id),u_ele_delta:new a.aH(y,o.u_ele_delta)})};class Gd{constructor(o,h,p){this.context=o;const m=o.gl;this.buffer=m.createBuffer(),this.dynamicDraw=!!p,this.context.unbindVAO(),o.bindElementBuffer.set(this.buffer),m.bufferData(m.ELEMENT_ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?m.DYNAMIC_DRAW:m.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(o){const h=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),h.bufferSubData(h.ELEMENT_ARRAY_BUFFER,0,o.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const ss={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Qa{constructor(o,h,p,m){this.length=h.length,this.attributes=p,this.itemSize=h.bytesPerElement,this.dynamicDraw=m,this.context=o;const b=o.gl;this.buffer=b.createBuffer(),o.bindVertexBuffer.set(this.buffer),b.bufferData(b.ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(o){if(o.length!==this.length)throw new Error(`Length of new data is ${o.length}, which doesn't match current length of ${this.length}`);const h=this.context.gl;this.bind(),h.bufferSubData(h.ARRAY_BUFFER,0,o.arrayBuffer)}enableAttributes(o,h){for(let p=0;p<this.attributes.length;p++){const m=h.attributes[this.attributes[p].name];m!==void 0&&o.enableVertexAttribArray(m)}}setVertexAttribPointers(o,h,p){for(let m=0;m<this.attributes.length;m++){const b=this.attributes[m],C=h.attributes[b.name];C!==void 0&&o.vertexAttribPointer(C,b.components,o[ss[b.type]],!1,this.itemSize,b.offset+this.itemSize*(p||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const dr=new WeakMap;function rr(y){var o;if(dr.has(y))return dr.get(y);{const h=(o=y.getParameter(y.VERSION))===null||o===void 0?void 0:o.startsWith("WebGL 2.0");return dr.set(y,h),h}}class Di{constructor(o){this.gl=o.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(o){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class el extends Di{getDefault(){return a.aO.transparent}set(o){const h=this.current;(o.r!==h.r||o.g!==h.g||o.b!==h.b||o.a!==h.a||this.dirty)&&(this.gl.clearColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class tl extends Di{getDefault(){return 1}set(o){(o!==this.current||this.dirty)&&(this.gl.clearDepth(o),this.current=o,this.dirty=!1)}}class fc extends Di{getDefault(){return 0}set(o){(o!==this.current||this.dirty)&&(this.gl.clearStencil(o),this.current=o,this.dirty=!1)}}class pc extends Di{getDefault(){return[!0,!0,!0,!0]}set(o){const h=this.current;(o[0]!==h[0]||o[1]!==h[1]||o[2]!==h[2]||o[3]!==h[3]||this.dirty)&&(this.gl.colorMask(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class il extends Di{getDefault(){return!0}set(o){(o!==this.current||this.dirty)&&(this.gl.depthMask(o),this.current=o,this.dirty=!1)}}class mc extends Di{getDefault(){return 255}set(o){(o!==this.current||this.dirty)&&(this.gl.stencilMask(o),this.current=o,this.dirty=!1)}}class gc extends Di{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(o){const h=this.current;(o.func!==h.func||o.ref!==h.ref||o.mask!==h.mask||this.dirty)&&(this.gl.stencilFunc(o.func,o.ref,o.mask),this.current=o,this.dirty=!1)}}class nl extends Di{getDefault(){const o=this.gl;return[o.KEEP,o.KEEP,o.KEEP]}set(o){const h=this.current;(o[0]!==h[0]||o[1]!==h[1]||o[2]!==h[2]||this.dirty)&&(this.gl.stencilOp(o[0],o[1],o[2]),this.current=o,this.dirty=!1)}}class ah extends Di{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;o?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),this.current=o,this.dirty=!1}}class lh extends Di{getDefault(){return[0,1]}set(o){const h=this.current;(o[0]!==h[0]||o[1]!==h[1]||this.dirty)&&(this.gl.depthRange(o[0],o[1]),this.current=o,this.dirty=!1)}}class zs extends Di{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;o?h.enable(h.DEPTH_TEST):h.disable(h.DEPTH_TEST),this.current=o,this.dirty=!1}}class Wd extends Di{getDefault(){return this.gl.LESS}set(o){(o!==this.current||this.dirty)&&(this.gl.depthFunc(o),this.current=o,this.dirty=!1)}}class Hd extends Di{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;o?h.enable(h.BLEND):h.disable(h.BLEND),this.current=o,this.dirty=!1}}class Xd extends Di{getDefault(){const o=this.gl;return[o.ONE,o.ZERO]}set(o){const h=this.current;(o[0]!==h[0]||o[1]!==h[1]||this.dirty)&&(this.gl.blendFunc(o[0],o[1]),this.current=o,this.dirty=!1)}}class Kd extends Di{getDefault(){return a.aO.transparent}set(o){const h=this.current;(o.r!==h.r||o.g!==h.g||o.b!==h.b||o.a!==h.a||this.dirty)&&(this.gl.blendColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class Jd extends Di{getDefault(){return this.gl.FUNC_ADD}set(o){(o!==this.current||this.dirty)&&(this.gl.blendEquation(o),this.current=o,this.dirty=!1)}}class Yd extends Di{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;o?h.enable(h.CULL_FACE):h.disable(h.CULL_FACE),this.current=o,this.dirty=!1}}class _c extends Di{getDefault(){return this.gl.BACK}set(o){(o!==this.current||this.dirty)&&(this.gl.cullFace(o),this.current=o,this.dirty=!1)}}class rl extends Di{getDefault(){return this.gl.CCW}set(o){(o!==this.current||this.dirty)&&(this.gl.frontFace(o),this.current=o,this.dirty=!1)}}class yc extends Di{getDefault(){return null}set(o){(o!==this.current||this.dirty)&&(this.gl.useProgram(o),this.current=o,this.dirty=!1)}}class vc extends Di{getDefault(){return this.gl.TEXTURE0}set(o){(o!==this.current||this.dirty)&&(this.gl.activeTexture(o),this.current=o,this.dirty=!1)}}class Ds extends Di{getDefault(){const o=this.gl;return[0,0,o.drawingBufferWidth,o.drawingBufferHeight]}set(o){const h=this.current;(o[0]!==h[0]||o[1]!==h[1]||o[2]!==h[2]||o[3]!==h[3]||this.dirty)&&(this.gl.viewport(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class ch extends Di{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.bindFramebuffer(h.FRAMEBUFFER,o),this.current=o,this.dirty=!1}}class uh extends Di{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.bindRenderbuffer(h.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class bc extends Di{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.bindTexture(h.TEXTURE_2D,o),this.current=o,this.dirty=!1}}class as extends Di{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.bindBuffer(h.ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class hh extends Di{getDefault(){return null}set(o){const h=this.gl;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class Rs extends Di{getDefault(){return null}set(o){var h;if(o===this.current&&!this.dirty)return;const p=this.gl;rr(p)?p.bindVertexArray(o):(h=p.getExtension("OES_vertex_array_object"))===null||h===void 0||h.bindVertexArrayOES(o),this.current=o,this.dirty=!1}}class Bs extends Di{getDefault(){return 4}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_ALIGNMENT,o),this.current=o,this.dirty=!1}}class dh extends Di{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o),this.current=o,this.dirty=!1}}class wc extends Di{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,o),this.current=o,this.dirty=!1}}class Li extends Di{constructor(o,h){super(o),this.context=o,this.parent=h}getDefault(){return null}}class ol extends Li{setDirty(){this.dirty=!0}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,o,0),this.current=o,this.dirty=!1}}class Qd extends Li{set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_ATTACHMENT,h.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class fh extends Li{set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_STENCIL_ATTACHMENT,h.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class ya{constructor(o,h,p,m,b){this.context=o,this.width=h,this.height=p;const C=o.gl,M=this.framebuffer=C.createFramebuffer();if(this.colorAttachment=new ol(o,M),m)this.depthAttachment=b?new fh(o,M):new Qd(o,M);else if(b)throw new Error("Stencil cannot be set without depth");if(C.checkFramebufferStatus(C.FRAMEBUFFER)!==C.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const o=this.context.gl,h=this.colorAttachment.get();if(h&&o.deleteTexture(h),this.depthAttachment){const p=this.depthAttachment.get();p&&o.deleteRenderbuffer(p)}o.deleteFramebuffer(this.framebuffer)}}class In{constructor(o,h,p){this.blendFunction=o,this.blendColor=h,this.mask=p}}In.Replace=[1,0],In.disabled=new In(In.Replace,a.aO.transparent,[!1,!1,!1,!1]),In.unblended=new In(In.Replace,a.aO.transparent,[!0,!0,!0,!0]),In.alphaBlended=new In([1,771],a.aO.transparent,[!0,!0,!0,!0]);class ef{constructor(o){var h,p;if(this.gl=o,this.clearColor=new el(this),this.clearDepth=new tl(this),this.clearStencil=new fc(this),this.colorMask=new pc(this),this.depthMask=new il(this),this.stencilMask=new mc(this),this.stencilFunc=new gc(this),this.stencilOp=new nl(this),this.stencilTest=new ah(this),this.depthRange=new lh(this),this.depthTest=new zs(this),this.depthFunc=new Wd(this),this.blend=new Hd(this),this.blendFunc=new Xd(this),this.blendColor=new Kd(this),this.blendEquation=new Jd(this),this.cullFace=new Yd(this),this.cullFaceSide=new _c(this),this.frontFace=new rl(this),this.program=new yc(this),this.activeTexture=new vc(this),this.viewport=new Ds(this),this.bindFramebuffer=new ch(this),this.bindRenderbuffer=new uh(this),this.bindTexture=new bc(this),this.bindVertexBuffer=new as(this),this.bindElementBuffer=new hh(this),this.bindVertexArray=new Rs(this),this.pixelStoreUnpack=new Bs(this),this.pixelStoreUnpackPremultiplyAlpha=new dh(this),this.pixelStoreUnpackFlipY=new wc(this),this.extTextureFilterAnisotropic=o.getExtension("EXT_texture_filter_anisotropic")||o.getExtension("MOZ_EXT_texture_filter_anisotropic")||o.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=o.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=o.getParameter(o.MAX_TEXTURE_SIZE),rr(o)){this.HALF_FLOAT=o.HALF_FLOAT;const m=o.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(h=o.RGBA16F)!==null&&h!==void 0?h:m==null?void 0:m.RGBA16F_EXT,this.RGB16F=(p=o.RGB16F)!==null&&p!==void 0?p:m==null?void 0:m.RGB16F_EXT,o.getExtension("EXT_color_buffer_float")}else{o.getExtension("EXT_color_buffer_half_float"),o.getExtension("OES_texture_half_float_linear");const m=o.getExtension("OES_texture_half_float");this.HALF_FLOAT=m==null?void 0:m.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(o,h){return new Gd(this,o,h)}createVertexBuffer(o,h,p){return new Qa(this,o,h,p)}createRenderbuffer(o,h,p){const m=this.gl,b=m.createRenderbuffer();return this.bindRenderbuffer.set(b),m.renderbufferStorage(m.RENDERBUFFER,o,h,p),this.bindRenderbuffer.set(null),b}createFramebuffer(o,h,p,m){return new ya(this,o,h,p,m)}clear({color:o,depth:h,stencil:p}){const m=this.gl;let b=0;o&&(b|=m.COLOR_BUFFER_BIT,this.clearColor.set(o),this.colorMask.set([!0,!0,!0,!0])),h!==void 0&&(b|=m.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(h),this.depthMask.set(!0)),p!==void 0&&(b|=m.STENCIL_BUFFER_BIT,this.clearStencil.set(p),this.stencilMask.set(255)),m.clear(b)}setCullFace(o){o.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(o.mode),this.frontFace.set(o.frontFace))}setDepthMode(o){o.func!==this.gl.ALWAYS||o.mask?(this.depthTest.set(!0),this.depthFunc.set(o.func),this.depthMask.set(o.mask),this.depthRange.set(o.range)):this.depthTest.set(!1)}setStencilMode(o){o.test.func!==this.gl.ALWAYS||o.mask?(this.stencilTest.set(!0),this.stencilMask.set(o.mask),this.stencilOp.set([o.fail,o.depthFail,o.pass]),this.stencilFunc.set({func:o.test.func,ref:o.ref,mask:o.test.mask})):this.stencilTest.set(!1)}setColorMode(o){a.aD(o.blendFunction,In.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(o.blendFunction),this.blendColor.set(o.blendColor)),this.colorMask.set(o.mask)}createVertexArray(){var o;return rr(this.gl)?this.gl.createVertexArray():(o=this.gl.getExtension("OES_vertex_array_object"))===null||o===void 0?void 0:o.createVertexArrayOES()}deleteVertexArray(o){var h;return rr(this.gl)?this.gl.deleteVertexArray(o):(h=this.gl.getExtension("OES_vertex_array_object"))===null||h===void 0?void 0:h.deleteVertexArrayOES(o)}unbindVAO(){this.bindVertexArray.set(null)}}class Si{constructor(o,h,p){this.func=o,this.mask=h,this.range=p}}Si.ReadOnly=!1,Si.ReadWrite=!0,Si.disabled=new Si(519,Si.ReadOnly,[0,1]);const xc=7680;class en{constructor(o,h,p,m,b,C){this.test=o,this.ref=h,this.mask=p,this.fail=m,this.depthFail=b,this.pass=C}}en.disabled=new en({func:519,mask:0},0,0,xc,xc,xc);class Ji{constructor(o,h,p){this.enable=o,this.mode=h,this.frontFace=p}}let ls;function sl(y,o,h,p,m,b,C){const M=y.context,L=M.gl,O=y.useProgram("collisionBox"),$=[];let q=0,ee=0;for(let be=0;be<p.length;be++){const Re=p[be],We=o.getTile(Re),He=We.getBucket(h);if(!He)continue;let Xe=Re.posMatrix;m[0]===0&&m[1]===0||(Xe=y.translatePosMatrix(Re.posMatrix,We,m,b));const rt=C?He.textCollisionBox:He.iconCollisionBox,it=He.collisionCircleArray;if(it.length>0){const pt=a.F(),yt=Xe;a.aP(pt,He.placementInvProjMatrix,y.transform.glCoordMatrix),a.aP(pt,pt,He.placementViewportMatrix),$.push({circleArray:it,circleOffset:ee,transform:yt,invTransform:pt,coord:Re}),q+=it.length/4,ee=q}rt&&O.draw(M,L.LINES,Si.disabled,en.disabled,y.colorModeForRenderPass(),Ji.disabled,th(Xe,y.transform,We),y.style.map.terrain&&y.style.map.terrain.getTerrainData(Re),h.id,rt.layoutVertexBuffer,rt.indexBuffer,rt.segments,null,y.transform.zoom,null,null,rt.collisionVertexBuffer)}if(!C||!$.length)return;const pe=y.useProgram("collisionCircle"),fe=new a.aQ;fe.resize(4*q),fe._trim();let _e=0;for(const be of $)for(let Re=0;Re<be.circleArray.length/4;Re++){const We=4*Re,He=be.circleArray[We+0],Xe=be.circleArray[We+1],rt=be.circleArray[We+2],it=be.circleArray[We+3];fe.emplace(_e++,He,Xe,rt,it,0),fe.emplace(_e++,He,Xe,rt,it,1),fe.emplace(_e++,He,Xe,rt,it,2),fe.emplace(_e++,He,Xe,rt,it,3)}(!ls||ls.length<2*q)&&(ls=function(be){const Re=2*be,We=new a.aS;We.resize(Re),We._trim();for(let He=0;He<Re;He++){const Xe=6*He;We.uint16[Xe+0]=4*He+0,We.uint16[Xe+1]=4*He+1,We.uint16[Xe+2]=4*He+2,We.uint16[Xe+3]=4*He+2,We.uint16[Xe+4]=4*He+3,We.uint16[Xe+5]=4*He+0}return We}(q));const ce=M.createIndexBuffer(ls,!0),Ce=M.createVertexBuffer(fe,a.aR.members,!0);for(const be of $){const Re={u_matrix:be.transform,u_inv_matrix:be.invTransform,u_camera_to_center_distance:(Ze=y.transform).cameraToCenterDistance,u_viewport_size:[Ze.width,Ze.height]};pe.draw(M,L.TRIANGLES,Si.disabled,en.disabled,y.colorModeForRenderPass(),Ji.disabled,Re,y.style.map.terrain&&y.style.map.terrain.getTerrainData(be.coord),h.id,Ce,ce,a.$.simpleSegment(0,2*be.circleOffset,be.circleArray.length,be.circleArray.length/2),null,y.transform.zoom,null,null,null)}var Ze;Ce.destroy(),ce.destroy()}Ji.disabled=new Ji(!1,1029,2305),Ji.backCCW=new Ji(!0,1029,2305);const kc=a.an(new Float32Array(16));function ph(y,o,h,p,m,b){const{horizontalAlign:C,verticalAlign:M}=a.at(y);return new a.P((-(C-.5)*o/m+p[0])*b,(-(M-.5)*h/m+p[1])*b)}function al(y,o,h,p,m,b,C,M,L,O,$){const q=y.text.placedSymbolArray,ee=y.text.dynamicLayoutVertexArray,pe=y.icon.dynamicLayoutVertexArray,fe={};ee.clear();for(let _e=0;_e<q.length;_e++){const ce=q.get(_e),Ce=ce.hidden||!ce.crossTileID||y.allowVerticalPlacement&&!ce.placedOrientation?null:p[ce.crossTileID];if(Ce){const Ze=new a.P(ce.anchorX,ce.anchorY),be=_n(Ze,h?C:b,$),Re=me(m.cameraToCenterDistance,be.signedDistanceFromCamera);let We=a.ai(y.textSizeData,L,ce)*Re/a.ao;h&&(We*=y.tilePixelRatio/M);const{width:He,height:Xe,anchor:rt,textOffset:it,textBoxScale:pt}=Ce,yt=ph(rt,He,Xe,it,pt,We),ai=h?_n(Ze.add(yt),b,$).point:be.point.add(o?yt.rotate(-m.angle):yt),bt=y.allowVerticalPlacement&&ce.placedOrientation===a.ah.vertical?Math.PI/2:0;for(let Kt=0;Kt<ce.numGlyphs;Kt++)a.aj(ee,ai,bt);O&&ce.associatedIconIndex>=0&&(fe[ce.associatedIconIndex]={shiftedAnchor:ai,angle:bt})}else Ge(ce.numGlyphs,ee)}if(O){pe.clear();const _e=y.icon.placedSymbolArray;for(let ce=0;ce<_e.length;ce++){const Ce=_e.get(ce);if(Ce.hidden)Ge(Ce.numGlyphs,pe);else{const Ze=fe[ce];if(Ze)for(let be=0;be<Ce.numGlyphs;be++)a.aj(pe,Ze.shiftedAnchor,Ze.angle);else Ge(Ce.numGlyphs,pe)}}y.icon.dynamicLayoutVertexBuffer.updateData(pe)}y.text.dynamicLayoutVertexBuffer.updateData(ee)}function ll(y,o,h){return h.iconsInText&&o?"symbolTextAndIcon":y?"symbolSDF":"symbolIcon"}function cl(y,o,h,p,m,b,C,M,L,O,$,q){const ee=y.context,pe=ee.gl,fe=y.transform,_e=M==="map",ce=L==="map",Ce=M!=="viewport"&&h.layout.get("symbol-placement")!=="point",Ze=_e&&!ce&&!Ce,be=!h.layout.get("symbol-sort-key").isConstant();let Re=!1;const We=y.depthModeForSublayer(0,Si.ReadOnly),He=h._unevaluatedLayout.hasValue("text-variable-anchor")||h._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Xe=[];for(const rt of p){const it=o.getTile(rt),pt=it.getBucket(h);if(!pt)continue;const yt=m?pt.text:pt.icon;if(!yt||!yt.segments.get().length||!yt.hasVisibleVertices)continue;const ai=yt.programConfigurations.get(h.id),bt=m||pt.sdfIcons,Kt=m?pt.textSizeData:pt.iconSizeData,li=ce||fe.pitch!==0,Ti=y.useProgram(ll(bt,m,pt),ai),ii=a.ag(Kt,fe.zoom),di=y.style.map.terrain&&y.style.map.terrain.getTerrainData(rt);let mi,wn,Vi,Fr,qn=[0,0],fn=null;if(m)wn=it.glyphAtlasTexture,Vi=pe.LINEAR,mi=it.glyphAtlasTexture.size,pt.iconsInText&&(qn=it.imageAtlasTexture.size,fn=it.imageAtlasTexture,Fr=li||y.options.rotating||y.options.zooming||Kt.kind==="composite"||Kt.kind==="camera"?pe.LINEAR:pe.NEAREST);else{const On=h.layout.get("icon-size").constantOr(0)!==1||pt.iconsNeedLinear;wn=it.imageAtlasTexture,Vi=bt||y.options.rotating||y.options.zooming||On||li?pe.LINEAR:pe.NEAREST,mi=it.imageAtlasTexture.size}const Zn=Xt(it,1,y.transform.zoom),Or=ni(rt.posMatrix,ce,_e,y.transform,Zn),wo=no(rt.posMatrix,ce,_e,y.transform,Zn),Yo=He&&pt.hasTextData(),Aa=h.layout.get("icon-text-fit")!=="none"&&Yo&&pt.hasIconData();if(Ce){const On=y.style.map.terrain?(Yr,Nn)=>y.style.map.terrain.getElevation(rt,Yr,Nn):null,mn=h.layout.get("text-rotation-alignment")==="map";K(pt,rt.posMatrix,y,m,Or,wo,ce,O,mn,On)}const Qo=y.translatePosMatrix(rt.posMatrix,it,b,C),xo=Ce||m&&He||Aa?kc:Or,Fn=y.translatePosMatrix(wo,it,b,C,!0),pn=bt&&h.paint.get(m?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let ln;ln=bt?pt.iconsInText?_a(Kt.kind,ii,Ze,ce,y,Qo,xo,Fn,mi,qn):ga(Kt.kind,ii,Ze,ce,y,Qo,xo,Fn,m,mi,!0):ma(Kt.kind,ii,Ze,ce,y,Qo,xo,Fn,m,mi);const Jr={program:Ti,buffers:yt,uniformValues:ln,atlasTexture:wn,atlasTextureIcon:fn,atlasInterpolation:Vi,atlasInterpolationIcon:Fr,isSDF:bt,hasHalo:pn};if(be&&pt.canOverlap){Re=!0;const On=yt.segments.get();for(const mn of On)Xe.push({segments:new a.$([mn]),sortKey:mn.sortKey,state:Jr,terrainData:di})}else Xe.push({segments:yt.segments,sortKey:0,state:Jr,terrainData:di})}Re&&Xe.sort((rt,it)=>rt.sortKey-it.sortKey);for(const rt of Xe){const it=rt.state;if(ee.activeTexture.set(pe.TEXTURE0),it.atlasTexture.bind(it.atlasInterpolation,pe.CLAMP_TO_EDGE),it.atlasTextureIcon&&(ee.activeTexture.set(pe.TEXTURE1),it.atlasTextureIcon&&it.atlasTextureIcon.bind(it.atlasInterpolationIcon,pe.CLAMP_TO_EDGE)),it.isSDF){const pt=it.uniformValues;it.hasHalo&&(pt.u_is_halo=1,mh(it.buffers,rt.segments,h,y,it.program,We,$,q,pt,rt.terrainData)),pt.u_is_halo=0}mh(it.buffers,rt.segments,h,y,it.program,We,$,q,it.uniformValues,rt.terrainData)}}function mh(y,o,h,p,m,b,C,M,L,O){const $=p.context;m.draw($,$.gl.TRIANGLES,b,C,M,Ji.disabled,L,O,h.id,y.layoutVertexBuffer,y.indexBuffer,o,h.paint,p.transform.zoom,y.programConfigurations.get(h.id),y.dynamicLayoutVertexBuffer,y.opacityVertexBuffer)}function ul(y,o,h,p,m){if(!h||!p||!p.imageAtlas)return;const b=p.imageAtlas.patternPositions;let C=b[h.to.toString()],M=b[h.from.toString()];if(!C&&M&&(C=M),!M&&C&&(M=C),!C||!M){const L=m.getPaintProperty(o);C=b[L],M=b[L]}C&&M&&y.setConstantPatternPositions(C,M)}function gh(y,o,h,p,m,b,C){const M=y.context.gl,L="fill-pattern",O=h.paint.get(L),$=O&&O.constantOr(1),q=h.getCrossfadeParameters();let ee,pe,fe,_e,ce;C?(pe=$&&!h.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",ee=M.LINES):(pe=$?"fillPattern":"fill",ee=M.TRIANGLES);const Ce=O.constantOr(null);for(const Ze of p){const be=o.getTile(Ze);if($&&!be.patternsLoaded())continue;const Re=be.getBucket(h);if(!Re)continue;const We=Re.programConfigurations.get(h.id),He=y.useProgram(pe,We),Xe=y.style.map.terrain&&y.style.map.terrain.getTerrainData(Ze);$&&(y.context.activeTexture.set(M.TEXTURE0),be.imageAtlasTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),We.updatePaintBuffers(q)),ul(We,L,Ce,be,h);const rt=Xe?Ze:null,it=y.translatePosMatrix(rt?rt.posMatrix:Ze.posMatrix,be,h.paint.get("fill-translate"),h.paint.get("fill-translate-anchor"));if(C){_e=Re.indexBuffer2,ce=Re.segments2;const pt=[M.drawingBufferWidth,M.drawingBufferHeight];fe=pe==="fillOutlinePattern"&&$?eh(it,y,q,be,pt):Vd(it,pt)}else _e=Re.indexBuffer,ce=Re.segments,fe=$?Ha(it,y,q,be):Qu(it);He.draw(y.context,ee,m,y.stencilModeForClipping(Ze),b,Ji.disabled,fe,Xe,h.id,Re.layoutVertexBuffer,_e,ce,h.paint,y.transform.zoom,We)}}function hl(y,o,h,p,m,b,C){const M=y.context,L=M.gl,O="fill-extrusion-pattern",$=h.paint.get(O),q=$.constantOr(1),ee=h.getCrossfadeParameters(),pe=h.paint.get("fill-extrusion-opacity"),fe=$.constantOr(null);for(const _e of p){const ce=o.getTile(_e),Ce=ce.getBucket(h);if(!Ce)continue;const Ze=y.style.map.terrain&&y.style.map.terrain.getTerrainData(_e),be=Ce.programConfigurations.get(h.id),Re=y.useProgram(q?"fillExtrusionPattern":"fillExtrusion",be);q&&(y.context.activeTexture.set(L.TEXTURE0),ce.imageAtlasTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE),be.updatePaintBuffers(ee)),ul(be,O,fe,ce,h);const We=y.translatePosMatrix(_e.posMatrix,ce,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),He=h.paint.get("fill-extrusion-vertical-gradient"),Xe=q?Ud(We,y,He,pe,_e,ee,ce):da(We,y,He,pe);Re.draw(M,M.gl.TRIANGLES,m,b,C,Ji.backCCW,Xe,Ze,h.id,Ce.layoutVertexBuffer,Ce.indexBuffer,Ce.segments,h.paint,y.transform.zoom,be,y.style.map.terrain&&Ce.centroidVertexBuffer)}}function dl(y,o,h,p,m,b,C){const M=y.context,L=M.gl,O=h.fbo;if(!O)return;const $=y.useProgram("hillshade"),q=y.style.map.terrain&&y.style.map.terrain.getTerrainData(o);M.activeTexture.set(L.TEXTURE0),L.bindTexture(L.TEXTURE_2D,O.colorAttachment.get()),$.draw(M,L.TRIANGLES,m,b,C,Ji.disabled,((ee,pe,fe,_e)=>{const ce=fe.paint.get("hillshade-shadow-color"),Ce=fe.paint.get("hillshade-highlight-color"),Ze=fe.paint.get("hillshade-accent-color");let be=fe.paint.get("hillshade-illumination-direction")*(Math.PI/180);fe.paint.get("hillshade-illumination-anchor")==="viewport"&&(be-=ee.transform.angle);const Re=!ee.options.moving;return{u_matrix:_e?_e.posMatrix:ee.transform.calculatePosMatrix(pe.tileID.toUnwrapped(),Re),u_image:0,u_latrange:rh(0,pe.tileID),u_light:[fe.paint.get("hillshade-exaggeration"),be],u_shadow:ce,u_highlight:Ce,u_accent:Ze}})(y,h,p,q?o:null),q,p.id,y.rasterBoundsBuffer,y.quadTriangleIndexBuffer,y.rasterBoundsSegments)}function Sc(y,o,h,p,m,b){const C=y.context,M=C.gl,L=o.dem;if(L&&L.data){const O=L.dim,$=L.stride,q=L.getPixels();if(C.activeTexture.set(M.TEXTURE1),C.pixelStoreUnpackPremultiplyAlpha.set(!1),o.demTexture=o.demTexture||y.getTileTexture($),o.demTexture){const pe=o.demTexture;pe.update(q,{premultiply:!1}),pe.bind(M.NEAREST,M.CLAMP_TO_EDGE)}else o.demTexture=new re(C,q,M.RGBA,{premultiply:!1}),o.demTexture.bind(M.NEAREST,M.CLAMP_TO_EDGE);C.activeTexture.set(M.TEXTURE0);let ee=o.fbo;if(!ee){const pe=new re(C,{width:O,height:O,data:null},M.RGBA);pe.bind(M.LINEAR,M.CLAMP_TO_EDGE),ee=o.fbo=C.createFramebuffer(O,O,!0,!1),ee.colorAttachment.set(pe.texture)}C.bindFramebuffer.set(ee.framebuffer),C.viewport.set([0,0,O,O]),y.useProgram("hillshadePrepare").draw(C,M.TRIANGLES,p,m,b,Ji.disabled,((pe,fe)=>{const _e=fe.stride,ce=a.F();return a.aN(ce,0,a.W,-a.W,0,0,1),a.H(ce,ce,[0,-a.W,0]),{u_matrix:ce,u_image:1,u_dimension:[_e,_e],u_zoom:pe.overscaledZ,u_unpack:fe.getUnpackVector()}})(o.tileID,L),null,h.id,y.rasterBoundsBuffer,y.quadTriangleIndexBuffer,y.rasterBoundsSegments),o.needsHillshadePrepare=!1}}function _h(y,o,h,p,m,b){const C=p.paint.get("raster-fade-duration");if(!b&&C>0){const M=S.now(),L=(M-y.timeAdded)/C,O=o?(M-o.timeAdded)/C:-1,$=h.getSource(),q=m.coveringZoomLevel({tileSize:$.tileSize,roundZoom:$.roundZoom}),ee=!o||Math.abs(o.tileID.overscaledZ-q)>Math.abs(y.tileID.overscaledZ-q),pe=ee&&y.refreshedUponExpiration?1:a.ac(ee?L:1-O,0,1);return y.refreshedUponExpiration&&L>=1&&(y.refreshedUponExpiration=!1),o?{opacity:1,mix:1-pe}:{opacity:pe,mix:0}}return{opacity:1,mix:0}}const yh=new a.aO(1,0,0,1),fl=new a.aO(0,1,0,1),Tc=new a.aO(0,0,1,1),tf=new a.aO(1,0,1,1),vh=new a.aO(0,1,1,1);function vn(y,o,h,p){fr(y,0,o+h/2,y.transform.width,h,p)}function Ho(y,o,h,p){fr(y,o-h/2,0,h,y.transform.height,p)}function fr(y,o,h,p,m,b){const C=y.context,M=C.gl;M.enable(M.SCISSOR_TEST),M.scissor(o*y.pixelRatio,h*y.pixelRatio,p*y.pixelRatio,m*y.pixelRatio),C.clear({color:b}),M.disable(M.SCISSOR_TEST)}function Cc(y,o,h){const p=y.context,m=p.gl,b=h.posMatrix,C=y.useProgram("debug"),M=Si.disabled,L=en.disabled,O=y.colorModeForRenderPass(),$="$debug",q=y.style.map.terrain&&y.style.map.terrain.getTerrainData(h);p.activeTexture.set(m.TEXTURE0);const ee=o.getTileByID(h.key).latestRawTileData,pe=Math.floor((ee&&ee.byteLength||0)/1024),fe=o.getTile(h).tileSize,_e=512/Math.min(fe,512)*(h.overscaledZ/y.transform.zoom)*.5;let ce=h.canonical.toString();h.overscaledZ!==h.canonical.z&&(ce+=` => ${h.overscaledZ}`),function(Ce,Ze){Ce.initDebugOverlayCanvas();const be=Ce.debugOverlayCanvas,Re=Ce.context.gl,We=Ce.debugOverlayCanvas.getContext("2d");We.clearRect(0,0,be.width,be.height),We.shadowColor="white",We.shadowBlur=2,We.lineWidth=1.5,We.strokeStyle="white",We.textBaseline="top",We.font="bold 36px Open Sans, sans-serif",We.fillText(Ze,5,5),We.strokeText(Ze,5,5),Ce.debugOverlayTexture.update(be),Ce.debugOverlayTexture.bind(Re.LINEAR,Re.CLAMP_TO_EDGE)}(y,`${ce} ${pe}kB`),C.draw(p,m.TRIANGLES,M,L,In.alphaBlended,Ji.disabled,ih(b,a.aO.transparent,_e),null,$,y.debugBuffer,y.quadTriangleIndexBuffer,y.debugSegments),C.draw(p,m.LINE_STRIP,M,L,O,Ji.disabled,ih(b,a.aO.red),q,$,y.debugBuffer,y.tileBorderIndexBuffer,y.debugSegments)}function pl(y,o,h){const p=y.context,m=p.gl,b=y.colorModeForRenderPass(),C=new Si(m.LEQUAL,Si.ReadWrite,y.depthRangeFor3D),M=y.useProgram("terrain"),L=o.getTerrainMesh();p.bindFramebuffer.set(null),p.viewport.set([0,0,y.width,y.height]);for(const O of h){const $=y.renderToTexture.getTexture(O),q=o.getTerrainData(O.tileID);p.activeTexture.set(m.TEXTURE0),m.bindTexture(m.TEXTURE_2D,$.texture);const ee={u_matrix:y.transform.calculatePosMatrix(O.tileID.toUnwrapped()),u_texture:0,u_ele_delta:o.getMeshFrameDelta(y.transform.zoom)};M.draw(p,m.TRIANGLES,C,en.disabled,b,Ji.backCCW,ee,q,"terrain",L.vertexBuffer,L.indexBuffer,L.segments)}}class bh{constructor(o,h){this.context=new ef(o),this.transform=h,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:a.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Xi.maxUnderzooming+Xi.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Go}resize(o,h,p){if(this.width=Math.floor(o*p),this.height=Math.floor(h*p),this.pixelRatio=p,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const m of this.style._order)this.style._layers[m].resize()}setup(){const o=this.context,h=new a.aV;h.emplaceBack(0,0),h.emplaceBack(a.W,0),h.emplaceBack(0,a.W),h.emplaceBack(a.W,a.W),this.tileExtentBuffer=o.createVertexBuffer(h,Za.members),this.tileExtentSegments=a.$.simpleSegment(0,0,4,2);const p=new a.aV;p.emplaceBack(0,0),p.emplaceBack(a.W,0),p.emplaceBack(0,a.W),p.emplaceBack(a.W,a.W),this.debugBuffer=o.createVertexBuffer(p,Za.members),this.debugSegments=a.$.simpleSegment(0,0,4,5);const m=new a.Z;m.emplaceBack(0,0,0,0),m.emplaceBack(a.W,0,a.W,0),m.emplaceBack(0,a.W,0,a.W),m.emplaceBack(a.W,a.W,a.W,a.W),this.rasterBoundsBuffer=o.createVertexBuffer(m,Ye.members),this.rasterBoundsSegments=a.$.simpleSegment(0,0,4,2);const b=new a.aV;b.emplaceBack(0,0),b.emplaceBack(1,0),b.emplaceBack(0,1),b.emplaceBack(1,1),this.viewportBuffer=o.createVertexBuffer(b,Za.members),this.viewportSegments=a.$.simpleSegment(0,0,4,2);const C=new a.aW;C.emplaceBack(0),C.emplaceBack(1),C.emplaceBack(3),C.emplaceBack(2),C.emplaceBack(0),this.tileBorderIndexBuffer=o.createIndexBuffer(C);const M=new a.aX;M.emplaceBack(0,1,2),M.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=o.createIndexBuffer(M);const L=this.context.gl;this.stencilClearMode=new en({func:L.ALWAYS,mask:0},0,255,L.ZERO,L.ZERO,L.ZERO)}clearStencil(){const o=this.context,h=o.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const p=a.F();a.aN(p,0,this.width,this.height,0,0,1),a.J(p,p,[h.drawingBufferWidth,h.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(o,h.TRIANGLES,Si.disabled,this.stencilClearMode,In.disabled,Ji.disabled,Xa(p),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(o,h){if(this.currentStencilSource===o.source||!o.isTileClipped()||!h||!h.length)return;this.currentStencilSource=o.source;const p=this.context,m=p.gl;this.nextStencilID+h.length>256&&this.clearStencil(),p.setColorMode(In.disabled),p.setDepthMode(Si.disabled);const b=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const C of h){const M=this._tileClippingMaskIDs[C.key]=this.nextStencilID++,L=this.style.map.terrain&&this.style.map.terrain.getTerrainData(C);b.draw(p,m.TRIANGLES,Si.disabled,new en({func:m.ALWAYS,mask:0},M,255,m.KEEP,m.KEEP,m.REPLACE),In.disabled,Ji.disabled,Xa(C.posMatrix),L,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const o=this.nextStencilID++,h=this.context.gl;return new en({func:h.NOTEQUAL,mask:255},o,255,h.KEEP,h.KEEP,h.REPLACE)}stencilModeForClipping(o){const h=this.context.gl;return new en({func:h.EQUAL,mask:255},this._tileClippingMaskIDs[o.key],0,h.KEEP,h.KEEP,h.REPLACE)}stencilConfigForOverlap(o){const h=this.context.gl,p=o.sort((C,M)=>M.overscaledZ-C.overscaledZ),m=p[p.length-1].overscaledZ,b=p[0].overscaledZ-m+1;if(b>1){this.currentStencilSource=void 0,this.nextStencilID+b>256&&this.clearStencil();const C={};for(let M=0;M<b;M++)C[M+m]=new en({func:h.GEQUAL,mask:255},M+this.nextStencilID,255,h.KEEP,h.KEEP,h.REPLACE);return this.nextStencilID+=b,[C,p]}return[{[m]:en.disabled},p]}colorModeForRenderPass(){const o=this.context.gl;return this._showOverdrawInspector?new In([o.CONSTANT_COLOR,o.ONE],new a.aO(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?In.unblended:In.alphaBlended}depthModeForSublayer(o,h,p){if(!this.opaquePassEnabledForLayer())return Si.disabled;const m=1-((1+this.currentLayer)*this.numSublayers+o)*this.depthEpsilon;return new Si(p||this.context.gl.LEQUAL,h,[m,m])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(o,h){this.style=o,this.options=h,this.lineAtlas=o.lineAtlas,this.imageManager=o.imageManager,this.glyphManager=o.glyphManager,this.symbolFadeChange=o.placement.symbolFadeChange(S.now()),this.imageManager.beginFrame();const p=this.style._order,m=this.style.sourceCaches,b={},C={},M={};for(const L in m){const O=m[L];O.used&&O.prepare(this.context),b[L]=O.getVisibleCoordinates(),C[L]=b[L].slice().reverse(),M[L]=O.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let L=0;L<p.length;L++)if(this.style._layers[p[L]].is3D()){this.opaquePassCutoff=L;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const L of p){const O=this.style._layers[L];if(!O.hasOffscreenPass()||O.isHidden(this.transform.zoom))continue;const $=C[O.source];(O.type==="custom"||$.length)&&this.renderLayer(this,m[O.source],O,$)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:h.showOverdrawInspector?a.aO.black:a.aO.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=h.showOverdrawInspector,this.depthRangeFor3D=[0,1-(o._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=p.length-1;this.currentLayer>=0;this.currentLayer--){const L=this.style._layers[p[this.currentLayer]],O=m[L.source],$=b[L.source];this._renderTileClippingMasks(L,$),this.renderLayer(this,O,L,$)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<p.length;this.currentLayer++){const L=this.style._layers[p[this.currentLayer]],O=m[L.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(L))continue;const $=(L.type==="symbol"?M:C)[L.source];this._renderTileClippingMasks(L,b[L.source]),this.renderLayer(this,O,L,$)}if(this.options.showTileBoundaries){const L=function(O,$){let q=null;const ee=Object.values(O._layers).flatMap(ce=>ce.source&&!ce.isHidden($)?[O.sourceCaches[ce.source]]:[]),pe=ee.filter(ce=>ce.getSource().type==="vector"),fe=ee.filter(ce=>ce.getSource().type!=="vector"),_e=ce=>{(!q||q.getSource().maxzoom<ce.getSource().maxzoom)&&(q=ce)};return pe.forEach(ce=>_e(ce)),q||fe.forEach(ce=>_e(ce)),q}(this.style,this.transform.zoom);L&&function(O,$,q){for(let ee=0;ee<q.length;ee++)Cc(O,$,q[ee])}(this,L,L.getVisibleCoordinates())}this.options.showPadding&&function(L){const O=L.transform.padding;vn(L,L.transform.height-(O.top||0),3,yh),vn(L,O.bottom||0,3,fl),Ho(L,O.left||0,3,Tc),Ho(L,L.transform.width-(O.right||0),3,tf);const $=L.transform.centerPoint;(function(q,ee,pe,fe){fr(q,ee-1,pe-10,2,20,fe),fr(q,ee-10,pe-1,20,2,fe)})(L,$.x,L.transform.height-$.y,vh)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(o){if(!this.style||!this.style.map||!this.style.map.terrain)return;const h=this.terrainFacilitator.matrix,p=this.transform.projMatrix;let m=this.terrainFacilitator.dirty;m||(m=o?!a.aY(h,p):!a.aZ(h,p)),m||(m=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),m&&(a.a_(h,p),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(b,C){const M=b.context,L=M.gl,O=In.unblended,$=new Si(L.LEQUAL,Si.ReadWrite,[0,1]),q=C.getTerrainMesh(),ee=C.sourceCache.getRenderableTiles(),pe=b.useProgram("terrainDepth");M.bindFramebuffer.set(C.getFramebuffer("depth").framebuffer),M.viewport.set([0,0,b.width/devicePixelRatio,b.height/devicePixelRatio]),M.clear({color:a.aO.transparent,depth:1});for(const fe of ee){const _e=C.getTerrainData(fe.tileID),ce={u_matrix:b.transform.calculatePosMatrix(fe.tileID.toUnwrapped()),u_ele_delta:C.getMeshFrameDelta(b.transform.zoom)};pe.draw(M,L.TRIANGLES,$,en.disabled,O,Ji.backCCW,ce,_e,"terrain",q.vertexBuffer,q.indexBuffer,q.segments)}M.bindFramebuffer.set(null),M.viewport.set([0,0,b.width,b.height])}(this,this.style.map.terrain),function(b,C){const M=b.context,L=M.gl,O=In.unblended,$=new Si(L.LEQUAL,Si.ReadWrite,[0,1]),q=C.getTerrainMesh(),ee=C.getCoordsTexture(),pe=C.sourceCache.getRenderableTiles(),fe=b.useProgram("terrainCoords");M.bindFramebuffer.set(C.getFramebuffer("coords").framebuffer),M.viewport.set([0,0,b.width/devicePixelRatio,b.height/devicePixelRatio]),M.clear({color:a.aO.transparent,depth:1}),C.coordsIndex=[];for(const _e of pe){const ce=C.getTerrainData(_e.tileID);M.activeTexture.set(L.TEXTURE0),L.bindTexture(L.TEXTURE_2D,ee.texture);const Ce={u_matrix:b.transform.calculatePosMatrix(_e.tileID.toUnwrapped()),u_terrain_coords_id:(255-C.coordsIndex.length)/255,u_texture:0,u_ele_delta:C.getMeshFrameDelta(b.transform.zoom)};fe.draw(M,L.TRIANGLES,$,en.disabled,O,Ji.backCCW,Ce,ce,"terrain",q.vertexBuffer,q.indexBuffer,q.segments),C.coordsIndex.push(_e.tileID.key)}M.bindFramebuffer.set(null),M.viewport.set([0,0,b.width,b.height])}(this,this.style.map.terrain))}renderLayer(o,h,p,m){if(!p.isHidden(this.transform.zoom)&&(p.type==="background"||p.type==="custom"||(m||[]).length))switch(this.id=p.id,p.type){case"symbol":(function(b,C,M,L,O){if(b.renderPass!=="translucent")return;const $=en.disabled,q=b.colorModeForRenderPass();(M._unevaluatedLayout.hasValue("text-variable-anchor")||M._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(ee,pe,fe,_e,ce,Ce,Ze){const be=pe.transform,Re=ce==="map",We=Ce==="map";for(const He of ee){const Xe=_e.getTile(He),rt=Xe.getBucket(fe);if(!rt||!rt.text||!rt.text.segments.get().length)continue;const it=a.ag(rt.textSizeData,be.zoom),pt=Xt(Xe,1,pe.transform.zoom),yt=ni(He.posMatrix,We,Re,pe.transform,pt),ai=fe.layout.get("icon-text-fit")!=="none"&&rt.hasIconData();if(it){const bt=Math.pow(2,be.zoom-Xe.tileID.overscaledZ);al(rt,Re,We,Ze,be,yt,He.posMatrix,bt,it,ai,pe.style.map.terrain?(Kt,li)=>pe.style.map.terrain.getElevation(He,Kt,li):null)}}}(L,b,M,C,M.layout.get("text-rotation-alignment"),M.layout.get("text-pitch-alignment"),O),M.paint.get("icon-opacity").constantOr(1)!==0&&cl(b,C,M,L,!1,M.paint.get("icon-translate"),M.paint.get("icon-translate-anchor"),M.layout.get("icon-rotation-alignment"),M.layout.get("icon-pitch-alignment"),M.layout.get("icon-keep-upright"),$,q),M.paint.get("text-opacity").constantOr(1)!==0&&cl(b,C,M,L,!0,M.paint.get("text-translate"),M.paint.get("text-translate-anchor"),M.layout.get("text-rotation-alignment"),M.layout.get("text-pitch-alignment"),M.layout.get("text-keep-upright"),$,q),C.map.showCollisionBoxes&&(sl(b,C,M,L,M.paint.get("text-translate"),M.paint.get("text-translate-anchor"),!0),sl(b,C,M,L,M.paint.get("icon-translate"),M.paint.get("icon-translate-anchor"),!1))})(o,h,p,m,this.style.placement.variableOffsets);break;case"circle":(function(b,C,M,L){if(b.renderPass!=="translucent")return;const O=M.paint.get("circle-opacity"),$=M.paint.get("circle-stroke-width"),q=M.paint.get("circle-stroke-opacity"),ee=!M.layout.get("circle-sort-key").isConstant();if(O.constantOr(1)===0&&($.constantOr(1)===0||q.constantOr(1)===0))return;const pe=b.context,fe=pe.gl,_e=b.depthModeForSublayer(0,Si.ReadOnly),ce=en.disabled,Ce=b.colorModeForRenderPass(),Ze=[];for(let be=0;be<L.length;be++){const Re=L[be],We=C.getTile(Re),He=We.getBucket(M);if(!He)continue;const Xe=He.programConfigurations.get(M.id),rt=b.useProgram("circle",Xe),it=He.layoutVertexBuffer,pt=He.indexBuffer,yt=b.style.map.terrain&&b.style.map.terrain.getTerrainData(Re),ai={programConfiguration:Xe,program:rt,layoutVertexBuffer:it,indexBuffer:pt,uniformValues:$d(b,Re,We,M),terrainData:yt};if(ee){const bt=He.segments.get();for(const Kt of bt)Ze.push({segments:new a.$([Kt]),sortKey:Kt.sortKey,state:ai})}else Ze.push({segments:He.segments,sortKey:0,state:ai})}ee&&Ze.sort((be,Re)=>be.sortKey-Re.sortKey);for(const be of Ze){const{programConfiguration:Re,program:We,layoutVertexBuffer:He,indexBuffer:Xe,uniformValues:rt,terrainData:it}=be.state;We.draw(pe,fe.TRIANGLES,_e,ce,Ce,Ji.disabled,rt,it,M.id,He,Xe,be.segments,M.paint,b.transform.zoom,Re)}})(o,h,p,m);break;case"heatmap":(function(b,C,M,L){if(M.paint.get("heatmap-opacity")!==0)if(b.renderPass==="offscreen"){const O=b.context,$=O.gl,q=en.disabled,ee=new In([$.ONE,$.ONE],a.aO.transparent,[!0,!0,!0,!0]);(function(pe,fe,_e){const ce=pe.gl;pe.activeTexture.set(ce.TEXTURE1),pe.viewport.set([0,0,fe.width/4,fe.height/4]);let Ce=_e.heatmapFbo;if(Ce)ce.bindTexture(ce.TEXTURE_2D,Ce.colorAttachment.get()),pe.bindFramebuffer.set(Ce.framebuffer);else{const Ze=ce.createTexture();ce.bindTexture(ce.TEXTURE_2D,Ze),ce.texParameteri(ce.TEXTURE_2D,ce.TEXTURE_WRAP_S,ce.CLAMP_TO_EDGE),ce.texParameteri(ce.TEXTURE_2D,ce.TEXTURE_WRAP_T,ce.CLAMP_TO_EDGE),ce.texParameteri(ce.TEXTURE_2D,ce.TEXTURE_MIN_FILTER,ce.LINEAR),ce.texParameteri(ce.TEXTURE_2D,ce.TEXTURE_MAG_FILTER,ce.LINEAR),Ce=_e.heatmapFbo=pe.createFramebuffer(fe.width/4,fe.height/4,!1,!1),function(be,Re,We,He){var Xe,rt;const it=be.gl,pt=(Xe=be.HALF_FLOAT)!==null&&Xe!==void 0?Xe:it.UNSIGNED_BYTE,yt=(rt=be.RGBA16F)!==null&&rt!==void 0?rt:it.RGBA;it.texImage2D(it.TEXTURE_2D,0,yt,Re.width/4,Re.height/4,0,it.RGBA,pt,null),He.colorAttachment.set(We)}(pe,fe,Ze,Ce)}})(O,b,M),O.clear({color:a.aO.transparent});for(let pe=0;pe<L.length;pe++){const fe=L[pe];if(C.hasRenderableParent(fe))continue;const _e=C.getTile(fe),ce=_e.getBucket(M);if(!ce)continue;const Ce=ce.programConfigurations.get(M.id),Ze=b.useProgram("heatmap",Ce),{zoom:be}=b.transform;Ze.draw(O,$.TRIANGLES,Si.disabled,q,ee,Ji.disabled,nh(fe.posMatrix,_e,be,M.paint.get("heatmap-intensity")),null,M.id,ce.layoutVertexBuffer,ce.indexBuffer,ce.segments,M.paint,b.transform.zoom,Ce)}O.viewport.set([0,0,b.width,b.height])}else b.renderPass==="translucent"&&(b.context.setColorMode(b.colorModeForRenderPass()),function(O,$){const q=O.context,ee=q.gl,pe=$.heatmapFbo;if(!pe)return;q.activeTexture.set(ee.TEXTURE0),ee.bindTexture(ee.TEXTURE_2D,pe.colorAttachment.get()),q.activeTexture.set(ee.TEXTURE1);let fe=$.colorRampTexture;fe||(fe=$.colorRampTexture=new re(q,$.colorRamp,ee.RGBA)),fe.bind(ee.LINEAR,ee.CLAMP_TO_EDGE),O.useProgram("heatmapTexture").draw(q,ee.TRIANGLES,Si.disabled,en.disabled,O.colorModeForRenderPass(),Ji.disabled,((_e,ce,Ce,Ze)=>{const be=a.F();a.aN(be,0,_e.width,_e.height,0,0,1);const Re=_e.context.gl;return{u_matrix:be,u_world:[Re.drawingBufferWidth,Re.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:ce.paint.get("heatmap-opacity")}})(O,$),null,$.id,O.viewportBuffer,O.quadTriangleIndexBuffer,O.viewportSegments,$.paint,O.transform.zoom)}(b,M))})(o,h,p,m);break;case"line":(function(b,C,M,L){if(b.renderPass!=="translucent")return;const O=M.paint.get("line-opacity"),$=M.paint.get("line-width");if(O.constantOr(1)===0||$.constantOr(1)===0)return;const q=b.depthModeForSublayer(0,Si.ReadOnly),ee=b.colorModeForRenderPass(),pe=M.paint.get("line-dasharray"),fe=M.paint.get("line-pattern"),_e=fe.constantOr(1),ce=M.paint.get("line-gradient"),Ce=M.getCrossfadeParameters(),Ze=_e?"linePattern":pe?"lineSDF":ce?"lineGradient":"line",be=b.context,Re=be.gl;let We=!0;for(const He of L){const Xe=C.getTile(He);if(_e&&!Xe.patternsLoaded())continue;const rt=Xe.getBucket(M);if(!rt)continue;const it=rt.programConfigurations.get(M.id),pt=b.context.program.get(),yt=b.useProgram(Ze,it),ai=We||yt.program!==pt,bt=b.style.map.terrain&&b.style.map.terrain.getTerrainData(He),Kt=fe.constantOr(null);if(Kt&&Xe.imageAtlas){const ii=Xe.imageAtlas,di=ii.patternPositions[Kt.to.toString()],mi=ii.patternPositions[Kt.from.toString()];di&&mi&&it.setConstantPatternPositions(di,mi)}const li=bt?He:null,Ti=_e?os(b,Xe,M,Ce,li):pe?Ja(b,Xe,M,pe,Ce,li):ce?oh(b,Xe,M,rt.lineClipsArray.length,li):Ka(b,Xe,M,li);if(_e)be.activeTexture.set(Re.TEXTURE0),Xe.imageAtlasTexture.bind(Re.LINEAR,Re.CLAMP_TO_EDGE),it.updatePaintBuffers(Ce);else if(pe&&(ai||b.lineAtlas.dirty))be.activeTexture.set(Re.TEXTURE0),b.lineAtlas.bind(be);else if(ce){const ii=rt.gradients[M.id];let di=ii.texture;if(M.gradientVersion!==ii.version){let mi=256;if(M.stepInterpolant){const wn=C.getSource().maxzoom,Vi=He.canonical.z===wn?Math.ceil(1<<b.transform.maxZoom-He.canonical.z):1;mi=a.ac(a.aT(rt.maxLineLength/a.W*1024*Vi),256,be.maxTextureSize)}ii.gradient=a.aU({expression:M.gradientExpression(),evaluationKey:"lineProgress",resolution:mi,image:ii.gradient||void 0,clips:rt.lineClipsArray}),ii.texture?ii.texture.update(ii.gradient):ii.texture=new re(be,ii.gradient,Re.RGBA),ii.version=M.gradientVersion,di=ii.texture}be.activeTexture.set(Re.TEXTURE0),di.bind(M.stepInterpolant?Re.NEAREST:Re.LINEAR,Re.CLAMP_TO_EDGE)}yt.draw(be,Re.TRIANGLES,q,b.stencilModeForClipping(He),ee,Ji.disabled,Ti,bt,M.id,rt.layoutVertexBuffer,rt.indexBuffer,rt.segments,M.paint,b.transform.zoom,it,rt.layoutVertexBuffer2),We=!1}})(o,h,p,m);break;case"fill":(function(b,C,M,L){const O=M.paint.get("fill-color"),$=M.paint.get("fill-opacity");if($.constantOr(1)===0)return;const q=b.colorModeForRenderPass(),ee=M.paint.get("fill-pattern"),pe=b.opaquePassEnabledForLayer()&&!ee.constantOr(1)&&O.constantOr(a.aO.transparent).a===1&&$.constantOr(0)===1?"opaque":"translucent";if(b.renderPass===pe){const fe=b.depthModeForSublayer(1,b.renderPass==="opaque"?Si.ReadWrite:Si.ReadOnly);gh(b,C,M,L,fe,q,!1)}if(b.renderPass==="translucent"&&M.paint.get("fill-antialias")){const fe=b.depthModeForSublayer(M.getPaintProperty("fill-outline-color")?2:0,Si.ReadOnly);gh(b,C,M,L,fe,q,!0)}})(o,h,p,m);break;case"fill-extrusion":(function(b,C,M,L){const O=M.paint.get("fill-extrusion-opacity");if(O!==0&&b.renderPass==="translucent"){const $=new Si(b.context.gl.LEQUAL,Si.ReadWrite,b.depthRangeFor3D);if(O!==1||M.paint.get("fill-extrusion-pattern").constantOr(1))hl(b,C,M,L,$,en.disabled,In.disabled),hl(b,C,M,L,$,b.stencilModeFor3D(),b.colorModeForRenderPass());else{const q=b.colorModeForRenderPass();hl(b,C,M,L,$,en.disabled,q)}}})(o,h,p,m);break;case"hillshade":(function(b,C,M,L){if(b.renderPass!=="offscreen"&&b.renderPass!=="translucent")return;const O=b.context,$=b.depthModeForSublayer(0,Si.ReadOnly),q=b.colorModeForRenderPass(),[ee,pe]=b.renderPass==="translucent"?b.stencilConfigForOverlap(L):[{},L];for(const fe of pe){const _e=C.getTile(fe);_e.needsHillshadePrepare!==void 0&&_e.needsHillshadePrepare&&b.renderPass==="offscreen"?Sc(b,_e,M,$,en.disabled,q):b.renderPass==="translucent"&&dl(b,fe,_e,M,$,ee[fe.overscaledZ],q)}O.viewport.set([0,0,b.width,b.height])})(o,h,p,m);break;case"raster":(function(b,C,M,L){if(b.renderPass!=="translucent"||M.paint.get("raster-opacity")===0||!L.length)return;const O=b.context,$=O.gl,q=C.getSource(),ee=b.useProgram("raster"),pe=b.colorModeForRenderPass(),[fe,_e]=q instanceof Ot?[{},L]:b.stencilConfigForOverlap(L),ce=_e[_e.length-1].overscaledZ,Ce=!b.options.moving;for(const Ze of _e){const be=b.depthModeForSublayer(Ze.overscaledZ-ce,M.paint.get("raster-opacity")===1?Si.ReadWrite:Si.ReadOnly,$.LESS),Re=C.getTile(Ze);Re.registerFadeDuration(M.paint.get("raster-fade-duration"));const We=C.findLoadedParent(Ze,0),He=_h(Re,We,C,M,b.transform,b.style.map.terrain);let Xe,rt;const it=M.paint.get("raster-resampling")==="nearest"?$.NEAREST:$.LINEAR;O.activeTexture.set($.TEXTURE0),Re.texture.bind(it,$.CLAMP_TO_EDGE,$.LINEAR_MIPMAP_NEAREST),O.activeTexture.set($.TEXTURE1),We?(We.texture.bind(it,$.CLAMP_TO_EDGE,$.LINEAR_MIPMAP_NEAREST),Xe=Math.pow(2,We.tileID.overscaledZ-Re.tileID.overscaledZ),rt=[Re.tileID.canonical.x*Xe%1,Re.tileID.canonical.y*Xe%1]):Re.texture.bind(it,$.CLAMP_TO_EDGE,$.LINEAR_MIPMAP_NEAREST);const pt=b.style.map.terrain&&b.style.map.terrain.getTerrainData(Ze),yt=pt?Ze:null,ai=yt?yt.posMatrix:b.transform.calculatePosMatrix(Ze.toUnwrapped(),Ce),bt=Ya(ai,rt||[0,0],Xe||1,He,M);q instanceof Ot?ee.draw(O,$.TRIANGLES,be,en.disabled,pe,Ji.disabled,bt,pt,M.id,q.boundsBuffer,b.quadTriangleIndexBuffer,q.boundsSegments):ee.draw(O,$.TRIANGLES,be,fe[Ze.overscaledZ],pe,Ji.disabled,bt,pt,M.id,b.rasterBoundsBuffer,b.quadTriangleIndexBuffer,b.rasterBoundsSegments)}})(o,h,p,m);break;case"background":(function(b,C,M,L){const O=M.paint.get("background-color"),$=M.paint.get("background-opacity");if($===0)return;const q=b.context,ee=q.gl,pe=b.transform,fe=pe.tileSize,_e=M.paint.get("background-pattern");if(b.isPatternMissing(_e))return;const ce=!_e&&O.a===1&&$===1&&b.opaquePassEnabledForLayer()?"opaque":"translucent";if(b.renderPass!==ce)return;const Ce=en.disabled,Ze=b.depthModeForSublayer(0,ce==="opaque"?Si.ReadWrite:Si.ReadOnly),be=b.colorModeForRenderPass(),Re=b.useProgram(_e?"backgroundPattern":"background"),We=L||pe.coveringTiles({tileSize:fe,terrain:b.style.map.terrain});_e&&(q.activeTexture.set(ee.TEXTURE0),b.imageManager.bind(b.context));const He=M.getCrossfadeParameters();for(const Xe of We){const rt=L?Xe.posMatrix:b.transform.calculatePosMatrix(Xe.toUnwrapped()),it=_e?Zd(rt,$,b,_e,{tileID:Xe,tileSize:fe},He):qd(rt,$,O),pt=b.style.map.terrain&&b.style.map.terrain.getTerrainData(Xe);Re.draw(q,ee.TRIANGLES,Ze,Ce,be,Ji.disabled,it,pt,M.id,b.tileExtentBuffer,b.quadTriangleIndexBuffer,b.tileExtentSegments)}})(o,0,p,m);break;case"custom":(function(b,C,M){const L=b.context,O=M.implementation;if(b.renderPass==="offscreen"){const $=O.prerender;$&&(b.setCustomLayerDefaults(),L.setColorMode(b.colorModeForRenderPass()),$.call(O,L.gl,b.transform.customLayerMatrix()),L.setDirty(),b.setBaseState())}else if(b.renderPass==="translucent"){b.setCustomLayerDefaults(),L.setColorMode(b.colorModeForRenderPass()),L.setStencilMode(en.disabled);const $=O.renderingMode==="3d"?new Si(b.context.gl.LEQUAL,Si.ReadWrite,b.depthRangeFor3D):b.depthModeForSublayer(0,Si.ReadOnly);L.setDepthMode($),O.render(L.gl,b.transform.customLayerMatrix()),L.setDirty(),b.setBaseState(),L.bindFramebuffer.set(null)}})(o,0,p)}}translatePosMatrix(o,h,p,m,b){if(!p[0]&&!p[1])return o;const C=b?m==="map"?this.transform.angle:0:m==="viewport"?-this.transform.angle:0;if(C){const O=Math.sin(C),$=Math.cos(C);p=[p[0]*$-p[1]*O,p[0]*O+p[1]*$]}const M=[b?p[0]:Xt(h,p[0],this.transform.zoom),b?p[1]:Xt(h,p[1],this.transform.zoom),0],L=new Float32Array(16);return a.H(L,o,M),L}saveTileTexture(o){const h=this._tileTextures[o.size[0]];h?h.push(o):this._tileTextures[o.size[0]]=[o]}getTileTexture(o){const h=this._tileTextures[o];return h&&h.length>0?h.pop():null}isPatternMissing(o){if(!o)return!1;if(!o.from||!o.to)return!0;const h=this.imageManager.getPattern(o.from.toString()),p=this.imageManager.getPattern(o.to.toString());return!h||!p}useProgram(o,h){this.cache=this.cache||{};const p=o+(h?h.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[p]||(this.cache[p]=new Wo(this.context,ha[o],h,sh[o],this._showOverdrawInspector,this.style.map.terrain)),this.cache[p]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const o=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(o.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new re(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:o,drawingBufferHeight:h}=this.context.gl;return this.width!==o||this.height!==h}}class Xo{constructor(o,h){this.points=o,this.planes=h}static fromInvProjectionMatrix(o,h,p){const m=Math.pow(2,p),b=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(M=>{const L=1/(M=a.af([],M,o))[3]/h*m;return a.a$(M,M,[L,L,1/M[3],L])}),C=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(M=>{const L=function(ee,pe){var fe=pe[0],_e=pe[1],ce=pe[2],Ce=fe*fe+_e*_e+ce*ce;return Ce>0&&(Ce=1/Math.sqrt(Ce)),ee[0]=pe[0]*Ce,ee[1]=pe[1]*Ce,ee[2]=pe[2]*Ce,ee}([],function(ee,pe,fe){var _e=pe[0],ce=pe[1],Ce=pe[2],Ze=fe[0],be=fe[1],Re=fe[2];return ee[0]=ce*Re-Ce*be,ee[1]=Ce*Ze-_e*Re,ee[2]=_e*be-ce*Ze,ee}([],Q([],b[M[0]],b[M[1]]),Q([],b[M[2]],b[M[1]]))),O=-(($=L)[0]*(q=b[M[1]])[0]+$[1]*q[1]+$[2]*q[2]);var $,q;return L.concat(O)});return new Xo(b,C)}}class Ko{constructor(o,h){this.min=o,this.max=h,this.center=function(p,m,b){return p[0]=.5*m[0],p[1]=.5*m[1],p[2]=.5*m[2],p}([],function(p,m,b){return p[0]=m[0]+b[0],p[1]=m[1]+b[1],p[2]=m[2]+b[2],p}([],this.min,this.max))}quadrant(o){const h=[o%2==0,o<2],p=he(this.min),m=he(this.max);for(let b=0;b<h.length;b++)p[b]=h[b]?this.min[b]:this.center[b],m[b]=h[b]?this.center[b]:this.max[b];return m[2]=this.max[2],new Ko(p,m)}distanceX(o){return Math.max(Math.min(this.max[0],o[0]),this.min[0])-o[0]}distanceY(o){return Math.max(Math.min(this.max[1],o[1]),this.min[1])-o[1]}intersects(o){const h=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let p=!0;for(let m=0;m<o.planes.length;m++){const b=o.planes[m];let C=0;for(let M=0;M<h.length;M++)a.b0(b,h[M])>=0&&C++;if(C===0)return 0;C!==h.length&&(p=!1)}if(p)return 2;for(let m=0;m<3;m++){let b=Number.MAX_VALUE,C=-Number.MAX_VALUE;for(let M=0;M<o.points.length;M++){const L=o.points[M][m]-this.min[m];b=Math.min(b,L),C=Math.max(C,L)}if(C<0||b>this.max[m]-this.min[m])return 0}return 1}}class Fs{constructor(o=0,h=0,p=0,m=0){if(isNaN(o)||o<0||isNaN(h)||h<0||isNaN(p)||p<0||isNaN(m)||m<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=o,this.bottom=h,this.left=p,this.right=m}interpolate(o,h,p){return h.top!=null&&o.top!=null&&(this.top=a.z.number(o.top,h.top,p)),h.bottom!=null&&o.bottom!=null&&(this.bottom=a.z.number(o.bottom,h.bottom,p)),h.left!=null&&o.left!=null&&(this.left=a.z.number(o.left,h.left,p)),h.right!=null&&o.right!=null&&(this.right=a.z.number(o.right,h.right,p)),this}getCenter(o,h){const p=a.ac((this.left+o-this.right)/2,0,o),m=a.ac((this.top+h-this.bottom)/2,0,h);return new a.P(p,m)}equals(o){return this.top===o.top&&this.bottom===o.bottom&&this.left===o.left&&this.right===o.right}clone(){return new Fs(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const Ec=85.051129;class ml{constructor(o,h,p,m,b){this.tileSize=512,this._renderWorldCopies=b===void 0||!!b,this._minZoom=o||0,this._maxZoom=h||22,this._minPitch=p??0,this._maxPitch=m??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new a.M(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Fs,this._posMatrixCache={},this._alignedPosMatrixCache={},this.minElevationForCurrentTile=0}clone(){const o=new ml(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return o.apply(this),o}apply(o){this.tileSize=o.tileSize,this.latRange=o.latRange,this.width=o.width,this.height=o.height,this._center=o._center,this._elevation=o._elevation,this.minElevationForCurrentTile=o.minElevationForCurrentTile,this.zoom=o.zoom,this.angle=o.angle,this._fov=o._fov,this._pitch=o._pitch,this._unmodified=o._unmodified,this._edgeInsets=o._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(o){this._minZoom!==o&&(this._minZoom=o,this.zoom=Math.max(this.zoom,o))}get maxZoom(){return this._maxZoom}set maxZoom(o){this._maxZoom!==o&&(this._maxZoom=o,this.zoom=Math.min(this.zoom,o))}get minPitch(){return this._minPitch}set minPitch(o){this._minPitch!==o&&(this._minPitch=o,this.pitch=Math.max(this.pitch,o))}get maxPitch(){return this._maxPitch}set maxPitch(o){this._maxPitch!==o&&(this._maxPitch=o,this.pitch=Math.min(this.pitch,o))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(o){o===void 0?o=!0:o===null&&(o=!1),this._renderWorldCopies=o}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new a.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(o){const h=-a.b1(o,-180,180)*Math.PI/180;this.angle!==h&&(this._unmodified=!1,this.angle=h,this._calcMatrices(),this.rotationMatrix=function(){var p=new a.A(4);return a.A!=Float32Array&&(p[1]=0,p[2]=0),p[0]=1,p[3]=1,p}(),function(p,m,b){var C=m[0],M=m[1],L=m[2],O=m[3],$=Math.sin(b),q=Math.cos(b);p[0]=C*q+L*$,p[1]=M*q+O*$,p[2]=C*-$+L*q,p[3]=M*-$+O*q}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(o){const h=a.ac(o,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==h&&(this._unmodified=!1,this._pitch=h,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(o){o=Math.max(.01,Math.min(60,o)),this._fov!==o&&(this._unmodified=!1,this._fov=o/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(o){const h=Math.min(Math.max(o,this.minZoom),this.maxZoom);this._zoom!==h&&(this._unmodified=!1,this._zoom=h,this.tileZoom=Math.max(0,Math.floor(h)),this.scale=this.zoomScale(h),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(o){o.lat===this._center.lat&&o.lng===this._center.lng||(this._unmodified=!1,this._center=o,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(o){o!==this._elevation&&(this._elevation=o,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(o){this._edgeInsets.equals(o)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,o,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(o){return this._edgeInsets.equals(o)}interpolatePadding(o,h,p){this._unmodified=!1,this._edgeInsets.interpolate(o,h,p),this._constrain(),this._calcMatrices()}coveringZoomLevel(o){const h=(o.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/o.tileSize));return Math.max(0,h)}getVisibleUnwrappedCoordinates(o){const h=[new a.b2(0,o)];if(this._renderWorldCopies){const p=this.pointCoordinate(new a.P(0,0)),m=this.pointCoordinate(new a.P(this.width,0)),b=this.pointCoordinate(new a.P(this.width,this.height)),C=this.pointCoordinate(new a.P(0,this.height)),M=Math.floor(Math.min(p.x,m.x,b.x,C.x)),L=Math.floor(Math.max(p.x,m.x,b.x,C.x)),O=1;for(let $=M-O;$<=L+O;$++)$!==0&&h.push(new a.b2($,o))}return h}coveringTiles(o){var h,p;let m=this.coveringZoomLevel(o);const b=m;if(o.minzoom!==void 0&&m<o.minzoom)return[];o.maxzoom!==void 0&&m>o.maxzoom&&(m=o.maxzoom);const C=this.pointCoordinate(this.getCameraPoint()),M=a.Y.fromLngLat(this.center),L=Math.pow(2,m),O=[L*C.x,L*C.y,0],$=[L*M.x,L*M.y,0],q=Xo.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,m);let ee=o.minzoom||0;!o.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(ee=m);const pe=o.terrain?2/Math.min(this.tileSize,o.tileSize)*this.tileSize:3,fe=be=>({aabb:new Ko([be*L,0,0],[(be+1)*L,L,0]),zoom:0,x:0,y:0,wrap:be,fullyVisible:!1}),_e=[],ce=[],Ce=m,Ze=o.reparseOverscaled?b:m;if(this._renderWorldCopies)for(let be=1;be<=3;be++)_e.push(fe(-be)),_e.push(fe(be));for(_e.push(fe(0));_e.length>0;){const be=_e.pop(),Re=be.x,We=be.y;let He=be.fullyVisible;if(!He){const yt=be.aabb.intersects(q);if(yt===0)continue;He=yt===2}const Xe=o.terrain?O:$,rt=be.aabb.distanceX(Xe),it=be.aabb.distanceY(Xe),pt=Math.max(Math.abs(rt),Math.abs(it));if(be.zoom===Ce||pt>pe+(1<<Ce-be.zoom)-2&&be.zoom>=ee){const yt=Ce-be.zoom,ai=O[0]-.5-(Re<<yt),bt=O[1]-.5-(We<<yt);ce.push({tileID:new a.Q(be.zoom===Ce?Ze:be.zoom,be.wrap,be.zoom,Re,We),distanceSq:ye([$[0]-.5-Re,$[1]-.5-We]),tileDistanceToCamera:Math.sqrt(ai*ai+bt*bt)})}else for(let yt=0;yt<4;yt++){const ai=(Re<<1)+yt%2,bt=(We<<1)+(yt>>1),Kt=be.zoom+1;let li=be.aabb.quadrant(yt);if(o.terrain){const Ti=new a.Q(Kt,be.wrap,Kt,ai,bt),ii=o.terrain.getMinMaxElevation(Ti),di=(h=ii.minElevation)!==null&&h!==void 0?h:this.elevation,mi=(p=ii.maxElevation)!==null&&p!==void 0?p:this.elevation;li=new Ko([li.min[0],li.min[1],di],[li.max[0],li.max[1],mi])}_e.push({aabb:li,zoom:Kt,x:ai,y:bt,wrap:be.wrap,fullyVisible:He})}}return ce.sort((be,Re)=>be.distanceSq-Re.distanceSq).map(be=>be.tileID)}resize(o,h){this.width=o,this.height=h,this.pixelsToGLUnits=[2/o,-2/h],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(o){return Math.pow(2,o)}scaleZoom(o){return Math.log(o)/Math.LN2}project(o){const h=a.ac(o.lat,-85.051129,Ec);return new a.P(a.N(o.lng)*this.worldSize,a.O(h)*this.worldSize)}unproject(o){return new a.Y(o.x/this.worldSize,o.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(o){const h=this.elevation,p=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,m=this.pointLocation(this.centerPoint,o),b=o.getElevationForLngLatZoom(m,this.tileZoom);if(!(this.elevation-b))return;const C=p+h-b,M=Math.cos(this._pitch)*this.cameraToCenterDistance/C/a.b3(1,m.lat),L=this.scaleZoom(M/this.tileSize);this._elevation=b,this._center=m,this.zoom=L}setLocationAtPoint(o,h){const p=this.pointCoordinate(h),m=this.pointCoordinate(this.centerPoint),b=this.locationCoordinate(o),C=new a.Y(b.x-(p.x-m.x),b.y-(p.y-m.y));this.center=this.coordinateLocation(C),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(o,h){return h?this.coordinatePoint(this.locationCoordinate(o),h.getElevationForLngLatZoom(o,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(o))}pointLocation(o,h){return this.coordinateLocation(this.pointCoordinate(o,h))}locationCoordinate(o){return a.Y.fromLngLat(o)}coordinateLocation(o){return o&&o.toLngLat()}pointCoordinate(o,h){if(h){const ee=h.pointCoordinate(o);if(ee!=null)return ee}const p=[o.x,o.y,0,1],m=[o.x,o.y,1,1];a.af(p,p,this.pixelMatrixInverse),a.af(m,m,this.pixelMatrixInverse);const b=p[3],C=m[3],M=p[1]/b,L=m[1]/C,O=p[2]/b,$=m[2]/C,q=O===$?0:(0-O)/($-O);return new a.Y(a.z.number(p[0]/b,m[0]/C,q)/this.worldSize,a.z.number(M,L,q)/this.worldSize)}coordinatePoint(o,h=0,p=this.pixelMatrix){const m=[o.x*this.worldSize,o.y*this.worldSize,h,1];return a.af(m,m,p),new a.P(m[0]/m[3],m[1]/m[3])}getBounds(){const o=Math.max(0,this.height/2-this.getHorizon());return new je().extend(this.pointLocation(new a.P(0,o))).extend(this.pointLocation(new a.P(this.width,o))).extend(this.pointLocation(new a.P(this.width,this.height))).extend(this.pointLocation(new a.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new je([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(o){o?(this.lngRange=[o.getWest(),o.getEast()],this.latRange=[o.getSouth(),o.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,Ec])}calculatePosMatrix(o,h=!1){const p=o.key,m=h?this._alignedPosMatrixCache:this._posMatrixCache;if(m[p])return m[p];const b=o.canonical,C=this.worldSize/this.zoomScale(b.z),M=b.x+Math.pow(2,b.z)*o.wrap,L=a.an(new Float64Array(16));return a.H(L,L,[M*C,b.y*C,0]),a.J(L,L,[C/a.W,C/a.W,1]),a.K(L,h?this.alignedProjMatrix:this.projMatrix,L),m[p]=new Float32Array(L),m[p]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(o,h){h=a.ac(+h,this.minZoom,this.maxZoom);const p={center:new a.M(o.lng,o.lat),zoom:h};let m=this.lngRange;if(!this._renderWorldCopies&&m===null){const be=179.9999999999;m=[-be,be]}const b=this.tileSize*this.zoomScale(p.zoom);let C=0,M=b,L=0,O=b,$=0,q=0;const{x:ee,y:pe}=this.size;if(this.latRange){const be=this.latRange;C=a.O(be[1])*b,M=a.O(be[0])*b,M-C<pe&&($=pe/(M-C))}m&&(L=a.b1(a.N(m[0])*b,0,b),O=a.b1(a.N(m[1])*b,0,b),O<L&&(O+=b),O-L<ee&&(q=ee/(O-L)));const{x:fe,y:_e}=this.project.call({worldSize:b},o);let ce,Ce;const Ze=Math.max(q||0,$||0);if(Ze){const be=new a.P(q?(O+L)/2:fe,$?(M+C)/2:_e);return p.center=this.unproject.call({worldSize:b},be).wrap(),p.zoom+=this.scaleZoom(Ze),p}if(this.latRange){const be=pe/2;_e-be<C&&(Ce=C+be),_e+be>M&&(Ce=M-be)}if(m){const be=(L+O)/2;let Re=fe;this._renderWorldCopies&&(Re=a.b1(fe,be-b/2,be+b/2));const We=ee/2;Re-We<L&&(ce=L+We),Re+We>O&&(ce=O-We)}if(ce!==void 0||Ce!==void 0){const be=new a.P(ce??fe,Ce??_e);p.center=this.unproject.call({worldSize:b},be).wrap()}return p}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const o=this._unmodified,{center:h,zoom:p}=this.getConstrained(this.center,this.zoom);this.center=h,this.zoom=p,this._unmodified=o,this._constraining=!1}_calcMatrices(){if(!this.height)return;const o=this.centerOffset,h=this.point.x,p=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=a.b3(1,this.center.lat)*this.worldSize;let m=a.an(new Float64Array(16));a.J(m,m,[this.width/2,-this.height/2,1]),a.H(m,m,[1,-1,0]),this.labelPlaneMatrix=m,m=a.an(new Float64Array(16)),a.J(m,m,[1,-1,1]),a.H(m,m,[-1,-1,0]),a.J(m,m,[2/this.width,2/this.height,1]),this.glCoordMatrix=m;const b=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),C=Math.min(this.elevation,this.minElevationForCurrentTile),M=b-C*this._pixelPerMeter/Math.cos(this._pitch),L=C<0?M:b,O=Math.PI/2+this._pitch,$=this._fov*(.5+o.y/this.height),q=Math.sin($)*L/Math.sin(a.ac(Math.PI-O-$,.01,Math.PI-.01)),ee=this.getHorizon(),pe=2*Math.atan(ee/this.cameraToCenterDistance)*(.5+o.y/(2*ee)),fe=Math.sin(pe)*L/Math.sin(a.ac(Math.PI-O-pe,.01,Math.PI-.01)),_e=Math.min(q,fe),ce=1.01*(Math.cos(Math.PI/2-this._pitch)*_e+L),Ce=this.height/50;m=new Float64Array(16),a.b4(m,this._fov,this.width/this.height,Ce,ce),m[8]=2*-o.x/this.width,m[9]=2*o.y/this.height,a.J(m,m,[1,-1,1]),a.H(m,m,[0,0,-this.cameraToCenterDistance]),a.b5(m,m,this._pitch),a.ad(m,m,this.angle),a.H(m,m,[-h,-p,0]),this.mercatorMatrix=a.J([],m,[this.worldSize,this.worldSize,this.worldSize]),a.J(m,m,[1,1,this._pixelPerMeter]),this.pixelMatrix=a.K(new Float64Array(16),this.labelPlaneMatrix,m),a.H(m,m,[0,0,-this.elevation]),this.projMatrix=m,this.invProjMatrix=a.ar([],m),this.pixelMatrix3D=a.K(new Float64Array(16),this.labelPlaneMatrix,m);const Ze=this.width%2/2,be=this.height%2/2,Re=Math.cos(this.angle),We=Math.sin(this.angle),He=h-Math.round(h)+Re*Ze+We*be,Xe=p-Math.round(p)+Re*be+We*Ze,rt=new Float64Array(m);if(a.H(rt,rt,[He>.5?He-1:He,Xe>.5?Xe-1:Xe,0]),this.alignedProjMatrix=rt,m=a.ar(new Float64Array(16),this.pixelMatrix),!m)throw new Error("failed to invert matrix");this.pixelMatrixInverse=m,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const o=this.pointCoordinate(new a.P(0,0)),h=[o.x*this.worldSize,o.y*this.worldSize,0,1];return a.af(h,h,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const o=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new a.P(0,o))}getCameraQueryGeometry(o){const h=this.getCameraPoint();if(o.length===1)return[o[0],h];{let p=h.x,m=h.y,b=h.x,C=h.y;for(const M of o)p=Math.min(p,M.x),m=Math.min(m,M.y),b=Math.max(b,M.x),C=Math.max(C,M.y);return[new a.P(p,m),new a.P(b,m),new a.P(b,C),new a.P(p,C),new a.P(p,m)]}}lngLatToCameraDepth(o,h){const p=this.locationCoordinate(o),m=[p.x*this.worldSize,p.y*this.worldSize,h,1];return a.af(m,m,this.projMatrix),m[2]/m[3]}}function Mc(y,o){let h,p=!1,m=null,b=null;const C=()=>{m=null,p&&(y.apply(b,h),m=setTimeout(C,o),p=!1)};return(...M)=>(p=!0,b=this,h=M,m||C(),m)}class Ic{constructor(o){this._getCurrentHash=()=>{const h=window.location.hash.replace("#","");if(this._hashName){let p;return h.split("&").map(m=>m.split("=")).forEach(m=>{m[0]===this._hashName&&(p=m)}),(p&&p[1]||"").split("/")}return h.split("/")},this._onHashChange=()=>{const h=this._getCurrentHash();if(h.length>=3&&!h.some(p=>isNaN(p))){const p=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(h[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+h[2],+h[1]],zoom:+h[0],bearing:p,pitch:+(h[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const h=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,h)}catch{}},this._updateHash=Mc(this._updateHashUnthrottled,300),this._hashName=o&&encodeURIComponent(o)}addTo(o){return this._map=o,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(o){const h=this._map.getCenter(),p=Math.round(100*this._map.getZoom())/100,m=Math.ceil((p*Math.LN2+Math.log(512/360/.5))/Math.LN10),b=Math.pow(10,m),C=Math.round(h.lng*b)/b,M=Math.round(h.lat*b)/b,L=this._map.getBearing(),O=this._map.getPitch();let $="";if($+=o?`/${C}/${M}/${p}`:`${p}/${M}/${C}`,(L||O)&&($+="/"+Math.round(10*L)/10),O&&($+=`/${Math.round(O)}`),this._hashName){const q=this._hashName;let ee=!1;const pe=window.location.hash.slice(1).split("&").map(fe=>{const _e=fe.split("=")[0];return _e===q?(ee=!0,`${_e}=${$}`):fe}).filter(fe=>fe);return ee||pe.push(`${q}=${$}`),`#${pe.join("&")}`}return`#${$}`}}const va={linearity:.3,easing:a.b6(0,0,.3,1)},cs=a.e({deceleration:2500,maxSpeed:1400},va),wh=a.e({deceleration:20,maxSpeed:1400},va),xh=a.e({deceleration:1e3,maxSpeed:360},va),kh=a.e({deceleration:1e3,maxSpeed:90},va);class Sh{constructor(o){this._map=o,this.clear()}clear(){this._inertiaBuffer=[]}record(o){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:S.now(),settings:o})}_drainInertiaBuffer(){const o=this._inertiaBuffer,h=S.now();for(;o.length>0&&h-o[0].time>160;)o.shift()}_onMoveEnd(o){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const h={zoom:0,bearing:0,pitch:0,pan:new a.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:b}of this._inertiaBuffer)h.zoom+=b.zoomDelta||0,h.bearing+=b.bearingDelta||0,h.pitch+=b.pitchDelta||0,b.panDelta&&h.pan._add(b.panDelta),b.around&&(h.around=b.around),b.pinchAround&&(h.pinchAround=b.pinchAround);const p=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,m={};if(h.pan.mag()){const b=wa(h.pan.mag(),p,a.e({},cs,o||{}));m.offset=h.pan.mult(b.amount/h.pan.mag()),m.center=this._map.transform.center,ba(m,b)}if(h.zoom){const b=wa(h.zoom,p,wh);m.zoom=this._map.transform.zoom+b.amount,ba(m,b)}if(h.bearing){const b=wa(h.bearing,p,xh);m.bearing=this._map.transform.bearing+a.ac(b.amount,-179,179),ba(m,b)}if(h.pitch){const b=wa(h.pitch,p,kh);m.pitch=this._map.transform.pitch+b.amount,ba(m,b)}if(m.zoom||m.bearing){const b=h.pinchAround===void 0?h.around:h.pinchAround;m.around=b?this._map.unproject(b):this._map.getCenter()}return this.clear(),a.e(m,{noMoveStart:!0})}}function ba(y,o){(!y.duration||y.duration<o.duration)&&(y.duration=o.duration,y.easing=o.easing)}function wa(y,o,h){const{maxSpeed:p,linearity:m,deceleration:b}=h,C=a.ac(y*m/(o/1e3),-p,p),M=Math.abs(C)/(b*m);return{easing:h.easing,duration:1e3*M,amount:C*(M/2)}}class kr extends a.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,h,p,m={}){const b=E.mousePos(h.getCanvas(),p),C=h.unproject(b);super(o,a.e({point:b,lngLat:C,originalEvent:p},m)),this._defaultPrevented=!1,this.target=h}}class yo extends a.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,h,p){const m=o==="touchend"?p.changedTouches:p.touches,b=E.touchPos(h.getCanvasContainer(),m),C=b.map(L=>h.unproject(L)),M=b.reduce((L,O,$,q)=>L.add(O.div(q.length)),new a.P(0,0));super(o,{points:b,point:M,lngLats:C,lngLat:h.unproject(M),originalEvent:p}),this._defaultPrevented=!1}}class Lc extends a.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,h,p){super(o,{originalEvent:p}),this._defaultPrevented=!1}}class ro{constructor(o,h){this._map=o,this._clickTolerance=h.clickTolerance}reset(){delete this._mousedownPos}wheel(o){return this._firePreventable(new Lc(o.type,this._map,o))}mousedown(o,h){return this._mousedownPos=h,this._firePreventable(new kr(o.type,this._map,o))}mouseup(o){this._map.fire(new kr(o.type,this._map,o))}click(o,h){this._mousedownPos&&this._mousedownPos.dist(h)>=this._clickTolerance||this._map.fire(new kr(o.type,this._map,o))}dblclick(o){return this._firePreventable(new kr(o.type,this._map,o))}mouseover(o){this._map.fire(new kr(o.type,this._map,o))}mouseout(o){this._map.fire(new kr(o.type,this._map,o))}touchstart(o){return this._firePreventable(new yo(o.type,this._map,o))}touchmove(o){this._map.fire(new yo(o.type,this._map,o))}touchend(o){this._map.fire(new yo(o.type,this._map,o))}touchcancel(o){this._map.fire(new yo(o.type,this._map,o))}_firePreventable(o){if(this._map.fire(o),o.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class vo{constructor(o){this._map=o}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(o){this._map.fire(new kr(o.type,this._map,o))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new kr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(o){this._delayContextMenu?this._contextMenuEvent=o:this._ignoreContextMenu||this._map.fire(new kr(o.type,this._map,o)),this._map.listens("contextmenu")&&o.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Os{constructor(o){this._map=o}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(o){return this.transform.pointLocation(a.P.convert(o),this._map.terrain)}}class oo{constructor(o,h){this._map=o,this._tr=new Os(o),this._el=o.getCanvasContainer(),this._container=o.getContainer(),this._clickTolerance=h.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(o,h){this.isEnabled()&&o.shiftKey&&o.button===0&&(E.disableDrag(),this._startPos=this._lastPos=h,this._active=!0)}mousemoveWindow(o,h){if(!this._active)return;const p=h;if(this._lastPos.equals(p)||!this._box&&p.dist(this._startPos)<this._clickTolerance)return;const m=this._startPos;this._lastPos=p,this._box||(this._box=E.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",o));const b=Math.min(m.x,p.x),C=Math.max(m.x,p.x),M=Math.min(m.y,p.y),L=Math.max(m.y,p.y);E.setTransform(this._box,`translate(${b}px,${M}px)`),this._box.style.width=C-b+"px",this._box.style.height=L-M+"px"}mouseupWindow(o,h){if(!this._active||o.button!==0)return;const p=this._startPos,m=h;if(this.reset(),E.suppressClick(),p.x!==m.x||p.y!==m.y)return this._map.fire(new a.k("boxzoomend",{originalEvent:o})),{cameraAnimation:b=>b.fitScreenCoordinates(p,m,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",o)}keydown(o){this._active&&o.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",o))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(E.remove(this._box),this._box=null),E.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(o,h){return this._map.fire(new a.k(o,{originalEvent:h}))}}function us(y,o){if(y.length!==o.length)throw new Error(`The number of touches and points are not equal - touches ${y.length}, points ${o.length}`);const h={};for(let p=0;p<y.length;p++)h[y[p].identifier]=o[p];return h}class nf{constructor(o){this.reset(),this.numTouches=o.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(o,h,p){(this.centroid||p.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=o.timeStamp),p.length===this.numTouches&&(this.centroid=function(m){const b=new a.P(0,0);for(const C of m)b._add(C);return b.div(m.length)}(h),this.touches=us(p,h)))}touchmove(o,h,p){if(this.aborted||!this.centroid)return;const m=us(p,h);for(const b in this.touches){const C=m[b];(!C||C.dist(this.touches[b])>30)&&(this.aborted=!0)}}touchend(o,h,p){if((!this.centroid||o.timeStamp-this.startTime>500)&&(this.aborted=!0),p.length===0){const m=!this.aborted&&this.centroid;if(this.reset(),m)return m}}}class Ac{constructor(o){this.singleTap=new nf(o),this.numTaps=o.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(o,h,p){this.singleTap.touchstart(o,h,p)}touchmove(o,h,p){this.singleTap.touchmove(o,h,p)}touchend(o,h,p){const m=this.singleTap.touchend(o,h,p);if(m){const b=o.timeStamp-this.lastTime<500,C=!this.lastTap||this.lastTap.dist(m)<30;if(b&&C||this.reset(),this.count++,this.lastTime=o.timeStamp,this.lastTap=m,this.count===this.numTaps)return this.reset(),m}}}class rf{constructor(o){this._tr=new Os(o),this._zoomIn=new Ac({numTouches:1,numTaps:2}),this._zoomOut=new Ac({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(o,h,p){this._zoomIn.touchstart(o,h,p),this._zoomOut.touchstart(o,h,p)}touchmove(o,h,p){this._zoomIn.touchmove(o,h,p),this._zoomOut.touchmove(o,h,p)}touchend(o,h,p){const m=this._zoomIn.touchend(o,h,p),b=this._zoomOut.touchend(o,h,p),C=this._tr;return m?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:M=>M.easeTo({duration:300,zoom:C.zoom+1,around:C.unproject(m)},{originalEvent:o})}):b?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:M=>M.easeTo({duration:300,zoom:C.zoom-1,around:C.unproject(b)},{originalEvent:o})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ns{constructor(o){this._enabled=!!o.enable,this._moveStateManager=o.moveStateManager,this._clickTolerance=o.clickTolerance||1,this._moveFunction=o.move,this._activateOnStart=!!o.activateOnStart,o.assignEvents(this),this.reset()}reset(o){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(o)}_move(...o){const h=this._moveFunction(...o);if(h.bearingDelta||h.pitchDelta||h.around||h.panDelta)return this._active=!0,h}dragStart(o,h){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(o)&&(this._moveStateManager.startMove(o),this._lastPoint=h.length?h[0]:h,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(o,h){if(!this.isEnabled())return;const p=this._lastPoint;if(!p)return;if(o.preventDefault(),!this._moveStateManager.isValidMoveEvent(o))return void this.reset(o);const m=h.length?h[0]:h;return!this._moved&&m.dist(p)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=m,this._move(p,m))}dragEnd(o){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(o)&&(this._moved&&E.suppressClick(),this.reset(o))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const xa={0:1,2:2};class bo{constructor(o){this._correctEvent=o.checkCorrectEvent}startMove(o){const h=E.mouseButton(o);this._eventButton=h}endMove(o){delete this._eventButton}isValidStartEvent(o){return this._correctEvent(o)}isValidMoveEvent(o){return!function(h,p){const m=xa[p];return h.buttons===void 0||(h.buttons&m)!==m}(o,this._eventButton)}isValidEndEvent(o){return E.mouseButton(o)===this._eventButton}}class Lt{constructor(){this._firstTouch=void 0}_isOneFingerTouch(o){return o.targetTouches.length===1}_isSameTouchEvent(o){return o.targetTouches[0].identifier===this._firstTouch}startMove(o){this._firstTouch=o.targetTouches[0].identifier}endMove(o){delete this._firstTouch}isValidStartEvent(o){return this._isOneFingerTouch(o)}isValidMoveEvent(o){return this._isOneFingerTouch(o)&&this._isSameTouchEvent(o)}isValidEndEvent(o){return this._isOneFingerTouch(o)&&this._isSameTouchEvent(o)}}const gl=y=>{y.mousedown=y.dragStart,y.mousemoveWindow=y.dragMove,y.mouseup=y.dragEnd,y.contextmenu=function(o){o.preventDefault()}},js=({enable:y,clickTolerance:o,bearingDegreesPerPixelMoved:h=.8})=>{const p=new bo({checkCorrectEvent:m=>E.mouseButton(m)===0&&m.ctrlKey||E.mouseButton(m)===2});return new Ns({clickTolerance:o,move:(m,b)=>({bearingDelta:(b.x-m.x)*h}),moveStateManager:p,enable:y,assignEvents:gl})},Us=({enable:y,clickTolerance:o,pitchDegreesPerPixelMoved:h=-.5})=>{const p=new bo({checkCorrectEvent:m=>E.mouseButton(m)===0&&m.ctrlKey||E.mouseButton(m)===2});return new Ns({clickTolerance:o,move:(m,b)=>({pitchDelta:(b.y-m.y)*h}),moveStateManager:p,enable:y,assignEvents:gl})};class Th{constructor(o,h){this._clickTolerance=o.clickTolerance||1,this._map=h,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new a.P(0,0)}minTouchs(){return this._map.cooperativeGestures.isEnabled()?2:1}touchstart(o,h,p){return this._calculateTransform(o,h,p)}touchmove(o,h,p){if(this._active&&!(p.length<this.minTouchs()))return o.preventDefault(),this._calculateTransform(o,h,p)}touchend(o,h,p){this._calculateTransform(o,h,p),this._active&&p.length<this.minTouchs()&&this.reset()}touchcancel(){this.reset()}_calculateTransform(o,h,p){p.length>0&&(this._active=!0);const m=us(p,h),b=new a.P(0,0),C=new a.P(0,0);let M=0;for(const O in m){const $=m[O],q=this._touches[O];q&&(b._add($),C._add($.sub(q)),M++,m[O]=$)}if(this._touches=m,M<this.minTouchs()||!C.mag())return;const L=C.div(M);return this._sum._add(L),this._sum.mag()<this._clickTolerance?void 0:{around:b.div(M),panDelta:L}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ct{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(o,h,p){this._firstTwoTouches||p.length<2||(this._firstTwoTouches=[p[0].identifier,p[1].identifier],this._start([h[0],h[1]]))}touchmove(o,h,p){if(!this._firstTwoTouches)return;o.preventDefault();const[m,b]=this._firstTwoTouches,C=Vs(p,h,m),M=Vs(p,h,b);if(!C||!M)return;const L=this._aroundCenter?null:C.add(M).div(2);return this._move([C,M],L,o)}touchend(o,h,p){if(!this._firstTwoTouches)return;const[m,b]=this._firstTwoTouches,C=Vs(p,h,m),M=Vs(p,h,b);C&&M||(this._active&&E.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(o){this._enabled=!0,this._aroundCenter=!!o&&o.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Vs(y,o,h){for(let p=0;p<y.length;p++)if(y[p].identifier===h)return o[p]}function Ch(y,o){return Math.log(y/o)/Math.LN2}class Eh extends Ct{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(o){this._startDistance=this._distance=o[0].dist(o[1])}_move(o,h){const p=this._distance;if(this._distance=o[0].dist(o[1]),this._active||!(Math.abs(Ch(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Ch(this._distance,p),pinchAround:h}}}function _l(y,o){return 180*y.angleWith(o)/Math.PI}class Pc extends Ct{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(o){this._startVector=this._vector=o[0].sub(o[1]),this._minDiameter=o[0].dist(o[1])}_move(o,h,p){const m=this._vector;if(this._vector=o[0].sub(o[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:_l(this._vector,m),pinchAround:h}}_isBelowThreshold(o){this._minDiameter=Math.min(this._minDiameter,o.mag());const h=25/(Math.PI*this._minDiameter)*360,p=_l(o,this._startVector);return Math.abs(p)<h}}function yl(y){return Math.abs(y.y)>Math.abs(y.x)}class Mh extends Ct{constructor(o){super(),this._currentTouchCount=0,this._map=o}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(o,h,p){super.touchstart(o,h,p),this._currentTouchCount=p.length}_start(o){this._lastPoints=o,yl(o[0].sub(o[1]))&&(this._valid=!1)}_move(o,h,p){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const m=o[0].sub(this._lastPoints[0]),b=o[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(m,b,p.timeStamp),this._valid?(this._lastPoints=o,this._active=!0,{pitchDelta:(m.y+b.y)/2*-.5}):void 0}gestureBeginsVertically(o,h,p){if(this._valid!==void 0)return this._valid;const m=o.mag()>=2,b=h.mag()>=2;if(!m&&!b)return;if(!m||!b)return this._firstMove===void 0&&(this._firstMove=p),p-this._firstMove<100&&void 0;const C=o.y>0==h.y>0;return yl(o)&&yl(h)&&C}}const of={panStep:100,bearingStep:15,pitchStep:10};class Jo{constructor(o){this._tr=new Os(o);const h=of;this._panStep=h.panStep,this._bearingStep=h.bearingStep,this._pitchStep=h.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(o){if(o.altKey||o.ctrlKey||o.metaKey)return;let h=0,p=0,m=0,b=0,C=0;switch(o.keyCode){case 61:case 107:case 171:case 187:h=1;break;case 189:case 109:case 173:h=-1;break;case 37:o.shiftKey?p=-1:(o.preventDefault(),b=-1);break;case 39:o.shiftKey?p=1:(o.preventDefault(),b=1);break;case 38:o.shiftKey?m=1:(o.preventDefault(),C=-1);break;case 40:o.shiftKey?m=-1:(o.preventDefault(),C=1);break;default:return}return this._rotationDisabled&&(p=0,m=0),{cameraAnimation:M=>{const L=this._tr;M.easeTo({duration:300,easeId:"keyboardHandler",easing:an,zoom:h?Math.round(L.zoom)+h*(o.shiftKey?2:1):L.zoom,bearing:L.bearing+p*this._bearingStep,pitch:L.pitch+m*this._pitchStep,offset:[-b*this._panStep,-C*this._panStep],center:L.center},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function an(y){return y*(2-y)}const ka=4.000244140625;class vl{constructor(o,h){this._onTimeout=p=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(p)},this._map=o,this._tr=new Os(o),this._triggerRenderFrame=h,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(o){this._defaultZoomRate=o}setWheelZoomRate(o){this._wheelZoomRate=o}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(o){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!o&&o.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(o){if(!this.isEnabled()||this._map.cooperativeGestures.isEnabled()&&!o[this._map.cooperativeGestures._bypassKey])return;let h=o.deltaMode===WheelEvent.DOM_DELTA_LINE?40*o.deltaY:o.deltaY;const p=S.now(),m=p-(this._lastWheelEventTime||0);this._lastWheelEventTime=p,h!==0&&h%ka==0?this._type="wheel":h!==0&&Math.abs(h)<4?this._type="trackpad":m>400?(this._type=null,this._lastValue=h,this._timeout=setTimeout(this._onTimeout,40,o)):this._type||(this._type=Math.abs(m*h)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,h+=this._lastValue)),o.shiftKey&&h&&(h/=4),this._type&&(this._lastWheelEvent=o,this._delta-=h,this._active||this._start(o)),o.preventDefault()}_start(o){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const h=E.mousePos(this._map.getCanvas(),o),p=this._tr;this._around=h.y>p.transform.height/2-p.transform.getHorizon()?a.M.convert(this._aroundCenter?p.center:p.unproject(h)):a.M.convert(p.center),this._aroundPoint=p.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const o=this._tr.transform;if(this._delta!==0){const M=this._type==="wheel"&&Math.abs(this._delta)>ka?this._wheelZoomRate:this._defaultZoomRate;let L=2/(1+Math.exp(-Math.abs(this._delta*M)));this._delta<0&&L!==0&&(L=1/L);const O=typeof this._targetZoom=="number"?o.zoomScale(this._targetZoom):o.scale;this._targetZoom=Math.min(o.maxZoom,Math.max(o.minZoom,o.scaleZoom(O*L))),this._type==="wheel"&&(this._startZoom=o.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const h=typeof this._targetZoom=="number"?this._targetZoom:o.zoom,p=this._startZoom,m=this._easing;let b,C=!1;if(this._type==="wheel"&&p&&m){const M=Math.min((S.now()-this._lastWheelEventTime)/200,1),L=m(M);b=a.z.number(p,h,L),M<1?this._frameId||(this._frameId=!0):C=!0}else b=h,C=!0;return this._active=!0,C&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!C,zoomDelta:b-o.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(o){let h=a.b7;if(this._prevEase){const p=this._prevEase,m=(S.now()-p.start)/p.duration,b=p.easing(m+.01)-p.easing(m),C=.27/Math.sqrt(b*b+1e-4)*.01,M=Math.sqrt(.0729-C*C);h=a.b6(C,M,.25,1)}return this._prevEase={start:S.now(),duration:o,easing:h},h}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class zc{constructor(o,h){this._clickZoom=o,this._tapZoom=h}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Ih{constructor(o){this._tr=new Os(o),this.reset()}reset(){this._active=!1}dblclick(o,h){return o.preventDefault(),{cameraAnimation:p=>{p.easeTo({duration:300,zoom:this._tr.zoom+(o.shiftKey?-1:1),around:this._tr.unproject(h)},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Lh{constructor(){this._tap=new Ac({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(o,h,p){if(!this._swipePoint)if(this._tapTime){const m=h[0],b=o.timeStamp-this._tapTime<500,C=this._tapPoint.dist(m)<30;b&&C?p.length>0&&(this._swipePoint=m,this._swipeTouch=p[0].identifier):this.reset()}else this._tap.touchstart(o,h,p)}touchmove(o,h,p){if(this._tapTime){if(this._swipePoint){if(p[0].identifier!==this._swipeTouch)return;const m=h[0],b=m.y-this._swipePoint.y;return this._swipePoint=m,o.preventDefault(),this._active=!0,{zoomDelta:b/128}}}else this._tap.touchmove(o,h,p)}touchend(o,h,p){if(this._tapTime)this._swipePoint&&p.length===0&&this.reset();else{const m=this._tap.touchend(o,h,p);m&&(this._tapTime=o.timeStamp,this._tapPoint=m)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ah{constructor(o,h,p){this._el=o,this._mousePan=h,this._touchPan=p}enable(o){this._inertiaOptions=o||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class so{constructor(o,h,p){this._pitchWithRotate=o.pitchWithRotate,this._mouseRotate=h,this._mousePitch=p}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Sa{constructor(o,h,p,m){this._el=o,this._touchZoom=h,this._touchRotate=p,this._tapDragZoom=m,this._rotationDisabled=!1,this._enabled=!0}enable(o){this._touchZoom.enable(o),this._rotationDisabled||this._touchRotate.enable(o),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class $t{constructor(o,h){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=o,this._options=h,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const o=this._map.getCanvasContainer();o.classList.add("maplibregl-cooperative-gestures"),this._container=E.create("div","maplibregl-cooperative-gesture-screen",o);let h=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(h=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const p=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),m=document.createElement("div");m.className="maplibregl-desktop-message",m.textContent=h,this._container.appendChild(m);const b=document.createElement("div");b.className="maplibregl-mobile-message",b.textContent=p,this._container.appendChild(b),this._container.setAttribute("aria-hidden","true")}_destoryUI(){this._container&&(E.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destoryUI()}isEnabled(){return this._enabled}touchmove(o){this._onCooperativeGesture(o.touches.length===1)}wheel(o){this._map.scrollZoom.isEnabled()&&this._onCooperativeGesture(!o[this._bypassKey])}_onCooperativeGesture(o){this._enabled&&o&&(this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const Gt=y=>y.zoom||y.drag||y.pitch||y.rotate;class bl extends a.k{}function Ta(y){return y.panDelta&&y.panDelta.mag()||y.zoomDelta||y.bearingDelta||y.pitchDelta}class Dc{constructor(o,h){this.handleWindowEvent=m=>{this.handleEvent(m,`${m.type}Window`)},this.handleEvent=(m,b)=>{if(m.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const C=m.type==="renderFrame"?void 0:m,M={needsRenderFrame:!1},L={},O={},$=m.touches,q=$?this._getMapTouches($):void 0,ee=q?E.touchPos(this._map.getCanvas(),q):E.mousePos(this._map.getCanvas(),m);for(const{handlerName:_e,handler:ce,allowed:Ce}of this._handlers){if(!ce.isEnabled())continue;let Ze;this._blockedByActive(O,Ce,_e)?ce.reset():ce[b||m.type]&&(Ze=ce[b||m.type](m,ee,q),this.mergeHandlerResult(M,L,Ze,_e,C),Ze&&Ze.needsRenderFrame&&this._triggerRenderFrame()),(Ze||ce.isActive())&&(O[_e]=ce)}const pe={};for(const _e in this._previousActiveHandlers)O[_e]||(pe[_e]=C);this._previousActiveHandlers=O,(Object.keys(pe).length||Ta(M))&&(this._changes.push([M,L,pe]),this._triggerRenderFrame()),(Object.keys(O).length||Ta(M))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:fe}=M;fe&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],fe(this._map))},this._map=o,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Sh(o),this._bearingSnap=h.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(h);const p=this._el;this._listeners=[[p,"touchstart",{passive:!0}],[p,"touchmove",{passive:!1}],[p,"touchend",void 0],[p,"touchcancel",void 0],[p,"mousedown",void 0],[p,"mousemove",void 0],[p,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[p,"mouseover",void 0],[p,"mouseout",void 0],[p,"dblclick",void 0],[p,"click",void 0],[p,"keydown",{capture:!1}],[p,"keyup",void 0],[p,"wheel",{passive:!1}],[p,"contextmenu",void 0],[window,"blur",void 0]];for(const[m,b,C]of this._listeners)E.addEventListener(m,b,m===document?this.handleWindowEvent:this.handleEvent,C)}destroy(){for(const[o,h,p]of this._listeners)E.removeEventListener(o,h,o===document?this.handleWindowEvent:this.handleEvent,p)}_addDefaultHandlers(o){const h=this._map,p=h.getCanvasContainer();this._add("mapEvent",new ro(h,o));const m=h.boxZoom=new oo(h,o);this._add("boxZoom",m),o.interactive&&o.boxZoom&&m.enable();const b=h.cooperativeGestures=new $t(h,o.cooperativeGestures);this._add("cooperativeGestures",b),o.cooperativeGestures&&b.enable();const C=new rf(h),M=new Ih(h);h.doubleClickZoom=new zc(M,C),this._add("tapZoom",C),this._add("clickZoom",M),o.interactive&&o.doubleClickZoom&&h.doubleClickZoom.enable();const L=new Lh;this._add("tapDragZoom",L);const O=h.touchPitch=new Mh(h);this._add("touchPitch",O),o.interactive&&o.touchPitch&&h.touchPitch.enable(o.touchPitch);const $=js(o),q=Us(o);h.dragRotate=new so(o,$,q),this._add("mouseRotate",$,["mousePitch"]),this._add("mousePitch",q,["mouseRotate"]),o.interactive&&o.dragRotate&&h.dragRotate.enable();const ee=(({enable:Ze,clickTolerance:be})=>{const Re=new bo({checkCorrectEvent:We=>E.mouseButton(We)===0&&!We.ctrlKey});return new Ns({clickTolerance:be,move:(We,He)=>({around:He,panDelta:He.sub(We)}),activateOnStart:!0,moveStateManager:Re,enable:Ze,assignEvents:gl})})(o),pe=new Th(o,h);h.dragPan=new Ah(p,ee,pe),this._add("mousePan",ee),this._add("touchPan",pe,["touchZoom","touchRotate"]),o.interactive&&o.dragPan&&h.dragPan.enable(o.dragPan);const fe=new Pc,_e=new Eh;h.touchZoomRotate=new Sa(p,_e,fe,L),this._add("touchRotate",fe,["touchPan","touchZoom"]),this._add("touchZoom",_e,["touchPan","touchRotate"]),o.interactive&&o.touchZoomRotate&&h.touchZoomRotate.enable(o.touchZoomRotate);const ce=h.scrollZoom=new vl(h,()=>this._triggerRenderFrame());this._add("scrollZoom",ce,["mousePan"]),o.interactive&&o.scrollZoom&&h.scrollZoom.enable(o.scrollZoom);const Ce=h.keyboard=new Jo(h);this._add("keyboard",Ce),o.interactive&&o.keyboard&&h.keyboard.enable(),this._add("blockableMapEvent",new vo(h))}_add(o,h,p){this._handlers.push({handlerName:o,handler:h,allowed:p}),this._handlersById[o]=h}stop(o){if(!this._updatingCamera){for(const{handler:h}of this._handlers)h.reset();this._inertia.clear(),this._fireEvents({},{},o),this._changes=[]}}isActive(){for(const{handler:o}of this._handlers)if(o.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Gt(this._eventsInProgress)||this.isZooming()}_blockedByActive(o,h,p){for(const m in o)if(m!==p&&(!h||h.indexOf(m)<0))return!0;return!1}_getMapTouches(o){const h=[];for(const p of o)this._el.contains(p.target)&&h.push(p);return h}mergeHandlerResult(o,h,p,m,b){if(!p)return;a.e(o,p);const C={handlerName:m,originalEvent:p.originalEvent||b};p.zoomDelta!==void 0&&(h.zoom=C),p.panDelta!==void 0&&(h.drag=C),p.pitchDelta!==void 0&&(h.pitch=C),p.bearingDelta!==void 0&&(h.rotate=C)}_applyChanges(){const o={},h={},p={};for(const[m,b,C]of this._changes)m.panDelta&&(o.panDelta=(o.panDelta||new a.P(0,0))._add(m.panDelta)),m.zoomDelta&&(o.zoomDelta=(o.zoomDelta||0)+m.zoomDelta),m.bearingDelta&&(o.bearingDelta=(o.bearingDelta||0)+m.bearingDelta),m.pitchDelta&&(o.pitchDelta=(o.pitchDelta||0)+m.pitchDelta),m.around!==void 0&&(o.around=m.around),m.pinchAround!==void 0&&(o.pinchAround=m.pinchAround),m.noInertia&&(o.noInertia=m.noInertia),a.e(h,b),a.e(p,C);this._updateMapTransform(o,h,p),this._changes=[]}_updateMapTransform(o,h,p){const m=this._map,b=m._getTransformForUpdate(),C=m.terrain;if(!(Ta(o)||C&&this._terrainMovement))return this._fireEvents(h,p,!0);let{panDelta:M,zoomDelta:L,bearingDelta:O,pitchDelta:$,around:q,pinchAround:ee}=o;ee!==void 0&&(q=ee),m._stop(!0),q=q||m.transform.centerPoint;const pe=b.pointLocation(M?q.sub(M):q);O&&(b.bearing+=O),$&&(b.pitch+=$),L&&(b.zoom+=L),C?this._terrainMovement||!h.drag&&!h.zoom?h.drag&&this._terrainMovement?b.center=b.pointLocation(b.centerPoint.sub(M)):b.setLocationAtPoint(pe,q):(this._terrainMovement=!0,this._map._elevationFreeze=!0,b.setLocationAtPoint(pe,q),this._map.once("moveend",()=>{this._map._elevationFreeze=!1,this._terrainMovement=!1,b.recalculateZoom(m.terrain)})):b.setLocationAtPoint(pe,q),m._applyUpdatedTransform(b),this._map._update(),o.noInertia||this._inertia.record(o),this._fireEvents(h,p,!0)}_fireEvents(o,h,p){const m=Gt(this._eventsInProgress),b=Gt(o),C={};for(const $ in o){const{originalEvent:q}=o[$];this._eventsInProgress[$]||(C[`${$}start`]=q),this._eventsInProgress[$]=o[$]}!m&&b&&this._fireEvent("movestart",b.originalEvent);for(const $ in C)this._fireEvent($,C[$]);b&&this._fireEvent("move",b.originalEvent);for(const $ in o){const{originalEvent:q}=o[$];this._fireEvent($,q)}const M={};let L;for(const $ in this._eventsInProgress){const{handlerName:q,originalEvent:ee}=this._eventsInProgress[$];this._handlersById[q].isActive()||(delete this._eventsInProgress[$],L=h[q]||ee,M[`${$}end`]=L)}for(const $ in M)this._fireEvent($,M[$]);const O=Gt(this._eventsInProgress);if(p&&(m||b)&&!O){this._updatingCamera=!0;const $=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),q=ee=>ee!==0&&-this._bearingSnap<ee&&ee<this._bearingSnap;!$||!$.essential&&S.prefersReducedMotion?(this._map.fire(new a.k("moveend",{originalEvent:L})),q(this._map.getBearing())&&this._map.resetNorth()):(q($.bearing||this._map.getBearing())&&($.bearing=0),$.freezeElevation=!0,this._map.easeTo($,{originalEvent:L})),this._updatingCamera=!1}}_fireEvent(o,h){this._map.fire(new a.k(o,h?{originalEvent:h}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(o=>{delete this._frameId,this.handleEvent(new bl("renderFrame",{timeStamp:o})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Sr extends a.E{constructor(o,h){super(),this._renderFrameCallback=()=>{const p=Math.min((S.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(p)),p<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=o,this._bearingSnap=h.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new a.M(this.transform.center.lng,this.transform.center.lat)}setCenter(o,h){return this.jumpTo({center:o},h)}panBy(o,h,p){return o=a.P.convert(o).mult(-1),this.panTo(this.transform.center,a.e({offset:o},h),p)}panTo(o,h,p){return this.easeTo(a.e({center:o},h),p)}getZoom(){return this.transform.zoom}setZoom(o,h){return this.jumpTo({zoom:o},h),this}zoomTo(o,h,p){return this.easeTo(a.e({zoom:o},h),p)}zoomIn(o,h){return this.zoomTo(this.getZoom()+1,o,h),this}zoomOut(o,h){return this.zoomTo(this.getZoom()-1,o,h),this}getBearing(){return this.transform.bearing}setBearing(o,h){return this.jumpTo({bearing:o},h),this}getPadding(){return this.transform.padding}setPadding(o,h){return this.jumpTo({padding:o},h),this}rotateTo(o,h,p){return this.easeTo(a.e({bearing:o},h),p)}resetNorth(o,h){return this.rotateTo(0,a.e({duration:1e3},o),h),this}resetNorthPitch(o,h){return this.easeTo(a.e({bearing:0,pitch:0,duration:1e3},o),h),this}snapToNorth(o,h){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(o,h):this}getPitch(){return this.transform.pitch}setPitch(o,h){return this.jumpTo({pitch:o},h),this}cameraForBounds(o,h){o=je.convert(o);const p=h&&h.bearing||0;return this._cameraForBoxAndBearing(o.getNorthWest(),o.getSouthEast(),p,h)}_cameraForBoxAndBearing(o,h,p,m){const b={top:0,bottom:0,right:0,left:0};if(typeof(m=a.e({padding:b,offset:[0,0],maxZoom:this.transform.maxZoom},m)).padding=="number"){const yt=m.padding;m.padding={top:yt,bottom:yt,right:yt,left:yt}}m.padding=a.e(b,m.padding);const C=this.transform,M=C.padding,L=new je(o,h),O=C.project(L.getNorthWest()),$=C.project(L.getNorthEast()),q=C.project(L.getSouthEast()),ee=C.project(L.getSouthWest()),pe=a.b8(-p),fe=O.rotate(pe),_e=$.rotate(pe),ce=q.rotate(pe),Ce=ee.rotate(pe),Ze=new a.P(Math.max(fe.x,_e.x,Ce.x,ce.x),Math.max(fe.y,_e.y,Ce.y,ce.y)),be=new a.P(Math.min(fe.x,_e.x,Ce.x,ce.x),Math.min(fe.y,_e.y,Ce.y,ce.y)),Re=Ze.sub(be),We=(C.width-(M.left+M.right+m.padding.left+m.padding.right))/Re.x,He=(C.height-(M.top+M.bottom+m.padding.top+m.padding.bottom))/Re.y;if(He<0||We<0)return void a.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const Xe=Math.min(C.scaleZoom(C.scale*Math.min(We,He)),m.maxZoom),rt=a.P.convert(m.offset),it=new a.P((m.padding.left-m.padding.right)/2,(m.padding.top-m.padding.bottom)/2).rotate(a.b8(p)),pt=rt.add(it).mult(C.scale/C.zoomScale(Xe));return{center:C.unproject(O.add(q).div(2).sub(pt)),zoom:Xe,bearing:p}}fitBounds(o,h,p){return this._fitInternal(this.cameraForBounds(o,h),h,p)}fitScreenCoordinates(o,h,p,m,b){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(a.P.convert(o)),this.transform.pointLocation(a.P.convert(h)),p,m),m,b)}_fitInternal(o,h,p){return o?(delete(h=a.e(o,h)).padding,h.linear?this.easeTo(h,p):this.flyTo(h,p)):this}jumpTo(o,h){this.stop();const p=this._getTransformForUpdate();let m=!1,b=!1,C=!1;return"zoom"in o&&p.zoom!==+o.zoom&&(m=!0,p.zoom=+o.zoom),o.center!==void 0&&(p.center=a.M.convert(o.center)),"bearing"in o&&p.bearing!==+o.bearing&&(b=!0,p.bearing=+o.bearing),"pitch"in o&&p.pitch!==+o.pitch&&(C=!0,p.pitch=+o.pitch),o.padding==null||p.isPaddingEqual(o.padding)||(p.padding=o.padding),this._applyUpdatedTransform(p),this.fire(new a.k("movestart",h)).fire(new a.k("move",h)),m&&this.fire(new a.k("zoomstart",h)).fire(new a.k("zoom",h)).fire(new a.k("zoomend",h)),b&&this.fire(new a.k("rotatestart",h)).fire(new a.k("rotate",h)).fire(new a.k("rotateend",h)),C&&this.fire(new a.k("pitchstart",h)).fire(new a.k("pitch",h)).fire(new a.k("pitchend",h)),this.fire(new a.k("moveend",h))}calculateCameraOptionsFromTo(o,h,p,m=0){const b=a.Y.fromLngLat(o,h),C=a.Y.fromLngLat(p,m),M=C.x-b.x,L=C.y-b.y,O=C.z-b.z,$=Math.hypot(M,L,O);if($===0)throw new Error("Can't calculate camera options with same From and To");const q=Math.hypot(M,L),ee=this.transform.scaleZoom(this.transform.cameraToCenterDistance/$/this.transform.tileSize),pe=180*Math.atan2(M,-L)/Math.PI;let fe=180*Math.acos(q/$)/Math.PI;return fe=O<0?90-fe:90+fe,{center:C.toLngLat(),zoom:ee,pitch:fe,bearing:pe}}easeTo(o,h){var p;this._stop(!1,o.easeId),((o=a.e({offset:[0,0],duration:500,easing:a.b7},o)).animate===!1||!o.essential&&S.prefersReducedMotion)&&(o.duration=0);const m=this._getTransformForUpdate(),b=this.getZoom(),C=this.getBearing(),M=this.getPitch(),L=this.getPadding(),O="bearing"in o?this._normalizeBearing(o.bearing,C):C,$="pitch"in o?+o.pitch:M,q="padding"in o?o.padding:m.padding,ee=a.P.convert(o.offset);let pe=m.centerPoint.add(ee);const fe=m.pointLocation(pe),{center:_e,zoom:ce}=m.getConstrained(a.M.convert(o.center||fe),(p=o.zoom)!==null&&p!==void 0?p:b);this._normalizeCenter(_e);const Ce=m.project(fe),Ze=m.project(_e).sub(Ce),be=m.zoomScale(ce-b);let Re,We;o.around&&(Re=a.M.convert(o.around),We=m.locationPoint(Re));const He={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||ce!==b,this._rotating=this._rotating||C!==O,this._pitching=this._pitching||$!==M,this._padding=!m.isPaddingEqual(q),this._easeId=o.easeId,this._prepareEase(h,o.noMoveStart,He),this.terrain&&this._prepareElevation(_e),this._ease(Xe=>{if(this._zooming&&(m.zoom=a.z.number(b,ce,Xe)),this._rotating&&(m.bearing=a.z.number(C,O,Xe)),this._pitching&&(m.pitch=a.z.number(M,$,Xe)),this._padding&&(m.interpolatePadding(L,q,Xe),pe=m.centerPoint.add(ee)),this.terrain&&!o.freezeElevation&&this._updateElevation(Xe),Re)m.setLocationAtPoint(Re,We);else{const rt=m.zoomScale(m.zoom-b),it=ce>b?Math.min(2,be):Math.max(.5,be),pt=Math.pow(it,1-Xe),yt=m.unproject(Ce.add(Ze.mult(Xe*pt)).mult(rt));m.setLocationAtPoint(m.renderWorldCopies?yt.wrap():yt,pe)}this._applyUpdatedTransform(m),this._fireMoveEvents(h)},Xe=>{this.terrain&&this._finalizeElevation(),this._afterEase(h,Xe)},o),this}_prepareEase(o,h,p={}){this._moving=!0,h||p.moving||this.fire(new a.k("movestart",o)),this._zooming&&!p.zooming&&this.fire(new a.k("zoomstart",o)),this._rotating&&!p.rotating&&this.fire(new a.k("rotatestart",o)),this._pitching&&!p.pitching&&this.fire(new a.k("pitchstart",o))}_prepareElevation(o){this._elevationCenter=o,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(o,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(o){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const h=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(o<1&&h!==this._elevationTarget){const p=this._elevationTarget-this._elevationStart;this._elevationStart+=o*(p-(h-(p*o+this._elevationStart))/(1-o)),this._elevationTarget=h}this.transform.elevation=a.z.number(this._elevationStart,this._elevationTarget,o)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(o){if(!this.transformCameraUpdate)return;const h=o.clone(),{center:p,zoom:m,pitch:b,bearing:C,elevation:M}=this.transformCameraUpdate(h);p&&(h.center=p),m!==void 0&&(h.zoom=m),b!==void 0&&(h.pitch=b),C!==void 0&&(h.bearing=C),M!==void 0&&(h.elevation=M),this.transform.apply(h)}_fireMoveEvents(o){this.fire(new a.k("move",o)),this._zooming&&this.fire(new a.k("zoom",o)),this._rotating&&this.fire(new a.k("rotate",o)),this._pitching&&this.fire(new a.k("pitch",o))}_afterEase(o,h){if(this._easeId&&h&&this._easeId===h)return;delete this._easeId;const p=this._zooming,m=this._rotating,b=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,p&&this.fire(new a.k("zoomend",o)),m&&this.fire(new a.k("rotateend",o)),b&&this.fire(new a.k("pitchend",o)),this.fire(new a.k("moveend",o))}flyTo(o,h){var p;if(!o.essential&&S.prefersReducedMotion){const Ti=a.L(o,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Ti,h)}this.stop(),o=a.e({offset:[0,0],speed:1.2,curve:1.42,easing:a.b7},o);const m=this._getTransformForUpdate(),b=this.getZoom(),C=this.getBearing(),M=this.getPitch(),L=this.getPadding(),O="bearing"in o?this._normalizeBearing(o.bearing,C):C,$="pitch"in o?+o.pitch:M,q="padding"in o?o.padding:m.padding,ee=a.P.convert(o.offset);let pe=m.centerPoint.add(ee);const fe=m.pointLocation(pe),{center:_e,zoom:ce}=m.getConstrained(a.M.convert(o.center||fe),(p=o.zoom)!==null&&p!==void 0?p:b);this._normalizeCenter(_e);const Ce=m.zoomScale(ce-b),Ze=m.project(fe),be=m.project(_e).sub(Ze);let Re=o.curve;const We=Math.max(m.width,m.height),He=We/Ce,Xe=be.mag();if("minZoom"in o){const Ti=a.ac(Math.min(o.minZoom,b,ce),m.minZoom,m.maxZoom),ii=We/m.zoomScale(Ti-b);Re=Math.sqrt(ii/Xe*2)}const rt=Re*Re;function it(Ti){const ii=(He*He-We*We+(Ti?-1:1)*rt*rt*Xe*Xe)/(2*(Ti?He:We)*rt*Xe);return Math.log(Math.sqrt(ii*ii+1)-ii)}function pt(Ti){return(Math.exp(Ti)-Math.exp(-Ti))/2}function yt(Ti){return(Math.exp(Ti)+Math.exp(-Ti))/2}const ai=it(!1);let bt=function(Ti){return yt(ai)/yt(ai+Re*Ti)},Kt=function(Ti){return We*((yt(ai)*(pt(ii=ai+Re*Ti)/yt(ii))-pt(ai))/rt)/Xe;var ii},li=(it(!0)-ai)/Re;if(Math.abs(Xe)<1e-6||!isFinite(li)){if(Math.abs(We-He)<1e-6)return this.easeTo(o,h);const Ti=He<We?-1:1;li=Math.abs(Math.log(He/We))/Re,Kt=function(){return 0},bt=function(ii){return Math.exp(Ti*Re*ii)}}return o.duration="duration"in o?+o.duration:1e3*li/("screenSpeed"in o?+o.screenSpeed/Re:+o.speed),o.maxDuration&&o.duration>o.maxDuration&&(o.duration=0),this._zooming=!0,this._rotating=C!==O,this._pitching=$!==M,this._padding=!m.isPaddingEqual(q),this._prepareEase(h,!1),this.terrain&&this._prepareElevation(_e),this._ease(Ti=>{const ii=Ti*li,di=1/bt(ii);m.zoom=Ti===1?ce:b+m.scaleZoom(di),this._rotating&&(m.bearing=a.z.number(C,O,Ti)),this._pitching&&(m.pitch=a.z.number(M,$,Ti)),this._padding&&(m.interpolatePadding(L,q,Ti),pe=m.centerPoint.add(ee)),this.terrain&&!o.freezeElevation&&this._updateElevation(Ti);const mi=Ti===1?_e:m.unproject(Ze.add(be.mult(Kt(ii))).mult(di));m.setLocationAtPoint(m.renderWorldCopies?mi.wrap():mi,pe),this._applyUpdatedTransform(m),this._fireMoveEvents(h)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(h)},o),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(o,h){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const p=this._onEaseEnd;delete this._onEaseEnd,p.call(this,h)}if(!o){const p=this.handlers;p&&p.stop(!1)}return this}_ease(o,h,p){p.animate===!1||p.duration===0?(o(1),h()):(this._easeStart=S.now(),this._easeOptions=p,this._onEaseFrame=o,this._onEaseEnd=h,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(o,h){o=a.b1(o,-180,180);const p=Math.abs(o-h);return Math.abs(o-360-h)<p&&(o-=360),Math.abs(o+360-h)<p&&(o+=360),o}_normalizeCenter(o){const h=this.transform;if(!h.renderWorldCopies||h.lngRange)return;const p=o.lng-h.center.lng;o.lng+=p>180?-360:p<-180?360:0}queryTerrainElevation(o){return this.terrain?this.terrain.getElevationForLngLatZoom(a.M.convert(o),this.transform.tileZoom)-this.transform.elevation:null}}const Rc={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class ao{constructor(o=Rc){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=h=>{!h||h.sourceDataType!=="metadata"&&h.sourceDataType!=="visibility"&&h.dataType!=="style"&&h.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=o}getDefaultPosition(){return"bottom-right"}onAdd(o){return this._map=o,this._compact=this.options.compact,this._container=E.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=E.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=E.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){E.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(o,h){const p=this._map._getUIString(`AttributionControl.${h}`);o.title=p,o.setAttribute("aria-label",p)}_updateAttributions(){if(!this._map.style)return;let o=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?o=o.concat(this.options.customAttribution.map(m=>typeof m!="string"?"":m)):typeof this.options.customAttribution=="string"&&o.push(this.options.customAttribution)),this._map.style.stylesheet){const m=this._map.style.stylesheet;this.styleOwner=m.owner,this.styleId=m.id}const h=this._map.style.sourceCaches;for(const m in h){const b=h[m];if(b.used||b.usedForTerrain){const C=b.getSource();C.attribution&&o.indexOf(C.attribution)<0&&o.push(C.attribution)}}o=o.filter(m=>String(m).trim()),o.sort((m,b)=>m.length-b.length),o=o.filter((m,b)=>{for(let C=b+1;C<o.length;C++)if(o[C].indexOf(m)>=0)return!1;return!0});const p=o.join(" | ");p!==this._attribHTML&&(this._attribHTML=p,o.length?(this._innerContainer.innerHTML=p,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Ph{constructor(o={}){this._updateCompact=()=>{const h=this._container.children;if(h.length){const p=h[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&p.classList.add("maplibregl-compact"):p.classList.remove("maplibregl-compact")}},this.options=o}getDefaultPosition(){return"bottom-left"}onAdd(o){this._map=o,this._compact=this.options&&this.options.compact,this._container=E.create("div","maplibregl-ctrl");const h=E.create("a","maplibregl-ctrl-logo");return h.target="_blank",h.rel="noopener nofollow",h.href="https://maplibre.org/",h.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),h.setAttribute("rel","noopener nofollow"),this._container.appendChild(h),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){E.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Ca{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(o){const h=++this._id;return this._queue.push({callback:o,id:h,cancelled:!1}),h}remove(o){const h=this._currentlyRunning,p=h?this._queue.concat(h):this._queue;for(const m of p)if(m.id===o)return void(m.cancelled=!0)}run(o=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const h=this._currentlyRunning=this._queue;this._queue=[];for(const p of h)if(!p.cancelled&&(p.callback(o),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var bn=a.X([{name:"a_pos3d",type:"Int16",components:3}]);class Ln extends a.E{constructor(o){super(),this.sourceCache=o,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,o.usedForTerrain=!0,o.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(o,h){this.sourceCache.update(o,h),this._renderableTilesKeys=[];const p={};for(const m of o.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:h}))p[m.key]=!0,this._renderableTilesKeys.push(m.key),this._tiles[m.key]||(m.posMatrix=new Float64Array(16),a.aN(m.posMatrix,0,a.W,0,a.W,0,1),this._tiles[m.key]=new Mi(m,this.tileSize));for(const m in this._tiles)p[m]||delete this._tiles[m]}freeRtt(o){for(const h in this._tiles){const p=this._tiles[h];(!o||p.tileID.equals(o)||p.tileID.isChildOf(o)||o.isChildOf(p.tileID))&&(p.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(o=>this.getTileByID(o))}getTileByID(o){return this._tiles[o]}getTerrainCoords(o){const h={};for(const p of this._renderableTilesKeys){const m=this._tiles[p].tileID;if(m.canonical.equals(o.canonical)){const b=o.clone();b.posMatrix=new Float64Array(16),a.aN(b.posMatrix,0,a.W,0,a.W,0,1),h[p]=b}else if(m.canonical.isChildOf(o.canonical)){const b=o.clone();b.posMatrix=new Float64Array(16);const C=m.canonical.z-o.canonical.z,M=m.canonical.x-(m.canonical.x>>C<<C),L=m.canonical.y-(m.canonical.y>>C<<C),O=a.W>>C;a.aN(b.posMatrix,0,O,0,O,0,1),a.H(b.posMatrix,b.posMatrix,[-M*O,-L*O,0]),h[p]=b}else if(o.canonical.isChildOf(m.canonical)){const b=o.clone();b.posMatrix=new Float64Array(16);const C=o.canonical.z-m.canonical.z,M=o.canonical.x-(o.canonical.x>>C<<C),L=o.canonical.y-(o.canonical.y>>C<<C),O=a.W>>C;a.aN(b.posMatrix,0,a.W,0,a.W,0,1),a.H(b.posMatrix,b.posMatrix,[M*O,L*O,0]),a.J(b.posMatrix,b.posMatrix,[1/2**C,1/2**C,0]),h[p]=b}}return h}getSourceTile(o,h){const p=this.sourceCache._source;let m=o.overscaledZ-this.deltaZoom;if(m>p.maxzoom&&(m=p.maxzoom),m<p.minzoom)return null;this._sourceTileCache[o.key]||(this._sourceTileCache[o.key]=o.scaledTo(m).key);let b=this.sourceCache.getTileByID(this._sourceTileCache[o.key]);if((!b||!b.dem)&&h)for(;m>=p.minzoom&&(!b||!b.dem);)b=this.sourceCache.getTileByID(o.scaledTo(m--).key);return b}tilesAfterTime(o=Date.now()){return Object.values(this._tiles).filter(h=>h.timeAdded>=o)}}class zh{constructor(o,h,p){this.painter=o,this.sourceCache=new Ln(h),this.options=p,this.exaggeration=typeof p.exaggeration=="number"?p.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(o,h,p,m=a.W){var b;if(!(h>=0&&h<m&&p>=0&&p<m))return 0;const C=this.getTerrainData(o),M=(b=C.tile)===null||b===void 0?void 0:b.dem;if(!M)return 0;const L=function(fe,_e,ce){var Ce=_e[0],Ze=_e[1];return fe[0]=ce[0]*Ce+ce[4]*Ze+ce[12],fe[1]=ce[1]*Ce+ce[5]*Ze+ce[13],fe}([],[h/m*a.W,p/m*a.W],C.u_terrain_matrix),O=[L[0]*M.dim,L[1]*M.dim],$=Math.floor(O[0]),q=Math.floor(O[1]),ee=O[0]-$,pe=O[1]-q;return M.get($,q)*(1-ee)*(1-pe)+M.get($+1,q)*ee*(1-pe)+M.get($,q+1)*(1-ee)*pe+M.get($+1,q+1)*ee*pe}getElevationForLngLatZoom(o,h){const{tileID:p,mercatorX:m,mercatorY:b}=this._getOverscaledTileIDFromLngLatZoom(o,h);return this.getElevation(p,m%a.W,b%a.W,a.W)}getElevation(o,h,p,m=a.W){return this.getDEMElevation(o,h,p,m)*this.exaggeration}getTerrainData(o){if(!this._emptyDemTexture){const m=this.painter.context,b=new a.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new re(m,b,m.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new re(m,new a.R({width:1,height:1}),m.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(m.gl.NEAREST,m.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=a.an([])}const h=this.sourceCache.getSourceTile(o,!0);if(h&&h.dem&&(!h.demTexture||h.needsTerrainPrepare)){const m=this.painter.context;h.demTexture=this.painter.getTileTexture(h.dem.stride),h.demTexture?h.demTexture.update(h.dem.getPixels(),{premultiply:!1}):h.demTexture=new re(m,h.dem.getPixels(),m.gl.RGBA,{premultiply:!1}),h.demTexture.bind(m.gl.NEAREST,m.gl.CLAMP_TO_EDGE),h.needsTerrainPrepare=!1}const p=h&&h+h.tileID.key+o.key;if(p&&!this._demMatrixCache[p]){const m=this.sourceCache.sourceCache._source.maxzoom;let b=o.canonical.z-h.tileID.canonical.z;o.overscaledZ>o.canonical.z&&(o.canonical.z>=m?b=o.canonical.z-m:a.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const C=o.canonical.x-(o.canonical.x>>b<<b),M=o.canonical.y-(o.canonical.y>>b<<b),L=a.b9(new Float64Array(16),[1/(a.W<<b),1/(a.W<<b),0]);a.H(L,L,[C*a.W,M*a.W,0]),this._demMatrixCache[o.key]={matrix:L,coord:o}}return{u_depth:2,u_terrain:3,u_terrain_dim:h&&h.dem&&h.dem.dim||1,u_terrain_matrix:p?this._demMatrixCache[o.key].matrix:this._emptyDemMatrix,u_terrain_unpack:h&&h.dem&&h.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(h&&h.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:h}}getFramebuffer(o){const h=this.painter,p=h.width/devicePixelRatio,m=h.height/devicePixelRatio;return!this._fbo||this._fbo.width===p&&this._fbo.height===m||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new re(h.context,{width:p,height:m,data:null},h.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(h.context.gl.NEAREST,h.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new re(h.context,{width:p,height:m,data:null},h.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(h.context.gl.NEAREST,h.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=h.context.createFramebuffer(p,m,!0,!1),this._fbo.depthAttachment.set(h.context.createRenderbuffer(h.context.gl.DEPTH_COMPONENT16,p,m))),this._fbo.colorAttachment.set(o==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const o=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const h=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let b=0,C=0;b<this._coordsTextureSize;b++)for(let M=0;M<this._coordsTextureSize;M++,C+=4)h[C+0]=255&M,h[C+1]=255&b,h[C+2]=M>>8<<4|b>>8,h[C+3]=0;const p=new a.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(h.buffer)),m=new re(o,p,o.gl.RGBA,{premultiply:!1});return m.bind(o.gl.NEAREST,o.gl.CLAMP_TO_EDGE),this._coordsTexture=m,m}pointCoordinate(o){this.painter.maybeDrawDepthAndCoords(!0);const h=new Uint8Array(4),p=this.painter.context,m=p.gl,b=Math.round(o.x*this.painter.pixelRatio/devicePixelRatio),C=Math.round(o.y*this.painter.pixelRatio/devicePixelRatio),M=Math.round(this.painter.height/devicePixelRatio);p.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),m.readPixels(b,M-C-1,1,1,m.RGBA,m.UNSIGNED_BYTE,h),p.bindFramebuffer.set(null);const L=h[0]+(h[2]>>4<<8),O=h[1]+((15&h[2])<<8),$=this.coordsIndex[255-h[3]],q=$&&this.sourceCache.getTileByID($);if(!q)return null;const ee=this._coordsTextureSize,pe=(1<<q.tileID.canonical.z)*ee;return new a.Y((q.tileID.canonical.x*ee+L)/pe+q.tileID.wrap,(q.tileID.canonical.y*ee+O)/pe,this.getElevation(q.tileID,L,O,ee))}depthAtPoint(o){const h=new Uint8Array(4),p=this.painter.context,m=p.gl;return p.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),m.readPixels(o.x,this.painter.height/devicePixelRatio-o.y-1,1,1,m.RGBA,m.UNSIGNED_BYTE,h),p.bindFramebuffer.set(null),(h[0]/16777216+h[1]/65536+h[2]/256+h[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const o=this.painter.context,h=new a.ba,p=new a.aX,m=this.meshSize,b=a.W/m,C=m*m;for(let q=0;q<=m;q++)for(let ee=0;ee<=m;ee++)h.emplaceBack(ee*b,q*b,0);for(let q=0;q<C;q+=m+1)for(let ee=0;ee<m;ee++)p.emplaceBack(ee+q,m+ee+q+1,m+ee+q+2),p.emplaceBack(ee+q,m+ee+q+2,ee+q+1);const M=h.length,L=M+2*(m+1);for(const q of[0,1])for(let ee=0;ee<=m;ee++)for(const pe of[0,1])h.emplaceBack(ee*b,q*a.W,pe);for(let q=0;q<2*m;q+=2)p.emplaceBack(L+q,L+q+1,L+q+3),p.emplaceBack(L+q,L+q+3,L+q+2),p.emplaceBack(M+q,M+q+3,M+q+1),p.emplaceBack(M+q,M+q+2,M+q+3);const O=h.length,$=O+2*(m+1);for(const q of[0,1])for(let ee=0;ee<=m;ee++)for(const pe of[0,1])h.emplaceBack(q*a.W,ee*b,pe);for(let q=0;q<2*m;q+=2)p.emplaceBack(O+q,O+q+1,O+q+3),p.emplaceBack(O+q,O+q+3,O+q+2),p.emplaceBack($+q,$+q+3,$+q+1),p.emplaceBack($+q,$+q+2,$+q+3);return this._mesh={indexBuffer:o.createIndexBuffer(p),vertexBuffer:o.createVertexBuffer(h,bn.members),segments:a.$.simpleSegment(0,0,h.length,p.length)},this._mesh}getMeshFrameDelta(o){return 2*Math.PI*a.bb/Math.pow(2,o)/5}getMinTileElevationForLngLatZoom(o,h){var p;const{tileID:m}=this._getOverscaledTileIDFromLngLatZoom(o,h);return(p=this.getMinMaxElevation(m).minElevation)!==null&&p!==void 0?p:0}getMinMaxElevation(o){const h=this.getTerrainData(o).tile,p={minElevation:null,maxElevation:null};return h&&h.dem&&(p.minElevation=h.dem.min*this.exaggeration,p.maxElevation=h.dem.max*this.exaggeration),p}_getOverscaledTileIDFromLngLatZoom(o,h){const p=a.Y.fromLngLat(o.wrap()),m=(1<<h)*a.W,b=p.x*m,C=p.y*m,M=Math.floor(b/a.W),L=Math.floor(C/a.W);return{tileID:new a.Q(h,0,h,M,L),mercatorX:b,mercatorY:C}}}class Ea{constructor(o,h,p){this._context=o,this._size=h,this._tileSize=p,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const o of this._objects)o.texture.destroy(),o.fbo.destroy()}_createObject(o){const h=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),p=new re(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return p.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),h.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),h.colorAttachment.set(p.texture),{id:o,fbo:h,texture:p,stamp:-1,inUse:!1}}getObjectForId(o){return this._objects[o]}useObject(o){o.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(h=>o.id!==h),this._recentlyUsed.push(o.id)}stampObject(o){o.stamp=++this._stamp}getOrCreateFreeObject(){for(const h of this._recentlyUsed)if(!this._objects[h].inUse)return this._objects[h];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const o=this._createObject(this._objects.length);return this._objects.push(o),o}freeObject(o){o.inUse=!1}freeAllObjects(){for(const o of this._objects)this.freeObject(o)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(o=>!o.inUse)===!1}}const zo={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class Bc{constructor(o,h){this.painter=o,this.terrain=h,this.pool=new Ea(o.context,30,h.sourceCache.tileSize*h.qualityFactor)}destruct(){this.pool.destruct()}getTexture(o){return this.pool.getObjectForId(o.rtt[this._stacks.length-1].id).texture}prepareForRender(o,h){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=o._order.filter(p=>!o._layers[p].isHidden(h)),this._coordsDescendingInv={};for(const p in o.sourceCaches){this._coordsDescendingInv[p]={};const m=o.sourceCaches[p].getVisibleCoordinates();for(const b of m){const C=this.terrain.sourceCache.getTerrainCoords(b);for(const M in C)this._coordsDescendingInv[p][M]||(this._coordsDescendingInv[p][M]=[]),this._coordsDescendingInv[p][M].push(C[M])}}this._coordsDescendingInvStr={};for(const p of o._order){const m=o._layers[p],b=m.source;if(zo[m.type]&&!this._coordsDescendingInvStr[b]){this._coordsDescendingInvStr[b]={};for(const C in this._coordsDescendingInv[b])this._coordsDescendingInvStr[b][C]=this._coordsDescendingInv[b][C].map(M=>M.key).sort().join()}}for(const p of this._renderableTiles)for(const m in this._coordsDescendingInvStr){const b=this._coordsDescendingInvStr[m][p.tileID.key];b&&b!==p.rttCoords[m]&&(p.rtt=[])}}renderLayer(o){if(o.isHidden(this.painter.transform.zoom))return!1;const h=o.type,p=this.painter,m=this._renderableLayerIds[this._renderableLayerIds.length-1]===o.id;if(zo[h]&&(this._prevType&&zo[this._prevType]||this._stacks.push([]),this._prevType=h,this._stacks[this._stacks.length-1].push(o.id),!m))return!0;if(zo[this._prevType]||zo[h]&&m){this._prevType=h;const b=this._stacks.length-1,C=this._stacks[b]||[];for(const M of this._renderableTiles){if(this.pool.isFull()&&(pl(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(M),M.rtt[b]){const O=this.pool.getObjectForId(M.rtt[b].id);if(O.stamp===M.rtt[b].stamp){this.pool.useObject(O);continue}}const L=this.pool.getOrCreateFreeObject();this.pool.useObject(L),this.pool.stampObject(L),M.rtt[b]={id:L.id,stamp:L.stamp},p.context.bindFramebuffer.set(L.fbo.framebuffer),p.context.clear({color:a.aO.transparent,stencil:0}),p.currentStencilSource=void 0;for(let O=0;O<C.length;O++){const $=p.style._layers[C[O]],q=$.source?this._coordsDescendingInv[$.source][M.tileID.key]:[M.tileID];p.context.viewport.set([0,0,L.fbo.width,L.fbo.height]),p._renderTileClippingMasks($,q),p.renderLayer(p,p.style.sourceCaches[$.source],$,q),$.source&&(M.rttCoords[$.source]=this._coordsDescendingInvStr[$.source][M.tileID.key])}}return pl(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),zo[h]}return!1}}const Fc={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use â + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Oc=_,Ma={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:Rc,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:a.a.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096]},wl=y=>{y.touchstart=y.dragStart,y.touchmoveWindow=y.dragMove,y.touchend=y.dragEnd},Nc={showCompass:!0,showZoom:!0,visualizePitch:!1};class jc{constructor(o,h,p=!1){this.mousedown=C=>{this.startMouse(a.e({},C,{ctrlKey:!0,preventDefault:()=>C.preventDefault()}),E.mousePos(this.element,C)),E.addEventListener(window,"mousemove",this.mousemove),E.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=C=>{this.moveMouse(C,E.mousePos(this.element,C))},this.mouseup=C=>{this.mouseRotate.dragEnd(C),this.mousePitch&&this.mousePitch.dragEnd(C),this.offTemp()},this.touchstart=C=>{C.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=E.touchPos(this.element,C.targetTouches)[0],this.startTouch(C,this._startPos),E.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),E.addEventListener(window,"touchend",this.touchend))},this.touchmove=C=>{C.targetTouches.length!==1?this.reset():(this._lastPos=E.touchPos(this.element,C.targetTouches)[0],this.moveTouch(C,this._lastPos))},this.touchend=C=>{C.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const m=o.dragRotate._mouseRotate.getClickTolerance(),b=o.dragRotate._mousePitch.getClickTolerance();this.element=h,this.mouseRotate=js({clickTolerance:m,enable:!0}),this.touchRotate=(({enable:C,clickTolerance:M,bearingDegreesPerPixelMoved:L=.8})=>{const O=new Lt;return new Ns({clickTolerance:M,move:($,q)=>({bearingDelta:(q.x-$.x)*L}),moveStateManager:O,enable:C,assignEvents:wl})})({clickTolerance:m,enable:!0}),this.map=o,p&&(this.mousePitch=Us({clickTolerance:b,enable:!0}),this.touchPitch=(({enable:C,clickTolerance:M,pitchDegreesPerPixelMoved:L=-.5})=>{const O=new Lt;return new Ns({clickTolerance:M,move:($,q)=>({pitchDelta:(q.y-$.y)*L}),moveStateManager:O,enable:C,assignEvents:wl})})({clickTolerance:b,enable:!0})),E.addEventListener(h,"mousedown",this.mousedown),E.addEventListener(h,"touchstart",this.touchstart,{passive:!1}),E.addEventListener(h,"touchcancel",this.reset)}startMouse(o,h){this.mouseRotate.dragStart(o,h),this.mousePitch&&this.mousePitch.dragStart(o,h),E.disableDrag()}startTouch(o,h){this.touchRotate.dragStart(o,h),this.touchPitch&&this.touchPitch.dragStart(o,h),E.disableDrag()}moveMouse(o,h){const p=this.map,{bearingDelta:m}=this.mouseRotate.dragMove(o,h)||{};if(m&&p.setBearing(p.getBearing()+m),this.mousePitch){const{pitchDelta:b}=this.mousePitch.dragMove(o,h)||{};b&&p.setPitch(p.getPitch()+b)}}moveTouch(o,h){const p=this.map,{bearingDelta:m}=this.touchRotate.dragMove(o,h)||{};if(m&&p.setBearing(p.getBearing()+m),this.touchPitch){const{pitchDelta:b}=this.touchPitch.dragMove(o,h)||{};b&&p.setPitch(p.getPitch()+b)}}off(){const o=this.element;E.removeEventListener(o,"mousedown",this.mousedown),E.removeEventListener(o,"touchstart",this.touchstart,{passive:!1}),E.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),E.removeEventListener(window,"touchend",this.touchend),E.removeEventListener(o,"touchcancel",this.reset),this.offTemp()}offTemp(){E.enableDrag(),E.removeEventListener(window,"mousemove",this.mousemove),E.removeEventListener(window,"mouseup",this.mouseup),E.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),E.removeEventListener(window,"touchend",this.touchend)}}let Do;function xl(y,o,h){const p=new a.M(y.lng,y.lat);if(y=new a.M(y.lng,y.lat),o){const m=new a.M(y.lng-360,y.lat),b=new a.M(y.lng+360,y.lat),C=h.locationPoint(y).distSqr(o);h.locationPoint(m).distSqr(o)<C?y=m:h.locationPoint(b).distSqr(o)<C&&(y=b)}for(;Math.abs(y.lng-h.center.lng)>180;){const m=h.locationPoint(y);if(m.x>=0&&m.y>=0&&m.x<=h.width&&m.y<=h.height)break;y.lng>h.center.lng?y.lng-=360:y.lng+=360}return y.lng!==p.lng&&h.locationPoint(y).y>h.height/2-h.getHorizon()?y:p}const Ia={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function kl(y,o,h){const p=y.classList;for(const m in Ia)p.remove(`maplibregl-${h}-anchor-${m}`);p.add(`maplibregl-${h}-anchor-${o}`)}class La extends a.E{constructor(o){if(super(),this._onKeyPress=h=>{const p=h.code,m=h.charCode||h.keyCode;p!=="Space"&&p!=="Enter"&&m!==32&&m!==13||this.togglePopup()},this._onMapClick=h=>{const p=h.originalEvent.target,m=this._element;this._popup&&(p===m||m.contains(p))&&this.togglePopup()},this._update=h=>{var p;if(!this._map)return;const m=this._map.loaded()&&!this._map.isMoving();((h==null?void 0:h.type)==="terrain"||(h==null?void 0:h.type)==="render"&&!m)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?xl(this._lngLat,this._flatPos,this._map.transform):(p=this._lngLat)===null||p===void 0?void 0:p.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let b="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?b=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(b=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let C="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?C="rotateX(0deg)":this._pitchAlignment==="map"&&(C=`rotateX(${this._map.getPitch()}deg)`),h&&h.type!=="moveend"||(this._pos=this._pos.round()),E.setTransform(this._element,`${Ia[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${C} ${b}`),S.frameAsync(new AbortController).then(()=>{this._updateOpacity(h&&h.type==="moveend")}).catch(()=>{})},this._onMove=h=>{if(!this._isDragging){const p=this._clickTolerance||this._map._clickTolerance;this._isDragging=h.point.dist(this._pointerdownPos)>=p}this._isDragging&&(this._pos=h.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new a.k("dragstart"))),this.fire(new a.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new a.k("dragend")),this._state="inactive"},this._addDragHandler=h=>{this._element.contains(h.originalEvent.target)&&(h.preventDefault(),this._positionDelta=h.point.sub(this._pos).add(this._offset),this._pointerdownPos=h.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=o&&o.anchor||"center",this._color=o&&o.color||"#3FB1CE",this._scale=o&&o.scale||1,this._draggable=o&&o.draggable||!1,this._clickTolerance=o&&o.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=o&&o.rotation||0,this._rotationAlignment=o&&o.rotationAlignment||"auto",this._pitchAlignment=o&&o.pitchAlignment&&o.pitchAlignment!=="auto"?o.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(o==null?void 0:o.opacity,o==null?void 0:o.opacityWhenCovered),o&&o.element)this._element=o.element,this._offset=a.P.convert(o&&o.offset||[0,0]);else{this._defaultMarker=!0,this._element=E.create("div"),this._element.setAttribute("aria-label","Map marker");const h=E.createNS("http://www.w3.org/2000/svg","svg"),p=41,m=27;h.setAttributeNS(null,"display","block"),h.setAttributeNS(null,"height",`${p}px`),h.setAttributeNS(null,"width",`${m}px`),h.setAttributeNS(null,"viewBox",`0 0 ${m} ${p}`);const b=E.createNS("http://www.w3.org/2000/svg","g");b.setAttributeNS(null,"stroke","none"),b.setAttributeNS(null,"stroke-width","1"),b.setAttributeNS(null,"fill","none"),b.setAttributeNS(null,"fill-rule","evenodd");const C=E.createNS("http://www.w3.org/2000/svg","g");C.setAttributeNS(null,"fill-rule","nonzero");const M=E.createNS("http://www.w3.org/2000/svg","g");M.setAttributeNS(null,"transform","translate(3.0, 29.0)"),M.setAttributeNS(null,"fill","#000000");const L=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const Ce of L){const Ze=E.createNS("http://www.w3.org/2000/svg","ellipse");Ze.setAttributeNS(null,"opacity","0.04"),Ze.setAttributeNS(null,"cx","10.5"),Ze.setAttributeNS(null,"cy","5.80029008"),Ze.setAttributeNS(null,"rx",Ce.rx),Ze.setAttributeNS(null,"ry",Ce.ry),M.appendChild(Ze)}const O=E.createNS("http://www.w3.org/2000/svg","g");O.setAttributeNS(null,"fill",this._color);const $=E.createNS("http://www.w3.org/2000/svg","path");$.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),O.appendChild($);const q=E.createNS("http://www.w3.org/2000/svg","g");q.setAttributeNS(null,"opacity","0.25"),q.setAttributeNS(null,"fill","#000000");const ee=E.createNS("http://www.w3.org/2000/svg","path");ee.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),q.appendChild(ee);const pe=E.createNS("http://www.w3.org/2000/svg","g");pe.setAttributeNS(null,"transform","translate(6.0, 7.0)"),pe.setAttributeNS(null,"fill","#FFFFFF");const fe=E.createNS("http://www.w3.org/2000/svg","g");fe.setAttributeNS(null,"transform","translate(8.0, 8.0)");const _e=E.createNS("http://www.w3.org/2000/svg","circle");_e.setAttributeNS(null,"fill","#000000"),_e.setAttributeNS(null,"opacity","0.25"),_e.setAttributeNS(null,"cx","5.5"),_e.setAttributeNS(null,"cy","5.5"),_e.setAttributeNS(null,"r","5.4999962");const ce=E.createNS("http://www.w3.org/2000/svg","circle");ce.setAttributeNS(null,"fill","#FFFFFF"),ce.setAttributeNS(null,"cx","5.5"),ce.setAttributeNS(null,"cy","5.5"),ce.setAttributeNS(null,"r","5.4999962"),fe.appendChild(_e),fe.appendChild(ce),C.appendChild(M),C.appendChild(O),C.appendChild(q),C.appendChild(pe),C.appendChild(fe),h.appendChild(C),h.setAttributeNS(null,"height",p*this._scale+"px"),h.setAttributeNS(null,"width",m*this._scale+"px"),this._element.appendChild(h),this._offset=a.P.convert(o&&o.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",h=>{h.preventDefault()}),this._element.addEventListener("mousedown",h=>{h.preventDefault()}),kl(this._element,this._anchor,"marker"),o&&o.className)for(const h of o.className.split(" "))this._element.classList.add(h);this._popup=null}addTo(o){return this.remove(),this._map=o,o.getCanvasContainer().appendChild(this._element),o.on("move",this._update),o.on("moveend",this._update),o.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),E.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(o){return this._lngLat=a.M.convert(o),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(o){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),o){if(!("offset"in o.options)){const m=Math.abs(13.5)/Math.SQRT2;o.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[m,-1*(38.1-13.5+m)],"bottom-right":[-m,-1*(38.1-13.5+m)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=o,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){const o=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:o?(o.isOpen()?o.remove():(o.setLngLat(this._lngLat),o.addTo(this._map)),this):this}_updateOpacity(o=!1){var h,p;if(!(!((h=this._map)===null||h===void 0)&&h.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(o)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const m=this._map,b=m.terrain.depthAtPoint(this._pos),C=m.terrain.getElevationForLngLatZoom(this._lngLat,m.transform.tileZoom);if(m.transform.lngLatToCameraDepth(this._lngLat,C)-b<.006)return void(this._element.style.opacity=this._opacity);const M=-this._offset.y/m.transform._pixelPerMeter,L=Math.sin(m.getPitch()*Math.PI/180)*M,O=m.terrain.depthAtPoint(new a.P(this._pos.x,this._pos.y-this._offset.y)),$=m.transform.lngLatToCameraDepth(this._lngLat,C+L)-O>.006;!((p=this._popup)===null||p===void 0)&&p.isOpen()&&$&&this._popup.remove(),this._element.style.opacity=$?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(o){return this._offset=a.P.convert(o),this._update(),this}addClassName(o){this._element.classList.add(o)}removeClassName(o){this._element.classList.remove(o)}toggleClassName(o){return this._element.classList.toggle(o)}setDraggable(o){return this._draggable=!!o,this._map&&(o?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(o){return this._rotation=o||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(o){return this._rotationAlignment=o||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(o){return this._pitchAlignment=o&&o!=="auto"?o:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(o,h){return o===void 0&&h===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),o!==void 0&&(this._opacity=o),h!==void 0&&(this._opacityWhenCovered=h),this._map&&this._updateOpacity(!0),this}}const Sl={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let $s=0,hs=!1;const Tl={maxWidth:100,unit:"metric"};function Cl(y,o,h){const p=h&&h.maxWidth||100,m=y._container.clientHeight/2,b=y.unproject([0,m]),C=y.unproject([p,m]),M=b.distanceTo(C);if(h&&h.unit==="imperial"){const L=3.2808*M;L>5280?ds(o,p,L/5280,y._getUIString("ScaleControl.Miles")):ds(o,p,L,y._getUIString("ScaleControl.Feet"))}else h&&h.unit==="nautical"?ds(o,p,M/1852,y._getUIString("ScaleControl.NauticalMiles")):M>=1e3?ds(o,p,M/1e3,y._getUIString("ScaleControl.Kilometers")):ds(o,p,M,y._getUIString("ScaleControl.Meters"))}function ds(y,o,h,p){const m=function(b){const C=Math.pow(10,`${Math.floor(b)}`.length-1);let M=b/C;return M=M>=10?10:M>=5?5:M>=3?3:M>=2?2:M>=1?1:function(L){const O=Math.pow(10,Math.ceil(-Math.log(L)/Math.LN10));return Math.round(L*O)/O}(M),C*M}(h);y.style.width=o*(m/h)+"px",y.innerHTML=`${m}&nbsp;${p}`}const Uc={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},Vc=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function El(y){if(y){if(typeof y=="number"){const o=Math.round(Math.abs(y)/Math.SQRT2);return{center:new a.P(0,0),top:new a.P(0,y),"top-left":new a.P(o,o),"top-right":new a.P(-o,o),bottom:new a.P(0,-y),"bottom-left":new a.P(o,-o),"bottom-right":new a.P(-o,-o),left:new a.P(y,0),right:new a.P(-y,0)}}if(y instanceof a.P||Array.isArray(y)){const o=a.P.convert(y);return{center:o,top:o,"top-left":o,"top-right":o,bottom:o,"bottom-left":o,"bottom-right":o,left:o,right:o}}return{center:a.P.convert(y.center||[0,0]),top:a.P.convert(y.top||[0,0]),"top-left":a.P.convert(y["top-left"]||[0,0]),"top-right":a.P.convert(y["top-right"]||[0,0]),bottom:a.P.convert(y.bottom||[0,0]),"bottom-left":a.P.convert(y["bottom-left"]||[0,0]),"bottom-right":a.P.convert(y["bottom-right"]||[0,0]),left:a.P.convert(y.left||[0,0]),right:a.P.convert(y.right||[0,0])}}return El(new a.P(0,0))}const Dh=_;d.AJAXError=a.be,d.Evented=a.E,d.LngLat=a.M,d.MercatorCoordinate=a.Y,d.Point=a.P,d.addProtocol=a.bf,d.config=a.a,d.removeProtocol=a.bg,d.AttributionControl=ao,d.BoxZoomHandler=oo,d.CanvasSource=bi,d.CooperativeGesturesHandler=$t,d.DoubleClickZoomHandler=zc,d.DragPanHandler=Ah,d.DragRotateHandler=so,d.EdgeInsets=Fs,d.FullscreenControl=class extends a.E{constructor(y={}){super(),this._onFullscreenChange=()=>{var o;let h=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((o=h==null?void 0:h.shadowRoot)===null||o===void 0)&&o.fullscreenElement;)h=h.shadowRoot.fullscreenElement;h===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,y&&y.container&&(y.container instanceof HTMLElement?this._container=y.container:a.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(y){return this._map=y,this._container||(this._container=this._map.getContainer()),this._controlContainer=E.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){E.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const y=this._fullscreenButton=E.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);E.create("span","maplibregl-ctrl-icon",y).setAttribute("aria-hidden","true"),y.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const y=this._getTitle();this._fullscreenButton.setAttribute("aria-label",y),this._fullscreenButton.title=y}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new a.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new a.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},d.GeoJSONSource=qe,d.GeolocateControl=class extends a.E{constructor(y){super(),this._onSuccess=o=>{if(this._map){if(this._isOutOfMapMaxBounds(o))return this._setErrorState(),this.fire(new a.k("outofmaxbounds",o)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=o,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(o),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(o),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new a.k("geolocate",o)),this._finish()}},this._updateCamera=o=>{const h=new a.M(o.coords.longitude,o.coords.latitude),p=o.coords.accuracy,m=this._map.getBearing(),b=a.e({bearing:m},this.options.fitBoundsOptions),C=je.fromLngLat(h,p);this._map.fitBounds(C,b,{geolocateSource:!0})},this._updateMarker=o=>{if(o){const h=new a.M(o.coords.longitude,o.coords.latitude);this._accuracyCircleMarker.setLngLat(h).addTo(this._map),this._userLocationDotMarker.setLngLat(h).addTo(this._map),this._accuracy=o.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=o=>{if(this._map){if(this.options.trackUserLocation)if(o.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const h=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(o.code===3&&hs)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new a.k("error",o)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=o=>{if(this._map){if(this._container.addEventListener("contextmenu",h=>h.preventDefault()),this._geolocateButton=E.create("button","maplibregl-ctrl-geolocate",this._container),E.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",o===!1){a.w("Geolocation support is not available so the GeolocateControl will be disabled.");const h=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h)}else{const h=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=E.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new La({element:this._dotElement}),this._circleElement=E.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new La({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",h=>{h.geolocateSource||this._watchState!=="ACTIVE_LOCK"||h.originalEvent&&h.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new a.k("trackuserlocationend")))})}},this.options=a.e({},Sl,y)}onAdd(y){return this._map=y,this._container=E.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(){return a._(this,arguments,void 0,function*(o=!1){if(Do!==void 0&&!o)return Do;if(window.navigator.permissions===void 0)return Do=!!window.navigator.geolocation,Do;try{Do=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{Do=!!window.navigator.geolocation}return Do})}().then(o=>this._setupUI(o)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),E.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,$s=0,hs=!1}_isOutOfMapMaxBounds(y){const o=this._map.getMaxBounds(),h=y.coords;return o&&(h.longitude<o.getWest()||h.longitude>o.getEast()||h.latitude<o.getSouth()||h.latitude>o.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const y=this._map.getBounds(),o=y.getSouthEast(),h=y.getNorthEast(),p=o.distanceTo(h),m=Math.ceil(this._accuracy/(p/this._map._container.clientHeight)*2);this._circleElement.style.width=`${m}px`,this._circleElement.style.height=`${m}px`}trigger(){if(!this._setup)return a.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new a.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":$s--,hs=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new a.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new a.k("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let y;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),$s++,$s>1?(y={maximumAge:6e5,timeout:0},hs=!0):(y=this.options.positionOptions,hs=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,y)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},d.Hash=Ic,d.ImageSource=Ot,d.KeyboardHandler=Jo,d.LngLatBounds=je,d.LogoControl=Ph,d.Map=class extends Sr{constructor(y){if(a.bc.mark(a.bd.create),(y=a.e({},Ma,y)).minZoom!=null&&y.maxZoom!=null&&y.minZoom>y.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(y.minPitch!=null&&y.maxPitch!=null&&y.minPitch>y.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(y.minPitch!=null&&y.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(y.maxPitch!=null&&y.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new ml(y.minZoom,y.maxZoom,y.minPitch,y.maxPitch,y.renderWorldCopies),{bearingSnap:y.bearingSnap}),this._contextLost=o=>{o.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new a.k("webglcontextlost",{originalEvent:o}))},this._contextRestored=o=>{this._setupPainter(),this.resize(),this._update(),this.fire(new a.k("webglcontextrestored",{originalEvent:o}))},this._onMapScroll=o=>{if(o.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=y.interactive,this._maxTileCacheSize=y.maxTileCacheSize,this._maxTileCacheZoomLevels=y.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=y.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=y.preserveDrawingBuffer,this._antialias=y.antialias,this._trackResize=y.trackResize,this._bearingSnap=y.bearingSnap,this._refreshExpiredTiles=y.refreshExpiredTiles,this._fadeDuration=y.fadeDuration,this._crossSourceCollisions=y.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=y.collectResourceTiming,this._renderTaskQueue=new Ca,this._controls=[],this._mapId=a.a3(),this._locale=a.e({},Fc,y.locale),this._clickTolerance=y.clickTolerance,this._overridePixelRatio=y.pixelRatio,this._maxCanvasSize=y.maxCanvasSize,this.transformCameraUpdate=y.transformCameraUpdate,this._imageQueueHandle=j.addThrottleControl(()=>this.isMoving()),this._requestManager=new U(y.transformRequest),typeof y.container=="string"){if(this._container=document.getElementById(y.container),!this._container)throw new Error(`Container '${y.container}' not found.`)}else{if(!(y.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=y.container}if(y.maxBounds&&this.setMaxBounds(y.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let o=!1;const h=Mc(p=>{this._trackResize&&!this._removed&&this.resize(p)._update()},50);this._resizeObserver=new ResizeObserver(p=>{o?h(p):o=!0}),this._resizeObserver.observe(this._container)}this.handlers=new Dc(this,y),this._hash=y.hash&&new Ic(typeof y.hash=="string"&&y.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:y.center,zoom:y.zoom,bearing:y.bearing,pitch:y.pitch}),y.bounds&&(this.resize(),this.fitBounds(y.bounds,a.e({},y.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=y.localIdeographFontFamily,this._validateStyle=y.validateStyle,y.style&&this.setStyle(y.style,{localIdeographFontFamily:y.localIdeographFontFamily}),y.attributionControl&&this.addControl(new ao(typeof y.attributionControl=="boolean"?void 0:y.attributionControl)),y.maplibreLogo&&this.addControl(new Ph,y.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",o=>{this._update(o.dataType==="style"),this.fire(new a.k(`${o.dataType}data`,o))}),this.on("dataloading",o=>{this.fire(new a.k(`${o.dataType}dataloading`,o))}),this.on("dataabort",o=>{this.fire(new a.k("sourcedataabort",o))})}_getMapId(){return this._mapId}addControl(y,o){if(o===void 0&&(o=y.getDefaultPosition?y.getDefaultPosition():"top-right"),!y||!y.onAdd)return this.fire(new a.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const h=y.onAdd(this);this._controls.push(y);const p=this._controlPositions[o];return o.indexOf("bottom")!==-1?p.insertBefore(h,p.firstChild):p.appendChild(h),this}removeControl(y){if(!y||!y.onRemove)return this.fire(new a.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const o=this._controls.indexOf(y);return o>-1&&this._controls.splice(o,1),y.onRemove(this),this}hasControl(y){return this._controls.indexOf(y)>-1}calculateCameraOptionsFromTo(y,o,h,p){return p==null&&this.terrain&&(p=this.terrain.getElevationForLngLatZoom(h,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(y,o,h,p)}resize(y){var o;const h=this._containerDimensions(),p=h[0],m=h[1],b=this._getClampedPixelRatio(p,m);if(this._resizeCanvas(p,m,b),this.painter.resize(p,m,b),this.painter.overLimit()){const M=this.painter.context.gl;this._maxCanvasSize=[M.drawingBufferWidth,M.drawingBufferHeight];const L=this._getClampedPixelRatio(p,m);this._resizeCanvas(p,m,L),this.painter.resize(p,m,L)}this.transform.resize(p,m),(o=this._requestedCameraState)===null||o===void 0||o.resize(p,m);const C=!this._moving;return C&&(this.stop(),this.fire(new a.k("movestart",y)).fire(new a.k("move",y))),this.fire(new a.k("resize",y)),C&&this.fire(new a.k("moveend",y)),this}_getClampedPixelRatio(y,o){const{0:h,1:p}=this._maxCanvasSize,m=this.getPixelRatio(),b=y*m,C=o*m;return Math.min(b>h?h/b:1,C>p?p/C:1)*m}getPixelRatio(){var y;return(y=this._overridePixelRatio)!==null&&y!==void 0?y:devicePixelRatio}setPixelRatio(y){this._overridePixelRatio=y,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(y){return this.transform.setMaxBounds(je.convert(y)),this._update()}setMinZoom(y){if((y=y??-2)>=-2&&y<=this.transform.maxZoom)return this.transform.minZoom=y,this._update(),this.getZoom()<y&&this.setZoom(y),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(y){if((y=y??22)>=this.transform.minZoom)return this.transform.maxZoom=y,this._update(),this.getZoom()>y&&this.setZoom(y),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(y){if((y=y??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(y>=0&&y<=this.transform.maxPitch)return this.transform.minPitch=y,this._update(),this.getPitch()<y&&this.setPitch(y),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(y){if((y=y??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(y>=this.transform.minPitch)return this.transform.maxPitch=y,this._update(),this.getPitch()>y&&this.setPitch(y),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(y){return this.transform.renderWorldCopies=y,this._update()}project(y){return this.transform.locationPoint(a.M.convert(y),this.style&&this.terrain)}unproject(y){return this.transform.pointLocation(a.P.convert(y),this.terrain)}isMoving(){var y;return this._moving||((y=this.handlers)===null||y===void 0?void 0:y.isMoving())}isZooming(){var y;return this._zooming||((y=this.handlers)===null||y===void 0?void 0:y.isZooming())}isRotating(){var y;return this._rotating||((y=this.handlers)===null||y===void 0?void 0:y.isRotating())}_createDelegatedListener(y,o,h){if(y==="mouseenter"||y==="mouseover"){let p=!1;return{layer:o,listener:h,delegates:{mousemove:b=>{const C=this.getLayer(o)?this.queryRenderedFeatures(b.point,{layers:[o]}):[];C.length?p||(p=!0,h.call(this,new kr(y,this,b.originalEvent,{features:C}))):p=!1},mouseout:()=>{p=!1}}}}if(y==="mouseleave"||y==="mouseout"){let p=!1;return{layer:o,listener:h,delegates:{mousemove:C=>{(this.getLayer(o)?this.queryRenderedFeatures(C.point,{layers:[o]}):[]).length?p=!0:p&&(p=!1,h.call(this,new kr(y,this,C.originalEvent)))},mouseout:C=>{p&&(p=!1,h.call(this,new kr(y,this,C.originalEvent)))}}}}{const p=m=>{const b=this.getLayer(o)?this.queryRenderedFeatures(m.point,{layers:[o]}):[];b.length&&(m.features=b,h.call(this,m),delete m.features)};return{layer:o,listener:h,delegates:{[y]:p}}}}on(y,o,h){if(h===void 0)return super.on(y,o);const p=this._createDelegatedListener(y,o,h);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[y]=this._delegatedListeners[y]||[],this._delegatedListeners[y].push(p);for(const m in p.delegates)this.on(m,p.delegates[m]);return this}once(y,o,h){if(h===void 0)return super.once(y,o);const p=this._createDelegatedListener(y,o,h);for(const m in p.delegates)this.once(m,p.delegates[m]);return this}off(y,o,h){return h===void 0?super.off(y,o):(this._delegatedListeners&&this._delegatedListeners[y]&&(p=>{const m=this._delegatedListeners[y];for(let b=0;b<m.length;b++){const C=m[b];if(C.layer===o&&C.listener===h){for(const M in C.delegates)this.off(M,C.delegates[M]);return m.splice(b,1),this}}})(),this)}queryRenderedFeatures(y,o){if(!this.style)return[];let h;const p=y instanceof a.P||Array.isArray(y),m=p?y:[[0,0],[this.transform.width,this.transform.height]];if(o=o||(p?{}:y)||{},m instanceof a.P||typeof m[0]=="number")h=[a.P.convert(m)];else{const b=a.P.convert(m[0]),C=a.P.convert(m[1]);h=[b,new a.P(C.x,b.y),C,new a.P(b.x,C.y),b]}return this.style.queryRenderedFeatures(h,o,this.transform)}querySourceFeatures(y,o){return this.style.querySourceFeatures(y,o)}setStyle(y,o){return(o=a.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},o)).diff!==!1&&o.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&y?(this._diffStyle(y,o),this):(this._localIdeographFontFamily=o.localIdeographFontFamily,this._updateStyle(y,o))}setTransformRequest(y){return this._requestManager.setTransformRequest(y),this}_getUIString(y){const o=this._locale[y];if(o==null)throw new Error(`Missing UI string '${y}'`);return o}_updateStyle(y,o){if(o.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(y,o));const h=this.style&&o.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!y)),y?(this.style=new Rr(this,o||{}),this.style.setEventedParent(this,{style:this.style}),typeof y=="string"?this.style.loadURL(y,o,h):this.style.loadJSON(y,o,h),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Rr(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(y,o){if(typeof y=="string"){const h=this._requestManager.transformRequest(y,"Style");a.h(h,new AbortController).then(p=>{this._updateDiff(p.data,o)}).catch(p=>{p&&this.fire(new a.j(p))})}else typeof y=="object"&&this._updateDiff(y,o)}_updateDiff(y,o){try{this.style.setState(y,o)&&this._update(!0)}catch(h){a.w(`Unable to perform style diff: ${h.message||h.error||h}.  Rebuilding the style from scratch.`),this._updateStyle(y,o)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():a.w("There is no style added to the map.")}addSource(y,o){return this._lazyInitEmptyStyle(),this.style.addSource(y,o),this._update(!0)}isSourceLoaded(y){const o=this.style&&this.style.sourceCaches[y];if(o!==void 0)return o.loaded();this.fire(new a.j(new Error(`There is no source with ID '${y}'`)))}setTerrain(y){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),y){const o=this.style.sourceCaches[y.source];if(!o)throw new Error(`cannot load terrain, because there exists no source with ID: ${y.source}`);this.terrain===null&&o.reload();for(const h in this.style._layers){const p=this.style._layers[h];p.type==="hillshade"&&p.source===y.source&&a.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new zh(this.painter,o,y),this.painter.renderToTexture=new Bc(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=h=>{h.dataType==="style"?this.terrain.sourceCache.freeRtt():h.dataType==="source"&&h.tile&&(h.sourceId!==y.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(h.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new a.k("terrain",{terrain:y})),this}getTerrain(){var y,o;return(o=(y=this.terrain)===null||y===void 0?void 0:y.options)!==null&&o!==void 0?o:null}areTilesLoaded(){const y=this.style&&this.style.sourceCaches;for(const o in y){const h=y[o]._tiles;for(const p in h){const m=h[p];if(m.state!=="loaded"&&m.state!=="errored")return!1}}return!0}removeSource(y){return this.style.removeSource(y),this._update(!0)}getSource(y){return this.style.getSource(y)}addImage(y,o,h={}){const{pixelRatio:p=1,sdf:m=!1,stretchX:b,stretchY:C,content:M}=h;if(this._lazyInitEmptyStyle(),!(o instanceof HTMLImageElement||a.b(o))){if(o.width===void 0||o.height===void 0)return this.fire(new a.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:L,height:O,data:$}=o,q=o;return this.style.addImage(y,{data:new a.R({width:L,height:O},new Uint8Array($)),pixelRatio:p,stretchX:b,stretchY:C,content:M,sdf:m,version:0,userImage:q}),q.onAdd&&q.onAdd(this,y),this}}{const{width:L,height:O,data:$}=S.getImageData(o);this.style.addImage(y,{data:new a.R({width:L,height:O},$),pixelRatio:p,stretchX:b,stretchY:C,content:M,sdf:m,version:0})}}updateImage(y,o){const h=this.style.getImage(y);if(!h)return this.fire(new a.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const p=o instanceof HTMLImageElement||a.b(o)?S.getImageData(o):o,{width:m,height:b,data:C}=p;if(m===void 0||b===void 0)return this.fire(new a.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(m!==h.data.width||b!==h.data.height)return this.fire(new a.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const M=!(o instanceof HTMLImageElement||a.b(o));return h.data.replace(C,M),this.style.updateImage(y,h),this}getImage(y){return this.style.getImage(y)}hasImage(y){return y?!!this.style.getImage(y):(this.fire(new a.j(new Error("Missing required image id"))),!1)}removeImage(y){this.style.removeImage(y)}loadImage(y){return j.getImage(this._requestManager.transformRequest(y,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(y,o){return this._lazyInitEmptyStyle(),this.style.addLayer(y,o),this._update(!0)}moveLayer(y,o){return this.style.moveLayer(y,o),this._update(!0)}removeLayer(y){return this.style.removeLayer(y),this._update(!0)}getLayer(y){return this.style.getLayer(y)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(y,o,h){return this.style.setLayerZoomRange(y,o,h),this._update(!0)}setFilter(y,o,h={}){return this.style.setFilter(y,o,h),this._update(!0)}getFilter(y){return this.style.getFilter(y)}setPaintProperty(y,o,h,p={}){return this.style.setPaintProperty(y,o,h,p),this._update(!0)}getPaintProperty(y,o){return this.style.getPaintProperty(y,o)}setLayoutProperty(y,o,h,p={}){return this.style.setLayoutProperty(y,o,h,p),this._update(!0)}getLayoutProperty(y,o){return this.style.getLayoutProperty(y,o)}setGlyphs(y,o={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(y,o),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(y,o,h={}){return this._lazyInitEmptyStyle(),this.style.addSprite(y,o,h,p=>{p||this._update(!0)}),this}removeSprite(y){return this._lazyInitEmptyStyle(),this.style.removeSprite(y),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(y,o={}){return this._lazyInitEmptyStyle(),this.style.setSprite(y,o,h=>{h||this._update(!0)}),this}setLight(y,o={}){return this._lazyInitEmptyStyle(),this.style.setLight(y,o),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(y,o){return this.style.setFeatureState(y,o),this._update()}removeFeatureState(y,o){return this.style.removeFeatureState(y,o),this._update()}getFeatureState(y){return this.style.getFeatureState(y)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let y=0,o=0;return this._container&&(y=this._container.clientWidth||400,o=this._container.clientHeight||300),[y,o]}_setupContainer(){const y=this._container;y.classList.add("maplibregl-map");const o=this._canvasContainer=E.create("div","maplibregl-canvas-container",y);this._interactive&&o.classList.add("maplibregl-interactive"),this._canvas=E.create("canvas","maplibregl-canvas",o),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const h=this._containerDimensions(),p=this._getClampedPixelRatio(h[0],h[1]);this._resizeCanvas(h[0],h[1],p);const m=this._controlContainer=E.create("div","maplibregl-control-container",y),b=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(C=>{b[C]=E.create("div",`maplibregl-ctrl-${C} `,m)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(y,o,h){this._canvas.width=Math.floor(h*y),this._canvas.height=Math.floor(h*o),this._canvas.style.width=`${y}px`,this._canvas.style.height=`${o}px`}_setupPainter(){const y={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let o=null;this._canvas.addEventListener("webglcontextcreationerror",p=>{o={requestedAttributes:y},p&&(o.statusMessage=p.statusMessage,o.type=p.type)},{once:!0});const h=this._canvas.getContext("webgl2",y)||this._canvas.getContext("webgl",y);if(!h){const p="Failed to initialize WebGL";throw o?(o.message=p,new Error(JSON.stringify(o))):new Error(p)}this.painter=new bh(h,this.transform),A.testSupport(h)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(y){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||y,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(y){return this._update(),this._renderTaskQueue.add(y)}_cancelRenderFrame(y){this._renderTaskQueue.remove(y)}_render(y){const o=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(y),this._removed)return;let h=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const m=this.transform.zoom,b=S.now();this.style.zoomHistory.update(m,b);const C=new a.a8(m,{now:b,fadeDuration:o,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),M=C.crossFadingFactor();M===1&&M===this._crossFadingFactor||(h=!0,this._crossFadingFactor=M),this.style.update(C)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,o,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:o,showPadding:this.showPadding}),this.fire(new a.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,a.bc.mark(a.bd.load),this.fire(new a.k("load"))),this.style&&(this.style.hasTransitions()||h)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const p=this._sourcesDirty||this._styleDirty||this._placementDirty;return p||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new a.k("idle")),!this._loaded||this._fullyLoaded||p||(this._fullyLoaded=!0,a.bc.mark(a.bd.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var y;this._hash&&this._hash.remove();for(const h of this._controls)h.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),j.removeThrottleControl(this._imageQueueHandle),(y=this._resizeObserver)===null||y===void 0||y.disconnect();const o=this.painter.context.gl.getExtension("WEBGL_lose_context");o&&o.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),E.remove(this._canvasContainer),E.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),a.bc.clearMetrics(),this._removed=!0,this.fire(new a.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,S.frameAsync(this._frameRequest).then(y=>{a.bc.frame(y),this._frameRequest=null,this._render(y)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(y){this._showTileBoundaries!==y&&(this._showTileBoundaries=y,this._update())}get showPadding(){return!!this._showPadding}set showPadding(y){this._showPadding!==y&&(this._showPadding=y,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(y){this._showCollisionBoxes!==y&&(this._showCollisionBoxes=y,y?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(y){this._showOverdrawInspector!==y&&(this._showOverdrawInspector=y,this._update())}get repaint(){return!!this._repaint}set repaint(y){this._repaint!==y&&(this._repaint=y,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(y){this._vertices=y,this._update()}get version(){return Oc}getCameraTargetElevation(){return this.transform.elevation}},d.MapMouseEvent=kr,d.MapTouchEvent=yo,d.MapWheelEvent=Lc,d.Marker=La,d.NavigationControl=class{constructor(y){this._updateZoomButtons=()=>{const o=this._map.getZoom(),h=o===this._map.getMaxZoom(),p=o===this._map.getMinZoom();this._zoomInButton.disabled=h,this._zoomOutButton.disabled=p,this._zoomInButton.setAttribute("aria-disabled",h.toString()),this._zoomOutButton.setAttribute("aria-disabled",p.toString())},this._rotateCompassArrow=()=>{const o=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=o},this._setButtonTitle=(o,h)=>{const p=this._map._getUIString(`NavigationControl.${h}`);o.title=p,o.setAttribute("aria-label",p)},this.options=a.e({},Nc,y),this._container=E.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",o=>o.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",o=>this._map.zoomIn({},{originalEvent:o})),E.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",o=>this._map.zoomOut({},{originalEvent:o})),E.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",o=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:o}):this._map.resetNorth({},{originalEvent:o})}),this._compassIcon=E.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(y){return this._map=y,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new jc(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){E.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(y,o){const h=E.create("button",y,this._container);return h.type="button",h.addEventListener("click",o),h}},d.Popup=class extends a.E{constructor(y){super(),this.remove=()=>(this._content&&E.remove(this._content),this._container&&(E.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new a.k("close"))),this),this._onMouseUp=o=>{this._update(o.point)},this._onMouseMove=o=>{this._update(o.point)},this._onDrag=o=>{this._update(o.point)},this._update=o=>{var h;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=E.create("div","maplibregl-popup",this._map.getContainer()),this._tip=E.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const M of this.options.className.split(" "))this._container.classList.add(M);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?xl(this._lngLat,this._flatPos,this._map.transform):(h=this._lngLat)===null||h===void 0?void 0:h.wrap(),this._trackPointer&&!o)return;const p=this._flatPos=this._pos=this._trackPointer&&o?o:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&o?o:this._map.transform.locationPoint(this._lngLat));let m=this.options.anchor;const b=El(this.options.offset);if(!m){const M=this._container.offsetWidth,L=this._container.offsetHeight;let O;O=p.y+b.bottom.y<L?["top"]:p.y>this._map.transform.height-L?["bottom"]:[],p.x<M/2?O.push("left"):p.x>this._map.transform.width-M/2&&O.push("right"),m=O.length===0?"bottom":O.join("-")}let C=p.add(b[m]);this.options.subpixelPositioning||(C=C.round()),E.setTransform(this._container,`${Ia[m]} translate(${C.x}px,${C.y}px)`),kl(this._container,m,"popup")},this._onClose=()=>{this.remove()},this.options=a.e(Object.create(Uc),y)}addTo(y){return this._map&&this.remove(),this._map=y,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new a.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(y){return this._lngLat=a.M.convert(y),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(y){return this.setDOMContent(document.createTextNode(y))}setHTML(y){const o=document.createDocumentFragment(),h=document.createElement("body");let p;for(h.innerHTML=y;p=h.firstChild,p;)o.appendChild(p);return this.setDOMContent(o)}getMaxWidth(){var y;return(y=this._container)===null||y===void 0?void 0:y.style.maxWidth}setMaxWidth(y){return this.options.maxWidth=y,this._update(),this}setDOMContent(y){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=E.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(y),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(y){this._container&&this._container.classList.add(y)}removeClassName(y){this._container&&this._container.classList.remove(y)}setOffset(y){return this.options.offset=y,this._update(),this}toggleClassName(y){if(this._container)return this._container.classList.toggle(y)}setSubpixelPositioning(y){this.options.subpixelPositioning=y}_createCloseButton(){this.options.closeButton&&(this._closeButton=E.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const y=this._container.querySelector(Vc);y&&y.focus()}},d.RasterDEMTileSource=Ei,d.RasterTileSource=we,d.ScaleControl=class{constructor(y){this._onMove=()=>{Cl(this._map,this._container,this.options)},this.setUnit=o=>{this.options.unit=o,Cl(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},Tl),y)}getDefaultPosition(){return"bottom-left"}onAdd(y){return this._map=y,this._container=E.create("div","maplibregl-ctrl maplibregl-ctrl-scale",y.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){E.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},d.ScrollZoomHandler=vl,d.Style=Rr,d.TerrainControl=class{constructor(y){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=y}onAdd(y){return this._map=y,this._container=E.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=E.create("button","maplibregl-ctrl-terrain",this._container),E.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){E.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},d.TwoFingersTouchPitchHandler=Mh,d.TwoFingersTouchRotateHandler=Pc,d.TwoFingersTouchZoomHandler=Eh,d.TwoFingersTouchZoomRotateHandler=Sa,d.VectorTileSource=vt,d.VideoSource=Pi,d.addSourceType=(y,o)=>a._(void 0,void 0,void 0,function*(){if(Mn(y))throw new Error(`A source type called "${y}" already exists.`);((h,p)=>{gn[h]=p})(y,o)}),d.clearPrewarmedResources=function(){const y=ti;y&&(y.isPreloaded()&&y.numActive()===1?(y.release(At),ti=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},d.getMaxParallelImageRequests=function(){return a.a.MAX_PARALLEL_IMAGE_REQUESTS},d.getRTLTextPluginStatus=function(){return nt().getRTLTextPluginStatus()},d.getVersion=function(){return Dh},d.getWorkerCount=function(){return ei.workerCount},d.getWorkerUrl=function(){return a.a.WORKER_URL},d.importScriptInWorkers=function(y){return zi().broadcast("IS",y)},d.prewarm=function(){Jt().acquire(At)},d.setMaxParallelImageRequests=function(y){a.a.MAX_PARALLEL_IMAGE_REQUESTS=y},d.setRTLTextPlugin=function(y,o){return nt().setRTLTextPlugin(y,o)},d.setWorkerCount=function(y){ei.workerCount=y},d.setWorkerUrl=function(y){a.a.WORKER_URL=y}});var u=t;return u})})(l0);var Ts=l0.exports;const to=a0(Ts),Ab=sb({__proto__:null,default:to},[Ts]);let qt;const u0=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&u0.decode();let yu=null;function Cu(){return(yu===null||yu.byteLength===0)&&(yu=new Uint8Array(qt.memory.buffer)),yu}function Co(r,e){return r=r>>>0,u0.decode(Cu().subarray(r,r+e))}const ws=new Array(128).fill(void 0);ws.push(void 0,null,!0,!1);let Eu=ws.length;function Vn(r){Eu===ws.length&&ws.push(ws.length+1);const e=Eu;return Eu=ws[e],ws[e]=r,e}function Ci(r){return ws[r]}function Pb(r){r<132||(ws[r]=Eu,Eu=r)}function Wl(r){const e=Ci(r);return Pb(r),e}function Hf(r){return r==null}let vu=null;function zb(){return(vu===null||vu.byteLength===0)&&(vu=new Float64Array(qt.memory.buffer)),vu}let bu=null;function Ri(){return(bu===null||bu.byteLength===0)&&(bu=new Int32Array(qt.memory.buffer)),bu}let Js=0;const cd=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},Db=typeof cd.encodeInto=="function"?function(r,e){return cd.encodeInto(r,e)}:function(r,e){const t=cd.encode(r);return e.set(t),{read:r.length,written:t.length}};function rd(r,e,t){if(t===void 0){const a=cd.encode(r),_=e(a.length,1)>>>0;return Cu().subarray(_,_+a.length).set(a),Js=a.length,_}let i=r.length,l=e(i,1)>>>0;const u=Cu();let d=0;for(;d<i;d++){const a=r.charCodeAt(d);if(a>127)break;u[l+d]=a}if(d!==i){d!==0&&(r=r.slice(d)),l=t(l,i,i=d+r.length*3,1)>>>0;const a=Cu().subarray(l+d,l+i),_=Db(r,a);d+=_.written}return Js=d,l}function ap(r){const e=typeof r;if(e=="number"||e=="boolean"||r==null)return`${r}`;if(e=="string")return`"${r}"`;if(e=="symbol"){const l=r.description;return l==null?"Symbol":`Symbol(${l})`}if(e=="function"){const l=r.name;return typeof l=="string"&&l.length>0?`Function(${l})`:"Function"}if(Array.isArray(r)){const l=r.length;let u="[";l>0&&(u+=ap(r[0]));for(let d=1;d<l;d++)u+=", "+ap(r[d]);return u+="]",u}const t=/\[object ([^\]]+)\]/.exec(toString.call(r));let i;if(t.length>1)i=t[1];else return toString.call(r);if(i=="Object")try{return"Object("+JSON.stringify(r)+")"}catch{return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:i}function Rb(r,e){const t=e(r.length*1,1)>>>0;return Cu().set(r,t/1),Js=r.length,t}function Xf(r,e){try{return r.apply(this,e)}catch(t){qt.__wbindgen_exn_store(Vn(t))}}class bd{static __wrap(e){e=e>>>0;const t=Object.create(bd.prototype);return t.__wbg_ptr=e,t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();qt.__wbg_jsroutesnapper_free(e)}constructor(e){try{const u=qt.__wbindgen_add_to_stack_pointer(-16),d=Rb(e,qt.__wbindgen_malloc),a=Js;qt.jsroutesnapper_new(u,d,a);var t=Ri()[u/4+0],i=Ri()[u/4+1],l=Ri()[u/4+2];if(l)throw Wl(i);return bd.__wrap(t)}finally{qt.__wbindgen_add_to_stack_pointer(16)}}setRouteConfig(e){qt.jsroutesnapper_setRouteConfig(this.__wbg_ptr,Vn(e))}setAreaMode(){qt.jsroutesnapper_setAreaMode(this.__wbg_ptr)}getConfig(){let e,t;try{const u=qt.__wbindgen_add_to_stack_pointer(-16);qt.jsroutesnapper_getConfig(u,this.__wbg_ptr);var i=Ri()[u/4+0],l=Ri()[u/4+1];return e=i,t=l,Co(i,l)}finally{qt.__wbindgen_add_to_stack_pointer(16),qt.__wbindgen_free(e,t,1)}}toFinalFeature(){try{const i=qt.__wbindgen_add_to_stack_pointer(-16);qt.jsroutesnapper_toFinalFeature(i,this.__wbg_ptr);var e=Ri()[i/4+0],t=Ri()[i/4+1];let l;return e!==0&&(l=Co(e,t).slice(),qt.__wbindgen_free(e,t*1)),l}finally{qt.__wbindgen_add_to_stack_pointer(16)}}renderGeojson(){let e,t;try{const u=qt.__wbindgen_add_to_stack_pointer(-16);qt.jsroutesnapper_renderGeojson(u,this.__wbg_ptr);var i=Ri()[u/4+0],l=Ri()[u/4+1];return e=i,t=l,Co(i,l)}finally{qt.__wbindgen_add_to_stack_pointer(16),qt.__wbindgen_free(e,t,1)}}toggleSnapMode(){qt.jsroutesnapper_toggleSnapMode(this.__wbg_ptr)}onMouseMove(e,t,i){return qt.jsroutesnapper_onMouseMove(this.__wbg_ptr,e,t,i)!==0}onClick(){qt.jsroutesnapper_onClick(this.__wbg_ptr)}onDragStart(){return qt.jsroutesnapper_onDragStart(this.__wbg_ptr)!==0}onMouseUp(){return qt.jsroutesnapper_onMouseUp(this.__wbg_ptr)!==0}clearState(){qt.jsroutesnapper_clearState(this.__wbg_ptr)}editExisting(e){try{const l=qt.__wbindgen_add_to_stack_pointer(-16);qt.jsroutesnapper_editExisting(l,this.__wbg_ptr,Vn(e));var t=Ri()[l/4+0],i=Ri()[l/4+1];if(i)throw Wl(t)}finally{qt.__wbindgen_add_to_stack_pointer(16)}}debugRenderGraph(){let e,t;try{const u=qt.__wbindgen_add_to_stack_pointer(-16);qt.jsroutesnapper_debugRenderGraph(u,this.__wbg_ptr);var i=Ri()[u/4+0],l=Ri()[u/4+1];return e=i,t=l,Co(i,l)}finally{qt.__wbindgen_add_to_stack_pointer(16),qt.__wbindgen_free(e,t,1)}}debugSnappableNodes(){let e,t;try{const u=qt.__wbindgen_add_to_stack_pointer(-16);qt.jsroutesnapper_debugSnappableNodes(u,this.__wbg_ptr);var i=Ri()[u/4+0],l=Ri()[u/4+1];return e=i,t=l,Co(i,l)}finally{qt.__wbindgen_add_to_stack_pointer(16),qt.__wbindgen_free(e,t,1)}}routeNameForWaypoints(e){let t,i;try{const k=qt.__wbindgen_add_to_stack_pointer(-16);qt.jsroutesnapper_routeNameForWaypoints(k,this.__wbg_ptr,Vn(e));var l=Ri()[k/4+0],u=Ri()[k/4+1],d=Ri()[k/4+2],a=Ri()[k/4+3],_=l,v=u;if(a)throw _=0,v=0,Wl(d);return t=_,i=v,Co(_,v)}finally{qt.__wbindgen_add_to_stack_pointer(16),qt.__wbindgen_free(t,i,1)}}addSnappedWaypoint(e,t){qt.jsroutesnapper_addSnappedWaypoint(this.__wbg_ptr,e,t)}undo(){qt.jsroutesnapper_undo(this.__wbg_ptr)}calculateRoute(e){let t,i;try{const k=qt.__wbindgen_add_to_stack_pointer(-16);qt.jsroutesnapper_calculateRoute(k,this.__wbg_ptr,Vn(e));var l=Ri()[k/4+0],u=Ri()[k/4+1],d=Ri()[k/4+2],a=Ri()[k/4+3],_=l,v=u;if(a)throw _=0,v=0,Wl(d);return t=_,i=v,Co(_,v)}finally{qt.__wbindgen_add_to_stack_pointer(16),qt.__wbindgen_free(t,i,1)}}getExtraNodes(e,t){let i,l;try{const S=qt.__wbindgen_add_to_stack_pointer(-16);qt.jsroutesnapper_getExtraNodes(S,this.__wbg_ptr,Vn(e),Vn(t));var u=Ri()[S/4+0],d=Ri()[S/4+1],a=Ri()[S/4+2],_=Ri()[S/4+3],v=u,k=d;if(_)throw v=0,k=0,Wl(a);return i=v,l=k,Co(v,k)}finally{qt.__wbindgen_add_to_stack_pointer(16),qt.__wbindgen_free(i,l,1)}}}async function Bb(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(i){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",i);else throw i}const t=await r.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(r,e);return t instanceof WebAssembly.Instance?{instance:t,module:r}:t}}function Fb(){const r={};return r.wbg={},r.wbg.__wbindgen_string_new=function(e,t){const i=Co(e,t);return Vn(i)},r.wbg.__wbindgen_object_drop_ref=function(e){Wl(e)},r.wbg.__wbindgen_error_new=function(e,t){const i=new Error(Co(e,t));return Vn(i)},r.wbg.__wbindgen_number_get=function(e,t){const i=Ci(t),l=typeof i=="number"?i:void 0;zb()[e/8+1]=Hf(l)?0:l,Ri()[e/4+0]=!Hf(l)},r.wbg.__wbindgen_is_object=function(e){const t=Ci(e);return typeof t=="object"&&t!==null},r.wbg.__wbindgen_is_undefined=function(e){return Ci(e)===void 0},r.wbg.__wbindgen_in=function(e,t){return Ci(e)in Ci(t)},r.wbg.__wbindgen_boolean_get=function(e){const t=Ci(e);return typeof t=="boolean"?t?1:0:2},r.wbg.__wbindgen_jsval_loose_eq=function(e,t){return Ci(e)==Ci(t)},r.wbg.__wbindgen_string_get=function(e,t){const i=Ci(t),l=typeof i=="string"?i:void 0;var u=Hf(l)?0:rd(l,qt.__wbindgen_malloc,qt.__wbindgen_realloc),d=Js;Ri()[e/4+1]=d,Ri()[e/4+0]=u},r.wbg.__wbg_String_4370c5505c674d30=function(e,t){const i=String(Ci(t)),l=rd(i,qt.__wbindgen_malloc,qt.__wbindgen_realloc),u=Js;Ri()[e/4+1]=u,Ri()[e/4+0]=l},r.wbg.__wbindgen_object_clone_ref=function(e){const t=Ci(e);return Vn(t)},r.wbg.__wbg_getwithrefkey_d1f0d12f1f1b63ea=function(e,t){const i=Ci(e)[Ci(t)];return Vn(i)},r.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return Vn(e)},r.wbg.__wbg_stack_658279fe44541cf6=function(e,t){const i=Ci(t).stack,l=rd(i,qt.__wbindgen_malloc,qt.__wbindgen_realloc),u=Js;Ri()[e/4+1]=u,Ri()[e/4+0]=l},r.wbg.__wbg_error_f851667af71bcfc6=function(e,t){let i,l;try{i=e,l=t,console.error(Co(e,t))}finally{qt.__wbindgen_free(i,l,1)}},r.wbg.__wbg_debug_9a6b3243fbbebb61=function(e){console.debug(Ci(e))},r.wbg.__wbg_error_788ae33f81d3b84b=function(e){console.error(Ci(e))},r.wbg.__wbg_info_2e30e8204b29d91d=function(e){console.info(Ci(e))},r.wbg.__wbg_log_1d3ae0273d8f4f8a=function(e){console.log(Ci(e))},r.wbg.__wbg_warn_d60e832f9882c1b2=function(e){console.warn(Ci(e))},r.wbg.__wbg_get_44be0491f933a435=function(e,t){const i=Ci(e)[t>>>0];return Vn(i)},r.wbg.__wbg_length_fff51ee6522a1a18=function(e){return Ci(e).length},r.wbg.__wbindgen_is_function=function(e){return typeof Ci(e)=="function"},r.wbg.__wbg_next_526fc47e980da008=function(e){const t=Ci(e).next;return Vn(t)},r.wbg.__wbg_next_ddb3312ca1c4e32a=function(){return Xf(function(e){const t=Ci(e).next();return Vn(t)},arguments)},r.wbg.__wbg_done_5c1f01fb660d73b5=function(e){return Ci(e).done},r.wbg.__wbg_value_1695675138684bd5=function(e){const t=Ci(e).value;return Vn(t)},r.wbg.__wbg_iterator_97f0c81209c6c35a=function(){return Vn(Symbol.iterator)},r.wbg.__wbg_get_97b561fb56f034b5=function(){return Xf(function(e,t){const i=Reflect.get(Ci(e),Ci(t));return Vn(i)},arguments)},r.wbg.__wbg_call_cb65541d95d71282=function(){return Xf(function(e,t){const i=Ci(e).call(Ci(t));return Vn(i)},arguments)},r.wbg.__wbg_isArray_4c24b343cb13cfb1=function(e){return Array.isArray(Ci(e))},r.wbg.__wbg_instanceof_ArrayBuffer_39ac22089b74fddb=function(e){let t;try{t=Ci(e)instanceof ArrayBuffer}catch{t=!1}return t},r.wbg.__wbg_buffer_085ec1f694018c4f=function(e){const t=Ci(e).buffer;return Vn(t)},r.wbg.__wbg_new_8125e318e6245eed=function(e){const t=new Uint8Array(Ci(e));return Vn(t)},r.wbg.__wbg_set_5cf90238115182c3=function(e,t,i){Ci(e).set(Ci(t),i>>>0)},r.wbg.__wbg_length_72e2208bbc0efc61=function(e){return Ci(e).length},r.wbg.__wbg_instanceof_Uint8Array_d8d9cb2b8e8ac1d4=function(e){let t;try{t=Ci(e)instanceof Uint8Array}catch{t=!1}return t},r.wbg.__wbindgen_debug_string=function(e,t){const i=ap(Ci(t)),l=rd(i,qt.__wbindgen_malloc,qt.__wbindgen_realloc),u=Js;Ri()[e/4+1]=u,Ri()[e/4+0]=l},r.wbg.__wbindgen_throw=function(e,t){throw new Error(Co(e,t))},r.wbg.__wbindgen_memory=function(){const e=qt.memory;return Vn(e)},r}function Ob(r,e){return qt=r.exports,h0.__wbindgen_wasm_module=e,vu=null,bu=null,yu=null,qt}async function h0(r){if(qt!==void 0)return qt;typeof r>"u"&&(r="/ltn/assets/route_snapper_bg.wasm");const e=Fb();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:t,module:i}=await Bb(await r,e);return Ob(t,i)}var Ar=63710088e-1,Pp={centimeters:Ar*100,centimetres:Ar*100,degrees:Ar/111325,feet:Ar*3.28084,inches:Ar*39.37,kilometers:Ar/1e3,kilometres:Ar/1e3,meters:Ar,metres:Ar,miles:Ar/1609.344,millimeters:Ar*1e3,millimetres:Ar*1e3,nauticalmiles:Ar/1852,radians:1,yards:Ar*1.0936},Nb={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/Ar,yards:1.0936133},lp={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function Ao(r,e,t){t===void 0&&(t={});var i={type:"Feature"};return(t.id===0||t.id)&&(i.id=t.id),t.bbox&&(i.bbox=t.bbox),i.properties=e||{},i.geometry=r,i}function jb(r,e,t){switch(r){case"Point":return eo(e).geometry;case"LineString":return Mo(e).geometry;case"Polygon":return zp(e).geometry;case"MultiPoint":return f0(e).geometry;case"MultiLineString":return d0(e).geometry;case"MultiPolygon":return p0(e).geometry;default:throw new Error(r+" is invalid")}}function eo(r,e,t){if(t===void 0&&(t={}),!r)throw new Error("coordinates is required");if(!Array.isArray(r))throw new Error("coordinates must be an Array");if(r.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!wd(r[0])||!wd(r[1]))throw new Error("coordinates must contain numbers");var i={type:"Point",coordinates:r};return Ao(i,e,t)}function Ub(r,e,t){return t===void 0&&(t={}),Oa(r.map(function(i){return eo(i,e)}),t)}function zp(r,e,t){t===void 0&&(t={});for(var i=0,l=r;i<l.length;i++){var u=l[i];if(u.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var d=0;d<u[u.length-1].length;d++)if(u[u.length-1][d]!==u[0][d])throw new Error("First and last Position are not equivalent.")}var a={type:"Polygon",coordinates:r};return Ao(a,e,t)}function Vb(r,e,t){return t===void 0&&(t={}),Oa(r.map(function(i){return zp(i,e)}),t)}function Mo(r,e,t){if(t===void 0&&(t={}),r.length<2)throw new Error("coordinates must be an array of two or more positions");var i={type:"LineString",coordinates:r};return Ao(i,e,t)}function $b(r,e,t){return t===void 0&&(t={}),Oa(r.map(function(i){return Mo(i,e)}),t)}function Oa(r,e){e===void 0&&(e={});var t={type:"FeatureCollection"};return e.id&&(t.id=e.id),e.bbox&&(t.bbox=e.bbox),t.features=r,t}function d0(r,e,t){t===void 0&&(t={});var i={type:"MultiLineString",coordinates:r};return Ao(i,e,t)}function f0(r,e,t){t===void 0&&(t={});var i={type:"MultiPoint",coordinates:r};return Ao(i,e,t)}function p0(r,e,t){t===void 0&&(t={});var i={type:"MultiPolygon",coordinates:r};return Ao(i,e,t)}function qb(r,e,t){t===void 0&&(t={});var i={type:"GeometryCollection",geometries:r};return Ao(i,e,t)}function Zb(r,e){if(e===void 0&&(e=0),e&&!(e>=0))throw new Error("precision must be a positive number");var t=Math.pow(10,e||0);return Math.round(r*t)/t}function Dp(r,e){e===void 0&&(e="kilometers");var t=Pp[e];if(!t)throw new Error(e+" units is invalid");return r*t}function zd(r,e){e===void 0&&(e="kilometers");var t=Pp[e];if(!t)throw new Error(e+" units is invalid");return r/t}function Gb(r,e){return Pu(zd(r,e))}function Wb(r){var e=r%360;return e<0&&(e+=360),e}function Pu(r){var e=r%(2*Math.PI);return e*180/Math.PI}function Io(r){var e=r%360;return e*Math.PI/180}function Hb(r,e,t){if(e===void 0&&(e="kilometers"),t===void 0&&(t="kilometers"),!(r>=0))throw new Error("length must be a positive number");return Dp(zd(r,e),t)}function Xb(r,e,t){if(e===void 0&&(e="meters"),t===void 0&&(t="kilometers"),!(r>=0))throw new Error("area must be a positive number");var i=lp[e];if(!i)throw new Error("invalid original units");var l=lp[t];if(!l)throw new Error("invalid final units");return r/i*l}function wd(r){return!isNaN(r)&&r!==null&&!Array.isArray(r)}function Rp(r){return!!r&&r.constructor===Object}function Kb(r){if(!r)throw new Error("bbox is required");if(!Array.isArray(r))throw new Error("bbox must be an Array");if(r.length!==4&&r.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");r.forEach(function(e){if(!wd(e))throw new Error("bbox must only contain numbers")})}function Jb(r){if(!r)throw new Error("id is required");if(["string","number"].indexOf(typeof r)===-1)throw new Error("id must be a number or a string")}const Yb=Object.freeze(Object.defineProperty({__proto__:null,areaFactors:lp,bearingToAzimuth:Wb,convertArea:Xb,convertLength:Hb,degreesToRadians:Io,earthRadius:Ar,factors:Pp,feature:Ao,featureCollection:Oa,geometry:jb,geometryCollection:qb,isNumber:wd,isObject:Rp,lengthToDegrees:Gb,lengthToRadians:zd,lineString:Mo,lineStrings:$b,multiLineString:d0,multiPoint:f0,multiPolygon:p0,point:eo,points:Ub,polygon:zp,polygons:Vb,radiansToDegrees:Pu,radiansToLength:Dp,round:Zb,unitsFactors:Nb,validateBBox:Kb,validateId:Jb},Symbol.toStringTag,{value:"Module"}));function zu(r){if(!r)throw new Error("coord is required");if(!Array.isArray(r)){if(r.type==="Feature"&&r.geometry!==null&&r.geometry.type==="Point")return r.geometry.coordinates;if(r.type==="Point")return r.coordinates}if(Array.isArray(r)&&r.length>=2&&!Array.isArray(r[0])&&!Array.isArray(r[1]))return r;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function rc(r){if(Array.isArray(r))return r;if(r.type==="Feature"){if(r.geometry!==null)return r.geometry.coordinates}else if(r.coordinates)return r.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function hu(r,e,t){t===void 0&&(t={});var i=zu(r),l=zu(e),u=Io(l[1]-i[1]),d=Io(l[0]-i[0]),a=Io(i[1]),_=Io(l[1]),v=Math.pow(Math.sin(u/2),2)+Math.pow(Math.sin(d/2),2)*Math.cos(a)*Math.cos(_);return Dp(2*Math.atan2(Math.sqrt(v),Math.sqrt(1-v)),t.units)}function Gu(r,e,t){if(r!==null)for(var i,l,u,d,a,_,v,k=0,S=0,E,A=r.type,D=A==="FeatureCollection",B=A==="Feature",P=D?r.features.length:1,R=0;R<P;R++){v=D?r.features[R].geometry:B?r.geometry:r,E=v?v.type==="GeometryCollection":!1,a=E?v.geometries.length:1;for(var F=0;F<a;F++){var j=0,U=0;if(d=E?v.geometries[F]:v,d!==null){_=d.coordinates;var le=d.type;switch(k=t&&(le==="Polygon"||le==="MultiPolygon")?1:0,le){case null:break;case"Point":if(e(_,S,R,j,U)===!1)return!1;S++,j++;break;case"LineString":case"MultiPoint":for(i=0;i<_.length;i++){if(e(_[i],S,R,j,U)===!1)return!1;S++,le==="MultiPoint"&&j++}le==="LineString"&&j++;break;case"Polygon":case"MultiLineString":for(i=0;i<_.length;i++){for(l=0;l<_[i].length-k;l++){if(e(_[i][l],S,R,j,U)===!1)return!1;S++}le==="MultiLineString"&&j++,le==="Polygon"&&U++}le==="Polygon"&&j++;break;case"MultiPolygon":for(i=0;i<_.length;i++){for(U=0,l=0;l<_[i].length;l++){for(u=0;u<_[i][l].length-k;u++){if(e(_[i][l][u],S,R,j,U)===!1)return!1;S++}U++}j++}break;case"GeometryCollection":for(i=0;i<d.geometries.length;i++)if(Gu(d.geometries[i],e,t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Qb(r,e,t,i){var l=t;return Gu(r,function(u,d,a,_,v){d===0&&t===void 0?l=u:l=e(l,u,d,a,_,v)},i),l}function m0(r,e){var t;switch(r.type){case"FeatureCollection":for(t=0;t<r.features.length&&e(r.features[t].properties,t)!==!1;t++);break;case"Feature":e(r.properties,0);break}}function ew(r,e,t){var i=t;return m0(r,function(l,u){u===0&&t===void 0?i=l:i=e(i,l,u)}),i}function xd(r,e){if(r.type==="Feature")e(r,0);else if(r.type==="FeatureCollection")for(var t=0;t<r.features.length&&e(r.features[t],t)!==!1;t++);}function tw(r,e,t){var i=t;return xd(r,function(l,u){u===0&&t===void 0?i=l:i=e(i,l,u)}),i}function iw(r){var e=[];return Gu(r,function(t){e.push(t)}),e}function Bp(r,e){var t,i,l,u,d,a,_,v,k,S,E=0,A=r.type==="FeatureCollection",D=r.type==="Feature",B=A?r.features.length:1;for(t=0;t<B;t++){for(a=A?r.features[t].geometry:D?r.geometry:r,v=A?r.features[t].properties:D?r.properties:{},k=A?r.features[t].bbox:D?r.bbox:void 0,S=A?r.features[t].id:D?r.id:void 0,_=a?a.type==="GeometryCollection":!1,d=_?a.geometries.length:1,l=0;l<d;l++){if(u=_?a.geometries[l]:a,u===null){if(e(null,E,v,k,S)===!1)return!1;continue}switch(u.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(u,E,v,k,S)===!1)return!1;break}case"GeometryCollection":{for(i=0;i<u.geometries.length;i++)if(e(u.geometries[i],E,v,k,S)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}E++}}function nw(r,e,t){var i=t;return Bp(r,function(l,u,d,a,_){u===0&&t===void 0?i=l:i=e(i,l,u,d,a,_)}),i}function ac(r,e){Bp(r,function(t,i,l,u,d){var a=t===null?null:t.type;switch(a){case null:case"Point":case"LineString":case"Polygon":return e(Ao(t,l,{bbox:u,id:d}),i,0)===!1?!1:void 0}var _;switch(a){case"MultiPoint":_="Point";break;case"MultiLineString":_="LineString";break;case"MultiPolygon":_="Polygon";break}for(var v=0;v<t.coordinates.length;v++){var k=t.coordinates[v],S={type:_,coordinates:k};if(e(Ao(S,l),i,v)===!1)return!1}})}function rw(r,e,t){var i=t;return ac(r,function(l,u,d){u===0&&d===0&&t===void 0?i=l:i=e(i,l,u,d)}),i}function g0(r,e){ac(r,function(t,i,l){var u=0;if(t.geometry){var d=t.geometry.type;if(!(d==="Point"||d==="MultiPoint")){var a,_=0,v=0,k=0;if(Gu(t,function(S,E,A,D,B){if(a===void 0||i>_||D>v||B>k){a=S,_=i,v=D,k=B,u=0;return}var P=Mo([a,S],t.properties);if(e(P,i,l,B,u)===!1)return!1;u++,a=S})===!1)return!1}}})}function ow(r,e,t){var i=t,l=!1;return g0(r,function(u,d,a,_,v){l===!1&&t===void 0?i=u:i=e(i,u,d,a,_,v),l=!0}),i}function _0(r,e){if(!r)throw new Error("geojson is required");ac(r,function(t,i,l){if(t.geometry!==null){var u=t.geometry.type,d=t.geometry.coordinates;switch(u){case"LineString":if(e(t,i,l,0,0)===!1)return!1;break;case"Polygon":for(var a=0;a<d.length;a++)if(e(Mo(d[a],t.properties),i,l,a)===!1)return!1;break}}})}function sw(r,e,t){var i=t;return _0(r,function(l,u,d,a){u===0&&t===void 0?i=l:i=e(i,l,u,d,a)}),i}function aw(r,e){if(e=e||{},!Rp(e))throw new Error("options is invalid");var t=e.featureIndex||0,i=e.multiFeatureIndex||0,l=e.geometryIndex||0,u=e.segmentIndex||0,d=e.properties,a;switch(r.type){case"FeatureCollection":t<0&&(t=r.features.length+t),d=d||r.features[t].properties,a=r.features[t].geometry;break;case"Feature":d=d||r.properties,a=r.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":a=r;break;default:throw new Error("geojson is invalid")}if(a===null)return null;var _=a.coordinates;switch(a.type){case"Point":case"MultiPoint":return null;case"LineString":return u<0&&(u=_.length+u-1),Mo([_[u],_[u+1]],d,e);case"Polygon":return l<0&&(l=_.length+l),u<0&&(u=_[l].length+u-1),Mo([_[l][u],_[l][u+1]],d,e);case"MultiLineString":return i<0&&(i=_.length+i),u<0&&(u=_[i].length+u-1),Mo([_[i][u],_[i][u+1]],d,e);case"MultiPolygon":return i<0&&(i=_.length+i),l<0&&(l=_[i].length+l),u<0&&(u=_[i][l].length-u-1),Mo([_[i][l][u],_[i][l][u+1]],d,e)}throw new Error("geojson is invalid")}function lw(r,e){if(e=e||{},!Rp(e))throw new Error("options is invalid");var t=e.featureIndex||0,i=e.multiFeatureIndex||0,l=e.geometryIndex||0,u=e.coordIndex||0,d=e.properties,a;switch(r.type){case"FeatureCollection":t<0&&(t=r.features.length+t),d=d||r.features[t].properties,a=r.features[t].geometry;break;case"Feature":d=d||r.properties,a=r.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":a=r;break;default:throw new Error("geojson is invalid")}if(a===null)return null;var _=a.coordinates;switch(a.type){case"Point":return eo(_,d,e);case"MultiPoint":return i<0&&(i=_.length+i),eo(_[i],d,e);case"LineString":return u<0&&(u=_.length+u),eo(_[u],d,e);case"Polygon":return l<0&&(l=_.length+l),u<0&&(u=_[l].length+u),eo(_[l][u],d,e);case"MultiLineString":return i<0&&(i=_.length+i),u<0&&(u=_[i].length+u),eo(_[i][u],d,e);case"MultiPolygon":return i<0&&(i=_.length+i),l<0&&(l=_[i].length+l),u<0&&(u=_[i][l].length-u),eo(_[i][l][u],d,e)}throw new Error("geojson is invalid")}const cw=Object.freeze(Object.defineProperty({__proto__:null,coordAll:iw,coordEach:Gu,coordReduce:Qb,featureEach:xd,featureReduce:tw,findPoint:lw,findSegment:aw,flattenEach:ac,flattenReduce:rw,geomEach:Bp,geomReduce:nw,lineEach:_0,lineReduce:sw,propEach:m0,propReduce:ew,segmentEach:g0,segmentReduce:ow},Symbol.toStringTag,{value:"Module"}));function y0(r,e,t){if(t===void 0&&(t={}),t.final===!0)return uw(r,e);var i=zu(r),l=zu(e),u=Io(i[0]),d=Io(l[0]),a=Io(i[1]),_=Io(l[1]),v=Math.sin(d-u)*Math.cos(_),k=Math.cos(a)*Math.sin(_)-Math.sin(a)*Math.cos(_)*Math.cos(d-u);return Pu(Math.atan2(v,k))}function uw(r,e){var t=y0(e,r);return t=(t+180)%360,t}function zg(r,e,t,i){i===void 0&&(i={});var l=zu(r),u=Io(l[0]),d=Io(l[1]),a=Io(t),_=zd(e,i.units),v=Math.asin(Math.sin(d)*Math.cos(_)+Math.cos(d)*Math.sin(_)*Math.cos(a)),k=u+Math.atan2(Math.sin(a)*Math.sin(_)*Math.cos(d),Math.cos(_)-Math.sin(d)*Math.sin(v)),S=Pu(k),E=Pu(v);return eo([S,E],i.properties)}function Dg(r){if(!r)throw new Error("geojson is required");var e=[];return ac(r,function(t){hw(t,e)}),Oa(e)}function hw(r,e){var t=[],i=r.geometry;if(i!==null){switch(i.type){case"Polygon":t=rc(i);break;case"LineString":t=[rc(i)]}t.forEach(function(l){var u=dw(l,r.properties);u.forEach(function(d){d.id=e.length,e.push(d)})})}}function dw(r,e){var t=[];return r.reduce(function(i,l){var u=Mo([i,l],e);return u.bbox=fw(i,l),t.push(u),l}),t}function fw(r,e){var t=r[0],i=r[1],l=e[0],u=e[1],d=t<l?t:l,a=i<u?i:u,_=t>l?t:l,v=i>u?i:u;return[d,a,_,v]}var Fp={exports:{}},v0={exports:{}};(function(r,e){(function(t,i){r.exports=i()})(s0,function(){function t(F,j,U,le,he){(function Z(Q,ye,Ne,re,ve){for(;re>Ne;){if(re-Ne>600){var Ke=re-Ne+1,Le=ye-Ne+1,et=Math.log(Ke),xt=.5*Math.exp(2*et/3),mt=.5*Math.sqrt(et*xt*(Ke-xt)/Ke)*(Le-Ke/2<0?-1:1),at=Math.max(Ne,Math.floor(ye-Le*xt/Ke+mt)),Ht=Math.min(re,Math.floor(ye+(Ke-Le)*xt/Ke+mt));Z(Q,ye,at,Ht,ve)}var ri=Q[ye],Nt=Ne,At=re;for(i(Q,Ne,ye),ve(Q[re],ri)>0&&i(Q,Ne,re);Nt<At;){for(i(Q,Nt,At),Nt++,At--;ve(Q[Nt],ri)<0;)Nt++;for(;ve(Q[At],ri)>0;)At--}ve(Q[Ne],ri)===0?i(Q,Ne,At):i(Q,++At,re),At<=ye&&(Ne=At+1),ye<=At&&(re=At-1)}})(F,j,U||0,le||F.length-1,he||l)}function i(F,j,U){var le=F[j];F[j]=F[U],F[U]=le}function l(F,j){return F<j?-1:F>j?1:0}var u=function(F){F===void 0&&(F=9),this._maxEntries=Math.max(4,F),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function d(F,j,U){if(!U)return j.indexOf(F);for(var le=0;le<j.length;le++)if(U(F,j[le]))return le;return-1}function a(F,j){_(F,0,F.children.length,j,F)}function _(F,j,U,le,he){he||(he=P(null)),he.minX=1/0,he.minY=1/0,he.maxX=-1/0,he.maxY=-1/0;for(var Z=j;Z<U;Z++){var Q=F.children[Z];v(he,F.leaf?le(Q):Q)}return he}function v(F,j){return F.minX=Math.min(F.minX,j.minX),F.minY=Math.min(F.minY,j.minY),F.maxX=Math.max(F.maxX,j.maxX),F.maxY=Math.max(F.maxY,j.maxY),F}function k(F,j){return F.minX-j.minX}function S(F,j){return F.minY-j.minY}function E(F){return(F.maxX-F.minX)*(F.maxY-F.minY)}function A(F){return F.maxX-F.minX+(F.maxY-F.minY)}function D(F,j){return F.minX<=j.minX&&F.minY<=j.minY&&j.maxX<=F.maxX&&j.maxY<=F.maxY}function B(F,j){return j.minX<=F.maxX&&j.minY<=F.maxY&&j.maxX>=F.minX&&j.maxY>=F.minY}function P(F){return{children:F,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function R(F,j,U,le,he){for(var Z=[j,U];Z.length;)if(!((U=Z.pop())-(j=Z.pop())<=le)){var Q=j+Math.ceil((U-j)/le/2)*le;t(F,Q,j,U,he),Z.push(j,Q,Q,U)}}return u.prototype.all=function(){return this._all(this.data,[])},u.prototype.search=function(F){var j=this.data,U=[];if(!B(F,j))return U;for(var le=this.toBBox,he=[];j;){for(var Z=0;Z<j.children.length;Z++){var Q=j.children[Z],ye=j.leaf?le(Q):Q;B(F,ye)&&(j.leaf?U.push(Q):D(F,ye)?this._all(Q,U):he.push(Q))}j=he.pop()}return U},u.prototype.collides=function(F){var j=this.data;if(!B(F,j))return!1;for(var U=[];j;){for(var le=0;le<j.children.length;le++){var he=j.children[le],Z=j.leaf?this.toBBox(he):he;if(B(F,Z)){if(j.leaf||D(F,Z))return!0;U.push(he)}}j=U.pop()}return!1},u.prototype.load=function(F){if(!F||!F.length)return this;if(F.length<this._minEntries){for(var j=0;j<F.length;j++)this.insert(F[j]);return this}var U=this._build(F.slice(),0,F.length-1,0);if(this.data.children.length)if(this.data.height===U.height)this._splitRoot(this.data,U);else{if(this.data.height<U.height){var le=this.data;this.data=U,U=le}this._insert(U,this.data.height-U.height-1,!0)}else this.data=U;return this},u.prototype.insert=function(F){return F&&this._insert(F,this.data.height-1),this},u.prototype.clear=function(){return this.data=P([]),this},u.prototype.remove=function(F,j){if(!F)return this;for(var U,le,he,Z=this.data,Q=this.toBBox(F),ye=[],Ne=[];Z||ye.length;){if(Z||(Z=ye.pop(),le=ye[ye.length-1],U=Ne.pop(),he=!0),Z.leaf){var re=d(F,Z.children,j);if(re!==-1)return Z.children.splice(re,1),ye.push(Z),this._condense(ye),this}he||Z.leaf||!D(Z,Q)?le?(U++,Z=le.children[U],he=!1):Z=null:(ye.push(Z),Ne.push(U),U=0,le=Z,Z=Z.children[0])}return this},u.prototype.toBBox=function(F){return F},u.prototype.compareMinX=function(F,j){return F.minX-j.minX},u.prototype.compareMinY=function(F,j){return F.minY-j.minY},u.prototype.toJSON=function(){return this.data},u.prototype.fromJSON=function(F){return this.data=F,this},u.prototype._all=function(F,j){for(var U=[];F;)F.leaf?j.push.apply(j,F.children):U.push.apply(U,F.children),F=U.pop();return j},u.prototype._build=function(F,j,U,le){var he,Z=U-j+1,Q=this._maxEntries;if(Z<=Q)return a(he=P(F.slice(j,U+1)),this.toBBox),he;le||(le=Math.ceil(Math.log(Z)/Math.log(Q)),Q=Math.ceil(Z/Math.pow(Q,le-1))),(he=P([])).leaf=!1,he.height=le;var ye=Math.ceil(Z/Q),Ne=ye*Math.ceil(Math.sqrt(Q));R(F,j,U,Ne,this.compareMinX);for(var re=j;re<=U;re+=Ne){var ve=Math.min(re+Ne-1,U);R(F,re,ve,ye,this.compareMinY);for(var Ke=re;Ke<=ve;Ke+=ye){var Le=Math.min(Ke+ye-1,ve);he.children.push(this._build(F,Ke,Le,le-1))}}return a(he,this.toBBox),he},u.prototype._chooseSubtree=function(F,j,U,le){for(;le.push(j),!j.leaf&&le.length-1!==U;){for(var he=1/0,Z=1/0,Q=void 0,ye=0;ye<j.children.length;ye++){var Ne=j.children[ye],re=E(Ne),ve=(Ke=F,Le=Ne,(Math.max(Le.maxX,Ke.maxX)-Math.min(Le.minX,Ke.minX))*(Math.max(Le.maxY,Ke.maxY)-Math.min(Le.minY,Ke.minY))-re);ve<Z?(Z=ve,he=re<he?re:he,Q=Ne):ve===Z&&re<he&&(he=re,Q=Ne)}j=Q||j.children[0]}var Ke,Le;return j},u.prototype._insert=function(F,j,U){var le=U?F:this.toBBox(F),he=[],Z=this._chooseSubtree(le,this.data,j,he);for(Z.children.push(F),v(Z,le);j>=0&&he[j].children.length>this._maxEntries;)this._split(he,j),j--;this._adjustParentBBoxes(le,he,j)},u.prototype._split=function(F,j){var U=F[j],le=U.children.length,he=this._minEntries;this._chooseSplitAxis(U,he,le);var Z=this._chooseSplitIndex(U,he,le),Q=P(U.children.splice(Z,U.children.length-Z));Q.height=U.height,Q.leaf=U.leaf,a(U,this.toBBox),a(Q,this.toBBox),j?F[j-1].children.push(Q):this._splitRoot(U,Q)},u.prototype._splitRoot=function(F,j){this.data=P([F,j]),this.data.height=F.height+1,this.data.leaf=!1,a(this.data,this.toBBox)},u.prototype._chooseSplitIndex=function(F,j,U){for(var le,he,Z,Q,ye,Ne,re,ve=1/0,Ke=1/0,Le=j;Le<=U-j;Le++){var et=_(F,0,Le,this.toBBox),xt=_(F,Le,U,this.toBBox),mt=(he=et,Z=xt,Q=void 0,ye=void 0,Ne=void 0,re=void 0,Q=Math.max(he.minX,Z.minX),ye=Math.max(he.minY,Z.minY),Ne=Math.min(he.maxX,Z.maxX),re=Math.min(he.maxY,Z.maxY),Math.max(0,Ne-Q)*Math.max(0,re-ye)),at=E(et)+E(xt);mt<ve?(ve=mt,le=Le,Ke=at<Ke?at:Ke):mt===ve&&at<Ke&&(Ke=at,le=Le)}return le||U-j},u.prototype._chooseSplitAxis=function(F,j,U){var le=F.leaf?this.compareMinX:k,he=F.leaf?this.compareMinY:S;this._allDistMargin(F,j,U,le)<this._allDistMargin(F,j,U,he)&&F.children.sort(le)},u.prototype._allDistMargin=function(F,j,U,le){F.children.sort(le);for(var he=this.toBBox,Z=_(F,0,j,he),Q=_(F,U-j,U,he),ye=A(Z)+A(Q),Ne=j;Ne<U-j;Ne++){var re=F.children[Ne];v(Z,F.leaf?he(re):re),ye+=A(Z)}for(var ve=U-j-1;ve>=j;ve--){var Ke=F.children[ve];v(Q,F.leaf?he(Ke):Ke),ye+=A(Q)}return ye},u.prototype._adjustParentBBoxes=function(F,j,U){for(var le=U;le>=0;le--)v(j[le],F)},u.prototype._condense=function(F){for(var j=F.length-1,U=void 0;j>=0;j--)F[j].children.length===0?j>0?(U=F[j-1].children).splice(U.indexOf(F[j]),1):this.clear():a(F[j],this.toBBox)},u})})(v0);var pw=v0.exports;const mw=Ap(Yb),gw=Ap(cw);function b0(r,e,t){if(r!==null)for(var i,l,u,d,a,_,v,k=0,S=0,E,A=r.type,D=A==="FeatureCollection",B=A==="Feature",P=D?r.features.length:1,R=0;R<P;R++){v=D?r.features[R].geometry:B?r.geometry:r,E=v?v.type==="GeometryCollection":!1,a=E?v.geometries.length:1;for(var F=0;F<a;F++){var j=0,U=0;if(d=E?v.geometries[F]:v,d!==null){_=d.coordinates;var le=d.type;switch(k=t&&(le==="Polygon"||le==="MultiPolygon")?1:0,le){case null:break;case"Point":if(e(_,S,R,j,U)===!1)return!1;S++,j++;break;case"LineString":case"MultiPoint":for(i=0;i<_.length;i++){if(e(_[i],S,R,j,U)===!1)return!1;S++,le==="MultiPoint"&&j++}le==="LineString"&&j++;break;case"Polygon":case"MultiLineString":for(i=0;i<_.length;i++){for(l=0;l<_[i].length-k;l++){if(e(_[i][l],S,R,j,U)===!1)return!1;S++}le==="MultiLineString"&&j++,le==="Polygon"&&U++}le==="Polygon"&&j++;break;case"MultiPolygon":for(i=0;i<_.length;i++){for(U=0,l=0;l<_[i].length;l++){for(u=0;u<_[i][l].length-k;u++){if(e(_[i][l][u],S,R,j,U)===!1)return!1;S++}U++}j++}break;case"GeometryCollection":for(i=0;i<d.geometries.length;i++)if(b0(d.geometries[i],e,t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function w0(r,e={}){if(r.bbox!=null&&e.recompute!==!0)return r.bbox;const t=[1/0,1/0,-1/0,-1/0];return b0(r,i=>{t[0]>i[0]&&(t[0]=i[0]),t[1]>i[1]&&(t[1]=i[1]),t[2]<i[0]&&(t[2]=i[0]),t[3]<i[1]&&(t[3]=i[1])}),t}var _w=w0;const yw=Object.freeze(Object.defineProperty({__proto__:null,bbox:w0,default:_w},Symbol.toStringTag,{value:"Module"})),vw=Ap(yw);var ns=pw,x0=mw,k0=gw,Ul=vw.default,bw=k0.featureEach;k0.coordEach;x0.polygon;var Rg=x0.featureCollection;function S0(r){var e=new ns(r);return e.insert=function(t){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:Ul(t),ns.prototype.insert.call(this,t)},e.load=function(t){var i=[];return Array.isArray(t)?t.forEach(function(l){if(l.type!=="Feature")throw new Error("invalid features");l.bbox=l.bbox?l.bbox:Ul(l),i.push(l)}):bw(t,function(l){if(l.type!=="Feature")throw new Error("invalid features");l.bbox=l.bbox?l.bbox:Ul(l),i.push(l)}),ns.prototype.load.call(this,i)},e.remove=function(t,i){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:Ul(t),ns.prototype.remove.call(this,t,i)},e.clear=function(){return ns.prototype.clear.call(this)},e.search=function(t){var i=ns.prototype.search.call(this,this.toBBox(t));return Rg(i)},e.collides=function(t){return ns.prototype.collides.call(this,this.toBBox(t))},e.all=function(){var t=ns.prototype.all.call(this);return Rg(t)},e.toJSON=function(){return ns.prototype.toJSON.call(this)},e.fromJSON=function(t){return ns.prototype.fromJSON.call(this,t)},e.toBBox=function(t){var i;if(t.bbox)i=t.bbox;else if(Array.isArray(t)&&t.length===4)i=t;else if(Array.isArray(t)&&t.length===6)i=[t[0],t[1],t[3],t[4]];else if(t.type==="Feature")i=Ul(t);else if(t.type==="FeatureCollection")i=Ul(t);else throw new Error("invalid geojson");return{minX:i[0],minY:i[1],maxX:i[2],maxY:i[3]}},e}Fp.exports=S0;Fp.exports.default=S0;var ww=Fp.exports;const xw=a0(ww);function kw(r,e){var t={},i=[];if(r.type==="LineString"&&(r=Ao(r)),e.type==="LineString"&&(e=Ao(e)),r.type==="Feature"&&e.type==="Feature"&&r.geometry!==null&&e.geometry!==null&&r.geometry.type==="LineString"&&e.geometry.type==="LineString"&&r.geometry.coordinates.length===2&&e.geometry.coordinates.length===2){var l=Bg(r,e);return l&&i.push(l),Oa(i)}var u=xw();return u.load(Dg(e)),xd(Dg(r),function(d){xd(u.search(d),function(a){var _=Bg(d,a);if(_){var v=rc(_).join(",");t[v]||(t[v]=!0,i.push(_))}})}),Oa(i)}function Bg(r,e){var t=rc(r),i=rc(e);if(t.length!==2)throw new Error("<intersects> line1 must only contain 2 coordinates");if(i.length!==2)throw new Error("<intersects> line2 must only contain 2 coordinates");var l=t[0][0],u=t[0][1],d=t[1][0],a=t[1][1],_=i[0][0],v=i[0][1],k=i[1][0],S=i[1][1],E=(S-v)*(d-l)-(k-_)*(a-u),A=(k-_)*(u-v)-(S-v)*(l-_),D=(d-l)*(u-v)-(a-u)*(l-_);if(E===0)return null;var B=A/E,P=D/E;if(B>=0&&B<=1&&P>=0&&P<=1){var R=l+B*(d-l),F=u+B*(a-u);return eo([R,F])}return null}function Sw(r,e,t){t===void 0&&(t={});var i=eo([1/0,1/0],{dist:1/0}),l=0;return ac(r,function(u){for(var d=rc(u),a=0;a<d.length-1;a++){var _=eo(d[a]);_.properties.dist=hu(e,_,t);var v=eo(d[a+1]);v.properties.dist=hu(e,v,t);var k=hu(_,v,t),S=Math.max(_.properties.dist,v.properties.dist),E=y0(_,v),A=zg(e,S,E+90,t),D=zg(e,S,E-90,t),B=kw(Mo([A.geometry.coordinates,D.geometry.coordinates]),Mo([_.geometry.coordinates,v.geometry.coordinates])),P=null;B.features.length>0&&(P=B.features[0],P.properties.dist=hu(e,P,t),P.properties.location=l+hu(_,P,t)),_.properties.dist<i.properties.dist&&(i=_,i.properties.index=a,i.properties.location=l),v.properties.dist<i.properties.dist&&(i=v,i.properties.index=a+1,i.properties.location=l+k),P&&P.properties.dist<i.properties.dist&&(i=P,i.properties.index=a),l+=k}}),i}const Tw=30;class Cw{constructor(e,t,i,l,u){this.onMouseMove=d=>{if(!this.active)return;const a=[d.point.x-Tw,d.point.y],_=this.map.unproject(d.point).distanceTo(this.map.unproject(a));this.inner.onMouseMove(d.lngLat.lng,d.lngLat.lat,_)&&(this.redraw(),this.dataUpdated())},this.onClick=()=>{this.active&&(this.inner.onClick(),this.redraw(),this.dataUpdated())},this.onDoubleClick=d=>{this.active&&(d.preventDefault(),this.inner.onClick(),this.finish())},this.onDragStart=()=>{this.active&&this.inner.onDragStart()&&this.map.dragPan.disable()},this.onMouseUp=()=>{this.active&&this.inner.onMouseUp()&&this.map.dragPan.enable()},this.onKeyDown=d=>{if(!this.active)return;let a=d.target.tagName;a=="INPUT"||a=="TEXTAREA"||d.key=="Escape"&&(d.stopPropagation(),this.cancel())},this.onKeyPress=d=>{if(!this.active)return;let a=d.target.tagName;a=="INPUT"||a=="TEXTAREA"||(d.key=="Enter"?(d.stopPropagation(),this.finish()):d.key=="s"||d.key=="S"?(d.stopPropagation(),this.inner.toggleSnapMode(),this.redraw()):d.key=="z"&&d.ctrlKey&&this.undo())},this.map=e,console.time("Deserialize and setup JsRouteSnapper"),this.inner=new bd(t),console.timeEnd("Deserialize and setup JsRouteSnapper"),this.active=!1,this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[],this.routeToolGj=i,this.snapMode=l,this.undoLength=u,this.map.on("mousemove",this.onMouseMove),this.map.on("click",this.onClick),this.map.on("dblclick",this.onDoubleClick),this.map.on("dragstart",this.onDragStart),this.map.on("mouseup",this.onMouseUp),document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keypress",this.onKeyPress)}tearDown(){this.map.off("mousemove",this.onMouseMove),this.map.off("click",this.onClick),this.map.off("dblclick",this.onDoubleClick),this.map.off("dragstart",this.onDragStart),this.map.off("mouseup",this.onMouseUp),document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keypress",this.onKeyPress)}startRoute(){this.active||(this.active=!0,this.map.boxZoom.disable(),this.map.doubleClickZoom.disable())}startArea(){this.active||(this.inner.setAreaMode(),this.active=!0,this.map.boxZoom.disable(),this.map.doubleClickZoom.disable())}stop(){this.active=!1,this.inner.clearState(),this.redraw(),this.map.boxZoom.enable(),this.map.doubleClickZoom.enable()}editExistingRoute(e){this.active&&window.alert("Bug: editExistingRoute called when tool is already active"),e.properties.waypoints||(e.properties.waypoints=[{lon:e.geometry.coordinates[0][0],lat:e.geometry.coordinates[0][1],snapped:!0},{lon:e.geometry.coordinates[e.geometry.coordinates.length-1][0],lat:e.geometry.coordinates[e.geometry.coordinates.length-1][1],snapped:!0}]),this.startRoute(),this.inner.editExisting(e.properties.waypoints),this.redraw()}editExistingArea(e){this.active&&window.alert("Bug: editExistingArea called when tool is already active"),e.properties.waypoints||window.alert("Bug: editExistingArea called for a polygon not produced by the route-snapper"),this.startArea(),this.inner.editExisting(e.properties.waypoints),this.redraw()}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerUpdated(e){this.eventListenersUpdated.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}clearEventListeners(){this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[]}isActive(){return this.active}finish(){let e=this.inner.toFinalFeature();if(e)for(let t of this.eventListenersSuccess)t(JSON.parse(e));else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){this.inner.clearState(),this.finish()}setRouteConfig(e){this.inner.setRouteConfig(e),this.redraw()}addSnappedWaypoint(e){this.inner.addSnappedWaypoint(e[0],e[1]),this.redraw()}undo(){this.inner.undo(),this.redraw()}toggleSnapMode(){this.inner.toggleSnapMode(),this.redraw()}redraw(){let e=JSON.parse(this.inner.renderGeojson());this.routeToolGj.set(e),this.map.getCanvas().style.cursor=e.cursor,this.snapMode.set(e.snap_mode),this.undoLength.set(e.undo_length)}dataUpdated(){let e=this.inner.toFinalFeature();if(e)for(let t of this.eventListenersUpdated)t(JSON.parse(e))}}const Vl=[];function Kf(r,e){return{subscribe:ki(r,e).subscribe}}function ki(r,e=It){let t;const i=new Set;function l(a){if(zt(r,a)&&(r=a,t)){const _=!Vl.length;for(const v of i)v[1](),Vl.push(v,r);if(_){for(let v=0;v<Vl.length;v+=2)Vl[v][0](Vl[v+1]);Vl.length=0}}}function u(a){l(a(r))}function d(a,_=It){const v=[a,_];return i.add(v),i.size===1&&(t=e(l,u)||It),a(r),()=>{i.delete(v),i.size===0&&t&&(t(),t=null)}}return{set:l,update:u,subscribe:d}}const cp="MZEJTanw3WpxRvt7qDfo";let qo=ki(null),Du=ki(!1),Cs=ki(""),kd=ki(!0),Dn=ki(null),Ru=ki(new Ts.LngLat(0,0)),Bu=ki(new Ts.LngLat(0,0)),ud=ki(new Ts.LngLat(0,0)),Fg=ki(1),bs=ki(1),Wt=ki({mode:"title",firstLoad:!0}),up=ki("streets-v2"),hp=ki("walk_cycle_only"),Og=ki(!1),Fu=ki(!1),Sd=ki("shortcuts"),dp=ki(!1);function oc(){let r=Pr(Cs);r||window.alert("Autosave failed; no projectName set?!"),window.localStorage.setItem(r,JSON.stringify(Pr(Dn).toSavefile()))}function Ng(r){let e,t;return e=new Ad({props:{$$slots:{default:[Ew,({dialog:i})=>({3:i}),({dialog:i})=>i?8:0]},$$scope:{ctx:r}}}),e.$on("close",r[2]),{c(){Ie(e.$$.fragment)},m(i,l){Ee(e,i,l),t=!0},p(i,l){const u={};l&24&&(u.$$scope={dirty:l,ctx:i}),e.$set(u)},i(i){t||(J(e.$$.fragment,i),t=!0)},o(i){ne(e.$$.fragment,i),t=!1},d(i){Me(e,i)}}}function Ew(r){let e,t,i,l,u,d,a,_,v,k,S,E,A,D;function B(){return r[1](r[3])}return{c(){e=oe("h1"),e.textContent="The low-traffic neighbourhood (LTN) tool, v2",t=Ae(),i=oe("p"),i.innerHTML=`This is an <b>experimental</b>
      version of the
      <a href="https://a-b-street.github.io/docs/software/ltn/index.html" target="_blank">A/B Street LTN tool</a>
      . Most parts of it do not work yet, and you should probably use the other version
      of the tool instead.`,l=Ae(),u=oe("p"),u.textContent="To use this tool, you need to:",d=Ae(),a=oe("ol"),a.innerHTML=`<li>Choose your study area to analyze</li> <li>Define one or more neighbourhood boundaries</li> <li>Optionally, fix the basemap data on existing modal filters, turn
        restrictions, one-ways, etc</li> <li>Create one or more proposals with new modal filters, and explore their
        effects</li>`,_=Ae(),v=oe("p"),v.innerHTML=`This tool is created by <a href="https://github.com/dabreegster/" target="_blank">Dustin Carlino</a>
      and relies heavily on
      <a href="https://www.openstreetmap.org/about" target="_blank">OpenStreetMap</a>
      data.`,k=Ae(),S=oe("center"),E=oe("button"),E.textContent="Start!"},m(P,R){ae(P,e,R),ae(P,t,R),ae(P,i,R),ae(P,l,R),ae(P,u,R),ae(P,d,R),ae(P,a,R),ae(P,_,R),ae(P,v,R),ae(P,k,R),ae(P,S,R),G(S,E),A||(D=St(E,"click",B),A=!0)},p(P,R){r=P},d(P){P&&(se(e),se(t),se(i),se(l),se(u),se(d),se(a),se(_),se(v),se(k),se(S)),A=!1,D()}}}function Mw(r){let e,t,i=r[0]&&Ng(r);return{c(){i&&i.c(),e=En()},m(l,u){i&&i.m(l,u),ae(l,e,u),t=!0},p(l,[u]){l[0]?i?(i.p(l,u),u&1&&J(i,1)):(i=Ng(l),i.c(),J(i,1),i.m(e.parentNode,e)):i&&(yi(),ne(i,1,1,()=>{i=null}),vi())},i(l){t||(J(i),t=!0)},o(l){ne(i),t=!1},d(l){l&&se(e),i&&i.d(l)}}}function Iw(r,e,t){let i;return lt(r,kd,d=>t(0,i=d)),[i,d=>vr(d).close(),()=>Tt(kd,i=!1,i)]}class Lw extends Vt{constructor(e){super(),Ut(this,e,Iw,Mw,zt,{})}}let ot;const xs=new Array(128).fill(void 0);xs.push(void 0,null,!0,!1);function pi(r){return xs[r]}let Mu=xs.length;function Aw(r){r<132||(xs[r]=Mu,Mu=r)}function nr(r){const e=pi(r);return Aw(r),e}let qr=0,wu=null;function Jl(){return(wu===null||wu.byteLength===0)&&(wu=new Uint8Array(ot.memory.buffer)),wu}const hd=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},Pw=typeof hd.encodeInto=="function"?function(r,e){return hd.encodeInto(r,e)}:function(r,e){const t=hd.encode(r);return e.set(t),{read:r.length,written:t.length}};function No(r,e,t){if(t===void 0){const a=hd.encode(r),_=e(a.length,1)>>>0;return Jl().subarray(_,_+a.length).set(a),qr=a.length,_}let i=r.length,l=e(i,1)>>>0;const u=Jl();let d=0;for(;d<i;d++){const a=r.charCodeAt(d);if(a>127)break;u[l+d]=a}if(d!==i){d!==0&&(r=r.slice(d)),l=t(l,i,i=d+r.length*3,1)>>>0;const a=Jl().subarray(l+d,l+i),_=Pw(r,a);d+=_.written}return qr=d,l}function Hl(r){return r==null}let xu=null;function Rt(){return(xu===null||xu.byteLength===0)&&(xu=new Int32Array(ot.memory.buffer)),xu}let ku=null;function T0(){return(ku===null||ku.byteLength===0)&&(ku=new Float64Array(ot.memory.buffer)),ku}function Yi(r){Mu===xs.length&&xs.push(xs.length+1);const e=Mu;return Mu=xs[e],xs[e]=r,e}const C0=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&C0.decode();function yr(r,e){return r=r>>>0,C0.decode(Jl().subarray(r,r+e))}let Su=null;function zw(){return(Su===null||Su.byteLength===0)&&(Su=new BigInt64Array(ot.memory.buffer)),Su}function fp(r){const e=typeof r;if(e=="number"||e=="boolean"||r==null)return`${r}`;if(e=="string")return`"${r}"`;if(e=="symbol"){const l=r.description;return l==null?"Symbol":`Symbol(${l})`}if(e=="function"){const l=r.name;return typeof l=="string"&&l.length>0?`Function(${l})`:"Function"}if(Array.isArray(r)){const l=r.length;let u="[";l>0&&(u+=fp(r[0]));for(let d=1;d<l;d++)u+=", "+fp(r[d]);return u+="]",u}const t=/\[object ([^\]]+)\]/.exec(toString.call(r));let i;if(t.length>1)i=t[1];else return toString.call(r);if(i=="Object")try{return"Object("+JSON.stringify(r)+")"}catch{return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:i}function Dw(r,e){const t=e(r.length*1,1)>>>0;return Jl().set(r,t/1),qr=r.length,t}function Rw(r,e){return r=r>>>0,T0().subarray(r/8,r/8+e)}function Bw(r,e){return r=r>>>0,Jl().subarray(r/1,r/1+e)}function Ra(r,e){try{return r.apply(this,e)}catch(t){ot.__wbindgen_exn_store(Yi(t))}}class Fw{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();ot.__wbg_ltn_free(e)}constructor(e,t,i){try{const v=ot.__wbindgen_add_to_stack_pointer(-16),k=Dw(e,ot.__wbindgen_malloc),S=qr;var l=Hl(i)?0:No(i,ot.__wbindgen_malloc,ot.__wbindgen_realloc),u=qr;ot.ltn_new(v,k,S,Yi(t),l,u);var d=Rt()[v/4+0],a=Rt()[v/4+1],_=Rt()[v/4+2];if(_)throw nr(a);return this.__wbg_ptr=d>>>0,this}finally{ot.__wbindgen_add_to_stack_pointer(16)}}getInvertedBoundary(){let e,t;try{const v=ot.__wbindgen_add_to_stack_pointer(-16);ot.ltn_getInvertedBoundary(v,this.__wbg_ptr);var i=Rt()[v/4+0],l=Rt()[v/4+1],u=Rt()[v/4+2],d=Rt()[v/4+3],a=i,_=l;if(d)throw a=0,_=0,nr(u);return e=a,t=_,yr(a,_)}finally{ot.__wbindgen_add_to_stack_pointer(16),ot.__wbindgen_free(e,t,1)}}getBounds(){try{const l=ot.__wbindgen_add_to_stack_pointer(-16);ot.ltn_getBounds(l,this.__wbg_ptr);var e=Rt()[l/4+0],t=Rt()[l/4+1],i=Rw(e,t).slice();return ot.__wbindgen_free(e,t*8,8),i}finally{ot.__wbindgen_add_to_stack_pointer(16)}}toRouteSnapper(){try{const l=ot.__wbindgen_add_to_stack_pointer(-16);ot.ltn_toRouteSnapper(l,this.__wbg_ptr);var e=Rt()[l/4+0],t=Rt()[l/4+1],i=Bw(e,t).slice();return ot.__wbindgen_free(e,t*1,1),i}finally{ot.__wbindgen_add_to_stack_pointer(16)}}toRouteSnapperGj(){let e,t;try{const v=ot.__wbindgen_add_to_stack_pointer(-16);ot.ltn_toRouteSnapperGj(v,this.__wbg_ptr);var i=Rt()[v/4+0],l=Rt()[v/4+1],u=Rt()[v/4+2],d=Rt()[v/4+3],a=i,_=l;if(d)throw a=0,_=0,nr(u);return e=a,t=_,yr(a,_)}finally{ot.__wbindgen_add_to_stack_pointer(16),ot.__wbindgen_free(e,t,1)}}renderModalFilters(){let e,t;try{const v=ot.__wbindgen_add_to_stack_pointer(-16);ot.ltn_renderModalFilters(v,this.__wbg_ptr);var i=Rt()[v/4+0],l=Rt()[v/4+1],u=Rt()[v/4+2],d=Rt()[v/4+3],a=i,_=l;if(d)throw a=0,_=0,nr(u);return e=a,t=_,yr(a,_)}finally{ot.__wbindgen_add_to_stack_pointer(16),ot.__wbindgen_free(e,t,1)}}renderNeighbourhood(){let e,t;try{const v=ot.__wbindgen_add_to_stack_pointer(-16);ot.ltn_renderNeighbourhood(v,this.__wbg_ptr);var i=Rt()[v/4+0],l=Rt()[v/4+1],u=Rt()[v/4+2],d=Rt()[v/4+3],a=i,_=l;if(d)throw a=0,_=0,nr(u);return e=a,t=_,yr(a,_)}finally{ot.__wbindgen_add_to_stack_pointer(16),ot.__wbindgen_free(e,t,1)}}renderAutoBoundaries(){let e,t;try{const v=ot.__wbindgen_add_to_stack_pointer(-16);ot.ltn_renderAutoBoundaries(v,this.__wbg_ptr);var i=Rt()[v/4+0],l=Rt()[v/4+1],u=Rt()[v/4+2],d=Rt()[v/4+3],a=i,_=l;if(d)throw a=0,_=0,nr(u);return e=a,t=_,yr(a,_)}finally{ot.__wbindgen_add_to_stack_pointer(16),ot.__wbindgen_free(e,t,1)}}setNeighbourhoodBoundary(e,t){try{const u=ot.__wbindgen_add_to_stack_pointer(-16),d=No(e,ot.__wbindgen_malloc,ot.__wbindgen_realloc),a=qr;ot.ltn_setNeighbourhoodBoundary(u,this.__wbg_ptr,d,a,Yi(t));var i=Rt()[u/4+0],l=Rt()[u/4+1];if(l)throw nr(i)}finally{ot.__wbindgen_add_to_stack_pointer(16)}}deleteNeighbourhoodBoundary(e){const t=No(e,ot.__wbindgen_malloc,ot.__wbindgen_realloc),i=qr;ot.ltn_deleteNeighbourhoodBoundary(this.__wbg_ptr,t,i)}renameNeighbourhoodBoundary(e,t){const i=No(e,ot.__wbindgen_malloc,ot.__wbindgen_realloc),l=qr,u=No(t,ot.__wbindgen_malloc,ot.__wbindgen_realloc),d=qr;ot.ltn_renameNeighbourhoodBoundary(this.__wbg_ptr,i,l,u,d)}setCurrentNeighbourhood(e,t){try{const u=ot.__wbindgen_add_to_stack_pointer(-16),d=No(e,ot.__wbindgen_malloc,ot.__wbindgen_realloc),a=qr;ot.ltn_setCurrentNeighbourhood(u,this.__wbg_ptr,d,a,t);var i=Rt()[u/4+0],l=Rt()[u/4+1];if(l)throw nr(i)}finally{ot.__wbindgen_add_to_stack_pointer(16)}}addModalFilter(e,t){try{const u=ot.__wbindgen_add_to_stack_pointer(-16),d=No(t,ot.__wbindgen_malloc,ot.__wbindgen_realloc),a=qr;ot.ltn_addModalFilter(u,this.__wbg_ptr,Yi(e),d,a);var i=Rt()[u/4+0],l=Rt()[u/4+1];if(l)throw nr(i)}finally{ot.__wbindgen_add_to_stack_pointer(16)}}addManyModalFilters(e,t){try{const u=ot.__wbindgen_add_to_stack_pointer(-16),d=No(t,ot.__wbindgen_malloc,ot.__wbindgen_realloc),a=qr;ot.ltn_addManyModalFilters(u,this.__wbg_ptr,Yi(e),d,a);var i=Rt()[u/4+0],l=Rt()[u/4+1];if(l)throw nr(i)}finally{ot.__wbindgen_add_to_stack_pointer(16)}}deleteModalFilter(e){ot.ltn_deleteModalFilter(this.__wbg_ptr,e)}toggleDirection(e){ot.ltn_toggleDirection(this.__wbg_ptr,e)}undo(){ot.ltn_undo(this.__wbg_ptr)}redo(){ot.ltn_redo(this.__wbg_ptr)}getShortcutsCrossingRoad(e){let t,i;try{const k=ot.__wbindgen_add_to_stack_pointer(-16);ot.ltn_getShortcutsCrossingRoad(k,this.__wbg_ptr,e);var l=Rt()[k/4+0],u=Rt()[k/4+1],d=Rt()[k/4+2],a=Rt()[k/4+3],_=l,v=u;if(a)throw _=0,v=0,nr(d);return t=_,i=v,yr(_,v)}finally{ot.__wbindgen_add_to_stack_pointer(16),ot.__wbindgen_free(t,i,1)}}getAllShortcuts(){let e,t;try{const v=ot.__wbindgen_add_to_stack_pointer(-16);ot.ltn_getAllShortcuts(v,this.__wbg_ptr);var i=Rt()[v/4+0],l=Rt()[v/4+1],u=Rt()[v/4+2],d=Rt()[v/4+3],a=i,_=l;if(d)throw a=0,_=0,nr(u);return e=a,t=_,yr(a,_)}finally{ot.__wbindgen_add_to_stack_pointer(16),ot.__wbindgen_free(e,t,1)}}toSavefile(){let e,t;try{const v=ot.__wbindgen_add_to_stack_pointer(-16);ot.ltn_toSavefile(v,this.__wbg_ptr);var i=Rt()[v/4+0],l=Rt()[v/4+1],u=Rt()[v/4+2],d=Rt()[v/4+3],a=i,_=l;if(d)throw a=0,_=0,nr(u);return e=a,t=_,yr(a,_)}finally{ot.__wbindgen_add_to_stack_pointer(16),ot.__wbindgen_free(e,t,1)}}loadSavefile(e){try{const l=ot.__wbindgen_add_to_stack_pointer(-16);ot.ltn_loadSavefile(l,this.__wbg_ptr,Yi(e));var t=Rt()[l/4+0],i=Rt()[l/4+1];if(i)throw nr(t)}finally{ot.__wbindgen_add_to_stack_pointer(16)}}compareRoute(e,t,i,l,u){let d,a;try{const D=ot.__wbindgen_add_to_stack_pointer(-16);ot.ltn_compareRoute(D,this.__wbg_ptr,e,t,i,l,u);var _=Rt()[D/4+0],v=Rt()[D/4+1],k=Rt()[D/4+2],S=Rt()[D/4+3],E=_,A=v;if(S)throw E=0,A=0,nr(k);return d=E,a=A,yr(E,A)}finally{ot.__wbindgen_add_to_stack_pointer(16),ot.__wbindgen_free(d,a,1)}}impactToOneDestination(e,t){let i,l;try{const S=ot.__wbindgen_add_to_stack_pointer(-16);ot.ltn_impactToOneDestination(S,this.__wbg_ptr,e,t);var u=Rt()[S/4+0],d=Rt()[S/4+1],a=Rt()[S/4+2],_=Rt()[S/4+3],v=u,k=d;if(_)throw v=0,k=0,nr(a);return i=v,l=k,yr(v,k)}finally{ot.__wbindgen_add_to_stack_pointer(16),ot.__wbindgen_free(i,l,1)}}predictImpact(){let e,t;try{const v=ot.__wbindgen_add_to_stack_pointer(-16);ot.ltn_predictImpact(v,this.__wbg_ptr);var i=Rt()[v/4+0],l=Rt()[v/4+1],u=Rt()[v/4+2],d=Rt()[v/4+3],a=i,_=l;if(d)throw a=0,_=0,nr(u);return e=a,t=_,yr(a,_)}finally{ot.__wbindgen_add_to_stack_pointer(16),ot.__wbindgen_free(e,t,1)}}getImpactsOnRoad(e){let t,i;try{const k=ot.__wbindgen_add_to_stack_pointer(-16);ot.ltn_getImpactsOnRoad(k,this.__wbg_ptr,e);var l=Rt()[k/4+0],u=Rt()[k/4+1],d=Rt()[k/4+2],a=Rt()[k/4+3],_=l,v=u;if(a)throw _=0,v=0,nr(d);return t=_,i=v,yr(_,v)}finally{ot.__wbindgen_add_to_stack_pointer(16),ot.__wbindgen_free(t,i,1)}}}async function Ow(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(i){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",i);else throw i}const t=await r.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(r,e);return t instanceof WebAssembly.Instance?{instance:t,module:r}:t}}function Nw(){const r={};return r.wbg={},r.wbg.__wbindgen_object_drop_ref=function(e){nr(e)},r.wbg.__wbindgen_string_get=function(e,t){const i=pi(t),l=typeof i=="string"?i:void 0;var u=Hl(l)?0:No(l,ot.__wbindgen_malloc,ot.__wbindgen_realloc),d=qr;Rt()[e/4+1]=d,Rt()[e/4+0]=u},r.wbg.__wbindgen_boolean_get=function(e){const t=pi(e);return typeof t=="boolean"?t?1:0:2},r.wbg.__wbindgen_is_bigint=function(e){return typeof pi(e)=="bigint"},r.wbg.__wbindgen_number_get=function(e,t){const i=pi(t),l=typeof i=="number"?i:void 0;T0()[e/8+1]=Hl(l)?0:l,Rt()[e/4+0]=!Hl(l)},r.wbg.__wbindgen_is_object=function(e){const t=pi(e);return typeof t=="object"&&t!==null},r.wbg.__wbindgen_in=function(e,t){return pi(e)in pi(t)},r.wbg.__wbindgen_bigint_from_i64=function(e){return Yi(e)},r.wbg.__wbindgen_jsval_eq=function(e,t){return pi(e)===pi(t)},r.wbg.__wbindgen_bigint_from_u64=function(e){const t=BigInt.asUintN(64,e);return Yi(t)},r.wbg.__wbindgen_error_new=function(e,t){const i=new Error(yr(e,t));return Yi(i)},r.wbg.__wbindgen_is_undefined=function(e){return pi(e)===void 0},r.wbg.__wbindgen_string_new=function(e,t){const i=yr(e,t);return Yi(i)},r.wbg.__wbindgen_jsval_loose_eq=function(e,t){return pi(e)==pi(t)},r.wbg.__wbindgen_object_clone_ref=function(e){const t=pi(e);return Yi(t)},r.wbg.__wbg_getwithrefkey_3b3c46ba20582127=function(e,t){const i=pi(e)[pi(t)];return Yi(i)},r.wbg.__wbg_debug_34c9290896ec9856=function(e){console.debug(pi(e))},r.wbg.__wbg_error_e60eff06f24ab7a4=function(e){console.error(pi(e))},r.wbg.__wbg_info_d7d58472d0bab115=function(e){console.info(pi(e))},r.wbg.__wbg_log_a4530b4fe289336f=function(e){console.log(pi(e))},r.wbg.__wbg_warn_f260f49434e45e62=function(e){console.warn(pi(e))},r.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return Yi(e)},r.wbg.__wbg_stack_658279fe44541cf6=function(e,t){const i=pi(t).stack,l=No(i,ot.__wbindgen_malloc,ot.__wbindgen_realloc),u=qr;Rt()[e/4+1]=u,Rt()[e/4+0]=l},r.wbg.__wbg_error_f851667af71bcfc6=function(e,t){let i,l;try{i=e,l=t,console.error(yr(e,t))}finally{ot.__wbindgen_free(i,l,1)}},r.wbg.__wbg_performance_3f3012faa4463882=function(e){const t=pi(e).performance;return Yi(t)},r.wbg.__wbg_now_2fd65358804c9485=function(e){return pi(e).now()},r.wbg.__wbg_get_f01601b5a68d10e3=function(e,t){const i=pi(e)[t>>>0];return Yi(i)},r.wbg.__wbg_length_1009b1af0c481d7b=function(e){return pi(e).length},r.wbg.__wbindgen_is_function=function(e){return typeof pi(e)=="function"},r.wbg.__wbg_newnoargs_c62ea9419c21fbac=function(e,t){const i=new Function(yr(e,t));return Yi(i)},r.wbg.__wbg_next_9b877f231f476d01=function(e){const t=pi(e).next;return Yi(t)},r.wbg.__wbg_next_6529ee0cca8d57ed=function(){return Ra(function(e){const t=pi(e).next();return Yi(t)},arguments)},r.wbg.__wbg_done_5fe336b092d60cf2=function(e){return pi(e).done},r.wbg.__wbg_value_0c248a78fdc8e19f=function(e){const t=pi(e).value;return Yi(t)},r.wbg.__wbg_iterator_db7ca081358d4fb2=function(){return Yi(Symbol.iterator)},r.wbg.__wbg_get_7b48513de5dc5ea4=function(){return Ra(function(e,t){const i=Reflect.get(pi(e),pi(t));return Yi(i)},arguments)},r.wbg.__wbg_call_90c26b09837aba1c=function(){return Ra(function(e,t){const i=pi(e).call(pi(t));return Yi(i)},arguments)},r.wbg.__wbg_self_f0e34d89f33b99fd=function(){return Ra(function(){const e=self.self;return Yi(e)},arguments)},r.wbg.__wbg_window_d3b084224f4774d7=function(){return Ra(function(){const e=window.window;return Yi(e)},arguments)},r.wbg.__wbg_globalThis_9caa27ff917c6860=function(){return Ra(function(){const e=globalThis.globalThis;return Yi(e)},arguments)},r.wbg.__wbg_global_35dfdd59a4da3e74=function(){return Ra(function(){const e=global.global;return Yi(e)},arguments)},r.wbg.__wbg_isArray_74fb723e24f76012=function(e){return Array.isArray(pi(e))},r.wbg.__wbg_instanceof_ArrayBuffer_e7d53d51371448e2=function(e){let t;try{t=pi(e)instanceof ArrayBuffer}catch{t=!1}return t},r.wbg.__wbg_isSafeInteger_f93fde0dca9820f8=function(e){return Number.isSafeInteger(pi(e))},r.wbg.__wbg_entries_9e2e2aa45aa5094a=function(e){const t=Object.entries(pi(e));return Yi(t)},r.wbg.__wbg_buffer_a448f833075b71ba=function(e){const t=pi(e).buffer;return Yi(t)},r.wbg.__wbg_new_8f67e318f15d7254=function(e){const t=new Uint8Array(pi(e));return Yi(t)},r.wbg.__wbg_set_2357bf09366ee480=function(e,t,i){pi(e).set(pi(t),i>>>0)},r.wbg.__wbg_length_1d25fa9e4ac21ce7=function(e){return pi(e).length},r.wbg.__wbg_instanceof_Uint8Array_bced6f43aed8c1aa=function(e){let t;try{t=pi(e)instanceof Uint8Array}catch{t=!1}return t},r.wbg.__wbindgen_bigint_get_as_i64=function(e,t){const i=pi(t),l=typeof i=="bigint"?i:void 0;zw()[e/8+1]=Hl(l)?BigInt(0):l,Rt()[e/4+0]=!Hl(l)},r.wbg.__wbindgen_debug_string=function(e,t){const i=fp(pi(t)),l=No(i,ot.__wbindgen_malloc,ot.__wbindgen_realloc),u=qr;Rt()[e/4+1]=u,Rt()[e/4+0]=l},r.wbg.__wbindgen_throw=function(e,t){throw new Error(yr(e,t))},r.wbg.__wbindgen_memory=function(){const e=ot.memory;return Yi(e)},r}function jw(r,e){return ot=r.exports,E0.__wbindgen_wasm_module=e,Su=null,ku=null,xu=null,wu=null,ot}async function E0(r){if(ot!==void 0)return ot;typeof r>"u"&&(r="/ltn/assets/backend_bg.wasm");const e=Nw();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:t,module:i}=await Ow(await r,e);return jw(t,i)}let Uw=Date.now();function lc(r){return`${r}-${Uw++}`}const Op=Symbol.for("svelte-maplibre");function cc(){return Ld(Op)}function Vw(r){let e=new WeakMap;return t=>{var d;let i=e.get(t.originalEvent);if(i!==void 0)return i;let u=(d=t.target.queryRenderedFeatures(t.point).find(a=>{var _;return(_=r.get(a.layer.id))==null?void 0:_.interactive}))==null?void 0:d.layer.id;return e.set(t.originalEvent,u),u}}function $w(){let r=new Map;return Id(Op,{map:ki(null),source:Kf(null),layer:Kf(null),popupTarget:Kf(null),cluster:ki(),loadedImages:ki(new Set),minzoom:ki(0),maxzoom:ki(24),layerEvent:ki(null),layerInfo:r,eventTopMost:Vw(r),markerClickManager:new Ww})}function jg(r){return{subscribe:r.subscribe}}function Np({key:r,setPopupTarget:e=!1,setCluster:t=!1,setMouseEvent:i=!1}){let l=cc(),u=ki(null),d=jg(u),a={...l,[r]:jg(u)};if(e&&(a.popupTarget=d),i){let _=ki(null);a.layerEvent=_,l.layerEvent=_}return t&&(a.cluster=ki()),Id(Op,a),{...l,self:u}}function qw(){return Np({key:"source",setCluster:!0})}function Zw(r=!0){return Np({key:"layer",setPopupTarget:r,setMouseEvent:r})}function Gw(){return Np({key:"popupTarget",setPopupTarget:!0,setMouseEvent:!0})}class Ww{constructor(){Un(this,"_handlers",new Set)}add(e){this._handlers.add(e)}remove(e){this._handlers.delete(e)}handleClick(e){for(const t of this._handlers)t(e)}}function Ug(r){let e;return t=>{if(t)for(let i in t){let l=e==null?void 0:e[i],u=t[i];l!==u&&r(i,u,l)}else if(e)for(let i in e)r(i,void 0,e[i]);e=t}}function Hw(r,...e){let t=[r];for(let i of e)if(i)Array.isArray(i)&&i[0]===r?t.push(...i.slice(1)):t.push(i);else continue;if(t.length!==1)return t.length===2?t[1]:t}function Xw(r){return r===!0?["has","point_count"]:r===!1?["!",["has","point_count"]]:void 0}function Na(r,e){return["case",["boolean",["feature-state","hover"],!1],e,r]}var ja=Kw;function Kw(r){var e,t,i;if(r){if(Array.isArray(r)){for(e=[],t=r.length,i=0;i<t;i++){var l=r[i];l!=null&&e.push(l)}return e}if(typeof r=="object"){e={};var u=Object.keys(r);for(t=u.length,i=0;i<t;i++){var d=u[i],a=r[d];a!=null&&(e[d]=a)}return e}}}function Vg(r){let e=r[0],t,i,l=$g(r);return{c(){l.c(),t=En()},m(u,d){l.m(u,d),ae(u,t,d),i=!0},p(u,d){d[0]&1&&zt(e,e=u[0])?(yi(),ne(l,1,1,It),vi(),l=$g(u),l.c(),J(l,1),l.m(t.parentNode,t)):l.p(u,d)},i(u){i||(J(l),i=!0)},o(u){ne(l),i=!1},d(u){u&&se(t),l.d(u)}}}function $g(r){let e;const t=r[36].default,i=$i(t,r,r[35],null);return{c(){i&&i.c()},m(l,u){i&&i.m(l,u),e=!0},p(l,u){i&&i.p&&(!e||u[1]&16)&&Zi(i,t,l,l[35],e?qi(t,l[35],u,null):Gi(l[35]),null)},i(l){e||(J(i,l),e=!0)},o(l){ne(i,l),e=!1},d(l){i&&i.d(l)}}}function Jw(r){let e,t,i=r[0]&&Vg(r);return{c(){i&&i.c(),e=En()},m(l,u){i&&i.m(l,u),ae(l,e,u),t=!0},p(l,u){l[0]?i?(i.p(l,u),u[0]&1&&J(i,1)):(i=Vg(l),i.c(),J(i,1),i.m(e.parentNode,e)):i&&(yi(),ne(i,1,1,()=>{i=null}),vi())},i(l){t||(J(i),t=!0)},o(l){ne(i),t=!1},d(l){l&&se(e),i&&i.d(l)}}}function Yw(r,e,t){let i,l,u,d,a,_,v,k,S,E,A,D,{$$slots:B={},$$scope:P}=e,{id:R=lc("layer")}=e,{source:F=void 0}=e,{sourceLayer:j=void 0}=e,{beforeId:U=void 0}=e,{beforeLayerType:le=void 0}=e,{type:he}=e,{paint:Z=void 0}=e,{layout:Q=void 0}=e,{filter:ye=void 0}=e,{applyToClusters:Ne=void 0}=e,{minzoom:re=void 0}=e,{maxzoom:ve=void 0}=e,{manageHoverState:Ke=!1}=e,{hovered:Le=null}=e,{interactive:et=!0}=e,{hoverCursor:xt=void 0}=e,{eventsIfTopMost:mt=!1}=e;const at=rs(),{map:Ht,source:ri,self:Nt,minzoom:At,maxzoom:ei,eventTopMost:ci,layerInfo:ti}=Zw();lt(r,Ht,Fe=>t(31,S=Fe)),lt(r,ri,Fe=>t(32,E=Fe)),lt(r,Nt,Fe=>t(0,k=Fe)),lt(r,At,Fe=>t(34,D=Fe)),lt(r,ei,Fe=>t(33,A=Fe)),er(()=>{k&&S&&(ti.delete(k),S==null||S.removeLayer(k))});let ft;function Jt(Fe){var we,Ei;if(!et||!k||!S||mt&&ci(Fe)!==k)return;let je=Fe.features??[],ht=(Ei=(we=je[0])==null?void 0:we.properties)==null?void 0:Ei.cluster_id,vt={event:Fe,map:S,clusterId:ht,layer:k,source:a,features:je};at(Fe.type,vt)}function gi(Fe){var we,Ei;if(!et||!k||!S||mt&&ci(Fe)!==k)return;xt&&(S.getCanvas().style.cursor=xt);let je=Fe.features??[];t(6,Le=je[0]??null);let ht=(Ei=(we=je[0])==null?void 0:we.properties)==null?void 0:Ei.cluster_id;at("mouseenter",{event:Fe,map:S,clusterId:ht,layer:k,source:a,features:je})}function zi(Fe){var we,Ei,qe;if(!et||!S)return;if(mt&&ci(Fe)!==k){t(6,Le=null),Ke&&ft!==void 0&&(S==null||S.setFeatureState({source:a,sourceLayer:j,id:ft},{hover:!1}),ft=void 0);return}S.getCanvas().style.cursor=xt;let je=Fe.features??[],ht=(Ei=(we=je[0])==null?void 0:we.properties)==null?void 0:Ei.cluster_id,vt=(qe=je[0])==null?void 0:qe.id;vt!==ft&&(Ke&&(ft!==void 0&&(S==null||S.setFeatureState({source:a,id:ft,sourceLayer:j},{hover:!1})),S==null||S.setFeatureState({source:a,id:vt,sourceLayer:j},{hover:!0})),ft=vt,t(6,Le=je[0]??null)),at("mousemove",{event:Fe,map:S,clusterId:ht,layer:k,source:a,features:je})}function Fi(Fe){if(!(!et||!k||!S)){if(xt&&(S.getCanvas().style.cursor=""),t(6,Le=null),Ke&&ft!==void 0){const je={source:a,id:ft,sourceLayer:j};S==null||S.setFeatureState(je,{hover:!1}),ft=void 0}at("mouseleave",{map:S,layer:k,source:a})}}let ut=!0;function Dt(Fe){S&&(S.off("click",Fe,Jt),S.off("dblclick",Fe,Jt),S.off("contextmenu",Fe,Jt),S.off("mouseenter",Fe,gi),S.off("mousemove",Fe,zi),S.off("mouseleave",Fe,Fi))}return er(()=>{S&&k&&Dt(k)}),r.$$set=Fe=>{"id"in Fe&&t(7,R=Fe.id),"source"in Fe&&t(8,F=Fe.source),"sourceLayer"in Fe&&t(9,j=Fe.sourceLayer),"beforeId"in Fe&&t(10,U=Fe.beforeId),"beforeLayerType"in Fe&&t(11,le=Fe.beforeLayerType),"type"in Fe&&t(12,he=Fe.type),"paint"in Fe&&t(13,Z=Fe.paint),"layout"in Fe&&t(14,Q=Fe.layout),"filter"in Fe&&t(15,ye=Fe.filter),"applyToClusters"in Fe&&t(16,Ne=Fe.applyToClusters),"minzoom"in Fe&&t(17,re=Fe.minzoom),"maxzoom"in Fe&&t(18,ve=Fe.maxzoom),"manageHoverState"in Fe&&t(19,Ke=Fe.manageHoverState),"hovered"in Fe&&t(6,Le=Fe.hovered),"interactive"in Fe&&t(20,et=Fe.interactive),"hoverCursor"in Fe&&t(21,xt=Fe.hoverCursor),"eventsIfTopMost"in Fe&&t(22,mt=Fe.eventsIfTopMost),"$$scope"in Fe&&t(35,P=Fe.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&65536&&t(30,i=Xw(Ne)),r.$$.dirty[0]&1073774592&&t(24,l=Hw("all",i,ye)),r.$$.dirty[0]&131072|r.$$.dirty[1]&8&&t(26,u=re??D),r.$$.dirty[0]&262144|r.$$.dirty[1]&4&&t(25,d=ve??A),r.$$.dirty[0]&256|r.$$.dirty[1]&2&&t(29,a=F||E),r.$$.dirty[0]&654343809|r.$$.dirty[1]&1&&S&&k!==R&&a){k&&(Dt(k),ti.delete(k));let Fe=U;if(!U&&le){let je=S.getStyle().layers,ht=typeof le=="function"?le:we=>we.type===le,vt=je==null?void 0:je.find(ht);vt&&(Fe=vt.id)}Tt(Nt,k=R,k),S.addLayer(ja({id:k,type:he,source:a,"source-layer":j,filter:l,paint:Z,layout:Q,minzoom:u,maxzoom:d}),Fe),t(23,ut=!0),S.on("click",k,Jt),S.on("dblclick",k,Jt),S.on("contextmenu",k,Jt),S.on("mouseenter",k,gi),S.on("mousemove",k,zi),S.on("mouseleave",k,Fi)}r.$$.dirty[0]&1048577&&k&&ti.set(k,{interactive:et}),r.$$.dirty[0]&1|r.$$.dirty[1]&1&&t(28,_=k?Ug((Fe,je)=>{S!=null&&S.style._loaded?S.setPaintProperty(k,Fe,je):S==null||S.once("styledata",()=>S==null?void 0:S.setPaintProperty(k,Fe,je))}):void 0),r.$$.dirty[0]&1|r.$$.dirty[1]&1&&t(27,v=k?Ug((Fe,je)=>{S!=null&&S.style._loaded?S.setLayoutProperty(k,Fe,je):S==null||S.once("styledata",()=>S==null?void 0:S.setLayoutProperty(k,Fe,je))}):void 0),r.$$.dirty[0]&268443648&&(_==null||_(Z)),r.$$.dirty[0]&134234112&&(v==null||v(Q)),r.$$.dirty[0]&100663297|r.$$.dirty[1]&1&&k&&(S==null||S.setLayerZoomRange(k,u,d)),r.$$.dirty[0]&25165825|r.$$.dirty[1]&1&&k&&(ut?t(23,ut=!1):S==null||S.setFilter(k,l))},[k,Ht,ri,Nt,At,ei,Le,R,F,j,U,le,he,Z,Q,ye,Ne,re,ve,Ke,et,xt,mt,ut,l,d,u,v,_,a,i,S,E,A,D,P,B]}let Dd=class extends Vt{constructor(e){super(),Ut(this,e,Yw,Jw,zt,{id:7,source:8,sourceLayer:9,beforeId:10,beforeLayerType:11,type:12,paint:13,layout:14,filter:15,applyToClusters:16,minzoom:17,maxzoom:18,manageHoverState:19,hovered:6,interactive:20,hoverCursor:21,eventsIfTopMost:22},null,[-1,-1])}};function Qw(r){let e;const t=r[16].default,i=$i(t,r,r[24],null);return{c(){i&&i.c()},m(l,u){i&&i.m(l,u),e=!0},p(l,u){i&&i.p&&(!e||u&16777216)&&Zi(i,t,l,l[24],e?qi(t,l[24],u,null):Gi(l[24]),null)},i(l){e||(J(i,l),e=!0)},o(l){ne(i,l),e=!1},d(l){i&&i.d(l)}}}function ex(r){let e,t,i;function l(d){r[17](d)}let u={id:r[1],type:"circle",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],applyToClusters:r[9],minzoom:r[10],maxzoom:r[11],hoverCursor:r[12],manageHoverState:r[13],eventsIfTopMost:r[14],interactive:r[15],$$slots:{default:[Qw]},$$scope:{ctx:r}};return r[0]!==void 0&&(u.hovered=r[0]),e=new Dd({props:u}),on.push(()=>Wr(e,"hovered",l)),e.$on("click",r[18]),e.$on("dblclick",r[19]),e.$on("contextmenu",r[20]),e.$on("mouseenter",r[21]),e.$on("mousemove",r[22]),e.$on("mouseleave",r[23]),{c(){Ie(e.$$.fragment)},m(d,a){Ee(e,d,a),i=!0},p(d,[a]){const _={};a&2&&(_.id=d[1]),a&4&&(_.source=d[2]),a&8&&(_.sourceLayer=d[3]),a&16&&(_.beforeId=d[4]),a&32&&(_.beforeLayerType=d[5]),a&64&&(_.paint=d[6]),a&128&&(_.layout=d[7]),a&256&&(_.filter=d[8]),a&512&&(_.applyToClusters=d[9]),a&1024&&(_.minzoom=d[10]),a&2048&&(_.maxzoom=d[11]),a&4096&&(_.hoverCursor=d[12]),a&8192&&(_.manageHoverState=d[13]),a&16384&&(_.eventsIfTopMost=d[14]),a&32768&&(_.interactive=d[15]),a&16777216&&(_.$$scope={dirty:a,ctx:d}),!t&&a&1&&(t=!0,_.hovered=d[0],Gr(()=>t=!1)),e.$set(_)},i(d){i||(J(e.$$.fragment,d),i=!0)},o(d){ne(e.$$.fragment,d),i=!1},d(d){Me(e,d)}}}function tx(r,e,t){let{$$slots:i={},$$scope:l}=e,{id:u=lc("circle")}=e,{source:d=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:_=void 0}=e,{beforeLayerType:v=void 0}=e,{paint:k}=e,{layout:S=void 0}=e,{filter:E=void 0}=e,{applyToClusters:A=void 0}=e,{minzoom:D=void 0}=e,{maxzoom:B=void 0}=e,{hoverCursor:P=void 0}=e,{manageHoverState:R=!1}=e,{hovered:F=null}=e,{eventsIfTopMost:j=!1}=e,{interactive:U=!0}=e;function le(ve){F=ve,t(0,F)}function he(ve){fi.call(this,r,ve)}function Z(ve){fi.call(this,r,ve)}function Q(ve){fi.call(this,r,ve)}function ye(ve){fi.call(this,r,ve)}function Ne(ve){fi.call(this,r,ve)}function re(ve){fi.call(this,r,ve)}return r.$$set=ve=>{"id"in ve&&t(1,u=ve.id),"source"in ve&&t(2,d=ve.source),"sourceLayer"in ve&&t(3,a=ve.sourceLayer),"beforeId"in ve&&t(4,_=ve.beforeId),"beforeLayerType"in ve&&t(5,v=ve.beforeLayerType),"paint"in ve&&t(6,k=ve.paint),"layout"in ve&&t(7,S=ve.layout),"filter"in ve&&t(8,E=ve.filter),"applyToClusters"in ve&&t(9,A=ve.applyToClusters),"minzoom"in ve&&t(10,D=ve.minzoom),"maxzoom"in ve&&t(11,B=ve.maxzoom),"hoverCursor"in ve&&t(12,P=ve.hoverCursor),"manageHoverState"in ve&&t(13,R=ve.manageHoverState),"hovered"in ve&&t(0,F=ve.hovered),"eventsIfTopMost"in ve&&t(14,j=ve.eventsIfTopMost),"interactive"in ve&&t(15,U=ve.interactive),"$$scope"in ve&&t(24,l=ve.$$scope)},[F,u,d,a,_,v,k,S,E,A,D,B,P,R,j,U,i,le,he,Z,Q,ye,Ne,re,l]}let jp=class extends Vt{constructor(e){super(),Ut(this,e,tx,ex,zt,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}};function ix(r){let e;const t=r[15].default,i=$i(t,r,r[23],null);return{c(){i&&i.c()},m(l,u){i&&i.m(l,u),e=!0},p(l,u){i&&i.p&&(!e||u&8388608)&&Zi(i,t,l,l[23],e?qi(t,l[23],u,null):Gi(l[23]),null)},i(l){e||(J(i,l),e=!0)},o(l){ne(i,l),e=!1},d(l){i&&i.d(l)}}}function nx(r){let e,t,i;function l(d){r[16](d)}let u={id:r[1],type:"fill",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],minzoom:r[9],maxzoom:r[10],hoverCursor:r[11],manageHoverState:r[12],eventsIfTopMost:r[13],interactive:r[14],$$slots:{default:[ix]},$$scope:{ctx:r}};return r[0]!==void 0&&(u.hovered=r[0]),e=new Dd({props:u}),on.push(()=>Wr(e,"hovered",l)),e.$on("click",r[17]),e.$on("dblclick",r[18]),e.$on("contextmenu",r[19]),e.$on("mouseenter",r[20]),e.$on("mousemove",r[21]),e.$on("mouseleave",r[22]),{c(){Ie(e.$$.fragment)},m(d,a){Ee(e,d,a),i=!0},p(d,[a]){const _={};a&2&&(_.id=d[1]),a&4&&(_.source=d[2]),a&8&&(_.sourceLayer=d[3]),a&16&&(_.beforeId=d[4]),a&32&&(_.beforeLayerType=d[5]),a&64&&(_.paint=d[6]),a&128&&(_.layout=d[7]),a&256&&(_.filter=d[8]),a&512&&(_.minzoom=d[9]),a&1024&&(_.maxzoom=d[10]),a&2048&&(_.hoverCursor=d[11]),a&4096&&(_.manageHoverState=d[12]),a&8192&&(_.eventsIfTopMost=d[13]),a&16384&&(_.interactive=d[14]),a&8388608&&(_.$$scope={dirty:a,ctx:d}),!t&&a&1&&(t=!0,_.hovered=d[0],Gr(()=>t=!1)),e.$set(_)},i(d){i||(J(e.$$.fragment,d),i=!0)},o(d){ne(e.$$.fragment,d),i=!1},d(d){Me(e,d)}}}function rx(r,e,t){let{$$slots:i={},$$scope:l}=e,{id:u=lc("fill")}=e,{source:d=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:_=void 0}=e,{beforeLayerType:v=void 0}=e,{paint:k}=e,{layout:S=void 0}=e,{filter:E=void 0}=e,{minzoom:A=void 0}=e,{maxzoom:D=void 0}=e,{hoverCursor:B=void 0}=e,{manageHoverState:P=!1}=e,{hovered:R=null}=e,{eventsIfTopMost:F=!1}=e,{interactive:j=!0}=e;function U(re){R=re,t(0,R)}function le(re){fi.call(this,r,re)}function he(re){fi.call(this,r,re)}function Z(re){fi.call(this,r,re)}function Q(re){fi.call(this,r,re)}function ye(re){fi.call(this,r,re)}function Ne(re){fi.call(this,r,re)}return r.$$set=re=>{"id"in re&&t(1,u=re.id),"source"in re&&t(2,d=re.source),"sourceLayer"in re&&t(3,a=re.sourceLayer),"beforeId"in re&&t(4,_=re.beforeId),"beforeLayerType"in re&&t(5,v=re.beforeLayerType),"paint"in re&&t(6,k=re.paint),"layout"in re&&t(7,S=re.layout),"filter"in re&&t(8,E=re.filter),"minzoom"in re&&t(9,A=re.minzoom),"maxzoom"in re&&t(10,D=re.maxzoom),"hoverCursor"in re&&t(11,B=re.hoverCursor),"manageHoverState"in re&&t(12,P=re.manageHoverState),"hovered"in re&&t(0,R=re.hovered),"eventsIfTopMost"in re&&t(13,F=re.eventsIfTopMost),"interactive"in re&&t(14,j=re.interactive),"$$scope"in re&&t(23,l=re.$$scope)},[R,u,d,a,_,v,k,S,E,A,D,B,P,F,j,i,U,le,he,Z,Q,ye,Ne,l]}let Es=class extends Vt{constructor(e){super(),Ut(this,e,rx,nx,zt,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}};function ox(r,e,t){let i;const{map:l}=cc();lt(r,l,_=>t(4,i=_));let{position:u="top-left"}=e,{container:d=void 0}=e,a=null;return er(()=>{i!=null&&i.loaded()&&a&&i.removeControl(a)}),r.$$set=_=>{"position"in _&&t(1,u=_.position),"container"in _&&t(2,d=_.container)},r.$$.update=()=>{if(r.$$.dirty&30&&i&&!a){let _;typeof d=="string"?_=document.querySelector(d)??void 0:_=d,t(3,a=new to.FullscreenControl({container:_})),i.addControl(a,u)}},[l,u,d,a,i]}class sx extends Vt{constructor(e){super(),Ut(this,e,ox,null,zt,{position:1,container:2})}}function ax(r,e,t,i,l){let u=!1;r.getSource(e)&&(u=!0,r.removeSource(e));const d=()=>{i(e)&&(r.addSource(e,t),l())};if(u){const a=()=>{e&&(r.getSource(e)?setTimeout(a,1):d())};a()}else d()}function lx(r,e,t){n0().then(()=>{let i=Pr(r);if(!i)return;i.getSource(e)===t&&i.removeSource(e)})}function qg(r){let e=r[0],t,i,l=Zg(r);return{c(){l.c(),t=En()},m(u,d){l.m(u,d),ae(u,t,d),i=!0},p(u,d){d&1&&zt(e,e=u[0])?(yi(),ne(l,1,1,It),vi(),l=Zg(u),l.c(),J(l,1),l.m(t.parentNode,t)):l.p(u,d)},i(u){i||(J(l),i=!0)},o(u){ne(l),i=!1},d(u){u&&se(t),l.d(u)}}}function Zg(r){let e;const t=r[19].default,i=$i(t,r,r[18],null);return{c(){i&&i.c()},m(l,u){i&&i.m(l,u),e=!0},p(l,u){i&&i.p&&(!e||u&262144)&&Zi(i,t,l,l[18],e?qi(t,l[18],u,null):Gi(l[18]),null)},i(l){e||(J(i,l),e=!0)},o(l){ne(i,l),e=!1},d(l){i&&i.d(l)}}}function cx(r){let e,t,i=r[0]&&qg(r);return{c(){i&&i.c(),e=En()},m(l,u){i&&i.m(l,u),ae(l,e,u),t=!0},p(l,[u]){l[0]?i?(i.p(l,u),u&1&&J(i,1)):(i=qg(l),i.c(),J(i,1),i.m(e.parentNode,e)):i&&(yi(),ne(i,1,1,()=>{i=null}),vi())},i(l){t||(J(i),t=!0)},o(l){ne(i),t=!1},d(l){l&&se(e),i&&i.d(l)}}}function ux(r,e,t){let i,l,u,{$$slots:d={},$$scope:a}=e,{id:_=lc("geojson")}=e,{data:v}=e,{generateId:k=!1}=e,{promoteId:S=void 0}=e,{filter:E=void 0}=e,{lineMetrics:A=void 0}=e,{cluster:D=void 0}=e,{maxzoom:B=void 0}=e,{attribution:P=void 0}=e,{buffer:R=void 0}=e,{tolerance:F=void 0}=e;const{map:j,cluster:U,self:le}=qw();lt(r,j,Q=>t(17,l=Q)),lt(r,U,Q=>t(20,u=Q)),lt(r,le,Q=>t(0,i=Q));let he,Z=!0;return er(()=>{i&&he&&l&&(lx(j,i,he),Tt(le,i=null,i),t(15,he=void 0))}),r.$$set=Q=>{"id"in Q&&t(4,_=Q.id),"data"in Q&&t(5,v=Q.data),"generateId"in Q&&t(6,k=Q.generateId),"promoteId"in Q&&t(7,S=Q.promoteId),"filter"in Q&&t(8,E=Q.filter),"lineMetrics"in Q&&t(9,A=Q.lineMetrics),"cluster"in Q&&t(10,D=Q.cluster),"maxzoom"in Q&&t(11,B=Q.maxzoom),"attribution"in Q&&t(12,P=Q.attribution),"buffer"in Q&&t(13,R=Q.buffer),"tolerance"in Q&&t(14,F=Q.tolerance),"$$scope"in Q&&t(18,a=Q.$$scope)},r.$$.update=()=>{r.$$.dirty&1024&&Tt(U,u=D,u),r.$$.dirty&196593&&l&&i!==_&&(Tt(le,i=_,i),ax(l,i,ja({type:"geojson",data:v,filter:E,lineMetrics:A,generateId:k,promoteId:S,cluster:!!D,clusterMinPoints:D==null?void 0:D.minPoints,clusterMaxZoom:D==null?void 0:D.maxZoom,clusterRadius:D==null?void 0:D.radius,clusterProperties:D==null?void 0:D.properties,maxzoom:B,attribution:P,buffer:R,tolerance:F}),Q=>l&&Q===i,()=>{i&&(t(15,he=l==null?void 0:l.getSource(i)),t(16,Z=!0))})),r.$$.dirty&131088&&(l==null||l.on("style.load",()=>{t(15,he=l==null?void 0:l.getSource(_))})),r.$$.dirty&98336&&he&&(Z?t(16,Z=!1):he.setData(v)),r.$$.dirty&33792&&(he==null||he.setClusterOptions(ja({cluster:!!D,clusterMaxZoom:D==null?void 0:D.maxZoom,clusterRadius:D==null?void 0:D.radius})))},[i,j,U,le,_,v,k,S,E,A,D,B,P,R,F,he,Z,l,a,d]}let ur=class extends Vt{constructor(e){super(),Ut(this,e,ux,cx,zt,{id:4,data:5,generateId:6,promoteId:7,filter:8,lineMetrics:9,cluster:10,maxzoom:11,attribution:12,buffer:13,tolerance:14})}};function hx(r,e,t){let i;const{map:l}=cc();lt(r,l,E=>t(8,i=E));let{position:u="top-left"}=e,{positionOptions:d=void 0}=e,{fitBoundsOptions:a=void 0}=e,{trackUserLocation:_=!1}=e,{showAccuracyCircle:v=!0}=e,{showUserLocation:k=!0}=e,{control:S=null}=e;return er(()=>{i!=null&&i.loaded()&&S&&i.removeControl(S)}),r.$$set=E=>{"position"in E&&t(2,u=E.position),"positionOptions"in E&&t(3,d=E.positionOptions),"fitBoundsOptions"in E&&t(4,a=E.fitBoundsOptions),"trackUserLocation"in E&&t(5,_=E.trackUserLocation),"showAccuracyCircle"in E&&t(6,v=E.showAccuracyCircle),"showUserLocation"in E&&t(7,k=E.showUserLocation),"control"in E&&t(1,S=E.control)},r.$$.update=()=>{r.$$.dirty&510&&i&&!S&&(t(1,S=new to.GeolocateControl({positionOptions:d,fitBoundsOptions:a,trackUserLocation:_,showAccuracyCircle:v,showUserLocation:k})),i.addControl(S,u))},[l,S,u,d,a,_,v,k,i]}class dx extends Vt{constructor(e){super(),Ut(this,e,hx,null,zt,{position:2,positionOptions:3,fitBoundsOptions:4,trackUserLocation:5,showAccuracyCircle:6,showUserLocation:7,control:1})}}function fx(r){let e;const t=r[15].default,i=$i(t,r,r[23],null);return{c(){i&&i.c()},m(l,u){i&&i.m(l,u),e=!0},p(l,u){i&&i.p&&(!e||u&8388608)&&Zi(i,t,l,l[23],e?qi(t,l[23],u,null):Gi(l[23]),null)},i(l){e||(J(i,l),e=!0)},o(l){ne(i,l),e=!1},d(l){i&&i.d(l)}}}function px(r){let e,t,i;function l(d){r[16](d)}let u={id:r[1],type:"line",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],minzoom:r[9],maxzoom:r[10],hoverCursor:r[11],manageHoverState:r[12],eventsIfTopMost:r[13],interactive:r[14],$$slots:{default:[fx]},$$scope:{ctx:r}};return r[0]!==void 0&&(u.hovered=r[0]),e=new Dd({props:u}),on.push(()=>Wr(e,"hovered",l)),e.$on("click",r[17]),e.$on("dblclick",r[18]),e.$on("contextmenu",r[19]),e.$on("mouseenter",r[20]),e.$on("mousemove",r[21]),e.$on("mouseleave",r[22]),{c(){Ie(e.$$.fragment)},m(d,a){Ee(e,d,a),i=!0},p(d,[a]){const _={};a&2&&(_.id=d[1]),a&4&&(_.source=d[2]),a&8&&(_.sourceLayer=d[3]),a&16&&(_.beforeId=d[4]),a&32&&(_.beforeLayerType=d[5]),a&64&&(_.paint=d[6]),a&128&&(_.layout=d[7]),a&256&&(_.filter=d[8]),a&512&&(_.minzoom=d[9]),a&1024&&(_.maxzoom=d[10]),a&2048&&(_.hoverCursor=d[11]),a&4096&&(_.manageHoverState=d[12]),a&8192&&(_.eventsIfTopMost=d[13]),a&16384&&(_.interactive=d[14]),a&8388608&&(_.$$scope={dirty:a,ctx:d}),!t&&a&1&&(t=!0,_.hovered=d[0],Gr(()=>t=!1)),e.$set(_)},i(d){i||(J(e.$$.fragment,d),i=!0)},o(d){ne(e.$$.fragment,d),i=!1},d(d){Me(e,d)}}}function mx(r,e,t){let{$$slots:i={},$$scope:l}=e,{id:u=lc("line")}=e,{source:d=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:_=void 0}=e,{beforeLayerType:v=void 0}=e,{paint:k}=e,{layout:S=void 0}=e,{filter:E=void 0}=e,{minzoom:A=void 0}=e,{maxzoom:D=void 0}=e,{hoverCursor:B=void 0}=e,{manageHoverState:P=!1}=e,{hovered:R=null}=e,{eventsIfTopMost:F=!1}=e,{interactive:j=!0}=e;function U(re){R=re,t(0,R)}function le(re){fi.call(this,r,re)}function he(re){fi.call(this,r,re)}function Z(re){fi.call(this,r,re)}function Q(re){fi.call(this,r,re)}function ye(re){fi.call(this,r,re)}function Ne(re){fi.call(this,r,re)}return r.$$set=re=>{"id"in re&&t(1,u=re.id),"source"in re&&t(2,d=re.source),"sourceLayer"in re&&t(3,a=re.sourceLayer),"beforeId"in re&&t(4,_=re.beforeId),"beforeLayerType"in re&&t(5,v=re.beforeLayerType),"paint"in re&&t(6,k=re.paint),"layout"in re&&t(7,S=re.layout),"filter"in re&&t(8,E=re.filter),"minzoom"in re&&t(9,A=re.minzoom),"maxzoom"in re&&t(10,D=re.maxzoom),"hoverCursor"in re&&t(11,B=re.hoverCursor),"manageHoverState"in re&&t(12,P=re.manageHoverState),"hovered"in re&&t(0,R=re.hovered),"eventsIfTopMost"in re&&t(13,F=re.eventsIfTopMost),"interactive"in re&&t(14,j=re.interactive),"$$scope"in re&&t(23,l=re.$$scope)},[R,u,d,a,_,v,k,S,E,A,D,B,P,F,j,i,U,le,he,Z,Q,ye,Ne,l]}let Hr=class extends Vt{constructor(e){super(),Ut(this,e,mx,px,zt,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}};function gx(r,e,t){let i;const l=rs();let{layer:u=void 0}=e;const{map:d}=cc();lt(r,d,k=>t(2,i=k));function a(k){l(k.type,{...k,map:d})}const _=["click","dblclick","mousedown","mouseup","mousemove","mouseenter","mouseleave","contextmenu","mouseover","mouseout"],v=["click","dblclick","contextmenu","mousemove","movestart","moveend","zoomstart","zoom","zoomend"];return er(()=>{if(i)if(u)for(const k of _)i.off(k,u,a);else for(const k of v)i.off(k,a)}),r.$$set=k=>{"layer"in k&&t(1,u=k.layer)},r.$$.update=()=>{if(r.$$.dirty&6&&i)if(u)for(const k of _)i.on(k,u,a);else for(const k of v)i.on(k,a)},[d,u,i]}class M0 extends Vt{constructor(e){super(),Ut(this,e,gx,null,zt,{layer:1})}}function _x(r){let e=r.getCenter(),t=Math.round(r.getZoom()*100)/100,i=Math.ceil((t*Math.LN2+Math.log(512/360/.5))/Math.LN10),l=Math.pow(10,i),u=Math.round(e.lat*l)/l,d=Math.round(e.lng*l)/l,a=`${t}/${u}/${d}`,_=r.getBearing(),v=r.getPitch();return(_||v)&&(a+=`/${Math.round(_*10)/10}`),v&&(a+=`/${Math.round(v)}`),`#${a}`}function yx(r){return r.replace("#","").split("/").map(parseFloat)}var $l=Up;function Up(r,e){return r===e||r!==r&&e!==e?!0:typeof r!=typeof e||{}.toString.call(r)!={}.toString.call(e)||r!==Object(r)||!r?!1:Array.isArray(r)?Gg(r,e):{}.toString.call(r)=="[object Set]"?Gg(Array.from(r),Array.from(e)):{}.toString.call(r)=="[object Object]"?bx(r,e):vx(r,e)}function vx(r,e){return r.toString()===e.toString()}function Gg(r,e){var t=r.length;if(t!=e.length)return!1;for(var i=0;i<t;i++)if(!Up(r[i],e[i]))return!1;return!0}function bx(r,e){var t=Object.keys(r),i=t.length;if(i!=Object.keys(e).length)return!1;for(var l=0;l<i;l++){var u=t[l];if(!(e.hasOwnProperty(u)&&Up(r[u],e[u])))return!1}return!0}function wx(r,e,t){let i;const{map:l}=cc();lt(r,l,k=>t(6,i=k));let{position:u="top-left"}=e,{showCompass:d=!0}=e,{showZoom:a=!0}=e,{visualizePitch:_=!1}=e,v=null;return er(()=>{i!=null&&i.loaded()&&v&&i.removeControl(v)}),r.$$set=k=>{"position"in k&&t(1,u=k.position),"showCompass"in k&&t(2,d=k.showCompass),"showZoom"in k&&t(3,a=k.showZoom),"visualizePitch"in k&&t(4,_=k.visualizePitch)},r.$$.update=()=>{r.$$.dirty&126&&i&&!v&&(t(5,v=new to.NavigationControl({showCompass:d,showZoom:a,visualizePitch:_})),i.addControl(v,u))},[l,u,d,a,_,v,i]}class I0 extends Vt{constructor(e){super(),Ut(this,e,wx,null,zt,{position:1,showCompass:2,showZoom:3,visualizePitch:4})}}function xx(r,e,t){let i;const{map:l}=cc();lt(r,l,v=>t(5,i=v));let{position:u="bottom-left"}=e,{maxWidth:d=void 0}=e,{unit:a="metric"}=e,_=null;return er(()=>{i!=null&&i.loaded()&&_&&i.removeControl(_)}),r.$$set=v=>{"position"in v&&t(1,u=v.position),"maxWidth"in v&&t(2,d=v.maxWidth),"unit"in v&&t(3,a=v.unit)},r.$$.update=()=>{r.$$.dirty&62&&i&&!_&&(t(4,_=new to.ScaleControl({maxWidth:d,unit:a})),i.addControl(_,u))},[l,u,d,a,_,i]}class L0 extends Vt{constructor(e){super(),Ut(this,e,xx,null,zt,{position:1,maxWidth:2,unit:3})}}const{window:kx}=Md,Sx=r=>({map:r[0]&16,loadedImages:r[0]&32,allImagesLoaded:r[0]&64}),Wg=r=>({map:r[4],loadedImages:r[5],allImagesLoaded:r[6]});function Hg(r){let e,t,i=r[3]&&Xg(r);const l=r[46].default,u=$i(l,r,r[45],Wg);return{c(){i&&i.c(),e=Ae(),u&&u.c()},m(d,a){i&&i.m(d,a),ae(d,e,a),u&&u.m(d,a),t=!0},p(d,a){d[3]?i?(i.p(d,a),a[0]&8&&J(i,1)):(i=Xg(d),i.c(),J(i,1),i.m(e.parentNode,e)):i&&(yi(),ne(i,1,1,()=>{i=null}),vi()),u&&u.p&&(!t||a[0]&112|a[1]&16384)&&Zi(u,l,d,d[45],t?qi(l,d[45],a,Sx):Gi(d[45]),Wg)},i(d){t||(J(i),J(u,d),t=!0)},o(d){ne(i),ne(u,d),t=!1},d(d){d&&se(e),i&&i.d(d),u&&u.d(d)}}}function Xg(r){let e,t,i,l,u,d,a,_;return e=new I0({props:{position:r[7]}}),i=new dx({props:{position:r[7],fitBoundsOptions:{maxZoom:12}}}),u=new sx({props:{position:r[7]}}),a=new L0({props:{position:r[7]}}),{c(){Ie(e.$$.fragment),t=Ae(),Ie(i.$$.fragment),l=Ae(),Ie(u.$$.fragment),d=Ae(),Ie(a.$$.fragment)},m(v,k){Ee(e,v,k),ae(v,t,k),Ee(i,v,k),ae(v,l,k),Ee(u,v,k),ae(v,d,k),Ee(a,v,k),_=!0},p(v,k){const S={};k[0]&128&&(S.position=v[7]),e.$set(S);const E={};k[0]&128&&(E.position=v[7]),i.$set(E);const A={};k[0]&128&&(A.position=v[7]),u.$set(A);const D={};k[0]&128&&(D.position=v[7]),a.$set(D)},i(v){_||(J(e.$$.fragment,v),J(i.$$.fragment,v),J(u.$$.fragment,v),J(a.$$.fragment,v),_=!0)},o(v){ne(e.$$.fragment,v),ne(i.$$.fragment,v),ne(u.$$.fragment,v),ne(a.$$.fragment,v),_=!1},d(v){v&&(se(t),se(l),se(d)),Me(e,v),Me(i,v),Me(u,v),Me(a,v)}}}function Tx(r){let e,t,i,l,u,d=r[4]&&r[0]&&Hg(r);return{c(){e=oe("div"),d&&d.c(),ke(e,"class",t=yd(r[2])+" svelte-p00lfq"),ke(e,"data-testid","map-container"),cr(e,"expand-map",!r[2])},m(a,_){ae(a,e,_),d&&d.m(e,null),r[47](e),i=!0,l||(u=[St(kx,"hashchange",r[11]),rp(r[10].call(null,e))],l=!0)},p(a,_){a[4]&&a[0]?d?(d.p(a,_),_[0]&17&&J(d,1)):(d=Hg(a),d.c(),J(d,1),d.m(e,null)):d&&(yi(),ne(d,1,1,()=>{d=null}),vi()),(!i||_[0]&4&&t!==(t=yd(a[2])+" svelte-p00lfq"))&&ke(e,"class",t),(!i||_[0]&4)&&cr(e,"expand-map",!a[2])},i(a){i||(J(d),i=!0)},o(a){ne(d),i=!1},d(a){a&&se(e),d&&d.d(),r[47](null),l=!1,hn(u)}}}function Cx(r,e,t){let i,l,u,d,{$$slots:a={},$$scope:_}=e,{map:v=null}=e,{mapContainer:k=void 0}=e,{class:S=void 0}=e,{style:E}=e,{diffStyleUpdates:A=!1}=e,{center:D=void 0}=e,{zoom:B=void 0}=e,{pitch:P=0}=e,{bearing:R=0}=e,{bounds:F=void 0}=e,{hash:j=!1}=e,{updateHash:U=qe=>{window.history.replaceState(window.history.state,"",qe)}}=e,{loaded:le=!1}=e,{minZoom:he=0}=e,{maxZoom:Z=22}=e,{minPitch:Q=0}=e,{maxPitch:ye=60}=e,{renderWorldCopies:Ne=void 0}=e,{dragPan:re=void 0}=e,{dragRotate:ve=void 0}=e,{pitchWithRotate:Ke=void 0}=e,{antialias:Le=void 0}=e,{zoomOnDoubleClick:et=!0}=e,{locale:xt=void 0}=e,{interactive:mt=!0}=e,{attributionControl:at=!0}=e,{cooperativeGestures:Ht=!1}=e,{preserveDrawingBuffer:ri=!1}=e,{maxBounds:Nt=void 0}=e,{images:At=[]}=e,{standardControls:ei=!1}=e,{filterLayers:ci=void 0}=e,{transformRequest:ti=void 0}=e;const ft=rs(),{map:Jt,loadedImages:gi}=$w();lt(r,Jt,qe=>t(4,u=qe)),lt(r,gi,qe=>t(5,d=qe));let zi=new Set;async function Fi(qe,Ye=!1){if(u&&!(!u.loaded()&&!Ye))if("url"in qe){zi.add(qe.id);try{let Ot=await u.loadImage(qe.url);u==null||u.addImage(qe.id,Ot.data,qe.options),d.add(qe.id),gi.set(d)}catch(Ot){ft("error",Ot)}finally{zi.delete(qe.id)}}else u.addImage(qe.id,qe.data,qe.options),d.add(qe.id),gi.set(d)}let ut,Dt,Fe,je;function ht(qe){return we(),Tt(Jt,u=new to.Map(ja({container:qe,style:E,locale:xt,center:D,zoom:B,pitch:P,bearing:R,minZoom:he,maxZoom:Z,minPitch:Q,maxPitch:ye,renderWorldCopies:Ne,dragPan:re,dragRotate:ve,pitchWithRotate:Ke,antialias:Le,interactive:mt,preserveDrawingBuffer:ri,maxBounds:Nt,bounds:F,attributionControl:at,transformRequest:ti,cooperativeGestures:Ht})),u),u.on("load",Ye=>{Ye.target.getContainer().setAttribute("data-testid","map"),Ye.target.getCanvas().setAttribute("data-testid","map-canvas"),t(0,le=!0),ft("load",u)}),u.on("error",Ye=>ft("error",{...Ye,map:u})),u.on("movestart",Ye=>ft("movestart",{...Ye,map:u})),u.on("moveend",Ye=>{if(t(12,D=Ye.target.getCenter()),t(13,B=Ye.target.getZoom()),t(14,P=Ye.target.getPitch()),t(15,R=Ye.target.getBearing()),t(16,F=Ye.target.getBounds()),ft("moveend",{...Ye,map:u}),j){let Ot=new URL(window.location.href.replace(/(#.+)?$/,_x(u)));U(Ot)}}),u.on("click",Ye=>ft("click",{...Ye,map:u})),u.on("dblclick",Ye=>ft("dblclick",{...Ye,map:u})),u.on("contextmenu",Ye=>ft("contextmenu",{...Ye,map:u})),u.on("zoomstart",Ye=>ft("zoomstart",{...Ye,map:u})),u.on("zoom",Ye=>{ft("zoom",{...Ye,map:u})}),u.on("zoomend",Ye=>{ft("zoomend",{...Ye,map:u})}),u.on("style.load",()=>{if(u){const Ye=u.getStyle();if(t(42,ut=Ye.layers.map(Ot=>Ot.id)),t(43,Dt=Object.keys(Ye.sources)),je)for(const[Ot,Pi]of Object.entries(je))u.addSource(Ot,Pi);if(Fe)for(const Ot of Fe)u.addLayer(Ot);for(const Ot of At)Fi(Ot,!0)}}),u.on("styledata",Ye=>{if(u&&ci){const Ot=u.getStyle().layers;if(Ot)for(let Pi of Ot)ci(Pi)||u.setLayoutProperty(Pi.id,"visibility","none")}ft("styledata",{...Ye,map:u})}),{destroy(){t(0,le=!1),u==null||u.remove(),Tt(Jt,u=null,u)}}}let vt=E;function we(){if(j){let qe=yx(window.location.hash);qe.length>=3&&(t(13,B=qe[0]),t(12,D=[qe[2],qe[1]])),qe.length==5&&(t(15,R=qe[3]),t(14,P=qe[4]))}}function Ei(qe){on[qe?"unshift":"push"](()=>{k=qe,t(1,k)})}return r.$$set=qe=>{"map"in qe&&t(17,v=qe.map),"mapContainer"in qe&&t(1,k=qe.mapContainer),"class"in qe&&t(2,S=qe.class),"style"in qe&&t(18,E=qe.style),"diffStyleUpdates"in qe&&t(19,A=qe.diffStyleUpdates),"center"in qe&&t(12,D=qe.center),"zoom"in qe&&t(13,B=qe.zoom),"pitch"in qe&&t(14,P=qe.pitch),"bearing"in qe&&t(15,R=qe.bearing),"bounds"in qe&&t(16,F=qe.bounds),"hash"in qe&&t(20,j=qe.hash),"updateHash"in qe&&t(21,U=qe.updateHash),"loaded"in qe&&t(0,le=qe.loaded),"minZoom"in qe&&t(22,he=qe.minZoom),"maxZoom"in qe&&t(23,Z=qe.maxZoom),"minPitch"in qe&&t(24,Q=qe.minPitch),"maxPitch"in qe&&t(25,ye=qe.maxPitch),"renderWorldCopies"in qe&&t(26,Ne=qe.renderWorldCopies),"dragPan"in qe&&t(27,re=qe.dragPan),"dragRotate"in qe&&t(28,ve=qe.dragRotate),"pitchWithRotate"in qe&&t(29,Ke=qe.pitchWithRotate),"antialias"in qe&&t(30,Le=qe.antialias),"zoomOnDoubleClick"in qe&&t(31,et=qe.zoomOnDoubleClick),"locale"in qe&&t(32,xt=qe.locale),"interactive"in qe&&t(33,mt=qe.interactive),"attributionControl"in qe&&t(34,at=qe.attributionControl),"cooperativeGestures"in qe&&t(35,Ht=qe.cooperativeGestures),"preserveDrawingBuffer"in qe&&t(36,ri=qe.preserveDrawingBuffer),"maxBounds"in qe&&t(37,Nt=qe.maxBounds),"images"in qe&&t(38,At=qe.images),"standardControls"in qe&&t(3,ei=qe.standardControls),"filterLayers"in qe&&t(39,ci=qe.filterLayers),"transformRequest"in qe&&t(40,ti=qe.transformRequest),"$$scope"in qe&&t(45,_=qe.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&8&&t(7,i=typeof ei=="boolean"?void 0:ei),r.$$.dirty[0]&16&&t(17,v=u),r.$$.dirty[0]&786448|r.$$.dirty[1]&14336&&u&&!$l(E,vt)){const qe=u.getStyle();if(ut&&(Fe=qe.layers.filter(Ye=>!ut.includes(Ye.id))),Dt){const Ye=Object.keys(qe.sources).filter(Ot=>!Dt.includes(Ot));je={};for(const Ot of Ye)je[Ot]=qe.sources[Ot]}t(44,vt=E),u.setStyle(E,{diff:A}),Tt(gi,d=new Set,d),t(41,zi=new Set)}if(r.$$.dirty[0]&49|r.$$.dirty[1]&1152&&le&&u!=null&&u.loaded())for(let qe of At)!d.has(qe.id)&&!zi.has(qe.id)&&!u.hasImage(qe.id)&&Fi(qe);if(r.$$.dirty[0]&32|r.$$.dirty[1]&128&&t(6,l=At.every(qe=>d.has(qe.id))),r.$$.dirty[0]&61456&&u){let qe={};D!=null&&!$l(D,u==null?void 0:u.getCenter())&&(qe.center=D),B!=null&&!$l(B,u==null?void 0:u.getZoom())&&(qe.zoom=B),R!=null&&!$l(R,u==null?void 0:u.getBearing())&&(qe.bearing=R),P!=null&&!$l(P,u==null?void 0:u.getPitch())&&(qe.pitch=P),Object.keys(qe).length&&u.easeTo(qe)}r.$$.dirty[0]&65552&&F&&!$l(F,u==null?void 0:u.getBounds())&&(u==null||u.fitBounds(F)),r.$$.dirty[0]&16|r.$$.dirty[1]&1&&(et?u==null||u.doubleClickZoom.enable():u==null||u.doubleClickZoom.disable())},[le,k,S,ei,u,d,l,i,Jt,gi,ht,we,D,B,P,R,F,v,E,A,j,U,he,Z,Q,ye,Ne,re,ve,Ke,Le,et,xt,mt,at,Ht,ri,Nt,At,ci,ti,zi,ut,Dt,vt,_,a,Ei]}class Ex extends Vt{constructor(e){super(),Ut(this,e,Cx,Tx,zt,{map:17,mapContainer:1,class:2,style:18,diffStyleUpdates:19,center:12,zoom:13,pitch:14,bearing:15,bounds:16,hash:20,updateHash:21,loaded:0,minZoom:22,maxZoom:23,minPitch:24,maxPitch:25,renderWorldCopies:26,dragPan:27,dragRotate:28,pitchWithRotate:29,antialias:30,zoomOnDoubleClick:31,locale:32,interactive:33,attributionControl:34,cooperativeGestures:35,preserveDrawingBuffer:36,maxBounds:37,images:38,standardControls:3,filterLayers:39,transformRequest:40},null,[-1,-1])}}const Mx=r=>({marker:r&8}),Kg=r=>({marker:r[3]});function Ix(r){let e,t,i,l,u,d,a;const _=r[19].default,v=$i(_,r,r[18],Kg);return{c(){e=oe("div"),v&&v.c(),ke(e,"tabindex",t=r[1]?0:void 0),ke(e,"role",i=r[1]?"button":void 0),Ai(e,"z-index",r[2])},m(k,S){ae(k,e,S),v&&v.m(e,null),u=!0,d||(a=[rp(r[7].call(null,e)),rp(l=Lx.call(null,e,r[0])),St(e,"click",Gf(r[20])),St(e,"dblclick",Gf(r[21])),St(e,"contextmenu",Gf(Mp(r[22]))),St(e,"mouseenter",r[23]),St(e,"mouseleave",r[24]),St(e,"mousemove",r[25]),St(e,"keydown",r[8])],d=!0)},p(k,[S]){v&&v.p&&(!u||S&262152)&&Zi(v,_,k,k[18],u?qi(_,k[18],S,Mx):Gi(k[18]),Kg),(!u||S&2&&t!==(t=k[1]?0:void 0))&&ke(e,"tabindex",t),(!u||S&2&&i!==(i=k[1]?"button":void 0))&&ke(e,"role",i),l&&ec(l.update)&&S&1&&l.update.call(null,k[0]),S&4&&Ai(e,"z-index",k[2])},i(k){u||(J(v,k),u=!0)},o(k){ne(v,k),u=!1},d(k){k&&se(e),v&&v.d(k),d=!1,hn(a)}}}function Lx(r,e){const t=r.className;function i(l){l?r.className=`${t} ${l}`:r.className=t}return i(e),{update:i}}function Ax(r,e,t){let i,l,u,{$$slots:d={},$$scope:a}=e,{marker:_=void 0}=e,{lngLat:v}=e,{class:k=void 0}=e,{interactive:S=!0}=e,{asButton:E=!1}=e,{draggable:A=!1}=e,{feature:D=null}=e,{offset:B=void 0}=e,{zIndex:P=void 0}=e,{rotation:R=0}=e,{opacity:F=1}=e;const j=rs(),{map:U,layerEvent:le,self:he,markerClickManager:Z}=Gw();lt(r,U,at=>t(27,u=at)),lt(r,le,at=>t(26,i=at)),lt(r,he,at=>t(3,l=at));function Q(at){Tt(he,l=new to.Marker({element:at,rotation:R,draggable:A,offset:B,opacity:F.toString()}).setLngLat(v).addTo(u),l),t(11,_=l);const Ht=()=>re("dragstart"),ri=()=>{ye(),re("drag")},Nt=()=>{ye(),re("dragend")};return A&&(l.on("dragstart",Ht),l.on("drag",ri),l.on("dragend",Nt)),{destroy(){A&&(l==null||l.off("dragstart",Ht),l==null||l.off("drag",ri),l==null||l.off("dragend",Nt)),t(11,_=void 0),l==null||l.remove()}}}function ye(){let at=l==null?void 0:l.getLngLat();at&&(Array.isArray(v)?t(10,v=[at.lng,at.lat]):v&&"lon"in v?t(10,v={lon:at.lng,lat:at.lat}):t(10,v=at))}function Ne(at){at.key===" "&&(at.preventDefault(),at.stopPropagation(),re("click"))}function re(at){if(!S)return;let Ht=l==null?void 0:l.getLngLat();if(!Ht)return;const ri=[Ht.lng,Ht.lat];let Nt={map:u,marker:l,lngLat:ri,features:[{type:"Feature",properties:(D==null?void 0:D.properties)??{},geometry:{type:"Point",coordinates:ri}}]};(at==="click"||at==="contextmenu")&&Z.handleClick(Nt),Tt(le,i={...Nt,layerType:"marker",type:at},i),j(at,Nt)}const ve=()=>re("click"),Ke=()=>re("dblclick"),Le=()=>{re("contextmenu")},et=()=>{re("mouseenter")},xt=()=>{re("mouseleave")},mt=()=>re("mousemove");return r.$$set=at=>{"marker"in at&&t(11,_=at.marker),"lngLat"in at&&t(10,v=at.lngLat),"class"in at&&t(0,k=at.class),"interactive"in at&&t(12,S=at.interactive),"asButton"in at&&t(1,E=at.asButton),"draggable"in at&&t(13,A=at.draggable),"feature"in at&&t(14,D=at.feature),"offset"in at&&t(15,B=at.offset),"zIndex"in at&&t(2,P=at.zIndex),"rotation"in at&&t(16,R=at.rotation),"opacity"in at&&t(17,F=at.opacity),"$$scope"in at&&t(18,a=at.$$scope)},r.$$.update=()=>{r.$$.dirty&1032&&(l==null||l.setLngLat(v)),r.$$.dirty&32776&&(l==null||l.setOffset(B??[0,0])),r.$$.dirty&65544&&(l==null||l.setRotation(R)),r.$$.dirty&131080&&(l==null||l.setOpacity(F.toString()))},[k,E,P,l,U,le,he,Q,Ne,re,v,_,S,A,D,B,R,F,a,d,ve,Ke,Le,et,xt,mt]}class Rd extends Vt{constructor(e){super(),Ut(this,e,Ax,Ix,zt,{marker:11,lngLat:10,class:0,interactive:12,asButton:1,draggable:13,feature:14,offset:15,zIndex:2,rotation:16,opacity:17})}}var Wu=Uint8Array,A0=Uint16Array,Px=Int32Array,zx=new Wu([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Dx=new Wu([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),P0=function(r,e){for(var t=new A0(31),i=0;i<31;++i)t[i]=e+=1<<r[i-1];for(var l=new Px(t[30]),i=1;i<30;++i)for(var u=t[i];u<t[i+1];++u)l[u]=u-t[i]<<5|i;return{b:t,r:l}},z0=P0(zx,2),Rx=z0.b,Bx=z0.r;Rx[28]=258,Bx[258]=28;P0(Dx,0);var Fx=new A0(32768);for(Hi=0;Hi<32768;++Hi)vs=(Hi&43690)>>1|(Hi&21845)<<1,vs=(vs&52428)>>2|(vs&13107)<<2,vs=(vs&61680)>>4|(vs&3855)<<4,Fx[Hi]=((vs&65280)>>8|(vs&255)<<8)>>1;var vs,Hi,Bd=new Wu(288);for(Hi=0;Hi<144;++Hi)Bd[Hi]=8;var Hi;for(Hi=144;Hi<256;++Hi)Bd[Hi]=9;var Hi;for(Hi=256;Hi<280;++Hi)Bd[Hi]=7;var Hi;for(Hi=280;Hi<288;++Hi)Bd[Hi]=8;var Hi,Ox=new Wu(32);for(Hi=0;Hi<32;++Hi)Ox[Hi]=5;var Hi,Nx=new Wu(0),jx=typeof TextDecoder<"u"&&new TextDecoder,Ux=0;try{jx.decode(Nx,{stream:!0}),Ux=1}catch{}function Vx(r){let e;const t=r[16].default,i=$i(t,r,r[24],null);return{c(){i&&i.c()},m(l,u){i&&i.m(l,u),e=!0},p(l,u){i&&i.p&&(!e||u&16777216)&&Zi(i,t,l,l[24],e?qi(t,l[24],u,null):Gi(l[24]),null)},i(l){e||(J(i,l),e=!0)},o(l){ne(i,l),e=!1},d(l){i&&i.d(l)}}}function $x(r){let e,t,i;function l(d){r[17](d)}let u={id:r[1],type:"symbol",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],applyToClusters:r[9],minzoom:r[10],maxzoom:r[11],hoverCursor:r[12],manageHoverState:r[13],eventsIfTopMost:r[14],interactive:r[15],$$slots:{default:[Vx]},$$scope:{ctx:r}};return r[0]!==void 0&&(u.hovered=r[0]),e=new Dd({props:u}),on.push(()=>Wr(e,"hovered",l)),e.$on("click",r[18]),e.$on("dblclick",r[19]),e.$on("contextmenu",r[20]),e.$on("mouseenter",r[21]),e.$on("mousemove",r[22]),e.$on("mouseleave",r[23]),{c(){Ie(e.$$.fragment)},m(d,a){Ee(e,d,a),i=!0},p(d,[a]){const _={};a&2&&(_.id=d[1]),a&4&&(_.source=d[2]),a&8&&(_.sourceLayer=d[3]),a&16&&(_.beforeId=d[4]),a&32&&(_.beforeLayerType=d[5]),a&64&&(_.paint=d[6]),a&128&&(_.layout=d[7]),a&256&&(_.filter=d[8]),a&512&&(_.applyToClusters=d[9]),a&1024&&(_.minzoom=d[10]),a&2048&&(_.maxzoom=d[11]),a&4096&&(_.hoverCursor=d[12]),a&8192&&(_.manageHoverState=d[13]),a&16384&&(_.eventsIfTopMost=d[14]),a&32768&&(_.interactive=d[15]),a&16777216&&(_.$$scope={dirty:a,ctx:d}),!t&&a&1&&(t=!0,_.hovered=d[0],Gr(()=>t=!1)),e.$set(_)},i(d){i||(J(e.$$.fragment,d),i=!0)},o(d){ne(e.$$.fragment,d),i=!1},d(d){Me(e,d)}}}function qx(r,e,t){let{$$slots:i={},$$scope:l}=e,{id:u=lc("symbol")}=e,{source:d=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:_=void 0}=e,{beforeLayerType:v=void 0}=e,{paint:k=void 0}=e,{layout:S=void 0}=e,{filter:E=void 0}=e,{applyToClusters:A=void 0}=e,{minzoom:D=void 0}=e,{maxzoom:B=void 0}=e,{hoverCursor:P=void 0}=e,{manageHoverState:R=!1}=e,{hovered:F=null}=e,{eventsIfTopMost:j=!1}=e,{interactive:U=!0}=e;function le(ve){F=ve,t(0,F)}function he(ve){fi.call(this,r,ve)}function Z(ve){fi.call(this,r,ve)}function Q(ve){fi.call(this,r,ve)}function ye(ve){fi.call(this,r,ve)}function Ne(ve){fi.call(this,r,ve)}function re(ve){fi.call(this,r,ve)}return r.$$set=ve=>{"id"in ve&&t(1,u=ve.id),"source"in ve&&t(2,d=ve.source),"sourceLayer"in ve&&t(3,a=ve.sourceLayer),"beforeId"in ve&&t(4,_=ve.beforeId),"beforeLayerType"in ve&&t(5,v=ve.beforeLayerType),"paint"in ve&&t(6,k=ve.paint),"layout"in ve&&t(7,S=ve.layout),"filter"in ve&&t(8,E=ve.filter),"applyToClusters"in ve&&t(9,A=ve.applyToClusters),"minzoom"in ve&&t(10,D=ve.minzoom),"maxzoom"in ve&&t(11,B=ve.maxzoom),"hoverCursor"in ve&&t(12,P=ve.hoverCursor),"manageHoverState"in ve&&t(13,R=ve.manageHoverState),"hovered"in ve&&t(0,F=ve.hovered),"eventsIfTopMost"in ve&&t(14,j=ve.eventsIfTopMost),"interactive"in ve&&t(15,U=ve.interactive),"$$scope"in ve&&t(24,l=ve.$$scope)},[F,u,d,a,_,v,k,S,E,A,D,B,P,R,j,U,i,le,he,Z,Q,ye,Ne,re,l]}class D0 extends Vt{constructor(e){super(),Ut(this,e,qx,$x,zt,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}var Zx=Object.defineProperty,R0=r=>{throw TypeError(r)},Gx=(r,e,t)=>e in r?Zx(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,po=(r,e,t)=>Gx(r,typeof e!="symbol"?e+"":e,t),B0=(r,e,t)=>e.has(r)||R0("Cannot "+t),ir=(r,e,t)=>(B0(r,e,"read from private field"),t?t.call(r):e.get(r)),Jg=(r,e,t)=>e.has(r)?R0("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(r):e.set(r,t),Yg=(r,e,t,i)=>(B0(r,e,"write to private field"),i?i.call(r,t):e.set(r,t),t);function xn(){}function Wx(r,e){for(const t in e)r[t]=e[t];return r}function F0(r){return r()}function Qg(){return Object.create(null)}function Ls(r){r.forEach(F0)}function O0(r){return typeof r=="function"}function oa(r,e){return r!=r?e==e:r!==e||r&&typeof r=="object"||typeof r=="function"}let od;function zr(r,e){return r===e?!0:(od||(od=document.createElement("a")),od.href=e,r===od.href)}function Hx(r){return Object.keys(r).length===0}function Xx(r,e,t,i){if(r){const l=N0(r,e,t,i);return r[0](l)}}function N0(r,e,t,i){return r[1]&&i?Wx(t.ctx.slice(),r[1](i(e))):t.ctx}function Kx(r,e,t,i){if(r[2]&&i){const l=r[2](i(t));if(e.dirty===void 0)return l;if(typeof l=="object"){const u=[],d=Math.max(e.dirty.length,l.length);for(let a=0;a<d;a+=1)u[a]=e.dirty[a]|l[a];return u}return e.dirty|l}return e.dirty}function Jx(r,e,t,i,l,u){if(l){const d=N0(e,t,i,u);r.p(d,l)}}function Yx(r){if(r.ctx.length>32){const e=[],t=r.ctx.length/32;for(let i=0;i<t;i++)e[i]=-1;return e}return-1}function e_(r){return r??""}function Bi(r,e){r.appendChild(e)}function Cn(r,e,t){r.insertBefore(e,t||null)}function kn(r){r.parentNode&&r.parentNode.removeChild(r)}function nn(r){return document.createElement(r)}function Vo(r){return document.createElementNS("http://www.w3.org/2000/svg",r)}function ia(r){return document.createTextNode(r)}function mo(){return ia(" ")}function Qx(){return ia("")}function Zr(r,e,t,i){return r.addEventListener(e,t,i),()=>r.removeEventListener(e,t,i)}function e2(r){return function(e){return e.preventDefault(),r.call(this,e)}}function st(r,e,t){t==null?r.removeAttribute(e):r.getAttribute(e)!==t&&r.setAttribute(e,t)}function t2(r){return Array.from(r.childNodes)}function Ou(r,e){e=""+e,r.data!==e&&(r.data=e)}function t_(r,e){r.value=e??""}function Lo(r,e,t){r.classList.toggle(e,!!t)}function i2(r,e,{bubbles:t=!1,cancelable:i=!1}={}){return new CustomEvent(r,{detail:e,bubbles:t,cancelable:i})}let Nu;function Iu(r){Nu=r}function j0(){if(!Nu)throw new Error("Function called outside component initialization");return Nu}function n2(r){j0().$$.on_destroy.push(r)}function r2(){const r=j0();return(e,t,{cancelable:i=!1}={})=>{const l=r.$$.callbacks[e];if(l){const u=i2(e,t,{cancelable:i});return l.slice().forEach(d=>{d.call(r,u)}),!u.defaultPrevented}return!0}}function i_(r,e){const t=r.$$.callbacks[e.type];t&&t.slice().forEach(i=>i.call(this,e))}const Xl=[],pp=[];let Yl=[];const n_=[],o2=Promise.resolve();let mp=!1;function s2(){mp||(mp=!0,o2.then(U0))}function gp(r){Yl.push(r)}const Jf=new Set;let ql=0;function U0(){if(ql!==0)return;const r=Nu;do{try{for(;ql<Xl.length;){const e=Xl[ql];ql++,Iu(e),a2(e.$$)}}catch(e){throw Xl.length=0,ql=0,e}for(Iu(null),Xl.length=0,ql=0;pp.length;)pp.pop()();for(let e=0;e<Yl.length;e+=1){const t=Yl[e];Jf.has(t)||(Jf.add(t),t())}Yl.length=0}while(Xl.length);for(;n_.length;)n_.pop()();mp=!1,Jf.clear(),Iu(r)}function a2(r){if(r.fragment!==null){r.update(),Ls(r.before_update);const e=r.dirty;r.dirty=[-1],r.fragment&&r.fragment.p(r.ctx,e),r.after_update.forEach(gp)}}function l2(r){const e=[],t=[];Yl.forEach(i=>r.indexOf(i)===-1?e.push(i):t.push(i)),t.forEach(i=>i()),Yl=e}const dd=new Set;let Fa;function fd(){Fa={r:0,c:[],p:Fa}}function pd(){Fa.r||Ls(Fa.c),Fa=Fa.p}function Yn(r,e){r&&r.i&&(dd.delete(r),r.i(e))}function lr(r,e,t,i){if(r&&r.o){if(dd.has(r))return;dd.add(r),Fa.c.push(()=>{dd.delete(r),i&&(t&&r.d(1),i())}),r.o(e)}else i&&i()}function r_(r){return(r==null?void 0:r.length)!==void 0?r:Array.from(r)}function c2(r,e){lr(r,1,1,()=>{e.delete(r.key)})}function u2(r,e,t,i,l,u,d,a,_,v,k,S){let E=r.length,A=u.length,D=E;const B={};for(;D--;)B[r[D].key]=D;const P=[],R=new Map,F=new Map,j=[];for(D=A;D--;){const Z=S(l,u,D),Q=t(Z);let ye=d.get(Q);ye?j.push(()=>ye.p(Z,e)):(ye=v(Q,Z),ye.c()),R.set(Q,P[D]=ye),Q in B&&F.set(Q,Math.abs(D-B[Q]))}const U=new Set,le=new Set;function he(Z){Yn(Z,1),Z.m(a,k),d.set(Z.key,Z),k=Z.first,A--}for(;E&&A;){const Z=P[A-1],Q=r[E-1],ye=Z.key,Ne=Q.key;Z===Q?(k=Z.first,E--,A--):R.has(Ne)?!d.has(ye)||U.has(ye)?he(Z):le.has(Ne)?E--:F.get(ye)>F.get(Ne)?(le.add(ye),he(Z)):(U.add(Ne),E--):(_(Q,d),E--)}for(;E--;){const Z=r[E];R.has(Z.key)||_(Z,d)}for(;A;)he(P[A-1]);return Ls(j),P}function na(r){r&&r.c()}function Ms(r,e,t){const{fragment:i,after_update:l}=r.$$;i&&i.m(e,t),gp(()=>{const u=r.$$.on_mount.map(F0).filter(O0);r.$$.on_destroy?r.$$.on_destroy.push(...u):Ls(u),r.$$.on_mount=[]}),l.forEach(gp)}function Is(r,e){const t=r.$$;t.fragment!==null&&(l2(t.after_update),Ls(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function h2(r,e){r.$$.dirty[0]===-1&&(Xl.push(r),s2(),r.$$.dirty.fill(0)),r.$$.dirty[e/31|0]|=1<<e%31}function sa(r,e,t,i,l,u,d=null,a=[-1]){const _=Nu;Iu(r);const v=r.$$={fragment:null,ctx:[],props:u,update:xn,not_equal:l,bound:Qg(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(_?_.$$.context:[])),callbacks:Qg(),dirty:a,skip_bound:!1,root:e.target||_.$$.root};d&&d(v.root);let k=!1;if(v.ctx=t?t(r,e.props||{},(S,E,...A)=>{const D=A.length?A[0]:E;return v.ctx&&l(v.ctx[S],v.ctx[S]=D)&&(!v.skip_bound&&v.bound[S]&&v.bound[S](D),k&&h2(r,S)),E}):[],v.update(),k=!0,Ls(v.before_update),v.fragment=i?i(v.ctx):!1,e.target){if(e.hydrate){const S=t2(e.target);v.fragment&&v.fragment.l(S),S.forEach(kn)}else v.fragment&&v.fragment.c();e.intro&&Yn(r.$$.fragment),Ms(r,e.target,e.anchor),U0()}Iu(_)}class aa{constructor(){po(this,"$$"),po(this,"$$set")}$destroy(){Is(this,1),this.$destroy=xn}$on(e,t){if(!O0(t))return xn;const i=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return i.push(t),()=>{const l=i.indexOf(t);l!==-1&&i.splice(l,1)}}$set(e){this.$$set&&!Hx(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const d2="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(d2);function f2(r){let e,t;return{c(){e=Vo("svg"),t=Vo("path"),st(t,"d","M13.12.706a.982.982 0 0 0-1.391 0L6.907 5.517 2.087.696a.982.982 0 1 0-1.391 1.39l4.821 4.821L.696 11.73a.982.982 0 1 0 1.39 1.39l4.821-4.821 4.822 4.821a.982.982 0 1 0 1.39-1.39L8.298 6.908l4.821-4.822a.988.988 0 0 0 0-1.38Z"),st(e,"viewBox","0 0 14 14"),st(e,"width","13"),st(e,"height","13"),st(e,"class","svelte-en2qvf")},m(i,l){Cn(i,e,l),Bi(e,t)},p:xn,i:xn,o:xn,d(i){i&&kn(e)}}}class V0 extends aa{constructor(e){super(),sa(this,e,null,f2,oa,{})}}function p2(r){let e,t;return{c(){e=Vo("svg"),t=Vo("path"),st(t,"d","M15 0C6.705 0 0 6.705 0 15C0 23.295 6.705 30 15 30C23.295 30 30 23.295 30 15C30 6.705 23.295 0 15 0ZM22.5 20.385L20.385 22.5L15 17.115L9.615 22.5L7.5 20.385L12.885 15L7.5 9.615L9.615 7.5L15 12.885L20.385 7.5L22.5 9.615L17.115 15L22.5 20.385Z"),st(e,"viewBox","0 0 30 30"),st(e,"fill","none"),st(e,"xmlns","http://www.w3.org/2000/svg"),st(e,"class","svelte-d2loi5")},m(i,l){Cn(i,e,l),Bi(e,t)},p:xn,i:xn,o:xn,d(i){i&&kn(e)}}}class $0 extends aa{constructor(e){super(),sa(this,e,null,p2,oa,{})}}function m2(r){let e,t;return{c(){e=nn("img"),zr(e.src,t=r[3]+"area.svg")||st(e,"src",t),st(e,"alt",r[6]),st(e,"class","svelte-ltkwvy")},m(i,l){Cn(i,e,l)},p(i,l){l&8&&!zr(e.src,t=i[3]+"area.svg")&&st(e,"src",t),l&64&&st(e,"alt",i[6])},d(i){i&&kn(e)}}}function g2(r){let e,t;return{c(){e=nn("img"),zr(e.src,t=r[3]+"reverse.svg")||st(e,"src",t),st(e,"alt",r[6]),st(e,"class","svelte-ltkwvy")},m(i,l){Cn(i,e,l)},p(i,l){l&8&&!zr(e.src,t=i[3]+"reverse.svg")&&st(e,"src",t),l&64&&st(e,"alt",i[6])},d(i){i&&kn(e)}}}function _2(r){let e,t;return{c(){e=nn("img"),zr(e.src,t=r[3]+"poi.svg")||st(e,"src",t),st(e,"alt",r[6]),st(e,"class","svelte-ltkwvy")},m(i,l){Cn(i,e,l)},p(i,l){l&8&&!zr(e.src,t=i[3]+"poi.svg")&&st(e,"src",t),l&64&&st(e,"alt",i[6])},d(i){i&&kn(e)}}}function y2(r){let e,t;return{c(){e=nn("img"),zr(e.src,t=r[3]+"postal_code.svg")||st(e,"src",t),st(e,"alt",r[6]),st(e,"class","svelte-ltkwvy")},m(i,l){Cn(i,e,l)},p(i,l){l&8&&!zr(e.src,t=i[3]+"postal_code.svg")&&st(e,"src",t),l&64&&st(e,"alt",i[6])},d(i){i&&kn(e)}}}function v2(r){let e,t;return{c(){e=nn("img"),zr(e.src,t=r[3]+"street.svg")||st(e,"src",t),st(e,"alt",r[6]),st(e,"class","svelte-ltkwvy")},m(i,l){Cn(i,e,l)},p(i,l){l&8&&!zr(e.src,t=i[3]+"street.svg")&&st(e,"src",t),l&64&&st(e,"alt",i[6])},d(i){i&&kn(e)}}}function b2(r){let e,t;return{c(){e=nn("img"),zr(e.src,t=r[3]+"road.svg")||st(e,"src",t),st(e,"alt",r[6]),st(e,"class","svelte-ltkwvy")},m(i,l){Cn(i,e,l)},p(i,l){l&8&&!zr(e.src,t=i[3]+"road.svg")&&st(e,"src",t),l&64&&st(e,"alt",i[6])},d(i){i&&kn(e)}}}function w2(r){let e,t;return{c(){e=nn("img"),zr(e.src,t=r[3]+"housenumber.svg")||st(e,"src",t),st(e,"alt",r[6]),st(e,"class","svelte-ltkwvy")},m(i,l){Cn(i,e,l)},p(i,l){l&8&&!zr(e.src,t=i[3]+"housenumber.svg")&&st(e,"src",t),l&64&&st(e,"alt",i[6])},d(i){i&&kn(e)}}}function x2(r){let e,t,i,l;return{c(){e=nn("img"),zr(e.src,t=r[5])||st(e,"src",t),st(e,"alt",r[4]),st(e,"class","svelte-ltkwvy")},m(u,d){Cn(u,e,d),i||(l=Zr(e,"error",r[14]),i=!0)},p(u,d){d&32&&!zr(e.src,t=u[5])&&st(e,"src",t),d&16&&st(e,"alt",u[4])},d(u){u&&kn(e),i=!1,l()}}}function o_(r){let e,t;return{c(){e=nn("span"),t=ia(r[6]),st(e,"class","secondary svelte-ltkwvy")},m(i,l){Cn(i,e,l),Bi(e,t)},p(i,l){l&64&&Ou(t,i[6])},d(i){i&&kn(e)}}}function k2(r){let e,t,i,l,u,d,a,_,v,k=(r[7]?r[0].place_name:r[0].place_name.replace(/,.*/,""))+"",S,E,A=r[2]==="always"||r[2]!=="never"&&!r[0].address&&!r[0].id.startsWith("road.")&&!r[0].id.startsWith("address.")&&!r[0].id.startsWith("postal_code.")&&(!r[0].id.startsWith("poi.")||!r[5])&&!r[7],D,B,P=(r[7]?"":r[0].place_name.replace(/[^,]*,?\s*/,""))+"",R,F,j;function U(Q,ye){return ye&1&&(t=null),ye&1&&(i=null),ye&1&&(l=null),ye&1&&(u=null),Q[5]?x2:Q[0].address?w2:(t==null&&(t=!!Q[0].id.startsWith("road.")),t?b2:(i==null&&(i=!!Q[0].id.startsWith("address.")),i?v2:(l==null&&(l=!!Q[0].id.startsWith("postal_code.")),l?y2:(u==null&&(u=!!Q[0].id.startsWith("poi.")),u?_2:Q[7]?g2:m2))))}let le=U(r,-1),he=le(r),Z=A&&o_(r);return{c(){e=nn("li"),he.c(),d=mo(),a=nn("span"),_=nn("span"),v=nn("span"),S=ia(k),E=mo(),Z&&Z.c(),D=mo(),B=nn("span"),R=ia(P),st(v,"class","primary svelte-ltkwvy"),st(_,"class","svelte-ltkwvy"),st(B,"class","line2 svelte-ltkwvy"),st(a,"class","texts svelte-ltkwvy"),st(e,"tabindex","0"),st(e,"data-selected",r[1]),st(e,"class","svelte-ltkwvy"),Lo(e,"selected",r[1])},m(Q,ye){Cn(Q,e,ye),he.m(e,null),Bi(e,d),Bi(e,a),Bi(a,_),Bi(_,v),Bi(v,S),Bi(_,E),Z&&Z.m(_,null),Bi(a,D),Bi(a,B),Bi(B,R),F||(j=[Zr(e,"mouseenter",r[12]),Zr(e,"focus",r[13])],F=!0)},p(Q,[ye]){le===(le=U(Q,ye))&&he?he.p(Q,ye):(he.d(1),he=le(Q),he&&(he.c(),he.m(e,d))),ye&1&&k!==(k=(Q[7]?Q[0].place_name:Q[0].place_name.replace(/,.*/,""))+"")&&Ou(S,k),ye&37&&(A=Q[2]==="always"||Q[2]!=="never"&&!Q[0].address&&!Q[0].id.startsWith("road.")&&!Q[0].id.startsWith("address.")&&!Q[0].id.startsWith("postal_code.")&&(!Q[0].id.startsWith("poi.")||!Q[5])&&!Q[7]),A?Z?Z.p(Q,ye):(Z=o_(Q),Z.c(),Z.m(_,null)):Z&&(Z.d(1),Z=null),ye&1&&P!==(P=(Q[7]?"":Q[0].place_name.replace(/[^,]*,?\s*/,""))+"")&&Ou(R,P),ye&2&&st(e,"data-selected",Q[1]),ye&2&&Lo(e,"selected",Q[1])},i:xn,o:xn,d(Q){Q&&kn(e),he.d(),Z&&Z.d(),F=!1,Ls(j)}}}function S2(r,e,t){var i;let l,u,{feature:d}=e,{selected:a=!1}=e,{showPlaceType:_}=e,{missingIconsCache:v}=e,{iconsBaseUrl:k}=e;const S=(i=d.properties)==null?void 0:i.categories;let E,A,D=0,B=d.place_type[0]==="reverse";function P(){A&&v.add(A),t(10,D++,D)}function R(U){i_.call(this,r,U)}function F(U){i_.call(this,r,U)}const j=()=>P();return r.$$set=U=>{"feature"in U&&t(0,d=U.feature),"selected"in U&&t(1,a=U.selected),"showPlaceType"in U&&t(2,_=U.showPlaceType),"missingIconsCache"in U&&t(9,v=U.missingIconsCache),"iconsBaseUrl"in U&&t(3,k=U.iconsBaseUrl)},r.$$.update=()=>{var U,le,he,Z;if(r.$$.dirty&3640)do t(11,l--,l),t(4,E=S==null?void 0:S[l]),t(5,A=E?k+E.replace(/ /g,"_")+".svg":void 0);while(l>-1&&(!A||v.has(A)));r.$$.dirty&1&&t(6,u=((le=(U=d.properties)==null?void 0:U.categories)==null?void 0:le.join(", "))??((Z=(he=d.properties)==null?void 0:he.place_type_name)==null?void 0:Z[0])??d.place_type[0])},t(11,l=(S==null?void 0:S.length)??0),[d,a,_,k,E,A,u,B,P,v,D,l,R,F,j]}class T2 extends aa{constructor(e){super(),sa(this,e,S2,k2,oa,{feature:0,selected:1,showPlaceType:2,missingIconsCache:9,iconsBaseUrl:3})}}function C2(r){let e;return{c(){e=nn("div"),e.innerHTML='<svg viewBox="0 0 18 18" width="24" height="24" class="svelte-7cmwmc"><path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"></path><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"></path></svg>',st(e,"class","svelte-7cmwmc")},m(t,i){Cn(t,e,i)},p:xn,i:xn,o:xn,d(t){t&&kn(e)}}}class E2 extends aa{constructor(e){super(),sa(this,e,null,C2,oa,{})}}function M2(r){let e,t,i;return{c(){e=Vo("svg"),t=Vo("path"),st(t,"stroke-width","4"),st(t,"d","M 5,33.103579 C 5,17.607779 18.457,5 35,5 C 51.543,5 65,17.607779 65,33.103579 C 65,56.388679 40.4668,76.048179 36.6112,79.137779 C 36.3714,79.329879 36.2116,79.457979 36.1427,79.518879 C 35.8203,79.800879 35.4102,79.942779 35,79.942779 C 34.5899,79.942779 34.1797,79.800879 33.8575,79.518879 C 33.7886,79.457979 33.6289,79.330079 33.3893,79.138079 C 29.5346,76.049279 5,56.389379 5,33.103579 Z M 35.0001,49.386379 C 43.1917,49.386379 49.8323,42.646079 49.8323,34.331379 C 49.8323,26.016779 43.1917,19.276479 35.0001,19.276479 C 26.8085,19.276479 20.1679,26.016779 20.1679,34.331379 C 20.1679,42.646079 26.8085,49.386379 35.0001,49.386379 Z"),st(t,"class","svelte-gzo3ar"),st(e,"width",i=r[0]==="list"?20:void 0),st(e,"viewBox","0 0 70 85"),st(e,"fill","none"),st(e,"class","svelte-gzo3ar"),Lo(e,"in-map",r[0]!=="list"),Lo(e,"list-icon",r[0]==="list")},m(l,u){Cn(l,e,u),Bi(e,t)},p(l,[u]){u&1&&i!==(i=l[0]==="list"?20:void 0)&&st(e,"width",i),u&1&&Lo(e,"in-map",l[0]!=="list"),u&1&&Lo(e,"list-icon",l[0]==="list")},i:xn,o:xn,d(l){l&&kn(e)}}}function I2(r,e,t){let{displayIn:i}=e;return r.$$set=l=>{"displayIn"in l&&t(0,i=l.displayIn)},[i]}class L2 extends aa{constructor(e){super(),sa(this,e,I2,M2,oa,{displayIn:0})}}function A2(r){let e,t;return{c(){e=Vo("svg"),t=Vo("path"),st(t,"d","M30.003-26.765C13.46-26.765 0-14.158 0 1.337c0 23.286 24.535 42.952 28.39 46.04.24.192.402.316.471.376.323.282.732.424 1.142.424.41 0 .82-.142 1.142-.424.068-.06.231-.183.471-.376 3.856-3.09 28.39-22.754 28.39-46.04 0-15.495-13.46-28.102-30.003-28.102Zm1.757 12.469c4.38 0 7.858 1.052 10.431 3.158 2.595 2.105 3.89 4.913 3.89 8.422 0 2.34-.53 4.362-1.593 6.063-1.063 1.702-3.086 3.616-6.063 5.742-2.042 1.51-3.337 2.659-3.89 3.446-.532.787-.8 1.82-.8 3.096v1.914h-8.449V15.18c0-2.041.434-3.815 1.306-5.325.872-1.51 2.467-3.118 4.785-4.82 2.233-1.594 3.7-2.89 4.402-3.889a5.582 5.582 0 0 0 1.087-3.35c0-1.382-.51-2.435-1.531-3.158-1.02-.723-2.45-1.087-4.28-1.087-3.19 0-6.826 1.047-10.91 3.131l-3.472-6.986c4.742-2.659 9.77-3.992 15.087-3.992Zm-1.88 37.324c1.765 0 3.124.472 4.08 1.408.98.936 1.47 2.276 1.47 4.02 0 1.68-.49 3.007-1.47 3.985-.977.957-2.336 1.435-4.08 1.435-1.787 0-3.171-.465-4.15-1.4-.978-.958-1.47-2.298-1.47-4.02 0-1.787.48-3.14 1.436-4.054.957-.915 2.355-1.374 4.184-1.374Z"),st(e,"viewBox","0 0 60.006 21.412"),st(e,"width","14"),st(e,"height","20"),st(e,"class","svelte-en2qvf")},m(i,l){Cn(i,e,l),Bi(e,t)},p:xn,i:xn,o:xn,d(i){i&&kn(e)}}}class P2 extends aa{constructor(e){super(),sa(this,e,null,A2,oa,{})}}function z2(r){let e,t,i;return{c(){e=Vo("svg"),t=Vo("circle"),i=Vo("path"),st(t,"cx","4.789"),st(t,"cy","4.787"),st(t,"r","3.85"),st(t,"class","svelte-1aq105l"),st(i,"d","M12.063 12.063 7.635 7.635"),st(i,"class","svelte-1aq105l"),st(e,"xmlns","http://www.w3.org/2000/svg"),st(e,"width","13"),st(e,"height","13"),st(e,"viewBox","0 0 13 13"),st(e,"class","svelte-1aq105l")},m(l,u){Cn(l,e,u),Bi(e,t),Bi(e,i)},p:xn,i:xn,o:xn,d(l){l&&kn(e)}}}class D2 extends aa{constructor(e){super(),sa(this,e,null,z2,oa,{})}}function R2(r,e,t){const i=e[1],l=e[0],u=i-l;return r===i&&t?r:((r-l)%u+u)%u+l}function Td(r){const e=[...r];return e[2]<e[0]&&(Math.abs((e[0]+e[2]+360)/2)>Math.abs((e[0]-360+e[2])/2)?e[0]-=360:e[2]+=360),e}let du;async function B2(r,e,t){const i=r==null?void 0:r.getCenterAndZoom();for(const l of e??[])if(!(i&&(l.minZoom!=null&&l.minZoom>i[0]||l.maxZoom!=null&&l.maxZoom<i[0]))){if(l.type==="fixed")return l.coordinates.join(",");e:if(l.type==="client-geolocation"){if(du&&l.cachedLocationExpiry&&du.time+l.cachedLocationExpiry>Date.now()){if(!du.coords)break e;return du.coords}let u;try{return u=await new Promise((d,a)=>{t.signal.addEventListener("abort",()=>{a(Error("aborted"))}),navigator.geolocation.getCurrentPosition(_=>{d([_.coords.longitude,_.coords.latitude].map(v=>v.toFixed(6)).join(","))},_=>{a(_)},l)}),u}catch{}finally{l.cachedLocationExpiry&&(du={time:Date.now(),coords:u})}if(t.signal.aborted)return}if(l.type==="server-geolocation")return"ip";if(i&&l.type==="map-center")return i[1].toFixed(6)+","+i[2].toFixed(6)}}const F2=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([â¢ÂºÂ°\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['â²Â´â\.:]|M(?:IN)?(?:UTES)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([â¢ÂºÂ°\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['â²Â´â\.:]|M(?:IN)?(?:UTES)?)?\s*(EAST|WEST|[EW])?$/i,s_=/^([+-]?[0-8]?[0-9])\s+([0-5]?[0-9]\.\d{3,})[\s,]{1,}([+-]?[0-1]?[0-9]?[0-9])\s+([0-5]?[0-9]\.\d{3,})$/,a_=/^(NORTH|SOUTH|[NS])?[\s]*([+-]?[0-8]?[0-9](?:[\.,]\d{3,}))[\s]*([â¢ÂºÂ°]?)[\s]*(NORTH|SOUTH|[NS])?[\s]*[,/;]?[\s]*(EAST|WEST|[EW])?[\s]*([+-]?[0-1]?[0-9]?[0-9](?:[\.,]\d{3,}))[\s]*([â¢ÂºÂ°]?)[\s]*(EAST|WEST|[EW])?$/i,l_=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(EAST|WEST|[EW])?$/i,c_=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)\s*(EAST|WEST|[EW])?$/i,u_=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([â¢ÂºÂ°\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['â²Â´â\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''|â²â²|ââ|Â´Â´|["â³â\.])?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([â¢ÂºÂ°\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['â²Â´â\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''|â²â²|Â´Â´|ââ|["â³â\.])?\s*(EAST|WEST|[EW])?$/i;function O2(r){if(!["DMS","DM","DD"].includes(r))throw new Error("invalid format specified");if(this.decimalCoordinates&&this.decimalCoordinates.trim()){const e=this.decimalCoordinates.split(",").map(A=>Number(A.trim())),t=Number(e[0]),i=Number(e[1]),l=Math.abs(t),u=Math.abs(i),d=t>0?"N":"S",a=i>0?"E":"W";let _;r=="DD"&&(_=`${l}Â° ${d}, ${u}Â° ${a}`);const v=Math.floor(l),k=Math.floor(u),S=(l-v)*60,E=(u-k)*60;if(r=="DM"){let A=h_(S,3).toFixed(3).padStart(6,"0"),D=h_(E,3).toFixed(3).padStart(6,"0");A.endsWith(".000")&&D.endsWith(".000")&&(A=A.replace(/\.000$/,""),D=D.replace(/\.000$/,"")),_=`${v}Â° ${A}' ${d}, ${k}Â° ${D}' ${a}`}if(r=="DMS"){const A=Math.floor(S),D=Math.floor(E);let B=((S-A)*60).toFixed(1).padStart(4,"0"),P=((E-D)*60).toFixed(1).padStart(4,"0");const R=A.toString().padStart(2,"0"),F=D.toString().padStart(2,"0");B.endsWith(".0")&&P.endsWith(".0")&&(B=B.replace(/\.0$/,""),P=P.replace(/\.0$/,"")),_=`${v}Â° ${R}' ${B}" ${d}, ${k}Â° ${F}' ${P}" ${a}`}return _}else throw new Error("no decimal coordinates to convert")}function h_(r,e){const t=Math.pow(10,e);return Math.round((r+Number.EPSILON)*t)/t}function Vp(r,e){e||(e=5),r=r.replace(/\s+/g," ").trim();let t=null,i=null,l="",u="",d=null,a=[],_=!1;if(F2.test(r))throw new Error("invalid coordinate value");if(s_.test(r))if(a=s_.exec(r),_=fu(a),_)t=Math.abs(a[1])+a[2]/60,Number(a[1])<0&&(t*=-1),i=Math.abs(a[3])+a[4]/60,Number(a[3])<0&&(i*=-1),d="DM";else throw new Error("invalid coordinate format");else if(a_.test(r))if(a=a_.exec(r),_=fu(a),_){if(t=a[2],i=a[6],t.includes(",")&&(t=t.replace(",",".")),i.includes(",")&&(i=i.replace(",",".")),d="DD",Number(Math.round(t))==Number(t))throw new Error("integer only coordinate provided");if(Number(Math.round(i))==Number(i))throw new Error("integer only coordinate provided");a[1]?(l=a[1],u=a[5]):a[4]&&(l=a[4],u=a[8])}else throw new Error("invalid decimal coordinate format");else if(l_.test(r))if(a=l_.exec(r),_=fu(a),_)t=Math.abs(parseInt(a[2])),a[4]&&(t+=a[4]/60,d="DM"),a[6]&&(t+=a[6].replace(",",".")/3600,d="DMS"),parseInt(a[2])<0&&(t=-1*t),i=Math.abs(parseInt(a[9])),a[11]&&(i+=a[11]/60),a[13]&&(i+=a[13].replace(",",".")/3600),parseInt(a[9])<0&&(i=-1*i),a[1]?(l=a[1],u=a[8]):a[7]&&(l=a[7],u=a[14]);else throw new Error("invalid DMS coordinates format");else if(c_.test(r))if(a=c_.exec(r),_=fu(a),_)t=Math.abs(parseInt(a[2])),a[4]&&(t+=a[4]/60,d="DM"),a[6]&&(t+=a[6]/3600,d="DMS"),parseInt(a[2])<0&&(t=-1*t),i=Math.abs(parseInt(a[10])),a[12]&&(i+=a[12]/60),a[14]&&(i+=a[14]/3600),parseInt(a[10])<0&&(i=-1*i),a[1]?(l=a[1],u=a[9]):a[8]&&(l=a[8],u=a[16]);else throw new Error("invalid DMS coordinates format");else if(u_.test(r)){if(a=u_.exec(r),_=fu(a),a.filter(v=>v).length<=5)throw new Error("invalid coordinates format");if(_)t=Math.abs(parseInt(a[2])),a[4]&&(t+=a[4].replace(",",".")/60,d="DM"),a[6]&&(t+=a[6].replace(",",".")/3600,d="DMS"),parseInt(a[2])<0&&(t=-1*t),i=Math.abs(parseInt(a[10])),a[12]&&(i+=a[12].replace(",",".")/60),a[14]&&(i+=a[14].replace(",",".")/3600),parseInt(a[10])<0&&(i=-1*i),a[1]?(l=a[1],u=a[9]):a[8]&&(l=a[8],u=a[16]);else throw new Error("invalid coordinates format")}if(_){if(Math.abs(i)>=180)throw new Error("invalid longitude value");if(Math.abs(t)>=90)throw new Error("invalid latitude value");if(l&&!u||!l&&u)throw new Error("invalid coordinates value");if(l&&l==u)throw new Error("invalid coordinates format");t.toString().includes(",")&&(t=t.replace(",",".")),i.toString().includes(",")&&(i=i.replace(",","."));let v=/S|SOUTH/i;v.test(l)&&t>0&&(t=-1*t),v=/W|WEST/i,v.test(u)&&i>0&&(i=-1*i);const k=a[0].trim();let S,E;const A=/[,/;\u0020]/g,D=k.match(A);if(D==null){const R=Math.floor(r.length/2);S=k.substring(0,R).trim(),E=k.substring(R).trim()}else{let R;D.length%2==1?R=Math.floor(D.length/2):R=D.length/2-1;let F=0;if(R==0)F=k.indexOf(D[0]),S=k.substring(0,F).trim(),E=k.substring(F+1).trim();else{let j=0,U=0;for(;j<=R;)F=k.indexOf(D[j],U),U=F+1,j++;S=k.substring(0,F).trim(),E=k.substring(F+1).trim()}}const B=S.split(".");if(B.length==2&&B[1]==0&&B[1].length!=2)throw new Error("invalid coordinates format");const P=E.split(".");if(P.length==2&&P[1]==0&&P[1].length!=2)throw new Error("invalid coordinates format");if(/^\d+$/.test(S)||/^\d+$/.test(E))throw new Error("degree only coordinate/s provided");return t=Number(Number(t).toFixed(e)),i=Number(Number(i).toFixed(e)),Object.freeze({verbatimCoordinates:k,verbatimLatitude:S,verbatimLongitude:E,decimalLatitude:t,decimalLongitude:i,decimalCoordinates:`${t},${i}`,originalFormat:d,closeEnough:N2,toCoordinateFormat:O2})}else throw new Error("coordinates pattern match failed")}function fu(r){if(!isNaN(r[0]))return!1;const e=[...r];if(e.shift(),e.length%2>0)return!1;const t=/^[-+]?\d+([\.,]\d+)?$/,i=/[eastsouthnorthwest]+/i,l=e.length/2;for(let u=0;u<l;u++){const d=e[u],a=e[u+l],_=t.test(d)&&t.test(a),v=i.test(d)&&i.test(a),k=d==a;if(!(d==null&&a==null)){if(d==null||a==null)return!1;if(_||v||k)continue;return!1}}return!0}function d_(r,e){const t=Math.abs(r-e);return Number(t.toFixed(6))<=1e-5}function N2(r){if(!r)throw new Error("coords must be provided");if(r.includes(",")){const e=r.split(",");if(Number(e[0])==NaN||Number(e[1])==NaN)throw new Error("coords are not valid decimals");return d_(this.decimalLatitude,Number(e[0]))&&d_(this.decimalLongitude,e[1])}else throw new Error("coords being tested must be separated by a comma")}const j2=Object.freeze({DMS:"DMS",DM:"DM",DD:"DD"});Vp.to=j2;const U2=[{verbatimCoordinates:"40.123, -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123Â° N 74.123Â° W",verbatimLatitude:"40.123Â° N",verbatimLongitude:"74.123Â° W"},{verbatimCoordinates:"40.123Â° N 74.123Â° W",verbatimLatitude:"40.123Â° N",verbatimLongitude:"74.123Â° W"},{verbatimCoordinates:'40Â° 7Â´ 22.8" N 74Â° 7Â´ 22.8" W',verbatimLatitude:'40Â° 7Â´ 22.8" N',verbatimLongitude:'74Â° 7Â´ 22.8" W'},{verbatimCoordinates:"40Â° 7.38â , -74Â° 7.38â",verbatimLatitude:"40Â° 7.38â",verbatimLongitude:"-74Â° 7.38â"},{verbatimCoordinates:"N40Â°7â22.8ââ, W74Â°7â22.8ââ",verbatimLatitude:"N40Â°7â22.8ââ",verbatimLongitude:"W74Â°7â22.8ââ"},{verbatimCoordinates:'40Â°7â22.8"N, 74Â°7â22.8"W',verbatimLatitude:'40Â°7â22.8"N',verbatimLongitude:'74Â°7â22.8"W'},{verbatimCoordinates:`40Â°7'22.8"N, 74Â°7'22.8"W`,verbatimLatitude:`40Â°7'22.8"N`,verbatimLongitude:`74Â°7'22.8"W`},{verbatimCoordinates:"40 7 22.8, -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"},{verbatimCoordinates:"40.123 -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123Â°,-74.123Â°",verbatimLatitude:"40.123Â°",verbatimLongitude:"-74.123Â°"},{verbatimCoordinates:"40.123N74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"4007.38N7407.38W",verbatimLatitude:"4007.38N",verbatimLongitude:"7407.38W"},{verbatimCoordinates:'40Â°7â22.8"N, 74Â°7â22.8"W',verbatimLatitude:'40Â°7â22.8"N',verbatimLongitude:'74Â°7â22.8"W'},{verbatimCoordinates:"400722.8N740722.8W",verbatimLatitude:"400722.8N",verbatimLongitude:"740722.8W"},{verbatimCoordinates:"N 40 7.38 W 74 7.38",verbatimLatitude:"N 40 7.38",verbatimLongitude:"W 74 7.38"},{verbatimCoordinates:"40:7:22.8N 74:7:22.8W",verbatimLatitude:"40:7:22.8N",verbatimLongitude:"74:7:22.8W"},{verbatimCoordinates:"40:7:23N,74:7:23W",verbatimLatitude:"40:7:23N",verbatimLongitude:"74:7:23W",decimalLatitude:40.1230555555,decimalLongitude:-74.1230555555},{verbatimCoordinates:'40Â°7â23"N 74Â°7â23"W',verbatimLatitude:'40Â°7â23"N',verbatimLongitude:'74Â°7â23"W',decimalLatitude:40.1230555555,decimalLongitude:-74.12305555555555},{verbatimCoordinates:'40Â°7â23"S 74Â°7â23"E',verbatimLatitude:'40Â°7â23"S',verbatimLongitude:'74Â°7â23"E',decimalLatitude:-40.1230555555,decimalLongitude:74.12305555555555},{verbatimCoordinates:'40Â°7â23" -74Â°7â23"',verbatimLatitude:'40Â°7â23"',verbatimLongitude:'-74Â°7â23"',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:'40d 7â 23" N 74d 7â 23" W',verbatimLatitude:'40d 7â 23" N',verbatimLongitude:'74d 7â 23" W',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:"40.123N 74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"40Â° 7.38, -74Â° 7.38",verbatimLatitude:"40Â° 7.38",verbatimLongitude:"-74Â° 7.38"},{verbatimCoordinates:"40Â° 7.38, -74Â° 7.38",verbatimLatitude:"40Â° 7.38",verbatimLongitude:"-74Â° 7.38"},{verbatimCoordinates:"40 7 22.8; -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"}],V2={decimalLatitude:40.123,decimalLongitude:-74.123},$2=[{verbatimCoordinates:`50Â°4'17.698"south, 14Â°24'2.826"east`,verbatimLatitude:`50Â°4'17.698"south`,verbatimLongitude:`14Â°24'2.826"east`,decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"50d4m17.698S 14d24m2.826E",verbatimLatitude:"50d4m17.698S",verbatimLongitude:"14d24m2.826E",decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"40:26:46N,79:56:55W",verbatimLatitude:"40:26:46N",verbatimLongitude:"79:56:55W",decimalLatitude:40.44611111111111,decimalLongitude:-79.9486111111111},{verbatimCoordinates:"40:26:46.302N 79:56:55.903W",verbatimLatitude:"40:26:46.302N",verbatimLongitude:"79:56:55.903W",decimalLatitude:40.446195,decimalLongitude:-79.94886194444445},{verbatimCoordinates:"40Â°26â²47â³N 79Â°58â²36â³W",verbatimLatitude:"40Â°26â²47â³N",verbatimLongitude:"79Â°58â²36â³W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40d 26â² 47â³ N 79d 58â² 36â³ W",verbatimLatitude:"40d 26â² 47â³ N",verbatimLongitude:"79d 58â² 36â³ W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40.446195N 79.948862W",verbatimLatitude:"40.446195N",verbatimLongitude:"79.948862W",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40,446195Â° 79,948862Â°",verbatimLatitude:"40,446195Â°",verbatimLongitude:"79,948862Â°",decimalLatitude:40.446195,decimalLongitude:79.948862},{verbatimCoordinates:"40Â° 26.7717, -79Â° 56.93172",verbatimLatitude:"40Â° 26.7717",verbatimLongitude:"-79Â° 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.446195, -79.948862",verbatimLatitude:"40.446195",verbatimLongitude:"-79.948862",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.123256; -74.123256",verbatimLatitude:"40.123256",verbatimLongitude:"-74.123256",decimalLatitude:40.123256,decimalLongitude:-74.123256},{verbatimCoordinates:"18Â°24S 22Â°45E",verbatimLatitude:"18Â°24S",verbatimLongitude:"22Â°45E",decimalLatitude:-18.4,decimalLongitude:22.75}],q2=[{verbatimCoordinates:"10.432342S 10.6345345E",verbatimLatitude:"10.432342S",verbatimLongitude:"10.6345345E",decimalLatitude:-10.432342,decimalLongitude:10.6345345},{verbatimCoordinates:"10.00S 10.00E",verbatimLatitude:"10.00S",verbatimLongitude:"10.00E",decimalLatitude:-10,decimalLongitude:10},{verbatimCoordinates:"00.00S 01.00E",verbatimLatitude:"00.00S",verbatimLongitude:"01.00E",decimalLatitude:0,decimalLongitude:1},{verbatimCoordinates:"18.24S 22.45E",verbatimLatitude:"18.24S",verbatimLongitude:"22.45E",decimalLatitude:-18.4,decimalLongitude:22.75},{verbatimCoordinates:"27deg 15min 45.2sec S 18deg 32min 53.7sec E",verbatimLatitude:"27deg 15min 45.2sec S",verbatimLongitude:"18deg 32min 53.7sec E",decimalLatitude:-27.262555555555554,decimalLongitude:18.54825},{verbatimCoordinates:"-23.3245Â° S / 28.2344Â° E",verbatimLatitude:"-23.3245Â° S",verbatimLongitude:"28.2344Â° E",decimalLatitude:-23.3245,decimalLongitude:28.2344},{verbatimCoordinates:"40Â° 26.7717 -79Â° 56.93172",verbatimLatitude:"40Â° 26.7717",verbatimLongitude:"-79Â° 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"27.15.45S 18.32.53E",verbatimLatitude:"27.15.45S",verbatimLongitude:"18.32.53E",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"-27.15.45 18.32.53",verbatimLatitude:"-27.15.45",verbatimLongitude:"18.32.53",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"27.15.45.2S 18.32.53.4E",verbatimLatitude:"27.15.45.2S",verbatimLongitude:"18.32.53.4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"27.15.45,2S 18.32.53,4E",verbatimLatitude:"27.15.45,2S",verbatimLongitude:"18.32.53,4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"S23.43563 Â°  E22.45634 Â°",verbatimLatitude:"S23.43563 Â°",verbatimLongitude:"E22.45634 Â°",decimalLatitude:-23.43563,decimalLongitude:22.45634},{verbatimCoordinates:"27,71372Â° S 23,07771Â° E",verbatimLatitude:"27,71372Â° S",verbatimLongitude:"23,07771Â° E",decimalLatitude:-27.71372,decimalLongitude:23.07771},{verbatimCoordinates:"27.45.34 S 23.23.23 E",verbatimLatitude:"27.45.34 S",verbatimLongitude:"23.23.23 E",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"S 27.45.34 E 23.23.23",verbatimLatitude:"S 27.45.34",verbatimLongitude:"E 23.23.23",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"53 16.3863,4 52.8171",verbatimLatitude:"53 16.3863",verbatimLongitude:"4 52.8171",decimalLatitude:53.273105,decimalLongitude:4.88029},{verbatimCoordinates:"50 8.2914,-5 2.4447",verbatimLatitude:"50 8.2914",verbatimLongitude:"-5 2.4447",decimalLatitude:50.13819,decimalLongitude:-5.040745},{verbatimCoordinates:"N 48Â° 30,6410', E 18Â° 57,4583'",verbatimLatitude:"N 48Â° 30,6410'",verbatimLongitude:"E 18Â° 57,4583'",decimalLatitude:48.51068,decimalLongitude:18.95764},{verbatimCoordinates:"1.23456, 18.33453",verbatimLatitude:"1.23456",verbatimLongitude:"18.33453",decimalLatitude:1.23456,decimalLongitude:18.33453}];function Z2(){const r=[];return U2.forEach(e=>{e.decimalLatitude?r.push(e):r.push({...e,...V2})}),[...r,...$2,...q2]}const G2=Z2();Vp.formats=G2.map(r=>r.verbatimCoordinates);const W2=Vp;function f_(r,e,t){const i=r.slice();return i[84]=e[t],i[86]=t,i}function p_(r){let e,t;return e=new E2({}),{c(){na(e.$$.fragment)},m(i,l){Ms(e,i,l),t=!0},i(i){t||(Yn(e.$$.fragment,i),t=!0)},o(i){lr(e.$$.fragment,i),t=!1},d(i){Is(e,i)}}}function m_(r){let e,t,i,l,u;return t=new P2({}),{c(){e=nn("button"),na(t.$$.fragment),st(e,"type","button"),st(e,"title",r[9]),st(e,"class","svelte-bz0zu3"),Lo(e,"active",r[0])},m(d,a){Cn(d,e,a),Ms(t,e,null),i=!0,l||(u=Zr(e,"click",r[69]),l=!0)},p(d,a){(!i||a[0]&512)&&st(e,"title",d[9]),(!i||a[0]&1)&&Lo(e,"active",d[0])},i(d){i||(Yn(t.$$.fragment,d),i=!0)},o(d){lr(t.$$.fragment,d),i=!1},d(d){d&&kn(e),Is(t),l=!1,u()}}}function H2(r){let e,t=[],i=new Map,l,u,d,a=r_(r[14]);const _=v=>v[84].id+(v[84].address?","+v[84].address:"");for(let v=0;v<a.length;v+=1){let k=f_(r,a,v),S=_(k);i.set(S,t[v]=g_(S,k))}return{c(){e=nn("ul");for(let v=0;v<t.length;v+=1)t[v].c();st(e,"class","options svelte-bz0zu3")},m(v,k){Cn(v,e,k);for(let S=0;S<t.length;S+=1)t[S]&&t[S].m(e,null);l=!0,u||(d=[Zr(e,"mouseleave",r[73]),Zr(e,"blur",r[74])],u=!0)},p(v,k){k[0]&17880064&&(a=r_(v[14]),fd(),t=u2(t,k,_,1,v,a,i,e,c2,g_,null,f_),pd())},i(v){if(!l){for(let k=0;k<a.length;k+=1)Yn(t[k]);l=!0}},o(v){for(let k=0;k<t.length;k+=1)lr(t[k]);l=!1},d(v){v&&kn(e);for(let k=0;k<t.length;k+=1)t[k].d();u=!1,Ls(d)}}}function X2(r){let e,t,i,l,u,d;return t=new $0({}),{c(){e=nn("div"),na(t.$$.fragment),i=mo(),l=nn("div"),u=ia(r[7]),st(l,"class","svelte-bz0zu3"),st(e,"class","no-results svelte-bz0zu3")},m(a,_){Cn(a,e,_),Ms(t,e,null),Bi(e,i),Bi(e,l),Bi(l,u),d=!0},p(a,_){(!d||_[0]&128)&&Ou(u,a[7])},i(a){d||(Yn(t.$$.fragment,a),d=!0)},o(a){lr(t.$$.fragment,a),d=!1},d(a){a&&kn(e),Is(t)}}}function K2(r){let e="",t;return{c(){t=ia(e)},m(i,l){Cn(i,t,l)},p:xn,i:xn,o:xn,d(i){i&&kn(t)}}}function J2(r){let e,t,i,l,u,d,a,_,v,k,S;return t=new $0({}),_=new V0({}),{c(){e=nn("div"),na(t.$$.fragment),i=mo(),l=nn("div"),u=ia(r[6]),d=mo(),a=nn("button"),na(_.$$.fragment),st(l,"class","svelte-bz0zu3"),st(a,"class","svelte-bz0zu3"),st(e,"class","error svelte-bz0zu3")},m(E,A){Cn(E,e,A),Ms(t,e,null),Bi(e,i),Bi(e,l),Bi(l,u),Bi(e,d),Bi(e,a),Ms(_,a,null),v=!0,k||(S=Zr(a,"click",r[70]),k=!0)},p(E,A){(!v||A[0]&64)&&Ou(u,E[6])},i(E){v||(Yn(t.$$.fragment,E),Yn(_.$$.fragment,E),v=!0)},o(E){lr(t.$$.fragment,E),lr(_.$$.fragment,E),v=!1},d(E){E&&kn(e),Is(t),Is(_),k=!1,S()}}}function g_(r,e){let t,i,l;function u(){return e[71](e[86])}function d(){return e[72](e[84])}return i=new T2({props:{feature:e[84],showPlaceType:e[10],selected:e[15]===e[86],missingIconsCache:e[20],iconsBaseUrl:e[12]}}),i.$on("mouseenter",u),i.$on("focus",d),{key:r,first:null,c(){t=Qx(),na(i.$$.fragment),this.first=t},m(a,_){Cn(a,t,_),Ms(i,a,_),l=!0},p(a,_){e=a;const v={};_[0]&16384&&(v.feature=e[84]),_[0]&1024&&(v.showPlaceType=e[10]),_[0]&49152&&(v.selected=e[15]===e[86]),_[0]&4096&&(v.iconsBaseUrl=e[12]),i.$set(v)},i(a){l||(Yn(i.$$.fragment,a),l=!0)},o(a){lr(i.$$.fragment,a),l=!1},d(a){a&&kn(t),Is(i,a)}}}function Y2(r){let e,t,i,l,u,d,a,_,v,k,S,E,A,D,B,P,R,F,j,U,le,he=!1;u=new D2({}),S=new V0({});let Z=r[19]&&p_(),Q=r[5]==="button"&&m_(r);const ye=r[61].default,Ne=Xx(ye,r,r[60],null),re=[J2,K2,X2,H2],ve=[];function Ke(Le,et){var xt,mt;return Le[18]?0:Le[16]?((xt=Le[14])==null?void 0:xt.length)===0?2:Le[16]&&(mt=Le[14])!=null&&mt.length?3:-1:1}return~(P=Ke(r))&&(R=ve[P]=re[P](r)),{c(){e=mo(),t=nn("form"),i=nn("div"),l=nn("button"),na(u.$$.fragment),d=mo(),a=nn("input"),_=mo(),v=nn("div"),k=nn("button"),na(S.$$.fragment),E=mo(),Z&&Z.c(),A=mo(),Q&&Q.c(),D=mo(),Ne&&Ne.c(),B=mo(),R&&R.c(),st(l,"class","search-button svelte-bz0zu3"),st(l,"type","button"),st(a,"placeholder",r[8]),st(a,"aria-label",r[8]),st(a,"class","svelte-bz0zu3"),st(k,"type","button"),st(k,"title",r[3]),st(k,"class","svelte-bz0zu3"),st(v,"class","clear-button-container svelte-bz0zu3"),Lo(v,"displayable",r[1]!==""),st(i,"class","input-group svelte-bz0zu3"),st(t,"tabindex","0"),st(t,"class",F=e_(r[2])+" svelte-bz0zu3"),Lo(t,"can-collapse",r[4]&&r[1]==="")},m(Le,et){Cn(Le,e,et),Cn(Le,t,et),Bi(t,i),Bi(i,l),Ms(u,l,null),Bi(i,d),Bi(i,a),r[63](a),t_(a,r[1]),Bi(i,_),Bi(i,v),Bi(v,k),Ms(S,k,null),Bi(v,E),Z&&Z.m(v,null),Bi(i,A),Q&&Q.m(i,null),Bi(i,D),Ne&&Ne.m(i,null),Bi(t,B),~P&&ve[P].m(t,null),j=!0,U||(le=[Zr(l,"click",r[62]),Zr(a,"input",r[64]),Zr(a,"focus",r[65]),Zr(a,"blur",r[66]),Zr(a,"keydown",r[22]),Zr(a,"input",r[67]),Zr(k,"click",r[68]),Zr(t,"submit",e2(r[21]))],U=!0)},p(Le,et){(!j||et[0]&256)&&st(a,"placeholder",Le[8]),(!j||et[0]&256)&&st(a,"aria-label",Le[8]),et[0]&2&&a.value!==Le[1]&&t_(a,Le[1]),(!j||et[0]&8)&&st(k,"title",Le[3]),Le[19]?Z?et[0]&524288&&Yn(Z,1):(Z=p_(),Z.c(),Yn(Z,1),Z.m(v,null)):Z&&(fd(),lr(Z,1,1,()=>{Z=null}),pd()),(!j||et[0]&2)&&Lo(v,"displayable",Le[1]!==""),Le[5]==="button"?Q?(Q.p(Le,et),et[0]&32&&Yn(Q,1)):(Q=m_(Le),Q.c(),Yn(Q,1),Q.m(i,D)):Q&&(fd(),lr(Q,1,1,()=>{Q=null}),pd()),Ne&&Ne.p&&(!j||et[1]&536870912)&&Jx(Ne,ye,Le,Le[60],j?Kx(ye,Le[60],et,null):Yx(Le[60]),null);let xt=P;P=Ke(Le),P===xt?~P&&ve[P].p(Le,et):(R&&(fd(),lr(ve[xt],1,1,()=>{ve[xt]=null}),pd()),~P?(R=ve[P],R?R.p(Le,et):(R=ve[P]=re[P](Le),R.c()),Yn(R,1),R.m(t,null)):R=null),(!j||et[0]&4&&F!==(F=e_(Le[2])+" svelte-bz0zu3"))&&st(t,"class",F),(!j||et[0]&22)&&Lo(t,"can-collapse",Le[4]&&Le[1]==="")},i(Le){j||(Yn(he),Yn(u.$$.fragment,Le),Yn(S.$$.fragment,Le),Yn(Z),Yn(Q),Yn(Ne,Le),Yn(R),j=!0)},o(Le){lr(he),lr(u.$$.fragment,Le),lr(S.$$.fragment,Le),lr(Z),lr(Q),lr(Ne,Le),lr(R),j=!1},d(Le){Le&&(kn(e),kn(t)),Is(u),r[63](null),Is(S),Z&&Z.d(),Q&&Q.d(),Ne&&Ne.d(Le),~P&&ve[P].d(),U=!1,Ls(le)}}}function Q2(r,e,t){let i,l,{$$slots:u={},$$scope:d}=e;const a={continental_marine:4,country:4,major_landform:8,region:5,subregion:6,county:7,joint_municipality:8,joint_submunicipality:9,municipality:10,municipal_district:11,locality:12,neighbourhood:13,place:14,postal_code:14,road:16,poi:17,address:18,"poi.peak":15,"poi.shop":18,"poi.cafe":18,"poi.restaurant":18,"poi.aerodrome":13};let{class:_=void 0}=e,{apiKey:v}=e,{bbox:k=void 0}=e,{clearButtonTitle:S="clear"}=e,{clearOnBlur:E=!1}=e,{collapsed:A=!1}=e,{country:D=void 0}=e,{debounceSearch:B=200}=e,{enableReverse:P="never"}=e,{errorMessage:R="Something went wrongâ¦"}=e,{filter:F=()=>!0}=e,{flyTo:j=!0}=e,{fuzzyMatch:U=!0}=e,{language:le=void 0}=e,{limit:he=void 0}=e,{mapController:Z=void 0}=e,{minLength:Q=2}=e,{noResultsMessage:ye="Oops! Looks like you're trying to predict something that's not quite right. We can't seem to find what you're looking for. Maybe try double-checking your spelling or try a different search term. Keep on typing - we'll do our best to get you where you need to go!"}=e,{placeholder:Ne="Search"}=e,{proximity:re=[{type:"server-geolocation"}]}=e,{reverseActive:ve=P==="always"}=e,{reverseButtonTitle:Ke="toggle reverse geocoding"}=e,{searchValue:Le=""}=e,{pickedResultStyle:et="full-geometry"}=e,{showPlaceType:xt="if-needed"}=e,{showResultsWhileTyping:mt=!0}=e,{selectFirst:at=!0}=e,{flyToSelected:Ht=!1}=e,{markerOnSelected:ri=!0}=e,{types:Nt=void 0}=e,{exhaustiveReverseGeocoding:At=!1}=e,{excludeTypes:ei=!1}=e,{zoom:ci=a}=e,{apiUrl:ti="https://api.maptiler.com/geocoding"}=e,{fetchParameters:ft={}}=e,{iconsBaseUrl:Jt="https://cdn.maptiler.com/maptiler-geocoding-control/v2.0.1/icons/"}=e,{adjustUrlQuery:gi=()=>{}}=e;function zi(){qe.focus()}function Fi(){qe.blur()}function ut(W,Ue=!0,$e=!1){t(1,Le=W),Ue?(t(15,Ye=-1),nt()):(Qt(!$e,$e),setTimeout(()=>{qe.focus(),qe.select()}))}function Dt(){t(14,ht=void 0),t(56,we=void 0),t(15,Ye=-1)}function Fe(){t(55,vt=[]),t(56,we=void 0)}let je=!1,ht,vt,we,Ei="",qe,Ye=-1,Ot,Pi=[],bi,gn,Mn,Qi;const io=new Set,Oi=r2();n2(()=>{Z&&(Z.setEventHandler(void 0),Z.indicateReverse(!1),Z.setSelectedMarker(-1),Z.setFeatures(void 0,void 0,!1))});function nt(W){if(gn&&(clearTimeout(gn),gn=void 0),Ye>-1&&ht)t(56,we=ht[Ye]),t(1,Le=we.place_type[0]==="reverse"?we.place_name:we.place_name.replace(/,.*/,"")),t(18,Ot=void 0),t(55,vt=void 0),t(15,Ye=-1);else if(Le){const Ue=W||!Mi(Le);Yt(Le,{exact:!0}).then(()=>{t(55,vt=ht),t(56,we=void 0),Ue&&Ni()}).catch($e=>t(18,Ot=$e))}}function Mi(W){try{return W2(W,6)}catch{return!1}}async function Yt(W,{byId:Ue=!1,exact:$e=!1}={}){t(18,Ot=void 0),bi==null||bi.abort();const Ge=new AbortController;t(19,bi=Ge);try{const Je=Mi(W),dt=new URLSearchParams;if(le!==void 0&&dt.set("language",Array.isArray(le)?le.join(","):le??""),Nt&&dt.set("types",Nt.join(",")),ei&&dt.set("excludeTypes",String(ei)),k&&dt.set("bbox",k.map(wi=>wi.toFixed(6)).join(",")),D&&dt.set("country",Array.isArray(D)?D.join(","):D),!Ue&&!Je){const wi=await B2(Z,re,Ge);wi&&dt.set("proximity",wi),($e||!mt)&&dt.set("autocomplete","false"),dt.set("fuzzyMatch",String(U))}he!==void 0&&(At||!Je||(Nt==null?void 0:Nt.length)===1)&&dt.set("limit",String(he)),dt.set("key",v),gi(dt);const Bt=ti+"/"+encodeURIComponent(Je?Je.decimalLongitude+","+Je.decimalLatitude:W)+".json?"+dt.toString();if(Bt===Ei){Ue?(t(14,ht=void 0),t(56,we=Pi[0])):t(14,ht=Pi);return}Ei=Bt;const Xt=await fetch(Bt,{signal:Ge.signal,...ft});if(!Xt.ok)throw new Error(await Xt.text());const ui=await Xt.json();Oi("response",{url:Bt,featureCollection:ui}),Ue?(t(14,ht=void 0),t(56,we=ui.features[0]),Pi=[we]):(t(14,ht=ui.features.filter(F)),Je&&ht.unshift({type:"Feature",properties:{},id:"reverse_"+Je.decimalLongitude+"_"+Je.decimalLatitude,text:Je.decimalLatitude+", "+Je.decimalLongitude,place_name:Je.decimalLatitude+", "+Je.decimalLongitude,place_type:["reverse"],center:[Je.decimalLongitude,Je.decimalLatitude],bbox:[Je.decimalLongitude,Je.decimalLatitude,Je.decimalLongitude,Je.decimalLatitude],geometry:{type:"Point",coordinates:[Je.decimalLongitude,Je.decimalLatitude]}}),Pi=ht,Je&&qe.focus())}catch(Je){if(Je&&typeof Je=="object"&&"name"in Je&&Je.name==="AbortError")return;throw Je}finally{Ge===bi&&t(19,bi=void 0)}}function Ni(){var W;if(!(vt!=null&&vt.length)||!j)return;const Ue=[180,90,-180,-90],$e=!vt.some(Je=>!Je.matching_text);let Ge;for(const Je of vt){const dt=Xi(Je);if(Ge=Ge===void 0?dt:dt===void 0?Ge:Math.max(Ge,dt),$e||!Je.matching_text)for(const Bt of[0,1,2,3])Ue[Bt]=Math[Bt<2?"min":"max"](Ue[Bt],((W=Je.bbox)==null?void 0:W[Bt])??Je.center[Bt%2])}Z&&vt.length>0&&(we&&Ue[0]===Ue[2]&&Ue[1]===Ue[3]?Z.flyTo(we.center,Xi(we)):Z.fitBounds(Td(Ue),50,Ge))}function Xi(W){var Ue;if(!W.bbox||W.bbox[0]!==W.bbox[2]&&W.bbox[1]!==W.bbox[3])return;const $e=W.id.replace(/\..*/,"");return(Array.isArray((Ue=W.properties)==null?void 0:Ue.categories)?W.properties.categories.reduce((Ge,Je)=>{const dt=ci[$e+"."+Je];return Ge===void 0?dt:dt===void 0?Ge:Math.max(Ge,dt)},void 0):void 0)??ci[$e]}function _t(W){t(0,ve=P==="always"),t(14,ht=void 0),t(56,we=void 0),t(15,Ye=-1),ut(W[1].toFixed(6)+", "+R2(W[0],[-180,180],!0).toFixed(6),!1,!0)}function oi(W){if(!ht)return;let Ue=W.key==="ArrowDown"?1:W.key==="ArrowUp"?-1:0;Ue&&(Ye===(at?0:-1)&&Ue===-1&&t(15,Ye=ht.length),t(15,Ye+=Ue),Ye>=ht.length&&t(15,Ye=-1),Ye<0&&at&&t(15,Ye=0),W.preventDefault())}function Qt(W=!0,Ue=!1){if(t(18,Ot=void 0),mt||Ue){if(gn&&clearTimeout(gn),Le.length<Q)return;const $e=Le;gn=window.setTimeout(()=>{Yt($e).catch(Ge=>t(18,Ot=Ge))},W?B:0)}else t(14,ht=void 0),t(18,Ot=void 0)}function Ki(W){t(56,we=W),t(1,Le=W.place_name),t(15,Ye=-1)}const br=()=>qe.focus();function ni(W){pp[W?"unshift":"push"](()=>{qe=W,t(17,qe)})}function no(){Le=this.value,t(1,Le),t(13,je),t(28,E)}const _n=()=>t(13,je=!0),me=()=>t(13,je=!1),H=()=>Qt(),K=()=>{t(1,Le=""),qe.focus()},ie=()=>t(0,ve=!ve),de=()=>t(18,Ot=void 0),Pe=W=>t(15,Ye=W),ze=W=>Ki(W),Be=()=>{at||t(15,Ye=-1)},Se=()=>{};return r.$$set=W=>{"class"in W&&t(2,_=W.class),"apiKey"in W&&t(26,v=W.apiKey),"bbox"in W&&t(27,k=W.bbox),"clearButtonTitle"in W&&t(3,S=W.clearButtonTitle),"clearOnBlur"in W&&t(28,E=W.clearOnBlur),"collapsed"in W&&t(4,A=W.collapsed),"country"in W&&t(29,D=W.country),"debounceSearch"in W&&t(30,B=W.debounceSearch),"enableReverse"in W&&t(5,P=W.enableReverse),"errorMessage"in W&&t(6,R=W.errorMessage),"filter"in W&&t(31,F=W.filter),"flyTo"in W&&t(32,j=W.flyTo),"fuzzyMatch"in W&&t(33,U=W.fuzzyMatch),"language"in W&&t(34,le=W.language),"limit"in W&&t(35,he=W.limit),"mapController"in W&&t(36,Z=W.mapController),"minLength"in W&&t(37,Q=W.minLength),"noResultsMessage"in W&&t(7,ye=W.noResultsMessage),"placeholder"in W&&t(8,Ne=W.placeholder),"proximity"in W&&t(38,re=W.proximity),"reverseActive"in W&&t(0,ve=W.reverseActive),"reverseButtonTitle"in W&&t(9,Ke=W.reverseButtonTitle),"searchValue"in W&&t(1,Le=W.searchValue),"pickedResultStyle"in W&&t(39,et=W.pickedResultStyle),"showPlaceType"in W&&t(10,xt=W.showPlaceType),"showResultsWhileTyping"in W&&t(40,mt=W.showResultsWhileTyping),"selectFirst"in W&&t(11,at=W.selectFirst),"flyToSelected"in W&&t(41,Ht=W.flyToSelected),"markerOnSelected"in W&&t(42,ri=W.markerOnSelected),"types"in W&&t(43,Nt=W.types),"exhaustiveReverseGeocoding"in W&&t(44,At=W.exhaustiveReverseGeocoding),"excludeTypes"in W&&t(45,ei=W.excludeTypes),"zoom"in W&&t(46,ci=W.zoom),"apiUrl"in W&&t(47,ti=W.apiUrl),"fetchParameters"in W&&t(48,ft=W.fetchParameters),"iconsBaseUrl"in W&&t(12,Jt=W.iconsBaseUrl),"adjustUrlQuery"in W&&t(49,gi=W.adjustUrlQuery),"$$scope"in W&&t(60,d=W.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&32&&t(0,ve=P==="always"),r.$$.dirty[0]&268443648&&setTimeout(()=>{t(16,Mn=je),E&&!je&&t(1,Le="")}),r.$$.dirty[0]&16386|r.$$.dirty[1]&64&&Le.length<Q&&(t(56,we=void 0),t(14,ht=void 0),t(18,Ot=void 0),t(55,vt=ht)),r.$$.dirty[1]&33554688&&et!=="marker-only"&&we&&!we.address&&we.geometry.type==="Point"&&we.place_type[0]!=="reverse"&&Yt(we.id,{byId:!0}).catch(W=>t(18,Ot=W)),r.$$.dirty[1]&100663330&&(Z&&we&&we.id!==Qi&&j&&(!we.bbox||we.bbox[0]===we.bbox[2]&&we.bbox[1]===we.bbox[3]?Z.flyTo(we.center,Xi(we)):Z.fitBounds(Td(we.bbox),50,Xi(we)),t(14,ht=void 0),t(55,vt=void 0),t(15,Ye=-1)),t(57,Qi=we==null?void 0:we.id)),r.$$.dirty[0]&18432&&at&&ht!=null&&ht.length&&t(15,Ye=0),r.$$.dirty[0]&2&&t(15,Ye=-1),r.$$.dirty[0]&16384|r.$$.dirty[1]&16777216&&vt!==ht&&t(55,vt=void 0),r.$$.dirty[0]&81921|r.$$.dirty[1]&16777248&&Z&&Z.setEventHandler(W=>{switch(W.type){case"mapClick":ve&&_t(W.coordinates);break;case"markerClick":{const Ue=ht==null?void 0:ht.find($e=>$e.id===W.id);Ue&&Ki(Ue)}break;case"markerMouseEnter":vt&&t(15,Ye=Mn?(ht==null?void 0:ht.findIndex(Ue=>Ue.id===W.id))??-1:-1);break;case"markerMouseLeave":vt&&t(15,Ye=-1);break}}),r.$$.dirty[0]&49152&&t(58,l=ht==null?void 0:ht[Ye]),r.$$.dirty[1]&134218786&&Z&&l&&j&&Ht&&Z.flyTo(l.center,Xi(l)),r.$$.dirty[1]&256&&t(59,i=et==="full-geometry-including-polygon-center-marker"),r.$$.dirty[1]&268437536&&(ri||Z==null||Z.setFeatures(void 0,void 0,i)),r.$$.dirty[1]&419432480&&Z&&ri&&!vt&&(Z.setFeatures(l?[l]:void 0,void 0,i),Z.setSelectedMarker(l?0:-1)),r.$$.dirty[1]&318767136&&Z&&Z.setFeatures(vt,we,i),r.$$.dirty[0]&32768|r.$$.dirty[1]&16777248&&vt&&Z&&Z.setSelectedMarker(Ye),r.$$.dirty[0]&2|r.$$.dirty[1]&32&&Z){const W=Mi(Le);Z.setReverseMarker(W?[W.decimalLongitude,W.decimalLatitude]:void 0)}r.$$.dirty[1]&134217728&&Oi("select",{feature:l}),r.$$.dirty[1]&33554432&&Oi("pick",{feature:we}),r.$$.dirty[0]&81920&&Oi("optionsvisibilitychange",{optionsVisible:Mn&&!!ht}),r.$$.dirty[0]&16384&&Oi("featureslisted",{features:ht}),r.$$.dirty[1]&16777216&&Oi("featuresmarked",{features:vt}),r.$$.dirty[0]&1&&Oi("reversetoggle",{reverse:ve}),r.$$.dirty[0]&2&&Oi("querychange",{query:Le}),r.$$.dirty[0]&1|r.$$.dirty[1]&32&&Z&&Z.indicateReverse(ve)},[ve,Le,_,S,A,P,R,ye,Ne,Ke,xt,at,Jt,je,ht,Ye,Mn,qe,Ot,bi,io,nt,oi,Qt,Ki,a,v,k,E,D,B,F,j,U,le,he,Z,Q,re,et,mt,Ht,ri,Nt,At,ei,ci,ti,ft,gi,zi,Fi,ut,Dt,Fe,vt,we,Qi,l,i,d,u,br,ni,no,_n,me,H,K,ie,de,Pe,ze,Be,Se]}let ek=class extends aa{constructor(r){super(),sa(this,r,Q2,Y2,oa,{ZOOM_DEFAULTS:25,class:2,apiKey:26,bbox:27,clearButtonTitle:3,clearOnBlur:28,collapsed:4,country:29,debounceSearch:30,enableReverse:5,errorMessage:6,filter:31,flyTo:32,fuzzyMatch:33,language:34,limit:35,mapController:36,minLength:37,noResultsMessage:7,placeholder:8,proximity:38,reverseActive:0,reverseButtonTitle:9,searchValue:1,pickedResultStyle:39,showPlaceType:10,showResultsWhileTyping:40,selectFirst:11,flyToSelected:41,markerOnSelected:42,types:43,exhaustiveReverseGeocoding:44,excludeTypes:45,zoom:46,apiUrl:47,fetchParameters:48,iconsBaseUrl:12,adjustUrlQuery:49,focus:50,blur:51,setQuery:52,clearList:53,clearMap:54},null,[-1,-1,-1])}get ZOOM_DEFAULTS(){return this.$$.ctx[25]}get focus(){return this.$$.ctx[50]}get blur(){return this.$$.ctx[51]}get setQuery(){return this.$$.ctx[52]}get clearList(){return this.$$.ctx[53]}get clearMap(){return this.$$.ctx[54]}};function ju(r,e,t={}){const i={type:"Feature"};return(t.id===0||t.id)&&(i.id=t.id),t.bbox&&(i.bbox=t.bbox),i.properties=e||{},i.geometry=r,i}function $p(r,e,t={}){for(const i of r){if(i.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(i[i.length-1].length!==i[0].length)throw new Error("First and last Position are not equivalent.");for(let l=0;l<i[i.length-1].length;l++)if(i[i.length-1][l]!==i[0][l])throw new Error("First and last Position are not equivalent.")}return ju({type:"Polygon",coordinates:r},e,t)}function Uu(r,e={}){const t={type:"FeatureCollection"};return e.id&&(t.id=e.id),e.bbox&&(t.bbox=e.bbox),t.features=r,t}function q0(r,e,t={}){return ju({type:"MultiPolygon",coordinates:r},e,t)}/**
 * splaytree v3.1.2
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function tk(r,e){var t={label:0,sent:function(){if(u[0]&1)throw u[1];return u[1]},trys:[],ops:[]},i,l,u,d;return d={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(d[Symbol.iterator]=function(){return this}),d;function a(v){return function(k){return _([v,k])}}function _(v){if(i)throw new TypeError("Generator is already executing.");for(;t;)try{if(i=1,l&&(u=v[0]&2?l.return:v[0]?l.throw||((u=l.return)&&u.call(l),0):l.next)&&!(u=u.call(l,v[1])).done)return u;switch(l=0,u&&(v=[v[0]&2,u.value]),v[0]){case 0:case 1:u=v;break;case 4:return t.label++,{value:v[1],done:!1};case 5:t.label++,l=v[1],v=[0];continue;case 7:v=t.ops.pop(),t.trys.pop();continue;default:if(u=t.trys,!(u=u.length>0&&u[u.length-1])&&(v[0]===6||v[0]===2)){t=0;continue}if(v[0]===3&&(!u||v[1]>u[0]&&v[1]<u[3])){t.label=v[1];break}if(v[0]===6&&t.label<u[1]){t.label=u[1],u=v;break}if(u&&t.label<u[2]){t.label=u[2],t.ops.push(v);break}u[2]&&t.ops.pop(),t.trys.pop();continue}v=e.call(r,t)}catch(k){v=[6,k],l=0}finally{i=u=0}if(v[0]&5)throw v[1];return{value:v[0]?v[1]:void 0,done:!0}}}var ra=function(){function r(e,t){this.next=null,this.key=e,this.data=t,this.left=null,this.right=null}return r}();function ik(r,e){return r>e?1:r<e?-1:0}function Ks(r,e,t){for(var i=new ra(null,null),l=i,u=i;;){var d=t(r,e.key);if(d<0){if(e.left===null)break;if(t(r,e.left.key)<0){var a=e.left;if(e.left=a.right,a.right=e,e=a,e.left===null)break}u.left=e,u=e,e=e.left}else if(d>0){if(e.right===null)break;if(t(r,e.right.key)>0){var a=e.right;if(e.right=a.left,a.left=e,e=a,e.right===null)break}l.right=e,l=e,e=e.right}else break}return l.right=e.left,u.left=e.right,e.left=i.right,e.right=i.left,e}function Yf(r,e,t,i){var l=new ra(r,e);if(t===null)return l.left=l.right=null,l;t=Ks(r,t,i);var u=i(r,t.key);return u<0?(l.left=t.left,l.right=t,t.left=null):u>=0&&(l.right=t.right,l.left=t,t.right=null),l}function __(r,e,t){var i=null,l=null;if(e){e=Ks(r,e,t);var u=t(e.key,r);u===0?(i=e.left,l=e.right):u<0?(l=e.right,e.right=null,i=e):(i=e.left,e.left=null,l=e)}return{left:i,right:l}}function nk(r,e,t){return e===null?r:(r===null||(e=Ks(r.key,e,t),e.left=r),e)}function _p(r,e,t,i,l){if(r){i(""+e+(t?"âââ ":"âââ ")+l(r)+`
`);var u=e+(t?"    ":"â   ");r.left&&_p(r.left,u,!1,i,l),r.right&&_p(r.right,u,!0,i,l)}}var qp=function(){function r(e){e===void 0&&(e=ik),this._root=null,this._size=0,this._comparator=e}return r.prototype.insert=function(e,t){return this._size++,this._root=Yf(e,t,this._root,this._comparator)},r.prototype.add=function(e,t){var i=new ra(e,t);this._root===null&&(i.left=i.right=null,this._size++,this._root=i);var l=this._comparator,u=Ks(e,this._root,l),d=l(e,u.key);return d===0?this._root=u:(d<0?(i.left=u.left,i.right=u,u.left=null):d>0&&(i.right=u.right,i.left=u,u.right=null),this._size++,this._root=i),this._root},r.prototype.remove=function(e){this._root=this._remove(e,this._root,this._comparator)},r.prototype._remove=function(e,t,i){var l;if(t===null)return null;t=Ks(e,t,i);var u=i(e,t.key);return u===0?(t.left===null?l=t.right:(l=Ks(e,t.left,i),l.right=t.right),this._size--,l):t},r.prototype.pop=function(){var e=this._root;if(e){for(;e.left;)e=e.left;return this._root=Ks(e.key,this._root,this._comparator),this._root=this._remove(e.key,this._root,this._comparator),{key:e.key,data:e.data}}return null},r.prototype.findStatic=function(e){for(var t=this._root,i=this._comparator;t;){var l=i(e,t.key);if(l===0)return t;l<0?t=t.left:t=t.right}return null},r.prototype.find=function(e){return this._root&&(this._root=Ks(e,this._root,this._comparator),this._comparator(e,this._root.key)!==0)?null:this._root},r.prototype.contains=function(e){for(var t=this._root,i=this._comparator;t;){var l=i(e,t.key);if(l===0)return!0;l<0?t=t.left:t=t.right}return!1},r.prototype.forEach=function(e,t){for(var i=this._root,l=[],u=!1;!u;)i!==null?(l.push(i),i=i.left):l.length!==0?(i=l.pop(),e.call(t,i),i=i.right):u=!0;return this},r.prototype.range=function(e,t,i,l){for(var u=[],d=this._comparator,a=this._root,_;u.length!==0||a;)if(a)u.push(a),a=a.left;else{if(a=u.pop(),_=d(a.key,t),_>0)break;if(d(a.key,e)>=0&&i.call(l,a))return this;a=a.right}return this},r.prototype.keys=function(){var e=[];return this.forEach(function(t){var i=t.key;return e.push(i)}),e},r.prototype.values=function(){var e=[];return this.forEach(function(t){var i=t.data;return e.push(i)}),e},r.prototype.min=function(){return this._root?this.minNode(this._root).key:null},r.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},r.prototype.minNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.left;)e=e.left;return e},r.prototype.maxNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.right;)e=e.right;return e},r.prototype.at=function(e){for(var t=this._root,i=!1,l=0,u=[];!i;)if(t)u.push(t),t=t.left;else if(u.length>0){if(t=u.pop(),l===e)return t;l++,t=t.right}else i=!0;return null},r.prototype.next=function(e){var t=this._root,i=null;if(e.right){for(i=e.right;i.left;)i=i.left;return i}for(var l=this._comparator;t;){var u=l(e.key,t.key);if(u===0)break;u<0?(i=t,t=t.left):t=t.right}return i},r.prototype.prev=function(e){var t=this._root,i=null;if(e.left!==null){for(i=e.left;i.right;)i=i.right;return i}for(var l=this._comparator;t;){var u=l(e.key,t.key);if(u===0)break;u<0?t=t.left:(i=t,t=t.right)}return i},r.prototype.clear=function(){return this._root=null,this._size=0,this},r.prototype.toList=function(){return ok(this._root)},r.prototype.load=function(e,t,i){t===void 0&&(t=[]),i===void 0&&(i=!1);var l=e.length,u=this._comparator;if(i&&bp(e,t,0,l-1,u),this._root===null)this._root=yp(e,t,0,l),this._size=l;else{var d=sk(this.toList(),rk(e,t),u);l=this._size+l,this._root=vp({head:d},0,l)}return this},r.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(r.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),r.prototype.toString=function(e){e===void 0&&(e=function(i){return String(i.key)});var t=[];return _p(this._root,"",!0,function(i){return t.push(i)},e),t.join("")},r.prototype.update=function(e,t,i){var l=this._comparator,u=__(e,this._root,l),d=u.left,a=u.right;l(e,t)<0?a=Yf(t,i,a,l):d=Yf(t,i,d,l),this._root=nk(d,a,l)},r.prototype.split=function(e){return __(e,this._root,this._comparator)},r.prototype[Symbol.iterator]=function(){var e,t,i;return tk(this,function(l){switch(l.label){case 0:e=this._root,t=[],i=!1,l.label=1;case 1:return i?[3,6]:e===null?[3,2]:(t.push(e),e=e.left,[3,5]);case 2:return t.length===0?[3,4]:(e=t.pop(),[4,e]);case 3:return l.sent(),e=e.right,[3,5];case 4:i=!0,l.label=5;case 5:return[3,1];case 6:return[2]}})},r}();function yp(r,e,t,i){var l=i-t;if(l>0){var u=t+Math.floor(l/2),d=r[u],a=e[u],_=new ra(d,a);return _.left=yp(r,e,t,u),_.right=yp(r,e,u+1,i),_}return null}function rk(r,e){for(var t=new ra(null,null),i=t,l=0;l<r.length;l++)i=i.next=new ra(r[l],e[l]);return i.next=null,t.next}function ok(r){for(var e=r,t=[],i=!1,l=new ra(null,null),u=l;!i;)e?(t.push(e),e=e.left):t.length>0?(e=u=u.next=t.pop(),e=e.right):i=!0;return u.next=null,l.next}function vp(r,e,t){var i=t-e;if(i>0){var l=e+Math.floor(i/2),u=vp(r,e,l),d=r.head;return d.left=u,r.head=r.head.next,d.right=vp(r,l+1,t),d}return null}function sk(r,e,t){for(var i=new ra(null,null),l=i,u=r,d=e;u!==null&&d!==null;)t(u.key,d.key)<0?(l.next=u,u=u.next):(l.next=d,d=d.next),l=l.next;return u!==null?l.next=u:d!==null&&(l.next=d),i.next}function bp(r,e,t,i,l){if(!(t>=i)){for(var u=r[t+i>>1],d=t-1,a=i+1;;){do d++;while(l(r[d],u)<0);do a--;while(l(r[a],u)>0);if(d>=a)break;var _=r[d];r[d]=r[a],r[a]=_,_=e[d],e[d]=e[a],e[a]=_}bp(r,e,t,a,l),bp(r,e,a+1,i,l)}}const Ss=11102230246251565e-32,Lr=134217729,ak=(3+8*Ss)*Ss;function Qf(r,e,t,i,l){let u,d,a,_,v=e[0],k=i[0],S=0,E=0;k>v==k>-v?(u=v,v=e[++S]):(u=k,k=i[++E]);let A=0;if(S<r&&E<t)for(k>v==k>-v?(d=v+u,a=u-(d-v),v=e[++S]):(d=k+u,a=u-(d-k),k=i[++E]),u=d,a!==0&&(l[A++]=a);S<r&&E<t;)k>v==k>-v?(d=u+v,_=d-u,a=u-(d-_)+(v-_),v=e[++S]):(d=u+k,_=d-u,a=u-(d-_)+(k-_),k=i[++E]),u=d,a!==0&&(l[A++]=a);for(;S<r;)d=u+v,_=d-u,a=u-(d-_)+(v-_),v=e[++S],u=d,a!==0&&(l[A++]=a);for(;E<t;)d=u+k,_=d-u,a=u-(d-_)+(k-_),k=i[++E],u=d,a!==0&&(l[A++]=a);return(u!==0||A===0)&&(l[A++]=u),A}function lk(r,e){let t=e[0];for(let i=1;i<r;i++)t+=e[i];return t}function Hu(r){return new Float64Array(r)}const ck=(3+16*Ss)*Ss,uk=(2+12*Ss)*Ss,hk=(9+64*Ss)*Ss*Ss,Zl=Hu(4),y_=Hu(8),v_=Hu(12),b_=Hu(16),$r=Hu(4);function dk(r,e,t,i,l,u,d){let a,_,v,k,S,E,A,D,B,P,R,F,j,U,le,he,Z,Q;const ye=r-l,Ne=t-l,re=e-u,ve=i-u;U=ye*ve,E=Lr*ye,A=E-(E-ye),D=ye-A,E=Lr*ve,B=E-(E-ve),P=ve-B,le=D*P-(U-A*B-D*B-A*P),he=re*Ne,E=Lr*re,A=E-(E-re),D=re-A,E=Lr*Ne,B=E-(E-Ne),P=Ne-B,Z=D*P-(he-A*B-D*B-A*P),R=le-Z,S=le-R,Zl[0]=le-(R+S)+(S-Z),F=U+R,S=F-U,j=U-(F-S)+(R-S),R=j-he,S=j-R,Zl[1]=j-(R+S)+(S-he),Q=F+R,S=Q-F,Zl[2]=F-(Q-S)+(R-S),Zl[3]=Q;let Ke=lk(4,Zl),Le=uk*d;if(Ke>=Le||-Ke>=Le||(S=r-ye,a=r-(ye+S)+(S-l),S=t-Ne,v=t-(Ne+S)+(S-l),S=e-re,_=e-(re+S)+(S-u),S=i-ve,k=i-(ve+S)+(S-u),a===0&&_===0&&v===0&&k===0)||(Le=hk*d+ak*Math.abs(Ke),Ke+=ye*k+ve*a-(re*v+Ne*_),Ke>=Le||-Ke>=Le))return Ke;U=a*ve,E=Lr*a,A=E-(E-a),D=a-A,E=Lr*ve,B=E-(E-ve),P=ve-B,le=D*P-(U-A*B-D*B-A*P),he=_*Ne,E=Lr*_,A=E-(E-_),D=_-A,E=Lr*Ne,B=E-(E-Ne),P=Ne-B,Z=D*P-(he-A*B-D*B-A*P),R=le-Z,S=le-R,$r[0]=le-(R+S)+(S-Z),F=U+R,S=F-U,j=U-(F-S)+(R-S),R=j-he,S=j-R,$r[1]=j-(R+S)+(S-he),Q=F+R,S=Q-F,$r[2]=F-(Q-S)+(R-S),$r[3]=Q;const et=Qf(4,Zl,4,$r,y_);U=ye*k,E=Lr*ye,A=E-(E-ye),D=ye-A,E=Lr*k,B=E-(E-k),P=k-B,le=D*P-(U-A*B-D*B-A*P),he=re*v,E=Lr*re,A=E-(E-re),D=re-A,E=Lr*v,B=E-(E-v),P=v-B,Z=D*P-(he-A*B-D*B-A*P),R=le-Z,S=le-R,$r[0]=le-(R+S)+(S-Z),F=U+R,S=F-U,j=U-(F-S)+(R-S),R=j-he,S=j-R,$r[1]=j-(R+S)+(S-he),Q=F+R,S=Q-F,$r[2]=F-(Q-S)+(R-S),$r[3]=Q;const xt=Qf(et,y_,4,$r,v_);U=a*k,E=Lr*a,A=E-(E-a),D=a-A,E=Lr*k,B=E-(E-k),P=k-B,le=D*P-(U-A*B-D*B-A*P),he=_*v,E=Lr*_,A=E-(E-_),D=_-A,E=Lr*v,B=E-(E-v),P=v-B,Z=D*P-(he-A*B-D*B-A*P),R=le-Z,S=le-R,$r[0]=le-(R+S)+(S-Z),F=U+R,S=F-U,j=U-(F-S)+(R-S),R=j-he,S=j-R,$r[1]=j-(R+S)+(S-he),Q=F+R,S=Q-F,$r[2]=F-(Q-S)+(R-S),$r[3]=Q;const mt=Qf(xt,v_,4,$r,b_);return b_[mt-1]}function fk(r,e,t,i,l,u){const d=(e-u)*(t-l),a=(r-l)*(i-u),_=d-a,v=Math.abs(d+a);return Math.abs(_)>=ck*v?_:-dk(r,e,t,i,l,u,v)}const pu=(r,e)=>r.ll.x<=e.x&&e.x<=r.ur.x&&r.ll.y<=e.y&&e.y<=r.ur.y,wp=(r,e)=>{if(e.ur.x<r.ll.x||r.ur.x<e.ll.x||e.ur.y<r.ll.y||r.ur.y<e.ll.y)return null;const t=r.ll.x<e.ll.x?e.ll.x:r.ll.x,i=r.ur.x<e.ur.x?r.ur.x:e.ur.x,l=r.ll.y<e.ll.y?e.ll.y:r.ll.y,u=r.ur.y<e.ur.y?r.ur.y:e.ur.y;return{ll:{x:t,y:l},ur:{x:i,y:u}}};let Ys=Number.EPSILON;Ys===void 0&&(Ys=Math.pow(2,-52));const pk=Ys*Ys,w_=(r,e)=>{if(-Ys<r&&r<Ys&&-Ys<e&&e<Ys)return 0;const t=r-e;return t*t<pk*r*e?0:r<e?-1:1};class mk{constructor(){this.reset()}reset(){this.xRounder=new x_,this.yRounder=new x_}round(e,t){return{x:this.xRounder.round(e),y:this.yRounder.round(t)}}}class x_{constructor(){this.tree=new qp,this.round(0)}round(e){const t=this.tree.add(e),i=this.tree.prev(t);if(i!==null&&w_(t.key,i.key)===0)return this.tree.remove(e),i.key;const l=this.tree.next(t);return l!==null&&w_(t.key,l.key)===0?(this.tree.remove(e),l.key):e}}const Vu=new mk,md=(r,e)=>r.x*e.y-r.y*e.x,Z0=(r,e)=>r.x*e.x+r.y*e.y,k_=(r,e,t)=>{const i=fk(r.x,r.y,e.x,e.y,t.x,t.y);return i>0?-1:i<0?1:0},Cd=r=>Math.sqrt(Z0(r,r)),gk=(r,e,t)=>{const i={x:e.x-r.x,y:e.y-r.y},l={x:t.x-r.x,y:t.y-r.y};return md(l,i)/Cd(l)/Cd(i)},_k=(r,e,t)=>{const i={x:e.x-r.x,y:e.y-r.y},l={x:t.x-r.x,y:t.y-r.y};return Z0(l,i)/Cd(l)/Cd(i)},S_=(r,e,t)=>e.y===0?null:{x:r.x+e.x/e.y*(t-r.y),y:t},T_=(r,e,t)=>e.x===0?null:{x:t,y:r.y+e.y/e.x*(t-r.x)},yk=(r,e,t,i)=>{if(e.x===0)return T_(t,i,r.x);if(i.x===0)return T_(r,e,t.x);if(e.y===0)return S_(t,i,r.y);if(i.y===0)return S_(r,e,t.y);const l=md(e,i);if(l==0)return null;const u={x:t.x-r.x,y:t.y-r.y},d=md(u,e)/l,a=md(u,i)/l,_=r.x+a*e.x,v=t.x+d*i.x,k=r.y+a*e.y,S=t.y+d*i.y,E=(_+v)/2,A=(k+S)/2;return{x:E,y:A}};class Eo{static compare(e,t){const i=Eo.comparePoints(e.point,t.point);return i!==0?i:(e.point!==t.point&&e.link(t),e.isLeft!==t.isLeft?e.isLeft?1:-1:ta.compare(e.segment,t.segment))}static comparePoints(e,t){return e.x<t.x?-1:e.x>t.x?1:e.y<t.y?-1:e.y>t.y?1:0}constructor(e,t){e.events===void 0?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=t}link(e){if(e.point===this.point)throw new Error("Tried to link already linked events");const t=e.point.events;for(let i=0,l=t.length;i<l;i++){const u=t[i];this.point.events.push(u),u.point=this.point}this.checkForConsuming()}checkForConsuming(){const e=this.point.events.length;for(let t=0;t<e;t++){const i=this.point.events[t];if(i.segment.consumedBy===void 0)for(let l=t+1;l<e;l++){const u=this.point.events[l];u.consumedBy===void 0&&i.otherSE.point.events===u.otherSE.point.events&&i.segment.consume(u.segment)}}}getAvailableLinkedEvents(){const e=[];for(let t=0,i=this.point.events.length;t<i;t++){const l=this.point.events[t];l!==this&&!l.segment.ringOut&&l.segment.isInResult()&&e.push(l)}return e}getLeftmostComparator(e){const t=new Map,i=l=>{const u=l.otherSE;t.set(l,{sine:gk(this.point,e.point,u.point),cosine:_k(this.point,e.point,u.point)})};return(l,u)=>{t.has(l)||i(l),t.has(u)||i(u);const{sine:d,cosine:a}=t.get(l),{sine:_,cosine:v}=t.get(u);return d>=0&&_>=0?a<v?1:a>v?-1:0:d<0&&_<0?a<v?-1:a>v?1:0:_<d?-1:_>d?1:0}}}let vk=0;class ta{static compare(e,t){const i=e.leftSE.point.x,l=t.leftSE.point.x,u=e.rightSE.point.x,d=t.rightSE.point.x;if(d<i)return 1;if(u<l)return-1;const a=e.leftSE.point.y,_=t.leftSE.point.y,v=e.rightSE.point.y,k=t.rightSE.point.y;if(i<l){if(_<a&&_<v)return 1;if(_>a&&_>v)return-1;const S=e.comparePoint(t.leftSE.point);if(S<0)return 1;if(S>0)return-1;const E=t.comparePoint(e.rightSE.point);return E!==0?E:-1}if(i>l){if(a<_&&a<k)return-1;if(a>_&&a>k)return 1;const S=t.comparePoint(e.leftSE.point);if(S!==0)return S;const E=e.comparePoint(t.rightSE.point);return E<0?1:E>0?-1:1}if(a<_)return-1;if(a>_)return 1;if(u<d){const S=t.comparePoint(e.rightSE.point);if(S!==0)return S}if(u>d){const S=e.comparePoint(t.rightSE.point);if(S<0)return 1;if(S>0)return-1}if(u!==d){const S=v-a,E=u-i,A=k-_,D=d-l;if(S>E&&A<D)return 1;if(S<E&&A>D)return-1}return u>d?1:u<d||v<k?-1:v>k?1:e.id<t.id?-1:e.id>t.id?1:0}constructor(e,t,i,l){this.id=++vk,this.leftSE=e,e.segment=this,e.otherSE=t,this.rightSE=t,t.segment=this,t.otherSE=e,this.rings=i,this.windings=l}static fromRing(e,t,i){let l,u,d;const a=Eo.comparePoints(e,t);if(a<0)l=e,u=t,d=1;else if(a>0)l=t,u=e,d=-1;else throw new Error(`Tried to create degenerate segment at [${e.x}, ${e.y}]`);const _=new Eo(l,!0),v=new Eo(u,!1);return new ta(_,v,[i],[d])}replaceRightSE(e){this.rightSE=e,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}bbox(){const e=this.leftSE.point.y,t=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:e<t?e:t},ur:{x:this.rightSE.point.x,y:e>t?e:t}}}vector(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}isAnEndpoint(e){return e.x===this.leftSE.point.x&&e.y===this.leftSE.point.y||e.x===this.rightSE.point.x&&e.y===this.rightSE.point.y}comparePoint(e){if(this.isAnEndpoint(e))return 0;const t=this.leftSE.point,i=this.rightSE.point,l=this.vector();if(t.x===i.x)return e.x===t.x?0:e.x<t.x?1:-1;const u=(e.y-t.y)/l.y,d=t.x+u*l.x;if(e.x===d)return 0;const a=(e.x-t.x)/l.x,_=t.y+a*l.y;return e.y===_?0:e.y<_?-1:1}getIntersection(e){const t=this.bbox(),i=e.bbox(),l=wp(t,i);if(l===null)return null;const u=this.leftSE.point,d=this.rightSE.point,a=e.leftSE.point,_=e.rightSE.point,v=pu(t,a)&&this.comparePoint(a)===0,k=pu(i,u)&&e.comparePoint(u)===0,S=pu(t,_)&&this.comparePoint(_)===0,E=pu(i,d)&&e.comparePoint(d)===0;if(k&&v)return E&&!S?d:!E&&S?_:null;if(k)return S&&u.x===_.x&&u.y===_.y?null:u;if(v)return E&&d.x===a.x&&d.y===a.y?null:a;if(E&&S)return null;if(E)return d;if(S)return _;const A=yk(u,this.vector(),a,e.vector());return A===null||!pu(l,A)?null:Vu.round(A.x,A.y)}split(e){const t=[],i=e.events!==void 0,l=new Eo(e,!0),u=new Eo(e,!1),d=this.rightSE;this.replaceRightSE(u),t.push(u),t.push(l);const a=new ta(l,d,this.rings.slice(),this.windings.slice());return Eo.comparePoints(a.leftSE.point,a.rightSE.point)>0&&a.swapEvents(),Eo.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),i&&(l.checkForConsuming(),u.checkForConsuming()),t}swapEvents(){const e=this.rightSE;this.rightSE=this.leftSE,this.leftSE=e,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(let t=0,i=this.windings.length;t<i;t++)this.windings[t]*=-1}consume(e){let t=this,i=e;for(;t.consumedBy;)t=t.consumedBy;for(;i.consumedBy;)i=i.consumedBy;const l=ta.compare(t,i);if(l!==0){if(l>0){const u=t;t=i,i=u}if(t.prev===i){const u=t;t=i,i=u}for(let u=0,d=i.rings.length;u<d;u++){const a=i.rings[u],_=i.windings[u],v=t.rings.indexOf(a);v===-1?(t.rings.push(a),t.windings.push(_)):t.windings[v]+=_}i.rings=null,i.windings=null,i.consumedBy=t,i.leftSE.consumedBy=t.leftSE,i.rightSE.consumedBy=t.rightSE}}prevInResult(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}beforeState(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{const e=this.prev.consumedBy||this.prev;this._beforeState=e.afterState()}return this._beforeState}afterState(){if(this._afterState!==void 0)return this._afterState;const e=this.beforeState();this._afterState={rings:e.rings.slice(0),windings:e.windings.slice(0),multiPolys:[]};const t=this._afterState.rings,i=this._afterState.windings,l=this._afterState.multiPolys;for(let a=0,_=this.rings.length;a<_;a++){const v=this.rings[a],k=this.windings[a],S=t.indexOf(v);S===-1?(t.push(v),i.push(k)):i[S]+=k}const u=[],d=[];for(let a=0,_=t.length;a<_;a++){if(i[a]===0)continue;const v=t[a],k=v.poly;if(d.indexOf(k)===-1)if(v.isExterior)u.push(k);else{d.indexOf(k)===-1&&d.push(k);const S=u.indexOf(v.poly);S!==-1&&u.splice(S,1)}}for(let a=0,_=u.length;a<_;a++){const v=u[a].multiPoly;l.indexOf(v)===-1&&l.push(v)}return this._afterState}isInResult(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;const e=this.beforeState().multiPolys,t=this.afterState().multiPolys;switch(jo.type){case"union":{const i=e.length===0,l=t.length===0;this._isInResult=i!==l;break}case"intersection":{let i,l;e.length<t.length?(i=e.length,l=t.length):(i=t.length,l=e.length),this._isInResult=l===jo.numMultiPolys&&i<l;break}case"xor":{const i=Math.abs(e.length-t.length);this._isInResult=i%2===1;break}case"difference":{const i=l=>l.length===1&&l[0].isSubject;this._isInResult=i(e)!==i(t);break}default:throw new Error(`Unrecognized operation type found ${jo.type}`)}return this._isInResult}}class C_{constructor(e,t,i){if(!Array.isArray(e)||e.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=t,this.isExterior=i,this.segments=[],typeof e[0][0]!="number"||typeof e[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const l=Vu.round(e[0][0],e[0][1]);this.bbox={ll:{x:l.x,y:l.y},ur:{x:l.x,y:l.y}};let u=l;for(let d=1,a=e.length;d<a;d++){if(typeof e[d][0]!="number"||typeof e[d][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");let _=Vu.round(e[d][0],e[d][1]);_.x===u.x&&_.y===u.y||(this.segments.push(ta.fromRing(u,_,this)),_.x<this.bbox.ll.x&&(this.bbox.ll.x=_.x),_.y<this.bbox.ll.y&&(this.bbox.ll.y=_.y),_.x>this.bbox.ur.x&&(this.bbox.ur.x=_.x),_.y>this.bbox.ur.y&&(this.bbox.ur.y=_.y),u=_)}(l.x!==u.x||l.y!==u.y)&&this.segments.push(ta.fromRing(u,l,this))}getSweepEvents(){const e=[];for(let t=0,i=this.segments.length;t<i;t++){const l=this.segments[t];e.push(l.leftSE),e.push(l.rightSE)}return e}}class bk{constructor(e,t){if(!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new C_(e[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(let i=1,l=e.length;i<l;i++){const u=new C_(e[i],this,!1);u.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=u.bbox.ll.x),u.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=u.bbox.ll.y),u.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=u.bbox.ur.x),u.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=u.bbox.ur.y),this.interiorRings.push(u)}this.multiPoly=t}getSweepEvents(){const e=this.exteriorRing.getSweepEvents();for(let t=0,i=this.interiorRings.length;t<i;t++){const l=this.interiorRings[t].getSweepEvents();for(let u=0,d=l.length;u<d;u++)e.push(l[u])}return e}}class E_{constructor(e,t){if(!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof e[0][0][0]=="number"&&(e=[e])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(let i=0,l=e.length;i<l;i++){const u=new bk(e[i],this);u.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=u.bbox.ll.x),u.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=u.bbox.ll.y),u.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=u.bbox.ur.x),u.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=u.bbox.ur.y),this.polys.push(u)}this.isSubject=t}getSweepEvents(){const e=[];for(let t=0,i=this.polys.length;t<i;t++){const l=this.polys[t].getSweepEvents();for(let u=0,d=l.length;u<d;u++)e.push(l[u])}return e}}class Ed{static factory(e){const t=[];for(let i=0,l=e.length;i<l;i++){const u=e[i];if(!u.isInResult()||u.ringOut)continue;let d=null,a=u.leftSE,_=u.rightSE;const v=[a],k=a.point,S=[];for(;d=a,a=_,v.push(a),a.point!==k;)for(;;){const E=a.getAvailableLinkedEvents();if(E.length===0){const B=v[0].point,P=v[v.length-1].point;throw new Error(`Unable to complete output ring starting at [${B.x}, ${B.y}]. Last matching segment found ends at [${P.x}, ${P.y}].`)}if(E.length===1){_=E[0].otherSE;break}let A=null;for(let B=0,P=S.length;B<P;B++)if(S[B].point===a.point){A=B;break}if(A!==null){const B=S.splice(A)[0],P=v.splice(B.index);P.unshift(P[0].otherSE),t.push(new Ed(P.reverse()));continue}S.push({index:v.length,point:a.point});const D=a.getLeftmostComparator(d);_=E.sort(D)[0].otherSE;break}t.push(new Ed(v))}return t}constructor(e){this.events=e;for(let t=0,i=e.length;t<i;t++)e[t].segment.ringOut=this;this.poly=null}getGeom(){let e=this.events[0].point;const t=[e];for(let v=1,k=this.events.length-1;v<k;v++){const S=this.events[v].point,E=this.events[v+1].point;k_(S,e,E)!==0&&(t.push(S),e=S)}if(t.length===1)return null;const i=t[0],l=t[1];k_(i,e,l)===0&&t.shift(),t.push(t[0]);const u=this.isExteriorRing()?1:-1,d=this.isExteriorRing()?0:t.length-1,a=this.isExteriorRing()?t.length:-1,_=[];for(let v=d;v!=a;v+=u)_.push([t[v].x,t[v].y]);return _}isExteriorRing(){if(this._isExteriorRing===void 0){const e=this.enclosingRing();this._isExteriorRing=e?!e.isExteriorRing():!0}return this._isExteriorRing}enclosingRing(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}_calcEnclosingRing(){let e=this.events[0];for(let l=1,u=this.events.length;l<u;l++){const d=this.events[l];Eo.compare(e,d)>0&&(e=d)}let t=e.segment.prevInResult(),i=t?t.prevInResult():null;for(;;){if(!t)return null;if(!i)return t.ringOut;if(i.ringOut!==t.ringOut)return i.ringOut.enclosingRing()!==t.ringOut?t.ringOut:t.ringOut.enclosingRing();t=i.prevInResult(),i=t?t.prevInResult():null}}}class M_{constructor(e){this.exteriorRing=e,e.poly=this,this.interiorRings=[]}addInterior(e){this.interiorRings.push(e),e.poly=this}getGeom(){const e=[this.exteriorRing.getGeom()];if(e[0]===null)return null;for(let t=0,i=this.interiorRings.length;t<i;t++){const l=this.interiorRings[t].getGeom();l!==null&&e.push(l)}return e}}class wk{constructor(e){this.rings=e,this.polys=this._composePolys(e)}getGeom(){const e=[];for(let t=0,i=this.polys.length;t<i;t++){const l=this.polys[t].getGeom();l!==null&&e.push(l)}return e}_composePolys(e){const t=[];for(let i=0,l=e.length;i<l;i++){const u=e[i];if(!u.poly)if(u.isExteriorRing())t.push(new M_(u));else{const d=u.enclosingRing();d.poly||t.push(new M_(d)),d.poly.addInterior(u)}}return t}}class xk{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:ta.compare;this.queue=e,this.tree=new qp(t),this.segments=[]}process(e){const t=e.segment,i=[];if(e.consumedBy)return e.isLeft?this.queue.remove(e.otherSE):this.tree.remove(t),i;const l=e.isLeft?this.tree.add(t):this.tree.find(t);if(!l)throw new Error(`Unable to find segment #${t.id} [${t.leftSE.point.x}, ${t.leftSE.point.y}] -> [${t.rightSE.point.x}, ${t.rightSE.point.y}] in SweepLine tree.`);let u=l,d=l,a,_;for(;a===void 0;)u=this.tree.prev(u),u===null?a=null:u.key.consumedBy===void 0&&(a=u.key);for(;_===void 0;)d=this.tree.next(d),d===null?_=null:d.key.consumedBy===void 0&&(_=d.key);if(e.isLeft){let v=null;if(a){const S=a.getIntersection(t);if(S!==null&&(t.isAnEndpoint(S)||(v=S),!a.isAnEndpoint(S))){const E=this._splitSafely(a,S);for(let A=0,D=E.length;A<D;A++)i.push(E[A])}}let k=null;if(_){const S=_.getIntersection(t);if(S!==null&&(t.isAnEndpoint(S)||(k=S),!_.isAnEndpoint(S))){const E=this._splitSafely(_,S);for(let A=0,D=E.length;A<D;A++)i.push(E[A])}}if(v!==null||k!==null){let S=null;v===null?S=k:k===null?S=v:S=Eo.comparePoints(v,k)<=0?v:k,this.queue.remove(t.rightSE),i.push(t.rightSE);const E=t.split(S);for(let A=0,D=E.length;A<D;A++)i.push(E[A])}i.length>0?(this.tree.remove(t),i.push(e)):(this.segments.push(t),t.prev=a)}else{if(a&&_){const v=a.getIntersection(_);if(v!==null){if(!a.isAnEndpoint(v)){const k=this._splitSafely(a,v);for(let S=0,E=k.length;S<E;S++)i.push(k[S])}if(!_.isAnEndpoint(v)){const k=this._splitSafely(_,v);for(let S=0,E=k.length;S<E;S++)i.push(k[S])}}}this.tree.remove(t)}return i}_splitSafely(e,t){this.tree.remove(e);const i=e.rightSE;this.queue.remove(i);const l=e.split(t);return l.push(i),e.consumedBy===void 0&&this.tree.add(e),l}}const I_=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,kk=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6;class Sk{run(e,t,i){jo.type=e,Vu.reset();const l=[new E_(t,!0)];for(let k=0,S=i.length;k<S;k++)l.push(new E_(i[k],!1));if(jo.numMultiPolys=l.length,jo.type==="difference"){const k=l[0];let S=1;for(;S<l.length;)wp(l[S].bbox,k.bbox)!==null?S++:l.splice(S,1)}if(jo.type==="intersection")for(let k=0,S=l.length;k<S;k++){const E=l[k];for(let A=k+1,D=l.length;A<D;A++)if(wp(E.bbox,l[A].bbox)===null)return[]}const u=new qp(Eo.compare);for(let k=0,S=l.length;k<S;k++){const E=l[k].getSweepEvents();for(let A=0,D=E.length;A<D;A++)if(u.insert(E[A]),u.size>I_)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big).")}const d=new xk(u);let a=u.size,_=u.pop();for(;_;){const k=_.key;if(u.size===a){const E=k.segment;throw new Error(`Unable to pop() ${k.isLeft?"left":"right"} SweepEvent [${k.point.x}, ${k.point.y}] from segment #${E.id} [${E.leftSE.point.x}, ${E.leftSE.point.y}] -> [${E.rightSE.point.x}, ${E.rightSE.point.y}] from queue.`)}if(u.size>I_)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big).");if(d.segments.length>kk)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments).");const S=d.process(k);for(let E=0,A=S.length;E<A;E++){const D=S[E];D.consumedBy===void 0&&u.insert(D)}a=u.size,_=u.pop()}Vu.reset();const v=Ed.factory(d.segments);return new wk(v).getGeom()}}const jo=new Sk,Tk=function(r){for(var e=arguments.length,t=new Array(e>1?e-1:0),i=1;i<e;i++)t[i-1]=arguments[i];return jo.run("union",r,t)},Ck=function(r){for(var e=arguments.length,t=new Array(e>1?e-1:0),i=1;i<e;i++)t[i-1]=arguments[i];return jo.run("intersection",r,t)},Ek=function(r){for(var e=arguments.length,t=new Array(e>1?e-1:0),i=1;i<e;i++)t[i-1]=arguments[i];return jo.run("xor",r,t)},Mk=function(r){for(var e=arguments.length,t=new Array(e>1?e-1:0),i=1;i<e;i++)t[i-1]=arguments[i];return jo.run("difference",r,t)};var G0={union:Tk,intersection:Ck,xor:Ek,difference:Mk};function W0(r,e,t){if(r!==null)for(var i,l,u,d,a,_,v,k=0,S=0,E,A=r.type,D=A==="FeatureCollection",B=A==="Feature",P=D?r.features.length:1,R=0;R<P;R++){v=D?r.features[R].geometry:B?r.geometry:r,E=v?v.type==="GeometryCollection":!1,a=E?v.geometries.length:1;for(var F=0;F<a;F++){var j=0,U=0;if(d=E?v.geometries[F]:v,d!==null){_=d.coordinates;var le=d.type;switch(k=0,le){case null:break;case"Point":if(e(_,S,R,j,U)===!1)return!1;S++,j++;break;case"LineString":case"MultiPoint":for(i=0;i<_.length;i++){if(e(_[i],S,R,j,U)===!1)return!1;S++,le==="MultiPoint"&&j++}le==="LineString"&&j++;break;case"Polygon":case"MultiLineString":for(i=0;i<_.length;i++){for(l=0;l<_[i].length-k;l++){if(e(_[i][l],S,R,j,U)===!1)return!1;S++}le==="MultiLineString"&&j++,le==="Polygon"&&U++}le==="Polygon"&&j++;break;case"MultiPolygon":for(i=0;i<_.length;i++){for(U=0,l=0;l<_[i].length;l++){for(u=0;u<_[i][l].length-k;u++){if(e(_[i][l][u],S,R,j,U)===!1)return!1;S++}U++}j++}break;case"GeometryCollection":for(i=0;i<d.geometries.length;i++)if(W0(d.geometries[i],e)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Zp(r,e){var t,i,l,u,d,a,_,v,k,S,E=0,A=r.type==="FeatureCollection",D=r.type==="Feature",B=A?r.features.length:1;for(t=0;t<B;t++){for(a=A?r.features[t].geometry:D?r.geometry:r,v=A?r.features[t].properties:D?r.properties:{},k=A?r.features[t].bbox:D?r.bbox:void 0,S=A?r.features[t].id:D?r.id:void 0,_=a?a.type==="GeometryCollection":!1,d=_?a.geometries.length:1,l=0;l<d;l++){if(u=_?a.geometries[l]:a,u===null){if(e(null,E,v,k,S)===!1)return!1;continue}switch(u.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(u,E,v,k,S)===!1)return!1;break}case"GeometryCollection":{for(i=0;i<u.geometries.length;i++)if(e(u.geometries[i],E,v,k,S)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}E++}}function Ik(r,e){Zp(r,function(t,i,l,u,d){var a=t===null?null:t.type;switch(a){case null:case"Point":case"LineString":case"Polygon":return e(ju(t,l,{bbox:u,id:d}),i,0)===!1?!1:void 0}var _;switch(a){case"MultiPoint":_="Point";break;case"MultiLineString":_="LineString";break;case"MultiPolygon":_="Polygon";break}for(var v=0;v<t.coordinates.length;v++){var k=t.coordinates[v],S={type:_,coordinates:k};if(e(ju(S,l),i,v)===!1)return!1}})}function Lk(r,e={}){const t=[];if(Zp(r,l=>{t.push(l.coordinates)}),t.length<2)throw new Error("Must have at least 2 geometries");const i=G0.union(t[0],...t.slice(1));return i.length===0?null:i.length===1?$p(i[0],e.properties):q0(i,e.properties)}var H0=Lk;function Ak(r,e={}){if(r.bbox!=null&&e.recompute!==!0)return r.bbox;const t=[1/0,1/0,-1/0,-1/0];return W0(r,i=>{t[0]>i[0]&&(t[0]=i[0]),t[1]>i[1]&&(t[1]=i[1]),t[2]<i[0]&&(t[2]=i[0]),t[3]<i[1]&&(t[3]=i[1])}),t}var L_=Ak;function Pk(r){const e=[];if(Zp(r,l=>{e.push(l.coordinates)}),e.length<2)throw new Error("Must have at least two features");const t=r.features[0].properties||{},i=G0.difference(e[0],...e.slice(1));return i.length===0?null:i.length===1?$p(i[0],t):q0(i,t)}var zk=Pk;function Dk(r){if(!r)throw new Error("geojson is required");var e=[];return Ik(r,function(t){e.push(t)}),Uu(e)}var Rk=Dk;function A_(r,e){const t=zk(Uu([$p([[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]]),r]));if(!t)return;t.properties={isMask:!0};const i=Td(L_(r)),l=(i[2]-i[0])/360/1e3,u=i[0]<-180,d=i[2]>180,a=Rk(r);if(a.features.length>1&&(u||d))for(const _ of a.features){const v=Td(L_(_));if(d&&v[0]<-180+l)for(const k of _.geometry.coordinates)for(const S of k)S[0]+=360-l;if(u&&v[2]>180-l)for(const k of _.geometry.coordinates)for(const S of k)S[0]-=360-l}e(Uu([a.features.length<2?r:H0(a)??r,t]))}const P_={fill:{paint:{"fill-color":"#000","fill-opacity":.1},filter:["all",["==",["geometry-type"],"Polygon"],["has","isMask"]]},line:{layout:{"line-cap":"square"},paint:{"line-width":["case",["==",["geometry-type"],"Polygon"],2,3],"line-dasharray":[1,1],"line-color":"#3170fe"},filter:["!",["has","isMask"]]}},sd="mtlr-gc-full-geom",z_="mtlr-gc-full-geom-fill",D_="mtlr-gc-full-geom-line";function X0(r,e,t=!0,i=!0,l={},u={},d=P_){let a;const _=[];let v,k,S;function E(){if(!r.loaded){r.once("load",E);return}const P=d?d===!0?P_:d:void 0;if(!(P!=null&&P.fill)&&!(P!=null&&P.line))return;const R=r.getSource(sd);if(R)R.setData(S??Uu([]));else if(S)r.addSource(sd,{type:"geojson",data:S});else return;!r.getLayer(z_)&&P!=null&&P.fill&&r.addLayer({...P==null?void 0:P.fill,id:z_,type:"fill",source:sd}),!r.getLayer(D_)&&P!=null&&P.line&&r.addLayer({...P==null?void 0:P.line,id:D_,type:"line",source:sd})}function A(P){S=P,E()}r.on("styledata",()=>{setTimeout(()=>{S&&E()})});const D=P=>{a==null||a({type:"mapClick",coordinates:[P.lngLat.lng,P.lngLat.lat]})};function B(P=!1){if(!e)throw new Error;const R=document.createElement("div");return P&&R.classList.add("marker-interactive"),new L2({props:{displayIn:"maplibre"},target:R}),new e.Marker({element:R,offset:[1,-13]})}return{setEventHandler(P){P?(a=P,r.on("click",D)):(a=void 0,r.off("click",D))},flyTo(P,R){r.flyTo({center:P,...R?{zoom:R}:{},...l})},fitBounds(P,R,F){r.fitBounds([[P[0],P[1]],[P[2],P[3]]],{padding:R,...F?{maxZoom:F}:{},...u})},indicateReverse(P){r.getCanvasContainer().style.cursor=P?"crosshair":""},setReverseMarker(P){!e||!t||(k?P?k.setLngLat(P):(k.remove(),k=void 0):P&&(t instanceof Function?k=t(r)??void 0:(k=(typeof t=="object"?new e.Marker(t):B()).setLngLat(P).addTo(r),k.getElement().classList.add("marker-reverse"))))},setFeatures(P,R,F){for(const j of _)j.remove();if(_.length=0,A(void 0),!!e){if(R){let j=!1;if(R.geometry.type==="GeometryCollection"){const U=R.geometry.geometries.filter(le=>le.type==="Polygon"||le.type==="MultiPolygon");e:if(U.length>0){const le=H0(Uu(U.map(he=>ju(he))));if(!le)break e;A_({...R,geometry:le.geometry},A),j=!0}else{const le=R.geometry.geometries.filter(he=>he.type==="LineString"||he.type==="MultiLineString");le.length>0&&(A({...R,geometry:{type:"GeometryCollection",geometries:le}}),j=!0)}}if(!j){if(R.geometry.type==="Polygon"||R.geometry.type==="MultiPolygon")A_(R,A);else if(R.geometry.type==="LineString"||R.geometry.type==="MultiLineString"){A(R);return}}if(!F&&R.geometry.type!=="Point")return;if(t instanceof Function){const U=t(r,R);U&&_.push(U)}else t&&_.push(typeof t=="object"?new e.Marker(t):B().setLngLat(R.center).addTo(r))}if(i)for(const j of P??[]){if(j===R)continue;let U;if(i instanceof Function){if(U=i(r,j),!U)continue}else U=(typeof i=="object"?new e.Marker(i):B(!0)).setLngLat(j.center).setPopup(new e.Popup({offset:[1,-27],closeButton:!1,closeOnMove:!0,className:"maptiler-gc-popup"}).setText(j.place_type[0]==="reverse"?j.place_name:j.place_name.replace(/,.*/,""))).addTo(r);const le=U.getElement();le.addEventListener("click",he=>{he.stopPropagation(),a==null||a({type:"markerClick",id:j.id})}),le.addEventListener("mouseenter",()=>{a==null||a({type:"markerMouseEnter",id:j.id}),U.togglePopup()}),le.addEventListener("mouseleave",()=>{a==null||a({type:"markerMouseLeave",id:j.id}),U.togglePopup()}),_.push(U)}}},setSelectedMarker(P){v&&v.getElement().classList.toggle("marker-selected",!1),v=P>-1?_[P]:void 0,v==null||v.getElement().classList.toggle("marker-selected",!0)},getCenterAndZoom(){const P=r.getCenter();return[r.getZoom(),P.lng,P.lat]}}}function Bk(r,e,t){var i,l;class u{constructor(P,R){po(this,"type"),po(this,"target"),this.type=R,this.target=P}}class d extends u{constructor(P,R){super(P,"select"),po(this,"feature"),Object.assign(this,R)}}class a extends u{constructor(P,R){super(P,"featureslisted"),po(this,"features"),this.features=R}}class _ extends u{constructor(P,R){super(P,"featuresmarked"),po(this,"features"),this.features=R}}class v extends u{constructor(P,R){super(P,"optionsvisibilitychange"),po(this,"optionsVisible"),this.optionsVisible=R}}class k extends u{constructor(P,R){super(P,"pick"),po(this,"feature"),this.feature=R}}class S extends u{constructor(P,R){super(P,"querychange"),po(this,"query"),this.query=R}}class E extends u{constructor(P,R,F){super(P,"response"),po(this,"url"),po(this,"featureCollection"),this.url=R,this.featureCollection=F}}class A extends u{constructor(P,R){super(P,"reversetoggle"),po(this,"reverse"),this.reverse=R}}class D extends r{constructor(P={}){super(),Jg(this,i),Jg(this,l),Yg(this,l,P)}onAddInt(P){const R=document.createElement("div");R.className="mapboxgl-ctrl-geocoder mapboxgl-ctrl maplibregl-ctrl-geocoder maplibregl-ctrl mapboxgl-ctrl-group";const{marker:F,showResultMarkers:j,flyTo:U,fullGeometryStyle:le,...he}=ir(this,l),Z=typeof U=="boolean"?{}:U,Q={mapController:X0(P,e,F,j,Z,Z,le),flyTo:U===void 0?!0:!!U,apiKey:"",...t==null?void 0:t(P,R),...he};if(!Q.apiKey)throw new Error("no apiKey provided");return Yg(this,i,new ek({target:R,props:Q})),ir(this,i).$on("select",ye=>{this.fire(new d(this,ye.detail))}),ir(this,i).$on("pick",ye=>{this.fire(new k(this,ye.detail.feature))}),ir(this,i).$on("featureslisted",ye=>{this.fire(new a(this,ye.detail.features))}),ir(this,i).$on("featuresmarked",ye=>{this.fire(new _(this,ye.detail.features))}),ir(this,i).$on("response",ye=>{this.fire(new E(this,ye.detail.url,ye.detail.featureCollection))}),ir(this,i).$on("optionsvisibilitychange",ye=>{this.fire(new v(this,ye.detail.optionsVisible))}),ir(this,i).$on("reversetoggle",ye=>{this.fire(new A(this,ye.detail.reverse))}),ir(this,i).$on("querychange",ye=>{this.fire(new S(this,ye.detail.query))}),R}on(P,R){return super.on(P,R)}once(P,R){return super.once(P,R)}off(P,R){return super.off(P,R)}listens(P){return super.listens(P)}setOptions(P){var R;Object.assign(ir(this,l),P);const{marker:F,showResultMarkers:j,flyTo:U,fullGeometryStyle:le,...he}=ir(this,l);(R=ir(this,i))==null||R.$set(he)}setQuery(P,R=!0){var F;(F=ir(this,i))==null||F.setQuery(P,R)}clearMap(){var P;(P=ir(this,i))==null||P.clearMap()}clearList(){var P;(P=ir(this,i))==null||P.clearList()}setReverseMode(P){var R;(R=ir(this,i))==null||R.$set({reverseActive:P})}focus(){var P;(P=ir(this,i))==null||P.focus()}blur(){var P;(P=ir(this,i))==null||P.blur()}onRemove(){var P;(P=ir(this,i))==null||P.$destroy()}}return i=new WeakMap,l=new WeakMap,{MapLibreBasedGeocodingControl:D,events:{SelectEvent:d,FeaturesListedEvent:a,FeaturesMarkedEvent:_,OptionsVisibilityChangeEvent:v,PickEvent:k,QueryChangeEvent:S,ResponseEvent:E,ReverseToggleEvent:A}}}const{MapLibreBasedGeocodingControl:aM,events:la}=Bk(Ts.Evented,Ab);la.SelectEvent;la.FeaturesListedEvent;la.FeaturesMarkedEvent;la.OptionsVisibilityChangeEvent;la.PickEvent;la.QueryChangeEvent;la.ResponseEvent;la.ReverseToggleEvent;function Fk(r){let e,t;return{c(){e=ks("svg"),t=ks("path"),ke(t,"d","M13.12.706a.982.982 0 0 0-1.391 0L6.907 5.517 2.087.696a.982.982 0 1 0-1.391 1.39l4.821 4.821L.696 11.73a.982.982 0 1 0 1.39 1.39l4.821-4.821 4.822 4.821a.982.982 0 1 0 1.39-1.39L8.298 6.908l4.821-4.822a.988.988 0 0 0 0-1.38Z"),ke(e,"viewBox","0 0 14 14"),ke(e,"width","13"),ke(e,"height","13"),ke(e,"class","svelte-en2qvf")},m(i,l){ae(i,e,l),G(e,t)},p:It,i:It,o:It,d(i){i&&se(e)}}}class K0 extends Vt{constructor(e){super(),Ut(this,e,null,Fk,zt,{})}}function Ok(r){let e,t;return{c(){e=ks("svg"),t=ks("path"),ke(t,"d","M15 0C6.705 0 0 6.705 0 15C0 23.295 6.705 30 15 30C23.295 30 30 23.295 30 15C30 6.705 23.295 0 15 0ZM22.5 20.385L20.385 22.5L15 17.115L9.615 22.5L7.5 20.385L12.885 15L7.5 9.615L9.615 7.5L15 12.885L20.385 7.5L22.5 9.615L17.115 15L22.5 20.385Z"),ke(e,"viewBox","0 0 30 30"),ke(e,"fill","none"),ke(e,"xmlns","http://www.w3.org/2000/svg"),ke(e,"class","svelte-d2loi5")},m(i,l){ae(i,e,l),G(e,t)},p:It,i:It,o:It,d(i){i&&se(e)}}}class J0 extends Vt{constructor(e){super(),Ut(this,e,null,Ok,zt,{})}}function Nk(r){let e,t;return{c(){e=oe("img"),zn(e.src,t=r[3]+"area.svg")||ke(e,"src",t),ke(e,"alt",r[6]),ke(e,"class","svelte-ltkwvy")},m(i,l){ae(i,e,l)},p(i,l){l&8&&!zn(e.src,t=i[3]+"area.svg")&&ke(e,"src",t),l&64&&ke(e,"alt",i[6])},d(i){i&&se(e)}}}function jk(r){let e,t;return{c(){e=oe("img"),zn(e.src,t=r[3]+"reverse.svg")||ke(e,"src",t),ke(e,"alt",r[6]),ke(e,"class","svelte-ltkwvy")},m(i,l){ae(i,e,l)},p(i,l){l&8&&!zn(e.src,t=i[3]+"reverse.svg")&&ke(e,"src",t),l&64&&ke(e,"alt",i[6])},d(i){i&&se(e)}}}function Uk(r){let e,t;return{c(){e=oe("img"),zn(e.src,t=r[3]+"poi.svg")||ke(e,"src",t),ke(e,"alt",r[6]),ke(e,"class","svelte-ltkwvy")},m(i,l){ae(i,e,l)},p(i,l){l&8&&!zn(e.src,t=i[3]+"poi.svg")&&ke(e,"src",t),l&64&&ke(e,"alt",i[6])},d(i){i&&se(e)}}}function Vk(r){let e,t;return{c(){e=oe("img"),zn(e.src,t=r[3]+"postal_code.svg")||ke(e,"src",t),ke(e,"alt",r[6]),ke(e,"class","svelte-ltkwvy")},m(i,l){ae(i,e,l)},p(i,l){l&8&&!zn(e.src,t=i[3]+"postal_code.svg")&&ke(e,"src",t),l&64&&ke(e,"alt",i[6])},d(i){i&&se(e)}}}function $k(r){let e,t;return{c(){e=oe("img"),zn(e.src,t=r[3]+"street.svg")||ke(e,"src",t),ke(e,"alt",r[6]),ke(e,"class","svelte-ltkwvy")},m(i,l){ae(i,e,l)},p(i,l){l&8&&!zn(e.src,t=i[3]+"street.svg")&&ke(e,"src",t),l&64&&ke(e,"alt",i[6])},d(i){i&&se(e)}}}function qk(r){let e,t;return{c(){e=oe("img"),zn(e.src,t=r[3]+"road.svg")||ke(e,"src",t),ke(e,"alt",r[6]),ke(e,"class","svelte-ltkwvy")},m(i,l){ae(i,e,l)},p(i,l){l&8&&!zn(e.src,t=i[3]+"road.svg")&&ke(e,"src",t),l&64&&ke(e,"alt",i[6])},d(i){i&&se(e)}}}function Zk(r){let e,t;return{c(){e=oe("img"),zn(e.src,t=r[3]+"housenumber.svg")||ke(e,"src",t),ke(e,"alt",r[6]),ke(e,"class","svelte-ltkwvy")},m(i,l){ae(i,e,l)},p(i,l){l&8&&!zn(e.src,t=i[3]+"housenumber.svg")&&ke(e,"src",t),l&64&&ke(e,"alt",i[6])},d(i){i&&se(e)}}}function Gk(r){let e,t,i,l;return{c(){e=oe("img"),zn(e.src,t=r[5])||ke(e,"src",t),ke(e,"alt",r[4]),ke(e,"class","svelte-ltkwvy")},m(u,d){ae(u,e,d),i||(l=St(e,"error",r[14]),i=!0)},p(u,d){d&32&&!zn(e.src,t=u[5])&&ke(e,"src",t),d&16&&ke(e,"alt",u[4])},d(u){u&&se(e),i=!1,l()}}}function R_(r){let e,t;return{c(){e=oe("span"),t=Ve(r[6]),ke(e,"class","secondary svelte-ltkwvy")},m(i,l){ae(i,e,l),G(e,t)},p(i,l){l&64&&si(t,i[6])},d(i){i&&se(e)}}}function Wk(r){let e,t,i,l,u,d,a,_,v,k=(r[7]?r[0].place_name:r[0].place_name.replace(/,.*/,""))+"",S,E,A=r[2]==="always"||r[2]!=="never"&&!r[0].address&&!r[0].id.startsWith("road.")&&!r[0].id.startsWith("address.")&&!r[0].id.startsWith("postal_code.")&&(!r[0].id.startsWith("poi.")||!r[5])&&!r[7],D,B,P=(r[7]?"":r[0].place_name.replace(/[^,]*,?\s*/,""))+"",R,F,j;function U(Q,ye){return ye&1&&(t=null),ye&1&&(i=null),ye&1&&(l=null),ye&1&&(u=null),Q[5]?Gk:Q[0].address?Zk:(t==null&&(t=!!Q[0].id.startsWith("road.")),t?qk:(i==null&&(i=!!Q[0].id.startsWith("address.")),i?$k:(l==null&&(l=!!Q[0].id.startsWith("postal_code.")),l?Vk:(u==null&&(u=!!Q[0].id.startsWith("poi.")),u?Uk:Q[7]?jk:Nk))))}let le=U(r,-1),he=le(r),Z=A&&R_(r);return{c(){e=oe("li"),he.c(),d=Ae(),a=oe("span"),_=oe("span"),v=oe("span"),S=Ve(k),E=Ae(),Z&&Z.c(),D=Ae(),B=oe("span"),R=Ve(P),ke(v,"class","primary svelte-ltkwvy"),ke(_,"class","svelte-ltkwvy"),ke(B,"class","line2 svelte-ltkwvy"),ke(a,"class","texts svelte-ltkwvy"),ke(e,"tabindex","0"),ke(e,"data-selected",r[1]),ke(e,"class","svelte-ltkwvy"),cr(e,"selected",r[1])},m(Q,ye){ae(Q,e,ye),he.m(e,null),G(e,d),G(e,a),G(a,_),G(_,v),G(v,S),G(_,E),Z&&Z.m(_,null),G(a,D),G(a,B),G(B,R),F||(j=[St(e,"mouseenter",r[12]),St(e,"focus",r[13])],F=!0)},p(Q,[ye]){le===(le=U(Q,ye))&&he?he.p(Q,ye):(he.d(1),he=le(Q),he&&(he.c(),he.m(e,d))),ye&1&&k!==(k=(Q[7]?Q[0].place_name:Q[0].place_name.replace(/,.*/,""))+"")&&si(S,k),ye&37&&(A=Q[2]==="always"||Q[2]!=="never"&&!Q[0].address&&!Q[0].id.startsWith("road.")&&!Q[0].id.startsWith("address.")&&!Q[0].id.startsWith("postal_code.")&&(!Q[0].id.startsWith("poi.")||!Q[5])&&!Q[7]),A?Z?Z.p(Q,ye):(Z=R_(Q),Z.c(),Z.m(_,null)):Z&&(Z.d(1),Z=null),ye&1&&P!==(P=(Q[7]?"":Q[0].place_name.replace(/[^,]*,?\s*/,""))+"")&&si(R,P),ye&2&&ke(e,"data-selected",Q[1]),ye&2&&cr(e,"selected",Q[1])},i:It,o:It,d(Q){Q&&se(e),he.d(),Z&&Z.d(),F=!1,hn(j)}}}function Hk(r,e,t){var j;let i,l,{feature:u}=e,{selected:d=!1}=e,{showPlaceType:a}=e,{missingIconsCache:_}=e,{iconsBaseUrl:v}=e;const k=(j=u.properties)==null?void 0:j.categories;let S,E,A=0,D=u.place_type[0]==="reverse";function B(){E&&_.add(E),t(10,A++,A)}function P(U){fi.call(this,r,U)}function R(U){fi.call(this,r,U)}const F=()=>B();return r.$$set=U=>{"feature"in U&&t(0,u=U.feature),"selected"in U&&t(1,d=U.selected),"showPlaceType"in U&&t(2,a=U.showPlaceType),"missingIconsCache"in U&&t(9,_=U.missingIconsCache),"iconsBaseUrl"in U&&t(3,v=U.iconsBaseUrl)},r.$$.update=()=>{var U,le,he,Z;if(r.$$.dirty&3640)do t(11,i--,i),t(4,S=k==null?void 0:k[i]),t(5,E=S?v+S.replace(/ /g,"_")+".svg":void 0);while(i>-1&&(!E||_.has(E)));r.$$.dirty&1&&t(6,l=((le=(U=u.properties)==null?void 0:U.categories)==null?void 0:le.join(", "))??((Z=(he=u.properties)==null?void 0:he.place_type_name)==null?void 0:Z[0])??u.place_type[0])},t(11,i=(k==null?void 0:k.length)??0),[u,d,a,v,S,E,l,D,B,_,A,i,P,R,F]}class Xk extends Vt{constructor(e){super(),Ut(this,e,Hk,Wk,zt,{feature:0,selected:1,showPlaceType:2,missingIconsCache:9,iconsBaseUrl:3})}}function Kk(r){let e;return{c(){e=oe("div"),e.innerHTML='<svg viewBox="0 0 18 18" width="24" height="24" class="svelte-7cmwmc"><path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"></path><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"></path></svg>',ke(e,"class","svelte-7cmwmc")},m(t,i){ae(t,e,i)},p:It,i:It,o:It,d(t){t&&se(e)}}}class Jk extends Vt{constructor(e){super(),Ut(this,e,null,Kk,zt,{})}}function Yk(r){let e,t;return{c(){e=ks("svg"),t=ks("path"),ke(t,"d","M30.003-26.765C13.46-26.765 0-14.158 0 1.337c0 23.286 24.535 42.952 28.39 46.04.24.192.402.316.471.376.323.282.732.424 1.142.424.41 0 .82-.142 1.142-.424.068-.06.231-.183.471-.376 3.856-3.09 28.39-22.754 28.39-46.04 0-15.495-13.46-28.102-30.003-28.102Zm1.757 12.469c4.38 0 7.858 1.052 10.431 3.158 2.595 2.105 3.89 4.913 3.89 8.422 0 2.34-.53 4.362-1.593 6.063-1.063 1.702-3.086 3.616-6.063 5.742-2.042 1.51-3.337 2.659-3.89 3.446-.532.787-.8 1.82-.8 3.096v1.914h-8.449V15.18c0-2.041.434-3.815 1.306-5.325.872-1.51 2.467-3.118 4.785-4.82 2.233-1.594 3.7-2.89 4.402-3.889a5.582 5.582 0 0 0 1.087-3.35c0-1.382-.51-2.435-1.531-3.158-1.02-.723-2.45-1.087-4.28-1.087-3.19 0-6.826 1.047-10.91 3.131l-3.472-6.986c4.742-2.659 9.77-3.992 15.087-3.992Zm-1.88 37.324c1.765 0 3.124.472 4.08 1.408.98.936 1.47 2.276 1.47 4.02 0 1.68-.49 3.007-1.47 3.985-.977.957-2.336 1.435-4.08 1.435-1.787 0-3.171-.465-4.15-1.4-.978-.958-1.47-2.298-1.47-4.02 0-1.787.48-3.14 1.436-4.054.957-.915 2.355-1.374 4.184-1.374Z"),ke(e,"viewBox","0 0 60.006 21.412"),ke(e,"width","14"),ke(e,"height","20"),ke(e,"class","svelte-en2qvf")},m(i,l){ae(i,e,l),G(e,t)},p:It,i:It,o:It,d(i){i&&se(e)}}}class Qk extends Vt{constructor(e){super(),Ut(this,e,null,Yk,zt,{})}}function e4(r){let e,t,i;return{c(){e=ks("svg"),t=ks("circle"),i=ks("path"),ke(t,"cx","4.789"),ke(t,"cy","4.787"),ke(t,"r","3.85"),ke(t,"class","svelte-1aq105l"),ke(i,"d","M12.063 12.063 7.635 7.635"),ke(i,"class","svelte-1aq105l"),ke(e,"xmlns","http://www.w3.org/2000/svg"),ke(e,"width","13"),ke(e,"height","13"),ke(e,"viewBox","0 0 13 13"),ke(e,"class","svelte-1aq105l")},m(l,u){ae(l,e,u),G(e,t),G(e,i)},p:It,i:It,o:It,d(l){l&&se(e)}}}class t4 extends Vt{constructor(e){super(),Ut(this,e,null,e4,zt,{})}}function i4(r,e,t){const i=e[1],l=e[0],u=i-l;return r===i&&t?r:((r-l)%u+u)%u+l}function B_(r){const e=[...r];return e[2]<e[0]&&(Math.abs((e[0]+e[2]+360)/2)>Math.abs((e[0]-360+e[2])/2)?e[0]-=360:e[2]+=360),e}let mu;async function n4(r,e,t){const i=r==null?void 0:r.getCenterAndZoom();for(const l of e??[])if(!(i&&(l.minZoom!=null&&l.minZoom>i[0]||l.maxZoom!=null&&l.maxZoom<i[0]))){if(l.type==="fixed")return l.coordinates.join(",");e:if(l.type==="client-geolocation"){if(mu&&l.cachedLocationExpiry&&mu.time+l.cachedLocationExpiry>Date.now()){if(!mu.coords)break e;return mu.coords}let u;try{return u=await new Promise((d,a)=>{t.signal.addEventListener("abort",()=>{a(Error("aborted"))}),navigator.geolocation.getCurrentPosition(_=>{d([_.coords.longitude,_.coords.latitude].map(v=>v.toFixed(6)).join(","))},_=>{a(_)},l)}),u}catch{}finally{l.cachedLocationExpiry&&(mu={time:Date.now(),coords:u})}if(t.signal.aborted)return}if(l.type==="server-geolocation")return"ip";if(i&&l.type==="map-center")return i[1].toFixed(6)+","+i[2].toFixed(6)}}const r4=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([â¢ÂºÂ°\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['â²Â´â\.:]|M(?:IN)?(?:UTES)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([â¢ÂºÂ°\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['â²Â´â\.:]|M(?:IN)?(?:UTES)?)?\s*(EAST|WEST|[EW])?$/i,F_=/^([+-]?[0-8]?[0-9])\s+([0-5]?[0-9]\.\d{3,})[\s,]{1,}([+-]?[0-1]?[0-9]?[0-9])\s+([0-5]?[0-9]\.\d{3,})$/,O_=/^(NORTH|SOUTH|[NS])?[\s]*([+-]?[0-8]?[0-9](?:[\.,]\d{3,}))[\s]*([â¢ÂºÂ°]?)[\s]*(NORTH|SOUTH|[NS])?[\s]*[,/;]?[\s]*(EAST|WEST|[EW])?[\s]*([+-]?[0-1]?[0-9]?[0-9](?:[\.,]\d{3,}))[\s]*([â¢ÂºÂ°]?)[\s]*(EAST|WEST|[EW])?$/i,N_=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(EAST|WEST|[EW])?$/i,j_=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)\s*(EAST|WEST|[EW])?$/i,U_=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([â¢ÂºÂ°\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['â²Â´â\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''|â²â²|ââ|Â´Â´|["â³â\.])?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([â¢ÂºÂ°\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['â²Â´â\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''|â²â²|Â´Â´|ââ|["â³â\.])?\s*(EAST|WEST|[EW])?$/i;function o4(r){if(!["DMS","DM","DD"].includes(r))throw new Error("invalid format specified");if(this.decimalCoordinates&&this.decimalCoordinates.trim()){const e=this.decimalCoordinates.split(",").map(A=>Number(A.trim())),t=Number(e[0]),i=Number(e[1]),l=Math.abs(t),u=Math.abs(i),d=t>0?"N":"S",a=i>0?"E":"W";let _;r=="DD"&&(_=`${l}Â° ${d}, ${u}Â° ${a}`);const v=Math.floor(l),k=Math.floor(u),S=(l-v)*60,E=(u-k)*60;if(r=="DM"){let A=V_(S,3).toFixed(3).padStart(6,"0"),D=V_(E,3).toFixed(3).padStart(6,"0");A.endsWith(".000")&&D.endsWith(".000")&&(A=A.replace(/\.000$/,""),D=D.replace(/\.000$/,"")),_=`${v}Â° ${A}' ${d}, ${k}Â° ${D}' ${a}`}if(r=="DMS"){const A=Math.floor(S),D=Math.floor(E);let B=((S-A)*60).toFixed(1).padStart(4,"0"),P=((E-D)*60).toFixed(1).padStart(4,"0");const R=A.toString().padStart(2,"0"),F=D.toString().padStart(2,"0");B.endsWith(".0")&&P.endsWith(".0")&&(B=B.replace(/\.0$/,""),P=P.replace(/\.0$/,"")),_=`${v}Â° ${R}' ${B}" ${d}, ${k}Â° ${F}' ${P}" ${a}`}return _}else throw new Error("no decimal coordinates to convert")}function V_(r,e){const t=Math.pow(10,e);return Math.round((r+Number.EPSILON)*t)/t}function Gp(r,e){e||(e=5),r=r.replace(/\s+/g," ").trim();let t=null,i=null,l="",u="",d=null,a=[],_=!1;if(r4.test(r))throw new Error("invalid coordinate value");if(F_.test(r))if(a=F_.exec(r),_=gu(a),_)t=Math.abs(a[1])+a[2]/60,Number(a[1])<0&&(t*=-1),i=Math.abs(a[3])+a[4]/60,Number(a[3])<0&&(i*=-1),d="DM";else throw new Error("invalid coordinate format");else if(O_.test(r))if(a=O_.exec(r),_=gu(a),_){if(t=a[2],i=a[6],t.includes(",")&&(t=t.replace(",",".")),i.includes(",")&&(i=i.replace(",",".")),d="DD",Number(Math.round(t))==Number(t))throw new Error("integer only coordinate provided");if(Number(Math.round(i))==Number(i))throw new Error("integer only coordinate provided");a[1]?(l=a[1],u=a[5]):a[4]&&(l=a[4],u=a[8])}else throw new Error("invalid decimal coordinate format");else if(N_.test(r))if(a=N_.exec(r),_=gu(a),_)t=Math.abs(parseInt(a[2])),a[4]&&(t+=a[4]/60,d="DM"),a[6]&&(t+=a[6].replace(",",".")/3600,d="DMS"),parseInt(a[2])<0&&(t=-1*t),i=Math.abs(parseInt(a[9])),a[11]&&(i+=a[11]/60),a[13]&&(i+=a[13].replace(",",".")/3600),parseInt(a[9])<0&&(i=-1*i),a[1]?(l=a[1],u=a[8]):a[7]&&(l=a[7],u=a[14]);else throw new Error("invalid DMS coordinates format");else if(j_.test(r))if(a=j_.exec(r),_=gu(a),_)t=Math.abs(parseInt(a[2])),a[4]&&(t+=a[4]/60,d="DM"),a[6]&&(t+=a[6]/3600,d="DMS"),parseInt(a[2])<0&&(t=-1*t),i=Math.abs(parseInt(a[10])),a[12]&&(i+=a[12]/60),a[14]&&(i+=a[14]/3600),parseInt(a[10])<0&&(i=-1*i),a[1]?(l=a[1],u=a[9]):a[8]&&(l=a[8],u=a[16]);else throw new Error("invalid DMS coordinates format");else if(U_.test(r)){if(a=U_.exec(r),_=gu(a),a.filter(v=>v).length<=5)throw new Error("invalid coordinates format");if(_)t=Math.abs(parseInt(a[2])),a[4]&&(t+=a[4].replace(",",".")/60,d="DM"),a[6]&&(t+=a[6].replace(",",".")/3600,d="DMS"),parseInt(a[2])<0&&(t=-1*t),i=Math.abs(parseInt(a[10])),a[12]&&(i+=a[12].replace(",",".")/60),a[14]&&(i+=a[14].replace(",",".")/3600),parseInt(a[10])<0&&(i=-1*i),a[1]?(l=a[1],u=a[9]):a[8]&&(l=a[8],u=a[16]);else throw new Error("invalid coordinates format")}if(_){if(Math.abs(i)>=180)throw new Error("invalid longitude value");if(Math.abs(t)>=90)throw new Error("invalid latitude value");if(l&&!u||!l&&u)throw new Error("invalid coordinates value");if(l&&l==u)throw new Error("invalid coordinates format");t.toString().includes(",")&&(t=t.replace(",",".")),i.toString().includes(",")&&(i=i.replace(",","."));let v=/S|SOUTH/i;v.test(l)&&t>0&&(t=-1*t),v=/W|WEST/i,v.test(u)&&i>0&&(i=-1*i);const k=a[0].trim();let S,E;const A=/[,/;\u0020]/g,D=k.match(A);if(D==null){const R=Math.floor(r.length/2);S=k.substring(0,R).trim(),E=k.substring(R).trim()}else{let R;D.length%2==1?R=Math.floor(D.length/2):R=D.length/2-1;let F=0;if(R==0)F=k.indexOf(D[0]),S=k.substring(0,F).trim(),E=k.substring(F+1).trim();else{let j=0,U=0;for(;j<=R;)F=k.indexOf(D[j],U),U=F+1,j++;S=k.substring(0,F).trim(),E=k.substring(F+1).trim()}}const B=S.split(".");if(B.length==2&&B[1]==0&&B[1].length!=2)throw new Error("invalid coordinates format");const P=E.split(".");if(P.length==2&&P[1]==0&&P[1].length!=2)throw new Error("invalid coordinates format");if(/^\d+$/.test(S)||/^\d+$/.test(E))throw new Error("degree only coordinate/s provided");return t=Number(Number(t).toFixed(e)),i=Number(Number(i).toFixed(e)),Object.freeze({verbatimCoordinates:k,verbatimLatitude:S,verbatimLongitude:E,decimalLatitude:t,decimalLongitude:i,decimalCoordinates:`${t},${i}`,originalFormat:d,closeEnough:s4,toCoordinateFormat:o4})}else throw new Error("coordinates pattern match failed")}function gu(r){if(!isNaN(r[0]))return!1;const e=[...r];if(e.shift(),e.length%2>0)return!1;const t=/^[-+]?\d+([\.,]\d+)?$/,i=/[eastsouthnorthwest]+/i,l=e.length/2;for(let u=0;u<l;u++){const d=e[u],a=e[u+l],_=t.test(d)&&t.test(a),v=i.test(d)&&i.test(a),k=d==a;if(!(d==null&&a==null)){if(d==null||a==null)return!1;if(_||v||k)continue;return!1}}return!0}function $_(r,e){const t=Math.abs(r-e);return Number(t.toFixed(6))<=1e-5}function s4(r){if(!r)throw new Error("coords must be provided");if(r.includes(",")){const e=r.split(",");if(Number(e[0])==NaN||Number(e[1])==NaN)throw new Error("coords are not valid decimals");return $_(this.decimalLatitude,Number(e[0]))&&$_(this.decimalLongitude,e[1])}else throw new Error("coords being tested must be separated by a comma")}const a4=Object.freeze({DMS:"DMS",DM:"DM",DD:"DD"});Gp.to=a4;const l4=[{verbatimCoordinates:"40.123, -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123Â° N 74.123Â° W",verbatimLatitude:"40.123Â° N",verbatimLongitude:"74.123Â° W"},{verbatimCoordinates:"40.123Â° N 74.123Â° W",verbatimLatitude:"40.123Â° N",verbatimLongitude:"74.123Â° W"},{verbatimCoordinates:'40Â° 7Â´ 22.8" N 74Â° 7Â´ 22.8" W',verbatimLatitude:'40Â° 7Â´ 22.8" N',verbatimLongitude:'74Â° 7Â´ 22.8" W'},{verbatimCoordinates:"40Â° 7.38â , -74Â° 7.38â",verbatimLatitude:"40Â° 7.38â",verbatimLongitude:"-74Â° 7.38â"},{verbatimCoordinates:"N40Â°7â22.8ââ, W74Â°7â22.8ââ",verbatimLatitude:"N40Â°7â22.8ââ",verbatimLongitude:"W74Â°7â22.8ââ"},{verbatimCoordinates:'40Â°7â22.8"N, 74Â°7â22.8"W',verbatimLatitude:'40Â°7â22.8"N',verbatimLongitude:'74Â°7â22.8"W'},{verbatimCoordinates:`40Â°7'22.8"N, 74Â°7'22.8"W`,verbatimLatitude:`40Â°7'22.8"N`,verbatimLongitude:`74Â°7'22.8"W`},{verbatimCoordinates:"40 7 22.8, -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"},{verbatimCoordinates:"40.123 -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123Â°,-74.123Â°",verbatimLatitude:"40.123Â°",verbatimLongitude:"-74.123Â°"},{verbatimCoordinates:"40.123N74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"4007.38N7407.38W",verbatimLatitude:"4007.38N",verbatimLongitude:"7407.38W"},{verbatimCoordinates:'40Â°7â22.8"N, 74Â°7â22.8"W',verbatimLatitude:'40Â°7â22.8"N',verbatimLongitude:'74Â°7â22.8"W'},{verbatimCoordinates:"400722.8N740722.8W",verbatimLatitude:"400722.8N",verbatimLongitude:"740722.8W"},{verbatimCoordinates:"N 40 7.38 W 74 7.38",verbatimLatitude:"N 40 7.38",verbatimLongitude:"W 74 7.38"},{verbatimCoordinates:"40:7:22.8N 74:7:22.8W",verbatimLatitude:"40:7:22.8N",verbatimLongitude:"74:7:22.8W"},{verbatimCoordinates:"40:7:23N,74:7:23W",verbatimLatitude:"40:7:23N",verbatimLongitude:"74:7:23W",decimalLatitude:40.1230555555,decimalLongitude:-74.1230555555},{verbatimCoordinates:'40Â°7â23"N 74Â°7â23"W',verbatimLatitude:'40Â°7â23"N',verbatimLongitude:'74Â°7â23"W',decimalLatitude:40.1230555555,decimalLongitude:-74.12305555555555},{verbatimCoordinates:'40Â°7â23"S 74Â°7â23"E',verbatimLatitude:'40Â°7â23"S',verbatimLongitude:'74Â°7â23"E',decimalLatitude:-40.1230555555,decimalLongitude:74.12305555555555},{verbatimCoordinates:'40Â°7â23" -74Â°7â23"',verbatimLatitude:'40Â°7â23"',verbatimLongitude:'-74Â°7â23"',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:'40d 7â 23" N 74d 7â 23" W',verbatimLatitude:'40d 7â 23" N',verbatimLongitude:'74d 7â 23" W',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:"40.123N 74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"40Â° 7.38, -74Â° 7.38",verbatimLatitude:"40Â° 7.38",verbatimLongitude:"-74Â° 7.38"},{verbatimCoordinates:"40Â° 7.38, -74Â° 7.38",verbatimLatitude:"40Â° 7.38",verbatimLongitude:"-74Â° 7.38"},{verbatimCoordinates:"40 7 22.8; -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"}],c4={decimalLatitude:40.123,decimalLongitude:-74.123},u4=[{verbatimCoordinates:`50Â°4'17.698"south, 14Â°24'2.826"east`,verbatimLatitude:`50Â°4'17.698"south`,verbatimLongitude:`14Â°24'2.826"east`,decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"50d4m17.698S 14d24m2.826E",verbatimLatitude:"50d4m17.698S",verbatimLongitude:"14d24m2.826E",decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"40:26:46N,79:56:55W",verbatimLatitude:"40:26:46N",verbatimLongitude:"79:56:55W",decimalLatitude:40.44611111111111,decimalLongitude:-79.9486111111111},{verbatimCoordinates:"40:26:46.302N 79:56:55.903W",verbatimLatitude:"40:26:46.302N",verbatimLongitude:"79:56:55.903W",decimalLatitude:40.446195,decimalLongitude:-79.94886194444445},{verbatimCoordinates:"40Â°26â²47â³N 79Â°58â²36â³W",verbatimLatitude:"40Â°26â²47â³N",verbatimLongitude:"79Â°58â²36â³W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40d 26â² 47â³ N 79d 58â² 36â³ W",verbatimLatitude:"40d 26â² 47â³ N",verbatimLongitude:"79d 58â² 36â³ W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40.446195N 79.948862W",verbatimLatitude:"40.446195N",verbatimLongitude:"79.948862W",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40,446195Â° 79,948862Â°",verbatimLatitude:"40,446195Â°",verbatimLongitude:"79,948862Â°",decimalLatitude:40.446195,decimalLongitude:79.948862},{verbatimCoordinates:"40Â° 26.7717, -79Â° 56.93172",verbatimLatitude:"40Â° 26.7717",verbatimLongitude:"-79Â° 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.446195, -79.948862",verbatimLatitude:"40.446195",verbatimLongitude:"-79.948862",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.123256; -74.123256",verbatimLatitude:"40.123256",verbatimLongitude:"-74.123256",decimalLatitude:40.123256,decimalLongitude:-74.123256},{verbatimCoordinates:"18Â°24S 22Â°45E",verbatimLatitude:"18Â°24S",verbatimLongitude:"22Â°45E",decimalLatitude:-18.4,decimalLongitude:22.75}],h4=[{verbatimCoordinates:"10.432342S 10.6345345E",verbatimLatitude:"10.432342S",verbatimLongitude:"10.6345345E",decimalLatitude:-10.432342,decimalLongitude:10.6345345},{verbatimCoordinates:"10.00S 10.00E",verbatimLatitude:"10.00S",verbatimLongitude:"10.00E",decimalLatitude:-10,decimalLongitude:10},{verbatimCoordinates:"00.00S 01.00E",verbatimLatitude:"00.00S",verbatimLongitude:"01.00E",decimalLatitude:0,decimalLongitude:1},{verbatimCoordinates:"18.24S 22.45E",verbatimLatitude:"18.24S",verbatimLongitude:"22.45E",decimalLatitude:-18.4,decimalLongitude:22.75},{verbatimCoordinates:"27deg 15min 45.2sec S 18deg 32min 53.7sec E",verbatimLatitude:"27deg 15min 45.2sec S",verbatimLongitude:"18deg 32min 53.7sec E",decimalLatitude:-27.262555555555554,decimalLongitude:18.54825},{verbatimCoordinates:"-23.3245Â° S / 28.2344Â° E",verbatimLatitude:"-23.3245Â° S",verbatimLongitude:"28.2344Â° E",decimalLatitude:-23.3245,decimalLongitude:28.2344},{verbatimCoordinates:"40Â° 26.7717 -79Â° 56.93172",verbatimLatitude:"40Â° 26.7717",verbatimLongitude:"-79Â° 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"27.15.45S 18.32.53E",verbatimLatitude:"27.15.45S",verbatimLongitude:"18.32.53E",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"-27.15.45 18.32.53",verbatimLatitude:"-27.15.45",verbatimLongitude:"18.32.53",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"27.15.45.2S 18.32.53.4E",verbatimLatitude:"27.15.45.2S",verbatimLongitude:"18.32.53.4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"27.15.45,2S 18.32.53,4E",verbatimLatitude:"27.15.45,2S",verbatimLongitude:"18.32.53,4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"S23.43563 Â°  E22.45634 Â°",verbatimLatitude:"S23.43563 Â°",verbatimLongitude:"E22.45634 Â°",decimalLatitude:-23.43563,decimalLongitude:22.45634},{verbatimCoordinates:"27,71372Â° S 23,07771Â° E",verbatimLatitude:"27,71372Â° S",verbatimLongitude:"23,07771Â° E",decimalLatitude:-27.71372,decimalLongitude:23.07771},{verbatimCoordinates:"27.45.34 S 23.23.23 E",verbatimLatitude:"27.45.34 S",verbatimLongitude:"23.23.23 E",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"S 27.45.34 E 23.23.23",verbatimLatitude:"S 27.45.34",verbatimLongitude:"E 23.23.23",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"53 16.3863,4 52.8171",verbatimLatitude:"53 16.3863",verbatimLongitude:"4 52.8171",decimalLatitude:53.273105,decimalLongitude:4.88029},{verbatimCoordinates:"50 8.2914,-5 2.4447",verbatimLatitude:"50 8.2914",verbatimLongitude:"-5 2.4447",decimalLatitude:50.13819,decimalLongitude:-5.040745},{verbatimCoordinates:"N 48Â° 30,6410', E 18Â° 57,4583'",verbatimLatitude:"N 48Â° 30,6410'",verbatimLongitude:"E 18Â° 57,4583'",decimalLatitude:48.51068,decimalLongitude:18.95764},{verbatimCoordinates:"1.23456, 18.33453",verbatimLatitude:"1.23456",verbatimLongitude:"18.33453",decimalLatitude:1.23456,decimalLongitude:18.33453}];function d4(){const r=[];return l4.forEach(e=>{e.decimalLatitude?r.push(e):r.push({...e,...c4})}),[...r,...u4,...h4]}const f4=d4();Gp.formats=f4.map(r=>r.verbatimCoordinates);const p4=Gp;function q_(r,e,t){const i=r.slice();return i[84]=e[t],i[86]=t,i}function Z_(r){let e,t;return e=new Jk({}),{c(){Ie(e.$$.fragment)},m(i,l){Ee(e,i,l),t=!0},i(i){t||(J(e.$$.fragment,i),t=!0)},o(i){ne(e.$$.fragment,i),t=!1},d(i){Me(e,i)}}}function G_(r){let e,t,i,l,u;return t=new Qk({}),{c(){e=oe("button"),Ie(t.$$.fragment),ke(e,"type","button"),ke(e,"title",r[9]),ke(e,"class","svelte-bz0zu3"),cr(e,"active",r[0])},m(d,a){ae(d,e,a),Ee(t,e,null),i=!0,l||(u=St(e,"click",r[69]),l=!0)},p(d,a){(!i||a[0]&512)&&ke(e,"title",d[9]),(!i||a[0]&1)&&cr(e,"active",d[0])},i(d){i||(J(t.$$.fragment,d),i=!0)},o(d){ne(t.$$.fragment,d),i=!1},d(d){d&&se(e),Me(t),l=!1,u()}}}function m4(r){let e,t=[],i=new Map,l,u,d,a=Tn(r[14]);const _=v=>v[84].id+(v[84].address?","+v[84].address:"");for(let v=0;v<a.length;v+=1){let k=q_(r,a,v),S=_(k);i.set(S,t[v]=W_(S,k))}return{c(){e=oe("ul");for(let v=0;v<t.length;v+=1)t[v].c();ke(e,"class","options svelte-bz0zu3")},m(v,k){ae(v,e,k);for(let S=0;S<t.length;S+=1)t[S]&&t[S].m(e,null);l=!0,u||(d=[St(e,"mouseleave",r[73]),St(e,"blur",r[74])],u=!0)},p(v,k){k[0]&17880064&&(a=Tn(v[14]),yi(),t=pb(t,k,_,1,v,a,i,e,fb,W_,null,q_),vi())},i(v){if(!l){for(let k=0;k<a.length;k+=1)J(t[k]);l=!0}},o(v){for(let k=0;k<t.length;k+=1)ne(t[k]);l=!1},d(v){v&&se(e);for(let k=0;k<t.length;k+=1)t[k].d();u=!1,hn(d)}}}function g4(r){let e,t,i,l,u,d;return t=new J0({}),{c(){e=oe("div"),Ie(t.$$.fragment),i=Ae(),l=oe("div"),u=Ve(r[7]),ke(l,"class","svelte-bz0zu3"),ke(e,"class","no-results svelte-bz0zu3")},m(a,_){ae(a,e,_),Ee(t,e,null),G(e,i),G(e,l),G(l,u),d=!0},p(a,_){(!d||_[0]&128)&&si(u,a[7])},i(a){d||(J(t.$$.fragment,a),d=!0)},o(a){ne(t.$$.fragment,a),d=!1},d(a){a&&se(e),Me(t)}}}function _4(r){let e="",t;return{c(){t=Ve(e)},m(i,l){ae(i,t,l)},p:It,i:It,o:It,d(i){i&&se(t)}}}function y4(r){let e,t,i,l,u,d,a,_,v,k,S;return t=new J0({}),_=new K0({}),{c(){e=oe("div"),Ie(t.$$.fragment),i=Ae(),l=oe("div"),u=Ve(r[6]),d=Ae(),a=oe("button"),Ie(_.$$.fragment),ke(l,"class","svelte-bz0zu3"),ke(a,"class","svelte-bz0zu3"),ke(e,"class","error svelte-bz0zu3")},m(E,A){ae(E,e,A),Ee(t,e,null),G(e,i),G(e,l),G(l,u),G(e,d),G(e,a),Ee(_,a,null),v=!0,k||(S=St(a,"click",r[70]),k=!0)},p(E,A){(!v||A[0]&64)&&si(u,E[6])},i(E){v||(J(t.$$.fragment,E),J(_.$$.fragment,E),v=!0)},o(E){ne(t.$$.fragment,E),ne(_.$$.fragment,E),v=!1},d(E){E&&se(e),Me(t),Me(_),k=!1,S()}}}function W_(r,e){let t,i,l;function u(){return e[71](e[86])}function d(){return e[72](e[84])}return i=new Xk({props:{feature:e[84],showPlaceType:e[10],selected:e[15]===e[86],missingIconsCache:e[20],iconsBaseUrl:e[12]}}),i.$on("mouseenter",u),i.$on("focus",d),{key:r,first:null,c(){t=En(),Ie(i.$$.fragment),this.first=t},m(a,_){ae(a,t,_),Ee(i,a,_),l=!0},p(a,_){e=a;const v={};_[0]&16384&&(v.feature=e[84]),_[0]&1024&&(v.showPlaceType=e[10]),_[0]&49152&&(v.selected=e[15]===e[86]),_[0]&4096&&(v.iconsBaseUrl=e[12]),i.$set(v)},i(a){l||(J(i.$$.fragment,a),l=!0)},o(a){ne(i.$$.fragment,a),l=!1},d(a){a&&se(t),Me(i,a)}}}function v4(r){let e,t,i,l,u,d,a,_,v,k,S,E,A,D,B,P,R,F,j,U,le,he=!1;u=new t4({}),S=new K0({});let Z=r[19]&&Z_(),Q=r[5]==="button"&&G_(r);const ye=r[61].default,Ne=$i(ye,r,r[60],null),re=[y4,_4,g4,m4],ve=[];function Ke(Le,et){var xt,mt;return Le[18]?0:Le[16]?((xt=Le[14])==null?void 0:xt.length)===0?2:Le[16]&&((mt=Le[14])!=null&&mt.length)?3:-1:1}return~(P=Ke(r))&&(R=ve[P]=re[P](r)),{c(){e=Ae(),t=oe("form"),i=oe("div"),l=oe("button"),Ie(u.$$.fragment),d=Ae(),a=oe("input"),_=Ae(),v=oe("div"),k=oe("button"),Ie(S.$$.fragment),E=Ae(),Z&&Z.c(),A=Ae(),Q&&Q.c(),D=Ae(),Ne&&Ne.c(),B=Ae(),R&&R.c(),ke(l,"class","search-button svelte-bz0zu3"),ke(l,"type","button"),ke(a,"placeholder",r[8]),ke(a,"aria-label",r[8]),ke(a,"class","svelte-bz0zu3"),ke(k,"type","button"),ke(k,"title",r[3]),ke(k,"class","svelte-bz0zu3"),ke(v,"class","clear-button-container svelte-bz0zu3"),cr(v,"displayable",r[1]!==""),ke(i,"class","input-group svelte-bz0zu3"),ke(t,"tabindex","0"),ke(t,"class",F=yd(r[2])+" svelte-bz0zu3"),cr(t,"can-collapse",r[4]&&r[1]==="")},m(Le,et){ae(Le,e,et),ae(Le,t,et),G(t,i),G(i,l),Ee(u,l,null),G(i,d),G(i,a),r[63](a),Pn(a,r[1]),G(i,_),G(i,v),G(v,k),Ee(S,k,null),G(v,E),Z&&Z.m(v,null),G(i,A),Q&&Q.m(i,null),G(i,D),Ne&&Ne.m(i,null),G(t,B),~P&&ve[P].m(t,null),j=!0,U||(le=[St(l,"click",r[62]),St(a,"input",r[64]),St(a,"focus",r[65]),St(a,"blur",r[66]),St(a,"keydown",r[22]),St(a,"input",r[67]),St(k,"click",r[68]),St(t,"submit",Mp(r[21]))],U=!0)},p(Le,et){(!j||et[0]&256)&&ke(a,"placeholder",Le[8]),(!j||et[0]&256)&&ke(a,"aria-label",Le[8]),et[0]&2&&a.value!==Le[1]&&Pn(a,Le[1]),(!j||et[0]&8)&&ke(k,"title",Le[3]),Le[19]?Z?et[0]&524288&&J(Z,1):(Z=Z_(),Z.c(),J(Z,1),Z.m(v,null)):Z&&(yi(),ne(Z,1,1,()=>{Z=null}),vi()),(!j||et[0]&2)&&cr(v,"displayable",Le[1]!==""),Le[5]==="button"?Q?(Q.p(Le,et),et[0]&32&&J(Q,1)):(Q=G_(Le),Q.c(),J(Q,1),Q.m(i,D)):Q&&(yi(),ne(Q,1,1,()=>{Q=null}),vi()),Ne&&Ne.p&&(!j||et[1]&536870912)&&Zi(Ne,ye,Le,Le[60],j?qi(ye,Le[60],et,null):Gi(Le[60]),null);let xt=P;P=Ke(Le),P===xt?~P&&ve[P].p(Le,et):(R&&(yi(),ne(ve[xt],1,1,()=>{ve[xt]=null}),vi()),~P?(R=ve[P],R?R.p(Le,et):(R=ve[P]=re[P](Le),R.c()),J(R,1),R.m(t,null)):R=null),(!j||et[0]&4&&F!==(F=yd(Le[2])+" svelte-bz0zu3"))&&ke(t,"class",F),(!j||et[0]&22)&&cr(t,"can-collapse",Le[4]&&Le[1]==="")},i(Le){j||(J(he),J(u.$$.fragment,Le),J(S.$$.fragment,Le),J(Z),J(Q),J(Ne,Le),J(R),j=!0)},o(Le){ne(he),ne(u.$$.fragment,Le),ne(S.$$.fragment,Le),ne(Z),ne(Q),ne(Ne,Le),ne(R),j=!1},d(Le){Le&&(se(e),se(t)),Me(u),r[63](null),Me(S),Z&&Z.d(),Q&&Q.d(),Ne&&Ne.d(Le),~P&&ve[P].d(),U=!1,hn(le)}}}function b4(r,e,t){let i,l,{$$slots:u={},$$scope:d}=e;const a={continental_marine:4,country:4,major_landform:8,region:5,subregion:6,county:7,joint_municipality:8,joint_submunicipality:9,municipality:10,municipal_district:11,locality:12,neighbourhood:13,place:14,postal_code:14,road:16,poi:17,address:18,"poi.peak":15,"poi.shop":18,"poi.cafe":18,"poi.restaurant":18,"poi.aerodrome":13};let{class:_=void 0}=e,{apiKey:v}=e,{bbox:k=void 0}=e,{clearButtonTitle:S="clear"}=e,{clearOnBlur:E=!1}=e,{collapsed:A=!1}=e,{country:D=void 0}=e,{debounceSearch:B=200}=e,{enableReverse:P="never"}=e,{errorMessage:R="Something went wrongâ¦"}=e,{filter:F=()=>!0}=e,{flyTo:j=!0}=e,{fuzzyMatch:U=!0}=e,{language:le=void 0}=e,{limit:he=void 0}=e,{mapController:Z=void 0}=e,{minLength:Q=2}=e,{noResultsMessage:ye="Oops! Looks like you're trying to predict something that's not quite right. We can't seem to find what you're looking for. Maybe try double-checking your spelling or try a different search term. Keep on typing - we'll do our best to get you where you need to go!"}=e,{placeholder:Ne="Search"}=e,{proximity:re=[{type:"server-geolocation"}]}=e,{reverseActive:ve=P==="always"}=e,{reverseButtonTitle:Ke="toggle reverse geocoding"}=e,{searchValue:Le=""}=e,{pickedResultStyle:et="full-geometry"}=e,{showPlaceType:xt="if-needed"}=e,{showResultsWhileTyping:mt=!0}=e,{selectFirst:at=!0}=e,{flyToSelected:Ht=!1}=e,{markerOnSelected:ri=!0}=e,{types:Nt=void 0}=e,{exhaustiveReverseGeocoding:At=!1}=e,{excludeTypes:ei=!1}=e,{zoom:ci=a}=e,{apiUrl:ti="https://api.maptiler.com/geocoding"}=e,{fetchParameters:ft={}}=e,{iconsBaseUrl:Jt="https://cdn.maptiler.com/maptiler-geocoding-control/v2.0.1/icons/"}=e,{adjustUrlQuery:gi=()=>{}}=e;function zi(){qe.focus()}function Fi(){qe.blur()}function ut(W,Ue=!0,$e=!1){t(1,Le=W),Ue?(t(15,Ye=-1),nt()):(Qt(!$e,$e),setTimeout(()=>{qe.focus(),qe.select()}))}function Dt(){t(14,ht=void 0),t(56,we=void 0),t(15,Ye=-1)}function Fe(){t(55,vt=[]),t(56,we=void 0)}let je=!1,ht,vt,we,Ei="",qe,Ye=-1,Ot,Pi=[],bi,gn,Mn,Qi;const io=new Set,Oi=rs();er(()=>{Z&&(Z.setEventHandler(void 0),Z.indicateReverse(!1),Z.setSelectedMarker(-1),Z.setFeatures(void 0,void 0,!1))});function nt(W){if(gn&&(clearTimeout(gn),gn=void 0),Ye>-1&&ht)t(56,we=ht[Ye]),t(1,Le=we.place_type[0]==="reverse"?we.place_name:we.place_name.replace(/,.*/,"")),t(18,Ot=void 0),t(55,vt=void 0),t(15,Ye=-1);else if(Le){const Ue=W||!Mi(Le);Yt(Le,{exact:!0}).then(()=>{t(55,vt=ht),t(56,we=void 0),Ue&&Ni()}).catch($e=>t(18,Ot=$e))}}function Mi(W){try{return p4(W,6)}catch{return!1}}async function Yt(W,{byId:Ue=!1,exact:$e=!1}={}){t(18,Ot=void 0),bi==null||bi.abort();const Ge=new AbortController;t(19,bi=Ge);try{const Je=Mi(W),dt=new URLSearchParams;if(le!==void 0&&dt.set("language",Array.isArray(le)?le.join(","):le??""),Nt&&dt.set("types",Nt.join(",")),ei&&dt.set("excludeTypes",String(ei)),k&&dt.set("bbox",k.map(wi=>wi.toFixed(6)).join(",")),D&&dt.set("country",Array.isArray(D)?D.join(","):D),!Ue&&!Je){const wi=await n4(Z,re,Ge);wi&&dt.set("proximity",wi),($e||!mt)&&dt.set("autocomplete","false"),dt.set("fuzzyMatch",String(U))}he!==void 0&&(At||!Je||(Nt==null?void 0:Nt.length)===1)&&dt.set("limit",String(he)),dt.set("key",v),gi(dt);const Bt=ti+"/"+encodeURIComponent(Je?Je.decimalLongitude+","+Je.decimalLatitude:W)+".json?"+dt.toString();if(Bt===Ei){Ue?(t(14,ht=void 0),t(56,we=Pi[0])):t(14,ht=Pi);return}Ei=Bt;const Xt=await fetch(Bt,{signal:Ge.signal,...ft});if(!Xt.ok)throw new Error(await Xt.text());const ui=await Xt.json();Oi("response",{url:Bt,featureCollection:ui}),Ue?(t(14,ht=void 0),t(56,we=ui.features[0]),Pi=[we]):(t(14,ht=ui.features.filter(F)),Je&&ht.unshift({type:"Feature",properties:{},id:"reverse_"+Je.decimalLongitude+"_"+Je.decimalLatitude,text:Je.decimalLatitude+", "+Je.decimalLongitude,place_name:Je.decimalLatitude+", "+Je.decimalLongitude,place_type:["reverse"],center:[Je.decimalLongitude,Je.decimalLatitude],bbox:[Je.decimalLongitude,Je.decimalLatitude,Je.decimalLongitude,Je.decimalLatitude],geometry:{type:"Point",coordinates:[Je.decimalLongitude,Je.decimalLatitude]}}),Pi=ht,Je&&qe.focus())}catch(Je){if(Je&&typeof Je=="object"&&"name"in Je&&Je.name==="AbortError")return;throw Je}finally{Ge===bi&&t(19,bi=void 0)}}function Ni(){var Ge;if(!(vt!=null&&vt.length)||!j)return;const W=[180,90,-180,-90],Ue=!vt.some(Je=>!Je.matching_text);let $e;for(const Je of vt){const dt=Xi(Je);if($e=$e===void 0?dt:dt===void 0?$e:Math.max($e,dt),Ue||!Je.matching_text)for(const Bt of[0,1,2,3])W[Bt]=Math[Bt<2?"min":"max"](W[Bt],((Ge=Je.bbox)==null?void 0:Ge[Bt])??Je.center[Bt%2])}Z&&vt.length>0&&(we&&W[0]===W[2]&&W[1]===W[3]?Z.flyTo(we.center,Xi(we)):Z.fitBounds(B_(W),50,$e))}function Xi(W){var $e;if(!W.bbox||W.bbox[0]!==W.bbox[2]&&W.bbox[1]!==W.bbox[3])return;const Ue=W.id.replace(/\..*/,"");return(Array.isArray(($e=W.properties)==null?void 0:$e.categories)?W.properties.categories.reduce((Ge,Je)=>{const dt=ci[Ue+"."+Je];return Ge===void 0?dt:dt===void 0?Ge:Math.max(Ge,dt)},void 0):void 0)??ci[Ue]}function _t(W){t(0,ve=P==="always"),t(14,ht=void 0),t(56,we=void 0),t(15,Ye=-1),ut(W[1].toFixed(6)+", "+i4(W[0],[-180,180],!0).toFixed(6),!1,!0)}function oi(W){if(!ht)return;let Ue=W.key==="ArrowDown"?1:W.key==="ArrowUp"?-1:0;Ue&&(Ye===(at?0:-1)&&Ue===-1&&t(15,Ye=ht.length),t(15,Ye+=Ue),Ye>=ht.length&&t(15,Ye=-1),Ye<0&&at&&t(15,Ye=0),W.preventDefault())}function Qt(W=!0,Ue=!1){if(t(18,Ot=void 0),mt||Ue){if(gn&&clearTimeout(gn),Le.length<Q)return;const $e=Le;gn=window.setTimeout(()=>{Yt($e).catch(Ge=>t(18,Ot=Ge))},W?B:0)}else t(14,ht=void 0),t(18,Ot=void 0)}function Ki(W){t(56,we=W),t(1,Le=W.place_name),t(15,Ye=-1)}const br=()=>qe.focus();function ni(W){on[W?"unshift":"push"](()=>{qe=W,t(17,qe)})}function no(){Le=this.value,t(1,Le),t(13,je),t(28,E)}const _n=()=>t(13,je=!0),me=()=>t(13,je=!1),H=()=>Qt(),K=()=>{t(1,Le=""),qe.focus()},ie=()=>t(0,ve=!ve),de=()=>t(18,Ot=void 0),Pe=W=>t(15,Ye=W),ze=W=>Ki(W),Be=()=>{at||t(15,Ye=-1)},Se=()=>{};return r.$$set=W=>{"class"in W&&t(2,_=W.class),"apiKey"in W&&t(26,v=W.apiKey),"bbox"in W&&t(27,k=W.bbox),"clearButtonTitle"in W&&t(3,S=W.clearButtonTitle),"clearOnBlur"in W&&t(28,E=W.clearOnBlur),"collapsed"in W&&t(4,A=W.collapsed),"country"in W&&t(29,D=W.country),"debounceSearch"in W&&t(30,B=W.debounceSearch),"enableReverse"in W&&t(5,P=W.enableReverse),"errorMessage"in W&&t(6,R=W.errorMessage),"filter"in W&&t(31,F=W.filter),"flyTo"in W&&t(32,j=W.flyTo),"fuzzyMatch"in W&&t(33,U=W.fuzzyMatch),"language"in W&&t(34,le=W.language),"limit"in W&&t(35,he=W.limit),"mapController"in W&&t(36,Z=W.mapController),"minLength"in W&&t(37,Q=W.minLength),"noResultsMessage"in W&&t(7,ye=W.noResultsMessage),"placeholder"in W&&t(8,Ne=W.placeholder),"proximity"in W&&t(38,re=W.proximity),"reverseActive"in W&&t(0,ve=W.reverseActive),"reverseButtonTitle"in W&&t(9,Ke=W.reverseButtonTitle),"searchValue"in W&&t(1,Le=W.searchValue),"pickedResultStyle"in W&&t(39,et=W.pickedResultStyle),"showPlaceType"in W&&t(10,xt=W.showPlaceType),"showResultsWhileTyping"in W&&t(40,mt=W.showResultsWhileTyping),"selectFirst"in W&&t(11,at=W.selectFirst),"flyToSelected"in W&&t(41,Ht=W.flyToSelected),"markerOnSelected"in W&&t(42,ri=W.markerOnSelected),"types"in W&&t(43,Nt=W.types),"exhaustiveReverseGeocoding"in W&&t(44,At=W.exhaustiveReverseGeocoding),"excludeTypes"in W&&t(45,ei=W.excludeTypes),"zoom"in W&&t(46,ci=W.zoom),"apiUrl"in W&&t(47,ti=W.apiUrl),"fetchParameters"in W&&t(48,ft=W.fetchParameters),"iconsBaseUrl"in W&&t(12,Jt=W.iconsBaseUrl),"adjustUrlQuery"in W&&t(49,gi=W.adjustUrlQuery),"$$scope"in W&&t(60,d=W.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&32&&t(0,ve=P==="always"),r.$$.dirty[0]&268443648&&setTimeout(()=>{t(16,Mn=je),E&&!je&&t(1,Le="")}),r.$$.dirty[0]&16386|r.$$.dirty[1]&64&&Le.length<Q&&(t(56,we=void 0),t(14,ht=void 0),t(18,Ot=void 0),t(55,vt=ht)),r.$$.dirty[1]&33554688&&et!=="marker-only"&&we&&!we.address&&we.geometry.type==="Point"&&we.place_type[0]!=="reverse"&&Yt(we.id,{byId:!0}).catch(W=>t(18,Ot=W)),r.$$.dirty[1]&100663330&&(Z&&we&&we.id!==Qi&&j&&(!we.bbox||we.bbox[0]===we.bbox[2]&&we.bbox[1]===we.bbox[3]?Z.flyTo(we.center,Xi(we)):Z.fitBounds(B_(we.bbox),50,Xi(we)),t(14,ht=void 0),t(55,vt=void 0),t(15,Ye=-1)),t(57,Qi=we==null?void 0:we.id)),r.$$.dirty[0]&18432&&at&&ht!=null&&ht.length&&t(15,Ye=0),r.$$.dirty[0]&2&&t(15,Ye=-1),r.$$.dirty[0]&16384|r.$$.dirty[1]&16777216&&vt!==ht&&t(55,vt=void 0),r.$$.dirty[0]&81921|r.$$.dirty[1]&16777248&&Z&&Z.setEventHandler(W=>{switch(W.type){case"mapClick":ve&&_t(W.coordinates);break;case"markerClick":{const Ue=ht==null?void 0:ht.find($e=>$e.id===W.id);Ue&&Ki(Ue)}break;case"markerMouseEnter":vt&&t(15,Ye=Mn?(ht==null?void 0:ht.findIndex(Ue=>Ue.id===W.id))??-1:-1);break;case"markerMouseLeave":vt&&t(15,Ye=-1);break}}),r.$$.dirty[0]&49152&&t(58,l=ht==null?void 0:ht[Ye]),r.$$.dirty[1]&134218786&&Z&&l&&j&&Ht&&Z.flyTo(l.center,Xi(l)),r.$$.dirty[1]&256&&t(59,i=et==="full-geometry-including-polygon-center-marker"),r.$$.dirty[1]&268437536&&(ri||Z==null||Z.setFeatures(void 0,void 0,i)),r.$$.dirty[1]&419432480&&Z&&ri&&!vt&&(Z.setFeatures(l?[l]:void 0,void 0,i),Z.setSelectedMarker(l?0:-1)),r.$$.dirty[1]&318767136&&Z&&Z.setFeatures(vt,we,i),r.$$.dirty[0]&32768|r.$$.dirty[1]&16777248&&vt&&Z&&Z.setSelectedMarker(Ye),r.$$.dirty[0]&2|r.$$.dirty[1]&32&&Z){const W=Mi(Le);Z.setReverseMarker(W?[W.decimalLongitude,W.decimalLatitude]:void 0)}r.$$.dirty[1]&134217728&&Oi("select",{feature:l}),r.$$.dirty[1]&33554432&&Oi("pick",{feature:we}),r.$$.dirty[0]&81920&&Oi("optionsvisibilitychange",{optionsVisible:Mn&&!!ht}),r.$$.dirty[0]&16384&&Oi("featureslisted",{features:ht}),r.$$.dirty[1]&16777216&&Oi("featuresmarked",{features:vt}),r.$$.dirty[0]&1&&Oi("reversetoggle",{reverse:ve}),r.$$.dirty[0]&2&&Oi("querychange",{query:Le}),r.$$.dirty[0]&1|r.$$.dirty[1]&32&&Z&&Z.indicateReverse(ve)},[ve,Le,_,S,A,P,R,ye,Ne,Ke,xt,at,Jt,je,ht,Ye,Mn,qe,Ot,bi,io,nt,oi,Qt,Ki,a,v,k,E,D,B,F,j,U,le,he,Z,Q,re,et,mt,Ht,ri,Nt,At,ei,ci,ti,ft,gi,zi,Fi,ut,Dt,Fe,vt,we,Qi,l,i,d,u,br,ni,no,_n,me,H,K,ie,de,Pe,ze,Be,Se]}class w4 extends Vt{constructor(e){super(),Ut(this,e,b4,v4,zt,{ZOOM_DEFAULTS:25,class:2,apiKey:26,bbox:27,clearButtonTitle:3,clearOnBlur:28,collapsed:4,country:29,debounceSearch:30,enableReverse:5,errorMessage:6,filter:31,flyTo:32,fuzzyMatch:33,language:34,limit:35,mapController:36,minLength:37,noResultsMessage:7,placeholder:8,proximity:38,reverseActive:0,reverseButtonTitle:9,searchValue:1,pickedResultStyle:39,showPlaceType:10,showResultsWhileTyping:40,selectFirst:11,flyToSelected:41,markerOnSelected:42,types:43,exhaustiveReverseGeocoding:44,excludeTypes:45,zoom:46,apiUrl:47,fetchParameters:48,iconsBaseUrl:12,adjustUrlQuery:49,focus:50,blur:51,setQuery:52,clearList:53,clearMap:54},null,[-1,-1,-1])}get ZOOM_DEFAULTS(){return this.$$.ctx[25]}get focus(){return this.$$.ctx[50]}get blur(){return this.$$.ctx[51]}get setQuery(){return this.$$.ctx[52]}get clearList(){return this.$$.ctx[53]}get clearMap(){return this.$$.ctx[54]}}function H_(r){let e,t,i;return t=new w4({props:{mapController:r[2],apiKey:r[0],country:r[1],types:r[3],proximity:[{type:"map-center"}]}}),{c(){e=oe("div"),Ie(t.$$.fragment),ke(e,"class","svelte-ixhnie")},m(l,u){ae(l,e,u),Ee(t,e,null),i=!0},p(l,u){const d={};u&4&&(d.mapController=l[2]),u&1&&(d.apiKey=l[0]),u&2&&(d.country=l[1]),t.$set(d)},i(l){i||(J(t.$$.fragment,l),i=!0)},o(l){ne(t.$$.fragment,l),i=!1},d(l){l&&se(e),Me(t)}}}function x4(r){let e,t,i=r[2]&&H_(r);return{c(){i&&i.c(),e=En()},m(l,u){i&&i.m(l,u),ae(l,e,u),t=!0},p(l,[u]){l[2]?i?(i.p(l,u),u&4&&J(i,1)):(i=H_(l),i.c(),J(i,1),i.m(e.parentNode,e)):i&&(yi(),ne(i,1,1,()=>{i=null}),vi())},i(l){t||(J(i),t=!0)},o(l){ne(i),t=!1},d(l){l&&se(e),i&&i.d(l)}}}function k4(r,e,t){let i,{apiKey:l}=e,{map:u}=e,{country:d}=e,a=["continental_marine","country","major_landform","region","subregion","county","joint_municipality","joint_submunicipality","municipality","municipal_district","locality","neighbourhood","place","postal_code","address","road","poi"];function _(v){return v?X0(v,to,!0,!0,{duration:1e3},{duration:1e3}):null}return r.$$set=v=>{"apiKey"in v&&t(0,l=v.apiKey),"map"in v&&t(4,u=v.map),"country"in v&&t(1,d=v.country)},r.$$.update=()=>{r.$$.dirty&16&&t(2,i=_(u))},[l,d,i,a,u]}class S4 extends Vt{constructor(e){super(),Ut(this,e,k4,x4,zt,{apiKey:0,map:4,country:1})}}const T4=Symbol.for("svelte-maplibre");function C4(){return Ld(T4)}function E4(r){return"layerType"in r&&r.layerType==="deckgl"}const M4=r=>({features:r[0]&16,data:r[0]&16,map:r[0]&4,close:r[0]&1}),X_=r=>{var e;return{features:r[4],data:(e=r[4])==null?void 0:e[0],map:r[2],close:r[31]}};function K_(r){let e,t,i=(r[4]||r[3]instanceof to.Marker)&&J_(r);return{c(){e=oe("div"),i&&i.c()},m(l,u){ae(l,e,u),i&&i.m(e,null),r[32](e),t=!0},p(l,u){l[4]||l[3]instanceof to.Marker?i?(i.p(l,u),u[0]&24&&J(i,1)):(i=J_(l),i.c(),J(i,1),i.m(e,null)):i&&(yi(),ne(i,1,1,()=>{i=null}),vi())},i(l){t||(J(i),t=!0)},o(l){ne(i),t=!1},d(l){l&&se(e),i&&i.d(),r[32](null)}}}function J_(r){let e;const t=r[30].default,i=$i(t,r,r[29],X_);return{c(){i&&i.c()},m(l,u){i&&i.m(l,u),e=!0},p(l,u){i&&i.p&&(!e||u[0]&536870933)&&Zi(i,t,l,l[29],e?qi(t,l[29],u,M4):Gi(l[29]),X_)},i(l){e||(J(i,l),e=!0)},o(l){ne(i,l),e=!1},d(l){i&&i.d(l)}}}function I4(r){let e,t,i=r[9].default&&K_(r);return{c(){i&&i.c(),e=En()},m(l,u){i&&i.m(l,u),ae(l,e,u),t=!0},p(l,u){l[9].default?i?(i.p(l,u),u[0]&512&&J(i,1)):(i=K_(l),i.c(),J(i,1),i.m(e.parentNode,e)):i&&(yi(),ne(i,1,1,()=>{i=null}),vi())},i(l){t||(J(i),t=!0)},o(l){ne(i),t=!1},d(l){l&&se(e),i&&i.d(l)}}}function L4(r,e,t){let i,l,u,d,a,_,{$$slots:v={},$$scope:k}=e;const S=lb(v);let{closeButton:E=void 0}=e,{closeOnClickOutside:A=!0}=e,{closeOnClickInside:D=!1}=e,{closeOnMove:B=!1}=e,{openOn:P="click"}=e,{openIfTopMost:R=!0}=e,{focusAfterOpen:F=!0}=e,{anchor:j=void 0}=e,{offset:U=void 0}=e,{popupClass:le=void 0}=e,{maxWidth:he=void 0}=e,{lngLat:Z=void 0}=e,{html:Q=void 0}=e,{open:ye=!1}=e;const Ne=rs(),{map:re,popupTarget:ve,layerEvent:Ke,layer:Le,eventTopMost:et}=C4();lt(r,re,je=>t(2,u=je)),lt(r,ve,je=>t(3,a=je)),lt(r,Ke,je=>t(28,d=je)),lt(r,Le,je=>t(35,_=je));const xt=["click","dblclick","contextmenu"];let mt,at=!1,Ht;function ri(){if(!mt)return;let je=mt.getElement();!je||je===Ht||(Ht=je,P==="hover"&&(Ht.style.pointerEvents="none"),Ht.addEventListener("mouseenter",()=>{t(24,at=!0)},{passive:!0}),Ht.addEventListener("mouseleave",()=>{t(24,at=!1)},{passive:!0}),Ht.addEventListener("click",()=>{D&&t(0,ye=!1)},{passive:!0}))}Zu(()=>{if(u)return u.on("click",Fi),u.on("contextmenu",Fi),typeof a=="string"&&(u.on("click",a,ci),u.on("dblclick",a,ci),u.on("contextmenu",a,ci),u.on("mousemove",a,zi),u.on("mouseleave",a,gi),u.on("touchstart",a,ft),u.on("touchend",a,Jt)),()=>{u!=null&&u.loaded()&&(mt==null||mt.remove(),u.off("click",Fi),u.off("contextmenu",Fi),a instanceof to.Marker?a.getPopup()===mt&&a.setPopup(void 0):typeof a=="string"&&(u.off("click",a,ci),u.off("dblclick",a,ci),u.off("contextmenu",a,ci),u.off("mousemove",a,zi),u.off("mouseleave",a,gi),u.off("touchstart",a,ft),u.off("touchend",a,Jt)))}});function Nt(je){return R?!("marker"in je)&&!E4(je)&&et(je)!==_:!1}let At=null,ei="normal";function ci(je){je.type===P&&(Nt(je)||("layerType"in je?je.layerType==="deckgl"?(t(10,Z=je.coordinate),t(4,At=je.object?[je.object]:null)):(t(10,Z=je.lngLat),t(4,At=je.features??[])):(t(10,Z=je.lngLat),t(4,At=je.features??[])),setTimeout(()=>t(0,ye=!0))))}let ti=null;function ft(je){ti=je.point}function Jt(je){if(!ti||P!=="hover")return;let ht=ti.dist(je.point);ti=null,ht<3&&(t(10,Z=je.lngLat),t(4,At=je.features??[]),mt.isOpen()?t(25,ei="justOpened"):(t(25,ei="opening"),t(0,ye=!0)))}function gi(je){P!=="hover"||ti||ei!=="normal"||(t(0,ye=!1),t(4,At=null))}function zi(je){if(!(P!=="hover"||ti||ei!=="normal")){if(Nt(je)){t(0,ye=!1),t(4,At=null);return}t(0,ye=!0),t(4,At=je.features??[]),t(10,Z=je.lngLat)}}function Fi(je){if(ei==="justOpened"){t(25,ei="normal");return}if(!A)return;let ht=[Ht,a instanceof to.Marker?a==null?void 0:a.getElement():null];ye&&mt.isOpen()&&!ht.some(vt=>vt==null?void 0:vt.contains(je.originalEvent.target))&&(je.type==="contextmenu"&&P==="contextmenu"||je.type!=="contextmenu")&&t(0,ye=!1)}er(()=>{u&&(mt!=null&&mt.isOpen())&&mt.remove()});let ut;const Dt=()=>t(0,ye=!1);function Fe(je){on[je?"unshift":"push"](()=>{ut=je,t(1,ut)})}return r.$$set=je=>{"closeButton"in je&&t(11,E=je.closeButton),"closeOnClickOutside"in je&&t(12,A=je.closeOnClickOutside),"closeOnClickInside"in je&&t(13,D=je.closeOnClickInside),"closeOnMove"in je&&t(14,B=je.closeOnMove),"openOn"in je&&t(15,P=je.openOn),"openIfTopMost"in je&&t(16,R=je.openIfTopMost),"focusAfterOpen"in je&&t(17,F=je.focusAfterOpen),"anchor"in je&&t(18,j=je.anchor),"offset"in je&&t(19,U=je.offset),"popupClass"in je&&t(20,le=je.popupClass),"maxWidth"in je&&t(21,he=je.maxWidth),"lngLat"in je&&t(10,Z=je.lngLat),"html"in je&&t(22,Q=je.html),"open"in je&&t(0,ye=je.open),"$$scope"in je&&t(29,k=je.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&14336&&t(27,i=E??(!A&&!D)),r.$$.dirty[0]&146685952&&(mt||(t(23,mt=new to.Popup({closeButton:i,closeOnClick:!1,closeOnMove:B,focusAfterOpen:F,maxWidth:he,className:le,anchor:j,offset:U})),Ht=mt.getElement(),mt.on("open",()=>{t(0,ye=!0),ri(),Ne("open",mt)}),mt.on("close",()=>{t(0,ye=!1),Ne("close",mt)}),mt.on("hover",()=>{Ne("hover",mt)}))),r.$$.dirty[0]&8421384&&mt&&a instanceof to.Marker&&(P==="click"?a.setPopup(mt):a.getPopup()===mt&&a.setPopup(void 0)),r.$$.dirty[0]&268468224&&xt.includes(P)&&(d==null?void 0:d.type)===P&&(ci(d),Tt(Ke,d=null,d)),r.$$.dirty[0]&268468224&&t(26,l=P==="hover"&&((d==null?void 0:d.type)==="mousemove"||(d==null?void 0:d.type)==="mouseenter")),r.$$.dirty[0]&352354304&&P==="hover"&&Ke&&(l&&d&&(d.layerType==="deckgl"?(t(10,Z=d.coordinate),t(4,At=d.object?[d.object]:null)):(t(10,Z=d.lngLat),t(4,At=d.features??[]))),t(0,ye=(l||at)??!1)),r.$$.dirty[0]&12582914&&(ut?mt.setDOMContent(ut):Q&&mt.setHTML(Q)),r.$$.dirty[0]&8389632&&Z&&mt.setLngLat(Z),r.$$.dirty[0]&41943045&&u){let je=mt.isOpen();ye&&!je?(mt.addTo(u),ei==="opening"&&t(25,ei="justOpened")):!ye&&je&&mt.remove()}},[ye,ut,u,a,At,re,ve,Ke,Le,S,Z,E,A,D,B,P,R,F,j,U,le,he,Q,mt,at,ei,l,i,d,k,v,Dt,Fe]}class A4 extends Vt{constructor(e){super(),Ut(this,e,L4,I4,zt,{closeButton:11,closeOnClickOutside:12,closeOnClickInside:13,closeOnMove:14,openOn:15,openIfTopMost:16,focusAfterOpen:17,anchor:18,offset:19,popupClass:20,maxWidth:21,lngLat:10,html:22,open:0},null,[-1,-1])}}const P4=r=>({props:r&8}),Y_=r=>({props:R4(r[3])});function z4(r){let e;const t=r[1].default,i=$i(t,r,r[2],Y_);return{c(){i&&i.c()},m(l,u){i&&i.m(l,u),e=!0},p(l,u){i&&i.p&&(!e||u&12)&&Zi(i,t,l,l[2],e?qi(t,l[2],u,P4):Gi(l[2]),Y_)},i(l){e||(J(i,l),e=!0)},o(l){ne(i,l),e=!1},d(l){i&&i.d(l)}}}function D4(r){let e,t;return e=new A4({props:{openOn:r[0],$$slots:{default:[z4,({features:i})=>({3:i}),({features:i})=>i?8:0]},$$scope:{ctx:r}}}),{c(){Ie(e.$$.fragment)},m(i,l){Ee(e,i,l),t=!0},p(i,[l]){const u={};l&1&&(u.openOn=i[0]),l&12&&(u.$$scope={dirty:l,ctx:i}),e.$set(u)},i(i){t||(J(e.$$.fragment,i),t=!0)},o(i){ne(e.$$.fragment,i),t=!1},d(i){Me(e,i)}}}function R4(r){return r?r[0].properties??{}:(console.log("A Popup with null features should be impossible"),{})}function B4(r,e,t){let{$$slots:i={},$$scope:l}=e,{openOn:u="hover"}=e;return r.$$set=d=>{"openOn"in d&&t(0,u=d.openOn),"$$scope"in d&&t(2,l=d.$$scope)},[u,i,l]}class Zo extends Vt{constructor(e){super(),Ut(this,e,B4,D4,zt,{openOn:0})}}const F4=["==",["geometry-type"],"Polygon"],O4=["==",["geometry-type"],"LineString"];function Lu(r,e,t){let i=["match",r];for(let[l,u]of Object.entries(e))i.push(l),i.push(u);return i.push(t),i}function N4(r,e,t){let i=["step",r];for(let l=1;l<e.length;l++)i.push(t[l-1]),i.push(e[l]);return i.push(t[t.length-1]),i}function Ql(){return{type:"FeatureCollection",features:[]}}const j4=r=>({}),Q_=r=>({}),U4=r=>({}),ey=r=>({}),V4=r=>({}),ty=r=>({});function $4(r){let e,t,i,l,u,d,a,_;const v=r[1].top,k=$i(v,r,r[0],ty),S=r[1].left,E=$i(S,r,r[0],ey),A=r[1].main,D=$i(A,r,r[0],Q_);return{c(){e=oe("div"),t=oe("div"),k&&k.c(),i=Ae(),l=oe("div"),u=oe("div"),E&&E.c(),d=Ae(),a=oe("div"),D&&D.c(),ke(t,"class","top svelte-29q570"),ke(u,"class","left svelte-29q570"),ke(a,"class","main svelte-29q570"),ke(l,"class","content svelte-29q570"),ke(e,"class","flex-container svelte-29q570")},m(B,P){ae(B,e,P),G(e,t),k&&k.m(t,null),G(e,i),G(e,l),G(l,u),E&&E.m(u,null),G(l,d),G(l,a),D&&D.m(a,null),_=!0},p(B,[P]){k&&k.p&&(!_||P&1)&&Zi(k,v,B,B[0],_?qi(v,B[0],P,V4):Gi(B[0]),ty),E&&E.p&&(!_||P&1)&&Zi(E,S,B,B[0],_?qi(S,B[0],P,U4):Gi(B[0]),ey),D&&D.p&&(!_||P&1)&&Zi(D,A,B,B[0],_?qi(A,B[0],P,j4):Gi(B[0]),Q_)},i(B){_||(J(k,B),J(E,B),J(D,B),_=!0)},o(B){ne(k,B),ne(E,B),ne(D,B),_=!1},d(B){B&&se(e),k&&k.d(B),E&&E.d(B),D&&D.d(B)}}}function q4(r,e,t){let{$$slots:i={},$$scope:l}=e;return r.$$set=u=>{"$$scope"in u&&t(0,l=u.$$scope)},[l,i]}class Z4 extends Vt{constructor(e){super(),Ut(this,e,q4,$4,zt,{})}}const G4=r=>({}),iy=r=>({}),W4=r=>({}),ny=r=>({}),H4=r=>({}),ry=r=>({});function X4(r){let e,t,i,l,u,d;const a=r[4].top,_=$i(a,r,r[3],ry),v=r[4].sidebar,k=$i(v,r,r[3],ny),S=r[4].map,E=$i(S,r,r[3],iy);return{c(){e=oe("div"),_&&_.c(),t=Ae(),i=oe("div"),k&&k.c(),l=Ae(),u=oe("div"),E&&E.c()},m(A,D){ae(A,e,D),_&&_.m(e,null),r[5](e),ae(A,t,D),ae(A,i,D),k&&k.m(i,null),r[6](i),ae(A,l,D),ae(A,u,D),E&&E.m(u,null),r[7](u),d=!0},p(A,[D]){_&&_.p&&(!d||D&8)&&Zi(_,a,A,A[3],d?qi(a,A[3],D,H4):Gi(A[3]),ry),k&&k.p&&(!d||D&8)&&Zi(k,v,A,A[3],d?qi(v,A[3],D,W4):Gi(A[3]),ny),E&&E.p&&(!d||D&8)&&Zi(E,S,A,A[3],d?qi(S,A[3],D,G4):Gi(A[3]),iy)},i(A){d||(J(_,A),J(k,A),J(E,A),d=!0)},o(A){ne(_,A),ne(k,A),ne(E,A),d=!1},d(A){A&&(se(e),se(t),se(i),se(l),se(u)),_&&_.d(A),r[5](null),k&&k.d(A),r[6](null),E&&E.d(A),r[7](null)}}}function K4(r,e,t){let i,l,u;lt(r,xp,S=>t(0,i=S)),lt(r,kp,S=>t(1,l=S)),lt(r,Sp,S=>t(2,u=S));let{$$slots:d={},$$scope:a}=e;function _(S){on[S?"unshift":"push"](()=>{i=S,xp.set(i)})}function v(S){on[S?"unshift":"push"](()=>{l=S,kp.set(l)})}function k(S){on[S?"unshift":"push"](()=>{u=S,Sp.set(u)})}return r.$$set=S=>{"$$scope"in S&&t(3,a=S.$$scope)},[i,l,u,a,d,_,v,k]}class Po extends Vt{constructor(e){super(),Ut(this,e,K4,X4,zt,{})}}let xp=ki(null),kp=ki(null),Sp=ki(null);function J4(r){let e,t,i,l,u,d,a,_,v;return{c(){e=oe("label"),t=Ve(`Basemap:
  `),i=oe("select"),l=oe("option"),l.textContent="MapTiler Dataviz",u=oe("option"),u.textContent="MapTiler Streets",d=oe("option"),d.textContent="MapTiler Satellite",a=oe("option"),a.textContent="OS Open Zoomstack",l.__value="dataviz",Pn(l,l.__value),u.__value="streets-v2",Pn(u,u.__value),d.__value="hybrid",Pn(d,d.__value),a.__value="uk-openzoomstack-light",Pn(a,a.__value),r[0]===void 0&&ic(()=>r[1].call(i))},m(k,S){ae(k,e,S),G(e,t),G(e,i),G(i,l),G(i,u),G(i,d),G(i,a),tc(i,r[0],!0),_||(v=St(i,"change",r[1]),_=!0)},p(k,[S]){S&1&&tc(i,k[0])},i:It,o:It,d(k){k&&se(e),_=!1,v()}}}function Y4(r,e,t){let i;lt(r,up,u=>t(0,i=u));function l(){i=Lp(this),up.set(i)}return[i,l]}class Q4 extends Vt{constructor(e){super(),Ut(this,e,Y4,J4,zt,{})}}let gd=ki(!0);function eS(r){let e,t;return e=new Es({props:{paint:{"fill-color":"black","fill-opacity":0},layout:{visibility:r[0]?"none":"visible"}}}),{c(){Ie(e.$$.fragment)},m(i,l){Ee(e,i,l),t=!0},p(i,l){const u={};l&1&&(u.layout={visibility:i[0]?"none":"visible"}),e.$set(u)},i(i){t||(J(e.$$.fragment,i),t=!0)},o(i){ne(e.$$.fragment,i),t=!1},d(i){Me(e,i)}}}function tS(r){let e,t;return e=new ur({props:{data:r[1],$$slots:{default:[eS]},$$scope:{ctx:r}}}),{c(){Ie(e.$$.fragment)},m(i,l){Ee(e,i,l),t=!0},p(i,[l]){const u={};l&5&&(u.$$scope={dirty:l,ctx:i}),e.$set(u)},i(i){t||(J(e.$$.fragment,i),t=!0)},o(i){ne(e.$$.fragment,i),t=!1},d(i){Me(e,i)}}}function iS(r,e,t){let i;return lt(r,gd,u=>t(0,i=u)),[i,{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]]}}]}class nS extends Vt{constructor(e){super(),Ut(this,e,iS,tS,zt,{})}}function rS(r){let e,t;return e=new Rd({props:{lngLat:r[0],$$slots:{default:[sS]},$$scope:{ctx:r}}}),{c(){Ie(e.$$.fragment)},m(i,l){Ee(e,i,l),t=!0},p(i,l){const u={};l&1&&(u.lngLat=i[0]),l&16&&(u.$$scope={dirty:l,ctx:i}),e.$set(u)},i(i){t||(J(e.$$.fragment,i),t=!0)},o(i){ne(e.$$.fragment,i),t=!1},d(i){Me(e,i)}}}function oS(r){let e,t,i;function l(d){r[3](d)}let u={draggable:!0,$$slots:{default:[aS]},$$scope:{ctx:r}};return r[0]!==void 0&&(u.lngLat=r[0]),e=new Rd({props:u}),on.push(()=>Wr(e,"lngLat",l)),{c(){Ie(e.$$.fragment)},m(d,a){Ee(e,d,a),i=!0},p(d,a){const _={};a&16&&(_.$$scope={dirty:a,ctx:d}),!t&&a&1&&(t=!0,_.lngLat=d[0],Gr(()=>t=!1)),e.$set(_)},i(d){i||(J(e.$$.fragment,d),i=!0)},o(d){ne(e.$$.fragment,d),i=!1},d(d){Me(e,d)}}}function sS(r){let e,t;const i=r[2].default,l=$i(i,r,r[4],null);return{c(){e=oe("span"),l&&l.c(),ke(e,"class","dot svelte-1gcxp27")},m(u,d){ae(u,e,d),l&&l.m(e,null),t=!0},p(u,d){l&&l.p&&(!t||d&16)&&Zi(l,i,u,u[4],t?qi(i,u[4],d,null):Gi(u[4]),null)},i(u){t||(J(l,u),t=!0)},o(u){ne(l,u),t=!1},d(u){u&&se(e),l&&l.d(u)}}}function aS(r){let e,t;const i=r[2].default,l=$i(i,r,r[4],null);return{c(){e=oe("span"),l&&l.c(),ke(e,"class","dot svelte-1gcxp27")},m(u,d){ae(u,e,d),l&&l.m(e,null),t=!0},p(u,d){l&&l.p&&(!t||d&16)&&Zi(l,i,u,u[4],t?qi(i,u[4],d,null):Gi(u[4]),null)},i(u){t||(J(l,u),t=!0)},o(u){ne(l,u),t=!1},d(u){u&&se(e),l&&l.d(u)}}}function lS(r){let e,t,i,l;const u=[oS,rS],d=[];function a(_,v){return _[1]?0:1}return e=a(r),t=d[e]=u[e](r),{c(){t.c(),i=En()},m(_,v){d[e].m(_,v),ae(_,i,v),l=!0},p(_,[v]){let k=e;e=a(_),e===k?d[e].p(_,v):(yi(),ne(d[k],1,1,()=>{d[k]=null}),vi(),t=d[e],t?t.p(_,v):(t=d[e]=u[e](_),t.c()),J(t,1),t.m(i.parentNode,i))},i(_){l||(J(t),l=!0)},o(_){ne(t),l=!1},d(_){_&&se(i),d[e].d(_)}}}function cS(r,e,t){let{$$slots:i={},$$scope:l}=e,{lngLat:u}=e,{draggable:d=!1}=e;function a(_){u=_,t(0,u)}return r.$$set=_=>{"lngLat"in _&&t(0,u=_.lngLat),"draggable"in _&&t(1,d=_.draggable),"$$scope"in _&&t(4,l=_.$$scope)},[u,d,i,a,l]}class Ua extends Vt{constructor(e){super(),Ut(this,e,cS,lS,zt,{lngLat:0,draggable:1})}}const uS="/ltn/assets/help-d011708a.svg";function oy(r){let e,t;return e=new Ad({props:{$$slots:{default:[hS]},$$scope:{ctx:r}}}),e.$on("close",r[3]),{c(){Ie(e.$$.fragment)},m(i,l){Ee(e,i,l),t=!0},p(i,l){const u={};l&16&&(u.$$scope={dirty:l,ctx:i}),e.$set(u)},i(i){t||(J(e.$$.fragment,i),t=!0)},o(i){ne(e.$$.fragment,i),t=!1},d(i){Me(e,i)}}}function hS(r){let e,t,i;const l=r[1].default,u=$i(l,r,r[4],null);return{c(){e=oe("h2"),e.textContent="Help",t=Ae(),u&&u.c()},m(d,a){ae(d,e,a),ae(d,t,a),u&&u.m(d,a),i=!0},p(d,a){u&&u.p&&(!i||a&16)&&Zi(u,l,d,d[4],i?qi(l,d[4],a,null):Gi(d[4]),null)},i(d){i||(J(u,d),i=!0)},o(d){ne(u,d),i=!1},d(d){d&&(se(e),se(t)),u&&u.d(d)}}}function dS(r){let e,t,i,l,u,d,a=r[0]&&oy(r);return{c(){e=oe("button"),e.innerHTML=`<img src="${uS}" title="Help" alt="Help"/>`,t=Ae(),a&&a.c(),i=En(),ke(e,"class","svelte-gb6dzm")},m(_,v){ae(_,e,v),ae(_,t,v),a&&a.m(_,v),ae(_,i,v),l=!0,u||(d=St(e,"click",r[2]),u=!0)},p(_,[v]){_[0]?a?(a.p(_,v),v&1&&J(a,1)):(a=oy(_),a.c(),J(a,1),a.m(i.parentNode,i)):a&&(yi(),ne(a,1,1,()=>{a=null}),vi())},i(_){l||(J(a),l=!0)},o(_){ne(a),l=!1},d(_){_&&(se(e),se(t),se(i)),a&&a.d(_),u=!1,d()}}}function fS(r,e,t){let{$$slots:i={},$$scope:l}=e,u=!1;const d=()=>t(0,u=!0),a=()=>t(0,u=!1);return r.$$set=_=>{"$$scope"in _&&t(4,l=_.$$scope)},[u,i,d,a,l]}class Wp extends Vt{constructor(e){super(),Ut(this,e,fS,dS,zt,{})}}function pS(r){let e,t,i,l;const u=r[1].default,d=$i(u,r,r[0],null);return{c(){e=oe("a"),d&&d.c(),ke(e,"href","#")},m(a,_){ae(a,e,_),d&&d.m(e,null),t=!0,i||(l=St(e,"click",Mp(r[2])),i=!0)},p(a,[_]){d&&d.p&&(!t||_&1)&&Zi(d,u,a,a[0],t?qi(u,a[0],_,null):Gi(a[0]),null)},i(a){t||(J(d,a),t=!0)},o(a){ne(d,a),t=!1},d(a){a&&se(e),d&&d.d(a),i=!1,l()}}}function mS(r,e,t){let{$$slots:i={},$$scope:l}=e;function u(d){fi.call(this,r,d)}return r.$$set=d=>{"$$scope"in d&&t(0,l=d.$$scope)},[l,i,u]}class Ii extends Vt{constructor(e){super(),Ut(this,e,mS,pS,zt,{})}}function gS(r,e){let t=new Set(r.getStyle().layers.filter(i=>i.type=="line").map(i=>i.id));return e=="dataviz"?["Road network","Path"].filter(i=>t.has(i)):e=="hybrid"?["Path","Road","Tunnel"].filter(i=>t.has(i)):e=="streets-v2"?r.getStyle().layers.filter(i=>i["source-layer"]=="transportation"&&i.type=="line").map(i=>i.id):e=="uk-openzoomstack-light"?r.getStyle().layers.filter(i=>i["source-layer"]=="roads"&&i.type=="line").map(i=>i.id):[]}const{window:_S}=Md;function yS(r){let e,t,i,l,u,d,a,_,v,k,S,E,A,D,B;return A=e0(r[8][0]),{c(){e=oe("button"),e.textContent="Stop StreetView",t=Ae(),i=oe("fieldset"),l=oe("legend"),l.textContent="Source:",u=Ae(),d=oe("label"),a=oe("input"),_=Ve(`
      Google Street View`),v=Ae(),k=oe("label"),S=oe("input"),E=Ve(`
      Bing Streetside`),ke(e,"class","secondary"),ke(a,"type","radio"),a.__value="google",Pn(a,a.__value),ke(S,"type","radio"),S.__value="bing",Pn(S,S.__value),A.p(a,S)},m(P,R){ae(P,e,R),ae(P,t,R),ae(P,i,R),G(i,l),G(i,u),G(i,d),G(d,a),a.checked=a.__value===r[0],G(d,_),G(i,v),G(i,k),G(k,S),S.checked=S.__value===r[0],G(k,E),D||(B=[St(e,"click",r[3]),St(a,"change",r[7]),St(S,"change",r[9])],D=!0)},p(P,R){R&1&&(a.checked=a.__value===P[0]),R&1&&(S.checked=S.__value===P[0])},d(P){P&&(se(e),se(t),se(i)),A.r(),D=!1,hn(B)}}}function vS(r){let e,t,i;return{c(){e=oe("button"),e.textContent="StreetView",ke(e,"class","secondary")},m(l,u){ae(l,e,u),t||(i=St(e,"click",r[2]),t=!0)},p:It,d(l){l&&se(e),t=!1,i()}}}function bS(r){let e,t,i;function l(a,_){return a[1]?vS:yS}let u=l(r),d=u(r);return{c(){d.c(),e=En()},m(a,_){d.m(a,_),ae(a,e,_),t||(i=St(_S,"keydown",r[4]),t=!0)},p(a,[_]){u===(u=l(a))&&d?d.p(a,_):(d.d(1),d=u(a),d&&(d.c(),d.m(e.parentNode,e)))},i:It,o:It,d(a){a&&se(e),d.d(a),t=!1,i()}}}function wS(r,e,t){let i;lt(r,gd,B=>t(1,i=B));let{map:l}=e,{maptilerBasemap:u}=e,d="google",a=[];function _(){Tt(gd,i=!1,i),l.on("click",k),l.getCanvas().style.cursor="crosshair";for(let B of gS(l,u))a.push([B,l.getPaintProperty(B,"line-color")]),l.setPaintProperty(B,"line-color","cyan")}function v(){Tt(gd,i=!0,i),l.off("click",k),l.getCanvas().style.cursor="inherit";for(let[B,P]of a)l.setPaintProperty(B,"line-color",P);a=[]}er(v);function k(B){let P=B.lngLat.lng,R=B.lngLat.lat;d=="google"?window.open(`http://maps.google.com/maps?q=&layer=c&cbll=${R},${P}&cbp=11,0,0,0,0`,"_blank"):d=="bing"&&window.open(`https://www.bing.com/maps?cp=${R}~${P}&style=x`,"_blank")}function S(B){!i&&B.key=="Escape"&&(B.stopPropagation(),v())}const E=[[]];function A(){d=this.__value,t(0,d)}function D(){d=this.__value,t(0,d)}return r.$$set=B=>{"map"in B&&t(5,l=B.map),"maptilerBasemap"in B&&t(6,u=B.maptilerBasemap)},[d,i,_,v,S,l,u,A,E,D]}class xS extends Vt{constructor(e){super(),Ut(this,e,wS,bS,zt,{map:5,maptilerBasemap:6})}}function un(r,e=!0){return{id:r,beforeId:kS(r),eventsIfTopMost:e}}function kS(r){let e=Pr(qo);if(!e){console.warn(`getBeforeId(${r}) called before map is ready. Z-ordering may be incorrect.`);return}let t,i=!1;for(let l=sy.length-1;l>=0;l--){let u=sy[l];if(u==r){i=!0;break}e.getLayer(u)&&(t=u)}if(!i)throw new Error(`Layer ID ${r} not defined in layerZorder`);return t}let ep=r=>r,tp=r=>r;const sy=[ep(tp("Background")),"neighbourhood-boundaries",ep("Ferry line"),"debug-borders","debug-crosses","debug-filters","cells","interior-roads-outlines","interior-roads","compare-route","shortcuts","shortcuts-focus","predict-impact",tp("Building"),"draw-area-lines","draw-area-preview","one-ways",tp("Road labels"),ep("road_label"),"animate-shortcuts","modal-filters","boundary","neighbourhood-boundary","border-arrows","border-arrow-outlines","auto-boundaries-areas","auto-boundaries-severances","freehand-line","edit-polygon-fill","edit-polygon-lines","edit-polygon-vertices"];function SS(r){return["interpolate",["linear"],["zoom"],5,.5+r,10,1+r,12,1.5+r,14,4+r,16,7+r,20,24+r]}function Qs(r){return r<1e3?Math.round(r)+"m":(r/1e3).toFixed(1)+"km"}function ea(r){if(r<60)return Math.round(r)+"s";let e=Math.floor(r/60),t=Math.round(r-e*60);return`${e}m${t}s`}function TS(r){let e;return{c(){e=Ve("Back")},m(t,i){ae(t,e,i)},d(t){t&&se(e)}}}function CS(r){let e,t,i,l;return e=new Ii({props:{$$slots:{default:[TS]},$$scope:{ctx:r}}}),e.$on("click",r[2]),{c(){Ie(e.$$.fragment)},m(u,d){Ee(e,u,d),t=!0,i||(l=St(window,"keydown",r[1]),i=!0)},p(u,[d]){const a={};d&8&&(a.$$scope={dirty:d,ctx:u}),e.$set(a)},i(u){t||(J(e.$$.fragment,u),t=!0)},o(u){ne(e.$$.fragment,u),t=!1},d(u){Me(e,u),i=!1,l()}}}function ES(r){let e=rs();function t(l){l.key=="Escape"&&(l.stopPropagation(),e("click"))}return[e,t,()=>e("click")]}class uc extends Vt{constructor(e){super(),Ut(this,e,ES,CS,zt,{})}}function Tp(r,e,t){let i=new Set(r.toSavefile().features.filter(l=>l.properties.kind=="boundary").map(l=>l.properties.name));for(;;){let l=window.prompt(e,t);if(!l)return null;if(i.has(l))window.alert(`There is already a neighbourhood called ${l}; please pick another name`);else return l}}function MS(r){let e;return{c(){e=Ve("Choose project")},m(t,i){ae(t,e,i)},d(t){t&&se(e)}}}function IS(r){let e;return{c(){e=Ve("Pick neighbourhood")},m(t,i){ae(t,e,i)},d(t){t&&se(e)}}}function LS(r){let e,t,i,l,u,d,a,_,v,k,S;return u=new Ii({props:{$$slots:{default:[MS]},$$scope:{ctx:r}}}),u.$on("click",r[10]),_=new Ii({props:{$$slots:{default:[IS]},$$scope:{ctx:r}}}),_.$on("click",r[11]),{c(){e=oe("div"),t=oe("nav"),i=oe("ul"),l=oe("li"),Ie(u.$$.fragment),d=Ae(),a=oe("li"),Ie(_.$$.fragment),v=Ae(),k=oe("li"),k.textContent="Use an auto-generated boundary",ke(t,"aria-label","breadcrumb"),ke(e,"slot","top")},m(E,A){ae(E,e,A),G(e,t),G(t,i),G(i,l),Ee(u,l,null),G(i,d),G(i,a),Ee(_,a,null),G(i,v),G(i,k),S=!0},p(E,A){const D={};A&32768&&(D.$$scope={dirty:A,ctx:E}),u.$set(D);const B={};A&32768&&(B.$$scope={dirty:A,ctx:E}),_.$set(B)},i(E){S||(J(u.$$.fragment,E),J(_.$$.fragment,E),S=!0)},o(E){ne(u.$$.fragment,E),ne(_.$$.fragment,E),S=!1},d(E){E&&se(e),Me(u),Me(_)}}}function AS(r){let e,t,i,l,u,d,a,_,v,k,S,E,A,D,B,P,R;return t=new uc({}),t.$on("click",r[7]),{c(){e=oe("div"),Ie(t.$$.fragment),i=Ae(),l=oe("p"),l.textContent=`Click an area to use it as a neighbourhood. These are generated by finding
      roads, railways, and water that form severances. There are many bugs; this
      is experimental. The colors are arbitrary, just to distinguish better.`,u=Ae(),d=oe("button"),d.textContent="Export to GeoJSON",a=Ae(),_=oe("label"),v=Ve(`Minimum area (kmÂ²)
      `),k=oe("input"),S=Ae(),E=oe("label"),A=oe("input"),D=Ve(`
      Remove areas not touching a big road`),ke(d,"class","secondary"),ke(k,"type","number"),ke(k,"min","0"),ke(k,"max","1"),ke(k,"step","0.01"),ke(A,"type","checkbox"),ke(e,"slot","sidebar")},m(F,j){ae(F,e,j),Ee(t,e,null),G(e,i),G(e,l),G(e,u),G(e,d),G(e,a),G(e,_),G(_,v),G(_,k),Pn(k,r[0]),G(e,S),G(e,E),G(E,A),A.checked=r[1],G(E,D),B=!0,P||(R=[St(d,"click",r[5]),St(k,"input",r[8]),St(A,"change",r[9])],P=!0)},p(F,j){j&1&&Ip(k.value)!==F[0]&&Pn(k,F[0]),j&2&&(A.checked=F[1])},i(F){B||(J(t.$$.fragment,F),B=!0)},o(F){ne(t.$$.fragment,F),B=!1},d(F){F&&se(e),Me(t),P=!1,hn(R)}}}function PS(r){let e,t,i=r[14].area_km2.toFixed(1)+"",l,u,d,a,_,v=r[14].touches_big_road+"",k,S,E=r[14].touches_railway+"",A,D,B=r[14].touches_waterway+"",P;return{c(){e=oe("p"),t=Ve("Area: "),l=Ve(i),u=Ve(" kmÂ²"),d=Ae(),a=oe("p"),_=Ve("Borders roads = "),k=Ve(v),S=Ve(", railway = "),A=Ve(E),D=Ve(`,
            water = `),P=Ve(B)},m(R,F){ae(R,e,F),G(e,t),G(e,l),G(e,u),ae(R,d,F),ae(R,a,F),G(a,_),G(a,k),G(a,S),G(a,A),G(a,D),G(a,P)},p(R,F){F&16384&&i!==(i=R[14].area_km2.toFixed(1)+"")&&si(l,i),F&16384&&v!==(v=R[14].touches_big_road+"")&&si(k,v),F&16384&&E!==(E=R[14].touches_railway+"")&&si(A,E),F&16384&&B!==(B=R[14].touches_waterway+"")&&si(P,B)},d(R){R&&(se(e),se(d),se(a))}}}function zS(r){let e,t;return e=new Zo({props:{openOn:"hover",$$slots:{default:[PS,({props:i})=>({14:i}),({props:i})=>i?16384:0]},$$scope:{ctx:r}}}),{c(){Ie(e.$$.fragment)},m(i,l){Ee(e,i,l),t=!0},p(i,l){const u={};l&49152&&(u.$$scope={dirty:l,ctx:i}),e.$set(u)},i(i){t||(J(e.$$.fragment,i),t=!0)},o(i){ne(e.$$.fragment,i),t=!1},d(i){Me(e,i)}}}function DS(r){let e,t,i,l;const u=[un("auto-boundaries-areas"),{filter:r[6](r[0],r[1])},{manageHoverState:!0},{paint:{"fill-color":["match",["%",["id"],5],0,"blue",1,"yellow",2,"green",3,"purple",4,"orange","black"],"fill-opacity":Na(.3,.7)}},{hoverCursor:"pointer"}];let d={$$slots:{default:[zS]},$$scope:{ctx:r}};for(let v=0;v<u.length;v+=1)d=rn(d,u[v]);e=new Es({props:d}),e.$on("click",r[4]);const a=[un("auto-boundaries-severances"),{filter:O4},{manageHoverState:!0},{paint:{"line-color":Na("black","red"),"line-width":3}}];let _={};for(let v=0;v<a.length;v+=1)_=rn(_,a[v]);return i=new Hr({props:_}),{c(){Ie(e.$$.fragment),t=Ae(),Ie(i.$$.fragment)},m(v,k){Ee(e,v,k),ae(v,t,k),Ee(i,v,k),l=!0},p(v,k){const S=k&67?nc(u,[u[0],{filter:v[6](v[0],v[1])},u[2],u[3],u[4]]):{};k&32768&&(S.$$scope={dirty:k,ctx:v}),e.$set(S);const E={};i.$set(E)},i(v){l||(J(e.$$.fragment,v),J(i.$$.fragment,v),l=!0)},o(v){ne(e.$$.fragment,v),ne(i.$$.fragment,v),l=!1},d(v){v&&se(t),Me(e,v),Me(i,v)}}}function RS(r){let e,t,i;return t=new ur({props:{data:r[3],generateId:!0,$$slots:{default:[DS]},$$scope:{ctx:r}}}),{c(){e=oe("div"),Ie(t.$$.fragment),ke(e,"slot","map")},m(l,u){ae(l,e,u),Ee(t,e,null),i=!0},p(l,u){const d={};u&32771&&(d.$$scope={dirty:u,ctx:l}),t.$set(d)},i(l){i||(J(t.$$.fragment,l),i=!0)},o(l){ne(t.$$.fragment,l),i=!1},d(l){l&&se(e),Me(t)}}}function BS(r){let e,t;return e=new Po({props:{$$slots:{map:[RS],sidebar:[AS],top:[LS]},$$scope:{ctx:r}}}),{c(){Ie(e.$$.fragment)},m(i,l){Ee(e,i,l),t=!0},p(i,[l]){const u={};l&32775&&(u.$$scope={dirty:l,ctx:i}),e.$set(u)},i(i){t||(J(e.$$.fragment,i),t=!0)},o(i){ne(e.$$.fragment,i),t=!1},d(i){Me(e,i)}}}function FS(r,e,t){let i,l,u;lt(r,Wt,R=>t(2,i=R)),lt(r,Fu,R=>t(12,l=R)),lt(r,Dn,R=>t(13,u=R));let d=u.renderAutoBoundaries(),a=0,_=!0;function v(R){let F=Tp(u,"What do you want to name the neighbourhood?","");if(F)try{let j={type:"Feature",properties:{},geometry:d.features[R.detail.features[0].id].geometry};u.setNeighbourhoodBoundary(F,j),oc(),u.setCurrentNeighbourhood(F,l),Tt(Wt,i={mode:"neighbourhood"},i)}catch(j){console.log(j),window.alert("Known georust bug hit, sorry. You may need to just refresh the page now.")}}function k(){vd("auto_boundaries.geojson",JSON.stringify(d,null,"  "))}function S(R,F){let j=["all",F4,[">=",["get","area_km2"],R]];return F&&j.push(["get","touches_big_road"]),j}const E=()=>Tt(Wt,i={mode:"network"},i);function A(){a=Ip(this.value),t(0,a)}function D(){_=this.checked,t(1,_)}return[a,_,i,d,v,k,S,E,A,D,()=>Tt(Wt,i={mode:"title",firstLoad:!1},i),()=>Tt(Wt,i={mode:"network"},i)]}class OS extends Vt{constructor(e){super(),Ut(this,e,FS,BS,zt,{})}}function NS(r){let e,t,i,l,u,d;const a=[un("cells"),{filter:["==",["get","kind"],"cell"]},{layout:{visibility:r[0]=="cells"?"none":"visible"}},{paint:{"fill-color":["get","color"],"fill-opacity":.8}}];let _={};for(let A=0;A<a.length;A+=1)_=rn(_,a[A]);e=new Es({props:_});const v=[un("border-arrows"),{filter:["==",["get","kind"],"border_arrow"]},{paint:{"fill-color":["get","color"]}}];let k={};for(let A=0;A<v.length;A+=1)k=rn(k,v[A]);i=new Es({props:k});const S=[un("border-arrow-outlines"),{filter:["==",["get","kind"],"border_arrow"]},{paint:{"line-color":"black","line-width":2}}];let E={};for(let A=0;A<S.length;A+=1)E=rn(E,S[A]);return u=new Hr({props:E}),{c(){Ie(e.$$.fragment),t=Ae(),Ie(i.$$.fragment),l=Ae(),Ie(u.$$.fragment)},m(A,D){Ee(e,A,D),ae(A,t,D),Ee(i,A,D),ae(A,l,D),Ee(u,A,D),d=!0},p(A,[D]){const B=D&1?nc(a,[a[0],a[1],{layout:{visibility:A[0]=="cells"?"none":"visible"}},a[3]]):{};e.$set(B);const P={};i.$set(P);const R={};u.$set(R)},i(A){d||(J(e.$$.fragment,A),J(i.$$.fragment,A),J(u.$$.fragment,A),d=!0)},o(A){ne(e.$$.fragment,A),ne(i.$$.fragment,A),ne(u.$$.fragment,A),d=!1},d(A){A&&(se(t),se(l)),Me(e,A),Me(i,A),Me(u,A)}}}function jS(r,e,t){let i;return lt(r,Sd,l=>t(0,i=l)),[i]}class Fd extends Vt{constructor(e){super(),Ut(this,e,jS,NS,zt,{})}}function US(r){let e,t;const i=[un("neighbourhood-boundary"),{filter:["==",["get","kind"],"boundary"]},{paint:{"fill-color":"black","fill-opacity":.3}}];let l={};for(let u=0;u<i.length;u+=1)l=rn(l,i[u]);return e=new Es({props:l}),{c(){Ie(e.$$.fragment)},m(u,d){Ee(e,u,d),t=!0},p(u,[d]){const a={};e.$set(a)},i(u){t||(J(e.$$.fragment,u),t=!0)},o(u){ne(e.$$.fragment,u),t=!1},d(u){Me(e,u)}}}class Od extends Vt{constructor(e){super(),Ut(this,e,null,US,zt,{})}}let Y0=["#8a9a5b","#ffc300","#cc5500","#c70039","#900c3f","#581845"],Q0=[20,30,40,50,60,70];const VS=r=>({}),ay=r=>({});function ly(r){let e;const t=r[7]["line-popup"],i=$i(t,r,r[9],ay);return{c(){i&&i.c()},m(l,u){i&&i.m(l,u),e=!0},p(l,u){i&&i.p&&(!e||u&512)&&Zi(i,t,l,l[9],e?qi(t,l[9],u,VS):Gi(l[9]),ay)},i(l){e||(J(i,l),e=!0)},o(l){ne(i,l),e=!1},d(l){i&&i.d(l)}}}function $S(r){let e,t,i=r[0]&&ly(r);return{c(){i&&i.c(),e=En()},m(l,u){i&&i.m(l,u),ae(l,e,u),t=!0},p(l,u){l[0]?i?(i.p(l,u),u&1&&J(i,1)):(i=ly(l),i.c(),J(i,1),i.m(e.parentNode,e)):i&&(yi(),ne(i,1,1,()=>{i=null}),vi())},i(l){t||(J(i),t=!0)},o(l){ne(i),t=!1},d(l){l&&se(e),i&&i.d(l)}}}function qS(r){let e,t,i,l;const u=[un("interior-roads-outlines"),{filter:["==",["get","kind"],"interior_road"]},{paint:{"line-width":r[6](r[2],r[4].maxShortcuts,0),"line-color":"black"}}];let d={};for(let v=0;v<u.length;v+=1)d=rn(d,u[v]);e=new Hr({props:d});const a=[un("interior-roads"),{filter:["==",["get","kind"],"interior_road"]},{paint:{"line-width":r[6](r[2],r[4].maxShortcuts,0),"line-color":r[5](r[3],r[4].maxShortcuts),"line-opacity":Na(1,.5)}},{manageHoverState:r[0]},{hoverCursor:r[0]?"pointer":void 0}];let _={$$slots:{default:[$S]},$$scope:{ctx:r}};for(let v=0;v<a.length;v+=1)_=rn(_,a[v]);return i=new Hr({props:_}),i.$on("click",r[8]),{c(){Ie(e.$$.fragment),t=Ae(),Ie(i.$$.fragment)},m(v,k){Ee(e,v,k),ae(v,t,k),Ee(i,v,k),l=!0},p(v,[k]){const S=k&84?nc(u,[u[0],u[1],{paint:{"line-width":v[6](v[2],v[4].maxShortcuts,0),"line-color":"black"}}]):{};e.$set(S);const E=k&125?nc(a,[a[0],a[1],k&124&&{paint:{"line-width":v[6](v[2],v[4].maxShortcuts,0),"line-color":v[5](v[3],v[4].maxShortcuts),"line-opacity":Na(1,.5)}},k&1&&{manageHoverState:v[0]},k&1&&{hoverCursor:v[0]?"pointer":void 0}]):{};k&513&&(E.$$scope={dirty:k,ctx:v}),i.$set(E)},i(v){l||(J(e.$$.fragment,v),J(i.$$.fragment,v),l=!0)},o(v){ne(e.$$.fragment,v),ne(i.$$.fragment,v),l=!1},d(v){v&&se(t),Me(e,v),Me(i,v)}}}function ZS(r,e,t){let i,l;lt(r,dp,A=>t(2,i=A)),lt(r,Sd,A=>t(3,l=A));let{$$slots:u={},$$scope:d}=e,a=Ld("neighbourhoodGj"),{interactive:_=!0}=e,{onClickLine:v=(A,D)=>{}}=e;function k(A,D){return A=="cells"?["get","color"]:A=="edits"?["case",["get","edited"],"grey","white"]:A=="speeds"?N4(["get","speed_mph"],Q0,Y0):D<=2?Na("white","blue"):Na(["interpolate-hcl",["linear"],["get","shortcuts"],0,"white",1,"#F19A93",D,"#A32015"],"blue")}function S(A,D,B){return!A||D<=2?SS(B):["interpolate",["linear"],["get","shortcuts"],0,5+B,D,25+B]}const E=A=>_&&v(A.detail.features[0],A.detail.event.lngLat);return r.$$set=A=>{"interactive"in A&&t(0,_=A.interactive),"onClickLine"in A&&t(1,v=A.onClickLine),"$$scope"in A&&t(9,d=A.$$scope)},[_,v,i,l,a,k,S,u,E,d]}class Xu extends Vt{constructor(e){super(),Ut(this,e,ZS,qS,zt,{interactive:0,onClickLine:1})}}function GS(r){let e;const t=r[3].default,i=$i(t,r,r[5],null);return{c(){i&&i.c()},m(l,u){i&&i.m(l,u),e=!0},p(l,u){i&&i.p&&(!e||u&32)&&Zi(i,t,l,l[5],e?qi(t,l[5],u,null):Gi(l[5]),null)},i(l){e||(J(i,l),e=!0)},o(l){ne(i,l),e=!1},d(l){i&&i.d(l)}}}function WS(r){let e,t;const i=[un("modal-filters"),{layout:{"icon-image":["get","filter_kind"],"icon-rotate":["get","angle"],"icon-allow-overlap":!0,"icon-size":.1}},{paint:{"icon-opacity":["case",["get","edited"],1,.5]}}];let l={$$slots:{default:[GS]},$$scope:{ctx:r}};for(let u=0;u<i.length;u+=1)l=rn(l,i[u]);return e=new D0({props:l}),e.$on("click",r[4]),{c(){Ie(e.$$.fragment)},m(u,d){Ee(e,u,d),t=!0},p(u,d){const a={};d&32&&(a.$$scope={dirty:d,ctx:u}),e.$set(a)},i(u){t||(J(e.$$.fragment,u),t=!0)},o(u){ne(e.$$.fragment,u),t=!1},d(u){Me(e,u)}}}function HS(r){let e,t;return e=new ur({props:{data:r[0],generateId:!0,$$slots:{default:[WS]},$$scope:{ctx:r}}}),{c(){Ie(e.$$.fragment)},m(i,l){Ee(e,i,l),t=!0},p(i,[l]){const u={};l&1&&(u.data=i[0]),l&32&&(u.$$scope={dirty:l,ctx:i}),e.$set(u)},i(i){t||(J(e.$$.fragment,i),t=!0)},o(i){ne(e.$$.fragment,i),t=!1},d(i){Me(e,i)}}}function XS(r,e,t){let i,l,u;lt(r,Dn,v=>t(1,l=v)),lt(r,bs,v=>t(2,u=v));let{$$slots:d={},$$scope:a}=e;function _(v){fi.call(this,r,v)}return r.$$set=v=>{"$$scope"in v&&t(5,a=v.$$scope)},r.$$.update=()=>{r.$$.dirty&6&&t(0,i=u>0?l.renderModalFilters():Ql())},[i,l,u,d,_,a]}class Va extends Vt{constructor(e){super(),Ut(this,e,XS,HS,zt,{})}}function KS(r){let e,t;const i=[un("one-ways"),{filter:["all",["==",["get","kind"],"interior_road"],["!=",["get","direction"],"both"]]},{layout:{"icon-image":"oneway-arrow","icon-size":1,"symbol-placement":"line","symbol-spacing":50,"icon-allow-overlap":!0,"icon-rotate":["case",["==",["get","direction"],"forwards"],0,180]}},{paint:{"icon-opacity":["case",["get","direction_edited"],1,.5]}},{interactive:!1},{hoverCursor:"pointer"}];let l={};for(let u=0;u<i.length;u+=1)l=rn(l,i[u]);return e=new D0({props:l}),{c(){Ie(e.$$.fragment)},m(u,d){Ee(e,u,d),t=!0},p(u,[d]){const a={};e.$set(a)},i(u){t||(J(e.$$.fragment,u),t=!0)},o(u){ne(e.$$.fragment,u),t=!1},d(u){Me(e,u)}}}class Nd extends Vt{constructor(e){super(),Ut(this,e,null,KS,zt,{})}}function JS(r){let e;const t=r[3].default,i=$i(t,r,r[4],null);return{c(){i&&i.c()},m(l,u){i&&i.m(l,u),e=!0},p(l,u){i&&i.p&&(!e||u&16)&&Zi(i,t,l,l[4],e?qi(t,l[4],u,null):Gi(l[4]),null)},i(l){e||(J(i,l),e=!0)},o(l){ne(i,l),e=!1},d(l){i&&i.d(l)}}}function YS(r){let e,t;return e=new ur({props:{data:r[0],generateId:!0,$$slots:{default:[JS]},$$scope:{ctx:r}}}),{c(){Ie(e.$$.fragment)},m(i,l){Ee(e,i,l),t=!0},p(i,[l]){const u={};l&1&&(u.data=i[0]),l&16&&(u.$$scope={dirty:l,ctx:i}),e.$set(u)},i(i){t||(J(e.$$.fragment,i),t=!0)},o(i){ne(e.$$.fragment,i),t=!1},d(i){Me(e,i)}}}function QS(r,e,t){let i,l;lt(r,Dn,_=>t(2,l=_));let{$$slots:u={},$$scope:d}=e,{input:a=null}=e;return r.$$set=_=>{"input"in _&&t(1,a=_.input),"$$scope"in _&&t(4,d=_.$$scope)},r.$$.update=()=>{r.$$.dirty&6&&t(0,i=a||l.renderNeighbourhood()),r.$$.dirty&1&&Id("neighbourhoodGj",i)},[i,a,l,u,d]}class Ku extends Vt{constructor(e){super(),Ut(this,e,QS,YS,zt,{input:1})}}function e3(r){let e;return{c(){e=Ve("Choose project")},m(t,i){ae(t,e,i)},d(t){t&&se(e)}}}function t3(r){let e;return{c(){e=Ve("Pick neighbourhood")},m(t,i){ae(t,e,i)},d(t){t&&se(e)}}}function i3(r){let e;return{c(){e=Ve("Editing")},m(t,i){ae(t,e,i)},d(t){t&&se(e)}}}function n3(r){let e,t,i,l,u,d,a,_,v,k,S,E,A,D;return u=new Ii({props:{$$slots:{default:[e3]},$$scope:{ctx:r}}}),u.$on("click",r[4]),_=new Ii({props:{$$slots:{default:[t3]},$$scope:{ctx:r}}}),_.$on("click",r[5]),S=new Ii({props:{$$slots:{default:[i3]},$$scope:{ctx:r}}}),S.$on("click",r[6]),{c(){e=oe("div"),t=oe("nav"),i=oe("ul"),l=oe("li"),Ie(u.$$.fragment),d=Ae(),a=oe("li"),Ie(_.$$.fragment),v=Ae(),k=oe("li"),Ie(S.$$.fragment),E=Ae(),A=oe("li"),A.textContent="Debug mode",ke(t,"aria-label","breadcrumb"),ke(e,"slot","top")},m(B,P){ae(B,e,P),G(e,t),G(t,i),G(i,l),Ee(u,l,null),G(i,d),G(i,a),Ee(_,a,null),G(i,v),G(i,k),Ee(S,k,null),G(i,E),G(i,A),D=!0},p(B,P){const R={};P&256&&(R.$$scope={dirty:P,ctx:B}),u.$set(R);const F={};P&256&&(F.$$scope={dirty:P,ctx:B}),_.$set(F);const j={};P&256&&(j.$$scope={dirty:P,ctx:B}),S.$set(j)},i(B){D||(J(u.$$.fragment,B),J(_.$$.fragment,B),J(S.$$.fragment,B),D=!0)},o(B){ne(u.$$.fragment,B),ne(_.$$.fragment,B),ne(S.$$.fragment,B),D=!1},d(B){B&&se(e),Me(u),Me(_),Me(S)}}}function r3(r){let e,t,i;return t=new uc({}),t.$on("click",r[3]),{c(){e=oe("div"),Ie(t.$$.fragment),ke(e,"slot","sidebar")},m(l,u){ae(l,e,u),Ee(t,e,null),i=!0},p:It,i(l){i||(J(t.$$.fragment,l),i=!0)},o(l){ne(t.$$.fragment,l),i=!1},d(l){l&&se(e),Me(t)}}}function o3(r){let e,t;return e=new Pd({props:{properties:r[7]}}),{c(){Ie(e.$$.fragment)},m(i,l){Ee(e,i,l),t=!0},p(i,l){const u={};l&128&&(u.properties=i[7]),e.$set(u)},i(i){t||(J(e.$$.fragment,i),t=!0)},o(i){ne(e.$$.fragment,i),t=!1},d(i){Me(e,i)}}}function s3(r){let e,t;return e=new Zo({props:{openOn:"hover",$$slots:{default:[o3,({props:i})=>({7:i}),({props:i})=>i?128:0]},$$scope:{ctx:r}}}),{c(){Ie(e.$$.fragment)},m(i,l){Ee(e,i,l),t=!0},p(i,l){const u={};l&384&&(u.$$scope={dirty:l,ctx:i}),e.$set(u)},i(i){t||(J(e.$$.fragment,i),t=!0)},o(i){ne(e.$$.fragment,i),t=!1},d(i){Me(e,i)}}}function a3(r){let e,t;return e=new Pd({props:{properties:r[7]}}),{c(){Ie(e.$$.fragment)},m(i,l){Ee(e,i,l),t=!0},p(i,l){const u={};l&128&&(u.properties=i[7]),e.$set(u)},i(i){t||(J(e.$$.fragment,i),t=!0)},o(i){ne(e.$$.fragment,i),t=!1},d(i){Me(e,i)}}}function l3(r){let e,t;return e=new Zo({props:{openOn:"hover",$$slots:{default:[a3,({props:i})=>({7:i}),({props:i})=>i?128:0]},$$scope:{ctx:r}}}),{c(){Ie(e.$$.fragment)},m(i,l){Ee(e,i,l),t=!0},p(i,l){const u={};l&384&&(u.$$scope={dirty:l,ctx:i}),e.$set(u)},i(i){t||(J(e.$$.fragment,i),t=!0)},o(i){ne(e.$$.fragment,i),t=!1},d(i){Me(e,i)}}}function c3(r){let e,t;return e=new Pd({props:{properties:r[7]}}),{c(){Ie(e.$$.fragment)},m(i,l){Ee(e,i,l),t=!0},p(i,l){const u={};l&128&&(u.properties=i[7]),e.$set(u)},i(i){t||(J(e.$$.fragment,i),t=!0)},o(i){ne(e.$$.fragment,i),t=!1},d(i){Me(e,i)}}}function u3(r){let e,t,i;return t=new Zo({props:{openOn:"hover",$$slots:{default:[c3,({props:l})=>({7:l}),({props:l})=>l?128:0]},$$scope:{ctx:r}}}),{c(){e=oe("div"),Ie(t.$$.fragment),ke(e,"slot","line-popup")},m(l,u){ae(l,e,u),Ee(t,e,null),i=!0},p(l,u){const d={};u&384&&(d.$$scope={dirty:u,ctx:l}),t.$set(d)},i(l){i||(J(t.$$.fragment,l),i=!0)},o(l){ne(t.$$.fragment,l),i=!1},d(l){l&&se(e),Me(t)}}}function h3(r){let e,t,i,l,u,d,a,_,v,k,S,E;e=new Od({}),i=new Fd({}),u=new Nd({});const A=[un("debug-borders"),{filter:["==",["get","kind"],"border_intersection"]},{paint:{"circle-radius":15,"circle-color":"green"}}];let D={$$slots:{default:[s3]},$$scope:{ctx:r}};for(let R=0;R<A.length;R+=1)D=rn(D,A[R]);a=new jp({props:D});const B=[un("debug-crosses"),{filter:["==",["get","kind"],"crosses"]},{paint:{"line-width":5,"line-color":"blue"}}];let P={$$slots:{default:[l3]},$$scope:{ctx:r}};for(let R=0;R<B.length;R+=1)P=rn(P,B[R]);return v=new Hr({props:P}),S=new Xu({props:{interactive:!0,onClickLine:r[2],$$slots:{"line-popup":[u3]},$$scope:{ctx:r}}}),{c(){Ie(e.$$.fragment),t=Ae(),Ie(i.$$.fragment),l=Ae(),Ie(u.$$.fragment),d=Ae(),Ie(a.$$.fragment),_=Ae(),Ie(v.$$.fragment),k=Ae(),Ie(S.$$.fragment)},m(R,F){Ee(e,R,F),ae(R,t,F),Ee(i,R,F),ae(R,l,F),Ee(u,R,F),ae(R,d,F),Ee(a,R,F),ae(R,_,F),Ee(v,R,F),ae(R,k,F),Ee(S,R,F),E=!0},p(R,F){const j={};F&256&&(j.$$scope={dirty:F,ctx:R}),a.$set(j);const U={};F&256&&(U.$$scope={dirty:F,ctx:R}),v.$set(U);const le={};F&256&&(le.$$scope={dirty:F,ctx:R}),S.$set(le)},i(R){E||(J(e.$$.fragment,R),J(i.$$.fragment,R),J(u.$$.fragment,R),J(a.$$.fragment,R),J(v.$$.fragment,R),J(S.$$.fragment,R),E=!0)},o(R){ne(e.$$.fragment,R),ne(i.$$.fragment,R),ne(u.$$.fragment,R),ne(a.$$.fragment,R),ne(v.$$.fragment,R),ne(S.$$.fragment,R),E=!1},d(R){R&&(se(t),se(l),se(d),se(_),se(k)),Me(e,R),Me(i,R),Me(u,R),Me(a,R),Me(v,R),Me(S,R)}}}function d3(r){let e,t;return e=new Pd({props:{properties:r[7]}}),{c(){Ie(e.$$.fragment)},m(i,l){Ee(e,i,l),t=!0},p(i,l){const u={};l&128&&(u.properties=i[7]),e.$set(u)},i(i){t||(J(e.$$.fragment,i),t=!0)},o(i){ne(e.$$.fragment,i),t=!1},d(i){Me(e,i)}}}function f3(r){let e,t;return e=new Zo({props:{openOn:"hover",$$slots:{default:[d3,({props:i})=>({7:i}),({props:i})=>i?128:0]},$$scope:{ctx:r}}}),{c(){Ie(e.$$.fragment)},m(i,l){Ee(e,i,l),t=!0},p(i,l){const u={};l&384&&(u.$$scope={dirty:l,ctx:i}),e.$set(u)},i(i){t||(J(e.$$.fragment,i),t=!0)},o(i){ne(e.$$.fragment,i),t=!1},d(i){Me(e,i)}}}function p3(r){let e,t;const i=[un("debug-filters"),{paint:{"circle-radius":15,"circle-color":"black"}}];let l={$$slots:{default:[f3]},$$scope:{ctx:r}};for(let u=0;u<i.length;u+=1)l=rn(l,i[u]);return e=new jp({props:l}),{c(){Ie(e.$$.fragment)},m(u,d){Ee(e,u,d),t=!0},p(u,d){const a={};d&256&&(a.$$scope={dirty:d,ctx:u}),e.$set(a)},i(u){t||(J(e.$$.fragment,u),t=!0)},o(u){ne(e.$$.fragment,u),t=!1},d(u){Me(e,u)}}}function m3(r){let e,t,i,l,u;return t=new Ku({props:{$$slots:{default:[h3]},$$scope:{ctx:r}}}),l=new ur({props:{data:vr(r[0]).renderModalFilters(),generateId:!0,$$slots:{default:[p3]},$$scope:{ctx:r}}}),{c(){e=oe("div"),Ie(t.$$.fragment),i=Ae(),Ie(l.$$.fragment),ke(e,"slot","map")},m(d,a){ae(d,e,a),Ee(t,e,null),G(e,i),Ee(l,e,null),u=!0},p(d,a){const _={};a&256&&(_.$$scope={dirty:a,ctx:d}),t.$set(_);const v={};a&1&&(v.data=vr(d[0]).renderModalFilters()),a&256&&(v.$$scope={dirty:a,ctx:d}),l.$set(v)},i(d){u||(J(t.$$.fragment,d),J(l.$$.fragment,d),u=!0)},o(d){ne(t.$$.fragment,d),ne(l.$$.fragment,d),u=!1},d(d){d&&se(e),Me(t),Me(l)}}}function g3(r){let e,t;return e=new Po({props:{$$slots:{map:[m3],sidebar:[r3],top:[n3]},$$scope:{ctx:r}}}),{c(){Ie(e.$$.fragment)},m(i,l){Ee(e,i,l),t=!0},p(i,[l]){const u={};l&259&&(u.$$scope={dirty:l,ctx:i}),e.$set(u)},i(i){t||(J(e.$$.fragment,i),t=!0)},o(i){ne(e.$$.fragment,i),t=!1},d(i){Me(e,i)}}}function _3(r,e,t){let i,l;return lt(r,Dn,k=>t(0,i=k)),lt(r,Wt,k=>t(1,l=k)),[i,l,(k,S)=>window.open(vr(k.properties).way,"_blank"),()=>Tt(Wt,l={mode:"neighbourhood"},l),()=>Tt(Wt,l={mode:"title",firstLoad:!1},l),()=>Tt(Wt,l={mode:"network"},l),()=>Tt(Wt,l={mode:"neighbourhood"},l)]}class y3 extends Vt{constructor(e){super(),Ut(this,e,_3,g3,zt,{})}}var fo=63710088e-1,e1={centimeters:fo*100,centimetres:fo*100,degrees:360/(2*Math.PI),feet:fo*3.28084,inches:fo*39.37,kilometers:fo/1e3,kilometres:fo/1e3,meters:fo,metres:fo,miles:fo/1609.344,millimeters:fo*1e3,millimetres:fo*1e3,nauticalmiles:fo/1852,radians:1,yards:fo*1.0936};function v3(r,e,t={}){const i={type:"Feature"};return(t.id===0||t.id)&&(i.id=t.id),t.bbox&&(i.bbox=t.bbox),i.properties=e||{},i.geometry=r,i}function Cp(r,e,t={}){if(!r)throw new Error("coordinates is required");if(!Array.isArray(r))throw new Error("coordinates must be an Array");if(r.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!cy(r[0])||!cy(r[1]))throw new Error("coordinates must contain numbers");return v3({type:"Point",coordinates:r},e,t)}function b3(r,e="kilometers"){const t=e1[e];if(!t)throw new Error(e+" units is invalid");return r*t}function w3(r,e="kilometers"){const t=e1[e];if(!t)throw new Error(e+" units is invalid");return r/t}function Ep(r){return r%(2*Math.PI)*180/Math.PI}function Uo(r){return r%360*Math.PI/180}function cy(r){return!isNaN(r)&&r!==null&&!Array.isArray(r)}function $u(r){if(!r)throw new Error("coord is required");if(!Array.isArray(r)){if(r.type==="Feature"&&r.geometry!==null&&r.geometry.type==="Point")return[...r.geometry.coordinates];if(r.type==="Point")return[...r.coordinates]}if(Array.isArray(r)&&r.length>=2&&!Array.isArray(r[0])&&!Array.isArray(r[1]))return[...r];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function x3(r){return r.type==="Feature"?r.geometry:r}function t1(r,e,t={}){if(t.final===!0)return k3(r,e);const i=$u(r),l=$u(e),u=Uo(i[0]),d=Uo(l[0]),a=Uo(i[1]),_=Uo(l[1]),v=Math.sin(d-u)*Math.cos(_),k=Math.cos(a)*Math.sin(_)-Math.sin(a)*Math.cos(_)*Math.cos(d-u);return Ep(Math.atan2(v,k))}function k3(r,e){let t=t1(e,r);return t=(t+180)%360,t}function S3(r,e,t,i={}){const l=$u(r),u=Uo(l[0]),d=Uo(l[1]),a=Uo(t),_=w3(e,i.units),v=Math.asin(Math.sin(d)*Math.cos(_)+Math.cos(d)*Math.sin(_)*Math.cos(a)),k=u+Math.atan2(Math.sin(a)*Math.sin(_)*Math.cos(d),Math.cos(_)-Math.sin(d)*Math.sin(v)),S=Ep(k),E=Ep(v);return Cp([S,E],i.properties)}function T3(r,e,t={}){var i=$u(r),l=$u(e),u=Uo(l[1]-i[1]),d=Uo(l[0]-i[0]),a=Uo(i[1]),_=Uo(l[1]),v=Math.pow(Math.sin(u/2),2)+Math.pow(Math.sin(d/2),2)*Math.cos(a)*Math.cos(_);return b3(2*Math.atan2(Math.sqrt(v),Math.sqrt(1-v)),t.units)}function C3(r,e,t={}){const l=x3(r).coordinates;let u=0;for(let d=0;d<l.length&&!(e>=u&&d===l.length-1);d++)if(u>=e){const a=e-u;if(a){const _=t1(l[d],l[d-1])-180;return S3(l[d],a,_,t)}else return Cp(l[d])}else u+=T3(l[d],l[d+1],t);return Cp(l[l.length-1])}var E3=C3;function M3(r){let e,t;const i=[un("animate-shortcuts"),{paint:{"circle-radius":10,"circle-color":"purple","circle-stroke-color":"black","circle-stroke-width":1}}];let l={};for(let u=0;u<i.length;u+=1)l=rn(l,i[u]);return e=new jp({props:l}),{c(){Ie(e.$$.fragment)},m(u,d){Ee(e,u,d),t=!0},p(u,d){const a={};e.$set(a)},i(u){t||(J(e.$$.fragment,u),t=!0)},o(u){ne(e.$$.fragment,u),t=!1},d(u){Me(e,u)}}}function I3(r){let e,t;return e=new ur({props:{data:r[0],$$slots:{default:[M3]},$$scope:{ctx:r}}}),{c(){Ie(e.$$.fragment)},m(i,l){Ee(e,i,l),t=!0},p(i,[l]){const u={};l&1&&(u.data=i[0]),l&1024&&(u.$$scope={dirty:l,ctx:i}),e.$set(u)},i(i){t||(J(e.$$.fragment,i),t=!0)},o(i){ne(e.$$.fragment,i),t=!1},d(i){Me(e,i)}}}let L3=50,A3=100,P3=.01;function z3(r,e,t){let{paths:i}=e,l=_(),u=v(),d=S(),a=setInterval(E,A3);er(()=>clearInterval(a));function _(){return i.features.map(A=>1/A.properties.directness).reduce((A,D)=>A+D,0)}function v(){return i.features.length==0?[]:Array.from({length:L3},k)}function k(){let A=Math.random()*l,D=0;for(let[B,P]of i.features.entries())if(D+=1/P.properties.directness,A<D)return{idx:B,distance:0};throw new Error(`didnt pick dot, totalDirectness is ${l}`)}function S(){return{type:"FeatureCollection",features:u.map(({idx:A,distance:D})=>E3(i.features[A],D,{units:"kilometers"}))}}function E(){for(let[A,D]of u.entries())D.distance+=P3,D.distance>=i.features[D.idx].properties.length_meters/1e3&&(u[A]=k());t(0,d=S())}return r.$$set=A=>{"paths"in A&&t(1,i=A.paths)},r.$$.update=()=>{r.$$.dirty&2&&i&&(l=_(),u=v())},[d,i]}class D3 extends Vt{constructor(e){super(),Ut(this,e,z3,I3,zt,{paths:1})}}function uy(r,e,t){const i=r.slice();return i[7]=e[t][0],i[8]=e[t][1],i[9]=e[t][2],i}function hy(r){let e,t,i,l,u,d,a=r[8]+"",_,v,k,S,E;function A(){return r[3](r[7])}return{c(){e=oe("button"),t=oe("img"),l=Ae(),u=oe("br"),d=Ae(),_=Ve(a),v=Ae(),zn(t.src,i=`/ltn//filters/${r[7]}_icon.gif`)||ke(t,"src",i),ke(t,"width","80"),ke(t,"alt",r[8]),ke(e,"class","outline"),Ai(e,"width","100%"),e.disabled=k=r[0]==r[7]},m(D,B){ae(D,e,B),G(e,t),G(e,l),G(e,u),G(e,d),G(e,_),G(e,v),S||(E=St(e,"click",A),S=!0)},p(D,B){r=D,B&1&&k!==(k=r[0]==r[7])&&(e.disabled=k)},d(D){D&&se(e),S=!1,E()}}}function R3(r){let e,t,i,l,u,d,a,_,v,k,S,E,A=r[1][2]+"",D,B,P,R,F,j,U=Tn(r[2]),le=[];for(let Z=0;Z<U.length;Z+=1)le[Z]=hy(uy(r,U,Z));function he(){return r[4](r[6])}return{c(){e=oe("h3"),e.textContent="Choose a modal filter to place on streets",t=Ae(),i=oe("table"),l=oe("tr"),u=oe("td");for(let Z=0;Z<le.length;Z+=1)le[Z].c();d=Ae(),a=oe("td"),_=oe("img"),S=Ae(),E=oe("p"),D=Ve(A),B=Ae(),P=oe("center"),R=oe("button"),R.textContent="Confirm",zn(_.src,v=`/ltn//filters/${r[0]}.gif`)||ke(_,"src",v),ke(_,"height","300"),ke(_,"alt",k=r[1][1])},m(Z,Q){ae(Z,e,Q),ae(Z,t,Q),ae(Z,i,Q),G(i,l),G(l,u);for(let ye=0;ye<le.length;ye+=1)le[ye]&&le[ye].m(u,null);G(l,d),G(l,a),G(a,_),G(a,S),G(a,E),G(E,D),ae(Z,B,Q),ae(Z,P,Q),G(P,R),F||(j=St(R,"click",he),F=!0)},p(Z,Q){if(r=Z,Q&5){U=Tn(r[2]);let ye;for(ye=0;ye<U.length;ye+=1){const Ne=uy(r,U,ye);le[ye]?le[ye].p(Ne,Q):(le[ye]=hy(Ne),le[ye].c(),le[ye].m(u,null))}for(;ye<le.length;ye+=1)le[ye].d(1);le.length=U.length}Q&1&&!zn(_.src,v=`/ltn//filters/${r[0]}.gif`)&&ke(_,"src",v),Q&2&&k!==(k=r[1][1])&&ke(_,"alt",k),Q&2&&A!==(A=r[1][2]+"")&&si(D,A)},d(Z){Z&&(se(e),se(t),se(i),se(B),se(P)),$o(le,Z),F=!1,j()}}}function B3(r){let e,t;return e=new Ad({props:{$$slots:{default:[R3,({dialog:i})=>({6:i}),({dialog:i})=>i?64:0]},$$scope:{ctx:r}}}),e.$on("close",r[5]),{c(){Ie(e.$$.fragment)},m(i,l){Ee(e,i,l),t=!0},p(i,[l]){const u={};l&4163&&(u.$$scope={dirty:l,ctx:i}),e.$set(u)},i(i){t||(J(e.$$.fragment,i),t=!0)},o(i){ne(e.$$.fragment,i),t=!1},d(i){Me(e,i)}}}function F3(r,e,t){let i,l;lt(r,hp,v=>t(0,l=v));let u=[["walk_cycle_only","Walking/cycling only","A physical barrier that only allows people walking, cycling, and rolling to pass. Often planters or bollards. Larger vehicles cannot enter."],["no_entry","No entry","An alternative sign to indicate vehicles are not allowed to enter the street. Only people walking, cycling, and rolling may pass through."],["bus_gate","Bus gate","A bus gate sign and traffic cameras are installed to allow buses, pedestrians, and cyclists to pass. There is no physical barrier."],["school_street","School street","A closure during school hours only. The barrier usually allows teachers and staff to access the school."]];const d=v=>Tt(hp,l=v,l),a=v=>vr(v).close();function _(v){fi.call(this,r,v)}return r.$$.update=()=>{r.$$.dirty&1&&t(1,i=u.find(v=>v[0]==l))},[l,i,u,d,a,_]}class O3 extends Vt{constructor(e){super(),Ut(this,e,F3,B3,zt,{})}}function dy(r){let e,t;return e=new ur({props:{data:r[0],$$slots:{default:[N3]},$$scope:{ctx:r}}}),{c(){Ie(e.$$.fragment)},m(i,l){Ee(e,i,l),t=!0},p(i,l){const u={};l&1&&(u.data=i[0]),l&64&&(u.$$scope={dirty:l,ctx:i}),e.$set(u)},i(i){t||(J(e.$$.fragment,i),t=!0)},o(i){ne(e.$$.fragment,i),t=!1},d(i){Me(e,i)}}}function N3(r){let e,t;const i=[un("freehand-line"),{paint:{"line-width":5,"line-color":"red"}}];let l={};for(let u=0;u<i.length;u+=1)l=rn(l,i[u]);return e=new Hr({props:l}),{c(){Ie(e.$$.fragment)},m(u,d){Ee(e,u,d),t=!0},p(u,d){const a={};e.$set(a)},i(u){t||(J(e.$$.fragment,u),t=!0)},o(u){ne(e.$$.fragment,u),t=!1},d(u){Me(e,u)}}}function j3(r){let e,t,i=r[0]&&dy(r);return{c(){i&&i.c(),e=En()},m(l,u){i&&i.m(l,u),ae(l,e,u),t=!0},p(l,[u]){l[0]?i?(i.p(l,u),u&1&&J(i,1)):(i=dy(l),i.c(),J(i,1),i.m(e.parentNode,e)):i&&(yi(),ne(i,1,1,()=>{i=null}),vi())},i(l){t||(J(i),t=!0)},o(l){ne(i),t=!1},d(l){l&&se(e),i&&i.d(l)}}}function U3(r,e,t){let{map:i}=e,l=null;const u=rs();i.on("dragstart",d),i.on("mousemove",a),i.on("mouseup",_),er(()=>{i.dragPan.enable(),i.off("dragstart",d),i.off("mousemove",a),i.off("mouseup",_)});function d(){i.dragPan.disable(),t(0,l={type:"Feature",properties:{},geometry:{type:"LineString",coordinates:[]}})}function a(v){l&&(l.geometry.coordinates.push(v.lngLat.toArray()),t(0,l))}function _(){l&&(u("done",l),t(0,l=null))}return r.$$set=v=>{"map"in v&&t(1,i=v.map)},[l,i]}class V3 extends Vt{constructor(e){super(),Ut(this,e,U3,j3,zt,{map:1})}}function $3(r){let e;return{c(){e=Ve("Choose project")},m(t,i){ae(t,e,i)},d(t){t&&se(e)}}}function q3(r){let e;return{c(){e=Ve("Pick neighbourhood")},m(t,i){ae(t,e,i)},d(t){t&&se(e)}}}function Z3(r){let e;return{c(){e=oe("p"),e.textContent=`Now that you've defined a neighbourhood boundary, you can see the
              possible shortcuts that vehicles are currently able to take
              through it. You can add a new modal filter to try and solve this.
              The colored "cell" areas show what's reachable for drivers without
              leaving the boundary you've drawn.`},m(t,i){ae(t,e,i)},p:It,d(t){t&&se(e)}}}function G3(r){let e;return{c(){e=Ve("View shortcuts")},m(t,i){ae(t,e,i)},d(t){t&&se(e)}}}function W3(r){let e;return{c(){e=Ve("Route")},m(t,i){ae(t,e,i)},d(t){t&&se(e)}}}function H3(r){let e;return{c(){e=Ve("Impact routing to one destination")},m(t,i){ae(t,e,i)},d(t){t&&se(e)}}}function X3(r){let e;return{c(){e=Ve("Change this boundary")},m(t,i){ae(t,e,i)},d(t){t&&se(e)}}}function K3(r){let e;return{c(){e=Ve("Debug")},m(t,i){ae(t,e,i)},d(t){t&&se(e)}}}function J3(r){let e,t,i,l,u,d,a,_,v,k,S,E,A,D,B,P,R,F,j,U,le,he,Z,Q,ye,Ne,re,ve,Ke,Le;return u=new Ii({props:{$$slots:{default:[$3]},$$scope:{ctx:r}}}),u.$on("click",r[30]),_=new Ii({props:{$$slots:{default:[q3]},$$scope:{ctx:r}}}),_.$on("click",r[31]),E=new Wp({props:{$$slots:{default:[Z3]},$$scope:{ctx:r}}}),R=new Ii({props:{$$slots:{default:[G3]},$$scope:{ctx:r}}}),R.$on("click",r[32]),U=new Ii({props:{$$slots:{default:[W3]},$$scope:{ctx:r}}}),U.$on("click",r[33]),Z=new Ii({props:{$$slots:{default:[H3]},$$scope:{ctx:r}}}),Z.$on("click",r[34]),Ne=new Ii({props:{$$slots:{default:[X3]},$$scope:{ctx:r}}}),Ne.$on("click",r[35]),Ke=new Ii({props:{$$slots:{default:[K3]},$$scope:{ctx:r}}}),Ke.$on("click",r[36]),{c(){e=oe("div"),t=oe("nav"),i=oe("ul"),l=oe("li"),Ie(u.$$.fragment),d=Ae(),a=oe("li"),Ie(_.$$.fragment),v=Ae(),k=oe("li"),S=Ve(`Editing
          `),Ie(E.$$.fragment),A=Ae(),D=oe("nav"),B=oe("ul"),P=oe("li"),Ie(R.$$.fragment),F=Ae(),j=oe("li"),Ie(U.$$.fragment),le=Ae(),he=oe("li"),Ie(Z.$$.fragment),Q=Ae(),ye=oe("li"),Ie(Ne.$$.fragment),re=Ae(),ve=oe("li"),Ie(Ke.$$.fragment),ke(t,"aria-label","breadcrumb"),ke(e,"slot","top"),Ai(e,"display","flex"),Ai(e,"justify-content","space-between")},m(et,xt){ae(et,e,xt),G(e,t),G(t,i),G(i,l),Ee(u,l,null),G(i,d),G(i,a),Ee(_,a,null),G(i,v),G(i,k),G(k,S),Ee(E,k,null),G(e,A),G(e,D),G(D,B),G(B,P),Ee(R,P,null),G(B,F),G(B,j),Ee(U,j,null),G(B,le),G(B,he),Ee(Z,he,null),G(B,Q),G(B,ye),Ee(Ne,ye,null),G(B,re),G(B,ve),Ee(Ke,ve,null),Le=!0},p(et,xt){const mt={};xt[1]&512&&(mt.$$scope={dirty:xt,ctx:et}),u.$set(mt);const at={};xt[1]&512&&(at.$$scope={dirty:xt,ctx:et}),_.$set(at);const Ht={};xt[1]&512&&(Ht.$$scope={dirty:xt,ctx:et}),E.$set(Ht);const ri={};xt[1]&512&&(ri.$$scope={dirty:xt,ctx:et}),R.$set(ri);const Nt={};xt[1]&512&&(Nt.$$scope={dirty:xt,ctx:et}),U.$set(Nt);const At={};xt[1]&512&&(At.$$scope={dirty:xt,ctx:et}),Z.$set(At);const ei={};xt[1]&512&&(ei.$$scope={dirty:xt,ctx:et}),Ne.$set(ei);const ci={};xt[1]&512&&(ci.$$scope={dirty:xt,ctx:et}),Ke.$set(ci)},i(et){Le||(J(u.$$.fragment,et),J(_.$$.fragment,et),J(E.$$.fragment,et),J(R.$$.fragment,et),J(U.$$.fragment,et),J(Z.$$.fragment,et),J(Ne.$$.fragment,et),J(Ke.$$.fragment,et),Le=!0)},o(et){ne(u.$$.fragment,et),ne(_.$$.fragment,et),ne(E.$$.fragment,et),ne(R.$$.fragment,et),ne(U.$$.fragment,et),ne(Z.$$.fragment,et),ne(Ne.$$.fragment,et),ne(Ke.$$.fragment,et),Le=!1},d(et){et&&se(e),Me(u),Me(_),Me(E),Me(R),Me(U),Me(Z),Me(Ne),Me(Ke)}}}function fy(r){let e;return{c(){e=oe("mark"),e.textContent=`Some parts of the neighbourhood aren't reachable by drivers, shown in
        red`},m(t,i){ae(t,e,i)},d(t){t&&se(e)}}}function py(r){let e,t;return e=new Lb({props:{colorScale:Y0,limits:Q0}}),{c(){Ie(e.$$.fragment)},m(i,l){Ee(e,i,l),t=!0},i(i){t||(J(e.$$.fragment,i),t=!0)},o(i){ne(e.$$.fragment,i),t=!1},d(i){Me(e,i)}}}function Y3(r){let e,t,i;return{c(){e=Ve("Undo ("),t=Ve(r[4]),i=Ve(")")},m(l,u){ae(l,e,u),ae(l,t,u),ae(l,i,u)},p(l,u){u[0]&16&&si(t,l[4])},d(l){l&&(se(e),se(t),se(i))}}}function Q3(r){let e;return{c(){e=Ve("Undo")},m(t,i){ae(t,e,i)},p:It,d(t){t&&se(e)}}}function eT(r){let e,t,i;return{c(){e=Ve("Redo ("),t=Ve(r[5]),i=Ve(")")},m(l,u){ae(l,e,u),ae(l,t,u),ae(l,i,u)},p(l,u){u[0]&32&&si(t,l[5])},d(l){l&&(se(e),se(t),se(i))}}}function tT(r){let e;return{c(){e=Ve("Redo")},m(t,i){ae(t,e,i)},p:It,d(t){t&&se(e)}}}function my(r){let e,t;return e=new O3({}),e.$on("close",r[29]),{c(){Ie(e.$$.fragment)},m(i,l){Ee(e,i,l),t=!0},p:It,i(i){t||(J(e.$$.fragment,i),t=!0)},o(i){ne(e.$$.fragment,i),t=!1},d(i){Me(e,i)}}}function iT(r){let e,t,i,l,u=vr(r[6]).properties.name+"",d,a,_=r[1].area_km2.toFixed(1)+"",v,k,S,E,A,D,B,P,R,F,j,U,le,he,Z,Q,ye,Ne,re,ve,Ke,Le,et,xt,mt,at,Ht,ri,Nt,At,ei,ci,ti,ft,Jt,gi,zi,Fi,ut,Dt,Fe,je,ht,vt,we,Ei,qe,Ye,Ot,Pi=r[8]>0&&fy(),bi=r[12]=="speeds"&&py();function gn(Yt,Ni){return Yt[4]==0?Q3:Y3}let Mn=gn(r),Qi=Mn(r);function io(Yt,Ni){return Yt[5]==0?tT:eT}let Oi=io(r),nt=Oi(r),Mi=r[3]&&my(r);return{c(){e=oe("div"),t=oe("p"),i=Ve("Editing neighbourhood "),l=oe("u"),d=Ve(u),a=Ve(`
      , with an area of `),v=Ve(_),k=Ve(" kmÂ²"),S=Ae(),Pi&&Pi.c(),E=Ae(),A=oe("div"),D=oe("button"),B=oe("img"),R=Ve(`
        Add a modal filter`),j=Ae(),U=oe("button"),le=Ve("Add many modal filters along line"),Z=Ae(),Q=oe("button"),ye=Ve("Reverse directions"),re=Ae(),ve=oe("button"),ve.textContent="Change modal filter type",Ke=Ae(),Le=oe("label"),et=oe("input"),xt=Ve(`
      Animate shortcuts`),mt=Ae(),at=oe("label"),Ht=oe("input"),ri=Ve(`
      Include perimeter roads`),Nt=Ae(),At=oe("div"),ei=oe("label"),ci=Ve(`Draw roads:
        `),ti=oe("select"),ft=oe("option"),ft.textContent="Worst shortcuts",Jt=oe("option"),Jt.textContent="Cell",gi=oe("option"),gi.textContent="Edits (either filter or direction)",zi=oe("option"),zi.textContent="Speed limit",Fi=Ae(),bi&&bi.c(),ut=Ae(),Dt=oe("div"),Fe=oe("button"),Qi.c(),ht=Ae(),vt=oe("button"),nt.c(),Ei=Ae(),Mi&&Mi.c(),zn(B.src,P=`/ltn//filters/${r[9]}_icon.gif`)||ke(B,"src",P),ke(B,"width","30"),ke(B,"alt","Add a modal filter"),D.disabled=F=r[0]=="filter",ke(D,"data-tooltip","hotkey 1"),U.disabled=he=r[0]=="freehand-filters",ke(U,"data-tooltip","hotkey 2"),Q.disabled=Ne=r[0]=="oneway",ke(Q,"data-tooltip","hotkey 3"),Ai(A,"display","flex"),Ai(A,"justify-content","space-between"),ke(et,"type","checkbox"),ke(Ht,"type","checkbox"),ft.__value="shortcuts",Pn(ft,ft.__value),Jt.__value="cells",Pn(Jt,Jt.__value),gi.__value="edits",Pn(gi,gi.__value),zi.__value="speeds",Pn(zi,zi.__value),r[12]===void 0&&ic(()=>r[28].call(ti)),Ai(At,"border","1px solid black"),Ai(At,"padding","4px"),Fe.disabled=je=r[4]==0,ke(Fe,"data-tooltip","Ctrl+Z"),vt.disabled=we=r[5]==0,ke(vt,"data-tooltip","Ctrl+Y"),Ai(Dt,"display","flex"),Ai(Dt,"justify-content","space-between"),ke(e,"slot","sidebar")},m(Yt,Ni){ae(Yt,e,Ni),G(e,t),G(t,i),G(t,l),G(l,d),G(t,a),G(t,v),G(t,k),G(e,S),Pi&&Pi.m(e,null),G(e,E),G(e,A),G(A,D),G(D,B),G(D,R),G(A,j),G(A,U),G(U,le),G(A,Z),G(A,Q),G(Q,ye),G(e,re),G(e,ve),G(e,Ke),G(e,Le),G(Le,et),et.checked=r[11],G(Le,xt),G(e,mt),G(e,at),G(at,Ht),Ht.checked=r[10],G(at,ri),G(e,Nt),G(e,At),G(At,ei),G(ei,ci),G(ei,ti),G(ti,ft),G(ti,Jt),G(ti,gi),G(ti,zi),tc(ti,r[12],!0),G(At,Fi),bi&&bi.m(At,null),G(e,ut),G(e,Dt),G(Dt,Fe),Qi.m(Fe,null),G(Dt,ht),G(Dt,vt),nt.m(vt,null),G(e,Ei),Mi&&Mi.m(e,null),qe=!0,Ye||(Ot=[St(D,"click",r[22]),St(U,"click",r[23]),St(Q,"click",r[24]),St(ve,"click",r[25]),St(et,"change",r[26]),St(Ht,"change",r[27]),St(Ht,"change",r[14]),St(ti,"change",r[28]),St(Fe,"click",r[18]),St(vt,"click",r[19])],Ye=!0)},p(Yt,Ni){(!qe||Ni[0]&64)&&u!==(u=vr(Yt[6]).properties.name+"")&&si(d,u),(!qe||Ni[0]&2)&&_!==(_=Yt[1].area_km2.toFixed(1)+"")&&si(v,_),Yt[8]>0?Pi||(Pi=fy(),Pi.c(),Pi.m(e,E)):Pi&&(Pi.d(1),Pi=null),(!qe||Ni[0]&512&&!zn(B.src,P=`/ltn//filters/${Yt[9]}_icon.gif`))&&ke(B,"src",P),(!qe||Ni[0]&1&&F!==(F=Yt[0]=="filter"))&&(D.disabled=F),(!qe||Ni[0]&1&&he!==(he=Yt[0]=="freehand-filters"))&&(U.disabled=he),(!qe||Ni[0]&1&&Ne!==(Ne=Yt[0]=="oneway"))&&(Q.disabled=Ne),Ni[0]&2048&&(et.checked=Yt[11]),Ni[0]&1024&&(Ht.checked=Yt[10]),Ni[0]&4096&&tc(ti,Yt[12]),Yt[12]=="speeds"?bi?Ni[0]&4096&&J(bi,1):(bi=py(),bi.c(),J(bi,1),bi.m(At,null)):bi&&(yi(),ne(bi,1,1,()=>{bi=null}),vi()),Mn===(Mn=gn(Yt))&&Qi?Qi.p(Yt,Ni):(Qi.d(1),Qi=Mn(Yt),Qi&&(Qi.c(),Qi.m(Fe,null))),(!qe||Ni[0]&16&&je!==(je=Yt[4]==0))&&(Fe.disabled=je),Oi===(Oi=io(Yt))&&nt?nt.p(Yt,Ni):(nt.d(1),nt=Oi(Yt),nt&&(nt.c(),nt.m(vt,null))),(!qe||Ni[0]&32&&we!==(we=Yt[5]==0))&&(vt.disabled=we),Yt[3]?Mi?(Mi.p(Yt,Ni),Ni[0]&8&&J(Mi,1)):(Mi=my(Yt),Mi.c(),J(Mi,1),Mi.m(e,null)):Mi&&(yi(),ne(Mi,1,1,()=>{Mi=null}),vi())},i(Yt){qe||(J(bi),J(Mi),qe=!0)},o(Yt){ne(bi),ne(Mi),qe=!1},d(Yt){Yt&&se(e),Pi&&Pi.d(),bi&&bi.d(),Qi.d(),nt.d(),Mi&&Mi.d(),Ye=!1,hn(Ot)}}}function nT(r){let e;return{c(){e=oe("p"),e.textContent="Click to change direction"},m(t,i){ae(t,e,i)},p:It,d(t){t&&se(e)}}}function rT(r){let e,t,i,l;return{c(){e=oe("div"),t=oe("img"),l=Ve(`
                Click to add modal filter`),zn(t.src,i=`/ltn//filters/${r[9]}_icon.gif`)||ke(t,"src",i),ke(t,"width","20"),ke(t,"alt","Add modal filter")},m(u,d){ae(u,e,d),G(e,t),G(e,l)},p(u,d){d[0]&512&&!zn(t.src,i=`/ltn//filters/${u[9]}_icon.gif`)&&ke(t,"src",i)},d(u){u&&se(e)}}}function oT(r){let e,t=r[39].shortcuts+"",i,l,u=(r[39].name??"unnamed road")+"",d,a,_=Math.round(r[39].speed_mph)+"",v,k,S,E;function A(P,R){return P[0]=="filter"?rT:nT}let D=A(r),B=D(r);return{c(){e=oe("p"),i=Ve(t),l=Ve(" shortcuts through "),d=Ve(u),a=Ve(`
              (`),v=Ve(_),k=Ve(" mph)"),S=Ae(),B.c(),E=En()},m(P,R){ae(P,e,R),G(e,i),G(e,l),G(e,d),G(e,a),G(e,v),G(e,k),ae(P,S,R),B.m(P,R),ae(P,E,R)},p(P,R){R[1]&256&&t!==(t=P[39].shortcuts+"")&&si(i,t),R[1]&256&&u!==(u=(P[39].name??"unnamed road")+"")&&si(d,u),R[1]&256&&_!==(_=Math.round(P[39].speed_mph)+"")&&si(v,_),D===(D=A(P))&&B?B.p(P,R):(B.d(1),B=D(P),B&&(B.c(),B.m(E.parentNode,E)))},d(P){P&&(se(e),se(S),se(E)),B.d(P)}}}function sT(r){let e,t,i;return t=new Zo({props:{openOn:"hover",$$slots:{default:[oT,({props:l})=>({39:l}),({props:l})=>[0,l?256:0]]},$$scope:{ctx:r}}}),{c(){e=oe("div"),Ie(t.$$.fragment),ke(e,"slot","line-popup")},m(l,u){ae(l,e,u),Ee(t,e,null),i=!0},p(l,u){const d={};u[0]&513|u[1]&768&&(d.$$scope={dirty:u,ctx:l}),t.$set(d)},i(l){i||(J(t.$$.fragment,l),i=!0)},o(l){ne(t.$$.fragment,l),i=!1},d(l){l&&se(e),Me(t)}}}function aT(r){let e,t,i,l,u,d,a,_;return e=new Od({}),i=new Fd({}),u=new Nd({}),a=new Xu({props:{interactive:r[0]=="filter"||r[0]=="oneway",onClickLine:r[15],$$slots:{"line-popup":[sT]},$$scope:{ctx:r}}}),{c(){Ie(e.$$.fragment),t=Ae(),Ie(i.$$.fragment),l=Ae(),Ie(u.$$.fragment),d=Ae(),Ie(a.$$.fragment)},m(v,k){Ee(e,v,k),ae(v,t,k),Ee(i,v,k),ae(v,l,k),Ee(u,v,k),ae(v,d,k),Ee(a,v,k),_=!0},p(v,k){const S={};k[0]&1&&(S.interactive=v[0]=="filter"||v[0]=="oneway"),k[0]&513|k[1]&512&&(S.$$scope={dirty:k,ctx:v}),a.$set(S)},i(v){_||(J(e.$$.fragment,v),J(i.$$.fragment,v),J(u.$$.fragment,v),J(a.$$.fragment,v),_=!0)},o(v){ne(e.$$.fragment,v),ne(i.$$.fragment,v),ne(u.$$.fragment,v),ne(a.$$.fragment,v),_=!1},d(v){v&&(se(t),se(l),se(d)),Me(e,v),Me(i,v),Me(u,v),Me(a,v)}}}function gy(r){let e,t;return e=new D3({props:{paths:r[7]}}),{c(){Ie(e.$$.fragment)},m(i,l){Ee(e,i,l),t=!0},p(i,l){const u={};l[0]&128&&(u.paths=i[7]),e.$set(u)},i(i){t||(J(e.$$.fragment,i),t=!0)},o(i){ne(e.$$.fragment,i),t=!1},d(i){Me(e,i)}}}function lT(r){let e;return{c(){e=Ve("Click to delete")},m(t,i){ae(t,e,i)},d(t){t&&se(e)}}}function cT(r){let e,t;return e=new Zo({props:{openOn:"hover",$$slots:{default:[lT]},$$scope:{ctx:r}}}),{c(){Ie(e.$$.fragment)},m(i,l){Ee(e,i,l),t=!0},p(i,l){const u={};l[1]&512&&(u.$$scope={dirty:l,ctx:i}),e.$set(u)},i(i){t||(J(e.$$.fragment,i),t=!0)},o(i){ne(e.$$.fragment,i),t=!1},d(i){Me(e,i)}}}function _y(r){let e,t;return e=new V3({props:{map:vr(r[2])}}),e.$on("done",r[20]),{c(){Ie(e.$$.fragment)},m(i,l){Ee(e,i,l),t=!0},p(i,l){const u={};l[0]&4&&(u.map=vr(i[2])),e.$set(u)},i(i){t||(J(e.$$.fragment,i),t=!0)},o(i){ne(e.$$.fragment,i),t=!1},d(i){Me(e,i)}}}function uT(r){let e,t,i,l,u,d,a;t=new Ku({props:{input:r[1],$$slots:{default:[aT]},$$scope:{ctx:r}}});let _=r[11]&&gy(r);u=new Va({props:{$$slots:{default:[cT]},$$scope:{ctx:r}}}),u.$on("click",r[16]);let v=r[0]=="freehand-filters"&&_y(r);return{c(){e=oe("div"),Ie(t.$$.fragment),i=Ae(),_&&_.c(),l=Ae(),Ie(u.$$.fragment),d=Ae(),v&&v.c(),ke(e,"slot","map")},m(k,S){ae(k,e,S),Ee(t,e,null),G(e,i),_&&_.m(e,null),G(e,l),Ee(u,e,null),G(e,d),v&&v.m(e,null),a=!0},p(k,S){const E={};S[0]&2&&(E.input=k[1]),S[0]&513|S[1]&512&&(E.$$scope={dirty:S,ctx:k}),t.$set(E),k[11]?_?(_.p(k,S),S[0]&2048&&J(_,1)):(_=gy(k),_.c(),J(_,1),_.m(e,l)):_&&(yi(),ne(_,1,1,()=>{_=null}),vi());const A={};S[1]&512&&(A.$$scope={dirty:S,ctx:k}),u.$set(A),k[0]=="freehand-filters"?v?(v.p(k,S),S[0]&1&&J(v,1)):(v=_y(k),v.c(),J(v,1),v.m(e,null)):v&&(yi(),ne(v,1,1,()=>{v=null}),vi())},i(k){a||(J(t.$$.fragment,k),J(_),J(u.$$.fragment,k),J(v),a=!0)},o(k){ne(t.$$.fragment,k),ne(_),ne(u.$$.fragment,k),ne(v),a=!1},d(k){k&&se(e),Me(t),_&&_.d(),Me(u),v&&v.d()}}}function hT(r){let e,t,i,l;return e=new Po({props:{$$slots:{map:[uT],sidebar:[iT],top:[J3]},$$scope:{ctx:r}}}),{c(){Ie(e.$$.fragment)},m(u,d){Ee(e,u,d),t=!0,i||(l=St(window,"keydown",r[17]),i=!0)},p(u,d){const a={};d[0]&16383|d[1]&512&&(a.$$scope={dirty:d,ctx:u}),e.$set(a)},i(u){t||(J(e.$$.fragment,u),t=!0)},o(u){ne(e.$$.fragment,u),t=!1},d(u){Me(e,u),i=!1,l()}}}function dT(r,e,t){let i,l,u,d,a,_,v,k,S;lt(r,bs,ft=>t(21,l=ft)),lt(r,hp,ft=>t(9,u=ft)),lt(r,Dn,ft=>t(37,d=ft)),lt(r,Fu,ft=>t(10,a=ft)),lt(r,qo,ft=>t(2,_=ft)),lt(r,Og,ft=>t(11,v=ft)),lt(r,Sd,ft=>t(12,k=ft)),lt(r,Wt,ft=>t(13,S=ft));let E="filter",A=!1,D=0,B=0,P,R,F=d.getAllShortcuts();er(()=>{_.doubleClickZoom.enable()});function j(ft){t(1,R=d.renderNeighbourhood()),t(6,P=R.features.find(Jt=>Jt.properties.kind=="boundary")),t(4,D=R.undo_length),t(5,B=R.redo_length),t(7,F=d.getAllShortcuts()),oc()}function U(){d.setCurrentNeighbourhood(P.properties.name,a),Tt(bs,l++,l)}function le(ft,Jt){E=="filter"?(d.addModalFilter(Jt,u),Tt(bs,l++,l)):E=="oneway"&&(d.toggleDirection(ft.properties.road),Tt(bs,l++,l))}function he(ft){let Jt=ft.detail.features[0];d.deleteModalFilter(Jt.properties.road),Tt(bs,l++,l)}function Z(ft){ft.target.tagName!="INPUT"&&(ft.ctrlKey&&ft.key=="z"&&Q(),ft.ctrlKey&&ft.key=="y"&&ye(),ft.key=="1"&&t(0,E="filter"),ft.key=="2"&&t(0,E="freehand-filters"),ft.key=="3"&&t(0,E="oneway"))}function Q(){d.undo(),Tt(bs,l++,l)}function ye(){d.redo(),Tt(bs,l++,l)}function Ne(ft){let Jt=ft.detail;Jt&&(d.addManyModalFilters(Jt,u),Tt(bs,l++,l)),t(0,E="filter")}const re=()=>t(0,E="filter"),ve=()=>t(0,E="freehand-filters"),Ke=()=>t(0,E="oneway"),Le=()=>t(3,A=!0);function et(){v=this.checked,Og.set(v)}function xt(){a=this.checked,Fu.set(a)}function mt(){k=Lp(this),Sd.set(k)}const at=()=>t(3,A=!1),Ht=()=>Tt(Wt,S={mode:"title",firstLoad:!1},S),ri=()=>Tt(Wt,S={mode:"network"},S),Nt=()=>Tt(Wt,S={mode:"view-shortcuts"},S),At=()=>Tt(Wt,S={mode:"route",prevMode:"neighbourhood"},S),ei=()=>Tt(Wt,S={mode:"impact-one-destination"},S),ci=()=>Tt(Wt,S={mode:"set-boundary",name:vr(P).properties.name,existing:P},S),ti=()=>Tt(Wt,S={mode:"debug"},S);return r.$$.update=()=>{r.$$.dirty[0]&5&&(E=="oneway"?_.doubleClickZoom.disable():_.doubleClickZoom.enable()),r.$$.dirty[0]&2097152&&j(),r.$$.dirty[0]&2&&t(8,i=R.features.filter(ft=>ft.properties.kind=="cell"&&ft.properties.cell_color=="disconnected").length)},[E,R,_,A,D,B,P,F,i,u,a,v,k,S,U,le,he,Z,Q,ye,Ne,l,re,ve,Ke,Le,et,xt,mt,at,Ht,ri,Nt,At,ei,ci,ti]}class fT extends Vt{constructor(e){super(),Ut(this,e,dT,hT,zt,{},null,[-1,-1])}}function pT(r){let e;return{c(){e=Ve("Choose project")},m(t,i){ae(t,e,i)},d(t){t&&se(e)}}}function mT(r){let e;return{c(){e=Ve("Pick neighbourhood")},m(t,i){ae(t,e,i)},d(t){t&&se(e)}}}function gT(r){let e,t,i,l,u,d,a,_,v,k,S;return u=new Ii({props:{$$slots:{default:[pT]},$$scope:{ctx:r}}}),u.$on("click",r[9]),_=new Ii({props:{$$slots:{default:[mT]},$$scope:{ctx:r}}}),_.$on("click",r[10]),{c(){e=oe("div"),t=oe("nav"),i=oe("ul"),l=oe("li"),Ie(u.$$.fragment),d=Ae(),a=oe("li"),Ie(_.$$.fragment),v=Ae(),k=oe("li"),k.textContent="Predict impact",ke(t,"aria-label","breadcrumb"),ke(e,"slot","top")},m(E,A){ae(E,e,A),G(e,t),G(t,i),G(i,l),Ee(u,l,null),G(i,d),G(i,a),Ee(_,a,null),G(i,v),G(i,k),S=!0},p(E,A){const D={};A&8192&&(D.$$scope={dirty:A,ctx:E}),u.$set(D);const B={};A&8192&&(B.$$scope={dirty:A,ctx:E}),_.$set(B)},i(E){S||(J(u.$$.fragment,E),J(_.$$.fragment,E),S=!0)},o(E){ne(u.$$.fragment,E),ne(_.$$.fragment,E),S=!1},d(E){E&&se(e),Me(u),Me(_)}}}function _T(r){let e;return{c(){e=Ve("Pick a different road")},m(t,i){ae(t,e,i)},d(t){t&&se(e)}}}function yT(r){let e,t,i,l,u,d,a,_,v=r[0]+1+"",k,S,E=r[2].length+"",A,D,B,P,R,F,j,U,le,he;return t=new Ii({props:{$$slots:{default:[_T]},$$scope:{ctx:r}}}),t.$on("click",r[8]),{c(){e=oe("div"),Ie(t.$$.fragment),i=Ae(),l=oe("div"),u=oe("button"),d=Ve("Previous"),_=Ae(),k=Ve(v),S=Ve(" / "),A=Ve(E),D=Ae(),B=oe("button"),P=Ve("Next"),F=Ae(),j=oe("p"),j.innerHTML=`<span style="color: red">Route before</span>
      ,
      <span style="color: blue">route after</span>`,u.disabled=a=r[0]==0,ke(u,"data-tooltip","Left"),B.disabled=R=r[0]==r[2].length-1,ke(B,"data-tooltip","Right"),Ai(l,"display","flex"),Ai(l,"justify-content","space-between"),ke(e,"slot","sidebar")},m(Z,Q){ae(Z,e,Q),Ee(t,e,null),G(e,i),G(e,l),G(l,u),G(u,d),G(l,_),G(l,k),G(l,S),G(l,A),G(l,D),G(l,B),G(B,P),G(e,F),G(e,j),U=!0,le||(he=[St(u,"click",r[4]),St(B,"click",r[5])],le=!0)},p(Z,Q){const ye={};Q&8192&&(ye.$$scope={dirty:Q,ctx:Z}),t.$set(ye),(!U||Q&1&&a!==(a=Z[0]==0))&&(u.disabled=a),(!U||Q&1)&&v!==(v=Z[0]+1+"")&&si(k,v),(!U||Q&1&&R!==(R=Z[0]==Z[2].length-1))&&(B.disabled=R)},i(Z){U||(J(t.$$.fragment,Z),U=!0)},o(Z){ne(t.$$.fragment,Z),U=!1},d(Z){Z&&se(e),Me(t),le=!1,hn(he)}}}function vT(r){let e,t;const i=[un("predict-impact"),{paint:{"line-width":Lu(["get","kind"],{focus:8},5),"line-color":Lu(["get","kind"],{focus:"black",before:"red",after:"blue"},"cyan"),"line-opacity":Lu(["get","kind"],{focus:1},.5)}}];let l={};for(let u=0;u<i.length;u+=1)l=rn(l,i[u]);return e=new Hr({props:l}),{c(){Ie(e.$$.fragment)},m(u,d){Ee(e,u,d),t=!0},p(u,d){const a={};e.$set(a)},i(u){t||(J(e.$$.fragment,u),t=!0)},o(u){ne(e.$$.fragment,u),t=!1},d(u){Me(e,u)}}}function bT(r){let e;return{c(){e=Ve("A")},m(t,i){ae(t,e,i)},d(t){t&&se(e)}}}function wT(r){let e;return{c(){e=Ve("B")},m(t,i){ae(t,e,i)},d(t){t&&se(e)}}}function xT(r){let e,t,i,l,u,d,a,_,v;return t=new ur({props:{data:r[6](r[0]),$$slots:{default:[vT]},$$scope:{ctx:r}}}),l=new Ua({props:{lngLat:r[2][r[0]][0].geometry.coordinates[0],$$slots:{default:[bT]},$$scope:{ctx:r}}}),d=new Ua({props:{lngLat:r[2][r[0]][0].geometry.coordinates[r[2][r[0]][0].geometry.coordinates.length-1],$$slots:{default:[wT]},$$scope:{ctx:r}}}),_=new Va({}),{c(){e=oe("div"),Ie(t.$$.fragment),i=Ae(),Ie(l.$$.fragment),u=Ae(),Ie(d.$$.fragment),a=Ae(),Ie(_.$$.fragment),ke(e,"slot","map")},m(k,S){ae(k,e,S),Ee(t,e,null),G(e,i),Ee(l,e,null),G(e,u),Ee(d,e,null),G(e,a),Ee(_,e,null),v=!0},p(k,S){const E={};S&1&&(E.data=k[6](k[0])),S&8192&&(E.$$scope={dirty:S,ctx:k}),t.$set(E);const A={};S&1&&(A.lngLat=k[2][k[0]][0].geometry.coordinates[0]),S&8192&&(A.$$scope={dirty:S,ctx:k}),l.$set(A);const D={};S&1&&(D.lngLat=k[2][k[0]][0].geometry.coordinates[k[2][k[0]][0].geometry.coordinates.length-1]),S&8192&&(D.$$scope={dirty:S,ctx:k}),d.$set(D)},i(k){v||(J(t.$$.fragment,k),J(l.$$.fragment,k),J(d.$$.fragment,k),J(_.$$.fragment,k),v=!0)},o(k){ne(t.$$.fragment,k),ne(l.$$.fragment,k),ne(d.$$.fragment,k),ne(_.$$.fragment,k),v=!1},d(k){k&&se(e),Me(t),Me(l),Me(d),Me(_)}}}function kT(r){let e,t,i,l;return e=new Po({props:{$$slots:{map:[xT],sidebar:[yT],top:[gT]},$$scope:{ctx:r}}}),{c(){Ie(e.$$.fragment)},m(u,d){Ee(e,u,d),t=!0,i||(l=St(window,"keydown",r[3]),i=!0)},p(u,[d]){const a={};d&8195&&(a.$$scope={dirty:d,ctx:u}),e.$set(a)},i(u){t||(J(e.$$.fragment,u),t=!0)},o(u){ne(e.$$.fragment,u),t=!1},d(u){Me(e,u),i=!1,l()}}}function ST(r,e,t){let i,l,u;lt(r,qo,P=>t(11,i=P)),lt(r,Dn,P=>t(12,l=P)),lt(r,Wt,P=>t(1,u=P));let{road:d}=e;d.properties.kind="focus";let a=l.getImpactsOnRoad(d.properties.id),_=0;Zu(()=>{i==null||i.keyboard.disable()}),er(()=>{i==null||i.keyboard.enable()});function v(P){P.key=="ArrowLeft"&&(P.stopPropagation(),k()),P.key=="ArrowRight"&&(P.stopPropagation(),S())}function k(){_!=0&&t(0,_--,_)}function S(){_!=a.length-1&&t(0,_++,_)}function E(P){return{type:"FeatureCollection",features:[a[P][0],a[P][1],d]}}const A=()=>Tt(Wt,u={mode:"predict-impact"},u),D=()=>Tt(Wt,u={mode:"title",firstLoad:!1},u),B=()=>Tt(Wt,u={mode:"network"},u);return r.$$set=P=>{"road"in P&&t(7,d=P.road)},[_,u,a,v,k,S,E,d,A,D,B]}class TT extends Vt{constructor(e){super(),Ut(this,e,ST,kT,zt,{road:7})}}function CT(r){let e;return{c(){e=Ve("Choose project")},m(t,i){ae(t,e,i)},d(t){t&&se(e)}}}function ET(r){let e;return{c(){e=Ve("Pick neighbourhood")},m(t,i){ae(t,e,i)},d(t){t&&se(e)}}}function MT(r){let e;return{c(){e=Ve("Editing")},m(t,i){ae(t,e,i)},d(t){t&&se(e)}}}function IT(r){let e,t,i,l,u,d,a,_,v,k,S,E,A,D;return u=new Ii({props:{$$slots:{default:[CT]},$$scope:{ctx:r}}}),u.$on("click",r[12]),_=new Ii({props:{$$slots:{default:[ET]},$$scope:{ctx:r}}}),_.$on("click",r[13]),S=new Ii({props:{$$slots:{default:[MT]},$$scope:{ctx:r}}}),S.$on("click",r[5]),{c(){e=oe("div"),t=oe("nav"),i=oe("ul"),l=oe("li"),Ie(u.$$.fragment),d=Ae(),a=oe("li"),Ie(_.$$.fragment),v=Ae(),k=oe("li"),Ie(S.$$.fragment),E=Ae(),A=oe("li"),A.textContent="Impact routing to one destination",ke(t,"aria-label","breadcrumb"),ke(e,"slot","top")},m(B,P){ae(B,e,P),G(e,t),G(t,i),G(i,l),Ee(u,l,null),G(i,d),G(i,a),Ee(_,a,null),G(i,v),G(i,k),Ee(S,k,null),G(i,E),G(i,A),D=!0},p(B,P){const R={};P&262144&&(R.$$scope={dirty:P,ctx:B}),u.$set(R);const F={};P&262144&&(F.$$scope={dirty:P,ctx:B}),_.$set(F);const j={};P&262144&&(j.$$scope={dirty:P,ctx:B}),S.$set(j)},i(B){D||(J(u.$$.fragment,B),J(_.$$.fragment,B),J(S.$$.fragment,B),D=!0)},o(B){ne(u.$$.fragment,B),ne(_.$$.fragment,B),ne(S.$$.fragment,B),D=!1},d(B){B&&se(e),Me(u),Me(_),Me(S)}}}function LT(r){let e,t,i,l,u,d,a,_=r[3].highest_time_ratio.toFixed(1)+"",v,k;return t=new uc({}),t.$on("click",r[5]),{c(){e=oe("div"),Ie(t.$$.fragment),i=Ae(),l=oe("p"),l.textContent=`This shows the change in driving time to one destination from everywhere
      within the neighbourhood. Drag the pin around to change that destination.`,u=Ae(),d=oe("p"),a=Ve("Highest ratio is "),v=Ve(_),ke(e,"slot","sidebar")},m(S,E){ae(S,e,E),Ee(t,e,null),G(e,i),G(e,l),G(e,u),G(e,d),G(d,a),G(d,v),k=!0},p(S,E){(!k||E&8)&&_!==(_=S[3].highest_time_ratio.toFixed(1)+"")&&si(v,_)},i(S){k||(J(t.$$.fragment,S),k=!0)},o(S){ne(t.$$.fragment,S),k=!1},d(S){S&&se(e),Me(t)}}}function AT(r){let e,t;const i=[un("cells"),{filter:["==",["get","kind"],"cell"]},{paint:{"fill-color":["get","color"],"fill-opacity":.6}}];let l={};for(let u=0;u<i.length;u+=1)l=rn(l,i[u]);return e=new Es({props:l}),{c(){Ie(e.$$.fragment)},m(u,d){Ee(e,u,d),t=!0},p(u,d){const a={};e.$set(a)},i(u){t||(J(e.$$.fragment,u),t=!0)},o(u){ne(e.$$.fragment,u),t=!1},d(u){Me(e,u)}}}function PT(r){let e,t=Qs(r[17].distance_before)+"",i,l,u=ea(r[17].time_before)+"",d,a,_,v,k=Qs(r[17].distance_after)+"",S,E,A=ea(r[17].time_after)+"",D,B,P,R,F,j=(r[17].time_after/r[17].time_before).toFixed(1)+"",U;return{c(){e=oe("p"),i=Ve(t),l=Ve(", "),d=Ve(u),a=Ve(" before"),_=Ae(),v=oe("p"),S=Ve(k),E=Ve(", "),D=Ve(A),B=Ve(" after"),P=Ae(),R=oe("p"),F=Ve("Time ratio: "),U=Ve(j)},m(le,he){ae(le,e,he),G(e,i),G(e,l),G(e,d),G(e,a),ae(le,_,he),ae(le,v,he),G(v,S),G(v,E),G(v,D),G(v,B),ae(le,P,he),ae(le,R,he),G(R,F),G(R,U)},p(le,he){he&131072&&t!==(t=Qs(le[17].distance_before)+"")&&si(i,t),he&131072&&u!==(u=ea(le[17].time_before)+"")&&si(d,u),he&131072&&k!==(k=Qs(le[17].distance_after)+"")&&si(S,k),he&131072&&A!==(A=ea(le[17].time_after)+"")&&si(D,A),he&131072&&j!==(j=(le[17].time_after/le[17].time_before).toFixed(1)+"")&&si(U,j)},d(le){le&&(se(e),se(_),se(v),se(P),se(R))}}}function zT(r){let e,t;return e=new Zo({props:{openOn:"hover",$$slots:{default:[PT,({props:i})=>({17:i}),({props:i})=>i?131072:0]},$$scope:{ctx:r}}}),{c(){Ie(e.$$.fragment)},m(i,l){Ee(e,i,l),t=!0},p(i,l){const u={};l&393216&&(u.$$scope={dirty:l,ctx:i}),e.$set(u)},i(i){t||(J(e.$$.fragment,i),t=!0)},o(i){ne(e.$$.fragment,i),t=!1},d(i){Me(e,i)}}}function DT(r){let e,t,i;const l=[un("interior-roads"),{paint:{"line-color":["interpolate-hcl",["linear"],["/",["get","time_after"],["get","time_before"]],1,"white",Math.max(r[3].highest_time_ratio,1.1),"red"],"line-width":5}},{manageHoverState:!0}];function u(a){r[9](a)}let d={$$slots:{default:[zT]},$$scope:{ctx:r}};for(let a=0;a<l.length;a+=1)d=rn(d,l[a]);return r[0]!==void 0&&(d.hovered=r[0]),e=new Hr({props:d}),on.push(()=>Wr(e,"hovered",u)),e.$on("click",r[10]),{c(){Ie(e.$$.fragment)},m(a,_){Ee(e,a,_),i=!0},p(a,_){const v=_&8?nc(l,[l[0],{paint:{"line-color":["interpolate-hcl",["linear"],["/",["get","time_after"],["get","time_before"]],1,"white",Math.max(a[3].highest_time_ratio,1.1),"red"],"line-width":5}},l[2]]):{};_&262144&&(v.$$scope={dirty:_,ctx:a}),!t&&_&1&&(t=!0,v.hovered=a[0],Gr(()=>t=!1)),e.$set(v)},i(a){i||(J(e.$$.fragment,a),i=!0)},o(a){ne(e.$$.fragment,a),i=!1},d(a){Me(e,a)}}}function RT(r){let e,t;const i=[un("compare-route"),{interactive:!1},{paint:{"line-width":10,"line-color":Lu(["get","kind"],{before:"red",after:"blue"},"red")}}];let l={};for(let u=0;u<i.length;u+=1)l=rn(l,i[u]);return e=new Hr({props:l}),{c(){Ie(e.$$.fragment)},m(u,d){Ee(e,u,d),t=!0},p(u,d){const a={};e.$set(a)},i(u){t||(J(e.$$.fragment,u),t=!0)},o(u){ne(e.$$.fragment,u),t=!1},d(u){Me(e,u)}}}function BT(r){let e;return{c(){e=Ve("X")},m(t,i){ae(t,e,i)},d(t){t&&se(e)}}}function FT(r){let e,t,i,l,u,d,a,_,v,k,S,E;t=new Ku({props:{$$slots:{default:[AT]},$$scope:{ctx:r}}}),l=new ur({props:{data:r[3],generateId:!0,$$slots:{default:[DT]},$$scope:{ctx:r}}}),d=new ur({props:{data:r[2],$$slots:{default:[RT]},$$scope:{ctx:r}}}),_=new Va({});function A(B){r[11](B)}let D={draggable:!0,$$slots:{default:[BT]},$$scope:{ctx:r}};return r[1]!==void 0&&(D.lngLat=r[1]),k=new Ua({props:D}),on.push(()=>Wr(k,"lngLat",A)),{c(){e=oe("div"),Ie(t.$$.fragment),i=Ae(),Ie(l.$$.fragment),u=Ae(),Ie(d.$$.fragment),a=Ae(),Ie(_.$$.fragment),v=Ae(),Ie(k.$$.fragment),ke(e,"slot","map")},m(B,P){ae(B,e,P),Ee(t,e,null),G(e,i),Ee(l,e,null),G(e,u),Ee(d,e,null),G(e,a),Ee(_,e,null),G(e,v),Ee(k,e,null),E=!0},p(B,P){const R={};P&262144&&(R.$$scope={dirty:P,ctx:B}),t.$set(R);const F={};P&8&&(F.data=B[3]),P&262153&&(F.$$scope={dirty:P,ctx:B}),l.$set(F);const j={};P&4&&(j.data=B[2]),P&262144&&(j.$$scope={dirty:P,ctx:B}),d.$set(j);const U={};P&262144&&(U.$$scope={dirty:P,ctx:B}),!S&&P&2&&(S=!0,U.lngLat=B[1],Gr(()=>S=!1)),k.$set(U)},i(B){E||(J(t.$$.fragment,B),J(l.$$.fragment,B),J(d.$$.fragment,B),J(_.$$.fragment,B),J(k.$$.fragment,B),E=!0)},o(B){ne(t.$$.fragment,B),ne(l.$$.fragment,B),ne(d.$$.fragment,B),ne(_.$$.fragment,B),ne(k.$$.fragment,B),E=!1},d(B){B&&se(e),Me(t),Me(l),Me(d),Me(_),Me(k)}}}function OT(r){let e,t,i,l;return e=new M0({}),e.$on("contextmenu",r[7]),i=new Po({props:{$$slots:{map:[FT],sidebar:[LT],top:[IT]},$$scope:{ctx:r}}}),{c(){Ie(e.$$.fragment),t=Ae(),Ie(i.$$.fragment)},m(u,d){Ee(e,u,d),ae(u,t,d),Ee(i,u,d),l=!0},p(u,[d]){const a={};d&262175&&(a.$$scope={dirty:d,ctx:u}),i.$set(a)},i(u){l||(J(e.$$.fragment,u),J(i.$$.fragment,u),l=!0)},o(u){ne(e.$$.fragment,u),ne(i.$$.fragment,u),l=!1},d(u){u&&se(t),Me(e,u),Me(i,u)}}}function NT(r,e,t){let i,l,u,d,a,_,v;lt(r,ud,U=>t(1,u=U)),lt(r,Wt,U=>t(4,d=U)),lt(r,Bu,U=>t(14,a=U)),lt(r,Ru,U=>t(15,_=U)),lt(r,Dn,U=>t(8,v=U));function k(){Tt(Wt,d={mode:"neighbourhood"},d)}let S=null;function E(U){return U?v.compareRoute(new Ts.LngLat(U.properties.pt1_x,U.properties.pt1_y),u,1):Ql()}function A(U){Tt(Ru,_=new Ts.LngLat(U.properties.pt1_x,U.properties.pt1_y),_),Tt(Bu,a=u,a),Tt(Wt,d={mode:"route",prevMode:"impact-one-destination"},d)}function D(U){Tt(ud,u=U.detail.lngLat,u)}function B(U){S=U,t(0,S)}const P=U=>A(U.detail.features[0]);function R(U){u=U,ud.set(u)}const F=()=>Tt(Wt,d={mode:"title",firstLoad:!1},d),j=()=>Tt(Wt,d={mode:"network"},d);return r.$$.update=()=>{r.$$.dirty&258&&t(3,i=v.impactToOneDestination(u)),r.$$.dirty&1&&t(2,l=E(S))},[S,u,l,i,d,k,A,D,v,B,P,R,F,j]}class jT extends Vt{constructor(e){super(),Ut(this,e,NT,OT,zt,{})}}const i1="/ltn/assets/delete-ec75e756.svg",n1="/ltn/assets/edit-f3f51206.svg";function yy(r,e,t){const i=r.slice();return i[21]=e[t],i}function UT(r){let e;return{c(){e=Ve("Choose project")},m(t,i){ae(t,e,i)},d(t){t&&se(e)}}}function VT(r){let e;return{c(){e=oe("p"),e.textContent=`Inside the neighbourhood you define, the goal is to eliminate (or
              deliberately permit) through-traffic. An appropriate neighbourhood
              boundary depends on many factors. The simplest approach is to find
              the area bounded on all sides by "main" roads, which are designed
              for higher traffic volumes. There are many other considerations,
              though -- maybe severances like rivers or rail should be part of a
              boundary. Bridges and tunnels near a boundary may be confusing as
              well. And note that your boundary may not match the conventional
              definition of "neighbourhood."`},m(t,i){ae(t,e,i)},p:It,d(t){t&&se(e)}}}function $T(r){let e;return{c(){e=Ve("Route")},m(t,i){ae(t,e,i)},d(t){t&&se(e)}}}function qT(r){let e;return{c(){e=Ve("Predict impact")},m(t,i){ae(t,e,i)},d(t){t&&se(e)}}}function ZT(r){let e,t,i,l,u,d,a,_,v,k,S,E,A,D,B,P,R,F;return u=new Ii({props:{$$slots:{default:[UT]},$$scope:{ctx:r}}}),u.$on("click",r[16]),v=new Wp({props:{$$slots:{default:[VT]},$$scope:{ctx:r}}}),D=new Ii({props:{$$slots:{default:[$T]},$$scope:{ctx:r}}}),D.$on("click",r[17]),R=new Ii({props:{$$slots:{default:[qT]},$$scope:{ctx:r}}}),R.$on("click",r[18]),{c(){e=oe("div"),t=oe("nav"),i=oe("ul"),l=oe("li"),Ie(u.$$.fragment),d=Ae(),a=oe("li"),_=Ve(`Pick neighbourhood
          `),Ie(v.$$.fragment),k=Ae(),S=oe("nav"),E=oe("ul"),A=oe("li"),Ie(D.$$.fragment),B=Ae(),P=oe("li"),Ie(R.$$.fragment),ke(t,"aria-label","breadcrumb"),ke(e,"slot","top"),Ai(e,"display","flex"),Ai(e,"justify-content","space-between")},m(j,U){ae(j,e,U),G(e,t),G(t,i),G(i,l),Ee(u,l,null),G(i,d),G(i,a),G(a,_),Ee(v,a,null),G(e,k),G(e,S),G(S,E),G(E,A),Ee(D,A,null),G(E,B),G(E,P),Ee(R,P,null),F=!0},p(j,U){const le={};U&16777216&&(le.$$scope={dirty:U,ctx:j}),u.$set(le);const he={};U&16777216&&(he.$$scope={dirty:U,ctx:j}),v.$set(he);const Z={};U&16777216&&(Z.$$scope={dirty:U,ctx:j}),D.$set(Z);const Q={};U&16777216&&(Q.$$scope={dirty:U,ctx:j}),R.$set(Q)},i(j){F||(J(u.$$.fragment,j),J(v.$$.fragment,j),J(D.$$.fragment,j),J(R.$$.fragment,j),F=!0)},o(j){ne(u.$$.fragment,j),ne(v.$$.fragment,j),ne(D.$$.fragment,j),ne(R.$$.fragment,j),F=!1},d(j){j&&se(e),Me(u),Me(v),Me(D),Me(R)}}}function GT(r){let e;return{c(){e=Ve("Draw a new boundary")},m(t,i){ae(t,e,i)},d(t){t&&se(e)}}}function WT(r){let e;return{c(){e=Ve("Use an auto-generated boundary")},m(t,i){ae(t,e,i)},d(t){t&&se(e)}}}function HT(r){let e=r[21]+"",t;return{c(){t=Ve(e)},m(i,l){ae(i,t,l)},p(i,l){l&2&&e!==(e=i[21]+"")&&si(t,e)},d(i){i&&se(t)}}}function vy(r){let e,t,i,l,u,d,a,_,v,k,S;function E(){return r[13](r[21])}i=new Ii({props:{$$slots:{default:[HT]},$$scope:{ctx:r}}}),i.$on("click",E);function A(){return r[14](r[21])}function D(){return r[15](r[21])}return{c(){e=oe("li"),t=oe("span"),Ie(i.$$.fragment),l=Ae(),u=oe("button"),u.innerHTML=`<img src="${n1}" alt="Rename neighbourhood"/>`,d=Ae(),a=oe("button"),a.innerHTML=`<img src="${i1}" alt="Delete neighbourhood"/>`,_=Ae(),ke(u,"class","secondary"),ke(a,"class","secondary"),Ai(t,"display","flex"),Ai(t,"justify-content","space-between")},m(B,P){ae(B,e,P),G(e,t),Ee(i,t,null),G(t,l),G(t,u),G(t,d),G(t,a),G(e,_),v=!0,k||(S=[St(u,"click",A),St(a,"click",D)],k=!0)},p(B,P){r=B;const R={};P&16777218&&(R.$$scope={dirty:P,ctx:r}),i.$set(R)},i(B){v||(J(i.$$.fragment,B),v=!0)},o(B){ne(i.$$.fragment,B),v=!1},d(B){B&&se(e),Me(i),k=!1,hn(S)}}}function XT(r){let e,t,i,l,u,d,a,_,v,k,S,E,A,D,B,P,R,F,j,U,le;i=new Ii({props:{$$slots:{default:[GT]},$$scope:{ctx:r}}}),i.$on("click",r[7]),d=new Ii({props:{$$slots:{default:[WT]},$$scope:{ctx:r}}}),d.$on("click",r[12]);let he=Tn(r[1]),Z=[];for(let ye=0;ye<he.length;ye+=1)Z[ye]=vy(yy(r,he,ye));const Q=ye=>ne(Z[ye],1,1,()=>{Z[ye]=null});return{c(){e=oe("div"),t=oe("div"),Ie(i.$$.fragment),l=Ae(),u=oe("div"),Ie(d.$$.fragment),a=Ae(),_=oe("ul");for(let ye=0;ye<Z.length;ye+=1)Z[ye].c();v=Ae(),k=oe("hr"),S=Ae(),E=oe("p"),A=Ve("Current project: "),D=Ve(r[2]),B=Ae(),P=oe("button"),P.textContent="Export project to GeoJSON",R=Ae(),F=oe("button"),F.textContent="Debug route-snapper",ke(F,"class","secondary"),ke(e,"slot","sidebar")},m(ye,Ne){ae(ye,e,Ne),G(e,t),Ee(i,t,null),G(e,l),G(e,u),Ee(d,u,null),G(e,a),G(e,_);for(let re=0;re<Z.length;re+=1)Z[re]&&Z[re].m(_,null);G(e,v),G(e,k),G(e,S),G(e,E),G(E,A),G(E,D),G(e,B),G(e,P),G(e,R),G(e,F),j=!0,U||(le=[St(P,"click",r[8]),St(F,"click",r[9])],U=!0)},p(ye,Ne){const re={};Ne&16777216&&(re.$$scope={dirty:Ne,ctx:ye}),i.$set(re);const ve={};if(Ne&16777216&&(ve.$$scope={dirty:Ne,ctx:ye}),d.$set(ve),Ne&114){he=Tn(ye[1]);let Ke;for(Ke=0;Ke<he.length;Ke+=1){const Le=yy(ye,he,Ke);Z[Ke]?(Z[Ke].p(Le,Ne),J(Z[Ke],1)):(Z[Ke]=vy(Le),Z[Ke].c(),J(Z[Ke],1),Z[Ke].m(_,null))}for(yi(),Ke=he.length;Ke<Z.length;Ke+=1)Q(Ke);vi()}(!j||Ne&4)&&si(D,ye[2])},i(ye){if(!j){J(i.$$.fragment,ye),J(d.$$.fragment,ye);for(let Ne=0;Ne<he.length;Ne+=1)J(Z[Ne]);j=!0}},o(ye){ne(i.$$.fragment,ye),ne(d.$$.fragment,ye),Z=Z.filter(Boolean);for(let Ne=0;Ne<Z.length;Ne+=1)ne(Z[Ne]);j=!1},d(ye){ye&&se(e),Me(i),Me(d),$o(Z,ye),U=!1,hn(le)}}}function KT(r){let e,t=r[20].name+"",i;return{c(){e=oe("p"),i=Ve(t)},m(l,u){ae(l,e,u),G(e,i)},p(l,u){u&1048576&&t!==(t=l[20].name+"")&&si(i,t)},d(l){l&&se(e)}}}function JT(r){let e,t;return e=new Zo({props:{openOn:"hover",$$slots:{default:[KT,({props:i})=>({20:i}),({props:i})=>i?1048576:0]},$$scope:{ctx:r}}}),{c(){Ie(e.$$.fragment)},m(i,l){Ee(e,i,l),t=!0},p(i,l){const u={};l&17825792&&(u.$$scope={dirty:l,ctx:i}),e.$set(u)},i(i){t||(J(e.$$.fragment,i),t=!0)},o(i){ne(e.$$.fragment,i),t=!1},d(i){Me(e,i)}}}function YT(r){let e,t;const i=[un("neighbourhood-boundaries",!1),{filter:["==",["get","kind"],"boundary"]},{paint:{"fill-color":"black","fill-opacity":Na(.3,.5)}},{manageHoverState:!0},{hoverCursor:"pointer"}];let l={$$slots:{default:[JT]},$$scope:{ctx:r}};for(let u=0;u<i.length;u+=1)l=rn(l,i[u]);return e=new Es({props:l}),e.$on("click",r[11]),{c(){Ie(e.$$.fragment)},m(u,d){Ee(e,u,d),t=!0},p(u,d){const a={};d&16777216&&(a.$$scope={dirty:d,ctx:u}),e.$set(a)},i(u){t||(J(e.$$.fragment,u),t=!0)},o(u){ne(e.$$.fragment,u),t=!1},d(u){Me(e,u)}}}function QT(r){let e,t,i,l,u;return t=new ur({props:{data:r[0],generateId:!0,$$slots:{default:[YT]},$$scope:{ctx:r}}}),l=new Va({}),{c(){e=oe("div"),Ie(t.$$.fragment),i=Ae(),Ie(l.$$.fragment),ke(e,"slot","map")},m(d,a){ae(d,e,a),Ee(t,e,null),G(e,i),Ee(l,e,null),u=!0},p(d,a){const _={};a&1&&(_.data=d[0]),a&16777216&&(_.$$scope={dirty:a,ctx:d}),t.$set(_)},i(d){u||(J(t.$$.fragment,d),J(l.$$.fragment,d),u=!0)},o(d){ne(t.$$.fragment,d),ne(l.$$.fragment,d),u=!1},d(d){d&&se(e),Me(t),Me(l)}}}function e5(r){let e,t;return e=new Po({props:{$$slots:{map:[QT],sidebar:[XT],top:[ZT]},$$scope:{ctx:r}}}),{c(){Ie(e.$$.fragment)},m(i,l){Ee(e,i,l),t=!0},p(i,[l]){const u={};l&16777231&&(u.$$scope={dirty:l,ctx:i}),e.$set(u)},i(i){t||(J(e.$$.fragment,i),t=!0)},o(i){ne(e.$$.fragment,i),t=!1},d(i){Me(e,i)}}}function t5(r,e,t){let i,l,u,d,a,_;lt(r,Dn,Z=>t(10,u=Z)),lt(r,Cs,Z=>t(2,d=Z)),lt(r,Wt,Z=>t(3,a=Z)),lt(r,Fu,Z=>t(19,_=Z));function v(Z){u.setCurrentNeighbourhood(Z,_),Tt(Wt,a={mode:"neighbourhood"},a)}function k(Z){window.confirm(`Really delete neighbourhood ${Z}? You can't undo this.`)&&(u.deleteNeighbourhoodBoundary(Z),oc(),t(0,i=u.toSavefile()))}function S(Z){let Q=Tp(u,`Rename neighbourhood ${Z} to what?`,Z);Q&&(u.renameNeighbourhoodBoundary(Z,Q),oc(),t(0,i=u.toSavefile()))}function E(){let Z=Tp(u,"What do you want to name the neighbourhood?","");Z&&Tt(Wt,a={mode:"set-boundary",name:Z,existing:null},a)}function A(){vd(d+".geojson",JSON.stringify(u.toSavefile()))}function D(){vd("debug_route_snapper.geojson",u.toRouteSnapperGj())}const B=Z=>v(vr(Z.detail.features[0].properties).name),P=()=>Tt(Wt,a={mode:"auto-boundaries"},a),R=Z=>v(Z),F=Z=>S(Z),j=Z=>k(Z),U=()=>Tt(Wt,a={mode:"title",firstLoad:!1},a),le=()=>Tt(Wt,a={mode:"route",prevMode:"network"},a),he=()=>Tt(Wt,a={mode:"predict-impact"},a);return r.$$.update=()=>{r.$$.dirty&1024&&t(0,i=u.toSavefile()),r.$$.dirty&1&&t(1,l=i.features.filter(Z=>Z.properties.kind=="boundary").map(Z=>Z.properties.name))},[i,l,d,a,v,k,S,E,A,D,u,B,P,R,F,j,U,le,he]}class i5 extends Vt{constructor(e){super(),Ut(this,e,t5,e5,zt,{})}}function n5(r){let e;return{c(){e=Ve("Choose project")},m(t,i){ae(t,e,i)},d(t){t&&se(e)}}}function r5(r){let e;return{c(){e=Ve("Pick neighbourhood")},m(t,i){ae(t,e,i)},d(t){t&&se(e)}}}function o5(r){let e,t,i,l,u,d,a,_,v,k,S;return u=new Ii({props:{$$slots:{default:[n5]},$$scope:{ctx:r}}}),u.$on("click",r[6]),_=new Ii({props:{$$slots:{default:[r5]},$$scope:{ctx:r}}}),_.$on("click",r[7]),{c(){e=oe("div"),t=oe("nav"),i=oe("ul"),l=oe("li"),Ie(u.$$.fragment),d=Ae(),a=oe("li"),Ie(_.$$.fragment),v=Ae(),k=oe("li"),k.textContent="Predict impact",ke(t,"aria-label","breadcrumb"),ke(e,"slot","top")},m(E,A){ae(E,e,A),G(e,t),G(t,i),G(i,l),Ee(u,l,null),G(i,d),G(i,a),Ee(_,a,null),G(i,v),G(i,k),S=!0},p(E,A){const D={};A&1024&&(D.$$scope={dirty:A,ctx:E}),u.$set(D);const B={};A&1024&&(B.$$scope={dirty:A,ctx:E}),_.$set(B)},i(E){S||(J(u.$$.fragment,E),J(_.$$.fragment,E),S=!0)},o(E){ne(u.$$.fragment,E),ne(_.$$.fragment,E),S=!1},d(E){E&&se(e),Me(u),Me(_)}}}function s5(r){let e,t,i,l,u,d,a,_,v;return t=new uc({}),t.$on("click",r[5]),{c(){e=oe("div"),Ie(t.$$.fragment),i=Ae(),l=oe("p"),l.textContent=`This mode estimates the impact of all your changes on traffic around the
      entire area. It's based on many assumptions and must be interpreted very
      carefully.`,u=Ae(),d=oe("p"),d.textContent=`Red roads have increased traffic, and green roads have decreased. If
      hovering on a road doesn't show anything, there was no change there. Click
      a road to see example routes through it that've changed.`,a=Ae(),_=oe("p"),_.textContent=`Thicker roads have more traffic after edits, relative to the max count for
      any road: ${r[2].max_count.toLocaleString()}`,ke(e,"slot","sidebar")},m(k,S){ae(k,e,S),Ee(t,e,null),G(e,i),G(e,l),G(e,u),G(e,d),G(e,a),G(e,_),v=!0},p:It,i(k){v||(J(t.$$.fragment,k),v=!0)},o(k){ne(t.$$.fragment,k),v=!1},d(k){k&&se(e),Me(t)}}}function a5(r){let e,t=r[9].before.toLocaleString()+"",i,l,u=r[9].after.toLocaleString()+"",d,a,_,v,k=Math.round(100*r[9].after/r[9].before)+"",S,E;return{c(){e=oe("p"),i=Ve(t),l=Ve(" before, "),d=Ve(u),a=Ve(`
            after`),_=Ae(),v=oe("p"),S=Ve(k),E=Ve("%")},m(A,D){ae(A,e,D),G(e,i),G(e,l),G(e,d),G(e,a),ae(A,_,D),ae(A,v,D),G(v,S),G(v,E)},p(A,D){D&512&&t!==(t=A[9].before.toLocaleString()+"")&&si(i,t),D&512&&u!==(u=A[9].after.toLocaleString()+"")&&si(d,u),D&512&&k!==(k=Math.round(100*A[9].after/A[9].before)+"")&&si(S,k)},d(A){A&&(se(e),se(_),se(v))}}}function l5(r){let e,t;return e=new Zo({props:{openOn:"hover",$$slots:{default:[a5,({props:i})=>({9:i}),({props:i})=>i?512:0]},$$scope:{ctx:r}}}),{c(){Ie(e.$$.fragment)},m(i,l){Ee(e,i,l),t=!0},p(i,l){const u={};l&1536&&(u.$$scope={dirty:l,ctx:i}),e.$set(u)},i(i){t||(J(e.$$.fragment,i),t=!0)},o(i){ne(e.$$.fragment,i),t=!1},d(i){Me(e,i)}}}function c5(r){let e,t;const i=[un("predict-impact"),{paint:{"line-width":["interpolate",["linear"],["get","after"],0,by,r[2].max_count,wy],"line-color":["let","ratio",["*",100,["/",["get","after"],["get","before"]]],["interpolate-hcl",["linear"],["var","ratio"],0,r[1][0],50,r[1][1],100,r[1][2],150,r[1][3],200,r[1][4]]]}},{manageHoverState:!0},{hoverCursor:"pointer"}];let l={$$slots:{default:[l5]},$$scope:{ctx:r}};for(let u=0;u<i.length;u+=1)l=rn(l,i[u]);return e=new Hr({props:l}),e.$on("click",r[4]),{c(){Ie(e.$$.fragment)},m(u,d){Ee(e,u,d),t=!0},p(u,d){const a=d&6?nc(i,[i[0],{paint:{"line-width":["interpolate",["linear"],["get","after"],0,by,u[2].max_count,wy],"line-color":["let","ratio",["*",100,["/",["get","after"],["get","before"]]],["interpolate-hcl",["linear"],["var","ratio"],0,u[1][0],50,u[1][1],100,u[1][2],150,u[1][3],200,u[1][4]]]}},i[2],i[3]]):{};d&1024&&(a.$$scope={dirty:d,ctx:u}),e.$set(a)},i(u){t||(J(e.$$.fragment,u),t=!0)},o(u){ne(e.$$.fragment,u),t=!1},d(u){Me(e,u)}}}function u5(r){let e,t,i,l,u;return t=new ur({props:{data:r[2],generateId:!0,$$slots:{default:[c5]},$$scope:{ctx:r}}}),l=new Va({}),{c(){e=oe("div"),Ie(t.$$.fragment),i=Ae(),Ie(l.$$.fragment),ke(e,"slot","map")},m(d,a){ae(d,e,a),Ee(t,e,null),G(e,i),Ee(l,e,null),u=!0},p(d,a){const _={};a&1024&&(_.$$scope={dirty:a,ctx:d}),t.$set(_)},i(d){u||(J(t.$$.fragment,d),J(l.$$.fragment,d),u=!0)},o(d){ne(t.$$.fragment,d),ne(l.$$.fragment,d),u=!1},d(d){d&&se(e),Me(t),Me(l)}}}function h5(r){let e,t;return e=new Po({props:{$$slots:{map:[u5],sidebar:[s5],top:[o5]},$$scope:{ctx:r}}}),{c(){Ie(e.$$.fragment)},m(i,l){Ee(e,i,l),t=!0},p(i,[l]){const u={};l&1025&&(u.$$scope={dirty:l,ctx:i}),e.$set(u)},i(i){t||(J(e.$$.fragment,i),t=!0)},o(i){ne(e.$$.fragment,i),t=!1},d(i){Me(e,i)}}}let by=3,wy=10;function d5(r,e,t){let i,l;lt(r,Wt,E=>t(0,i=E)),lt(r,Dn,E=>t(8,l=E));let u=["#1a9641","#a6d96a","white","#fdae61","#d7191c"],d=l.predictImpact();function a(E){Tt(Wt,i={mode:"impact-detail",road:E},i)}return[i,u,d,a,E=>a(E.detail.features[0]),()=>Tt(Wt,i={mode:"network"},i),()=>Tt(Wt,i={mode:"title",firstLoad:!1},i),()=>Tt(Wt,i={mode:"network"},i)]}class f5 extends Vt{constructor(e){super(),Ut(this,e,d5,h5,zt,{})}}function p5(r){let e;return{c(){e=Ve("Choose project")},m(t,i){ae(t,e,i)},d(t){t&&se(e)}}}function m5(r){let e;return{c(){e=Ve("Pick neighbourhood")},m(t,i){ae(t,e,i)},d(t){t&&se(e)}}}function xy(r){let e,t,i;return t=new Ii({props:{$$slots:{default:[g5]},$$scope:{ctx:r}}}),t.$on("click",r[13]),{c(){e=oe("li"),Ie(t.$$.fragment)},m(l,u){ae(l,e,u),Ee(t,e,null),i=!0},p(l,u){const d={};u&16384&&(d.$$scope={dirty:u,ctx:l}),t.$set(d)},i(l){i||(J(t.$$.fragment,l),i=!0)},o(l){ne(t.$$.fragment,l),i=!1},d(l){l&&se(e),Me(t)}}}function g5(r){let e;return{c(){e=Ve("Editing")},m(t,i){ae(t,e,i)},d(t){t&&se(e)}}}function _5(r){let e,t,i,l,u,d,a,_,v,k,S,E;u=new Ii({props:{$$slots:{default:[p5]},$$scope:{ctx:r}}}),u.$on("click",r[11]),_=new Ii({props:{$$slots:{default:[m5]},$$scope:{ctx:r}}}),_.$on("click",r[12]);let A=r[0]=="neighbourhood"&&xy(r);return{c(){e=oe("div"),t=oe("nav"),i=oe("ul"),l=oe("li"),Ie(u.$$.fragment),d=Ae(),a=oe("li"),Ie(_.$$.fragment),v=Ae(),A&&A.c(),k=Ae(),S=oe("li"),S.textContent="Routing",ke(t,"aria-label","breadcrumb"),ke(e,"slot","top")},m(D,B){ae(D,e,B),G(e,t),G(t,i),G(i,l),Ee(u,l,null),G(i,d),G(i,a),Ee(_,a,null),G(i,v),A&&A.m(i,null),G(i,k),G(i,S),E=!0},p(D,B){const P={};B&16384&&(P.$$scope={dirty:B,ctx:D}),u.$set(P);const R={};B&16384&&(R.$$scope={dirty:B,ctx:D}),_.$set(R),D[0]=="neighbourhood"?A?(A.p(D,B),B&1&&J(A,1)):(A=xy(D),A.c(),J(A,1),A.m(i,k)):A&&(yi(),ne(A,1,1,()=>{A=null}),vi())},i(D){E||(J(u.$$.fragment,D),J(_.$$.fragment,D),J(A),E=!0)},o(D){ne(u.$$.fragment,D),ne(_.$$.fragment,D),ne(A),E=!1},d(D){D&&se(e),Me(u),Me(_),A&&A.d()}}}function ky(r){let e,t,i,l=Qs(r[4].features[0].properties.distance)+"",u,d,a=ea(r[4].features[0].properties.time)+"",_,v,k,S,E,A=Qs(r[4].features[1].properties.distance)+"",D,B,P=ea(r[4].features[1].properties.time)+"",R;return{c(){e=oe("p"),t=oe("span"),t.textContent="Route before",i=Ve(`
        : `),u=Ve(l),d=Ve(", "),_=Ve(a),v=Ae(),k=oe("p"),S=oe("span"),S.textContent="Route after",E=Ve(`
        : `),D=Ve(A),B=Ve(", "),R=Ve(P),Ai(t,"color","red"),Ai(S,"color","blue")},m(F,j){ae(F,e,j),G(e,t),G(e,i),G(e,u),G(e,d),G(e,_),ae(F,v,j),ae(F,k,j),G(k,S),G(k,E),G(k,D),G(k,B),G(k,R)},p(F,j){j&16&&l!==(l=Qs(F[4].features[0].properties.distance)+"")&&si(u,l),j&16&&a!==(a=ea(F[4].features[0].properties.time)+"")&&si(_,a),j&16&&A!==(A=Qs(F[4].features[1].properties.distance)+"")&&si(D,A),j&16&&P!==(P=ea(F[4].features[1].properties.time)+"")&&si(R,P)},d(F){F&&(se(e),se(v),se(k))}}}function y5(r){let e,t,i,l,u,d,a,_,v,k,S,E,A,D,B,P;t=new uc({}),t.$on("click",r[6]);let R=r[4].features.length==2&&ky(r);return{c(){e=oe("div"),Ie(t.$$.fragment),i=Ae(),l=oe("p"),l.textContent="Drag markers for a route",u=Ae(),R&&R.c(),d=Ae(),a=oe("label"),_=Ve("Slow-down factor for main roads: "),v=Ve(r[1]),k=Ae(),S=oe("input"),E=Ae(),A=oe("i"),A.textContent=`Increase to see how drivers may detour in heavy traffic. 1 means
      free-flow.`,ke(S,"type","range"),ke(S,"min","1.0"),ke(S,"max","5.0"),ke(S,"step","0.1"),ke(e,"slot","sidebar")},m(F,j){ae(F,e,j),Ee(t,e,null),G(e,i),G(e,l),G(e,u),R&&R.m(e,null),G(e,d),G(e,a),G(a,_),G(a,v),G(a,k),G(a,S),Pn(S,r[1]),G(e,E),G(e,A),D=!0,B||(P=[St(S,"change",r[10]),St(S,"input",r[10])],B=!0)},p(F,j){F[4].features.length==2?R?R.p(F,j):(R=ky(F),R.c(),R.m(e,d)):R&&(R.d(1),R=null),(!D||j&2)&&si(v,F[1]),j&2&&Pn(S,F[1])},i(F){D||(J(t.$$.fragment,F),D=!0)},o(F){ne(t.$$.fragment,F),D=!1},d(F){F&&se(e),Me(t),R&&R.d(),B=!1,hn(P)}}}function Sy(r){let e,t;return e=new Ku({props:{$$slots:{default:[v5]},$$scope:{ctx:r}}}),{c(){Ie(e.$$.fragment)},m(i,l){Ee(e,i,l),t=!0},i(i){t||(J(e.$$.fragment,i),t=!0)},o(i){ne(e.$$.fragment,i),t=!1},d(i){Me(e,i)}}}function v5(r){let e,t,i,l,u,d,a,_;return e=new Od({}),i=new Fd({}),u=new Nd({}),a=new Xu({props:{interactive:!1}}),{c(){Ie(e.$$.fragment),t=Ae(),Ie(i.$$.fragment),l=Ae(),Ie(u.$$.fragment),d=Ae(),Ie(a.$$.fragment)},m(v,k){Ee(e,v,k),ae(v,t,k),Ee(i,v,k),ae(v,l,k),Ee(u,v,k),ae(v,d,k),Ee(a,v,k),_=!0},p:It,i(v){_||(J(e.$$.fragment,v),J(i.$$.fragment,v),J(u.$$.fragment,v),J(a.$$.fragment,v),_=!0)},o(v){ne(e.$$.fragment,v),ne(i.$$.fragment,v),ne(u.$$.fragment,v),ne(a.$$.fragment,v),_=!1},d(v){v&&(se(t),se(l),se(d)),Me(e,v),Me(i,v),Me(u,v),Me(a,v)}}}function b5(r){let e,t;const i=[un("compare-route"),{paint:{"line-width":10,"line-color":Lu(["get","kind"],{before:"red",after:"blue"},"red")}}];let l={};for(let u=0;u<i.length;u+=1)l=rn(l,i[u]);return e=new Hr({props:l}),{c(){Ie(e.$$.fragment)},m(u,d){Ee(e,u,d),t=!0},p(u,d){const a={};e.$set(a)},i(u){t||(J(e.$$.fragment,u),t=!0)},o(u){ne(e.$$.fragment,u),t=!1},d(u){Me(e,u)}}}function w5(r){let e;return{c(){e=Ve("A")},m(t,i){ae(t,e,i)},d(t){t&&se(e)}}}function x5(r){let e;return{c(){e=Ve("B")},m(t,i){ae(t,e,i)},d(t){t&&se(e)}}}function k5(r){let e,t,i,l,u,d,a,_,v,k,S,E,A=r[0]=="neighbourhood"&&Sy(r);i=new Va({}),u=new ur({props:{data:r[4],$$slots:{default:[b5]},$$scope:{ctx:r}}});function D(F){r[8](F)}let B={draggable:!0,$$slots:{default:[w5]},$$scope:{ctx:r}};r[3]!==void 0&&(B.lngLat=r[3]),a=new Ua({props:B}),on.push(()=>Wr(a,"lngLat",D));function P(F){r[9](F)}let R={draggable:!0,$$slots:{default:[x5]},$$scope:{ctx:r}};return r[2]!==void 0&&(R.lngLat=r[2]),k=new Ua({props:R}),on.push(()=>Wr(k,"lngLat",P)),{c(){e=oe("div"),A&&A.c(),t=Ae(),Ie(i.$$.fragment),l=Ae(),Ie(u.$$.fragment),d=Ae(),Ie(a.$$.fragment),v=Ae(),Ie(k.$$.fragment),ke(e,"slot","map")},m(F,j){ae(F,e,j),A&&A.m(e,null),G(e,t),Ee(i,e,null),G(e,l),Ee(u,e,null),G(e,d),Ee(a,e,null),G(e,v),Ee(k,e,null),E=!0},p(F,j){F[0]=="neighbourhood"?A?j&1&&J(A,1):(A=Sy(F),A.c(),J(A,1),A.m(e,t)):A&&(yi(),ne(A,1,1,()=>{A=null}),vi());const U={};j&16&&(U.data=F[4]),j&16384&&(U.$$scope={dirty:j,ctx:F}),u.$set(U);const le={};j&16384&&(le.$$scope={dirty:j,ctx:F}),!_&&j&8&&(_=!0,le.lngLat=F[3],Gr(()=>_=!1)),a.$set(le);const he={};j&16384&&(he.$$scope={dirty:j,ctx:F}),!S&&j&4&&(S=!0,he.lngLat=F[2],Gr(()=>S=!1)),k.$set(he)},i(F){E||(J(A),J(i.$$.fragment,F),J(u.$$.fragment,F),J(a.$$.fragment,F),J(k.$$.fragment,F),E=!0)},o(F){ne(A),ne(i.$$.fragment,F),ne(u.$$.fragment,F),ne(a.$$.fragment,F),ne(k.$$.fragment,F),E=!1},d(F){F&&se(e),A&&A.d(),Me(i),Me(u),Me(a),Me(k)}}}function S5(r){let e,t;return e=new Po({props:{$$slots:{map:[k5],sidebar:[y5],top:[_5]},$$scope:{ctx:r}}}),{c(){Ie(e.$$.fragment)},m(i,l){Ee(e,i,l),t=!0},p(i,[l]){const u={};l&16447&&(u.$$scope={dirty:l,ctx:i}),e.$set(u)},i(i){t||(J(e.$$.fragment,i),t=!0)},o(i){ne(e.$$.fragment,i),t=!1},d(i){Me(e,i)}}}function T5(r,e,t){let i,l,u,d,a,_;lt(r,Wt,R=>t(5,l=R)),lt(r,Fg,R=>t(1,u=R)),lt(r,Bu,R=>t(2,d=R)),lt(r,Ru,R=>t(3,a=R)),lt(r,Dn,R=>t(7,_=R));let{prevMode:v}=e;function k(){Tt(Wt,l={mode:v},l)}function S(R){a=R,Ru.set(a)}function E(R){d=R,Bu.set(d)}function A(){u=Ip(this.value),Fg.set(u)}const D=()=>Tt(Wt,l={mode:"title",firstLoad:!1},l),B=()=>Tt(Wt,l={mode:"network"},l),P=()=>Tt(Wt,l={mode:"neighbourhood"},l);return r.$$set=R=>{"prevMode"in R&&t(0,v=R.prevMode)},r.$$.update=()=>{r.$$.dirty&142&&t(4,i=_.compareRoute(a,d,u))},[v,u,d,a,i,l,k,_,S,E,A,D,B,P]}class C5 extends Vt{constructor(e){super(),Ut(this,e,T5,S5,zt,{prevMode:0})}}let sc=ki(null);const To=ki([]);function r1(r){if(r.length<3)return JSON.parse(Pr(sc).inner.calculateRoute(r));let e=JSON.parse(JSON.stringify(r));e.push(e[0]);let t=JSON.parse(Pr(sc).inner.calculateRoute(e));return t.properties.waypoints.pop(),t.geometry.type="Polygon",t.geometry.coordinates=[t.geometry.coordinates],t}const{window:E5}=Md,M5=r=>({}),Ty=r=>({}),I5=r=>({}),Cy=r=>({});function Ey(r,e,t){const i=r.slice();return i[44]=e[t],i[45]=e,i[46]=t,i}function My(r,e,t){const i=r.slice();return i[47]=e[t],i[48]=e,i[49]=t,i}function L5(r){let e,t;const i=r[24]["extra-top"],l=$i(i,r,r[38],Ty);return{c(){e=oe("div"),l&&l.c(),ke(e,"slot","top")},m(u,d){ae(u,e,d),l&&l.m(e,null),t=!0},p(u,d){l&&l.p&&(!t||d[1]&128)&&Zi(l,i,u,u[38],t?qi(i,u[38],d,M5):Gi(u[38]),Ty)},i(u){t||(J(l,u),t=!0)},o(u){ne(l,u),t=!1},d(u){u&&se(e),l&&l.d(u)}}}function A5(r){let e,t,i,l,u;return{c(){e=oe("ul"),e.innerHTML=`<li><b>Click</b>
            the map to add new points, until there are at least 3 points</li> <li><b>Click and drag</b>
            any point to move it</li> <li><b>Click</b>
            a waypoint to toggle snapping</li> <li><b>Right click</b>
            a waypoint to delete it</li>`,t=Ae(),i=oe("p"),i.textContent="Keyboard shortcuts:",l=Ae(),u=oe("ul"),u.innerHTML=`<li><b>s</b>
            to switch between snapping to roads and drawing anywhere</li> <li><b>Control+Z</b>
            to undo your last change</li> <li><b>Enter</b>
            or
            <b>Escape</b>
            to finish</li> <li>From the main mode, <b>3</b>
            to draw a new area</li>`},m(d,a){ae(d,e,a),ae(d,t,a),ae(d,i,a),ae(d,l,a),ae(d,u,a)},p:It,d(d){d&&(se(e),se(t),se(i),se(l),se(u))}}}function P5(r){let e,t=r[8].length+"",i,l;return{c(){e=Ve("Undo ("),i=Ve(t),l=Ve(")")},m(u,d){ae(u,e,d),ae(u,i,d),ae(u,l,d)},p(u,d){d[0]&256&&t!==(t=u[8].length+"")&&si(i,t)},d(u){u&&(se(e),se(i),se(l))}}}function z5(r){let e;return{c(){e=Ve("Undo")},m(t,i){ae(t,e,i)},p:It,d(t){t&&se(e)}}}function D5(r){let e;return{c(){e=oe("p"),e.textContent="Drag to adjust. Click to toggle snapped. Right click to delete."},m(t,i){ae(t,e,i)},p:It,d(t){t&&se(e)}}}function R5(r){let e,t,i,l,u,d,a,_,v,k,S,E,A;return S=e0(r[36][0]),{c(){e=oe("fieldset"),t=oe("label"),i=oe("input"),l=Ve(`
          Snap to roads`),u=Ae(),d=oe("label"),a=oe("input"),_=Ve(`
          Draw anywhere`),v=Ae(),k=oe("p"),k.textContent="Click to add at least 3 points",ke(i,"type","radio"),i.__value="snap",Pn(i,i.__value),ke(a,"type","radio"),a.__value="free",Pn(a,a.__value),S.p(i,a)},m(D,B){ae(D,e,B),G(e,t),G(t,i),i.checked=i.__value===r[7],G(t,l),G(e,u),G(e,d),G(d,a),a.checked=a.__value===r[7],G(d,_),ae(D,v,B),ae(D,k,B),E||(A=[St(i,"change",r[35]),St(a,"change",r[37])],E=!0)},p(D,B){B[0]&128&&(i.checked=i.__value===D[7]),B[0]&128&&(a.checked=a.__value===D[7])},d(D){D&&(se(e),se(v),se(k)),S.r(),E=!1,hn(A)}}}function B5(r){let e,t,i,l,u,d,a,_,v,k,S,E,A,D,B,P,R;const F=r[24]["extra-sidebar"],j=$i(F,r,r[38],Cy);k=new Wp({props:{$$slots:{default:[A5]},$$scope:{ctx:r}}});function U(Ne,re){return Ne[8].length==0?z5:P5}let le=U(r),he=le(r);function Z(Ne,re){return Ne[5].length<3?R5:D5}let Q=Z(r),ye=Q(r);return{c(){e=oe("div"),j&&j.c(),t=Ae(),i=oe("div"),l=oe("button"),u=Ve("Finish"),a=Ae(),_=oe("button"),_.textContent="Cancel",v=Ae(),Ie(k.$$.fragment),S=Ae(),E=oe("button"),he.c(),D=Ae(),ye.c(),l.disabled=d=r[5].length<3,ke(_,"class","secondary"),Ai(i,"display","flex"),ke(E,"class","secondary"),E.disabled=A=r[8].length==0,ke(e,"slot","sidebar")},m(Ne,re){ae(Ne,e,re),j&&j.m(e,null),G(e,t),G(e,i),G(i,l),G(l,u),G(i,a),G(i,_),G(i,v),Ee(k,i,null),G(e,S),G(e,E),he.m(E,null),G(e,D),ye.m(e,null),B=!0,P||(R=[St(l,"click",function(){ec(r[0])&&r[0].apply(this,arguments)}),St(_,"click",function(){ec(r[1])&&r[1].apply(this,arguments)}),St(E,"click",r[11])],P=!0)},p(Ne,re){r=Ne,j&&j.p&&(!B||re[1]&128)&&Zi(j,F,r,r[38],B?qi(F,r[38],re,I5):Gi(r[38]),Cy),(!B||re[0]&32&&d!==(d=r[5].length<3))&&(l.disabled=d);const ve={};re[1]&128&&(ve.$$scope={dirty:re,ctx:r}),k.$set(ve),le===(le=U(r))&&he?he.p(r,re):(he.d(1),he=le(r),he&&(he.c(),he.m(E,null))),(!B||re[0]&256&&A!==(A=r[8].length==0))&&(E.disabled=A),Q===(Q=Z(r))&&ye?ye.p(r,re):(ye.d(1),ye=Q(r),ye&&(ye.c(),ye.m(e,null)))},i(Ne){B||(J(j,Ne),J(k.$$.fragment,Ne),B=!0)},o(Ne){ne(j,Ne),ne(k.$$.fragment,Ne),B=!1},d(Ne){Ne&&se(e),j&&j.d(Ne),Me(k),he.d(),ye.d(),P=!1,hn(R)}}}function F5(r){let e;return{c(){e=oe("span"),ke(e,"class","dot svelte-1cj4rwq"),cr(e,"snapped-node",r[47].snapped),cr(e,"free-node",!r[47].snapped),cr(e,"hide",r[4])},m(t,i){ae(t,e,i)},p(t,i){i[0]&512&&cr(e,"snapped-node",t[47].snapped),i[0]&512&&cr(e,"free-node",!t[47].snapped),i[0]&16&&cr(e,"hide",t[4])},d(t){t&&se(e)}}}function Iy(r){let e,t,i;function l(v){r[25](v,r[47])}function u(){return r[26](r[47])}function d(){return r[27](r[47])}function a(){return r[28](r[47])}let _={draggable:!0,zIndex:0,$$slots:{default:[F5]},$$scope:{ctx:r}};return r[47].point!==void 0&&(_.lngLat=r[47].point),e=new Rd({props:_}),on.push(()=>Wr(e,"lngLat",l)),e.$on("dragstart",u),e.$on("drag",d),e.$on("dragend",r[19]),e.$on("click",a),{c(){Ie(e.$$.fragment)},m(v,k){Ee(e,v,k),i=!0},p(v,k){r=v;const S={};k[0]&528|k[1]&128&&(S.$$scope={dirty:k,ctx:r}),!t&&k[0]&512&&(t=!0,S.lngLat=r[47].point,Gr(()=>t=!1)),e.$set(S)},i(v){i||(J(e.$$.fragment,v),i=!0)},o(v){ne(e.$$.fragment,v),i=!1},d(v){Me(e,v)}}}function O5(r){let e;return{c(){e=oe("span"),e.textContent=`${r[46]+1}`,ke(e,"class","dot svelte-1cj4rwq"),cr(e,"snapped",r[44].snapped)},m(t,i){ae(t,e,i)},p(t,i){i[0]&32&&cr(e,"snapped",t[44].snapped)},d(t){t&&se(e)}}}function Ly(r){let e,t,i;function l(_){r[29](_,r[44])}function u(){return r[30](r[46])}function d(){return r[31](r[46])}let a={draggable:!0,zIndex:1,$$slots:{default:[O5]},$$scope:{ctx:r}};return r[44].point!==void 0&&(a.lngLat=r[44].point),e=new Rd({props:a}),on.push(()=>Wr(e,"lngLat",l)),e.$on("click",u),e.$on("contextmenu",d),e.$on("mouseenter",r[32]),e.$on("mouseleave",r[33]),e.$on("dragstart",r[21]),e.$on("dragend",r[34]),{c(){Ie(e.$$.fragment)},m(_,v){Ee(e,_,v),i=!0},p(_,v){r=_;const k={};v[0]&32|v[1]&128&&(k.$$scope={dirty:v,ctx:r}),!t&&v[0]&32&&(t=!0,k.lngLat=r[44].point,Gr(()=>t=!1)),e.$set(k)},i(_){i||(J(e.$$.fragment,_),i=!0)},o(_){ne(e.$$.fragment,_),i=!1},d(_){Me(e,_)}}}function N5(r){let e,t,i,l;const u=[un("draw-area-lines"),{paint:{"line-color":"black","line-width":10}}];let d={};for(let v=0;v<u.length;v+=1)d=rn(d,u[v]);e=new Hr({props:d});const a=[un("draw-area-preview"),{paint:{"fill-color":"grey","fill-opacity":.5}}];let _={};for(let v=0;v<a.length;v+=1)_=rn(_,a[v]);return i=new Es({props:_}),{c(){Ie(e.$$.fragment),t=Ae(),Ie(i.$$.fragment)},m(v,k){Ee(e,v,k),ae(v,t,k),Ee(i,v,k),l=!0},p(v,k){const S={};e.$set(S);const E={};i.$set(E)},i(v){l||(J(e.$$.fragment,v),J(i.$$.fragment,v),l=!0)},o(v){ne(e.$$.fragment,v),ne(i.$$.fragment,v),l=!1},d(v){v&&se(t),Me(e,v),Me(i,v)}}}function j5(r){let e,t;return e=new Hr({props:{paint:{"line-color":"black","line-width":3}}}),{c(){Ie(e.$$.fragment)},m(i,l){Ee(e,i,l),t=!0},p:It,i(i){t||(J(e.$$.fragment,i),t=!0)},o(i){ne(e.$$.fragment,i),t=!1},d(i){Me(e,i)}}}function U5(r){let e,t,i,l,u,d,a,_,v;t=new M0({}),t.$on("click",r[12]),t.$on("mousemove",r[13]);let k=Tn(r[9]),S=[];for(let P=0;P<k.length;P+=1)S[P]=Iy(My(r,k,P));const E=P=>ne(S[P],1,1,()=>{S[P]=null});let A=Tn(r[5]),D=[];for(let P=0;P<A.length;P+=1)D[P]=Ly(Ey(r,A,P));const B=P=>ne(D[P],1,1,()=>{D[P]=null});return d=new ur({props:{data:r[16](r[6],r[5]),generateId:!0,$$slots:{default:[N5]},$$scope:{ctx:r}}}),_=new ur({props:{data:r[10],$$slots:{default:[j5]},$$scope:{ctx:r}}}),{c(){e=oe("div"),Ie(t.$$.fragment),i=Ae();for(let P=0;P<S.length;P+=1)S[P].c();l=Ae();for(let P=0;P<D.length;P+=1)D[P].c();u=Ae(),Ie(d.$$.fragment),a=Ae(),Ie(_.$$.fragment),ke(e,"slot","map")},m(P,R){ae(P,e,R),Ee(t,e,null),G(e,i);for(let F=0;F<S.length;F+=1)S[F]&&S[F].m(e,null);G(e,l);for(let F=0;F<D.length;F+=1)D[F]&&D[F].m(e,null);G(e,u),Ee(d,e,null),G(e,a),Ee(_,e,null),v=!0},p(P,R){if(R[0]&918032){k=Tn(P[9]);let U;for(U=0;U<k.length;U+=1){const le=My(P,k,U);S[U]?(S[U].p(le,R),J(S[U],1)):(S[U]=Iy(le),S[U].c(),J(S[U],1),S[U].m(e,l))}for(yi(),U=k.length;U<S.length;U+=1)E(U);vi()}if(R[0]&2146348){A=Tn(P[5]);let U;for(U=0;U<A.length;U+=1){const le=Ey(P,A,U);D[U]?(D[U].p(le,R),J(D[U],1)):(D[U]=Ly(le),D[U].c(),J(D[U],1),D[U].m(e,u))}for(yi(),U=A.length;U<D.length;U+=1)B(U);vi()}const F={};R[0]&96&&(F.data=P[16](P[6],P[5])),R[1]&128&&(F.$$scope={dirty:R,ctx:P}),d.$set(F);const j={};R[0]&1024&&(j.data=P[10]),R[1]&128&&(j.$$scope={dirty:R,ctx:P}),_.$set(j)},i(P){if(!v){J(t.$$.fragment,P);for(let R=0;R<k.length;R+=1)J(S[R]);for(let R=0;R<A.length;R+=1)J(D[R]);J(d.$$.fragment,P),J(_.$$.fragment,P),v=!0}},o(P){ne(t.$$.fragment,P),S=S.filter(Boolean);for(let R=0;R<S.length;R+=1)ne(S[R]);D=D.filter(Boolean);for(let R=0;R<D.length;R+=1)ne(D[R]);ne(d.$$.fragment,P),ne(_.$$.fragment,P),v=!1},d(P){P&&se(e),Me(t),$o(S,P),$o(D,P),Me(d),Me(_)}}}function V5(r){let e,t,i,l;return e=new Po({props:{$$slots:{map:[U5],sidebar:[B5],top:[L5]},$$scope:{ctx:r}}}),{c(){Ie(e.$$.fragment)},m(u,d){Ee(e,u,d),t=!0,i||(l=St(E5,"keydown",r[20]),i=!0)},p(u,d){const a={};d[0]&2047|d[1]&128&&(a.$$scope={dirty:d,ctx:u}),e.$set(a)},i(u){t||(J(e.$$.fragment,u),t=!0)},o(u){ne(e.$$.fragment,u),t=!1},d(u){Me(e,u),i=!1,l()}}}function $5(r,e,t){let i,l,u;lt(r,To,ut=>t(5,l=ut)),lt(r,sc,ut=>t(6,u=ut));let{$$slots:d={},$$scope:a}=e,{map:_}=e,{finish:v}=e,{cancel:k}=e;er(()=>{Tt(To,l=[],l),u==null||u.stop(),_.getCanvas().style.cursor="inherit"});let S="snap",E=[],A=[],D=null,B=!1,P=!1,R=!1;function F(ut){let Dt=ut.length==0?"crosshair":"inherit";_.getCanvas().style.cursor=Dt}function j(){let ut=E.pop();t(8,E),ut&&Tt(To,l=ut,l)}function U(){E.length==100&&E.shift(),t(8,E=[...E,JSON.parse(JSON.stringify(l))])}function le(){t(7,S=S=="snap"?"free":"snap"),D&&t(23,D.snapped=S=="snap",D)}function he(ut){l.length>=3||(U(),To.update(Dt=>(Dt.push({point:ut.detail.lngLat.toArray(),snapped:S=="snap"}),Dt)))}function Z(ut){t(23,D={point:ut.detail.lngLat.toArray(),snapped:S=="snap"})}function Q(ut){U(),To.update(Dt=>(Dt[ut].snapped=!Dt[ut].snapped,Dt))}function ye(ut){U(),To.update(Dt=>(Dt.splice(ut,1),Dt)),t(2,B=!1)}function Ne(ut,Dt){try{if(ut)return r1(Dt)}catch{}return Ql()}function re(ut,Dt,Fe,je){if(je||Dt.length>=3)return Ql();try{if(ut&&Dt.length>0&&Fe)return JSON.parse(ut.inner.calculateRoute([Dt[Dt.length-1],Fe]))}catch{}return Ql()}function ve(ut,Dt,Fe){if(Fe)return;if(!ut||Dt.length<3){t(9,A=[]);return}let je=[],ht=1,vt=JSON.parse(JSON.stringify(Dt));vt.push(vt[0]);for(let we=0;we<vt.length-1;we++){let Ei=JSON.parse(ut.inner.getExtraNodes(vt[we],vt[we+1]));for(let[qe,Ye,Ot]of Ei)je.push({point:[qe,Ye],snapped:Ot,insertIdx:ht});ht++}t(9,A=je)}function Ke(ut){U(),To.update(Dt=>(Dt.splice(ut.insertIdx,0,{point:ut.point,snapped:ut.snapped}),Dt)),t(4,R=!0)}function Le(ut){To.update(Dt=>(Dt[ut.insertIdx].point=ut.point,Dt))}function et(){t(4,R=!1)}function xt(ut){let Dt=ut.target.tagName,Fe=Dt=="INPUT"||Dt=="TEXTAREA";ut.key=="Enter"&&!Fe||ut.key=="Escape"?(ut.stopPropagation(),l.length>=3?v():window.alert("You can't save this area unless it has at least three points. Press 'Cancel' to discard these changes.")):ut.key=="s"&&!Fe?le():ut.key=="z"&&ut.ctrlKey&&(ut.stopPropagation(),j())}function mt(){U(),t(3,P=!0)}const at=[[]];function Ht(ut,Dt){r.$$.not_equal(Dt.point,ut)&&(Dt.point=ut,t(9,A))}const ri=ut=>Ke(ut),Nt=ut=>Le(ut),At=ut=>{Ke(ut),t(4,R=!1)};function ei(ut,Dt){r.$$.not_equal(Dt.point,ut)&&(Dt.point=ut,To.set(l))}const ci=ut=>Q(ut),ti=ut=>ye(ut),ft=()=>t(2,B=!0),Jt=()=>t(2,B=!1),gi=()=>t(3,P=!1);function zi(){S=this.__value,t(7,S)}function Fi(){S=this.__value,t(7,S)}return r.$$set=ut=>{"map"in ut&&t(22,_=ut.map),"finish"in ut&&t(0,v=ut.finish),"cancel"in ut&&t(1,k=ut.cancel),"$$scope"in ut&&t(38,a=ut.$$scope)},r.$$.update=()=>{r.$$.dirty[0]&112&&ve(u,l,R),r.$$.dirty[0]&8388716&&t(10,i=re(u,l,D,B||P)),r.$$.dirty[0]&32&&F(l)},[v,k,B,P,R,l,u,S,E,A,i,j,he,Z,Q,ye,Ne,Ke,Le,et,xt,mt,_,D,d,Ht,ri,Nt,At,ei,ci,ti,ft,Jt,gi,zi,at,Fi,a]}class q5 extends Vt{constructor(e){super(),Ut(this,e,$5,V5,zt,{map:22,finish:0,cancel:1},null,[-1,-1])}}function Z5(r){let e;return{c(){e=Ve("Choose project")},m(t,i){ae(t,e,i)},d(t){t&&se(e)}}}function G5(r){let e;return{c(){e=Ve("Pick neighbourhood")},m(t,i){ae(t,e,i)},d(t){t&&se(e)}}}function W5(r){let e;return{c(){e=oe("li"),e.textContent="Creating new neighbourhood boundary"},m(t,i){ae(t,e,i)},p:It,i:It,o:It,d(t){t&&se(e)}}}function H5(r){let e,t,i,l,u;return t=new Ii({props:{$$slots:{default:[X5]},$$scope:{ctx:r}}}),t.$on("click",r[8]),{c(){e=oe("li"),Ie(t.$$.fragment),i=Ae(),l=oe("li"),l.textContent="Changing neighbourhood boundary"},m(d,a){ae(d,e,a),Ee(t,e,null),ae(d,i,a),ae(d,l,a),u=!0},p(d,a){const _={};a&4096&&(_.$$scope={dirty:a,ctx:d}),t.$set(_)},i(d){u||(J(t.$$.fragment,d),u=!0)},o(d){ne(t.$$.fragment,d),u=!1},d(d){d&&(se(e),se(i),se(l)),Me(t)}}}function X5(r){let e;return{c(){e=Ve("Editing")},m(t,i){ae(t,e,i)},d(t){t&&se(e)}}}function K5(r){let e,t,i,l,u,d,a,_,v,k,S,E;u=new Ii({props:{$$slots:{default:[Z5]},$$scope:{ctx:r}}}),u.$on("click",r[6]),_=new Ii({props:{$$slots:{default:[G5]},$$scope:{ctx:r}}}),_.$on("click",r[7]);const A=[H5,W5],D=[];function B(P,R){return P[1]?0:1}return k=B(r),S=D[k]=A[k](r),{c(){e=oe("div"),t=oe("nav"),i=oe("ul"),l=oe("li"),Ie(u.$$.fragment),d=Ae(),a=oe("li"),Ie(_.$$.fragment),v=Ae(),S.c(),ke(t,"aria-label","breadcrumb"),ke(e,"slot","extra-top")},m(P,R){ae(P,e,R),G(e,t),G(t,i),G(i,l),Ee(u,l,null),G(i,d),G(i,a),Ee(_,a,null),G(i,v),D[k].m(i,null),E=!0},p(P,R){const F={};R&4096&&(F.$$scope={dirty:R,ctx:P}),u.$set(F);const j={};R&4096&&(j.$$scope={dirty:R,ctx:P}),_.$set(j);let U=k;k=B(P),k===U?D[k].p(P,R):(yi(),ne(D[U],1,1,()=>{D[U]=null}),vi(),S=D[k],S?S.p(P,R):(S=D[k]=A[k](P),S.c()),J(S,1),S.m(i,null))},i(P){E||(J(u.$$.fragment,P),J(_.$$.fragment,P),J(S),E=!0)},o(P){ne(u.$$.fragment,P),ne(_.$$.fragment,P),ne(S),E=!1},d(P){P&&se(e),Me(u),Me(_),D[k].d()}}}function J5(r){let e,t,i,l;return{c(){e=oe("div"),t=oe("h1"),i=Ve("Draw your neighbourhood boundary for "),l=Ve(r[0]),ke(e,"slot","extra-sidebar")},m(u,d){ae(u,e,d),G(e,t),G(t,i),G(t,l)},p(u,d){d&1&&si(l,u[0])},d(u){u&&se(e)}}}function Y5(r){let e,t;return e=new q5({props:{map:vr(r[3]),finish:r[4],cancel:r[5],$$slots:{"extra-sidebar":[J5],"extra-top":[K5]},$$scope:{ctx:r}}}),{c(){Ie(e.$$.fragment)},m(i,l){Ee(e,i,l),t=!0},p(i,[l]){const u={};l&8&&(u.map=vr(i[3])),l&4103&&(u.$$scope={dirty:l,ctx:i}),e.$set(u)},i(i){t||(J(e.$$.fragment,i),t=!0)},o(i){ne(e.$$.fragment,i),t=!1},d(i){Me(e,i)}}}function Q5(r,e,t){let i,l,u,d,a;lt(r,Wt,B=>t(2,i=B)),lt(r,Fu,B=>t(9,l=B)),lt(r,Dn,B=>t(10,u=B)),lt(r,To,B=>t(11,d=B)),lt(r,qo,B=>t(3,a=B));let{name:_}=e,{existing:v}=e;v&&(v.properties.waypoints?Tt(To,d=v.properties.waypoints.map(B=>({point:[B.lon,B.lat],snapped:B.snapped})),d):Tt(To,d=v.geometry.coordinates[0].slice(1).map(B=>({point:B,snapped:!1})),d));function k(){if(d.length>=3)try{let B=r1(d);u.setNeighbourhoodBoundary(_,B),oc(),u.setCurrentNeighbourhood(_,l),Tt(Wt,i={mode:"neighbourhood"},i)}catch{window.alert("Known georust bug hit, sorry. You may need to just refresh the page now."),S()}}function S(){v?Tt(Wt,i={mode:"neighbourhood"},i):Tt(Wt,i={mode:"network"},i)}const E=()=>Tt(Wt,i={mode:"title",firstLoad:!1},i),A=()=>Tt(Wt,i={mode:"network"},i),D=()=>Tt(Wt,i={mode:"neighbourhood"},i);return r.$$set=B=>{"name"in B&&t(0,_=B.name),"existing"in B&&t(1,v=B.existing)},[_,v,i,a,k,S,E,A,D]}class eC extends Vt{constructor(e){super(),Ut(this,e,Q5,Y5,zt,{name:0,existing:1})}}const tC="/ltn/assets/settings-342fb430.svg";function Ay(r){let e,t;return e=new Ad({props:{$$slots:{default:[iC]},$$scope:{ctx:r}}}),e.$on("close",r[5]),{c(){Ie(e.$$.fragment)},m(i,l){Ee(e,i,l),t=!0},p(i,l){const u={};l&67&&(u.$$scope={dirty:l,ctx:i}),e.$set(u)},i(i){t||(J(e.$$.fragment,i),t=!0)},o(i){ne(e.$$.fragment,i),t=!1},d(i){Me(e,i)}}}function iC(r){let e,t,i,l,u,d,a,_,v,k,S,E,A;return i=new Q4({}),{c(){e=oe("h1"),e.textContent="Settings",t=Ae(),Ie(i.$$.fragment),l=Ae(),u=oe("label"),d=oe("input"),a=Ve(`
      Road thickness depends on shortcuts`),_=Ae(),v=oe("center"),k=oe("button"),k.textContent="Confirm",ke(d,"type","checkbox")},m(D,B){ae(D,e,B),ae(D,t,B),Ee(i,D,B),ae(D,l,B),ae(D,u,B),G(u,d),d.checked=r[1],G(u,a),ae(D,_,B),ae(D,v,B),G(v,k),S=!0,E||(A=[St(d,"change",r[3]),St(k,"click",r[4])],E=!0)},p(D,B){B&2&&(d.checked=D[1])},i(D){S||(J(i.$$.fragment,D),S=!0)},o(D){ne(i.$$.fragment,D),S=!1},d(D){D&&(se(e),se(t),se(l),se(u),se(_),se(v)),Me(i,D),E=!1,hn(A)}}}function nC(r){let e,t,i,l,u,d,a=r[0]&&Ay(r);return{c(){e=oe("button"),e.innerHTML=`<img src="${tC}" alt="Settings"/>`,t=Ae(),a&&a.c(),i=En(),ke(e,"class","outline")},m(_,v){ae(_,e,v),ae(_,t,v),a&&a.m(_,v),ae(_,i,v),l=!0,u||(d=St(e,"click",r[2]),u=!0)},p(_,[v]){_[0]?a?(a.p(_,v),v&1&&J(a,1)):(a=Ay(_),a.c(),J(a,1),a.m(i.parentNode,i)):a&&(yi(),ne(a,1,1,()=>{a=null}),vi())},i(_){l||(J(a),l=!0)},o(_){ne(a),l=!1},d(_){_&&(se(e),se(t),se(i)),a&&a.d(_),u=!1,d()}}}function rC(r,e,t){let i;lt(r,dp,v=>t(1,i=v));let l=!1;const u=()=>t(0,l=!0);function d(){i=this.checked,dp.set(i)}return[l,i,u,d,()=>t(0,l=!1),()=>t(0,l=!1)]}class oC extends Vt{constructor(e){super(),Ut(this,e,rC,nC,zt,{})}}const sC=["==",["geometry-type"],"Polygon"],aC=["==",["geometry-type"],"LineString"],lC=["==",["geometry-type"],"Point"];function o1(){return{type:"FeatureCollection",features:[]}}function ip(r){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:s1(r)}}}function s1(r){return[Math.round(r[0]*1e7)/1e7,Math.round(r[1]*1e7)/1e7]}const a1=ki(o1()),l1=ki(0),cC=100;class uC{constructor(e){Un(this,"map");Un(this,"active");Un(this,"eventListenersSuccess");Un(this,"eventListenersUpdated");Un(this,"eventListenersFailure");Un(this,"points");Un(this,"cursor");Un(this,"hover");Un(this,"dragFrom");Un(this,"previousStates");Un(this,"onMouseMove",e=>{if(this.active&&!this.dragFrom)this.recalculateHovering(e);else if(this.active&&this.dragFrom){if(this.hover=="polygon"){let t=this.dragFrom[0]-e.lngLat.lng,i=this.dragFrom[1]-e.lngLat.lat;for(let l of this.points)l[0]-=t,l[1]-=i}else this.points[this.hover]=e.lngLat.toArray();this.dragFrom=e.lngLat.toArray(),this.redraw()}});Un(this,"onClick",e=>{if(this.beforeUpdate(),this.active&&this.cursor){let t=[];if(Py(this.points).forEach((i,l)=>{t.push([l+1,Sw(i,this.cursor).properties.dist])}),t.sort((i,l)=>i[1]-l[1]),t.length>0){let i=t[0][0];this.points.splice(i,0,this.cursor.geometry.coordinates),this.hover=i}else this.points.push(this.cursor.geometry.coordinates),this.hover=this.points.length-1;this.redraw(),this.pointsUpdated()}else this.active&&typeof this.hover=="number"&&(this.points.splice(this.hover,1),this.hover=null,this.redraw(),this.pointsUpdated(),this.recalculateHovering(e))});Un(this,"onDoubleClick",e=>{this.active&&(e.preventDefault(),this.cursor=ip(e.lngLat.toArray()),this.onClick(e),this.finish())});Un(this,"onMouseDown",e=>{this.active&&!this.dragFrom&&this.hover!=null&&(e.preventDefault(),this.cursor=null,this.dragFrom=e.lngLat.toArray(),this.beforeUpdate(),this.redraw())});Un(this,"onMouseUp",()=>{this.active&&this.dragFrom&&(this.dragFrom=null,this.redraw(),this.pointsUpdated())});Un(this,"onKeypress",e=>{this.active&&(e.key=="Enter"?(e.stopPropagation(),this.finish()):e.key=="z"&&e.ctrlKey&&this.undo())});Un(this,"onKeyDown",e=>{this.active&&e.key=="Escape"&&(e.stopPropagation(),this.cancel())});this.map=e,this.active=!1,this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[],this.points=[],this.cursor=null,this.hover=null,this.dragFrom=null,this.previousStates=[],this.map.on("mousemove",this.onMouseMove),this.map.on("click",this.onClick),this.map.on("dblclick",this.onDoubleClick),this.map.on("mousedown",this.onMouseDown),this.map.on("mouseup",this.onMouseUp),document.addEventListener("keypress",this.onKeypress),document.addEventListener("keydown",this.onKeyDown)}tearDown(){this.map.off("mousemove",this.onMouseMove),this.map.off("click",this.onClick),this.map.off("dblclick",this.onDoubleClick),this.map.off("mousedown",this.onMouseDown),this.map.off("mouseup",this.onMouseUp),document.removeEventListener("keypress",this.onKeypress),document.removeEventListener("keydown",this.onKeyDown)}finish(){let e=this.polygonFeature();if(e)for(let t of this.eventListenersSuccess)t(e);else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){for(let e of this.eventListenersFailure)e();this.stop()}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerUpdated(e){this.eventListenersUpdated.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}clearEventListeners(){this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[]}startNew(){this.active=!0,this.map.doubleClickZoom.disable()}editExisting(e){this.active=!0,this.map.doubleClickZoom.disable(),this.points=JSON.parse(JSON.stringify(e.geometry.coordinates[0])),this.points.pop(),this.redraw()}stop(){this.map.doubleClickZoom.enable(),this.points=[],this.cursor=null,this.active=!1,this.hover=null,this.dragFrom=null,this.previousStates=[],this.redraw(),this.map.getCanvas().style.cursor="inherit"}undo(){this.dragFrom!=null||this.previousStates.length==0||(this.points=this.previousStates.pop(),this.hover=null,this.redraw())}redraw(){let e=o1();this.points.forEach((l,u)=>{let d=ip(l);d.properties.hover=this.hover==u,d.properties.idx=u,e.features.push(d)}),e.features=e.features.concat(Py(this.points));let t=this.polygonFeature();t&&(t.properties.hover=this.hover=="polygon",e.features.push(t)),a1.set(e);let i="crosshair";this.hover!=null&&(i=this.dragFrom?"grabbing":"pointer"),this.map.getCanvas().style.cursor=i,l1.set(this.previousStates.length)}pointsUpdated(){let e=this.polygonFeature();if(e)for(let t of this.eventListenersUpdated)t(e)}recalculateHovering(e){this.cursor=null,this.hover=null;for(let t of this.map.queryRenderedFeatures(e.point,{layers:["edit-polygon-fill","edit-polygon-vertices"]}))if(t.geometry.type=="Polygon"){this.hover="polygon";break}else if(t.geometry.type=="Point"&&Object.hasOwn(t.properties,"idx")){this.hover=t.properties.idx;break}this.hover==null&&(this.cursor=ip(e.lngLat.toArray())),this.redraw()}polygonFeature(){if(this.points.length<3)return null;let e=this.points.map(s1),t=[JSON.parse(JSON.stringify(e))];return t[0].push(JSON.parse(JSON.stringify(t[0][0]))),{type:"Feature",geometry:{type:"Polygon",coordinates:t},properties:{}}}beforeUpdate(){this.previousStates.push(JSON.parse(JSON.stringify(this.points))),this.previousStates.length>cC&&this.previousStates.shift()}}function Py(r){let e=[];for(let t=0;t<r.length-1;t++)e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[t],r[t+1]]},properties:{}});return r.length>=3&&e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[r.length-1],r[0]]},properties:{}}),e}function hC(r){let e,t,i;return{c(){e=Ve("Undo ("),t=Ve(r[1]),i=Ve(")")},m(l,u){ae(l,e,u),ae(l,t,u),ae(l,i,u)},p(l,u){u&2&&si(t,l[1])},d(l){l&&(se(e),se(t),se(i))}}}function dC(r){let e;return{c(){e=Ve("Undo")},m(t,i){ae(t,e,i)},p:It,d(t){t&&se(e)}}}function fC(r){let e,t,i,l,u,d,a,_,v,k,S;function E(B,P){return B[1]==0?dC:hC}let A=E(r),D=A(r);return{c(){e=oe("div"),t=oe("button"),t.textContent="Finish",i=Ae(),l=oe("button"),l.textContent="Cancel",u=Ae(),d=oe("button"),D.c(),_=Ae(),v=oe("ul"),v.innerHTML=`<li><b>Click</b>
    the map to add a vertex</li> <li><b>Click</b>
    a vertex to delete it</li> <li><b>Drag</b>
    a vertex or the polygon to move it</li> <li>Press <b>Control+Z</b>
    to undo your last change</li> <li>Press <b>Enter</b>
    or
    <b>double click</b>
    to finish</li> <li>Press <b>Escape</b>
    to cancel</li>`,d.disabled=a=r[1]==0,Ai(e,"display","flex"),Ai(e,"justify-content","space-between")},m(B,P){ae(B,e,P),G(e,t),G(e,i),G(e,l),G(e,u),G(e,d),D.m(d,null),ae(B,_,P),ae(B,v,P),k||(S=[St(t,"click",r[2]),St(l,"click",r[3]),St(d,"click",r[4])],k=!0)},p(B,[P]){A===(A=E(B))&&D?D.p(B,P):(D.d(1),D=A(B),D&&(D.c(),D.m(d,null))),P&2&&a!==(a=B[1]==0)&&(d.disabled=a)},i:It,o:It,d(B){B&&(se(e),se(_),se(v)),D.d(),k=!1,hn(S)}}}function pC(r,e,t){let i;lt(r,l1,_=>t(1,i=_));let{polygonTool:l}=e;const u=()=>l.finish(),d=()=>l.cancel(),a=()=>l.undo();return r.$$set=_=>{"polygonTool"in _&&t(0,l=_.polygonTool)},[l,i,u,d,a]}class mC extends Vt{constructor(e){super(),Ut(this,e,pC,fC,zt,{polygonTool:0})}}let gC=Date.now();function Ju(r){return`${r}-${gC++}`}const c1=Symbol.for("svelte-maplibre");function _C(){return Ld(c1)}function zy(r){return{subscribe:r.subscribe}}function u1({key:r,setPopupTarget:e=!1,setCluster:t=!1,setMouseEvent:i=!1}){let l=_C(),u=ki(null),d=zy(u),a={...l,[r]:zy(u)};if(e&&(a.popupTarget=d),i){let _=ki(null);a.layerEvent=_,l.layerEvent=_}return t&&(a.cluster=ki()),Id(c1,a),{...l,self:u}}function yC(){return u1({key:"source",setCluster:!0})}function vC(r=!0){return u1({key:"layer",setPopupTarget:r,setMouseEvent:r})}function Dy(r){let e;return t=>{if(t)for(let i in t){let l=e==null?void 0:e[i],u=t[i];l!==u&&r(i,u,l)}else if(e)for(let i in e)r(i,void 0,e[i]);e=t}}function bC(r,...e){let t=[r];for(let i of e)if(i)Array.isArray(i)&&i[0]===r?t.push(...i.slice(1)):t.push(i);else continue;if(t.length!==1)return t.length===2?t[1]:t}function wC(r){return r===!0?["has","point_count"]:r===!1?["!",["has","point_count"]]:void 0}function Ry(r){let e=r[0],t,i,l=By(r);return{c(){l.c(),t=En()},m(u,d){l.m(u,d),ae(u,t,d),i=!0},p(u,d){d[0]&1&&zt(e,e=u[0])?(yi(),ne(l,1,1,It),vi(),l=By(u),l.c(),J(l,1),l.m(t.parentNode,t)):l.p(u,d)},i(u){i||(J(l),i=!0)},o(u){ne(l),i=!1},d(u){u&&se(t),l.d(u)}}}function By(r){let e;const t=r[36].default,i=$i(t,r,r[35],null);return{c(){i&&i.c()},m(l,u){i&&i.m(l,u),e=!0},p(l,u){i&&i.p&&(!e||u[1]&16)&&Zi(i,t,l,l[35],e?qi(t,l[35],u,null):Gi(l[35]),null)},i(l){e||(J(i,l),e=!0)},o(l){ne(i,l),e=!1},d(l){i&&i.d(l)}}}function xC(r){let e,t,i=r[0]&&Ry(r);return{c(){i&&i.c(),e=En()},m(l,u){i&&i.m(l,u),ae(l,e,u),t=!0},p(l,u){l[0]?i?(i.p(l,u),u[0]&1&&J(i,1)):(i=Ry(l),i.c(),J(i,1),i.m(e.parentNode,e)):i&&(yi(),ne(i,1,1,()=>{i=null}),vi())},i(l){t||(J(i),t=!0)},o(l){ne(i),t=!1},d(l){l&&se(e),i&&i.d(l)}}}function kC(r,e,t){let i,l,u,d,a,_,v,k,S,E,A,D,{$$slots:B={},$$scope:P}=e,{id:R=Ju("layer")}=e,{source:F=void 0}=e,{sourceLayer:j=void 0}=e,{beforeId:U=void 0}=e,{beforeLayerType:le=void 0}=e,{type:he}=e,{paint:Z=void 0}=e,{layout:Q=void 0}=e,{filter:ye=void 0}=e,{applyToClusters:Ne=void 0}=e,{minzoom:re=void 0}=e,{maxzoom:ve=void 0}=e,{manageHoverState:Ke=!1}=e,{hovered:Le=null}=e,{interactive:et=!0}=e,{hoverCursor:xt=void 0}=e,{eventsIfTopMost:mt=!1}=e;const at=rs(),{map:Ht,source:ri,self:Nt,minzoom:At,maxzoom:ei,eventTopMost:ci,layerInfo:ti}=vC();lt(r,Ht,Fe=>t(31,S=Fe)),lt(r,ri,Fe=>t(32,E=Fe)),lt(r,Nt,Fe=>t(0,k=Fe)),lt(r,At,Fe=>t(34,D=Fe)),lt(r,ei,Fe=>t(33,A=Fe)),er(()=>{k&&S&&(ti.delete(k),S==null||S.removeLayer(k))});let ft;function Jt(Fe){var we,Ei;if(!et||!k||!S||mt&&ci(Fe)!==k)return;let je=Fe.features??[],ht=(Ei=(we=je[0])==null?void 0:we.properties)==null?void 0:Ei.cluster_id,vt={event:Fe,map:S,clusterId:ht,layer:k,source:a,features:je};at(Fe.type,vt)}function gi(Fe){var we,Ei;if(!et||!k||!S||mt&&ci(Fe)!==k)return;xt&&(S.getCanvas().style.cursor=xt);let je=Fe.features??[];t(6,Le=je[0]??null);let ht=(Ei=(we=je[0])==null?void 0:we.properties)==null?void 0:Ei.cluster_id;at("mouseenter",{event:Fe,map:S,clusterId:ht,layer:k,source:a,features:je})}function zi(Fe){var we,Ei,qe;if(!et||!S)return;if(mt&&ci(Fe)!==k){t(6,Le=null),Ke&&ft!==void 0&&(S==null||S.setFeatureState({source:a,sourceLayer:j,id:ft},{hover:!1}),ft=void 0);return}S.getCanvas().style.cursor=xt;let je=Fe.features??[],ht=(Ei=(we=je[0])==null?void 0:we.properties)==null?void 0:Ei.cluster_id,vt=(qe=je[0])==null?void 0:qe.id;vt!==ft&&(Ke&&(ft!==void 0&&(S==null||S.setFeatureState({source:a,id:ft,sourceLayer:j},{hover:!1})),S==null||S.setFeatureState({source:a,id:vt,sourceLayer:j},{hover:!0})),ft=vt,t(6,Le=je[0]??null)),at("mousemove",{event:Fe,map:S,clusterId:ht,layer:k,source:a,features:je})}function Fi(Fe){if(!(!et||!k||!S)){if(xt&&(S.getCanvas().style.cursor=""),t(6,Le=null),Ke&&ft!==void 0){const je={source:a,id:ft,sourceLayer:j};S==null||S.setFeatureState(je,{hover:!1}),ft=void 0}at("mouseleave",{map:S,layer:k,source:a})}}let ut=!0;function Dt(Fe){S&&(S.off("click",Fe,Jt),S.off("dblclick",Fe,Jt),S.off("contextmenu",Fe,Jt),S.off("mouseenter",Fe,gi),S.off("mousemove",Fe,zi),S.off("mouseleave",Fe,Fi))}return er(()=>{S&&k&&Dt(k)}),r.$$set=Fe=>{"id"in Fe&&t(7,R=Fe.id),"source"in Fe&&t(8,F=Fe.source),"sourceLayer"in Fe&&t(9,j=Fe.sourceLayer),"beforeId"in Fe&&t(10,U=Fe.beforeId),"beforeLayerType"in Fe&&t(11,le=Fe.beforeLayerType),"type"in Fe&&t(12,he=Fe.type),"paint"in Fe&&t(13,Z=Fe.paint),"layout"in Fe&&t(14,Q=Fe.layout),"filter"in Fe&&t(15,ye=Fe.filter),"applyToClusters"in Fe&&t(16,Ne=Fe.applyToClusters),"minzoom"in Fe&&t(17,re=Fe.minzoom),"maxzoom"in Fe&&t(18,ve=Fe.maxzoom),"manageHoverState"in Fe&&t(19,Ke=Fe.manageHoverState),"hovered"in Fe&&t(6,Le=Fe.hovered),"interactive"in Fe&&t(20,et=Fe.interactive),"hoverCursor"in Fe&&t(21,xt=Fe.hoverCursor),"eventsIfTopMost"in Fe&&t(22,mt=Fe.eventsIfTopMost),"$$scope"in Fe&&t(35,P=Fe.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&65536&&t(30,i=wC(Ne)),r.$$.dirty[0]&1073774592&&t(24,l=bC("all",i,ye)),r.$$.dirty[0]&131072|r.$$.dirty[1]&8&&t(26,u=re??D),r.$$.dirty[0]&262144|r.$$.dirty[1]&4&&t(25,d=ve??A),r.$$.dirty[0]&256|r.$$.dirty[1]&2&&t(29,a=F||E),r.$$.dirty[0]&654343809|r.$$.dirty[1]&1&&S&&k!==R&&a){k&&(Dt(k),ti.delete(k));let Fe=U;if(!U&&le){let je=S.getStyle().layers,ht=typeof le=="function"?le:we=>we.type===le,vt=je==null?void 0:je.find(ht);vt&&(Fe=vt.id)}Tt(Nt,k=R,k),S.addLayer(ja({id:k,type:he,source:a,"source-layer":j,filter:l,paint:Z,layout:Q,minzoom:u,maxzoom:d}),Fe),t(23,ut=!0),S.on("click",k,Jt),S.on("dblclick",k,Jt),S.on("contextmenu",k,Jt),S.on("mouseenter",k,gi),S.on("mousemove",k,zi),S.on("mouseleave",k,Fi)}r.$$.dirty[0]&1048577&&k&&ti.set(k,{interactive:et}),r.$$.dirty[0]&1|r.$$.dirty[1]&1&&t(28,_=k?Dy((Fe,je)=>S==null?void 0:S.setPaintProperty(k,Fe,je)):void 0),r.$$.dirty[0]&1|r.$$.dirty[1]&1&&t(27,v=k?Dy((Fe,je)=>S==null?void 0:S.setLayoutProperty(k,Fe,je)):void 0),r.$$.dirty[0]&268443648&&(_==null||_(Z)),r.$$.dirty[0]&134234112&&(v==null||v(Q)),r.$$.dirty[0]&100663297|r.$$.dirty[1]&1&&k&&(S==null||S.setLayerZoomRange(k,u,d)),r.$$.dirty[0]&25165825|r.$$.dirty[1]&1&&k&&(ut?t(23,ut=!1):S==null||S.setFilter(k,l))},[k,Ht,ri,Nt,At,ei,Le,R,F,j,U,le,he,Z,Q,ye,Ne,re,ve,Ke,et,xt,mt,ut,l,d,u,v,_,a,i,S,E,A,D,P,B]}class Hp extends Vt{constructor(e){super(),Ut(this,e,kC,xC,zt,{id:7,source:8,sourceLayer:9,beforeId:10,beforeLayerType:11,type:12,paint:13,layout:14,filter:15,applyToClusters:16,minzoom:17,maxzoom:18,manageHoverState:19,hovered:6,interactive:20,hoverCursor:21,eventsIfTopMost:22},null,[-1,-1])}}function SC(r){let e;const t=r[16].default,i=$i(t,r,r[24],null);return{c(){i&&i.c()},m(l,u){i&&i.m(l,u),e=!0},p(l,u){i&&i.p&&(!e||u&16777216)&&Zi(i,t,l,l[24],e?qi(t,l[24],u,null):Gi(l[24]),null)},i(l){e||(J(i,l),e=!0)},o(l){ne(i,l),e=!1},d(l){i&&i.d(l)}}}function TC(r){let e,t,i;function l(d){r[17](d)}let u={id:r[1],type:"circle",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],applyToClusters:r[9],minzoom:r[10],maxzoom:r[11],hoverCursor:r[12],manageHoverState:r[13],eventsIfTopMost:r[14],interactive:r[15],$$slots:{default:[SC]},$$scope:{ctx:r}};return r[0]!==void 0&&(u.hovered=r[0]),e=new Hp({props:u}),on.push(()=>Wr(e,"hovered",l)),e.$on("click",r[18]),e.$on("dblclick",r[19]),e.$on("contextmenu",r[20]),e.$on("mouseenter",r[21]),e.$on("mousemove",r[22]),e.$on("mouseleave",r[23]),{c(){Ie(e.$$.fragment)},m(d,a){Ee(e,d,a),i=!0},p(d,[a]){const _={};a&2&&(_.id=d[1]),a&4&&(_.source=d[2]),a&8&&(_.sourceLayer=d[3]),a&16&&(_.beforeId=d[4]),a&32&&(_.beforeLayerType=d[5]),a&64&&(_.paint=d[6]),a&128&&(_.layout=d[7]),a&256&&(_.filter=d[8]),a&512&&(_.applyToClusters=d[9]),a&1024&&(_.minzoom=d[10]),a&2048&&(_.maxzoom=d[11]),a&4096&&(_.hoverCursor=d[12]),a&8192&&(_.manageHoverState=d[13]),a&16384&&(_.eventsIfTopMost=d[14]),a&32768&&(_.interactive=d[15]),a&16777216&&(_.$$scope={dirty:a,ctx:d}),!t&&a&1&&(t=!0,_.hovered=d[0],Gr(()=>t=!1)),e.$set(_)},i(d){i||(J(e.$$.fragment,d),i=!0)},o(d){ne(e.$$.fragment,d),i=!1},d(d){Me(e,d)}}}function CC(r,e,t){let{$$slots:i={},$$scope:l}=e,{id:u=Ju("circle")}=e,{source:d=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:_=void 0}=e,{beforeLayerType:v=void 0}=e,{paint:k}=e,{layout:S=void 0}=e,{filter:E=void 0}=e,{applyToClusters:A=void 0}=e,{minzoom:D=void 0}=e,{maxzoom:B=void 0}=e,{hoverCursor:P=void 0}=e,{manageHoverState:R=!1}=e,{hovered:F=null}=e,{eventsIfTopMost:j=!1}=e,{interactive:U=!0}=e;function le(ve){F=ve,t(0,F)}function he(ve){fi.call(this,r,ve)}function Z(ve){fi.call(this,r,ve)}function Q(ve){fi.call(this,r,ve)}function ye(ve){fi.call(this,r,ve)}function Ne(ve){fi.call(this,r,ve)}function re(ve){fi.call(this,r,ve)}return r.$$set=ve=>{"id"in ve&&t(1,u=ve.id),"source"in ve&&t(2,d=ve.source),"sourceLayer"in ve&&t(3,a=ve.sourceLayer),"beforeId"in ve&&t(4,_=ve.beforeId),"beforeLayerType"in ve&&t(5,v=ve.beforeLayerType),"paint"in ve&&t(6,k=ve.paint),"layout"in ve&&t(7,S=ve.layout),"filter"in ve&&t(8,E=ve.filter),"applyToClusters"in ve&&t(9,A=ve.applyToClusters),"minzoom"in ve&&t(10,D=ve.minzoom),"maxzoom"in ve&&t(11,B=ve.maxzoom),"hoverCursor"in ve&&t(12,P=ve.hoverCursor),"manageHoverState"in ve&&t(13,R=ve.manageHoverState),"hovered"in ve&&t(0,F=ve.hovered),"eventsIfTopMost"in ve&&t(14,j=ve.eventsIfTopMost),"interactive"in ve&&t(15,U=ve.interactive),"$$scope"in ve&&t(24,l=ve.$$scope)},[F,u,d,a,_,v,k,S,E,A,D,B,P,R,j,U,i,le,he,Z,Q,ye,Ne,re,l]}class EC extends Vt{constructor(e){super(),Ut(this,e,CC,TC,zt,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}function MC(r){let e;const t=r[15].default,i=$i(t,r,r[23],null);return{c(){i&&i.c()},m(l,u){i&&i.m(l,u),e=!0},p(l,u){i&&i.p&&(!e||u&8388608)&&Zi(i,t,l,l[23],e?qi(t,l[23],u,null):Gi(l[23]),null)},i(l){e||(J(i,l),e=!0)},o(l){ne(i,l),e=!1},d(l){i&&i.d(l)}}}function IC(r){let e,t,i;function l(d){r[16](d)}let u={id:r[1],type:"fill",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],minzoom:r[9],maxzoom:r[10],hoverCursor:r[11],manageHoverState:r[12],eventsIfTopMost:r[13],interactive:r[14],$$slots:{default:[MC]},$$scope:{ctx:r}};return r[0]!==void 0&&(u.hovered=r[0]),e=new Hp({props:u}),on.push(()=>Wr(e,"hovered",l)),e.$on("click",r[17]),e.$on("dblclick",r[18]),e.$on("contextmenu",r[19]),e.$on("mouseenter",r[20]),e.$on("mousemove",r[21]),e.$on("mouseleave",r[22]),{c(){Ie(e.$$.fragment)},m(d,a){Ee(e,d,a),i=!0},p(d,[a]){const _={};a&2&&(_.id=d[1]),a&4&&(_.source=d[2]),a&8&&(_.sourceLayer=d[3]),a&16&&(_.beforeId=d[4]),a&32&&(_.beforeLayerType=d[5]),a&64&&(_.paint=d[6]),a&128&&(_.layout=d[7]),a&256&&(_.filter=d[8]),a&512&&(_.minzoom=d[9]),a&1024&&(_.maxzoom=d[10]),a&2048&&(_.hoverCursor=d[11]),a&4096&&(_.manageHoverState=d[12]),a&8192&&(_.eventsIfTopMost=d[13]),a&16384&&(_.interactive=d[14]),a&8388608&&(_.$$scope={dirty:a,ctx:d}),!t&&a&1&&(t=!0,_.hovered=d[0],Gr(()=>t=!1)),e.$set(_)},i(d){i||(J(e.$$.fragment,d),i=!0)},o(d){ne(e.$$.fragment,d),i=!1},d(d){Me(e,d)}}}function LC(r,e,t){let{$$slots:i={},$$scope:l}=e,{id:u=Ju("fill")}=e,{source:d=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:_=void 0}=e,{beforeLayerType:v=void 0}=e,{paint:k}=e,{layout:S=void 0}=e,{filter:E=void 0}=e,{minzoom:A=void 0}=e,{maxzoom:D=void 0}=e,{hoverCursor:B=void 0}=e,{manageHoverState:P=!1}=e,{hovered:R=null}=e,{eventsIfTopMost:F=!1}=e,{interactive:j=!0}=e;function U(re){R=re,t(0,R)}function le(re){fi.call(this,r,re)}function he(re){fi.call(this,r,re)}function Z(re){fi.call(this,r,re)}function Q(re){fi.call(this,r,re)}function ye(re){fi.call(this,r,re)}function Ne(re){fi.call(this,r,re)}return r.$$set=re=>{"id"in re&&t(1,u=re.id),"source"in re&&t(2,d=re.source),"sourceLayer"in re&&t(3,a=re.sourceLayer),"beforeId"in re&&t(4,_=re.beforeId),"beforeLayerType"in re&&t(5,v=re.beforeLayerType),"paint"in re&&t(6,k=re.paint),"layout"in re&&t(7,S=re.layout),"filter"in re&&t(8,E=re.filter),"minzoom"in re&&t(9,A=re.minzoom),"maxzoom"in re&&t(10,D=re.maxzoom),"hoverCursor"in re&&t(11,B=re.hoverCursor),"manageHoverState"in re&&t(12,P=re.manageHoverState),"hovered"in re&&t(0,R=re.hovered),"eventsIfTopMost"in re&&t(13,F=re.eventsIfTopMost),"interactive"in re&&t(14,j=re.interactive),"$$scope"in re&&t(23,l=re.$$scope)},[R,u,d,a,_,v,k,S,E,A,D,B,P,F,j,i,U,le,he,Z,Q,ye,Ne,l]}class AC extends Vt{constructor(e){super(),Ut(this,e,LC,IC,zt,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}function PC(r,e,t,i,l){let u=!1;r.getSource(e)&&(u=!0,r.removeSource(e));const d=()=>{i(e)&&(r.addSource(e,t),l())};if(u){const a=()=>{e&&(r.getSource(e)?setTimeout(a,1):d())};a()}else d()}function zC(r,e,t){n0().then(()=>{let i=Pr(r);if(!i)return;i.getSource(e)===t&&i.removeSource(e)})}function Fy(r){let e=r[0],t,i,l=Oy(r);return{c(){l.c(),t=En()},m(u,d){l.m(u,d),ae(u,t,d),i=!0},p(u,d){d&1&&zt(e,e=u[0])?(yi(),ne(l,1,1,It),vi(),l=Oy(u),l.c(),J(l,1),l.m(t.parentNode,t)):l.p(u,d)},i(u){i||(J(l),i=!0)},o(u){ne(l),i=!1},d(u){u&&se(t),l.d(u)}}}function Oy(r){let e;const t=r[15].default,i=$i(t,r,r[14],null);return{c(){i&&i.c()},m(l,u){i&&i.m(l,u),e=!0},p(l,u){i&&i.p&&(!e||u&16384)&&Zi(i,t,l,l[14],e?qi(t,l[14],u,null):Gi(l[14]),null)},i(l){e||(J(i,l),e=!0)},o(l){ne(i,l),e=!1},d(l){i&&i.d(l)}}}function DC(r){let e,t,i=r[0]&&Fy(r);return{c(){i&&i.c(),e=En()},m(l,u){i&&i.m(l,u),ae(l,e,u),t=!0},p(l,[u]){l[0]?i?(i.p(l,u),u&1&&J(i,1)):(i=Fy(l),i.c(),J(i,1),i.m(e.parentNode,e)):i&&(yi(),ne(i,1,1,()=>{i=null}),vi())},i(l){t||(J(i),t=!0)},o(l){ne(i),t=!1},d(l){l&&se(e),i&&i.d(l)}}}function RC(r,e,t){let i,l,u,{$$slots:d={},$$scope:a}=e,{id:_=Ju("geojson")}=e,{data:v}=e,{generateId:k=!1}=e,{promoteId:S=void 0}=e,{filter:E=void 0}=e,{lineMetrics:A=void 0}=e,{cluster:D=void 0}=e;const{map:B,cluster:P,self:R}=yC();lt(r,B,U=>t(13,l=U)),lt(r,P,U=>t(16,u=U)),lt(r,R,U=>t(0,i=U));let F,j=!0;return er(()=>{i&&F&&l&&(zC(B,i,F),Tt(R,i=null,i),t(11,F=void 0))}),r.$$set=U=>{"id"in U&&t(4,_=U.id),"data"in U&&t(5,v=U.data),"generateId"in U&&t(6,k=U.generateId),"promoteId"in U&&t(7,S=U.promoteId),"filter"in U&&t(8,E=U.filter),"lineMetrics"in U&&t(9,A=U.lineMetrics),"cluster"in U&&t(10,D=U.cluster),"$$scope"in U&&t(14,a=U.$$scope)},r.$$.update=()=>{r.$$.dirty&1024&&Tt(P,u=D,u),r.$$.dirty&12273&&l&&i!==_&&(Tt(R,i=_,i),PC(l,i,ja({type:"geojson",data:v,filter:E,lineMetrics:A,generateId:k,promoteId:S,cluster:!!D,clusterMinPoints:D==null?void 0:D.minPoints,clusterMaxZoom:D==null?void 0:D.maxZoom,clusterRadius:D==null?void 0:D.radius,clusterProperties:D==null?void 0:D.properties}),U=>l&&U===i,()=>{i&&(t(11,F=l==null?void 0:l.getSource(i)),t(12,j=!0))})),r.$$.dirty&8208&&(l==null||l.on("style.load",()=>{t(11,F=l==null?void 0:l.getSource(_))})),r.$$.dirty&6176&&F&&(j?t(12,j=!1):F.setData(v)),r.$$.dirty&3072&&(F==null||F.setClusterOptions(ja({cluster:!!D,clusterMaxZoom:D==null?void 0:D.maxZoom,clusterRadius:D==null?void 0:D.radius})))},[i,B,P,R,_,v,k,S,E,A,D,F,j,l,a,d]}class BC extends Vt{constructor(e){super(),Ut(this,e,RC,DC,zt,{id:4,data:5,generateId:6,promoteId:7,filter:8,lineMetrics:9,cluster:10})}}function FC(r){let e;const t=r[15].default,i=$i(t,r,r[23],null);return{c(){i&&i.c()},m(l,u){i&&i.m(l,u),e=!0},p(l,u){i&&i.p&&(!e||u&8388608)&&Zi(i,t,l,l[23],e?qi(t,l[23],u,null):Gi(l[23]),null)},i(l){e||(J(i,l),e=!0)},o(l){ne(i,l),e=!1},d(l){i&&i.d(l)}}}function OC(r){let e,t,i;function l(d){r[16](d)}let u={id:r[1],type:"line",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],minzoom:r[9],maxzoom:r[10],hoverCursor:r[11],manageHoverState:r[12],eventsIfTopMost:r[13],interactive:r[14],$$slots:{default:[FC]},$$scope:{ctx:r}};return r[0]!==void 0&&(u.hovered=r[0]),e=new Hp({props:u}),on.push(()=>Wr(e,"hovered",l)),e.$on("click",r[17]),e.$on("dblclick",r[18]),e.$on("contextmenu",r[19]),e.$on("mouseenter",r[20]),e.$on("mousemove",r[21]),e.$on("mouseleave",r[22]),{c(){Ie(e.$$.fragment)},m(d,a){Ee(e,d,a),i=!0},p(d,[a]){const _={};a&2&&(_.id=d[1]),a&4&&(_.source=d[2]),a&8&&(_.sourceLayer=d[3]),a&16&&(_.beforeId=d[4]),a&32&&(_.beforeLayerType=d[5]),a&64&&(_.paint=d[6]),a&128&&(_.layout=d[7]),a&256&&(_.filter=d[8]),a&512&&(_.minzoom=d[9]),a&1024&&(_.maxzoom=d[10]),a&2048&&(_.hoverCursor=d[11]),a&4096&&(_.manageHoverState=d[12]),a&8192&&(_.eventsIfTopMost=d[13]),a&16384&&(_.interactive=d[14]),a&8388608&&(_.$$scope={dirty:a,ctx:d}),!t&&a&1&&(t=!0,_.hovered=d[0],Gr(()=>t=!1)),e.$set(_)},i(d){i||(J(e.$$.fragment,d),i=!0)},o(d){ne(e.$$.fragment,d),i=!1},d(d){Me(e,d)}}}function NC(r,e,t){let{$$slots:i={},$$scope:l}=e,{id:u=Ju("line")}=e,{source:d=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:_=void 0}=e,{beforeLayerType:v=void 0}=e,{paint:k}=e,{layout:S=void 0}=e,{filter:E=void 0}=e,{minzoom:A=void 0}=e,{maxzoom:D=void 0}=e,{hoverCursor:B=void 0}=e,{manageHoverState:P=!1}=e,{hovered:R=null}=e,{eventsIfTopMost:F=!1}=e,{interactive:j=!0}=e;function U(re){R=re,t(0,R)}function le(re){fi.call(this,r,re)}function he(re){fi.call(this,r,re)}function Z(re){fi.call(this,r,re)}function Q(re){fi.call(this,r,re)}function ye(re){fi.call(this,r,re)}function Ne(re){fi.call(this,r,re)}return r.$$set=re=>{"id"in re&&t(1,u=re.id),"source"in re&&t(2,d=re.source),"sourceLayer"in re&&t(3,a=re.sourceLayer),"beforeId"in re&&t(4,_=re.beforeId),"beforeLayerType"in re&&t(5,v=re.beforeLayerType),"paint"in re&&t(6,k=re.paint),"layout"in re&&t(7,S=re.layout),"filter"in re&&t(8,E=re.filter),"minzoom"in re&&t(9,A=re.minzoom),"maxzoom"in re&&t(10,D=re.maxzoom),"hoverCursor"in re&&t(11,B=re.hoverCursor),"manageHoverState"in re&&t(12,P=re.manageHoverState),"hovered"in re&&t(0,R=re.hovered),"eventsIfTopMost"in re&&t(13,F=re.eventsIfTopMost),"interactive"in re&&t(14,j=re.interactive),"$$scope"in re&&t(23,l=re.$$scope)},[R,u,d,a,_,v,k,S,E,A,D,B,P,F,j,i,U,le,he,Z,Q,ye,Ne,l]}class jC extends Vt{constructor(e){super(),Ut(this,e,NC,OC,zt,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}function UC(r){let e,t,i,l,u,d;return e=new AC({props:{id:"edit-polygon-fill",filter:sC,paint:{"fill-color":"red","fill-opacity":["case",["boolean",["get","hover"],"false"],1,.5]}}}),i=new jC({props:{id:"edit-polygon-lines",filter:aC,paint:{"line-color":"black","line-width":8,"line-opacity":.5}}}),u=new EC({props:{id:"edit-polygon-vertices",filter:lC,paint:{"circle-color":"black","circle-opacity":["case",["has","hovered"],1,.5],"circle-radius":10}}}),{c(){Ie(e.$$.fragment),t=Ae(),Ie(i.$$.fragment),l=Ae(),Ie(u.$$.fragment)},m(a,_){Ee(e,a,_),ae(a,t,_),Ee(i,a,_),ae(a,l,_),Ee(u,a,_),d=!0},p:It,i(a){d||(J(e.$$.fragment,a),J(i.$$.fragment,a),J(u.$$.fragment,a),d=!0)},o(a){ne(e.$$.fragment,a),ne(i.$$.fragment,a),ne(u.$$.fragment,a),d=!1},d(a){a&&(se(t),se(l)),Me(e,a),Me(i,a),Me(u,a)}}}function VC(r){let e,t;return e=new BC({props:{data:r[0],$$slots:{default:[UC]},$$scope:{ctx:r}}}),{c(){Ie(e.$$.fragment)},m(i,l){Ee(e,i,l),t=!0},p(i,[l]){const u={};l&1&&(u.data=i[0]),l&2&&(u.$$scope={dirty:l,ctx:i}),e.$set(u)},i(i){t||(J(e.$$.fragment,i),t=!0)},o(i){ne(e.$$.fragment,i),t=!1},d(i){Me(e,i)}}}function $C(r,e,t){let i;return lt(r,a1,l=>t(0,i=l)),[i]}class qC extends Vt{constructor(e){super(),Ut(this,e,$C,VC,zt,{})}}function ZC(r){let e,t,i,l,u,d,a;return{c(){e=oe("button"),e.textContent="Import current view",t=Ae(),i=oe("i"),i.textContent="or...",l=Ae(),u=oe("button"),u.textContent="Draw an area to import on the map",ke(e,"type","button"),ke(u,"type","button")},m(_,v){ae(_,e,v),ae(_,t,v),ae(_,i,v),ae(_,l,v),ae(_,u,v),d||(a=[St(e,"click",r[2]),St(u,"click",r[3])],d=!0)},p:It,i:It,o:It,d(_){_&&(se(e),se(t),se(i),se(l),se(u)),d=!1,hn(a)}}}function GC(r){let e,t;return e=new mC({props:{polygonTool:r[0]}}),{c(){Ie(e.$$.fragment)},m(i,l){Ee(e,i,l),t=!0},p(i,l){const u={};l&1&&(u.polygonTool=i[0]),e.$set(u)},i(i){t||(J(e.$$.fragment,i),t=!0)},o(i){ne(e.$$.fragment,i),t=!1},d(i){Me(e,i)}}}function WC(r){let e,t,i,l,u,d,a,_,v;const k=[GC,ZC],S=[];function E(A,D){return A[0]?0:1}return e=E(r),t=S[e]=k[e](r),{c(){t.c(),i=Ae(),l=oe("label"),u=oe("input"),d=Ve(`Save a copy of the osm.xml
  after importing`),ke(u,"type","checkbox")},m(A,D){S[e].m(A,D),ae(A,i,D),ae(A,l,D),G(l,u),u.checked=r[1],G(l,d),a=!0,_||(v=St(u,"change",r[5]),_=!0)},p(A,[D]){let B=e;e=E(A),e===B?S[e].p(A,D):(yi(),ne(S[B],1,1,()=>{S[B]=null}),vi(),t=S[e],t?t.p(A,D):(t=S[e]=k[e](A),t.c()),J(t,1),t.m(i.parentNode,i)),D&2&&(u.checked=A[1])},i(A){a||(J(t),a=!0)},o(A){ne(t),a=!1},d(A){A&&(se(i),se(l)),S[e].d(A),_=!1,v()}}}function _u(r){return[r.lng,r.lat]}function HC(r,e,t){let{map:i}=e;const l=rs();let u=null,d=!1;async function a(E){try{l("loading","Loading from Overpass");let D=await(await fetch(h1(E))).text();d&&vd("osm.xml",D),l("gotXml",{xml:D,boundary:E})}catch(A){l("error",A.toString())}}function _(){let E=i.getBounds();return{type:"Feature",properties:{},geometry:{coordinates:[[_u(E.getSouthWest()),_u(E.getNorthWest()),_u(E.getNorthEast()),_u(E.getSouthEast()),_u(E.getSouthWest())]],type:"Polygon"}}}async function v(){if(i){if(i.getZoom()<13){l("error","Zoom in more to import");return}await a(_())}}function k(){i&&(t(0,u=new uC(i)),u.startNew(),u.addEventListenerSuccess(async E=>{t(0,u=null),await a(E)}),u.addEventListenerFailure(()=>{t(0,u=null)}))}function S(){d=this.checked,t(1,d)}return r.$$set=E=>{"map"in E&&t(4,i=E.map)},[u,d,v,k,i,S]}class XC extends Vt{constructor(e){super(),Ut(this,e,HC,WC,zt,{map:4})}}function h1(r){let e='poly:"';for(let[i,l]of r.geometry.coordinates[0])e+=`${l} ${i} `;return e=e.slice(0,-1)+'"',`https://overpass-api.de/api/interpreter?data=${`(nwr(${e}); node(w)->.x; <;); out meta;`}`}class d1{constructor(e,t,i){Un(this,"inner");this.inner=new Fw(e,t,i)}getInvertedBoundary(){return JSON.parse(this.inner.getInvertedBoundary())}getBounds(){return Array.from(this.inner.getBounds())}toRouteSnapper(){return this.inner.toRouteSnapper()}toRouteSnapperGj(){return this.inner.toRouteSnapperGj()}renderModalFilters(){return JSON.parse(this.inner.renderModalFilters())}renderNeighbourhood(){let e=KC(JSON.parse(this.inner.renderNeighbourhood()));return e.maxShortcuts=Math.max(...e.features.map(t=>t.properties.kind=="interior_road"?t.properties.shortcuts:0))??0,e}renderAutoBoundaries(){return JSON.parse(this.inner.renderAutoBoundaries())}setNeighbourhoodBoundary(e,t){this.inner.setNeighbourhoodBoundary(e,t)}deleteNeighbourhoodBoundary(e){this.inner.deleteNeighbourhoodBoundary(e)}renameNeighbourhoodBoundary(e,t){this.inner.renameNeighbourhoodBoundary(e,t)}setCurrentNeighbourhood(e,t){this.inner.setCurrentNeighbourhood(e,t)}addModalFilter(e,t){this.inner.addModalFilter(e,t)}addManyModalFilters(e,t){this.inner.addManyModalFilters(e,t)}deleteModalFilter(e){this.inner.deleteModalFilter(e)}toggleDirection(e){this.inner.toggleDirection(e)}undo(){this.inner.undo()}redo(){this.inner.redo()}getShortcutsCrossingRoad(e){return JSON.parse(this.inner.getShortcutsCrossingRoad(e))}getAllShortcuts(){return JSON.parse(this.inner.getAllShortcuts())}toSavefile(){return JSON.parse(this.inner.toSavefile())}loadSavefile(e){this.inner.loadSavefile(e)}compareRoute(e,t,i){return JSON.parse(this.inner.compareRoute(e.lng,e.lat,t.lng,t.lat,i))}impactToOneDestination(e){return JSON.parse(this.inner.impactToOneDestination(e.lng,e.lat))}predictImpact(){return JSON.parse(this.inner.predictImpact())}getImpactsOnRoad(e){return JSON.parse(this.inner.getImpactsOnRoad(e))}}function KC(r){let e=["#8dd3c7","#ffffb3","#bebada","#80b1d3","#fdb462","#b3de69","#fccde5","#bc80bd","#ccebc5","#ffed6f"];for(let t of r.features)t.properties.kind!="cell"&&t.properties.kind!="border_arrow"&&t.properties.kind!="interior_road"||(t.properties.cell_color=="disconnected"?t.properties.color="red":t.properties.color=e[t.properties.cell_color%e.length]);return r}async function _d(r){Cs.set(r);try{let e=JSON.parse(window.localStorage.getItem(r));console.time("get OSM input");let[t,i]=await JC(e);console.timeEnd("get OSM input"),console.time("load"),Dn.set(new d1(new Uint8Array(t),i,e.study_area_name||void 0)),Pr(Dn).loadSavefile(e),console.timeEnd("load"),f1()}catch(e){window.alert(`Couldn't open project: ${e}`),Cs.set("")}}async function JC(r){if(r.study_area_name){let e=Pr(Du)?`/osm/${r.study_area_name}.pbf`:`https://assets.od2net.org/severance_pbfs/${r.study_area_name}.pbf`;console.log(`Grabbing ${e}`);let i=await(await fetch(e)).arrayBuffer(),l=Pr(Du)?`/boundaries/${r.study_area_name}.geojson`:`https://assets.od2net.org/boundaries/${r.study_area_name}.geojson`,d=await(await fetch(l)).json();return[i,d]}else{console.log("Grabbing from Overpass");let e=r.features.find(l=>l.properties.kind=="study_area_boundary");return[await(await fetch(h1(e))).arrayBuffer(),e]}}function f1(){Wt.set({mode:"network"}),sc.set(new Cw(Pr(qo),Pr(Dn).toRouteSnapper(),ki(Ql()),ki(!0),ki(0))),Pr(qo).fitBounds(Pr(Dn).getBounds(),{animate:!1}),Ru.set(np()),Bu.set(np()),ud.set(np());let r=new URL(window.location.href);r.searchParams.set("project",Pr(Cs)),window.history.replaceState(null,"",r.toString())}function np(){let r=Pr(Dn).getBounds(),e=r[0]+Math.random()*(r[2]-r[0]),t=r[1]+Math.random()*(r[3]-r[1]);return new Ts.LngLat(e,t)}function Ny(r,e,t){const i=r.slice();return i[17]=e[t][0],i[18]=e[t][1],i}function jy(r,e,t){const i=r.slice();return i[21]=e[t][0],i[22]=e[t][1],i}function YC(r){let e;return{c(){e=Ve("Choose project")},m(t,i){ae(t,e,i)},d(t){t&&se(e)}}}function QC(r){let e,t,i,l,u,d,a,_;return u=new Ii({props:{$$slots:{default:[YC]},$$scope:{ctx:r}}}),u.$on("click",r[13]),{c(){e=oe("div"),t=oe("nav"),i=oe("ul"),l=oe("li"),Ie(u.$$.fragment),d=Ae(),a=oe("li"),a.textContent="New project",ke(t,"aria-label","breadcrumb"),ke(e,"slot","top")},m(v,k){ae(v,e,k),G(e,t),G(t,i),G(i,l),Ee(u,l,null),G(i,d),G(i,a),_=!0},p(v,k){const S={};k&33554432&&(S.$$scope={dirty:k,ctx:v}),u.$set(S)},i(v){_||(J(u.$$.fragment,v),_=!0)},o(v){ne(u.$$.fragment,v),_=!1},d(v){v&&se(e),Me(u)}}}function Uy(r){let e,t,i,l,u,d,a,_,v,k,S,E,A,D;e=new o0({props:{loading:r[4]}});let B=Tn(r[3]),P=[];for(let R=0;R<B.length;R+=1)P[R]=$y(Ny(r,B,R));return S=new XC({props:{map:r[5]}}),S.$on("gotXml",r[7]),S.$on("loading",r[11]),S.$on("error",r[12]),{c(){Ie(e.$$.fragment),t=Ae(),i=oe("label"),l=Ve(`Load a built-in area:
        `),u=oe("select"),d=oe("option");for(let R=0;R<P.length;R+=1)P[R].c();a=Ae(),_=oe("i"),_.textContent="or...",v=Ae(),k=oe("div"),Ie(S.$$.fragment),d.__value="",Pn(d,d.__value),r[2]===void 0&&ic(()=>r[9].call(u))},m(R,F){Ee(e,R,F),ae(R,t,F),ae(R,i,F),G(i,l),G(i,u),G(u,d);for(let j=0;j<P.length;j+=1)P[j]&&P[j].m(u,null);tc(u,r[2],!0),ae(R,a,F),ae(R,_,F),ae(R,v,F),ae(R,k,F),Ee(S,k,null),E=!0,A||(D=[St(u,"change",r[9]),St(u,"change",r[10])],A=!0)},p(R,F){const j={};if(F&16&&(j.loading=R[4]),e.$set(j),F&8){B=Tn(R[3]);let le;for(le=0;le<B.length;le+=1){const he=Ny(R,B,le);P[le]?P[le].p(he,F):(P[le]=$y(he),P[le].c(),P[le].m(u,null))}for(;le<P.length;le+=1)P[le].d(1);P.length=B.length}F&12&&tc(u,R[2]);const U={};F&32&&(U.map=R[5]),S.$set(U)},i(R){E||(J(e.$$.fragment,R),J(S.$$.fragment,R),E=!0)},o(R){ne(e.$$.fragment,R),ne(S.$$.fragment,R),E=!1},d(R){R&&(se(t),se(i),se(a),se(_),se(v),se(k)),Me(e,R),$o(P,R),Me(S),A=!1,hn(D)}}}function Vy(r){let e,t=r[22]+"",i,l;return{c(){e=oe("option"),i=Ve(t),e.__value=l=r[21],Pn(e,e.__value)},m(u,d){ae(u,e,d),G(e,i)},p(u,d){d&8&&t!==(t=u[22]+"")&&si(i,t),d&8&&l!==(l=u[21])&&(e.__value=l,Pn(e,e.__value))},d(u){u&&se(e)}}}function $y(r){let e,t,i=Tn(r[18]),l=[];for(let u=0;u<i.length;u+=1)l[u]=Vy(jy(r,i,u));return{c(){e=oe("optgroup");for(let u=0;u<l.length;u+=1)l[u].c();ke(e,"label",t=r[17])},m(u,d){ae(u,e,d);for(let a=0;a<l.length;a+=1)l[a]&&l[a].m(e,null)},p(u,d){if(d&8){i=Tn(u[18]);let a;for(a=0;a<i.length;a+=1){const _=jy(u,i,a);l[a]?l[a].p(_,d):(l[a]=Vy(_),l[a].c(),l[a].m(e,null))}for(;a<l.length;a+=1)l[a].d(1);l.length=i.length}d&8&&t!==(t=u[17])&&ke(e,"label",t)},d(u){u&&se(e),$o(l,u)}}}function eE(r){let e,t,i,l,u,d,a,_,v,k=r[1]&&Uy(r);return{c(){e=oe("div"),t=oe("div"),i=oe("label"),l=Ve(`Project name:
        `),u=oe("input"),d=Ae(),k&&k.c(),ke(u,"type","text"),ke(e,"slot","sidebar")},m(S,E){ae(S,e,E),G(e,t),G(t,i),G(i,l),G(i,u),Pn(u,r[1]),G(e,d),k&&k.m(e,null),a=!0,_||(v=St(u,"input",r[8]),_=!0)},p(S,E){E&2&&u.value!==S[1]&&Pn(u,S[1]),S[1]?k?(k.p(S,E),E&2&&J(k,1)):(k=Uy(S),k.c(),J(k,1),k.m(e,null)):k&&(yi(),ne(k,1,1,()=>{k=null}),vi())},i(S){a||(J(k),a=!0)},o(S){ne(k),a=!1},d(S){S&&se(e),k&&k.d(),_=!1,v()}}}function tE(r){let e,t,i;return t=new qC({}),{c(){e=oe("div"),Ie(t.$$.fragment),ke(e,"slot","map")},m(l,u){ae(l,e,u),Ee(t,e,null),i=!0},p:It,i(l){i||(J(t.$$.fragment,l),i=!0)},o(l){ne(t.$$.fragment,l),i=!1},d(l){l&&se(e),Me(t)}}}function iE(r){let e,t;return e=new Po({props:{$$slots:{map:[tE],sidebar:[eE],top:[QC]},$$scope:{ctx:r}}}),{c(){Ie(e.$$.fragment)},m(i,l){Ee(e,i,l),t=!0},p(i,[l]){const u={};l&33554558&&(u.$$scope={dirty:l,ctx:i}),e.$set(u)},i(i){t||(J(e.$$.fragment,i),t=!0)},o(i){ne(e.$$.fragment,i),t=!1},d(i){Me(e,i)}}}function nE(r,e,t){let i,l,u,d,a;lt(r,Cs,U=>t(14,i=U)),lt(r,Dn,U=>t(15,l=U)),lt(r,Du,U=>t(16,u=U)),lt(r,qo,U=>t(5,d=U)),lt(r,Wt,U=>t(6,a=U));let _="",v="",k=[],S="";Zu(async()=>{let U=await fetch(u?"/osm/areas.json":"https://assets.od2net.org/severance_pbfs/areas.json");t(3,k=await U.json())});function E(U){t(4,S="Loading OSM");try{Tt(Dn,l=new d1(new TextEncoder().encode(U.detail.xml),U.detail.boundary,void 0),l),Tt(Cs,i=`ltn_${_}`,i),f1(),oc()}catch(le){window.alert(`Couldn't import from Overpass: ${le}`)}t(4,S="")}async function A(){if(v=="")return;let U=`ltn_${_}`;window.localStorage.setItem(U,JSON.stringify({type:"FeatureCollection",features:[],study_area_name:v})),t(4,S=`Loading pre-clipped OSM area ${v}`),await _d(U),t(4,S="")}function D(){_=this.value,t(1,_)}function B(){v=Lp(this),t(2,v),t(3,k)}return[A,_,v,k,S,d,a,E,D,B,()=>A(),U=>t(4,S=U.detail),U=>window.alert(U.detail),()=>Tt(Wt,a={mode:"title",firstLoad:!1},a)]}class rE extends Vt{constructor(e){super(),Ut(this,e,nE,iE,zt,{loadExample:0})}get loadExample(){return this.$$.ctx[0]}}function qy(r,e,t){const i=r.slice();return i[19]=e[t][0],i[20]=e[t][1],i}function Zy(r,e,t){const i=r.slice();return i[23]=e[t],i}function oE(r){let e;return{c(){e=oe("div"),e.innerHTML='<nav aria-label="breadcrumb"><ul><li>Choose project</li></ul></nav>',ke(e,"slot","top")},m(t,i){ae(t,e,i)},p:It,d(t){t&&se(e)}}}function sE(r){let e;return{c(){e=oe("p"),e.textContent="Waiting for MapLibre and WASM to load..."},m(t,i){ae(t,e,i)},p:It,i:It,o:It,d(t){t&&se(e)}}}function aE(r){let e,t,i,l,u,d,a,_,v,k,S,E,A;t=new Ii({props:{$$slots:{default:[lE]},$$scope:{ctx:r}}}),t.$on("click",r[11]);let D=Tn(r[2]),B=[];for(let R=0;R<D.length;R+=1)B[R]=Wy(qy(r,D,R));const P=R=>ne(B[R],1,1,()=>{B[R]=null});return{c(){e=oe("div"),Ie(t.$$.fragment),i=Ae(),l=oe("p"),l.textContent="Load a saved project:",u=Ae(),d=oe("ul");for(let R=0;R<B.length;R+=1)B[R].c();a=Ae(),_=oe("label"),v=Ve(`Load a project from a file
        `),k=oe("input"),ke(k,"type","file")},m(R,F){ae(R,e,F),Ee(t,e,null),ae(R,i,F),ae(R,l,F),ae(R,u,F),ae(R,d,F);for(let j=0;j<B.length;j+=1)B[j]&&B[j].m(d,null);ae(R,a,F),ae(R,_,F),G(_,v),G(_,k),r[15](k),S=!0,E||(A=St(k,"change",r[6]),E=!0)},p(R,F){const j={};if(F&67108864&&(j.$$scope={dirty:F,ctx:R}),t.$set(j),F&900){D=Tn(R[2]);let U;for(U=0;U<D.length;U+=1){const le=qy(R,D,U);B[U]?(B[U].p(le,F),J(B[U],1)):(B[U]=Wy(le),B[U].c(),J(B[U],1),B[U].m(d,null))}for(yi(),U=D.length;U<B.length;U+=1)P(U);vi()}},i(R){if(!S){J(t.$$.fragment,R);for(let F=0;F<D.length;F+=1)J(B[F]);S=!0}},o(R){ne(t.$$.fragment,R),B=B.filter(Boolean);for(let F=0;F<B.length;F+=1)ne(B[F]);S=!1},d(R){R&&(se(e),se(i),se(l),se(u),se(d),se(a),se(_)),Me(t),$o(B,R),r[15](null),E=!1,A()}}}function lE(r){let e;return{c(){e=Ve("New project")},m(t,i){ae(t,e,i)},d(t){t&&se(e)}}}function cE(r){let e=r[23].slice(4)+"",t;return{c(){t=Ve(e)},m(i,l){ae(i,t,l)},p(i,l){l&4&&e!==(e=i[23].slice(4)+"")&&si(t,e)},d(i){i&&se(t)}}}function Gy(r){let e,t,i,l,u,d,a,_,v,k,S;function E(){return r[12](r[23])}i=new Ii({props:{$$slots:{default:[cE]},$$scope:{ctx:r}}}),i.$on("click",E);function A(){return r[13](r[23])}function D(){return r[14](r[23])}return{c(){e=oe("li"),t=oe("span"),Ie(i.$$.fragment),l=Ae(),u=oe("button"),u.innerHTML=`<img src="${n1}" alt="Rename project"/>`,d=Ae(),a=oe("button"),a.innerHTML=`<img src="${i1}" alt="Delete project"/>`,_=Ae(),ke(u,"class","secondary"),ke(a,"class","secondary"),Ai(t,"display","flex"),Ai(t,"justify-content","space-between")},m(B,P){ae(B,e,P),G(e,t),Ee(i,t,null),G(t,l),G(t,u),G(t,d),G(t,a),G(e,_),v=!0,k||(S=[St(u,"click",A),St(a,"click",D)],k=!0)},p(B,P){r=B;const R={};P&67108868&&(R.$$scope={dirty:P,ctx:r}),i.$set(R)},i(B){v||(J(i.$$.fragment,B),v=!0)},o(B){ne(i.$$.fragment,B),v=!1},d(B){B&&se(e),Me(i),k=!1,hn(S)}}}function Wy(r){let e,t=(r[19]??"custom area")+"",i,l,u,d,a=Tn(r[20]),_=[];for(let k=0;k<a.length;k+=1)_[k]=Gy(Zy(r,a,k));const v=k=>ne(_[k],1,1,()=>{_[k]=null});return{c(){e=oe("u"),i=Ve(t),l=Ae();for(let k=0;k<_.length;k+=1)_[k].c();u=En()},m(k,S){ae(k,e,S),G(e,i),ae(k,l,S);for(let E=0;E<_.length;E+=1)_[E]&&_[E].m(k,S);ae(k,u,S),d=!0},p(k,S){if((!d||S&4)&&t!==(t=(k[19]??"custom area")+"")&&si(i,t),S&900){a=Tn(k[20]);let E;for(E=0;E<a.length;E+=1){const A=Zy(k,a,E);_[E]?(_[E].p(A,S),J(_[E],1)):(_[E]=Gy(A),_[E].c(),J(_[E],1),_[E].m(u.parentNode,u))}for(yi(),E=a.length;E<_.length;E+=1)v(E);vi()}},i(k){if(!d){for(let S=0;S<a.length;S+=1)J(_[S]);d=!0}},o(k){_=_.filter(Boolean);for(let S=0;S<_.length;S+=1)ne(_[S]);d=!1},d(k){k&&(se(e),se(l),se(u)),$o(_,k)}}}function uE(r){let e,t,i,l;const u=[aE,sE],d=[];function a(_,v){return _[4]&&_[0]?0:1}return t=a(r),i=d[t]=u[t](r),{c(){e=oe("div"),i.c(),ke(e,"slot","sidebar")},m(_,v){ae(_,e,v),d[t].m(e,null),l=!0},p(_,v){let k=t;t=a(_),t===k?d[t].p(_,v):(yi(),ne(d[k],1,1,()=>{d[k]=null}),vi(),i=d[t],i?i.p(_,v):(i=d[t]=u[t](_),i.c()),J(i,1),i.m(e,null))},i(_){l||(J(i),l=!0)},o(_){ne(i),l=!1},d(_){_&&se(e),d[t].d()}}}function hE(r){let e,t,i,l;return e=new o0({props:{loading:r[1]}}),i=new Po({props:{$$slots:{sidebar:[uE],top:[oE]},$$scope:{ctx:r}}}),{c(){Ie(e.$$.fragment),t=Ae(),Ie(i.$$.fragment)},m(u,d){Ee(e,u,d),ae(u,t,d),Ee(i,u,d),l=!0},p(u,[d]){const a={};d&2&&(a.loading=u[1]),e.$set(a);const _={};d&67108925&&(_.$$scope={dirty:d,ctx:u}),i.$set(_)},i(u){l||(J(e.$$.fragment,u),J(i.$$.fragment,u),l=!0)},o(u){ne(e.$$.fragment,u),ne(i.$$.fragment,u),l=!1},d(u){u&&se(t),Me(e,u),Me(i,u)}}}function ad(){let r=new Map,e=[];for(let i=0;i<window.localStorage.length;i++){let l=window.localStorage.key(i);if(l.startsWith("ltn_")){let u="";try{u=JSON.parse(window.localStorage.getItem(l)).study_area_name}catch{}u&&u.length>0?(r.has(u)||r.set(u,[]),r.get(u).push(l)):e.push(l)}}let t=[...r.entries()];return t.sort((i,l)=>i[0].localeCompare(l[0])),t.push(["custom",e]),t}function dE(r,e,t){let i,l,u,d,a;lt(r,Cs,he=>t(16,i=he)),lt(r,sc,he=>t(17,l=he)),lt(r,Dn,he=>t(18,u=he)),lt(r,qo,he=>t(4,d=he)),lt(r,Wt,he=>t(5,a=he));let{wasmReady:_}=e,{firstLoad:v}=e,k="";if(Tt(Dn,u=null,u),Tt(sc,l=null,l),Tt(Cs,i="",i),v){let Z=new URLSearchParams(window.location.search).get("project");Z&&_d(Z)}else{let he=new URL(window.location.href);he.searchParams.delete("project"),window.history.replaceState(null,"",he.toString())}let S=ad(),E;async function A(he){let Z="ltn_"+E.files[0].name;t(1,k=`Loading from file ${Z}`),window.localStorage.setItem(Z,await E.files[0].text()),t(2,S=ad()),await _d(Z),t(1,k="")}function D(he){window.confirm(`Really delete project ${he}? You can't undo this.`)&&(window.localStorage.removeItem(he),t(2,S=ad()))}function B(he){let Z=window.prompt(`Rename project ${he} to what?`,he);if(Z){Z.startsWith("ltn_")||(Z=`ltn_${Z}`);let Q=window.localStorage.getItem(he);window.localStorage.setItem(Z,Q),window.localStorage.removeItem(he),t(2,S=ad())}}async function P(he){t(1,k=`Loading project ${he}`),await _d(he),t(1,k="")}const R=()=>Tt(Wt,a={mode:"new-project"},a),F=he=>P(he),j=he=>B(he),U=he=>D(he);function le(he){on[he?"unshift":"push"](()=>{E=he,t(3,E)})}return r.$$set=he=>{"wasmReady"in he&&t(0,_=he.wasmReady),"firstLoad"in he&&t(10,v=he.firstLoad)},[_,k,S,E,d,a,A,D,B,P,v,R,F,j,U,le]}class fE extends Vt{constructor(e){super(),Ut(this,e,dE,hE,zt,{wasmReady:0,firstLoad:10})}}const{window:pE}=Md;function mE(r){let e;return{c(){e=Ve("Choose project")},m(t,i){ae(t,e,i)},d(t){t&&se(e)}}}function gE(r){let e;return{c(){e=Ve("Pick neighbourhood")},m(t,i){ae(t,e,i)},d(t){t&&se(e)}}}function _E(r){let e;return{c(){e=Ve("Editing")},m(t,i){ae(t,e,i)},d(t){t&&se(e)}}}function yE(r){let e,t,i,l,u,d,a,_,v,k,S,E,A,D;return u=new Ii({props:{$$slots:{default:[mE]},$$scope:{ctx:r}}}),u.$on("click",r[8]),_=new Ii({props:{$$slots:{default:[gE]},$$scope:{ctx:r}}}),_.$on("click",r[9]),S=new Ii({props:{$$slots:{default:[_E]},$$scope:{ctx:r}}}),S.$on("click",r[4]),{c(){e=oe("div"),t=oe("nav"),i=oe("ul"),l=oe("li"),Ie(u.$$.fragment),d=Ae(),a=oe("li"),Ie(_.$$.fragment),v=Ae(),k=oe("li"),Ie(S.$$.fragment),E=Ae(),A=oe("li"),A.textContent="Viewing shortcuts",ke(t,"aria-label","breadcrumb"),ke(e,"slot","top")},m(B,P){ae(B,e,P),G(e,t),G(t,i),G(i,l),Ee(u,l,null),G(i,d),G(i,a),Ee(_,a,null),G(i,v),G(i,k),Ee(S,k,null),G(i,E),G(i,A),D=!0},p(B,P){const R={};P&8192&&(R.$$scope={dirty:P,ctx:B}),u.$set(R);const F={};P&8192&&(F.$$scope={dirty:P,ctx:B}),_.$set(F);const j={};P&8192&&(j.$$scope={dirty:P,ctx:B}),S.$set(j)},i(B){D||(J(u.$$.fragment,B),J(_.$$.fragment,B),J(S.$$.fragment,B),D=!0)},o(B){ne(u.$$.fragment,B),ne(_.$$.fragment,B),ne(S.$$.fragment,B),D=!1},d(B){B&&se(e),Me(u),Me(_),Me(S)}}}function vE(r){let e,t,i,l,u,d,a,_,v,k=r[0].shortcutIndex+1+"",S,E,A=r[0].gj.features.length+"",D,B,P,R,F,j,U,le,he,Z=vr(r[0].gj.features[r[0].shortcutIndex].properties).directness.toFixed(1)+"",Q,ye,Ne,re,ve;return{c(){e=oe("p"),e.textContent=`This shows all possible shortcuts crossing the blue road you've chosen.
        A shortcut is defined as a route starting and ending outside the
        neighbourhood, but cutting through it. It might not actually be
        considered a "good shortcut" in practice -- this tool doesn't know any
        real traffic patterns; it's just looking for any possible path. This
        view lets you understand the limits of this assumption.`,t=Ae(),i=oe("button"),i.textContent="Pick a different road",l=Ae(),u=oe("div"),d=oe("button"),a=Ve("Previous"),v=Ae(),S=Ve(k),E=Ve(" / "),D=Ve(A),B=Ae(),P=oe("button"),R=Ve("Next"),j=Ae(),U=oe("p"),le=Ve("This shortcut is "),he=oe("b"),Q=Ve(Z),ye=Ve("x"),Ne=Ve(`
        the length of the shortest route using all roads, not just this neighbourhood`),d.disabled=_=r[0].shortcutIndex==0,ke(d,"data-tooltip","Left"),P.disabled=F=r[0].shortcutIndex==r[0].gj.features.length-1,ke(P,"data-tooltip","Right"),Ai(u,"display","flex"),Ai(u,"justify-content","space-between")},m(Ke,Le){ae(Ke,e,Le),ae(Ke,t,Le),ae(Ke,i,Le),ae(Ke,l,Le),ae(Ke,u,Le),G(u,d),G(d,a),G(u,v),G(u,S),G(u,E),G(u,D),G(u,B),G(u,P),G(P,R),ae(Ke,j,Le),ae(Ke,U,Le),G(U,le),G(U,he),G(he,Q),G(he,ye),G(U,Ne),re||(ve=[St(i,"click",r[7]),St(d,"click",r[5]),St(P,"click",r[6])],re=!0)},p(Ke,Le){Le&1&&_!==(_=Ke[0].shortcutIndex==0)&&(d.disabled=_),Le&1&&k!==(k=Ke[0].shortcutIndex+1+"")&&si(S,k),Le&1&&A!==(A=Ke[0].gj.features.length+"")&&si(D,A),Le&1&&F!==(F=Ke[0].shortcutIndex==Ke[0].gj.features.length-1)&&(P.disabled=F),Le&1&&Z!==(Z=vr(Ke[0].gj.features[Ke[0].shortcutIndex].properties).directness.toFixed(1)+"")&&si(Q,Z)},d(Ke){Ke&&(se(e),se(t),se(i),se(l),se(u),se(j),se(U)),re=!1,hn(ve)}}}function bE(r){let e;return{c(){e=oe("p"),e.textContent="Click a road to see shortcuts"},m(t,i){ae(t,e,i)},p:It,d(t){t&&se(e)}}}function wE(r){let e,t,i,l;t=new uc({}),t.$on("click",r[4]);function u(_,v){if(_[0].state=="neutral")return bE;if(_[0].state=="chose-road")return vE}let d=u(r),a=d&&d(r);return{c(){e=oe("div"),Ie(t.$$.fragment),i=Ae(),a&&a.c(),ke(e,"slot","sidebar")},m(_,v){ae(_,e,v),Ee(t,e,null),G(e,i),a&&a.m(e,null),l=!0},p(_,v){d===(d=u(_))&&a?a.p(_,v):(a&&a.d(1),a=d&&d(_),a&&(a.c(),a.m(e,null)))},i(_){l||(J(t.$$.fragment,_),l=!0)},o(_){ne(t.$$.fragment,_),l=!1},d(_){_&&se(e),Me(t),a&&a.d()}}}function xE(r){let e,t;return e=new Xu({props:{interactive:!1}}),{c(){Ie(e.$$.fragment)},m(i,l){Ee(e,i,l),t=!0},p:It,i(i){t||(J(e.$$.fragment,i),t=!0)},o(i){ne(e.$$.fragment,i),t=!1},d(i){Me(e,i)}}}function kE(r){let e,t;return e=new Xu({props:{onClickLine:r[2],$$slots:{"line-popup":[TE]},$$scope:{ctx:r}}}),{c(){Ie(e.$$.fragment)},m(i,l){Ee(e,i,l),t=!0},p(i,l){const u={};l&8192&&(u.$$scope={dirty:l,ctx:i}),e.$set(u)},i(i){t||(J(e.$$.fragment,i),t=!0)},o(i){ne(e.$$.fragment,i),t=!1},d(i){Me(e,i)}}}function SE(r){let e,t=r[12].shortcuts+"",i,l,u=(r[12].name??"unnamed road")+"",d;return{c(){e=oe("p"),i=Ve(t),l=Ve(" shortcuts through "),d=Ve(u)},m(a,_){ae(a,e,_),G(e,i),G(e,l),G(e,d)},p(a,_){_&4096&&t!==(t=a[12].shortcuts+"")&&si(i,t),_&4096&&u!==(u=(a[12].name??"unnamed road")+"")&&si(d,u)},d(a){a&&se(e)}}}function TE(r){let e,t,i;return t=new Zo({props:{openOn:"hover",$$slots:{default:[SE,({props:l})=>({12:l}),({props:l})=>l?4096:0]},$$scope:{ctx:r}}}),{c(){e=oe("div"),Ie(t.$$.fragment),ke(e,"slot","line-popup")},m(l,u){ae(l,e,u),Ee(t,e,null),i=!0},p(l,u){const d={};u&12288&&(d.$$scope={dirty:u,ctx:l}),t.$set(d)},i(l){i||(J(t.$$.fragment,l),i=!0)},o(l){ne(t.$$.fragment,l),i=!1},d(l){l&&se(e),Me(t)}}}function CE(r){let e,t,i,l,u,d,a,_,v,k;e=new Od({}),i=new Fd({}),u=new Nd({});const S=[kE,xE],E=[];function A(D,B){return D[0].state=="neutral"?0:D[0].state=="chose-road"?1:-1}return~(a=A(r))&&(_=E[a]=S[a](r)),{c(){Ie(e.$$.fragment),t=Ae(),Ie(i.$$.fragment),l=Ae(),Ie(u.$$.fragment),d=Ae(),_&&_.c(),v=En()},m(D,B){Ee(e,D,B),ae(D,t,B),Ee(i,D,B),ae(D,l,B),Ee(u,D,B),ae(D,d,B),~a&&E[a].m(D,B),ae(D,v,B),k=!0},p(D,B){let P=a;a=A(D),a===P?~a&&E[a].p(D,B):(_&&(yi(),ne(E[P],1,1,()=>{E[P]=null}),vi()),~a?(_=E[a],_?_.p(D,B):(_=E[a]=S[a](D),_.c()),J(_,1),_.m(v.parentNode,v)):_=null)},i(D){k||(J(e.$$.fragment,D),J(i.$$.fragment,D),J(u.$$.fragment,D),J(_),k=!0)},o(D){ne(e.$$.fragment,D),ne(i.$$.fragment,D),ne(u.$$.fragment,D),ne(_),k=!1},d(D){D&&(se(t),se(l),se(d),se(v)),Me(e,D),Me(i,D),Me(u,D),~a&&E[a].d(D)}}}function Hy(r){let e,t,i,l,u,d,a,_;return e=new ur({props:{data:r[0].gj.features[r[0].shortcutIndex],$$slots:{default:[EE]},$$scope:{ctx:r}}}),i=new ur({props:{data:r[0].roadGj,$$slots:{default:[ME]},$$scope:{ctx:r}}}),u=new Ua({props:{lngLat:r[0].gj.features[r[0].shortcutIndex].geometry.coordinates[0],$$slots:{default:[IE]},$$scope:{ctx:r}}}),a=new Ua({props:{lngLat:r[0].gj.features[r[0].shortcutIndex].geometry.coordinates[r[0].gj.features[r[0].shortcutIndex].geometry.coordinates.length-1],$$slots:{default:[LE]},$$scope:{ctx:r}}}),{c(){Ie(e.$$.fragment),t=Ae(),Ie(i.$$.fragment),l=Ae(),Ie(u.$$.fragment),d=Ae(),Ie(a.$$.fragment)},m(v,k){Ee(e,v,k),ae(v,t,k),Ee(i,v,k),ae(v,l,k),Ee(u,v,k),ae(v,d,k),Ee(a,v,k),_=!0},p(v,k){const S={};k&1&&(S.data=v[0].gj.features[v[0].shortcutIndex]),k&8192&&(S.$$scope={dirty:k,ctx:v}),e.$set(S);const E={};k&1&&(E.data=v[0].roadGj),k&8192&&(E.$$scope={dirty:k,ctx:v}),i.$set(E);const A={};k&1&&(A.lngLat=v[0].gj.features[v[0].shortcutIndex].geometry.coordinates[0]),k&8192&&(A.$$scope={dirty:k,ctx:v}),u.$set(A);const D={};k&1&&(D.lngLat=v[0].gj.features[v[0].shortcutIndex].geometry.coordinates[v[0].gj.features[v[0].shortcutIndex].geometry.coordinates.length-1]),k&8192&&(D.$$scope={dirty:k,ctx:v}),a.$set(D)},i(v){_||(J(e.$$.fragment,v),J(i.$$.fragment,v),J(u.$$.fragment,v),J(a.$$.fragment,v),_=!0)},o(v){ne(e.$$.fragment,v),ne(i.$$.fragment,v),ne(u.$$.fragment,v),ne(a.$$.fragment,v),_=!1},d(v){v&&(se(t),se(l),se(d)),Me(e,v),Me(i,v),Me(u,v),Me(a,v)}}}function EE(r){let e,t;const i=[un("shortcuts"),{paint:{"line-width":10,"line-color":"cyan"}}];let l={};for(let u=0;u<i.length;u+=1)l=rn(l,i[u]);return e=new Hr({props:l}),{c(){Ie(e.$$.fragment)},m(u,d){Ee(e,u,d),t=!0},p(u,d){const a={};e.$set(a)},i(u){t||(J(e.$$.fragment,u),t=!0)},o(u){ne(e.$$.fragment,u),t=!1},d(u){Me(e,u)}}}function ME(r){let e,t;const i=[un("shortcuts-focus"),{paint:{"line-width":5,"line-color":"blue"}}];let l={};for(let u=0;u<i.length;u+=1)l=rn(l,i[u]);return e=new Hr({props:l}),{c(){Ie(e.$$.fragment)},m(u,d){Ee(e,u,d),t=!0},p(u,d){const a={};e.$set(a)},i(u){t||(J(e.$$.fragment,u),t=!0)},o(u){ne(e.$$.fragment,u),t=!1},d(u){Me(e,u)}}}function IE(r){let e;return{c(){e=Ve("A")},m(t,i){ae(t,e,i)},d(t){t&&se(e)}}}function LE(r){let e;return{c(){e=Ve("B")},m(t,i){ae(t,e,i)},d(t){t&&se(e)}}}function AE(r){let e,t,i,l,u,d;t=new Ku({props:{$$slots:{default:[CE]},$$scope:{ctx:r}}});let a=r[0].state=="chose-road"&&Hy(r);return u=new Va({}),{c(){e=oe("div"),Ie(t.$$.fragment),i=Ae(),a&&a.c(),l=Ae(),Ie(u.$$.fragment),ke(e,"slot","map")},m(_,v){ae(_,e,v),Ee(t,e,null),G(e,i),a&&a.m(e,null),G(e,l),Ee(u,e,null),d=!0},p(_,v){const k={};v&8193&&(k.$$scope={dirty:v,ctx:_}),t.$set(k),_[0].state=="chose-road"?a?(a.p(_,v),v&1&&J(a,1)):(a=Hy(_),a.c(),J(a,1),a.m(e,l)):a&&(yi(),ne(a,1,1,()=>{a=null}),vi())},i(_){d||(J(t.$$.fragment,_),J(a),J(u.$$.fragment,_),d=!0)},o(_){ne(t.$$.fragment,_),ne(a),ne(u.$$.fragment,_),d=!1},d(_){_&&se(e),Me(t),a&&a.d(),Me(u)}}}function PE(r){let e,t,i,l;return e=new Po({props:{$$slots:{map:[AE],sidebar:[wE],top:[yE]},$$scope:{ctx:r}}}),{c(){Ie(e.$$.fragment)},m(u,d){Ee(e,u,d),t=!0,i||(l=St(pE,"keydown",r[3]),i=!0)},p(u,[d]){const a={};d&8195&&(a.$$scope={dirty:d,ctx:u}),e.$set(a)},i(u){t||(J(e.$$.fragment,u),t=!0)},o(u){ne(e.$$.fragment,u),t=!1},d(u){Me(e,u),i=!1,l()}}}function zE(r,e,t){let i,l,u;lt(r,Wt,B=>t(1,i=B)),lt(r,qo,B=>t(10,l=B)),lt(r,Dn,B=>t(11,u=B));let d={state:"neutral"};function a(B,P){let R=u.getShortcutsCrossingRoad(B.properties.id);if(R.features.length==0){window.alert("No shortcuts here");return}t(0,d={state:"chose-road",roadGj:B,gj:R,shortcutIndex:0})}Zu(()=>{l==null||l.keyboard.disable()}),er(()=>{l==null||l.keyboard.enable()});function _(B){d.state=="chose-road"&&(B.key=="ArrowLeft"&&(B.stopPropagation(),d.shortcutIndex>0&&t(0,d.shortcutIndex--,d)),B.key=="ArrowRight"&&(B.stopPropagation(),d.shortcutIndex!=d.gj.features.length-1&&t(0,d.shortcutIndex++,d)))}function v(){Tt(Wt,i={mode:"neighbourhood"},i)}function k(){d.state=="chose-road"&&t(0,d.shortcutIndex--,d)}function S(){d.state=="chose-road"&&t(0,d.shortcutIndex++,d)}return[d,i,a,_,v,k,S,()=>t(0,d={state:"neutral"}),()=>Tt(Wt,i={mode:"title",firstLoad:!1},i),()=>Tt(Wt,i={mode:"network"},i)]}class DE extends Vt{constructor(e){super(),Ut(this,e,zE,PE,zt,{})}}function RE(r){let e,t,i,l,u,d,a,_,v;return l=new oC({}),{c(){e=oe("div"),t=oe("button"),t.innerHTML=`<img src="${yb}" style="height: 6vh;" alt="A/B Street logo"/>`,i=Ae(),Ie(l.$$.fragment),u=Ae(),d=oe("span"),ke(t,"class","outline"),Ai(d,"width","100%"),ke(e,"slot","top"),Ai(e,"display","flex")},m(k,S){ae(k,e,S),G(e,t),G(e,i),Ee(l,e,null),G(e,u),G(e,d),r[19](d),a=!0,_||(v=St(t,"click",r[18]),_=!0)},p:It,i(k){a||(J(l.$$.fragment,k),a=!0)},o(k){ne(l.$$.fragment,k),a=!1},d(k){k&&se(e),Me(l),r[19](null),_=!1,v()}}}function Xy(r){let e,t,i,l,u,d;return i=new xS({props:{map:vr(r[6]),maptilerBasemap:r[7]}}),{c(){e=oe("button"),e.textContent="Zoom to fit study area",t=Ae(),Ie(i.$$.fragment),ke(e,"class","secondary")},m(a,_){ae(a,e,_),ae(a,t,_),Ee(i,a,_),l=!0,u||(d=St(e,"click",r[10]),u=!0)},p(a,_){const v={};_&64&&(v.map=vr(a[6])),_&128&&(v.maptilerBasemap=a[7]),i.$set(v)},i(a){l||(J(i.$$.fragment,a),l=!0)},o(a){ne(i.$$.fragment,a),l=!1},d(a){a&&(se(e),se(t)),Me(i,a),u=!1,d()}}}function BE(r){let e,t,i,l,u,d,a=r[5]&&Xy(r);return{c(){e=oe("div"),t=oe("div"),i=Ae(),l=oe("hr"),u=Ae(),a&&a.c(),ke(e,"slot","left")},m(_,v){ae(_,e,v),G(e,t),r[17](t),G(e,i),G(e,l),G(e,u),a&&a.m(e,null),d=!0},p(_,v){_[5]?a?(a.p(_,v),v&32&&J(a,1)):(a=Xy(_),a.c(),J(a,1),a.m(e,null)):a&&(yi(),ne(a,1,1,()=>{a=null}),vi())},i(_){d||(J(a),d=!0)},o(_){ne(a),d=!1},d(_){_&&se(e),r[17](null),a&&a.d()}}}function FE(r){let e,t;return e=new rE({}),{c(){Ie(e.$$.fragment)},m(i,l){Ee(e,i,l),t=!0},p:It,i(i){t||(J(e.$$.fragment,i),t=!0)},o(i){ne(e.$$.fragment,i),t=!1},d(i){Me(e,i)}}}function OE(r){let e,t;return e=new fE({props:{wasmReady:r[4],firstLoad:r[8].firstLoad}}),{c(){Ie(e.$$.fragment)},m(i,l){Ee(e,i,l),t=!0},p(i,l){const u={};l&16&&(u.wasmReady=i[4]),l&256&&(u.firstLoad=i[8].firstLoad),e.$set(u)},i(i){t||(J(e.$$.fragment,i),t=!0)},o(i){ne(e.$$.fragment,i),t=!1},d(i){Me(e,i)}}}function Ky(r){let e,t,i,l,u,d;e=new ur({props:{data:r[5].getInvertedBoundary(),$$slots:{default:[NE]},$$scope:{ctx:r}}});const a=[XE,HE,WE,GE,ZE,qE,$E,VE,UE,jE],_=[];function v(k,S){return k[8].mode=="network"?0:k[8].mode=="set-boundary"?1:k[8].mode=="auto-boundaries"?2:k[8].mode=="neighbourhood"?3:k[8].mode=="view-shortcuts"?4:k[8].mode=="impact-one-destination"?5:k[8].mode=="route"?6:k[8].mode=="predict-impact"?7:k[8].mode=="impact-detail"?8:k[8].mode=="debug"?9:-1}return~(i=v(r))&&(l=_[i]=a[i](r)),{c(){Ie(e.$$.fragment),t=Ae(),l&&l.c(),u=En()},m(k,S){Ee(e,k,S),ae(k,t,S),~i&&_[i].m(k,S),ae(k,u,S),d=!0},p(k,S){const E={};S&32&&(E.data=k[5].getInvertedBoundary()),S&2097152&&(E.$$scope={dirty:S,ctx:k}),e.$set(E);let A=i;i=v(k),i===A?~i&&_[i].p(k,S):(l&&(yi(),ne(_[A],1,1,()=>{_[A]=null}),vi()),~i?(l=_[i],l?l.p(k,S):(l=_[i]=a[i](k),l.c()),J(l,1),l.m(u.parentNode,u)):l=null)},i(k){d||(J(e.$$.fragment,k),J(l),d=!0)},o(k){ne(e.$$.fragment,k),ne(l),d=!1},d(k){k&&(se(t),se(u)),Me(e,k),~i&&_[i].d(k)}}}function NE(r){let e,t;const i=[un("boundary"),{paint:{"fill-color":"black","fill-opacity":.3}}];let l={};for(let u=0;u<i.length;u+=1)l=rn(l,i[u]);return e=new Es({props:l}),{c(){Ie(e.$$.fragment)},m(u,d){Ee(e,u,d),t=!0},p(u,d){const a={};e.$set(a)},i(u){t||(J(e.$$.fragment,u),t=!0)},o(u){ne(e.$$.fragment,u),t=!1},d(u){Me(e,u)}}}function jE(r){let e,t;return e=new y3({}),{c(){Ie(e.$$.fragment)},m(i,l){Ee(e,i,l),t=!0},p:It,i(i){t||(J(e.$$.fragment,i),t=!0)},o(i){ne(e.$$.fragment,i),t=!1},d(i){Me(e,i)}}}function UE(r){let e,t;return e=new TT({props:{road:r[8].road}}),{c(){Ie(e.$$.fragment)},m(i,l){Ee(e,i,l),t=!0},p(i,l){const u={};l&256&&(u.road=i[8].road),e.$set(u)},i(i){t||(J(e.$$.fragment,i),t=!0)},o(i){ne(e.$$.fragment,i),t=!1},d(i){Me(e,i)}}}function VE(r){let e,t;return e=new f5({}),{c(){Ie(e.$$.fragment)},m(i,l){Ee(e,i,l),t=!0},p:It,i(i){t||(J(e.$$.fragment,i),t=!0)},o(i){ne(e.$$.fragment,i),t=!1},d(i){Me(e,i)}}}function $E(r){let e,t;return e=new C5({props:{prevMode:r[8].prevMode}}),{c(){Ie(e.$$.fragment)},m(i,l){Ee(e,i,l),t=!0},p(i,l){const u={};l&256&&(u.prevMode=i[8].prevMode),e.$set(u)},i(i){t||(J(e.$$.fragment,i),t=!0)},o(i){ne(e.$$.fragment,i),t=!1},d(i){Me(e,i)}}}function qE(r){let e,t;return e=new jT({}),{c(){Ie(e.$$.fragment)},m(i,l){Ee(e,i,l),t=!0},p:It,i(i){t||(J(e.$$.fragment,i),t=!0)},o(i){ne(e.$$.fragment,i),t=!1},d(i){Me(e,i)}}}function ZE(r){let e,t;return e=new DE({}),{c(){Ie(e.$$.fragment)},m(i,l){Ee(e,i,l),t=!0},p:It,i(i){t||(J(e.$$.fragment,i),t=!0)},o(i){ne(e.$$.fragment,i),t=!1},d(i){Me(e,i)}}}function GE(r){let e,t;return e=new fT({}),{c(){Ie(e.$$.fragment)},m(i,l){Ee(e,i,l),t=!0},p:It,i(i){t||(J(e.$$.fragment,i),t=!0)},o(i){ne(e.$$.fragment,i),t=!1},d(i){Me(e,i)}}}function WE(r){let e,t;return e=new OS({}),{c(){Ie(e.$$.fragment)},m(i,l){Ee(e,i,l),t=!0},p:It,i(i){t||(J(e.$$.fragment,i),t=!0)},o(i){ne(e.$$.fragment,i),t=!1},d(i){Me(e,i)}}}function HE(r){let e,t;return e=new eC({props:{name:r[8].name,existing:r[8].existing}}),{c(){Ie(e.$$.fragment)},m(i,l){Ee(e,i,l),t=!0},p(i,l){const u={};l&256&&(u.name=i[8].name),l&256&&(u.existing=i[8].existing),e.$set(u)},i(i){t||(J(e.$$.fragment,i),t=!0)},o(i){ne(e.$$.fragment,i),t=!1},d(i){Me(e,i)}}}function XE(r){let e,t;return e=new i5({}),{c(){Ie(e.$$.fragment)},m(i,l){Ee(e,i,l),t=!0},p:It,i(i){t||(J(e.$$.fragment,i),t=!0)},o(i){ne(e.$$.fragment,i),t=!1},d(i){Me(e,i)}}}function KE(r){let e,t,i,l,u,d,a,_,v,k,S,E,A,D;e=new I0({}),i=new L0({}),u=new S4({props:{map:r[0],apiKey:cp,country:void 0}});const B=[OE,FE],P=[];function R(j,U){return j[8].mode=="title"?0:j[8].mode=="new-project"?1:-1}~(v=R(r))&&(k=P[v]=B[v](r));let F=r[5]&&Ky(r);return A=new nS({}),{c(){Ie(e.$$.fragment),t=Ae(),Ie(i.$$.fragment),l=Ae(),Ie(u.$$.fragment),d=Ae(),a=oe("div"),_=Ae(),k&&k.c(),S=Ae(),F&&F.c(),E=Ae(),Ie(A.$$.fragment)},m(j,U){Ee(e,j,U),ae(j,t,U),Ee(i,j,U),ae(j,l,U),Ee(u,j,U),ae(j,d,U),ae(j,a,U),r[14](a),ae(j,_,U),~v&&P[v].m(j,U),ae(j,S,U),F&&F.m(j,U),ae(j,E,U),Ee(A,j,U),D=!0},p(j,U){const le={};U&1&&(le.map=j[0]),u.$set(le);let he=v;v=R(j),v===he?~v&&P[v].p(j,U):(k&&(yi(),ne(P[he],1,1,()=>{P[he]=null}),vi()),~v?(k=P[v],k?k.p(j,U):(k=P[v]=B[v](j),k.c()),J(k,1),k.m(S.parentNode,S)):k=null),j[5]?F?(F.p(j,U),U&32&&J(F,1)):(F=Ky(j),F.c(),J(F,1),F.m(E.parentNode,E)):F&&(yi(),ne(F,1,1,()=>{F=null}),vi())},i(j){D||(J(e.$$.fragment,j),J(i.$$.fragment,j),J(u.$$.fragment,j),J(k),J(F),J(A.$$.fragment,j),D=!0)},o(j){ne(e.$$.fragment,j),ne(i.$$.fragment,j),ne(u.$$.fragment,j),ne(k),ne(F),ne(A.$$.fragment,j),D=!1},d(j){j&&(se(t),se(l),se(d),se(a),se(_),se(S),se(E)),Me(e,j),Me(i,j),Me(u,j),r[14](null),~v&&P[v].d(j),F&&F.d(j),Me(A,j)}}}function JE(r){let e,t,i,l;function u(a){r[15](a)}let d={style:`https://api.maptiler.com/maps/${r[7]}/style.json?key=${cp}`,hash:!0,images:[{id:"walk_cycle_only",url:"/ltn//filters/walk_cycle_only_icon.gif"},{id:"no_entry",url:"/ltn//filters/no_entry_icon.gif"},{id:"bus_gate",url:"/ltn//filters/bus_gate_icon.gif"},{id:"school_street",url:"/ltn//filters/school_street_icon.gif"},{id:"oneway-arrow",url:_b}],$$slots:{default:[KE]},$$scope:{ctx:r}};return r[0]!==void 0&&(d.map=r[0]),t=new Ex({props:d}),on.push(()=>Wr(t,"map",u)),t.$on("error",r[16]),{c(){e=oe("div"),Ie(t.$$.fragment),ke(e,"slot","main"),Ai(e,"position","relative"),Ai(e,"width","100%"),Ai(e,"height","100%")},m(a,_){ae(a,e,_),Ee(t,e,null),l=!0},p(a,_){const v={};_&128&&(v.style=`https://api.maptiler.com/maps/${a[7]}/style.json?key=${cp}`),_&2097465&&(v.$$scope={dirty:_,ctx:a}),!i&&_&1&&(i=!0,v.map=a[0],Gr(()=>i=!1)),t.$set(v)},i(a){l||(J(t.$$.fragment,a),l=!0)},o(a){ne(t.$$.fragment,a),l=!1},d(a){a&&se(e),Me(t)}}}function YE(r){let e,t,i,l;return e=new Lw({}),i=new Z4({props:{$$slots:{main:[JE],left:[BE],top:[RE]},$$scope:{ctx:r}}}),{c(){Ie(e.$$.fragment),t=Ae(),Ie(i.$$.fragment)},m(u,d){Ee(e,u,d),ae(u,t,d),Ee(i,u,d),l=!0},p(u,[d]){const a={};d&2098175&&(a.$$scope={dirty:d,ctx:u}),i.$set(a)},i(u){l||(J(e.$$.fragment,u),J(i.$$.fragment,u),l=!0)},o(u){ne(e.$$.fragment,u),ne(i.$$.fragment,u),l=!1},d(u){u&&se(t),Me(e,u),Me(i,u)}}}function QE(r,e,t){let i,l,u,d,a,_,v,k,S;lt(r,Sp,Q=>t(11,i=Q)),lt(r,kp,Q=>t(12,l=Q)),lt(r,xp,Q=>t(13,u=Q)),lt(r,Dn,Q=>t(5,d=Q)),lt(r,qo,Q=>t(6,a=Q)),lt(r,Du,Q=>t(20,_=Q)),lt(r,up,Q=>t(7,v=Q)),lt(r,Wt,Q=>t(8,k=Q)),lt(r,kd,Q=>t(9,S=Q));let E=!1;Zu(async()=>{await E0(),await h0(),t(4,E=!0);try{(await fetch("/osm/areas.json")).ok&&(Tt(Du,_=!0,_),console.log("Using local cache, not od2net.org"))}catch{}});let A=null;function D(){a.fitBounds(d.getBounds(),{animate:!1})}let B,P,R;function F(Q){on[Q?"unshift":"push"](()=>{R=Q,t(3,R),t(11,i)})}function j(Q){A=Q,t(0,A)}const U=Q=>{console.log(Q.detail.error)};function le(Q){on[Q?"unshift":"push"](()=>{P=Q,t(2,P),t(12,l)})}const he=()=>Tt(kd,S=!0,S);function Z(Q){on[Q?"unshift":"push"](()=>{B=Q,t(1,B),t(13,u)})}return r.$$.update=()=>{r.$$.dirty&1&&A&&qo.set(A),r.$$.dirty&8194&&B&&u&&(t(1,B.innerHTML="",B),B.appendChild(u)),r.$$.dirty&4100&&P&&l&&(t(2,P.innerHTML="",P),P.appendChild(l)),r.$$.dirty&2056&&R&&i&&(t(3,R.innerHTML="",R),R.appendChild(i))},[A,B,P,R,E,d,a,v,k,S,D,i,l,u,F,j,U,le,he,Z]}class eM extends Vt{constructor(e){super(),Ut(this,e,QE,YE,zt,{})}}new eM({target:document.getElementById("app")});
