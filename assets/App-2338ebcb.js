var ix=Object.defineProperty;var ox=(r,e,t)=>e in r?ix(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var Yn=(r,e,t)=>(ox(r,typeof e!="symbol"?e+"":e,t),t);function sx(r,e){for(var t=0;t<e.length;t++){const n=e[t];if(typeof n!="string"&&!Array.isArray(n)){for(const i in n)if(i!=="default"&&!(i in r)){const o=Object.getOwnPropertyDescriptor(n,i);o&&Object.defineProperty(r,i,o.get?o:{enumerable:!0,get:()=>n[i]})}}}return Object.freeze(Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const u of o.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&n(u)}).observe(document,{childList:!0,subtree:!0});function t(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(i){if(i.ep)return;i.ep=!0;const o=t(i);fetch(i.href,o)}})();function ot(){}function Mt(r,e){for(const t in e)r[t]=e[t];return r}function ax(r){return!!r&&(typeof r=="object"||typeof r=="function")&&typeof r.then=="function"}function Tb(r){return r()}function N_(){return Object.create(null)}function ur(r){r.forEach(Tb)}function vl(r){return typeof r=="function"}function _t(r,e){return r!=r?e==e:r!==e||r&&typeof r=="object"||typeof r=="function"}let Uf;function dr(r,e){return r===e?!0:(Uf||(Uf=document.createElement("a")),Uf.href=e,r===Uf.href)}function lx(r){return Object.keys(r).length===0}function Cb(r,...e){if(r==null){for(const n of e)n(void 0);return ot}const t=r.subscribe(...e);return t.unsubscribe?()=>t.unsubscribe():t}function Ci(r){let e;return Cb(r,t=>e=t)(),e}function st(r,e,t){r.$$.on_destroy.push(Cb(e,t))}function mn(r,e,t,n){if(r){const i=Mb(r,e,t,n);return r[0](i)}}function Mb(r,e,t,n){return r[1]&&n?Mt(t.ctx.slice(),r[1](n(e))):t.ctx}function gn(r,e,t,n){if(r[2]&&n){const i=r[2](n(t));if(e.dirty===void 0)return i;if(typeof i=="object"){const o=[],u=Math.max(e.dirty.length,i.length);for(let a=0;a<u;a+=1)o[a]=e.dirty[a]|i[a];return o}return e.dirty|i}return e.dirty}function _n(r,e,t,n,i,o){if(i){const u=Mb(e,t,n,o);r.p(u,i)}}function yn(r){if(r.ctx.length>32){const e=[],t=r.ctx.length/32;for(let n=0;n<t;n++)e[n]=-1;return e}return-1}function pr(r){const e={};for(const t in r)t[0]!=="$"&&(e[t]=r[t]);return e}function j_(r,e){const t={};e=new Set(e);for(const n in r)!e.has(n)&&n[0]!=="$"&&(t[n]=r[n]);return t}function $m(r){const e={};for(const t in r)e[t]=!0;return e}function Bu(r){return r??""}function an(r,e,t){return r.set(t),e}function nm(r){return r&&vl(r.destroy)?r.destroy:ot}const Lb=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function D(r,e){r.appendChild(e)}function Z(r,e,t){r.insertBefore(e,t||null)}function q(r){r.parentNode&&r.parentNode.removeChild(r)}function gi(r,e){for(let t=0;t<r.length;t+=1)r[t]&&r[t].d(e)}function j(r){return document.createElement(r)}function ms(r){return document.createElementNS("http://www.w3.org/2000/svg",r)}function Ee(r){return document.createTextNode(r)}function ie(){return Ee(" ")}function Xn(){return Ee("")}function Tt(r,e,t,n){return r.addEventListener(e,t,n),()=>r.removeEventListener(e,t,n)}function Om(r){return function(e){return e.preventDefault(),r.call(this,e)}}function oh(r){return function(e){return e.stopPropagation(),r.call(this,e)}}function ae(r,e,t){t==null?r.removeAttribute(e):r.getAttribute(e)!==t&&r.setAttribute(e,t)}function ud(r,e){for(const t in e)ae(r,t,e[t])}function ux(r,e,t){const n=new Set;for(let i=0;i<r.length;i+=1)r[i].checked&&n.add(r[i].__value);return t||n.delete(e),Array.from(n)}function Nm(r){let e;return{p(...t){e=t,e.forEach(n=>r.push(n))},r(){e.forEach(t=>r.splice(r.indexOf(t),1))}}}function gl(r){return r===""?null:+r}function cx(r){return Array.from(r.childNodes)}function gt(r,e){e=""+e,r.data!==e&&(r.data=e)}function Vn(r,e){r.value=e??""}function Ye(r,e,t,n){t==null?r.style.removeProperty(e):r.style.setProperty(e,t,n?"important":"")}function Hi(r,e,t){for(let n=0;n<r.options.length;n+=1){const i=r.options[n];if(i.__value===e){i.selected=!0;return}}(!t||e!==void 0)&&(r.selectedIndex=-1)}function Sa(r){const e=r.querySelector(":checked");return e&&e.__value}function jt(r,e,t){r.classList.toggle(e,!!t)}function hx(r,e,{bubbles:t=!1,cancelable:n=!1}={}){return new CustomEvent(r,{detail:e,bubbles:t,cancelable:n})}let mh;function Xs(r){mh=r}function ju(){if(!mh)throw new Error("Function called outside component initialization");return mh}function Es(r){ju().$$.on_mount.push(r)}function ti(r){ju().$$.on_destroy.push(r)}function Is(){const r=ju();return(e,t,{cancelable:n=!1}={})=>{const i=r.$$.callbacks[e];if(i){const o=hx(e,t,{cancelable:n});return i.slice().forEach(u=>{u.call(r,o)}),!o.defaultPrevented}return!0}}function wd(r,e){return ju().$$.context.set(r,e),e}function Th(r){return ju().$$.context.get(r)}function In(r,e){const t=r.$$.callbacks[e.type];t&&t.slice().forEach(n=>n.call(this,e))}const Lu=[],un=[];let zu=[];const rm=[],Eb=Promise.resolve();let im=!1;function Ib(){im||(im=!0,Eb.then(jm))}function Ab(){return Ib(),Eb}function ds(r){zu.push(r)}function An(r){rm.push(r)}const jp=new Set;let wu=0;function jm(){if(wu!==0)return;const r=mh;do{try{for(;wu<Lu.length;){const e=Lu[wu];wu++,Xs(e),fx(e.$$)}}catch(e){throw Lu.length=0,wu=0,e}for(Xs(null),Lu.length=0,wu=0;un.length;)un.pop()();for(let e=0;e<zu.length;e+=1){const t=zu[e];jp.has(t)||(jp.add(t),t())}zu.length=0}while(Lu.length);for(;rm.length;)rm.pop()();im=!1,jp.clear(),Xs(r)}function fx(r){if(r.fragment!==null){r.update(),ur(r.before_update);const e=r.dirty;r.dirty=[-1],r.fragment&&r.fragment.p(r.ctx,e),r.after_update.forEach(ds)}}function dx(r){const e=[],t=[];zu.forEach(n=>r.indexOf(n)===-1?e.push(n):t.push(n)),t.forEach(n=>n()),zu=e}const Yf=new Set;let dl;function Kt(){dl={r:0,c:[],p:dl}}function Xt(){dl.r||ur(dl.c),dl=dl.p}function N(r,e){r&&r.i&&(Yf.delete(r),r.i(e))}function V(r,e,t,n){if(r&&r.o){if(Yf.has(r))return;Yf.add(r),dl.c.push(()=>{Yf.delete(r),n&&(t&&r.d(1),n())}),r.o(e)}else n&&n()}function U_(r,e){const t=e.token={};function n(i,o,u,a){if(e.token!==t)return;e.resolved=a;let d=e.ctx;u!==void 0&&(d=d.slice(),d[u]=a);const p=i&&(e.current=i)(d);let g=!1;e.block&&(e.blocks?e.blocks.forEach((y,x)=>{x!==o&&y&&(Kt(),V(y,1,1,()=>{e.blocks[x]===y&&(e.blocks[x]=null)}),Xt())}):e.block.d(1),p.c(),N(p,1),p.m(e.mount(),e.anchor),g=!0),e.block=p,e.blocks&&(e.blocks[o]=p),g&&jm()}if(ax(r)){const i=ju();if(r.then(o=>{Xs(i),n(e.then,1,e.value,o),Xs(null)},o=>{if(Xs(i),n(e.catch,2,e.error,o),Xs(null),!e.hasCatch)throw o}),e.current!==e.pending)return n(e.pending,0),!0}else{if(e.current!==e.then)return n(e.then,1,e.value,r),!0;e.resolved=r}}function px(r,e,t){const n=e.slice(),{resolved:i}=r;r.current===r.then&&(n[r.value]=i),r.current===r.catch&&(n[r.error]=i),r.block.p(n,t)}function Rn(r){return(r==null?void 0:r.length)!==void 0?r:Array.from(r)}function mx(r,e){V(r,1,1,()=>{e.delete(r.key)})}function gx(r,e,t,n,i,o,u,a,d,p,g,y){let x=r.length,C=o.length,M=x;const F={};for(;M--;)F[r[M].key]=M;const z=[],E=new Map,P=new Map,$=[];for(M=C;M--;){const W=y(i,o,M),J=t(W);let he=u.get(J);he?n&&$.push(()=>he.p(W,e)):(he=p(J,W),he.c()),E.set(J,z[M]=he),J in F&&P.set(J,Math.abs(M-F[J]))}const U=new Set,K=new Set;function ee(W){N(W,1),W.m(a,g),u.set(W.key,W),g=W.first,C--}for(;x&&C;){const W=z[C-1],J=r[x-1],he=W.key,Ae=J.key;W===J?(g=W.first,x--,C--):E.has(Ae)?!u.has(he)||U.has(he)?ee(W):K.has(Ae)?x--:P.get(he)>P.get(Ae)?(K.add(he),ee(W)):(U.add(Ae),x--):(d(J,u),x--)}for(;x--;){const W=r[x];E.has(W.key)||d(W,u)}for(;C;)ee(z[C-1]);return ur($),z}function En(r,e){const t={},n={},i={$$scope:1};let o=r.length;for(;o--;){const u=r[o],a=e[o];if(a){for(const d in u)d in a||(n[d]=1);for(const d in a)i[d]||(t[d]=a[d],i[d]=1);r[o]=a}else for(const d in u)i[d]=1}for(const u in n)u in t||(t[u]=void 0);return t}function bo(r){return typeof r=="object"&&r!==null?r:{}}function Pn(r,e,t){const n=r.$$.props[e];n!==void 0&&(r.$$.bound[n]=t,t(r.$$.ctx[n]))}function ce(r){r&&r.c()}function le(r,e,t){const{fragment:n,after_update:i}=r.$$;n&&n.m(e,t),ds(()=>{const o=r.$$.on_mount.map(Tb).filter(vl);r.$$.on_destroy?r.$$.on_destroy.push(...o):ur(o),r.$$.on_mount=[]}),i.forEach(ds)}function ue(r,e){const t=r.$$;t.fragment!==null&&(dx(t.after_update),ur(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function _x(r,e){r.$$.dirty[0]===-1&&(Lu.push(r),Ib(),r.$$.dirty.fill(0)),r.$$.dirty[e/31|0]|=1<<e%31}function kt(r,e,t,n,i,o,u=null,a=[-1]){const d=mh;Xs(r);const p=r.$$={fragment:null,ctx:[],props:o,update:ot,not_equal:i,bound:N_(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(d?d.$$.context:[])),callbacks:N_(),dirty:a,skip_bound:!1,root:e.target||d.$$.root};u&&u(p.root);let g=!1;if(p.ctx=t?t(r,e.props||{},(y,x,...C)=>{const M=C.length?C[0]:x;return p.ctx&&i(p.ctx[y],p.ctx[y]=M)&&(!p.skip_bound&&p.bound[y]&&p.bound[y](M),g&&_x(r,y)),x}):[],p.update(),g=!0,ur(p.before_update),p.fragment=n?n(p.ctx):!1,e.target){if(e.hydrate){const y=cx(e.target);p.fragment&&p.fragment.l(y),y.forEach(q)}else p.fragment&&p.fragment.c();e.intro&&N(r.$$.fragment),le(r,e.target,e.anchor),jm()}Xs(d)}class St{constructor(){Yn(this,"$$");Yn(this,"$$set")}$destroy(){ue(this,1),this.$destroy=ot}$on(e,t){if(!vl(t))return ot;const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const i=n.indexOf(t);i!==-1&&n.splice(i,1)}}$set(e){this.$$set&&!lx(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const yx="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(yx);const bx="/ltn/assets/arrow-big-up-4ad5891e.png",vx="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAk0lEQVRIS+3U0Q2AIAwEUNjMUXQydRJH0zZB0wjGuwJfSsKfuWfO1hg6n9g5P3wPWKTSXe6EVstUNEjoloIVghAG0OxR7swgLEAjHoBCvACM1AAQUgJ0DL0nm67WwJom7XrBlhVl4arUAHYniuE1ABTuBeBwD0CFs4D92T12fp9v9iPrnJ8LBu0KC0Ch9qEfeK3sAPceHxk8hJ17AAAAAElFTkSuQmCC",wx="/ltn/assets/logo-97f2d067.svg",Pb="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAJCAYAAAACTR1pAAAACXBIWXMAAANVAAADaAEorMqLAAAAGXRFWHRTb2Z0d2FyZQB3d3cuaW5rc2NhcGUub3Jnm+48GgAAAPtJREFUKJF9kT1LwwAURc+NAQsdtFYHa8HBSAcHJ0HBUVz0n7i4ObkoKAV/gYObm5ubu7OKFMQPECFuoQgWRJtch9aSYvSO770D53Flm58kM401BdkesAJcYw4m4scz8kf9qGBGe3ZuNcuCHcEmcGv7qBo/nWKnAzCpR8+/yMGWUWAcU0L6wn4DOgAhcFHEGEoBLGAqoK7te6Eb406h6vv0/NRnyBawDYyATzKFzcmXu9chmaQeHfesVDZeFGqAU0QrMy3BR5FRCKz31FxGGrMdIrpATVD98/0hVSlo16INB9oFLyEuldKsxA/n/4O59DvdB5YNVzKH+U6/AaiZavkY71DDAAAAAElFTkSuQmCC";function V_(r){let e,t,n,i=r[1]!=null&&q_(r);return{c(){e=j("div"),t=Ee(r[0]),n=ie(),i&&i.c(),ae(e,"class","cover svelte-1w7hi45")},m(o,u){Z(o,e,u),D(e,t),D(e,n),i&&i.m(e,null)},p(o,u){u&1&&gt(t,o[0]),o[1]!=null?i?i.p(o,u):(i=q_(o),i.c(),i.m(e,null)):i&&(i.d(1),i=null)},d(o){o&&q(e),i&&i.d()}}}function q_(r){let e,t;return{c(){e=j("div"),t=j("progress"),t.value=r[1],Ye(t,"width","100%")},m(n,i){Z(n,e,i),D(e,t)},p(n,i){i&2&&(t.value=n[1])},d(n){n&&q(e)}}}function xx(r){let e,t=r[0]&&V_(r);return{c(){t&&t.c(),e=Xn()},m(n,i){t&&t.m(n,i),Z(n,e,i)},p(n,[i]){n[0]?t?t.p(n,i):(t=V_(n),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:ot,o:ot,d(n){n&&q(e),t&&t.d(n)}}}function kx(r,e,t){let{loading:n}=e,{progress:i=null}=e;return r.$$set=o=>{"loading"in o&&t(0,n=o.loading),"progress"in o&&t(1,i=o.progress)},[n,i]}class Ch extends St{constructor(e){super(),kt(this,e,kx,xx,_t,{loading:0,progress:1})}}function Sx(r){let e,t,n,i,o;const u=r[5].default,a=mn(u,r,r[4],null);return{c(){e=j("dialog"),t=j("article"),a&&a.c()},m(d,p){Z(d,e,p),D(e,t),a&&a.m(t,null),r[6](e),n=!0,i||(o=[Tt(e,"click",oh(r[1])),Tt(e,"keydown",r[2])],i=!0)},p(d,[p]){a&&a.p&&(!n||p&16)&&_n(a,u,d,d[4],n?gn(u,d[4],p,null):yn(d[4]),null)},i(d){n||(N(a,d),n=!0)},o(d){V(a,d),n=!1},d(d){d&&q(e),a&&a.d(d),r[6](null),i=!1,ur(o)}}}function Tx(r,e,t){let{$$slots:n={},$$scope:i}=e,{show:o=!1}=e,u;function a(g){g.target==u&&t(3,o=!1)}function d(g){(g.key=="Escape"||g.key=="Enter")&&(g.stopPropagation(),t(3,o=!1))}function p(g){un[g?"unshift":"push"](()=>{u=g,t(0,u)})}return r.$$set=g=>{"show"in g&&t(3,o=g.show),"$$scope"in g&&t(4,i=g.$$scope)},r.$$.update=()=>{r.$$.dirty&9&&u&&(o?u.showModal():u.close())},[u,a,d,o,i,n,p]}class Um extends St{constructor(e){super(),kt(this,e,Tx,Sx,_t,{show:3})}}function Z_(r,e,t){const n=r.slice();return n[1]=e[t][0],n[2]=e[t][1],n}function G_(r){let e,t,n=r[1]+"",i,o,u,a=r[2]+"",d,p;return{c(){e=j("tr"),t=j("td"),i=Ee(n),o=ie(),u=j("td"),d=Ee(a),p=ie()},m(g,y){Z(g,e,y),D(e,t),D(t,i),D(e,o),D(e,u),D(u,d),D(e,p)},p(g,y){y&1&&n!==(n=g[1]+"")&&gt(i,n),y&1&&a!==(a=g[2]+"")&&gt(d,a)},d(g){g&&q(e)}}}function Cx(r){let e,t,n=Rn(Object.entries(r[0])),i=[];for(let o=0;o<n.length;o+=1)i[o]=G_(Z_(r,n,o));return{c(){e=j("table"),t=j("tbody");for(let o=0;o<i.length;o+=1)i[o].c();ae(e,"class","svelte-lh2o9l")},m(o,u){Z(o,e,u),D(e,t);for(let a=0;a<i.length;a+=1)i[a]&&i[a].m(t,null)},p(o,[u]){if(u&1){n=Rn(Object.entries(o[0]));let a;for(a=0;a<n.length;a+=1){const d=Z_(o,n,a);i[a]?i[a].p(d,u):(i[a]=G_(d),i[a].c(),i[a].m(t,null))}for(;a<i.length;a+=1)i[a].d(1);i.length=n.length}},i:ot,o:ot,d(o){o&&q(e),gi(i,o)}}}function Mx(r,e,t){let{properties:n}=e;return r.$$set=i=>{"properties"in i&&t(0,n=i.properties)},[n]}class Mh extends St{constructor(e){super(),kt(this,e,Mx,Cx,_t,{properties:0})}}function xd(r,e){let t=document.createElement("a");t.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(e)),t.setAttribute("download",r),document.body.appendChild(t),t.click(),document.body.removeChild(t)}function or(r){if(r==null||r==null)throw new Error("Oops, notNull given something null");return r}var zb=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Db(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function Vm(r){if(r.__esModule)return r;var e=r.default;if(typeof e=="function"){var t=function n(){return this instanceof n?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(r).forEach(function(n){var i=Object.getOwnPropertyDescriptor(r,n);Object.defineProperty(t,n,i.get?i:{enumerable:!0,get:function(){return r[n]}})}),t}var Rb={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v4.1.3/LICENSE.txt
 */(function(r,e){(function(t,n){r.exports=n()})(zb,function(){var t={},n={};function i(u,a,d){if(n[u]=d,u==="index"){var p="var sharedModule = {}; ("+n.shared+")(sharedModule); ("+n.worker+")(sharedModule);",g={};return n.shared(g),n.index(t,g),typeof window<"u"&&t.setWorkerUrl(window.URL.createObjectURL(new Blob([p],{type:"text/javascript"}))),t}}i("shared",["exports"],function(u){function a(c,s,h,m){return new(h||(h=Promise))(function(v,S){function T(O){try{R(m.next(O))}catch(H){S(H)}}function L(O){try{R(m.throw(O))}catch(H){S(H)}}function R(O){var H;O.done?v(O.value):(H=O.value,H instanceof h?H:new h(function(X){X(H)})).then(T,L)}R((m=m.apply(c,s||[])).next())})}function d(c){return c&&c.__esModule&&Object.prototype.hasOwnProperty.call(c,"default")?c.default:c}typeof SuppressedError=="function"&&SuppressedError;var p=g;function g(c,s){this.x=c,this.y=s}g.prototype={clone:function(){return new g(this.x,this.y)},add:function(c){return this.clone()._add(c)},sub:function(c){return this.clone()._sub(c)},multByPoint:function(c){return this.clone()._multByPoint(c)},divByPoint:function(c){return this.clone()._divByPoint(c)},mult:function(c){return this.clone()._mult(c)},div:function(c){return this.clone()._div(c)},rotate:function(c){return this.clone()._rotate(c)},rotateAround:function(c,s){return this.clone()._rotateAround(c,s)},matMult:function(c){return this.clone()._matMult(c)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(c){return this.x===c.x&&this.y===c.y},dist:function(c){return Math.sqrt(this.distSqr(c))},distSqr:function(c){var s=c.x-this.x,h=c.y-this.y;return s*s+h*h},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(c){return Math.atan2(this.y-c.y,this.x-c.x)},angleWith:function(c){return this.angleWithSep(c.x,c.y)},angleWithSep:function(c,s){return Math.atan2(this.x*s-this.y*c,this.x*c+this.y*s)},_matMult:function(c){var s=c[2]*this.x+c[3]*this.y;return this.x=c[0]*this.x+c[1]*this.y,this.y=s,this},_add:function(c){return this.x+=c.x,this.y+=c.y,this},_sub:function(c){return this.x-=c.x,this.y-=c.y,this},_mult:function(c){return this.x*=c,this.y*=c,this},_div:function(c){return this.x/=c,this.y/=c,this},_multByPoint:function(c){return this.x*=c.x,this.y*=c.y,this},_divByPoint:function(c){return this.x/=c.x,this.y/=c.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var c=this.y;return this.y=this.x,this.x=-c,this},_rotate:function(c){var s=Math.cos(c),h=Math.sin(c),m=h*this.x+s*this.y;return this.x=s*this.x-h*this.y,this.y=m,this},_rotateAround:function(c,s){var h=Math.cos(c),m=Math.sin(c),v=s.y+m*(this.x-s.x)+h*(this.y-s.y);return this.x=s.x+h*(this.x-s.x)-m*(this.y-s.y),this.y=v,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},g.convert=function(c){return c instanceof g?c:Array.isArray(c)?new g(c[0],c[1]):c};var y=d(p),x=C;function C(c,s,h,m){this.cx=3*c,this.bx=3*(h-c)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*s,this.by=3*(m-s)-this.cy,this.ay=1-this.cy-this.by,this.p1x=c,this.p1y=s,this.p2x=h,this.p2y=m}C.prototype={sampleCurveX:function(c){return((this.ax*c+this.bx)*c+this.cx)*c},sampleCurveY:function(c){return((this.ay*c+this.by)*c+this.cy)*c},sampleCurveDerivativeX:function(c){return(3*this.ax*c+2*this.bx)*c+this.cx},solveCurveX:function(c,s){if(s===void 0&&(s=1e-6),c<0)return 0;if(c>1)return 1;for(var h=c,m=0;m<8;m++){var v=this.sampleCurveX(h)-c;if(Math.abs(v)<s)return h;var S=this.sampleCurveDerivativeX(h);if(Math.abs(S)<1e-6)break;h-=v/S}var T=0,L=1;for(h=c,m=0;m<20&&(v=this.sampleCurveX(h),!(Math.abs(v-c)<s));m++)c>v?T=h:L=h,h=.5*(L-T)+T;return h},solve:function(c,s){return this.sampleCurveY(this.solveCurveX(c,s))}};var M=d(x);let F,z;function E(){return F==null&&(F=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),F}function P(){if(z==null&&(z=!1,E())){const s=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(s){for(let m=0;m<5*5;m++){const v=4*m;s.fillStyle=`rgb(${v},${v+1},${v+2})`,s.fillRect(m%5,Math.floor(m/5),1,1)}const h=s.getImageData(0,0,5,5).data;for(let m=0;m<5*5*4;m++)if(m%4!=3&&h[m]!==m){z=!0;break}}}return z||!1}function $(c,s,h,m){const v=new M(c,s,h,m);return function(S){return v.solve(S)}}const U=$(.25,.1,.25,1);function K(c,s,h){return Math.min(h,Math.max(s,c))}function ee(c,s,h){const m=h-s,v=((c-s)%m+m)%m+s;return v===s?h:v}function W(c,...s){for(const h of s)for(const m in h)c[m]=h[m];return c}let J=1;function he(c,s,h){const m={};for(const v in c)m[v]=s.call(h||this,c[v],v,c);return m}function Ae(c,s,h){const m={};for(const v in c)s.call(h||this,c[v],v,c)&&(m[v]=c[v]);return m}function ne(c){return Array.isArray(c)?c.map(ne):typeof c=="object"&&c?he(c,ne):c}const fe={};function Ce(c){fe[c]||(typeof console<"u"&&console.warn(c),fe[c]=!0)}function _e(c,s,h){return(h.y-c.y)*(s.x-c.x)>(s.y-c.y)*(h.x-c.x)}function Ze(c){let s=0;for(let h,m,v=0,S=c.length,T=S-1;v<S;T=v++)h=c[v],m=c[T],s+=(m.x-h.x)*(h.y+m.y);return s}function Oe(c){return typeof WorkerGlobalScope<"u"&&c!==void 0&&c instanceof WorkerGlobalScope}let je=null;function De(c){return typeof ImageBitmap<"u"&&c instanceof ImageBitmap}const At="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function ut(c,s,h,m,v){return a(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const S=new VideoFrame(c,{timestamp:0});try{const T=S==null?void 0:S.format;if(!T||!T.startsWith("BGR")&&!T.startsWith("RGB"))throw new Error(`Unrecognized format ${T}`);const L=T.startsWith("BGR"),R=new Uint8ClampedArray(m*v*4);if(yield S.copyTo(R,function(O,H,X,oe,de){const ge=4*Math.max(-H,0),ve=(Math.max(0,X)-X)*oe*4+ge,Me=4*oe,Pe=Math.max(0,H),He=Math.max(0,X);return{rect:{x:Pe,y:He,width:Math.min(O.width,H+oe)-Pe,height:Math.min(O.height,X+de)-He},layout:[{offset:ve,stride:Me}]}}(c,s,h,m,v)),L)for(let O=0;O<R.length;O+=4){const H=R[O];R[O]=R[O+2],R[O+2]=H}return R}finally{S.close()}})}let ht,wt;const pt="AbortError";function Qe(){return new Error(pt)}const Ft={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function bt(c){return Ft.REGISTERED_PROTOCOLS[c.substring(0,c.indexOf("://"))]}const Bt="global-dispatcher";class Pt extends Error{constructor(s,h,m,v){super(`AJAXError: ${h} (${s}): ${m}`),this.status=s,this.statusText=h,this.url=m,this.body=v}}const Qt=()=>Oe(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,vn=function(c,s){if(/:\/\//.test(c.url)&&!/^https?:|^file:/.test(c.url)){const m=bt(c.url);if(m)return m(c,s);if(Oe(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:c,targetMapId:Bt},s)}if(!(/^file:/.test(h=c.url)||/^file:/.test(Qt())&&!/^\w+:/.test(h))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(m,v){return a(this,void 0,void 0,function*(){const S=new Request(m.url,{method:m.method||"GET",body:m.body,credentials:m.credentials,headers:m.headers,cache:m.cache,referrer:Qt(),signal:v.signal});m.type==="json"&&S.headers.set("Accept","application/json");const T=yield fetch(S);if(!T.ok){const O=yield T.blob();throw new Pt(T.status,T.statusText,m.url,O)}let L;L=m.type==="arrayBuffer"||m.type==="image"?T.arrayBuffer():m.type==="json"?T.json():T.text();const R=yield L;if(v.signal.aborted)throw Qe();return{data:R,cacheControl:T.headers.get("Cache-Control"),expires:T.headers.get("Expires")}})}(c,s);if(Oe(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:c,mustQueue:!0,targetMapId:Bt},s)}var h;return function(m,v){return new Promise((S,T)=>{const L=new XMLHttpRequest;L.open(m.method||"GET",m.url,!0),m.type!=="arrayBuffer"&&m.type!=="image"||(L.responseType="arraybuffer");for(const R in m.headers)L.setRequestHeader(R,m.headers[R]);m.type==="json"&&(L.responseType="text",L.setRequestHeader("Accept","application/json")),L.withCredentials=m.credentials==="include",L.onerror=()=>{T(new Error(L.statusText))},L.onload=()=>{if(!v.signal.aborted)if((L.status>=200&&L.status<300||L.status===0)&&L.response!==null){let R=L.response;if(m.type==="json")try{R=JSON.parse(L.response)}catch(O){return void T(O)}S({data:R,cacheControl:L.getResponseHeader("Cache-Control"),expires:L.getResponseHeader("Expires")})}else{const R=new Blob([L.response],{type:L.getResponseHeader("Content-Type")});T(new Pt(L.status,L.statusText,m.url,R))}},v.signal.addEventListener("abort",()=>{L.abort(),T(Qe())}),L.send(m.body)})}(c,s)};function qt(c){if(!c||c.indexOf("://")<=0||c.indexOf("data:image/")===0||c.indexOf("blob:")===0)return!0;const s=new URL(c),h=window.location;return s.protocol===h.protocol&&s.host===h.host}function rn(c,s,h){h[c]&&h[c].indexOf(s)!==-1||(h[c]=h[c]||[],h[c].push(s))}function Ge(c,s,h){if(h&&h[c]){const m=h[c].indexOf(s);m!==-1&&h[c].splice(m,1)}}class qe{constructor(s,h={}){W(this,h),this.type=s}}class Je extends qe{constructor(s,h={}){super("error",W({error:s},h))}}class Et{on(s,h){return this._listeners=this._listeners||{},rn(s,h,this._listeners),this}off(s,h){return Ge(s,h,this._listeners),Ge(s,h,this._oneTimeListeners),this}once(s,h){return h?(this._oneTimeListeners=this._oneTimeListeners||{},rn(s,h,this._oneTimeListeners),this):new Promise(m=>this.once(s,m))}fire(s,h){typeof s=="string"&&(s=new qe(s,h||{}));const m=s.type;if(this.listens(m)){s.target=this;const v=this._listeners&&this._listeners[m]?this._listeners[m].slice():[];for(const L of v)L.call(this,s);const S=this._oneTimeListeners&&this._oneTimeListeners[m]?this._oneTimeListeners[m].slice():[];for(const L of S)Ge(m,L,this._oneTimeListeners),L.call(this,s);const T=this._eventedParent;T&&(W(s,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),T.fire(s))}else s instanceof Je&&console.error(s.error);return this}listens(s){return this._listeners&&this._listeners[s]&&this._listeners[s].length>0||this._oneTimeListeners&&this._oneTimeListeners[s]&&this._oneTimeListeners[s].length>0||this._eventedParent&&this._eventedParent.listens(s)}setEventedParent(s,h){return this._eventedParent=s,this._eventedParentData=h,this}}var ye={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const kn=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Ue(c,s){const h={};for(const m in c)m!=="ref"&&(h[m]=c[m]);return kn.forEach(m=>{m in s&&(h[m]=s[m])}),h}function it(c,s){if(Array.isArray(c)){if(!Array.isArray(s)||c.length!==s.length)return!1;for(let h=0;h<c.length;h++)if(!it(c[h],s[h]))return!1;return!0}if(typeof c=="object"&&c!==null&&s!==null){if(typeof s!="object"||Object.keys(c).length!==Object.keys(s).length)return!1;for(const h in c)if(!it(c[h],s[h]))return!1;return!0}return c===s}function Wt(c,s){c.push(s)}function cr(c,s,h){Wt(h,{command:"addSource",args:[c,s[c]]})}function _r(c,s,h){Wt(s,{command:"removeSource",args:[c]}),h[c]=!0}function yr(c,s,h,m){_r(c,h,m),cr(c,s,h)}function ni(c,s,h){let m;for(m in c[h])if(Object.prototype.hasOwnProperty.call(c[h],m)&&m!=="data"&&!it(c[h][m],s[h][m]))return!1;for(m in s[h])if(Object.prototype.hasOwnProperty.call(s[h],m)&&m!=="data"&&!it(c[h][m],s[h][m]))return!1;return!0}function jr(c,s,h,m,v,S){c=c||{},s=s||{};for(const T in c)Object.prototype.hasOwnProperty.call(c,T)&&(it(c[T],s[T])||h.push({command:S,args:[m,T,s[T],v]}));for(const T in s)Object.prototype.hasOwnProperty.call(s,T)&&!Object.prototype.hasOwnProperty.call(c,T)&&(it(c[T],s[T])||h.push({command:S,args:[m,T,s[T],v]}))}function xo(c){return c.id}function hr(c,s){return c[s.id]=s,c}class vt{constructor(s,h,m,v){this.message=(s?`${s}: `:"")+m,v&&(this.identifier=v),h!=null&&h.__line__&&(this.line=h.__line__)}}function Pr(c,...s){for(const h of s)for(const m in h)c[m]=h[m];return c}class Mr extends Error{constructor(s,h){super(h),this.message=h,this.key=s}}class zr{constructor(s,h=[]){this.parent=s,this.bindings={};for(const[m,v]of h)this.bindings[m]=v}concat(s){return new zr(this,s)}get(s){if(this.bindings[s])return this.bindings[s];if(this.parent)return this.parent.get(s);throw new Error(`${s} not found in scope.`)}has(s){return!!this.bindings[s]||!!this.parent&&this.parent.has(s)}}const qn={kind:"null"},It={kind:"number"},fn={kind:"string"},on={kind:"boolean"},Qn={kind:"color"},pi={kind:"object"},pn={kind:"value"},Di={kind:"collator"},er={kind:"formatted"},we={kind:"padding"},re={kind:"resolvedImage"},se={kind:"variableAnchorOffsetCollection"};function pe(c,s){return{kind:"array",itemType:c,N:s}}function xe(c){if(c.kind==="array"){const s=xe(c.itemType);return typeof c.N=="number"?`array<${s}, ${c.N}>`:c.itemType.kind==="value"?"array":`array<${s}>`}return c.kind}const Fe=[qn,It,fn,on,Qn,er,pi,pe(pn),we,re,se];function Be(c,s){if(s.kind==="error")return null;if(c.kind==="array"){if(s.kind==="array"&&(s.N===0&&s.itemType.kind==="value"||!Be(c.itemType,s.itemType))&&(typeof c.N!="number"||c.N===s.N))return null}else{if(c.kind===s.kind)return null;if(c.kind==="value"){for(const h of Fe)if(!Be(h,s))return null}}return`Expected ${xe(c)} but found ${xe(s)} instead.`}function $e(c,s){return s.some(h=>h.kind===c.kind)}function Se(c,s){return s.some(h=>h==="null"?c===null:h==="array"?Array.isArray(c):h==="object"?c&&!Array.isArray(c)&&typeof c=="object":h===typeof c)}function Q(c,s){return c.kind==="array"&&s.kind==="array"?c.itemType.kind===s.itemType.kind&&typeof c.N=="number":c.kind===s.kind}const We=.96422,Xe=.82521,tt=4/29,lt=6/29,Lt=3*lt*lt,Jt=lt*lt*lt,cn=Math.PI/180,Sn=180/Math.PI;function Fn(c){return(c%=360)<0&&(c+=360),c}function xr([c,s,h,m]){let v,S;const T=Tn((.2225045*(c=Hr(c))+.7168786*(s=Hr(s))+.0606169*(h=Hr(h)))/1);c===s&&s===h?v=S=T:(v=Tn((.4360747*c+.3850649*s+.1430804*h)/We),S=Tn((.0139322*c+.0971045*s+.7141733*h)/Xe));const L=116*T-16;return[L<0?0:L,500*(v-T),200*(T-S),m]}function Hr(c){return c<=.04045?c/12.92:Math.pow((c+.055)/1.055,2.4)}function Tn(c){return c>Jt?Math.pow(c,1/3):c/Lt+tt}function Dr([c,s,h,m]){let v=(c+16)/116,S=isNaN(s)?v:v+s/500,T=isNaN(h)?v:v-h/200;return v=1*Mi(v),S=We*Mi(S),T=Xe*Mi(T),[ri(3.1338561*S-1.6168667*v-.4906146*T),ri(-.9787684*S+1.9161415*v+.033454*T),ri(.0719453*S-.2289914*v+1.4052427*T),m]}function ri(c){return(c=c<=.00304?12.92*c:1.055*Math.pow(c,1/2.4)-.055)<0?0:c>1?1:c}function Mi(c){return c>lt?c*c*c:Lt*(c-tt)}function Ri(c){return parseInt(c.padEnd(2,c),16)/255}function mi(c,s){return jo(s?c/100:c,0,1)}function jo(c,s,h){return Math.min(Math.max(s,c),h)}function Fh(c){return!c.some(Number.isNaN)}const Fd={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class tr{constructor(s,h,m,v=1,S=!0){this.r=s,this.g=h,this.b=m,this.a=v,S||(this.r*=v,this.g*=v,this.b*=v,v||this.overwriteGetter("rgb",[s,h,m,v]))}static parse(s){if(s instanceof tr)return s;if(typeof s!="string")return;const h=function(m){if((m=m.toLowerCase().trim())==="transparent")return[0,0,0,0];const v=Fd[m];if(v){const[T,L,R]=v;return[T/255,L/255,R/255,1]}if(m.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(m)){const T=m.length<6?1:2;let L=1;return[Ri(m.slice(L,L+=T)),Ri(m.slice(L,L+=T)),Ri(m.slice(L,L+=T)),Ri(m.slice(L,L+T)||"ff")]}if(m.startsWith("rgb")){const T=m.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(T){const[L,R,O,H,X,oe,de,ge,ve,Me,Pe,He]=T,ze=[H||" ",de||" ",Me].join("");if(ze==="  "||ze==="  /"||ze===",,"||ze===",,,"){const Ne=[O,oe,ve].join(""),ct=Ne==="%%%"?100:Ne===""?255:0;if(ct){const ft=[jo(+R/ct,0,1),jo(+X/ct,0,1),jo(+ge/ct,0,1),Pe?mi(+Pe,He):1];if(Fh(ft))return ft}}return}}const S=m.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(S){const[T,L,R,O,H,X,oe,de,ge]=S,ve=[R||" ",H||" ",oe].join("");if(ve==="  "||ve==="  /"||ve===",,"||ve===",,,"){const Me=[+L,jo(+O,0,100),jo(+X,0,100),de?mi(+de,ge):1];if(Fh(Me))return function([Pe,He,ze,Ne]){function ct(ft){const Zt=(ft+Pe/30)%12,Yt=He*Math.min(ze,1-ze);return ze-Yt*Math.max(-1,Math.min(Zt-3,9-Zt,1))}return Pe=Fn(Pe),He/=100,ze/=100,[ct(0),ct(8),ct(4),Ne]}(Me)}}}(s);return h?new tr(...h,!1):void 0}get rgb(){const{r:s,g:h,b:m,a:v}=this,S=v||1/0;return this.overwriteGetter("rgb",[s/S,h/S,m/S,v])}get hcl(){return this.overwriteGetter("hcl",function(s){const[h,m,v,S]=xr(s),T=Math.sqrt(m*m+v*v);return[Math.round(1e4*T)?Fn(Math.atan2(v,m)*Sn):NaN,T,h,S]}(this.rgb))}get lab(){return this.overwriteGetter("lab",xr(this.rgb))}overwriteGetter(s,h){return Object.defineProperty(this,s,{value:h}),h}toString(){const[s,h,m,v]=this.rgb;return`rgba(${[s,h,m].map(S=>Math.round(255*S)).join(",")},${v})`}}tr.black=new tr(0,0,0,1),tr.white=new tr(1,1,1,1),tr.transparent=new tr(0,0,0,0),tr.red=new tr(1,0,0,1);class Vu{constructor(s,h,m){this.sensitivity=s?h?"variant":"case":h?"accent":"base",this.locale=m,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(s,h){return this.collator.compare(s,h)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class qu{constructor(s,h,m,v,S){this.text=s,this.image=h,this.scale=m,this.fontStack=v,this.textColor=S}}class Yi{constructor(s){this.sections=s}static fromString(s){return new Yi([new qu(s,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(s=>s.text.length!==0||s.image&&s.image.name.length!==0)}static factory(s){return s instanceof Yi?s:Yi.fromString(s)}toString(){return this.sections.length===0?"":this.sections.map(s=>s.text).join("")}}class Fi{constructor(s){this.values=s.slice()}static parse(s){if(s instanceof Fi)return s;if(typeof s=="number")return new Fi([s,s,s,s]);if(Array.isArray(s)&&!(s.length<1||s.length>4)){for(const h of s)if(typeof h!="number")return;switch(s.length){case 1:s=[s[0],s[0],s[0],s[0]];break;case 2:s=[s[0],s[1],s[0],s[1]];break;case 3:s=[s[0],s[1],s[2],s[1]]}return new Fi(s)}}toString(){return JSON.stringify(this.values)}}const Na=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class ho{constructor(s){this.values=s.slice()}static parse(s){if(s instanceof ho)return s;if(Array.isArray(s)&&!(s.length<1)&&s.length%2==0){for(let h=0;h<s.length;h+=2){const m=s[h],v=s[h+1];if(typeof m!="string"||!Na.has(m)||!Array.isArray(v)||v.length!==2||typeof v[0]!="number"||typeof v[1]!="number")return}return new ho(s)}}toString(){return JSON.stringify(this.values)}}class fo{constructor(s){this.name=s.name,this.available=s.available}toString(){return this.name}static fromString(s){return s?new fo({name:s,available:!1}):null}}function ra(c,s,h,m){return typeof c=="number"&&c>=0&&c<=255&&typeof s=="number"&&s>=0&&s<=255&&typeof h=="number"&&h>=0&&h<=255?m===void 0||typeof m=="number"&&m>=0&&m<=1?null:`Invalid rgba value [${[c,s,h,m].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof m=="number"?[c,s,h,m]:[c,s,h]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Sl(c){if(c===null||typeof c=="string"||typeof c=="boolean"||typeof c=="number"||c instanceof tr||c instanceof Vu||c instanceof Yi||c instanceof Fi||c instanceof ho||c instanceof fo)return!0;if(Array.isArray(c)){for(const s of c)if(!Sl(s))return!1;return!0}if(typeof c=="object"){for(const s in c)if(!Sl(c[s]))return!1;return!0}return!1}function Wr(c){if(c===null)return qn;if(typeof c=="string")return fn;if(typeof c=="boolean")return on;if(typeof c=="number")return It;if(c instanceof tr)return Qn;if(c instanceof Vu)return Di;if(c instanceof Yi)return er;if(c instanceof Fi)return we;if(c instanceof ho)return se;if(c instanceof fo)return re;if(Array.isArray(c)){const s=c.length;let h;for(const m of c){const v=Wr(m);if(h){if(h===v)continue;h=pn;break}h=v}return pe(h||pn,s)}return pi}function ja(c){const s=typeof c;return c===null?"":s==="string"||s==="number"||s==="boolean"?String(c):c instanceof tr||c instanceof Yi||c instanceof Fi||c instanceof ho||c instanceof fo?c.toString():JSON.stringify(c)}class _s{constructor(s,h){this.type=s,this.value=h}static parse(s,h){if(s.length!==2)return h.error(`'literal' expression requires exactly one argument, but found ${s.length-1} instead.`);if(!Sl(s[1]))return h.error("invalid value");const m=s[1];let v=Wr(m);const S=h.expectedType;return v.kind!=="array"||v.N!==0||!S||S.kind!=="array"||typeof S.N=="number"&&S.N!==0||(v=S),new _s(v,m)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class Lr{constructor(s){this.name="ExpressionEvaluationError",this.message=s}toJSON(){return this.message}}const Tl={string:fn,number:It,boolean:on,object:pi};class Qi{constructor(s,h){this.type=s,this.args=h}static parse(s,h){if(s.length<2)return h.error("Expected at least one argument.");let m,v=1;const S=s[0];if(S==="array"){let L,R;if(s.length>2){const O=s[1];if(typeof O!="string"||!(O in Tl)||O==="object")return h.error('The item type argument of "array" must be one of string, number, boolean',1);L=Tl[O],v++}else L=pn;if(s.length>3){if(s[2]!==null&&(typeof s[2]!="number"||s[2]<0||s[2]!==Math.floor(s[2])))return h.error('The length argument to "array" must be a positive integer literal',2);R=s[2],v++}m=pe(L,R)}else{if(!Tl[S])throw new Error(`Types doesn't contain name = ${S}`);m=Tl[S]}const T=[];for(;v<s.length;v++){const L=h.parse(s[v],v,pn);if(!L)return null;T.push(L)}return new Qi(m,T)}evaluate(s){for(let h=0;h<this.args.length;h++){const m=this.args[h].evaluate(s);if(!Be(this.type,Wr(m)))return m;if(h===this.args.length-1)throw new Lr(`Expected value to be of type ${xe(this.type)}, but found ${xe(Wr(m))} instead.`)}throw new Error}eachChild(s){this.args.forEach(s)}outputDefined(){return this.args.every(s=>s.outputDefined())}}const Cl={"to-boolean":on,"to-color":Qn,"to-number":It,"to-string":fn};class Uo{constructor(s,h){this.type=s,this.args=h}static parse(s,h){if(s.length<2)return h.error("Expected at least one argument.");const m=s[0];if(!Cl[m])throw new Error(`Can't parse ${m} as it is not part of the known types`);if((m==="to-boolean"||m==="to-string")&&s.length!==2)return h.error("Expected one argument.");const v=Cl[m],S=[];for(let T=1;T<s.length;T++){const L=h.parse(s[T],T,pn);if(!L)return null;S.push(L)}return new Uo(v,S)}evaluate(s){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(s);case"color":{let h,m;for(const v of this.args){if(h=v.evaluate(s),m=null,h instanceof tr)return h;if(typeof h=="string"){const S=s.parseColor(h);if(S)return S}else if(Array.isArray(h)&&(m=h.length<3||h.length>4?`Invalid rbga value ${JSON.stringify(h)}: expected an array containing either three or four numeric values.`:ra(h[0],h[1],h[2],h[3]),!m))return new tr(h[0]/255,h[1]/255,h[2]/255,h[3])}throw new Lr(m||`Could not parse color from value '${typeof h=="string"?h:JSON.stringify(h)}'`)}case"padding":{let h;for(const m of this.args){h=m.evaluate(s);const v=Fi.parse(h);if(v)return v}throw new Lr(`Could not parse padding from value '${typeof h=="string"?h:JSON.stringify(h)}'`)}case"variableAnchorOffsetCollection":{let h;for(const m of this.args){h=m.evaluate(s);const v=ho.parse(h);if(v)return v}throw new Lr(`Could not parse variableAnchorOffsetCollection from value '${typeof h=="string"?h:JSON.stringify(h)}'`)}case"number":{let h=null;for(const m of this.args){if(h=m.evaluate(s),h===null)return 0;const v=Number(h);if(!isNaN(v))return v}throw new Lr(`Could not convert ${JSON.stringify(h)} to number.`)}case"formatted":return Yi.fromString(ja(this.args[0].evaluate(s)));case"resolvedImage":return fo.fromString(ja(this.args[0].evaluate(s)));default:return ja(this.args[0].evaluate(s))}}eachChild(s){this.args.forEach(s)}outputDefined(){return this.args.every(s=>s.outputDefined())}}const Ua=["Unknown","Point","LineString","Polygon"];class nr{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Ua[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(s){let h=this._parseColorCache[s];return h||(h=this._parseColorCache[s]=tr.parse(s)),h}}class Ml{constructor(s,h,m=[],v,S=new zr,T=[]){this.registry=s,this.path=m,this.key=m.map(L=>`[${L}]`).join(""),this.scope=S,this.errors=T,this.expectedType=v,this._isConstant=h}parse(s,h,m,v,S={}){return h?this.concat(h,m,v)._parse(s,S):this._parse(s,S)}_parse(s,h){function m(v,S,T){return T==="assert"?new Qi(S,[v]):T==="coerce"?new Uo(S,[v]):v}if(s!==null&&typeof s!="string"&&typeof s!="boolean"&&typeof s!="number"||(s=["literal",s]),Array.isArray(s)){if(s.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const v=s[0];if(typeof v!="string")return this.error(`Expression name must be a string, but found ${typeof v} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const S=this.registry[v];if(S){let T=S.parse(s,this);if(!T)return null;if(this.expectedType){const L=this.expectedType,R=T.type;if(L.kind!=="string"&&L.kind!=="number"&&L.kind!=="boolean"&&L.kind!=="object"&&L.kind!=="array"||R.kind!=="value")if(L.kind!=="color"&&L.kind!=="formatted"&&L.kind!=="resolvedImage"||R.kind!=="value"&&R.kind!=="string")if(L.kind!=="padding"||R.kind!=="value"&&R.kind!=="number"&&R.kind!=="array")if(L.kind!=="variableAnchorOffsetCollection"||R.kind!=="value"&&R.kind!=="array"){if(this.checkSubtype(L,R))return null}else T=m(T,L,h.typeAnnotation||"coerce");else T=m(T,L,h.typeAnnotation||"coerce");else T=m(T,L,h.typeAnnotation||"coerce");else T=m(T,L,h.typeAnnotation||"assert")}if(!(T instanceof _s)&&T.type.kind!=="resolvedImage"&&this._isConstant(T)){const L=new nr;try{T=new _s(T.type,T.evaluate(L))}catch(R){return this.error(R.message),null}}return T}return this.error(`Unknown expression "${v}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(s===void 0?"'undefined' value invalid. Use null instead.":typeof s=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof s} instead.`)}concat(s,h,m){const v=typeof s=="number"?this.path.concat(s):this.path,S=m?this.scope.concat(m):this.scope;return new Ml(this.registry,this._isConstant,v,h||null,S,this.errors)}error(s,...h){const m=`${this.key}${h.map(v=>`[${v}]`).join("")}`;this.errors.push(new Mr(m,s))}checkSubtype(s,h){const m=Be(s,h);return m&&this.error(m),m}}class ia{constructor(s,h,m){this.type=Di,this.locale=m,this.caseSensitive=s,this.diacriticSensitive=h}static parse(s,h){if(s.length!==2)return h.error("Expected one argument.");const m=s[1];if(typeof m!="object"||Array.isArray(m))return h.error("Collator options argument must be an object.");const v=h.parse(m["case-sensitive"]!==void 0&&m["case-sensitive"],1,on);if(!v)return null;const S=h.parse(m["diacritic-sensitive"]!==void 0&&m["diacritic-sensitive"],1,on);if(!S)return null;let T=null;return m.locale&&(T=h.parse(m.locale,1,fn),!T)?null:new ia(v,S,T)}evaluate(s){return new Vu(this.caseSensitive.evaluate(s),this.diacriticSensitive.evaluate(s),this.locale?this.locale.evaluate(s):null)}eachChild(s){s(this.caseSensitive),s(this.diacriticSensitive),this.locale&&s(this.locale)}outputDefined(){return!1}}const ys=8192;function Ll(c,s){c[0]=Math.min(c[0],s[0]),c[1]=Math.min(c[1],s[1]),c[2]=Math.max(c[2],s[0]),c[3]=Math.max(c[3],s[1])}function Va(c,s){return!(c[0]<=s[0]||c[2]>=s[2]||c[1]<=s[1]||c[3]>=s[3])}function Bd(c,s){const h=(180+c[0])/360,m=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+c[1]*Math.PI/360)))/360,v=Math.pow(2,s.z);return[Math.round(h*v*ys),Math.round(m*v*ys)]}function Bh(c,s,h){const m=c[0]-s[0],v=c[1]-s[1],S=c[0]-h[0],T=c[1]-h[1];return m*T-S*v==0&&m*S<=0&&v*T<=0}function El(c,s){let h=!1;for(let T=0,L=s.length;T<L;T++){const R=s[T];for(let O=0,H=R.length;O<H-1;O++){if(Bh(c,R[O],R[O+1]))return!1;(v=R[O])[1]>(m=c)[1]!=(S=R[O+1])[1]>m[1]&&m[0]<(S[0]-v[0])*(m[1]-v[1])/(S[1]-v[1])+v[0]&&(h=!h)}}var m,v,S;return h}function $d(c,s){for(let h=0;h<s.length;h++)if(El(c,s[h]))return!0;return!1}function $h(c,s,h,m){const v=m[0]-h[0],S=m[1]-h[1],T=(c[0]-h[0])*S-v*(c[1]-h[1]),L=(s[0]-h[0])*S-v*(s[1]-h[1]);return T>0&&L<0||T<0&&L>0}function Od(c,s,h){for(const O of h)for(let H=0;H<O.length-1;++H)if((L=[(T=O[H+1])[0]-(S=O[H])[0],T[1]-S[1]])[0]*(R=[(v=s)[0]-(m=c)[0],v[1]-m[1]])[1]-L[1]*R[0]!=0&&$h(m,v,S,T)&&$h(S,T,m,v))return!0;var m,v,S,T,L,R;return!1}function Oh(c,s){for(let h=0;h<c.length;++h)if(!El(c[h],s))return!1;for(let h=0;h<c.length-1;++h)if(Od(c[h],c[h+1],s))return!1;return!0}function Nh(c,s){for(let h=0;h<s.length;h++)if(Oh(c,s[h]))return!0;return!1}function Il(c,s,h){const m=[];for(let v=0;v<c.length;v++){const S=[];for(let T=0;T<c[v].length;T++){const L=Bd(c[v][T],h);Ll(s,L),S.push(L)}m.push(S)}return m}function jh(c,s,h){const m=[];for(let v=0;v<c.length;v++){const S=Il(c[v],s,h);m.push(S)}return m}function Uh(c,s,h,m){if(c[0]<h[0]||c[0]>h[2]){const v=.5*m;let S=c[0]-h[0]>v?-m:h[0]-c[0]>v?m:0;S===0&&(S=c[0]-h[2]>v?-m:h[2]-c[0]>v?m:0),c[0]+=S}Ll(s,c)}function Al(c,s,h,m){const v=Math.pow(2,m.z)*ys,S=[m.x*ys,m.y*ys],T=[];for(const L of c)for(const R of L){const O=[R.x+S[0],R.y+S[1]];Uh(O,s,h,v),T.push(O)}return T}function Vh(c,s,h,m){const v=Math.pow(2,m.z)*ys,S=[m.x*ys,m.y*ys],T=[];for(const R of c){const O=[];for(const H of R){const X=[H.x+S[0],H.y+S[1]];Ll(s,X),O.push(X)}T.push(O)}if(s[2]-s[0]<=v/2){(L=s)[0]=L[1]=1/0,L[2]=L[3]=-1/0;for(const R of T)for(const O of R)Uh(O,s,h,v)}var L;return T}class Ps{constructor(s,h){this.type=on,this.geojson=s,this.geometries=h}static parse(s,h){if(s.length!==2)return h.error(`'within' expression requires exactly one argument, but found ${s.length-1} instead.`);if(Sl(s[1])){const m=s[1];if(m.type==="FeatureCollection"){const v=[];for(const S of m.features){const{type:T,coordinates:L}=S.geometry;T==="Polygon"&&v.push(L),T==="MultiPolygon"&&v.push(...L)}if(v.length)return new Ps(m,{type:"MultiPolygon",coordinates:v})}else if(m.type==="Feature"){const v=m.geometry.type;if(v==="Polygon"||v==="MultiPolygon")return new Ps(m,m.geometry)}else if(m.type==="Polygon"||m.type==="MultiPolygon")return new Ps(m,m)}return h.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(s){if(s.geometry()!=null&&s.canonicalID()!=null){if(s.geometryType()==="Point")return function(h,m){const v=[1/0,1/0,-1/0,-1/0],S=[1/0,1/0,-1/0,-1/0],T=h.canonicalID();if(m.type==="Polygon"){const L=Il(m.coordinates,S,T),R=Al(h.geometry(),v,S,T);if(!Va(v,S))return!1;for(const O of R)if(!El(O,L))return!1}if(m.type==="MultiPolygon"){const L=jh(m.coordinates,S,T),R=Al(h.geometry(),v,S,T);if(!Va(v,S))return!1;for(const O of R)if(!$d(O,L))return!1}return!0}(s,this.geometries);if(s.geometryType()==="LineString")return function(h,m){const v=[1/0,1/0,-1/0,-1/0],S=[1/0,1/0,-1/0,-1/0],T=h.canonicalID();if(m.type==="Polygon"){const L=Il(m.coordinates,S,T),R=Vh(h.geometry(),v,S,T);if(!Va(v,S))return!1;for(const O of R)if(!Oh(O,L))return!1}if(m.type==="MultiPolygon"){const L=jh(m.coordinates,S,T),R=Vh(h.geometry(),v,S,T);if(!Va(v,S))return!1;for(const O of R)if(!Nh(O,L))return!1}return!0}(s,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class Pl{constructor(s,h){this.type=h.type,this.name=s,this.boundExpression=h}static parse(s,h){if(s.length!==2||typeof s[1]!="string")return h.error("'var' expression requires exactly one string literal argument.");const m=s[1];return h.scope.has(m)?new Pl(m,h.scope.get(m)):h.error(`Unknown variable "${m}". Make sure "${m}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(s){return this.boundExpression.evaluate(s)}eachChild(){}outputDefined(){return!1}}class eo{constructor(s,h,m,v){this.name=s,this.type=h,this._evaluate=m,this.args=v}evaluate(s){return this._evaluate(s,this.args)}eachChild(s){this.args.forEach(s)}outputDefined(){return!1}static parse(s,h){const m=s[0],v=eo.definitions[m];if(!v)return h.error(`Unknown expression "${m}". If you wanted a literal array, use ["literal", [...]].`,0);const S=Array.isArray(v)?v[0]:v.type,T=Array.isArray(v)?[[v[1],v[2]]]:v.overloads,L=T.filter(([O])=>!Array.isArray(O)||O.length===s.length-1);let R=null;for(const[O,H]of L){R=new Ml(h.registry,qa,h.path,null,h.scope);const X=[];let oe=!1;for(let de=1;de<s.length;de++){const ge=s[de],ve=Array.isArray(O)?O[de-1]:O.type,Me=R.parse(ge,1+X.length,ve);if(!Me){oe=!0;break}X.push(Me)}if(!oe)if(Array.isArray(O)&&O.length!==X.length)R.error(`Expected ${O.length} arguments, but found ${X.length} instead.`);else{for(let de=0;de<X.length;de++){const ge=Array.isArray(O)?O[de]:O.type,ve=X[de];R.concat(de+1).checkSubtype(ge,ve.type)}if(R.errors.length===0)return new eo(m,S,H,X)}}if(L.length===1)h.errors.push(...R.errors);else{const O=(L.length?L:T).map(([X])=>{return oe=X,Array.isArray(oe)?`(${oe.map(xe).join(", ")})`:`(${xe(oe.type)}...)`;var oe}).join(" | "),H=[];for(let X=1;X<s.length;X++){const oe=h.parse(s[X],1+H.length);if(!oe)return null;H.push(xe(oe.type))}h.error(`Expected arguments of type ${O}, but found (${H.join(", ")}) instead.`)}return null}static register(s,h){eo.definitions=h;for(const m in h)s[m]=eo}}function qa(c){if(c instanceof Pl)return qa(c.boundExpression);if(c instanceof eo&&c.name==="error"||c instanceof ia||c instanceof Ps)return!1;const s=c instanceof Uo||c instanceof Qi;let h=!0;return c.eachChild(m=>{h=s?h&&qa(m):h&&m instanceof _s}),!!h&&zl(c)&&Ga(c,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function zl(c){if(c instanceof eo&&(c.name==="get"&&c.args.length===1||c.name==="feature-state"||c.name==="has"&&c.args.length===1||c.name==="properties"||c.name==="geometry-type"||c.name==="id"||/^filter-/.test(c.name))||c instanceof Ps)return!1;let s=!0;return c.eachChild(h=>{s&&!zl(h)&&(s=!1)}),s}function Za(c){if(c instanceof eo&&c.name==="feature-state")return!1;let s=!0;return c.eachChild(h=>{s&&!Za(h)&&(s=!1)}),s}function Ga(c,s){if(c instanceof eo&&s.indexOf(c.name)>=0)return!1;let h=!0;return c.eachChild(m=>{h&&!Ga(m,s)&&(h=!1)}),h}function Ha(c,s){const h=c.length-1;let m,v,S=0,T=h,L=0;for(;S<=T;)if(L=Math.floor((S+T)/2),m=c[L],v=c[L+1],m<=s){if(L===h||s<v)return L;S=L+1}else{if(!(m>s))throw new Lr("Input is not a number.");T=L-1}return 0}class Wa{constructor(s,h,m){this.type=s,this.input=h,this.labels=[],this.outputs=[];for(const[v,S]of m)this.labels.push(v),this.outputs.push(S)}static parse(s,h){if(s.length-1<4)return h.error(`Expected at least 4 arguments, but found only ${s.length-1}.`);if((s.length-1)%2!=0)return h.error("Expected an even number of arguments.");const m=h.parse(s[1],1,It);if(!m)return null;const v=[];let S=null;h.expectedType&&h.expectedType.kind!=="value"&&(S=h.expectedType);for(let T=1;T<s.length;T+=2){const L=T===1?-1/0:s[T],R=s[T+1],O=T,H=T+1;if(typeof L!="number")return h.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',O);if(v.length&&v[v.length-1][0]>=L)return h.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',O);const X=h.parse(R,H,S);if(!X)return null;S=S||X.type,v.push([L,X])}return new Wa(S,m,v)}evaluate(s){const h=this.labels,m=this.outputs;if(h.length===1)return m[0].evaluate(s);const v=this.input.evaluate(s);if(v<=h[0])return m[0].evaluate(s);const S=h.length;return v>=h[S-1]?m[S-1].evaluate(s):m[Ha(h,v)].evaluate(s)}eachChild(s){s(this.input);for(const h of this.outputs)s(h)}outputDefined(){return this.outputs.every(s=>s.outputDefined())}}function Nd(c){return c&&c.__esModule&&Object.prototype.hasOwnProperty.call(c,"default")?c.default:c}var jd=qh;function qh(c,s,h,m){this.cx=3*c,this.bx=3*(h-c)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*s,this.by=3*(m-s)-this.cy,this.ay=1-this.cy-this.by,this.p1x=c,this.p1y=s,this.p2x=h,this.p2y=m}qh.prototype={sampleCurveX:function(c){return((this.ax*c+this.bx)*c+this.cx)*c},sampleCurveY:function(c){return((this.ay*c+this.by)*c+this.cy)*c},sampleCurveDerivativeX:function(c){return(3*this.ax*c+2*this.bx)*c+this.cx},solveCurveX:function(c,s){if(s===void 0&&(s=1e-6),c<0)return 0;if(c>1)return 1;for(var h=c,m=0;m<8;m++){var v=this.sampleCurveX(h)-c;if(Math.abs(v)<s)return h;var S=this.sampleCurveDerivativeX(h);if(Math.abs(S)<1e-6)break;h-=v/S}var T=0,L=1;for(h=c,m=0;m<20&&(v=this.sampleCurveX(h),!(Math.abs(v-c)<s));m++)c>v?T=h:L=h,h=.5*(L-T)+T;return h},solve:function(c,s){return this.sampleCurveY(this.solveCurveX(c,s))}};var Ud=Nd(jd);function zs(c,s,h){return c+h*(s-c)}function Dl(c,s,h){return c.map((m,v)=>zs(m,s[v],h))}const Li={number:zs,color:function(c,s,h,m="rgb"){switch(m){case"rgb":{const[v,S,T,L]=Dl(c.rgb,s.rgb,h);return new tr(v,S,T,L,!1)}case"hcl":{const[v,S,T,L]=c.hcl,[R,O,H,X]=s.hcl;let oe,de;if(isNaN(v)||isNaN(R))isNaN(v)?isNaN(R)?oe=NaN:(oe=R,T!==1&&T!==0||(de=O)):(oe=v,H!==1&&H!==0||(de=S));else{let He=R-v;R>v&&He>180?He-=360:R<v&&v-R>180&&(He+=360),oe=v+h*He}const[ge,ve,Me,Pe]=function([He,ze,Ne,ct]){return He=isNaN(He)?0:He*cn,Dr([Ne,Math.cos(He)*ze,Math.sin(He)*ze,ct])}([oe,de??zs(S,O,h),zs(T,H,h),zs(L,X,h)]);return new tr(ge,ve,Me,Pe,!1)}case"lab":{const[v,S,T,L]=Dr(Dl(c.lab,s.lab,h));return new tr(v,S,T,L,!1)}}},array:Dl,padding:function(c,s,h){return new Fi(Dl(c.values,s.values,h))},variableAnchorOffsetCollection:function(c,s,h){const m=c.values,v=s.values;if(m.length!==v.length)throw new Lr(`Cannot interpolate values of different length. from: ${c.toString()}, to: ${s.toString()}`);const S=[];for(let T=0;T<m.length;T+=2){if(m[T]!==v[T])throw new Lr(`Cannot interpolate values containing mismatched anchors. from[${T}]: ${m[T]}, to[${T}]: ${v[T]}`);S.push(m[T]);const[L,R]=m[T+1],[O,H]=v[T+1];S.push([zs(L,O,h),zs(R,H,h)])}return new ho(S)}};class wi{constructor(s,h,m,v,S){this.type=s,this.operator=h,this.interpolation=m,this.input=v,this.labels=[],this.outputs=[];for(const[T,L]of S)this.labels.push(T),this.outputs.push(L)}static interpolationFactor(s,h,m,v){let S=0;if(s.name==="exponential")S=Zn(h,s.base,m,v);else if(s.name==="linear")S=Zn(h,1,m,v);else if(s.name==="cubic-bezier"){const T=s.controlPoints;S=new Ud(T[0],T[1],T[2],T[3]).solve(Zn(h,1,m,v))}return S}static parse(s,h){let[m,v,S,...T]=s;if(!Array.isArray(v)||v.length===0)return h.error("Expected an interpolation type expression.",1);if(v[0]==="linear")v={name:"linear"};else if(v[0]==="exponential"){const O=v[1];if(typeof O!="number")return h.error("Exponential interpolation requires a numeric base.",1,1);v={name:"exponential",base:O}}else{if(v[0]!=="cubic-bezier")return h.error(`Unknown interpolation type ${String(v[0])}`,1,0);{const O=v.slice(1);if(O.length!==4||O.some(H=>typeof H!="number"||H<0||H>1))return h.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);v={name:"cubic-bezier",controlPoints:O}}}if(s.length-1<4)return h.error(`Expected at least 4 arguments, but found only ${s.length-1}.`);if((s.length-1)%2!=0)return h.error("Expected an even number of arguments.");if(S=h.parse(S,2,It),!S)return null;const L=[];let R=null;m==="interpolate-hcl"||m==="interpolate-lab"?R=Qn:h.expectedType&&h.expectedType.kind!=="value"&&(R=h.expectedType);for(let O=0;O<T.length;O+=2){const H=T[O],X=T[O+1],oe=O+3,de=O+4;if(typeof H!="number")return h.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',oe);if(L.length&&L[L.length-1][0]>=H)return h.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',oe);const ge=h.parse(X,de,R);if(!ge)return null;R=R||ge.type,L.push([H,ge])}return Q(R,It)||Q(R,Qn)||Q(R,we)||Q(R,se)||Q(R,pe(It))?new wi(R,m,v,S,L):h.error(`Type ${xe(R)} is not interpolatable.`)}evaluate(s){const h=this.labels,m=this.outputs;if(h.length===1)return m[0].evaluate(s);const v=this.input.evaluate(s);if(v<=h[0])return m[0].evaluate(s);const S=h.length;if(v>=h[S-1])return m[S-1].evaluate(s);const T=Ha(h,v),L=wi.interpolationFactor(this.interpolation,v,h[T],h[T+1]),R=m[T].evaluate(s),O=m[T+1].evaluate(s);switch(this.operator){case"interpolate":return Li[this.type.kind](R,O,L);case"interpolate-hcl":return Li.color(R,O,L,"hcl");case"interpolate-lab":return Li.color(R,O,L,"lab")}}eachChild(s){s(this.input);for(const h of this.outputs)s(h)}outputDefined(){return this.outputs.every(s=>s.outputDefined())}}function Zn(c,s,h,m){const v=m-h,S=c-h;return v===0?0:s===1?S/v:(Math.pow(s,S)-1)/(Math.pow(s,v)-1)}class Rl{constructor(s,h){this.type=s,this.args=h}static parse(s,h){if(s.length<2)return h.error("Expectected at least one argument.");let m=null;const v=h.expectedType;v&&v.kind!=="value"&&(m=v);const S=[];for(const L of s.slice(1)){const R=h.parse(L,1+S.length,m,void 0,{typeAnnotation:"omit"});if(!R)return null;m=m||R.type,S.push(R)}if(!m)throw new Error("No output type");const T=v&&S.some(L=>Be(v,L.type));return new Rl(T?pn:m,S)}evaluate(s){let h,m=null,v=0;for(const S of this.args)if(v++,m=S.evaluate(s),m&&m instanceof fo&&!m.available&&(h||(h=m.name),m=null,v===this.args.length&&(m=h)),m!==null)break;return m}eachChild(s){this.args.forEach(s)}outputDefined(){return this.args.every(s=>s.outputDefined())}}class Fl{constructor(s,h){this.type=h.type,this.bindings=[].concat(s),this.result=h}evaluate(s){return this.result.evaluate(s)}eachChild(s){for(const h of this.bindings)s(h[1]);s(this.result)}static parse(s,h){if(s.length<4)return h.error(`Expected at least 3 arguments, but found ${s.length-1} instead.`);const m=[];for(let S=1;S<s.length-1;S+=2){const T=s[S];if(typeof T!="string")return h.error(`Expected string, but found ${typeof T} instead.`,S);if(/[^a-zA-Z0-9_]/.test(T))return h.error("Variable names must contain only alphanumeric characters or '_'.",S);const L=h.parse(s[S+1],S+1);if(!L)return null;m.push([T,L])}const v=h.parse(s[s.length-1],s.length-1,h.expectedType,m);return v?new Fl(m,v):null}outputDefined(){return this.result.outputDefined()}}class Zu{constructor(s,h,m){this.type=s,this.index=h,this.input=m}static parse(s,h){if(s.length!==3)return h.error(`Expected 2 arguments, but found ${s.length-1} instead.`);const m=h.parse(s[1],1,It),v=h.parse(s[2],2,pe(h.expectedType||pn));return m&&v?new Zu(v.type.itemType,m,v):null}evaluate(s){const h=this.index.evaluate(s),m=this.input.evaluate(s);if(h<0)throw new Lr(`Array index out of bounds: ${h} < 0.`);if(h>=m.length)throw new Lr(`Array index out of bounds: ${h} > ${m.length-1}.`);if(h!==Math.floor(h))throw new Lr(`Array index must be an integer, but found ${h} instead.`);return m[h]}eachChild(s){s(this.index),s(this.input)}outputDefined(){return!1}}class Gu{constructor(s,h){this.type=on,this.needle=s,this.haystack=h}static parse(s,h){if(s.length!==3)return h.error(`Expected 2 arguments, but found ${s.length-1} instead.`);const m=h.parse(s[1],1,pn),v=h.parse(s[2],2,pn);return m&&v?$e(m.type,[on,fn,It,qn,pn])?new Gu(m,v):h.error(`Expected first argument to be of type boolean, string, number or null, but found ${xe(m.type)} instead`):null}evaluate(s){const h=this.needle.evaluate(s),m=this.haystack.evaluate(s);if(!m)return!1;if(!Se(h,["boolean","string","number","null"]))throw new Lr(`Expected first argument to be of type boolean, string, number or null, but found ${xe(Wr(h))} instead.`);if(!Se(m,["string","array"]))throw new Lr(`Expected second argument to be of type array or string, but found ${xe(Wr(m))} instead.`);return m.indexOf(h)>=0}eachChild(s){s(this.needle),s(this.haystack)}outputDefined(){return!0}}class Bl{constructor(s,h,m){this.type=It,this.needle=s,this.haystack=h,this.fromIndex=m}static parse(s,h){if(s.length<=2||s.length>=5)return h.error(`Expected 3 or 4 arguments, but found ${s.length-1} instead.`);const m=h.parse(s[1],1,pn),v=h.parse(s[2],2,pn);if(!m||!v)return null;if(!$e(m.type,[on,fn,It,qn,pn]))return h.error(`Expected first argument to be of type boolean, string, number or null, but found ${xe(m.type)} instead`);if(s.length===4){const S=h.parse(s[3],3,It);return S?new Bl(m,v,S):null}return new Bl(m,v)}evaluate(s){const h=this.needle.evaluate(s),m=this.haystack.evaluate(s);if(!Se(h,["boolean","string","number","null"]))throw new Lr(`Expected first argument to be of type boolean, string, number or null, but found ${xe(Wr(h))} instead.`);if(!Se(m,["string","array"]))throw new Lr(`Expected second argument to be of type array or string, but found ${xe(Wr(m))} instead.`);if(this.fromIndex){const v=this.fromIndex.evaluate(s);return m.indexOf(h,v)}return m.indexOf(h)}eachChild(s){s(this.needle),s(this.haystack),this.fromIndex&&s(this.fromIndex)}outputDefined(){return!1}}class Hu{constructor(s,h,m,v,S,T){this.inputType=s,this.type=h,this.input=m,this.cases=v,this.outputs=S,this.otherwise=T}static parse(s,h){if(s.length<5)return h.error(`Expected at least 4 arguments, but found only ${s.length-1}.`);if(s.length%2!=1)return h.error("Expected an even number of arguments.");let m,v;h.expectedType&&h.expectedType.kind!=="value"&&(v=h.expectedType);const S={},T=[];for(let O=2;O<s.length-1;O+=2){let H=s[O];const X=s[O+1];Array.isArray(H)||(H=[H]);const oe=h.concat(O);if(H.length===0)return oe.error("Expected at least one branch label.");for(const ge of H){if(typeof ge!="number"&&typeof ge!="string")return oe.error("Branch labels must be numbers or strings.");if(typeof ge=="number"&&Math.abs(ge)>Number.MAX_SAFE_INTEGER)return oe.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof ge=="number"&&Math.floor(ge)!==ge)return oe.error("Numeric branch labels must be integer values.");if(m){if(oe.checkSubtype(m,Wr(ge)))return null}else m=Wr(ge);if(S[String(ge)]!==void 0)return oe.error("Branch labels must be unique.");S[String(ge)]=T.length}const de=h.parse(X,O,v);if(!de)return null;v=v||de.type,T.push(de)}const L=h.parse(s[1],1,pn);if(!L)return null;const R=h.parse(s[s.length-1],s.length-1,v);return R?L.type.kind!=="value"&&h.concat(1).checkSubtype(m,L.type)?null:new Hu(m,v,L,S,T,R):null}evaluate(s){const h=this.input.evaluate(s);return(Wr(h)===this.inputType&&this.outputs[this.cases[h]]||this.otherwise).evaluate(s)}eachChild(s){s(this.input),this.outputs.forEach(s),s(this.otherwise)}outputDefined(){return this.outputs.every(s=>s.outputDefined())&&this.otherwise.outputDefined()}}class Wu{constructor(s,h,m){this.type=s,this.branches=h,this.otherwise=m}static parse(s,h){if(s.length<4)return h.error(`Expected at least 3 arguments, but found only ${s.length-1}.`);if(s.length%2!=0)return h.error("Expected an odd number of arguments.");let m;h.expectedType&&h.expectedType.kind!=="value"&&(m=h.expectedType);const v=[];for(let T=1;T<s.length-1;T+=2){const L=h.parse(s[T],T,on);if(!L)return null;const R=h.parse(s[T+1],T+1,m);if(!R)return null;v.push([L,R]),m=m||R.type}const S=h.parse(s[s.length-1],s.length-1,m);if(!S)return null;if(!m)throw new Error("Can't infer output type");return new Wu(m,v,S)}evaluate(s){for(const[h,m]of this.branches)if(h.evaluate(s))return m.evaluate(s);return this.otherwise.evaluate(s)}eachChild(s){for(const[h,m]of this.branches)s(h),s(m);s(this.otherwise)}outputDefined(){return this.branches.every(([s,h])=>h.outputDefined())&&this.otherwise.outputDefined()}}class $l{constructor(s,h,m,v){this.type=s,this.input=h,this.beginIndex=m,this.endIndex=v}static parse(s,h){if(s.length<=2||s.length>=5)return h.error(`Expected 3 or 4 arguments, but found ${s.length-1} instead.`);const m=h.parse(s[1],1,pn),v=h.parse(s[2],2,It);if(!m||!v)return null;if(!$e(m.type,[pe(pn),fn,pn]))return h.error(`Expected first argument to be of type array or string, but found ${xe(m.type)} instead`);if(s.length===4){const S=h.parse(s[3],3,It);return S?new $l(m.type,m,v,S):null}return new $l(m.type,m,v)}evaluate(s){const h=this.input.evaluate(s),m=this.beginIndex.evaluate(s);if(!Se(h,["string","array"]))throw new Lr(`Expected first argument to be of type array or string, but found ${xe(Wr(h))} instead.`);if(this.endIndex){const v=this.endIndex.evaluate(s);return h.slice(m,v)}return h.slice(m)}eachChild(s){s(this.input),s(this.beginIndex),this.endIndex&&s(this.endIndex)}outputDefined(){return!1}}function Zh(c,s){return c==="=="||c==="!="?s.kind==="boolean"||s.kind==="string"||s.kind==="number"||s.kind==="null"||s.kind==="value":s.kind==="string"||s.kind==="number"||s.kind==="value"}function Gh(c,s,h,m){return m.compare(s,h)===0}function oa(c,s,h){const m=c!=="=="&&c!=="!=";return class Fb{constructor(S,T,L){this.type=on,this.lhs=S,this.rhs=T,this.collator=L,this.hasUntypedArgument=S.type.kind==="value"||T.type.kind==="value"}static parse(S,T){if(S.length!==3&&S.length!==4)return T.error("Expected two or three arguments.");const L=S[0];let R=T.parse(S[1],1,pn);if(!R)return null;if(!Zh(L,R.type))return T.concat(1).error(`"${L}" comparisons are not supported for type '${xe(R.type)}'.`);let O=T.parse(S[2],2,pn);if(!O)return null;if(!Zh(L,O.type))return T.concat(2).error(`"${L}" comparisons are not supported for type '${xe(O.type)}'.`);if(R.type.kind!==O.type.kind&&R.type.kind!=="value"&&O.type.kind!=="value")return T.error(`Cannot compare types '${xe(R.type)}' and '${xe(O.type)}'.`);m&&(R.type.kind==="value"&&O.type.kind!=="value"?R=new Qi(O.type,[R]):R.type.kind!=="value"&&O.type.kind==="value"&&(O=new Qi(R.type,[O])));let H=null;if(S.length===4){if(R.type.kind!=="string"&&O.type.kind!=="string"&&R.type.kind!=="value"&&O.type.kind!=="value")return T.error("Cannot use collator to compare non-string types.");if(H=T.parse(S[3],3,Di),!H)return null}return new Fb(R,O,H)}evaluate(S){const T=this.lhs.evaluate(S),L=this.rhs.evaluate(S);if(m&&this.hasUntypedArgument){const R=Wr(T),O=Wr(L);if(R.kind!==O.kind||R.kind!=="string"&&R.kind!=="number")throw new Lr(`Expected arguments for "${c}" to be (string, string) or (number, number), but found (${R.kind}, ${O.kind}) instead.`)}if(this.collator&&!m&&this.hasUntypedArgument){const R=Wr(T),O=Wr(L);if(R.kind!=="string"||O.kind!=="string")return s(S,T,L)}return this.collator?h(S,T,L,this.collator.evaluate(S)):s(S,T,L)}eachChild(S){S(this.lhs),S(this.rhs),this.collator&&S(this.collator)}outputDefined(){return!0}}}const Vd=oa("==",function(c,s,h){return s===h},Gh),qd=oa("!=",function(c,s,h){return s!==h},function(c,s,h,m){return!Gh(0,s,h,m)}),Zd=oa("<",function(c,s,h){return s<h},function(c,s,h,m){return m.compare(s,h)<0}),Gd=oa(">",function(c,s,h){return s>h},function(c,s,h,m){return m.compare(s,h)>0}),Hd=oa("<=",function(c,s,h){return s<=h},function(c,s,h,m){return m.compare(s,h)<=0}),Wd=oa(">=",function(c,s,h){return s>=h},function(c,s,h,m){return m.compare(s,h)>=0});class Ku{constructor(s,h,m,v,S){this.type=fn,this.number=s,this.locale=h,this.currency=m,this.minFractionDigits=v,this.maxFractionDigits=S}static parse(s,h){if(s.length!==3)return h.error("Expected two arguments.");const m=h.parse(s[1],1,It);if(!m)return null;const v=s[2];if(typeof v!="object"||Array.isArray(v))return h.error("NumberFormat options argument must be an object.");let S=null;if(v.locale&&(S=h.parse(v.locale,1,fn),!S))return null;let T=null;if(v.currency&&(T=h.parse(v.currency,1,fn),!T))return null;let L=null;if(v["min-fraction-digits"]&&(L=h.parse(v["min-fraction-digits"],1,It),!L))return null;let R=null;return v["max-fraction-digits"]&&(R=h.parse(v["max-fraction-digits"],1,It),!R)?null:new Ku(m,S,T,L,R)}evaluate(s){return new Intl.NumberFormat(this.locale?this.locale.evaluate(s):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(s):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(s):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(s):void 0}).format(this.number.evaluate(s))}eachChild(s){s(this.number),this.locale&&s(this.locale),this.currency&&s(this.currency),this.minFractionDigits&&s(this.minFractionDigits),this.maxFractionDigits&&s(this.maxFractionDigits)}outputDefined(){return!1}}class Ol{constructor(s){this.type=er,this.sections=s}static parse(s,h){if(s.length<2)return h.error("Expected at least one argument.");const m=s[1];if(!Array.isArray(m)&&typeof m=="object")return h.error("First argument must be an image or text section.");const v=[];let S=!1;for(let T=1;T<=s.length-1;++T){const L=s[T];if(S&&typeof L=="object"&&!Array.isArray(L)){S=!1;let R=null;if(L["font-scale"]&&(R=h.parse(L["font-scale"],1,It),!R))return null;let O=null;if(L["text-font"]&&(O=h.parse(L["text-font"],1,pe(fn)),!O))return null;let H=null;if(L["text-color"]&&(H=h.parse(L["text-color"],1,Qn),!H))return null;const X=v[v.length-1];X.scale=R,X.font=O,X.textColor=H}else{const R=h.parse(s[T],1,pn);if(!R)return null;const O=R.type.kind;if(O!=="string"&&O!=="value"&&O!=="null"&&O!=="resolvedImage")return h.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");S=!0,v.push({content:R,scale:null,font:null,textColor:null})}}return new Ol(v)}evaluate(s){return new Yi(this.sections.map(h=>{const m=h.content.evaluate(s);return Wr(m)===re?new qu("",m,null,null,null):new qu(ja(m),null,h.scale?h.scale.evaluate(s):null,h.font?h.font.evaluate(s).join(","):null,h.textColor?h.textColor.evaluate(s):null)}))}eachChild(s){for(const h of this.sections)s(h.content),h.scale&&s(h.scale),h.font&&s(h.font),h.textColor&&s(h.textColor)}outputDefined(){return!1}}class Xu{constructor(s){this.type=re,this.input=s}static parse(s,h){if(s.length!==2)return h.error("Expected two arguments.");const m=h.parse(s[1],1,fn);return m?new Xu(m):h.error("No image name provided.")}evaluate(s){const h=this.input.evaluate(s),m=fo.fromString(h);return m&&s.availableImages&&(m.available=s.availableImages.indexOf(h)>-1),m}eachChild(s){s(this.input)}outputDefined(){return!1}}class Ju{constructor(s){this.type=It,this.input=s}static parse(s,h){if(s.length!==2)return h.error(`Expected 1 argument, but found ${s.length-1} instead.`);const m=h.parse(s[1],1);return m?m.type.kind!=="array"&&m.type.kind!=="string"&&m.type.kind!=="value"?h.error(`Expected argument of type string or array, but found ${xe(m.type)} instead.`):new Ju(m):null}evaluate(s){const h=this.input.evaluate(s);if(typeof h=="string"||Array.isArray(h))return h.length;throw new Lr(`Expected value to be of type string or array, but found ${xe(Wr(h))} instead.`)}eachChild(s){s(this.input)}outputDefined(){return!1}}const sa={"==":Vd,"!=":qd,">":Gd,"<":Zd,">=":Wd,"<=":Hd,array:Qi,at:Zu,boolean:Qi,case:Wu,coalesce:Rl,collator:ia,format:Ol,image:Xu,in:Gu,"index-of":Bl,interpolate:wi,"interpolate-hcl":wi,"interpolate-lab":wi,length:Ju,let:Fl,literal:_s,match:Hu,number:Qi,"number-format":Ku,object:Qi,slice:$l,step:Wa,string:Qi,"to-boolean":Uo,"to-color":Uo,"to-number":Uo,"to-string":Uo,var:Pl,within:Ps};function Hh(c,[s,h,m,v]){s=s.evaluate(c),h=h.evaluate(c),m=m.evaluate(c);const S=v?v.evaluate(c):1,T=ra(s,h,m,S);if(T)throw new Lr(T);return new tr(s/255,h/255,m/255,S,!1)}function Wh(c,s){return c in s}function Yu(c,s){const h=s[c];return h===void 0?null:h}function Ds(c){return{type:c}}function Kh(c){return{result:"success",value:c}}function aa(c){return{result:"error",value:c}}function la(c){return c["property-type"]==="data-driven"||c["property-type"]==="cross-faded-data-driven"}function Xh(c){return!!c.expression&&c.expression.parameters.indexOf("zoom")>-1}function Qu(c){return!!c.expression&&c.expression.interpolated}function Un(c){return c instanceof Number?"number":c instanceof String?"string":c instanceof Boolean?"boolean":Array.isArray(c)?"array":c===null?"null":typeof c}function Nl(c){return typeof c=="object"&&c!==null&&!Array.isArray(c)}function Kd(c){return c}function Jh(c,s){const h=s.type==="color",m=c.stops&&typeof c.stops[0][0]=="object",v=m||!(m||c.property!==void 0),S=c.type||(Qu(s)?"exponential":"interval");if(h||s.type==="padding"){const H=h?tr.parse:Fi.parse;(c=Pr({},c)).stops&&(c.stops=c.stops.map(X=>[X[0],H(X[1])])),c.default=H(c.default?c.default:s.default)}if(c.colorSpace&&(T=c.colorSpace)!=="rgb"&&T!=="hcl"&&T!=="lab")throw new Error(`Unknown color space: "${c.colorSpace}"`);var T;let L,R,O;if(S==="exponential")L=$n;else if(S==="interval")L=Xd;else if(S==="categorical"){L=qr,R=Object.create(null);for(const H of c.stops)R[H[0]]=H[1];O=typeof c.stops[0][0]}else{if(S!=="identity")throw new Error(`Unknown function type "${S}"`);L=ec}if(m){const H={},X=[];for(let ge=0;ge<c.stops.length;ge++){const ve=c.stops[ge],Me=ve[0].zoom;H[Me]===void 0&&(H[Me]={zoom:Me,type:c.type,property:c.property,default:c.default,stops:[]},X.push(Me)),H[Me].stops.push([ve[0].value,ve[1]])}const oe=[];for(const ge of X)oe.push([H[ge].zoom,Jh(H[ge],s)]);const de={name:"linear"};return{kind:"composite",interpolationType:de,interpolationFactor:wi.interpolationFactor.bind(void 0,de),zoomStops:oe.map(ge=>ge[0]),evaluate:({zoom:ge},ve)=>$n({stops:oe,base:c.base},s,ge).evaluate(ge,ve)}}if(v){const H=S==="exponential"?{name:"exponential",base:c.base!==void 0?c.base:1}:null;return{kind:"camera",interpolationType:H,interpolationFactor:wi.interpolationFactor.bind(void 0,H),zoomStops:c.stops.map(X=>X[0]),evaluate:({zoom:X})=>L(c,s,X,R,O)}}return{kind:"source",evaluate(H,X){const oe=X&&X.properties?X.properties[c.property]:void 0;return oe===void 0?Ka(c.default,s.default):L(c,s,oe,R,O)}}}function Ka(c,s,h){return c!==void 0?c:s!==void 0?s:h!==void 0?h:void 0}function qr(c,s,h,m,v){return Ka(typeof h===v?m[h]:void 0,c.default,s.default)}function Xd(c,s,h){if(Un(h)!=="number")return Ka(c.default,s.default);const m=c.stops.length;if(m===1||h<=c.stops[0][0])return c.stops[0][1];if(h>=c.stops[m-1][0])return c.stops[m-1][1];const v=Ha(c.stops.map(S=>S[0]),h);return c.stops[v][1]}function $n(c,s,h){const m=c.base!==void 0?c.base:1;if(Un(h)!=="number")return Ka(c.default,s.default);const v=c.stops.length;if(v===1||h<=c.stops[0][0])return c.stops[0][1];if(h>=c.stops[v-1][0])return c.stops[v-1][1];const S=Ha(c.stops.map(H=>H[0]),h),T=function(H,X,oe,de){const ge=de-oe,ve=H-oe;return ge===0?0:X===1?ve/ge:(Math.pow(X,ve)-1)/(Math.pow(X,ge)-1)}(h,m,c.stops[S][0],c.stops[S+1][0]),L=c.stops[S][1],R=c.stops[S+1][1],O=Li[s.type]||Kd;return typeof L.evaluate=="function"?{evaluate(...H){const X=L.evaluate.apply(void 0,H),oe=R.evaluate.apply(void 0,H);if(X!==void 0&&oe!==void 0)return O(X,oe,T,c.colorSpace)}}:O(L,R,T,c.colorSpace)}function ec(c,s,h){switch(s.type){case"color":h=tr.parse(h);break;case"formatted":h=Yi.fromString(h.toString());break;case"resolvedImage":h=fo.fromString(h.toString());break;case"padding":h=Fi.parse(h);break;default:Un(h)===s.type||s.type==="enum"&&s.values[h]||(h=void 0)}return Ka(h,c.default,s.default)}eo.register(sa,{error:[{kind:"error"},[fn],(c,[s])=>{throw new Lr(s.evaluate(c))}],typeof:[fn,[pn],(c,[s])=>xe(Wr(s.evaluate(c)))],"to-rgba":[pe(It,4),[Qn],(c,[s])=>{const[h,m,v,S]=s.evaluate(c).rgb;return[255*h,255*m,255*v,S]}],rgb:[Qn,[It,It,It],Hh],rgba:[Qn,[It,It,It,It],Hh],has:{type:on,overloads:[[[fn],(c,[s])=>Wh(s.evaluate(c),c.properties())],[[fn,pi],(c,[s,h])=>Wh(s.evaluate(c),h.evaluate(c))]]},get:{type:pn,overloads:[[[fn],(c,[s])=>Yu(s.evaluate(c),c.properties())],[[fn,pi],(c,[s,h])=>Yu(s.evaluate(c),h.evaluate(c))]]},"feature-state":[pn,[fn],(c,[s])=>Yu(s.evaluate(c),c.featureState||{})],properties:[pi,[],c=>c.properties()],"geometry-type":[fn,[],c=>c.geometryType()],id:[pn,[],c=>c.id()],zoom:[It,[],c=>c.globals.zoom],"heatmap-density":[It,[],c=>c.globals.heatmapDensity||0],"line-progress":[It,[],c=>c.globals.lineProgress||0],accumulated:[pn,[],c=>c.globals.accumulated===void 0?null:c.globals.accumulated],"+":[It,Ds(It),(c,s)=>{let h=0;for(const m of s)h+=m.evaluate(c);return h}],"*":[It,Ds(It),(c,s)=>{let h=1;for(const m of s)h*=m.evaluate(c);return h}],"-":{type:It,overloads:[[[It,It],(c,[s,h])=>s.evaluate(c)-h.evaluate(c)],[[It],(c,[s])=>-s.evaluate(c)]]},"/":[It,[It,It],(c,[s,h])=>s.evaluate(c)/h.evaluate(c)],"%":[It,[It,It],(c,[s,h])=>s.evaluate(c)%h.evaluate(c)],ln2:[It,[],()=>Math.LN2],pi:[It,[],()=>Math.PI],e:[It,[],()=>Math.E],"^":[It,[It,It],(c,[s,h])=>Math.pow(s.evaluate(c),h.evaluate(c))],sqrt:[It,[It],(c,[s])=>Math.sqrt(s.evaluate(c))],log10:[It,[It],(c,[s])=>Math.log(s.evaluate(c))/Math.LN10],ln:[It,[It],(c,[s])=>Math.log(s.evaluate(c))],log2:[It,[It],(c,[s])=>Math.log(s.evaluate(c))/Math.LN2],sin:[It,[It],(c,[s])=>Math.sin(s.evaluate(c))],cos:[It,[It],(c,[s])=>Math.cos(s.evaluate(c))],tan:[It,[It],(c,[s])=>Math.tan(s.evaluate(c))],asin:[It,[It],(c,[s])=>Math.asin(s.evaluate(c))],acos:[It,[It],(c,[s])=>Math.acos(s.evaluate(c))],atan:[It,[It],(c,[s])=>Math.atan(s.evaluate(c))],min:[It,Ds(It),(c,s)=>Math.min(...s.map(h=>h.evaluate(c)))],max:[It,Ds(It),(c,s)=>Math.max(...s.map(h=>h.evaluate(c)))],abs:[It,[It],(c,[s])=>Math.abs(s.evaluate(c))],round:[It,[It],(c,[s])=>{const h=s.evaluate(c);return h<0?-Math.round(-h):Math.round(h)}],floor:[It,[It],(c,[s])=>Math.floor(s.evaluate(c))],ceil:[It,[It],(c,[s])=>Math.ceil(s.evaluate(c))],"filter-==":[on,[fn,pn],(c,[s,h])=>c.properties()[s.value]===h.value],"filter-id-==":[on,[pn],(c,[s])=>c.id()===s.value],"filter-type-==":[on,[fn],(c,[s])=>c.geometryType()===s.value],"filter-<":[on,[fn,pn],(c,[s,h])=>{const m=c.properties()[s.value],v=h.value;return typeof m==typeof v&&m<v}],"filter-id-<":[on,[pn],(c,[s])=>{const h=c.id(),m=s.value;return typeof h==typeof m&&h<m}],"filter->":[on,[fn,pn],(c,[s,h])=>{const m=c.properties()[s.value],v=h.value;return typeof m==typeof v&&m>v}],"filter-id->":[on,[pn],(c,[s])=>{const h=c.id(),m=s.value;return typeof h==typeof m&&h>m}],"filter-<=":[on,[fn,pn],(c,[s,h])=>{const m=c.properties()[s.value],v=h.value;return typeof m==typeof v&&m<=v}],"filter-id-<=":[on,[pn],(c,[s])=>{const h=c.id(),m=s.value;return typeof h==typeof m&&h<=m}],"filter->=":[on,[fn,pn],(c,[s,h])=>{const m=c.properties()[s.value],v=h.value;return typeof m==typeof v&&m>=v}],"filter-id->=":[on,[pn],(c,[s])=>{const h=c.id(),m=s.value;return typeof h==typeof m&&h>=m}],"filter-has":[on,[pn],(c,[s])=>s.value in c.properties()],"filter-has-id":[on,[],c=>c.id()!==null&&c.id()!==void 0],"filter-type-in":[on,[pe(fn)],(c,[s])=>s.value.indexOf(c.geometryType())>=0],"filter-id-in":[on,[pe(pn)],(c,[s])=>s.value.indexOf(c.id())>=0],"filter-in-small":[on,[fn,pe(pn)],(c,[s,h])=>h.value.indexOf(c.properties()[s.value])>=0],"filter-in-large":[on,[fn,pe(pn)],(c,[s,h])=>function(m,v,S,T){for(;S<=T;){const L=S+T>>1;if(v[L]===m)return!0;v[L]>m?T=L-1:S=L+1}return!1}(c.properties()[s.value],h.value,0,h.value.length-1)],all:{type:on,overloads:[[[on,on],(c,[s,h])=>s.evaluate(c)&&h.evaluate(c)],[Ds(on),(c,s)=>{for(const h of s)if(!h.evaluate(c))return!1;return!0}]]},any:{type:on,overloads:[[[on,on],(c,[s,h])=>s.evaluate(c)||h.evaluate(c)],[Ds(on),(c,s)=>{for(const h of s)if(h.evaluate(c))return!0;return!1}]]},"!":[on,[on],(c,[s])=>!s.evaluate(c)],"is-supported-script":[on,[fn],(c,[s])=>{const h=c.globals&&c.globals.isSupportedScript;return!h||h(s.evaluate(c))}],upcase:[fn,[fn],(c,[s])=>s.evaluate(c).toUpperCase()],downcase:[fn,[fn],(c,[s])=>s.evaluate(c).toLowerCase()],concat:[fn,Ds(pn),(c,s)=>s.map(h=>ja(h.evaluate(c))).join("")],"resolved-locale":[fn,[Di],(c,[s])=>s.evaluate(c).resolvedLocale()]});class br{constructor(s,h){var m;this.expression=s,this._warningHistory={},this._evaluator=new nr,this._defaultValue=h?(m=h).type==="color"&&Nl(m.default)?new tr(0,0,0,0):m.type==="color"?tr.parse(m.default)||null:m.type==="padding"?Fi.parse(m.default)||null:m.type==="variableAnchorOffsetCollection"?ho.parse(m.default)||null:m.default===void 0?null:m.default:null,this._enumValues=h&&h.type==="enum"?h.values:null}evaluateWithoutErrorHandling(s,h,m,v,S,T){return this._evaluator.globals=s,this._evaluator.feature=h,this._evaluator.featureState=m,this._evaluator.canonical=v,this._evaluator.availableImages=S||null,this._evaluator.formattedSection=T,this.expression.evaluate(this._evaluator)}evaluate(s,h,m,v,S,T){this._evaluator.globals=s,this._evaluator.feature=h||null,this._evaluator.featureState=m||null,this._evaluator.canonical=v,this._evaluator.availableImages=S||null,this._evaluator.formattedSection=T||null;try{const L=this.expression.evaluate(this._evaluator);if(L==null||typeof L=="number"&&L!=L)return this._defaultValue;if(this._enumValues&&!(L in this._enumValues))throw new Lr(`Expected value to be one of ${Object.keys(this._enumValues).map(R=>JSON.stringify(R)).join(", ")}, but found ${JSON.stringify(L)} instead.`);return L}catch(L){return this._warningHistory[L.message]||(this._warningHistory[L.message]=!0,typeof console<"u"&&console.warn(L.message)),this._defaultValue}}}function fr(c){return Array.isArray(c)&&c.length>0&&typeof c[0]=="string"&&c[0]in sa}function Rs(c,s){const h=new Ml(sa,qa,[],s?function(v){const S={color:Qn,string:fn,number:It,enum:fn,boolean:on,formatted:er,padding:we,resolvedImage:re,variableAnchorOffsetCollection:se};return v.type==="array"?pe(S[v.value]||pn,v.length):S[v.type]}(s):void 0),m=h.parse(c,void 0,void 0,void 0,s&&s.type==="string"?{typeAnnotation:"coerce"}:void 0);return m?Kh(new br(m,s)):aa(h.errors)}class jl{constructor(s,h){this.kind=s,this._styleExpression=h,this.isStateDependent=s!=="constant"&&!Za(h.expression)}evaluateWithoutErrorHandling(s,h,m,v,S,T){return this._styleExpression.evaluateWithoutErrorHandling(s,h,m,v,S,T)}evaluate(s,h,m,v,S,T){return this._styleExpression.evaluate(s,h,m,v,S,T)}}class tc{constructor(s,h,m,v){this.kind=s,this.zoomStops=m,this._styleExpression=h,this.isStateDependent=s!=="camera"&&!Za(h.expression),this.interpolationType=v}evaluateWithoutErrorHandling(s,h,m,v,S,T){return this._styleExpression.evaluateWithoutErrorHandling(s,h,m,v,S,T)}evaluate(s,h,m,v,S,T){return this._styleExpression.evaluate(s,h,m,v,S,T)}interpolationFactor(s,h,m){return this.interpolationType?wi.interpolationFactor(this.interpolationType,s,h,m):0}}function Yh(c,s){const h=Rs(c,s);if(h.result==="error")return h;const m=h.value.expression,v=zl(m);if(!v&&!la(s))return aa([new Mr("","data expressions not supported")]);const S=Ga(m,["zoom"]);if(!S&&!Xh(s))return aa([new Mr("","zoom expressions not supported")]);const T=Vl(m);return T||S?T instanceof Mr?aa([T]):T instanceof wi&&!Qu(s)?aa([new Mr("",'"interpolate" expressions cannot be used with this property')]):Kh(T?new tc(v?"camera":"composite",h.value,T.labels,T instanceof wi?T.interpolation:void 0):new jl(v?"constant":"source",h.value)):aa([new Mr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Ul{constructor(s,h){this._parameters=s,this._specification=h,Pr(this,Jh(this._parameters,this._specification))}static deserialize(s){return new Ul(s._parameters,s._specification)}static serialize(s){return{_parameters:s._parameters,_specification:s._specification}}}function Vl(c){let s=null;if(c instanceof Fl)s=Vl(c.result);else if(c instanceof Rl){for(const h of c.args)if(s=Vl(h),s)break}else(c instanceof Wa||c instanceof wi)&&c.input instanceof eo&&c.input.name==="zoom"&&(s=c);return s instanceof Mr||c.eachChild(h=>{const m=Vl(h);m instanceof Mr?s=m:!s&&m?s=new Mr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):s&&m&&s!==m&&(s=new Mr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),s}function ql(c){if(c===!0||c===!1)return!0;if(!Array.isArray(c)||c.length===0)return!1;switch(c[0]){case"has":return c.length>=2&&c[1]!=="$id"&&c[1]!=="$type";case"in":return c.length>=3&&(typeof c[1]!="string"||Array.isArray(c[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return c.length!==3||Array.isArray(c[1])||Array.isArray(c[2]);case"any":case"all":for(const s of c.slice(1))if(!ql(s)&&typeof s!="boolean")return!1;return!0;default:return!0}}const Qh={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Zl(c){if(c==null)return{filter:()=>!0,needGeometry:!1};ql(c)||(c=Hl(c));const s=Rs(c,Qh);if(s.result==="error")throw new Error(s.value.map(h=>`${h.key}: ${h.message}`).join(", "));return{filter:(h,m,v)=>s.value.evaluate(h,m,{},v),needGeometry:Gl(c)}}function ef(c,s){return c<s?-1:c>s?1:0}function Gl(c){if(!Array.isArray(c))return!1;if(c[0]==="within")return!0;for(let s=1;s<c.length;s++)if(Gl(c[s]))return!0;return!1}function Hl(c){if(!c)return!0;const s=c[0];return c.length<=1?s!=="any":s==="=="?nc(c[1],c[2],"=="):s==="!="?Wl(nc(c[1],c[2],"==")):s==="<"||s===">"||s==="<="||s===">="?nc(c[1],c[2],s):s==="any"?(h=c.slice(1),["any"].concat(h.map(Hl))):s==="all"?["all"].concat(c.slice(1).map(Hl)):s==="none"?["all"].concat(c.slice(1).map(Hl).map(Wl)):s==="in"?tf(c[1],c.slice(2)):s==="!in"?Wl(tf(c[1],c.slice(2))):s==="has"?nf(c[1]):s==="!has"?Wl(nf(c[1])):s!=="within"||c;var h}function nc(c,s,h){switch(c){case"$type":return[`filter-type-${h}`,s];case"$id":return[`filter-id-${h}`,s];default:return[`filter-${h}`,c,s]}}function tf(c,s){if(s.length===0)return!1;switch(c){case"$type":return["filter-type-in",["literal",s]];case"$id":return["filter-id-in",["literal",s]];default:return s.length>200&&!s.some(h=>typeof h!=typeof s[0])?["filter-in-large",c,["literal",s.sort(ef)]]:["filter-in-small",c,["literal",s]]}}function nf(c){switch(c){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",c]}}function Wl(c){return["!",c]}function rc(c){const s=typeof c;if(s==="number"||s==="boolean"||s==="string"||c==null)return JSON.stringify(c);if(Array.isArray(c)){let v="[";for(const S of c)v+=`${rc(S)},`;return`${v}]`}const h=Object.keys(c).sort();let m="{";for(let v=0;v<h.length;v++)m+=`${JSON.stringify(h[v])}:${rc(c[h[v]])},`;return`${m}}`}function Jd(c){let s="";for(const h of kn)s+=`/${rc(c[h])}`;return s}function rf(c){const s=c.value;return s?[new vt(c.key,s,"constants have been deprecated as of v8")]:[]}function Rr(c){return c instanceof Number||c instanceof String||c instanceof Boolean?c.valueOf():c}function bs(c){if(Array.isArray(c))return c.map(bs);if(c instanceof Object&&!(c instanceof Number||c instanceof String||c instanceof Boolean)){const s={};for(const h in c)s[h]=bs(c[h]);return s}return Rr(c)}function Ei(c){const s=c.key,h=c.value,m=c.valueSpec||{},v=c.objectElementValidators||{},S=c.style,T=c.styleSpec,L=c.validateSpec;let R=[];const O=Un(h);if(O!=="object")return[new vt(s,h,`object expected, ${O} found`)];for(const H in h){const X=H.split(".")[0],oe=m[X]||m["*"];let de;if(v[X])de=v[X];else if(m[X])de=L;else if(v["*"])de=v["*"];else{if(!m["*"]){R.push(new vt(s,h[H],`unknown property "${H}"`));continue}de=L}R=R.concat(de({key:(s&&`${s}.`)+H,value:h[H],valueSpec:oe,style:S,styleSpec:T,object:h,objectKey:H,validateSpec:L},h))}for(const H in m)v[H]||m[H].required&&m[H].default===void 0&&h[H]===void 0&&R.push(new vt(s,h,`missing required property "${H}"`));return R}function ic(c){const s=c.value,h=c.valueSpec,m=c.style,v=c.styleSpec,S=c.key,T=c.arrayElementValidator||c.validateSpec;if(Un(s)!=="array")return[new vt(S,s,`array expected, ${Un(s)} found`)];if(h.length&&s.length!==h.length)return[new vt(S,s,`array length ${h.length} expected, length ${s.length} found`)];if(h["min-length"]&&s.length<h["min-length"])return[new vt(S,s,`array length at least ${h["min-length"]} expected, length ${s.length} found`)];let L={type:h.value,values:h.values};v.$version<7&&(L.function=h.function),Un(h.value)==="object"&&(L=h.value);let R=[];for(let O=0;O<s.length;O++)R=R.concat(T({array:s,arrayIndex:O,value:s[O],valueSpec:L,validateSpec:c.validateSpec,style:m,styleSpec:v,key:`${S}[${O}]`}));return R}function Kl(c){const s=c.key,h=c.value,m=c.valueSpec;let v=Un(h);return v==="number"&&h!=h&&(v="NaN"),v!=="number"?[new vt(s,h,`number expected, ${v} found`)]:"minimum"in m&&h<m.minimum?[new vt(s,h,`${h} is less than the minimum value ${m.minimum}`)]:"maximum"in m&&h>m.maximum?[new vt(s,h,`${h} is greater than the maximum value ${m.maximum}`)]:[]}function of(c){const s=c.valueSpec,h=Rr(c.value.type);let m,v,S,T={};const L=h!=="categorical"&&c.value.property===void 0,R=!L,O=Un(c.value.stops)==="array"&&Un(c.value.stops[0])==="array"&&Un(c.value.stops[0][0])==="object",H=Ei({key:c.key,value:c.value,valueSpec:c.styleSpec.function,validateSpec:c.validateSpec,style:c.style,styleSpec:c.styleSpec,objectElementValidators:{stops:function(de){if(h==="identity")return[new vt(de.key,de.value,'identity function may not have a "stops" property')];let ge=[];const ve=de.value;return ge=ge.concat(ic({key:de.key,value:ve,valueSpec:de.valueSpec,validateSpec:de.validateSpec,style:de.style,styleSpec:de.styleSpec,arrayElementValidator:X})),Un(ve)==="array"&&ve.length===0&&ge.push(new vt(de.key,ve,"array must have at least one stop")),ge},default:function(de){return de.validateSpec({key:de.key,value:de.value,valueSpec:s,validateSpec:de.validateSpec,style:de.style,styleSpec:de.styleSpec})}}});return h==="identity"&&L&&H.push(new vt(c.key,c.value,'missing required property "property"')),h==="identity"||c.value.stops||H.push(new vt(c.key,c.value,'missing required property "stops"')),h==="exponential"&&c.valueSpec.expression&&!Qu(c.valueSpec)&&H.push(new vt(c.key,c.value,"exponential functions not supported")),c.styleSpec.$version>=8&&(R&&!la(c.valueSpec)?H.push(new vt(c.key,c.value,"property functions not supported")):L&&!Xh(c.valueSpec)&&H.push(new vt(c.key,c.value,"zoom functions not supported"))),h!=="categorical"&&!O||c.value.property!==void 0||H.push(new vt(c.key,c.value,'"property" property is required')),H;function X(de){let ge=[];const ve=de.value,Me=de.key;if(Un(ve)!=="array")return[new vt(Me,ve,`array expected, ${Un(ve)} found`)];if(ve.length!==2)return[new vt(Me,ve,`array length 2 expected, length ${ve.length} found`)];if(O){if(Un(ve[0])!=="object")return[new vt(Me,ve,`object expected, ${Un(ve[0])} found`)];if(ve[0].zoom===void 0)return[new vt(Me,ve,"object stop key must have zoom")];if(ve[0].value===void 0)return[new vt(Me,ve,"object stop key must have value")];if(S&&S>Rr(ve[0].zoom))return[new vt(Me,ve[0].zoom,"stop zoom values must appear in ascending order")];Rr(ve[0].zoom)!==S&&(S=Rr(ve[0].zoom),v=void 0,T={}),ge=ge.concat(Ei({key:`${Me}[0]`,value:ve[0],valueSpec:{zoom:{}},validateSpec:de.validateSpec,style:de.style,styleSpec:de.styleSpec,objectElementValidators:{zoom:Kl,value:oe}}))}else ge=ge.concat(oe({key:`${Me}[0]`,value:ve[0],valueSpec:{},validateSpec:de.validateSpec,style:de.style,styleSpec:de.styleSpec},ve));return fr(bs(ve[1]))?ge.concat([new vt(`${Me}[1]`,ve[1],"expressions are not allowed in function stops.")]):ge.concat(de.validateSpec({key:`${Me}[1]`,value:ve[1],valueSpec:s,validateSpec:de.validateSpec,style:de.style,styleSpec:de.styleSpec}))}function oe(de,ge){const ve=Un(de.value),Me=Rr(de.value),Pe=de.value!==null?de.value:ge;if(m){if(ve!==m)return[new vt(de.key,Pe,`${ve} stop domain type must match previous stop domain type ${m}`)]}else m=ve;if(ve!=="number"&&ve!=="string"&&ve!=="boolean")return[new vt(de.key,Pe,"stop domain value must be a number, string, or boolean")];if(ve!=="number"&&h!=="categorical"){let He=`number expected, ${ve} found`;return la(s)&&h===void 0&&(He+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new vt(de.key,Pe,He)]}return h!=="categorical"||ve!=="number"||isFinite(Me)&&Math.floor(Me)===Me?h!=="categorical"&&ve==="number"&&v!==void 0&&Me<v?[new vt(de.key,Pe,"stop domain values must appear in ascending order")]:(v=Me,h==="categorical"&&Me in T?[new vt(de.key,Pe,"stop domain values must be unique")]:(T[Me]=!0,[])):[new vt(de.key,Pe,`integer expected, found ${Me}`)]}}function vs(c){const s=(c.expressionContext==="property"?Yh:Rs)(bs(c.value),c.valueSpec);if(s.result==="error")return s.value.map(m=>new vt(`${c.key}${m.key}`,c.value,m.message));const h=s.value.expression||s.value._styleExpression.expression;if(c.expressionContext==="property"&&c.propertyKey==="text-font"&&!h.outputDefined())return[new vt(c.key,c.value,`Invalid data expression for "${c.propertyKey}". Output values must be contained as literals within the expression.`)];if(c.expressionContext==="property"&&c.propertyType==="layout"&&!Za(h))return[new vt(c.key,c.value,'"feature-state" data expressions are not supported with layout properties.')];if(c.expressionContext==="filter"&&!Za(h))return[new vt(c.key,c.value,'"feature-state" data expressions are not supported with filters.')];if(c.expressionContext&&c.expressionContext.indexOf("cluster")===0){if(!Ga(h,["zoom","feature-state"]))return[new vt(c.key,c.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(c.expressionContext==="cluster-initial"&&!zl(h))return[new vt(c.key,c.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function ws(c){const s=c.key,h=c.value,m=c.valueSpec,v=[];return Array.isArray(m.values)?m.values.indexOf(Rr(h))===-1&&v.push(new vt(s,h,`expected one of [${m.values.join(", ")}], ${JSON.stringify(h)} found`)):Object.keys(m.values).indexOf(Rr(h))===-1&&v.push(new vt(s,h,`expected one of [${Object.keys(m.values).join(", ")}], ${JSON.stringify(h)} found`)),v}function ua(c){return ql(bs(c.value))?vs(Pr({},c,{expressionContext:"filter",valueSpec:{value:"boolean"}})):oc(c)}function oc(c){const s=c.value,h=c.key;if(Un(s)!=="array")return[new vt(h,s,`array expected, ${Un(s)} found`)];const m=c.styleSpec;let v,S=[];if(s.length<1)return[new vt(h,s,"filter array must have at least 1 element")];switch(S=S.concat(ws({key:`${h}[0]`,value:s[0],valueSpec:m.filter_operator,style:c.style,styleSpec:c.styleSpec})),Rr(s[0])){case"<":case"<=":case">":case">=":s.length>=2&&Rr(s[1])==="$type"&&S.push(new vt(h,s,`"$type" cannot be use with operator "${s[0]}"`));case"==":case"!=":s.length!==3&&S.push(new vt(h,s,`filter array for operator "${s[0]}" must have 3 elements`));case"in":case"!in":s.length>=2&&(v=Un(s[1]),v!=="string"&&S.push(new vt(`${h}[1]`,s[1],`string expected, ${v} found`)));for(let T=2;T<s.length;T++)v=Un(s[T]),Rr(s[1])==="$type"?S=S.concat(ws({key:`${h}[${T}]`,value:s[T],valueSpec:m.geometry_type,style:c.style,styleSpec:c.styleSpec})):v!=="string"&&v!=="number"&&v!=="boolean"&&S.push(new vt(`${h}[${T}]`,s[T],`string, number, or boolean expected, ${v} found`));break;case"any":case"all":case"none":for(let T=1;T<s.length;T++)S=S.concat(oc({key:`${h}[${T}]`,value:s[T],style:c.style,styleSpec:c.styleSpec}));break;case"has":case"!has":v=Un(s[1]),s.length!==2?S.push(new vt(h,s,`filter array for "${s[0]}" operator must have 2 elements`)):v!=="string"&&S.push(new vt(`${h}[1]`,s[1],`string expected, ${v} found`));break;case"within":v=Un(s[1]),s.length!==2?S.push(new vt(h,s,`filter array for "${s[0]}" operator must have 2 elements`)):v!=="object"&&S.push(new vt(`${h}[1]`,s[1],`object expected, ${v} found`))}return S}function Xl(c,s){const h=c.key,m=c.validateSpec,v=c.style,S=c.styleSpec,T=c.value,L=c.objectKey,R=S[`${s}_${c.layerType}`];if(!R)return[];const O=L.match(/^(.*)-transition$/);if(s==="paint"&&O&&R[O[1]]&&R[O[1]].transition)return m({key:h,value:T,valueSpec:S.transition,style:v,styleSpec:S});const H=c.valueSpec||R[L];if(!H)return[new vt(h,T,`unknown property "${L}"`)];let X;if(Un(T)==="string"&&la(H)&&!H.tokens&&(X=/^{([^}]+)}$/.exec(T)))return[new vt(h,T,`"${L}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(X[1])} }\`.`)];const oe=[];return c.layerType==="symbol"&&(L==="text-field"&&v&&!v.glyphs&&oe.push(new vt(h,T,'use of "text-field" requires a style "glyphs" property')),L==="text-font"&&Nl(bs(T))&&Rr(T.type)==="identity"&&oe.push(new vt(h,T,'"text-font" does not support identity functions'))),oe.concat(m({key:c.key,value:T,valueSpec:H,style:v,styleSpec:S,expressionContext:"property",propertyType:s,propertyKey:L}))}function sc(c){return Xl(c,"paint")}function ac(c){return Xl(c,"layout")}function Xa(c){let s=[];const h=c.value,m=c.key,v=c.style,S=c.styleSpec;h.type||h.ref||s.push(new vt(m,h,'either "type" or "ref" is required'));let T=Rr(h.type);const L=Rr(h.ref);if(h.id){const R=Rr(h.id);for(let O=0;O<c.arrayIndex;O++){const H=v.layers[O];Rr(H.id)===R&&s.push(new vt(m,h.id,`duplicate layer id "${h.id}", previously used at line ${H.id.__line__}`))}}if("ref"in h){let R;["type","source","source-layer","filter","layout"].forEach(O=>{O in h&&s.push(new vt(m,h[O],`"${O}" is prohibited for ref layers`))}),v.layers.forEach(O=>{Rr(O.id)===L&&(R=O)}),R?R.ref?s.push(new vt(m,h.ref,"ref cannot reference another ref layer")):T=Rr(R.type):s.push(new vt(m,h.ref,`ref layer "${L}" not found`))}else if(T!=="background")if(h.source){const R=v.sources&&v.sources[h.source],O=R&&Rr(R.type);R?O==="vector"&&T==="raster"?s.push(new vt(m,h.source,`layer "${h.id}" requires a raster source`)):O!=="raster-dem"&&T==="hillshade"?s.push(new vt(m,h.source,`layer "${h.id}" requires a raster-dem source`)):O==="raster"&&T!=="raster"?s.push(new vt(m,h.source,`layer "${h.id}" requires a vector source`)):O!=="vector"||h["source-layer"]?O==="raster-dem"&&T!=="hillshade"?s.push(new vt(m,h.source,"raster-dem source can only be used with layer type 'hillshade'.")):T!=="line"||!h.paint||!h.paint["line-gradient"]||O==="geojson"&&R.lineMetrics||s.push(new vt(m,h,`layer "${h.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):s.push(new vt(m,h,`layer "${h.id}" must specify a "source-layer"`)):s.push(new vt(m,h.source,`source "${h.source}" not found`))}else s.push(new vt(m,h,'missing required property "source"'));return s=s.concat(Ei({key:m,value:h,valueSpec:S.layer,style:c.style,styleSpec:c.styleSpec,validateSpec:c.validateSpec,objectElementValidators:{"*":()=>[],type:()=>c.validateSpec({key:`${m}.type`,value:h.type,valueSpec:S.layer.type,style:c.style,styleSpec:c.styleSpec,validateSpec:c.validateSpec,object:h,objectKey:"type"}),filter:ua,layout:R=>Ei({layer:h,key:R.key,value:R.value,style:R.style,styleSpec:R.styleSpec,validateSpec:R.validateSpec,objectElementValidators:{"*":O=>ac(Pr({layerType:T},O))}}),paint:R=>Ei({layer:h,key:R.key,value:R.value,style:R.style,styleSpec:R.styleSpec,validateSpec:R.validateSpec,objectElementValidators:{"*":O=>sc(Pr({layerType:T},O))}})}})),s}function Fs(c){const s=c.value,h=c.key,m=Un(s);return m!=="string"?[new vt(h,s,`string expected, ${m} found`)]:[]}const sf={promoteId:function({key:c,value:s}){if(Un(s)==="string")return Fs({key:c,value:s});{const h=[];for(const m in s)h.push(...Fs({key:`${c}.${m}`,value:s[m]}));return h}}};function af(c){const s=c.value,h=c.key,m=c.styleSpec,v=c.style,S=c.validateSpec;if(!s.type)return[new vt(h,s,'"type" is required')];const T=Rr(s.type);let L;switch(T){case"vector":case"raster":return L=Ei({key:h,value:s,valueSpec:m[`source_${T.replace("-","_")}`],style:c.style,styleSpec:m,objectElementValidators:sf,validateSpec:S}),L;case"raster-dem":return L=function(R){var O;const H=(O=R.sourceName)!==null&&O!==void 0?O:"",X=R.value,oe=R.styleSpec,de=oe.source_raster_dem,ge=R.style;let ve=[];const Me=Un(X);if(X===void 0)return ve;if(Me!=="object")return ve.push(new vt("source_raster_dem",X,`object expected, ${Me} found`)),ve;const Pe=Rr(X.encoding)==="custom",He=["redFactor","greenFactor","blueFactor","baseShift"],ze=R.value.encoding?`"${R.value.encoding}"`:"Default";for(const Ne in X)!Pe&&He.includes(Ne)?ve.push(new vt(Ne,X[Ne],`In "${H}": "${Ne}" is only valid when "encoding" is set to "custom". ${ze} encoding found`)):de[Ne]?ve=ve.concat(R.validateSpec({key:Ne,value:X[Ne],valueSpec:de[Ne],validateSpec:R.validateSpec,style:ge,styleSpec:oe})):ve.push(new vt(Ne,X[Ne],`unknown property "${Ne}"`));return ve}({sourceName:h,value:s,style:c.style,styleSpec:m,validateSpec:S}),L;case"geojson":if(L=Ei({key:h,value:s,valueSpec:m.source_geojson,style:v,styleSpec:m,validateSpec:S,objectElementValidators:sf}),s.cluster)for(const R in s.clusterProperties){const[O,H]=s.clusterProperties[R],X=typeof O=="string"?[O,["accumulated"],["get",R]]:O;L.push(...vs({key:`${h}.${R}.map`,value:H,validateSpec:S,expressionContext:"cluster-map"})),L.push(...vs({key:`${h}.${R}.reduce`,value:X,validateSpec:S,expressionContext:"cluster-reduce"}))}return L;case"video":return Ei({key:h,value:s,valueSpec:m.source_video,style:v,validateSpec:S,styleSpec:m});case"image":return Ei({key:h,value:s,valueSpec:m.source_image,style:v,validateSpec:S,styleSpec:m});case"canvas":return[new vt(h,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return ws({key:`${h}.type`,value:s.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:v,validateSpec:S,styleSpec:m})}}function lf(c){const s=c.value,h=c.styleSpec,m=h.light,v=c.style;let S=[];const T=Un(s);if(s===void 0)return S;if(T!=="object")return S=S.concat([new vt("light",s,`object expected, ${T} found`)]),S;for(const L in s){const R=L.match(/^(.*)-transition$/);S=S.concat(R&&m[R[1]]&&m[R[1]].transition?c.validateSpec({key:L,value:s[L],valueSpec:h.transition,validateSpec:c.validateSpec,style:v,styleSpec:h}):m[L]?c.validateSpec({key:L,value:s[L],valueSpec:m[L],validateSpec:c.validateSpec,style:v,styleSpec:h}):[new vt(L,s[L],`unknown property "${L}"`)])}return S}function uf(c){const s=c.value,h=c.styleSpec,m=h.sky,v=c.style,S=Un(s);if(s===void 0)return[];if(S!=="object")return[new vt("sky",s,`object expected, ${S} found`)];let T=[];for(const L in s)T=T.concat(m[L]?Vo({key:L,value:s[L],valueSpec:m[L],style:v,styleSpec:h}):[new vt(L,s[L],`unknown property "${L}"`)]);return T}function Ja(c){const s=c.value,h=c.styleSpec,m=h.terrain,v=c.style;let S=[];const T=Un(s);if(s===void 0)return S;if(T!=="object")return S=S.concat([new vt("terrain",s,`object expected, ${T} found`)]),S;for(const L in s)S=S.concat(m[L]?c.validateSpec({key:L,value:s[L],valueSpec:m[L],validateSpec:c.validateSpec,style:v,styleSpec:h}):[new vt(L,s[L],`unknown property "${L}"`)]);return S}function Ya(c){let s=[];const h=c.value,m=c.key;if(Array.isArray(h)){const v=[],S=[];for(const T in h)h[T].id&&v.includes(h[T].id)&&s.push(new vt(m,h,`all the sprites' ids must be unique, but ${h[T].id} is duplicated`)),v.push(h[T].id),h[T].url&&S.includes(h[T].url)&&s.push(new vt(m,h,`all the sprites' URLs must be unique, but ${h[T].url} is duplicated`)),S.push(h[T].url),s=s.concat(Ei({key:`${m}[${T}]`,value:h[T],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:c.validateSpec}));return s}return Fs({key:m,value:h})}const Bi={"*":()=>[],array:ic,boolean:function(c){const s=c.value,h=c.key,m=Un(s);return m!=="boolean"?[new vt(h,s,`boolean expected, ${m} found`)]:[]},number:Kl,color:function(c){const s=c.key,h=c.value,m=Un(h);return m!=="string"?[new vt(s,h,`color expected, ${m} found`)]:tr.parse(String(h))?[]:[new vt(s,h,`color expected, "${h}" found`)]},constants:rf,enum:ws,filter:ua,function:of,layer:Xa,object:Ei,source:af,light:lf,sky:uf,terrain:Ja,string:Fs,formatted:function(c){return Fs(c).length===0?[]:vs(c)},resolvedImage:function(c){return Fs(c).length===0?[]:vs(c)},padding:function(c){const s=c.key,h=c.value;if(Un(h)==="array"){if(h.length<1||h.length>4)return[new vt(s,h,`padding requires 1 to 4 values; ${h.length} values found`)];const m={type:"number"};let v=[];for(let S=0;S<h.length;S++)v=v.concat(c.validateSpec({key:`${s}[${S}]`,value:h[S],validateSpec:c.validateSpec,valueSpec:m}));return v}return Kl({key:s,value:h,valueSpec:{}})},variableAnchorOffsetCollection:function(c){const s=c.key,h=c.value,m=Un(h),v=c.styleSpec;if(m!=="array"||h.length<1||h.length%2!=0)return[new vt(s,h,"variableAnchorOffsetCollection requires a non-empty array of even length")];let S=[];for(let T=0;T<h.length;T+=2)S=S.concat(ws({key:`${s}[${T}]`,value:h[T],valueSpec:v.layout_symbol["text-anchor"]})),S=S.concat(ic({key:`${s}[${T+1}]`,value:h[T+1],valueSpec:{length:2,value:"number"},validateSpec:c.validateSpec,style:c.style,styleSpec:v}));return S},sprite:Ya};function Vo(c){const s=c.value,h=c.valueSpec,m=c.styleSpec;return c.validateSpec=Vo,h.expression&&Nl(Rr(s))?of(c):h.expression&&fr(bs(s))?vs(c):h.type&&Bi[h.type]?Bi[h.type](c):Ei(Pr({},c,{valueSpec:h.type?m[h.type]:h}))}function lc(c){const s=c.value,h=c.key,m=Fs(c);return m.length||(s.indexOf("{fontstack}")===-1&&m.push(new vt(h,s,'"glyphs" url must include a "{fontstack}" token')),s.indexOf("{range}")===-1&&m.push(new vt(h,s,'"glyphs" url must include a "{range}" token'))),m}function ko(c,s=ye){let h=[];return h=h.concat(Vo({key:"",value:c,valueSpec:s.$root,styleSpec:s,style:c,validateSpec:Vo,objectElementValidators:{glyphs:lc,"*":()=>[]}})),c.constants&&(h=h.concat(rf({key:"constants",value:c.constants,style:c,styleSpec:s,validateSpec:Vo}))),ca(h)}function qo(c){return function(s){return c({...s,validateSpec:Vo})}}function ca(c){return[].concat(c).sort((s,h)=>s.line-h.line)}function So(c){return function(...s){return ca(c.apply(this,s))}}ko.source=So(qo(af)),ko.sprite=So(qo(Ya)),ko.glyphs=So(qo(lc)),ko.light=So(qo(lf)),ko.sky=So(qo(uf)),ko.terrain=So(qo(Ja)),ko.layer=So(qo(Xa)),ko.filter=So(qo(ua)),ko.paintProperty=So(qo(sc)),ko.layoutProperty=So(qo(ac));const Bs=ko,Yd=Bs.light,uc=Bs.paintProperty,Qd=Bs.layoutProperty;function ha(c,s){let h=!1;if(s&&s.length)for(const m of s)c.fire(new Je(new Error(m.message))),h=!0;return h}class Qa{constructor(s,h,m){const v=this.cells=[];if(s instanceof ArrayBuffer){this.arrayBuffer=s;const T=new Int32Array(this.arrayBuffer);s=T[0],this.d=(h=T[1])+2*(m=T[2]);for(let R=0;R<this.d*this.d;R++){const O=T[3+R],H=T[3+R+1];v.push(O===H?null:T.subarray(O,H))}const L=T[3+v.length+1];this.keys=T.subarray(T[3+v.length],L),this.bboxes=T.subarray(L),this.insert=this._insertReadonly}else{this.d=h+2*m;for(let T=0;T<this.d*this.d;T++)v.push([]);this.keys=[],this.bboxes=[]}this.n=h,this.extent=s,this.padding=m,this.scale=h/s,this.uid=0;const S=m/h*s;this.min=-S,this.max=s+S}insert(s,h,m,v,S){this._forEachCell(h,m,v,S,this._insertCell,this.uid++,void 0,void 0),this.keys.push(s),this.bboxes.push(h),this.bboxes.push(m),this.bboxes.push(v),this.bboxes.push(S)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(s,h,m,v,S,T){this.cells[S].push(T)}query(s,h,m,v,S){const T=this.min,L=this.max;if(s<=T&&h<=T&&L<=m&&L<=v&&!S)return Array.prototype.slice.call(this.keys);{const R=[];return this._forEachCell(s,h,m,v,this._queryCell,R,{},S),R}}_queryCell(s,h,m,v,S,T,L,R){const O=this.cells[S];if(O!==null){const H=this.keys,X=this.bboxes;for(let oe=0;oe<O.length;oe++){const de=O[oe];if(L[de]===void 0){const ge=4*de;(R?R(X[ge+0],X[ge+1],X[ge+2],X[ge+3]):s<=X[ge+2]&&h<=X[ge+3]&&m>=X[ge+0]&&v>=X[ge+1])?(L[de]=!0,T.push(H[de])):L[de]=!1}}}}_forEachCell(s,h,m,v,S,T,L,R){const O=this._convertToCellCoord(s),H=this._convertToCellCoord(h),X=this._convertToCellCoord(m),oe=this._convertToCellCoord(v);for(let de=O;de<=X;de++)for(let ge=H;ge<=oe;ge++){const ve=this.d*ge+de;if((!R||R(this._convertFromCellCoord(de),this._convertFromCellCoord(ge),this._convertFromCellCoord(de+1),this._convertFromCellCoord(ge+1)))&&S.call(this,s,h,m,v,ve,T,L,R))return}}_convertFromCellCoord(s){return(s-this.padding)/this.scale}_convertToCellCoord(s){return Math.max(0,Math.min(this.d-1,Math.floor(s*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const s=this.cells,h=3+this.cells.length+1+1;let m=0;for(let T=0;T<this.cells.length;T++)m+=this.cells[T].length;const v=new Int32Array(h+m+this.keys.length+this.bboxes.length);v[0]=this.extent,v[1]=this.n,v[2]=this.padding;let S=h;for(let T=0;T<s.length;T++){const L=s[T];v[3+T]=S,v.set(L,S),S+=L.length}return v[3+s.length]=S,v.set(this.keys,S),S+=this.keys.length,v[3+s.length+1]=S,v.set(this.bboxes,S),S+=this.bboxes.length,v.buffer}static serialize(s,h){const m=s.toArrayBuffer();return h&&h.push(m),{buffer:m}}static deserialize(s){return new Qa(s.buffer)}}const Zo={};function Gt(c,s,h={}){if(Zo[c])throw new Error(`${c} is already registered.`);Object.defineProperty(s,"_classRegistryKey",{value:c,writeable:!1}),Zo[c]={klass:s,omit:h.omit||[],shallow:h.shallow||[]}}Gt("Object",Object),Gt("TransferableGridIndex",Qa),Gt("Color",tr),Gt("Error",Error),Gt("AJAXError",Pt),Gt("ResolvedImage",fo),Gt("StylePropertyFunction",Ul),Gt("StyleExpression",br,{omit:["_evaluator"]}),Gt("ZoomDependentExpression",tc),Gt("ZoomConstantExpression",jl),Gt("CompoundExpression",eo,{omit:["_evaluate"]});for(const c in sa)sa[c]._classRegistryKey||Gt(`Expression_${c}`,sa[c]);function Jl(c){return c&&typeof ArrayBuffer<"u"&&(c instanceof ArrayBuffer||c.constructor&&c.constructor.name==="ArrayBuffer")}function fa(c,s){if(c==null||typeof c=="boolean"||typeof c=="number"||typeof c=="string"||c instanceof Boolean||c instanceof Number||c instanceof String||c instanceof Date||c instanceof RegExp||c instanceof Blob||c instanceof Error)return c;if(Jl(c)||De(c))return s&&s.push(c),c;if(ArrayBuffer.isView(c)){const h=c;return s&&s.push(h.buffer),h}if(c instanceof ImageData)return s&&s.push(c.data.buffer),c;if(Array.isArray(c)){const h=[];for(const m of c)h.push(fa(m,s));return h}if(typeof c=="object"){const h=c.constructor,m=h._classRegistryKey;if(!m)throw new Error(`can't serialize object of unregistered class ${h.name}`);if(!Zo[m])throw new Error(`${m} is not registered.`);const v=h.serialize?h.serialize(c,s):{};if(h.serialize){if(s&&v===s[s.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const S in c){if(!c.hasOwnProperty(S)||Zo[m].omit.indexOf(S)>=0)continue;const T=c[S];v[S]=Zo[m].shallow.indexOf(S)>=0?T:fa(T,s)}c instanceof Error&&(v.message=c.message)}if(v.$name)throw new Error("$name property is reserved for worker serialization logic.");return m!=="Object"&&(v.$name=m),v}throw new Error("can't serialize object of type "+typeof c)}function da(c){if(c==null||typeof c=="boolean"||typeof c=="number"||typeof c=="string"||c instanceof Boolean||c instanceof Number||c instanceof String||c instanceof Date||c instanceof RegExp||c instanceof Blob||c instanceof Error||Jl(c)||De(c)||ArrayBuffer.isView(c)||c instanceof ImageData)return c;if(Array.isArray(c))return c.map(da);if(typeof c=="object"){const s=c.$name||"Object";if(!Zo[s])throw new Error(`can't deserialize unregistered class ${s}`);const{klass:h}=Zo[s];if(!h)throw new Error(`can't deserialize unregistered class ${s}`);if(h.deserialize)return h.deserialize(c);const m=Object.create(h.prototype);for(const v of Object.keys(c)){if(v==="$name")continue;const S=c[v];m[v]=Zo[s].shallow.indexOf(v)>=0?S:da(S)}return m}throw new Error("can't deserialize object of type "+typeof c)}class cf{constructor(){this.first=!0}update(s,h){const m=Math.floor(s);return this.first?(this.first=!1,this.lastIntegerZoom=m,this.lastIntegerZoomTime=0,this.lastZoom=s,this.lastFloorZoom=m,!0):(this.lastFloorZoom>m?(this.lastIntegerZoom=m+1,this.lastIntegerZoomTime=h):this.lastFloorZoom<m&&(this.lastIntegerZoom=m,this.lastIntegerZoomTime=h),s!==this.lastZoom&&(this.lastZoom=s,this.lastFloorZoom=m,!0))}}const Ut={"Latin-1 Supplement":c=>c>=128&&c<=255,Arabic:c=>c>=1536&&c<=1791,"Arabic Supplement":c=>c>=1872&&c<=1919,"Arabic Extended-A":c=>c>=2208&&c<=2303,"Hangul Jamo":c=>c>=4352&&c<=4607,"Unified Canadian Aboriginal Syllabics":c=>c>=5120&&c<=5759,Khmer:c=>c>=6016&&c<=6143,"Unified Canadian Aboriginal Syllabics Extended":c=>c>=6320&&c<=6399,"General Punctuation":c=>c>=8192&&c<=8303,"Letterlike Symbols":c=>c>=8448&&c<=8527,"Number Forms":c=>c>=8528&&c<=8591,"Miscellaneous Technical":c=>c>=8960&&c<=9215,"Control Pictures":c=>c>=9216&&c<=9279,"Optical Character Recognition":c=>c>=9280&&c<=9311,"Enclosed Alphanumerics":c=>c>=9312&&c<=9471,"Geometric Shapes":c=>c>=9632&&c<=9727,"Miscellaneous Symbols":c=>c>=9728&&c<=9983,"Miscellaneous Symbols and Arrows":c=>c>=11008&&c<=11263,"CJK Radicals Supplement":c=>c>=11904&&c<=12031,"Kangxi Radicals":c=>c>=12032&&c<=12255,"Ideographic Description Characters":c=>c>=12272&&c<=12287,"CJK Symbols and Punctuation":c=>c>=12288&&c<=12351,Hiragana:c=>c>=12352&&c<=12447,Katakana:c=>c>=12448&&c<=12543,Bopomofo:c=>c>=12544&&c<=12591,"Hangul Compatibility Jamo":c=>c>=12592&&c<=12687,Kanbun:c=>c>=12688&&c<=12703,"Bopomofo Extended":c=>c>=12704&&c<=12735,"CJK Strokes":c=>c>=12736&&c<=12783,"Katakana Phonetic Extensions":c=>c>=12784&&c<=12799,"Enclosed CJK Letters and Months":c=>c>=12800&&c<=13055,"CJK Compatibility":c=>c>=13056&&c<=13311,"CJK Unified Ideographs Extension A":c=>c>=13312&&c<=19903,"Yijing Hexagram Symbols":c=>c>=19904&&c<=19967,"CJK Unified Ideographs":c=>c>=19968&&c<=40959,"Yi Syllables":c=>c>=40960&&c<=42127,"Yi Radicals":c=>c>=42128&&c<=42191,"Hangul Jamo Extended-A":c=>c>=43360&&c<=43391,"Hangul Syllables":c=>c>=44032&&c<=55215,"Hangul Jamo Extended-B":c=>c>=55216&&c<=55295,"Private Use Area":c=>c>=57344&&c<=63743,"CJK Compatibility Ideographs":c=>c>=63744&&c<=64255,"Arabic Presentation Forms-A":c=>c>=64336&&c<=65023,"Vertical Forms":c=>c>=65040&&c<=65055,"CJK Compatibility Forms":c=>c>=65072&&c<=65103,"Small Form Variants":c=>c>=65104&&c<=65135,"Arabic Presentation Forms-B":c=>c>=65136&&c<=65279,"Halfwidth and Fullwidth Forms":c=>c>=65280&&c<=65519};function pa(c){for(const s of c)if(Yl(s.charCodeAt(0)))return!0;return!1}function hf(c){for(const s of c)if(!ff(s.charCodeAt(0)))return!1;return!0}function ff(c){return!(Ut.Arabic(c)||Ut["Arabic Supplement"](c)||Ut["Arabic Extended-A"](c)||Ut["Arabic Presentation Forms-A"](c)||Ut["Arabic Presentation Forms-B"](c))}function Yl(c){return!(c!==746&&c!==747&&(c<4352||!(Ut["Bopomofo Extended"](c)||Ut.Bopomofo(c)||Ut["CJK Compatibility Forms"](c)&&!(c>=65097&&c<=65103)||Ut["CJK Compatibility Ideographs"](c)||Ut["CJK Compatibility"](c)||Ut["CJK Radicals Supplement"](c)||Ut["CJK Strokes"](c)||!(!Ut["CJK Symbols and Punctuation"](c)||c>=12296&&c<=12305||c>=12308&&c<=12319||c===12336)||Ut["CJK Unified Ideographs Extension A"](c)||Ut["CJK Unified Ideographs"](c)||Ut["Enclosed CJK Letters and Months"](c)||Ut["Hangul Compatibility Jamo"](c)||Ut["Hangul Jamo Extended-A"](c)||Ut["Hangul Jamo Extended-B"](c)||Ut["Hangul Jamo"](c)||Ut["Hangul Syllables"](c)||Ut.Hiragana(c)||Ut["Ideographic Description Characters"](c)||Ut.Kanbun(c)||Ut["Kangxi Radicals"](c)||Ut["Katakana Phonetic Extensions"](c)||Ut.Katakana(c)&&c!==12540||!(!Ut["Halfwidth and Fullwidth Forms"](c)||c===65288||c===65289||c===65293||c>=65306&&c<=65310||c===65339||c===65341||c===65343||c>=65371&&c<=65503||c===65507||c>=65512&&c<=65519)||!(!Ut["Small Form Variants"](c)||c>=65112&&c<=65118||c>=65123&&c<=65126)||Ut["Unified Canadian Aboriginal Syllabics"](c)||Ut["Unified Canadian Aboriginal Syllabics Extended"](c)||Ut["Vertical Forms"](c)||Ut["Yijing Hexagram Symbols"](c)||Ut["Yi Syllables"](c)||Ut["Yi Radicals"](c))))}function cc(c){return!(Yl(c)||function(s){return!!(Ut["Latin-1 Supplement"](s)&&(s===167||s===169||s===174||s===177||s===188||s===189||s===190||s===215||s===247)||Ut["General Punctuation"](s)&&(s===8214||s===8224||s===8225||s===8240||s===8241||s===8251||s===8252||s===8258||s===8263||s===8264||s===8265||s===8273)||Ut["Letterlike Symbols"](s)||Ut["Number Forms"](s)||Ut["Miscellaneous Technical"](s)&&(s>=8960&&s<=8967||s>=8972&&s<=8991||s>=8996&&s<=9e3||s===9003||s>=9085&&s<=9114||s>=9150&&s<=9165||s===9167||s>=9169&&s<=9179||s>=9186&&s<=9215)||Ut["Control Pictures"](s)&&s!==9251||Ut["Optical Character Recognition"](s)||Ut["Enclosed Alphanumerics"](s)||Ut["Geometric Shapes"](s)||Ut["Miscellaneous Symbols"](s)&&!(s>=9754&&s<=9759)||Ut["Miscellaneous Symbols and Arrows"](s)&&(s>=11026&&s<=11055||s>=11088&&s<=11097||s>=11192&&s<=11243)||Ut["CJK Symbols and Punctuation"](s)||Ut.Katakana(s)||Ut["Private Use Area"](s)||Ut["CJK Compatibility Forms"](s)||Ut["Small Form Variants"](s)||Ut["Halfwidth and Fullwidth Forms"](s)||s===8734||s===8756||s===8757||s>=9984&&s<=10087||s>=10102&&s<=10131||s===65532||s===65533)}(c))}function Ql(c){return c>=1424&&c<=2303||Ut["Arabic Presentation Forms-A"](c)||Ut["Arabic Presentation Forms-B"](c)}function df(c,s){return!(!s&&Ql(c)||c>=2304&&c<=3583||c>=3840&&c<=4255||Ut.Khmer(c))}function ep(c){for(const s of c)if(Ql(s.charCodeAt(0)))return!0;return!1}const xs=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(c){this.pluginStatus=c.pluginStatus,this.pluginURL=c.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(c){this.applyArabicShaping=c.applyArabicShaping,this.processBidirectionalText=c.processBidirectionalText,this.processStyledBidirectionalText=c.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class kr{constructor(s,h){this.zoom=s,h?(this.now=h.now,this.fadeDuration=h.fadeDuration,this.zoomHistory=h.zoomHistory,this.transition=h.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new cf,this.transition={})}isSupportedScript(s){return function(h,m){for(const v of h)if(!df(v.charCodeAt(0),m))return!1;return!0}(s,xs.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const s=this.zoom,h=s-Math.floor(s),m=this.crossFadingFactor();return s>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:h+(1-h)*m}:{fromScale:.5,toScale:1,t:1-(1-m)*h}}}class el{constructor(s,h){this.property=s,this.value=h,this.expression=function(m,v){if(Nl(m))return new Ul(m,v);if(fr(m)){const S=Yh(m,v);if(S.result==="error")throw new Error(S.value.map(T=>`${T.key}: ${T.message}`).join(", "));return S.value}{let S=m;return v.type==="color"&&typeof m=="string"?S=tr.parse(m):v.type!=="padding"||typeof m!="number"&&!Array.isArray(m)?v.type==="variableAnchorOffsetCollection"&&Array.isArray(m)&&(S=ho.parse(m)):S=Fi.parse(m),{kind:"constant",evaluate:()=>S}}}(h===void 0?s.specification.default:h,s.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(s,h,m){return this.property.possiblyEvaluate(this,s,h,m)}}class eu{constructor(s){this.property=s,this.value=new el(s,void 0)}transitioned(s,h){return new pf(this.property,this.value,h,W({},s.transition,this.transition),s.now)}untransitioned(){return new pf(this.property,this.value,null,{},0)}}class hc{constructor(s){this._properties=s,this._values=Object.create(s.defaultTransitionablePropertyValues)}getValue(s){return ne(this._values[s].value.value)}setValue(s,h){Object.prototype.hasOwnProperty.call(this._values,s)||(this._values[s]=new eu(this._values[s].property)),this._values[s].value=new el(this._values[s].property,h===null?void 0:ne(h))}getTransition(s){return ne(this._values[s].transition)}setTransition(s,h){Object.prototype.hasOwnProperty.call(this._values,s)||(this._values[s]=new eu(this._values[s].property)),this._values[s].transition=ne(h)||void 0}serialize(){const s={};for(const h of Object.keys(this._values)){const m=this.getValue(h);m!==void 0&&(s[h]=m);const v=this.getTransition(h);v!==void 0&&(s[`${h}-transition`]=v)}return s}transitioned(s,h){const m=new mf(this._properties);for(const v of Object.keys(this._values))m._values[v]=this._values[v].transitioned(s,h._values[v]);return m}untransitioned(){const s=new mf(this._properties);for(const h of Object.keys(this._values))s._values[h]=this._values[h].untransitioned();return s}}class pf{constructor(s,h,m,v,S){this.property=s,this.value=h,this.begin=S+v.delay||0,this.end=this.begin+v.duration||0,s.specification.transition&&(v.delay||v.duration)&&(this.prior=m)}possiblyEvaluate(s,h,m){const v=s.now||0,S=this.value.possiblyEvaluate(s,h,m),T=this.prior;if(T){if(v>this.end)return this.prior=null,S;if(this.value.isDataDriven())return this.prior=null,S;if(v<this.begin)return T.possiblyEvaluate(s,h,m);{const L=(v-this.begin)/(this.end-this.begin);return this.property.interpolate(T.possiblyEvaluate(s,h,m),S,function(R){if(R<=0)return 0;if(R>=1)return 1;const O=R*R,H=O*R;return 4*(R<.5?H:3*(R-O)+H-.75)}(L))}}return S}}class mf{constructor(s){this._properties=s,this._values=Object.create(s.defaultTransitioningPropertyValues)}possiblyEvaluate(s,h,m){const v=new tl(this._properties);for(const S of Object.keys(this._values))v._values[S]=this._values[S].possiblyEvaluate(s,h,m);return v}hasTransition(){for(const s of Object.keys(this._values))if(this._values[s].prior)return!0;return!1}}class gf{constructor(s){this._properties=s,this._values=Object.create(s.defaultPropertyValues)}hasValue(s){return this._values[s].value!==void 0}getValue(s){return ne(this._values[s].value)}setValue(s,h){this._values[s]=new el(this._values[s].property,h===null?void 0:ne(h))}serialize(){const s={};for(const h of Object.keys(this._values)){const m=this.getValue(h);m!==void 0&&(s[h]=m)}return s}possiblyEvaluate(s,h,m){const v=new tl(this._properties);for(const S of Object.keys(this._values))v._values[S]=this._values[S].possiblyEvaluate(s,h,m);return v}}class To{constructor(s,h,m){this.property=s,this.value=h,this.parameters=m}isConstant(){return this.value.kind==="constant"}constantOr(s){return this.value.kind==="constant"?this.value.value:s}evaluate(s,h,m,v){return this.property.evaluate(this.value,this.parameters,s,h,m,v)}}class tl{constructor(s){this._properties=s,this._values=Object.create(s.defaultPossiblyEvaluatedValues)}get(s){return this._values[s]}}class tn{constructor(s){this.specification=s}possiblyEvaluate(s,h){if(s.isDataDriven())throw new Error("Value should not be data driven");return s.expression.evaluate(h)}interpolate(s,h,m){const v=Li[this.specification.type];return v?v(s,h,m):s}}class ln{constructor(s,h){this.specification=s,this.overrides=h}possiblyEvaluate(s,h,m,v){return new To(this,s.expression.kind==="constant"||s.expression.kind==="camera"?{kind:"constant",value:s.expression.evaluate(h,null,{},m,v)}:s.expression,h)}interpolate(s,h,m){if(s.value.kind!=="constant"||h.value.kind!=="constant")return s;if(s.value.value===void 0||h.value.value===void 0)return new To(this,{kind:"constant",value:void 0},s.parameters);const v=Li[this.specification.type];if(v){const S=v(s.value.value,h.value.value,m);return new To(this,{kind:"constant",value:S},s.parameters)}return s}evaluate(s,h,m,v,S,T){return s.kind==="constant"?s.value:s.evaluate(h,m,v,S,T)}}class tu extends ln{possiblyEvaluate(s,h,m,v){if(s.value===void 0)return new To(this,{kind:"constant",value:void 0},h);if(s.expression.kind==="constant"){const S=s.expression.evaluate(h,null,{},m,v),T=s.property.specification.type==="resolvedImage"&&typeof S!="string"?S.name:S,L=this._calculate(T,T,T,h);return new To(this,{kind:"constant",value:L},h)}if(s.expression.kind==="camera"){const S=this._calculate(s.expression.evaluate({zoom:h.zoom-1}),s.expression.evaluate({zoom:h.zoom}),s.expression.evaluate({zoom:h.zoom+1}),h);return new To(this,{kind:"constant",value:S},h)}return new To(this,s.expression,h)}evaluate(s,h,m,v,S,T){if(s.kind==="source"){const L=s.evaluate(h,m,v,S,T);return this._calculate(L,L,L,h)}return s.kind==="composite"?this._calculate(s.evaluate({zoom:Math.floor(h.zoom)-1},m,v),s.evaluate({zoom:Math.floor(h.zoom)},m,v),s.evaluate({zoom:Math.floor(h.zoom)+1},m,v),h):s.value}_calculate(s,h,m,v){return v.zoom>v.zoomHistory.lastIntegerZoom?{from:s,to:h}:{from:m,to:h}}interpolate(s){return s}}class nl{constructor(s){this.specification=s}possiblyEvaluate(s,h,m,v){if(s.value!==void 0){if(s.expression.kind==="constant"){const S=s.expression.evaluate(h,null,{},m,v);return this._calculate(S,S,S,h)}return this._calculate(s.expression.evaluate(new kr(Math.floor(h.zoom-1),h)),s.expression.evaluate(new kr(Math.floor(h.zoom),h)),s.expression.evaluate(new kr(Math.floor(h.zoom+1),h)),h)}}_calculate(s,h,m,v){return v.zoom>v.zoomHistory.lastIntegerZoom?{from:s,to:h}:{from:m,to:h}}interpolate(s){return s}}class fc{constructor(s){this.specification=s}possiblyEvaluate(s,h,m,v){return!!s.expression.evaluate(h,null,{},m,v)}interpolate(){return!1}}class $i{constructor(s){this.properties=s,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const h in s){const m=s[h];m.specification.overridable&&this.overridableProperties.push(h);const v=this.defaultPropertyValues[h]=new el(m,void 0),S=this.defaultTransitionablePropertyValues[h]=new eu(m);this.defaultTransitioningPropertyValues[h]=S.untransitioned(),this.defaultPossiblyEvaluatedValues[h]=v.possiblyEvaluate({})}}}Gt("DataDrivenProperty",ln),Gt("DataConstantProperty",tn),Gt("CrossFadedDataDrivenProperty",tu),Gt("CrossFadedProperty",nl),Gt("ColorRampProperty",fc);const dc="-transition";class Co extends Et{constructor(s,h){if(super(),this.id=s.id,this.type=s.type,this._featureFilter={filter:()=>!0,needGeometry:!1},s.type!=="custom"&&(this.metadata=s.metadata,this.minzoom=s.minzoom,this.maxzoom=s.maxzoom,s.type!=="background"&&(this.source=s.source,this.sourceLayer=s["source-layer"],this.filter=s.filter),h.layout&&(this._unevaluatedLayout=new gf(h.layout)),h.paint)){this._transitionablePaint=new hc(h.paint);for(const m in s.paint)this.setPaintProperty(m,s.paint[m],{validate:!1});for(const m in s.layout)this.setLayoutProperty(m,s.layout[m],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new tl(h.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(s){return s==="visibility"?this.visibility:this._unevaluatedLayout.getValue(s)}setLayoutProperty(s,h,m={}){h!=null&&this._validate(Qd,`layers.${this.id}.layout.${s}`,s,h,m)||(s!=="visibility"?this._unevaluatedLayout.setValue(s,h):this.visibility=h)}getPaintProperty(s){return s.endsWith(dc)?this._transitionablePaint.getTransition(s.slice(0,-11)):this._transitionablePaint.getValue(s)}setPaintProperty(s,h,m={}){if(h!=null&&this._validate(uc,`layers.${this.id}.paint.${s}`,s,h,m))return!1;if(s.endsWith(dc))return this._transitionablePaint.setTransition(s.slice(0,-11),h||void 0),!1;{const v=this._transitionablePaint._values[s],S=v.property.specification["property-type"]==="cross-faded-data-driven",T=v.value.isDataDriven(),L=v.value;this._transitionablePaint.setValue(s,h),this._handleSpecialPaintPropertyUpdate(s);const R=this._transitionablePaint._values[s].value;return R.isDataDriven()||T||S||this._handleOverridablePaintPropertyUpdate(s,L,R)}}_handleSpecialPaintPropertyUpdate(s){}_handleOverridablePaintPropertyUpdate(s,h,m){return!1}isHidden(s){return!!(this.minzoom&&s<this.minzoom)||!!(this.maxzoom&&s>=this.maxzoom)||this.visibility==="none"}updateTransitions(s){this._transitioningPaint=this._transitionablePaint.transitioned(s,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(s,h){s.getCrossfadeParameters&&(this._crossfadeParameters=s.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(s,void 0,h)),this.paint=this._transitioningPaint.possiblyEvaluate(s,void 0,h)}serialize(){const s={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(s.layout=s.layout||{},s.layout.visibility=this.visibility),Ae(s,(h,m)=>!(h===void 0||m==="layout"&&!Object.keys(h).length||m==="paint"&&!Object.keys(h).length))}_validate(s,h,m,v,S={}){return(!S||S.validate!==!1)&&ha(this,s.call(Bs,{key:h,layerType:this.type,objectKey:m,value:v,styleSpec:ye,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const s in this.paint._values){const h=this.paint.get(s);if(h instanceof To&&la(h.property.specification)&&(h.value.kind==="source"||h.value.kind==="composite")&&h.value.isStateDependent)return!0}return!1}}const _f={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class rl{constructor(s,h){this._structArray=s,this._pos1=h*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Fr{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(s,h){return s._trim(),h&&(s.isTransferred=!0,h.push(s.arrayBuffer)),{length:s.length,arrayBuffer:s.arrayBuffer}}static deserialize(s){const h=Object.create(this.prototype);return h.arrayBuffer=s.arrayBuffer,h.length=s.length,h.capacity=s.arrayBuffer.byteLength/h.bytesPerElement,h._refreshViews(),h}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(s){this.reserve(s),this.length=s}reserve(s){if(s>this.capacity){this.capacity=Math.max(s,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const h=this.uint8;this._refreshViews(),h&&this.uint8.set(h)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Zr(c,s=1){let h=0,m=0;return{members:c.map(v=>{const S=_f[v.type].BYTES_PER_ELEMENT,T=h=yf(h,Math.max(s,S)),L=v.components||1;return m=Math.max(m,S),h+=S*L,{name:v.name,type:v.type,components:L,offset:T}}),size:yf(h,Math.max(m,s)),alignment:s}}function yf(c,s){return Math.ceil(c/s)*s}class il extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,h){const m=this.length;return this.resize(m+1),this.emplace(m,s,h)}emplace(s,h,m){const v=2*s;return this.int16[v+0]=h,this.int16[v+1]=m,s}}il.prototype.bytesPerElement=4,Gt("StructArrayLayout2i4",il);class os extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,h,m){const v=this.length;return this.resize(v+1),this.emplace(v,s,h,m)}emplace(s,h,m,v){const S=3*s;return this.int16[S+0]=h,this.int16[S+1]=m,this.int16[S+2]=v,s}}os.prototype.bytesPerElement=6,Gt("StructArrayLayout3i6",os);class pc extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,h,m,v){const S=this.length;return this.resize(S+1),this.emplace(S,s,h,m,v)}emplace(s,h,m,v,S){const T=4*s;return this.int16[T+0]=h,this.int16[T+1]=m,this.int16[T+2]=v,this.int16[T+3]=S,s}}pc.prototype.bytesPerElement=8,Gt("StructArrayLayout4i8",pc);class mc extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,h,m,v,S,T){const L=this.length;return this.resize(L+1),this.emplace(L,s,h,m,v,S,T)}emplace(s,h,m,v,S,T,L){const R=6*s;return this.int16[R+0]=h,this.int16[R+1]=m,this.int16[R+2]=v,this.int16[R+3]=S,this.int16[R+4]=T,this.int16[R+5]=L,s}}mc.prototype.bytesPerElement=12,Gt("StructArrayLayout2i4i12",mc);class gc extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,h,m,v,S,T){const L=this.length;return this.resize(L+1),this.emplace(L,s,h,m,v,S,T)}emplace(s,h,m,v,S,T,L){const R=4*s,O=8*s;return this.int16[R+0]=h,this.int16[R+1]=m,this.uint8[O+4]=v,this.uint8[O+5]=S,this.uint8[O+6]=T,this.uint8[O+7]=L,s}}gc.prototype.bytesPerElement=8,Gt("StructArrayLayout2i4ub8",gc);class ol extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,h){const m=this.length;return this.resize(m+1),this.emplace(m,s,h)}emplace(s,h,m){const v=2*s;return this.float32[v+0]=h,this.float32[v+1]=m,s}}ol.prototype.bytesPerElement=8,Gt("StructArrayLayout2f8",ol);class nu extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,h,m,v,S,T,L,R,O,H){const X=this.length;return this.resize(X+1),this.emplace(X,s,h,m,v,S,T,L,R,O,H)}emplace(s,h,m,v,S,T,L,R,O,H,X){const oe=10*s;return this.uint16[oe+0]=h,this.uint16[oe+1]=m,this.uint16[oe+2]=v,this.uint16[oe+3]=S,this.uint16[oe+4]=T,this.uint16[oe+5]=L,this.uint16[oe+6]=R,this.uint16[oe+7]=O,this.uint16[oe+8]=H,this.uint16[oe+9]=X,s}}nu.prototype.bytesPerElement=20,Gt("StructArrayLayout10ui20",nu);class _c extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,h,m,v,S,T,L,R,O,H,X,oe){const de=this.length;return this.resize(de+1),this.emplace(de,s,h,m,v,S,T,L,R,O,H,X,oe)}emplace(s,h,m,v,S,T,L,R,O,H,X,oe,de){const ge=12*s;return this.int16[ge+0]=h,this.int16[ge+1]=m,this.int16[ge+2]=v,this.int16[ge+3]=S,this.uint16[ge+4]=T,this.uint16[ge+5]=L,this.uint16[ge+6]=R,this.uint16[ge+7]=O,this.int16[ge+8]=H,this.int16[ge+9]=X,this.int16[ge+10]=oe,this.int16[ge+11]=de,s}}_c.prototype.bytesPerElement=24,Gt("StructArrayLayout4i4ui4i24",_c);class yc extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,h,m){const v=this.length;return this.resize(v+1),this.emplace(v,s,h,m)}emplace(s,h,m,v){const S=3*s;return this.float32[S+0]=h,this.float32[S+1]=m,this.float32[S+2]=v,s}}yc.prototype.bytesPerElement=12,Gt("StructArrayLayout3f12",yc);class ss extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(s){const h=this.length;return this.resize(h+1),this.emplace(h,s)}emplace(s,h){return this.uint32[1*s+0]=h,s}}ss.prototype.bytesPerElement=4,Gt("StructArrayLayout1ul4",ss);class ru extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,h,m,v,S,T,L,R,O){const H=this.length;return this.resize(H+1),this.emplace(H,s,h,m,v,S,T,L,R,O)}emplace(s,h,m,v,S,T,L,R,O,H){const X=10*s,oe=5*s;return this.int16[X+0]=h,this.int16[X+1]=m,this.int16[X+2]=v,this.int16[X+3]=S,this.int16[X+4]=T,this.int16[X+5]=L,this.uint32[oe+3]=R,this.uint16[X+8]=O,this.uint16[X+9]=H,s}}ru.prototype.bytesPerElement=20,Gt("StructArrayLayout6i1ul2ui20",ru);class sl extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,h,m,v,S,T){const L=this.length;return this.resize(L+1),this.emplace(L,s,h,m,v,S,T)}emplace(s,h,m,v,S,T,L){const R=6*s;return this.int16[R+0]=h,this.int16[R+1]=m,this.int16[R+2]=v,this.int16[R+3]=S,this.int16[R+4]=T,this.int16[R+5]=L,s}}sl.prototype.bytesPerElement=12,Gt("StructArrayLayout2i2i2i12",sl);class iu extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,h,m,v,S){const T=this.length;return this.resize(T+1),this.emplace(T,s,h,m,v,S)}emplace(s,h,m,v,S,T){const L=4*s,R=8*s;return this.float32[L+0]=h,this.float32[L+1]=m,this.float32[L+2]=v,this.int16[R+6]=S,this.int16[R+7]=T,s}}iu.prototype.bytesPerElement=16,Gt("StructArrayLayout2f1f2i16",iu);class al extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,h,m,v){const S=this.length;return this.resize(S+1),this.emplace(S,s,h,m,v)}emplace(s,h,m,v,S){const T=12*s,L=3*s;return this.uint8[T+0]=h,this.uint8[T+1]=m,this.float32[L+1]=v,this.float32[L+2]=S,s}}al.prototype.bytesPerElement=12,Gt("StructArrayLayout2ub2f12",al);class ou extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,h,m){const v=this.length;return this.resize(v+1),this.emplace(v,s,h,m)}emplace(s,h,m,v){const S=3*s;return this.uint16[S+0]=h,this.uint16[S+1]=m,this.uint16[S+2]=v,s}}ou.prototype.bytesPerElement=6,Gt("StructArrayLayout3ui6",ou);class ma extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,h,m,v,S,T,L,R,O,H,X,oe,de,ge,ve,Me,Pe){const He=this.length;return this.resize(He+1),this.emplace(He,s,h,m,v,S,T,L,R,O,H,X,oe,de,ge,ve,Me,Pe)}emplace(s,h,m,v,S,T,L,R,O,H,X,oe,de,ge,ve,Me,Pe,He){const ze=24*s,Ne=12*s,ct=48*s;return this.int16[ze+0]=h,this.int16[ze+1]=m,this.uint16[ze+2]=v,this.uint16[ze+3]=S,this.uint32[Ne+2]=T,this.uint32[Ne+3]=L,this.uint32[Ne+4]=R,this.uint16[ze+10]=O,this.uint16[ze+11]=H,this.uint16[ze+12]=X,this.float32[Ne+7]=oe,this.float32[Ne+8]=de,this.uint8[ct+36]=ge,this.uint8[ct+37]=ve,this.uint8[ct+38]=Me,this.uint32[Ne+10]=Pe,this.int16[ze+22]=He,s}}ma.prototype.bytesPerElement=48,Gt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",ma);class $s extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,h,m,v,S,T,L,R,O,H,X,oe,de,ge,ve,Me,Pe,He,ze,Ne,ct,ft,Zt,Yt,Vt,Nt,Dt,Ht){const Ot=this.length;return this.resize(Ot+1),this.emplace(Ot,s,h,m,v,S,T,L,R,O,H,X,oe,de,ge,ve,Me,Pe,He,ze,Ne,ct,ft,Zt,Yt,Vt,Nt,Dt,Ht)}emplace(s,h,m,v,S,T,L,R,O,H,X,oe,de,ge,ve,Me,Pe,He,ze,Ne,ct,ft,Zt,Yt,Vt,Nt,Dt,Ht,Ot){const Ct=32*s,sn=16*s;return this.int16[Ct+0]=h,this.int16[Ct+1]=m,this.int16[Ct+2]=v,this.int16[Ct+3]=S,this.int16[Ct+4]=T,this.int16[Ct+5]=L,this.int16[Ct+6]=R,this.int16[Ct+7]=O,this.uint16[Ct+8]=H,this.uint16[Ct+9]=X,this.uint16[Ct+10]=oe,this.uint16[Ct+11]=de,this.uint16[Ct+12]=ge,this.uint16[Ct+13]=ve,this.uint16[Ct+14]=Me,this.uint16[Ct+15]=Pe,this.uint16[Ct+16]=He,this.uint16[Ct+17]=ze,this.uint16[Ct+18]=Ne,this.uint16[Ct+19]=ct,this.uint16[Ct+20]=ft,this.uint16[Ct+21]=Zt,this.uint16[Ct+22]=Yt,this.uint32[sn+12]=Vt,this.float32[sn+13]=Nt,this.float32[sn+14]=Dt,this.uint16[Ct+30]=Ht,this.uint16[Ct+31]=Ot,s}}$s.prototype.bytesPerElement=64,Gt("StructArrayLayout8i15ui1ul2f2ui64",$s);class su extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s){const h=this.length;return this.resize(h+1),this.emplace(h,s)}emplace(s,h){return this.float32[1*s+0]=h,s}}su.prototype.bytesPerElement=4,Gt("StructArrayLayout1f4",su);class au extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,h,m){const v=this.length;return this.resize(v+1),this.emplace(v,s,h,m)}emplace(s,h,m,v){const S=3*s;return this.uint16[6*s+0]=h,this.float32[S+1]=m,this.float32[S+2]=v,s}}au.prototype.bytesPerElement=12,Gt("StructArrayLayout1ui2f12",au);class Os extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,h,m){const v=this.length;return this.resize(v+1),this.emplace(v,s,h,m)}emplace(s,h,m,v){const S=4*s;return this.uint32[2*s+0]=h,this.uint16[S+2]=m,this.uint16[S+3]=v,s}}Os.prototype.bytesPerElement=8,Gt("StructArrayLayout1ul2ui8",Os);class bc extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,h){const m=this.length;return this.resize(m+1),this.emplace(m,s,h)}emplace(s,h,m){const v=2*s;return this.uint16[v+0]=h,this.uint16[v+1]=m,s}}bc.prototype.bytesPerElement=4,Gt("StructArrayLayout2ui4",bc);class vc extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s){const h=this.length;return this.resize(h+1),this.emplace(h,s)}emplace(s,h){return this.uint16[1*s+0]=h,s}}vc.prototype.bytesPerElement=2,Gt("StructArrayLayout1ui2",vc);class lu extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,h,m,v){const S=this.length;return this.resize(S+1),this.emplace(S,s,h,m,v)}emplace(s,h,m,v,S){const T=4*s;return this.float32[T+0]=h,this.float32[T+1]=m,this.float32[T+2]=v,this.float32[T+3]=S,s}}lu.prototype.bytesPerElement=16,Gt("StructArrayLayout4f16",lu);class bf extends rl{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new y(this.anchorPointX,this.anchorPointY)}}bf.prototype.size=20;class w extends ru{get(s){return new bf(this,s)}}Gt("CollisionBoxArray",w);class l extends rl{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(s){this._structArray.uint8[this._pos1+37]=s}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(s){this._structArray.uint8[this._pos1+38]=s}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(s){this._structArray.uint32[this._pos4+10]=s}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}l.prototype.size=48;class f extends ma{get(s){return new l(this,s)}}Gt("PlacedSymbolArray",f);class _ extends rl{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(s){this._structArray.uint32[this._pos4+12]=s}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}_.prototype.size=64;class b extends $s{get(s){return new _(this,s)}}Gt("SymbolInstanceArray",b);class k extends su{getoffsetX(s){return this.float32[1*s+0]}}Gt("GlyphOffsetArray",k);class I extends os{getx(s){return this.int16[3*s+0]}gety(s){return this.int16[3*s+1]}gettileUnitDistanceFromAnchor(s){return this.int16[3*s+2]}}Gt("SymbolLineVertexArray",I);class A extends rl{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}A.prototype.size=12;class B extends au{get(s){return new A(this,s)}}Gt("TextAnchorOffsetArray",B);class G extends rl{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}G.prototype.size=8;class Y extends Os{get(s){return new G(this,s)}}Gt("FeatureIndexArray",Y);class te extends il{}class me extends il{}class Te extends il{}class ke extends mc{}class Le extends gc{}class be extends ol{}class Re extends nu{}class et extends _c{}class Ie extends yc{}class Ve extends ss{}class nt extends sl{}class rt extends al{}class at extends ou{}class yt extends bc{}const mt=Zr([{name:"a_pos",components:2,type:"Int16"}],4),{members:zt}=mt;class Rt{constructor(s=[]){this.segments=s}prepareSegment(s,h,m,v){let S=this.segments[this.segments.length-1];return s>Rt.MAX_VERTEX_ARRAY_LENGTH&&Ce(`Max vertices per segment is ${Rt.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${s}`),(!S||S.vertexLength+s>Rt.MAX_VERTEX_ARRAY_LENGTH||S.sortKey!==v)&&(S={vertexOffset:h.length,primitiveOffset:m.length,vertexLength:0,primitiveLength:0},v!==void 0&&(S.sortKey=v),this.segments.push(S)),S}get(){return this.segments}destroy(){for(const s of this.segments)for(const h in s.vaos)s.vaos[h].destroy()}static simpleSegment(s,h,m,v){return new Rt([{vertexOffset:s,primitiveOffset:h,vertexLength:m,primitiveLength:v,vaos:{},sortKey:0}])}}function wn(c,s){return 256*(c=K(Math.floor(c),0,255))+K(Math.floor(s),0,255)}Rt.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Gt("SegmentVector",Rt);const $t=Zr([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var hn={exports:{}},xn={exports:{}};xn.exports=function(c,s){var h,m,v,S,T,L,R,O;for(m=c.length-(h=3&c.length),v=s,T=3432918353,L=461845907,O=0;O<m;)R=255&c.charCodeAt(O)|(255&c.charCodeAt(++O))<<8|(255&c.charCodeAt(++O))<<16|(255&c.charCodeAt(++O))<<24,++O,v=27492+(65535&(S=5*(65535&(v=(v^=R=(65535&(R=(R=(65535&R)*T+(((R>>>16)*T&65535)<<16)&4294967295)<<15|R>>>17))*L+(((R>>>16)*L&65535)<<16)&4294967295)<<13|v>>>19))+((5*(v>>>16)&65535)<<16)&4294967295))+((58964+(S>>>16)&65535)<<16);switch(R=0,h){case 3:R^=(255&c.charCodeAt(O+2))<<16;case 2:R^=(255&c.charCodeAt(O+1))<<8;case 1:v^=R=(65535&(R=(R=(65535&(R^=255&c.charCodeAt(O)))*T+(((R>>>16)*T&65535)<<16)&4294967295)<<15|R>>>17))*L+(((R>>>16)*L&65535)<<16)&4294967295}return v^=c.length,v=2246822507*(65535&(v^=v>>>16))+((2246822507*(v>>>16)&65535)<<16)&4294967295,v=3266489909*(65535&(v^=v>>>13))+((3266489909*(v>>>16)&65535)<<16)&4294967295,(v^=v>>>16)>>>0};var On=xn.exports,bn={exports:{}};bn.exports=function(c,s){for(var h,m=c.length,v=s^m,S=0;m>=4;)h=1540483477*(65535&(h=255&c.charCodeAt(S)|(255&c.charCodeAt(++S))<<8|(255&c.charCodeAt(++S))<<16|(255&c.charCodeAt(++S))<<24))+((1540483477*(h>>>16)&65535)<<16),v=1540483477*(65535&v)+((1540483477*(v>>>16)&65535)<<16)^(h=1540483477*(65535&(h^=h>>>24))+((1540483477*(h>>>16)&65535)<<16)),m-=4,++S;switch(m){case 3:v^=(255&c.charCodeAt(S+2))<<16;case 2:v^=(255&c.charCodeAt(S+1))<<8;case 1:v=1540483477*(65535&(v^=255&c.charCodeAt(S)))+((1540483477*(v>>>16)&65535)<<16)}return v=1540483477*(65535&(v^=v>>>13))+((1540483477*(v>>>16)&65535)<<16),(v^=v>>>15)>>>0};var Cn=On,zn=bn.exports;hn.exports=Cn,hn.exports.murmur3=Cn,hn.exports.murmur2=zn;var Br=d(hn.exports);class rr{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(s,h,m,v){this.ids.push(to(s)),this.positions.push(h,m,v)}getPositions(s){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const h=to(s);let m=0,v=this.ids.length-1;for(;m<v;){const T=m+v>>1;this.ids[T]>=h?v=T:m=T+1}const S=[];for(;this.ids[m]===h;)S.push({index:this.positions[3*m],start:this.positions[3*m+1],end:this.positions[3*m+2]}),m++;return S}static serialize(s,h){const m=new Float64Array(s.ids),v=new Uint32Array(s.positions);return ii(m,v,0,m.length-1),h&&h.push(m.buffer,v.buffer),{ids:m,positions:v}}static deserialize(s){const h=new rr;return h.ids=s.ids,h.positions=s.positions,h.indexed=!0,h}}function to(c){const s=+c;return!isNaN(s)&&s<=Number.MAX_SAFE_INTEGER?s:Br(String(c))}function ii(c,s,h,m){for(;h<m;){const v=c[h+m>>1];let S=h-1,T=m+1;for(;;){do S++;while(c[S]<v);do T--;while(c[T]>v);if(S>=T)break;Er(c,S,T),Er(s,3*S,3*T),Er(s,3*S+1,3*T+1),Er(s,3*S+2,3*T+2)}T-h<m-T?(ii(c,s,h,T),h=T+1):(ii(c,s,T+1,m),m=T)}}function Er(c,s,h){const m=c[s];c[s]=c[h],c[h]=m}Gt("FeaturePositionMap",rr);class oi{constructor(s,h){this.gl=s.gl,this.location=h}}class no extends oi{constructor(s,h){super(s,h),this.current=0}set(s){this.current!==s&&(this.current=s,this.gl.uniform1f(this.location,s))}}class Go extends oi{constructor(s,h){super(s,h),this.current=[0,0,0,0]}set(s){s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]&&s[3]===this.current[3]||(this.current=s,this.gl.uniform4f(this.location,s[0],s[1],s[2],s[3]))}}class ks extends oi{constructor(s,h){super(s,h),this.current=tr.transparent}set(s){s.r===this.current.r&&s.g===this.current.g&&s.b===this.current.b&&s.a===this.current.a||(this.current=s,this.gl.uniform4f(this.location,s.r,s.g,s.b,s.a))}}const ll=new Float32Array(16);function Ss(c){return[wn(255*c.r,255*c.g),wn(255*c.b,255*c.a)]}class Ho{constructor(s,h,m){this.value=s,this.uniformNames=h.map(v=>`u_${v}`),this.type=m}setUniform(s,h,m){s.set(m.constantOr(this.value))}getBinding(s,h,m){return this.type==="color"?new ks(s,h):new no(s,h)}}class Kr{constructor(s,h){this.uniformNames=h.map(m=>`u_${m}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(s,h){this.pixelRatioFrom=h.pixelRatio,this.pixelRatioTo=s.pixelRatio,this.patternFrom=h.tlbr,this.patternTo=s.tlbr}setUniform(s,h,m,v){const S=v==="u_pattern_to"?this.patternTo:v==="u_pattern_from"?this.patternFrom:v==="u_pixel_ratio_to"?this.pixelRatioTo:v==="u_pixel_ratio_from"?this.pixelRatioFrom:null;S&&s.set(S)}getBinding(s,h,m){return m.substr(0,9)==="u_pattern"?new Go(s,h):new no(s,h)}}class Ir{constructor(s,h,m,v){this.expression=s,this.type=m,this.maxValue=0,this.paintVertexAttributes=h.map(S=>({name:`a_${S}`,type:"Float32",components:m==="color"?2:1,offset:0})),this.paintVertexArray=new v}populatePaintArray(s,h,m,v,S){const T=this.paintVertexArray.length,L=this.expression.evaluate(new kr(0),h,{},v,[],S);this.paintVertexArray.resize(s),this._setPaintValue(T,s,L)}updatePaintArray(s,h,m,v){const S=this.expression.evaluate({zoom:0},m,v);this._setPaintValue(s,h,S)}_setPaintValue(s,h,m){if(this.type==="color"){const v=Ss(m);for(let S=s;S<h;S++)this.paintVertexArray.emplace(S,v[0],v[1])}else{for(let v=s;v<h;v++)this.paintVertexArray.emplace(v,m);this.maxValue=Math.max(this.maxValue,Math.abs(m))}}upload(s){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=s.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Sr{constructor(s,h,m,v,S,T){this.expression=s,this.uniformNames=h.map(L=>`u_${L}_t`),this.type=m,this.useIntegerZoom=v,this.zoom=S,this.maxValue=0,this.paintVertexAttributes=h.map(L=>({name:`a_${L}`,type:"Float32",components:m==="color"?4:2,offset:0})),this.paintVertexArray=new T}populatePaintArray(s,h,m,v,S){const T=this.expression.evaluate(new kr(this.zoom),h,{},v,[],S),L=this.expression.evaluate(new kr(this.zoom+1),h,{},v,[],S),R=this.paintVertexArray.length;this.paintVertexArray.resize(s),this._setPaintValue(R,s,T,L)}updatePaintArray(s,h,m,v){const S=this.expression.evaluate({zoom:this.zoom},m,v),T=this.expression.evaluate({zoom:this.zoom+1},m,v);this._setPaintValue(s,h,S,T)}_setPaintValue(s,h,m,v){if(this.type==="color"){const S=Ss(m),T=Ss(v);for(let L=s;L<h;L++)this.paintVertexArray.emplace(L,S[0],S[1],T[0],T[1])}else{for(let S=s;S<h;S++)this.paintVertexArray.emplace(S,m,v);this.maxValue=Math.max(this.maxValue,Math.abs(m),Math.abs(v))}}upload(s){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=s.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(s,h){const m=this.useIntegerZoom?Math.floor(h.zoom):h.zoom,v=K(this.expression.interpolationFactor(m,this.zoom,this.zoom+1),0,1);s.set(v)}getBinding(s,h,m){return new no(s,h)}}class po{constructor(s,h,m,v,S,T){this.expression=s,this.type=h,this.useIntegerZoom=m,this.zoom=v,this.layerId=T,this.zoomInPaintVertexArray=new S,this.zoomOutPaintVertexArray=new S}populatePaintArray(s,h,m){const v=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(s),this.zoomOutPaintVertexArray.resize(s),this._setPaintValues(v,s,h.patterns&&h.patterns[this.layerId],m)}updatePaintArray(s,h,m,v,S){this._setPaintValues(s,h,m.patterns&&m.patterns[this.layerId],S)}_setPaintValues(s,h,m,v){if(!v||!m)return;const{min:S,mid:T,max:L}=m,R=v[S],O=v[T],H=v[L];if(R&&O&&H)for(let X=s;X<h;X++)this.zoomInPaintVertexArray.emplace(X,O.tl[0],O.tl[1],O.br[0],O.br[1],R.tl[0],R.tl[1],R.br[0],R.br[1],O.pixelRatio,R.pixelRatio),this.zoomOutPaintVertexArray.emplace(X,O.tl[0],O.tl[1],O.br[0],O.br[1],H.tl[0],H.tl[1],H.br[0],H.br[1],O.pixelRatio,H.pixelRatio)}upload(s){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=s.createVertexBuffer(this.zoomInPaintVertexArray,$t.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=s.createVertexBuffer(this.zoomOutPaintVertexArray,$t.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Xr{constructor(s,h,m){this.binders={},this._buffers=[];const v=[];for(const S in s.paint._values){if(!m(S))continue;const T=s.paint.get(S);if(!(T instanceof To&&la(T.property.specification)))continue;const L=mo(S,s.type),R=T.value,O=T.property.specification.type,H=T.property.useIntegerZoom,X=T.property.specification["property-type"],oe=X==="cross-faded"||X==="cross-faded-data-driven";if(R.kind==="constant")this.binders[S]=oe?new Kr(R.value,L):new Ho(R.value,L,O),v.push(`/u_${S}`);else if(R.kind==="source"||oe){const de=Jr(S,O,"source");this.binders[S]=oe?new po(R,O,H,h,de,s.id):new Ir(R,L,O,de),v.push(`/a_${S}`)}else{const de=Jr(S,O,"composite");this.binders[S]=new Sr(R,L,O,H,h,de),v.push(`/z_${S}`)}}this.cacheKey=v.sort().join("")}getMaxValue(s){const h=this.binders[s];return h instanceof Ir||h instanceof Sr?h.maxValue:0}populatePaintArrays(s,h,m,v,S){for(const T in this.binders){const L=this.binders[T];(L instanceof Ir||L instanceof Sr||L instanceof po)&&L.populatePaintArray(s,h,m,v,S)}}setConstantPatternPositions(s,h){for(const m in this.binders){const v=this.binders[m];v instanceof Kr&&v.setConstantPatternPositions(s,h)}}updatePaintArrays(s,h,m,v,S){let T=!1;for(const L in s){const R=h.getPositions(L);for(const O of R){const H=m.feature(O.index);for(const X in this.binders){const oe=this.binders[X];if((oe instanceof Ir||oe instanceof Sr||oe instanceof po)&&oe.expression.isStateDependent===!0){const de=v.paint.get(X);oe.expression=de.value,oe.updatePaintArray(O.start,O.end,H,s[L],S),T=!0}}}}return T}defines(){const s=[];for(const h in this.binders){const m=this.binders[h];(m instanceof Ho||m instanceof Kr)&&s.push(...m.uniformNames.map(v=>`#define HAS_UNIFORM_${v}`))}return s}getBinderAttributes(){const s=[];for(const h in this.binders){const m=this.binders[h];if(m instanceof Ir||m instanceof Sr)for(let v=0;v<m.paintVertexAttributes.length;v++)s.push(m.paintVertexAttributes[v].name);else if(m instanceof po)for(let v=0;v<$t.members.length;v++)s.push($t.members[v].name)}return s}getBinderUniforms(){const s=[];for(const h in this.binders){const m=this.binders[h];if(m instanceof Ho||m instanceof Kr||m instanceof Sr)for(const v of m.uniformNames)s.push(v)}return s}getPaintVertexBuffers(){return this._buffers}getUniforms(s,h){const m=[];for(const v in this.binders){const S=this.binders[v];if(S instanceof Ho||S instanceof Kr||S instanceof Sr){for(const T of S.uniformNames)if(h[T]){const L=S.getBinding(s,h[T],T);m.push({name:T,property:v,binding:L})}}}return m}setUniforms(s,h,m,v){for(const{name:S,property:T,binding:L}of h)this.binders[T].setUniform(L,v,m.get(T),S)}updatePaintBuffers(s){this._buffers=[];for(const h in this.binders){const m=this.binders[h];if(s&&m instanceof po){const v=s.fromScale===2?m.zoomInPaintVertexBuffer:m.zoomOutPaintVertexBuffer;v&&this._buffers.push(v)}else(m instanceof Ir||m instanceof Sr)&&m.paintVertexBuffer&&this._buffers.push(m.paintVertexBuffer)}}upload(s){for(const h in this.binders){const m=this.binders[h];(m instanceof Ir||m instanceof Sr||m instanceof po)&&m.upload(s)}this.updatePaintBuffers()}destroy(){for(const s in this.binders){const h=this.binders[s];(h instanceof Ir||h instanceof Sr||h instanceof po)&&h.destroy()}}}class Ar{constructor(s,h,m=()=>!0){this.programConfigurations={};for(const v of s)this.programConfigurations[v.id]=new Xr(v,h,m);this.needsUpload=!1,this._featureMap=new rr,this._bufferOffset=0}populatePaintArrays(s,h,m,v,S,T){for(const L in this.programConfigurations)this.programConfigurations[L].populatePaintArrays(s,h,v,S,T);h.id!==void 0&&this._featureMap.add(h.id,m,this._bufferOffset,s),this._bufferOffset=s,this.needsUpload=!0}updatePaintArrays(s,h,m,v){for(const S of m)this.needsUpload=this.programConfigurations[S.id].updatePaintArrays(s,this._featureMap,h,S,v)||this.needsUpload}get(s){return this.programConfigurations[s]}upload(s){if(this.needsUpload){for(const h in this.programConfigurations)this.programConfigurations[h].upload(s);this.needsUpload=!1}}destroy(){for(const s in this.programConfigurations)this.programConfigurations[s].destroy()}}function mo(c,s){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[c]||[c.replace(`${s}-`,"").replace(/-/g,"_")]}function Jr(c,s,h){const m={color:{source:ol,composite:lu},number:{source:su,composite:ol}},v=function(S){return{"line-pattern":{source:Re,composite:Re},"fill-pattern":{source:Re,composite:Re},"fill-extrusion-pattern":{source:Re,composite:Re}}[S]}(c);return v&&v[h]||m[s][h]}Gt("ConstantBinder",Ho),Gt("CrossFadedConstantBinder",Kr),Gt("SourceExpressionBinder",Ir),Gt("CrossFadedCompositeBinder",po),Gt("CompositeExpressionBinder",Sr),Gt("ProgramConfiguration",Xr,{omit:["_buffers"]}),Gt("ProgramConfigurationSet",Ar);const Ur=8192,wc=Math.pow(2,14)-1,vf=-wc-1;function Ns(c){const s=Ur/c.extent,h=c.loadGeometry();for(let m=0;m<h.length;m++){const v=h[m];for(let S=0;S<v.length;S++){const T=v[S],L=Math.round(T.x*s),R=Math.round(T.y*s);T.x=K(L,vf,wc),T.y=K(R,vf,wc),(L<T.x||L>T.x+1||R<T.y||R>T.y+1)&&Ce("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return h}function js(c,s){return{type:c.type,id:c.id,properties:c.properties,geometry:s?Ns(c):[]}}function uu(c,s,h,m,v){c.emplaceBack(2*s+(m+1)/2,2*h+(v+1)/2)}class Ts{constructor(s){this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(h=>h.id),this.index=s.index,this.hasPattern=!1,this.layoutVertexArray=new me,this.indexArray=new at,this.segments=new Rt,this.programConfigurations=new Ar(s.layers,s.zoom),this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id)}populate(s,h,m){const v=this.layers[0],S=[];let T=null,L=!1;v.type==="circle"&&(T=v.layout.get("circle-sort-key"),L=!T.isConstant());for(const{feature:R,id:O,index:H,sourceLayerIndex:X}of s){const oe=this.layers[0]._featureFilter.needGeometry,de=js(R,oe);if(!this.layers[0]._featureFilter.filter(new kr(this.zoom),de,m))continue;const ge=L?T.evaluate(de,{},m):void 0,ve={id:O,properties:R.properties,type:R.type,sourceLayerIndex:X,index:H,geometry:oe?de.geometry:Ns(R),patterns:{},sortKey:ge};S.push(ve)}L&&S.sort((R,O)=>R.sortKey-O.sortKey);for(const R of S){const{geometry:O,index:H,sourceLayerIndex:X}=R,oe=s[H].feature;this.addFeature(R,O,H,m),h.featureIndex.insert(oe,O,H,X,this.index)}}update(s,h,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(s,h,this.stateDependentLayers,m)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(s){this.uploaded||(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,zt),this.indexBuffer=s.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(s),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(s,h,m,v){for(const S of h)for(const T of S){const L=T.x,R=T.y;if(L<0||L>=Ur||R<0||R>=Ur)continue;const O=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,s.sortKey),H=O.vertexLength;uu(this.layoutVertexArray,L,R,-1,-1),uu(this.layoutVertexArray,L,R,1,-1),uu(this.layoutVertexArray,L,R,1,1),uu(this.layoutVertexArray,L,R,-1,1),this.indexArray.emplaceBack(H,H+1,H+2),this.indexArray.emplaceBack(H,H+3,H+2),O.vertexLength+=4,O.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,m,{},v)}}function xc(c,s){for(let h=0;h<c.length;h++)if(hu(s,c[h]))return!0;for(let h=0;h<s.length;h++)if(hu(c,s[h]))return!0;return!!cu(c,s)}function wf(c,s,h){return!!hu(c,s)||!!tp(s,c,h)}function kc(c,s){if(c.length===1)return fg(s,c[0]);for(let h=0;h<s.length;h++){const m=s[h];for(let v=0;v<m.length;v++)if(hu(c,m[v]))return!0}for(let h=0;h<c.length;h++)if(fg(s,c[h]))return!0;for(let h=0;h<s.length;h++)if(cu(c,s[h]))return!0;return!1}function Sc(c,s,h){if(c.length>1){if(cu(c,s))return!0;for(let m=0;m<s.length;m++)if(tp(s[m],c,h))return!0}for(let m=0;m<c.length;m++)if(tp(c[m],s,h))return!0;return!1}function cu(c,s){if(c.length===0||s.length===0)return!1;for(let h=0;h<c.length-1;h++){const m=c[h],v=c[h+1];for(let S=0;S<s.length-1;S++)if(Tc(m,v,s[S],s[S+1]))return!0}return!1}function Tc(c,s,h,m){return _e(c,h,m)!==_e(s,h,m)&&_e(c,s,h)!==_e(c,s,m)}function tp(c,s,h){const m=h*h;if(s.length===1)return c.distSqr(s[0])<m;for(let v=1;v<s.length;v++)if(hg(c,s[v-1],s[v])<m)return!0;return!1}function hg(c,s,h){const m=s.distSqr(h);if(m===0)return c.distSqr(s);const v=((c.x-s.x)*(h.x-s.x)+(c.y-s.y)*(h.y-s.y))/m;return c.distSqr(v<0?s:v>1?h:h.sub(s)._mult(v)._add(s))}function fg(c,s){let h,m,v,S=!1;for(let T=0;T<c.length;T++){h=c[T];for(let L=0,R=h.length-1;L<h.length;R=L++)m=h[L],v=h[R],m.y>s.y!=v.y>s.y&&s.x<(v.x-m.x)*(s.y-m.y)/(v.y-m.y)+m.x&&(S=!S)}return S}function hu(c,s){let h=!1;for(let m=0,v=c.length-1;m<c.length;v=m++){const S=c[m],T=c[v];S.y>s.y!=T.y>s.y&&s.x<(T.x-S.x)*(s.y-S.y)/(T.y-S.y)+S.x&&(h=!h)}return h}function pw(c,s,h){const m=h[0],v=h[2];if(c.x<m.x&&s.x<m.x||c.x>v.x&&s.x>v.x||c.y<m.y&&s.y<m.y||c.y>v.y&&s.y>v.y)return!1;const S=_e(c,s,h[0]);return S!==_e(c,s,h[1])||S!==_e(c,s,h[2])||S!==_e(c,s,h[3])}function Cc(c,s,h){const m=s.paint.get(c).value;return m.kind==="constant"?m.value:h.programConfigurations.get(s.id).getMaxValue(c)}function xf(c){return Math.sqrt(c[0]*c[0]+c[1]*c[1])}function kf(c,s,h,m,v){if(!s[0]&&!s[1])return c;const S=y.convert(s)._mult(v);h==="viewport"&&S._rotate(-m);const T=[];for(let L=0;L<c.length;L++)T.push(c[L].sub(S));return T}let dg,pg;Gt("CircleBucket",Ts,{omit:["layers"]});var mw={get paint(){return pg=pg||new $i({"circle-radius":new ln(ye.paint_circle["circle-radius"]),"circle-color":new ln(ye.paint_circle["circle-color"]),"circle-blur":new ln(ye.paint_circle["circle-blur"]),"circle-opacity":new ln(ye.paint_circle["circle-opacity"]),"circle-translate":new tn(ye.paint_circle["circle-translate"]),"circle-translate-anchor":new tn(ye.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new tn(ye.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new tn(ye.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new ln(ye.paint_circle["circle-stroke-width"]),"circle-stroke-color":new ln(ye.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new ln(ye.paint_circle["circle-stroke-opacity"])})},get layout(){return dg=dg||new $i({"circle-sort-key":new ln(ye.layout_circle["circle-sort-key"])})}},Oi=1e-6,fu=typeof Float32Array<"u"?Float32Array:Array;function np(c){return c[0]=1,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=1,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=1,c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c}function mg(c,s,h){var m=s[0],v=s[1],S=s[2],T=s[3],L=s[4],R=s[5],O=s[6],H=s[7],X=s[8],oe=s[9],de=s[10],ge=s[11],ve=s[12],Me=s[13],Pe=s[14],He=s[15],ze=h[0],Ne=h[1],ct=h[2],ft=h[3];return c[0]=ze*m+Ne*L+ct*X+ft*ve,c[1]=ze*v+Ne*R+ct*oe+ft*Me,c[2]=ze*S+Ne*O+ct*de+ft*Pe,c[3]=ze*T+Ne*H+ct*ge+ft*He,c[4]=(ze=h[4])*m+(Ne=h[5])*L+(ct=h[6])*X+(ft=h[7])*ve,c[5]=ze*v+Ne*R+ct*oe+ft*Me,c[6]=ze*S+Ne*O+ct*de+ft*Pe,c[7]=ze*T+Ne*H+ct*ge+ft*He,c[8]=(ze=h[8])*m+(Ne=h[9])*L+(ct=h[10])*X+(ft=h[11])*ve,c[9]=ze*v+Ne*R+ct*oe+ft*Me,c[10]=ze*S+Ne*O+ct*de+ft*Pe,c[11]=ze*T+Ne*H+ct*ge+ft*He,c[12]=(ze=h[12])*m+(Ne=h[13])*L+(ct=h[14])*X+(ft=h[15])*ve,c[13]=ze*v+Ne*R+ct*oe+ft*Me,c[14]=ze*S+Ne*O+ct*de+ft*Pe,c[15]=ze*T+Ne*H+ct*ge+ft*He,c}Math.hypot||(Math.hypot=function(){for(var c=0,s=arguments.length;s--;)c+=arguments[s]*arguments[s];return Math.sqrt(c)});var Mc,gw=mg;function Sf(c,s,h){var m=s[0],v=s[1],S=s[2],T=s[3];return c[0]=h[0]*m+h[4]*v+h[8]*S+h[12]*T,c[1]=h[1]*m+h[5]*v+h[9]*S+h[13]*T,c[2]=h[2]*m+h[6]*v+h[10]*S+h[14]*T,c[3]=h[3]*m+h[7]*v+h[11]*S+h[15]*T,c}Mc=new fu(4),fu!=Float32Array&&(Mc[0]=0,Mc[1]=0,Mc[2]=0,Mc[3]=0);class _w extends Co{constructor(s){super(s,mw)}createBucket(s){return new Ts(s)}queryRadius(s){const h=s;return Cc("circle-radius",this,h)+Cc("circle-stroke-width",this,h)+xf(this.paint.get("circle-translate"))}queryIntersectsFeature(s,h,m,v,S,T,L,R){const O=kf(s,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),T.angle,L),H=this.paint.get("circle-radius").evaluate(h,m)+this.paint.get("circle-stroke-width").evaluate(h,m),X=this.paint.get("circle-pitch-alignment")==="map",oe=X?O:function(ge,ve){return ge.map(Me=>gg(Me,ve))}(O,R),de=X?H*L:H;for(const ge of v)for(const ve of ge){const Me=X?ve:gg(ve,R);let Pe=de;const He=Sf([],[ve.x,ve.y,0,1],R);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Pe*=He[3]/T.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Pe*=T.cameraToCenterDistance/He[3]),wf(oe,Me,Pe))return!0}return!1}}function gg(c,s){const h=Sf([],[c.x,c.y,0,1],s);return new y(h[0]/h[3],h[1]/h[3])}class _g extends Ts{}let yg;Gt("HeatmapBucket",_g,{omit:["layers"]});var yw={get paint(){return yg=yg||new $i({"heatmap-radius":new ln(ye.paint_heatmap["heatmap-radius"]),"heatmap-weight":new ln(ye.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new tn(ye.paint_heatmap["heatmap-intensity"]),"heatmap-color":new fc(ye.paint_heatmap["heatmap-color"]),"heatmap-opacity":new tn(ye.paint_heatmap["heatmap-opacity"])})}};function rp(c,{width:s,height:h},m,v){if(v){if(v instanceof Uint8ClampedArray)v=new Uint8Array(v.buffer);else if(v.length!==s*h*m)throw new RangeError(`mismatched image size. expected: ${v.length} but got: ${s*h*m}`)}else v=new Uint8Array(s*h*m);return c.width=s,c.height=h,c.data=v,c}function bg(c,{width:s,height:h},m){if(s===c.width&&h===c.height)return;const v=rp({},{width:s,height:h},m);ip(c,v,{x:0,y:0},{x:0,y:0},{width:Math.min(c.width,s),height:Math.min(c.height,h)},m),c.width=s,c.height=h,c.data=v.data}function ip(c,s,h,m,v,S){if(v.width===0||v.height===0)return s;if(v.width>c.width||v.height>c.height||h.x>c.width-v.width||h.y>c.height-v.height)throw new RangeError("out of range source coordinates for image copy");if(v.width>s.width||v.height>s.height||m.x>s.width-v.width||m.y>s.height-v.height)throw new RangeError("out of range destination coordinates for image copy");const T=c.data,L=s.data;if(T===L)throw new Error("srcData equals dstData, so image is already copied");for(let R=0;R<v.height;R++){const O=((h.y+R)*c.width+h.x)*S,H=((m.y+R)*s.width+m.x)*S;for(let X=0;X<v.width*S;X++)L[H+X]=T[O+X]}return s}class Lc{constructor(s,h){rp(this,s,1,h)}resize(s){bg(this,s,1)}clone(){return new Lc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(s,h,m,v,S){ip(s,h,m,v,S,1)}}class Mo{constructor(s,h){rp(this,s,4,h)}resize(s){bg(this,s,4)}replace(s,h){h?this.data.set(s):this.data=s instanceof Uint8ClampedArray?new Uint8Array(s.buffer):s}clone(){return new Mo({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(s,h,m,v,S){ip(s,h,m,v,S,4)}}function vg(c){const s={},h=c.resolution||256,m=c.clips?c.clips.length:1,v=c.image||new Mo({width:h,height:m});if(Math.log(h)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${h}`);const S=(T,L,R)=>{s[c.evaluationKey]=R;const O=c.expression.evaluate(s);v.data[T+L+0]=Math.floor(255*O.r/O.a),v.data[T+L+1]=Math.floor(255*O.g/O.a),v.data[T+L+2]=Math.floor(255*O.b/O.a),v.data[T+L+3]=Math.floor(255*O.a)};if(c.clips)for(let T=0,L=0;T<m;++T,L+=4*h)for(let R=0,O=0;R<h;R++,O+=4){const H=R/(h-1),{start:X,end:oe}=c.clips[T];S(L,O,X*(1-H)+oe*H)}else for(let T=0,L=0;T<h;T++,L+=4)S(0,L,T/(h-1));return v}Gt("AlphaImage",Lc),Gt("RGBAImage",Mo);class bw extends Co{createBucket(s){return new _g(s)}constructor(s){super(s,yw),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(s){s==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=vg({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let wg;var vw={get paint(){return wg=wg||new $i({"hillshade-illumination-direction":new tn(ye.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new tn(ye.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new tn(ye.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new tn(ye.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new tn(ye.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new tn(ye.paint_hillshade["hillshade-accent-color"])})}};class ww extends Co{constructor(s){super(s,vw)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const xw=Zr([{name:"a_pos",components:2,type:"Int16"}],4),{members:kw}=xw;var op={exports:{}};function Tf(c,s,h){h=h||2;var m,v,S,T,L,R,O,H=s&&s.length,X=H?s[0]*h:c.length,oe=xg(c,0,X,h,!0),de=[];if(!oe||oe.next===oe.prev)return de;if(H&&(oe=function(ve,Me,Pe,He){var ze,Ne,ct,ft=[];for(ze=0,Ne=Me.length;ze<Ne;ze++)(ct=xg(ve,Me[ze]*He,ze<Ne-1?Me[ze+1]*He:ve.length,He,!1))===ct.next&&(ct.steiner=!0),ft.push(Aw(ct));for(ft.sort(Lw),ze=0;ze<ft.length;ze++)Pe=Ew(ft[ze],Pe);return Pe}(c,s,oe,h)),c.length>80*h){m=S=c[0],v=T=c[1];for(var ge=h;ge<X;ge+=h)(L=c[ge])<m&&(m=L),(R=c[ge+1])<v&&(v=R),L>S&&(S=L),R>T&&(T=R);O=(O=Math.max(S-m,T-v))!==0?32767/O:0}return Ec(oe,de,h,m,v,O,0),de}function xg(c,s,h,m,v){var S,T;if(v===lp(c,s,h,m)>0)for(S=s;S<h;S+=m)T=Tg(S,c[S],c[S+1],T);else for(S=h-m;S>=s;S-=m)T=Tg(S,c[S],c[S+1],T);return T&&Cf(T,T.next)&&(Ac(T),T=T.next),T}function ul(c,s){if(!c)return c;s||(s=c);var h,m=c;do if(h=!1,m.steiner||!Cf(m,m.next)&&Gr(m.prev,m,m.next)!==0)m=m.next;else{if(Ac(m),(m=s=m.prev)===m.next)break;h=!0}while(h||m!==s);return s}function Ec(c,s,h,m,v,S,T){if(c){!T&&S&&function(H,X,oe,de){var ge=H;do ge.z===0&&(ge.z=sp(ge.x,ge.y,X,oe,de)),ge.prevZ=ge.prev,ge.nextZ=ge.next,ge=ge.next;while(ge!==H);ge.prevZ.nextZ=null,ge.prevZ=null,function(ve){var Me,Pe,He,ze,Ne,ct,ft,Zt,Yt=1;do{for(Pe=ve,ve=null,Ne=null,ct=0;Pe;){for(ct++,He=Pe,ft=0,Me=0;Me<Yt&&(ft++,He=He.nextZ);Me++);for(Zt=Yt;ft>0||Zt>0&&He;)ft!==0&&(Zt===0||!He||Pe.z<=He.z)?(ze=Pe,Pe=Pe.nextZ,ft--):(ze=He,He=He.nextZ,Zt--),Ne?Ne.nextZ=ze:ve=ze,ze.prevZ=Ne,Ne=ze;Pe=He}Ne.nextZ=null,Yt*=2}while(ct>1)}(ge)}(c,m,v,S);for(var L,R,O=c;c.prev!==c.next;)if(L=c.prev,R=c.next,S?Tw(c,m,v,S):Sw(c))s.push(L.i/h|0),s.push(c.i/h|0),s.push(R.i/h|0),Ac(c),c=R.next,O=R.next;else if((c=R)===O){T?T===1?Ec(c=Cw(ul(c),s,h),s,h,m,v,S,2):T===2&&Mw(c,s,h,m,v,S):Ec(ul(c),s,h,m,v,S,1);break}}}function Sw(c){var s=c.prev,h=c,m=c.next;if(Gr(s,h,m)>=0)return!1;for(var v=s.x,S=h.x,T=m.x,L=s.y,R=h.y,O=m.y,H=v<S?v<T?v:T:S<T?S:T,X=L<R?L<O?L:O:R<O?R:O,oe=v>S?v>T?v:T:S>T?S:T,de=L>R?L>O?L:O:R>O?R:O,ge=m.next;ge!==s;){if(ge.x>=H&&ge.x<=oe&&ge.y>=X&&ge.y<=de&&du(v,L,S,R,T,O,ge.x,ge.y)&&Gr(ge.prev,ge,ge.next)>=0)return!1;ge=ge.next}return!0}function Tw(c,s,h,m){var v=c.prev,S=c,T=c.next;if(Gr(v,S,T)>=0)return!1;for(var L=v.x,R=S.x,O=T.x,H=v.y,X=S.y,oe=T.y,de=L<R?L<O?L:O:R<O?R:O,ge=H<X?H<oe?H:oe:X<oe?X:oe,ve=L>R?L>O?L:O:R>O?R:O,Me=H>X?H>oe?H:oe:X>oe?X:oe,Pe=sp(de,ge,s,h,m),He=sp(ve,Me,s,h,m),ze=c.prevZ,Ne=c.nextZ;ze&&ze.z>=Pe&&Ne&&Ne.z<=He;){if(ze.x>=de&&ze.x<=ve&&ze.y>=ge&&ze.y<=Me&&ze!==v&&ze!==T&&du(L,H,R,X,O,oe,ze.x,ze.y)&&Gr(ze.prev,ze,ze.next)>=0||(ze=ze.prevZ,Ne.x>=de&&Ne.x<=ve&&Ne.y>=ge&&Ne.y<=Me&&Ne!==v&&Ne!==T&&du(L,H,R,X,O,oe,Ne.x,Ne.y)&&Gr(Ne.prev,Ne,Ne.next)>=0))return!1;Ne=Ne.nextZ}for(;ze&&ze.z>=Pe;){if(ze.x>=de&&ze.x<=ve&&ze.y>=ge&&ze.y<=Me&&ze!==v&&ze!==T&&du(L,H,R,X,O,oe,ze.x,ze.y)&&Gr(ze.prev,ze,ze.next)>=0)return!1;ze=ze.prevZ}for(;Ne&&Ne.z<=He;){if(Ne.x>=de&&Ne.x<=ve&&Ne.y>=ge&&Ne.y<=Me&&Ne!==v&&Ne!==T&&du(L,H,R,X,O,oe,Ne.x,Ne.y)&&Gr(Ne.prev,Ne,Ne.next)>=0)return!1;Ne=Ne.nextZ}return!0}function Cw(c,s,h){var m=c;do{var v=m.prev,S=m.next.next;!Cf(v,S)&&kg(v,m,m.next,S)&&Ic(v,S)&&Ic(S,v)&&(s.push(v.i/h|0),s.push(m.i/h|0),s.push(S.i/h|0),Ac(m),Ac(m.next),m=c=S),m=m.next}while(m!==c);return ul(m)}function Mw(c,s,h,m,v,S){var T=c;do{for(var L=T.next.next;L!==T.prev;){if(T.i!==L.i&&Pw(T,L)){var R=Sg(T,L);return T=ul(T,T.next),R=ul(R,R.next),Ec(T,s,h,m,v,S,0),void Ec(R,s,h,m,v,S,0)}L=L.next}T=T.next}while(T!==c)}function Lw(c,s){return c.x-s.x}function Ew(c,s){var h=function(v,S){var T,L=S,R=v.x,O=v.y,H=-1/0;do{if(O<=L.y&&O>=L.next.y&&L.next.y!==L.y){var X=L.x+(O-L.y)*(L.next.x-L.x)/(L.next.y-L.y);if(X<=R&&X>H&&(H=X,T=L.x<L.next.x?L:L.next,X===R))return T}L=L.next}while(L!==S);if(!T)return null;var oe,de=T,ge=T.x,ve=T.y,Me=1/0;L=T;do R>=L.x&&L.x>=ge&&R!==L.x&&du(O<ve?R:H,O,ge,ve,O<ve?H:R,O,L.x,L.y)&&(oe=Math.abs(O-L.y)/(R-L.x),Ic(L,v)&&(oe<Me||oe===Me&&(L.x>T.x||L.x===T.x&&Iw(T,L)))&&(T=L,Me=oe)),L=L.next;while(L!==de);return T}(c,s);if(!h)return s;var m=Sg(h,c);return ul(m,m.next),ul(h,h.next)}function Iw(c,s){return Gr(c.prev,c,s.prev)<0&&Gr(s.next,c,c.next)<0}function sp(c,s,h,m,v){return(c=1431655765&((c=858993459&((c=252645135&((c=16711935&((c=(c-h)*v|0)|c<<8))|c<<4))|c<<2))|c<<1))|(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s=(s-m)*v|0)|s<<8))|s<<4))|s<<2))|s<<1))<<1}function Aw(c){var s=c,h=c;do(s.x<h.x||s.x===h.x&&s.y<h.y)&&(h=s),s=s.next;while(s!==c);return h}function du(c,s,h,m,v,S,T,L){return(v-T)*(s-L)>=(c-T)*(S-L)&&(c-T)*(m-L)>=(h-T)*(s-L)&&(h-T)*(S-L)>=(v-T)*(m-L)}function Pw(c,s){return c.next.i!==s.i&&c.prev.i!==s.i&&!function(h,m){var v=h;do{if(v.i!==h.i&&v.next.i!==h.i&&v.i!==m.i&&v.next.i!==m.i&&kg(v,v.next,h,m))return!0;v=v.next}while(v!==h);return!1}(c,s)&&(Ic(c,s)&&Ic(s,c)&&function(h,m){var v=h,S=!1,T=(h.x+m.x)/2,L=(h.y+m.y)/2;do v.y>L!=v.next.y>L&&v.next.y!==v.y&&T<(v.next.x-v.x)*(L-v.y)/(v.next.y-v.y)+v.x&&(S=!S),v=v.next;while(v!==h);return S}(c,s)&&(Gr(c.prev,c,s.prev)||Gr(c,s.prev,s))||Cf(c,s)&&Gr(c.prev,c,c.next)>0&&Gr(s.prev,s,s.next)>0)}function Gr(c,s,h){return(s.y-c.y)*(h.x-s.x)-(s.x-c.x)*(h.y-s.y)}function Cf(c,s){return c.x===s.x&&c.y===s.y}function kg(c,s,h,m){var v=Lf(Gr(c,s,h)),S=Lf(Gr(c,s,m)),T=Lf(Gr(h,m,c)),L=Lf(Gr(h,m,s));return v!==S&&T!==L||!(v!==0||!Mf(c,h,s))||!(S!==0||!Mf(c,m,s))||!(T!==0||!Mf(h,c,m))||!(L!==0||!Mf(h,s,m))}function Mf(c,s,h){return s.x<=Math.max(c.x,h.x)&&s.x>=Math.min(c.x,h.x)&&s.y<=Math.max(c.y,h.y)&&s.y>=Math.min(c.y,h.y)}function Lf(c){return c>0?1:c<0?-1:0}function Ic(c,s){return Gr(c.prev,c,c.next)<0?Gr(c,s,c.next)>=0&&Gr(c,c.prev,s)>=0:Gr(c,s,c.prev)<0||Gr(c,c.next,s)<0}function Sg(c,s){var h=new ap(c.i,c.x,c.y),m=new ap(s.i,s.x,s.y),v=c.next,S=s.prev;return c.next=s,s.prev=c,h.next=v,v.prev=h,m.next=h,h.prev=m,S.next=m,m.prev=S,m}function Tg(c,s,h,m){var v=new ap(c,s,h);return m?(v.next=m.next,v.prev=m,m.next.prev=v,m.next=v):(v.prev=v,v.next=v),v}function Ac(c){c.next.prev=c.prev,c.prev.next=c.next,c.prevZ&&(c.prevZ.nextZ=c.nextZ),c.nextZ&&(c.nextZ.prevZ=c.prevZ)}function ap(c,s,h){this.i=c,this.x=s,this.y=h,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function lp(c,s,h,m){for(var v=0,S=s,T=h-m;S<h;S+=m)v+=(c[T]-c[S])*(c[S+1]+c[T+1]),T=S;return v}op.exports=Tf,op.exports.default=Tf,Tf.deviation=function(c,s,h,m){var v=s&&s.length,S=Math.abs(lp(c,0,v?s[0]*h:c.length,h));if(v)for(var T=0,L=s.length;T<L;T++)S-=Math.abs(lp(c,s[T]*h,T<L-1?s[T+1]*h:c.length,h));var R=0;for(T=0;T<m.length;T+=3){var O=m[T]*h,H=m[T+1]*h,X=m[T+2]*h;R+=Math.abs((c[O]-c[X])*(c[H+1]-c[O+1])-(c[O]-c[H])*(c[X+1]-c[O+1]))}return S===0&&R===0?0:Math.abs((R-S)/S)},Tf.flatten=function(c){for(var s=c[0][0].length,h={vertices:[],holes:[],dimensions:s},m=0,v=0;v<c.length;v++){for(var S=0;S<c[v].length;S++)for(var T=0;T<s;T++)h.vertices.push(c[v][S][T]);v>0&&h.holes.push(m+=c[v-1].length)}return h};var Cg=d(op.exports);function zw(c,s,h,m,v){Mg(c,s,h||0,m||c.length-1,v||Dw)}function Mg(c,s,h,m,v){for(;m>h;){if(m-h>600){var S=m-h+1,T=s-h+1,L=Math.log(S),R=.5*Math.exp(2*L/3),O=.5*Math.sqrt(L*R*(S-R)/S)*(T-S/2<0?-1:1);Mg(c,s,Math.max(h,Math.floor(s-T*R/S+O)),Math.min(m,Math.floor(s+(S-T)*R/S+O)),v)}var H=c[s],X=h,oe=m;for(Pc(c,h,s),v(c[m],H)>0&&Pc(c,h,m);X<oe;){for(Pc(c,X,oe),X++,oe--;v(c[X],H)<0;)X++;for(;v(c[oe],H)>0;)oe--}v(c[h],H)===0?Pc(c,h,oe):Pc(c,++oe,m),oe<=s&&(h=oe+1),s<=oe&&(m=oe-1)}}function Pc(c,s,h){var m=c[s];c[s]=c[h],c[h]=m}function Dw(c,s){return c<s?-1:c>s?1:0}function up(c,s){const h=c.length;if(h<=1)return[c];const m=[];let v,S;for(let T=0;T<h;T++){const L=Ze(c[T]);L!==0&&(c[T].area=Math.abs(L),S===void 0&&(S=L<0),S===L<0?(v&&m.push(v),v=[c[T]]):v.push(c[T]))}if(v&&m.push(v),s>1)for(let T=0;T<m.length;T++)m[T].length<=s||(zw(m[T],s,1,m[T].length-1,Rw),m[T]=m[T].slice(0,s));return m}function Rw(c,s){return s.area-c.area}function cp(c,s,h){const m=h.patternDependencies;let v=!1;for(const S of s){const T=S.paint.get(`${c}-pattern`);T.isConstant()||(v=!0);const L=T.constantOr(null);L&&(v=!0,m[L.to]=!0,m[L.from]=!0)}return v}function hp(c,s,h,m,v){const S=v.patternDependencies;for(const T of s){const L=T.paint.get(`${c}-pattern`).value;if(L.kind!=="constant"){let R=L.evaluate({zoom:m-1},h,{},v.availableImages),O=L.evaluate({zoom:m},h,{},v.availableImages),H=L.evaluate({zoom:m+1},h,{},v.availableImages);R=R&&R.name?R.name:R,O=O&&O.name?O.name:O,H=H&&H.name?H.name:H,S[R]=!0,S[O]=!0,S[H]=!0,h.patterns[T.id]={min:R,mid:O,max:H}}}return h}class fp{constructor(s){this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(h=>h.id),this.index=s.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Te,this.indexArray=new at,this.indexArray2=new yt,this.programConfigurations=new Ar(s.layers,s.zoom),this.segments=new Rt,this.segments2=new Rt,this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id)}populate(s,h,m){this.hasPattern=cp("fill",this.layers,h);const v=this.layers[0].layout.get("fill-sort-key"),S=!v.isConstant(),T=[];for(const{feature:L,id:R,index:O,sourceLayerIndex:H}of s){const X=this.layers[0]._featureFilter.needGeometry,oe=js(L,X);if(!this.layers[0]._featureFilter.filter(new kr(this.zoom),oe,m))continue;const de=S?v.evaluate(oe,{},m,h.availableImages):void 0,ge={id:R,properties:L.properties,type:L.type,sourceLayerIndex:H,index:O,geometry:X?oe.geometry:Ns(L),patterns:{},sortKey:de};T.push(ge)}S&&T.sort((L,R)=>L.sortKey-R.sortKey);for(const L of T){const{geometry:R,index:O,sourceLayerIndex:H}=L;if(this.hasPattern){const X=hp("fill",this.layers,L,this.zoom,h);this.patternFeatures.push(X)}else this.addFeature(L,R,O,m,{});h.featureIndex.insert(s[O].feature,R,O,H,this.index)}}update(s,h,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(s,h,this.stateDependentLayers,m)}addFeatures(s,h,m){for(const v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,h,m)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(s){this.uploaded||(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,kw),this.indexBuffer=s.createIndexBuffer(this.indexArray),this.indexBuffer2=s.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(s),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(s,h,m,v,S){for(const T of up(h,500)){let L=0;for(const de of T)L+=de.length;const R=this.segments.prepareSegment(L,this.layoutVertexArray,this.indexArray),O=R.vertexLength,H=[],X=[];for(const de of T){if(de.length===0)continue;de!==T[0]&&X.push(H.length/2);const ge=this.segments2.prepareSegment(de.length,this.layoutVertexArray,this.indexArray2),ve=ge.vertexLength;this.layoutVertexArray.emplaceBack(de[0].x,de[0].y),this.indexArray2.emplaceBack(ve+de.length-1,ve),H.push(de[0].x),H.push(de[0].y);for(let Me=1;Me<de.length;Me++)this.layoutVertexArray.emplaceBack(de[Me].x,de[Me].y),this.indexArray2.emplaceBack(ve+Me-1,ve+Me),H.push(de[Me].x),H.push(de[Me].y);ge.vertexLength+=de.length,ge.primitiveLength+=de.length}const oe=Cg(H,X);for(let de=0;de<oe.length;de+=3)this.indexArray.emplaceBack(O+oe[de],O+oe[de+1],O+oe[de+2]);R.vertexLength+=L,R.primitiveLength+=oe.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,m,S,v)}}let Lg,Eg;Gt("FillBucket",fp,{omit:["layers","patternFeatures"]});var Fw={get paint(){return Eg=Eg||new $i({"fill-antialias":new tn(ye.paint_fill["fill-antialias"]),"fill-opacity":new ln(ye.paint_fill["fill-opacity"]),"fill-color":new ln(ye.paint_fill["fill-color"]),"fill-outline-color":new ln(ye.paint_fill["fill-outline-color"]),"fill-translate":new tn(ye.paint_fill["fill-translate"]),"fill-translate-anchor":new tn(ye.paint_fill["fill-translate-anchor"]),"fill-pattern":new tu(ye.paint_fill["fill-pattern"])})},get layout(){return Lg=Lg||new $i({"fill-sort-key":new ln(ye.layout_fill["fill-sort-key"])})}};class Bw extends Co{constructor(s){super(s,Fw)}recalculate(s,h){super.recalculate(s,h);const m=this.paint._values["fill-outline-color"];m.value.kind==="constant"&&m.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(s){return new fp(s)}queryRadius(){return xf(this.paint.get("fill-translate"))}queryIntersectsFeature(s,h,m,v,S,T,L){return kc(kf(s,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),T.angle,L),v)}isTileClipped(){return!0}}const $w=Zr([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),Ow=Zr([{name:"a_centroid",components:2,type:"Int16"}],4),{members:Nw}=$w;var ga={},jw=p,Ig=pu;function pu(c,s,h,m,v){this.properties={},this.extent=h,this.type=0,this._pbf=c,this._geometry=-1,this._keys=m,this._values=v,c.readFields(Uw,this,s)}function Uw(c,s,h){c==1?s.id=h.readVarint():c==2?function(m,v){for(var S=m.readVarint()+m.pos;m.pos<S;){var T=v._keys[m.readVarint()],L=v._values[m.readVarint()];v.properties[T]=L}}(h,s):c==3?s.type=h.readVarint():c==4&&(s._geometry=h.pos)}function Vw(c){for(var s,h,m=0,v=0,S=c.length,T=S-1;v<S;T=v++)m+=((h=c[T]).x-(s=c[v]).x)*(s.y+h.y);return m}pu.types=["Unknown","Point","LineString","Polygon"],pu.prototype.loadGeometry=function(){var c=this._pbf;c.pos=this._geometry;for(var s,h=c.readVarint()+c.pos,m=1,v=0,S=0,T=0,L=[];c.pos<h;){if(v<=0){var R=c.readVarint();m=7&R,v=R>>3}if(v--,m===1||m===2)S+=c.readSVarint(),T+=c.readSVarint(),m===1&&(s&&L.push(s),s=[]),s.push(new jw(S,T));else{if(m!==7)throw new Error("unknown command "+m);s&&s.push(s[0].clone())}}return s&&L.push(s),L},pu.prototype.bbox=function(){var c=this._pbf;c.pos=this._geometry;for(var s=c.readVarint()+c.pos,h=1,m=0,v=0,S=0,T=1/0,L=-1/0,R=1/0,O=-1/0;c.pos<s;){if(m<=0){var H=c.readVarint();h=7&H,m=H>>3}if(m--,h===1||h===2)(v+=c.readSVarint())<T&&(T=v),v>L&&(L=v),(S+=c.readSVarint())<R&&(R=S),S>O&&(O=S);else if(h!==7)throw new Error("unknown command "+h)}return[T,R,L,O]},pu.prototype.toGeoJSON=function(c,s,h){var m,v,S=this.extent*Math.pow(2,h),T=this.extent*c,L=this.extent*s,R=this.loadGeometry(),O=pu.types[this.type];function H(de){for(var ge=0;ge<de.length;ge++){var ve=de[ge];de[ge]=[360*(ve.x+T)/S-180,360/Math.PI*Math.atan(Math.exp((180-360*(ve.y+L)/S)*Math.PI/180))-90]}}switch(this.type){case 1:var X=[];for(m=0;m<R.length;m++)X[m]=R[m][0];H(R=X);break;case 2:for(m=0;m<R.length;m++)H(R[m]);break;case 3:for(R=function(de){var ge=de.length;if(ge<=1)return[de];for(var ve,Me,Pe=[],He=0;He<ge;He++){var ze=Vw(de[He]);ze!==0&&(Me===void 0&&(Me=ze<0),Me===ze<0?(ve&&Pe.push(ve),ve=[de[He]]):ve.push(de[He]))}return ve&&Pe.push(ve),Pe}(R),m=0;m<R.length;m++)for(v=0;v<R[m].length;v++)H(R[m][v])}R.length===1?R=R[0]:O="Multi"+O;var oe={type:"Feature",geometry:{type:O,coordinates:R},properties:this.properties};return"id"in this&&(oe.id=this.id),oe};var qw=Ig,Ag=Pg;function Pg(c,s){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=c,this._keys=[],this._values=[],this._features=[],c.readFields(Zw,this,s),this.length=this._features.length}function Zw(c,s,h){c===15?s.version=h.readVarint():c===1?s.name=h.readString():c===5?s.extent=h.readVarint():c===2?s._features.push(h.pos):c===3?s._keys.push(h.readString()):c===4&&s._values.push(function(m){for(var v=null,S=m.readVarint()+m.pos;m.pos<S;){var T=m.readVarint()>>3;v=T===1?m.readString():T===2?m.readFloat():T===3?m.readDouble():T===4?m.readVarint64():T===5?m.readVarint():T===6?m.readSVarint():T===7?m.readBoolean():null}return v}(h))}Pg.prototype.feature=function(c){if(c<0||c>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[c];var s=this._pbf.readVarint()+this._pbf.pos;return new qw(this._pbf,s,this.extent,this._keys,this._values)};var Gw=Ag;function Hw(c,s,h){if(c===3){var m=new Gw(h,h.readVarint()+h.pos);m.length&&(s[m.name]=m)}}ga.VectorTile=function(c,s){this.layers=c.readFields(Hw,{},s)},ga.VectorTileFeature=Ig,ga.VectorTileLayer=Ag;const Ww=ga.VectorTileFeature.types,dp=Math.pow(2,13);function zc(c,s,h,m,v,S,T,L){c.emplaceBack(s,h,2*Math.floor(m*dp)+T,v*dp*2,S*dp*2,Math.round(L))}class pp{constructor(s){this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(h=>h.id),this.index=s.index,this.hasPattern=!1,this.layoutVertexArray=new ke,this.centroidVertexArray=new te,this.indexArray=new at,this.programConfigurations=new Ar(s.layers,s.zoom),this.segments=new Rt,this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id)}populate(s,h,m){this.features=[],this.hasPattern=cp("fill-extrusion",this.layers,h);for(const{feature:v,id:S,index:T,sourceLayerIndex:L}of s){const R=this.layers[0]._featureFilter.needGeometry,O=js(v,R);if(!this.layers[0]._featureFilter.filter(new kr(this.zoom),O,m))continue;const H={id:S,sourceLayerIndex:L,index:T,geometry:R?O.geometry:Ns(v),properties:v.properties,type:v.type,patterns:{}};this.hasPattern?this.features.push(hp("fill-extrusion",this.layers,H,this.zoom,h)):this.addFeature(H,H.geometry,T,m,{}),h.featureIndex.insert(v,H.geometry,T,L,this.index,!0)}}addFeatures(s,h,m){for(const v of this.features){const{geometry:S}=v;this.addFeature(v,S,v.index,h,m)}}update(s,h,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(s,h,this.stateDependentLayers,m)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(s){this.uploaded||(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,Nw),this.centroidVertexBuffer=s.createVertexBuffer(this.centroidVertexArray,Ow.members,!0),this.indexBuffer=s.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(s),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(s,h,m,v,S){const T={x:0,y:0,vertexCount:0};for(const L of up(h,500)){let R=0;for(const ge of L)R+=ge.length;let O=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const ge of L){if(ge.length===0||Xw(ge))continue;let ve=0;for(let Me=0;Me<ge.length;Me++){const Pe=ge[Me];if(Me>=1){const He=ge[Me-1];if(!Kw(Pe,He)){O.vertexLength+4>Rt.MAX_VERTEX_ARRAY_LENGTH&&(O=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const ze=Pe.sub(He)._perp()._unit(),Ne=He.dist(Pe);ve+Ne>32768&&(ve=0),zc(this.layoutVertexArray,Pe.x,Pe.y,ze.x,ze.y,0,0,ve),zc(this.layoutVertexArray,Pe.x,Pe.y,ze.x,ze.y,0,1,ve),T.x+=2*Pe.x,T.y+=2*Pe.y,T.vertexCount+=2,ve+=Ne,zc(this.layoutVertexArray,He.x,He.y,ze.x,ze.y,0,0,ve),zc(this.layoutVertexArray,He.x,He.y,ze.x,ze.y,0,1,ve),T.x+=2*He.x,T.y+=2*He.y,T.vertexCount+=2;const ct=O.vertexLength;this.indexArray.emplaceBack(ct,ct+2,ct+1),this.indexArray.emplaceBack(ct+1,ct+2,ct+3),O.vertexLength+=4,O.primitiveLength+=2}}}}if(O.vertexLength+R>Rt.MAX_VERTEX_ARRAY_LENGTH&&(O=this.segments.prepareSegment(R,this.layoutVertexArray,this.indexArray)),Ww[s.type]!=="Polygon")continue;const H=[],X=[],oe=O.vertexLength;for(const ge of L)if(ge.length!==0){ge!==L[0]&&X.push(H.length/2);for(let ve=0;ve<ge.length;ve++){const Me=ge[ve];zc(this.layoutVertexArray,Me.x,Me.y,0,0,1,1,0),T.x+=Me.x,T.y+=Me.y,T.vertexCount+=1,H.push(Me.x),H.push(Me.y)}}const de=Cg(H,X);for(let ge=0;ge<de.length;ge+=3)this.indexArray.emplaceBack(oe+de[ge],oe+de[ge+2],oe+de[ge+1]);O.primitiveLength+=de.length/3,O.vertexLength+=R}for(let L=0;L<T.vertexCount;L++)this.centroidVertexArray.emplaceBack(Math.floor(T.x/T.vertexCount),Math.floor(T.y/T.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,m,S,v)}}function Kw(c,s){return c.x===s.x&&(c.x<0||c.x>Ur)||c.y===s.y&&(c.y<0||c.y>Ur)}function Xw(c){return c.every(s=>s.x<0)||c.every(s=>s.x>Ur)||c.every(s=>s.y<0)||c.every(s=>s.y>Ur)}let zg;Gt("FillExtrusionBucket",pp,{omit:["layers","features"]});var Jw={get paint(){return zg=zg||new $i({"fill-extrusion-opacity":new tn(ye["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new ln(ye["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new tn(ye["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new tn(ye["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new tu(ye["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new ln(ye["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new ln(ye["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new tn(ye["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class Yw extends Co{constructor(s){super(s,Jw)}createBucket(s){return new pp(s)}queryRadius(){return xf(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(s,h,m,v,S,T,L,R){const O=kf(s,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),T.angle,L),H=this.paint.get("fill-extrusion-height").evaluate(h,m),X=this.paint.get("fill-extrusion-base").evaluate(h,m),oe=function(ge,ve,Me,Pe){const He=[];for(const ze of ge){const Ne=[ze.x,ze.y,0,1];Sf(Ne,Ne,ve),He.push(new y(Ne[0]/Ne[3],Ne[1]/Ne[3]))}return He}(O,R),de=function(ge,ve,Me,Pe){const He=[],ze=[],Ne=Pe[8]*ve,ct=Pe[9]*ve,ft=Pe[10]*ve,Zt=Pe[11]*ve,Yt=Pe[8]*Me,Vt=Pe[9]*Me,Nt=Pe[10]*Me,Dt=Pe[11]*Me;for(const Ht of ge){const Ot=[],Ct=[];for(const sn of Ht){const en=sn.x,Dn=sn.y,vr=Pe[0]*en+Pe[4]*Dn+Pe[12],Tr=Pe[1]*en+Pe[5]*Dn+Pe[13],ai=Pe[2]*en+Pe[6]*Dn+Pe[14],go=Pe[3]*en+Pe[7]*Dn+Pe[15],Ni=ai+ft,Yr=go+Zt,_i=vr+Yt,ki=Tr+Vt,ji=ai+Nt,Ui=go+Dt,li=new y((vr+Ne)/Yr,(Tr+ct)/Yr);li.z=Ni/Yr,Ot.push(li);const ui=new y(_i/Ui,ki/Ui);ui.z=ji/Ui,Ct.push(ui)}He.push(Ot),ze.push(Ct)}return[He,ze]}(v,X,H,R);return function(ge,ve,Me){let Pe=1/0;kc(Me,ve)&&(Pe=Dg(Me,ve[0]));for(let He=0;He<ve.length;He++){const ze=ve[He],Ne=ge[He];for(let ct=0;ct<ze.length-1;ct++){const ft=ze[ct],Zt=[ft,ze[ct+1],Ne[ct+1],Ne[ct],ft];xc(Me,Zt)&&(Pe=Math.min(Pe,Dg(Me,Zt)))}}return Pe!==1/0&&Pe}(de[0],de[1],oe)}}function Dc(c,s){return c.x*s.x+c.y*s.y}function Dg(c,s){if(c.length===1){let h=0;const m=s[h++];let v;for(;!v||m.equals(v);)if(v=s[h++],!v)return 1/0;for(;h<s.length;h++){const S=s[h],T=c[0],L=v.sub(m),R=S.sub(m),O=T.sub(m),H=Dc(L,L),X=Dc(L,R),oe=Dc(R,R),de=Dc(O,L),ge=Dc(O,R),ve=H*oe-X*X,Me=(oe*de-X*ge)/ve,Pe=(H*ge-X*de)/ve,He=m.z*(1-Me-Pe)+v.z*Me+S.z*Pe;if(isFinite(He))return He}return 1/0}{let h=1/0;for(const m of s)h=Math.min(h,m.z);return h}}const Qw=Zr([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:e2}=Qw,t2=Zr([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:n2}=t2,r2=ga.VectorTileFeature.types,i2=Math.cos(Math.PI/180*37.5),Rg=Math.pow(2,14)/.5;class mp{constructor(s){this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(h=>h.id),this.index=s.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(h=>{this.gradients[h.id]={}}),this.layoutVertexArray=new Le,this.layoutVertexArray2=new be,this.indexArray=new at,this.programConfigurations=new Ar(s.layers,s.zoom),this.segments=new Rt,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id)}populate(s,h,m){this.hasPattern=cp("line",this.layers,h);const v=this.layers[0].layout.get("line-sort-key"),S=!v.isConstant(),T=[];for(const{feature:L,id:R,index:O,sourceLayerIndex:H}of s){const X=this.layers[0]._featureFilter.needGeometry,oe=js(L,X);if(!this.layers[0]._featureFilter.filter(new kr(this.zoom),oe,m))continue;const de=S?v.evaluate(oe,{},m):void 0,ge={id:R,properties:L.properties,type:L.type,sourceLayerIndex:H,index:O,geometry:X?oe.geometry:Ns(L),patterns:{},sortKey:de};T.push(ge)}S&&T.sort((L,R)=>L.sortKey-R.sortKey);for(const L of T){const{geometry:R,index:O,sourceLayerIndex:H}=L;if(this.hasPattern){const X=hp("line",this.layers,L,this.zoom,h);this.patternFeatures.push(X)}else this.addFeature(L,R,O,m,{});h.featureIndex.insert(s[O].feature,R,O,H,this.index)}}update(s,h,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(s,h,this.stateDependentLayers,m)}addFeatures(s,h,m){for(const v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,h,m)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(s){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=s.createVertexBuffer(this.layoutVertexArray2,n2)),this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,e2),this.indexBuffer=s.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(s),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(s){if(s.properties&&Object.prototype.hasOwnProperty.call(s.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(s.properties,"mapbox_clip_end"))return{start:+s.properties.mapbox_clip_start,end:+s.properties.mapbox_clip_end}}addFeature(s,h,m,v,S){const T=this.layers[0].layout,L=T.get("line-join").evaluate(s,{}),R=T.get("line-cap"),O=T.get("line-miter-limit"),H=T.get("line-round-limit");this.lineClips=this.lineFeatureClips(s);for(const X of h)this.addLine(X,s,L,R,O,H);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,m,S,v)}addLine(s,h,m,v,S,T){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Pe=0;Pe<s.length-1;Pe++)this.totalDistance+=s[Pe].dist(s[Pe+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const L=r2[h.type]==="Polygon";let R=s.length;for(;R>=2&&s[R-1].equals(s[R-2]);)R--;let O=0;for(;O<R-1&&s[O].equals(s[O+1]);)O++;if(R<(L?3:2))return;m==="bevel"&&(S=1.05);const H=this.overscaling<=16?15*Ur/(512*this.overscaling):0,X=this.segments.prepareSegment(10*R,this.layoutVertexArray,this.indexArray);let oe,de,ge,ve,Me;this.e1=this.e2=-1,L&&(oe=s[R-2],Me=s[O].sub(oe)._unit()._perp());for(let Pe=O;Pe<R;Pe++){if(ge=Pe===R-1?L?s[O+1]:void 0:s[Pe+1],ge&&s[Pe].equals(ge))continue;Me&&(ve=Me),oe&&(de=oe),oe=s[Pe],Me=ge?ge.sub(oe)._unit()._perp():ve,ve=ve||Me;let He=ve.add(Me);He.x===0&&He.y===0||He._unit();const ze=ve.x*Me.x+ve.y*Me.y,Ne=He.x*Me.x+He.y*Me.y,ct=Ne!==0?1/Ne:1/0,ft=2*Math.sqrt(2-2*Ne),Zt=Ne<i2&&de&&ge,Yt=ve.x*Me.y-ve.y*Me.x>0;if(Zt&&Pe>O){const Dt=oe.dist(de);if(Dt>2*H){const Ht=oe.sub(oe.sub(de)._mult(H/Dt)._round());this.updateDistance(de,Ht),this.addCurrentVertex(Ht,ve,0,0,X),de=Ht}}const Vt=de&&ge;let Nt=Vt?m:L?"butt":v;if(Vt&&Nt==="round"&&(ct<T?Nt="miter":ct<=2&&(Nt="fakeround")),Nt==="miter"&&ct>S&&(Nt="bevel"),Nt==="bevel"&&(ct>2&&(Nt="flipbevel"),ct<S&&(Nt="miter")),de&&this.updateDistance(de,oe),Nt==="miter")He._mult(ct),this.addCurrentVertex(oe,He,0,0,X);else if(Nt==="flipbevel"){if(ct>100)He=Me.mult(-1);else{const Dt=ct*ve.add(Me).mag()/ve.sub(Me).mag();He._perp()._mult(Dt*(Yt?-1:1))}this.addCurrentVertex(oe,He,0,0,X),this.addCurrentVertex(oe,He.mult(-1),0,0,X)}else if(Nt==="bevel"||Nt==="fakeround"){const Dt=-Math.sqrt(ct*ct-1),Ht=Yt?Dt:0,Ot=Yt?0:Dt;if(de&&this.addCurrentVertex(oe,ve,Ht,Ot,X),Nt==="fakeround"){const Ct=Math.round(180*ft/Math.PI/20);for(let sn=1;sn<Ct;sn++){let en=sn/Ct;if(en!==.5){const vr=en-.5;en+=en*vr*(en-1)*((1.0904+ze*(ze*(3.55645-1.43519*ze)-3.2452))*vr*vr+(.848013+ze*(.215638*ze-1.06021)))}const Dn=Me.sub(ve)._mult(en)._add(ve)._unit()._mult(Yt?-1:1);this.addHalfVertex(oe,Dn.x,Dn.y,!1,Yt,0,X)}}ge&&this.addCurrentVertex(oe,Me,-Ht,-Ot,X)}else if(Nt==="butt")this.addCurrentVertex(oe,He,0,0,X);else if(Nt==="square"){const Dt=de?1:-1;this.addCurrentVertex(oe,He,Dt,Dt,X)}else Nt==="round"&&(de&&(this.addCurrentVertex(oe,ve,0,0,X),this.addCurrentVertex(oe,ve,1,1,X,!0)),ge&&(this.addCurrentVertex(oe,Me,-1,-1,X,!0),this.addCurrentVertex(oe,Me,0,0,X)));if(Zt&&Pe<R-1){const Dt=oe.dist(ge);if(Dt>2*H){const Ht=oe.add(ge.sub(oe)._mult(H/Dt)._round());this.updateDistance(oe,Ht),this.addCurrentVertex(Ht,Me,0,0,X),oe=Ht}}}}addCurrentVertex(s,h,m,v,S,T=!1){const L=h.y*v-h.x,R=-h.y-h.x*v;this.addHalfVertex(s,h.x+h.y*m,h.y-h.x*m,T,!1,m,S),this.addHalfVertex(s,L,R,T,!0,-v,S),this.distance>Rg/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(s,h,m,v,S,T))}addHalfVertex({x:s,y:h},m,v,S,T,L,R){const O=.5*(this.lineClips?this.scaledDistance*(Rg-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((s<<1)+(S?1:0),(h<<1)+(T?1:0),Math.round(63*m)+128,Math.round(63*v)+128,1+(L===0?0:L<0?-1:1)|(63&O)<<2,O>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const H=R.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,H),R.primitiveLength++),T?this.e2=H:this.e1=H}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(s,h){this.distance+=s.dist(h),this.updateScaledDistance()}}let Fg,Bg;Gt("LineBucket",mp,{omit:["layers","patternFeatures"]});var $g={get paint(){return Bg=Bg||new $i({"line-opacity":new ln(ye.paint_line["line-opacity"]),"line-color":new ln(ye.paint_line["line-color"]),"line-translate":new tn(ye.paint_line["line-translate"]),"line-translate-anchor":new tn(ye.paint_line["line-translate-anchor"]),"line-width":new ln(ye.paint_line["line-width"]),"line-gap-width":new ln(ye.paint_line["line-gap-width"]),"line-offset":new ln(ye.paint_line["line-offset"]),"line-blur":new ln(ye.paint_line["line-blur"]),"line-dasharray":new nl(ye.paint_line["line-dasharray"]),"line-pattern":new tu(ye.paint_line["line-pattern"]),"line-gradient":new fc(ye.paint_line["line-gradient"])})},get layout(){return Fg=Fg||new $i({"line-cap":new tn(ye.layout_line["line-cap"]),"line-join":new ln(ye.layout_line["line-join"]),"line-miter-limit":new tn(ye.layout_line["line-miter-limit"]),"line-round-limit":new tn(ye.layout_line["line-round-limit"]),"line-sort-key":new ln(ye.layout_line["line-sort-key"])})}};class o2 extends ln{possiblyEvaluate(s,h){return h=new kr(Math.floor(h.zoom),{now:h.now,fadeDuration:h.fadeDuration,zoomHistory:h.zoomHistory,transition:h.transition}),super.possiblyEvaluate(s,h)}evaluate(s,h,m,v){return h=W({},h,{zoom:Math.floor(h.zoom)}),super.evaluate(s,h,m,v)}}let Ef;class s2 extends Co{constructor(s){super(s,$g),this.gradientVersion=0,Ef||(Ef=new o2($g.paint.properties["line-width"].specification),Ef.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(s){if(s==="line-gradient"){const h=this.gradientExpression();this.stepInterpolant=!!function(m){return m._styleExpression!==void 0}(h)&&h._styleExpression.expression instanceof Wa,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(s,h){super.recalculate(s,h),this.paint._values["line-floorwidth"]=Ef.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,s)}createBucket(s){return new mp(s)}queryRadius(s){const h=s,m=Og(Cc("line-width",this,h),Cc("line-gap-width",this,h)),v=Cc("line-offset",this,h);return m/2+Math.abs(v)+xf(this.paint.get("line-translate"))}queryIntersectsFeature(s,h,m,v,S,T,L){const R=kf(s,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),T.angle,L),O=L/2*Og(this.paint.get("line-width").evaluate(h,m),this.paint.get("line-gap-width").evaluate(h,m)),H=this.paint.get("line-offset").evaluate(h,m);return H&&(v=function(X,oe){const de=[];for(let ge=0;ge<X.length;ge++){const ve=X[ge],Me=[];for(let Pe=0;Pe<ve.length;Pe++){const He=ve[Pe-1],ze=ve[Pe],Ne=ve[Pe+1],ct=Pe===0?new y(0,0):ze.sub(He)._unit()._perp(),ft=Pe===ve.length-1?new y(0,0):Ne.sub(ze)._unit()._perp(),Zt=ct._add(ft)._unit(),Yt=Zt.x*ft.x+Zt.y*ft.y;Yt!==0&&Zt._mult(1/Yt),Me.push(Zt._mult(oe)._add(ze))}de.push(Me)}return de}(v,H*L)),function(X,oe,de){for(let ge=0;ge<oe.length;ge++){const ve=oe[ge];if(X.length>=3){for(let Me=0;Me<ve.length;Me++)if(hu(X,ve[Me]))return!0}if(Sc(X,ve,de))return!0}return!1}(R,v,O)}isTileClipped(){return!0}}function Og(c,s){return s>0?s+2*c:c}const a2=Zr([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),l2=Zr([{name:"a_projected_pos",components:3,type:"Float32"}],4);Zr([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const u2=Zr([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);Zr([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Ng=Zr([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),c2=Zr([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function h2(c,s,h){return c.sections.forEach(m=>{m.text=function(v,S,T){const L=S.layout.get("text-transform").evaluate(T,{});return L==="uppercase"?v=v.toLocaleUpperCase():L==="lowercase"&&(v=v.toLocaleLowerCase()),xs.applyArabicShaping&&(v=xs.applyArabicShaping(v)),v}(m.text,s,h)}),c}Zr([{name:"triangle",components:3,type:"Uint16"}]),Zr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Zr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Zr([{type:"Float32",name:"offsetX"}]),Zr([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Zr([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const Rc={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var si=24,jg=ar,Ug=function(c,s,h,m,v){var S,T,L=8*v-m-1,R=(1<<L)-1,O=R>>1,H=-7,X=h?v-1:0,oe=h?-1:1,de=c[s+X];for(X+=oe,S=de&(1<<-H)-1,de>>=-H,H+=L;H>0;S=256*S+c[s+X],X+=oe,H-=8);for(T=S&(1<<-H)-1,S>>=-H,H+=m;H>0;T=256*T+c[s+X],X+=oe,H-=8);if(S===0)S=1-O;else{if(S===R)return T?NaN:1/0*(de?-1:1);T+=Math.pow(2,m),S-=O}return(de?-1:1)*T*Math.pow(2,S-m)},Vg=function(c,s,h,m,v,S){var T,L,R,O=8*S-v-1,H=(1<<O)-1,X=H>>1,oe=v===23?Math.pow(2,-24)-Math.pow(2,-77):0,de=m?0:S-1,ge=m?1:-1,ve=s<0||s===0&&1/s<0?1:0;for(s=Math.abs(s),isNaN(s)||s===1/0?(L=isNaN(s)?1:0,T=H):(T=Math.floor(Math.log(s)/Math.LN2),s*(R=Math.pow(2,-T))<1&&(T--,R*=2),(s+=T+X>=1?oe/R:oe*Math.pow(2,1-X))*R>=2&&(T++,R/=2),T+X>=H?(L=0,T=H):T+X>=1?(L=(s*R-1)*Math.pow(2,v),T+=X):(L=s*Math.pow(2,X-1)*Math.pow(2,v),T=0));v>=8;c[h+de]=255&L,de+=ge,L/=256,v-=8);for(T=T<<v|L,O+=v;O>0;c[h+de]=255&T,de+=ge,T/=256,O-=8);c[h+de-ge]|=128*ve};function ar(c){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(c)?c:new Uint8Array(c||0),this.pos=0,this.type=0,this.length=this.buf.length}ar.Varint=0,ar.Fixed64=1,ar.Bytes=2,ar.Fixed32=5;var gp=4294967296,qg=1/gp,Zg=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Us(c){return c.type===ar.Bytes?c.readVarint()+c.pos:c.pos+1}function mu(c,s,h){return h?4294967296*s+(c>>>0):4294967296*(s>>>0)+(c>>>0)}function Gg(c,s,h){var m=s<=16383?1:s<=2097151?2:s<=268435455?3:Math.floor(Math.log(s)/(7*Math.LN2));h.realloc(m);for(var v=h.pos-1;v>=c;v--)h.buf[v+m]=h.buf[v]}function f2(c,s){for(var h=0;h<c.length;h++)s.writeVarint(c[h])}function d2(c,s){for(var h=0;h<c.length;h++)s.writeSVarint(c[h])}function p2(c,s){for(var h=0;h<c.length;h++)s.writeFloat(c[h])}function m2(c,s){for(var h=0;h<c.length;h++)s.writeDouble(c[h])}function g2(c,s){for(var h=0;h<c.length;h++)s.writeBoolean(c[h])}function _2(c,s){for(var h=0;h<c.length;h++)s.writeFixed32(c[h])}function y2(c,s){for(var h=0;h<c.length;h++)s.writeSFixed32(c[h])}function b2(c,s){for(var h=0;h<c.length;h++)s.writeFixed64(c[h])}function v2(c,s){for(var h=0;h<c.length;h++)s.writeSFixed64(c[h])}function If(c,s){return(c[s]|c[s+1]<<8|c[s+2]<<16)+16777216*c[s+3]}function gu(c,s,h){c[h]=s,c[h+1]=s>>>8,c[h+2]=s>>>16,c[h+3]=s>>>24}function Hg(c,s){return(c[s]|c[s+1]<<8|c[s+2]<<16)+(c[s+3]<<24)}ar.prototype={destroy:function(){this.buf=null},readFields:function(c,s,h){for(h=h||this.length;this.pos<h;){var m=this.readVarint(),v=m>>3,S=this.pos;this.type=7&m,c(v,s,this),this.pos===S&&this.skip(m)}return s},readMessage:function(c,s){return this.readFields(c,s,this.readVarint()+this.pos)},readFixed32:function(){var c=If(this.buf,this.pos);return this.pos+=4,c},readSFixed32:function(){var c=Hg(this.buf,this.pos);return this.pos+=4,c},readFixed64:function(){var c=If(this.buf,this.pos)+If(this.buf,this.pos+4)*gp;return this.pos+=8,c},readSFixed64:function(){var c=If(this.buf,this.pos)+Hg(this.buf,this.pos+4)*gp;return this.pos+=8,c},readFloat:function(){var c=Ug(this.buf,this.pos,!0,23,4);return this.pos+=4,c},readDouble:function(){var c=Ug(this.buf,this.pos,!0,52,8);return this.pos+=8,c},readVarint:function(c){var s,h,m=this.buf;return s=127&(h=m[this.pos++]),h<128?s:(s|=(127&(h=m[this.pos++]))<<7,h<128?s:(s|=(127&(h=m[this.pos++]))<<14,h<128?s:(s|=(127&(h=m[this.pos++]))<<21,h<128?s:function(v,S,T){var L,R,O=T.buf;if(L=(112&(R=O[T.pos++]))>>4,R<128||(L|=(127&(R=O[T.pos++]))<<3,R<128)||(L|=(127&(R=O[T.pos++]))<<10,R<128)||(L|=(127&(R=O[T.pos++]))<<17,R<128)||(L|=(127&(R=O[T.pos++]))<<24,R<128)||(L|=(1&(R=O[T.pos++]))<<31,R<128))return mu(v,L,S);throw new Error("Expected varint not more than 10 bytes")}(s|=(15&(h=m[this.pos]))<<28,c,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var c=this.readVarint();return c%2==1?(c+1)/-2:c/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var c=this.readVarint()+this.pos,s=this.pos;return this.pos=c,c-s>=12&&Zg?function(h,m,v){return Zg.decode(h.subarray(m,v))}(this.buf,s,c):function(h,m,v){for(var S="",T=m;T<v;){var L,R,O,H=h[T],X=null,oe=H>239?4:H>223?3:H>191?2:1;if(T+oe>v)break;oe===1?H<128&&(X=H):oe===2?(192&(L=h[T+1]))==128&&(X=(31&H)<<6|63&L)<=127&&(X=null):oe===3?(R=h[T+2],(192&(L=h[T+1]))==128&&(192&R)==128&&((X=(15&H)<<12|(63&L)<<6|63&R)<=2047||X>=55296&&X<=57343)&&(X=null)):oe===4&&(R=h[T+2],O=h[T+3],(192&(L=h[T+1]))==128&&(192&R)==128&&(192&O)==128&&((X=(15&H)<<18|(63&L)<<12|(63&R)<<6|63&O)<=65535||X>=1114112)&&(X=null)),X===null?(X=65533,oe=1):X>65535&&(X-=65536,S+=String.fromCharCode(X>>>10&1023|55296),X=56320|1023&X),S+=String.fromCharCode(X),T+=oe}return S}(this.buf,s,c)},readBytes:function(){var c=this.readVarint()+this.pos,s=this.buf.subarray(this.pos,c);return this.pos=c,s},readPackedVarint:function(c,s){if(this.type!==ar.Bytes)return c.push(this.readVarint(s));var h=Us(this);for(c=c||[];this.pos<h;)c.push(this.readVarint(s));return c},readPackedSVarint:function(c){if(this.type!==ar.Bytes)return c.push(this.readSVarint());var s=Us(this);for(c=c||[];this.pos<s;)c.push(this.readSVarint());return c},readPackedBoolean:function(c){if(this.type!==ar.Bytes)return c.push(this.readBoolean());var s=Us(this);for(c=c||[];this.pos<s;)c.push(this.readBoolean());return c},readPackedFloat:function(c){if(this.type!==ar.Bytes)return c.push(this.readFloat());var s=Us(this);for(c=c||[];this.pos<s;)c.push(this.readFloat());return c},readPackedDouble:function(c){if(this.type!==ar.Bytes)return c.push(this.readDouble());var s=Us(this);for(c=c||[];this.pos<s;)c.push(this.readDouble());return c},readPackedFixed32:function(c){if(this.type!==ar.Bytes)return c.push(this.readFixed32());var s=Us(this);for(c=c||[];this.pos<s;)c.push(this.readFixed32());return c},readPackedSFixed32:function(c){if(this.type!==ar.Bytes)return c.push(this.readSFixed32());var s=Us(this);for(c=c||[];this.pos<s;)c.push(this.readSFixed32());return c},readPackedFixed64:function(c){if(this.type!==ar.Bytes)return c.push(this.readFixed64());var s=Us(this);for(c=c||[];this.pos<s;)c.push(this.readFixed64());return c},readPackedSFixed64:function(c){if(this.type!==ar.Bytes)return c.push(this.readSFixed64());var s=Us(this);for(c=c||[];this.pos<s;)c.push(this.readSFixed64());return c},skip:function(c){var s=7&c;if(s===ar.Varint)for(;this.buf[this.pos++]>127;);else if(s===ar.Bytes)this.pos=this.readVarint()+this.pos;else if(s===ar.Fixed32)this.pos+=4;else{if(s!==ar.Fixed64)throw new Error("Unimplemented type: "+s);this.pos+=8}},writeTag:function(c,s){this.writeVarint(c<<3|s)},realloc:function(c){for(var s=this.length||16;s<this.pos+c;)s*=2;if(s!==this.length){var h=new Uint8Array(s);h.set(this.buf),this.buf=h,this.length=s}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(c){this.realloc(4),gu(this.buf,c,this.pos),this.pos+=4},writeSFixed32:function(c){this.realloc(4),gu(this.buf,c,this.pos),this.pos+=4},writeFixed64:function(c){this.realloc(8),gu(this.buf,-1&c,this.pos),gu(this.buf,Math.floor(c*qg),this.pos+4),this.pos+=8},writeSFixed64:function(c){this.realloc(8),gu(this.buf,-1&c,this.pos),gu(this.buf,Math.floor(c*qg),this.pos+4),this.pos+=8},writeVarint:function(c){(c=+c||0)>268435455||c<0?function(s,h){var m,v;if(s>=0?(m=s%4294967296|0,v=s/4294967296|0):(v=~(-s/4294967296),4294967295^(m=~(-s%4294967296))?m=m+1|0:(m=0,v=v+1|0)),s>=18446744073709552e3||s<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");h.realloc(10),function(S,T,L){L.buf[L.pos++]=127&S|128,S>>>=7,L.buf[L.pos++]=127&S|128,S>>>=7,L.buf[L.pos++]=127&S|128,S>>>=7,L.buf[L.pos++]=127&S|128,L.buf[L.pos]=127&(S>>>=7)}(m,0,h),function(S,T){var L=(7&S)<<4;T.buf[T.pos++]|=L|((S>>>=3)?128:0),S&&(T.buf[T.pos++]=127&S|((S>>>=7)?128:0),S&&(T.buf[T.pos++]=127&S|((S>>>=7)?128:0),S&&(T.buf[T.pos++]=127&S|((S>>>=7)?128:0),S&&(T.buf[T.pos++]=127&S|((S>>>=7)?128:0),S&&(T.buf[T.pos++]=127&S)))))}(v,h)}(c,this):(this.realloc(4),this.buf[this.pos++]=127&c|(c>127?128:0),c<=127||(this.buf[this.pos++]=127&(c>>>=7)|(c>127?128:0),c<=127||(this.buf[this.pos++]=127&(c>>>=7)|(c>127?128:0),c<=127||(this.buf[this.pos++]=c>>>7&127))))},writeSVarint:function(c){this.writeVarint(c<0?2*-c-1:2*c)},writeBoolean:function(c){this.writeVarint(!!c)},writeString:function(c){c=String(c),this.realloc(4*c.length),this.pos++;var s=this.pos;this.pos=function(m,v,S){for(var T,L,R=0;R<v.length;R++){if((T=v.charCodeAt(R))>55295&&T<57344){if(!L){T>56319||R+1===v.length?(m[S++]=239,m[S++]=191,m[S++]=189):L=T;continue}if(T<56320){m[S++]=239,m[S++]=191,m[S++]=189,L=T;continue}T=L-55296<<10|T-56320|65536,L=null}else L&&(m[S++]=239,m[S++]=191,m[S++]=189,L=null);T<128?m[S++]=T:(T<2048?m[S++]=T>>6|192:(T<65536?m[S++]=T>>12|224:(m[S++]=T>>18|240,m[S++]=T>>12&63|128),m[S++]=T>>6&63|128),m[S++]=63&T|128)}return S}(this.buf,c,this.pos);var h=this.pos-s;h>=128&&Gg(s,h,this),this.pos=s-1,this.writeVarint(h),this.pos+=h},writeFloat:function(c){this.realloc(4),Vg(this.buf,c,this.pos,!0,23,4),this.pos+=4},writeDouble:function(c){this.realloc(8),Vg(this.buf,c,this.pos,!0,52,8),this.pos+=8},writeBytes:function(c){var s=c.length;this.writeVarint(s),this.realloc(s);for(var h=0;h<s;h++)this.buf[this.pos++]=c[h]},writeRawMessage:function(c,s){this.pos++;var h=this.pos;c(s,this);var m=this.pos-h;m>=128&&Gg(h,m,this),this.pos=h-1,this.writeVarint(m),this.pos+=m},writeMessage:function(c,s,h){this.writeTag(c,ar.Bytes),this.writeRawMessage(s,h)},writePackedVarint:function(c,s){s.length&&this.writeMessage(c,f2,s)},writePackedSVarint:function(c,s){s.length&&this.writeMessage(c,d2,s)},writePackedBoolean:function(c,s){s.length&&this.writeMessage(c,g2,s)},writePackedFloat:function(c,s){s.length&&this.writeMessage(c,p2,s)},writePackedDouble:function(c,s){s.length&&this.writeMessage(c,m2,s)},writePackedFixed32:function(c,s){s.length&&this.writeMessage(c,_2,s)},writePackedSFixed32:function(c,s){s.length&&this.writeMessage(c,y2,s)},writePackedFixed64:function(c,s){s.length&&this.writeMessage(c,b2,s)},writePackedSFixed64:function(c,s){s.length&&this.writeMessage(c,v2,s)},writeBytesField:function(c,s){this.writeTag(c,ar.Bytes),this.writeBytes(s)},writeFixed32Field:function(c,s){this.writeTag(c,ar.Fixed32),this.writeFixed32(s)},writeSFixed32Field:function(c,s){this.writeTag(c,ar.Fixed32),this.writeSFixed32(s)},writeFixed64Field:function(c,s){this.writeTag(c,ar.Fixed64),this.writeFixed64(s)},writeSFixed64Field:function(c,s){this.writeTag(c,ar.Fixed64),this.writeSFixed64(s)},writeVarintField:function(c,s){this.writeTag(c,ar.Varint),this.writeVarint(s)},writeSVarintField:function(c,s){this.writeTag(c,ar.Varint),this.writeSVarint(s)},writeStringField:function(c,s){this.writeTag(c,ar.Bytes),this.writeString(s)},writeFloatField:function(c,s){this.writeTag(c,ar.Fixed32),this.writeFloat(s)},writeDoubleField:function(c,s){this.writeTag(c,ar.Fixed64),this.writeDouble(s)},writeBooleanField:function(c,s){this.writeVarintField(c,!!s)}};var _p=d(jg);const yp=3;function w2(c,s,h){c===1&&h.readMessage(x2,s)}function x2(c,s,h){if(c===3){const{id:m,bitmap:v,width:S,height:T,left:L,top:R,advance:O}=h.readMessage(k2,{});s.push({id:m,bitmap:new Lc({width:S+2*yp,height:T+2*yp},v),metrics:{width:S,height:T,left:L,top:R,advance:O}})}}function k2(c,s,h){c===1?s.id=h.readVarint():c===2?s.bitmap=h.readBytes():c===3?s.width=h.readVarint():c===4?s.height=h.readVarint():c===5?s.left=h.readSVarint():c===6?s.top=h.readSVarint():c===7&&(s.advance=h.readVarint())}const Wg=yp;function Kg(c){let s=0,h=0;for(const T of c)s+=T.w*T.h,h=Math.max(h,T.w);c.sort((T,L)=>L.h-T.h);const m=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(s/.95)),h),h:1/0}];let v=0,S=0;for(const T of c)for(let L=m.length-1;L>=0;L--){const R=m[L];if(!(T.w>R.w||T.h>R.h)){if(T.x=R.x,T.y=R.y,S=Math.max(S,T.y+T.h),v=Math.max(v,T.x+T.w),T.w===R.w&&T.h===R.h){const O=m.pop();L<m.length&&(m[L]=O)}else T.h===R.h?(R.x+=T.w,R.w-=T.w):T.w===R.w?(R.y+=T.h,R.h-=T.h):(m.push({x:R.x+T.w,y:R.y,w:R.w-T.w,h:T.h}),R.y+=T.h,R.h-=T.h);break}}return{w:v,h:S,fill:s/(v*S)||0}}const ro=1;class bp{constructor(s,{pixelRatio:h,version:m,stretchX:v,stretchY:S,content:T}){this.paddedRect=s,this.pixelRatio=h,this.stretchX=v,this.stretchY=S,this.content=T,this.version=m}get tl(){return[this.paddedRect.x+ro,this.paddedRect.y+ro]}get br(){return[this.paddedRect.x+this.paddedRect.w-ro,this.paddedRect.y+this.paddedRect.h-ro]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*ro)/this.pixelRatio,(this.paddedRect.h-2*ro)/this.pixelRatio]}}class Xg{constructor(s,h){const m={},v={};this.haveRenderCallbacks=[];const S=[];this.addImages(s,m,S),this.addImages(h,v,S);const{w:T,h:L}=Kg(S),R=new Mo({width:T||1,height:L||1});for(const O in s){const H=s[O],X=m[O].paddedRect;Mo.copy(H.data,R,{x:0,y:0},{x:X.x+ro,y:X.y+ro},H.data)}for(const O in h){const H=h[O],X=v[O].paddedRect,oe=X.x+ro,de=X.y+ro,ge=H.data.width,ve=H.data.height;Mo.copy(H.data,R,{x:0,y:0},{x:oe,y:de},H.data),Mo.copy(H.data,R,{x:0,y:ve-1},{x:oe,y:de-1},{width:ge,height:1}),Mo.copy(H.data,R,{x:0,y:0},{x:oe,y:de+ve},{width:ge,height:1}),Mo.copy(H.data,R,{x:ge-1,y:0},{x:oe-1,y:de},{width:1,height:ve}),Mo.copy(H.data,R,{x:0,y:0},{x:oe+ge,y:de},{width:1,height:ve})}this.image=R,this.iconPositions=m,this.patternPositions=v}addImages(s,h,m){for(const v in s){const S=s[v],T={x:0,y:0,w:S.data.width+2*ro,h:S.data.height+2*ro};m.push(T),h[v]=new bp(T,S),S.hasRenderCallback&&this.haveRenderCallbacks.push(v)}}patchUpdatedImages(s,h){s.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const m in s.updatedImages)this.patchUpdatedImage(this.iconPositions[m],s.getImage(m),h),this.patchUpdatedImage(this.patternPositions[m],s.getImage(m),h)}patchUpdatedImage(s,h,m){if(!s||!h||s.version===h.version)return;s.version=h.version;const[v,S]=s.tl;m.update(h.data,void 0,{x:v,y:S})}}var _a;Gt("ImagePosition",bp),Gt("ImageAtlas",Xg),u.ah=void 0,(_a=u.ah||(u.ah={}))[_a.none=0]="none",_a[_a.horizontal=1]="horizontal",_a[_a.vertical=2]="vertical",_a[_a.horizontalOnly=3]="horizontalOnly";const Fc=-17;class Bc{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(s,h){const m=new Bc;return m.scale=s||1,m.fontStack=h,m}static forImage(s){const h=new Bc;return h.imageName=s,h}}class _u{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(s,h){const m=new _u;for(let v=0;v<s.sections.length;v++){const S=s.sections[v];S.image?m.addImageSection(S):m.addTextSection(S,h)}return m}length(){return this.text.length}getSection(s){return this.sections[this.sectionIndex[s]]}getSectionIndex(s){return this.sectionIndex[s]}getCharCode(s){return this.text.charCodeAt(s)}verticalizePunctuation(){this.text=function(s){let h="";for(let m=0;m<s.length;m++){const v=s.charCodeAt(m+1)||null,S=s.charCodeAt(m-1)||null;h+=v&&cc(v)&&!Rc[s[m+1]]||S&&cc(S)&&!Rc[s[m-1]]||!Rc[s[m]]?s[m]:Rc[s[m]]}return h}(this.text)}trim(){let s=0;for(let m=0;m<this.text.length&&Pf[this.text.charCodeAt(m)];m++)s++;let h=this.text.length;for(let m=this.text.length-1;m>=0&&m>=s&&Pf[this.text.charCodeAt(m)];m--)h--;this.text=this.text.substring(s,h),this.sectionIndex=this.sectionIndex.slice(s,h)}substring(s,h){const m=new _u;return m.text=this.text.substring(s,h),m.sectionIndex=this.sectionIndex.slice(s,h),m.sections=this.sections,m}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((s,h)=>Math.max(s,this.sections[h].scale),0)}addTextSection(s,h){this.text+=s.text,this.sections.push(Bc.forText(s.scale,s.fontStack||h));const m=this.sections.length-1;for(let v=0;v<s.text.length;++v)this.sectionIndex.push(m)}addImageSection(s){const h=s.image?s.image.name:"";if(h.length===0)return void Ce("Can't add FormattedSection with an empty image.");const m=this.getNextImageSectionCharCode();m?(this.text+=String.fromCharCode(m),this.sections.push(Bc.forImage(h)),this.sectionIndex.push(this.sections.length-1)):Ce("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Af(c,s,h,m,v,S,T,L,R,O,H,X,oe,de,ge,ve){const Me=_u.fromFeature(c,v);let Pe;X===u.ah.vertical&&Me.verticalizePunctuation();const{processBidirectionalText:He,processStyledBidirectionalText:ze}=xs;if(He&&Me.sections.length===1){Pe=[];const ft=He(Me.toString(),vp(Me,O,S,s,m,de,ge));for(const Zt of ft){const Yt=new _u;Yt.text=Zt,Yt.sections=Me.sections;for(let Vt=0;Vt<Zt.length;Vt++)Yt.sectionIndex.push(0);Pe.push(Yt)}}else if(ze){Pe=[];const ft=ze(Me.text,Me.sectionIndex,vp(Me,O,S,s,m,de,ge));for(const Zt of ft){const Yt=new _u;Yt.text=Zt[0],Yt.sectionIndex=Zt[1],Yt.sections=Me.sections,Pe.push(Yt)}}else Pe=function(ft,Zt){const Yt=[],Vt=ft.text;let Nt=0;for(const Dt of Zt)Yt.push(ft.substring(Nt,Dt)),Nt=Dt;return Nt<Vt.length&&Yt.push(ft.substring(Nt,Vt.length)),Yt}(Me,vp(Me,O,S,s,m,de,ge));const Ne=[],ct={positionedLines:Ne,text:Me.toString(),top:H[1],bottom:H[1],left:H[0],right:H[0],writingMode:X,iconsInText:!1,verticalizable:!1};return function(ft,Zt,Yt,Vt,Nt,Dt,Ht,Ot,Ct,sn,en,Dn){let vr=0,Tr=Fc,ai=0,go=0;const Ni=Ot==="right"?1:Ot==="left"?0:.5;let Yr=0;for(const li of Nt){li.trim();const ui=li.getMaxScale(),Ii=(ui-1)*si,Vi={positionedGlyphs:[],lineOffset:0};ft.positionedLines[Yr]=Vi;const Ai=Vi.positionedGlyphs;let io=0;if(!li.length()){Tr+=Dt,++Yr;continue}for(let ci=0;ci<li.length();ci++){const Bn=li.getSection(ci),Pi=li.getSectionIndex(ci),Si=li.getCharCode(ci);let hi=0,Wo=null,as=null,ls=null,Vs=si;const Ko=!(Ct===u.ah.horizontal||!en&&!Yl(Si)||en&&(Pf[Si]||(_i=Si,Ut.Arabic(_i)||Ut["Arabic Supplement"](_i)||Ut["Arabic Extended-A"](_i)||Ut["Arabic Presentation Forms-A"](_i)||Ut["Arabic Presentation Forms-B"](_i))));if(Bn.imageName){const Eo=Vt[Bn.imageName];if(!Eo)continue;ls=Bn.imageName,ft.iconsInText=ft.iconsInText||!0,as=Eo.paddedRect;const so=Eo.displaySize;Bn.scale=Bn.scale*si/Dn,Wo={width:so[0],height:so[1],left:ro,top:-Wg,advance:Ko?so[1]:so[0]},hi=Ii+(si-so[1]*Bn.scale),Vs=Wo.advance;const qs=Ko?so[0]*Bn.scale-si*ui:so[1]*Bn.scale-si*ui;qs>0&&qs>io&&(io=qs)}else{const Eo=Yt[Bn.fontStack],so=Eo&&Eo[Si];if(so&&so.rect)as=so.rect,Wo=so.metrics;else{const qs=Zt[Bn.fontStack],Uc=qs&&qs[Si];if(!Uc)continue;Wo=Uc.metrics}hi=(ui-Bn.scale)*si}Ko?(ft.verticalizable=!0,Ai.push({glyph:Si,imageName:ls,x:vr,y:Tr+hi,vertical:Ko,scale:Bn.scale,fontStack:Bn.fontStack,sectionIndex:Pi,metrics:Wo,rect:as}),vr+=Vs*Bn.scale+sn):(Ai.push({glyph:Si,imageName:ls,x:vr,y:Tr+hi,vertical:Ko,scale:Bn.scale,fontStack:Bn.fontStack,sectionIndex:Pi,metrics:Wo,rect:as}),vr+=Wo.advance*Bn.scale+sn)}Ai.length!==0&&(ai=Math.max(vr-sn,ai),C2(Ai,0,Ai.length-1,Ni,io)),vr=0;const oo=Dt*ui+io;Vi.lineOffset=Math.max(io,Ii),Tr+=oo,go=Math.max(oo,go),++Yr}var _i;const ki=Tr-Fc,{horizontalAlign:ji,verticalAlign:Ui}=wp(Ht);(function(li,ui,Ii,Vi,Ai,io,oo,ci,Bn){const Pi=(ui-Ii)*Ai;let Si=0;Si=io!==oo?-ci*Vi-Fc:(-Vi*Bn+.5)*oo;for(const hi of li)for(const Wo of hi.positionedGlyphs)Wo.x+=Pi,Wo.y+=Si})(ft.positionedLines,Ni,ji,Ui,ai,go,Dt,ki,Nt.length),ft.top+=-Ui*ki,ft.bottom=ft.top+ki,ft.left+=-ji*ai,ft.right=ft.left+ai}(ct,s,h,m,Pe,T,L,R,X,O,oe,ve),!function(ft){for(const Zt of ft)if(Zt.positionedGlyphs.length!==0)return!1;return!0}(Ne)&&ct}const Pf={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},S2={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Jg(c,s,h,m,v,S){if(s.imageName){const T=m[s.imageName];return T?T.displaySize[0]*s.scale*si/S+v:0}{const T=h[s.fontStack],L=T&&T[c];return L?L.metrics.advance*s.scale+v:0}}function Yg(c,s,h,m){const v=Math.pow(c-s,2);return m?c<s?v/2:2*v:v+Math.abs(h)*h}function T2(c,s,h){let m=0;return c===10&&(m-=1e4),h&&(m+=150),c!==40&&c!==65288||(m+=50),s!==41&&s!==65289||(m+=50),m}function Qg(c,s,h,m,v,S){let T=null,L=Yg(s,h,v,S);for(const R of m){const O=Yg(s-R.x,h,v,S)+R.badness;O<=L&&(T=R,L=O)}return{index:c,x:s,priorBreak:T,badness:L}}function e_(c){return c?e_(c.priorBreak).concat(c.index):[]}function vp(c,s,h,m,v,S,T){if(S!=="point")return[];if(!c)return[];const L=[],R=function(oe,de,ge,ve,Me,Pe){let He=0;for(let ze=0;ze<oe.length();ze++){const Ne=oe.getSection(ze);He+=Jg(oe.getCharCode(ze),Ne,ve,Me,de,Pe)}return He/Math.max(1,Math.ceil(He/ge))}(c,s,h,m,v,T),O=c.text.indexOf("")>=0;let H=0;for(let oe=0;oe<c.length();oe++){const de=c.getSection(oe),ge=c.getCharCode(oe);if(Pf[ge]||(H+=Jg(ge,de,m,v,s,T)),oe<c.length()-1){const ve=!((X=ge)<11904||!(Ut["Bopomofo Extended"](X)||Ut.Bopomofo(X)||Ut["CJK Compatibility Forms"](X)||Ut["CJK Compatibility Ideographs"](X)||Ut["CJK Compatibility"](X)||Ut["CJK Radicals Supplement"](X)||Ut["CJK Strokes"](X)||Ut["CJK Symbols and Punctuation"](X)||Ut["CJK Unified Ideographs Extension A"](X)||Ut["CJK Unified Ideographs"](X)||Ut["Enclosed CJK Letters and Months"](X)||Ut["Halfwidth and Fullwidth Forms"](X)||Ut.Hiragana(X)||Ut["Ideographic Description Characters"](X)||Ut["Kangxi Radicals"](X)||Ut["Katakana Phonetic Extensions"](X)||Ut.Katakana(X)||Ut["Vertical Forms"](X)||Ut["Yi Radicals"](X)||Ut["Yi Syllables"](X)));(S2[ge]||ve||de.imageName)&&L.push(Qg(oe+1,H,R,L,T2(ge,c.getCharCode(oe+1),ve&&O),!1))}}var X;return e_(Qg(c.length(),H,R,L,0,!0))}function wp(c){let s=.5,h=.5;switch(c){case"right":case"top-right":case"bottom-right":s=1;break;case"left":case"top-left":case"bottom-left":s=0}switch(c){case"bottom":case"bottom-right":case"bottom-left":h=1;break;case"top":case"top-right":case"top-left":h=0}return{horizontalAlign:s,verticalAlign:h}}function C2(c,s,h,m,v){if(!m&&!v)return;const S=c[h],T=(c[h].x+S.metrics.advance*S.scale)*m;for(let L=s;L<=h;L++)c[L].x-=T,c[L].y+=v}function M2(c,s,h){const{horizontalAlign:m,verticalAlign:v}=wp(h),S=s[0]-c.displaySize[0]*m,T=s[1]-c.displaySize[1]*v;return{image:c,top:T,bottom:T+c.displaySize[1],left:S,right:S+c.displaySize[0]}}function t_(c,s,h,m,v,S){const T=c.image;let L;if(T.content){const Me=T.content,Pe=T.pixelRatio||1;L=[Me[0]/Pe,Me[1]/Pe,T.displaySize[0]-Me[2]/Pe,T.displaySize[1]-Me[3]/Pe]}const R=s.left*S,O=s.right*S;let H,X,oe,de;h==="width"||h==="both"?(de=v[0]+R-m[3],X=v[0]+O+m[1]):(de=v[0]+(R+O-T.displaySize[0])/2,X=de+T.displaySize[0]);const ge=s.top*S,ve=s.bottom*S;return h==="height"||h==="both"?(H=v[1]+ge-m[0],oe=v[1]+ve+m[2]):(H=v[1]+(ge+ve-T.displaySize[1])/2,oe=H+T.displaySize[1]),{image:T,top:H,right:X,bottom:oe,left:de,collisionPadding:L}}const $c=255,Cs=128,ya=$c*Cs;function n_(c,s){const{expression:h}=s;if(h.kind==="constant")return{kind:"constant",layoutSize:h.evaluate(new kr(c+1))};if(h.kind==="source")return{kind:"source"};{const{zoomStops:m,interpolationType:v}=h;let S=0;for(;S<m.length&&m[S]<=c;)S++;S=Math.max(0,S-1);let T=S;for(;T<m.length&&m[T]<c+1;)T++;T=Math.min(m.length-1,T);const L=m[S],R=m[T];return h.kind==="composite"?{kind:"composite",minZoom:L,maxZoom:R,interpolationType:v}:{kind:"camera",minZoom:L,maxZoom:R,minSize:h.evaluate(new kr(L)),maxSize:h.evaluate(new kr(R)),interpolationType:v}}}function xp(c,s,h){let m="never";const v=c.get(s);return v?m=v:c.get(h)&&(m="always"),m}const L2=ga.VectorTileFeature.types,E2=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function zf(c,s,h,m,v,S,T,L,R,O,H,X,oe){const de=L?Math.min(ya,Math.round(L[0])):0,ge=L?Math.min(ya,Math.round(L[1])):0;c.emplaceBack(s,h,Math.round(32*m),Math.round(32*v),S,T,(de<<1)+(R?1:0),ge,16*O,16*H,256*X,256*oe)}function kp(c,s,h){c.emplaceBack(s.x,s.y,h),c.emplaceBack(s.x,s.y,h),c.emplaceBack(s.x,s.y,h),c.emplaceBack(s.x,s.y,h)}function I2(c){for(const s of c.sections)if(ep(s.text))return!0;return!1}class Sp{constructor(s){this.layoutVertexArray=new et,this.indexArray=new at,this.programConfigurations=s,this.segments=new Rt,this.dynamicLayoutVertexArray=new Ie,this.opacityVertexArray=new Ve,this.hasVisibleVertices=!1,this.placedSymbolArray=new f}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(s,h,m,v){this.isEmpty()||(m&&(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,a2.members),this.indexBuffer=s.createIndexBuffer(this.indexArray,h),this.dynamicLayoutVertexBuffer=s.createVertexBuffer(this.dynamicLayoutVertexArray,l2.members,!0),this.opacityVertexBuffer=s.createVertexBuffer(this.opacityVertexArray,E2,!0),this.opacityVertexBuffer.itemSize=1),(m||v)&&this.programConfigurations.upload(s))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Gt("SymbolBuffers",Sp);class Tp{constructor(s,h,m){this.layoutVertexArray=new s,this.layoutAttributes=h,this.indexArray=new m,this.segments=new Rt,this.collisionVertexArray=new rt}upload(s){this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=s.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=s.createVertexBuffer(this.collisionVertexArray,u2.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Gt("CollisionBuffers",Tp);class yu{constructor(s){this.collisionBoxArray=s.collisionBoxArray,this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(T=>T.id),this.index=s.index,this.pixelRatio=s.pixelRatio,this.sourceLayerIndex=s.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=np([]),this.placementViewportMatrix=np([]);const h=this.layers[0]._unevaluatedLayout._values;this.textSizeData=n_(this.zoom,h["text-size"]),this.iconSizeData=n_(this.zoom,h["icon-size"]);const m=this.layers[0].layout,v=m.get("symbol-sort-key"),S=m.get("symbol-z-order");this.canOverlap=xp(m,"text-overlap","text-allow-overlap")!=="never"||xp(m,"icon-overlap","icon-allow-overlap")!=="never"||m.get("text-ignore-placement")||m.get("icon-ignore-placement"),this.sortFeaturesByKey=S!=="viewport-y"&&!v.isConstant(),this.sortFeaturesByY=(S==="viewport-y"||S==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,m.get("symbol-placement")==="point"&&(this.writingModes=m.get("text-writing-mode").map(T=>u.ah[T])),this.stateDependentLayerIds=this.layers.filter(T=>T.isStateDependent()).map(T=>T.id),this.sourceID=s.sourceID}createArrays(){this.text=new Sp(new Ar(this.layers,this.zoom,s=>/^text/.test(s))),this.icon=new Sp(new Ar(this.layers,this.zoom,s=>/^icon/.test(s))),this.glyphOffsetArray=new k,this.lineVertexArray=new I,this.symbolInstances=new b,this.textAnchorOffsets=new B}calculateGlyphDependencies(s,h,m,v,S){for(let T=0;T<s.length;T++)if(h[s.charCodeAt(T)]=!0,(m||v)&&S){const L=Rc[s.charAt(T)];L&&(h[L.charCodeAt(0)]=!0)}}populate(s,h,m){const v=this.layers[0],S=v.layout,T=S.get("text-font"),L=S.get("text-field"),R=S.get("icon-image"),O=(L.value.kind!=="constant"||L.value.value instanceof Yi&&!L.value.value.isEmpty()||L.value.value.toString().length>0)&&(T.value.kind!=="constant"||T.value.value.length>0),H=R.value.kind!=="constant"||!!R.value.value||Object.keys(R.parameters).length>0,X=S.get("symbol-sort-key");if(this.features=[],!O&&!H)return;const oe=h.iconDependencies,de=h.glyphDependencies,ge=h.availableImages,ve=new kr(this.zoom);for(const{feature:Me,id:Pe,index:He,sourceLayerIndex:ze}of s){const Ne=v._featureFilter.needGeometry,ct=js(Me,Ne);if(!v._featureFilter.filter(ve,ct,m))continue;let ft,Zt;if(Ne||(ct.geometry=Ns(Me)),O){const Vt=v.getValueAndResolveTokens("text-field",ct,m,ge),Nt=Yi.factory(Vt),Dt=this.hasRTLText=this.hasRTLText||I2(Nt);(!Dt||xs.getRTLTextPluginStatus()==="unavailable"||Dt&&xs.isParsed())&&(ft=h2(Nt,v,ct))}if(H){const Vt=v.getValueAndResolveTokens("icon-image",ct,m,ge);Zt=Vt instanceof fo?Vt:fo.fromString(Vt)}if(!ft&&!Zt)continue;const Yt=this.sortFeaturesByKey?X.evaluate(ct,{},m):void 0;if(this.features.push({id:Pe,text:ft,icon:Zt,index:He,sourceLayerIndex:ze,geometry:ct.geometry,properties:Me.properties,type:L2[Me.type],sortKey:Yt}),Zt&&(oe[Zt.name]=!0),ft){const Vt=T.evaluate(ct,{},m).join(","),Nt=S.get("text-rotation-alignment")!=="viewport"&&S.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(u.ah.vertical)>=0;for(const Dt of ft.sections)if(Dt.image)oe[Dt.image.name]=!0;else{const Ht=pa(ft.toString()),Ot=Dt.fontStack||Vt,Ct=de[Ot]=de[Ot]||{};this.calculateGlyphDependencies(Dt.text,Ct,Nt,this.allowVerticalPlacement,Ht)}}}S.get("symbol-placement")==="line"&&(this.features=function(Me){const Pe={},He={},ze=[];let Ne=0;function ct(Vt){ze.push(Me[Vt]),Ne++}function ft(Vt,Nt,Dt){const Ht=He[Vt];return delete He[Vt],He[Nt]=Ht,ze[Ht].geometry[0].pop(),ze[Ht].geometry[0]=ze[Ht].geometry[0].concat(Dt[0]),Ht}function Zt(Vt,Nt,Dt){const Ht=Pe[Nt];return delete Pe[Nt],Pe[Vt]=Ht,ze[Ht].geometry[0].shift(),ze[Ht].geometry[0]=Dt[0].concat(ze[Ht].geometry[0]),Ht}function Yt(Vt,Nt,Dt){const Ht=Dt?Nt[0][Nt[0].length-1]:Nt[0][0];return`${Vt}:${Ht.x}:${Ht.y}`}for(let Vt=0;Vt<Me.length;Vt++){const Nt=Me[Vt],Dt=Nt.geometry,Ht=Nt.text?Nt.text.toString():null;if(!Ht){ct(Vt);continue}const Ot=Yt(Ht,Dt),Ct=Yt(Ht,Dt,!0);if(Ot in He&&Ct in Pe&&He[Ot]!==Pe[Ct]){const sn=Zt(Ot,Ct,Dt),en=ft(Ot,Ct,ze[sn].geometry);delete Pe[Ot],delete He[Ct],He[Yt(Ht,ze[en].geometry,!0)]=en,ze[sn].geometry=null}else Ot in He?ft(Ot,Ct,Dt):Ct in Pe?Zt(Ot,Ct,Dt):(ct(Vt),Pe[Ot]=Ne-1,He[Ct]=Ne-1)}return ze.filter(Vt=>Vt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Me,Pe)=>Me.sortKey-Pe.sortKey)}update(s,h,m){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(s,h,this.layers,m),this.icon.programConfigurations.updatePaintArrays(s,h,this.layers,m))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(s){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(s),this.iconCollisionBox.upload(s)),this.text.upload(s,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(s,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(s,h){const m=this.lineVertexArray.length;if(s.segment!==void 0){let v=s.dist(h[s.segment+1]),S=s.dist(h[s.segment]);const T={};for(let L=s.segment+1;L<h.length;L++)T[L]={x:h[L].x,y:h[L].y,tileUnitDistanceFromAnchor:v},L<h.length-1&&(v+=h[L+1].dist(h[L]));for(let L=s.segment||0;L>=0;L--)T[L]={x:h[L].x,y:h[L].y,tileUnitDistanceFromAnchor:S},L>0&&(S+=h[L-1].dist(h[L]));for(let L=0;L<h.length;L++){const R=T[L];this.lineVertexArray.emplaceBack(R.x,R.y,R.tileUnitDistanceFromAnchor)}}return{lineStartIndex:m,lineLength:this.lineVertexArray.length-m}}addSymbols(s,h,m,v,S,T,L,R,O,H,X,oe){const de=s.indexArray,ge=s.layoutVertexArray,ve=s.segments.prepareSegment(4*h.length,ge,de,this.canOverlap?T.sortKey:void 0),Me=this.glyphOffsetArray.length,Pe=ve.vertexLength,He=this.allowVerticalPlacement&&L===u.ah.vertical?Math.PI/2:0,ze=T.text&&T.text.sections;for(let Ne=0;Ne<h.length;Ne++){const{tl:ct,tr:ft,bl:Zt,br:Yt,tex:Vt,pixelOffsetTL:Nt,pixelOffsetBR:Dt,minFontScaleX:Ht,minFontScaleY:Ot,glyphOffset:Ct,isSDF:sn,sectionIndex:en}=h[Ne],Dn=ve.vertexLength,vr=Ct[1];zf(ge,R.x,R.y,ct.x,vr+ct.y,Vt.x,Vt.y,m,sn,Nt.x,Nt.y,Ht,Ot),zf(ge,R.x,R.y,ft.x,vr+ft.y,Vt.x+Vt.w,Vt.y,m,sn,Dt.x,Nt.y,Ht,Ot),zf(ge,R.x,R.y,Zt.x,vr+Zt.y,Vt.x,Vt.y+Vt.h,m,sn,Nt.x,Dt.y,Ht,Ot),zf(ge,R.x,R.y,Yt.x,vr+Yt.y,Vt.x+Vt.w,Vt.y+Vt.h,m,sn,Dt.x,Dt.y,Ht,Ot),kp(s.dynamicLayoutVertexArray,R,He),de.emplaceBack(Dn,Dn+1,Dn+2),de.emplaceBack(Dn+1,Dn+2,Dn+3),ve.vertexLength+=4,ve.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Ct[0]),Ne!==h.length-1&&en===h[Ne+1].sectionIndex||s.programConfigurations.populatePaintArrays(ge.length,T,T.index,{},oe,ze&&ze[en])}s.placedSymbolArray.emplaceBack(R.x,R.y,Me,this.glyphOffsetArray.length-Me,Pe,O,H,R.segment,m?m[0]:0,m?m[1]:0,v[0],v[1],L,0,!1,0,X)}_addCollisionDebugVertex(s,h,m,v,S,T){return h.emplaceBack(0,0),s.emplaceBack(m.x,m.y,v,S,Math.round(T.x),Math.round(T.y))}addCollisionDebugVertices(s,h,m,v,S,T,L){const R=S.segments.prepareSegment(4,S.layoutVertexArray,S.indexArray),O=R.vertexLength,H=S.layoutVertexArray,X=S.collisionVertexArray,oe=L.anchorX,de=L.anchorY;this._addCollisionDebugVertex(H,X,T,oe,de,new y(s,h)),this._addCollisionDebugVertex(H,X,T,oe,de,new y(m,h)),this._addCollisionDebugVertex(H,X,T,oe,de,new y(m,v)),this._addCollisionDebugVertex(H,X,T,oe,de,new y(s,v)),R.vertexLength+=4;const ge=S.indexArray;ge.emplaceBack(O,O+1),ge.emplaceBack(O+1,O+2),ge.emplaceBack(O+2,O+3),ge.emplaceBack(O+3,O),R.primitiveLength+=4}addDebugCollisionBoxes(s,h,m,v){for(let S=s;S<h;S++){const T=this.collisionBoxArray.get(S);this.addCollisionDebugVertices(T.x1,T.y1,T.x2,T.y2,v?this.textCollisionBox:this.iconCollisionBox,T.anchorPoint,m)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Tp(nt,Ng.members,yt),this.iconCollisionBox=new Tp(nt,Ng.members,yt);for(let s=0;s<this.symbolInstances.length;s++){const h=this.symbolInstances.get(s);this.addDebugCollisionBoxes(h.textBoxStartIndex,h.textBoxEndIndex,h,!0),this.addDebugCollisionBoxes(h.verticalTextBoxStartIndex,h.verticalTextBoxEndIndex,h,!0),this.addDebugCollisionBoxes(h.iconBoxStartIndex,h.iconBoxEndIndex,h,!1),this.addDebugCollisionBoxes(h.verticalIconBoxStartIndex,h.verticalIconBoxEndIndex,h,!1)}}_deserializeCollisionBoxesForSymbol(s,h,m,v,S,T,L,R,O){const H={};for(let X=h;X<m;X++){const oe=s.get(X);H.textBox={x1:oe.x1,y1:oe.y1,x2:oe.x2,y2:oe.y2,anchorPointX:oe.anchorPointX,anchorPointY:oe.anchorPointY},H.textFeatureIndex=oe.featureIndex;break}for(let X=v;X<S;X++){const oe=s.get(X);H.verticalTextBox={x1:oe.x1,y1:oe.y1,x2:oe.x2,y2:oe.y2,anchorPointX:oe.anchorPointX,anchorPointY:oe.anchorPointY},H.verticalTextFeatureIndex=oe.featureIndex;break}for(let X=T;X<L;X++){const oe=s.get(X);H.iconBox={x1:oe.x1,y1:oe.y1,x2:oe.x2,y2:oe.y2,anchorPointX:oe.anchorPointX,anchorPointY:oe.anchorPointY},H.iconFeatureIndex=oe.featureIndex;break}for(let X=R;X<O;X++){const oe=s.get(X);H.verticalIconBox={x1:oe.x1,y1:oe.y1,x2:oe.x2,y2:oe.y2,anchorPointX:oe.anchorPointX,anchorPointY:oe.anchorPointY},H.verticalIconFeatureIndex=oe.featureIndex;break}return H}deserializeCollisionBoxes(s){this.collisionArrays=[];for(let h=0;h<this.symbolInstances.length;h++){const m=this.symbolInstances.get(h);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(s,m.textBoxStartIndex,m.textBoxEndIndex,m.verticalTextBoxStartIndex,m.verticalTextBoxEndIndex,m.iconBoxStartIndex,m.iconBoxEndIndex,m.verticalIconBoxStartIndex,m.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(s,h){const m=s.placedSymbolArray.get(h),v=m.vertexStartIndex+4*m.numGlyphs;for(let S=m.vertexStartIndex;S<v;S+=4)s.indexArray.emplaceBack(S,S+1,S+2),s.indexArray.emplaceBack(S+1,S+2,S+3)}getSortedSymbolIndexes(s){if(this.sortedAngle===s&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const h=Math.sin(s),m=Math.cos(s),v=[],S=[],T=[];for(let L=0;L<this.symbolInstances.length;++L){T.push(L);const R=this.symbolInstances.get(L);v.push(0|Math.round(h*R.anchorX+m*R.anchorY)),S.push(R.featureIndex)}return T.sort((L,R)=>v[L]-v[R]||S[R]-S[L]),T}addToSortKeyRanges(s,h){const m=this.sortKeyRanges[this.sortKeyRanges.length-1];m&&m.sortKey===h?m.symbolInstanceEnd=s+1:this.sortKeyRanges.push({sortKey:h,symbolInstanceStart:s,symbolInstanceEnd:s+1})}sortFeatures(s){if(this.sortFeaturesByY&&this.sortedAngle!==s&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(s),this.sortedAngle=s,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const h of this.symbolInstanceIndexes){const m=this.symbolInstances.get(h);this.featureSortOrder.push(m.featureIndex),[m.rightJustifiedTextSymbolIndex,m.centerJustifiedTextSymbolIndex,m.leftJustifiedTextSymbolIndex].forEach((v,S,T)=>{v>=0&&T.indexOf(v)===S&&this.addIndicesForPlacedSymbol(this.text,v)}),m.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,m.verticalPlacedTextSymbolIndex),m.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,m.placedIconSymbolIndex),m.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,m.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let r_,i_;Gt("SymbolBucket",yu,{omit:["layers","collisionBoxArray","features","compareText"]}),yu.MAX_GLYPHS=65535,yu.addDynamicAttributes=kp;var Cp={get paint(){return i_=i_||new $i({"icon-opacity":new ln(ye.paint_symbol["icon-opacity"]),"icon-color":new ln(ye.paint_symbol["icon-color"]),"icon-halo-color":new ln(ye.paint_symbol["icon-halo-color"]),"icon-halo-width":new ln(ye.paint_symbol["icon-halo-width"]),"icon-halo-blur":new ln(ye.paint_symbol["icon-halo-blur"]),"icon-translate":new tn(ye.paint_symbol["icon-translate"]),"icon-translate-anchor":new tn(ye.paint_symbol["icon-translate-anchor"]),"text-opacity":new ln(ye.paint_symbol["text-opacity"]),"text-color":new ln(ye.paint_symbol["text-color"],{runtimeType:Qn,getOverride:c=>c.textColor,hasOverride:c=>!!c.textColor}),"text-halo-color":new ln(ye.paint_symbol["text-halo-color"]),"text-halo-width":new ln(ye.paint_symbol["text-halo-width"]),"text-halo-blur":new ln(ye.paint_symbol["text-halo-blur"]),"text-translate":new tn(ye.paint_symbol["text-translate"]),"text-translate-anchor":new tn(ye.paint_symbol["text-translate-anchor"])})},get layout(){return r_=r_||new $i({"symbol-placement":new tn(ye.layout_symbol["symbol-placement"]),"symbol-spacing":new tn(ye.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new tn(ye.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new ln(ye.layout_symbol["symbol-sort-key"]),"symbol-z-order":new tn(ye.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new tn(ye.layout_symbol["icon-allow-overlap"]),"icon-overlap":new tn(ye.layout_symbol["icon-overlap"]),"icon-ignore-placement":new tn(ye.layout_symbol["icon-ignore-placement"]),"icon-optional":new tn(ye.layout_symbol["icon-optional"]),"icon-rotation-alignment":new tn(ye.layout_symbol["icon-rotation-alignment"]),"icon-size":new ln(ye.layout_symbol["icon-size"]),"icon-text-fit":new tn(ye.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new tn(ye.layout_symbol["icon-text-fit-padding"]),"icon-image":new ln(ye.layout_symbol["icon-image"]),"icon-rotate":new ln(ye.layout_symbol["icon-rotate"]),"icon-padding":new ln(ye.layout_symbol["icon-padding"]),"icon-keep-upright":new tn(ye.layout_symbol["icon-keep-upright"]),"icon-offset":new ln(ye.layout_symbol["icon-offset"]),"icon-anchor":new ln(ye.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new tn(ye.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new tn(ye.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new tn(ye.layout_symbol["text-rotation-alignment"]),"text-field":new ln(ye.layout_symbol["text-field"]),"text-font":new ln(ye.layout_symbol["text-font"]),"text-size":new ln(ye.layout_symbol["text-size"]),"text-max-width":new ln(ye.layout_symbol["text-max-width"]),"text-line-height":new tn(ye.layout_symbol["text-line-height"]),"text-letter-spacing":new ln(ye.layout_symbol["text-letter-spacing"]),"text-justify":new ln(ye.layout_symbol["text-justify"]),"text-radial-offset":new ln(ye.layout_symbol["text-radial-offset"]),"text-variable-anchor":new tn(ye.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new ln(ye.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new ln(ye.layout_symbol["text-anchor"]),"text-max-angle":new tn(ye.layout_symbol["text-max-angle"]),"text-writing-mode":new tn(ye.layout_symbol["text-writing-mode"]),"text-rotate":new ln(ye.layout_symbol["text-rotate"]),"text-padding":new tn(ye.layout_symbol["text-padding"]),"text-keep-upright":new tn(ye.layout_symbol["text-keep-upright"]),"text-transform":new ln(ye.layout_symbol["text-transform"]),"text-offset":new ln(ye.layout_symbol["text-offset"]),"text-allow-overlap":new tn(ye.layout_symbol["text-allow-overlap"]),"text-overlap":new tn(ye.layout_symbol["text-overlap"]),"text-ignore-placement":new tn(ye.layout_symbol["text-ignore-placement"]),"text-optional":new tn(ye.layout_symbol["text-optional"])})}};class o_{constructor(s){if(s.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=s.property.overrides?s.property.overrides.runtimeType:qn,this.defaultValue=s}evaluate(s){if(s.formattedSection){const h=this.defaultValue.property.overrides;if(h&&h.hasOverride(s.formattedSection))return h.getOverride(s.formattedSection)}return s.feature&&s.featureState?this.defaultValue.evaluate(s.feature,s.featureState):this.defaultValue.property.specification.default}eachChild(s){this.defaultValue.isConstant()||s(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Gt("FormatSectionOverride",o_,{omit:["defaultValue"]});class Df extends Co{constructor(s){super(s,Cp)}recalculate(s,h){if(super.recalculate(s,h),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const m=this.layout.get("text-writing-mode");if(m){const v=[];for(const S of m)v.indexOf(S)<0&&v.push(S);this.layout._values["text-writing-mode"]=v}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(s,h,m,v){const S=this.layout.get(s).evaluate(h,{},m,v),T=this._unevaluatedLayout._values[s];return T.isDataDriven()||fr(T.value)||!S?S:function(L,R){return R.replace(/{([^{}]+)}/g,(O,H)=>L&&H in L?String(L[H]):"")}(h.properties,S)}createBucket(s){return new yu(s)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const s of Cp.paint.overridableProperties){if(!Df.hasPaintOverride(this.layout,s))continue;const h=this.paint.get(s),m=new o_(h),v=new br(m,h.property.specification);let S=null;S=h.value.kind==="constant"||h.value.kind==="source"?new jl("source",v):new tc("composite",v,h.value.zoomStops),this.paint._values[s]=new To(h.property,S,h.parameters)}}_handleOverridablePaintPropertyUpdate(s,h,m){return!(!this.layout||h.isDataDriven()||m.isDataDriven())&&Df.hasPaintOverride(this.layout,s)}static hasPaintOverride(s,h){const m=s.get("text-field"),v=Cp.paint.properties[h];let S=!1;const T=L=>{for(const R of L)if(v.overrides&&v.overrides.hasOverride(R))return void(S=!0)};if(m.value.kind==="constant"&&m.value.value instanceof Yi)T(m.value.value.sections);else if(m.value.kind==="source"){const L=O=>{S||(O instanceof _s&&Wr(O.value)===er?T(O.value.sections):O instanceof Ol?T(O.sections):O.eachChild(L))},R=m.value;R._styleExpression&&L(R._styleExpression.expression)}return S}}let s_;var A2={get paint(){return s_=s_||new $i({"background-color":new tn(ye.paint_background["background-color"]),"background-pattern":new nl(ye.paint_background["background-pattern"]),"background-opacity":new tn(ye.paint_background["background-opacity"])})}};class P2 extends Co{constructor(s){super(s,A2)}}let a_;var z2={get paint(){return a_=a_||new $i({"raster-opacity":new tn(ye.paint_raster["raster-opacity"]),"raster-hue-rotate":new tn(ye.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new tn(ye.paint_raster["raster-brightness-min"]),"raster-brightness-max":new tn(ye.paint_raster["raster-brightness-max"]),"raster-saturation":new tn(ye.paint_raster["raster-saturation"]),"raster-contrast":new tn(ye.paint_raster["raster-contrast"]),"raster-resampling":new tn(ye.paint_raster["raster-resampling"]),"raster-fade-duration":new tn(ye.paint_raster["raster-fade-duration"])})}};class D2 extends Co{constructor(s){super(s,z2)}}class R2 extends Co{constructor(s){super(s,{}),this.onAdd=h=>{this.implementation.onAdd&&this.implementation.onAdd(h,h.painter.context.gl)},this.onRemove=h=>{this.implementation.onRemove&&this.implementation.onRemove(h,h.painter.context.gl)},this.implementation=s}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class F2{constructor(s){this._methodToThrottle=s,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const Mp=63710088e-1;class ba{constructor(s,h){if(isNaN(s)||isNaN(h))throw new Error(`Invalid LngLat object: (${s}, ${h})`);if(this.lng=+s,this.lat=+h,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new ba(ee(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(s){const h=Math.PI/180,m=this.lat*h,v=s.lat*h,S=Math.sin(m)*Math.sin(v)+Math.cos(m)*Math.cos(v)*Math.cos((s.lng-this.lng)*h);return Mp*Math.acos(Math.min(S,1))}static convert(s){if(s instanceof ba)return s;if(Array.isArray(s)&&(s.length===2||s.length===3))return new ba(Number(s[0]),Number(s[1]));if(!Array.isArray(s)&&typeof s=="object"&&s!==null)return new ba(Number("lng"in s?s.lng:s.lon),Number(s.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const l_=2*Math.PI*Mp;function u_(c){return l_*Math.cos(c*Math.PI/180)}function c_(c){return(180+c)/360}function h_(c){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+c*Math.PI/360)))/360}function f_(c,s){return c/u_(s)}function Lp(c){return 360/Math.PI*Math.atan(Math.exp((180-360*c)*Math.PI/180))-90}class Rf{constructor(s,h,m=0){this.x=+s,this.y=+h,this.z=+m}static fromLngLat(s,h=0){const m=ba.convert(s);return new Rf(c_(m.lng),h_(m.lat),f_(h,m.lat))}toLngLat(){return new ba(360*this.x-180,Lp(this.y))}toAltitude(){return this.z*u_(Lp(this.y))}meterInMercatorCoordinateUnits(){return 1/l_*(s=Lp(this.y),1/Math.cos(s*Math.PI/180));var s}}function d_(c,s,h){var m=2*Math.PI*6378137/256/Math.pow(2,h);return[c*m-2*Math.PI*6378137/2,s*m-2*Math.PI*6378137/2]}class Ep{constructor(s,h,m){if(s<0||s>25||m<0||m>=Math.pow(2,s)||h<0||h>=Math.pow(2,s))throw new Error(`x=${h}, y=${m}, z=${s} outside of bounds. 0<=x<${Math.pow(2,s)}, 0<=y<${Math.pow(2,s)} 0<=z<=25 `);this.z=s,this.x=h,this.y=m,this.key=Oc(0,s,s,h,m)}equals(s){return this.z===s.z&&this.x===s.x&&this.y===s.y}url(s,h,m){const v=(T=this.y,L=this.z,R=d_(256*(S=this.x),256*(T=Math.pow(2,L)-T-1),L),O=d_(256*(S+1),256*(T+1),L),R[0]+","+R[1]+","+O[0]+","+O[1]);var S,T,L,R,O;const H=function(X,oe,de){let ge,ve="";for(let Me=X;Me>0;Me--)ge=1<<Me-1,ve+=(oe&ge?1:0)+(de&ge?2:0);return ve}(this.z,this.x,this.y);return s[(this.x+this.y)%s.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(m==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,h>1?"@2x":"").replace(/{quadkey}/g,H).replace(/{bbox-epsg-3857}/g,v)}isChildOf(s){const h=this.z-s.z;return h>0&&s.x===this.x>>h&&s.y===this.y>>h}getTilePoint(s){const h=Math.pow(2,this.z);return new y((s.x*h-this.x)*Ur,(s.y*h-this.y)*Ur)}toString(){return`${this.z}/${this.x}/${this.y}`}}class p_{constructor(s,h){this.wrap=s,this.canonical=h,this.key=Oc(s,h.z,h.z,h.x,h.y)}}class Lo{constructor(s,h,m,v,S){if(s<m)throw new Error(`overscaledZ should be >= z; overscaledZ = ${s}; z = ${m}`);this.overscaledZ=s,this.wrap=h,this.canonical=new Ep(m,+v,+S),this.key=Oc(h,s,m,v,S)}clone(){return new Lo(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(s){return this.overscaledZ===s.overscaledZ&&this.wrap===s.wrap&&this.canonical.equals(s.canonical)}scaledTo(s){if(s>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${s}; overscaledZ = ${this.overscaledZ}`);const h=this.canonical.z-s;return s>this.canonical.z?new Lo(s,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Lo(s,this.wrap,s,this.canonical.x>>h,this.canonical.y>>h)}calculateScaledKey(s,h){if(s>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${s}; overscaledZ = ${this.overscaledZ}`);const m=this.canonical.z-s;return s>this.canonical.z?Oc(this.wrap*+h,s,this.canonical.z,this.canonical.x,this.canonical.y):Oc(this.wrap*+h,s,s,this.canonical.x>>m,this.canonical.y>>m)}isChildOf(s){if(s.wrap!==this.wrap)return!1;const h=this.canonical.z-s.canonical.z;return s.overscaledZ===0||s.overscaledZ<this.overscaledZ&&s.canonical.x===this.canonical.x>>h&&s.canonical.y===this.canonical.y>>h}children(s){if(this.overscaledZ>=s)return[new Lo(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const h=this.canonical.z+1,m=2*this.canonical.x,v=2*this.canonical.y;return[new Lo(h,this.wrap,h,m,v),new Lo(h,this.wrap,h,m+1,v),new Lo(h,this.wrap,h,m,v+1),new Lo(h,this.wrap,h,m+1,v+1)]}isLessThan(s){return this.wrap<s.wrap||!(this.wrap>s.wrap)&&(this.overscaledZ<s.overscaledZ||!(this.overscaledZ>s.overscaledZ)&&(this.canonical.x<s.canonical.x||!(this.canonical.x>s.canonical.x)&&this.canonical.y<s.canonical.y))}wrapped(){return new Lo(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(s){return new Lo(this.overscaledZ,s,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new p_(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(s){return this.canonical.getTilePoint(new Rf(s.x-this.wrap,s.y))}}function Oc(c,s,h,m,v){(c*=2)<0&&(c=-1*c-1);const S=1<<h;return(S*S*c+S*v+m).toString(36)+h.toString(36)+s.toString(36)}Gt("CanonicalTileID",Ep),Gt("OverscaledTileID",Lo,{omit:["posMatrix"]});class m_{constructor(s,h,m,v=1,S=1,T=1,L=0){if(this.uid=s,h.height!==h.width)throw new RangeError("DEM tiles must be square");if(m&&!["mapbox","terrarium","custom"].includes(m))return void Ce(`"${m}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=h.height;const R=this.dim=h.height-2;switch(this.data=new Uint32Array(h.data.buffer),m){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=v,this.greenFactor=S,this.blueFactor=T,this.baseShift=L;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let O=0;O<R;O++)this.data[this._idx(-1,O)]=this.data[this._idx(0,O)],this.data[this._idx(R,O)]=this.data[this._idx(R-1,O)],this.data[this._idx(O,-1)]=this.data[this._idx(O,0)],this.data[this._idx(O,R)]=this.data[this._idx(O,R-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(R,-1)]=this.data[this._idx(R-1,0)],this.data[this._idx(-1,R)]=this.data[this._idx(0,R-1)],this.data[this._idx(R,R)]=this.data[this._idx(R-1,R-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let O=0;O<R;O++)for(let H=0;H<R;H++){const X=this.get(O,H);X>this.max&&(this.max=X),X<this.min&&(this.min=X)}}get(s,h){const m=new Uint8Array(this.data.buffer),v=4*this._idx(s,h);return this.unpack(m[v],m[v+1],m[v+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(s,h){if(s<-1||s>=this.dim+1||h<-1||h>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(h+1)*this.stride+(s+1)}unpack(s,h,m){return s*this.redFactor+h*this.greenFactor+m*this.blueFactor-this.baseShift}getPixels(){return new Mo({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(s,h,m){if(this.dim!==s.dim)throw new Error("dem dimension mismatch");let v=h*this.dim,S=h*this.dim+this.dim,T=m*this.dim,L=m*this.dim+this.dim;switch(h){case-1:v=S-1;break;case 1:S=v+1}switch(m){case-1:T=L-1;break;case 1:L=T+1}const R=-h*this.dim,O=-m*this.dim;for(let H=T;H<L;H++)for(let X=v;X<S;X++)this.data[this._idx(X,H)]=s.data[this._idx(X+R,H+O)]}}Gt("DEMData",m_);class g_{constructor(s){this._stringToNumber={},this._numberToString=[];for(let h=0;h<s.length;h++){const m=s[h];this._stringToNumber[m]=h,this._numberToString[h]=m}}encode(s){return this._stringToNumber[s]}decode(s){if(s>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${s} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[s]}}class __{constructor(s,h,m,v,S){this.type="Feature",this._vectorTileFeature=s,s._z=h,s._x=m,s._y=v,this.properties=s.properties,this.id=S}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(s){this._geometry=s}toJSON(){const s={geometry:this.geometry};for(const h in this)h!=="_geometry"&&h!=="_vectorTileFeature"&&(s[h]=this[h]);return s}}class y_{constructor(s,h){this.tileID=s,this.x=s.canonical.x,this.y=s.canonical.y,this.z=s.canonical.z,this.grid=new Qa(Ur,16,0),this.grid3D=new Qa(Ur,16,0),this.featureIndexArray=new Y,this.promoteId=h}insert(s,h,m,v,S,T){const L=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(m,v,S);const R=T?this.grid3D:this.grid;for(let O=0;O<h.length;O++){const H=h[O],X=[1/0,1/0,-1/0,-1/0];for(let oe=0;oe<H.length;oe++){const de=H[oe];X[0]=Math.min(X[0],de.x),X[1]=Math.min(X[1],de.y),X[2]=Math.max(X[2],de.x),X[3]=Math.max(X[3],de.y)}X[0]<Ur&&X[1]<Ur&&X[2]>=0&&X[3]>=0&&R.insert(L,X[0],X[1],X[2],X[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new ga.VectorTile(new _p(this.rawTileData)).layers,this.sourceLayerCoder=new g_(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(s,h,m,v){this.loadVTLayers();const S=s.params||{},T=Ur/s.tileSize/s.scale,L=Zl(S.filter),R=s.queryGeometry,O=s.queryPadding*T,H=v_(R),X=this.grid.query(H.minX-O,H.minY-O,H.maxX+O,H.maxY+O),oe=v_(s.cameraQueryGeometry),de=this.grid3D.query(oe.minX-O,oe.minY-O,oe.maxX+O,oe.maxY+O,(Me,Pe,He,ze)=>function(Ne,ct,ft,Zt,Yt){for(const Nt of Ne)if(ct<=Nt.x&&ft<=Nt.y&&Zt>=Nt.x&&Yt>=Nt.y)return!0;const Vt=[new y(ct,ft),new y(ct,Yt),new y(Zt,Yt),new y(Zt,ft)];if(Ne.length>2){for(const Nt of Vt)if(hu(Ne,Nt))return!0}for(let Nt=0;Nt<Ne.length-1;Nt++)if(pw(Ne[Nt],Ne[Nt+1],Vt))return!0;return!1}(s.cameraQueryGeometry,Me-O,Pe-O,He+O,ze+O));for(const Me of de)X.push(Me);X.sort(B2);const ge={};let ve;for(let Me=0;Me<X.length;Me++){const Pe=X[Me];if(Pe===ve)continue;ve=Pe;const He=this.featureIndexArray.get(Pe);let ze=null;this.loadMatchingFeature(ge,He.bucketIndex,He.sourceLayerIndex,He.featureIndex,L,S.layers,S.availableImages,h,m,v,(Ne,ct,ft)=>(ze||(ze=Ns(Ne)),ct.queryIntersectsFeature(R,Ne,ft,ze,this.z,s.transform,T,s.pixelPosMatrix)))}return ge}loadMatchingFeature(s,h,m,v,S,T,L,R,O,H,X){const oe=this.bucketLayerIDs[h];if(T&&!function(Me,Pe){for(let He=0;He<Me.length;He++)if(Pe.indexOf(Me[He])>=0)return!0;return!1}(T,oe))return;const de=this.sourceLayerCoder.decode(m),ge=this.vtLayers[de].feature(v);if(S.needGeometry){const Me=js(ge,!0);if(!S.filter(new kr(this.tileID.overscaledZ),Me,this.tileID.canonical))return}else if(!S.filter(new kr(this.tileID.overscaledZ),ge))return;const ve=this.getId(ge,de);for(let Me=0;Me<oe.length;Me++){const Pe=oe[Me];if(T&&T.indexOf(Pe)<0)continue;const He=R[Pe];if(!He)continue;let ze={};ve&&H&&(ze=H.getState(He.sourceLayer||"_geojsonTileLayer",ve));const Ne=W({},O[Pe]);Ne.paint=b_(Ne.paint,He.paint,ge,ze,L),Ne.layout=b_(Ne.layout,He.layout,ge,ze,L);const ct=!X||X(ge,He,ze);if(!ct)continue;const ft=new __(ge,this.z,this.x,this.y,ve);ft.layer=Ne;let Zt=s[Pe];Zt===void 0&&(Zt=s[Pe]=[]),Zt.push({featureIndex:v,feature:ft,intersectionZ:ct})}}lookupSymbolFeatures(s,h,m,v,S,T,L,R){const O={};this.loadVTLayers();const H=Zl(S);for(const X of s)this.loadMatchingFeature(O,m,v,X,H,T,L,R,h);return O}hasLayer(s){for(const h of this.bucketLayerIDs)for(const m of h)if(s===m)return!0;return!1}getId(s,h){let m=s.id;return this.promoteId&&(m=s.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[h]],typeof m=="boolean"&&(m=Number(m))),m}}function b_(c,s,h,m,v){return he(c,(S,T)=>{const L=s instanceof tl?s.get(T):null;return L&&L.evaluate?L.evaluate(h,m,v):L})}function v_(c){let s=1/0,h=1/0,m=-1/0,v=-1/0;for(const S of c)s=Math.min(s,S.x),h=Math.min(h,S.y),m=Math.max(m,S.x),v=Math.max(v,S.y);return{minX:s,minY:h,maxX:m,maxY:v}}function B2(c,s){return s-c}function w_(c,s,h,m,v){const S=[];for(let T=0;T<c.length;T++){const L=c[T];let R;for(let O=0;O<L.length-1;O++){let H=L[O],X=L[O+1];H.x<s&&X.x<s||(H.x<s?H=new y(s,H.y+(s-H.x)/(X.x-H.x)*(X.y-H.y))._round():X.x<s&&(X=new y(s,H.y+(s-H.x)/(X.x-H.x)*(X.y-H.y))._round()),H.y<h&&X.y<h||(H.y<h?H=new y(H.x+(h-H.y)/(X.y-H.y)*(X.x-H.x),h)._round():X.y<h&&(X=new y(H.x+(h-H.y)/(X.y-H.y)*(X.x-H.x),h)._round()),H.x>=m&&X.x>=m||(H.x>=m?H=new y(m,H.y+(m-H.x)/(X.x-H.x)*(X.y-H.y))._round():X.x>=m&&(X=new y(m,H.y+(m-H.x)/(X.x-H.x)*(X.y-H.y))._round()),H.y>=v&&X.y>=v||(H.y>=v?H=new y(H.x+(v-H.y)/(X.y-H.y)*(X.x-H.x),v)._round():X.y>=v&&(X=new y(H.x+(v-H.y)/(X.y-H.y)*(X.x-H.x),v)._round()),R&&H.equals(R[R.length-1])||(R=[H],S.push(R)),R.push(X)))))}}return S}Gt("FeatureIndex",y_,{omit:["rawTileData","sourceLayerCoder"]});class va extends y{constructor(s,h,m,v){super(s,h),this.angle=m,v!==void 0&&(this.segment=v)}clone(){return new va(this.x,this.y,this.angle,this.segment)}}function x_(c,s,h,m,v){if(s.segment===void 0||h===0)return!0;let S=s,T=s.segment+1,L=0;for(;L>-h/2;){if(T--,T<0)return!1;L-=c[T].dist(S),S=c[T]}L+=c[T].dist(c[T+1]),T++;const R=[];let O=0;for(;L<h/2;){const H=c[T],X=c[T+1];if(!X)return!1;let oe=c[T-1].angleTo(H)-H.angleTo(X);for(oe=Math.abs((oe+3*Math.PI)%(2*Math.PI)-Math.PI),R.push({distance:L,angleDelta:oe}),O+=oe;L-R[0].distance>m;)O-=R.shift().angleDelta;if(O>v)return!1;T++,L+=H.dist(X)}return!0}function k_(c){let s=0;for(let h=0;h<c.length-1;h++)s+=c[h].dist(c[h+1]);return s}function S_(c,s,h){return c?.6*s*h:0}function T_(c,s){return Math.max(c?c.right-c.left:0,s?s.right-s.left:0)}function $2(c,s,h,m,v,S){const T=S_(h,v,S),L=T_(h,m)*S;let R=0;const O=k_(c)/2;for(let H=0;H<c.length-1;H++){const X=c[H],oe=c[H+1],de=X.dist(oe);if(R+de>O){const ge=(O-R)/de,ve=Li.number(X.x,oe.x,ge),Me=Li.number(X.y,oe.y,ge),Pe=new va(ve,Me,oe.angleTo(X),H);return Pe._round(),!T||x_(c,Pe,L,T,s)?Pe:void 0}R+=de}}function O2(c,s,h,m,v,S,T,L,R){const O=S_(m,S,T),H=T_(m,v),X=H*T,oe=c[0].x===0||c[0].x===R||c[0].y===0||c[0].y===R;return s-X<s/4&&(s=X+s/4),C_(c,oe?s/2*L%s:(H/2+2*S)*T*L%s,s,O,h,X,oe,!1,R)}function C_(c,s,h,m,v,S,T,L,R){const O=S/2,H=k_(c);let X=0,oe=s-h,de=[];for(let ge=0;ge<c.length-1;ge++){const ve=c[ge],Me=c[ge+1],Pe=ve.dist(Me),He=Me.angleTo(ve);for(;oe+h<X+Pe;){oe+=h;const ze=(oe-X)/Pe,Ne=Li.number(ve.x,Me.x,ze),ct=Li.number(ve.y,Me.y,ze);if(Ne>=0&&Ne<R&&ct>=0&&ct<R&&oe-O>=0&&oe+O<=H){const ft=new va(Ne,ct,He,ge);ft._round(),m&&!x_(c,ft,S,m,v)||de.push(ft)}}X+=Pe}return L||de.length||T||(de=C_(c,X/2,h,m,v,S,T,!0,R)),de}Gt("Anchor",va);const bu=ro;function M_(c,s,h,m){const v=[],S=c.image,T=S.pixelRatio,L=S.paddedRect.w-2*bu,R=S.paddedRect.h-2*bu,O=c.right-c.left,H=c.bottom-c.top,X=S.stretchX||[[0,L]],oe=S.stretchY||[[0,R]],de=(Dt,Ht)=>Dt+Ht[1]-Ht[0],ge=X.reduce(de,0),ve=oe.reduce(de,0),Me=L-ge,Pe=R-ve;let He=0,ze=ge,Ne=0,ct=ve,ft=0,Zt=Me,Yt=0,Vt=Pe;if(S.content&&m){const Dt=S.content;He=Ff(X,0,Dt[0]),Ne=Ff(oe,0,Dt[1]),ze=Ff(X,Dt[0],Dt[2]),ct=Ff(oe,Dt[1],Dt[3]),ft=Dt[0]-He,Yt=Dt[1]-Ne,Zt=Dt[2]-Dt[0]-ze,Vt=Dt[3]-Dt[1]-ct}const Nt=(Dt,Ht,Ot,Ct)=>{const sn=Bf(Dt.stretch-He,ze,O,c.left),en=$f(Dt.fixed-ft,Zt,Dt.stretch,ge),Dn=Bf(Ht.stretch-Ne,ct,H,c.top),vr=$f(Ht.fixed-Yt,Vt,Ht.stretch,ve),Tr=Bf(Ot.stretch-He,ze,O,c.left),ai=$f(Ot.fixed-ft,Zt,Ot.stretch,ge),go=Bf(Ct.stretch-Ne,ct,H,c.top),Ni=$f(Ct.fixed-Yt,Vt,Ct.stretch,ve),Yr=new y(sn,Dn),_i=new y(Tr,Dn),ki=new y(Tr,go),ji=new y(sn,go),Ui=new y(en/T,vr/T),li=new y(ai/T,Ni/T),ui=s*Math.PI/180;if(ui){const Ai=Math.sin(ui),io=Math.cos(ui),oo=[io,-Ai,Ai,io];Yr._matMult(oo),_i._matMult(oo),ji._matMult(oo),ki._matMult(oo)}const Ii=Dt.stretch+Dt.fixed,Vi=Ht.stretch+Ht.fixed;return{tl:Yr,tr:_i,bl:ji,br:ki,tex:{x:S.paddedRect.x+bu+Ii,y:S.paddedRect.y+bu+Vi,w:Ot.stretch+Ot.fixed-Ii,h:Ct.stretch+Ct.fixed-Vi},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Ui,pixelOffsetBR:li,minFontScaleX:Zt/T/O,minFontScaleY:Vt/T/H,isSDF:h}};if(m&&(S.stretchX||S.stretchY)){const Dt=L_(X,Me,ge),Ht=L_(oe,Pe,ve);for(let Ot=0;Ot<Dt.length-1;Ot++){const Ct=Dt[Ot],sn=Dt[Ot+1];for(let en=0;en<Ht.length-1;en++)v.push(Nt(Ct,Ht[en],sn,Ht[en+1]))}}else v.push(Nt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:L+1},{fixed:0,stretch:R+1}));return v}function Ff(c,s,h){let m=0;for(const v of c)m+=Math.max(s,Math.min(h,v[1]))-Math.max(s,Math.min(h,v[0]));return m}function L_(c,s,h){const m=[{fixed:-bu,stretch:0}];for(const[v,S]of c){const T=m[m.length-1];m.push({fixed:v-T.stretch,stretch:T.stretch}),m.push({fixed:v-T.stretch,stretch:T.stretch+(S-v)})}return m.push({fixed:s+bu,stretch:h}),m}function Bf(c,s,h,m){return c/s*h+m}function $f(c,s,h,m){return c-s*h/m}class Of{constructor(s,h,m,v,S,T,L,R,O,H){if(this.boxStartIndex=s.length,O){let X=T.top,oe=T.bottom;const de=T.collisionPadding;de&&(X-=de[1],oe+=de[3]);let ge=oe-X;ge>0&&(ge=Math.max(10,ge),this.circleDiameter=ge)}else{let X=T.top*L-R[0],oe=T.bottom*L+R[2],de=T.left*L-R[3],ge=T.right*L+R[1];const ve=T.collisionPadding;if(ve&&(de-=ve[0]*L,X-=ve[1]*L,ge+=ve[2]*L,oe+=ve[3]*L),H){const Me=new y(de,X),Pe=new y(ge,X),He=new y(de,oe),ze=new y(ge,oe),Ne=H*Math.PI/180;Me._rotate(Ne),Pe._rotate(Ne),He._rotate(Ne),ze._rotate(Ne),de=Math.min(Me.x,Pe.x,He.x,ze.x),ge=Math.max(Me.x,Pe.x,He.x,ze.x),X=Math.min(Me.y,Pe.y,He.y,ze.y),oe=Math.max(Me.y,Pe.y,He.y,ze.y)}s.emplaceBack(h.x,h.y,de,X,ge,oe,m,v,S)}this.boxEndIndex=s.length}}class N2{constructor(s=[],h=j2){if(this.data=s,this.length=this.data.length,this.compare=h,this.length>0)for(let m=(this.length>>1)-1;m>=0;m--)this._down(m)}push(s){this.data.push(s),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const s=this.data[0],h=this.data.pop();return this.length--,this.length>0&&(this.data[0]=h,this._down(0)),s}peek(){return this.data[0]}_up(s){const{data:h,compare:m}=this,v=h[s];for(;s>0;){const S=s-1>>1,T=h[S];if(m(v,T)>=0)break;h[s]=T,s=S}h[s]=v}_down(s){const{data:h,compare:m}=this,v=this.length>>1,S=h[s];for(;s<v;){let T=1+(s<<1),L=h[T];const R=T+1;if(R<this.length&&m(h[R],L)<0&&(T=R,L=h[R]),m(L,S)>=0)break;h[s]=L,s=T}h[s]=S}}function j2(c,s){return c<s?-1:c>s?1:0}function U2(c,s=1,h=!1){let m=1/0,v=1/0,S=-1/0,T=-1/0;const L=c[0];for(let de=0;de<L.length;de++){const ge=L[de];(!de||ge.x<m)&&(m=ge.x),(!de||ge.y<v)&&(v=ge.y),(!de||ge.x>S)&&(S=ge.x),(!de||ge.y>T)&&(T=ge.y)}const R=Math.min(S-m,T-v);let O=R/2;const H=new N2([],V2);if(R===0)return new y(m,v);for(let de=m;de<S;de+=R)for(let ge=v;ge<T;ge+=R)H.push(new vu(de+O,ge+O,O,c));let X=function(de){let ge=0,ve=0,Me=0;const Pe=de[0];for(let He=0,ze=Pe.length,Ne=ze-1;He<ze;Ne=He++){const ct=Pe[He],ft=Pe[Ne],Zt=ct.x*ft.y-ft.x*ct.y;ve+=(ct.x+ft.x)*Zt,Me+=(ct.y+ft.y)*Zt,ge+=3*Zt}return new vu(ve/ge,Me/ge,0,de)}(c),oe=H.length;for(;H.length;){const de=H.pop();(de.d>X.d||!X.d)&&(X=de,h&&console.log("found best %d after %d probes",Math.round(1e4*de.d)/1e4,oe)),de.max-X.d<=s||(O=de.h/2,H.push(new vu(de.p.x-O,de.p.y-O,O,c)),H.push(new vu(de.p.x+O,de.p.y-O,O,c)),H.push(new vu(de.p.x-O,de.p.y+O,O,c)),H.push(new vu(de.p.x+O,de.p.y+O,O,c)),oe+=4)}return h&&(console.log(`num probes: ${oe}`),console.log(`best distance: ${X.d}`)),X.p}function V2(c,s){return s.max-c.max}function vu(c,s,h,m){this.p=new y(c,s),this.h=h,this.d=function(v,S){let T=!1,L=1/0;for(let R=0;R<S.length;R++){const O=S[R];for(let H=0,X=O.length,oe=X-1;H<X;oe=H++){const de=O[H],ge=O[oe];de.y>v.y!=ge.y>v.y&&v.x<(ge.x-de.x)*(v.y-de.y)/(ge.y-de.y)+de.x&&(T=!T),L=Math.min(L,hg(v,de,ge))}}return(T?1:-1)*Math.sqrt(L)}(this.p,m),this.max=this.d+this.h*Math.SQRT2}var xi;u.ap=void 0,(xi=u.ap||(u.ap={}))[xi.center=1]="center",xi[xi.left=2]="left",xi[xi.right=3]="right",xi[xi.top=4]="top",xi[xi.bottom=5]="bottom",xi[xi["top-left"]=6]="top-left",xi[xi["top-right"]=7]="top-right",xi[xi["bottom-left"]=8]="bottom-left",xi[xi["bottom-right"]=9]="bottom-right";const wa=7,Ip=Number.POSITIVE_INFINITY;function E_(c,s){return s[1]!==Ip?function(h,m,v){let S=0,T=0;switch(m=Math.abs(m),v=Math.abs(v),h){case"top-right":case"top-left":case"top":T=v-wa;break;case"bottom-right":case"bottom-left":case"bottom":T=-v+wa}switch(h){case"top-right":case"bottom-right":case"right":S=-m;break;case"top-left":case"bottom-left":case"left":S=m}return[S,T]}(c,s[0],s[1]):function(h,m){let v=0,S=0;m<0&&(m=0);const T=m/Math.SQRT2;switch(h){case"top-right":case"top-left":S=T-wa;break;case"bottom-right":case"bottom-left":S=-T+wa;break;case"bottom":S=-m+wa;break;case"top":S=m-wa}switch(h){case"top-right":case"bottom-right":v=-T;break;case"top-left":case"bottom-left":v=T;break;case"left":v=m;break;case"right":v=-m}return[v,S]}(c,s[0])}function I_(c,s,h){var m;const v=c.layout,S=(m=v.get("text-variable-anchor-offset"))===null||m===void 0?void 0:m.evaluate(s,{},h);if(S){const L=S.values,R=[];for(let O=0;O<L.length;O+=2){const H=R[O]=L[O],X=L[O+1].map(oe=>oe*si);H.startsWith("top")?X[1]-=wa:H.startsWith("bottom")&&(X[1]+=wa),R[O+1]=X}return new ho(R)}const T=v.get("text-variable-anchor");if(T){let L;L=c._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[v.get("text-radial-offset").evaluate(s,{},h)*si,Ip]:v.get("text-offset").evaluate(s,{},h).map(O=>O*si);const R=[];for(const O of T)R.push(O,E_(O,L));return new ho(R)}return null}function Ap(c){switch(c){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function q2(c,s,h,m,v,S,T,L,R,O,H){let X=S.textMaxSize.evaluate(s,{});X===void 0&&(X=T);const oe=c.layers[0].layout,de=oe.get("icon-offset").evaluate(s,{},H),ge=P_(h.horizontal),ve=T/24,Me=c.tilePixelRatio*ve,Pe=c.tilePixelRatio*X/24,He=c.tilePixelRatio*L,ze=c.tilePixelRatio*oe.get("symbol-spacing"),Ne=oe.get("text-padding")*c.tilePixelRatio,ct=function(Ct,sn,en,Dn=1){const vr=Ct.get("icon-padding").evaluate(sn,{},en),Tr=vr&&vr.values;return[Tr[0]*Dn,Tr[1]*Dn,Tr[2]*Dn,Tr[3]*Dn]}(oe,s,H,c.tilePixelRatio),ft=oe.get("text-max-angle")/180*Math.PI,Zt=oe.get("text-rotation-alignment")!=="viewport"&&oe.get("symbol-placement")!=="point",Yt=oe.get("icon-rotation-alignment")==="map"&&oe.get("symbol-placement")!=="point",Vt=oe.get("symbol-placement"),Nt=ze/2,Dt=oe.get("icon-text-fit");let Ht;m&&Dt!=="none"&&(c.allowVerticalPlacement&&h.vertical&&(Ht=t_(m,h.vertical,Dt,oe.get("icon-text-fit-padding"),de,ve)),ge&&(m=t_(m,ge,Dt,oe.get("icon-text-fit-padding"),de,ve)));const Ot=(Ct,sn)=>{sn.x<0||sn.x>=Ur||sn.y<0||sn.y>=Ur||function(en,Dn,vr,Tr,ai,go,Ni,Yr,_i,ki,ji,Ui,li,ui,Ii,Vi,Ai,io,oo,ci,Bn,Pi,Si,hi,Wo){const as=en.addToLineVertexArray(Dn,vr);let ls,Vs,Ko,Eo,so=0,qs=0,Uc=0,F_=0,Op=-1,Np=-1;const Zs={};let B_=Br("");if(en.allowVerticalPlacement&&Tr.vertical){const zi=Yr.layout.get("text-rotate").evaluate(Bn,{},hi)+90;Ko=new Of(_i,Dn,ki,ji,Ui,Tr.vertical,li,ui,Ii,zi),Ni&&(Eo=new Of(_i,Dn,ki,ji,Ui,Ni,Ai,io,Ii,zi))}if(ai){const zi=Yr.layout.get("icon-rotate").evaluate(Bn,{}),Io=Yr.layout.get("icon-text-fit")!=="none",cl=M_(ai,zi,Si,Io),cs=Ni?M_(Ni,zi,Si,Io):void 0;Vs=new Of(_i,Dn,ki,ji,Ui,ai,Ai,io,!1,zi),so=4*cl.length;const hl=en.iconSizeData;let Ms=null;hl.kind==="source"?(Ms=[Cs*Yr.layout.get("icon-size").evaluate(Bn,{})],Ms[0]>ya&&Ce(`${en.layerIds[0]}: Value for "icon-size" is >= ${$c}. Reduce your "icon-size".`)):hl.kind==="composite"&&(Ms=[Cs*Pi.compositeIconSizes[0].evaluate(Bn,{},hi),Cs*Pi.compositeIconSizes[1].evaluate(Bn,{},hi)],(Ms[0]>ya||Ms[1]>ya)&&Ce(`${en.layerIds[0]}: Value for "icon-size" is >= ${$c}. Reduce your "icon-size".`)),en.addSymbols(en.icon,cl,Ms,ci,oo,Bn,u.ah.none,Dn,as.lineStartIndex,as.lineLength,-1,hi),Op=en.icon.placedSymbolArray.length-1,cs&&(qs=4*cs.length,en.addSymbols(en.icon,cs,Ms,ci,oo,Bn,u.ah.vertical,Dn,as.lineStartIndex,as.lineLength,-1,hi),Np=en.icon.placedSymbolArray.length-1)}const $_=Object.keys(Tr.horizontal);for(const zi of $_){const Io=Tr.horizontal[zi];if(!ls){B_=Br(Io.text);const cs=Yr.layout.get("text-rotate").evaluate(Bn,{},hi);ls=new Of(_i,Dn,ki,ji,Ui,Io,li,ui,Ii,cs)}const cl=Io.positionedLines.length===1;if(Uc+=A_(en,Dn,Io,go,Yr,Ii,Bn,Vi,as,Tr.vertical?u.ah.horizontal:u.ah.horizontalOnly,cl?$_:[zi],Zs,Op,Pi,hi),cl)break}Tr.vertical&&(F_+=A_(en,Dn,Tr.vertical,go,Yr,Ii,Bn,Vi,as,u.ah.vertical,["vertical"],Zs,Np,Pi,hi));const H2=ls?ls.boxStartIndex:en.collisionBoxArray.length,W2=ls?ls.boxEndIndex:en.collisionBoxArray.length,K2=Ko?Ko.boxStartIndex:en.collisionBoxArray.length,X2=Ko?Ko.boxEndIndex:en.collisionBoxArray.length,J2=Vs?Vs.boxStartIndex:en.collisionBoxArray.length,Y2=Vs?Vs.boxEndIndex:en.collisionBoxArray.length,Q2=Eo?Eo.boxStartIndex:en.collisionBoxArray.length,ex=Eo?Eo.boxEndIndex:en.collisionBoxArray.length;let us=-1;const jf=(zi,Io)=>zi&&zi.circleDiameter?Math.max(zi.circleDiameter,Io):Io;us=jf(ls,us),us=jf(Ko,us),us=jf(Vs,us),us=jf(Eo,us);const O_=us>-1?1:0;O_&&(us*=Wo/si),en.glyphOffsetArray.length>=yu.MAX_GLYPHS&&Ce("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Bn.sortKey!==void 0&&en.addToSortKeyRanges(en.symbolInstances.length,Bn.sortKey);const tx=I_(Yr,Bn,hi),[nx,rx]=function(zi,Io){const cl=zi.length,cs=Io==null?void 0:Io.values;if((cs==null?void 0:cs.length)>0)for(let hl=0;hl<cs.length;hl+=2){const Ms=cs[hl+1];zi.emplaceBack(u.ap[cs[hl]],Ms[0],Ms[1])}return[cl,zi.length]}(en.textAnchorOffsets,tx);en.symbolInstances.emplaceBack(Dn.x,Dn.y,Zs.right>=0?Zs.right:-1,Zs.center>=0?Zs.center:-1,Zs.left>=0?Zs.left:-1,Zs.vertical||-1,Op,Np,B_,H2,W2,K2,X2,J2,Y2,Q2,ex,ki,Uc,F_,so,qs,O_,0,li,us,nx,rx)}(c,sn,Ct,h,m,v,Ht,c.layers[0],c.collisionBoxArray,s.index,s.sourceLayerIndex,c.index,Me,[Ne,Ne,Ne,Ne],Zt,R,He,ct,Yt,de,s,S,O,H,T)};if(Vt==="line")for(const Ct of w_(s.geometry,0,0,Ur,Ur)){const sn=O2(Ct,ze,ft,h.vertical||ge,m,24,Pe,c.overscaling,Ur);for(const en of sn)ge&&Z2(c,ge.text,Nt,en)||Ot(Ct,en)}else if(Vt==="line-center"){for(const Ct of s.geometry)if(Ct.length>1){const sn=$2(Ct,ft,h.vertical||ge,m,24,Pe);sn&&Ot(Ct,sn)}}else if(s.type==="Polygon")for(const Ct of up(s.geometry,0)){const sn=U2(Ct,16);Ot(Ct[0],new va(sn.x,sn.y,0))}else if(s.type==="LineString")for(const Ct of s.geometry)Ot(Ct,new va(Ct[0].x,Ct[0].y,0));else if(s.type==="Point")for(const Ct of s.geometry)for(const sn of Ct)Ot([sn],new va(sn.x,sn.y,0))}function A_(c,s,h,m,v,S,T,L,R,O,H,X,oe,de,ge){const ve=function(He,ze,Ne,ct,ft,Zt,Yt,Vt){const Nt=ct.layout.get("text-rotate").evaluate(Zt,{})*Math.PI/180,Dt=[];for(const Ht of ze.positionedLines)for(const Ot of Ht.positionedGlyphs){if(!Ot.rect)continue;const Ct=Ot.rect||{};let sn=Wg+1,en=!0,Dn=1,vr=0;const Tr=(ft||Vt)&&Ot.vertical,ai=Ot.metrics.advance*Ot.scale/2;if(Vt&&ze.verticalizable&&(vr=Ht.lineOffset/2-(Ot.imageName?-(si-Ot.metrics.width*Ot.scale)/2:(Ot.scale-1)*si)),Ot.imageName){const ci=Yt[Ot.imageName];en=ci.sdf,Dn=ci.pixelRatio,sn=ro/Dn}const go=ft?[Ot.x+ai,Ot.y]:[0,0];let Ni=ft?[0,0]:[Ot.x+ai+Ne[0],Ot.y+Ne[1]-vr],Yr=[0,0];Tr&&(Yr=Ni,Ni=[0,0]);const _i=Ot.metrics.isDoubleResolution?2:1,ki=(Ot.metrics.left-sn)*Ot.scale-ai+Ni[0],ji=(-Ot.metrics.top-sn)*Ot.scale+Ni[1],Ui=ki+Ct.w/_i*Ot.scale/Dn,li=ji+Ct.h/_i*Ot.scale/Dn,ui=new y(ki,ji),Ii=new y(Ui,ji),Vi=new y(ki,li),Ai=new y(Ui,li);if(Tr){const ci=new y(-ai,ai-Fc),Bn=-Math.PI/2,Pi=si/2-ai,Si=new y(5-Fc-Pi,-(Ot.imageName?Pi:0)),hi=new y(...Yr);ui._rotateAround(Bn,ci)._add(Si)._add(hi),Ii._rotateAround(Bn,ci)._add(Si)._add(hi),Vi._rotateAround(Bn,ci)._add(Si)._add(hi),Ai._rotateAround(Bn,ci)._add(Si)._add(hi)}if(Nt){const ci=Math.sin(Nt),Bn=Math.cos(Nt),Pi=[Bn,-ci,ci,Bn];ui._matMult(Pi),Ii._matMult(Pi),Vi._matMult(Pi),Ai._matMult(Pi)}const io=new y(0,0),oo=new y(0,0);Dt.push({tl:ui,tr:Ii,bl:Vi,br:Ai,tex:Ct,writingMode:ze.writingMode,glyphOffset:go,sectionIndex:Ot.sectionIndex,isSDF:en,pixelOffsetTL:io,pixelOffsetBR:oo,minFontScaleX:0,minFontScaleY:0})}return Dt}(0,h,L,v,S,T,m,c.allowVerticalPlacement),Me=c.textSizeData;let Pe=null;Me.kind==="source"?(Pe=[Cs*v.layout.get("text-size").evaluate(T,{})],Pe[0]>ya&&Ce(`${c.layerIds[0]}: Value for "text-size" is >= ${$c}. Reduce your "text-size".`)):Me.kind==="composite"&&(Pe=[Cs*de.compositeTextSizes[0].evaluate(T,{},ge),Cs*de.compositeTextSizes[1].evaluate(T,{},ge)],(Pe[0]>ya||Pe[1]>ya)&&Ce(`${c.layerIds[0]}: Value for "text-size" is >= ${$c}. Reduce your "text-size".`)),c.addSymbols(c.text,ve,Pe,L,S,T,O,s,R.lineStartIndex,R.lineLength,oe,ge);for(const He of H)X[He]=c.text.placedSymbolArray.length-1;return 4*ve.length}function P_(c){for(const s in c)return c[s];return null}function Z2(c,s,h,m){const v=c.compareText;if(s in v){const S=v[s];for(let T=S.length-1;T>=0;T--)if(m.dist(S[T])<h)return!0}else v[s]=[];return v[s].push(m),!1}const z_=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Pp{static from(s){if(!(s instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[h,m]=new Uint8Array(s,0,2);if(h!==219)throw new Error("Data does not appear to be in a KDBush format.");const v=m>>4;if(v!==1)throw new Error(`Got v${v} data when expected v1.`);const S=z_[15&m];if(!S)throw new Error("Unrecognized array type.");const[T]=new Uint16Array(s,2,1),[L]=new Uint32Array(s,4,1);return new Pp(L,T,S,s)}constructor(s,h=64,m=Float64Array,v){if(isNaN(s)||s<0)throw new Error(`Unpexpected numItems value: ${s}.`);this.numItems=+s,this.nodeSize=Math.min(Math.max(+h,2),65535),this.ArrayType=m,this.IndexArrayType=s<65536?Uint16Array:Uint32Array;const S=z_.indexOf(this.ArrayType),T=2*s*this.ArrayType.BYTES_PER_ELEMENT,L=s*this.IndexArrayType.BYTES_PER_ELEMENT,R=(8-L%8)%8;if(S<0)throw new Error(`Unexpected typed array class: ${m}.`);v&&v instanceof ArrayBuffer?(this.data=v,this.ids=new this.IndexArrayType(this.data,8,s),this.coords=new this.ArrayType(this.data,8+L+R,2*s),this._pos=2*s,this._finished=!0):(this.data=new ArrayBuffer(8+T+L+R),this.ids=new this.IndexArrayType(this.data,8,s),this.coords=new this.ArrayType(this.data,8+L+R,2*s),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+S]),new Uint16Array(this.data,2,1)[0]=h,new Uint32Array(this.data,4,1)[0]=s)}add(s,h){const m=this._pos>>1;return this.ids[m]=m,this.coords[this._pos++]=s,this.coords[this._pos++]=h,m}finish(){const s=this._pos>>1;if(s!==this.numItems)throw new Error(`Added ${s} items when expected ${this.numItems}.`);return zp(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(s,h,m,v){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:S,coords:T,nodeSize:L}=this,R=[0,S.length-1,0],O=[];for(;R.length;){const H=R.pop()||0,X=R.pop()||0,oe=R.pop()||0;if(X-oe<=L){for(let Me=oe;Me<=X;Me++){const Pe=T[2*Me],He=T[2*Me+1];Pe>=s&&Pe<=m&&He>=h&&He<=v&&O.push(S[Me])}continue}const de=oe+X>>1,ge=T[2*de],ve=T[2*de+1];ge>=s&&ge<=m&&ve>=h&&ve<=v&&O.push(S[de]),(H===0?s<=ge:h<=ve)&&(R.push(oe),R.push(de-1),R.push(1-H)),(H===0?m>=ge:v>=ve)&&(R.push(de+1),R.push(X),R.push(1-H))}return O}within(s,h,m){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:v,coords:S,nodeSize:T}=this,L=[0,v.length-1,0],R=[],O=m*m;for(;L.length;){const H=L.pop()||0,X=L.pop()||0,oe=L.pop()||0;if(X-oe<=T){for(let Me=oe;Me<=X;Me++)R_(S[2*Me],S[2*Me+1],s,h)<=O&&R.push(v[Me]);continue}const de=oe+X>>1,ge=S[2*de],ve=S[2*de+1];R_(ge,ve,s,h)<=O&&R.push(v[de]),(H===0?s-m<=ge:h-m<=ve)&&(L.push(oe),L.push(de-1),L.push(1-H)),(H===0?s+m>=ge:h+m>=ve)&&(L.push(de+1),L.push(X),L.push(1-H))}return R}}function zp(c,s,h,m,v,S){if(v-m<=h)return;const T=m+v>>1;D_(c,s,T,m,v,S),zp(c,s,h,m,T-1,1-S),zp(c,s,h,T+1,v,1-S)}function D_(c,s,h,m,v,S){for(;v>m;){if(v-m>600){const O=v-m+1,H=h-m+1,X=Math.log(O),oe=.5*Math.exp(2*X/3),de=.5*Math.sqrt(X*oe*(O-oe)/O)*(H-O/2<0?-1:1);D_(c,s,h,Math.max(m,Math.floor(h-H*oe/O+de)),Math.min(v,Math.floor(h+(O-H)*oe/O+de)),S)}const T=s[2*h+S];let L=m,R=v;for(Nc(c,s,m,h),s[2*v+S]>T&&Nc(c,s,m,v);L<R;){for(Nc(c,s,L,R),L++,R--;s[2*L+S]<T;)L++;for(;s[2*R+S]>T;)R--}s[2*m+S]===T?Nc(c,s,m,R):(R++,Nc(c,s,R,v)),R<=h&&(m=R+1),h<=R&&(v=R-1)}}function Nc(c,s,h,m){Dp(c,h,m),Dp(s,2*h,2*m),Dp(s,2*h+1,2*m+1)}function Dp(c,s,h){const m=c[s];c[s]=c[h],c[h]=m}function R_(c,s,h,m){const v=c-h,S=s-m;return v*v+S*S}var Rp;u.bd=void 0,(Rp=u.bd||(u.bd={})).create="create",Rp.load="load",Rp.fullLoad="fullLoad";let Nf=null,jc=[];const Fp=1e3/60,Bp="loadTime",$p="fullLoadTime",G2={mark(c){performance.mark(c)},frame(c){const s=c;Nf!=null&&jc.push(s-Nf),Nf=s},clearMetrics(){Nf=null,jc=[],performance.clearMeasures(Bp),performance.clearMeasures($p);for(const c in u.bd)performance.clearMarks(u.bd[c])},getPerformanceMetrics(){performance.measure(Bp,u.bd.create,u.bd.load),performance.measure($p,u.bd.create,u.bd.fullLoad);const c=performance.getEntriesByName(Bp)[0].duration,s=performance.getEntriesByName($p)[0].duration,h=jc.length,m=1/(jc.reduce((S,T)=>S+T,0)/h/1e3),v=jc.filter(S=>S>Fp).reduce((S,T)=>S+(T-Fp)/Fp,0);return{loadTime:c,fullLoadTime:s,fps:m,percentDroppedFrames:v/(h+v)*100,totalFrames:h}}};u.$=Rt,u.A=fu,u.B=function(c){if(je==null){const s=c.navigator?c.navigator.userAgent:null;je=!!c.safari||!(!s||!(/\b(iPad|iPhone|iPod)\b/.test(s)||s.match("Safari")&&!s.match("Chrome")))}return je},u.C=class{constructor(c,s){this.target=c,this.mapId=s,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new F2(()=>this.process()),this.subscription=function(h,m,v,S){return h.addEventListener(m,v,!1),{unsubscribe:()=>{h.removeEventListener(m,v,!1)}}}(this.target,"message",h=>this.receive(h)),this.globalScope=Oe(self)?c:window}registerMessageHandler(c,s){this.messageHandlers[c]=s}sendAsync(c,s){return new Promise((h,m)=>{const v=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[v]={resolve:h,reject:m},s&&s.signal.addEventListener("abort",()=>{delete this.resolveRejects[v];const L={id:v,type:"<cancel>",origin:location.origin,targetMapId:c.targetMapId,sourceMapId:this.mapId};this.target.postMessage(L)},{once:!0});const S=[],T=Object.assign(Object.assign({},c),{id:v,sourceMapId:this.mapId,origin:location.origin,data:fa(c.data,S)});this.target.postMessage(T,{transfer:S})})}receive(c){const s=c.data,h=s.id;if(!(s.origin!=="file://"&&location.origin!=="file://"&&s.origin!==location.origin||s.targetMapId&&this.mapId!==s.targetMapId)){if(s.type==="<cancel>"){delete this.tasks[h];const m=this.abortControllers[h];return delete this.abortControllers[h],void(m&&m.abort())}if(Oe(self)||s.mustQueue)return this.tasks[h]=s,this.taskQueue.push(h),void this.invoker.trigger();this.processTask(h,s)}}process(){if(this.taskQueue.length===0)return;const c=this.taskQueue.shift(),s=this.tasks[c];delete this.tasks[c],this.taskQueue.length>0&&this.invoker.trigger(),s&&this.processTask(c,s)}processTask(c,s){return a(this,void 0,void 0,function*(){if(s.type==="<response>"){const v=this.resolveRejects[c];return delete this.resolveRejects[c],v?void(s.error?v.reject(da(s.error)):v.resolve(da(s.data))):void 0}if(!this.messageHandlers[s.type])return void this.completeTask(c,new Error(`Could not find a registered handler for ${s.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const h=da(s.data),m=new AbortController;this.abortControllers[c]=m;try{const v=yield this.messageHandlers[s.type](s.sourceMapId,h,m);this.completeTask(c,null,v)}catch(v){this.completeTask(c,v)}})}completeTask(c,s,h){const m=[];delete this.abortControllers[c];const v={id:c,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:s?fa(s):null,data:fa(h,m)};this.target.postMessage(v,{transfer:m})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},u.D=tn,u.E=Et,u.F=function(){var c=new fu(16);return fu!=Float32Array&&(c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[11]=0,c[12]=0,c[13]=0,c[14]=0),c[0]=1,c[5]=1,c[10]=1,c[15]=1,c},u.G=Bt,u.H=function(c,s,h){var m,v,S,T,L,R,O,H,X,oe,de,ge,ve=h[0],Me=h[1],Pe=h[2];return s===c?(c[12]=s[0]*ve+s[4]*Me+s[8]*Pe+s[12],c[13]=s[1]*ve+s[5]*Me+s[9]*Pe+s[13],c[14]=s[2]*ve+s[6]*Me+s[10]*Pe+s[14],c[15]=s[3]*ve+s[7]*Me+s[11]*Pe+s[15]):(v=s[1],S=s[2],T=s[3],L=s[4],R=s[5],O=s[6],H=s[7],X=s[8],oe=s[9],de=s[10],ge=s[11],c[0]=m=s[0],c[1]=v,c[2]=S,c[3]=T,c[4]=L,c[5]=R,c[6]=O,c[7]=H,c[8]=X,c[9]=oe,c[10]=de,c[11]=ge,c[12]=m*ve+L*Me+X*Pe+s[12],c[13]=v*ve+R*Me+oe*Pe+s[13],c[14]=S*ve+O*Me+de*Pe+s[14],c[15]=T*ve+H*Me+ge*Pe+s[15]),c},u.I=bp,u.J=function(c,s,h){var m=h[0],v=h[1],S=h[2];return c[0]=s[0]*m,c[1]=s[1]*m,c[2]=s[2]*m,c[3]=s[3]*m,c[4]=s[4]*v,c[5]=s[5]*v,c[6]=s[6]*v,c[7]=s[7]*v,c[8]=s[8]*S,c[9]=s[9]*S,c[10]=s[10]*S,c[11]=s[11]*S,c[12]=s[12],c[13]=s[13],c[14]=s[14],c[15]=s[15],c},u.K=mg,u.L=function(c,s){const h={};for(let m=0;m<s.length;m++){const v=s[m];v in c&&(h[v]=c[v])}return h},u.M=ba,u.N=c_,u.O=h_,u.P=y,u.Q=Lo,u.R=Mo,u.S=E,u.T=hc,u.U=P,u.V=ut,u.W=Ur,u.X=Zr,u.Y=Rf,u.Z=class extends pc{},u._=a,u.a=Ft,u.a$=function(c,s,h){return c[0]=s[0]*h[0],c[1]=s[1]*h[1],c[2]=s[2]*h[2],c[3]=s[3]*h[3],c},u.a0=Ep,u.a1=vt,u.a2=c=>{const s=window.document.createElement("video");return s.muted=!0,new Promise(h=>{s.onloadstart=()=>{h(s)};for(const m of c){const v=window.document.createElement("source");qt(m)||(s.crossOrigin="Anonymous"),v.src=m,s.appendChild(v)}})},u.a3=function(){return J++},u.a4=w,u.a5=yu,u.a6=Zl,u.a7=js,u.a8=kr,u.a9=__,u.aA=ne,u.aB=function(c,s){if(!c)return[{command:"setStyle",args:[s]}];let h=[];try{if(!it(c.version,s.version))return[{command:"setStyle",args:[s]}];it(c.center,s.center)||h.push({command:"setCenter",args:[s.center]}),it(c.zoom,s.zoom)||h.push({command:"setZoom",args:[s.zoom]}),it(c.bearing,s.bearing)||h.push({command:"setBearing",args:[s.bearing]}),it(c.pitch,s.pitch)||h.push({command:"setPitch",args:[s.pitch]}),it(c.sprite,s.sprite)||h.push({command:"setSprite",args:[s.sprite]}),it(c.glyphs,s.glyphs)||h.push({command:"setGlyphs",args:[s.glyphs]}),it(c.transition,s.transition)||h.push({command:"setTransition",args:[s.transition]}),it(c.light,s.light)||h.push({command:"setLight",args:[s.light]}),it(c.terrain,s.terrain)||h.push({command:"setTerrain",args:[s.terrain]}),it(c.sky,s.sky)||h.push({command:"setSky",args:[s.sky]});const m={},v=[];(function(T,L,R,O){let H;for(H in L=L||{},T=T||{})Object.prototype.hasOwnProperty.call(T,H)&&(Object.prototype.hasOwnProperty.call(L,H)||_r(H,R,O));for(H in L)Object.prototype.hasOwnProperty.call(L,H)&&(Object.prototype.hasOwnProperty.call(T,H)?it(T[H],L[H])||(T[H].type==="geojson"&&L[H].type==="geojson"&&ni(T,L,H)?Wt(R,{command:"setGeoJSONSourceData",args:[H,L[H].data]}):yr(H,L,R,O)):cr(H,L,R))})(c.sources,s.sources,v,m);const S=[];c.layers&&c.layers.forEach(T=>{"source"in T&&m[T.source]?h.push({command:"removeLayer",args:[T.id]}):S.push(T)}),h=h.concat(v),function(T,L,R){L=L||[];const O=(T=T||[]).map(xo),H=L.map(xo),X=T.reduce(hr,{}),oe=L.reduce(hr,{}),de=O.slice(),ge=Object.create(null);let ve,Me,Pe,He,ze;for(let Ne=0,ct=0;Ne<O.length;Ne++)ve=O[Ne],Object.prototype.hasOwnProperty.call(oe,ve)?ct++:(Wt(R,{command:"removeLayer",args:[ve]}),de.splice(de.indexOf(ve,ct),1));for(let Ne=0,ct=0;Ne<H.length;Ne++)ve=H[H.length-1-Ne],de[de.length-1-Ne]!==ve&&(Object.prototype.hasOwnProperty.call(X,ve)?(Wt(R,{command:"removeLayer",args:[ve]}),de.splice(de.lastIndexOf(ve,de.length-ct),1)):ct++,He=de[de.length-Ne],Wt(R,{command:"addLayer",args:[oe[ve],He]}),de.splice(de.length-Ne,0,ve),ge[ve]=!0);for(let Ne=0;Ne<H.length;Ne++)if(ve=H[Ne],Me=X[ve],Pe=oe[ve],!ge[ve]&&!it(Me,Pe))if(it(Me.source,Pe.source)&&it(Me["source-layer"],Pe["source-layer"])&&it(Me.type,Pe.type)){for(ze in jr(Me.layout,Pe.layout,R,ve,null,"setLayoutProperty"),jr(Me.paint,Pe.paint,R,ve,null,"setPaintProperty"),it(Me.filter,Pe.filter)||Wt(R,{command:"setFilter",args:[ve,Pe.filter]}),it(Me.minzoom,Pe.minzoom)&&it(Me.maxzoom,Pe.maxzoom)||Wt(R,{command:"setLayerZoomRange",args:[ve,Pe.minzoom,Pe.maxzoom]}),Me)Object.prototype.hasOwnProperty.call(Me,ze)&&ze!=="layout"&&ze!=="paint"&&ze!=="filter"&&ze!=="metadata"&&ze!=="minzoom"&&ze!=="maxzoom"&&(ze.indexOf("paint.")===0?jr(Me[ze],Pe[ze],R,ve,ze.slice(6),"setPaintProperty"):it(Me[ze],Pe[ze])||Wt(R,{command:"setLayerProperty",args:[ve,ze,Pe[ze]]}));for(ze in Pe)Object.prototype.hasOwnProperty.call(Pe,ze)&&!Object.prototype.hasOwnProperty.call(Me,ze)&&ze!=="layout"&&ze!=="paint"&&ze!=="filter"&&ze!=="metadata"&&ze!=="minzoom"&&ze!=="maxzoom"&&(ze.indexOf("paint.")===0?jr(Me[ze],Pe[ze],R,ve,ze.slice(6),"setPaintProperty"):it(Me[ze],Pe[ze])||Wt(R,{command:"setLayerProperty",args:[ve,ze,Pe[ze]]}))}else Wt(R,{command:"removeLayer",args:[ve]}),He=de[de.lastIndexOf(ve)+1],Wt(R,{command:"addLayer",args:[Pe,He]})}(S,s.layers,h)}catch(m){console.warn("Unable to compute style diff:",m),h=[{command:"setStyle",args:[s]}]}return h},u.aC=function(c){const s=[],h=c.id;return h===void 0&&s.push({message:`layers.${h}: missing required property "id"`}),c.render===void 0&&s.push({message:`layers.${h}: missing required method "render"`}),c.renderingMode&&c.renderingMode!=="2d"&&c.renderingMode!=="3d"&&s.push({message:`layers.${h}: property "renderingMode" must be either "2d" or "3d"`}),s},u.aD=function c(s,h){if(Array.isArray(s)){if(!Array.isArray(h)||s.length!==h.length)return!1;for(let m=0;m<s.length;m++)if(!c(s[m],h[m]))return!1;return!0}if(typeof s=="object"&&s!==null&&h!==null){if(typeof h!="object"||Object.keys(s).length!==Object.keys(h).length)return!1;for(const m in s)if(!c(s[m],h[m]))return!1;return!0}return s===h},u.aE=he,u.aF=Ae,u.aG=class extends oi{constructor(c,s){super(c,s),this.current=0}set(c){this.current!==c&&(this.current=c,this.gl.uniform1i(this.location,c))}},u.aH=no,u.aI=class extends oi{constructor(c,s){super(c,s),this.current=ll}set(c){if(c[12]!==this.current[12]||c[0]!==this.current[0])return this.current=c,void this.gl.uniformMatrix4fv(this.location,!1,c);for(let s=1;s<16;s++)if(c[s]!==this.current[s]){this.current=c,this.gl.uniformMatrix4fv(this.location,!1,c);break}}},u.aJ=Go,u.aK=class extends oi{constructor(c,s){super(c,s),this.current=[0,0,0]}set(c){c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]||(this.current=c,this.gl.uniform3f(this.location,c[0],c[1],c[2]))}},u.aL=class extends oi{constructor(c,s){super(c,s),this.current=[0,0]}set(c){c[0]===this.current[0]&&c[1]===this.current[1]||(this.current=c,this.gl.uniform2f(this.location,c[0],c[1]))}},u.aM=ks,u.aN=function(c,s,h,m,v,S,T){var L=1/(s-h),R=1/(m-v),O=1/(S-T);return c[0]=-2*L,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=-2*R,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=2*O,c[11]=0,c[12]=(s+h)*L,c[13]=(v+m)*R,c[14]=(T+S)*O,c[15]=1,c},u.aO=tr,u.aP=gw,u.aQ=class extends iu{},u.aR=c2,u.aS=class extends ou{},u.aT=function(c){return c<=1?1:Math.pow(2,Math.ceil(Math.log(c)/Math.LN2))},u.aU=vg,u.aV=te,u.aW=class extends vc{},u.aX=at,u.aY=function(c,s){return c[0]===s[0]&&c[1]===s[1]&&c[2]===s[2]&&c[3]===s[3]&&c[4]===s[4]&&c[5]===s[5]&&c[6]===s[6]&&c[7]===s[7]&&c[8]===s[8]&&c[9]===s[9]&&c[10]===s[10]&&c[11]===s[11]&&c[12]===s[12]&&c[13]===s[13]&&c[14]===s[14]&&c[15]===s[15]},u.aZ=function(c,s){var h=c[0],m=c[1],v=c[2],S=c[3],T=c[4],L=c[5],R=c[6],O=c[7],H=c[8],X=c[9],oe=c[10],de=c[11],ge=c[12],ve=c[13],Me=c[14],Pe=c[15],He=s[0],ze=s[1],Ne=s[2],ct=s[3],ft=s[4],Zt=s[5],Yt=s[6],Vt=s[7],Nt=s[8],Dt=s[9],Ht=s[10],Ot=s[11],Ct=s[12],sn=s[13],en=s[14],Dn=s[15];return Math.abs(h-He)<=Oi*Math.max(1,Math.abs(h),Math.abs(He))&&Math.abs(m-ze)<=Oi*Math.max(1,Math.abs(m),Math.abs(ze))&&Math.abs(v-Ne)<=Oi*Math.max(1,Math.abs(v),Math.abs(Ne))&&Math.abs(S-ct)<=Oi*Math.max(1,Math.abs(S),Math.abs(ct))&&Math.abs(T-ft)<=Oi*Math.max(1,Math.abs(T),Math.abs(ft))&&Math.abs(L-Zt)<=Oi*Math.max(1,Math.abs(L),Math.abs(Zt))&&Math.abs(R-Yt)<=Oi*Math.max(1,Math.abs(R),Math.abs(Yt))&&Math.abs(O-Vt)<=Oi*Math.max(1,Math.abs(O),Math.abs(Vt))&&Math.abs(H-Nt)<=Oi*Math.max(1,Math.abs(H),Math.abs(Nt))&&Math.abs(X-Dt)<=Oi*Math.max(1,Math.abs(X),Math.abs(Dt))&&Math.abs(oe-Ht)<=Oi*Math.max(1,Math.abs(oe),Math.abs(Ht))&&Math.abs(de-Ot)<=Oi*Math.max(1,Math.abs(de),Math.abs(Ot))&&Math.abs(ge-Ct)<=Oi*Math.max(1,Math.abs(ge),Math.abs(Ct))&&Math.abs(ve-sn)<=Oi*Math.max(1,Math.abs(ve),Math.abs(sn))&&Math.abs(Me-en)<=Oi*Math.max(1,Math.abs(Me),Math.abs(en))&&Math.abs(Pe-Dn)<=Oi*Math.max(1,Math.abs(Pe),Math.abs(Dn))},u.a_=function(c,s){return c[0]=s[0],c[1]=s[1],c[2]=s[2],c[3]=s[3],c[4]=s[4],c[5]=s[5],c[6]=s[6],c[7]=s[7],c[8]=s[8],c[9]=s[9],c[10]=s[10],c[11]=s[11],c[12]=s[12],c[13]=s[13],c[14]=s[14],c[15]=s[15],c},u.aa=function(c){const s={};if(c.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(h,m,v,S)=>{const T=v||S;return s[m]=!T||T.toLowerCase(),""}),s["max-age"]){const h=parseInt(s["max-age"],10);isNaN(h)?delete s["max-age"]:s["max-age"]=h}return s},u.ab=function(c,s){const h=[];for(const m in c)m in s||h.push(m);return h},u.ac=K,u.ad=function(c,s,h){var m=Math.sin(h),v=Math.cos(h),S=s[0],T=s[1],L=s[2],R=s[3],O=s[4],H=s[5],X=s[6],oe=s[7];return s!==c&&(c[8]=s[8],c[9]=s[9],c[10]=s[10],c[11]=s[11],c[12]=s[12],c[13]=s[13],c[14]=s[14],c[15]=s[15]),c[0]=S*v+O*m,c[1]=T*v+H*m,c[2]=L*v+X*m,c[3]=R*v+oe*m,c[4]=O*v-S*m,c[5]=H*v-T*m,c[6]=X*v-L*m,c[7]=oe*v-R*m,c},u.ae=function(c){var s=new fu(16);return s[0]=c[0],s[1]=c[1],s[2]=c[2],s[3]=c[3],s[4]=c[4],s[5]=c[5],s[6]=c[6],s[7]=c[7],s[8]=c[8],s[9]=c[9],s[10]=c[10],s[11]=c[11],s[12]=c[12],s[13]=c[13],s[14]=c[14],s[15]=c[15],s},u.af=Sf,u.ag=function(c,s){let h=0,m=0;if(c.kind==="constant")m=c.layoutSize;else if(c.kind!=="source"){const{interpolationType:v,minZoom:S,maxZoom:T}=c,L=v?K(wi.interpolationFactor(v,s,S,T),0,1):0;c.kind==="camera"?m=Li.number(c.minSize,c.maxSize,L):h=L}return{uSizeT:h,uSize:m}},u.ai=function(c,{uSize:s,uSizeT:h},{lowerSize:m,upperSize:v}){return c.kind==="source"?m/Cs:c.kind==="composite"?Li.number(m/Cs,v/Cs,h):s},u.aj=kp,u.ak=function(c,s,h,m){const v=s.y-c.y,S=s.x-c.x,T=m.y-h.y,L=m.x-h.x,R=T*S-L*v;if(R===0)return null;const O=(L*(c.y-h.y)-T*(c.x-h.x))/R;return new y(c.x+O*S,c.y+O*v)},u.al=w_,u.am=xc,u.an=np,u.ao=si,u.aq=xp,u.ar=function(c,s){var h=s[0],m=s[1],v=s[2],S=s[3],T=s[4],L=s[5],R=s[6],O=s[7],H=s[8],X=s[9],oe=s[10],de=s[11],ge=s[12],ve=s[13],Me=s[14],Pe=s[15],He=h*L-m*T,ze=h*R-v*T,Ne=h*O-S*T,ct=m*R-v*L,ft=m*O-S*L,Zt=v*O-S*R,Yt=H*ve-X*ge,Vt=H*Me-oe*ge,Nt=H*Pe-de*ge,Dt=X*Me-oe*ve,Ht=X*Pe-de*ve,Ot=oe*Pe-de*Me,Ct=He*Ot-ze*Ht+Ne*Dt+ct*Nt-ft*Vt+Zt*Yt;return Ct?(c[0]=(L*Ot-R*Ht+O*Dt)*(Ct=1/Ct),c[1]=(v*Ht-m*Ot-S*Dt)*Ct,c[2]=(ve*Zt-Me*ft+Pe*ct)*Ct,c[3]=(oe*ft-X*Zt-de*ct)*Ct,c[4]=(R*Nt-T*Ot-O*Vt)*Ct,c[5]=(h*Ot-v*Nt+S*Vt)*Ct,c[6]=(Me*Ne-ge*Zt-Pe*ze)*Ct,c[7]=(H*Zt-oe*Ne+de*ze)*Ct,c[8]=(T*Ht-L*Nt+O*Yt)*Ct,c[9]=(m*Nt-h*Ht-S*Yt)*Ct,c[10]=(ge*ft-ve*Ne+Pe*He)*Ct,c[11]=(X*Ne-H*ft-de*He)*Ct,c[12]=(L*Vt-T*Dt-R*Yt)*Ct,c[13]=(h*Dt-m*Vt+v*Yt)*Ct,c[14]=(ve*ze-ge*ct-Me*He)*Ct,c[15]=(H*ct-X*ze+oe*He)*Ct,c):null},u.as=Ap,u.at=wp,u.au=Pp,u.av=function(){const c={},s=ye.$version;for(const h in ye.$root){const m=ye.$root[h];if(m.required){let v=null;v=h==="version"?s:m.type==="array"?[]:{},v!=null&&(c[h]=v)}}return c},u.aw=cf,u.ax=Qt,u.ay=function(c){c=c.slice();const s=Object.create(null);for(let h=0;h<c.length;h++)s[c[h].id]=c[h];for(let h=0;h<c.length;h++)"ref"in c[h]&&(c[h]=Ue(c[h],s[c[h].ref]));return c},u.az=function(c){if(c.type==="custom")return new R2(c);switch(c.type){case"background":return new P2(c);case"circle":return new _w(c);case"fill":return new Bw(c);case"fill-extrusion":return new Yw(c);case"heatmap":return new bw(c);case"hillshade":return new ww(c);case"line":return new s2(c);case"raster":return new D2(c);case"symbol":return new Df(c)}},u.b=De,u.b0=function(c,s){return c[0]*s[0]+c[1]*s[1]+c[2]*s[2]+c[3]*s[3]},u.b1=ee,u.b2=p_,u.b3=f_,u.b4=function(c,s,h,m,v){var S,T=1/Math.tan(s/2);return c[0]=T/h,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=T,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[11]=-1,c[12]=0,c[13]=0,c[15]=0,v!=null&&v!==1/0?(c[10]=(v+m)*(S=1/(m-v)),c[14]=2*v*m*S):(c[10]=-1,c[14]=-2*m),c},u.b5=function(c,s,h){var m=Math.sin(h),v=Math.cos(h),S=s[4],T=s[5],L=s[6],R=s[7],O=s[8],H=s[9],X=s[10],oe=s[11];return s!==c&&(c[0]=s[0],c[1]=s[1],c[2]=s[2],c[3]=s[3],c[12]=s[12],c[13]=s[13],c[14]=s[14],c[15]=s[15]),c[4]=S*v+O*m,c[5]=T*v+H*m,c[6]=L*v+X*m,c[7]=R*v+oe*m,c[8]=O*v-S*m,c[9]=H*v-T*m,c[10]=X*v-L*m,c[11]=oe*v-R*m,c},u.b6=$,u.b7=U,u.b8=function(c){return c*Math.PI/180},u.b9=function(c,s){return c[0]=s[0],c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=s[1],c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=s[2],c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c},u.bA=xs,u.ba=class extends os{},u.bb=Mp,u.bc=G2,u.be=Pt,u.bf=function(c,s){Ft.REGISTERED_PROTOCOLS[c]=s},u.bg=function(c){delete Ft.REGISTERED_PROTOCOLS[c]},u.bh=function(c,s){const h={};for(let v=0;v<c.length;v++){const S=s&&s[c[v].id]||Jd(c[v]);s&&(s[c[v].id]=S);let T=h[S];T||(T=h[S]=[]),T.push(c[v])}const m=[];for(const v in h)m.push(h[v]);return m},u.bi=Gt,u.bj=g_,u.bk=y_,u.bl=Xg,u.bm=function(c){c.bucket.createArrays(),c.bucket.tilePixelRatio=Ur/(512*c.bucket.overscaling),c.bucket.compareText={},c.bucket.iconsNeedLinear=!1;const s=c.bucket.layers[0],h=s.layout,m=s._unevaluatedLayout._values,v={layoutIconSize:m["icon-size"].possiblyEvaluate(new kr(c.bucket.zoom+1),c.canonical),layoutTextSize:m["text-size"].possiblyEvaluate(new kr(c.bucket.zoom+1),c.canonical),textMaxSize:m["text-size"].possiblyEvaluate(new kr(18))};if(c.bucket.textSizeData.kind==="composite"){const{minZoom:O,maxZoom:H}=c.bucket.textSizeData;v.compositeTextSizes=[m["text-size"].possiblyEvaluate(new kr(O),c.canonical),m["text-size"].possiblyEvaluate(new kr(H),c.canonical)]}if(c.bucket.iconSizeData.kind==="composite"){const{minZoom:O,maxZoom:H}=c.bucket.iconSizeData;v.compositeIconSizes=[m["icon-size"].possiblyEvaluate(new kr(O),c.canonical),m["icon-size"].possiblyEvaluate(new kr(H),c.canonical)]}const S=h.get("text-line-height")*si,T=h.get("text-rotation-alignment")!=="viewport"&&h.get("symbol-placement")!=="point",L=h.get("text-keep-upright"),R=h.get("text-size");for(const O of c.bucket.features){const H=h.get("text-font").evaluate(O,{},c.canonical).join(","),X=R.evaluate(O,{},c.canonical),oe=v.layoutTextSize.evaluate(O,{},c.canonical),de=v.layoutIconSize.evaluate(O,{},c.canonical),ge={horizontal:{},vertical:void 0},ve=O.text;let Me,Pe=[0,0];if(ve){const Ne=ve.toString(),ct=h.get("text-letter-spacing").evaluate(O,{},c.canonical)*si,ft=hf(Ne)?ct:0,Zt=h.get("text-anchor").evaluate(O,{},c.canonical),Yt=I_(s,O,c.canonical);if(!Yt){const Ot=h.get("text-radial-offset").evaluate(O,{},c.canonical);Pe=Ot?E_(Zt,[Ot*si,Ip]):h.get("text-offset").evaluate(O,{},c.canonical).map(Ct=>Ct*si)}let Vt=T?"center":h.get("text-justify").evaluate(O,{},c.canonical);const Nt=h.get("symbol-placement"),Dt=Nt==="point"?h.get("text-max-width").evaluate(O,{},c.canonical)*si:0,Ht=()=>{c.bucket.allowVerticalPlacement&&pa(Ne)&&(ge.vertical=Af(ve,c.glyphMap,c.glyphPositions,c.imagePositions,H,Dt,S,Zt,"left",ft,Pe,u.ah.vertical,!0,Nt,oe,X))};if(!T&&Yt){const Ot=new Set;if(Vt==="auto")for(let sn=0;sn<Yt.values.length;sn+=2)Ot.add(Ap(Yt.values[sn]));else Ot.add(Vt);let Ct=!1;for(const sn of Ot)if(!ge.horizontal[sn])if(Ct)ge.horizontal[sn]=ge.horizontal[0];else{const en=Af(ve,c.glyphMap,c.glyphPositions,c.imagePositions,H,Dt,S,"center",sn,ft,Pe,u.ah.horizontal,!1,Nt,oe,X);en&&(ge.horizontal[sn]=en,Ct=en.positionedLines.length===1)}Ht()}else{Vt==="auto"&&(Vt=Ap(Zt));const Ot=Af(ve,c.glyphMap,c.glyphPositions,c.imagePositions,H,Dt,S,Zt,Vt,ft,Pe,u.ah.horizontal,!1,Nt,oe,X);Ot&&(ge.horizontal[Vt]=Ot),Ht(),pa(Ne)&&T&&L&&(ge.vertical=Af(ve,c.glyphMap,c.glyphPositions,c.imagePositions,H,Dt,S,Zt,Vt,ft,Pe,u.ah.vertical,!1,Nt,oe,X))}}let He=!1;if(O.icon&&O.icon.name){const Ne=c.imageMap[O.icon.name];Ne&&(Me=M2(c.imagePositions[O.icon.name],h.get("icon-offset").evaluate(O,{},c.canonical),h.get("icon-anchor").evaluate(O,{},c.canonical)),He=!!Ne.sdf,c.bucket.sdfIcons===void 0?c.bucket.sdfIcons=He:c.bucket.sdfIcons!==He&&Ce("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ne.pixelRatio!==c.bucket.pixelRatio||h.get("icon-rotate").constantOr(1)!==0)&&(c.bucket.iconsNeedLinear=!0))}const ze=P_(ge.horizontal)||ge.vertical;c.bucket.iconsInText=!!ze&&ze.iconsInText,(ze||Me)&&q2(c.bucket,O,ge,Me,c.imageMap,v,oe,de,Pe,He,c.canonical)}c.showCollisionBoxes&&c.bucket.generateCollisionDebugBuffers()},u.bn=mp,u.bo=fp,u.bp=pp,u.bq=ga,u.br=_p,u.bs=class{constructor(c){this._marks={start:[c.url,"start"].join("#"),end:[c.url,"end"].join("#"),measure:c.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let c=performance.getEntriesByName(this._marks.measure);return c.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),c=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),c}},u.bt=function(c,s,h,m,v){return a(this,void 0,void 0,function*(){if(P())try{return yield ut(c,s,h,m,v)}catch{}return function(S,T,L,R,O){const H=S.width,X=S.height;ht&&wt||(ht=new OffscreenCanvas(H,X),wt=ht.getContext("2d",{willReadFrequently:!0})),ht.width=H,ht.height=X,wt.drawImage(S,0,0,H,X);const oe=wt.getImageData(T,L,R,O);return wt.clearRect(0,0,H,X),oe.data}(c,s,h,m,v)})},u.bu=m_,u.bv=d,u.bw=p,u.bx=jg,u.by=Rs,u.bz=function(c){return c.message===pt},u.c=Qe,u.d=c=>a(void 0,void 0,void 0,function*(){if(c.byteLength===0)return createImageBitmap(new ImageData(1,1));const s=new Blob([new Uint8Array(c)],{type:"image/png"});try{return createImageBitmap(s)}catch(h){throw new Error(`Could not load image because of ${h.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),u.e=W,u.f=c=>new Promise((s,h)=>{const m=new Image;m.onload=()=>{s(m),URL.revokeObjectURL(m.src),m.onload=null,window.requestAnimationFrame(()=>{m.src=At})},m.onerror=()=>h(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const v=new Blob([new Uint8Array(c)],{type:"image/png"});m.src=c.byteLength?URL.createObjectURL(v):At}),u.g=bt,u.h=(c,s)=>vn(W(c,{type:"json"}),s),u.i=Oe,u.j=Je,u.k=qe,u.l=(c,s)=>vn(W(c,{type:"arrayBuffer"}),s),u.m=vn,u.n=function(c){return new _p(c).readFields(w2,[])},u.o=Lc,u.p=Kg,u.q=$i,u.r=Yd,u.s=qt,u.t=ha,u.u=Ut,u.v=ye,u.w=Ce,u.x=Bs,u.y=function([c,s,h]){return s+=90,s*=Math.PI/180,h*=Math.PI/180,{x:c*Math.cos(s)*Math.sin(h),y:c*Math.sin(s)*Math.sin(h),z:c*Math.cos(h)}},u.z=Li}),i("worker",["./shared"],function(u){class a{constructor(re){this.keyCache={},re&&this.replace(re)}replace(re){this._layerConfigs={},this._layers={},this.update(re,[])}update(re,se){for(const xe of re){this._layerConfigs[xe.id]=xe;const Fe=this._layers[xe.id]=u.az(xe);Fe._featureFilter=u.a6(Fe.filter),this.keyCache[xe.id]&&delete this.keyCache[xe.id]}for(const xe of se)delete this.keyCache[xe],delete this._layerConfigs[xe],delete this._layers[xe];this.familiesBySource={};const pe=u.bh(Object.values(this._layerConfigs),this.keyCache);for(const xe of pe){const Fe=xe.map(Xe=>this._layers[Xe.id]),Be=Fe[0];if(Be.visibility==="none")continue;const $e=Be.source||"";let Se=this.familiesBySource[$e];Se||(Se=this.familiesBySource[$e]={});const Q=Be.sourceLayer||"_geojsonTileLayer";let We=Se[Q];We||(We=Se[Q]=[]),We.push(Fe)}}}class d{constructor(re){const se={},pe=[];for(const $e in re){const Se=re[$e],Q=se[$e]={};for(const We in Se){const Xe=Se[+We];if(!Xe||Xe.bitmap.width===0||Xe.bitmap.height===0)continue;const tt={x:0,y:0,w:Xe.bitmap.width+2,h:Xe.bitmap.height+2};pe.push(tt),Q[We]={rect:tt,metrics:Xe.metrics}}}const{w:xe,h:Fe}=u.p(pe),Be=new u.o({width:xe||1,height:Fe||1});for(const $e in re){const Se=re[$e];for(const Q in Se){const We=Se[+Q];if(!We||We.bitmap.width===0||We.bitmap.height===0)continue;const Xe=se[$e][Q].rect;u.o.copy(We.bitmap,Be,{x:0,y:0},{x:Xe.x+1,y:Xe.y+1},We.bitmap)}}this.image=Be,this.positions=se}}u.bi("GlyphAtlas",d);class p{constructor(re){this.tileID=new u.Q(re.tileID.overscaledZ,re.tileID.wrap,re.tileID.canonical.z,re.tileID.canonical.x,re.tileID.canonical.y),this.uid=re.uid,this.zoom=re.zoom,this.pixelRatio=re.pixelRatio,this.tileSize=re.tileSize,this.source=re.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=re.showCollisionBoxes,this.collectResourceTiming=!!re.collectResourceTiming,this.returnDependencies=!!re.returnDependencies,this.promoteId=re.promoteId,this.inFlightDependencies=[]}parse(re,se,pe,xe){return u._(this,void 0,void 0,function*(){this.status="parsing",this.data=re,this.collisionBoxArray=new u.a4;const Fe=new u.bj(Object.keys(re.layers).sort()),Be=new u.bk(this.tileID,this.promoteId);Be.bucketLayerIDs=[];const $e={},Se={featureIndex:Be,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:pe},Q=se.familiesBySource[this.source];for(const Tn in Q){const Dr=re.layers[Tn];if(!Dr)continue;Dr.version===1&&u.w(`Vector tile source "${this.source}" layer "${Tn}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const ri=Fe.encode(Tn),Mi=[];for(let Ri=0;Ri<Dr.length;Ri++){const mi=Dr.feature(Ri),jo=Be.getId(mi,Tn);Mi.push({feature:mi,id:jo,index:Ri,sourceLayerIndex:ri})}for(const Ri of Q[Tn]){const mi=Ri[0];mi.source!==this.source&&u.w(`layer.source = ${mi.source} does not equal this.source = ${this.source}`),mi.minzoom&&this.zoom<Math.floor(mi.minzoom)||mi.maxzoom&&this.zoom>=mi.maxzoom||mi.visibility!=="none"&&(g(Ri,this.zoom,pe),($e[mi.id]=mi.createBucket({index:Be.bucketLayerIDs.length,layers:Ri,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:ri,sourceID:this.source})).populate(Mi,Se,this.tileID.canonical),Be.bucketLayerIDs.push(Ri.map(jo=>jo.id)))}}const We=u.aE(Se.glyphDependencies,Tn=>Object.keys(Tn).map(Number));this.inFlightDependencies.forEach(Tn=>Tn==null?void 0:Tn.abort()),this.inFlightDependencies=[];let Xe=Promise.resolve({});if(Object.keys(We).length){const Tn=new AbortController;this.inFlightDependencies.push(Tn),Xe=xe.sendAsync({type:"GG",data:{stacks:We,source:this.source,tileID:this.tileID,type:"glyphs"}},Tn)}const tt=Object.keys(Se.iconDependencies);let lt=Promise.resolve({});if(tt.length){const Tn=new AbortController;this.inFlightDependencies.push(Tn),lt=xe.sendAsync({type:"GI",data:{icons:tt,source:this.source,tileID:this.tileID,type:"icons"}},Tn)}const Lt=Object.keys(Se.patternDependencies);let Jt=Promise.resolve({});if(Lt.length){const Tn=new AbortController;this.inFlightDependencies.push(Tn),Jt=xe.sendAsync({type:"GI",data:{icons:Lt,source:this.source,tileID:this.tileID,type:"patterns"}},Tn)}const[cn,Sn,Fn]=yield Promise.all([Xe,lt,Jt]),xr=new d(cn),Hr=new u.bl(Sn,Fn);for(const Tn in $e){const Dr=$e[Tn];Dr instanceof u.a5?(g(Dr.layers,this.zoom,pe),u.bm({bucket:Dr,glyphMap:cn,glyphPositions:xr.positions,imageMap:Sn,imagePositions:Hr.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):Dr.hasPattern&&(Dr instanceof u.bn||Dr instanceof u.bo||Dr instanceof u.bp)&&(g(Dr.layers,this.zoom,pe),Dr.addFeatures(Se,this.tileID.canonical,Hr.patternPositions))}return this.status="done",{buckets:Object.values($e).filter(Tn=>!Tn.isEmpty()),featureIndex:Be,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:xr.image,imageAtlas:Hr,glyphMap:this.returnDependencies?cn:null,iconMap:this.returnDependencies?Sn:null,glyphPositions:this.returnDependencies?xr.positions:null}})}}function g(we,re,se){const pe=new u.a8(re);for(const xe of we)xe.recalculate(pe,se)}class y{constructor(re,se,pe){this.actor=re,this.layerIndex=se,this.availableImages=pe,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(re,se){return u._(this,void 0,void 0,function*(){const pe=yield u.l(re.request,se);try{return{vectorTile:new u.bq.VectorTile(new u.br(pe.data)),rawData:pe.data,cacheControl:pe.cacheControl,expires:pe.expires}}catch(xe){const Fe=new Uint8Array(pe.data);let Be=`Unable to parse the tile at ${re.request.url}, `;throw Be+=Fe[0]===31&&Fe[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${xe.messge}`,new Error(Be)}})}loadTile(re){return u._(this,void 0,void 0,function*(){const se=re.uid,pe=!!(re&&re.request&&re.request.collectResourceTiming)&&new u.bs(re.request),xe=new p(re);this.loading[se]=xe;const Fe=new AbortController;xe.abort=Fe;try{const Be=yield this.loadVectorTile(re,Fe);if(delete this.loading[se],!Be)return null;const $e=Be.rawData,Se={};Be.expires&&(Se.expires=Be.expires),Be.cacheControl&&(Se.cacheControl=Be.cacheControl);const Q={};if(pe){const Xe=pe.finish();Xe&&(Q.resourceTiming=JSON.parse(JSON.stringify(Xe)))}xe.vectorTile=Be.vectorTile;const We=xe.parse(Be.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[se]=xe,this.fetching[se]={rawTileData:$e,cacheControl:Se,resourceTiming:Q};try{const Xe=yield We;return u.e({rawTileData:$e.slice(0)},Xe,Se,Q)}finally{delete this.fetching[se]}}catch(Be){throw delete this.loading[se],xe.status="done",this.loaded[se]=xe,Be}})}reloadTile(re){return u._(this,void 0,void 0,function*(){const se=re.uid;if(!this.loaded||!this.loaded[se])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const pe=this.loaded[se];if(pe.showCollisionBoxes=re.showCollisionBoxes,pe.status==="parsing"){const xe=yield pe.parse(pe.vectorTile,this.layerIndex,this.availableImages,this.actor);let Fe;if(this.fetching[se]){const{rawTileData:Be,cacheControl:$e,resourceTiming:Se}=this.fetching[se];delete this.fetching[se],Fe=u.e({rawTileData:Be.slice(0)},xe,$e,Se)}else Fe=xe;return Fe}if(pe.status==="done"&&pe.vectorTile)return pe.parse(pe.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(re){return u._(this,void 0,void 0,function*(){const se=this.loading,pe=re.uid;se&&se[pe]&&se[pe].abort&&(se[pe].abort.abort(),delete se[pe])})}removeTile(re){return u._(this,void 0,void 0,function*(){this.loaded&&this.loaded[re.uid]&&delete this.loaded[re.uid]})}}class x{constructor(){this.loaded={}}loadTile(re){return u._(this,void 0,void 0,function*(){const{uid:se,encoding:pe,rawImageData:xe,redFactor:Fe,greenFactor:Be,blueFactor:$e,baseShift:Se}=re,Q=xe.width+2,We=xe.height+2,Xe=u.b(xe)?new u.R({width:Q,height:We},yield u.bt(xe,-1,-1,Q,We)):xe,tt=new u.bu(se,Xe,pe,Fe,Be,$e,Se);return this.loaded=this.loaded||{},this.loaded[se]=tt,tt})}removeTile(re){const se=this.loaded,pe=re.uid;se&&se[pe]&&delete se[pe]}}function C(we,re){if(we.length!==0){M(we[0],re);for(var se=1;se<we.length;se++)M(we[se],!re)}}function M(we,re){for(var se=0,pe=0,xe=0,Fe=we.length,Be=Fe-1;xe<Fe;Be=xe++){var $e=(we[xe][0]-we[Be][0])*(we[Be][1]+we[xe][1]),Se=se+$e;pe+=Math.abs(se)>=Math.abs($e)?se-Se+$e:$e-Se+se,se=Se}se+pe>=0!=!!re&&we.reverse()}var F=u.bv(function we(re,se){var pe,xe=re&&re.type;if(xe==="FeatureCollection")for(pe=0;pe<re.features.length;pe++)we(re.features[pe],se);else if(xe==="GeometryCollection")for(pe=0;pe<re.geometries.length;pe++)we(re.geometries[pe],se);else if(xe==="Feature")we(re.geometry,se);else if(xe==="Polygon")C(re.coordinates,se);else if(xe==="MultiPolygon")for(pe=0;pe<re.coordinates.length;pe++)C(re.coordinates[pe],se);return re});const z=u.bq.VectorTileFeature.prototype.toGeoJSON;var E={exports:{}},P=u.bw,$=u.bq.VectorTileFeature,U=K;function K(we,re){this.options=re||{},this.features=we,this.length=we.length}function ee(we,re){this.id=typeof we.id=="number"?we.id:void 0,this.type=we.type,this.rawGeometry=we.type===1?[we.geometry]:we.geometry,this.properties=we.tags,this.extent=re||4096}K.prototype.feature=function(we){return new ee(this.features[we],this.options.extent)},ee.prototype.loadGeometry=function(){var we=this.rawGeometry;this.geometry=[];for(var re=0;re<we.length;re++){for(var se=we[re],pe=[],xe=0;xe<se.length;xe++)pe.push(new P(se[xe][0],se[xe][1]));this.geometry.push(pe)}return this.geometry},ee.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var we=this.geometry,re=1/0,se=-1/0,pe=1/0,xe=-1/0,Fe=0;Fe<we.length;Fe++)for(var Be=we[Fe],$e=0;$e<Be.length;$e++){var Se=Be[$e];re=Math.min(re,Se.x),se=Math.max(se,Se.x),pe=Math.min(pe,Se.y),xe=Math.max(xe,Se.y)}return[re,pe,se,xe]},ee.prototype.toGeoJSON=$.prototype.toGeoJSON;var W=u.bx,J=U;function he(we){var re=new W;return function(se,pe){for(var xe in se.layers)pe.writeMessage(3,Ae,se.layers[xe])}(we,re),re.finish()}function Ae(we,re){var se;re.writeVarintField(15,we.version||1),re.writeStringField(1,we.name||""),re.writeVarintField(5,we.extent||4096);var pe={keys:[],values:[],keycache:{},valuecache:{}};for(se=0;se<we.length;se++)pe.feature=we.feature(se),re.writeMessage(2,ne,pe);var xe=pe.keys;for(se=0;se<xe.length;se++)re.writeStringField(3,xe[se]);var Fe=pe.values;for(se=0;se<Fe.length;se++)re.writeMessage(4,Oe,Fe[se])}function ne(we,re){var se=we.feature;se.id!==void 0&&re.writeVarintField(1,se.id),re.writeMessage(2,fe,we),re.writeVarintField(3,se.type),re.writeMessage(4,Ze,se)}function fe(we,re){var se=we.feature,pe=we.keys,xe=we.values,Fe=we.keycache,Be=we.valuecache;for(var $e in se.properties){var Se=se.properties[$e],Q=Fe[$e];if(Se!==null){Q===void 0&&(pe.push($e),Fe[$e]=Q=pe.length-1),re.writeVarint(Q);var We=typeof Se;We!=="string"&&We!=="boolean"&&We!=="number"&&(Se=JSON.stringify(Se));var Xe=We+":"+Se,tt=Be[Xe];tt===void 0&&(xe.push(Se),Be[Xe]=tt=xe.length-1),re.writeVarint(tt)}}}function Ce(we,re){return(re<<3)+(7&we)}function _e(we){return we<<1^we>>31}function Ze(we,re){for(var se=we.loadGeometry(),pe=we.type,xe=0,Fe=0,Be=se.length,$e=0;$e<Be;$e++){var Se=se[$e],Q=1;pe===1&&(Q=Se.length),re.writeVarint(Ce(1,Q));for(var We=pe===3?Se.length-1:Se.length,Xe=0;Xe<We;Xe++){Xe===1&&pe!==1&&re.writeVarint(Ce(2,We-1));var tt=Se[Xe].x-xe,lt=Se[Xe].y-Fe;re.writeVarint(_e(tt)),re.writeVarint(_e(lt)),xe+=tt,Fe+=lt}pe===3&&re.writeVarint(Ce(7,1))}}function Oe(we,re){var se=typeof we;se==="string"?re.writeStringField(1,we):se==="boolean"?re.writeBooleanField(7,we):se==="number"&&(we%1!=0?re.writeDoubleField(3,we):we<0?re.writeSVarintField(6,we):re.writeVarintField(5,we))}E.exports=he,E.exports.fromVectorTileJs=he,E.exports.fromGeojsonVt=function(we,re){re=re||{};var se={};for(var pe in we)se[pe]=new J(we[pe].features,re),se[pe].name=pe,se[pe].version=re.version,se[pe].extent=re.extent;return he({layers:se})},E.exports.GeoJSONWrapper=J;var je=u.bv(E.exports);const De={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:we=>we},At=Math.fround||(ut=new Float32Array(1),we=>(ut[0]=+we,ut[0]));var ut;const ht=3,wt=5,pt=6;class Qe{constructor(re){this.options=Object.assign(Object.create(De),re),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(re){const{log:se,minZoom:pe,maxZoom:xe}=this.options;se&&console.time("total time");const Fe=`prepare ${re.length} points`;se&&console.time(Fe),this.points=re;const Be=[];for(let Se=0;Se<re.length;Se++){const Q=re[Se];if(!Q.geometry)continue;const[We,Xe]=Q.geometry.coordinates,tt=At(Bt(We)),lt=At(Pt(Xe));Be.push(tt,lt,1/0,Se,-1,1),this.options.reduce&&Be.push(0)}let $e=this.trees[xe+1]=this._createTree(Be);se&&console.timeEnd(Fe);for(let Se=xe;Se>=pe;Se--){const Q=+Date.now();$e=this.trees[Se]=this._createTree(this._cluster($e,Se)),se&&console.log("z%d: %d clusters in %dms",Se,$e.numItems,+Date.now()-Q)}return se&&console.timeEnd("total time"),this}getClusters(re,se){let pe=((re[0]+180)%360+360)%360-180;const xe=Math.max(-90,Math.min(90,re[1]));let Fe=re[2]===180?180:((re[2]+180)%360+360)%360-180;const Be=Math.max(-90,Math.min(90,re[3]));if(re[2]-re[0]>=360)pe=-180,Fe=180;else if(pe>Fe){const Xe=this.getClusters([pe,xe,180,Be],se),tt=this.getClusters([-180,xe,Fe,Be],se);return Xe.concat(tt)}const $e=this.trees[this._limitZoom(se)],Se=$e.range(Bt(pe),Pt(Be),Bt(Fe),Pt(xe)),Q=$e.data,We=[];for(const Xe of Se){const tt=this.stride*Xe;We.push(Q[tt+wt]>1?Ft(Q,tt,this.clusterProps):this.points[Q[tt+ht]])}return We}getChildren(re){const se=this._getOriginId(re),pe=this._getOriginZoom(re),xe="No cluster with the specified id.",Fe=this.trees[pe];if(!Fe)throw new Error(xe);const Be=Fe.data;if(se*this.stride>=Be.length)throw new Error(xe);const $e=this.options.radius/(this.options.extent*Math.pow(2,pe-1)),Se=Fe.within(Be[se*this.stride],Be[se*this.stride+1],$e),Q=[];for(const We of Se){const Xe=We*this.stride;Be[Xe+4]===re&&Q.push(Be[Xe+wt]>1?Ft(Be,Xe,this.clusterProps):this.points[Be[Xe+ht]])}if(Q.length===0)throw new Error(xe);return Q}getLeaves(re,se,pe){const xe=[];return this._appendLeaves(xe,re,se=se||10,pe=pe||0,0),xe}getTile(re,se,pe){const xe=this.trees[this._limitZoom(re)],Fe=Math.pow(2,re),{extent:Be,radius:$e}=this.options,Se=$e/Be,Q=(pe-Se)/Fe,We=(pe+1+Se)/Fe,Xe={features:[]};return this._addTileFeatures(xe.range((se-Se)/Fe,Q,(se+1+Se)/Fe,We),xe.data,se,pe,Fe,Xe),se===0&&this._addTileFeatures(xe.range(1-Se/Fe,Q,1,We),xe.data,Fe,pe,Fe,Xe),se===Fe-1&&this._addTileFeatures(xe.range(0,Q,Se/Fe,We),xe.data,-1,pe,Fe,Xe),Xe.features.length?Xe:null}getClusterExpansionZoom(re){let se=this._getOriginZoom(re)-1;for(;se<=this.options.maxZoom;){const pe=this.getChildren(re);if(se++,pe.length!==1)break;re=pe[0].properties.cluster_id}return se}_appendLeaves(re,se,pe,xe,Fe){const Be=this.getChildren(se);for(const $e of Be){const Se=$e.properties;if(Se&&Se.cluster?Fe+Se.point_count<=xe?Fe+=Se.point_count:Fe=this._appendLeaves(re,Se.cluster_id,pe,xe,Fe):Fe<xe?Fe++:re.push($e),re.length===pe)break}return Fe}_createTree(re){const se=new u.au(re.length/this.stride|0,this.options.nodeSize,Float32Array);for(let pe=0;pe<re.length;pe+=this.stride)se.add(re[pe],re[pe+1]);return se.finish(),se.data=re,se}_addTileFeatures(re,se,pe,xe,Fe,Be){for(const $e of re){const Se=$e*this.stride,Q=se[Se+wt]>1;let We,Xe,tt;if(Q)We=bt(se,Se,this.clusterProps),Xe=se[Se],tt=se[Se+1];else{const Jt=this.points[se[Se+ht]];We=Jt.properties;const[cn,Sn]=Jt.geometry.coordinates;Xe=Bt(cn),tt=Pt(Sn)}const lt={type:1,geometry:[[Math.round(this.options.extent*(Xe*Fe-pe)),Math.round(this.options.extent*(tt*Fe-xe))]],tags:We};let Lt;Lt=Q||this.options.generateId?se[Se+ht]:this.points[se[Se+ht]].id,Lt!==void 0&&(lt.id=Lt),Be.features.push(lt)}}_limitZoom(re){return Math.max(this.options.minZoom,Math.min(Math.floor(+re),this.options.maxZoom+1))}_cluster(re,se){const{radius:pe,extent:xe,reduce:Fe,minPoints:Be}=this.options,$e=pe/(xe*Math.pow(2,se)),Se=re.data,Q=[],We=this.stride;for(let Xe=0;Xe<Se.length;Xe+=We){if(Se[Xe+2]<=se)continue;Se[Xe+2]=se;const tt=Se[Xe],lt=Se[Xe+1],Lt=re.within(Se[Xe],Se[Xe+1],$e),Jt=Se[Xe+wt];let cn=Jt;for(const Sn of Lt){const Fn=Sn*We;Se[Fn+2]>se&&(cn+=Se[Fn+wt])}if(cn>Jt&&cn>=Be){let Sn,Fn=tt*Jt,xr=lt*Jt,Hr=-1;const Tn=((Xe/We|0)<<5)+(se+1)+this.points.length;for(const Dr of Lt){const ri=Dr*We;if(Se[ri+2]<=se)continue;Se[ri+2]=se;const Mi=Se[ri+wt];Fn+=Se[ri]*Mi,xr+=Se[ri+1]*Mi,Se[ri+4]=Tn,Fe&&(Sn||(Sn=this._map(Se,Xe,!0),Hr=this.clusterProps.length,this.clusterProps.push(Sn)),Fe(Sn,this._map(Se,ri)))}Se[Xe+4]=Tn,Q.push(Fn/cn,xr/cn,1/0,Tn,-1,cn),Fe&&Q.push(Hr)}else{for(let Sn=0;Sn<We;Sn++)Q.push(Se[Xe+Sn]);if(cn>1)for(const Sn of Lt){const Fn=Sn*We;if(!(Se[Fn+2]<=se)){Se[Fn+2]=se;for(let xr=0;xr<We;xr++)Q.push(Se[Fn+xr])}}}}return Q}_getOriginId(re){return re-this.points.length>>5}_getOriginZoom(re){return(re-this.points.length)%32}_map(re,se,pe){if(re[se+wt]>1){const Be=this.clusterProps[re[se+pt]];return pe?Object.assign({},Be):Be}const xe=this.points[re[se+ht]].properties,Fe=this.options.map(xe);return pe&&Fe===xe?Object.assign({},Fe):Fe}}function Ft(we,re,se){return{type:"Feature",id:we[re+ht],properties:bt(we,re,se),geometry:{type:"Point",coordinates:[(pe=we[re],360*(pe-.5)),Qt(we[re+1])]}};var pe}function bt(we,re,se){const pe=we[re+wt],xe=pe>=1e4?`${Math.round(pe/1e3)}k`:pe>=1e3?Math.round(pe/100)/10+"k":pe,Fe=we[re+pt],Be=Fe===-1?{}:Object.assign({},se[Fe]);return Object.assign(Be,{cluster:!0,cluster_id:we[re+ht],point_count:pe,point_count_abbreviated:xe})}function Bt(we){return we/360+.5}function Pt(we){const re=Math.sin(we*Math.PI/180),se=.5-.25*Math.log((1+re)/(1-re))/Math.PI;return se<0?0:se>1?1:se}function Qt(we){const re=(180-360*we)*Math.PI/180;return 360*Math.atan(Math.exp(re))/Math.PI-90}function vn(we,re,se,pe){for(var xe,Fe=pe,Be=se-re>>1,$e=se-re,Se=we[re],Q=we[re+1],We=we[se],Xe=we[se+1],tt=re+3;tt<se;tt+=3){var lt=qt(we[tt],we[tt+1],Se,Q,We,Xe);if(lt>Fe)xe=tt,Fe=lt;else if(lt===Fe){var Lt=Math.abs(tt-Be);Lt<$e&&(xe=tt,$e=Lt)}}Fe>pe&&(xe-re>3&&vn(we,re,xe,pe),we[xe+2]=Fe,se-xe>3&&vn(we,xe,se,pe))}function qt(we,re,se,pe,xe,Fe){var Be=xe-se,$e=Fe-pe;if(Be!==0||$e!==0){var Se=((we-se)*Be+(re-pe)*$e)/(Be*Be+$e*$e);Se>1?(se=xe,pe=Fe):Se>0&&(se+=Be*Se,pe+=$e*Se)}return(Be=we-se)*Be+($e=re-pe)*$e}function rn(we,re,se,pe){var xe={id:we===void 0?null:we,type:re,geometry:se,tags:pe,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Fe){var Be=Fe.geometry,$e=Fe.type;if($e==="Point"||$e==="MultiPoint"||$e==="LineString")Ge(Fe,Be);else if($e==="Polygon"||$e==="MultiLineString")for(var Se=0;Se<Be.length;Se++)Ge(Fe,Be[Se]);else if($e==="MultiPolygon")for(Se=0;Se<Be.length;Se++)for(var Q=0;Q<Be[Se].length;Q++)Ge(Fe,Be[Se][Q])}(xe),xe}function Ge(we,re){for(var se=0;se<re.length;se+=3)we.minX=Math.min(we.minX,re[se]),we.minY=Math.min(we.minY,re[se+1]),we.maxX=Math.max(we.maxX,re[se]),we.maxY=Math.max(we.maxY,re[se+1])}function qe(we,re,se,pe){if(re.geometry){var xe=re.geometry.coordinates,Fe=re.geometry.type,Be=Math.pow(se.tolerance/((1<<se.maxZoom)*se.extent),2),$e=[],Se=re.id;if(se.promoteId?Se=re.properties[se.promoteId]:se.generateId&&(Se=pe||0),Fe==="Point")Je(xe,$e);else if(Fe==="MultiPoint")for(var Q=0;Q<xe.length;Q++)Je(xe[Q],$e);else if(Fe==="LineString")Et(xe,$e,Be,!1);else if(Fe==="MultiLineString"){if(se.lineMetrics){for(Q=0;Q<xe.length;Q++)Et(xe[Q],$e=[],Be,!1),we.push(rn(Se,"LineString",$e,re.properties));return}ye(xe,$e,Be,!1)}else if(Fe==="Polygon")ye(xe,$e,Be,!0);else{if(Fe!=="MultiPolygon"){if(Fe==="GeometryCollection"){for(Q=0;Q<re.geometry.geometries.length;Q++)qe(we,{id:Se,geometry:re.geometry.geometries[Q],properties:re.properties},se,pe);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Q=0;Q<xe.length;Q++){var We=[];ye(xe[Q],We,Be,!0),$e.push(We)}}we.push(rn(Se,Fe,$e,re.properties))}}function Je(we,re){re.push(kn(we[0])),re.push(Ue(we[1])),re.push(0)}function Et(we,re,se,pe){for(var xe,Fe,Be=0,$e=0;$e<we.length;$e++){var Se=kn(we[$e][0]),Q=Ue(we[$e][1]);re.push(Se),re.push(Q),re.push(0),$e>0&&(Be+=pe?(xe*Q-Se*Fe)/2:Math.sqrt(Math.pow(Se-xe,2)+Math.pow(Q-Fe,2))),xe=Se,Fe=Q}var We=re.length-3;re[2]=1,vn(re,0,We,se),re[We+2]=1,re.size=Math.abs(Be),re.start=0,re.end=re.size}function ye(we,re,se,pe){for(var xe=0;xe<we.length;xe++){var Fe=[];Et(we[xe],Fe,se,pe),re.push(Fe)}}function kn(we){return we/360+.5}function Ue(we){var re=Math.sin(we*Math.PI/180),se=.5-.25*Math.log((1+re)/(1-re))/Math.PI;return se<0?0:se>1?1:se}function it(we,re,se,pe,xe,Fe,Be,$e){if(pe/=re,Fe>=(se/=re)&&Be<pe)return we;if(Be<se||Fe>=pe)return null;for(var Se=[],Q=0;Q<we.length;Q++){var We=we[Q],Xe=We.geometry,tt=We.type,lt=xe===0?We.minX:We.minY,Lt=xe===0?We.maxX:We.maxY;if(lt>=se&&Lt<pe)Se.push(We);else if(!(Lt<se||lt>=pe)){var Jt=[];if(tt==="Point"||tt==="MultiPoint")Wt(Xe,Jt,se,pe,xe);else if(tt==="LineString")cr(Xe,Jt,se,pe,xe,!1,$e.lineMetrics);else if(tt==="MultiLineString")yr(Xe,Jt,se,pe,xe,!1);else if(tt==="Polygon")yr(Xe,Jt,se,pe,xe,!0);else if(tt==="MultiPolygon")for(var cn=0;cn<Xe.length;cn++){var Sn=[];yr(Xe[cn],Sn,se,pe,xe,!0),Sn.length&&Jt.push(Sn)}if(Jt.length){if($e.lineMetrics&&tt==="LineString"){for(cn=0;cn<Jt.length;cn++)Se.push(rn(We.id,tt,Jt[cn],We.tags));continue}tt!=="LineString"&&tt!=="MultiLineString"||(Jt.length===1?(tt="LineString",Jt=Jt[0]):tt="MultiLineString"),tt!=="Point"&&tt!=="MultiPoint"||(tt=Jt.length===3?"Point":"MultiPoint"),Se.push(rn(We.id,tt,Jt,We.tags))}}}return Se.length?Se:null}function Wt(we,re,se,pe,xe){for(var Fe=0;Fe<we.length;Fe+=3){var Be=we[Fe+xe];Be>=se&&Be<=pe&&(re.push(we[Fe]),re.push(we[Fe+1]),re.push(we[Fe+2]))}}function cr(we,re,se,pe,xe,Fe,Be){for(var $e,Se,Q=_r(we),We=xe===0?jr:xo,Xe=we.start,tt=0;tt<we.length-3;tt+=3){var lt=we[tt],Lt=we[tt+1],Jt=we[tt+2],cn=we[tt+3],Sn=we[tt+4],Fn=xe===0?lt:Lt,xr=xe===0?cn:Sn,Hr=!1;Be&&($e=Math.sqrt(Math.pow(lt-cn,2)+Math.pow(Lt-Sn,2))),Fn<se?xr>se&&(Se=We(Q,lt,Lt,cn,Sn,se),Be&&(Q.start=Xe+$e*Se)):Fn>pe?xr<pe&&(Se=We(Q,lt,Lt,cn,Sn,pe),Be&&(Q.start=Xe+$e*Se)):ni(Q,lt,Lt,Jt),xr<se&&Fn>=se&&(Se=We(Q,lt,Lt,cn,Sn,se),Hr=!0),xr>pe&&Fn<=pe&&(Se=We(Q,lt,Lt,cn,Sn,pe),Hr=!0),!Fe&&Hr&&(Be&&(Q.end=Xe+$e*Se),re.push(Q),Q=_r(we)),Be&&(Xe+=$e)}var Tn=we.length-3;lt=we[Tn],Lt=we[Tn+1],Jt=we[Tn+2],(Fn=xe===0?lt:Lt)>=se&&Fn<=pe&&ni(Q,lt,Lt,Jt),Tn=Q.length-3,Fe&&Tn>=3&&(Q[Tn]!==Q[0]||Q[Tn+1]!==Q[1])&&ni(Q,Q[0],Q[1],Q[2]),Q.length&&re.push(Q)}function _r(we){var re=[];return re.size=we.size,re.start=we.start,re.end=we.end,re}function yr(we,re,se,pe,xe,Fe){for(var Be=0;Be<we.length;Be++)cr(we[Be],re,se,pe,xe,Fe,!1)}function ni(we,re,se,pe){we.push(re),we.push(se),we.push(pe)}function jr(we,re,se,pe,xe,Fe){var Be=(Fe-re)/(pe-re);return we.push(Fe),we.push(se+(xe-se)*Be),we.push(1),Be}function xo(we,re,se,pe,xe,Fe){var Be=(Fe-se)/(xe-se);return we.push(re+(pe-re)*Be),we.push(Fe),we.push(1),Be}function hr(we,re){for(var se=[],pe=0;pe<we.length;pe++){var xe,Fe=we[pe],Be=Fe.type;if(Be==="Point"||Be==="MultiPoint"||Be==="LineString")xe=vt(Fe.geometry,re);else if(Be==="MultiLineString"||Be==="Polygon"){xe=[];for(var $e=0;$e<Fe.geometry.length;$e++)xe.push(vt(Fe.geometry[$e],re))}else if(Be==="MultiPolygon")for(xe=[],$e=0;$e<Fe.geometry.length;$e++){for(var Se=[],Q=0;Q<Fe.geometry[$e].length;Q++)Se.push(vt(Fe.geometry[$e][Q],re));xe.push(Se)}se.push(rn(Fe.id,Be,xe,Fe.tags))}return se}function vt(we,re){var se=[];se.size=we.size,we.start!==void 0&&(se.start=we.start,se.end=we.end);for(var pe=0;pe<we.length;pe+=3)se.push(we[pe]+re,we[pe+1],we[pe+2]);return se}function Pr(we,re){if(we.transformed)return we;var se,pe,xe,Fe=1<<we.z,Be=we.x,$e=we.y;for(se=0;se<we.features.length;se++){var Se=we.features[se],Q=Se.geometry,We=Se.type;if(Se.geometry=[],We===1)for(pe=0;pe<Q.length;pe+=2)Se.geometry.push(Mr(Q[pe],Q[pe+1],re,Fe,Be,$e));else for(pe=0;pe<Q.length;pe++){var Xe=[];for(xe=0;xe<Q[pe].length;xe+=2)Xe.push(Mr(Q[pe][xe],Q[pe][xe+1],re,Fe,Be,$e));Se.geometry.push(Xe)}}return we.transformed=!0,we}function Mr(we,re,se,pe,xe,Fe){return[Math.round(se*(we*pe-xe)),Math.round(se*(re*pe-Fe))]}function zr(we,re,se,pe,xe){for(var Fe=re===xe.maxZoom?0:xe.tolerance/((1<<re)*xe.extent),Be={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:se,y:pe,z:re,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},$e=0;$e<we.length;$e++){Be.numFeatures++,qn(Be,we[$e],Fe,xe);var Se=we[$e].minX,Q=we[$e].minY,We=we[$e].maxX,Xe=we[$e].maxY;Se<Be.minX&&(Be.minX=Se),Q<Be.minY&&(Be.minY=Q),We>Be.maxX&&(Be.maxX=We),Xe>Be.maxY&&(Be.maxY=Xe)}return Be}function qn(we,re,se,pe){var xe=re.geometry,Fe=re.type,Be=[];if(Fe==="Point"||Fe==="MultiPoint")for(var $e=0;$e<xe.length;$e+=3)Be.push(xe[$e]),Be.push(xe[$e+1]),we.numPoints++,we.numSimplified++;else if(Fe==="LineString")It(Be,xe,we,se,!1,!1);else if(Fe==="MultiLineString"||Fe==="Polygon")for($e=0;$e<xe.length;$e++)It(Be,xe[$e],we,se,Fe==="Polygon",$e===0);else if(Fe==="MultiPolygon")for(var Se=0;Se<xe.length;Se++){var Q=xe[Se];for($e=0;$e<Q.length;$e++)It(Be,Q[$e],we,se,!0,$e===0)}if(Be.length){var We=re.tags||null;if(Fe==="LineString"&&pe.lineMetrics){for(var Xe in We={},re.tags)We[Xe]=re.tags[Xe];We.mapbox_clip_start=xe.start/xe.size,We.mapbox_clip_end=xe.end/xe.size}var tt={geometry:Be,type:Fe==="Polygon"||Fe==="MultiPolygon"?3:Fe==="LineString"||Fe==="MultiLineString"?2:1,tags:We};re.id!==null&&(tt.id=re.id),we.features.push(tt)}}function It(we,re,se,pe,xe,Fe){var Be=pe*pe;if(pe>0&&re.size<(xe?Be:pe))se.numPoints+=re.length/3;else{for(var $e=[],Se=0;Se<re.length;Se+=3)(pe===0||re[Se+2]>Be)&&(se.numSimplified++,$e.push(re[Se]),$e.push(re[Se+1])),se.numPoints++;xe&&function(Q,We){for(var Xe=0,tt=0,lt=Q.length,Lt=lt-2;tt<lt;Lt=tt,tt+=2)Xe+=(Q[tt]-Q[Lt])*(Q[tt+1]+Q[Lt+1]);if(Xe>0===We)for(tt=0,lt=Q.length;tt<lt/2;tt+=2){var Jt=Q[tt],cn=Q[tt+1];Q[tt]=Q[lt-2-tt],Q[tt+1]=Q[lt-1-tt],Q[lt-2-tt]=Jt,Q[lt-1-tt]=cn}}($e,Fe),we.push($e)}}function fn(we,re){var se=(re=this.options=function(xe,Fe){for(var Be in Fe)xe[Be]=Fe[Be];return xe}(Object.create(this.options),re)).debug;if(se&&console.time("preprocess data"),re.maxZoom<0||re.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(re.promoteId&&re.generateId)throw new Error("promoteId and generateId cannot be used together.");var pe=function(xe,Fe){var Be=[];if(xe.type==="FeatureCollection")for(var $e=0;$e<xe.features.length;$e++)qe(Be,xe.features[$e],Fe,$e);else qe(Be,xe.type==="Feature"?xe:{geometry:xe},Fe);return Be}(we,re);this.tiles={},this.tileCoords=[],se&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",re.indexMaxZoom,re.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),pe=function(xe,Fe){var Be=Fe.buffer/Fe.extent,$e=xe,Se=it(xe,1,-1-Be,Be,0,-1,2,Fe),Q=it(xe,1,1-Be,2+Be,0,-1,2,Fe);return(Se||Q)&&($e=it(xe,1,-Be,1+Be,0,-1,2,Fe)||[],Se&&($e=hr(Se,1).concat($e)),Q&&($e=$e.concat(hr(Q,-1)))),$e}(pe,re),pe.length&&this.splitTile(pe,0,0,0),se&&(pe.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function on(we,re,se){return 32*((1<<we)*se+re)+we}function Qn(we,re){return re?we.properties[re]:we.id}function pi(we,re){if(we==null)return!0;if(we.type==="Feature")return Qn(we,re)!=null;if(we.type==="FeatureCollection"){const se=new Set;for(const pe of we.features){const xe=Qn(pe,re);if(xe==null||se.has(xe))return!1;se.add(xe)}return!0}return!1}function pn(we,re){const se=new Map;if(we!=null)if(we.type==="Feature")se.set(Qn(we,re),we);else for(const pe of we.features)se.set(Qn(pe,re),pe);return se}fn.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},fn.prototype.splitTile=function(we,re,se,pe,xe,Fe,Be){for(var $e=[we,re,se,pe],Se=this.options,Q=Se.debug;$e.length;){pe=$e.pop(),se=$e.pop(),re=$e.pop(),we=$e.pop();var We=1<<re,Xe=on(re,se,pe),tt=this.tiles[Xe];if(!tt&&(Q>1&&console.time("creation"),tt=this.tiles[Xe]=zr(we,re,se,pe,Se),this.tileCoords.push({z:re,x:se,y:pe}),Q)){Q>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",re,se,pe,tt.numFeatures,tt.numPoints,tt.numSimplified),console.timeEnd("creation"));var lt="z"+re;this.stats[lt]=(this.stats[lt]||0)+1,this.total++}if(tt.source=we,xe){if(re===Se.maxZoom||re===xe)continue;var Lt=1<<xe-re;if(se!==Math.floor(Fe/Lt)||pe!==Math.floor(Be/Lt))continue}else if(re===Se.indexMaxZoom||tt.numPoints<=Se.indexMaxPoints)continue;if(tt.source=null,we.length!==0){Q>1&&console.time("clipping");var Jt,cn,Sn,Fn,xr,Hr,Tn=.5*Se.buffer/Se.extent,Dr=.5-Tn,ri=.5+Tn,Mi=1+Tn;Jt=cn=Sn=Fn=null,xr=it(we,We,se-Tn,se+ri,0,tt.minX,tt.maxX,Se),Hr=it(we,We,se+Dr,se+Mi,0,tt.minX,tt.maxX,Se),we=null,xr&&(Jt=it(xr,We,pe-Tn,pe+ri,1,tt.minY,tt.maxY,Se),cn=it(xr,We,pe+Dr,pe+Mi,1,tt.minY,tt.maxY,Se),xr=null),Hr&&(Sn=it(Hr,We,pe-Tn,pe+ri,1,tt.minY,tt.maxY,Se),Fn=it(Hr,We,pe+Dr,pe+Mi,1,tt.minY,tt.maxY,Se),Hr=null),Q>1&&console.timeEnd("clipping"),$e.push(Jt||[],re+1,2*se,2*pe),$e.push(cn||[],re+1,2*se,2*pe+1),$e.push(Sn||[],re+1,2*se+1,2*pe),$e.push(Fn||[],re+1,2*se+1,2*pe+1)}}},fn.prototype.getTile=function(we,re,se){var pe=this.options,xe=pe.extent,Fe=pe.debug;if(we<0||we>24)return null;var Be=1<<we,$e=on(we,re=(re%Be+Be)%Be,se);if(this.tiles[$e])return Pr(this.tiles[$e],xe);Fe>1&&console.log("drilling down to z%d-%d-%d",we,re,se);for(var Se,Q=we,We=re,Xe=se;!Se&&Q>0;)Q--,We=Math.floor(We/2),Xe=Math.floor(Xe/2),Se=this.tiles[on(Q,We,Xe)];return Se&&Se.source?(Fe>1&&console.log("found parent tile z%d-%d-%d",Q,We,Xe),Fe>1&&console.time("drilling down"),this.splitTile(Se.source,Q,We,Xe,we,re,se),Fe>1&&console.timeEnd("drilling down"),this.tiles[$e]?Pr(this.tiles[$e],xe):null):null};class Di extends y{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(re,se){return u._(this,void 0,void 0,function*(){const pe=re.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const xe=this._geoJSONIndex.getTile(pe.z,pe.x,pe.y);if(!xe)return null;const Fe=new class{constructor($e){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=u.W,this.length=$e.length,this._features=$e}feature($e){return new class{constructor(Se){this._feature=Se,this.extent=u.W,this.type=Se.type,this.properties=Se.tags,"id"in Se&&!isNaN(Se.id)&&(this.id=parseInt(Se.id,10))}loadGeometry(){if(this._feature.type===1){const Se=[];for(const Q of this._feature.geometry)Se.push([new u.P(Q[0],Q[1])]);return Se}{const Se=[];for(const Q of this._feature.geometry){const We=[];for(const Xe of Q)We.push(new u.P(Xe[0],Xe[1]));Se.push(We)}return Se}}toGeoJSON(Se,Q,We){return z.call(this,Se,Q,We)}}(this._features[$e])}}(xe.features);let Be=je(Fe);return Be.byteOffset===0&&Be.byteLength===Be.buffer.byteLength||(Be=new Uint8Array(Be)),{vectorTile:Fe,rawData:Be.buffer}})}loadData(re){return u._(this,void 0,void 0,function*(){var se;(se=this._pendingRequest)===null||se===void 0||se.abort();const pe=!!(re&&re.request&&re.request.collectResourceTiming)&&new u.bs(re.request);this._pendingRequest=new AbortController;try{let xe=yield this.loadGeoJSON(re,this._pendingRequest);if(delete this._pendingRequest,typeof xe!="object")throw new Error(`Input data given to '${re.source}' is not a valid GeoJSON object.`);if(F(xe,!0),re.filter){const Be=u.by(re.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Be.result==="error")throw new Error(Be.value.map(Se=>`${Se.key}: ${Se.message}`).join(", "));xe={type:"FeatureCollection",features:xe.features.filter(Se=>Be.value.evaluate({zoom:0},Se))}}this._geoJSONIndex=re.cluster?new Qe(function({superclusterOptions:Be,clusterProperties:$e}){if(!$e||!Be)return Be;const Se={},Q={},We={accumulated:null,zoom:0},Xe={properties:null},tt=Object.keys($e);for(const lt of tt){const[Lt,Jt]=$e[lt],cn=u.by(Jt),Sn=u.by(typeof Lt=="string"?[Lt,["accumulated"],["get",lt]]:Lt);Se[lt]=cn.value,Q[lt]=Sn.value}return Be.map=lt=>{Xe.properties=lt;const Lt={};for(const Jt of tt)Lt[Jt]=Se[Jt].evaluate(We,Xe);return Lt},Be.reduce=(lt,Lt)=>{Xe.properties=Lt;for(const Jt of tt)We.accumulated=lt[Jt],lt[Jt]=Q[Jt].evaluate(We,Xe)},Be}(re)).load(xe.features):function(Be,$e){return new fn(Be,$e)}(xe,re.geojsonVtOptions),this.loaded={};const Fe={};if(pe){const Be=pe.finish();Be&&(Fe.resourceTiming={},Fe.resourceTiming[re.source]=JSON.parse(JSON.stringify(Be)))}return Fe}catch(xe){if(delete this._pendingRequest,u.bz(xe))return{abandoned:!0};throw xe}})}reloadTile(re){const se=this.loaded;return se&&se[re.uid]?super.reloadTile(re):this.loadTile(re)}loadGeoJSON(re,se){return u._(this,void 0,void 0,function*(){const{promoteId:pe}=re;if(re.request){const xe=yield u.h(re.request,se);return this._dataUpdateable=pi(xe.data,pe)?pn(xe.data,pe):void 0,xe.data}if(typeof re.data=="string")try{const xe=JSON.parse(re.data);return this._dataUpdateable=pi(xe,pe)?pn(xe,pe):void 0,xe}catch{throw new Error(`Input data given to '${re.source}' is not a valid GeoJSON object.`)}if(!re.dataDiff)throw new Error(`Input data given to '${re.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${re.source}`);return function(xe,Fe,Be){var $e,Se,Q,We;if(Fe.removeAll&&xe.clear(),Fe.remove)for(const Xe of Fe.remove)xe.delete(Xe);if(Fe.add)for(const Xe of Fe.add){const tt=Qn(Xe,Be);tt!=null&&xe.set(tt,Xe)}if(Fe.update)for(const Xe of Fe.update){let tt=xe.get(Xe.id);if(tt==null)continue;const lt=!Xe.removeAllProperties&&((($e=Xe.removeProperties)===null||$e===void 0?void 0:$e.length)>0||((Se=Xe.addOrUpdateProperties)===null||Se===void 0?void 0:Se.length)>0);if((Xe.newGeometry||Xe.removeAllProperties||lt)&&(tt=Object.assign({},tt),xe.set(Xe.id,tt),lt&&(tt.properties=Object.assign({},tt.properties))),Xe.newGeometry&&(tt.geometry=Xe.newGeometry),Xe.removeAllProperties)tt.properties={};else if(((Q=Xe.removeProperties)===null||Q===void 0?void 0:Q.length)>0)for(const Lt of Xe.removeProperties)Object.prototype.hasOwnProperty.call(tt.properties,Lt)&&delete tt.properties[Lt];if(((We=Xe.addOrUpdateProperties)===null||We===void 0?void 0:We.length)>0)for(const{key:Lt,value:Jt}of Xe.addOrUpdateProperties)tt.properties[Lt]=Jt}}(this._dataUpdateable,re.dataDiff,pe),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(re){return u._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(re){return this._geoJSONIndex.getClusterExpansionZoom(re.clusterId)}getClusterChildren(re){return this._geoJSONIndex.getChildren(re.clusterId)}getClusterLeaves(re){return this._geoJSONIndex.getLeaves(re.clusterId,re.limit,re.offset)}}class er{constructor(re){this.self=re,this.actor=new u.C(re),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(se,pe)=>{if(this.externalWorkerSourceTypes[se])throw new Error(`Worker source with name "${se}" already registered.`);this.externalWorkerSourceTypes[se]=pe},this.self.addProtocol=u.bf,this.self.removeProtocol=u.bg,this.self.registerRTLTextPlugin=se=>{if(u.bA.isParsed())throw new Error("RTL text plugin already registered.");u.bA.setMethods(se)},this.actor.registerMessageHandler("LDT",(se,pe)=>this._getDEMWorkerSource(se,pe.source).loadTile(pe)),this.actor.registerMessageHandler("RDT",(se,pe)=>u._(this,void 0,void 0,function*(){this._getDEMWorkerSource(se,pe.source).removeTile(pe)})),this.actor.registerMessageHandler("GCEZ",(se,pe)=>u._(this,void 0,void 0,function*(){return this._getWorkerSource(se,pe.type,pe.source).getClusterExpansionZoom(pe)})),this.actor.registerMessageHandler("GCC",(se,pe)=>u._(this,void 0,void 0,function*(){return this._getWorkerSource(se,pe.type,pe.source).getClusterChildren(pe)})),this.actor.registerMessageHandler("GCL",(se,pe)=>u._(this,void 0,void 0,function*(){return this._getWorkerSource(se,pe.type,pe.source).getClusterLeaves(pe)})),this.actor.registerMessageHandler("LD",(se,pe)=>this._getWorkerSource(se,pe.type,pe.source).loadData(pe)),this.actor.registerMessageHandler("LT",(se,pe)=>this._getWorkerSource(se,pe.type,pe.source).loadTile(pe)),this.actor.registerMessageHandler("RT",(se,pe)=>this._getWorkerSource(se,pe.type,pe.source).reloadTile(pe)),this.actor.registerMessageHandler("AT",(se,pe)=>this._getWorkerSource(se,pe.type,pe.source).abortTile(pe)),this.actor.registerMessageHandler("RMT",(se,pe)=>this._getWorkerSource(se,pe.type,pe.source).removeTile(pe)),this.actor.registerMessageHandler("RS",(se,pe)=>u._(this,void 0,void 0,function*(){if(!this.workerSources[se]||!this.workerSources[se][pe.type]||!this.workerSources[se][pe.type][pe.source])return;const xe=this.workerSources[se][pe.type][pe.source];delete this.workerSources[se][pe.type][pe.source],xe.removeSource!==void 0&&xe.removeSource(pe)})),this.actor.registerMessageHandler("RM",se=>u._(this,void 0,void 0,function*(){delete this.layerIndexes[se],delete this.availableImages[se],delete this.workerSources[se],delete this.demWorkerSources[se]})),this.actor.registerMessageHandler("SR",(se,pe)=>u._(this,void 0,void 0,function*(){this.referrer=pe})),this.actor.registerMessageHandler("SRPS",(se,pe)=>this._syncRTLPluginState(se,pe)),this.actor.registerMessageHandler("IS",(se,pe)=>u._(this,void 0,void 0,function*(){this.self.importScripts(pe)})),this.actor.registerMessageHandler("SI",(se,pe)=>this._setImages(se,pe)),this.actor.registerMessageHandler("UL",(se,pe)=>u._(this,void 0,void 0,function*(){this._getLayerIndex(se).update(pe.layers,pe.removedIds)})),this.actor.registerMessageHandler("SL",(se,pe)=>u._(this,void 0,void 0,function*(){this._getLayerIndex(se).replace(pe)}))}_setImages(re,se){return u._(this,void 0,void 0,function*(){this.availableImages[re]=se;for(const pe in this.workerSources[re]){const xe=this.workerSources[re][pe];for(const Fe in xe)xe[Fe].availableImages=se}})}_syncRTLPluginState(re,se){return u._(this,void 0,void 0,function*(){if(u.bA.isParsed())return u.bA.getState();if(se.pluginStatus!=="loading")return u.bA.setState(se),se;const pe=se.pluginURL;if(this.self.importScripts(pe),u.bA.isParsed()){const xe={pluginStatus:"loaded",pluginURL:pe};return u.bA.setState(xe),xe}throw u.bA.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${pe}`)})}_getAvailableImages(re){let se=this.availableImages[re];return se||(se=[]),se}_getLayerIndex(re){let se=this.layerIndexes[re];return se||(se=this.layerIndexes[re]=new a),se}_getWorkerSource(re,se,pe){if(this.workerSources[re]||(this.workerSources[re]={}),this.workerSources[re][se]||(this.workerSources[re][se]={}),!this.workerSources[re][se][pe]){const xe={sendAsync:(Fe,Be)=>(Fe.targetMapId=re,this.actor.sendAsync(Fe,Be))};switch(se){case"vector":this.workerSources[re][se][pe]=new y(xe,this._getLayerIndex(re),this._getAvailableImages(re));break;case"geojson":this.workerSources[re][se][pe]=new Di(xe,this._getLayerIndex(re),this._getAvailableImages(re));break;default:this.workerSources[re][se][pe]=new this.externalWorkerSourceTypes[se](xe,this._getLayerIndex(re),this._getAvailableImages(re))}}return this.workerSources[re][se][pe]}_getDEMWorkerSource(re,se){return this.demWorkerSources[re]||(this.demWorkerSources[re]={}),this.demWorkerSources[re][se]||(this.demWorkerSources[re][se]=new x),this.demWorkerSources[re][se]}}return u.i(self)&&(self.worker=new er(self)),er}),i("index",["exports","./shared"],function(u,a){var d="4.1.3";let p,g;const y={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:w=>new Promise((l,f)=>{const _=requestAnimationFrame(l);w.signal.addEventListener("abort",()=>{cancelAnimationFrame(_),f(a.c())})}),getImageData(w,l=0){return this.getImageCanvasContext(w).getImageData(-l,-l,w.width+2*l,w.height+2*l)},getImageCanvasContext(w){const l=window.document.createElement("canvas"),f=l.getContext("2d",{willReadFrequently:!0});if(!f)throw new Error("failed to create canvas 2d context");return l.width=w.width,l.height=w.height,f.drawImage(w,0,0,w.width,w.height),f},resolveURL:w=>(p||(p=document.createElement("a")),p.href=w,p.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(g==null&&(g=matchMedia("(prefers-reduced-motion: reduce)")),g.matches)}};class x{static testProp(l){if(!x.docStyle)return l[0];for(let f=0;f<l.length;f++)if(l[f]in x.docStyle)return l[f];return l[0]}static create(l,f,_){const b=window.document.createElement(l);return f!==void 0&&(b.className=f),_&&_.appendChild(b),b}static createNS(l,f){return window.document.createElementNS(l,f)}static disableDrag(){x.docStyle&&x.selectProp&&(x.userSelect=x.docStyle[x.selectProp],x.docStyle[x.selectProp]="none")}static enableDrag(){x.docStyle&&x.selectProp&&(x.docStyle[x.selectProp]=x.userSelect)}static setTransform(l,f){l.style[x.transformProp]=f}static addEventListener(l,f,_,b={}){l.addEventListener(f,_,"passive"in b?b:b.capture)}static removeEventListener(l,f,_,b={}){l.removeEventListener(f,_,"passive"in b?b:b.capture)}static suppressClickInternal(l){l.preventDefault(),l.stopPropagation(),window.removeEventListener("click",x.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",x.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",x.suppressClickInternal,!0)},0)}static getScale(l){const f=l.getBoundingClientRect();return{x:f.width/l.offsetWidth||1,y:f.height/l.offsetHeight||1,boundingClientRect:f}}static getPoint(l,f,_){const b=f.boundingClientRect;return new a.P((_.clientX-b.left)/f.x-l.clientLeft,(_.clientY-b.top)/f.y-l.clientTop)}static mousePos(l,f){const _=x.getScale(l);return x.getPoint(l,_,f)}static touchPos(l,f){const _=[],b=x.getScale(l);for(let k=0;k<f.length;k++)_.push(x.getPoint(l,b,f[k]));return _}static mouseButton(l){return l.button}static remove(l){l.parentNode&&l.parentNode.removeChild(l)}}x.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,x.selectProp=x.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),x.transformProp=x.testProp(["transform","WebkitTransform"]);const C={supported:!1,testSupport:function(w){!z&&F&&(E?P(w):M=w)}};let M,F,z=!1,E=!1;function P(w){const l=w.createTexture();w.bindTexture(w.TEXTURE_2D,l);try{if(w.texImage2D(w.TEXTURE_2D,0,w.RGBA,w.RGBA,w.UNSIGNED_BYTE,F),w.isContextLost())return;C.supported=!0}catch{}w.deleteTexture(l),z=!0}var $;typeof document<"u"&&(F=document.createElement("img"),F.onload=function(){M&&P(M),M=null,E=!0},F.onerror=function(){z=!0,M=null},F.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(w){let l,f,_,b;w.resetRequestQueue=()=>{l=[],f=0,_=0,b={}},w.addThrottleControl=B=>{const G=_++;return b[G]=B,G},w.removeThrottleControl=B=>{delete b[B],I()},w.getImage=(B,G,Y=!0)=>new Promise((te,me)=>{C.supported&&(B.headers||(B.headers={}),B.headers.accept="image/webp,*/*"),a.e(B,{type:"image"}),l.push({abortController:G,requestParameters:B,supportImageRefresh:Y,state:"queued",onError:Te=>{me(Te)},onSuccess:Te=>{te(Te)}}),I()});const k=B=>a._(this,void 0,void 0,function*(){B.state="running";const{requestParameters:G,supportImageRefresh:Y,onError:te,onSuccess:me,abortController:Te}=B,ke=Y===!1&&!a.i(self)&&!a.g(G.url)&&(!G.headers||Object.keys(G.headers).reduce((Re,et)=>Re&&et==="accept",!0));f++;const Le=ke?A(G,Te):a.m(G,Te);try{const Re=yield Le;delete B.abortController,B.state="completed",Re.data instanceof HTMLImageElement||a.b(Re.data)?me(Re):Re.data&&me({data:yield(be=Re.data,typeof createImageBitmap=="function"?a.d(be):a.f(be)),cacheControl:Re.cacheControl,expires:Re.expires})}catch(Re){delete B.abortController,te(Re)}finally{f--,I()}var be}),I=()=>{const B=(()=>{for(const G of Object.keys(b))if(b[G]())return!0;return!1})()?a.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:a.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let G=f;G<B&&l.length>0;G++){const Y=l.shift();Y.abortController.signal.aborted?G--:k(Y)}},A=(B,G)=>new Promise((Y,te)=>{const me=new Image,Te=B.url,ke=B.credentials;ke&&ke==="include"?me.crossOrigin="use-credentials":(ke&&ke==="same-origin"||!a.s(Te))&&(me.crossOrigin="anonymous"),G.signal.addEventListener("abort",()=>{me.src="",te(a.c())}),me.fetchPriority="high",me.onload=()=>{me.onerror=me.onload=null,Y({data:me})},me.onerror=()=>{me.onerror=me.onload=null,G.signal.aborted||te(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},me.src=Te})}($||($={})),$.resetRequestQueue();class U{constructor(l){this._transformRequestFn=l}transformRequest(l,f){return this._transformRequestFn&&this._transformRequestFn(l,f)||{url:l}}normalizeSpriteURL(l,f,_){const b=function(k){const I=k.match(K);if(!I)throw new Error(`Unable to parse URL "${k}"`);return{protocol:I[1],authority:I[2],path:I[3]||"/",params:I[4]?I[4].split("&"):[]}}(l);return b.path+=`${f}${_}`,function(k){const I=k.params.length?`?${k.params.join("&")}`:"";return`${k.protocol}://${k.authority}${k.path}${I}`}(b)}setTransformRequest(l){this._transformRequestFn=l}}const K=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function ee(w){var l=new a.A(3);return l[0]=w[0],l[1]=w[1],l[2]=w[2],l}var W,J=function(w,l,f){return w[0]=l[0]-f[0],w[1]=l[1]-f[1],w[2]=l[2]-f[2],w};W=new a.A(3),a.A!=Float32Array&&(W[0]=0,W[1]=0,W[2]=0);var he=function(w){var l=w[0],f=w[1];return l*l+f*f};function Ae(w){const l=[];if(typeof w=="string")l.push({id:"default",url:w});else if(w&&w.length>0){const f=[];for(const{id:_,url:b}of w){const k=`${_}${b}`;f.indexOf(k)===-1&&(f.push(k),l.push({id:_,url:b}))}}return l}(function(){var w=new a.A(2);a.A!=Float32Array&&(w[0]=0,w[1]=0)})();class ne{constructor(l,f,_,b){this.context=l,this.format=_,this.texture=l.gl.createTexture(),this.update(f,b)}update(l,f,_){const{width:b,height:k}=l,I=!(this.size&&this.size[0]===b&&this.size[1]===k||_),{context:A}=this,{gl:B}=A;if(this.useMipmap=!!(f&&f.useMipmap),B.bindTexture(B.TEXTURE_2D,this.texture),A.pixelStoreUnpackFlipY.set(!1),A.pixelStoreUnpack.set(1),A.pixelStoreUnpackPremultiplyAlpha.set(this.format===B.RGBA&&(!f||f.premultiply!==!1)),I)this.size=[b,k],l instanceof HTMLImageElement||l instanceof HTMLCanvasElement||l instanceof HTMLVideoElement||l instanceof ImageData||a.b(l)?B.texImage2D(B.TEXTURE_2D,0,this.format,this.format,B.UNSIGNED_BYTE,l):B.texImage2D(B.TEXTURE_2D,0,this.format,b,k,0,this.format,B.UNSIGNED_BYTE,l.data);else{const{x:G,y:Y}=_||{x:0,y:0};l instanceof HTMLImageElement||l instanceof HTMLCanvasElement||l instanceof HTMLVideoElement||l instanceof ImageData||a.b(l)?B.texSubImage2D(B.TEXTURE_2D,0,G,Y,B.RGBA,B.UNSIGNED_BYTE,l):B.texSubImage2D(B.TEXTURE_2D,0,G,Y,b,k,B.RGBA,B.UNSIGNED_BYTE,l.data)}this.useMipmap&&this.isSizePowerOfTwo()&&B.generateMipmap(B.TEXTURE_2D)}bind(l,f,_){const{context:b}=this,{gl:k}=b;k.bindTexture(k.TEXTURE_2D,this.texture),_!==k.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(_=k.LINEAR),l!==this.filter&&(k.texParameteri(k.TEXTURE_2D,k.TEXTURE_MAG_FILTER,l),k.texParameteri(k.TEXTURE_2D,k.TEXTURE_MIN_FILTER,_||l),this.filter=l),f!==this.wrap&&(k.texParameteri(k.TEXTURE_2D,k.TEXTURE_WRAP_S,f),k.texParameteri(k.TEXTURE_2D,k.TEXTURE_WRAP_T,f),this.wrap=f)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:l}=this.context;l.deleteTexture(this.texture),this.texture=null}}function fe(w){const{userImage:l}=w;return!!(l&&l.render&&l.render())&&(w.data.replace(new Uint8Array(l.data.buffer)),!0)}class Ce extends a.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new a.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(l){if(this.loaded!==l&&(this.loaded=l,l)){for(const{ids:f,promiseResolve:_}of this.requestors)_(this._getImagesForIds(f));this.requestors=[]}}getImage(l){const f=this.images[l];if(f&&!f.data&&f.spriteData){const _=f.spriteData;f.data=new a.R({width:_.width,height:_.height},_.context.getImageData(_.x,_.y,_.width,_.height).data),f.spriteData=null}return f}addImage(l,f){if(this.images[l])throw new Error(`Image id ${l} already exist, use updateImage instead`);this._validate(l,f)&&(this.images[l]=f)}_validate(l,f){let _=!0;const b=f.data||f.spriteData;return this._validateStretch(f.stretchX,b&&b.width)||(this.fire(new a.j(new Error(`Image "${l}" has invalid "stretchX" value`))),_=!1),this._validateStretch(f.stretchY,b&&b.height)||(this.fire(new a.j(new Error(`Image "${l}" has invalid "stretchY" value`))),_=!1),this._validateContent(f.content,f)||(this.fire(new a.j(new Error(`Image "${l}" has invalid "content" value`))),_=!1),_}_validateStretch(l,f){if(!l)return!0;let _=0;for(const b of l){if(b[0]<_||b[1]<b[0]||f<b[1])return!1;_=b[1]}return!0}_validateContent(l,f){if(!l)return!0;if(l.length!==4)return!1;const _=f.spriteData,b=_&&_.width||f.data.width,k=_&&_.height||f.data.height;return!(l[0]<0||b<l[0]||l[1]<0||k<l[1]||l[2]<0||b<l[2]||l[3]<0||k<l[3]||l[2]<l[0]||l[3]<l[1])}updateImage(l,f,_=!0){const b=this.getImage(l);if(_&&(b.data.width!==f.data.width||b.data.height!==f.data.height))throw new Error(`size mismatch between old image (${b.data.width}x${b.data.height}) and new image (${f.data.width}x${f.data.height}).`);f.version=b.version+1,this.images[l]=f,this.updatedImages[l]=!0}removeImage(l){const f=this.images[l];delete this.images[l],delete this.patterns[l],f.userImage&&f.userImage.onRemove&&f.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(l){return new Promise((f,_)=>{let b=!0;if(!this.isLoaded())for(const k of l)this.images[k]||(b=!1);this.isLoaded()||b?f(this._getImagesForIds(l)):this.requestors.push({ids:l,promiseResolve:f})})}_getImagesForIds(l){const f={};for(const _ of l){let b=this.getImage(_);b||(this.fire(new a.k("styleimagemissing",{id:_})),b=this.getImage(_)),b?f[_]={data:b.data.clone(),pixelRatio:b.pixelRatio,sdf:b.sdf,version:b.version,stretchX:b.stretchX,stretchY:b.stretchY,content:b.content,hasRenderCallback:!!(b.userImage&&b.userImage.render)}:a.w(`Image "${_}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return f}getPixelSize(){const{width:l,height:f}=this.atlasImage;return{width:l,height:f}}getPattern(l){const f=this.patterns[l],_=this.getImage(l);if(!_)return null;if(f&&f.position.version===_.version)return f.position;if(f)f.position.version=_.version;else{const b={w:_.data.width+2,h:_.data.height+2,x:0,y:0},k=new a.I(b,_);this.patterns[l]={bin:b,position:k}}return this._updatePatternAtlas(),this.patterns[l].position}bind(l){const f=l.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new ne(l,this.atlasImage,f.RGBA),this.atlasTexture.bind(f.LINEAR,f.CLAMP_TO_EDGE)}_updatePatternAtlas(){const l=[];for(const k in this.patterns)l.push(this.patterns[k].bin);const{w:f,h:_}=a.p(l),b=this.atlasImage;b.resize({width:f||1,height:_||1});for(const k in this.patterns){const{bin:I}=this.patterns[k],A=I.x+1,B=I.y+1,G=this.getImage(k).data,Y=G.width,te=G.height;a.R.copy(G,b,{x:0,y:0},{x:A,y:B},{width:Y,height:te}),a.R.copy(G,b,{x:0,y:te-1},{x:A,y:B-1},{width:Y,height:1}),a.R.copy(G,b,{x:0,y:0},{x:A,y:B+te},{width:Y,height:1}),a.R.copy(G,b,{x:Y-1,y:0},{x:A-1,y:B},{width:1,height:te}),a.R.copy(G,b,{x:0,y:0},{x:A+Y,y:B},{width:1,height:te})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(l){for(const f of l){if(this.callbackDispatchedThisFrame[f])continue;this.callbackDispatchedThisFrame[f]=!0;const _=this.getImage(f);_||a.w(`Image with ID: "${f}" was not found`),fe(_)&&this.updateImage(f,_)}}}const _e=1e20;function Ze(w,l,f,_,b,k,I,A,B){for(let G=l;G<l+_;G++)Oe(w,f*k+G,k,b,I,A,B);for(let G=f;G<f+b;G++)Oe(w,G*k+l,1,_,I,A,B)}function Oe(w,l,f,_,b,k,I){k[0]=0,I[0]=-_e,I[1]=_e,b[0]=w[l];for(let A=1,B=0,G=0;A<_;A++){b[A]=w[l+A*f];const Y=A*A;do{const te=k[B];G=(b[A]-b[te]+Y-te*te)/(A-te)/2}while(G<=I[B]&&--B>-1);B++,k[B]=A,I[B]=G,I[B+1]=_e}for(let A=0,B=0;A<_;A++){for(;I[B+1]<A;)B++;const G=k[B],Y=A-G;w[l+A*f]=b[G]+Y*Y}}class je{constructor(l,f){this.requestManager=l,this.localIdeographFontFamily=f,this.entries={}}setURL(l){this.url=l}getGlyphs(l){return a._(this,void 0,void 0,function*(){const f=[];for(const k in l)for(const I of l[k])f.push(this._getAndCacheGlyphsPromise(k,I));const _=yield Promise.all(f),b={};for(const{stack:k,id:I,glyph:A}of _)b[k]||(b[k]={}),b[k][I]=A&&{id:A.id,bitmap:A.bitmap.clone(),metrics:A.metrics};return b})}_getAndCacheGlyphsPromise(l,f){return a._(this,void 0,void 0,function*(){let _=this.entries[l];_||(_=this.entries[l]={glyphs:{},requests:{},ranges:{}});let b=_.glyphs[f];if(b!==void 0)return{stack:l,id:f,glyph:b};if(b=this._tinySDF(_,l,f),b)return _.glyphs[f]=b,{stack:l,id:f,glyph:b};const k=Math.floor(f/256);if(256*k>65535)throw new Error("glyphs > 65535 not supported");if(_.ranges[k])return{stack:l,id:f,glyph:b};if(!this.url)throw new Error("glyphsUrl is not set");if(!_.requests[k]){const A=je.loadGlyphRange(l,k,this.url,this.requestManager);_.requests[k]=A}const I=yield _.requests[k];for(const A in I)this._doesCharSupportLocalGlyph(+A)||(_.glyphs[+A]=I[+A]);return _.ranges[k]=!0,{stack:l,id:f,glyph:I[f]||null}})}_doesCharSupportLocalGlyph(l){return!!this.localIdeographFontFamily&&(a.u["CJK Unified Ideographs"](l)||a.u["Hangul Syllables"](l)||a.u.Hiragana(l)||a.u.Katakana(l))}_tinySDF(l,f,_){const b=this.localIdeographFontFamily;if(!b||!this._doesCharSupportLocalGlyph(_))return;let k=l.tinySDF;if(!k){let A="400";/bold/i.test(f)?A="900":/medium/i.test(f)?A="500":/light/i.test(f)&&(A="200"),k=l.tinySDF=new je.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:b,fontWeight:A})}const I=k.draw(String.fromCharCode(_));return{id:_,bitmap:new a.o({width:I.width||60,height:I.height||60},I.data),metrics:{width:I.glyphWidth/2||24,height:I.glyphHeight/2||24,left:I.glyphLeft/2+.5||0,top:I.glyphTop/2-27.5||-8,advance:I.glyphAdvance/2||24,isDoubleResolution:!0}}}}je.loadGlyphRange=function(w,l,f,_){return a._(this,void 0,void 0,function*(){const b=256*l,k=b+255,I=_.transformRequest(f.replace("{fontstack}",w).replace("{range}",`${b}-${k}`),"Glyphs"),A=yield a.l(I,new AbortController);if(!A||!A.data)throw new Error(`Could not load glyph range. range: ${l}, ${b}-${k}`);const B={};for(const G of a.n(A.data))B[G.id]=G;return B})},je.TinySDF=class{constructor({fontSize:w=24,buffer:l=3,radius:f=8,cutoff:_=.25,fontFamily:b="sans-serif",fontWeight:k="normal",fontStyle:I="normal"}={}){this.buffer=l,this.cutoff=_,this.radius=f;const A=this.size=w+4*l,B=this._createCanvas(A),G=this.ctx=B.getContext("2d",{willReadFrequently:!0});G.font=`${I} ${k} ${w}px ${b}`,G.textBaseline="alphabetic",G.textAlign="left",G.fillStyle="black",this.gridOuter=new Float64Array(A*A),this.gridInner=new Float64Array(A*A),this.f=new Float64Array(A),this.z=new Float64Array(A+1),this.v=new Uint16Array(A)}_createCanvas(w){const l=document.createElement("canvas");return l.width=l.height=w,l}draw(w){const{width:l,actualBoundingBoxAscent:f,actualBoundingBoxDescent:_,actualBoundingBoxLeft:b,actualBoundingBoxRight:k}=this.ctx.measureText(w),I=Math.ceil(f),A=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(k-b))),B=Math.min(this.size-this.buffer,I+Math.ceil(_)),G=A+2*this.buffer,Y=B+2*this.buffer,te=Math.max(G*Y,0),me=new Uint8ClampedArray(te),Te={data:me,width:G,height:Y,glyphWidth:A,glyphHeight:B,glyphTop:I,glyphLeft:0,glyphAdvance:l};if(A===0||B===0)return Te;const{ctx:ke,buffer:Le,gridInner:be,gridOuter:Re}=this;ke.clearRect(Le,Le,A,B),ke.fillText(w,Le,Le+I);const et=ke.getImageData(Le,Le,A,B);Re.fill(_e,0,te),be.fill(0,0,te);for(let Ie=0;Ie<B;Ie++)for(let Ve=0;Ve<A;Ve++){const nt=et.data[4*(Ie*A+Ve)+3]/255;if(nt===0)continue;const rt=(Ie+Le)*G+Ve+Le;if(nt===1)Re[rt]=0,be[rt]=_e;else{const at=.5-nt;Re[rt]=at>0?at*at:0,be[rt]=at<0?at*at:0}}Ze(Re,0,0,G,Y,G,this.f,this.v,this.z),Ze(be,Le,Le,A,B,G,this.f,this.v,this.z);for(let Ie=0;Ie<te;Ie++){const Ve=Math.sqrt(Re[Ie])-Math.sqrt(be[Ie]);me[Ie]=Math.round(255-255*(Ve/this.radius+this.cutoff))}return Te}};class De{constructor(){this.specification=a.v.light.position}possiblyEvaluate(l,f){return a.y(l.expression.evaluate(f))}interpolate(l,f,_){return{x:a.z.number(l.x,f.x,_),y:a.z.number(l.y,f.y,_),z:a.z.number(l.z,f.z,_)}}}let At;class ut extends a.E{constructor(l){super(),At=At||new a.q({anchor:new a.D(a.v.light.anchor),position:new De,color:new a.D(a.v.light.color),intensity:new a.D(a.v.light.intensity)}),this._transitionable=new a.T(At),this.setLight(l),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(l,f={}){if(!this._validate(a.r,l,f))for(const _ in l){const b=l[_];_.endsWith("-transition")?this._transitionable.setTransition(_.slice(0,-11),b):this._transitionable.setValue(_,b)}}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}_validate(l,f,_){return(!_||_.validate!==!1)&&a.t(this,l.call(a.x,{value:f,style:{glyphs:!0,sprite:!0},styleSpec:a.v}))}}class ht{constructor(l,f){this.width=l,this.height=f,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(l,f){const _=l.join(",")+String(f);return this.dashEntry[_]||(this.dashEntry[_]=this.addDash(l,f)),this.dashEntry[_]}getDashRanges(l,f,_){const b=[];let k=l.length%2==1?-l[l.length-1]*_:0,I=l[0]*_,A=!0;b.push({left:k,right:I,isDash:A,zeroLength:l[0]===0});let B=l[0];for(let G=1;G<l.length;G++){A=!A;const Y=l[G];k=B*_,B+=Y,I=B*_,b.push({left:k,right:I,isDash:A,zeroLength:Y===0})}return b}addRoundDash(l,f,_){const b=f/2;for(let k=-_;k<=_;k++){const I=this.width*(this.nextRow+_+k);let A=0,B=l[A];for(let G=0;G<this.width;G++){G/B.right>1&&(B=l[++A]);const Y=Math.abs(G-B.left),te=Math.abs(G-B.right),me=Math.min(Y,te);let Te;const ke=k/_*(b+1);if(B.isDash){const Le=b-Math.abs(ke);Te=Math.sqrt(me*me+Le*Le)}else Te=b-Math.sqrt(me*me+ke*ke);this.data[I+G]=Math.max(0,Math.min(255,Te+128))}}}addRegularDash(l){for(let A=l.length-1;A>=0;--A){const B=l[A],G=l[A+1];B.zeroLength?l.splice(A,1):G&&G.isDash===B.isDash&&(G.left=B.left,l.splice(A,1))}const f=l[0],_=l[l.length-1];f.isDash===_.isDash&&(f.left=_.left-this.width,_.right=f.right+this.width);const b=this.width*this.nextRow;let k=0,I=l[k];for(let A=0;A<this.width;A++){A/I.right>1&&(I=l[++k]);const B=Math.abs(A-I.left),G=Math.abs(A-I.right),Y=Math.min(B,G);this.data[b+A]=Math.max(0,Math.min(255,(I.isDash?Y:-Y)+128))}}addDash(l,f){const _=f?7:0,b=2*_+1;if(this.nextRow+b>this.height)return a.w("LineAtlas out of space"),null;let k=0;for(let A=0;A<l.length;A++)k+=l[A];if(k!==0){const A=this.width/k,B=this.getDashRanges(l,this.width,A);f?this.addRoundDash(B,A,_):this.addRegularDash(B)}const I={y:(this.nextRow+_+.5)/this.height,height:2*_/this.height,width:k};return this.nextRow+=b,this.dirty=!0,I}bind(l){const f=l.gl;this.texture?(f.bindTexture(f.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,f.texSubImage2D(f.TEXTURE_2D,0,0,0,this.width,this.height,f.ALPHA,f.UNSIGNED_BYTE,this.data))):(this.texture=f.createTexture(),f.bindTexture(f.TEXTURE_2D,this.texture),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,f.REPEAT),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,f.REPEAT),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,f.LINEAR),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,f.LINEAR),f.texImage2D(f.TEXTURE_2D,0,f.ALPHA,this.width,this.height,0,f.ALPHA,f.UNSIGNED_BYTE,this.data))}}const wt="maplibre_preloaded_worker_pool";class pt{constructor(){this.active={}}acquire(l){if(!this.workers)for(this.workers=[];this.workers.length<pt.workerCount;)this.workers.push(new Worker(a.a.WORKER_URL));return this.active[l]=!0,this.workers.slice()}release(l){delete this.active[l],this.numActive()===0&&(this.workers.forEach(f=>{f.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[wt]}numActive(){return Object.keys(this.active).length}}const Qe=Math.floor(y.hardwareConcurrency/2);let Ft,bt;function Bt(){return Ft||(Ft=new pt),Ft}pt.workerCount=a.B(globalThis)?Math.max(Math.min(Qe,3),1):1;class Pt{constructor(l,f){this.workerPool=l,this.actors=[],this.currentActor=0,this.id=f;const _=this.workerPool.acquire(f);for(let b=0;b<_.length;b++){const k=new a.C(_[b],f);k.name=`Worker ${b}`,this.actors.push(k)}if(!this.actors.length)throw new Error("No actors found")}broadcast(l,f){const _=[];for(const b of this.actors)_.push(b.sendAsync({type:l,data:f}));return Promise.all(_)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(l=!0){this.actors.forEach(f=>{f.remove()}),this.actors=[],l&&this.workerPool.release(this.id)}registerMessageHandler(l,f){for(const _ of this.actors)_.registerMessageHandler(l,f)}}function Qt(){return bt||(bt=new Pt(Bt(),a.G),bt.registerMessageHandler("GR",(w,l,f)=>a.m(l,f))),bt}function vn(w,l){const f=a.F();return a.H(f,f,[1,1,0]),a.J(f,f,[.5*w.width,.5*w.height,1]),a.K(f,f,w.calculatePosMatrix(l.toUnwrapped()))}function qt(w,l,f,_,b,k){const I=function(te,me,Te){if(te)for(const ke of te){const Le=me[ke];if(Le&&Le.source===Te&&Le.type==="fill-extrusion")return!0}else for(const ke in me){const Le=me[ke];if(Le.source===Te&&Le.type==="fill-extrusion")return!0}return!1}(b&&b.layers,l,w.id),A=k.maxPitchScaleFactor(),B=w.tilesIn(_,A,I);B.sort(rn);const G=[];for(const te of B)G.push({wrappedTileID:te.tileID.wrapped().key,queryResults:te.tile.queryRenderedFeatures(l,f,w._state,te.queryGeometry,te.cameraQueryGeometry,te.scale,b,k,A,vn(w.transform,te.tileID))});const Y=function(te){const me={},Te={};for(const ke of te){const Le=ke.queryResults,be=ke.wrappedTileID,Re=Te[be]=Te[be]||{};for(const et in Le){const Ie=Le[et],Ve=Re[et]=Re[et]||{},nt=me[et]=me[et]||[];for(const rt of Ie)Ve[rt.featureIndex]||(Ve[rt.featureIndex]=!0,nt.push(rt))}}return me}(G);for(const te in Y)Y[te].forEach(me=>{const Te=me.feature,ke=w.getFeatureState(Te.layer["source-layer"],Te.id);Te.source=Te.layer.source,Te.layer["source-layer"]&&(Te.sourceLayer=Te.layer["source-layer"]),Te.state=ke});return Y}function rn(w,l){const f=w.tileID,_=l.tileID;return f.overscaledZ-_.overscaledZ||f.canonical.y-_.canonical.y||f.wrap-_.wrap||f.canonical.x-_.canonical.x}function Ge(w,l,f){return a._(this,void 0,void 0,function*(){let _=w;if(w.url?_=(yield a.h(l.transformRequest(w.url,"Source"),f)).data:yield y.frameAsync(f),!_)return null;const b=a.L(a.e(_,w),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in _&&_.vector_layers&&(b.vectorLayerIds=_.vector_layers.map(k=>k.id)),b})}class qe{constructor(l,f){l&&(f?this.setSouthWest(l).setNorthEast(f):Array.isArray(l)&&(l.length===4?this.setSouthWest([l[0],l[1]]).setNorthEast([l[2],l[3]]):this.setSouthWest(l[0]).setNorthEast(l[1])))}setNorthEast(l){return this._ne=l instanceof a.M?new a.M(l.lng,l.lat):a.M.convert(l),this}setSouthWest(l){return this._sw=l instanceof a.M?new a.M(l.lng,l.lat):a.M.convert(l),this}extend(l){const f=this._sw,_=this._ne;let b,k;if(l instanceof a.M)b=l,k=l;else{if(!(l instanceof qe))return Array.isArray(l)?l.length===4||l.every(Array.isArray)?this.extend(qe.convert(l)):this.extend(a.M.convert(l)):l&&("lng"in l||"lon"in l)&&"lat"in l?this.extend(a.M.convert(l)):this;if(b=l._sw,k=l._ne,!b||!k)return this}return f||_?(f.lng=Math.min(b.lng,f.lng),f.lat=Math.min(b.lat,f.lat),_.lng=Math.max(k.lng,_.lng),_.lat=Math.max(k.lat,_.lat)):(this._sw=new a.M(b.lng,b.lat),this._ne=new a.M(k.lng,k.lat)),this}getCenter(){return new a.M((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new a.M(this.getWest(),this.getNorth())}getSouthEast(){return new a.M(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(l){const{lng:f,lat:_}=a.M.convert(l);let b=this._sw.lng<=f&&f<=this._ne.lng;return this._sw.lng>this._ne.lng&&(b=this._sw.lng>=f&&f>=this._ne.lng),this._sw.lat<=_&&_<=this._ne.lat&&b}static convert(l){return l instanceof qe?l:l&&new qe(l)}static fromLngLat(l,f=0){const _=360*f/40075017,b=_/Math.cos(Math.PI/180*l.lat);return new qe(new a.M(l.lng-b,l.lat-_),new a.M(l.lng+b,l.lat+_))}}class Je{constructor(l,f,_){this.bounds=qe.convert(this.validateBounds(l)),this.minzoom=f||0,this.maxzoom=_||24}validateBounds(l){return Array.isArray(l)&&l.length===4?[Math.max(-180,l[0]),Math.max(-90,l[1]),Math.min(180,l[2]),Math.min(90,l[3])]:[-180,-90,180,90]}contains(l){const f=Math.pow(2,l.z),_=Math.floor(a.N(this.bounds.getWest())*f),b=Math.floor(a.O(this.bounds.getNorth())*f),k=Math.ceil(a.N(this.bounds.getEast())*f),I=Math.ceil(a.O(this.bounds.getSouth())*f);return l.x>=_&&l.x<k&&l.y>=b&&l.y<I}}class Et extends a.E{constructor(l,f,_,b){if(super(),this.id=l,this.dispatcher=_,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,a.e(this,a.L(f,["url","scheme","tileSize","promoteId"])),this._options=a.e({type:"vector"},f),this._collectResourceTiming=f.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(b)}load(){return a._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new a.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const l=yield Ge(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),l&&(a.e(this,l),l.bounds&&(this.tileBounds=new Je(l.bounds,this.minzoom,this.maxzoom)),this.fire(new a.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.k("data",{dataType:"source",sourceDataType:"content"})))}catch(l){this._tileJSONRequest=null,this.fire(new a.j(l))}})}loaded(){return this._loaded}hasTile(l){return!this.tileBounds||this.tileBounds.contains(l.canonical)}onAdd(l){this.map=l,this.load()}setSourceProperty(l){this._tileJSONRequest&&this._tileJSONRequest.abort(),l(),this.load()}setTiles(l){return this.setSourceProperty(()=>{this._options.tiles=l}),this}setUrl(l){return this.setSourceProperty(()=>{this.url=l,this._options.url=l}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return a.e({},this._options)}loadTile(l){return a._(this,void 0,void 0,function*(){const f=l.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),_={request:this.map._requestManager.transformRequest(f,"Tile"),uid:l.uid,tileID:l.tileID,zoom:l.tileID.overscaledZ,tileSize:this.tileSize*l.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};_.request.collectResourceTiming=this._collectResourceTiming;let b="RT";if(l.actor&&l.state!=="expired"){if(l.state==="loading")return new Promise((k,I)=>{l.reloadPromise={resolve:k,reject:I}})}else l.actor=this.dispatcher.getActor(),b="LT";l.abortController=new AbortController;try{const k=yield l.actor.sendAsync({type:b,data:_},l.abortController);if(delete l.abortController,l.aborted)return;this._afterTileLoadWorkerResponse(l,k)}catch(k){if(delete l.abortController,l.aborted)return;if(k&&k.status!==404)throw k;this._afterTileLoadWorkerResponse(l,null)}})}_afterTileLoadWorkerResponse(l,f){if(f&&f.resourceTiming&&(l.resourceTiming=f.resourceTiming),f&&this.map._refreshExpiredTiles&&l.setExpiryData(f),l.loadVectorData(f,this.map.painter),l.reloadPromise){const _=l.reloadPromise;l.reloadPromise=null,this.loadTile(l).then(_.resolve).catch(_.reject)}}abortTile(l){return a._(this,void 0,void 0,function*(){l.abortController&&(l.abortController.abort(),delete l.abortController),l.actor&&(yield l.actor.sendAsync({type:"AT",data:{uid:l.uid,type:this.type,source:this.id}}))})}unloadTile(l){return a._(this,void 0,void 0,function*(){l.unloadVectorData(),l.actor&&(yield l.actor.sendAsync({type:"RMT",data:{uid:l.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class ye extends a.E{constructor(l,f,_,b){super(),this.id=l,this.dispatcher=_,this.setEventedParent(b),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=a.e({type:"raster"},f),a.e(this,a.L(f,["url","scheme","tileSize"]))}load(){return a._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new a.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const l=yield Ge(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,l&&(a.e(this,l),l.bounds&&(this.tileBounds=new Je(l.bounds,this.minzoom,this.maxzoom)),this.fire(new a.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.k("data",{dataType:"source",sourceDataType:"content"})))}catch(l){this._tileJSONRequest=null,this.fire(new a.j(l))}})}loaded(){return this._loaded}onAdd(l){this.map=l,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(l){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),l(),this.load()}setTiles(l){return this.setSourceProperty(()=>{this._options.tiles=l}),this}setUrl(l){return this.setSourceProperty(()=>{this.url=l,this._options.url=l}),this}serialize(){return a.e({},this._options)}hasTile(l){return!this.tileBounds||this.tileBounds.contains(l.canonical)}loadTile(l){return a._(this,void 0,void 0,function*(){const f=l.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);l.abortController=new AbortController;try{const _=yield $.getImage(this.map._requestManager.transformRequest(f,"Tile"),l.abortController,this.map._refreshExpiredTiles);if(delete l.abortController,l.aborted)return void(l.state="unloaded");if(_&&_.data){this.map._refreshExpiredTiles&&_.cacheControl&&_.expires&&l.setExpiryData({cacheControl:_.cacheControl,expires:_.expires});const b=this.map.painter.context,k=b.gl,I=_.data;l.texture=this.map.painter.getTileTexture(I.width),l.texture?l.texture.update(I,{useMipmap:!0}):(l.texture=new ne(b,I,k.RGBA,{useMipmap:!0}),l.texture.bind(k.LINEAR,k.CLAMP_TO_EDGE,k.LINEAR_MIPMAP_NEAREST),b.extTextureFilterAnisotropic&&k.texParameterf(k.TEXTURE_2D,b.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,b.extTextureFilterAnisotropicMax)),l.state="loaded"}}catch(_){if(delete l.abortController,l.aborted)l.state="unloaded";else if(_)throw l.state="errored",_}})}abortTile(l){return a._(this,void 0,void 0,function*(){l.abortController&&(l.abortController.abort(),delete l.abortController)})}unloadTile(l){return a._(this,void 0,void 0,function*(){l.texture&&this.map.painter.saveTileTexture(l.texture)})}hasTransition(){return!1}}class kn extends ye{constructor(l,f,_,b){super(l,f,_,b),this.type="raster-dem",this.maxzoom=22,this._options=a.e({type:"raster-dem"},f),this.encoding=f.encoding||"mapbox",this.redFactor=f.redFactor,this.greenFactor=f.greenFactor,this.blueFactor=f.blueFactor,this.baseShift=f.baseShift}loadTile(l){return a._(this,void 0,void 0,function*(){const f=l.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),_=this.map._requestManager.transformRequest(f,"Tile");l.neighboringTiles=this._getNeighboringTiles(l.tileID),l.abortController=new AbortController;try{const b=yield $.getImage(_,l.abortController,this.map._refreshExpiredTiles);if(delete l.abortController,l.aborted)return void(l.state="unloaded");if(b&&b.data){const k=b.data;this.map._refreshExpiredTiles&&b.cacheControl&&b.expires&&l.setExpiryData({cacheControl:b.cacheControl,expires:b.expires});const I=a.b(k)&&a.S()?k:yield this.readImageNow(k),A={type:this.type,uid:l.uid,source:this.id,rawImageData:I,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!l.actor||l.state==="expired"){l.actor=this.dispatcher.getActor();const B=yield l.actor.sendAsync({type:"LDT",data:A});l.dem=B,l.needsHillshadePrepare=!0,l.needsTerrainPrepare=!0,l.state="loaded"}}}catch(b){if(delete l.abortController,l.aborted)l.state="unloaded";else if(b)throw l.state="errored",b}})}readImageNow(l){return a._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&a.U()){const f=l.width+2,_=l.height+2;try{return new a.R({width:f,height:_},yield a.V(l,-1,-1,f,_))}catch{}}return y.getImageData(l,1)})}_getNeighboringTiles(l){const f=l.canonical,_=Math.pow(2,f.z),b=(f.x-1+_)%_,k=f.x===0?l.wrap-1:l.wrap,I=(f.x+1+_)%_,A=f.x+1===_?l.wrap+1:l.wrap,B={};return B[new a.Q(l.overscaledZ,k,f.z,b,f.y).key]={backfilled:!1},B[new a.Q(l.overscaledZ,A,f.z,I,f.y).key]={backfilled:!1},f.y>0&&(B[new a.Q(l.overscaledZ,k,f.z,b,f.y-1).key]={backfilled:!1},B[new a.Q(l.overscaledZ,l.wrap,f.z,f.x,f.y-1).key]={backfilled:!1},B[new a.Q(l.overscaledZ,A,f.z,I,f.y-1).key]={backfilled:!1}),f.y+1<_&&(B[new a.Q(l.overscaledZ,k,f.z,b,f.y+1).key]={backfilled:!1},B[new a.Q(l.overscaledZ,l.wrap,f.z,f.x,f.y+1).key]={backfilled:!1},B[new a.Q(l.overscaledZ,A,f.z,I,f.y+1).key]={backfilled:!1}),B}unloadTile(l){return a._(this,void 0,void 0,function*(){l.demTexture&&this.map.painter.saveTileTexture(l.demTexture),l.fbo&&(l.fbo.destroy(),delete l.fbo),l.dem&&delete l.dem,delete l.neighboringTiles,l.state="unloaded",l.actor&&(yield l.actor.sendAsync({type:"RDT",data:{type:this.type,uid:l.uid,source:this.id}}))})}}class Ue extends a.E{constructor(l,f,_,b){super(),this.id=l,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=_.getActor(),this.setEventedParent(b),this._data=f.data,this._options=a.e({},f),this._collectResourceTiming=f.collectResourceTiming,f.maxzoom!==void 0&&(this.maxzoom=f.maxzoom),f.type&&(this.type=f.type),f.attribution&&(this.attribution=f.attribution),this.promoteId=f.promoteId;const k=a.W/this.tileSize;this.workerOptions=a.e({source:this.id,cluster:f.cluster||!1,geojsonVtOptions:{buffer:(f.buffer!==void 0?f.buffer:128)*k,tolerance:(f.tolerance!==void 0?f.tolerance:.375)*k,extent:a.W,maxZoom:this.maxzoom,lineMetrics:f.lineMetrics||!1,generateId:f.generateId||!1},superclusterOptions:{maxZoom:f.clusterMaxZoom!==void 0?f.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,f.clusterMinPoints||2),extent:a.W,radius:(f.clusterRadius||50)*k,log:!1,generateId:f.generateId||!1},clusterProperties:f.clusterProperties,filter:f.filter},f.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return a._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(l){this.map=l,this.load()}setData(l){return this._data=l,this._updateWorkerData(),this}updateData(l){return this._updateWorkerData(l),this}setClusterOptions(l){return this.workerOptions.cluster=l.cluster,l&&(l.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=l.clusterRadius),l.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=l.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(l){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:l,source:this.id}})}getClusterChildren(l){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:l,source:this.id}})}getClusterLeaves(l,f,_){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:l,limit:f,offset:_}})}_updateWorkerData(l){return a._(this,void 0,void 0,function*(){const f=a.e({type:this.type},this.workerOptions);l?f.dataDiff=l:typeof this._data=="string"?(f.request=this.map._requestManager.transformRequest(y.resolveURL(this._data),"Source"),f.request.collectResourceTiming=this._collectResourceTiming):f.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new a.k("dataloading",{dataType:"source"}));try{const _=yield this.actor.sendAsync({type:"LD",data:f});if(this._pendingLoads--,this._removed||_.abandoned)return void this.fire(new a.k("dataabort",{dataType:"source"}));let b=null;_.resourceTiming&&_.resourceTiming[this.id]&&(b=_.resourceTiming[this.id].slice(0));const k={dataType:"source"};this._collectResourceTiming&&b&&b.length>0&&a.e(k,{resourceTiming:b}),this.fire(new a.k("data",Object.assign(Object.assign({},k),{sourceDataType:"metadata"}))),this.fire(new a.k("data",Object.assign(Object.assign({},k),{sourceDataType:"content"})))}catch(_){if(this._pendingLoads--,this._removed)return void this.fire(new a.k("dataabort",{dataType:"source"}));this.fire(new a.j(_))}})}loaded(){return this._pendingLoads===0}loadTile(l){return a._(this,void 0,void 0,function*(){const f=l.actor?"RT":"LT";l.actor=this.actor;const _={type:this.type,uid:l.uid,tileID:l.tileID,zoom:l.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};l.abortController=new AbortController;const b=yield this.actor.sendAsync({type:f,data:_},l.abortController);delete l.abortController,l.unloadVectorData(),l.aborted||l.loadVectorData(b,this.map.painter,f==="RT")})}abortTile(l){return a._(this,void 0,void 0,function*(){l.abortController&&(l.abortController.abort(),delete l.abortController),l.aborted=!0})}unloadTile(l){return a._(this,void 0,void 0,function*(){l.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:l.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return a.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var it=a.X([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Wt extends a.E{constructor(l,f,_,b){super(),this.id=l,this.dispatcher=_,this.coordinates=f.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(b),this.options=f}load(l){return a._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new a.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const f=yield $.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,f&&f.data&&(this.image=f.data,l&&(this.coordinates=l),this._finishLoading())}catch(f){this._request=null,this._loaded=!0,this.fire(new a.j(f))}})}loaded(){return this._loaded}updateImage(l){return l.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=l.url,this.load(l.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new a.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(l){this.map=l,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(l){this.coordinates=l;const f=l.map(a.Y.fromLngLat);this.tileID=function(b){let k=1/0,I=1/0,A=-1/0,B=-1/0;for(const me of b)k=Math.min(k,me.x),I=Math.min(I,me.y),A=Math.max(A,me.x),B=Math.max(B,me.y);const G=Math.max(A-k,B-I),Y=Math.max(0,Math.floor(-Math.log(G)/Math.LN2)),te=Math.pow(2,Y);return new a.a0(Y,Math.floor((k+A)/2*te),Math.floor((I+B)/2*te))}(f),this.minzoom=this.maxzoom=this.tileID.z;const _=f.map(b=>this.tileID.getTilePoint(b)._round());return this._boundsArray=new a.Z,this._boundsArray.emplaceBack(_[0].x,_[0].y,0,0),this._boundsArray.emplaceBack(_[1].x,_[1].y,a.W,0),this._boundsArray.emplaceBack(_[3].x,_[3].y,0,a.W),this._boundsArray.emplaceBack(_[2].x,_[2].y,a.W,a.W),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new a.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const l=this.map.painter.context,f=l.gl;this.boundsBuffer||(this.boundsBuffer=l.createVertexBuffer(this._boundsArray,it.members)),this.boundsSegments||(this.boundsSegments=a.$.simpleSegment(0,0,4,2)),this.texture||(this.texture=new ne(l,this.image,f.RGBA),this.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE));let _=!1;for(const b in this.tiles){const k=this.tiles[b];k.state!=="loaded"&&(k.state="loaded",k.texture=this.texture,_=!0)}_&&this.fire(new a.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(l){return a._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(l.tileID.canonical)?(this.tiles[String(l.tileID.wrap)]=l,l.buckets={}):l.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class cr extends Wt{constructor(l,f,_,b){super(l,f,_,b),this.roundZoom=!0,this.type="video",this.options=f}load(){return a._(this,void 0,void 0,function*(){this._loaded=!1;const l=this.options;this.urls=[];for(const f of l.urls)this.urls.push(this.map._requestManager.transformRequest(f,"Source").url);try{const f=yield a.a2(this.urls);if(this._loaded=!0,!f)return;this.video=f,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(f){this.fire(new a.j(f))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(l){if(this.video){const f=this.video.seekable;l<f.start(0)||l>f.end(0)?this.fire(new a.j(new a.a1(`sources.${this.id}`,null,`Playback for this video can be set only between the ${f.start(0)} and ${f.end(0)}-second mark.`))):this.video.currentTime=l}}getVideo(){return this.video}onAdd(l){this.map||(this.map=l,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const l=this.map.painter.context,f=l.gl;this.boundsBuffer||(this.boundsBuffer=l.createVertexBuffer(this._boundsArray,it.members)),this.boundsSegments||(this.boundsSegments=a.$.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE),f.texSubImage2D(f.TEXTURE_2D,0,0,0,f.RGBA,f.UNSIGNED_BYTE,this.video)):(this.texture=new ne(l,this.video,f.RGBA),this.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE));let _=!1;for(const b in this.tiles){const k=this.tiles[b];k.state!=="loaded"&&(k.state="loaded",k.texture=this.texture,_=!0)}_&&this.fire(new a.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class _r extends Wt{constructor(l,f,_,b){super(l,f,_,b),f.coordinates?Array.isArray(f.coordinates)&&f.coordinates.length===4&&!f.coordinates.some(k=>!Array.isArray(k)||k.length!==2||k.some(I=>typeof I!="number"))||this.fire(new a.j(new a.a1(`sources.${l}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new a.j(new a.a1(`sources.${l}`,null,'missing required property "coordinates"'))),f.animate&&typeof f.animate!="boolean"&&this.fire(new a.j(new a.a1(`sources.${l}`,null,'optional "animate" property must be a boolean value'))),f.canvas?typeof f.canvas=="string"||f.canvas instanceof HTMLCanvasElement||this.fire(new a.j(new a.a1(`sources.${l}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new a.j(new a.a1(`sources.${l}`,null,'missing required property "canvas"'))),this.options=f,this.animate=f.animate===void 0||f.animate}load(){return a._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new a.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(l){this.map=l,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let l=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,l=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,l=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const f=this.map.painter.context,_=f.gl;this.boundsBuffer||(this.boundsBuffer=f.createVertexBuffer(this._boundsArray,it.members)),this.boundsSegments||(this.boundsSegments=a.$.simpleSegment(0,0,4,2)),this.texture?(l||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new ne(f,this.canvas,_.RGBA,{premultiply:!0});let b=!1;for(const k in this.tiles){const I=this.tiles[k];I.state!=="loaded"&&(I.state="loaded",I.texture=this.texture,b=!0)}b&&this.fire(new a.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const l of[this.canvas.width,this.canvas.height])if(isNaN(l)||l<=0)return!0;return!1}}const yr={},ni=w=>{switch(w){case"geojson":return Ue;case"image":return Wt;case"raster":return ye;case"raster-dem":return kn;case"vector":return Et;case"video":return cr;case"canvas":return _r}return yr[w]},jr="RTLPluginLoaded";class xo extends a.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=Qt()}_syncState(l){return this.status=l,this.dispatcher.broadcast("SRPS",{pluginStatus:l,pluginURL:this.url}).catch(f=>{throw this.status="error",f})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(l){return a._(this,arguments,void 0,function*(f,_=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=y.resolveURL(f),!this.url)throw new Error(`requested url ${f} is invalid`);if(this.status==="unavailable"){if(!_)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return a._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new a.k(jr))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let hr=null;function vt(){return hr||(hr=new xo),hr}class Pr{constructor(l,f){this.timeAdded=0,this.fadeEndTime=0,this.tileID=l,this.uid=a.a3(),this.uses=0,this.tileSize=f,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(l){const f=l+this.timeAdded;f<this.fadeEndTime||(this.fadeEndTime=f)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(l){this.demTexture&&l.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(l,f,_){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",l){l.featureIndex&&(this.latestFeatureIndex=l.featureIndex,l.rawTileData?(this.latestRawTileData=l.rawTileData,this.latestFeatureIndex.rawTileData=l.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=l.collisionBoxArray,this.buckets=function(b,k){const I={};if(!k)return I;for(const A of b){const B=A.layerIds.map(G=>k.getLayer(G)).filter(Boolean);if(B.length!==0){A.layers=B,A.stateDependentLayerIds&&(A.stateDependentLayers=A.stateDependentLayerIds.map(G=>B.filter(Y=>Y.id===G)[0]));for(const G of B)I[G.id]=A}}return I}(l.buckets,f.style),this.hasSymbolBuckets=!1;for(const b in this.buckets){const k=this.buckets[b];if(k instanceof a.a5){if(this.hasSymbolBuckets=!0,!_)break;k.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const b in this.buckets){const k=this.buckets[b];if(k instanceof a.a5&&k.hasRTLText){this.hasRTLText=!0,vt().lazyLoad();break}}this.queryPadding=0;for(const b in this.buckets){const k=this.buckets[b];this.queryPadding=Math.max(this.queryPadding,f.style.getLayer(b).queryRadius(k))}l.imageAtlas&&(this.imageAtlas=l.imageAtlas),l.glyphAtlasImage&&(this.glyphAtlasImage=l.glyphAtlasImage)}else this.collisionBoxArray=new a.a4}unloadVectorData(){for(const l in this.buckets)this.buckets[l].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(l){return this.buckets[l.id]}upload(l){for(const _ in this.buckets){const b=this.buckets[_];b.uploadPending()&&b.upload(l)}const f=l.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new ne(l,this.imageAtlas.image,f.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new ne(l,this.glyphAtlasImage,f.ALPHA),this.glyphAtlasImage=null)}prepare(l){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(l,this.imageAtlasTexture)}queryRenderedFeatures(l,f,_,b,k,I,A,B,G,Y){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:b,cameraQueryGeometry:k,scale:I,tileSize:this.tileSize,pixelPosMatrix:Y,transform:B,params:A,queryPadding:this.queryPadding*G},l,f,_):{}}querySourceFeatures(l,f){const _=this.latestFeatureIndex;if(!_||!_.rawTileData)return;const b=_.loadVTLayers(),k=f&&f.sourceLayer?f.sourceLayer:"",I=b._geojsonTileLayer||b[k];if(!I)return;const A=a.a6(f&&f.filter),{z:B,x:G,y:Y}=this.tileID.canonical,te={z:B,x:G,y:Y};for(let me=0;me<I.length;me++){const Te=I.feature(me);if(A.needGeometry){const be=a.a7(Te,!0);if(!A.filter(new a.a8(this.tileID.overscaledZ),be,this.tileID.canonical))continue}else if(!A.filter(new a.a8(this.tileID.overscaledZ),Te))continue;const ke=_.getId(Te,k),Le=new a.a9(Te,B,G,Y,ke);Le.tile=te,l.push(Le)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(l){const f=this.expirationTime;if(l.cacheControl){const _=a.aa(l.cacheControl);_["max-age"]&&(this.expirationTime=Date.now()+1e3*_["max-age"])}else l.expires&&(this.expirationTime=new Date(l.expires).getTime());if(this.expirationTime){const _=Date.now();let b=!1;if(this.expirationTime>_)b=!1;else if(f)if(this.expirationTime<f)b=!0;else{const k=this.expirationTime-f;k?this.expirationTime=_+Math.max(k,3e4):b=!0}else b=!0;b?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(l,f){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(l).length===0)return;const _=this.latestFeatureIndex.loadVTLayers();for(const b in this.buckets){if(!f.style.hasLayer(b))continue;const k=this.buckets[b],I=k.layers[0].sourceLayer||"_geojsonTileLayer",A=_[I],B=l[I];if(!A||!B||Object.keys(B).length===0)continue;k.update(B,A,this.imageAtlas&&this.imageAtlas.patternPositions||{});const G=f&&f.style&&f.style.getLayer(b);G&&(this.queryPadding=Math.max(this.queryPadding,G.queryRadius(k)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<y.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(l){this.symbolFadeHoldUntil=y.now()+l}setDependencies(l,f){const _={};for(const b of f)_[b]=!0;this.dependencies[l]=_}hasDependency(l,f){for(const _ of l){const b=this.dependencies[_];if(b){for(const k of f)if(b[k])return!0}}return!1}}class Mr{constructor(l,f){this.max=l,this.onRemove=f,this.reset()}reset(){for(const l in this.data)for(const f of this.data[l])f.timeout&&clearTimeout(f.timeout),this.onRemove(f.value);return this.data={},this.order=[],this}add(l,f,_){const b=l.wrapped().key;this.data[b]===void 0&&(this.data[b]=[]);const k={value:f,timeout:void 0};if(_!==void 0&&(k.timeout=setTimeout(()=>{this.remove(l,k)},_)),this.data[b].push(k),this.order.push(b),this.order.length>this.max){const I=this._getAndRemoveByKey(this.order[0]);I&&this.onRemove(I)}return this}has(l){return l.wrapped().key in this.data}getAndRemove(l){return this.has(l)?this._getAndRemoveByKey(l.wrapped().key):null}_getAndRemoveByKey(l){const f=this.data[l].shift();return f.timeout&&clearTimeout(f.timeout),this.data[l].length===0&&delete this.data[l],this.order.splice(this.order.indexOf(l),1),f.value}getByKey(l){const f=this.data[l];return f?f[0].value:null}get(l){return this.has(l)?this.data[l.wrapped().key][0].value:null}remove(l,f){if(!this.has(l))return this;const _=l.wrapped().key,b=f===void 0?0:this.data[_].indexOf(f),k=this.data[_][b];return this.data[_].splice(b,1),k.timeout&&clearTimeout(k.timeout),this.data[_].length===0&&delete this.data[_],this.onRemove(k.value),this.order.splice(this.order.indexOf(_),1),this}setMaxSize(l){for(this.max=l;this.order.length>this.max;){const f=this._getAndRemoveByKey(this.order[0]);f&&this.onRemove(f)}return this}filter(l){const f=[];for(const _ in this.data)for(const b of this.data[_])l(b.value)||f.push(b);for(const _ of f)this.remove(_.value.tileID,_)}}class zr{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(l,f,_){const b=String(f);if(this.stateChanges[l]=this.stateChanges[l]||{},this.stateChanges[l][b]=this.stateChanges[l][b]||{},a.e(this.stateChanges[l][b],_),this.deletedStates[l]===null){this.deletedStates[l]={};for(const k in this.state[l])k!==b&&(this.deletedStates[l][k]=null)}else if(this.deletedStates[l]&&this.deletedStates[l][b]===null){this.deletedStates[l][b]={};for(const k in this.state[l][b])_[k]||(this.deletedStates[l][b][k]=null)}else for(const k in _)this.deletedStates[l]&&this.deletedStates[l][b]&&this.deletedStates[l][b][k]===null&&delete this.deletedStates[l][b][k]}removeFeatureState(l,f,_){if(this.deletedStates[l]===null)return;const b=String(f);if(this.deletedStates[l]=this.deletedStates[l]||{},_&&f!==void 0)this.deletedStates[l][b]!==null&&(this.deletedStates[l][b]=this.deletedStates[l][b]||{},this.deletedStates[l][b][_]=null);else if(f!==void 0)if(this.stateChanges[l]&&this.stateChanges[l][b])for(_ in this.deletedStates[l][b]={},this.stateChanges[l][b])this.deletedStates[l][b][_]=null;else this.deletedStates[l][b]=null;else this.deletedStates[l]=null}getState(l,f){const _=String(f),b=a.e({},(this.state[l]||{})[_],(this.stateChanges[l]||{})[_]);if(this.deletedStates[l]===null)return{};if(this.deletedStates[l]){const k=this.deletedStates[l][f];if(k===null)return{};for(const I in k)delete b[I]}return b}initializeTileState(l,f){l.setFeatureState(this.state,f)}coalesceChanges(l,f){const _={};for(const b in this.stateChanges){this.state[b]=this.state[b]||{};const k={};for(const I in this.stateChanges[b])this.state[b][I]||(this.state[b][I]={}),a.e(this.state[b][I],this.stateChanges[b][I]),k[I]=this.state[b][I];_[b]=k}for(const b in this.deletedStates){this.state[b]=this.state[b]||{};const k={};if(this.deletedStates[b]===null)for(const I in this.state[b])k[I]={},this.state[b][I]={};else for(const I in this.deletedStates[b]){if(this.deletedStates[b][I]===null)this.state[b][I]={};else for(const A of Object.keys(this.deletedStates[b][I]))delete this.state[b][I][A];k[I]=this.state[b][I]}_[b]=_[b]||{},a.e(_[b],k)}if(this.stateChanges={},this.deletedStates={},Object.keys(_).length!==0)for(const b in l)l[b].setFeatureState(_,f)}}class qn extends a.E{constructor(l,f,_){super(),this.id=l,this.dispatcher=_,this.on("data",b=>this._dataHandler(b)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((b,k,I,A)=>{const B=new(ni(k.type))(b,k,I,A);if(B.id!==b)throw new Error(`Expected Source id to be ${b} instead of ${B.id}`);return B})(l,f,_,this),this._tiles={},this._cache=new Mr(0,b=>this._unloadTile(b)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new zr,this._didEmitContent=!1,this._updated=!1}onAdd(l){this.map=l,this._maxTileCacheSize=l?l._maxTileCacheSize:null,this._maxTileCacheZoomLevels=l?l._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(l)}onRemove(l){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(l)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const l in this._tiles){const f=this._tiles[l];if(f.state!=="loaded"&&f.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const l=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,l&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(l,f,_){return a._(this,void 0,void 0,function*(){try{yield this._source.loadTile(l),this._tileLoaded(l,f,_)}catch(b){l.state="errored",b.status!==404?this._source.fire(new a.j(b,{tile:l})):this.update(this.transform,this.terrain)}})}_unloadTile(l){this._source.unloadTile&&this._source.unloadTile(l)}_abortTile(l){this._source.abortTile&&this._source.abortTile(l),this._source.fire(new a.k("dataabort",{tile:l,coord:l.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(l){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const f in this._tiles){const _=this._tiles[f];_.upload(l),_.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(l=>l.tileID).sort(It).map(l=>l.key)}getRenderableIds(l){const f=[];for(const _ in this._tiles)this._isIdRenderable(_,l)&&f.push(this._tiles[_]);return l?f.sort((_,b)=>{const k=_.tileID,I=b.tileID,A=new a.P(k.canonical.x,k.canonical.y)._rotate(this.transform.angle),B=new a.P(I.canonical.x,I.canonical.y)._rotate(this.transform.angle);return k.overscaledZ-I.overscaledZ||B.y-A.y||B.x-A.x}).map(_=>_.tileID.key):f.map(_=>_.tileID).sort(It).map(_=>_.key)}hasRenderableParent(l){const f=this.findLoadedParent(l,0);return!!f&&this._isIdRenderable(f.tileID.key)}_isIdRenderable(l,f){return this._tiles[l]&&this._tiles[l].hasData()&&!this._coveredTiles[l]&&(f||!this._tiles[l].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const l in this._tiles)this._tiles[l].state!=="errored"&&this._reloadTile(l,"reloading")}}_reloadTile(l,f){return a._(this,void 0,void 0,function*(){const _=this._tiles[l];_&&(_.state!=="loading"&&(_.state=f),yield this._loadTile(_,l,f))})}_tileLoaded(l,f,_){l.timeAdded=y.now(),_==="expired"&&(l.refreshedUponExpiration=!0),this._setTileReloadTimer(f,l),this.getSource().type==="raster-dem"&&l.dem&&this._backfillDEM(l),this._state.initializeTileState(l,this.map?this.map.painter:null),l.aborted||this._source.fire(new a.k("data",{dataType:"source",tile:l,coord:l.tileID}))}_backfillDEM(l){const f=this.getRenderableIds();for(let b=0;b<f.length;b++){const k=f[b];if(l.neighboringTiles&&l.neighboringTiles[k]){const I=this.getTileByID(k);_(l,I),_(I,l)}}function _(b,k){b.needsHillshadePrepare=!0,b.needsTerrainPrepare=!0;let I=k.tileID.canonical.x-b.tileID.canonical.x;const A=k.tileID.canonical.y-b.tileID.canonical.y,B=Math.pow(2,b.tileID.canonical.z),G=k.tileID.key;I===0&&A===0||Math.abs(A)>1||(Math.abs(I)>1&&(Math.abs(I+B)===1?I+=B:Math.abs(I-B)===1&&(I-=B)),k.dem&&b.dem&&(b.dem.backfillBorder(k.dem,I,A),b.neighboringTiles&&b.neighboringTiles[G]&&(b.neighboringTiles[G].backfilled=!0)))}}getTile(l){return this.getTileByID(l.key)}getTileByID(l){return this._tiles[l]}_retainLoadedChildren(l,f,_,b){for(const k in this._tiles){let I=this._tiles[k];if(b[k]||!I.hasData()||I.tileID.overscaledZ<=f||I.tileID.overscaledZ>_)continue;let A=I.tileID;for(;I&&I.tileID.overscaledZ>f+1;){const G=I.tileID.scaledTo(I.tileID.overscaledZ-1);I=this._tiles[G.key],I&&I.hasData()&&(A=G)}let B=A;for(;B.overscaledZ>f;)if(B=B.scaledTo(B.overscaledZ-1),l[B.key]){b[A.key]=A;break}}}findLoadedParent(l,f){if(l.key in this._loadedParentTiles){const _=this._loadedParentTiles[l.key];return _&&_.tileID.overscaledZ>=f?_:null}for(let _=l.overscaledZ-1;_>=f;_--){const b=l.scaledTo(_),k=this._getLoadedTile(b);if(k)return k}}_getLoadedTile(l){const f=this._tiles[l.key];return f&&f.hasData()?f:this._cache.getByKey(l.wrapped().key)}updateCacheSize(l){const f=Math.ceil(l.width/this._source.tileSize)+1,_=Math.ceil(l.height/this._source.tileSize)+1,b=Math.floor(f*_*(this._maxTileCacheZoomLevels===null?a.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),k=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,b):b;this._cache.setMaxSize(k)}handleWrapJump(l){const f=Math.round((l-(this._prevLng===void 0?l:this._prevLng))/360);if(this._prevLng=l,f){const _={};for(const b in this._tiles){const k=this._tiles[b];k.tileID=k.tileID.unwrapTo(k.tileID.wrap+f),_[k.tileID.key]=k}this._tiles=_;for(const b in this._timers)clearTimeout(this._timers[b]),delete this._timers[b];for(const b in this._tiles)this._setTileReloadTimer(b,this._tiles[b])}}update(l,f){if(!this._sourceLoaded||this._paused)return;let _;this.transform=l,this.terrain=f,this.updateCacheSize(l),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?_=l.getVisibleUnwrappedCoordinates(this._source.tileID).map(Y=>new a.Q(Y.canonical.z,Y.wrap,Y.canonical.z,Y.canonical.x,Y.canonical.y)):(_=l.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:f}),this._source.hasTile&&(_=_.filter(Y=>this._source.hasTile(Y)))):_=[];const b=l.coveringZoomLevel(this._source),k=Math.max(b-qn.maxOverzooming,this._source.minzoom),I=Math.max(b+qn.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const Y={};for(const te of _)if(te.canonical.z>this._source.minzoom){const me=te.scaledTo(te.canonical.z-1);Y[me.key]=me;const Te=te.scaledTo(Math.max(this._source.minzoom,Math.min(te.canonical.z,5)));Y[Te.key]=Te}_=_.concat(Object.values(Y))}const A=_.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,A&&this.fire(new a.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const B=this._updateRetainedTiles(_,b);if(fn(this._source.type)){const Y={},te={},me=Object.keys(B),Te=y.now();for(const ke of me){const Le=B[ke],be=this._tiles[ke];if(!be||be.fadeEndTime!==0&&be.fadeEndTime<=Te)continue;const Re=this.findLoadedParent(Le,k);Re&&(this._addTile(Re.tileID),Y[Re.tileID.key]=Re.tileID),te[ke]=Le}this._retainLoadedChildren(te,b,I,B);for(const ke in Y)B[ke]||(this._coveredTiles[ke]=!0,B[ke]=Y[ke]);if(f){const ke={},Le={};for(const be of _)this._tiles[be.key].hasData()?ke[be.key]=be:Le[be.key]=be;for(const be in Le){const Re=Le[be].children(this._source.maxzoom);this._tiles[Re[0].key]&&this._tiles[Re[1].key]&&this._tiles[Re[2].key]&&this._tiles[Re[3].key]&&(ke[Re[0].key]=B[Re[0].key]=Re[0],ke[Re[1].key]=B[Re[1].key]=Re[1],ke[Re[2].key]=B[Re[2].key]=Re[2],ke[Re[3].key]=B[Re[3].key]=Re[3],delete Le[be])}for(const be in Le){const Re=this.findLoadedParent(Le[be],this._source.minzoom);if(Re){ke[Re.tileID.key]=B[Re.tileID.key]=Re.tileID;for(const et in ke)ke[et].isChildOf(Re.tileID)&&delete ke[et]}}for(const be in this._tiles)ke[be]||(this._coveredTiles[be]=!0)}}for(const Y in B)this._tiles[Y].clearFadeHold();const G=a.ab(this._tiles,B);for(const Y of G){const te=this._tiles[Y];te.hasSymbolBuckets&&!te.holdingForFade()?te.setHoldDuration(this.map._fadeDuration):te.hasSymbolBuckets&&!te.symbolFadeFinished()||this._removeTile(Y)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const l in this._tiles)this._tiles[l].holdingForFade()&&this._removeTile(l)}_updateRetainedTiles(l,f){const _={},b={},k=Math.max(f-qn.maxOverzooming,this._source.minzoom),I=Math.max(f+qn.maxUnderzooming,this._source.minzoom),A={};for(const B of l){const G=this._addTile(B);_[B.key]=B,G.hasData()||f<this._source.maxzoom&&(A[B.key]=B)}this._retainLoadedChildren(A,f,I,_);for(const B of l){let G=this._tiles[B.key];if(G.hasData())continue;if(f+1>this._source.maxzoom){const te=B.children(this._source.maxzoom)[0],me=this.getTile(te);if(me&&me.hasData()){_[te.key]=te;continue}}else{const te=B.children(this._source.maxzoom);if(_[te[0].key]&&_[te[1].key]&&_[te[2].key]&&_[te[3].key])continue}let Y=G.wasRequested();for(let te=B.overscaledZ-1;te>=k;--te){const me=B.scaledTo(te);if(b[me.key])break;if(b[me.key]=!0,G=this.getTile(me),!G&&Y&&(G=this._addTile(me)),G){const Te=G.hasData();if((Y||Te)&&(_[me.key]=me),Y=G.wasRequested(),Te)break}}}return _}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const l in this._tiles){const f=[];let _,b=this._tiles[l].tileID;for(;b.overscaledZ>0;){if(b.key in this._loadedParentTiles){_=this._loadedParentTiles[b.key];break}f.push(b.key);const k=b.scaledTo(b.overscaledZ-1);if(_=this._getLoadedTile(k),_)break;b=k}for(const k of f)this._loadedParentTiles[k]=_}}_addTile(l){let f=this._tiles[l.key];if(f)return f;f=this._cache.getAndRemove(l),f&&(this._setTileReloadTimer(l.key,f),f.tileID=l,this._state.initializeTileState(f,this.map?this.map.painter:null),this._cacheTimers[l.key]&&(clearTimeout(this._cacheTimers[l.key]),delete this._cacheTimers[l.key],this._setTileReloadTimer(l.key,f)));const _=f;return f||(f=new Pr(l,this._source.tileSize*l.overscaleFactor()),this._loadTile(f,l.key,f.state)),f.uses++,this._tiles[l.key]=f,_||this._source.fire(new a.k("dataloading",{tile:f,coord:f.tileID,dataType:"source"})),f}_setTileReloadTimer(l,f){l in this._timers&&(clearTimeout(this._timers[l]),delete this._timers[l]);const _=f.getExpiryTimeout();_&&(this._timers[l]=setTimeout(()=>{this._reloadTile(l,"expired"),delete this._timers[l]},_))}_removeTile(l){const f=this._tiles[l];f&&(f.uses--,delete this._tiles[l],this._timers[l]&&(clearTimeout(this._timers[l]),delete this._timers[l]),f.uses>0||(f.hasData()&&f.state!=="reloading"?this._cache.add(f.tileID,f,f.getExpiryTimeout()):(f.aborted=!0,this._abortTile(f),this._unloadTile(f))))}_dataHandler(l){const f=l.sourceDataType;l.dataType==="source"&&f==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&l.dataType==="source"&&f==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const l in this._tiles)this._removeTile(l);this._cache.reset()}tilesIn(l,f,_){const b=[],k=this.transform;if(!k)return b;const I=_?k.getCameraQueryGeometry(l):l,A=l.map(ke=>k.pointCoordinate(ke,this.terrain)),B=I.map(ke=>k.pointCoordinate(ke,this.terrain)),G=this.getIds();let Y=1/0,te=1/0,me=-1/0,Te=-1/0;for(const ke of B)Y=Math.min(Y,ke.x),te=Math.min(te,ke.y),me=Math.max(me,ke.x),Te=Math.max(Te,ke.y);for(let ke=0;ke<G.length;ke++){const Le=this._tiles[G[ke]];if(Le.holdingForFade())continue;const be=Le.tileID,Re=Math.pow(2,k.zoom-Le.tileID.overscaledZ),et=f*Le.queryPadding*a.W/Le.tileSize/Re,Ie=[be.getTilePoint(new a.Y(Y,te)),be.getTilePoint(new a.Y(me,Te))];if(Ie[0].x-et<a.W&&Ie[0].y-et<a.W&&Ie[1].x+et>=0&&Ie[1].y+et>=0){const Ve=A.map(rt=>be.getTilePoint(rt)),nt=B.map(rt=>be.getTilePoint(rt));b.push({tile:Le,tileID:be,queryGeometry:Ve,cameraQueryGeometry:nt,scale:Re})}}return b}getVisibleCoordinates(l){const f=this.getRenderableIds(l).map(_=>this._tiles[_].tileID);for(const _ of f)_.posMatrix=this.transform.calculatePosMatrix(_.toUnwrapped());return f}hasTransition(){if(this._source.hasTransition())return!0;if(fn(this._source.type)){const l=y.now();for(const f in this._tiles)if(this._tiles[f].fadeEndTime>=l)return!0}return!1}setFeatureState(l,f,_){this._state.updateState(l=l||"_geojsonTileLayer",f,_)}removeFeatureState(l,f,_){this._state.removeFeatureState(l=l||"_geojsonTileLayer",f,_)}getFeatureState(l,f){return this._state.getState(l=l||"_geojsonTileLayer",f)}setDependencies(l,f,_){const b=this._tiles[l];b&&b.setDependencies(f,_)}reloadTilesForDependencies(l,f){for(const _ in this._tiles)this._tiles[_].hasDependency(l,f)&&this._reloadTile(_,"reloading");this._cache.filter(_=>!_.hasDependency(l,f))}}function It(w,l){const f=Math.abs(2*w.wrap)-+(w.wrap<0),_=Math.abs(2*l.wrap)-+(l.wrap<0);return w.overscaledZ-l.overscaledZ||_-f||l.canonical.y-w.canonical.y||l.canonical.x-w.canonical.x}function fn(w){return w==="raster"||w==="image"||w==="video"}qn.maxOverzooming=10,qn.maxUnderzooming=3;class on{constructor(l,f){this.reset(l,f)}reset(l,f){this.points=l||[],this._distances=[0];for(let _=1;_<this.points.length;_++)this._distances[_]=this._distances[_-1]+this.points[_].dist(this.points[_-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(f||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(l){if(this.points.length===1)return this.points[0];l=a.ac(l,0,1);let f=1,_=this._distances[f];const b=l*this.paddedLength+this.padding;for(;_<b&&f<this._distances.length;)_=this._distances[++f];const k=f-1,I=this._distances[k],A=_-I,B=A>0?(b-I)/A:0;return this.points[k].mult(1-B).add(this.points[f].mult(B))}}function Qn(w,l){let f=!0;return w==="always"||w!=="never"&&l!=="never"||(f=!1),f}class pi{constructor(l,f,_){const b=this.boxCells=[],k=this.circleCells=[];this.xCellCount=Math.ceil(l/_),this.yCellCount=Math.ceil(f/_);for(let I=0;I<this.xCellCount*this.yCellCount;I++)b.push([]),k.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=l,this.height=f,this.xScale=this.xCellCount/l,this.yScale=this.yCellCount/f,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(l,f,_,b,k){this._forEachCell(f,_,b,k,this._insertBoxCell,this.boxUid++),this.boxKeys.push(l),this.bboxes.push(f),this.bboxes.push(_),this.bboxes.push(b),this.bboxes.push(k)}insertCircle(l,f,_,b){this._forEachCell(f-b,_-b,f+b,_+b,this._insertCircleCell,this.circleUid++),this.circleKeys.push(l),this.circles.push(f),this.circles.push(_),this.circles.push(b)}_insertBoxCell(l,f,_,b,k,I){this.boxCells[k].push(I)}_insertCircleCell(l,f,_,b,k,I){this.circleCells[k].push(I)}_query(l,f,_,b,k,I,A){if(_<0||l>this.width||b<0||f>this.height)return[];const B=[];if(l<=0&&f<=0&&this.width<=_&&this.height<=b){if(k)return[{key:null,x1:l,y1:f,x2:_,y2:b}];for(let G=0;G<this.boxKeys.length;G++)B.push({key:this.boxKeys[G],x1:this.bboxes[4*G],y1:this.bboxes[4*G+1],x2:this.bboxes[4*G+2],y2:this.bboxes[4*G+3]});for(let G=0;G<this.circleKeys.length;G++){const Y=this.circles[3*G],te=this.circles[3*G+1],me=this.circles[3*G+2];B.push({key:this.circleKeys[G],x1:Y-me,y1:te-me,x2:Y+me,y2:te+me})}}else this._forEachCell(l,f,_,b,this._queryCell,B,{hitTest:k,overlapMode:I,seenUids:{box:{},circle:{}}},A);return B}query(l,f,_,b){return this._query(l,f,_,b,!1,null)}hitTest(l,f,_,b,k,I){return this._query(l,f,_,b,!0,k,I).length>0}hitTestCircle(l,f,_,b,k){const I=l-_,A=l+_,B=f-_,G=f+_;if(A<0||I>this.width||G<0||B>this.height)return!1;const Y=[];return this._forEachCell(I,B,A,G,this._queryCellCircle,Y,{hitTest:!0,overlapMode:b,circle:{x:l,y:f,radius:_},seenUids:{box:{},circle:{}}},k),Y.length>0}_queryCell(l,f,_,b,k,I,A,B){const{seenUids:G,hitTest:Y,overlapMode:te}=A,me=this.boxCells[k];if(me!==null){const ke=this.bboxes;for(const Le of me)if(!G.box[Le]){G.box[Le]=!0;const be=4*Le,Re=this.boxKeys[Le];if(l<=ke[be+2]&&f<=ke[be+3]&&_>=ke[be+0]&&b>=ke[be+1]&&(!B||B(Re))&&(!Y||!Qn(te,Re.overlapMode))&&(I.push({key:Re,x1:ke[be],y1:ke[be+1],x2:ke[be+2],y2:ke[be+3]}),Y))return!0}}const Te=this.circleCells[k];if(Te!==null){const ke=this.circles;for(const Le of Te)if(!G.circle[Le]){G.circle[Le]=!0;const be=3*Le,Re=this.circleKeys[Le];if(this._circleAndRectCollide(ke[be],ke[be+1],ke[be+2],l,f,_,b)&&(!B||B(Re))&&(!Y||!Qn(te,Re.overlapMode))){const et=ke[be],Ie=ke[be+1],Ve=ke[be+2];if(I.push({key:Re,x1:et-Ve,y1:Ie-Ve,x2:et+Ve,y2:Ie+Ve}),Y)return!0}}}return!1}_queryCellCircle(l,f,_,b,k,I,A,B){const{circle:G,seenUids:Y,overlapMode:te}=A,me=this.boxCells[k];if(me!==null){const ke=this.bboxes;for(const Le of me)if(!Y.box[Le]){Y.box[Le]=!0;const be=4*Le,Re=this.boxKeys[Le];if(this._circleAndRectCollide(G.x,G.y,G.radius,ke[be+0],ke[be+1],ke[be+2],ke[be+3])&&(!B||B(Re))&&!Qn(te,Re.overlapMode))return I.push(!0),!0}}const Te=this.circleCells[k];if(Te!==null){const ke=this.circles;for(const Le of Te)if(!Y.circle[Le]){Y.circle[Le]=!0;const be=3*Le,Re=this.circleKeys[Le];if(this._circlesCollide(ke[be],ke[be+1],ke[be+2],G.x,G.y,G.radius)&&(!B||B(Re))&&!Qn(te,Re.overlapMode))return I.push(!0),!0}}}_forEachCell(l,f,_,b,k,I,A,B){const G=this._convertToXCellCoord(l),Y=this._convertToYCellCoord(f),te=this._convertToXCellCoord(_),me=this._convertToYCellCoord(b);for(let Te=G;Te<=te;Te++)for(let ke=Y;ke<=me;ke++)if(k.call(this,l,f,_,b,this.xCellCount*ke+Te,I,A,B))return}_convertToXCellCoord(l){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(l*this.xScale)))}_convertToYCellCoord(l){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(l*this.yScale)))}_circlesCollide(l,f,_,b,k,I){const A=b-l,B=k-f,G=_+I;return G*G>A*A+B*B}_circleAndRectCollide(l,f,_,b,k,I,A){const B=(I-b)/2,G=Math.abs(l-(b+B));if(G>B+_)return!1;const Y=(A-k)/2,te=Math.abs(f-(k+Y));if(te>Y+_)return!1;if(G<=B||te<=Y)return!0;const me=G-B,Te=te-Y;return me*me+Te*Te<=_*_}}function pn(w,l,f,_,b){const k=a.F();return l?(a.J(k,k,[1/b,1/b,1]),f||a.ad(k,k,_.angle)):a.K(k,_.labelPlaneMatrix,w),k}function Di(w,l,f,_,b){if(l){const k=a.ae(w);return a.J(k,k,[b,b,1]),f||a.ad(k,k,-_.angle),k}return _.glCoordMatrix}function er(w,l,f){let _;f?(_=[w.x,w.y,f(w.x,w.y),1],a.af(_,_,l)):(_=[w.x,w.y,0,1],lt(_,_,l));const b=_[3];return{point:new a.P(_[0]/b,_[1]/b),signedDistanceFromCamera:b}}function we(w,l){return .5+w/l*.5}function re(w,l){const f=w[0]/w[3],_=w[1]/w[3];return f>=-l[0]&&f<=l[0]&&_>=-l[1]&&_<=l[1]}function se(w,l,f,_,b,k,I,A,B,G){const Y=_?w.textSizeData:w.iconSizeData,te=a.ag(Y,f.transform.zoom),me=[256/f.width*2+1,256/f.height*2+1],Te=_?w.text.dynamicLayoutVertexArray:w.icon.dynamicLayoutVertexArray;Te.clear();const ke=w.lineVertexArray,Le=_?w.text.placedSymbolArray:w.icon.placedSymbolArray,be=f.transform.width/f.transform.height;let Re=!1;for(let et=0;et<Le.length;et++){const Ie=Le.get(et);if(Ie.hidden||Ie.writingMode===a.ah.vertical&&!Re){tt(Ie.numGlyphs,Te);continue}let Ve;if(Re=!1,G?(Ve=[Ie.anchorX,Ie.anchorY,G(Ie.anchorX,Ie.anchorY),1],a.af(Ve,Ve,l)):(Ve=[Ie.anchorX,Ie.anchorY,0,1],lt(Ve,Ve,l)),!re(Ve,me)){tt(Ie.numGlyphs,Te);continue}const nt=we(f.transform.cameraToCenterDistance,Ve[3]),rt=a.ai(Y,te,Ie),at=I?rt/nt:rt*nt,yt=new a.P(Ie.anchorX,Ie.anchorY),mt=er(yt,b,G).point,zt={projections:{},offsets:{}},Rt=Fe(Ie,at,!1,A,l,b,k,w.glyphOffsetArray,ke,Te,mt,yt,zt,be,B,G);Re=Rt.useVertical,(Rt.notEnoughRoom||Re||Rt.needsFlipping&&Fe(Ie,at,!0,A,l,b,k,w.glyphOffsetArray,ke,Te,mt,yt,zt,be,B,G).notEnoughRoom)&&tt(Ie.numGlyphs,Te)}_?w.text.dynamicLayoutVertexBuffer.updateData(Te):w.icon.dynamicLayoutVertexBuffer.updateData(Te)}function pe(w,l,f,_,b,k,I,A,B,G,Y,te,me){const Te=A.glyphStartIndex+A.numGlyphs,ke=A.lineStartIndex,Le=A.lineStartIndex+A.lineLength,be=l.getoffsetX(A.glyphStartIndex),Re=l.getoffsetX(Te-1),et=We(w*be,f,_,b,k,I,A.segment,ke,Le,B,G,Y,te,me);if(!et)return null;const Ie=We(w*Re,f,_,b,k,I,A.segment,ke,Le,B,G,Y,te,me);return Ie?{first:et,last:Ie}:null}function xe(w,l,f,_){return w===a.ah.horizontal&&Math.abs(f.y-l.y)>Math.abs(f.x-l.x)*_?{useVertical:!0}:(w===a.ah.vertical?l.y<f.y:l.x>f.x)?{needsFlipping:!0}:null}function Fe(w,l,f,_,b,k,I,A,B,G,Y,te,me,Te,ke,Le){const be=l/24,Re=w.lineOffsetX*be,et=w.lineOffsetY*be;let Ie;if(w.numGlyphs>1){const Ve=w.glyphStartIndex+w.numGlyphs,nt=w.lineStartIndex,rt=w.lineStartIndex+w.lineLength,at=pe(be,A,Re,et,f,Y,te,w,B,k,me,ke,Le);if(!at)return{notEnoughRoom:!0};const yt=er(at.first.point,I,Le).point,mt=er(at.last.point,I,Le).point;if(_&&!f){const zt=xe(w.writingMode,yt,mt,Te);if(zt)return zt}Ie=[at.first];for(let zt=w.glyphStartIndex+1;zt<Ve-1;zt++)Ie.push(We(be*A.getoffsetX(zt),Re,et,f,Y,te,w.segment,nt,rt,B,k,me,ke,Le));Ie.push(at.last)}else{if(_&&!f){const nt=er(te,b,Le).point,rt=w.lineStartIndex+w.segment+1,at=new a.P(B.getx(rt),B.gety(rt)),yt=er(at,b,Le),mt=yt.signedDistanceFromCamera>0?yt.point:Be(te,at,nt,1,b,Le),zt=xe(w.writingMode,nt,mt,Te);if(zt)return zt}const Ve=We(be*A.getoffsetX(w.glyphStartIndex),Re,et,f,Y,te,w.segment,w.lineStartIndex,w.lineStartIndex+w.lineLength,B,k,me,ke,Le);if(!Ve)return{notEnoughRoom:!0};Ie=[Ve]}for(const Ve of Ie)a.aj(G,Ve.point,Ve.angle);return{}}function Be(w,l,f,_,b,k){const I=er(w.add(w.sub(l)._unit()),b,k).point,A=f.sub(I);return f.add(A._mult(_/A.mag()))}function $e(w,l){const{projectionCache:f,lineVertexArray:_,labelPlaneMatrix:b,tileAnchorPoint:k,distanceFromAnchor:I,getElevation:A,previousVertex:B,direction:G,absOffsetX:Y}=l;if(f.projections[w])return f.projections[w];const te=new a.P(_.getx(w),_.gety(w)),me=er(te,b,A);if(me.signedDistanceFromCamera>0)return f.projections[w]=me.point,me.point;const Te=w-G;return Be(I===0?k:new a.P(_.getx(Te),_.gety(Te)),te,B,Y-I+1,b,A)}function Se(w,l,f){return w._unit()._perp()._mult(l*f)}function Q(w,l,f,_,b,k,I,A){const{projectionCache:B,direction:G}=A;if(B.offsets[w])return B.offsets[w];const Y=f.add(l);if(w+G<_||w+G>=b)return B.offsets[w]=Y,Y;const te=$e(w+G,A),me=Se(te.sub(f),I,G),Te=f.add(me),ke=te.add(me);return B.offsets[w]=a.ak(k,Y,Te,ke)||Y,B.offsets[w]}function We(w,l,f,_,b,k,I,A,B,G,Y,te,me,Te){const ke=_?w-l:w+l;let Le=ke>0?1:-1,be=0;_&&(Le*=-1,be=Math.PI),Le<0&&(be+=Math.PI);let Re,et,Ie=Le>0?A+I:A+I+1,Ve=b,nt=b,rt=0,at=0;const yt=Math.abs(ke),mt=[];let zt;for(;rt+at<=yt;){if(Ie+=Le,Ie<A||Ie>=B)return null;rt+=at,nt=Ve,et=Re;const $t={projectionCache:te,lineVertexArray:G,labelPlaneMatrix:Y,tileAnchorPoint:k,distanceFromAnchor:rt,getElevation:Te,previousVertex:nt,direction:Le,absOffsetX:yt};if(Ve=$e(Ie,$t),f===0)mt.push(nt),zt=Ve.sub(nt);else{let hn;const xn=Ve.sub(nt);hn=xn.mag()===0?Se($e(Ie+Le,$t).sub(Ve),f,Le):Se(xn,f,Le),et||(et=nt.add(hn)),Re=Q(Ie,hn,Ve,A,B,et,f,$t),mt.push(et),zt=Re.sub(et)}at=zt.mag()}const Rt=zt._mult((yt-rt)/at)._add(et||nt),wn=be+Math.atan2(Ve.y-nt.y,Ve.x-nt.x);return mt.push(Rt),{point:Rt,angle:me?wn:0,path:mt}}const Xe=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function tt(w,l){for(let f=0;f<w;f++){const _=l.length;l.resize(_+4),l.float32.set(Xe,3*_)}}function lt(w,l,f){const _=l[0],b=l[1];return w[0]=f[0]*_+f[4]*b+f[12],w[1]=f[1]*_+f[5]*b+f[13],w[3]=f[3]*_+f[7]*b+f[15],w}const Lt=100;class Jt{constructor(l,f=new pi(l.width+200,l.height+200,25),_=new pi(l.width+200,l.height+200,25)){this.transform=l,this.grid=f,this.ignoredGrid=_,this.pitchfactor=Math.cos(l._pitch)*l.cameraToCenterDistance,this.screenRightBoundary=l.width+Lt,this.screenBottomBoundary=l.height+Lt,this.gridRightBoundary=l.width+200,this.gridBottomBoundary=l.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(l,f,_,b,k,I){const A=this.projectAndGetPerspectiveRatio(b,l.anchorPointX,l.anchorPointY,I),B=_*A.perspectiveRatio,G=l.x1*B+A.point.x,Y=l.y1*B+A.point.y,te=l.x2*B+A.point.x,me=l.y2*B+A.point.y;return!this.isInsideGrid(G,Y,te,me)||f!=="always"&&this.grid.hitTest(G,Y,te,me,f,k)||A.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[G,Y,te,me],offscreen:this.isOffscreen(G,Y,te,me)}}placeCollisionCircles(l,f,_,b,k,I,A,B,G,Y,te,me,Te,ke){const Le=[],be=new a.P(f.anchorX,f.anchorY),Re=er(be,I,ke),et=we(this.transform.cameraToCenterDistance,Re.signedDistanceFromCamera),Ie=(Y?k/et:k*et)/a.ao,Ve=er(be,A,ke).point,nt=pe(Ie,b,f.lineOffsetX*Ie,f.lineOffsetY*Ie,!1,Ve,be,f,_,A,{projections:{},offsets:{}},!1,ke);let rt=!1,at=!1,yt=!0;if(nt){const mt=.5*me*et+Te,zt=new a.P(-100,-100),Rt=new a.P(this.screenRightBoundary,this.screenBottomBoundary),wn=new on,$t=nt.first,hn=nt.last;let xn=[];for(let Cn=$t.path.length-1;Cn>=1;Cn--)xn.push($t.path[Cn]);for(let Cn=1;Cn<hn.path.length;Cn++)xn.push(hn.path[Cn]);const On=2.5*mt;if(B){const Cn=xn.map(zn=>er(zn,B,ke));xn=Cn.some(zn=>zn.signedDistanceFromCamera<=0)?[]:Cn.map(zn=>zn.point)}let bn=[];if(xn.length>0){const Cn=xn[0].clone(),zn=xn[0].clone();for(let Br=1;Br<xn.length;Br++)Cn.x=Math.min(Cn.x,xn[Br].x),Cn.y=Math.min(Cn.y,xn[Br].y),zn.x=Math.max(zn.x,xn[Br].x),zn.y=Math.max(zn.y,xn[Br].y);bn=Cn.x>=zt.x&&zn.x<=Rt.x&&Cn.y>=zt.y&&zn.y<=Rt.y?[xn]:zn.x<zt.x||Cn.x>Rt.x||zn.y<zt.y||Cn.y>Rt.y?[]:a.al([xn],zt.x,zt.y,Rt.x,Rt.y)}for(const Cn of bn){wn.reset(Cn,.25*mt);let zn=0;zn=wn.length<=.5*mt?1:Math.ceil(wn.paddedLength/On)+1;for(let Br=0;Br<zn;Br++){const rr=Br/Math.max(zn-1,1),to=wn.lerp(rr),ii=to.x+Lt,Er=to.y+Lt;Le.push(ii,Er,mt,0);const oi=ii-mt,no=Er-mt,Go=ii+mt,ks=Er+mt;if(yt=yt&&this.isOffscreen(oi,no,Go,ks),at=at||this.isInsideGrid(oi,no,Go,ks),l!=="always"&&this.grid.hitTestCircle(ii,Er,mt,l,te)&&(rt=!0,!G))return{circles:[],offscreen:!1,collisionDetected:rt}}}}return{circles:!G&&rt||!at||et<this.perspectiveRatioCutoff?[]:Le,offscreen:yt,collisionDetected:rt}}queryRenderedSymbols(l){if(l.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const f=[];let _=1/0,b=1/0,k=-1/0,I=-1/0;for(const Y of l){const te=new a.P(Y.x+Lt,Y.y+Lt);_=Math.min(_,te.x),b=Math.min(b,te.y),k=Math.max(k,te.x),I=Math.max(I,te.y),f.push(te)}const A=this.grid.query(_,b,k,I).concat(this.ignoredGrid.query(_,b,k,I)),B={},G={};for(const Y of A){const te=Y.key;if(B[te.bucketInstanceId]===void 0&&(B[te.bucketInstanceId]={}),B[te.bucketInstanceId][te.featureIndex])continue;const me=[new a.P(Y.x1,Y.y1),new a.P(Y.x2,Y.y1),new a.P(Y.x2,Y.y2),new a.P(Y.x1,Y.y2)];a.am(f,me)&&(B[te.bucketInstanceId][te.featureIndex]=!0,G[te.bucketInstanceId]===void 0&&(G[te.bucketInstanceId]=[]),G[te.bucketInstanceId].push(te.featureIndex))}return G}insertCollisionBox(l,f,_,b,k,I){(_?this.ignoredGrid:this.grid).insert({bucketInstanceId:b,featureIndex:k,collisionGroupID:I,overlapMode:f},l[0],l[1],l[2],l[3])}insertCollisionCircles(l,f,_,b,k,I){const A=_?this.ignoredGrid:this.grid,B={bucketInstanceId:b,featureIndex:k,collisionGroupID:I,overlapMode:f};for(let G=0;G<l.length;G+=4)A.insertCircle(B,l[G],l[G+1],l[G+2])}projectAndGetPerspectiveRatio(l,f,_,b){let k;return b?(k=[f,_,b(f,_),1],a.af(k,k,l)):(k=[f,_,0,1],lt(k,k,l)),{point:new a.P((k[0]/k[3]+1)/2*this.transform.width+Lt,(-k[1]/k[3]+1)/2*this.transform.height+Lt),perspectiveRatio:.5+this.transform.cameraToCenterDistance/k[3]*.5}}isOffscreen(l,f,_,b){return _<Lt||l>=this.screenRightBoundary||b<Lt||f>this.screenBottomBoundary}isInsideGrid(l,f,_,b){return _>=0&&l<this.gridRightBoundary&&b>=0&&f<this.gridBottomBoundary}getViewportMatrix(){const l=a.an([]);return a.H(l,l,[-100,-100,0]),l}}function cn(w,l,f){return l*(a.W/(w.tileSize*Math.pow(2,f-w.tileID.overscaledZ)))}class Sn{constructor(l,f,_,b){this.opacity=l?Math.max(0,Math.min(1,l.opacity+(l.placed?f:-f))):b&&_?1:0,this.placed=_}isHidden(){return this.opacity===0&&!this.placed}}class Fn{constructor(l,f,_,b,k){this.text=new Sn(l?l.text:null,f,_,k),this.icon=new Sn(l?l.icon:null,f,b,k)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class xr{constructor(l,f,_){this.text=l,this.icon=f,this.skipFade=_}}class Hr{constructor(){this.invProjMatrix=a.F(),this.viewportMatrix=a.F(),this.circles=[]}}class Tn{constructor(l,f,_,b,k){this.bucketInstanceId=l,this.featureIndex=f,this.sourceLayerIndex=_,this.bucketIndex=b,this.tileID=k}}class Dr{constructor(l){this.crossSourceCollisions=l,this.maxGroupID=0,this.collisionGroups={}}get(l){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[l]){const f=++this.maxGroupID;this.collisionGroups[l]={ID:f,predicate:_=>_.collisionGroupID===f}}return this.collisionGroups[l]}}function ri(w,l,f,_,b){const{horizontalAlign:k,verticalAlign:I}=a.at(w);return new a.P(-(k-.5)*l+_[0]*b,-(I-.5)*f+_[1]*b)}function Mi(w,l,f,_,b,k){const{x1:I,x2:A,y1:B,y2:G,anchorPointX:Y,anchorPointY:te}=w,me=new a.P(l,f);return _&&me._rotate(b?k:-k),{x1:I+me.x,y1:B+me.y,x2:A+me.x,y2:G+me.y,anchorPointX:Y,anchorPointY:te}}class Ri{constructor(l,f,_,b,k){this.transform=l.clone(),this.terrain=f,this.collisionIndex=new Jt(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=_,this.retainedQueryData={},this.collisionGroups=new Dr(b),this.collisionCircleArrays={},this.prevPlacement=k,k&&(k.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(l,f,_,b){const k=_.getBucket(f),I=_.latestFeatureIndex;if(!k||!I||f.id!==k.layerIds[0])return;const A=_.collisionBoxArray,B=k.layers[0].layout,G=Math.pow(2,this.transform.zoom-_.tileID.overscaledZ),Y=_.tileSize/a.W,te=this.transform.calculatePosMatrix(_.tileID.toUnwrapped()),me=B.get("text-pitch-alignment")==="map",Te=B.get("text-rotation-alignment")==="map",ke=cn(_,1,this.transform.zoom),Le=pn(te,me,Te,this.transform,ke);let be=null;if(me){const et=Di(te,me,Te,this.transform,ke);be=a.K([],this.transform.labelPlaneMatrix,et)}this.retainedQueryData[k.bucketInstanceId]=new Tn(k.bucketInstanceId,I,k.sourceLayerIndex,k.index,_.tileID);const Re={bucket:k,layout:B,posMatrix:te,textLabelPlaneMatrix:Le,labelToScreenMatrix:be,scale:G,textPixelRatio:Y,holdingForFade:_.holdingForFade(),collisionBoxArray:A,partiallyEvaluatedTextSize:a.ag(k.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(k.sourceID)};if(b)for(const et of k.sortKeyRanges){const{sortKey:Ie,symbolInstanceStart:Ve,symbolInstanceEnd:nt}=et;l.push({sortKey:Ie,symbolInstanceStart:Ve,symbolInstanceEnd:nt,parameters:Re})}else l.push({symbolInstanceStart:0,symbolInstanceEnd:k.symbolInstances.length,parameters:Re})}attemptAnchorPlacement(l,f,_,b,k,I,A,B,G,Y,te,me,Te,ke,Le,be){const Re=a.ap[l.textAnchor],et=[l.textOffset0,l.textOffset1],Ie=ri(Re,_,b,et,k),Ve=this.collisionIndex.placeCollisionBox(Mi(f,Ie.x,Ie.y,I,A,this.transform.angle),te,B,G,Y.predicate,be);if((!Le||this.collisionIndex.placeCollisionBox(Mi(Le,Ie.x,Ie.y,I,A,this.transform.angle),te,B,G,Y.predicate,be).box.length!==0)&&Ve.box.length>0){let nt;if(this.prevPlacement&&this.prevPlacement.variableOffsets[me.crossTileID]&&this.prevPlacement.placements[me.crossTileID]&&this.prevPlacement.placements[me.crossTileID].text&&(nt=this.prevPlacement.variableOffsets[me.crossTileID].anchor),me.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[me.crossTileID]={textOffset:et,width:_,height:b,anchor:Re,textBoxScale:k,prevAnchor:nt},this.markUsedJustification(Te,Re,me,ke),Te.allowVerticalPlacement&&(this.markUsedOrientation(Te,ke,me),this.placedOrientations[me.crossTileID]=ke),{shift:Ie,placedGlyphBoxes:Ve}}}placeLayerBucketPart(l,f,_){const{bucket:b,layout:k,posMatrix:I,textLabelPlaneMatrix:A,labelToScreenMatrix:B,textPixelRatio:G,holdingForFade:Y,collisionBoxArray:te,partiallyEvaluatedTextSize:me,collisionGroup:Te}=l.parameters,ke=k.get("text-optional"),Le=k.get("icon-optional"),be=a.aq(k,"text-overlap","text-allow-overlap"),Re=be==="always",et=a.aq(k,"icon-overlap","icon-allow-overlap"),Ie=et==="always",Ve=k.get("text-rotation-alignment")==="map",nt=k.get("text-pitch-alignment")==="map",rt=k.get("icon-text-fit")!=="none",at=k.get("symbol-z-order")==="viewport-y",yt=Re&&(Ie||!b.hasIconData()||Le),mt=Ie&&(Re||!b.hasTextData()||ke);!b.collisionArrays&&te&&b.deserializeCollisionBoxes(te);const zt=this.retainedQueryData[b.bucketInstanceId].tileID,Rt=this.terrain?($t,hn)=>this.terrain.getElevation(zt,$t,hn):null,wn=($t,hn)=>{var xn,On;if(f[$t.crossTileID])return;if(Y)return void(this.placements[$t.crossTileID]=new xr(!1,!1,!1));let bn=!1,Cn=!1,zn=!0,Br=null,rr={box:null,offscreen:null},to={box:null,offscreen:null},ii=null,Er=null,oi=null,no=0,Go=0,ks=0;hn.textFeatureIndex?no=hn.textFeatureIndex:$t.useRuntimeCollisionCircles&&(no=$t.featureIndex),hn.verticalTextFeatureIndex&&(Go=hn.verticalTextFeatureIndex);const ll=hn.textBox;if(ll){const Kr=Xr=>{let Ar=a.ah.horizontal;if(b.allowVerticalPlacement&&!Xr&&this.prevPlacement){const mo=this.prevPlacement.placedOrientations[$t.crossTileID];mo&&(this.placedOrientations[$t.crossTileID]=mo,Ar=mo,this.markUsedOrientation(b,Ar,$t))}return Ar},Ir=(Xr,Ar)=>{if(b.allowVerticalPlacement&&$t.numVerticalGlyphVertices>0&&hn.verticalTextBox){for(const mo of b.writingModes)if(mo===a.ah.vertical?(rr=Ar(),to=rr):rr=Xr(),rr&&rr.box&&rr.box.length)break}else rr=Xr()},Sr=$t.textAnchorOffsetStartIndex,po=$t.textAnchorOffsetEndIndex;if(po===Sr){const Xr=(Ar,mo)=>{const Jr=this.collisionIndex.placeCollisionBox(Ar,be,G,I,Te.predicate,Rt);return Jr&&Jr.box&&Jr.box.length&&(this.markUsedOrientation(b,mo,$t),this.placedOrientations[$t.crossTileID]=mo),Jr};Ir(()=>Xr(ll,a.ah.horizontal),()=>{const Ar=hn.verticalTextBox;return b.allowVerticalPlacement&&$t.numVerticalGlyphVertices>0&&Ar?Xr(Ar,a.ah.vertical):{box:null,offscreen:null}}),Kr(rr&&rr.box&&rr.box.length)}else{let Xr=a.ap[(On=(xn=this.prevPlacement)===null||xn===void 0?void 0:xn.variableOffsets[$t.crossTileID])===null||On===void 0?void 0:On.anchor];const Ar=(Jr,Ur,wc)=>{const vf=Jr.x2-Jr.x1,Ns=Jr.y2-Jr.y1,js=$t.textBoxScale,uu=rt&&et==="never"?Ur:null;let Ts={box:[],offscreen:!1},xc=be==="never"?1:2,wf="never";Xr&&xc++;for(let kc=0;kc<xc;kc++){for(let Sc=Sr;Sc<po;Sc++){const cu=b.textAnchorOffsets.get(Sc);if(Xr&&cu.textAnchor!==Xr)continue;const Tc=this.attemptAnchorPlacement(cu,Jr,vf,Ns,js,Ve,nt,G,I,Te,wf,$t,b,wc,uu,Rt);if(Tc&&(Ts=Tc.placedGlyphBoxes,Ts&&Ts.box&&Ts.box.length))return bn=!0,Br=Tc.shift,Ts}Xr?Xr=null:wf=be}return Ts};Ir(()=>Ar(ll,hn.iconBox,a.ah.horizontal),()=>{const Jr=hn.verticalTextBox;return b.allowVerticalPlacement&&!(rr&&rr.box&&rr.box.length)&&$t.numVerticalGlyphVertices>0&&Jr?Ar(Jr,hn.verticalIconBox,a.ah.vertical):{box:null,offscreen:null}}),rr&&(bn=rr.box,zn=rr.offscreen);const mo=Kr(rr&&rr.box);if(!bn&&this.prevPlacement){const Jr=this.prevPlacement.variableOffsets[$t.crossTileID];Jr&&(this.variableOffsets[$t.crossTileID]=Jr,this.markUsedJustification(b,Jr.anchor,$t,mo))}}}if(ii=rr,bn=ii&&ii.box&&ii.box.length>0,zn=ii&&ii.offscreen,$t.useRuntimeCollisionCircles){const Kr=b.text.placedSymbolArray.get($t.centerJustifiedTextSymbolIndex),Ir=a.ai(b.textSizeData,me,Kr),Sr=k.get("text-padding");Er=this.collisionIndex.placeCollisionCircles(be,Kr,b.lineVertexArray,b.glyphOffsetArray,Ir,I,A,B,_,nt,Te.predicate,$t.collisionCircleDiameter,Sr,Rt),Er.circles.length&&Er.collisionDetected&&!_&&a.w("Collisions detected, but collision boxes are not shown"),bn=Re||Er.circles.length>0&&!Er.collisionDetected,zn=zn&&Er.offscreen}if(hn.iconFeatureIndex&&(ks=hn.iconFeatureIndex),hn.iconBox){const Kr=Ir=>{const Sr=rt&&Br?Mi(Ir,Br.x,Br.y,Ve,nt,this.transform.angle):Ir;return this.collisionIndex.placeCollisionBox(Sr,et,G,I,Te.predicate,Rt)};to&&to.box&&to.box.length&&hn.verticalIconBox?(oi=Kr(hn.verticalIconBox),Cn=oi.box.length>0):(oi=Kr(hn.iconBox),Cn=oi.box.length>0),zn=zn&&oi.offscreen}const Ss=ke||$t.numHorizontalGlyphVertices===0&&$t.numVerticalGlyphVertices===0,Ho=Le||$t.numIconVertices===0;if(Ss||Ho?Ho?Ss||(Cn=Cn&&bn):bn=Cn&&bn:Cn=bn=Cn&&bn,bn&&ii&&ii.box&&this.collisionIndex.insertCollisionBox(ii.box,be,k.get("text-ignore-placement"),b.bucketInstanceId,to&&to.box&&Go?Go:no,Te.ID),Cn&&oi&&this.collisionIndex.insertCollisionBox(oi.box,et,k.get("icon-ignore-placement"),b.bucketInstanceId,ks,Te.ID),Er&&(bn&&this.collisionIndex.insertCollisionCircles(Er.circles,be,k.get("text-ignore-placement"),b.bucketInstanceId,no,Te.ID),_)){const Kr=b.bucketInstanceId;let Ir=this.collisionCircleArrays[Kr];Ir===void 0&&(Ir=this.collisionCircleArrays[Kr]=new Hr);for(let Sr=0;Sr<Er.circles.length;Sr+=4)Ir.circles.push(Er.circles[Sr+0]),Ir.circles.push(Er.circles[Sr+1]),Ir.circles.push(Er.circles[Sr+2]),Ir.circles.push(Er.collisionDetected?1:0)}if($t.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(b.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[$t.crossTileID]=new xr(bn||yt,Cn||mt,zn||b.justReloaded),f[$t.crossTileID]=!0};if(at){if(l.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const $t=b.getSortedSymbolIndexes(this.transform.angle);for(let hn=$t.length-1;hn>=0;--hn){const xn=$t[hn];wn(b.symbolInstances.get(xn),b.collisionArrays[xn])}}else for(let $t=l.symbolInstanceStart;$t<l.symbolInstanceEnd;$t++)wn(b.symbolInstances.get($t),b.collisionArrays[$t]);if(_&&b.bucketInstanceId in this.collisionCircleArrays){const $t=this.collisionCircleArrays[b.bucketInstanceId];a.ar($t.invProjMatrix,I),$t.viewportMatrix=this.collisionIndex.getViewportMatrix()}b.justReloaded=!1}markUsedJustification(l,f,_,b){let k;k=b===a.ah.vertical?_.verticalPlacedTextSymbolIndex:{left:_.leftJustifiedTextSymbolIndex,center:_.centerJustifiedTextSymbolIndex,right:_.rightJustifiedTextSymbolIndex}[a.as(f)];const I=[_.leftJustifiedTextSymbolIndex,_.centerJustifiedTextSymbolIndex,_.rightJustifiedTextSymbolIndex,_.verticalPlacedTextSymbolIndex];for(const A of I)A>=0&&(l.text.placedSymbolArray.get(A).crossTileID=k>=0&&A!==k?0:_.crossTileID)}markUsedOrientation(l,f,_){const b=f===a.ah.horizontal||f===a.ah.horizontalOnly?f:0,k=f===a.ah.vertical?f:0,I=[_.leftJustifiedTextSymbolIndex,_.centerJustifiedTextSymbolIndex,_.rightJustifiedTextSymbolIndex];for(const A of I)l.text.placedSymbolArray.get(A).placedOrientation=b;_.verticalPlacedTextSymbolIndex&&(l.text.placedSymbolArray.get(_.verticalPlacedTextSymbolIndex).placedOrientation=k)}commit(l){this.commitTime=l,this.zoomAtLastRecencyCheck=this.transform.zoom;const f=this.prevPlacement;let _=!1;this.prevZoomAdjustment=f?f.zoomAdjustment(this.transform.zoom):0;const b=f?f.symbolFadeChange(l):1,k=f?f.opacities:{},I=f?f.variableOffsets:{},A=f?f.placedOrientations:{};for(const B in this.placements){const G=this.placements[B],Y=k[B];Y?(this.opacities[B]=new Fn(Y,b,G.text,G.icon),_=_||G.text!==Y.text.placed||G.icon!==Y.icon.placed):(this.opacities[B]=new Fn(null,b,G.text,G.icon,G.skipFade),_=_||G.text||G.icon)}for(const B in k){const G=k[B];if(!this.opacities[B]){const Y=new Fn(G,b,!1,!1);Y.isHidden()||(this.opacities[B]=Y,_=_||G.text.placed||G.icon.placed)}}for(const B in I)this.variableOffsets[B]||!this.opacities[B]||this.opacities[B].isHidden()||(this.variableOffsets[B]=I[B]);for(const B in A)this.placedOrientations[B]||!this.opacities[B]||this.opacities[B].isHidden()||(this.placedOrientations[B]=A[B]);if(f&&f.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");_?this.lastPlacementChangeTime=l:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=f?f.lastPlacementChangeTime:l)}updateLayerOpacities(l,f){const _={};for(const b of f){const k=b.getBucket(l);k&&b.latestFeatureIndex&&l.id===k.layerIds[0]&&this.updateBucketOpacities(k,_,b.collisionBoxArray)}}updateBucketOpacities(l,f,_){l.hasTextData()&&(l.text.opacityVertexArray.clear(),l.text.hasVisibleVertices=!1),l.hasIconData()&&(l.icon.opacityVertexArray.clear(),l.icon.hasVisibleVertices=!1),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexArray.clear(),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexArray.clear();const b=l.layers[0],k=b.layout,I=new Fn(null,0,!1,!1,!0),A=k.get("text-allow-overlap"),B=k.get("icon-allow-overlap"),G=b._unevaluatedLayout.hasValue("text-variable-anchor")||b._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Y=k.get("text-rotation-alignment")==="map",te=k.get("text-pitch-alignment")==="map",me=k.get("icon-text-fit")!=="none",Te=new Fn(null,0,A&&(B||!l.hasIconData()||k.get("icon-optional")),B&&(A||!l.hasTextData()||k.get("text-optional")),!0);!l.collisionArrays&&_&&(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData())&&l.deserializeCollisionBoxes(_);const ke=(Le,be,Re)=>{for(let et=0;et<be/4;et++)Le.opacityVertexArray.emplaceBack(Re);Le.hasVisibleVertices=Le.hasVisibleVertices||Re!==Na};for(let Le=0;Le<l.symbolInstances.length;Le++){const be=l.symbolInstances.get(Le),{numHorizontalGlyphVertices:Re,numVerticalGlyphVertices:et,crossTileID:Ie}=be;let Ve=this.opacities[Ie];f[Ie]?Ve=I:Ve||(Ve=Te,this.opacities[Ie]=Ve),f[Ie]=!0;const nt=be.numIconVertices>0,rt=this.placedOrientations[be.crossTileID],at=rt===a.ah.vertical,yt=rt===a.ah.horizontal||rt===a.ah.horizontalOnly;if(Re>0||et>0){const mt=Fi(Ve.text);ke(l.text,Re,at?Na:mt),ke(l.text,et,yt?Na:mt);const zt=Ve.text.isHidden();[be.rightJustifiedTextSymbolIndex,be.centerJustifiedTextSymbolIndex,be.leftJustifiedTextSymbolIndex].forEach($t=>{$t>=0&&(l.text.placedSymbolArray.get($t).hidden=zt||at?1:0)}),be.verticalPlacedTextSymbolIndex>=0&&(l.text.placedSymbolArray.get(be.verticalPlacedTextSymbolIndex).hidden=zt||yt?1:0);const Rt=this.variableOffsets[be.crossTileID];Rt&&this.markUsedJustification(l,Rt.anchor,be,rt);const wn=this.placedOrientations[be.crossTileID];wn&&(this.markUsedJustification(l,"left",be,wn),this.markUsedOrientation(l,wn,be))}if(nt){const mt=Fi(Ve.icon),zt=!(me&&be.verticalPlacedIconSymbolIndex&&at);be.placedIconSymbolIndex>=0&&(ke(l.icon,be.numIconVertices,zt?mt:Na),l.icon.placedSymbolArray.get(be.placedIconSymbolIndex).hidden=Ve.icon.isHidden()),be.verticalPlacedIconSymbolIndex>=0&&(ke(l.icon,be.numVerticalIconVertices,zt?Na:mt),l.icon.placedSymbolArray.get(be.verticalPlacedIconSymbolIndex).hidden=Ve.icon.isHidden())}if(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData()){const mt=l.collisionArrays[Le];if(mt){let zt=new a.P(0,0);if(mt.textBox||mt.verticalTextBox){let wn=!0;if(G){const $t=this.variableOffsets[Ie];$t?(zt=ri($t.anchor,$t.width,$t.height,$t.textOffset,$t.textBoxScale),Y&&zt._rotate(te?this.transform.angle:-this.transform.angle)):wn=!1}mt.textBox&&mi(l.textCollisionBox.collisionVertexArray,Ve.text.placed,!wn||at,zt.x,zt.y),mt.verticalTextBox&&mi(l.textCollisionBox.collisionVertexArray,Ve.text.placed,!wn||yt,zt.x,zt.y)}const Rt=!!(!yt&&mt.verticalIconBox);mt.iconBox&&mi(l.iconCollisionBox.collisionVertexArray,Ve.icon.placed,Rt,me?zt.x:0,me?zt.y:0),mt.verticalIconBox&&mi(l.iconCollisionBox.collisionVertexArray,Ve.icon.placed,!Rt,me?zt.x:0,me?zt.y:0)}}}if(l.sortFeatures(this.transform.angle),this.retainedQueryData[l.bucketInstanceId]&&(this.retainedQueryData[l.bucketInstanceId].featureSortOrder=l.featureSortOrder),l.hasTextData()&&l.text.opacityVertexBuffer&&l.text.opacityVertexBuffer.updateData(l.text.opacityVertexArray),l.hasIconData()&&l.icon.opacityVertexBuffer&&l.icon.opacityVertexBuffer.updateData(l.icon.opacityVertexArray),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexBuffer&&l.iconCollisionBox.collisionVertexBuffer.updateData(l.iconCollisionBox.collisionVertexArray),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexBuffer&&l.textCollisionBox.collisionVertexBuffer.updateData(l.textCollisionBox.collisionVertexArray),l.text.opacityVertexArray.length!==l.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${l.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${l.text.layoutVertexArray.length}) / 4`);if(l.icon.opacityVertexArray.length!==l.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${l.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${l.icon.layoutVertexArray.length}) / 4`);if(l.bucketInstanceId in this.collisionCircleArrays){const Le=this.collisionCircleArrays[l.bucketInstanceId];l.placementInvProjMatrix=Le.invProjMatrix,l.placementViewportMatrix=Le.viewportMatrix,l.collisionCircleArray=Le.circles,delete this.collisionCircleArrays[l.bucketInstanceId]}}symbolFadeChange(l){return this.fadeDuration===0?1:(l-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(l){return Math.max(0,(this.transform.zoom-l)/1.5)}hasTransitions(l){return this.stale||l-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(l,f){const _=this.zoomAtLastRecencyCheck===f?1-this.zoomAdjustment(f):1;return this.zoomAtLastRecencyCheck=f,this.commitTime+this.fadeDuration*_>l}setStale(){this.stale=!0}}function mi(w,l,f,_,b){w.emplaceBack(l?1:0,f?1:0,_||0,b||0),w.emplaceBack(l?1:0,f?1:0,_||0,b||0),w.emplaceBack(l?1:0,f?1:0,_||0,b||0),w.emplaceBack(l?1:0,f?1:0,_||0,b||0)}const jo=Math.pow(2,25),Fh=Math.pow(2,24),Fd=Math.pow(2,17),tr=Math.pow(2,16),Vu=Math.pow(2,9),qu=Math.pow(2,8),Yi=Math.pow(2,1);function Fi(w){if(w.opacity===0&&!w.placed)return 0;if(w.opacity===1&&w.placed)return 4294967295;const l=w.placed?1:0,f=Math.floor(127*w.opacity);return f*jo+l*Fh+f*Fd+l*tr+f*Vu+l*qu+f*Yi+l}const Na=0;class ho{constructor(l){this._sortAcrossTiles=l.layout.get("symbol-z-order")!=="viewport-y"&&!l.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(l,f,_,b,k){const I=this._bucketParts;for(;this._currentTileIndex<l.length;)if(f.getBucketParts(I,b,l[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,k())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,I.sort((A,B)=>A.sortKey-B.sortKey));this._currentPartIndex<I.length;)if(f.placeLayerBucketPart(I[this._currentPartIndex],this._seenCrossTileIDs,_),this._currentPartIndex++,k())return!0;return!1}}class fo{constructor(l,f,_,b,k,I,A,B){this.placement=new Ri(l,f,I,A,B),this._currentPlacementIndex=_.length-1,this._forceFullPlacement=b,this._showCollisionBoxes=k,this._done=!1}isDone(){return this._done}continuePlacement(l,f,_){const b=y.now(),k=()=>!this._forceFullPlacement&&y.now()-b>2;for(;this._currentPlacementIndex>=0;){const I=f[l[this._currentPlacementIndex]],A=this.placement.collisionIndex.transform.zoom;if(I.type==="symbol"&&(!I.minzoom||I.minzoom<=A)&&(!I.maxzoom||I.maxzoom>A)){if(this._inProgressLayer||(this._inProgressLayer=new ho(I)),this._inProgressLayer.continuePlacement(_[I.source],this.placement,this._showCollisionBoxes,I,k))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(l){return this.placement.commit(l),this.placement}}const ra=512/a.W/2;class Sl{constructor(l,f,_){this.tileID=l,this.bucketInstanceId=_,this._symbolsByKey={};const b=new Map;for(let k=0;k<f.length;k++){const I=f.get(k),A=I.key,B=b.get(A);B?B.push(I):b.set(A,[I])}for(const[k,I]of b){const A={positions:I.map(B=>({x:Math.floor(B.anchorX*ra),y:Math.floor(B.anchorY*ra)})),crossTileIDs:I.map(B=>B.crossTileID)};if(A.positions.length>128){const B=new a.au(A.positions.length,16,Uint16Array);for(const{x:G,y:Y}of A.positions)B.add(G,Y);B.finish(),delete A.positions,A.index=B}this._symbolsByKey[k]=A}}getScaledCoordinates(l,f){const{x:_,y:b,z:k}=this.tileID.canonical,{x:I,y:A,z:B}=f.canonical,G=ra/Math.pow(2,B-k),Y=(A*a.W+l.anchorY)*G,te=b*a.W*ra;return{x:Math.floor((I*a.W+l.anchorX)*G-_*a.W*ra),y:Math.floor(Y-te)}}findMatches(l,f,_){const b=this.tileID.canonical.z<f.canonical.z?1:Math.pow(2,this.tileID.canonical.z-f.canonical.z);for(let k=0;k<l.length;k++){const I=l.get(k);if(I.crossTileID)continue;const A=this._symbolsByKey[I.key];if(!A)continue;const B=this.getScaledCoordinates(I,f);if(A.index){const G=A.index.range(B.x-b,B.y-b,B.x+b,B.y+b).sort();for(const Y of G){const te=A.crossTileIDs[Y];if(!_[te]){_[te]=!0,I.crossTileID=te;break}}}else if(A.positions)for(let G=0;G<A.positions.length;G++){const Y=A.positions[G],te=A.crossTileIDs[G];if(Math.abs(Y.x-B.x)<=b&&Math.abs(Y.y-B.y)<=b&&!_[te]){_[te]=!0,I.crossTileID=te;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:l})=>l)}}class Wr{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class ja{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(l){const f=Math.round((l-this.lng)/360);if(f!==0)for(const _ in this.indexes){const b=this.indexes[_],k={};for(const I in b){const A=b[I];A.tileID=A.tileID.unwrapTo(A.tileID.wrap+f),k[A.tileID.key]=A}this.indexes[_]=k}this.lng=l}addBucket(l,f,_){if(this.indexes[l.overscaledZ]&&this.indexes[l.overscaledZ][l.key]){if(this.indexes[l.overscaledZ][l.key].bucketInstanceId===f.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(l.overscaledZ,this.indexes[l.overscaledZ][l.key])}for(let k=0;k<f.symbolInstances.length;k++)f.symbolInstances.get(k).crossTileID=0;this.usedCrossTileIDs[l.overscaledZ]||(this.usedCrossTileIDs[l.overscaledZ]={});const b=this.usedCrossTileIDs[l.overscaledZ];for(const k in this.indexes){const I=this.indexes[k];if(Number(k)>l.overscaledZ)for(const A in I){const B=I[A];B.tileID.isChildOf(l)&&B.findMatches(f.symbolInstances,l,b)}else{const A=I[l.scaledTo(Number(k)).key];A&&A.findMatches(f.symbolInstances,l,b)}}for(let k=0;k<f.symbolInstances.length;k++){const I=f.symbolInstances.get(k);I.crossTileID||(I.crossTileID=_.generate(),b[I.crossTileID]=!0)}return this.indexes[l.overscaledZ]===void 0&&(this.indexes[l.overscaledZ]={}),this.indexes[l.overscaledZ][l.key]=new Sl(l,f.symbolInstances,f.bucketInstanceId),!0}removeBucketCrossTileIDs(l,f){for(const _ of f.getCrossTileIDsLists())for(const b of _)delete this.usedCrossTileIDs[l][b]}removeStaleBuckets(l){let f=!1;for(const _ in this.indexes){const b=this.indexes[_];for(const k in b)l[b[k].bucketInstanceId]||(this.removeBucketCrossTileIDs(_,b[k]),delete b[k],f=!0)}return f}}class _s{constructor(){this.layerIndexes={},this.crossTileIDs=new Wr,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(l,f,_){let b=this.layerIndexes[l.id];b===void 0&&(b=this.layerIndexes[l.id]=new ja);let k=!1;const I={};b.handleWrapJump(_);for(const A of f){const B=A.getBucket(l);B&&l.id===B.layerIds[0]&&(B.bucketInstanceId||(B.bucketInstanceId=++this.maxBucketInstanceId),b.addBucket(A.tileID,B,this.crossTileIDs)&&(k=!0),I[B.bucketInstanceId]=!0)}return b.removeStaleBuckets(I)&&(k=!0),k}pruneUnusedLayers(l){const f={};l.forEach(_=>{f[_]=!0});for(const _ in this.layerIndexes)f[_]||delete this.layerIndexes[_]}}const Lr=(w,l)=>a.t(w,l&&l.filter(f=>f.identifier!=="source.canvas")),Tl=a.av();class Qi extends a.E{constructor(l,f={}){super(),this._rtlPluginLoaded=()=>{for(const _ in this.sourceCaches){const b=this.sourceCaches[_].getSource().type;b!=="vector"&&b!=="geojson"||this.sourceCaches[_].reload()}},this.map=l,this.dispatcher=new Pt(Bt(),l._getMapId()),this.dispatcher.registerMessageHandler("GG",(_,b)=>this.getGlyphs(_,b)),this.dispatcher.registerMessageHandler("GI",(_,b)=>this.getImages(_,b)),this.imageManager=new Ce,this.imageManager.setEventedParent(this),this.glyphManager=new je(l._requestManager,f.localIdeographFontFamily),this.lineAtlas=new ht(256,512),this.crossTileSymbolIndex=new _s,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new a.aw,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",a.ax()),vt().on(jr,this._rtlPluginLoaded),this.on("data",_=>{if(_.dataType!=="source"||_.sourceDataType!=="metadata")return;const b=this.sourceCaches[_.sourceId];if(!b)return;const k=b.getSource();if(k&&k.vectorLayerIds)for(const I in this._layers){const A=this._layers[I];A.source===k.id&&this._validateLayer(A)}})}loadURL(l,f={},_){this.fire(new a.k("dataloading",{dataType:"style"})),f.validate=typeof f.validate!="boolean"||f.validate;const b=this.map._requestManager.transformRequest(l,"Style");this._loadStyleRequest=new AbortController,a.h(b,this._loadStyleRequest).then(k=>{this._loadStyleRequest=null,this._load(k.data,f,_)}).catch(k=>{this._loadStyleRequest=null,k&&this.fire(new a.j(k))})}loadJSON(l,f={},_){this.fire(new a.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,y.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,f.validate=f.validate!==!1,this._load(l,f,_)}).catch(()=>{})}loadEmpty(){this.fire(new a.k("dataloading",{dataType:"style"})),this._load(Tl,{validate:!1})}_load(l,f,_){var b;const k=f.transformStyle?f.transformStyle(_,l):l;if(!f.validate||!Lr(this,a.x(k))){this._loaded=!0,this.stylesheet=k;for(const I in k.sources)this.addSource(I,k.sources[I],{validate:!1});k.sprite?this._loadSprite(k.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(k.glyphs),this._createLayers(),this.light=new ut(this.stylesheet.light),this.map.setTerrain((b=this.stylesheet.terrain)!==null&&b!==void 0?b:null),this.fire(new a.k("data",{dataType:"style"})),this.fire(new a.k("style.load"))}}_createLayers(){const l=a.ay(this.stylesheet.layers);this.dispatcher.broadcast("SL",l),this._order=l.map(f=>f.id),this._layers={},this._serializedLayers=null;for(const f of l){const _=a.az(f);_.setEventedParent(this,{layer:{id:f.id}}),this._layers[f.id]=_}}_loadSprite(l,f=!1,_=void 0){let b;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(k,I,A,B){return a._(this,void 0,void 0,function*(){const G=Ae(k),Y=A>1?"@2x":"",te={},me={};for(const{id:Te,url:ke}of G){const Le=I.transformRequest(I.normalizeSpriteURL(ke,Y,".json"),"SpriteJSON");te[Te]=a.h(Le,B);const be=I.transformRequest(I.normalizeSpriteURL(ke,Y,".png"),"SpriteImage");me[Te]=$.getImage(be,B)}return yield Promise.all([...Object.values(te),...Object.values(me)]),function(Te,ke){return a._(this,void 0,void 0,function*(){const Le={};for(const be in Te){Le[be]={};const Re=y.getImageCanvasContext((yield ke[be]).data),et=(yield Te[be]).data;for(const Ie in et){const{width:Ve,height:nt,x:rt,y:at,sdf:yt,pixelRatio:mt,stretchX:zt,stretchY:Rt,content:wn}=et[Ie];Le[be][Ie]={data:null,pixelRatio:mt,sdf:yt,stretchX:zt,stretchY:Rt,content:wn,spriteData:{width:Ve,height:nt,x:rt,y:at,context:Re}}}}return Le})}(te,me)})}(l,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(k=>{if(this._spriteRequest=null,k)for(const I in k){this._spritesImagesIds[I]=[];const A=this._spritesImagesIds[I]?this._spritesImagesIds[I].filter(B=>!(B in k)):[];for(const B of A)this.imageManager.removeImage(B),this._changedImages[B]=!0;for(const B in k[I]){const G=I==="default"?B:`${I}:${B}`;this._spritesImagesIds[I].push(G),G in this.imageManager.images?this.imageManager.updateImage(G,k[I][B],!1):this.imageManager.addImage(G,k[I][B]),f&&(this._changedImages[G]=!0)}}}).catch(k=>{this._spriteRequest=null,b=k,this.fire(new a.j(b))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),f&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.k("data",{dataType:"style"})),_&&_(b)})}_unloadSprite(){for(const l of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(l),this._changedImages[l]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.k("data",{dataType:"style"}))}_validateLayer(l){const f=this.sourceCaches[l.source];if(!f)return;const _=l.sourceLayer;if(!_)return;const b=f.getSource();(b.type==="geojson"||b.vectorLayerIds&&b.vectorLayerIds.indexOf(_)===-1)&&this.fire(new a.j(new Error(`Source layer "${_}" does not exist on source "${b.id}" as specified by style layer "${l.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const l in this.sourceCaches)if(!this.sourceCaches[l].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(l){const f=this._serializedAllLayers();if(!l||l.length===0)return Object.values(f);const _=[];for(const b of l)f[b]&&_.push(f[b]);return _}_serializedAllLayers(){let l=this._serializedLayers;if(l)return l;l=this._serializedLayers={};const f=Object.keys(this._layers);for(const _ of f){const b=this._layers[_];b.type!=="custom"&&(l[_]=b.serialize())}return l}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const l in this.sourceCaches)if(this.sourceCaches[l].hasTransition())return!0;for(const l in this._layers)if(this._layers[l].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(l){if(!this._loaded)return;const f=this._changed;if(f){const b=Object.keys(this._updatedLayers),k=Object.keys(this._removedLayers);(b.length||k.length)&&this._updateWorkerLayers(b,k);for(const I in this._updatedSources){const A=this._updatedSources[I];if(A==="reload")this._reloadSource(I);else{if(A!=="clear")throw new Error(`Invalid action ${A}`);this._clearSource(I)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const I in this._updatedPaintProps)this._layers[I].updateTransitions(l);this.light.updateTransitions(l),this._resetUpdates()}const _={};for(const b in this.sourceCaches){const k=this.sourceCaches[b];_[b]=k.used,k.used=!1}for(const b of this._order){const k=this._layers[b];k.recalculate(l,this._availableImages),!k.isHidden(l.zoom)&&k.source&&(this.sourceCaches[k.source].used=!0)}for(const b in _){const k=this.sourceCaches[b];!!_[b]!=!!k.used&&k.fire(new a.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:b}))}this.light.recalculate(l),this.z=l.zoom,f&&this.fire(new a.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const l=Object.keys(this._changedImages);if(l.length){for(const f in this.sourceCaches)this.sourceCaches[f].reloadTilesForDependencies(["icons","patterns"],l);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const l in this.sourceCaches)this.sourceCaches[l].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(l,f){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(l),removedIds:f})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(l,f={}){var _;this._checkLoaded();const b=this.serialize();if(l=f.transformStyle?f.transformStyle(b,l):l,((_=f.validate)===null||_===void 0||_)&&Lr(this,a.x(l)))return!1;(l=a.aA(l)).layers=a.ay(l.layers);const k=a.aB(b,l),I=this._getOperationsToPerform(k);if(I.unimplemented.length>0)throw new Error(`Unimplemented: ${I.unimplemented.join(", ")}.`);if(I.operations.length===0)return!1;for(const A of I.operations)A();return this.stylesheet=l,this._serializedLayers=null,!0}_getOperationsToPerform(l){const f=[],_=[];for(const b of l)switch(b.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":f.push(()=>this.addLayer.apply(this,b.args));break;case"removeLayer":f.push(()=>this.removeLayer.apply(this,b.args));break;case"setPaintProperty":f.push(()=>this.setPaintProperty.apply(this,b.args));break;case"setLayoutProperty":f.push(()=>this.setLayoutProperty.apply(this,b.args));break;case"setFilter":f.push(()=>this.setFilter.apply(this,b.args));break;case"addSource":f.push(()=>this.addSource.apply(this,b.args));break;case"removeSource":f.push(()=>this.removeSource.apply(this,b.args));break;case"setLayerZoomRange":f.push(()=>this.setLayerZoomRange.apply(this,b.args));break;case"setLight":f.push(()=>this.setLight.apply(this,b.args));break;case"setGeoJSONSourceData":f.push(()=>this.setGeoJSONSourceData.apply(this,b.args));break;case"setGlyphs":f.push(()=>this.setGlyphs.apply(this,b.args));break;case"setSprite":f.push(()=>this.setSprite.apply(this,b.args));break;case"setTerrain":f.push(()=>this.map.setTerrain.apply(this,b.args));break;case"setTransition":f.push(()=>{});break;default:_.push(b.command)}return{operations:f,unimplemented:_}}addImage(l,f){if(this.getImage(l))return this.fire(new a.j(new Error(`An image named "${l}" already exists.`)));this.imageManager.addImage(l,f),this._afterImageUpdated(l)}updateImage(l,f){this.imageManager.updateImage(l,f)}getImage(l){return this.imageManager.getImage(l)}removeImage(l){if(!this.getImage(l))return this.fire(new a.j(new Error(`An image named "${l}" does not exist.`)));this.imageManager.removeImage(l),this._afterImageUpdated(l)}_afterImageUpdated(l){this._availableImages=this.imageManager.listImages(),this._changedImages[l]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(l,f,_={}){if(this._checkLoaded(),this.sourceCaches[l]!==void 0)throw new Error(`Source "${l}" already exists.`);if(!f.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(f).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(f.type)>=0&&this._validate(a.x.source,`sources.${l}`,f,null,_))return;this.map&&this.map._collectResourceTiming&&(f.collectResourceTiming=!0);const b=this.sourceCaches[l]=new qn(l,f,this.dispatcher);b.style=this,b.setEventedParent(this,()=>({isSourceLoaded:b.loaded(),source:b.serialize(),sourceId:l})),b.onAdd(this.map),this._changed=!0}removeSource(l){if(this._checkLoaded(),this.sourceCaches[l]===void 0)throw new Error("There is no source with this ID");for(const _ in this._layers)if(this._layers[_].source===l)return this.fire(new a.j(new Error(`Source "${l}" cannot be removed while layer "${_}" is using it.`)));const f=this.sourceCaches[l];delete this.sourceCaches[l],delete this._updatedSources[l],f.fire(new a.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:l})),f.setEventedParent(null),f.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(l,f){if(this._checkLoaded(),this.sourceCaches[l]===void 0)throw new Error(`There is no source with this ID=${l}`);const _=this.sourceCaches[l].getSource();if(_.type!=="geojson")throw new Error(`geojsonSource.type is ${_.type}, which is !== 'geojson`);_.setData(f),this._changed=!0}getSource(l){return this.sourceCaches[l]&&this.sourceCaches[l].getSource()}addLayer(l,f,_={}){this._checkLoaded();const b=l.id;if(this.getLayer(b))return void this.fire(new a.j(new Error(`Layer "${b}" already exists on this map.`)));let k;if(l.type==="custom"){if(Lr(this,a.aC(l)))return;k=a.az(l)}else{if("source"in l&&typeof l.source=="object"&&(this.addSource(b,l.source),l=a.aA(l),l=a.e(l,{source:b})),this._validate(a.x.layer,`layers.${b}`,l,{arrayIndex:-1},_))return;k=a.az(l),this._validateLayer(k),k.setEventedParent(this,{layer:{id:b}})}const I=f?this._order.indexOf(f):this._order.length;if(f&&I===-1)this.fire(new a.j(new Error(`Cannot add layer "${b}" before non-existing layer "${f}".`)));else{if(this._order.splice(I,0,b),this._layerOrderChanged=!0,this._layers[b]=k,this._removedLayers[b]&&k.source&&k.type!=="custom"){const A=this._removedLayers[b];delete this._removedLayers[b],A.type!==k.type?this._updatedSources[k.source]="clear":(this._updatedSources[k.source]="reload",this.sourceCaches[k.source].pause())}this._updateLayer(k),k.onAdd&&k.onAdd(this.map)}}moveLayer(l,f){if(this._checkLoaded(),this._changed=!0,!this._layers[l])return void this.fire(new a.j(new Error(`The layer '${l}' does not exist in the map's style and cannot be moved.`)));if(l===f)return;const _=this._order.indexOf(l);this._order.splice(_,1);const b=f?this._order.indexOf(f):this._order.length;f&&b===-1?this.fire(new a.j(new Error(`Cannot move layer "${l}" before non-existing layer "${f}".`))):(this._order.splice(b,0,l),this._layerOrderChanged=!0)}removeLayer(l){this._checkLoaded();const f=this._layers[l];if(!f)return void this.fire(new a.j(new Error(`Cannot remove non-existing layer "${l}".`)));f.setEventedParent(null);const _=this._order.indexOf(l);this._order.splice(_,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[l]=f,delete this._layers[l],this._serializedLayers&&delete this._serializedLayers[l],delete this._updatedLayers[l],delete this._updatedPaintProps[l],f.onRemove&&f.onRemove(this.map)}getLayer(l){return this._layers[l]}getLayersOrder(){return[...this._order]}hasLayer(l){return l in this._layers}setLayerZoomRange(l,f,_){this._checkLoaded();const b=this.getLayer(l);b?b.minzoom===f&&b.maxzoom===_||(f!=null&&(b.minzoom=f),_!=null&&(b.maxzoom=_),this._updateLayer(b)):this.fire(new a.j(new Error(`Cannot set the zoom range of non-existing layer "${l}".`)))}setFilter(l,f,_={}){this._checkLoaded();const b=this.getLayer(l);if(b){if(!a.aD(b.filter,f))return f==null?(b.filter=void 0,void this._updateLayer(b)):void(this._validate(a.x.filter,`layers.${b.id}.filter`,f,null,_)||(b.filter=a.aA(f),this._updateLayer(b)))}else this.fire(new a.j(new Error(`Cannot filter non-existing layer "${l}".`)))}getFilter(l){return a.aA(this.getLayer(l).filter)}setLayoutProperty(l,f,_,b={}){this._checkLoaded();const k=this.getLayer(l);k?a.aD(k.getLayoutProperty(f),_)||(k.setLayoutProperty(f,_,b),this._updateLayer(k)):this.fire(new a.j(new Error(`Cannot style non-existing layer "${l}".`)))}getLayoutProperty(l,f){const _=this.getLayer(l);if(_)return _.getLayoutProperty(f);this.fire(new a.j(new Error(`Cannot get style of non-existing layer "${l}".`)))}setPaintProperty(l,f,_,b={}){this._checkLoaded();const k=this.getLayer(l);k?a.aD(k.getPaintProperty(f),_)||(k.setPaintProperty(f,_,b)&&this._updateLayer(k),this._changed=!0,this._updatedPaintProps[l]=!0,this._serializedLayers=null):this.fire(new a.j(new Error(`Cannot style non-existing layer "${l}".`)))}getPaintProperty(l,f){return this.getLayer(l).getPaintProperty(f)}setFeatureState(l,f){this._checkLoaded();const _=l.source,b=l.sourceLayer,k=this.sourceCaches[_];if(k===void 0)return void this.fire(new a.j(new Error(`The source '${_}' does not exist in the map's style.`)));const I=k.getSource().type;I==="geojson"&&b?this.fire(new a.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):I!=="vector"||b?(l.id===void 0&&this.fire(new a.j(new Error("The feature id parameter must be provided."))),k.setFeatureState(b,l.id,f)):this.fire(new a.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(l,f){this._checkLoaded();const _=l.source,b=this.sourceCaches[_];if(b===void 0)return void this.fire(new a.j(new Error(`The source '${_}' does not exist in the map's style.`)));const k=b.getSource().type,I=k==="vector"?l.sourceLayer:void 0;k!=="vector"||I?f&&typeof l.id!="string"&&typeof l.id!="number"?this.fire(new a.j(new Error("A feature id is required to remove its specific state property."))):b.removeFeatureState(I,l.id,f):this.fire(new a.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(l){this._checkLoaded();const f=l.source,_=l.sourceLayer,b=this.sourceCaches[f];if(b!==void 0)return b.getSource().type!=="vector"||_?(l.id===void 0&&this.fire(new a.j(new Error("The feature id parameter must be provided."))),b.getFeatureState(_,l.id)):void this.fire(new a.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new a.j(new Error(`The source '${f}' does not exist in the map's style.`)))}getTransition(){return a.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const l=a.aE(this.sourceCaches,k=>k.serialize()),f=this._serializeByIds(this._order),_=this.map.getTerrain()||void 0,b=this.stylesheet;return a.aF({version:b.version,name:b.name,metadata:b.metadata,light:b.light,center:b.center,zoom:b.zoom,bearing:b.bearing,pitch:b.pitch,sprite:b.sprite,glyphs:b.glyphs,transition:b.transition,sources:l,layers:f,terrain:_},k=>k!==void 0)}_updateLayer(l){this._updatedLayers[l.id]=!0,l.source&&!this._updatedSources[l.source]&&this.sourceCaches[l.source].getSource().type!=="raster"&&(this._updatedSources[l.source]="reload",this.sourceCaches[l.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(l){const f=I=>this._layers[I].type==="fill-extrusion",_={},b=[];for(let I=this._order.length-1;I>=0;I--){const A=this._order[I];if(f(A)){_[A]=I;for(const B of l){const G=B[A];if(G)for(const Y of G)b.push(Y)}}}b.sort((I,A)=>A.intersectionZ-I.intersectionZ);const k=[];for(let I=this._order.length-1;I>=0;I--){const A=this._order[I];if(f(A))for(let B=b.length-1;B>=0;B--){const G=b[B].feature;if(_[G.layer.id]<I)break;k.push(G),b.pop()}else for(const B of l){const G=B[A];if(G)for(const Y of G)k.push(Y.feature)}}return k}queryRenderedFeatures(l,f,_){f&&f.filter&&this._validate(a.x.filter,"queryRenderedFeatures.filter",f.filter,null,f);const b={};if(f&&f.layers){if(!Array.isArray(f.layers))return this.fire(new a.j(new Error("parameters.layers must be an Array."))),[];for(const A of f.layers){const B=this._layers[A];if(!B)return this.fire(new a.j(new Error(`The layer '${A}' does not exist in the map's style and cannot be queried for features.`))),[];b[B.source]=!0}}const k=[];f.availableImages=this._availableImages;const I=this._serializedAllLayers();for(const A in this.sourceCaches)f.layers&&!b[A]||k.push(qt(this.sourceCaches[A],this._layers,I,l,f,_));return this.placement&&k.push(function(A,B,G,Y,te,me,Te){const ke={},Le=me.queryRenderedSymbols(Y),be=[];for(const Re of Object.keys(Le).map(Number))be.push(Te[Re]);be.sort(rn);for(const Re of be){const et=Re.featureIndex.lookupSymbolFeatures(Le[Re.bucketInstanceId],B,Re.bucketIndex,Re.sourceLayerIndex,te.filter,te.layers,te.availableImages,A);for(const Ie in et){const Ve=ke[Ie]=ke[Ie]||[],nt=et[Ie];nt.sort((rt,at)=>{const yt=Re.featureSortOrder;if(yt){const mt=yt.indexOf(rt.featureIndex);return yt.indexOf(at.featureIndex)-mt}return at.featureIndex-rt.featureIndex});for(const rt of nt)Ve.push(rt)}}for(const Re in ke)ke[Re].forEach(et=>{const Ie=et.feature,Ve=G[A[Re].source].getFeatureState(Ie.layer["source-layer"],Ie.id);Ie.source=Ie.layer.source,Ie.layer["source-layer"]&&(Ie.sourceLayer=Ie.layer["source-layer"]),Ie.state=Ve});return ke}(this._layers,I,this.sourceCaches,l,f,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(k)}querySourceFeatures(l,f){f&&f.filter&&this._validate(a.x.filter,"querySourceFeatures.filter",f.filter,null,f);const _=this.sourceCaches[l];return _?function(b,k){const I=b.getRenderableIds().map(G=>b.getTileByID(G)),A=[],B={};for(let G=0;G<I.length;G++){const Y=I[G],te=Y.tileID.canonical.key;B[te]||(B[te]=!0,Y.querySourceFeatures(A,k))}return A}(_,f):[]}getLight(){return this.light.getLight()}setLight(l,f={}){this._checkLoaded();const _=this.light.getLight();let b=!1;for(const I in l)if(!a.aD(l[I],_[I])){b=!0;break}if(!b)return;const k={now:y.now(),transition:a.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(l,f),this.light.updateTransitions(k)}_validate(l,f,_,b,k={}){return(!k||k.validate!==!1)&&Lr(this,l.call(a.x,a.e({key:f,style:this.serialize(),value:_,styleSpec:a.v},b)))}_remove(l=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),vt().off(jr,this._rtlPluginLoaded);for(const f in this._layers)this._layers[f].setEventedParent(null);for(const f in this.sourceCaches){const _=this.sourceCaches[f];_.setEventedParent(null),_.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),l&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(l)}_clearSource(l){this.sourceCaches[l].clearTiles()}_reloadSource(l){this.sourceCaches[l].resume(),this.sourceCaches[l].reload()}_updateSources(l){for(const f in this.sourceCaches)this.sourceCaches[f].update(l,this.map.terrain)}_generateCollisionBoxes(){for(const l in this.sourceCaches)this._reloadSource(l)}_updatePlacement(l,f,_,b,k=!1){let I=!1,A=!1;const B={};for(const G of this._order){const Y=this._layers[G];if(Y.type!=="symbol")continue;if(!B[Y.source]){const me=this.sourceCaches[Y.source];B[Y.source]=me.getRenderableIds(!0).map(Te=>me.getTileByID(Te)).sort((Te,ke)=>ke.tileID.overscaledZ-Te.tileID.overscaledZ||(Te.tileID.isLessThan(ke.tileID)?-1:1))}const te=this.crossTileSymbolIndex.addLayer(Y,B[Y.source],l.center.lng);I=I||te}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((k=k||this._layerOrderChanged||_===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(y.now(),l.zoom))&&(this.pauseablePlacement=new fo(l,this.map.terrain,this._order,k,f,_,b,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,B),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(y.now()),A=!0),I&&this.pauseablePlacement.placement.setStale()),A||I)for(const G of this._order){const Y=this._layers[G];Y.type==="symbol"&&this.placement.updateLayerOpacities(Y,B[Y.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(y.now())}_releaseSymbolFadeTiles(){for(const l in this.sourceCaches)this.sourceCaches[l].releaseSymbolFadeTiles()}getImages(l,f){return a._(this,void 0,void 0,function*(){const _=yield this.imageManager.getImages(f.icons);this._updateTilesForChangedImages();const b=this.sourceCaches[f.source];return b&&b.setDependencies(f.tileID.key,f.type,f.icons),_})}getGlyphs(l,f){return a._(this,void 0,void 0,function*(){const _=yield this.glyphManager.getGlyphs(f.stacks),b=this.sourceCaches[f.source];return b&&b.setDependencies(f.tileID.key,f.type,[""]),_})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(l,f={}){this._checkLoaded(),l&&this._validate(a.x.glyphs,"glyphs",l,null,f)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=l,this.glyphManager.entries={},this.glyphManager.setURL(l))}addSprite(l,f,_={},b){this._checkLoaded();const k=[{id:l,url:f}],I=[...Ae(this.stylesheet.sprite),...k];this._validate(a.x.sprite,"sprite",I,null,_)||(this.stylesheet.sprite=I,this._loadSprite(k,!0,b))}removeSprite(l){this._checkLoaded();const f=Ae(this.stylesheet.sprite);if(f.find(_=>_.id===l)){if(this._spritesImagesIds[l])for(const _ of this._spritesImagesIds[l])this.imageManager.removeImage(_),this._changedImages[_]=!0;f.splice(f.findIndex(_=>_.id===l),1),this.stylesheet.sprite=f.length>0?f:void 0,delete this._spritesImagesIds[l],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.k("data",{dataType:"style"}))}else this.fire(new a.j(new Error(`Sprite "${l}" doesn't exists on this map.`)))}getSprite(){return Ae(this.stylesheet.sprite)}setSprite(l,f={},_){this._checkLoaded(),l&&this._validate(a.x.sprite,"sprite",l,null,f)||(this.stylesheet.sprite=l,l?this._loadSprite(l,!0,_):(this._unloadSprite(),_&&_(null)))}}var Cl=a.X([{name:"a_pos",type:"Int16",components:2}]),Uo="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const Ua={prelude:nr(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:nr(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:nr(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:nr(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:nr("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:nr(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:nr(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:nr("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:nr("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:nr("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:nr(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:nr(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:nr(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:nr(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:nr(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:nr(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:nr(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:nr(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:nr(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:nr(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:nr(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:nr(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:nr(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:nr(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:nr(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:nr(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:nr("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",Uo),terrainDepth:nr("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",Uo),terrainCoords:nr("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",Uo)};function nr(w,l){const f=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,_=l.match(/attribute ([\w]+) ([\w]+)/g),b=w.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),k=l.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),I=k?k.concat(b):b,A={};return{fragmentSource:w=w.replace(f,(B,G,Y,te,me)=>(A[me]=!0,G==="define"?`
#ifndef HAS_UNIFORM_u_${me}
varying ${Y} ${te} ${me};
#else
uniform ${Y} ${te} u_${me};
#endif
`:`
#ifdef HAS_UNIFORM_u_${me}
    ${Y} ${te} ${me} = u_${me};
#endif
`)),vertexSource:l=l.replace(f,(B,G,Y,te,me)=>{const Te=te==="float"?"vec2":"vec4",ke=me.match(/color/)?"color":Te;return A[me]?G==="define"?`
#ifndef HAS_UNIFORM_u_${me}
uniform lowp float u_${me}_t;
attribute ${Y} ${Te} a_${me};
varying ${Y} ${te} ${me};
#else
uniform ${Y} ${te} u_${me};
#endif
`:ke==="vec4"?`
#ifndef HAS_UNIFORM_u_${me}
    ${me} = a_${me};
#else
    ${Y} ${te} ${me} = u_${me};
#endif
`:`
#ifndef HAS_UNIFORM_u_${me}
    ${me} = unpack_mix_${ke}(a_${me}, u_${me}_t);
#else
    ${Y} ${te} ${me} = u_${me};
#endif
`:G==="define"?`
#ifndef HAS_UNIFORM_u_${me}
uniform lowp float u_${me}_t;
attribute ${Y} ${Te} a_${me};
#else
uniform ${Y} ${te} u_${me};
#endif
`:ke==="vec4"?`
#ifndef HAS_UNIFORM_u_${me}
    ${Y} ${te} ${me} = a_${me};
#else
    ${Y} ${te} ${me} = u_${me};
#endif
`:`
#ifndef HAS_UNIFORM_u_${me}
    ${Y} ${te} ${me} = unpack_mix_${ke}(a_${me}, u_${me}_t);
#else
    ${Y} ${te} ${me} = u_${me};
#endif
`}),staticAttributes:_,staticUniforms:I}}class Ml{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(l,f,_,b,k,I,A,B,G){this.context=l;let Y=this.boundPaintVertexBuffers.length!==b.length;for(let te=0;!Y&&te<b.length;te++)this.boundPaintVertexBuffers[te]!==b[te]&&(Y=!0);!this.vao||this.boundProgram!==f||this.boundLayoutVertexBuffer!==_||Y||this.boundIndexBuffer!==k||this.boundVertexOffset!==I||this.boundDynamicVertexBuffer!==A||this.boundDynamicVertexBuffer2!==B||this.boundDynamicVertexBuffer3!==G?this.freshBind(f,_,b,k,I,A,B,G):(l.bindVertexArray.set(this.vao),A&&A.bind(),k&&k.dynamicDraw&&k.bind(),B&&B.bind(),G&&G.bind())}freshBind(l,f,_,b,k,I,A,B){const G=l.numAttributes,Y=this.context,te=Y.gl;this.vao&&this.destroy(),this.vao=Y.createVertexArray(),Y.bindVertexArray.set(this.vao),this.boundProgram=l,this.boundLayoutVertexBuffer=f,this.boundPaintVertexBuffers=_,this.boundIndexBuffer=b,this.boundVertexOffset=k,this.boundDynamicVertexBuffer=I,this.boundDynamicVertexBuffer2=A,this.boundDynamicVertexBuffer3=B,f.enableAttributes(te,l);for(const me of _)me.enableAttributes(te,l);I&&I.enableAttributes(te,l),A&&A.enableAttributes(te,l),B&&B.enableAttributes(te,l),f.bind(),f.setVertexAttribPointers(te,l,k);for(const me of _)me.bind(),me.setVertexAttribPointers(te,l,k);I&&(I.bind(),I.setVertexAttribPointers(te,l,k)),b&&b.bind(),A&&(A.bind(),A.setVertexAttribPointers(te,l,k)),B&&(B.bind(),B.setVertexAttribPointers(te,l,k)),Y.currentNumAttributes=G}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function ia(w){const l=[];for(let f=0;f<w.length;f++){if(w[f]===null)continue;const _=w[f].split(" ");l.push(_.pop())}return l}class ys{constructor(l,f,_,b,k,I){const A=l.gl;this.program=A.createProgram();const B=ia(f.staticAttributes),G=_?_.getBinderAttributes():[],Y=B.concat(G),te=Ua.prelude.staticUniforms?ia(Ua.prelude.staticUniforms):[],me=f.staticUniforms?ia(f.staticUniforms):[],Te=_?_.getBinderUniforms():[],ke=te.concat(me).concat(Te),Le=[];for(const rt of ke)Le.indexOf(rt)<0&&Le.push(rt);const be=_?_.defines():[];k&&be.push("#define OVERDRAW_INSPECTOR;"),I&&be.push("#define TERRAIN3D;");const Re=be.concat(Ua.prelude.fragmentSource,f.fragmentSource).join(`
`),et=be.concat(Ua.prelude.vertexSource,f.vertexSource).join(`
`),Ie=A.createShader(A.FRAGMENT_SHADER);if(A.isContextLost())return void(this.failedToCreate=!0);if(A.shaderSource(Ie,Re),A.compileShader(Ie),!A.getShaderParameter(Ie,A.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${A.getShaderInfoLog(Ie)}`);A.attachShader(this.program,Ie);const Ve=A.createShader(A.VERTEX_SHADER);if(A.isContextLost())return void(this.failedToCreate=!0);if(A.shaderSource(Ve,et),A.compileShader(Ve),!A.getShaderParameter(Ve,A.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${A.getShaderInfoLog(Ve)}`);A.attachShader(this.program,Ve),this.attributes={};const nt={};this.numAttributes=Y.length;for(let rt=0;rt<this.numAttributes;rt++)Y[rt]&&(A.bindAttribLocation(this.program,rt,Y[rt]),this.attributes[Y[rt]]=rt);if(A.linkProgram(this.program),!A.getProgramParameter(this.program,A.LINK_STATUS))throw new Error(`Program failed to link: ${A.getProgramInfoLog(this.program)}`);A.deleteShader(Ve),A.deleteShader(Ie);for(let rt=0;rt<Le.length;rt++){const at=Le[rt];if(at&&!nt[at]){const yt=A.getUniformLocation(this.program,at);yt&&(nt[at]=yt)}}this.fixedUniforms=b(l,nt),this.terrainUniforms=((rt,at)=>({u_depth:new a.aG(rt,at.u_depth),u_terrain:new a.aG(rt,at.u_terrain),u_terrain_dim:new a.aH(rt,at.u_terrain_dim),u_terrain_matrix:new a.aI(rt,at.u_terrain_matrix),u_terrain_unpack:new a.aJ(rt,at.u_terrain_unpack),u_terrain_exaggeration:new a.aH(rt,at.u_terrain_exaggeration)}))(l,nt),this.binderUniforms=_?_.getUniforms(l,nt):[]}draw(l,f,_,b,k,I,A,B,G,Y,te,me,Te,ke,Le,be,Re,et){const Ie=l.gl;if(this.failedToCreate)return;if(l.program.set(this.program),l.setDepthMode(_),l.setStencilMode(b),l.setColorMode(k),l.setCullFace(I),B){l.activeTexture.set(Ie.TEXTURE2),Ie.bindTexture(Ie.TEXTURE_2D,B.depthTexture),l.activeTexture.set(Ie.TEXTURE3),Ie.bindTexture(Ie.TEXTURE_2D,B.texture);for(const nt in this.terrainUniforms)this.terrainUniforms[nt].set(B[nt])}for(const nt in this.fixedUniforms)this.fixedUniforms[nt].set(A[nt]);Le&&Le.setUniforms(l,this.binderUniforms,Te,{zoom:ke});let Ve=0;switch(f){case Ie.LINES:Ve=2;break;case Ie.TRIANGLES:Ve=3;break;case Ie.LINE_STRIP:Ve=1}for(const nt of me.get()){const rt=nt.vaos||(nt.vaos={});(rt[G]||(rt[G]=new Ml)).bind(l,this,Y,Le?Le.getPaintVertexBuffers():[],te,nt.vertexOffset,be,Re,et),Ie.drawElements(f,nt.primitiveLength*Ve,Ie.UNSIGNED_SHORT,nt.primitiveOffset*Ve*2)}}}function Ll(w,l,f){const _=1/cn(f,1,l.transform.tileZoom),b=Math.pow(2,f.tileID.overscaledZ),k=f.tileSize*Math.pow(2,l.transform.tileZoom)/b,I=k*(f.tileID.canonical.x+f.tileID.wrap*b),A=k*f.tileID.canonical.y;return{u_image:0,u_texsize:f.imageAtlasTexture.size,u_scale:[_,w.fromScale,w.toScale],u_fade:w.t,u_pixel_coord_upper:[I>>16,A>>16],u_pixel_coord_lower:[65535&I,65535&A]}}const Va=(w,l,f,_)=>{const b=l.style.light,k=b.properties.get("position"),I=[k.x,k.y,k.z],A=function(){var G=new a.A(9);return a.A!=Float32Array&&(G[1]=0,G[2]=0,G[3]=0,G[5]=0,G[6]=0,G[7]=0),G[0]=1,G[4]=1,G[8]=1,G}();b.properties.get("anchor")==="viewport"&&function(G,Y){var te=Math.sin(Y),me=Math.cos(Y);G[0]=me,G[1]=te,G[2]=0,G[3]=-te,G[4]=me,G[5]=0,G[6]=0,G[7]=0,G[8]=1}(A,-l.transform.angle),function(G,Y,te){var me=Y[0],Te=Y[1],ke=Y[2];G[0]=me*te[0]+Te*te[3]+ke*te[6],G[1]=me*te[1]+Te*te[4]+ke*te[7],G[2]=me*te[2]+Te*te[5]+ke*te[8]}(I,I,A);const B=b.properties.get("color");return{u_matrix:w,u_lightpos:I,u_lightintensity:b.properties.get("intensity"),u_lightcolor:[B.r,B.g,B.b],u_vertical_gradient:+f,u_opacity:_}},Bd=(w,l,f,_,b,k,I)=>a.e(Va(w,l,f,_),Ll(k,l,I),{u_height_factor:-Math.pow(2,b.overscaledZ)/I.tileSize/8}),Bh=w=>({u_matrix:w}),El=(w,l,f,_)=>a.e(Bh(w),Ll(f,l,_)),$d=(w,l)=>({u_matrix:w,u_world:l}),$h=(w,l,f,_,b)=>a.e(El(w,l,f,_),{u_world:b}),Od=(w,l,f,_)=>{const b=w.transform;let k,I;if(_.paint.get("circle-pitch-alignment")==="map"){const A=cn(f,1,b.zoom);k=!0,I=[A,A]}else k=!1,I=b.pixelsToGLUnits;return{u_camera_to_center_distance:b.cameraToCenterDistance,u_scale_with_map:+(_.paint.get("circle-pitch-scale")==="map"),u_matrix:w.translatePosMatrix(l.posMatrix,f,_.paint.get("circle-translate"),_.paint.get("circle-translate-anchor")),u_pitch_with_map:+k,u_device_pixel_ratio:w.pixelRatio,u_extrude_scale:I}},Oh=(w,l,f)=>{const _=cn(f,1,l.zoom),b=Math.pow(2,l.zoom-f.tileID.overscaledZ),k=f.tileID.overscaleFactor();return{u_matrix:w,u_camera_to_center_distance:l.cameraToCenterDistance,u_pixels_to_tile_units:_,u_extrude_scale:[l.pixelsToGLUnits[0]/(_*b),l.pixelsToGLUnits[1]/(_*b)],u_overscale_factor:k}},Nh=(w,l,f=1)=>({u_matrix:w,u_color:l,u_overlay:0,u_overlay_scale:f}),Il=w=>({u_matrix:w}),jh=(w,l,f,_)=>({u_matrix:w,u_extrude_scale:cn(l,1,f),u_intensity:_});function Uh(w,l){const f=Math.pow(2,l.canonical.z),_=l.canonical.y;return[new a.Y(0,_/f).toLngLat().lat,new a.Y(0,(_+1)/f).toLngLat().lat]}const Al=(w,l,f,_)=>{const b=w.transform;return{u_matrix:qa(w,l,f,_),u_ratio:1/cn(l,1,b.zoom),u_device_pixel_ratio:w.pixelRatio,u_units_to_pixels:[1/b.pixelsToGLUnits[0],1/b.pixelsToGLUnits[1]]}},Vh=(w,l,f,_,b)=>a.e(Al(w,l,f,b),{u_image:0,u_image_height:_}),Ps=(w,l,f,_,b)=>{const k=w.transform,I=eo(l,k);return{u_matrix:qa(w,l,f,b),u_texsize:l.imageAtlasTexture.size,u_ratio:1/cn(l,1,k.zoom),u_device_pixel_ratio:w.pixelRatio,u_image:0,u_scale:[I,_.fromScale,_.toScale],u_fade:_.t,u_units_to_pixels:[1/k.pixelsToGLUnits[0],1/k.pixelsToGLUnits[1]]}},Pl=(w,l,f,_,b,k)=>{const I=w.lineAtlas,A=eo(l,w.transform),B=f.layout.get("line-cap")==="round",G=I.getDash(_.from,B),Y=I.getDash(_.to,B),te=G.width*b.fromScale,me=Y.width*b.toScale;return a.e(Al(w,l,f,k),{u_patternscale_a:[A/te,-G.height/2],u_patternscale_b:[A/me,-Y.height/2],u_sdfgamma:I.width/(256*Math.min(te,me)*w.pixelRatio)/2,u_image:0,u_tex_y_a:G.y,u_tex_y_b:Y.y,u_mix:b.t})};function eo(w,l){return 1/cn(w,1,l.tileZoom)}function qa(w,l,f,_){return w.translatePosMatrix(_?_.posMatrix:l.tileID.posMatrix,l,f.paint.get("line-translate"),f.paint.get("line-translate-anchor"))}const zl=(w,l,f,_,b)=>{return{u_matrix:w,u_tl_parent:l,u_scale_parent:f,u_buffer_scale:1,u_fade_t:_.mix,u_opacity:_.opacity*b.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:b.paint.get("raster-brightness-min"),u_brightness_high:b.paint.get("raster-brightness-max"),u_saturation_factor:(I=b.paint.get("raster-saturation"),I>0?1-1/(1.001-I):-I),u_contrast_factor:(k=b.paint.get("raster-contrast"),k>0?1/(1-k):1+k),u_spin_weights:Za(b.paint.get("raster-hue-rotate"))};var k,I};function Za(w){w*=Math.PI/180;const l=Math.sin(w),f=Math.cos(w);return[(2*f+1)/3,(-Math.sqrt(3)*l-f+1)/3,(Math.sqrt(3)*l-f+1)/3]}const Ga=(w,l,f,_,b,k,I,A,B,G)=>{const Y=b.transform;return{u_is_size_zoom_constant:+(w==="constant"||w==="source"),u_is_size_feature_constant:+(w==="constant"||w==="camera"),u_size_t:l?l.uSizeT:0,u_size:l?l.uSize:0,u_camera_to_center_distance:Y.cameraToCenterDistance,u_pitch:Y.pitch/360*2*Math.PI,u_rotate_symbol:+f,u_aspect_ratio:Y.width/Y.height,u_fade_change:b.options.fadeDuration?b.symbolFadeChange:1,u_matrix:k,u_label_plane_matrix:I,u_coord_matrix:A,u_is_text:+B,u_pitch_with_map:+_,u_texsize:G,u_texture:0}},Ha=(w,l,f,_,b,k,I,A,B,G,Y)=>{const te=b.transform;return a.e(Ga(w,l,f,_,b,k,I,A,B,G),{u_gamma_scale:_?Math.cos(te._pitch)*te.cameraToCenterDistance:1,u_device_pixel_ratio:b.pixelRatio,u_is_halo:+Y})},Wa=(w,l,f,_,b,k,I,A,B,G)=>a.e(Ha(w,l,f,_,b,k,I,A,!0,B,!0),{u_texsize_icon:G,u_texture_icon:1}),Nd=(w,l,f)=>({u_matrix:w,u_opacity:l,u_color:f}),jd=(w,l,f,_,b,k)=>a.e(function(I,A,B,G){const Y=B.imageManager.getPattern(I.from.toString()),te=B.imageManager.getPattern(I.to.toString()),{width:me,height:Te}=B.imageManager.getPixelSize(),ke=Math.pow(2,G.tileID.overscaledZ),Le=G.tileSize*Math.pow(2,B.transform.tileZoom)/ke,be=Le*(G.tileID.canonical.x+G.tileID.wrap*ke),Re=Le*G.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:Y.tl,u_pattern_br_a:Y.br,u_pattern_tl_b:te.tl,u_pattern_br_b:te.br,u_texsize:[me,Te],u_mix:A.t,u_pattern_size_a:Y.displaySize,u_pattern_size_b:te.displaySize,u_scale_a:A.fromScale,u_scale_b:A.toScale,u_tile_units_to_pixels:1/cn(G,1,B.transform.tileZoom),u_pixel_coord_upper:[be>>16,Re>>16],u_pixel_coord_lower:[65535&be,65535&Re]}}(_,k,f,b),{u_matrix:w,u_opacity:l}),qh={fillExtrusion:(w,l)=>({u_matrix:new a.aI(w,l.u_matrix),u_lightpos:new a.aK(w,l.u_lightpos),u_lightintensity:new a.aH(w,l.u_lightintensity),u_lightcolor:new a.aK(w,l.u_lightcolor),u_vertical_gradient:new a.aH(w,l.u_vertical_gradient),u_opacity:new a.aH(w,l.u_opacity)}),fillExtrusionPattern:(w,l)=>({u_matrix:new a.aI(w,l.u_matrix),u_lightpos:new a.aK(w,l.u_lightpos),u_lightintensity:new a.aH(w,l.u_lightintensity),u_lightcolor:new a.aK(w,l.u_lightcolor),u_vertical_gradient:new a.aH(w,l.u_vertical_gradient),u_height_factor:new a.aH(w,l.u_height_factor),u_image:new a.aG(w,l.u_image),u_texsize:new a.aL(w,l.u_texsize),u_pixel_coord_upper:new a.aL(w,l.u_pixel_coord_upper),u_pixel_coord_lower:new a.aL(w,l.u_pixel_coord_lower),u_scale:new a.aK(w,l.u_scale),u_fade:new a.aH(w,l.u_fade),u_opacity:new a.aH(w,l.u_opacity)}),fill:(w,l)=>({u_matrix:new a.aI(w,l.u_matrix)}),fillPattern:(w,l)=>({u_matrix:new a.aI(w,l.u_matrix),u_image:new a.aG(w,l.u_image),u_texsize:new a.aL(w,l.u_texsize),u_pixel_coord_upper:new a.aL(w,l.u_pixel_coord_upper),u_pixel_coord_lower:new a.aL(w,l.u_pixel_coord_lower),u_scale:new a.aK(w,l.u_scale),u_fade:new a.aH(w,l.u_fade)}),fillOutline:(w,l)=>({u_matrix:new a.aI(w,l.u_matrix),u_world:new a.aL(w,l.u_world)}),fillOutlinePattern:(w,l)=>({u_matrix:new a.aI(w,l.u_matrix),u_world:new a.aL(w,l.u_world),u_image:new a.aG(w,l.u_image),u_texsize:new a.aL(w,l.u_texsize),u_pixel_coord_upper:new a.aL(w,l.u_pixel_coord_upper),u_pixel_coord_lower:new a.aL(w,l.u_pixel_coord_lower),u_scale:new a.aK(w,l.u_scale),u_fade:new a.aH(w,l.u_fade)}),circle:(w,l)=>({u_camera_to_center_distance:new a.aH(w,l.u_camera_to_center_distance),u_scale_with_map:new a.aG(w,l.u_scale_with_map),u_pitch_with_map:new a.aG(w,l.u_pitch_with_map),u_extrude_scale:new a.aL(w,l.u_extrude_scale),u_device_pixel_ratio:new a.aH(w,l.u_device_pixel_ratio),u_matrix:new a.aI(w,l.u_matrix)}),collisionBox:(w,l)=>({u_matrix:new a.aI(w,l.u_matrix),u_camera_to_center_distance:new a.aH(w,l.u_camera_to_center_distance),u_pixels_to_tile_units:new a.aH(w,l.u_pixels_to_tile_units),u_extrude_scale:new a.aL(w,l.u_extrude_scale),u_overscale_factor:new a.aH(w,l.u_overscale_factor)}),collisionCircle:(w,l)=>({u_matrix:new a.aI(w,l.u_matrix),u_inv_matrix:new a.aI(w,l.u_inv_matrix),u_camera_to_center_distance:new a.aH(w,l.u_camera_to_center_distance),u_viewport_size:new a.aL(w,l.u_viewport_size)}),debug:(w,l)=>({u_color:new a.aM(w,l.u_color),u_matrix:new a.aI(w,l.u_matrix),u_overlay:new a.aG(w,l.u_overlay),u_overlay_scale:new a.aH(w,l.u_overlay_scale)}),clippingMask:(w,l)=>({u_matrix:new a.aI(w,l.u_matrix)}),heatmap:(w,l)=>({u_extrude_scale:new a.aH(w,l.u_extrude_scale),u_intensity:new a.aH(w,l.u_intensity),u_matrix:new a.aI(w,l.u_matrix)}),heatmapTexture:(w,l)=>({u_matrix:new a.aI(w,l.u_matrix),u_world:new a.aL(w,l.u_world),u_image:new a.aG(w,l.u_image),u_color_ramp:new a.aG(w,l.u_color_ramp),u_opacity:new a.aH(w,l.u_opacity)}),hillshade:(w,l)=>({u_matrix:new a.aI(w,l.u_matrix),u_image:new a.aG(w,l.u_image),u_latrange:new a.aL(w,l.u_latrange),u_light:new a.aL(w,l.u_light),u_shadow:new a.aM(w,l.u_shadow),u_highlight:new a.aM(w,l.u_highlight),u_accent:new a.aM(w,l.u_accent)}),hillshadePrepare:(w,l)=>({u_matrix:new a.aI(w,l.u_matrix),u_image:new a.aG(w,l.u_image),u_dimension:new a.aL(w,l.u_dimension),u_zoom:new a.aH(w,l.u_zoom),u_unpack:new a.aJ(w,l.u_unpack)}),line:(w,l)=>({u_matrix:new a.aI(w,l.u_matrix),u_ratio:new a.aH(w,l.u_ratio),u_device_pixel_ratio:new a.aH(w,l.u_device_pixel_ratio),u_units_to_pixels:new a.aL(w,l.u_units_to_pixels)}),lineGradient:(w,l)=>({u_matrix:new a.aI(w,l.u_matrix),u_ratio:new a.aH(w,l.u_ratio),u_device_pixel_ratio:new a.aH(w,l.u_device_pixel_ratio),u_units_to_pixels:new a.aL(w,l.u_units_to_pixels),u_image:new a.aG(w,l.u_image),u_image_height:new a.aH(w,l.u_image_height)}),linePattern:(w,l)=>({u_matrix:new a.aI(w,l.u_matrix),u_texsize:new a.aL(w,l.u_texsize),u_ratio:new a.aH(w,l.u_ratio),u_device_pixel_ratio:new a.aH(w,l.u_device_pixel_ratio),u_image:new a.aG(w,l.u_image),u_units_to_pixels:new a.aL(w,l.u_units_to_pixels),u_scale:new a.aK(w,l.u_scale),u_fade:new a.aH(w,l.u_fade)}),lineSDF:(w,l)=>({u_matrix:new a.aI(w,l.u_matrix),u_ratio:new a.aH(w,l.u_ratio),u_device_pixel_ratio:new a.aH(w,l.u_device_pixel_ratio),u_units_to_pixels:new a.aL(w,l.u_units_to_pixels),u_patternscale_a:new a.aL(w,l.u_patternscale_a),u_patternscale_b:new a.aL(w,l.u_patternscale_b),u_sdfgamma:new a.aH(w,l.u_sdfgamma),u_image:new a.aG(w,l.u_image),u_tex_y_a:new a.aH(w,l.u_tex_y_a),u_tex_y_b:new a.aH(w,l.u_tex_y_b),u_mix:new a.aH(w,l.u_mix)}),raster:(w,l)=>({u_matrix:new a.aI(w,l.u_matrix),u_tl_parent:new a.aL(w,l.u_tl_parent),u_scale_parent:new a.aH(w,l.u_scale_parent),u_buffer_scale:new a.aH(w,l.u_buffer_scale),u_fade_t:new a.aH(w,l.u_fade_t),u_opacity:new a.aH(w,l.u_opacity),u_image0:new a.aG(w,l.u_image0),u_image1:new a.aG(w,l.u_image1),u_brightness_low:new a.aH(w,l.u_brightness_low),u_brightness_high:new a.aH(w,l.u_brightness_high),u_saturation_factor:new a.aH(w,l.u_saturation_factor),u_contrast_factor:new a.aH(w,l.u_contrast_factor),u_spin_weights:new a.aK(w,l.u_spin_weights)}),symbolIcon:(w,l)=>({u_is_size_zoom_constant:new a.aG(w,l.u_is_size_zoom_constant),u_is_size_feature_constant:new a.aG(w,l.u_is_size_feature_constant),u_size_t:new a.aH(w,l.u_size_t),u_size:new a.aH(w,l.u_size),u_camera_to_center_distance:new a.aH(w,l.u_camera_to_center_distance),u_pitch:new a.aH(w,l.u_pitch),u_rotate_symbol:new a.aG(w,l.u_rotate_symbol),u_aspect_ratio:new a.aH(w,l.u_aspect_ratio),u_fade_change:new a.aH(w,l.u_fade_change),u_matrix:new a.aI(w,l.u_matrix),u_label_plane_matrix:new a.aI(w,l.u_label_plane_matrix),u_coord_matrix:new a.aI(w,l.u_coord_matrix),u_is_text:new a.aG(w,l.u_is_text),u_pitch_with_map:new a.aG(w,l.u_pitch_with_map),u_texsize:new a.aL(w,l.u_texsize),u_texture:new a.aG(w,l.u_texture)}),symbolSDF:(w,l)=>({u_is_size_zoom_constant:new a.aG(w,l.u_is_size_zoom_constant),u_is_size_feature_constant:new a.aG(w,l.u_is_size_feature_constant),u_size_t:new a.aH(w,l.u_size_t),u_size:new a.aH(w,l.u_size),u_camera_to_center_distance:new a.aH(w,l.u_camera_to_center_distance),u_pitch:new a.aH(w,l.u_pitch),u_rotate_symbol:new a.aG(w,l.u_rotate_symbol),u_aspect_ratio:new a.aH(w,l.u_aspect_ratio),u_fade_change:new a.aH(w,l.u_fade_change),u_matrix:new a.aI(w,l.u_matrix),u_label_plane_matrix:new a.aI(w,l.u_label_plane_matrix),u_coord_matrix:new a.aI(w,l.u_coord_matrix),u_is_text:new a.aG(w,l.u_is_text),u_pitch_with_map:new a.aG(w,l.u_pitch_with_map),u_texsize:new a.aL(w,l.u_texsize),u_texture:new a.aG(w,l.u_texture),u_gamma_scale:new a.aH(w,l.u_gamma_scale),u_device_pixel_ratio:new a.aH(w,l.u_device_pixel_ratio),u_is_halo:new a.aG(w,l.u_is_halo)}),symbolTextAndIcon:(w,l)=>({u_is_size_zoom_constant:new a.aG(w,l.u_is_size_zoom_constant),u_is_size_feature_constant:new a.aG(w,l.u_is_size_feature_constant),u_size_t:new a.aH(w,l.u_size_t),u_size:new a.aH(w,l.u_size),u_camera_to_center_distance:new a.aH(w,l.u_camera_to_center_distance),u_pitch:new a.aH(w,l.u_pitch),u_rotate_symbol:new a.aG(w,l.u_rotate_symbol),u_aspect_ratio:new a.aH(w,l.u_aspect_ratio),u_fade_change:new a.aH(w,l.u_fade_change),u_matrix:new a.aI(w,l.u_matrix),u_label_plane_matrix:new a.aI(w,l.u_label_plane_matrix),u_coord_matrix:new a.aI(w,l.u_coord_matrix),u_is_text:new a.aG(w,l.u_is_text),u_pitch_with_map:new a.aG(w,l.u_pitch_with_map),u_texsize:new a.aL(w,l.u_texsize),u_texsize_icon:new a.aL(w,l.u_texsize_icon),u_texture:new a.aG(w,l.u_texture),u_texture_icon:new a.aG(w,l.u_texture_icon),u_gamma_scale:new a.aH(w,l.u_gamma_scale),u_device_pixel_ratio:new a.aH(w,l.u_device_pixel_ratio),u_is_halo:new a.aG(w,l.u_is_halo)}),background:(w,l)=>({u_matrix:new a.aI(w,l.u_matrix),u_opacity:new a.aH(w,l.u_opacity),u_color:new a.aM(w,l.u_color)}),backgroundPattern:(w,l)=>({u_matrix:new a.aI(w,l.u_matrix),u_opacity:new a.aH(w,l.u_opacity),u_image:new a.aG(w,l.u_image),u_pattern_tl_a:new a.aL(w,l.u_pattern_tl_a),u_pattern_br_a:new a.aL(w,l.u_pattern_br_a),u_pattern_tl_b:new a.aL(w,l.u_pattern_tl_b),u_pattern_br_b:new a.aL(w,l.u_pattern_br_b),u_texsize:new a.aL(w,l.u_texsize),u_mix:new a.aH(w,l.u_mix),u_pattern_size_a:new a.aL(w,l.u_pattern_size_a),u_pattern_size_b:new a.aL(w,l.u_pattern_size_b),u_scale_a:new a.aH(w,l.u_scale_a),u_scale_b:new a.aH(w,l.u_scale_b),u_pixel_coord_upper:new a.aL(w,l.u_pixel_coord_upper),u_pixel_coord_lower:new a.aL(w,l.u_pixel_coord_lower),u_tile_units_to_pixels:new a.aH(w,l.u_tile_units_to_pixels)}),terrain:(w,l)=>({u_matrix:new a.aI(w,l.u_matrix),u_texture:new a.aG(w,l.u_texture),u_ele_delta:new a.aH(w,l.u_ele_delta)}),terrainDepth:(w,l)=>({u_matrix:new a.aI(w,l.u_matrix),u_ele_delta:new a.aH(w,l.u_ele_delta)}),terrainCoords:(w,l)=>({u_matrix:new a.aI(w,l.u_matrix),u_texture:new a.aG(w,l.u_texture),u_terrain_coords_id:new a.aH(w,l.u_terrain_coords_id),u_ele_delta:new a.aH(w,l.u_ele_delta)})};class Ud{constructor(l,f,_){this.context=l;const b=l.gl;this.buffer=b.createBuffer(),this.dynamicDraw=!!_,this.context.unbindVAO(),l.bindElementBuffer.set(this.buffer),b.bufferData(b.ELEMENT_ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||delete f.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(l){const f=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),f.bufferSubData(f.ELEMENT_ARRAY_BUFFER,0,l.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const zs={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Dl{constructor(l,f,_,b){this.length=f.length,this.attributes=_,this.itemSize=f.bytesPerElement,this.dynamicDraw=b,this.context=l;const k=l.gl;this.buffer=k.createBuffer(),l.bindVertexBuffer.set(this.buffer),k.bufferData(k.ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?k.DYNAMIC_DRAW:k.STATIC_DRAW),this.dynamicDraw||delete f.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(l){if(l.length!==this.length)throw new Error(`Length of new data is ${l.length}, which doesn't match current length of ${this.length}`);const f=this.context.gl;this.bind(),f.bufferSubData(f.ARRAY_BUFFER,0,l.arrayBuffer)}enableAttributes(l,f){for(let _=0;_<this.attributes.length;_++){const b=f.attributes[this.attributes[_].name];b!==void 0&&l.enableVertexAttribArray(b)}}setVertexAttribPointers(l,f,_){for(let b=0;b<this.attributes.length;b++){const k=this.attributes[b],I=f.attributes[k.name];I!==void 0&&l.vertexAttribPointer(I,k.components,l[zs[k.type]],!1,this.itemSize,k.offset+this.itemSize*(_||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Li=new WeakMap;function wi(w){var l;if(Li.has(w))return Li.get(w);{const f=(l=w.getParameter(w.VERSION))===null||l===void 0?void 0:l.startsWith("WebGL 2.0");return Li.set(w,f),f}}class Zn{constructor(l){this.gl=l.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(l){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Rl extends Zn{getDefault(){return a.aO.transparent}set(l){const f=this.current;(l.r!==f.r||l.g!==f.g||l.b!==f.b||l.a!==f.a||this.dirty)&&(this.gl.clearColor(l.r,l.g,l.b,l.a),this.current=l,this.dirty=!1)}}class Fl extends Zn{getDefault(){return 1}set(l){(l!==this.current||this.dirty)&&(this.gl.clearDepth(l),this.current=l,this.dirty=!1)}}class Zu extends Zn{getDefault(){return 0}set(l){(l!==this.current||this.dirty)&&(this.gl.clearStencil(l),this.current=l,this.dirty=!1)}}class Gu extends Zn{getDefault(){return[!0,!0,!0,!0]}set(l){const f=this.current;(l[0]!==f[0]||l[1]!==f[1]||l[2]!==f[2]||l[3]!==f[3]||this.dirty)&&(this.gl.colorMask(l[0],l[1],l[2],l[3]),this.current=l,this.dirty=!1)}}class Bl extends Zn{getDefault(){return!0}set(l){(l!==this.current||this.dirty)&&(this.gl.depthMask(l),this.current=l,this.dirty=!1)}}class Hu extends Zn{getDefault(){return 255}set(l){(l!==this.current||this.dirty)&&(this.gl.stencilMask(l),this.current=l,this.dirty=!1)}}class Wu extends Zn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(l){const f=this.current;(l.func!==f.func||l.ref!==f.ref||l.mask!==f.mask||this.dirty)&&(this.gl.stencilFunc(l.func,l.ref,l.mask),this.current=l,this.dirty=!1)}}class $l extends Zn{getDefault(){const l=this.gl;return[l.KEEP,l.KEEP,l.KEEP]}set(l){const f=this.current;(l[0]!==f[0]||l[1]!==f[1]||l[2]!==f[2]||this.dirty)&&(this.gl.stencilOp(l[0],l[1],l[2]),this.current=l,this.dirty=!1)}}class Zh extends Zn{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;l?f.enable(f.STENCIL_TEST):f.disable(f.STENCIL_TEST),this.current=l,this.dirty=!1}}class Gh extends Zn{getDefault(){return[0,1]}set(l){const f=this.current;(l[0]!==f[0]||l[1]!==f[1]||this.dirty)&&(this.gl.depthRange(l[0],l[1]),this.current=l,this.dirty=!1)}}class oa extends Zn{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;l?f.enable(f.DEPTH_TEST):f.disable(f.DEPTH_TEST),this.current=l,this.dirty=!1}}class Vd extends Zn{getDefault(){return this.gl.LESS}set(l){(l!==this.current||this.dirty)&&(this.gl.depthFunc(l),this.current=l,this.dirty=!1)}}class qd extends Zn{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;l?f.enable(f.BLEND):f.disable(f.BLEND),this.current=l,this.dirty=!1}}class Zd extends Zn{getDefault(){const l=this.gl;return[l.ONE,l.ZERO]}set(l){const f=this.current;(l[0]!==f[0]||l[1]!==f[1]||this.dirty)&&(this.gl.blendFunc(l[0],l[1]),this.current=l,this.dirty=!1)}}class Gd extends Zn{getDefault(){return a.aO.transparent}set(l){const f=this.current;(l.r!==f.r||l.g!==f.g||l.b!==f.b||l.a!==f.a||this.dirty)&&(this.gl.blendColor(l.r,l.g,l.b,l.a),this.current=l,this.dirty=!1)}}class Hd extends Zn{getDefault(){return this.gl.FUNC_ADD}set(l){(l!==this.current||this.dirty)&&(this.gl.blendEquation(l),this.current=l,this.dirty=!1)}}class Wd extends Zn{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;l?f.enable(f.CULL_FACE):f.disable(f.CULL_FACE),this.current=l,this.dirty=!1}}class Ku extends Zn{getDefault(){return this.gl.BACK}set(l){(l!==this.current||this.dirty)&&(this.gl.cullFace(l),this.current=l,this.dirty=!1)}}class Ol extends Zn{getDefault(){return this.gl.CCW}set(l){(l!==this.current||this.dirty)&&(this.gl.frontFace(l),this.current=l,this.dirty=!1)}}class Xu extends Zn{getDefault(){return null}set(l){(l!==this.current||this.dirty)&&(this.gl.useProgram(l),this.current=l,this.dirty=!1)}}class Ju extends Zn{getDefault(){return this.gl.TEXTURE0}set(l){(l!==this.current||this.dirty)&&(this.gl.activeTexture(l),this.current=l,this.dirty=!1)}}class sa extends Zn{getDefault(){const l=this.gl;return[0,0,l.drawingBufferWidth,l.drawingBufferHeight]}set(l){const f=this.current;(l[0]!==f[0]||l[1]!==f[1]||l[2]!==f[2]||l[3]!==f[3]||this.dirty)&&(this.gl.viewport(l[0],l[1],l[2],l[3]),this.current=l,this.dirty=!1)}}class Hh extends Zn{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;f.bindFramebuffer(f.FRAMEBUFFER,l),this.current=l,this.dirty=!1}}class Wh extends Zn{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;f.bindRenderbuffer(f.RENDERBUFFER,l),this.current=l,this.dirty=!1}}class Yu extends Zn{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;f.bindTexture(f.TEXTURE_2D,l),this.current=l,this.dirty=!1}}class Ds extends Zn{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;f.bindBuffer(f.ARRAY_BUFFER,l),this.current=l,this.dirty=!1}}class Kh extends Zn{getDefault(){return null}set(l){const f=this.gl;f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,l),this.current=l,this.dirty=!1}}class aa extends Zn{getDefault(){return null}set(l){var f;if(l===this.current&&!this.dirty)return;const _=this.gl;wi(_)?_.bindVertexArray(l):(f=_.getExtension("OES_vertex_array_object"))===null||f===void 0||f.bindVertexArrayOES(l),this.current=l,this.dirty=!1}}class la extends Zn{getDefault(){return 4}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;f.pixelStorei(f.UNPACK_ALIGNMENT,l),this.current=l,this.dirty=!1}}class Xh extends Zn{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;f.pixelStorei(f.UNPACK_PREMULTIPLY_ALPHA_WEBGL,l),this.current=l,this.dirty=!1}}class Qu extends Zn{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;f.pixelStorei(f.UNPACK_FLIP_Y_WEBGL,l),this.current=l,this.dirty=!1}}class Un extends Zn{constructor(l,f){super(l),this.context=l,this.parent=f}getDefault(){return null}}class Nl extends Un{setDirty(){this.dirty=!0}set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const f=this.gl;f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,l,0),this.current=l,this.dirty=!1}}class Kd extends Un{set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const f=this.gl;f.framebufferRenderbuffer(f.FRAMEBUFFER,f.DEPTH_ATTACHMENT,f.RENDERBUFFER,l),this.current=l,this.dirty=!1}}class Jh extends Un{set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const f=this.gl;f.framebufferRenderbuffer(f.FRAMEBUFFER,f.DEPTH_STENCIL_ATTACHMENT,f.RENDERBUFFER,l),this.current=l,this.dirty=!1}}class Ka{constructor(l,f,_,b,k){this.context=l,this.width=f,this.height=_;const I=l.gl,A=this.framebuffer=I.createFramebuffer();if(this.colorAttachment=new Nl(l,A),b)this.depthAttachment=k?new Jh(l,A):new Kd(l,A);else if(k)throw new Error("Stencil cannot be set without depth");if(I.checkFramebufferStatus(I.FRAMEBUFFER)!==I.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const l=this.context.gl,f=this.colorAttachment.get();if(f&&l.deleteTexture(f),this.depthAttachment){const _=this.depthAttachment.get();_&&l.deleteRenderbuffer(_)}l.deleteFramebuffer(this.framebuffer)}}class qr{constructor(l,f,_){this.blendFunction=l,this.blendColor=f,this.mask=_}}qr.Replace=[1,0],qr.disabled=new qr(qr.Replace,a.aO.transparent,[!1,!1,!1,!1]),qr.unblended=new qr(qr.Replace,a.aO.transparent,[!0,!0,!0,!0]),qr.alphaBlended=new qr([1,771],a.aO.transparent,[!0,!0,!0,!0]);class Xd{constructor(l){var f,_;if(this.gl=l,this.clearColor=new Rl(this),this.clearDepth=new Fl(this),this.clearStencil=new Zu(this),this.colorMask=new Gu(this),this.depthMask=new Bl(this),this.stencilMask=new Hu(this),this.stencilFunc=new Wu(this),this.stencilOp=new $l(this),this.stencilTest=new Zh(this),this.depthRange=new Gh(this),this.depthTest=new oa(this),this.depthFunc=new Vd(this),this.blend=new qd(this),this.blendFunc=new Zd(this),this.blendColor=new Gd(this),this.blendEquation=new Hd(this),this.cullFace=new Wd(this),this.cullFaceSide=new Ku(this),this.frontFace=new Ol(this),this.program=new Xu(this),this.activeTexture=new Ju(this),this.viewport=new sa(this),this.bindFramebuffer=new Hh(this),this.bindRenderbuffer=new Wh(this),this.bindTexture=new Yu(this),this.bindVertexBuffer=new Ds(this),this.bindElementBuffer=new Kh(this),this.bindVertexArray=new aa(this),this.pixelStoreUnpack=new la(this),this.pixelStoreUnpackPremultiplyAlpha=new Xh(this),this.pixelStoreUnpackFlipY=new Qu(this),this.extTextureFilterAnisotropic=l.getExtension("EXT_texture_filter_anisotropic")||l.getExtension("MOZ_EXT_texture_filter_anisotropic")||l.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=l.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=l.getParameter(l.MAX_TEXTURE_SIZE),wi(l)){this.HALF_FLOAT=l.HALF_FLOAT;const b=l.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(f=l.RGBA16F)!==null&&f!==void 0?f:b==null?void 0:b.RGBA16F_EXT,this.RGB16F=(_=l.RGB16F)!==null&&_!==void 0?_:b==null?void 0:b.RGB16F_EXT,l.getExtension("EXT_color_buffer_float")}else{l.getExtension("EXT_color_buffer_half_float"),l.getExtension("OES_texture_half_float_linear");const b=l.getExtension("OES_texture_half_float");this.HALF_FLOAT=b==null?void 0:b.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(l,f){return new Ud(this,l,f)}createVertexBuffer(l,f,_){return new Dl(this,l,f,_)}createRenderbuffer(l,f,_){const b=this.gl,k=b.createRenderbuffer();return this.bindRenderbuffer.set(k),b.renderbufferStorage(b.RENDERBUFFER,l,f,_),this.bindRenderbuffer.set(null),k}createFramebuffer(l,f,_,b){return new Ka(this,l,f,_,b)}clear({color:l,depth:f,stencil:_}){const b=this.gl;let k=0;l&&(k|=b.COLOR_BUFFER_BIT,this.clearColor.set(l),this.colorMask.set([!0,!0,!0,!0])),f!==void 0&&(k|=b.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(f),this.depthMask.set(!0)),_!==void 0&&(k|=b.STENCIL_BUFFER_BIT,this.clearStencil.set(_),this.stencilMask.set(255)),b.clear(k)}setCullFace(l){l.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(l.mode),this.frontFace.set(l.frontFace))}setDepthMode(l){l.func!==this.gl.ALWAYS||l.mask?(this.depthTest.set(!0),this.depthFunc.set(l.func),this.depthMask.set(l.mask),this.depthRange.set(l.range)):this.depthTest.set(!1)}setStencilMode(l){l.test.func!==this.gl.ALWAYS||l.mask?(this.stencilTest.set(!0),this.stencilMask.set(l.mask),this.stencilOp.set([l.fail,l.depthFail,l.pass]),this.stencilFunc.set({func:l.test.func,ref:l.ref,mask:l.test.mask})):this.stencilTest.set(!1)}setColorMode(l){a.aD(l.blendFunction,qr.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(l.blendFunction),this.blendColor.set(l.blendColor)),this.colorMask.set(l.mask)}createVertexArray(){var l;return wi(this.gl)?this.gl.createVertexArray():(l=this.gl.getExtension("OES_vertex_array_object"))===null||l===void 0?void 0:l.createVertexArrayOES()}deleteVertexArray(l){var f;return wi(this.gl)?this.gl.deleteVertexArray(l):(f=this.gl.getExtension("OES_vertex_array_object"))===null||f===void 0?void 0:f.deleteVertexArrayOES(l)}unbindVAO(){this.bindVertexArray.set(null)}}class $n{constructor(l,f,_){this.func=l,this.mask=f,this.range=_}}$n.ReadOnly=!1,$n.ReadWrite=!0,$n.disabled=new $n(519,$n.ReadOnly,[0,1]);const ec=7680;class br{constructor(l,f,_,b,k,I){this.test=l,this.ref=f,this.mask=_,this.fail=b,this.depthFail=k,this.pass=I}}br.disabled=new br({func:519,mask:0},0,0,ec,ec,ec);class fr{constructor(l,f,_){this.enable=l,this.mode=f,this.frontFace=_}}let Rs;function jl(w,l,f,_,b,k,I){const A=w.context,B=A.gl,G=w.useProgram("collisionBox"),Y=[];let te=0,me=0;for(let Ie=0;Ie<_.length;Ie++){const Ve=_[Ie],nt=l.getTile(Ve),rt=nt.getBucket(f);if(!rt)continue;let at=Ve.posMatrix;b[0]===0&&b[1]===0||(at=w.translatePosMatrix(Ve.posMatrix,nt,b,k));const yt=I?rt.textCollisionBox:rt.iconCollisionBox,mt=rt.collisionCircleArray;if(mt.length>0){const zt=a.F(),Rt=at;a.aP(zt,rt.placementInvProjMatrix,w.transform.glCoordMatrix),a.aP(zt,zt,rt.placementViewportMatrix),Y.push({circleArray:mt,circleOffset:me,transform:Rt,invTransform:zt,coord:Ve}),te+=mt.length/4,me=te}yt&&G.draw(A,B.LINES,$n.disabled,br.disabled,w.colorModeForRenderPass(),fr.disabled,Oh(at,w.transform,nt),w.style.map.terrain&&w.style.map.terrain.getTerrainData(Ve),f.id,yt.layoutVertexBuffer,yt.indexBuffer,yt.segments,null,w.transform.zoom,null,null,yt.collisionVertexBuffer)}if(!I||!Y.length)return;const Te=w.useProgram("collisionCircle"),ke=new a.aQ;ke.resize(4*te),ke._trim();let Le=0;for(const Ie of Y)for(let Ve=0;Ve<Ie.circleArray.length/4;Ve++){const nt=4*Ve,rt=Ie.circleArray[nt+0],at=Ie.circleArray[nt+1],yt=Ie.circleArray[nt+2],mt=Ie.circleArray[nt+3];ke.emplace(Le++,rt,at,yt,mt,0),ke.emplace(Le++,rt,at,yt,mt,1),ke.emplace(Le++,rt,at,yt,mt,2),ke.emplace(Le++,rt,at,yt,mt,3)}(!Rs||Rs.length<2*te)&&(Rs=function(Ie){const Ve=2*Ie,nt=new a.aS;nt.resize(Ve),nt._trim();for(let rt=0;rt<Ve;rt++){const at=6*rt;nt.uint16[at+0]=4*rt+0,nt.uint16[at+1]=4*rt+1,nt.uint16[at+2]=4*rt+2,nt.uint16[at+3]=4*rt+2,nt.uint16[at+4]=4*rt+3,nt.uint16[at+5]=4*rt+0}return nt}(te));const be=A.createIndexBuffer(Rs,!0),Re=A.createVertexBuffer(ke,a.aR.members,!0);for(const Ie of Y){const Ve={u_matrix:Ie.transform,u_inv_matrix:Ie.invTransform,u_camera_to_center_distance:(et=w.transform).cameraToCenterDistance,u_viewport_size:[et.width,et.height]};Te.draw(A,B.TRIANGLES,$n.disabled,br.disabled,w.colorModeForRenderPass(),fr.disabled,Ve,w.style.map.terrain&&w.style.map.terrain.getTerrainData(Ie.coord),f.id,Re,be,a.$.simpleSegment(0,2*Ie.circleOffset,Ie.circleArray.length,Ie.circleArray.length/2),null,w.transform.zoom,null,null,null)}var et;Re.destroy(),be.destroy()}fr.disabled=new fr(!1,1029,2305),fr.backCCW=new fr(!0,1029,2305);const tc=a.an(new Float32Array(16));function Yh(w,l,f,_,b,k){const{horizontalAlign:I,verticalAlign:A}=a.at(w);return new a.P((-(I-.5)*l/b+_[0])*k,(-(A-.5)*f/b+_[1])*k)}function Ul(w,l,f,_,b,k,I,A,B,G,Y){const te=w.text.placedSymbolArray,me=w.text.dynamicLayoutVertexArray,Te=w.icon.dynamicLayoutVertexArray,ke={};me.clear();for(let Le=0;Le<te.length;Le++){const be=te.get(Le),Re=be.hidden||!be.crossTileID||w.allowVerticalPlacement&&!be.placedOrientation?null:_[be.crossTileID];if(Re){const et=new a.P(be.anchorX,be.anchorY),Ie=er(et,f?I:k,Y),Ve=we(b.cameraToCenterDistance,Ie.signedDistanceFromCamera);let nt=a.ai(w.textSizeData,B,be)*Ve/a.ao;f&&(nt*=w.tilePixelRatio/A);const{width:rt,height:at,anchor:yt,textOffset:mt,textBoxScale:zt}=Re,Rt=Yh(yt,rt,at,mt,zt,nt),wn=f?er(et.add(Rt),k,Y).point:Ie.point.add(l?Rt.rotate(-b.angle):Rt),$t=w.allowVerticalPlacement&&be.placedOrientation===a.ah.vertical?Math.PI/2:0;for(let hn=0;hn<be.numGlyphs;hn++)a.aj(me,wn,$t);G&&be.associatedIconIndex>=0&&(ke[be.associatedIconIndex]={shiftedAnchor:wn,angle:$t})}else tt(be.numGlyphs,me)}if(G){Te.clear();const Le=w.icon.placedSymbolArray;for(let be=0;be<Le.length;be++){const Re=Le.get(be);if(Re.hidden)tt(Re.numGlyphs,Te);else{const et=ke[be];if(et)for(let Ie=0;Ie<Re.numGlyphs;Ie++)a.aj(Te,et.shiftedAnchor,et.angle);else tt(Re.numGlyphs,Te)}}w.icon.dynamicLayoutVertexBuffer.updateData(Te)}w.text.dynamicLayoutVertexBuffer.updateData(me)}function Vl(w,l,f){return f.iconsInText&&l?"symbolTextAndIcon":w?"symbolSDF":"symbolIcon"}function ql(w,l,f,_,b,k,I,A,B,G,Y,te){const me=w.context,Te=me.gl,ke=w.transform,Le=A==="map",be=B==="map",Re=A!=="viewport"&&f.layout.get("symbol-placement")!=="point",et=Le&&!be&&!Re,Ie=!f.layout.get("symbol-sort-key").isConstant();let Ve=!1;const nt=w.depthModeForSublayer(0,$n.ReadOnly),rt=f._unevaluatedLayout.hasValue("text-variable-anchor")||f._unevaluatedLayout.hasValue("text-variable-anchor-offset"),at=[];for(const yt of _){const mt=l.getTile(yt),zt=mt.getBucket(f);if(!zt)continue;const Rt=b?zt.text:zt.icon;if(!Rt||!Rt.segments.get().length||!Rt.hasVisibleVertices)continue;const wn=Rt.programConfigurations.get(f.id),$t=b||zt.sdfIcons,hn=b?zt.textSizeData:zt.iconSizeData,xn=be||ke.pitch!==0,On=w.useProgram(Vl($t,b,zt),wn),bn=a.ag(hn,ke.zoom),Cn=w.style.map.terrain&&w.style.map.terrain.getTerrainData(yt);let zn,Br,rr,to,ii=[0,0],Er=null;if(b)Br=mt.glyphAtlasTexture,rr=Te.LINEAR,zn=mt.glyphAtlasTexture.size,zt.iconsInText&&(ii=mt.imageAtlasTexture.size,Er=mt.imageAtlasTexture,to=xn||w.options.rotating||w.options.zooming||hn.kind==="composite"||hn.kind==="camera"?Te.LINEAR:Te.NEAREST);else{const Xr=f.layout.get("icon-size").constantOr(0)!==1||zt.iconsNeedLinear;Br=mt.imageAtlasTexture,rr=$t||w.options.rotating||w.options.zooming||Xr||xn?Te.LINEAR:Te.NEAREST,zn=mt.imageAtlasTexture.size}const oi=cn(mt,1,w.transform.zoom),no=pn(yt.posMatrix,be,Le,w.transform,oi),Go=Di(yt.posMatrix,be,Le,w.transform,oi),ks=rt&&zt.hasTextData(),ll=f.layout.get("icon-text-fit")!=="none"&&ks&&zt.hasIconData();if(Re){const Xr=w.style.map.terrain?(mo,Jr)=>w.style.map.terrain.getElevation(yt,mo,Jr):null,Ar=f.layout.get("text-rotation-alignment")==="map";se(zt,yt.posMatrix,w,b,no,Go,be,G,Ar,Xr)}const Ss=w.translatePosMatrix(yt.posMatrix,mt,k,I),Ho=Re||b&&rt||ll?tc:no,Kr=w.translatePosMatrix(Go,mt,k,I,!0),Ir=$t&&f.paint.get(b?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Sr;Sr=$t?zt.iconsInText?Wa(hn.kind,bn,et,be,w,Ss,Ho,Kr,zn,ii):Ha(hn.kind,bn,et,be,w,Ss,Ho,Kr,b,zn,!0):Ga(hn.kind,bn,et,be,w,Ss,Ho,Kr,b,zn);const po={program:On,buffers:Rt,uniformValues:Sr,atlasTexture:Br,atlasTextureIcon:Er,atlasInterpolation:rr,atlasInterpolationIcon:to,isSDF:$t,hasHalo:Ir};if(Ie&&zt.canOverlap){Ve=!0;const Xr=Rt.segments.get();for(const Ar of Xr)at.push({segments:new a.$([Ar]),sortKey:Ar.sortKey,state:po,terrainData:Cn})}else at.push({segments:Rt.segments,sortKey:0,state:po,terrainData:Cn})}Ve&&at.sort((yt,mt)=>yt.sortKey-mt.sortKey);for(const yt of at){const mt=yt.state;if(me.activeTexture.set(Te.TEXTURE0),mt.atlasTexture.bind(mt.atlasInterpolation,Te.CLAMP_TO_EDGE),mt.atlasTextureIcon&&(me.activeTexture.set(Te.TEXTURE1),mt.atlasTextureIcon&&mt.atlasTextureIcon.bind(mt.atlasInterpolationIcon,Te.CLAMP_TO_EDGE)),mt.isSDF){const zt=mt.uniformValues;mt.hasHalo&&(zt.u_is_halo=1,Qh(mt.buffers,yt.segments,f,w,mt.program,nt,Y,te,zt,yt.terrainData)),zt.u_is_halo=0}Qh(mt.buffers,yt.segments,f,w,mt.program,nt,Y,te,mt.uniformValues,yt.terrainData)}}function Qh(w,l,f,_,b,k,I,A,B,G){const Y=_.context;b.draw(Y,Y.gl.TRIANGLES,k,I,A,fr.disabled,B,G,f.id,w.layoutVertexBuffer,w.indexBuffer,l,f.paint,_.transform.zoom,w.programConfigurations.get(f.id),w.dynamicLayoutVertexBuffer,w.opacityVertexBuffer)}function Zl(w,l,f,_,b){if(!f||!_||!_.imageAtlas)return;const k=_.imageAtlas.patternPositions;let I=k[f.to.toString()],A=k[f.from.toString()];if(!I&&A&&(I=A),!A&&I&&(A=I),!I||!A){const B=b.getPaintProperty(l);I=k[B],A=k[B]}I&&A&&w.setConstantPatternPositions(I,A)}function ef(w,l,f,_,b,k,I){const A=w.context.gl,B="fill-pattern",G=f.paint.get(B),Y=G&&G.constantOr(1),te=f.getCrossfadeParameters();let me,Te,ke,Le,be;I?(Te=Y&&!f.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",me=A.LINES):(Te=Y?"fillPattern":"fill",me=A.TRIANGLES);const Re=G.constantOr(null);for(const et of _){const Ie=l.getTile(et);if(Y&&!Ie.patternsLoaded())continue;const Ve=Ie.getBucket(f);if(!Ve)continue;const nt=Ve.programConfigurations.get(f.id),rt=w.useProgram(Te,nt),at=w.style.map.terrain&&w.style.map.terrain.getTerrainData(et);Y&&(w.context.activeTexture.set(A.TEXTURE0),Ie.imageAtlasTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),nt.updatePaintBuffers(te)),Zl(nt,B,Re,Ie,f);const yt=at?et:null,mt=w.translatePosMatrix(yt?yt.posMatrix:et.posMatrix,Ie,f.paint.get("fill-translate"),f.paint.get("fill-translate-anchor"));if(I){Le=Ve.indexBuffer2,be=Ve.segments2;const zt=[A.drawingBufferWidth,A.drawingBufferHeight];ke=Te==="fillOutlinePattern"&&Y?$h(mt,w,te,Ie,zt):$d(mt,zt)}else Le=Ve.indexBuffer,be=Ve.segments,ke=Y?El(mt,w,te,Ie):Bh(mt);rt.draw(w.context,me,b,w.stencilModeForClipping(et),k,fr.disabled,ke,at,f.id,Ve.layoutVertexBuffer,Le,be,f.paint,w.transform.zoom,nt)}}function Gl(w,l,f,_,b,k,I){const A=w.context,B=A.gl,G="fill-extrusion-pattern",Y=f.paint.get(G),te=Y.constantOr(1),me=f.getCrossfadeParameters(),Te=f.paint.get("fill-extrusion-opacity"),ke=Y.constantOr(null);for(const Le of _){const be=l.getTile(Le),Re=be.getBucket(f);if(!Re)continue;const et=w.style.map.terrain&&w.style.map.terrain.getTerrainData(Le),Ie=Re.programConfigurations.get(f.id),Ve=w.useProgram(te?"fillExtrusionPattern":"fillExtrusion",Ie);te&&(w.context.activeTexture.set(B.TEXTURE0),be.imageAtlasTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),Ie.updatePaintBuffers(me)),Zl(Ie,G,ke,be,f);const nt=w.translatePosMatrix(Le.posMatrix,be,f.paint.get("fill-extrusion-translate"),f.paint.get("fill-extrusion-translate-anchor")),rt=f.paint.get("fill-extrusion-vertical-gradient"),at=te?Bd(nt,w,rt,Te,Le,me,be):Va(nt,w,rt,Te);Ve.draw(A,A.gl.TRIANGLES,b,k,I,fr.backCCW,at,et,f.id,Re.layoutVertexBuffer,Re.indexBuffer,Re.segments,f.paint,w.transform.zoom,Ie,w.style.map.terrain&&Re.centroidVertexBuffer)}}function Hl(w,l,f,_,b,k,I){const A=w.context,B=A.gl,G=f.fbo;if(!G)return;const Y=w.useProgram("hillshade"),te=w.style.map.terrain&&w.style.map.terrain.getTerrainData(l);A.activeTexture.set(B.TEXTURE0),B.bindTexture(B.TEXTURE_2D,G.colorAttachment.get()),Y.draw(A,B.TRIANGLES,b,k,I,fr.disabled,((me,Te,ke,Le)=>{const be=ke.paint.get("hillshade-shadow-color"),Re=ke.paint.get("hillshade-highlight-color"),et=ke.paint.get("hillshade-accent-color");let Ie=ke.paint.get("hillshade-illumination-direction")*(Math.PI/180);ke.paint.get("hillshade-illumination-anchor")==="viewport"&&(Ie-=me.transform.angle);const Ve=!me.options.moving;return{u_matrix:Le?Le.posMatrix:me.transform.calculatePosMatrix(Te.tileID.toUnwrapped(),Ve),u_image:0,u_latrange:Uh(0,Te.tileID),u_light:[ke.paint.get("hillshade-exaggeration"),Ie],u_shadow:be,u_highlight:Re,u_accent:et}})(w,f,_,te?l:null),te,_.id,w.rasterBoundsBuffer,w.quadTriangleIndexBuffer,w.rasterBoundsSegments)}function nc(w,l,f,_,b,k){const I=w.context,A=I.gl,B=l.dem;if(B&&B.data){const G=B.dim,Y=B.stride,te=B.getPixels();if(I.activeTexture.set(A.TEXTURE1),I.pixelStoreUnpackPremultiplyAlpha.set(!1),l.demTexture=l.demTexture||w.getTileTexture(Y),l.demTexture){const Te=l.demTexture;Te.update(te,{premultiply:!1}),Te.bind(A.NEAREST,A.CLAMP_TO_EDGE)}else l.demTexture=new ne(I,te,A.RGBA,{premultiply:!1}),l.demTexture.bind(A.NEAREST,A.CLAMP_TO_EDGE);I.activeTexture.set(A.TEXTURE0);let me=l.fbo;if(!me){const Te=new ne(I,{width:G,height:G,data:null},A.RGBA);Te.bind(A.LINEAR,A.CLAMP_TO_EDGE),me=l.fbo=I.createFramebuffer(G,G,!0,!1),me.colorAttachment.set(Te.texture)}I.bindFramebuffer.set(me.framebuffer),I.viewport.set([0,0,G,G]),w.useProgram("hillshadePrepare").draw(I,A.TRIANGLES,_,b,k,fr.disabled,((Te,ke)=>{const Le=ke.stride,be=a.F();return a.aN(be,0,a.W,-a.W,0,0,1),a.H(be,be,[0,-a.W,0]),{u_matrix:be,u_image:1,u_dimension:[Le,Le],u_zoom:Te.overscaledZ,u_unpack:ke.getUnpackVector()}})(l.tileID,B),null,f.id,w.rasterBoundsBuffer,w.quadTriangleIndexBuffer,w.rasterBoundsSegments),l.needsHillshadePrepare=!1}}function tf(w,l,f,_,b,k){const I=_.paint.get("raster-fade-duration");if(!k&&I>0){const A=y.now(),B=(A-w.timeAdded)/I,G=l?(A-l.timeAdded)/I:-1,Y=f.getSource(),te=b.coveringZoomLevel({tileSize:Y.tileSize,roundZoom:Y.roundZoom}),me=!l||Math.abs(l.tileID.overscaledZ-te)>Math.abs(w.tileID.overscaledZ-te),Te=me&&w.refreshedUponExpiration?1:a.ac(me?B:1-G,0,1);return w.refreshedUponExpiration&&B>=1&&(w.refreshedUponExpiration=!1),l?{opacity:1,mix:1-Te}:{opacity:Te,mix:0}}return{opacity:1,mix:0}}const nf=new a.aO(1,0,0,1),Wl=new a.aO(0,1,0,1),rc=new a.aO(0,0,1,1),Jd=new a.aO(1,0,1,1),rf=new a.aO(0,1,1,1);function Rr(w,l,f,_){Ei(w,0,l+f/2,w.transform.width,f,_)}function bs(w,l,f,_){Ei(w,l-f/2,0,f,w.transform.height,_)}function Ei(w,l,f,_,b,k){const I=w.context,A=I.gl;A.enable(A.SCISSOR_TEST),A.scissor(l*w.pixelRatio,f*w.pixelRatio,_*w.pixelRatio,b*w.pixelRatio),I.clear({color:k}),A.disable(A.SCISSOR_TEST)}function ic(w,l,f){const _=w.context,b=_.gl,k=f.posMatrix,I=w.useProgram("debug"),A=$n.disabled,B=br.disabled,G=w.colorModeForRenderPass(),Y="$debug",te=w.style.map.terrain&&w.style.map.terrain.getTerrainData(f);_.activeTexture.set(b.TEXTURE0);const me=l.getTileByID(f.key).latestRawTileData,Te=Math.floor((me&&me.byteLength||0)/1024),ke=l.getTile(f).tileSize,Le=512/Math.min(ke,512)*(f.overscaledZ/w.transform.zoom)*.5;let be=f.canonical.toString();f.overscaledZ!==f.canonical.z&&(be+=` => ${f.overscaledZ}`),function(Re,et){Re.initDebugOverlayCanvas();const Ie=Re.debugOverlayCanvas,Ve=Re.context.gl,nt=Re.debugOverlayCanvas.getContext("2d");nt.clearRect(0,0,Ie.width,Ie.height),nt.shadowColor="white",nt.shadowBlur=2,nt.lineWidth=1.5,nt.strokeStyle="white",nt.textBaseline="top",nt.font="bold 36px Open Sans, sans-serif",nt.fillText(et,5,5),nt.strokeText(et,5,5),Re.debugOverlayTexture.update(Ie),Re.debugOverlayTexture.bind(Ve.LINEAR,Ve.CLAMP_TO_EDGE)}(w,`${be} ${Te}kB`),I.draw(_,b.TRIANGLES,A,B,qr.alphaBlended,fr.disabled,Nh(k,a.aO.transparent,Le),null,Y,w.debugBuffer,w.quadTriangleIndexBuffer,w.debugSegments),I.draw(_,b.LINE_STRIP,A,B,G,fr.disabled,Nh(k,a.aO.red),te,Y,w.debugBuffer,w.tileBorderIndexBuffer,w.debugSegments)}function Kl(w,l,f){const _=w.context,b=_.gl,k=w.colorModeForRenderPass(),I=new $n(b.LEQUAL,$n.ReadWrite,w.depthRangeFor3D),A=w.useProgram("terrain"),B=l.getTerrainMesh();_.bindFramebuffer.set(null),_.viewport.set([0,0,w.width,w.height]);for(const G of f){const Y=w.renderToTexture.getTexture(G),te=l.getTerrainData(G.tileID);_.activeTexture.set(b.TEXTURE0),b.bindTexture(b.TEXTURE_2D,Y.texture);const me={u_matrix:w.transform.calculatePosMatrix(G.tileID.toUnwrapped()),u_texture:0,u_ele_delta:l.getMeshFrameDelta(w.transform.zoom)};A.draw(_,b.TRIANGLES,I,br.disabled,k,fr.backCCW,me,te,"terrain",B.vertexBuffer,B.indexBuffer,B.segments)}}class of{constructor(l,f){this.context=new Xd(l),this.transform=f,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:a.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=qn.maxUnderzooming+qn.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new _s}resize(l,f,_){if(this.width=Math.floor(l*_),this.height=Math.floor(f*_),this.pixelRatio=_,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const b of this.style._order)this.style._layers[b].resize()}setup(){const l=this.context,f=new a.aV;f.emplaceBack(0,0),f.emplaceBack(a.W,0),f.emplaceBack(0,a.W),f.emplaceBack(a.W,a.W),this.tileExtentBuffer=l.createVertexBuffer(f,Cl.members),this.tileExtentSegments=a.$.simpleSegment(0,0,4,2);const _=new a.aV;_.emplaceBack(0,0),_.emplaceBack(a.W,0),_.emplaceBack(0,a.W),_.emplaceBack(a.W,a.W),this.debugBuffer=l.createVertexBuffer(_,Cl.members),this.debugSegments=a.$.simpleSegment(0,0,4,5);const b=new a.Z;b.emplaceBack(0,0,0,0),b.emplaceBack(a.W,0,a.W,0),b.emplaceBack(0,a.W,0,a.W),b.emplaceBack(a.W,a.W,a.W,a.W),this.rasterBoundsBuffer=l.createVertexBuffer(b,it.members),this.rasterBoundsSegments=a.$.simpleSegment(0,0,4,2);const k=new a.aV;k.emplaceBack(0,0),k.emplaceBack(1,0),k.emplaceBack(0,1),k.emplaceBack(1,1),this.viewportBuffer=l.createVertexBuffer(k,Cl.members),this.viewportSegments=a.$.simpleSegment(0,0,4,2);const I=new a.aW;I.emplaceBack(0),I.emplaceBack(1),I.emplaceBack(3),I.emplaceBack(2),I.emplaceBack(0),this.tileBorderIndexBuffer=l.createIndexBuffer(I);const A=new a.aX;A.emplaceBack(0,1,2),A.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=l.createIndexBuffer(A);const B=this.context.gl;this.stencilClearMode=new br({func:B.ALWAYS,mask:0},0,255,B.ZERO,B.ZERO,B.ZERO)}clearStencil(){const l=this.context,f=l.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const _=a.F();a.aN(_,0,this.width,this.height,0,0,1),a.J(_,_,[f.drawingBufferWidth,f.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(l,f.TRIANGLES,$n.disabled,this.stencilClearMode,qr.disabled,fr.disabled,Il(_),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(l,f){if(this.currentStencilSource===l.source||!l.isTileClipped()||!f||!f.length)return;this.currentStencilSource=l.source;const _=this.context,b=_.gl;this.nextStencilID+f.length>256&&this.clearStencil(),_.setColorMode(qr.disabled),_.setDepthMode($n.disabled);const k=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const I of f){const A=this._tileClippingMaskIDs[I.key]=this.nextStencilID++,B=this.style.map.terrain&&this.style.map.terrain.getTerrainData(I);k.draw(_,b.TRIANGLES,$n.disabled,new br({func:b.ALWAYS,mask:0},A,255,b.KEEP,b.KEEP,b.REPLACE),qr.disabled,fr.disabled,Il(I.posMatrix),B,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const l=this.nextStencilID++,f=this.context.gl;return new br({func:f.NOTEQUAL,mask:255},l,255,f.KEEP,f.KEEP,f.REPLACE)}stencilModeForClipping(l){const f=this.context.gl;return new br({func:f.EQUAL,mask:255},this._tileClippingMaskIDs[l.key],0,f.KEEP,f.KEEP,f.REPLACE)}stencilConfigForOverlap(l){const f=this.context.gl,_=l.sort((I,A)=>A.overscaledZ-I.overscaledZ),b=_[_.length-1].overscaledZ,k=_[0].overscaledZ-b+1;if(k>1){this.currentStencilSource=void 0,this.nextStencilID+k>256&&this.clearStencil();const I={};for(let A=0;A<k;A++)I[A+b]=new br({func:f.GEQUAL,mask:255},A+this.nextStencilID,255,f.KEEP,f.KEEP,f.REPLACE);return this.nextStencilID+=k,[I,_]}return[{[b]:br.disabled},_]}colorModeForRenderPass(){const l=this.context.gl;return this._showOverdrawInspector?new qr([l.CONSTANT_COLOR,l.ONE],new a.aO(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?qr.unblended:qr.alphaBlended}depthModeForSublayer(l,f,_){if(!this.opaquePassEnabledForLayer())return $n.disabled;const b=1-((1+this.currentLayer)*this.numSublayers+l)*this.depthEpsilon;return new $n(_||this.context.gl.LEQUAL,f,[b,b])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(l,f){this.style=l,this.options=f,this.lineAtlas=l.lineAtlas,this.imageManager=l.imageManager,this.glyphManager=l.glyphManager,this.symbolFadeChange=l.placement.symbolFadeChange(y.now()),this.imageManager.beginFrame();const _=this.style._order,b=this.style.sourceCaches,k={},I={},A={};for(const B in b){const G=b[B];G.used&&G.prepare(this.context),k[B]=G.getVisibleCoordinates(),I[B]=k[B].slice().reverse(),A[B]=G.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let B=0;B<_.length;B++)if(this.style._layers[_[B]].is3D()){this.opaquePassCutoff=B;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const B of _){const G=this.style._layers[B];if(!G.hasOffscreenPass()||G.isHidden(this.transform.zoom))continue;const Y=I[G.source];(G.type==="custom"||Y.length)&&this.renderLayer(this,b[G.source],G,Y)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:f.showOverdrawInspector?a.aO.black:a.aO.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=f.showOverdrawInspector,this.depthRangeFor3D=[0,1-(l._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=_.length-1;this.currentLayer>=0;this.currentLayer--){const B=this.style._layers[_[this.currentLayer]],G=b[B.source],Y=k[B.source];this._renderTileClippingMasks(B,Y),this.renderLayer(this,G,B,Y)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<_.length;this.currentLayer++){const B=this.style._layers[_[this.currentLayer]],G=b[B.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(B))continue;const Y=(B.type==="symbol"?A:I)[B.source];this._renderTileClippingMasks(B,k[B.source]),this.renderLayer(this,G,B,Y)}if(this.options.showTileBoundaries){const B=function(G,Y){let te=null;const me=Object.values(G._layers).flatMap(be=>be.source&&!be.isHidden(Y)?[G.sourceCaches[be.source]]:[]),Te=me.filter(be=>be.getSource().type==="vector"),ke=me.filter(be=>be.getSource().type!=="vector"),Le=be=>{(!te||te.getSource().maxzoom<be.getSource().maxzoom)&&(te=be)};return Te.forEach(be=>Le(be)),te||ke.forEach(be=>Le(be)),te}(this.style,this.transform.zoom);B&&function(G,Y,te){for(let me=0;me<te.length;me++)ic(G,Y,te[me])}(this,B,B.getVisibleCoordinates())}this.options.showPadding&&function(B){const G=B.transform.padding;Rr(B,B.transform.height-(G.top||0),3,nf),Rr(B,G.bottom||0,3,Wl),bs(B,G.left||0,3,rc),bs(B,B.transform.width-(G.right||0),3,Jd);const Y=B.transform.centerPoint;(function(te,me,Te,ke){Ei(te,me-1,Te-10,2,20,ke),Ei(te,me-10,Te-1,20,2,ke)})(B,Y.x,B.transform.height-Y.y,rf)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(l){if(!this.style||!this.style.map||!this.style.map.terrain)return;const f=this.terrainFacilitator.matrix,_=this.transform.projMatrix;let b=this.terrainFacilitator.dirty;b||(b=l?!a.aY(f,_):!a.aZ(f,_)),b||(b=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),b&&(a.a_(f,_),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(k,I){const A=k.context,B=A.gl,G=qr.unblended,Y=new $n(B.LEQUAL,$n.ReadWrite,[0,1]),te=I.getTerrainMesh(),me=I.sourceCache.getRenderableTiles(),Te=k.useProgram("terrainDepth");A.bindFramebuffer.set(I.getFramebuffer("depth").framebuffer),A.viewport.set([0,0,k.width/devicePixelRatio,k.height/devicePixelRatio]),A.clear({color:a.aO.transparent,depth:1});for(const ke of me){const Le=I.getTerrainData(ke.tileID),be={u_matrix:k.transform.calculatePosMatrix(ke.tileID.toUnwrapped()),u_ele_delta:I.getMeshFrameDelta(k.transform.zoom)};Te.draw(A,B.TRIANGLES,Y,br.disabled,G,fr.backCCW,be,Le,"terrain",te.vertexBuffer,te.indexBuffer,te.segments)}A.bindFramebuffer.set(null),A.viewport.set([0,0,k.width,k.height])}(this,this.style.map.terrain),function(k,I){const A=k.context,B=A.gl,G=qr.unblended,Y=new $n(B.LEQUAL,$n.ReadWrite,[0,1]),te=I.getTerrainMesh(),me=I.getCoordsTexture(),Te=I.sourceCache.getRenderableTiles(),ke=k.useProgram("terrainCoords");A.bindFramebuffer.set(I.getFramebuffer("coords").framebuffer),A.viewport.set([0,0,k.width/devicePixelRatio,k.height/devicePixelRatio]),A.clear({color:a.aO.transparent,depth:1}),I.coordsIndex=[];for(const Le of Te){const be=I.getTerrainData(Le.tileID);A.activeTexture.set(B.TEXTURE0),B.bindTexture(B.TEXTURE_2D,me.texture);const Re={u_matrix:k.transform.calculatePosMatrix(Le.tileID.toUnwrapped()),u_terrain_coords_id:(255-I.coordsIndex.length)/255,u_texture:0,u_ele_delta:I.getMeshFrameDelta(k.transform.zoom)};ke.draw(A,B.TRIANGLES,Y,br.disabled,G,fr.backCCW,Re,be,"terrain",te.vertexBuffer,te.indexBuffer,te.segments),I.coordsIndex.push(Le.tileID.key)}A.bindFramebuffer.set(null),A.viewport.set([0,0,k.width,k.height])}(this,this.style.map.terrain))}renderLayer(l,f,_,b){if(!_.isHidden(this.transform.zoom)&&(_.type==="background"||_.type==="custom"||(b||[]).length))switch(this.id=_.id,_.type){case"symbol":(function(k,I,A,B,G){if(k.renderPass!=="translucent")return;const Y=br.disabled,te=k.colorModeForRenderPass();(A._unevaluatedLayout.hasValue("text-variable-anchor")||A._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(me,Te,ke,Le,be,Re,et){const Ie=Te.transform,Ve=be==="map",nt=Re==="map";for(const rt of me){const at=Le.getTile(rt),yt=at.getBucket(ke);if(!yt||!yt.text||!yt.text.segments.get().length)continue;const mt=a.ag(yt.textSizeData,Ie.zoom),zt=cn(at,1,Te.transform.zoom),Rt=pn(rt.posMatrix,nt,Ve,Te.transform,zt),wn=ke.layout.get("icon-text-fit")!=="none"&&yt.hasIconData();if(mt){const $t=Math.pow(2,Ie.zoom-at.tileID.overscaledZ);Ul(yt,Ve,nt,et,Ie,Rt,rt.posMatrix,$t,mt,wn,Te.style.map.terrain?(hn,xn)=>Te.style.map.terrain.getElevation(rt,hn,xn):null)}}}(B,k,A,I,A.layout.get("text-rotation-alignment"),A.layout.get("text-pitch-alignment"),G),A.paint.get("icon-opacity").constantOr(1)!==0&&ql(k,I,A,B,!1,A.paint.get("icon-translate"),A.paint.get("icon-translate-anchor"),A.layout.get("icon-rotation-alignment"),A.layout.get("icon-pitch-alignment"),A.layout.get("icon-keep-upright"),Y,te),A.paint.get("text-opacity").constantOr(1)!==0&&ql(k,I,A,B,!0,A.paint.get("text-translate"),A.paint.get("text-translate-anchor"),A.layout.get("text-rotation-alignment"),A.layout.get("text-pitch-alignment"),A.layout.get("text-keep-upright"),Y,te),I.map.showCollisionBoxes&&(jl(k,I,A,B,A.paint.get("text-translate"),A.paint.get("text-translate-anchor"),!0),jl(k,I,A,B,A.paint.get("icon-translate"),A.paint.get("icon-translate-anchor"),!1))})(l,f,_,b,this.style.placement.variableOffsets);break;case"circle":(function(k,I,A,B){if(k.renderPass!=="translucent")return;const G=A.paint.get("circle-opacity"),Y=A.paint.get("circle-stroke-width"),te=A.paint.get("circle-stroke-opacity"),me=!A.layout.get("circle-sort-key").isConstant();if(G.constantOr(1)===0&&(Y.constantOr(1)===0||te.constantOr(1)===0))return;const Te=k.context,ke=Te.gl,Le=k.depthModeForSublayer(0,$n.ReadOnly),be=br.disabled,Re=k.colorModeForRenderPass(),et=[];for(let Ie=0;Ie<B.length;Ie++){const Ve=B[Ie],nt=I.getTile(Ve),rt=nt.getBucket(A);if(!rt)continue;const at=rt.programConfigurations.get(A.id),yt=k.useProgram("circle",at),mt=rt.layoutVertexBuffer,zt=rt.indexBuffer,Rt=k.style.map.terrain&&k.style.map.terrain.getTerrainData(Ve),wn={programConfiguration:at,program:yt,layoutVertexBuffer:mt,indexBuffer:zt,uniformValues:Od(k,Ve,nt,A),terrainData:Rt};if(me){const $t=rt.segments.get();for(const hn of $t)et.push({segments:new a.$([hn]),sortKey:hn.sortKey,state:wn})}else et.push({segments:rt.segments,sortKey:0,state:wn})}me&&et.sort((Ie,Ve)=>Ie.sortKey-Ve.sortKey);for(const Ie of et){const{programConfiguration:Ve,program:nt,layoutVertexBuffer:rt,indexBuffer:at,uniformValues:yt,terrainData:mt}=Ie.state;nt.draw(Te,ke.TRIANGLES,Le,be,Re,fr.disabled,yt,mt,A.id,rt,at,Ie.segments,A.paint,k.transform.zoom,Ve)}})(l,f,_,b);break;case"heatmap":(function(k,I,A,B){if(A.paint.get("heatmap-opacity")!==0)if(k.renderPass==="offscreen"){const G=k.context,Y=G.gl,te=br.disabled,me=new qr([Y.ONE,Y.ONE],a.aO.transparent,[!0,!0,!0,!0]);(function(Te,ke,Le){const be=Te.gl;Te.activeTexture.set(be.TEXTURE1),Te.viewport.set([0,0,ke.width/4,ke.height/4]);let Re=Le.heatmapFbo;if(Re)be.bindTexture(be.TEXTURE_2D,Re.colorAttachment.get()),Te.bindFramebuffer.set(Re.framebuffer);else{const et=be.createTexture();be.bindTexture(be.TEXTURE_2D,et),be.texParameteri(be.TEXTURE_2D,be.TEXTURE_WRAP_S,be.CLAMP_TO_EDGE),be.texParameteri(be.TEXTURE_2D,be.TEXTURE_WRAP_T,be.CLAMP_TO_EDGE),be.texParameteri(be.TEXTURE_2D,be.TEXTURE_MIN_FILTER,be.LINEAR),be.texParameteri(be.TEXTURE_2D,be.TEXTURE_MAG_FILTER,be.LINEAR),Re=Le.heatmapFbo=Te.createFramebuffer(ke.width/4,ke.height/4,!1,!1),function(Ie,Ve,nt,rt){var at,yt;const mt=Ie.gl,zt=(at=Ie.HALF_FLOAT)!==null&&at!==void 0?at:mt.UNSIGNED_BYTE,Rt=(yt=Ie.RGBA16F)!==null&&yt!==void 0?yt:mt.RGBA;mt.texImage2D(mt.TEXTURE_2D,0,Rt,Ve.width/4,Ve.height/4,0,mt.RGBA,zt,null),rt.colorAttachment.set(nt)}(Te,ke,et,Re)}})(G,k,A),G.clear({color:a.aO.transparent});for(let Te=0;Te<B.length;Te++){const ke=B[Te];if(I.hasRenderableParent(ke))continue;const Le=I.getTile(ke),be=Le.getBucket(A);if(!be)continue;const Re=be.programConfigurations.get(A.id),et=k.useProgram("heatmap",Re),{zoom:Ie}=k.transform;et.draw(G,Y.TRIANGLES,$n.disabled,te,me,fr.disabled,jh(ke.posMatrix,Le,Ie,A.paint.get("heatmap-intensity")),null,A.id,be.layoutVertexBuffer,be.indexBuffer,be.segments,A.paint,k.transform.zoom,Re)}G.viewport.set([0,0,k.width,k.height])}else k.renderPass==="translucent"&&(k.context.setColorMode(k.colorModeForRenderPass()),function(G,Y){const te=G.context,me=te.gl,Te=Y.heatmapFbo;if(!Te)return;te.activeTexture.set(me.TEXTURE0),me.bindTexture(me.TEXTURE_2D,Te.colorAttachment.get()),te.activeTexture.set(me.TEXTURE1);let ke=Y.colorRampTexture;ke||(ke=Y.colorRampTexture=new ne(te,Y.colorRamp,me.RGBA)),ke.bind(me.LINEAR,me.CLAMP_TO_EDGE),G.useProgram("heatmapTexture").draw(te,me.TRIANGLES,$n.disabled,br.disabled,G.colorModeForRenderPass(),fr.disabled,((Le,be,Re,et)=>{const Ie=a.F();a.aN(Ie,0,Le.width,Le.height,0,0,1);const Ve=Le.context.gl;return{u_matrix:Ie,u_world:[Ve.drawingBufferWidth,Ve.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:be.paint.get("heatmap-opacity")}})(G,Y),null,Y.id,G.viewportBuffer,G.quadTriangleIndexBuffer,G.viewportSegments,Y.paint,G.transform.zoom)}(k,A))})(l,f,_,b);break;case"line":(function(k,I,A,B){if(k.renderPass!=="translucent")return;const G=A.paint.get("line-opacity"),Y=A.paint.get("line-width");if(G.constantOr(1)===0||Y.constantOr(1)===0)return;const te=k.depthModeForSublayer(0,$n.ReadOnly),me=k.colorModeForRenderPass(),Te=A.paint.get("line-dasharray"),ke=A.paint.get("line-pattern"),Le=ke.constantOr(1),be=A.paint.get("line-gradient"),Re=A.getCrossfadeParameters(),et=Le?"linePattern":Te?"lineSDF":be?"lineGradient":"line",Ie=k.context,Ve=Ie.gl;let nt=!0;for(const rt of B){const at=I.getTile(rt);if(Le&&!at.patternsLoaded())continue;const yt=at.getBucket(A);if(!yt)continue;const mt=yt.programConfigurations.get(A.id),zt=k.context.program.get(),Rt=k.useProgram(et,mt),wn=nt||Rt.program!==zt,$t=k.style.map.terrain&&k.style.map.terrain.getTerrainData(rt),hn=ke.constantOr(null);if(hn&&at.imageAtlas){const bn=at.imageAtlas,Cn=bn.patternPositions[hn.to.toString()],zn=bn.patternPositions[hn.from.toString()];Cn&&zn&&mt.setConstantPatternPositions(Cn,zn)}const xn=$t?rt:null,On=Le?Ps(k,at,A,Re,xn):Te?Pl(k,at,A,Te,Re,xn):be?Vh(k,at,A,yt.lineClipsArray.length,xn):Al(k,at,A,xn);if(Le)Ie.activeTexture.set(Ve.TEXTURE0),at.imageAtlasTexture.bind(Ve.LINEAR,Ve.CLAMP_TO_EDGE),mt.updatePaintBuffers(Re);else if(Te&&(wn||k.lineAtlas.dirty))Ie.activeTexture.set(Ve.TEXTURE0),k.lineAtlas.bind(Ie);else if(be){const bn=yt.gradients[A.id];let Cn=bn.texture;if(A.gradientVersion!==bn.version){let zn=256;if(A.stepInterpolant){const Br=I.getSource().maxzoom,rr=rt.canonical.z===Br?Math.ceil(1<<k.transform.maxZoom-rt.canonical.z):1;zn=a.ac(a.aT(yt.maxLineLength/a.W*1024*rr),256,Ie.maxTextureSize)}bn.gradient=a.aU({expression:A.gradientExpression(),evaluationKey:"lineProgress",resolution:zn,image:bn.gradient||void 0,clips:yt.lineClipsArray}),bn.texture?bn.texture.update(bn.gradient):bn.texture=new ne(Ie,bn.gradient,Ve.RGBA),bn.version=A.gradientVersion,Cn=bn.texture}Ie.activeTexture.set(Ve.TEXTURE0),Cn.bind(A.stepInterpolant?Ve.NEAREST:Ve.LINEAR,Ve.CLAMP_TO_EDGE)}Rt.draw(Ie,Ve.TRIANGLES,te,k.stencilModeForClipping(rt),me,fr.disabled,On,$t,A.id,yt.layoutVertexBuffer,yt.indexBuffer,yt.segments,A.paint,k.transform.zoom,mt,yt.layoutVertexBuffer2),nt=!1}})(l,f,_,b);break;case"fill":(function(k,I,A,B){const G=A.paint.get("fill-color"),Y=A.paint.get("fill-opacity");if(Y.constantOr(1)===0)return;const te=k.colorModeForRenderPass(),me=A.paint.get("fill-pattern"),Te=k.opaquePassEnabledForLayer()&&!me.constantOr(1)&&G.constantOr(a.aO.transparent).a===1&&Y.constantOr(0)===1?"opaque":"translucent";if(k.renderPass===Te){const ke=k.depthModeForSublayer(1,k.renderPass==="opaque"?$n.ReadWrite:$n.ReadOnly);ef(k,I,A,B,ke,te,!1)}if(k.renderPass==="translucent"&&A.paint.get("fill-antialias")){const ke=k.depthModeForSublayer(A.getPaintProperty("fill-outline-color")?2:0,$n.ReadOnly);ef(k,I,A,B,ke,te,!0)}})(l,f,_,b);break;case"fill-extrusion":(function(k,I,A,B){const G=A.paint.get("fill-extrusion-opacity");if(G!==0&&k.renderPass==="translucent"){const Y=new $n(k.context.gl.LEQUAL,$n.ReadWrite,k.depthRangeFor3D);if(G!==1||A.paint.get("fill-extrusion-pattern").constantOr(1))Gl(k,I,A,B,Y,br.disabled,qr.disabled),Gl(k,I,A,B,Y,k.stencilModeFor3D(),k.colorModeForRenderPass());else{const te=k.colorModeForRenderPass();Gl(k,I,A,B,Y,br.disabled,te)}}})(l,f,_,b);break;case"hillshade":(function(k,I,A,B){if(k.renderPass!=="offscreen"&&k.renderPass!=="translucent")return;const G=k.context,Y=k.depthModeForSublayer(0,$n.ReadOnly),te=k.colorModeForRenderPass(),[me,Te]=k.renderPass==="translucent"?k.stencilConfigForOverlap(B):[{},B];for(const ke of Te){const Le=I.getTile(ke);Le.needsHillshadePrepare!==void 0&&Le.needsHillshadePrepare&&k.renderPass==="offscreen"?nc(k,Le,A,Y,br.disabled,te):k.renderPass==="translucent"&&Hl(k,ke,Le,A,Y,me[ke.overscaledZ],te)}G.viewport.set([0,0,k.width,k.height])})(l,f,_,b);break;case"raster":(function(k,I,A,B){if(k.renderPass!=="translucent"||A.paint.get("raster-opacity")===0||!B.length)return;const G=k.context,Y=G.gl,te=I.getSource(),me=k.useProgram("raster"),Te=k.colorModeForRenderPass(),[ke,Le]=te instanceof Wt?[{},B]:k.stencilConfigForOverlap(B),be=Le[Le.length-1].overscaledZ,Re=!k.options.moving;for(const et of Le){const Ie=k.depthModeForSublayer(et.overscaledZ-be,A.paint.get("raster-opacity")===1?$n.ReadWrite:$n.ReadOnly,Y.LESS),Ve=I.getTile(et);Ve.registerFadeDuration(A.paint.get("raster-fade-duration"));const nt=I.findLoadedParent(et,0),rt=tf(Ve,nt,I,A,k.transform,k.style.map.terrain);let at,yt;const mt=A.paint.get("raster-resampling")==="nearest"?Y.NEAREST:Y.LINEAR;G.activeTexture.set(Y.TEXTURE0),Ve.texture.bind(mt,Y.CLAMP_TO_EDGE,Y.LINEAR_MIPMAP_NEAREST),G.activeTexture.set(Y.TEXTURE1),nt?(nt.texture.bind(mt,Y.CLAMP_TO_EDGE,Y.LINEAR_MIPMAP_NEAREST),at=Math.pow(2,nt.tileID.overscaledZ-Ve.tileID.overscaledZ),yt=[Ve.tileID.canonical.x*at%1,Ve.tileID.canonical.y*at%1]):Ve.texture.bind(mt,Y.CLAMP_TO_EDGE,Y.LINEAR_MIPMAP_NEAREST);const zt=k.style.map.terrain&&k.style.map.terrain.getTerrainData(et),Rt=zt?et:null,wn=Rt?Rt.posMatrix:k.transform.calculatePosMatrix(et.toUnwrapped(),Re),$t=zl(wn,yt||[0,0],at||1,rt,A);te instanceof Wt?me.draw(G,Y.TRIANGLES,Ie,br.disabled,Te,fr.disabled,$t,zt,A.id,te.boundsBuffer,k.quadTriangleIndexBuffer,te.boundsSegments):me.draw(G,Y.TRIANGLES,Ie,ke[et.overscaledZ],Te,fr.disabled,$t,zt,A.id,k.rasterBoundsBuffer,k.quadTriangleIndexBuffer,k.rasterBoundsSegments)}})(l,f,_,b);break;case"background":(function(k,I,A,B){const G=A.paint.get("background-color"),Y=A.paint.get("background-opacity");if(Y===0)return;const te=k.context,me=te.gl,Te=k.transform,ke=Te.tileSize,Le=A.paint.get("background-pattern");if(k.isPatternMissing(Le))return;const be=!Le&&G.a===1&&Y===1&&k.opaquePassEnabledForLayer()?"opaque":"translucent";if(k.renderPass!==be)return;const Re=br.disabled,et=k.depthModeForSublayer(0,be==="opaque"?$n.ReadWrite:$n.ReadOnly),Ie=k.colorModeForRenderPass(),Ve=k.useProgram(Le?"backgroundPattern":"background"),nt=B||Te.coveringTiles({tileSize:ke,terrain:k.style.map.terrain});Le&&(te.activeTexture.set(me.TEXTURE0),k.imageManager.bind(k.context));const rt=A.getCrossfadeParameters();for(const at of nt){const yt=B?at.posMatrix:k.transform.calculatePosMatrix(at.toUnwrapped()),mt=Le?jd(yt,Y,k,Le,{tileID:at,tileSize:ke},rt):Nd(yt,Y,G),zt=k.style.map.terrain&&k.style.map.terrain.getTerrainData(at);Ve.draw(te,me.TRIANGLES,et,Re,Ie,fr.disabled,mt,zt,A.id,k.tileExtentBuffer,k.quadTriangleIndexBuffer,k.tileExtentSegments)}})(l,0,_,b);break;case"custom":(function(k,I,A){const B=k.context,G=A.implementation;if(k.renderPass==="offscreen"){const Y=G.prerender;Y&&(k.setCustomLayerDefaults(),B.setColorMode(k.colorModeForRenderPass()),Y.call(G,B.gl,k.transform.customLayerMatrix()),B.setDirty(),k.setBaseState())}else if(k.renderPass==="translucent"){k.setCustomLayerDefaults(),B.setColorMode(k.colorModeForRenderPass()),B.setStencilMode(br.disabled);const Y=G.renderingMode==="3d"?new $n(k.context.gl.LEQUAL,$n.ReadWrite,k.depthRangeFor3D):k.depthModeForSublayer(0,$n.ReadOnly);B.setDepthMode(Y),G.render(B.gl,k.transform.customLayerMatrix()),B.setDirty(),k.setBaseState(),B.bindFramebuffer.set(null)}})(l,0,_)}}translatePosMatrix(l,f,_,b,k){if(!_[0]&&!_[1])return l;const I=k?b==="map"?this.transform.angle:0:b==="viewport"?-this.transform.angle:0;if(I){const G=Math.sin(I),Y=Math.cos(I);_=[_[0]*Y-_[1]*G,_[0]*G+_[1]*Y]}const A=[k?_[0]:cn(f,_[0],this.transform.zoom),k?_[1]:cn(f,_[1],this.transform.zoom),0],B=new Float32Array(16);return a.H(B,l,A),B}saveTileTexture(l){const f=this._tileTextures[l.size[0]];f?f.push(l):this._tileTextures[l.size[0]]=[l]}getTileTexture(l){const f=this._tileTextures[l];return f&&f.length>0?f.pop():null}isPatternMissing(l){if(!l)return!1;if(!l.from||!l.to)return!0;const f=this.imageManager.getPattern(l.from.toString()),_=this.imageManager.getPattern(l.to.toString());return!f||!_}useProgram(l,f){this.cache=this.cache||{};const _=l+(f?f.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[_]||(this.cache[_]=new ys(this.context,Ua[l],f,qh[l],this._showOverdrawInspector,this.style.map.terrain)),this.cache[_]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const l=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(l.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new ne(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:l,drawingBufferHeight:f}=this.context.gl;return this.width!==l||this.height!==f}}class vs{constructor(l,f){this.points=l,this.planes=f}static fromInvProjectionMatrix(l,f,_){const b=Math.pow(2,_),k=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(A=>{const B=1/(A=a.af([],A,l))[3]/f*b;return a.a$(A,A,[B,B,1/A[3],B])}),I=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(A=>{const B=function(me,Te){var ke=Te[0],Le=Te[1],be=Te[2],Re=ke*ke+Le*Le+be*be;return Re>0&&(Re=1/Math.sqrt(Re)),me[0]=Te[0]*Re,me[1]=Te[1]*Re,me[2]=Te[2]*Re,me}([],function(me,Te,ke){var Le=Te[0],be=Te[1],Re=Te[2],et=ke[0],Ie=ke[1],Ve=ke[2];return me[0]=be*Ve-Re*Ie,me[1]=Re*et-Le*Ve,me[2]=Le*Ie-be*et,me}([],J([],k[A[0]],k[A[1]]),J([],k[A[2]],k[A[1]]))),G=-((Y=B)[0]*(te=k[A[1]])[0]+Y[1]*te[1]+Y[2]*te[2]);var Y,te;return B.concat(G)});return new vs(k,I)}}class ws{constructor(l,f){this.min=l,this.max=f,this.center=function(_,b,k){return _[0]=.5*b[0],_[1]=.5*b[1],_[2]=.5*b[2],_}([],function(_,b,k){return _[0]=b[0]+k[0],_[1]=b[1]+k[1],_[2]=b[2]+k[2],_}([],this.min,this.max))}quadrant(l){const f=[l%2==0,l<2],_=ee(this.min),b=ee(this.max);for(let k=0;k<f.length;k++)_[k]=f[k]?this.min[k]:this.center[k],b[k]=f[k]?this.center[k]:this.max[k];return b[2]=this.max[2],new ws(_,b)}distanceX(l){return Math.max(Math.min(this.max[0],l[0]),this.min[0])-l[0]}distanceY(l){return Math.max(Math.min(this.max[1],l[1]),this.min[1])-l[1]}intersects(l){const f=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let _=!0;for(let b=0;b<l.planes.length;b++){const k=l.planes[b];let I=0;for(let A=0;A<f.length;A++)a.b0(k,f[A])>=0&&I++;if(I===0)return 0;I!==f.length&&(_=!1)}if(_)return 2;for(let b=0;b<3;b++){let k=Number.MAX_VALUE,I=-Number.MAX_VALUE;for(let A=0;A<l.points.length;A++){const B=l.points[A][b]-this.min[b];k=Math.min(k,B),I=Math.max(I,B)}if(I<0||k>this.max[b]-this.min[b])return 0}return 1}}class ua{constructor(l=0,f=0,_=0,b=0){if(isNaN(l)||l<0||isNaN(f)||f<0||isNaN(_)||_<0||isNaN(b)||b<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=l,this.bottom=f,this.left=_,this.right=b}interpolate(l,f,_){return f.top!=null&&l.top!=null&&(this.top=a.z.number(l.top,f.top,_)),f.bottom!=null&&l.bottom!=null&&(this.bottom=a.z.number(l.bottom,f.bottom,_)),f.left!=null&&l.left!=null&&(this.left=a.z.number(l.left,f.left,_)),f.right!=null&&l.right!=null&&(this.right=a.z.number(l.right,f.right,_)),this}getCenter(l,f){const _=a.ac((this.left+l-this.right)/2,0,l),b=a.ac((this.top+f-this.bottom)/2,0,f);return new a.P(_,b)}equals(l){return this.top===l.top&&this.bottom===l.bottom&&this.left===l.left&&this.right===l.right}clone(){return new ua(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const oc=85.051129;class Xl{constructor(l,f,_,b,k){this.tileSize=512,this._renderWorldCopies=k===void 0||!!k,this._minZoom=l||0,this._maxZoom=f||22,this._minPitch=_??0,this._maxPitch=b??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new a.M(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new ua,this._posMatrixCache={},this._alignedPosMatrixCache={},this.minElevationForCurrentTile=0}clone(){const l=new Xl(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return l.apply(this),l}apply(l){this.tileSize=l.tileSize,this.latRange=l.latRange,this.width=l.width,this.height=l.height,this._center=l._center,this._elevation=l._elevation,this.minElevationForCurrentTile=l.minElevationForCurrentTile,this.zoom=l.zoom,this.angle=l.angle,this._fov=l._fov,this._pitch=l._pitch,this._unmodified=l._unmodified,this._edgeInsets=l._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(l){this._minZoom!==l&&(this._minZoom=l,this.zoom=Math.max(this.zoom,l))}get maxZoom(){return this._maxZoom}set maxZoom(l){this._maxZoom!==l&&(this._maxZoom=l,this.zoom=Math.min(this.zoom,l))}get minPitch(){return this._minPitch}set minPitch(l){this._minPitch!==l&&(this._minPitch=l,this.pitch=Math.max(this.pitch,l))}get maxPitch(){return this._maxPitch}set maxPitch(l){this._maxPitch!==l&&(this._maxPitch=l,this.pitch=Math.min(this.pitch,l))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(l){l===void 0?l=!0:l===null&&(l=!1),this._renderWorldCopies=l}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new a.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(l){const f=-a.b1(l,-180,180)*Math.PI/180;this.angle!==f&&(this._unmodified=!1,this.angle=f,this._calcMatrices(),this.rotationMatrix=function(){var _=new a.A(4);return a.A!=Float32Array&&(_[1]=0,_[2]=0),_[0]=1,_[3]=1,_}(),function(_,b,k){var I=b[0],A=b[1],B=b[2],G=b[3],Y=Math.sin(k),te=Math.cos(k);_[0]=I*te+B*Y,_[1]=A*te+G*Y,_[2]=I*-Y+B*te,_[3]=A*-Y+G*te}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(l){const f=a.ac(l,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==f&&(this._unmodified=!1,this._pitch=f,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(l){l=Math.max(.01,Math.min(60,l)),this._fov!==l&&(this._unmodified=!1,this._fov=l/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(l){const f=Math.min(Math.max(l,this.minZoom),this.maxZoom);this._zoom!==f&&(this._unmodified=!1,this._zoom=f,this.tileZoom=Math.max(0,Math.floor(f)),this.scale=this.zoomScale(f),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(l){l.lat===this._center.lat&&l.lng===this._center.lng||(this._unmodified=!1,this._center=l,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(l){l!==this._elevation&&(this._elevation=l,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(l){this._edgeInsets.equals(l)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,l,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(l){return this._edgeInsets.equals(l)}interpolatePadding(l,f,_){this._unmodified=!1,this._edgeInsets.interpolate(l,f,_),this._constrain(),this._calcMatrices()}coveringZoomLevel(l){const f=(l.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/l.tileSize));return Math.max(0,f)}getVisibleUnwrappedCoordinates(l){const f=[new a.b2(0,l)];if(this._renderWorldCopies){const _=this.pointCoordinate(new a.P(0,0)),b=this.pointCoordinate(new a.P(this.width,0)),k=this.pointCoordinate(new a.P(this.width,this.height)),I=this.pointCoordinate(new a.P(0,this.height)),A=Math.floor(Math.min(_.x,b.x,k.x,I.x)),B=Math.floor(Math.max(_.x,b.x,k.x,I.x)),G=1;for(let Y=A-G;Y<=B+G;Y++)Y!==0&&f.push(new a.b2(Y,l))}return f}coveringTiles(l){var f,_;let b=this.coveringZoomLevel(l);const k=b;if(l.minzoom!==void 0&&b<l.minzoom)return[];l.maxzoom!==void 0&&b>l.maxzoom&&(b=l.maxzoom);const I=this.pointCoordinate(this.getCameraPoint()),A=a.Y.fromLngLat(this.center),B=Math.pow(2,b),G=[B*I.x,B*I.y,0],Y=[B*A.x,B*A.y,0],te=vs.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,b);let me=l.minzoom||0;!l.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(me=b);const Te=l.terrain?2/Math.min(this.tileSize,l.tileSize)*this.tileSize:3,ke=Ie=>({aabb:new ws([Ie*B,0,0],[(Ie+1)*B,B,0]),zoom:0,x:0,y:0,wrap:Ie,fullyVisible:!1}),Le=[],be=[],Re=b,et=l.reparseOverscaled?k:b;if(this._renderWorldCopies)for(let Ie=1;Ie<=3;Ie++)Le.push(ke(-Ie)),Le.push(ke(Ie));for(Le.push(ke(0));Le.length>0;){const Ie=Le.pop(),Ve=Ie.x,nt=Ie.y;let rt=Ie.fullyVisible;if(!rt){const Rt=Ie.aabb.intersects(te);if(Rt===0)continue;rt=Rt===2}const at=l.terrain?G:Y,yt=Ie.aabb.distanceX(at),mt=Ie.aabb.distanceY(at),zt=Math.max(Math.abs(yt),Math.abs(mt));if(Ie.zoom===Re||zt>Te+(1<<Re-Ie.zoom)-2&&Ie.zoom>=me){const Rt=Re-Ie.zoom,wn=G[0]-.5-(Ve<<Rt),$t=G[1]-.5-(nt<<Rt);be.push({tileID:new a.Q(Ie.zoom===Re?et:Ie.zoom,Ie.wrap,Ie.zoom,Ve,nt),distanceSq:he([Y[0]-.5-Ve,Y[1]-.5-nt]),tileDistanceToCamera:Math.sqrt(wn*wn+$t*$t)})}else for(let Rt=0;Rt<4;Rt++){const wn=(Ve<<1)+Rt%2,$t=(nt<<1)+(Rt>>1),hn=Ie.zoom+1;let xn=Ie.aabb.quadrant(Rt);if(l.terrain){const On=new a.Q(hn,Ie.wrap,hn,wn,$t),bn=l.terrain.getMinMaxElevation(On),Cn=(f=bn.minElevation)!==null&&f!==void 0?f:this.elevation,zn=(_=bn.maxElevation)!==null&&_!==void 0?_:this.elevation;xn=new ws([xn.min[0],xn.min[1],Cn],[xn.max[0],xn.max[1],zn])}Le.push({aabb:xn,zoom:hn,x:wn,y:$t,wrap:Ie.wrap,fullyVisible:rt})}}return be.sort((Ie,Ve)=>Ie.distanceSq-Ve.distanceSq).map(Ie=>Ie.tileID)}resize(l,f){this.width=l,this.height=f,this.pixelsToGLUnits=[2/l,-2/f],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(l){return Math.pow(2,l)}scaleZoom(l){return Math.log(l)/Math.LN2}project(l){const f=a.ac(l.lat,-85.051129,oc);return new a.P(a.N(l.lng)*this.worldSize,a.O(f)*this.worldSize)}unproject(l){return new a.Y(l.x/this.worldSize,l.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(l){const f=this.elevation,_=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,b=this.pointLocation(this.centerPoint,l),k=l.getElevationForLngLatZoom(b,this.tileZoom);if(!(this.elevation-k))return;const I=_+f-k,A=Math.cos(this._pitch)*this.cameraToCenterDistance/I/a.b3(1,b.lat),B=this.scaleZoom(A/this.tileSize);this._elevation=k,this._center=b,this.zoom=B}setLocationAtPoint(l,f){const _=this.pointCoordinate(f),b=this.pointCoordinate(this.centerPoint),k=this.locationCoordinate(l),I=new a.Y(k.x-(_.x-b.x),k.y-(_.y-b.y));this.center=this.coordinateLocation(I),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(l,f){return f?this.coordinatePoint(this.locationCoordinate(l),f.getElevationForLngLatZoom(l,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(l))}pointLocation(l,f){return this.coordinateLocation(this.pointCoordinate(l,f))}locationCoordinate(l){return a.Y.fromLngLat(l)}coordinateLocation(l){return l&&l.toLngLat()}pointCoordinate(l,f){if(f){const me=f.pointCoordinate(l);if(me!=null)return me}const _=[l.x,l.y,0,1],b=[l.x,l.y,1,1];a.af(_,_,this.pixelMatrixInverse),a.af(b,b,this.pixelMatrixInverse);const k=_[3],I=b[3],A=_[1]/k,B=b[1]/I,G=_[2]/k,Y=b[2]/I,te=G===Y?0:(0-G)/(Y-G);return new a.Y(a.z.number(_[0]/k,b[0]/I,te)/this.worldSize,a.z.number(A,B,te)/this.worldSize)}coordinatePoint(l,f=0,_=this.pixelMatrix){const b=[l.x*this.worldSize,l.y*this.worldSize,f,1];return a.af(b,b,_),new a.P(b[0]/b[3],b[1]/b[3])}getBounds(){const l=Math.max(0,this.height/2-this.getHorizon());return new qe().extend(this.pointLocation(new a.P(0,l))).extend(this.pointLocation(new a.P(this.width,l))).extend(this.pointLocation(new a.P(this.width,this.height))).extend(this.pointLocation(new a.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new qe([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(l){l?(this.lngRange=[l.getWest(),l.getEast()],this.latRange=[l.getSouth(),l.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,oc])}calculatePosMatrix(l,f=!1){const _=l.key,b=f?this._alignedPosMatrixCache:this._posMatrixCache;if(b[_])return b[_];const k=l.canonical,I=this.worldSize/this.zoomScale(k.z),A=k.x+Math.pow(2,k.z)*l.wrap,B=a.an(new Float64Array(16));return a.H(B,B,[A*I,k.y*I,0]),a.J(B,B,[I/a.W,I/a.W,1]),a.K(B,f?this.alignedProjMatrix:this.projMatrix,B),b[_]=new Float32Array(B),b[_]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(l,f){f=a.ac(+f,this.minZoom,this.maxZoom);const _={center:new a.M(l.lng,l.lat),zoom:f};let b=this.lngRange;if(!this._renderWorldCopies&&b===null){const Ie=179.9999999999;b=[-Ie,Ie]}const k=this.tileSize*this.zoomScale(_.zoom);let I=0,A=k,B=0,G=k,Y=0,te=0;const{x:me,y:Te}=this.size;if(this.latRange){const Ie=this.latRange;I=a.O(Ie[1])*k,A=a.O(Ie[0])*k,A-I<Te&&(Y=Te/(A-I))}b&&(B=a.b1(a.N(b[0])*k,0,k),G=a.b1(a.N(b[1])*k,0,k),G<B&&(G+=k),G-B<me&&(te=me/(G-B)));const{x:ke,y:Le}=this.project.call({worldSize:k},l);let be,Re;const et=Math.max(te||0,Y||0);if(et){const Ie=new a.P(te?(G+B)/2:ke,Y?(A+I)/2:Le);return _.center=this.unproject.call({worldSize:k},Ie).wrap(),_.zoom+=this.scaleZoom(et),_}if(this.latRange){const Ie=Te/2;Le-Ie<I&&(Re=I+Ie),Le+Ie>A&&(Re=A-Ie)}if(b){const Ie=(B+G)/2;let Ve=ke;this._renderWorldCopies&&(Ve=a.b1(ke,Ie-k/2,Ie+k/2));const nt=me/2;Ve-nt<B&&(be=B+nt),Ve+nt>G&&(be=G-nt)}if(be!==void 0||Re!==void 0){const Ie=new a.P(be??ke,Re??Le);_.center=this.unproject.call({worldSize:k},Ie).wrap()}return _}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const l=this._unmodified,{center:f,zoom:_}=this.getConstrained(this.center,this.zoom);this.center=f,this.zoom=_,this._unmodified=l,this._constraining=!1}_calcMatrices(){if(!this.height)return;const l=this.centerOffset,f=this.point.x,_=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=a.b3(1,this.center.lat)*this.worldSize;let b=a.an(new Float64Array(16));a.J(b,b,[this.width/2,-this.height/2,1]),a.H(b,b,[1,-1,0]),this.labelPlaneMatrix=b,b=a.an(new Float64Array(16)),a.J(b,b,[1,-1,1]),a.H(b,b,[-1,-1,0]),a.J(b,b,[2/this.width,2/this.height,1]),this.glCoordMatrix=b;const k=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),I=Math.min(this.elevation,this.minElevationForCurrentTile),A=k-I*this._pixelPerMeter/Math.cos(this._pitch),B=I<0?A:k,G=Math.PI/2+this._pitch,Y=this._fov*(.5+l.y/this.height),te=Math.sin(Y)*B/Math.sin(a.ac(Math.PI-G-Y,.01,Math.PI-.01)),me=this.getHorizon(),Te=2*Math.atan(me/this.cameraToCenterDistance)*(.5+l.y/(2*me)),ke=Math.sin(Te)*B/Math.sin(a.ac(Math.PI-G-Te,.01,Math.PI-.01)),Le=Math.min(te,ke),be=1.01*(Math.cos(Math.PI/2-this._pitch)*Le+B),Re=this.height/50;b=new Float64Array(16),a.b4(b,this._fov,this.width/this.height,Re,be),b[8]=2*-l.x/this.width,b[9]=2*l.y/this.height,a.J(b,b,[1,-1,1]),a.H(b,b,[0,0,-this.cameraToCenterDistance]),a.b5(b,b,this._pitch),a.ad(b,b,this.angle),a.H(b,b,[-f,-_,0]),this.mercatorMatrix=a.J([],b,[this.worldSize,this.worldSize,this.worldSize]),a.J(b,b,[1,1,this._pixelPerMeter]),this.pixelMatrix=a.K(new Float64Array(16),this.labelPlaneMatrix,b),a.H(b,b,[0,0,-this.elevation]),this.projMatrix=b,this.invProjMatrix=a.ar([],b),this.pixelMatrix3D=a.K(new Float64Array(16),this.labelPlaneMatrix,b);const et=this.width%2/2,Ie=this.height%2/2,Ve=Math.cos(this.angle),nt=Math.sin(this.angle),rt=f-Math.round(f)+Ve*et+nt*Ie,at=_-Math.round(_)+Ve*Ie+nt*et,yt=new Float64Array(b);if(a.H(yt,yt,[rt>.5?rt-1:rt,at>.5?at-1:at,0]),this.alignedProjMatrix=yt,b=a.ar(new Float64Array(16),this.pixelMatrix),!b)throw new Error("failed to invert matrix");this.pixelMatrixInverse=b,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const l=this.pointCoordinate(new a.P(0,0)),f=[l.x*this.worldSize,l.y*this.worldSize,0,1];return a.af(f,f,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const l=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new a.P(0,l))}getCameraQueryGeometry(l){const f=this.getCameraPoint();if(l.length===1)return[l[0],f];{let _=f.x,b=f.y,k=f.x,I=f.y;for(const A of l)_=Math.min(_,A.x),b=Math.min(b,A.y),k=Math.max(k,A.x),I=Math.max(I,A.y);return[new a.P(_,b),new a.P(k,b),new a.P(k,I),new a.P(_,I),new a.P(_,b)]}}lngLatToCameraDepth(l,f){const _=this.locationCoordinate(l),b=[_.x*this.worldSize,_.y*this.worldSize,f,1];return a.af(b,b,this.projMatrix),b[2]/b[3]}}function sc(w,l){let f,_=!1,b=null,k=null;const I=()=>{b=null,_&&(w.apply(k,f),b=setTimeout(I,l),_=!1)};return(...A)=>(_=!0,k=this,f=A,b||I(),b)}class ac{constructor(l){this._getCurrentHash=()=>{const f=window.location.hash.replace("#","");if(this._hashName){let _;return f.split("&").map(b=>b.split("=")).forEach(b=>{b[0]===this._hashName&&(_=b)}),(_&&_[1]||"").split("/")}return f.split("/")},this._onHashChange=()=>{const f=this._getCurrentHash();if(f.length>=3&&!f.some(_=>isNaN(_))){const _=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(f[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+f[2],+f[1]],zoom:+f[0],bearing:_,pitch:+(f[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const f=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,f)}catch{}},this._updateHash=sc(this._updateHashUnthrottled,300),this._hashName=l&&encodeURIComponent(l)}addTo(l){return this._map=l,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(l){const f=this._map.getCenter(),_=Math.round(100*this._map.getZoom())/100,b=Math.ceil((_*Math.LN2+Math.log(512/360/.5))/Math.LN10),k=Math.pow(10,b),I=Math.round(f.lng*k)/k,A=Math.round(f.lat*k)/k,B=this._map.getBearing(),G=this._map.getPitch();let Y="";if(Y+=l?`/${I}/${A}/${_}`:`${_}/${A}/${I}`,(B||G)&&(Y+="/"+Math.round(10*B)/10),G&&(Y+=`/${Math.round(G)}`),this._hashName){const te=this._hashName;let me=!1;const Te=window.location.hash.slice(1).split("&").map(ke=>{const Le=ke.split("=")[0];return Le===te?(me=!0,`${Le}=${Y}`):ke}).filter(ke=>ke);return me||Te.push(`${te}=${Y}`),`#${Te.join("&")}`}return`#${Y}`}}const Xa={linearity:.3,easing:a.b6(0,0,.3,1)},Fs=a.e({deceleration:2500,maxSpeed:1400},Xa),sf=a.e({deceleration:20,maxSpeed:1400},Xa),af=a.e({deceleration:1e3,maxSpeed:360},Xa),lf=a.e({deceleration:1e3,maxSpeed:90},Xa);class uf{constructor(l){this._map=l,this.clear()}clear(){this._inertiaBuffer=[]}record(l){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:y.now(),settings:l})}_drainInertiaBuffer(){const l=this._inertiaBuffer,f=y.now();for(;l.length>0&&f-l[0].time>160;)l.shift()}_onMoveEnd(l){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const f={zoom:0,bearing:0,pitch:0,pan:new a.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:k}of this._inertiaBuffer)f.zoom+=k.zoomDelta||0,f.bearing+=k.bearingDelta||0,f.pitch+=k.pitchDelta||0,k.panDelta&&f.pan._add(k.panDelta),k.around&&(f.around=k.around),k.pinchAround&&(f.pinchAround=k.pinchAround);const _=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,b={};if(f.pan.mag()){const k=Ya(f.pan.mag(),_,a.e({},Fs,l||{}));b.offset=f.pan.mult(k.amount/f.pan.mag()),b.center=this._map.transform.center,Ja(b,k)}if(f.zoom){const k=Ya(f.zoom,_,sf);b.zoom=this._map.transform.zoom+k.amount,Ja(b,k)}if(f.bearing){const k=Ya(f.bearing,_,af);b.bearing=this._map.transform.bearing+a.ac(k.amount,-179,179),Ja(b,k)}if(f.pitch){const k=Ya(f.pitch,_,lf);b.pitch=this._map.transform.pitch+k.amount,Ja(b,k)}if(b.zoom||b.bearing){const k=f.pinchAround===void 0?f.around:f.pinchAround;b.around=k?this._map.unproject(k):this._map.getCenter()}return this.clear(),a.e(b,{noMoveStart:!0})}}function Ja(w,l){(!w.duration||w.duration<l.duration)&&(w.duration=l.duration,w.easing=l.easing)}function Ya(w,l,f){const{maxSpeed:_,linearity:b,deceleration:k}=f,I=a.ac(w*b/(l/1e3),-_,_),A=Math.abs(I)/(k*b);return{easing:f.easing,duration:1e3*A,amount:I*(A/2)}}class Bi extends a.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,f,_,b={}){const k=x.mousePos(f.getCanvas(),_),I=f.unproject(k);super(l,a.e({point:k,lngLat:I,originalEvent:_},b)),this._defaultPrevented=!1,this.target=f}}class Vo extends a.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,f,_){const b=l==="touchend"?_.changedTouches:_.touches,k=x.touchPos(f.getCanvasContainer(),b),I=k.map(B=>f.unproject(B)),A=k.reduce((B,G,Y,te)=>B.add(G.div(te.length)),new a.P(0,0));super(l,{points:k,point:A,lngLats:I,lngLat:f.unproject(A),originalEvent:_}),this._defaultPrevented=!1}}class lc extends a.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,f,_){super(l,{originalEvent:_}),this._defaultPrevented=!1}}class ko{constructor(l,f){this._map=l,this._clickTolerance=f.clickTolerance}reset(){delete this._mousedownPos}wheel(l){return this._firePreventable(new lc(l.type,this._map,l))}mousedown(l,f){return this._mousedownPos=f,this._firePreventable(new Bi(l.type,this._map,l))}mouseup(l){this._map.fire(new Bi(l.type,this._map,l))}click(l,f){this._mousedownPos&&this._mousedownPos.dist(f)>=this._clickTolerance||this._map.fire(new Bi(l.type,this._map,l))}dblclick(l){return this._firePreventable(new Bi(l.type,this._map,l))}mouseover(l){this._map.fire(new Bi(l.type,this._map,l))}mouseout(l){this._map.fire(new Bi(l.type,this._map,l))}touchstart(l){return this._firePreventable(new Vo(l.type,this._map,l))}touchmove(l){this._map.fire(new Vo(l.type,this._map,l))}touchend(l){this._map.fire(new Vo(l.type,this._map,l))}touchcancel(l){this._map.fire(new Vo(l.type,this._map,l))}_firePreventable(l){if(this._map.fire(l),l.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class qo{constructor(l){this._map=l}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(l){this._map.fire(new Bi(l.type,this._map,l))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Bi("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(l){this._delayContextMenu?this._contextMenuEvent=l:this._ignoreContextMenu||this._map.fire(new Bi(l.type,this._map,l)),this._map.listens("contextmenu")&&l.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ca{constructor(l){this._map=l}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(l){return this.transform.pointLocation(a.P.convert(l),this._map.terrain)}}class So{constructor(l,f){this._map=l,this._tr=new ca(l),this._el=l.getCanvasContainer(),this._container=l.getContainer(),this._clickTolerance=f.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(l,f){this.isEnabled()&&l.shiftKey&&l.button===0&&(x.disableDrag(),this._startPos=this._lastPos=f,this._active=!0)}mousemoveWindow(l,f){if(!this._active)return;const _=f;if(this._lastPos.equals(_)||!this._box&&_.dist(this._startPos)<this._clickTolerance)return;const b=this._startPos;this._lastPos=_,this._box||(this._box=x.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",l));const k=Math.min(b.x,_.x),I=Math.max(b.x,_.x),A=Math.min(b.y,_.y),B=Math.max(b.y,_.y);x.setTransform(this._box,`translate(${k}px,${A}px)`),this._box.style.width=I-k+"px",this._box.style.height=B-A+"px"}mouseupWindow(l,f){if(!this._active||l.button!==0)return;const _=this._startPos,b=f;if(this.reset(),x.suppressClick(),_.x!==b.x||_.y!==b.y)return this._map.fire(new a.k("boxzoomend",{originalEvent:l})),{cameraAnimation:k=>k.fitScreenCoordinates(_,b,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",l)}keydown(l){this._active&&l.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",l))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(x.remove(this._box),this._box=null),x.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(l,f){return this._map.fire(new a.k(l,{originalEvent:f}))}}function Bs(w,l){if(w.length!==l.length)throw new Error(`The number of touches and points are not equal - touches ${w.length}, points ${l.length}`);const f={};for(let _=0;_<w.length;_++)f[w[_].identifier]=l[_];return f}class Yd{constructor(l){this.reset(),this.numTouches=l.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(l,f,_){(this.centroid||_.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=l.timeStamp),_.length===this.numTouches&&(this.centroid=function(b){const k=new a.P(0,0);for(const I of b)k._add(I);return k.div(b.length)}(f),this.touches=Bs(_,f)))}touchmove(l,f,_){if(this.aborted||!this.centroid)return;const b=Bs(_,f);for(const k in this.touches){const I=b[k];(!I||I.dist(this.touches[k])>30)&&(this.aborted=!0)}}touchend(l,f,_){if((!this.centroid||l.timeStamp-this.startTime>500)&&(this.aborted=!0),_.length===0){const b=!this.aborted&&this.centroid;if(this.reset(),b)return b}}}class uc{constructor(l){this.singleTap=new Yd(l),this.numTaps=l.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(l,f,_){this.singleTap.touchstart(l,f,_)}touchmove(l,f,_){this.singleTap.touchmove(l,f,_)}touchend(l,f,_){const b=this.singleTap.touchend(l,f,_);if(b){const k=l.timeStamp-this.lastTime<500,I=!this.lastTap||this.lastTap.dist(b)<30;if(k&&I||this.reset(),this.count++,this.lastTime=l.timeStamp,this.lastTap=b,this.count===this.numTaps)return this.reset(),b}}}class Qd{constructor(l){this._tr=new ca(l),this._zoomIn=new uc({numTouches:1,numTaps:2}),this._zoomOut=new uc({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(l,f,_){this._zoomIn.touchstart(l,f,_),this._zoomOut.touchstart(l,f,_)}touchmove(l,f,_){this._zoomIn.touchmove(l,f,_),this._zoomOut.touchmove(l,f,_)}touchend(l,f,_){const b=this._zoomIn.touchend(l,f,_),k=this._zoomOut.touchend(l,f,_),I=this._tr;return b?(this._active=!0,l.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:A=>A.easeTo({duration:300,zoom:I.zoom+1,around:I.unproject(b)},{originalEvent:l})}):k?(this._active=!0,l.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:A=>A.easeTo({duration:300,zoom:I.zoom-1,around:I.unproject(k)},{originalEvent:l})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ha{constructor(l){this._enabled=!!l.enable,this._moveStateManager=l.moveStateManager,this._clickTolerance=l.clickTolerance||1,this._moveFunction=l.move,this._activateOnStart=!!l.activateOnStart,l.assignEvents(this),this.reset()}reset(l){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(l)}_move(...l){const f=this._moveFunction(...l);if(f.bearingDelta||f.pitchDelta||f.around||f.panDelta)return this._active=!0,f}dragStart(l,f){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(l)&&(this._moveStateManager.startMove(l),this._lastPoint=f.length?f[0]:f,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(l,f){if(!this.isEnabled())return;const _=this._lastPoint;if(!_)return;if(l.preventDefault(),!this._moveStateManager.isValidMoveEvent(l))return void this.reset(l);const b=f.length?f[0]:f;return!this._moved&&b.dist(_)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=b,this._move(_,b))}dragEnd(l){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(l)&&(this._moved&&x.suppressClick(),this.reset(l))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Qa={0:1,2:2};class Zo{constructor(l){this._correctEvent=l.checkCorrectEvent}startMove(l){const f=x.mouseButton(l);this._eventButton=f}endMove(l){delete this._eventButton}isValidStartEvent(l){return this._correctEvent(l)}isValidMoveEvent(l){return!function(f,_){const b=Qa[_];return f.buttons===void 0||(f.buttons&b)!==b}(l,this._eventButton)}isValidEndEvent(l){return x.mouseButton(l)===this._eventButton}}class Gt{constructor(){this._firstTouch=void 0}_isOneFingerTouch(l){return l.targetTouches.length===1}_isSameTouchEvent(l){return l.targetTouches[0].identifier===this._firstTouch}startMove(l){this._firstTouch=l.targetTouches[0].identifier}endMove(l){delete this._firstTouch}isValidStartEvent(l){return this._isOneFingerTouch(l)}isValidMoveEvent(l){return this._isOneFingerTouch(l)&&this._isSameTouchEvent(l)}isValidEndEvent(l){return this._isOneFingerTouch(l)&&this._isSameTouchEvent(l)}}const Jl=w=>{w.mousedown=w.dragStart,w.mousemoveWindow=w.dragMove,w.mouseup=w.dragEnd,w.contextmenu=function(l){l.preventDefault()}},fa=({enable:w,clickTolerance:l,bearingDegreesPerPixelMoved:f=.8})=>{const _=new Zo({checkCorrectEvent:b=>x.mouseButton(b)===0&&b.ctrlKey||x.mouseButton(b)===2});return new ha({clickTolerance:l,move:(b,k)=>({bearingDelta:(k.x-b.x)*f}),moveStateManager:_,enable:w,assignEvents:Jl})},da=({enable:w,clickTolerance:l,pitchDegreesPerPixelMoved:f=-.5})=>{const _=new Zo({checkCorrectEvent:b=>x.mouseButton(b)===0&&b.ctrlKey||x.mouseButton(b)===2});return new ha({clickTolerance:l,move:(b,k)=>({pitchDelta:(k.y-b.y)*f}),moveStateManager:_,enable:w,assignEvents:Jl})};class cf{constructor(l,f){this._clickTolerance=l.clickTolerance||1,this._map=f,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new a.P(0,0)}minTouchs(){return this._map.cooperativeGestures.isEnabled()?2:1}touchstart(l,f,_){return this._calculateTransform(l,f,_)}touchmove(l,f,_){if(this._active&&!(_.length<this.minTouchs()))return l.preventDefault(),this._calculateTransform(l,f,_)}touchend(l,f,_){this._calculateTransform(l,f,_),this._active&&_.length<this.minTouchs()&&this.reset()}touchcancel(){this.reset()}_calculateTransform(l,f,_){_.length>0&&(this._active=!0);const b=Bs(_,f),k=new a.P(0,0),I=new a.P(0,0);let A=0;for(const G in b){const Y=b[G],te=this._touches[G];te&&(k._add(Y),I._add(Y.sub(te)),A++,b[G]=Y)}if(this._touches=b,A<this.minTouchs()||!I.mag())return;const B=I.div(A);return this._sum._add(B),this._sum.mag()<this._clickTolerance?void 0:{around:k.div(A),panDelta:B}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ut{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(l,f,_){this._firstTwoTouches||_.length<2||(this._firstTwoTouches=[_[0].identifier,_[1].identifier],this._start([f[0],f[1]]))}touchmove(l,f,_){if(!this._firstTwoTouches)return;l.preventDefault();const[b,k]=this._firstTwoTouches,I=pa(_,f,b),A=pa(_,f,k);if(!I||!A)return;const B=this._aroundCenter?null:I.add(A).div(2);return this._move([I,A],B,l)}touchend(l,f,_){if(!this._firstTwoTouches)return;const[b,k]=this._firstTwoTouches,I=pa(_,f,b),A=pa(_,f,k);I&&A||(this._active&&x.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(l){this._enabled=!0,this._aroundCenter=!!l&&l.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function pa(w,l,f){for(let _=0;_<w.length;_++)if(w[_].identifier===f)return l[_]}function hf(w,l){return Math.log(w/l)/Math.LN2}class ff extends Ut{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(l){this._startDistance=this._distance=l[0].dist(l[1])}_move(l,f){const _=this._distance;if(this._distance=l[0].dist(l[1]),this._active||!(Math.abs(hf(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:hf(this._distance,_),pinchAround:f}}}function Yl(w,l){return 180*w.angleWith(l)/Math.PI}class cc extends Ut{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(l){this._startVector=this._vector=l[0].sub(l[1]),this._minDiameter=l[0].dist(l[1])}_move(l,f,_){const b=this._vector;if(this._vector=l[0].sub(l[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Yl(this._vector,b),pinchAround:f}}_isBelowThreshold(l){this._minDiameter=Math.min(this._minDiameter,l.mag());const f=25/(Math.PI*this._minDiameter)*360,_=Yl(l,this._startVector);return Math.abs(_)<f}}function Ql(w){return Math.abs(w.y)>Math.abs(w.x)}class df extends Ut{constructor(l){super(),this._currentTouchCount=0,this._map=l}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(l,f,_){super.touchstart(l,f,_),this._currentTouchCount=_.length}_start(l){this._lastPoints=l,Ql(l[0].sub(l[1]))&&(this._valid=!1)}_move(l,f,_){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const b=l[0].sub(this._lastPoints[0]),k=l[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(b,k,_.timeStamp),this._valid?(this._lastPoints=l,this._active=!0,{pitchDelta:(b.y+k.y)/2*-.5}):void 0}gestureBeginsVertically(l,f,_){if(this._valid!==void 0)return this._valid;const b=l.mag()>=2,k=f.mag()>=2;if(!b&&!k)return;if(!b||!k)return this._firstMove===void 0&&(this._firstMove=_),_-this._firstMove<100&&void 0;const I=l.y>0==f.y>0;return Ql(l)&&Ql(f)&&I}}const ep={panStep:100,bearingStep:15,pitchStep:10};class xs{constructor(l){this._tr=new ca(l);const f=ep;this._panStep=f.panStep,this._bearingStep=f.bearingStep,this._pitchStep=f.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(l){if(l.altKey||l.ctrlKey||l.metaKey)return;let f=0,_=0,b=0,k=0,I=0;switch(l.keyCode){case 61:case 107:case 171:case 187:f=1;break;case 189:case 109:case 173:f=-1;break;case 37:l.shiftKey?_=-1:(l.preventDefault(),k=-1);break;case 39:l.shiftKey?_=1:(l.preventDefault(),k=1);break;case 38:l.shiftKey?b=1:(l.preventDefault(),I=-1);break;case 40:l.shiftKey?b=-1:(l.preventDefault(),I=1);break;default:return}return this._rotationDisabled&&(_=0,b=0),{cameraAnimation:A=>{const B=this._tr;A.easeTo({duration:300,easeId:"keyboardHandler",easing:kr,zoom:f?Math.round(B.zoom)+f*(l.shiftKey?2:1):B.zoom,bearing:B.bearing+_*this._bearingStep,pitch:B.pitch+b*this._pitchStep,offset:[-k*this._panStep,-I*this._panStep],center:B.center},{originalEvent:l})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function kr(w){return w*(2-w)}const el=4.000244140625;class eu{constructor(l,f){this._onTimeout=_=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(_)},this._map=l,this._tr=new ca(l),this._triggerRenderFrame=f,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(l){this._defaultZoomRate=l}setWheelZoomRate(l){this._wheelZoomRate=l}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(l){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!l&&l.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(l){if(!this.isEnabled()||this._map.cooperativeGestures.isEnabled()&&!l[this._map.cooperativeGestures._bypassKey])return;let f=l.deltaMode===WheelEvent.DOM_DELTA_LINE?40*l.deltaY:l.deltaY;const _=y.now(),b=_-(this._lastWheelEventTime||0);this._lastWheelEventTime=_,f!==0&&f%el==0?this._type="wheel":f!==0&&Math.abs(f)<4?this._type="trackpad":b>400?(this._type=null,this._lastValue=f,this._timeout=setTimeout(this._onTimeout,40,l)):this._type||(this._type=Math.abs(b*f)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,f+=this._lastValue)),l.shiftKey&&f&&(f/=4),this._type&&(this._lastWheelEvent=l,this._delta-=f,this._active||this._start(l)),l.preventDefault()}_start(l){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const f=x.mousePos(this._map.getCanvas(),l),_=this._tr;this._around=f.y>_.transform.height/2-_.transform.getHorizon()?a.M.convert(this._aroundCenter?_.center:_.unproject(f)):a.M.convert(_.center),this._aroundPoint=_.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const l=this._tr.transform;if(this._delta!==0){const A=this._type==="wheel"&&Math.abs(this._delta)>el?this._wheelZoomRate:this._defaultZoomRate;let B=2/(1+Math.exp(-Math.abs(this._delta*A)));this._delta<0&&B!==0&&(B=1/B);const G=typeof this._targetZoom=="number"?l.zoomScale(this._targetZoom):l.scale;this._targetZoom=Math.min(l.maxZoom,Math.max(l.minZoom,l.scaleZoom(G*B))),this._type==="wheel"&&(this._startZoom=l.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const f=typeof this._targetZoom=="number"?this._targetZoom:l.zoom,_=this._startZoom,b=this._easing;let k,I=!1;if(this._type==="wheel"&&_&&b){const A=Math.min((y.now()-this._lastWheelEventTime)/200,1),B=b(A);k=a.z.number(_,f,B),A<1?this._frameId||(this._frameId=!0):I=!0}else k=f,I=!0;return this._active=!0,I&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!I,zoomDelta:k-l.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(l){let f=a.b7;if(this._prevEase){const _=this._prevEase,b=(y.now()-_.start)/_.duration,k=_.easing(b+.01)-_.easing(b),I=.27/Math.sqrt(k*k+1e-4)*.01,A=Math.sqrt(.0729-I*I);f=a.b6(I,A,.25,1)}return this._prevEase={start:y.now(),duration:l,easing:f},f}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class hc{constructor(l,f){this._clickZoom=l,this._tapZoom=f}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class pf{constructor(l){this._tr=new ca(l),this.reset()}reset(){this._active=!1}dblclick(l,f){return l.preventDefault(),{cameraAnimation:_=>{_.easeTo({duration:300,zoom:this._tr.zoom+(l.shiftKey?-1:1),around:this._tr.unproject(f)},{originalEvent:l})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class mf{constructor(){this._tap=new uc({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(l,f,_){if(!this._swipePoint)if(this._tapTime){const b=f[0],k=l.timeStamp-this._tapTime<500,I=this._tapPoint.dist(b)<30;k&&I?_.length>0&&(this._swipePoint=b,this._swipeTouch=_[0].identifier):this.reset()}else this._tap.touchstart(l,f,_)}touchmove(l,f,_){if(this._tapTime){if(this._swipePoint){if(_[0].identifier!==this._swipeTouch)return;const b=f[0],k=b.y-this._swipePoint.y;return this._swipePoint=b,l.preventDefault(),this._active=!0,{zoomDelta:k/128}}}else this._tap.touchmove(l,f,_)}touchend(l,f,_){if(this._tapTime)this._swipePoint&&_.length===0&&this.reset();else{const b=this._tap.touchend(l,f,_);b&&(this._tapTime=l.timeStamp,this._tapPoint=b)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class gf{constructor(l,f,_){this._el=l,this._mousePan=f,this._touchPan=_}enable(l){this._inertiaOptions=l||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class To{constructor(l,f,_){this._pitchWithRotate=l.pitchWithRotate,this._mouseRotate=f,this._mousePitch=_}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class tl{constructor(l,f,_,b){this._el=l,this._touchZoom=f,this._touchRotate=_,this._tapDragZoom=b,this._rotationDisabled=!1,this._enabled=!0}enable(l){this._touchZoom.enable(l),this._rotationDisabled||this._touchRotate.enable(l),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class tn{constructor(l,f){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=l,this._options=f,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const l=this._map.getCanvasContainer();l.classList.add("maplibregl-cooperative-gestures"),this._container=x.create("div","maplibregl-cooperative-gesture-screen",l);let f=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(f=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const _=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),b=document.createElement("div");b.className="maplibregl-desktop-message",b.textContent=f,this._container.appendChild(b);const k=document.createElement("div");k.className="maplibregl-mobile-message",k.textContent=_,this._container.appendChild(k),this._container.setAttribute("aria-hidden","true")}_destoryUI(){this._container&&(x.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destoryUI()}isEnabled(){return this._enabled}touchmove(l){this._onCooperativeGesture(l.touches.length===1)}wheel(l){this._map.scrollZoom.isEnabled()&&this._onCooperativeGesture(!l[this._bypassKey])}_onCooperativeGesture(l){this._enabled&&l&&(this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const ln=w=>w.zoom||w.drag||w.pitch||w.rotate;class tu extends a.k{}function nl(w){return w.panDelta&&w.panDelta.mag()||w.zoomDelta||w.bearingDelta||w.pitchDelta}class fc{constructor(l,f){this.handleWindowEvent=b=>{this.handleEvent(b,`${b.type}Window`)},this.handleEvent=(b,k)=>{if(b.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const I=b.type==="renderFrame"?void 0:b,A={needsRenderFrame:!1},B={},G={},Y=b.touches,te=Y?this._getMapTouches(Y):void 0,me=te?x.touchPos(this._map.getCanvas(),te):x.mousePos(this._map.getCanvas(),b);for(const{handlerName:Le,handler:be,allowed:Re}of this._handlers){if(!be.isEnabled())continue;let et;this._blockedByActive(G,Re,Le)?be.reset():be[k||b.type]&&(et=be[k||b.type](b,me,te),this.mergeHandlerResult(A,B,et,Le,I),et&&et.needsRenderFrame&&this._triggerRenderFrame()),(et||be.isActive())&&(G[Le]=be)}const Te={};for(const Le in this._previousActiveHandlers)G[Le]||(Te[Le]=I);this._previousActiveHandlers=G,(Object.keys(Te).length||nl(A))&&(this._changes.push([A,B,Te]),this._triggerRenderFrame()),(Object.keys(G).length||nl(A))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:ke}=A;ke&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],ke(this._map))},this._map=l,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new uf(l),this._bearingSnap=f.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(f);const _=this._el;this._listeners=[[_,"touchstart",{passive:!0}],[_,"touchmove",{passive:!1}],[_,"touchend",void 0],[_,"touchcancel",void 0],[_,"mousedown",void 0],[_,"mousemove",void 0],[_,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[_,"mouseover",void 0],[_,"mouseout",void 0],[_,"dblclick",void 0],[_,"click",void 0],[_,"keydown",{capture:!1}],[_,"keyup",void 0],[_,"wheel",{passive:!1}],[_,"contextmenu",void 0],[window,"blur",void 0]];for(const[b,k,I]of this._listeners)x.addEventListener(b,k,b===document?this.handleWindowEvent:this.handleEvent,I)}destroy(){for(const[l,f,_]of this._listeners)x.removeEventListener(l,f,l===document?this.handleWindowEvent:this.handleEvent,_)}_addDefaultHandlers(l){const f=this._map,_=f.getCanvasContainer();this._add("mapEvent",new ko(f,l));const b=f.boxZoom=new So(f,l);this._add("boxZoom",b),l.interactive&&l.boxZoom&&b.enable();const k=f.cooperativeGestures=new tn(f,l.cooperativeGestures);this._add("cooperativeGestures",k),l.cooperativeGestures&&k.enable();const I=new Qd(f),A=new pf(f);f.doubleClickZoom=new hc(A,I),this._add("tapZoom",I),this._add("clickZoom",A),l.interactive&&l.doubleClickZoom&&f.doubleClickZoom.enable();const B=new mf;this._add("tapDragZoom",B);const G=f.touchPitch=new df(f);this._add("touchPitch",G),l.interactive&&l.touchPitch&&f.touchPitch.enable(l.touchPitch);const Y=fa(l),te=da(l);f.dragRotate=new To(l,Y,te),this._add("mouseRotate",Y,["mousePitch"]),this._add("mousePitch",te,["mouseRotate"]),l.interactive&&l.dragRotate&&f.dragRotate.enable();const me=(({enable:et,clickTolerance:Ie})=>{const Ve=new Zo({checkCorrectEvent:nt=>x.mouseButton(nt)===0&&!nt.ctrlKey});return new ha({clickTolerance:Ie,move:(nt,rt)=>({around:rt,panDelta:rt.sub(nt)}),activateOnStart:!0,moveStateManager:Ve,enable:et,assignEvents:Jl})})(l),Te=new cf(l,f);f.dragPan=new gf(_,me,Te),this._add("mousePan",me),this._add("touchPan",Te,["touchZoom","touchRotate"]),l.interactive&&l.dragPan&&f.dragPan.enable(l.dragPan);const ke=new cc,Le=new ff;f.touchZoomRotate=new tl(_,Le,ke,B),this._add("touchRotate",ke,["touchPan","touchZoom"]),this._add("touchZoom",Le,["touchPan","touchRotate"]),l.interactive&&l.touchZoomRotate&&f.touchZoomRotate.enable(l.touchZoomRotate);const be=f.scrollZoom=new eu(f,()=>this._triggerRenderFrame());this._add("scrollZoom",be,["mousePan"]),l.interactive&&l.scrollZoom&&f.scrollZoom.enable(l.scrollZoom);const Re=f.keyboard=new xs(f);this._add("keyboard",Re),l.interactive&&l.keyboard&&f.keyboard.enable(),this._add("blockableMapEvent",new qo(f))}_add(l,f,_){this._handlers.push({handlerName:l,handler:f,allowed:_}),this._handlersById[l]=f}stop(l){if(!this._updatingCamera){for(const{handler:f}of this._handlers)f.reset();this._inertia.clear(),this._fireEvents({},{},l),this._changes=[]}}isActive(){for(const{handler:l}of this._handlers)if(l.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!ln(this._eventsInProgress)||this.isZooming()}_blockedByActive(l,f,_){for(const b in l)if(b!==_&&(!f||f.indexOf(b)<0))return!0;return!1}_getMapTouches(l){const f=[];for(const _ of l)this._el.contains(_.target)&&f.push(_);return f}mergeHandlerResult(l,f,_,b,k){if(!_)return;a.e(l,_);const I={handlerName:b,originalEvent:_.originalEvent||k};_.zoomDelta!==void 0&&(f.zoom=I),_.panDelta!==void 0&&(f.drag=I),_.pitchDelta!==void 0&&(f.pitch=I),_.bearingDelta!==void 0&&(f.rotate=I)}_applyChanges(){const l={},f={},_={};for(const[b,k,I]of this._changes)b.panDelta&&(l.panDelta=(l.panDelta||new a.P(0,0))._add(b.panDelta)),b.zoomDelta&&(l.zoomDelta=(l.zoomDelta||0)+b.zoomDelta),b.bearingDelta&&(l.bearingDelta=(l.bearingDelta||0)+b.bearingDelta),b.pitchDelta&&(l.pitchDelta=(l.pitchDelta||0)+b.pitchDelta),b.around!==void 0&&(l.around=b.around),b.pinchAround!==void 0&&(l.pinchAround=b.pinchAround),b.noInertia&&(l.noInertia=b.noInertia),a.e(f,k),a.e(_,I);this._updateMapTransform(l,f,_),this._changes=[]}_updateMapTransform(l,f,_){const b=this._map,k=b._getTransformForUpdate(),I=b.terrain;if(!(nl(l)||I&&this._terrainMovement))return this._fireEvents(f,_,!0);let{panDelta:A,zoomDelta:B,bearingDelta:G,pitchDelta:Y,around:te,pinchAround:me}=l;me!==void 0&&(te=me),b._stop(!0),te=te||b.transform.centerPoint;const Te=k.pointLocation(A?te.sub(A):te);G&&(k.bearing+=G),Y&&(k.pitch+=Y),B&&(k.zoom+=B),I?this._terrainMovement||!f.drag&&!f.zoom?f.drag&&this._terrainMovement?k.center=k.pointLocation(k.centerPoint.sub(A)):k.setLocationAtPoint(Te,te):(this._terrainMovement=!0,this._map._elevationFreeze=!0,k.setLocationAtPoint(Te,te),this._map.once("moveend",()=>{this._map._elevationFreeze=!1,this._terrainMovement=!1,k.recalculateZoom(b.terrain)})):k.setLocationAtPoint(Te,te),b._applyUpdatedTransform(k),this._map._update(),l.noInertia||this._inertia.record(l),this._fireEvents(f,_,!0)}_fireEvents(l,f,_){const b=ln(this._eventsInProgress),k=ln(l),I={};for(const Y in l){const{originalEvent:te}=l[Y];this._eventsInProgress[Y]||(I[`${Y}start`]=te),this._eventsInProgress[Y]=l[Y]}!b&&k&&this._fireEvent("movestart",k.originalEvent);for(const Y in I)this._fireEvent(Y,I[Y]);k&&this._fireEvent("move",k.originalEvent);for(const Y in l){const{originalEvent:te}=l[Y];this._fireEvent(Y,te)}const A={};let B;for(const Y in this._eventsInProgress){const{handlerName:te,originalEvent:me}=this._eventsInProgress[Y];this._handlersById[te].isActive()||(delete this._eventsInProgress[Y],B=f[te]||me,A[`${Y}end`]=B)}for(const Y in A)this._fireEvent(Y,A[Y]);const G=ln(this._eventsInProgress);if(_&&(b||k)&&!G){this._updatingCamera=!0;const Y=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),te=me=>me!==0&&-this._bearingSnap<me&&me<this._bearingSnap;!Y||!Y.essential&&y.prefersReducedMotion?(this._map.fire(new a.k("moveend",{originalEvent:B})),te(this._map.getBearing())&&this._map.resetNorth()):(te(Y.bearing||this._map.getBearing())&&(Y.bearing=0),Y.freezeElevation=!0,this._map.easeTo(Y,{originalEvent:B})),this._updatingCamera=!1}}_fireEvent(l,f){this._map.fire(new a.k(l,f?{originalEvent:f}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(l=>{delete this._frameId,this.handleEvent(new tu("renderFrame",{timeStamp:l})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class $i extends a.E{constructor(l,f){super(),this._renderFrameCallback=()=>{const _=Math.min((y.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(_)),_<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=l,this._bearingSnap=f.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new a.M(this.transform.center.lng,this.transform.center.lat)}setCenter(l,f){return this.jumpTo({center:l},f)}panBy(l,f,_){return l=a.P.convert(l).mult(-1),this.panTo(this.transform.center,a.e({offset:l},f),_)}panTo(l,f,_){return this.easeTo(a.e({center:l},f),_)}getZoom(){return this.transform.zoom}setZoom(l,f){return this.jumpTo({zoom:l},f),this}zoomTo(l,f,_){return this.easeTo(a.e({zoom:l},f),_)}zoomIn(l,f){return this.zoomTo(this.getZoom()+1,l,f),this}zoomOut(l,f){return this.zoomTo(this.getZoom()-1,l,f),this}getBearing(){return this.transform.bearing}setBearing(l,f){return this.jumpTo({bearing:l},f),this}getPadding(){return this.transform.padding}setPadding(l,f){return this.jumpTo({padding:l},f),this}rotateTo(l,f,_){return this.easeTo(a.e({bearing:l},f),_)}resetNorth(l,f){return this.rotateTo(0,a.e({duration:1e3},l),f),this}resetNorthPitch(l,f){return this.easeTo(a.e({bearing:0,pitch:0,duration:1e3},l),f),this}snapToNorth(l,f){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(l,f):this}getPitch(){return this.transform.pitch}setPitch(l,f){return this.jumpTo({pitch:l},f),this}cameraForBounds(l,f){l=qe.convert(l);const _=f&&f.bearing||0;return this._cameraForBoxAndBearing(l.getNorthWest(),l.getSouthEast(),_,f)}_cameraForBoxAndBearing(l,f,_,b){const k={top:0,bottom:0,right:0,left:0};if(typeof(b=a.e({padding:k,offset:[0,0],maxZoom:this.transform.maxZoom},b)).padding=="number"){const Rt=b.padding;b.padding={top:Rt,bottom:Rt,right:Rt,left:Rt}}b.padding=a.e(k,b.padding);const I=this.transform,A=I.padding,B=new qe(l,f),G=I.project(B.getNorthWest()),Y=I.project(B.getNorthEast()),te=I.project(B.getSouthEast()),me=I.project(B.getSouthWest()),Te=a.b8(-_),ke=G.rotate(Te),Le=Y.rotate(Te),be=te.rotate(Te),Re=me.rotate(Te),et=new a.P(Math.max(ke.x,Le.x,Re.x,be.x),Math.max(ke.y,Le.y,Re.y,be.y)),Ie=new a.P(Math.min(ke.x,Le.x,Re.x,be.x),Math.min(ke.y,Le.y,Re.y,be.y)),Ve=et.sub(Ie),nt=(I.width-(A.left+A.right+b.padding.left+b.padding.right))/Ve.x,rt=(I.height-(A.top+A.bottom+b.padding.top+b.padding.bottom))/Ve.y;if(rt<0||nt<0)return void a.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const at=Math.min(I.scaleZoom(I.scale*Math.min(nt,rt)),b.maxZoom),yt=a.P.convert(b.offset),mt=new a.P((b.padding.left-b.padding.right)/2,(b.padding.top-b.padding.bottom)/2).rotate(a.b8(_)),zt=yt.add(mt).mult(I.scale/I.zoomScale(at));return{center:I.unproject(G.add(te).div(2).sub(zt)),zoom:at,bearing:_}}fitBounds(l,f,_){return this._fitInternal(this.cameraForBounds(l,f),f,_)}fitScreenCoordinates(l,f,_,b,k){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(a.P.convert(l)),this.transform.pointLocation(a.P.convert(f)),_,b),b,k)}_fitInternal(l,f,_){return l?(delete(f=a.e(l,f)).padding,f.linear?this.easeTo(f,_):this.flyTo(f,_)):this}jumpTo(l,f){this.stop();const _=this._getTransformForUpdate();let b=!1,k=!1,I=!1;return"zoom"in l&&_.zoom!==+l.zoom&&(b=!0,_.zoom=+l.zoom),l.center!==void 0&&(_.center=a.M.convert(l.center)),"bearing"in l&&_.bearing!==+l.bearing&&(k=!0,_.bearing=+l.bearing),"pitch"in l&&_.pitch!==+l.pitch&&(I=!0,_.pitch=+l.pitch),l.padding==null||_.isPaddingEqual(l.padding)||(_.padding=l.padding),this._applyUpdatedTransform(_),this.fire(new a.k("movestart",f)).fire(new a.k("move",f)),b&&this.fire(new a.k("zoomstart",f)).fire(new a.k("zoom",f)).fire(new a.k("zoomend",f)),k&&this.fire(new a.k("rotatestart",f)).fire(new a.k("rotate",f)).fire(new a.k("rotateend",f)),I&&this.fire(new a.k("pitchstart",f)).fire(new a.k("pitch",f)).fire(new a.k("pitchend",f)),this.fire(new a.k("moveend",f))}calculateCameraOptionsFromTo(l,f,_,b=0){const k=a.Y.fromLngLat(l,f),I=a.Y.fromLngLat(_,b),A=I.x-k.x,B=I.y-k.y,G=I.z-k.z,Y=Math.hypot(A,B,G);if(Y===0)throw new Error("Can't calculate camera options with same From and To");const te=Math.hypot(A,B),me=this.transform.scaleZoom(this.transform.cameraToCenterDistance/Y/this.transform.tileSize),Te=180*Math.atan2(A,-B)/Math.PI;let ke=180*Math.acos(te/Y)/Math.PI;return ke=G<0?90-ke:90+ke,{center:I.toLngLat(),zoom:me,pitch:ke,bearing:Te}}easeTo(l,f){var _;this._stop(!1,l.easeId),((l=a.e({offset:[0,0],duration:500,easing:a.b7},l)).animate===!1||!l.essential&&y.prefersReducedMotion)&&(l.duration=0);const b=this._getTransformForUpdate(),k=this.getZoom(),I=this.getBearing(),A=this.getPitch(),B=this.getPadding(),G="bearing"in l?this._normalizeBearing(l.bearing,I):I,Y="pitch"in l?+l.pitch:A,te="padding"in l?l.padding:b.padding,me=a.P.convert(l.offset);let Te=b.centerPoint.add(me);const ke=b.pointLocation(Te),{center:Le,zoom:be}=b.getConstrained(a.M.convert(l.center||ke),(_=l.zoom)!==null&&_!==void 0?_:k);this._normalizeCenter(Le);const Re=b.project(ke),et=b.project(Le).sub(Re),Ie=b.zoomScale(be-k);let Ve,nt;l.around&&(Ve=a.M.convert(l.around),nt=b.locationPoint(Ve));const rt={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||be!==k,this._rotating=this._rotating||I!==G,this._pitching=this._pitching||Y!==A,this._padding=!b.isPaddingEqual(te),this._easeId=l.easeId,this._prepareEase(f,l.noMoveStart,rt),this.terrain&&this._prepareElevation(Le),this._ease(at=>{if(this._zooming&&(b.zoom=a.z.number(k,be,at)),this._rotating&&(b.bearing=a.z.number(I,G,at)),this._pitching&&(b.pitch=a.z.number(A,Y,at)),this._padding&&(b.interpolatePadding(B,te,at),Te=b.centerPoint.add(me)),this.terrain&&!l.freezeElevation&&this._updateElevation(at),Ve)b.setLocationAtPoint(Ve,nt);else{const yt=b.zoomScale(b.zoom-k),mt=be>k?Math.min(2,Ie):Math.max(.5,Ie),zt=Math.pow(mt,1-at),Rt=b.unproject(Re.add(et.mult(at*zt)).mult(yt));b.setLocationAtPoint(b.renderWorldCopies?Rt.wrap():Rt,Te)}this._applyUpdatedTransform(b),this._fireMoveEvents(f)},at=>{this.terrain&&this._finalizeElevation(),this._afterEase(f,at)},l),this}_prepareEase(l,f,_={}){this._moving=!0,f||_.moving||this.fire(new a.k("movestart",l)),this._zooming&&!_.zooming&&this.fire(new a.k("zoomstart",l)),this._rotating&&!_.rotating&&this.fire(new a.k("rotatestart",l)),this._pitching&&!_.pitching&&this.fire(new a.k("pitchstart",l))}_prepareElevation(l){this._elevationCenter=l,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(l,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(l){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const f=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(l<1&&f!==this._elevationTarget){const _=this._elevationTarget-this._elevationStart;this._elevationStart+=l*(_-(f-(_*l+this._elevationStart))/(1-l)),this._elevationTarget=f}this.transform.elevation=a.z.number(this._elevationStart,this._elevationTarget,l)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(l){if(!this.transformCameraUpdate)return;const f=l.clone(),{center:_,zoom:b,pitch:k,bearing:I,elevation:A}=this.transformCameraUpdate(f);_&&(f.center=_),b!==void 0&&(f.zoom=b),k!==void 0&&(f.pitch=k),I!==void 0&&(f.bearing=I),A!==void 0&&(f.elevation=A),this.transform.apply(f)}_fireMoveEvents(l){this.fire(new a.k("move",l)),this._zooming&&this.fire(new a.k("zoom",l)),this._rotating&&this.fire(new a.k("rotate",l)),this._pitching&&this.fire(new a.k("pitch",l))}_afterEase(l,f){if(this._easeId&&f&&this._easeId===f)return;delete this._easeId;const _=this._zooming,b=this._rotating,k=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,_&&this.fire(new a.k("zoomend",l)),b&&this.fire(new a.k("rotateend",l)),k&&this.fire(new a.k("pitchend",l)),this.fire(new a.k("moveend",l))}flyTo(l,f){var _;if(!l.essential&&y.prefersReducedMotion){const On=a.L(l,["center","zoom","bearing","pitch","around"]);return this.jumpTo(On,f)}this.stop(),l=a.e({offset:[0,0],speed:1.2,curve:1.42,easing:a.b7},l);const b=this._getTransformForUpdate(),k=this.getZoom(),I=this.getBearing(),A=this.getPitch(),B=this.getPadding(),G="bearing"in l?this._normalizeBearing(l.bearing,I):I,Y="pitch"in l?+l.pitch:A,te="padding"in l?l.padding:b.padding,me=a.P.convert(l.offset);let Te=b.centerPoint.add(me);const ke=b.pointLocation(Te),{center:Le,zoom:be}=b.getConstrained(a.M.convert(l.center||ke),(_=l.zoom)!==null&&_!==void 0?_:k);this._normalizeCenter(Le);const Re=b.zoomScale(be-k),et=b.project(ke),Ie=b.project(Le).sub(et);let Ve=l.curve;const nt=Math.max(b.width,b.height),rt=nt/Re,at=Ie.mag();if("minZoom"in l){const On=a.ac(Math.min(l.minZoom,k,be),b.minZoom,b.maxZoom),bn=nt/b.zoomScale(On-k);Ve=Math.sqrt(bn/at*2)}const yt=Ve*Ve;function mt(On){const bn=(rt*rt-nt*nt+(On?-1:1)*yt*yt*at*at)/(2*(On?rt:nt)*yt*at);return Math.log(Math.sqrt(bn*bn+1)-bn)}function zt(On){return(Math.exp(On)-Math.exp(-On))/2}function Rt(On){return(Math.exp(On)+Math.exp(-On))/2}const wn=mt(!1);let $t=function(On){return Rt(wn)/Rt(wn+Ve*On)},hn=function(On){return nt*((Rt(wn)*(zt(bn=wn+Ve*On)/Rt(bn))-zt(wn))/yt)/at;var bn},xn=(mt(!0)-wn)/Ve;if(Math.abs(at)<1e-6||!isFinite(xn)){if(Math.abs(nt-rt)<1e-6)return this.easeTo(l,f);const On=rt<nt?-1:1;xn=Math.abs(Math.log(rt/nt))/Ve,hn=function(){return 0},$t=function(bn){return Math.exp(On*Ve*bn)}}return l.duration="duration"in l?+l.duration:1e3*xn/("screenSpeed"in l?+l.screenSpeed/Ve:+l.speed),l.maxDuration&&l.duration>l.maxDuration&&(l.duration=0),this._zooming=!0,this._rotating=I!==G,this._pitching=Y!==A,this._padding=!b.isPaddingEqual(te),this._prepareEase(f,!1),this.terrain&&this._prepareElevation(Le),this._ease(On=>{const bn=On*xn,Cn=1/$t(bn);b.zoom=On===1?be:k+b.scaleZoom(Cn),this._rotating&&(b.bearing=a.z.number(I,G,On)),this._pitching&&(b.pitch=a.z.number(A,Y,On)),this._padding&&(b.interpolatePadding(B,te,On),Te=b.centerPoint.add(me)),this.terrain&&!l.freezeElevation&&this._updateElevation(On);const zn=On===1?Le:b.unproject(et.add(Ie.mult(hn(bn))).mult(Cn));b.setLocationAtPoint(b.renderWorldCopies?zn.wrap():zn,Te),this._applyUpdatedTransform(b),this._fireMoveEvents(f)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(f)},l),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(l,f){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const _=this._onEaseEnd;delete this._onEaseEnd,_.call(this,f)}if(!l){const _=this.handlers;_&&_.stop(!1)}return this}_ease(l,f,_){_.animate===!1||_.duration===0?(l(1),f()):(this._easeStart=y.now(),this._easeOptions=_,this._onEaseFrame=l,this._onEaseEnd=f,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(l,f){l=a.b1(l,-180,180);const _=Math.abs(l-f);return Math.abs(l-360-f)<_&&(l-=360),Math.abs(l+360-f)<_&&(l+=360),l}_normalizeCenter(l){const f=this.transform;if(!f.renderWorldCopies||f.lngRange)return;const _=l.lng-f.center.lng;l.lng+=_>180?-360:_<-180?360:0}queryTerrainElevation(l){return this.terrain?this.terrain.getElevationForLngLatZoom(a.M.convert(l),this.transform.tileZoom)-this.transform.elevation:null}}const dc={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class Co{constructor(l=dc){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=f=>{!f||f.sourceDataType!=="metadata"&&f.sourceDataType!=="visibility"&&f.dataType!=="style"&&f.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=l}getDefaultPosition(){return"bottom-right"}onAdd(l){return this._map=l,this._compact=this.options.compact,this._container=x.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=x.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=x.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){x.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(l,f){const _=this._map._getUIString(`AttributionControl.${f}`);l.title=_,l.setAttribute("aria-label",_)}_updateAttributions(){if(!this._map.style)return;let l=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?l=l.concat(this.options.customAttribution.map(b=>typeof b!="string"?"":b)):typeof this.options.customAttribution=="string"&&l.push(this.options.customAttribution)),this._map.style.stylesheet){const b=this._map.style.stylesheet;this.styleOwner=b.owner,this.styleId=b.id}const f=this._map.style.sourceCaches;for(const b in f){const k=f[b];if(k.used||k.usedForTerrain){const I=k.getSource();I.attribution&&l.indexOf(I.attribution)<0&&l.push(I.attribution)}}l=l.filter(b=>String(b).trim()),l.sort((b,k)=>b.length-k.length),l=l.filter((b,k)=>{for(let I=k+1;I<l.length;I++)if(l[I].indexOf(b)>=0)return!1;return!0});const _=l.join(" | ");_!==this._attribHTML&&(this._attribHTML=_,l.length?(this._innerContainer.innerHTML=_,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class _f{constructor(l={}){this._updateCompact=()=>{const f=this._container.children;if(f.length){const _=f[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&_.classList.add("maplibregl-compact"):_.classList.remove("maplibregl-compact")}},this.options=l}getDefaultPosition(){return"bottom-left"}onAdd(l){this._map=l,this._compact=this.options&&this.options.compact,this._container=x.create("div","maplibregl-ctrl");const f=x.create("a","maplibregl-ctrl-logo");return f.target="_blank",f.rel="noopener nofollow",f.href="https://maplibre.org/",f.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),f.setAttribute("rel","noopener nofollow"),this._container.appendChild(f),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){x.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class rl{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(l){const f=++this._id;return this._queue.push({callback:l,id:f,cancelled:!1}),f}remove(l){const f=this._currentlyRunning,_=f?this._queue.concat(f):this._queue;for(const b of _)if(b.id===l)return void(b.cancelled=!0)}run(l=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const f=this._currentlyRunning=this._queue;this._queue=[];for(const _ of f)if(!_.cancelled&&(_.callback(l),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Fr=a.X([{name:"a_pos3d",type:"Int16",components:3}]);class Zr extends a.E{constructor(l){super(),this.sourceCache=l,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,l.usedForTerrain=!0,l.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(l,f){this.sourceCache.update(l,f),this._renderableTilesKeys=[];const _={};for(const b of l.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:f}))_[b.key]=!0,this._renderableTilesKeys.push(b.key),this._tiles[b.key]||(b.posMatrix=new Float64Array(16),a.aN(b.posMatrix,0,a.W,0,a.W,0,1),this._tiles[b.key]=new Pr(b,this.tileSize));for(const b in this._tiles)_[b]||delete this._tiles[b]}freeRtt(l){for(const f in this._tiles){const _=this._tiles[f];(!l||_.tileID.equals(l)||_.tileID.isChildOf(l)||l.isChildOf(_.tileID))&&(_.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(l=>this.getTileByID(l))}getTileByID(l){return this._tiles[l]}getTerrainCoords(l){const f={};for(const _ of this._renderableTilesKeys){const b=this._tiles[_].tileID;if(b.canonical.equals(l.canonical)){const k=l.clone();k.posMatrix=new Float64Array(16),a.aN(k.posMatrix,0,a.W,0,a.W,0,1),f[_]=k}else if(b.canonical.isChildOf(l.canonical)){const k=l.clone();k.posMatrix=new Float64Array(16);const I=b.canonical.z-l.canonical.z,A=b.canonical.x-(b.canonical.x>>I<<I),B=b.canonical.y-(b.canonical.y>>I<<I),G=a.W>>I;a.aN(k.posMatrix,0,G,0,G,0,1),a.H(k.posMatrix,k.posMatrix,[-A*G,-B*G,0]),f[_]=k}else if(l.canonical.isChildOf(b.canonical)){const k=l.clone();k.posMatrix=new Float64Array(16);const I=l.canonical.z-b.canonical.z,A=l.canonical.x-(l.canonical.x>>I<<I),B=l.canonical.y-(l.canonical.y>>I<<I),G=a.W>>I;a.aN(k.posMatrix,0,a.W,0,a.W,0,1),a.H(k.posMatrix,k.posMatrix,[A*G,B*G,0]),a.J(k.posMatrix,k.posMatrix,[1/2**I,1/2**I,0]),f[_]=k}}return f}getSourceTile(l,f){const _=this.sourceCache._source;let b=l.overscaledZ-this.deltaZoom;if(b>_.maxzoom&&(b=_.maxzoom),b<_.minzoom)return null;this._sourceTileCache[l.key]||(this._sourceTileCache[l.key]=l.scaledTo(b).key);let k=this.sourceCache.getTileByID(this._sourceTileCache[l.key]);if((!k||!k.dem)&&f)for(;b>=_.minzoom&&(!k||!k.dem);)k=this.sourceCache.getTileByID(l.scaledTo(b--).key);return k}tilesAfterTime(l=Date.now()){return Object.values(this._tiles).filter(f=>f.timeAdded>=l)}}class yf{constructor(l,f,_){this.painter=l,this.sourceCache=new Zr(f),this.options=_,this.exaggeration=typeof _.exaggeration=="number"?_.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(l,f,_,b=a.W){var k;if(!(f>=0&&f<b&&_>=0&&_<b))return 0;const I=this.getTerrainData(l),A=(k=I.tile)===null||k===void 0?void 0:k.dem;if(!A)return 0;const B=function(ke,Le,be){var Re=Le[0],et=Le[1];return ke[0]=be[0]*Re+be[4]*et+be[12],ke[1]=be[1]*Re+be[5]*et+be[13],ke}([],[f/b*a.W,_/b*a.W],I.u_terrain_matrix),G=[B[0]*A.dim,B[1]*A.dim],Y=Math.floor(G[0]),te=Math.floor(G[1]),me=G[0]-Y,Te=G[1]-te;return A.get(Y,te)*(1-me)*(1-Te)+A.get(Y+1,te)*me*(1-Te)+A.get(Y,te+1)*(1-me)*Te+A.get(Y+1,te+1)*me*Te}getElevationForLngLatZoom(l,f){const{tileID:_,mercatorX:b,mercatorY:k}=this._getOverscaledTileIDFromLngLatZoom(l,f);return this.getElevation(_,b%a.W,k%a.W,a.W)}getElevation(l,f,_,b=a.W){return this.getDEMElevation(l,f,_,b)*this.exaggeration}getTerrainData(l){if(!this._emptyDemTexture){const b=this.painter.context,k=new a.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new ne(b,k,b.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new ne(b,new a.R({width:1,height:1}),b.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(b.gl.NEAREST,b.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=a.an([])}const f=this.sourceCache.getSourceTile(l,!0);if(f&&f.dem&&(!f.demTexture||f.needsTerrainPrepare)){const b=this.painter.context;f.demTexture=this.painter.getTileTexture(f.dem.stride),f.demTexture?f.demTexture.update(f.dem.getPixels(),{premultiply:!1}):f.demTexture=new ne(b,f.dem.getPixels(),b.gl.RGBA,{premultiply:!1}),f.demTexture.bind(b.gl.NEAREST,b.gl.CLAMP_TO_EDGE),f.needsTerrainPrepare=!1}const _=f&&f+f.tileID.key+l.key;if(_&&!this._demMatrixCache[_]){const b=this.sourceCache.sourceCache._source.maxzoom;let k=l.canonical.z-f.tileID.canonical.z;l.overscaledZ>l.canonical.z&&(l.canonical.z>=b?k=l.canonical.z-b:a.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const I=l.canonical.x-(l.canonical.x>>k<<k),A=l.canonical.y-(l.canonical.y>>k<<k),B=a.b9(new Float64Array(16),[1/(a.W<<k),1/(a.W<<k),0]);a.H(B,B,[I*a.W,A*a.W,0]),this._demMatrixCache[l.key]={matrix:B,coord:l}}return{u_depth:2,u_terrain:3,u_terrain_dim:f&&f.dem&&f.dem.dim||1,u_terrain_matrix:_?this._demMatrixCache[l.key].matrix:this._emptyDemMatrix,u_terrain_unpack:f&&f.dem&&f.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(f&&f.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:f}}getFramebuffer(l){const f=this.painter,_=f.width/devicePixelRatio,b=f.height/devicePixelRatio;return!this._fbo||this._fbo.width===_&&this._fbo.height===b||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new ne(f.context,{width:_,height:b,data:null},f.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(f.context.gl.NEAREST,f.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new ne(f.context,{width:_,height:b,data:null},f.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(f.context.gl.NEAREST,f.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=f.context.createFramebuffer(_,b,!0,!1),this._fbo.depthAttachment.set(f.context.createRenderbuffer(f.context.gl.DEPTH_COMPONENT16,_,b))),this._fbo.colorAttachment.set(l==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const l=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const f=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let k=0,I=0;k<this._coordsTextureSize;k++)for(let A=0;A<this._coordsTextureSize;A++,I+=4)f[I+0]=255&A,f[I+1]=255&k,f[I+2]=A>>8<<4|k>>8,f[I+3]=0;const _=new a.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(f.buffer)),b=new ne(l,_,l.gl.RGBA,{premultiply:!1});return b.bind(l.gl.NEAREST,l.gl.CLAMP_TO_EDGE),this._coordsTexture=b,b}pointCoordinate(l){this.painter.maybeDrawDepthAndCoords(!0);const f=new Uint8Array(4),_=this.painter.context,b=_.gl,k=Math.round(l.x*this.painter.pixelRatio/devicePixelRatio),I=Math.round(l.y*this.painter.pixelRatio/devicePixelRatio),A=Math.round(this.painter.height/devicePixelRatio);_.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),b.readPixels(k,A-I-1,1,1,b.RGBA,b.UNSIGNED_BYTE,f),_.bindFramebuffer.set(null);const B=f[0]+(f[2]>>4<<8),G=f[1]+((15&f[2])<<8),Y=this.coordsIndex[255-f[3]],te=Y&&this.sourceCache.getTileByID(Y);if(!te)return null;const me=this._coordsTextureSize,Te=(1<<te.tileID.canonical.z)*me;return new a.Y((te.tileID.canonical.x*me+B)/Te+te.tileID.wrap,(te.tileID.canonical.y*me+G)/Te,this.getElevation(te.tileID,B,G,me))}depthAtPoint(l){const f=new Uint8Array(4),_=this.painter.context,b=_.gl;return _.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),b.readPixels(l.x,this.painter.height/devicePixelRatio-l.y-1,1,1,b.RGBA,b.UNSIGNED_BYTE,f),_.bindFramebuffer.set(null),(f[0]/16777216+f[1]/65536+f[2]/256+f[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const l=this.painter.context,f=new a.ba,_=new a.aX,b=this.meshSize,k=a.W/b,I=b*b;for(let te=0;te<=b;te++)for(let me=0;me<=b;me++)f.emplaceBack(me*k,te*k,0);for(let te=0;te<I;te+=b+1)for(let me=0;me<b;me++)_.emplaceBack(me+te,b+me+te+1,b+me+te+2),_.emplaceBack(me+te,b+me+te+2,me+te+1);const A=f.length,B=A+2*(b+1);for(const te of[0,1])for(let me=0;me<=b;me++)for(const Te of[0,1])f.emplaceBack(me*k,te*a.W,Te);for(let te=0;te<2*b;te+=2)_.emplaceBack(B+te,B+te+1,B+te+3),_.emplaceBack(B+te,B+te+3,B+te+2),_.emplaceBack(A+te,A+te+3,A+te+1),_.emplaceBack(A+te,A+te+2,A+te+3);const G=f.length,Y=G+2*(b+1);for(const te of[0,1])for(let me=0;me<=b;me++)for(const Te of[0,1])f.emplaceBack(te*a.W,me*k,Te);for(let te=0;te<2*b;te+=2)_.emplaceBack(G+te,G+te+1,G+te+3),_.emplaceBack(G+te,G+te+3,G+te+2),_.emplaceBack(Y+te,Y+te+3,Y+te+1),_.emplaceBack(Y+te,Y+te+2,Y+te+3);return this._mesh={indexBuffer:l.createIndexBuffer(_),vertexBuffer:l.createVertexBuffer(f,Fr.members),segments:a.$.simpleSegment(0,0,f.length,_.length)},this._mesh}getMeshFrameDelta(l){return 2*Math.PI*a.bb/Math.pow(2,l)/5}getMinTileElevationForLngLatZoom(l,f){var _;const{tileID:b}=this._getOverscaledTileIDFromLngLatZoom(l,f);return(_=this.getMinMaxElevation(b).minElevation)!==null&&_!==void 0?_:0}getMinMaxElevation(l){const f=this.getTerrainData(l).tile,_={minElevation:null,maxElevation:null};return f&&f.dem&&(_.minElevation=f.dem.min*this.exaggeration,_.maxElevation=f.dem.max*this.exaggeration),_}_getOverscaledTileIDFromLngLatZoom(l,f){const _=a.Y.fromLngLat(l.wrap()),b=(1<<f)*a.W,k=_.x*b,I=_.y*b,A=Math.floor(k/a.W),B=Math.floor(I/a.W);return{tileID:new a.Q(f,0,f,A,B),mercatorX:k,mercatorY:I}}}class il{constructor(l,f,_){this._context=l,this._size=f,this._tileSize=_,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const l of this._objects)l.texture.destroy(),l.fbo.destroy()}_createObject(l){const f=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),_=new ne(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return _.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),f.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),f.colorAttachment.set(_.texture),{id:l,fbo:f,texture:_,stamp:-1,inUse:!1}}getObjectForId(l){return this._objects[l]}useObject(l){l.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(f=>l.id!==f),this._recentlyUsed.push(l.id)}stampObject(l){l.stamp=++this._stamp}getOrCreateFreeObject(){for(const f of this._recentlyUsed)if(!this._objects[f].inUse)return this._objects[f];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const l=this._createObject(this._objects.length);return this._objects.push(l),l}freeObject(l){l.inUse=!1}freeAllObjects(){for(const l of this._objects)this.freeObject(l)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(l=>!l.inUse)===!1}}const os={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class pc{constructor(l,f){this.painter=l,this.terrain=f,this.pool=new il(l.context,30,f.sourceCache.tileSize*f.qualityFactor)}destruct(){this.pool.destruct()}getTexture(l){return this.pool.getObjectForId(l.rtt[this._stacks.length-1].id).texture}prepareForRender(l,f){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=l._order.filter(_=>!l._layers[_].isHidden(f)),this._coordsDescendingInv={};for(const _ in l.sourceCaches){this._coordsDescendingInv[_]={};const b=l.sourceCaches[_].getVisibleCoordinates();for(const k of b){const I=this.terrain.sourceCache.getTerrainCoords(k);for(const A in I)this._coordsDescendingInv[_][A]||(this._coordsDescendingInv[_][A]=[]),this._coordsDescendingInv[_][A].push(I[A])}}this._coordsDescendingInvStr={};for(const _ of l._order){const b=l._layers[_],k=b.source;if(os[b.type]&&!this._coordsDescendingInvStr[k]){this._coordsDescendingInvStr[k]={};for(const I in this._coordsDescendingInv[k])this._coordsDescendingInvStr[k][I]=this._coordsDescendingInv[k][I].map(A=>A.key).sort().join()}}for(const _ of this._renderableTiles)for(const b in this._coordsDescendingInvStr){const k=this._coordsDescendingInvStr[b][_.tileID.key];k&&k!==_.rttCoords[b]&&(_.rtt=[])}}renderLayer(l){if(l.isHidden(this.painter.transform.zoom))return!1;const f=l.type,_=this.painter,b=this._renderableLayerIds[this._renderableLayerIds.length-1]===l.id;if(os[f]&&(this._prevType&&os[this._prevType]||this._stacks.push([]),this._prevType=f,this._stacks[this._stacks.length-1].push(l.id),!b))return!0;if(os[this._prevType]||os[f]&&b){this._prevType=f;const k=this._stacks.length-1,I=this._stacks[k]||[];for(const A of this._renderableTiles){if(this.pool.isFull()&&(Kl(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(A),A.rtt[k]){const G=this.pool.getObjectForId(A.rtt[k].id);if(G.stamp===A.rtt[k].stamp){this.pool.useObject(G);continue}}const B=this.pool.getOrCreateFreeObject();this.pool.useObject(B),this.pool.stampObject(B),A.rtt[k]={id:B.id,stamp:B.stamp},_.context.bindFramebuffer.set(B.fbo.framebuffer),_.context.clear({color:a.aO.transparent,stencil:0}),_.currentStencilSource=void 0;for(let G=0;G<I.length;G++){const Y=_.style._layers[I[G]],te=Y.source?this._coordsDescendingInv[Y.source][A.tileID.key]:[A.tileID];_.context.viewport.set([0,0,B.fbo.width,B.fbo.height]),_._renderTileClippingMasks(Y,te),_.renderLayer(_,_.style.sourceCaches[Y.source],Y,te),Y.source&&(A.rttCoords[Y.source]=this._coordsDescendingInvStr[Y.source][A.tileID.key])}}return Kl(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),os[f]}return!1}}const mc={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},gc=d,ol={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:dc,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:a.a.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096]},nu=w=>{w.touchstart=w.dragStart,w.touchmoveWindow=w.dragMove,w.touchend=w.dragEnd},_c={showCompass:!0,showZoom:!0,visualizePitch:!1};class yc{constructor(l,f,_=!1){this.mousedown=I=>{this.startMouse(a.e({},I,{ctrlKey:!0,preventDefault:()=>I.preventDefault()}),x.mousePos(this.element,I)),x.addEventListener(window,"mousemove",this.mousemove),x.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=I=>{this.moveMouse(I,x.mousePos(this.element,I))},this.mouseup=I=>{this.mouseRotate.dragEnd(I),this.mousePitch&&this.mousePitch.dragEnd(I),this.offTemp()},this.touchstart=I=>{I.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=x.touchPos(this.element,I.targetTouches)[0],this.startTouch(I,this._startPos),x.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),x.addEventListener(window,"touchend",this.touchend))},this.touchmove=I=>{I.targetTouches.length!==1?this.reset():(this._lastPos=x.touchPos(this.element,I.targetTouches)[0],this.moveTouch(I,this._lastPos))},this.touchend=I=>{I.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const b=l.dragRotate._mouseRotate.getClickTolerance(),k=l.dragRotate._mousePitch.getClickTolerance();this.element=f,this.mouseRotate=fa({clickTolerance:b,enable:!0}),this.touchRotate=(({enable:I,clickTolerance:A,bearingDegreesPerPixelMoved:B=.8})=>{const G=new Gt;return new ha({clickTolerance:A,move:(Y,te)=>({bearingDelta:(te.x-Y.x)*B}),moveStateManager:G,enable:I,assignEvents:nu})})({clickTolerance:b,enable:!0}),this.map=l,_&&(this.mousePitch=da({clickTolerance:k,enable:!0}),this.touchPitch=(({enable:I,clickTolerance:A,pitchDegreesPerPixelMoved:B=-.5})=>{const G=new Gt;return new ha({clickTolerance:A,move:(Y,te)=>({pitchDelta:(te.y-Y.y)*B}),moveStateManager:G,enable:I,assignEvents:nu})})({clickTolerance:k,enable:!0})),x.addEventListener(f,"mousedown",this.mousedown),x.addEventListener(f,"touchstart",this.touchstart,{passive:!1}),x.addEventListener(f,"touchcancel",this.reset)}startMouse(l,f){this.mouseRotate.dragStart(l,f),this.mousePitch&&this.mousePitch.dragStart(l,f),x.disableDrag()}startTouch(l,f){this.touchRotate.dragStart(l,f),this.touchPitch&&this.touchPitch.dragStart(l,f),x.disableDrag()}moveMouse(l,f){const _=this.map,{bearingDelta:b}=this.mouseRotate.dragMove(l,f)||{};if(b&&_.setBearing(_.getBearing()+b),this.mousePitch){const{pitchDelta:k}=this.mousePitch.dragMove(l,f)||{};k&&_.setPitch(_.getPitch()+k)}}moveTouch(l,f){const _=this.map,{bearingDelta:b}=this.touchRotate.dragMove(l,f)||{};if(b&&_.setBearing(_.getBearing()+b),this.touchPitch){const{pitchDelta:k}=this.touchPitch.dragMove(l,f)||{};k&&_.setPitch(_.getPitch()+k)}}off(){const l=this.element;x.removeEventListener(l,"mousedown",this.mousedown),x.removeEventListener(l,"touchstart",this.touchstart,{passive:!1}),x.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),x.removeEventListener(window,"touchend",this.touchend),x.removeEventListener(l,"touchcancel",this.reset),this.offTemp()}offTemp(){x.enableDrag(),x.removeEventListener(window,"mousemove",this.mousemove),x.removeEventListener(window,"mouseup",this.mouseup),x.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),x.removeEventListener(window,"touchend",this.touchend)}}let ss;function ru(w,l,f){const _=new a.M(w.lng,w.lat);if(w=new a.M(w.lng,w.lat),l){const b=new a.M(w.lng-360,w.lat),k=new a.M(w.lng+360,w.lat),I=f.locationPoint(w).distSqr(l);f.locationPoint(b).distSqr(l)<I?w=b:f.locationPoint(k).distSqr(l)<I&&(w=k)}for(;Math.abs(w.lng-f.center.lng)>180;){const b=f.locationPoint(w);if(b.x>=0&&b.y>=0&&b.x<=f.width&&b.y<=f.height)break;w.lng>f.center.lng?w.lng-=360:w.lng+=360}return w.lng!==_.lng&&f.locationPoint(w).y>f.height/2-f.getHorizon()?w:_}const sl={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function iu(w,l,f){const _=w.classList;for(const b in sl)_.remove(`maplibregl-${f}-anchor-${b}`);_.add(`maplibregl-${f}-anchor-${l}`)}class al extends a.E{constructor(l){if(super(),this._onKeyPress=f=>{const _=f.code,b=f.charCode||f.keyCode;_!=="Space"&&_!=="Enter"&&b!==32&&b!==13||this.togglePopup()},this._onMapClick=f=>{const _=f.originalEvent.target,b=this._element;this._popup&&(_===b||b.contains(_))&&this.togglePopup()},this._update=f=>{var _;if(!this._map)return;const b=this._map.loaded()&&!this._map.isMoving();((f==null?void 0:f.type)==="terrain"||(f==null?void 0:f.type)==="render"&&!b)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?ru(this._lngLat,this._flatPos,this._map.transform):(_=this._lngLat)===null||_===void 0?void 0:_.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let k="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?k=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(k=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let I="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?I="rotateX(0deg)":this._pitchAlignment==="map"&&(I=`rotateX(${this._map.getPitch()}deg)`),f&&f.type!=="moveend"||(this._pos=this._pos.round()),x.setTransform(this._element,`${sl[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${I} ${k}`),y.frameAsync(new AbortController).then(()=>{this._updateOpacity(f&&f.type==="moveend")}).catch(()=>{})},this._onMove=f=>{if(!this._isDragging){const _=this._clickTolerance||this._map._clickTolerance;this._isDragging=f.point.dist(this._pointerdownPos)>=_}this._isDragging&&(this._pos=f.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new a.k("dragstart"))),this.fire(new a.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new a.k("dragend")),this._state="inactive"},this._addDragHandler=f=>{this._element.contains(f.originalEvent.target)&&(f.preventDefault(),this._positionDelta=f.point.sub(this._pos).add(this._offset),this._pointerdownPos=f.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=l&&l.anchor||"center",this._color=l&&l.color||"#3FB1CE",this._scale=l&&l.scale||1,this._draggable=l&&l.draggable||!1,this._clickTolerance=l&&l.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=l&&l.rotation||0,this._rotationAlignment=l&&l.rotationAlignment||"auto",this._pitchAlignment=l&&l.pitchAlignment&&l.pitchAlignment!=="auto"?l.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(l==null?void 0:l.opacity,l==null?void 0:l.opacityWhenCovered),l&&l.element)this._element=l.element,this._offset=a.P.convert(l&&l.offset||[0,0]);else{this._defaultMarker=!0,this._element=x.create("div"),this._element.setAttribute("aria-label","Map marker");const f=x.createNS("http://www.w3.org/2000/svg","svg"),_=41,b=27;f.setAttributeNS(null,"display","block"),f.setAttributeNS(null,"height",`${_}px`),f.setAttributeNS(null,"width",`${b}px`),f.setAttributeNS(null,"viewBox",`0 0 ${b} ${_}`);const k=x.createNS("http://www.w3.org/2000/svg","g");k.setAttributeNS(null,"stroke","none"),k.setAttributeNS(null,"stroke-width","1"),k.setAttributeNS(null,"fill","none"),k.setAttributeNS(null,"fill-rule","evenodd");const I=x.createNS("http://www.w3.org/2000/svg","g");I.setAttributeNS(null,"fill-rule","nonzero");const A=x.createNS("http://www.w3.org/2000/svg","g");A.setAttributeNS(null,"transform","translate(3.0, 29.0)"),A.setAttributeNS(null,"fill","#000000");const B=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const Re of B){const et=x.createNS("http://www.w3.org/2000/svg","ellipse");et.setAttributeNS(null,"opacity","0.04"),et.setAttributeNS(null,"cx","10.5"),et.setAttributeNS(null,"cy","5.80029008"),et.setAttributeNS(null,"rx",Re.rx),et.setAttributeNS(null,"ry",Re.ry),A.appendChild(et)}const G=x.createNS("http://www.w3.org/2000/svg","g");G.setAttributeNS(null,"fill",this._color);const Y=x.createNS("http://www.w3.org/2000/svg","path");Y.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),G.appendChild(Y);const te=x.createNS("http://www.w3.org/2000/svg","g");te.setAttributeNS(null,"opacity","0.25"),te.setAttributeNS(null,"fill","#000000");const me=x.createNS("http://www.w3.org/2000/svg","path");me.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),te.appendChild(me);const Te=x.createNS("http://www.w3.org/2000/svg","g");Te.setAttributeNS(null,"transform","translate(6.0, 7.0)"),Te.setAttributeNS(null,"fill","#FFFFFF");const ke=x.createNS("http://www.w3.org/2000/svg","g");ke.setAttributeNS(null,"transform","translate(8.0, 8.0)");const Le=x.createNS("http://www.w3.org/2000/svg","circle");Le.setAttributeNS(null,"fill","#000000"),Le.setAttributeNS(null,"opacity","0.25"),Le.setAttributeNS(null,"cx","5.5"),Le.setAttributeNS(null,"cy","5.5"),Le.setAttributeNS(null,"r","5.4999962");const be=x.createNS("http://www.w3.org/2000/svg","circle");be.setAttributeNS(null,"fill","#FFFFFF"),be.setAttributeNS(null,"cx","5.5"),be.setAttributeNS(null,"cy","5.5"),be.setAttributeNS(null,"r","5.4999962"),ke.appendChild(Le),ke.appendChild(be),I.appendChild(A),I.appendChild(G),I.appendChild(te),I.appendChild(Te),I.appendChild(ke),f.appendChild(I),f.setAttributeNS(null,"height",_*this._scale+"px"),f.setAttributeNS(null,"width",b*this._scale+"px"),this._element.appendChild(f),this._offset=a.P.convert(l&&l.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",f=>{f.preventDefault()}),this._element.addEventListener("mousedown",f=>{f.preventDefault()}),iu(this._element,this._anchor,"marker"),l&&l.className)for(const f of l.className.split(" "))this._element.classList.add(f);this._popup=null}addTo(l){return this.remove(),this._map=l,l.getCanvasContainer().appendChild(this._element),l.on("move",this._update),l.on("moveend",this._update),l.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),x.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(l){return this._lngLat=a.M.convert(l),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(l){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),l){if(!("offset"in l.options)){const b=Math.abs(13.5)/Math.SQRT2;l.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[b,-1*(38.1-13.5+b)],"bottom-right":[-b,-1*(38.1-13.5+b)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=l,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){const l=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:l?(l.isOpen()?l.remove():(l.setLngLat(this._lngLat),l.addTo(this._map)),this):this}_updateOpacity(l=!1){var f,_;if(!(!((f=this._map)===null||f===void 0)&&f.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(l)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const b=this._map,k=b.terrain.depthAtPoint(this._pos),I=b.terrain.getElevationForLngLatZoom(this._lngLat,b.transform.tileZoom);if(b.transform.lngLatToCameraDepth(this._lngLat,I)-k<.006)return void(this._element.style.opacity=this._opacity);const A=-this._offset.y/b.transform._pixelPerMeter,B=Math.sin(b.getPitch()*Math.PI/180)*A,G=b.terrain.depthAtPoint(new a.P(this._pos.x,this._pos.y-this._offset.y)),Y=b.transform.lngLatToCameraDepth(this._lngLat,I+B)-G>.006;!((_=this._popup)===null||_===void 0)&&_.isOpen()&&Y&&this._popup.remove(),this._element.style.opacity=Y?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(l){return this._offset=a.P.convert(l),this._update(),this}addClassName(l){this._element.classList.add(l)}removeClassName(l){this._element.classList.remove(l)}toggleClassName(l){return this._element.classList.toggle(l)}setDraggable(l){return this._draggable=!!l,this._map&&(l?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(l){return this._rotation=l||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(l){return this._rotationAlignment=l||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(l){return this._pitchAlignment=l&&l!=="auto"?l:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(l,f){return l===void 0&&f===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),l!==void 0&&(this._opacity=l),f!==void 0&&(this._opacityWhenCovered=f),this._map&&this._updateOpacity(!0),this}}const ou={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let ma=0,$s=!1;const su={maxWidth:100,unit:"metric"};function au(w,l,f){const _=f&&f.maxWidth||100,b=w._container.clientHeight/2,k=w.unproject([0,b]),I=w.unproject([_,b]),A=k.distanceTo(I);if(f&&f.unit==="imperial"){const B=3.2808*A;B>5280?Os(l,_,B/5280,w._getUIString("ScaleControl.Miles")):Os(l,_,B,w._getUIString("ScaleControl.Feet"))}else f&&f.unit==="nautical"?Os(l,_,A/1852,w._getUIString("ScaleControl.NauticalMiles")):A>=1e3?Os(l,_,A/1e3,w._getUIString("ScaleControl.Kilometers")):Os(l,_,A,w._getUIString("ScaleControl.Meters"))}function Os(w,l,f,_){const b=function(k){const I=Math.pow(10,`${Math.floor(k)}`.length-1);let A=k/I;return A=A>=10?10:A>=5?5:A>=3?3:A>=2?2:A>=1?1:function(B){const G=Math.pow(10,Math.ceil(-Math.log(B)/Math.LN10));return Math.round(B*G)/G}(A),I*A}(f);w.style.width=l*(b/f)+"px",w.innerHTML=`${b}&nbsp;${_}`}const bc={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},vc=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function lu(w){if(w){if(typeof w=="number"){const l=Math.round(Math.abs(w)/Math.SQRT2);return{center:new a.P(0,0),top:new a.P(0,w),"top-left":new a.P(l,l),"top-right":new a.P(-l,l),bottom:new a.P(0,-w),"bottom-left":new a.P(l,-l),"bottom-right":new a.P(-l,-l),left:new a.P(w,0),right:new a.P(-w,0)}}if(w instanceof a.P||Array.isArray(w)){const l=a.P.convert(w);return{center:l,top:l,"top-left":l,"top-right":l,bottom:l,"bottom-left":l,"bottom-right":l,left:l,right:l}}return{center:a.P.convert(w.center||[0,0]),top:a.P.convert(w.top||[0,0]),"top-left":a.P.convert(w["top-left"]||[0,0]),"top-right":a.P.convert(w["top-right"]||[0,0]),bottom:a.P.convert(w.bottom||[0,0]),"bottom-left":a.P.convert(w["bottom-left"]||[0,0]),"bottom-right":a.P.convert(w["bottom-right"]||[0,0]),left:a.P.convert(w.left||[0,0]),right:a.P.convert(w.right||[0,0])}}return lu(new a.P(0,0))}const bf=d;u.AJAXError=a.be,u.Evented=a.E,u.LngLat=a.M,u.MercatorCoordinate=a.Y,u.Point=a.P,u.addProtocol=a.bf,u.config=a.a,u.removeProtocol=a.bg,u.AttributionControl=Co,u.BoxZoomHandler=So,u.CanvasSource=_r,u.CooperativeGesturesHandler=tn,u.DoubleClickZoomHandler=hc,u.DragPanHandler=gf,u.DragRotateHandler=To,u.EdgeInsets=ua,u.FullscreenControl=class extends a.E{constructor(w={}){super(),this._onFullscreenChange=()=>{var l;let f=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((l=f==null?void 0:f.shadowRoot)===null||l===void 0)&&l.fullscreenElement;)f=f.shadowRoot.fullscreenElement;f===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,w&&w.container&&(w.container instanceof HTMLElement?this._container=w.container:a.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(w){return this._map=w,this._container||(this._container=this._map.getContainer()),this._controlContainer=x.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){x.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const w=this._fullscreenButton=x.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);x.create("span","maplibregl-ctrl-icon",w).setAttribute("aria-hidden","true"),w.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const w=this._getTitle();this._fullscreenButton.setAttribute("aria-label",w),this._fullscreenButton.title=w}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new a.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new a.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},u.GeoJSONSource=Ue,u.GeolocateControl=class extends a.E{constructor(w){super(),this._onSuccess=l=>{if(this._map){if(this._isOutOfMapMaxBounds(l))return this._setErrorState(),this.fire(new a.k("outofmaxbounds",l)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=l,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(l),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(l),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new a.k("geolocate",l)),this._finish()}},this._updateCamera=l=>{const f=new a.M(l.coords.longitude,l.coords.latitude),_=l.coords.accuracy,b=this._map.getBearing(),k=a.e({bearing:b},this.options.fitBoundsOptions),I=qe.fromLngLat(f,_);this._map.fitBounds(I,k,{geolocateSource:!0})},this._updateMarker=l=>{if(l){const f=new a.M(l.coords.longitude,l.coords.latitude);this._accuracyCircleMarker.setLngLat(f).addTo(this._map),this._userLocationDotMarker.setLngLat(f).addTo(this._map),this._accuracy=l.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=l=>{if(this._map){if(this.options.trackUserLocation)if(l.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const f=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=f,this._geolocateButton.setAttribute("aria-label",f),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(l.code===3&&$s)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new a.k("error",l)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=l=>{if(this._map){if(this._container.addEventListener("contextmenu",f=>f.preventDefault()),this._geolocateButton=x.create("button","maplibregl-ctrl-geolocate",this._container),x.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",l===!1){a.w("Geolocation support is not available so the GeolocateControl will be disabled.");const f=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=f,this._geolocateButton.setAttribute("aria-label",f)}else{const f=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=f,this._geolocateButton.setAttribute("aria-label",f)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=x.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new al({element:this._dotElement}),this._circleElement=x.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new al({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",f=>{f.geolocateSource||this._watchState!=="ACTIVE_LOCK"||f.originalEvent&&f.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new a.k("trackuserlocationend")))})}},this.options=a.e({},ou,w)}onAdd(w){return this._map=w,this._container=x.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(){return a._(this,arguments,void 0,function*(l=!1){if(ss!==void 0&&!l)return ss;if(window.navigator.permissions===void 0)return ss=!!window.navigator.geolocation,ss;try{ss=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{ss=!!window.navigator.geolocation}return ss})}().then(l=>this._setupUI(l)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),x.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,ma=0,$s=!1}_isOutOfMapMaxBounds(w){const l=this._map.getMaxBounds(),f=w.coords;return l&&(f.longitude<l.getWest()||f.longitude>l.getEast()||f.latitude<l.getSouth()||f.latitude>l.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const w=this._map.getBounds(),l=w.getSouthEast(),f=w.getNorthEast(),_=l.distanceTo(f),b=Math.ceil(this._accuracy/(_/this._map._container.clientHeight)*2);this._circleElement.style.width=`${b}px`,this._circleElement.style.height=`${b}px`}trigger(){if(!this._setup)return a.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new a.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":ma--,$s=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new a.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new a.k("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let w;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),ma++,ma>1?(w={maximumAge:6e5,timeout:0},$s=!0):(w=this.options.positionOptions,$s=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,w)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},u.Hash=ac,u.ImageSource=Wt,u.KeyboardHandler=xs,u.LngLatBounds=qe,u.LogoControl=_f,u.Map=class extends $i{constructor(w){if(a.bc.mark(a.bd.create),(w=a.e({},ol,w)).minZoom!=null&&w.maxZoom!=null&&w.minZoom>w.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(w.minPitch!=null&&w.maxPitch!=null&&w.minPitch>w.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(w.minPitch!=null&&w.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(w.maxPitch!=null&&w.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new Xl(w.minZoom,w.maxZoom,w.minPitch,w.maxPitch,w.renderWorldCopies),{bearingSnap:w.bearingSnap}),this._contextLost=l=>{l.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new a.k("webglcontextlost",{originalEvent:l}))},this._contextRestored=l=>{this._setupPainter(),this.resize(),this._update(),this.fire(new a.k("webglcontextrestored",{originalEvent:l}))},this._onMapScroll=l=>{if(l.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=w.interactive,this._maxTileCacheSize=w.maxTileCacheSize,this._maxTileCacheZoomLevels=w.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=w.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=w.preserveDrawingBuffer,this._antialias=w.antialias,this._trackResize=w.trackResize,this._bearingSnap=w.bearingSnap,this._refreshExpiredTiles=w.refreshExpiredTiles,this._fadeDuration=w.fadeDuration,this._crossSourceCollisions=w.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=w.collectResourceTiming,this._renderTaskQueue=new rl,this._controls=[],this._mapId=a.a3(),this._locale=a.e({},mc,w.locale),this._clickTolerance=w.clickTolerance,this._overridePixelRatio=w.pixelRatio,this._maxCanvasSize=w.maxCanvasSize,this.transformCameraUpdate=w.transformCameraUpdate,this._imageQueueHandle=$.addThrottleControl(()=>this.isMoving()),this._requestManager=new U(w.transformRequest),typeof w.container=="string"){if(this._container=document.getElementById(w.container),!this._container)throw new Error(`Container '${w.container}' not found.`)}else{if(!(w.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=w.container}if(w.maxBounds&&this.setMaxBounds(w.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let l=!1;const f=sc(_=>{this._trackResize&&!this._removed&&this.resize(_)._update()},50);this._resizeObserver=new ResizeObserver(_=>{l?f(_):l=!0}),this._resizeObserver.observe(this._container)}this.handlers=new fc(this,w),this._hash=w.hash&&new ac(typeof w.hash=="string"&&w.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:w.center,zoom:w.zoom,bearing:w.bearing,pitch:w.pitch}),w.bounds&&(this.resize(),this.fitBounds(w.bounds,a.e({},w.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=w.localIdeographFontFamily,this._validateStyle=w.validateStyle,w.style&&this.setStyle(w.style,{localIdeographFontFamily:w.localIdeographFontFamily}),w.attributionControl&&this.addControl(new Co(typeof w.attributionControl=="boolean"?void 0:w.attributionControl)),w.maplibreLogo&&this.addControl(new _f,w.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",l=>{this._update(l.dataType==="style"),this.fire(new a.k(`${l.dataType}data`,l))}),this.on("dataloading",l=>{this.fire(new a.k(`${l.dataType}dataloading`,l))}),this.on("dataabort",l=>{this.fire(new a.k("sourcedataabort",l))})}_getMapId(){return this._mapId}addControl(w,l){if(l===void 0&&(l=w.getDefaultPosition?w.getDefaultPosition():"top-right"),!w||!w.onAdd)return this.fire(new a.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const f=w.onAdd(this);this._controls.push(w);const _=this._controlPositions[l];return l.indexOf("bottom")!==-1?_.insertBefore(f,_.firstChild):_.appendChild(f),this}removeControl(w){if(!w||!w.onRemove)return this.fire(new a.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const l=this._controls.indexOf(w);return l>-1&&this._controls.splice(l,1),w.onRemove(this),this}hasControl(w){return this._controls.indexOf(w)>-1}calculateCameraOptionsFromTo(w,l,f,_){return _==null&&this.terrain&&(_=this.terrain.getElevationForLngLatZoom(f,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(w,l,f,_)}resize(w){var l;const f=this._containerDimensions(),_=f[0],b=f[1],k=this._getClampedPixelRatio(_,b);if(this._resizeCanvas(_,b,k),this.painter.resize(_,b,k),this.painter.overLimit()){const A=this.painter.context.gl;this._maxCanvasSize=[A.drawingBufferWidth,A.drawingBufferHeight];const B=this._getClampedPixelRatio(_,b);this._resizeCanvas(_,b,B),this.painter.resize(_,b,B)}this.transform.resize(_,b),(l=this._requestedCameraState)===null||l===void 0||l.resize(_,b);const I=!this._moving;return I&&(this.stop(),this.fire(new a.k("movestart",w)).fire(new a.k("move",w))),this.fire(new a.k("resize",w)),I&&this.fire(new a.k("moveend",w)),this}_getClampedPixelRatio(w,l){const{0:f,1:_}=this._maxCanvasSize,b=this.getPixelRatio(),k=w*b,I=l*b;return Math.min(k>f?f/k:1,I>_?_/I:1)*b}getPixelRatio(){var w;return(w=this._overridePixelRatio)!==null&&w!==void 0?w:devicePixelRatio}setPixelRatio(w){this._overridePixelRatio=w,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(w){return this.transform.setMaxBounds(qe.convert(w)),this._update()}setMinZoom(w){if((w=w??-2)>=-2&&w<=this.transform.maxZoom)return this.transform.minZoom=w,this._update(),this.getZoom()<w&&this.setZoom(w),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(w){if((w=w??22)>=this.transform.minZoom)return this.transform.maxZoom=w,this._update(),this.getZoom()>w&&this.setZoom(w),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(w){if((w=w??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(w>=0&&w<=this.transform.maxPitch)return this.transform.minPitch=w,this._update(),this.getPitch()<w&&this.setPitch(w),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(w){if((w=w??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(w>=this.transform.minPitch)return this.transform.maxPitch=w,this._update(),this.getPitch()>w&&this.setPitch(w),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(w){return this.transform.renderWorldCopies=w,this._update()}project(w){return this.transform.locationPoint(a.M.convert(w),this.style&&this.terrain)}unproject(w){return this.transform.pointLocation(a.P.convert(w),this.terrain)}isMoving(){var w;return this._moving||((w=this.handlers)===null||w===void 0?void 0:w.isMoving())}isZooming(){var w;return this._zooming||((w=this.handlers)===null||w===void 0?void 0:w.isZooming())}isRotating(){var w;return this._rotating||((w=this.handlers)===null||w===void 0?void 0:w.isRotating())}_createDelegatedListener(w,l,f){if(w==="mouseenter"||w==="mouseover"){let _=!1;return{layer:l,listener:f,delegates:{mousemove:k=>{const I=this.getLayer(l)?this.queryRenderedFeatures(k.point,{layers:[l]}):[];I.length?_||(_=!0,f.call(this,new Bi(w,this,k.originalEvent,{features:I}))):_=!1},mouseout:()=>{_=!1}}}}if(w==="mouseleave"||w==="mouseout"){let _=!1;return{layer:l,listener:f,delegates:{mousemove:I=>{(this.getLayer(l)?this.queryRenderedFeatures(I.point,{layers:[l]}):[]).length?_=!0:_&&(_=!1,f.call(this,new Bi(w,this,I.originalEvent)))},mouseout:I=>{_&&(_=!1,f.call(this,new Bi(w,this,I.originalEvent)))}}}}{const _=b=>{const k=this.getLayer(l)?this.queryRenderedFeatures(b.point,{layers:[l]}):[];k.length&&(b.features=k,f.call(this,b),delete b.features)};return{layer:l,listener:f,delegates:{[w]:_}}}}on(w,l,f){if(f===void 0)return super.on(w,l);const _=this._createDelegatedListener(w,l,f);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[w]=this._delegatedListeners[w]||[],this._delegatedListeners[w].push(_);for(const b in _.delegates)this.on(b,_.delegates[b]);return this}once(w,l,f){if(f===void 0)return super.once(w,l);const _=this._createDelegatedListener(w,l,f);for(const b in _.delegates)this.once(b,_.delegates[b]);return this}off(w,l,f){return f===void 0?super.off(w,l):(this._delegatedListeners&&this._delegatedListeners[w]&&(_=>{const b=this._delegatedListeners[w];for(let k=0;k<b.length;k++){const I=b[k];if(I.layer===l&&I.listener===f){for(const A in I.delegates)this.off(A,I.delegates[A]);return b.splice(k,1),this}}})(),this)}queryRenderedFeatures(w,l){if(!this.style)return[];let f;const _=w instanceof a.P||Array.isArray(w),b=_?w:[[0,0],[this.transform.width,this.transform.height]];if(l=l||(_?{}:w)||{},b instanceof a.P||typeof b[0]=="number")f=[a.P.convert(b)];else{const k=a.P.convert(b[0]),I=a.P.convert(b[1]);f=[k,new a.P(I.x,k.y),I,new a.P(k.x,I.y),k]}return this.style.queryRenderedFeatures(f,l,this.transform)}querySourceFeatures(w,l){return this.style.querySourceFeatures(w,l)}setStyle(w,l){return(l=a.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},l)).diff!==!1&&l.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&w?(this._diffStyle(w,l),this):(this._localIdeographFontFamily=l.localIdeographFontFamily,this._updateStyle(w,l))}setTransformRequest(w){return this._requestManager.setTransformRequest(w),this}_getUIString(w){const l=this._locale[w];if(l==null)throw new Error(`Missing UI string '${w}'`);return l}_updateStyle(w,l){if(l.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(w,l));const f=this.style&&l.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!w)),w?(this.style=new Qi(this,l||{}),this.style.setEventedParent(this,{style:this.style}),typeof w=="string"?this.style.loadURL(w,l,f):this.style.loadJSON(w,l,f),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Qi(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(w,l){if(typeof w=="string"){const f=this._requestManager.transformRequest(w,"Style");a.h(f,new AbortController).then(_=>{this._updateDiff(_.data,l)}).catch(_=>{_&&this.fire(new a.j(_))})}else typeof w=="object"&&this._updateDiff(w,l)}_updateDiff(w,l){try{this.style.setState(w,l)&&this._update(!0)}catch(f){a.w(`Unable to perform style diff: ${f.message||f.error||f}.  Rebuilding the style from scratch.`),this._updateStyle(w,l)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():a.w("There is no style added to the map.")}addSource(w,l){return this._lazyInitEmptyStyle(),this.style.addSource(w,l),this._update(!0)}isSourceLoaded(w){const l=this.style&&this.style.sourceCaches[w];if(l!==void 0)return l.loaded();this.fire(new a.j(new Error(`There is no source with ID '${w}'`)))}setTerrain(w){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),w){const l=this.style.sourceCaches[w.source];if(!l)throw new Error(`cannot load terrain, because there exists no source with ID: ${w.source}`);this.terrain===null&&l.reload();for(const f in this.style._layers){const _=this.style._layers[f];_.type==="hillshade"&&_.source===w.source&&a.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new yf(this.painter,l,w),this.painter.renderToTexture=new pc(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=f=>{f.dataType==="style"?this.terrain.sourceCache.freeRtt():f.dataType==="source"&&f.tile&&(f.sourceId!==w.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(f.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new a.k("terrain",{terrain:w})),this}getTerrain(){var w,l;return(l=(w=this.terrain)===null||w===void 0?void 0:w.options)!==null&&l!==void 0?l:null}areTilesLoaded(){const w=this.style&&this.style.sourceCaches;for(const l in w){const f=w[l]._tiles;for(const _ in f){const b=f[_];if(b.state!=="loaded"&&b.state!=="errored")return!1}}return!0}removeSource(w){return this.style.removeSource(w),this._update(!0)}getSource(w){return this.style.getSource(w)}addImage(w,l,f={}){const{pixelRatio:_=1,sdf:b=!1,stretchX:k,stretchY:I,content:A}=f;if(this._lazyInitEmptyStyle(),!(l instanceof HTMLImageElement||a.b(l))){if(l.width===void 0||l.height===void 0)return this.fire(new a.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:B,height:G,data:Y}=l,te=l;return this.style.addImage(w,{data:new a.R({width:B,height:G},new Uint8Array(Y)),pixelRatio:_,stretchX:k,stretchY:I,content:A,sdf:b,version:0,userImage:te}),te.onAdd&&te.onAdd(this,w),this}}{const{width:B,height:G,data:Y}=y.getImageData(l);this.style.addImage(w,{data:new a.R({width:B,height:G},Y),pixelRatio:_,stretchX:k,stretchY:I,content:A,sdf:b,version:0})}}updateImage(w,l){const f=this.style.getImage(w);if(!f)return this.fire(new a.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const _=l instanceof HTMLImageElement||a.b(l)?y.getImageData(l):l,{width:b,height:k,data:I}=_;if(b===void 0||k===void 0)return this.fire(new a.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(b!==f.data.width||k!==f.data.height)return this.fire(new a.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const A=!(l instanceof HTMLImageElement||a.b(l));return f.data.replace(I,A),this.style.updateImage(w,f),this}getImage(w){return this.style.getImage(w)}hasImage(w){return w?!!this.style.getImage(w):(this.fire(new a.j(new Error("Missing required image id"))),!1)}removeImage(w){this.style.removeImage(w)}loadImage(w){return $.getImage(this._requestManager.transformRequest(w,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(w,l){return this._lazyInitEmptyStyle(),this.style.addLayer(w,l),this._update(!0)}moveLayer(w,l){return this.style.moveLayer(w,l),this._update(!0)}removeLayer(w){return this.style.removeLayer(w),this._update(!0)}getLayer(w){return this.style.getLayer(w)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(w,l,f){return this.style.setLayerZoomRange(w,l,f),this._update(!0)}setFilter(w,l,f={}){return this.style.setFilter(w,l,f),this._update(!0)}getFilter(w){return this.style.getFilter(w)}setPaintProperty(w,l,f,_={}){return this.style.setPaintProperty(w,l,f,_),this._update(!0)}getPaintProperty(w,l){return this.style.getPaintProperty(w,l)}setLayoutProperty(w,l,f,_={}){return this.style.setLayoutProperty(w,l,f,_),this._update(!0)}getLayoutProperty(w,l){return this.style.getLayoutProperty(w,l)}setGlyphs(w,l={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(w,l),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(w,l,f={}){return this._lazyInitEmptyStyle(),this.style.addSprite(w,l,f,_=>{_||this._update(!0)}),this}removeSprite(w){return this._lazyInitEmptyStyle(),this.style.removeSprite(w),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(w,l={}){return this._lazyInitEmptyStyle(),this.style.setSprite(w,l,f=>{f||this._update(!0)}),this}setLight(w,l={}){return this._lazyInitEmptyStyle(),this.style.setLight(w,l),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(w,l){return this.style.setFeatureState(w,l),this._update()}removeFeatureState(w,l){return this.style.removeFeatureState(w,l),this._update()}getFeatureState(w){return this.style.getFeatureState(w)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let w=0,l=0;return this._container&&(w=this._container.clientWidth||400,l=this._container.clientHeight||300),[w,l]}_setupContainer(){const w=this._container;w.classList.add("maplibregl-map");const l=this._canvasContainer=x.create("div","maplibregl-canvas-container",w);this._interactive&&l.classList.add("maplibregl-interactive"),this._canvas=x.create("canvas","maplibregl-canvas",l),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const f=this._containerDimensions(),_=this._getClampedPixelRatio(f[0],f[1]);this._resizeCanvas(f[0],f[1],_);const b=this._controlContainer=x.create("div","maplibregl-control-container",w),k=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(I=>{k[I]=x.create("div",`maplibregl-ctrl-${I} `,b)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(w,l,f){this._canvas.width=Math.floor(f*w),this._canvas.height=Math.floor(f*l),this._canvas.style.width=`${w}px`,this._canvas.style.height=`${l}px`}_setupPainter(){const w={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let l=null;this._canvas.addEventListener("webglcontextcreationerror",_=>{l={requestedAttributes:w},_&&(l.statusMessage=_.statusMessage,l.type=_.type)},{once:!0});const f=this._canvas.getContext("webgl2",w)||this._canvas.getContext("webgl",w);if(!f){const _="Failed to initialize WebGL";throw l?(l.message=_,new Error(JSON.stringify(l))):new Error(_)}this.painter=new of(f,this.transform),C.testSupport(f)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(w){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||w,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(w){return this._update(),this._renderTaskQueue.add(w)}_cancelRenderFrame(w){this._renderTaskQueue.remove(w)}_render(w){const l=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(w),this._removed)return;let f=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const b=this.transform.zoom,k=y.now();this.style.zoomHistory.update(b,k);const I=new a.a8(b,{now:k,fadeDuration:l,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),A=I.crossFadingFactor();A===1&&A===this._crossFadingFactor||(f=!0,this._crossFadingFactor=A),this.style.update(I)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,l,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:l,showPadding:this.showPadding}),this.fire(new a.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,a.bc.mark(a.bd.load),this.fire(new a.k("load"))),this.style&&(this.style.hasTransitions()||f)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const _=this._sourcesDirty||this._styleDirty||this._placementDirty;return _||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new a.k("idle")),!this._loaded||this._fullyLoaded||_||(this._fullyLoaded=!0,a.bc.mark(a.bd.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var w;this._hash&&this._hash.remove();for(const f of this._controls)f.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),$.removeThrottleControl(this._imageQueueHandle),(w=this._resizeObserver)===null||w===void 0||w.disconnect();const l=this.painter.context.gl.getExtension("WEBGL_lose_context");l&&l.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),x.remove(this._canvasContainer),x.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),a.bc.clearMetrics(),this._removed=!0,this.fire(new a.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,y.frameAsync(this._frameRequest).then(w=>{a.bc.frame(w),this._frameRequest=null,this._render(w)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(w){this._showTileBoundaries!==w&&(this._showTileBoundaries=w,this._update())}get showPadding(){return!!this._showPadding}set showPadding(w){this._showPadding!==w&&(this._showPadding=w,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(w){this._showCollisionBoxes!==w&&(this._showCollisionBoxes=w,w?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(w){this._showOverdrawInspector!==w&&(this._showOverdrawInspector=w,this._update())}get repaint(){return!!this._repaint}set repaint(w){this._repaint!==w&&(this._repaint=w,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(w){this._vertices=w,this._update()}get version(){return gc}getCameraTargetElevation(){return this.transform.elevation}},u.MapMouseEvent=Bi,u.MapTouchEvent=Vo,u.MapWheelEvent=lc,u.Marker=al,u.NavigationControl=class{constructor(w){this._updateZoomButtons=()=>{const l=this._map.getZoom(),f=l===this._map.getMaxZoom(),_=l===this._map.getMinZoom();this._zoomInButton.disabled=f,this._zoomOutButton.disabled=_,this._zoomInButton.setAttribute("aria-disabled",f.toString()),this._zoomOutButton.setAttribute("aria-disabled",_.toString())},this._rotateCompassArrow=()=>{const l=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=l},this._setButtonTitle=(l,f)=>{const _=this._map._getUIString(`NavigationControl.${f}`);l.title=_,l.setAttribute("aria-label",_)},this.options=a.e({},_c,w),this._container=x.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",l=>l.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",l=>this._map.zoomIn({},{originalEvent:l})),x.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",l=>this._map.zoomOut({},{originalEvent:l})),x.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",l=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:l}):this._map.resetNorth({},{originalEvent:l})}),this._compassIcon=x.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(w){return this._map=w,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new yc(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){x.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(w,l){const f=x.create("button",w,this._container);return f.type="button",f.addEventListener("click",l),f}},u.Popup=class extends a.E{constructor(w){super(),this.remove=()=>(this._content&&x.remove(this._content),this._container&&(x.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new a.k("close"))),this),this._onMouseUp=l=>{this._update(l.point)},this._onMouseMove=l=>{this._update(l.point)},this._onDrag=l=>{this._update(l.point)},this._update=l=>{var f;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=x.create("div","maplibregl-popup",this._map.getContainer()),this._tip=x.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const A of this.options.className.split(" "))this._container.classList.add(A);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?ru(this._lngLat,this._flatPos,this._map.transform):(f=this._lngLat)===null||f===void 0?void 0:f.wrap(),this._trackPointer&&!l)return;const _=this._flatPos=this._pos=this._trackPointer&&l?l:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&l?l:this._map.transform.locationPoint(this._lngLat));let b=this.options.anchor;const k=lu(this.options.offset);if(!b){const A=this._container.offsetWidth,B=this._container.offsetHeight;let G;G=_.y+k.bottom.y<B?["top"]:_.y>this._map.transform.height-B?["bottom"]:[],_.x<A/2?G.push("left"):_.x>this._map.transform.width-A/2&&G.push("right"),b=G.length===0?"bottom":G.join("-")}let I=_.add(k[b]);this.options.subpixelPositioning||(I=I.round()),x.setTransform(this._container,`${sl[b]} translate(${I.x}px,${I.y}px)`),iu(this._container,b,"popup")},this._onClose=()=>{this.remove()},this.options=a.e(Object.create(bc),w)}addTo(w){return this._map&&this.remove(),this._map=w,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new a.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(w){return this._lngLat=a.M.convert(w),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(w){return this.setDOMContent(document.createTextNode(w))}setHTML(w){const l=document.createDocumentFragment(),f=document.createElement("body");let _;for(f.innerHTML=w;_=f.firstChild,_;)l.appendChild(_);return this.setDOMContent(l)}getMaxWidth(){var w;return(w=this._container)===null||w===void 0?void 0:w.style.maxWidth}setMaxWidth(w){return this.options.maxWidth=w,this._update(),this}setDOMContent(w){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=x.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(w),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(w){this._container&&this._container.classList.add(w)}removeClassName(w){this._container&&this._container.classList.remove(w)}setOffset(w){return this.options.offset=w,this._update(),this}toggleClassName(w){if(this._container)return this._container.classList.toggle(w)}setSubpixelPositioning(w){this.options.subpixelPositioning=w}_createCloseButton(){this.options.closeButton&&(this._closeButton=x.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const w=this._container.querySelector(vc);w&&w.focus()}},u.RasterDEMTileSource=kn,u.RasterTileSource=ye,u.ScaleControl=class{constructor(w){this._onMove=()=>{au(this._map,this._container,this.options)},this.setUnit=l=>{this.options.unit=l,au(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},su),w)}getDefaultPosition(){return"bottom-left"}onAdd(w){return this._map=w,this._container=x.create("div","maplibregl-ctrl maplibregl-ctrl-scale",w.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){x.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},u.ScrollZoomHandler=eu,u.Style=Qi,u.TerrainControl=class{constructor(w){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=w}onAdd(w){return this._map=w,this._container=x.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=x.create("button","maplibregl-ctrl-terrain",this._container),x.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){x.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},u.TwoFingersTouchPitchHandler=df,u.TwoFingersTouchRotateHandler=cc,u.TwoFingersTouchZoomHandler=ff,u.TwoFingersTouchZoomRotateHandler=tl,u.VectorTileSource=Et,u.VideoSource=cr,u.addSourceType=(w,l)=>a._(void 0,void 0,void 0,function*(){if(ni(w))throw new Error(`A source type called "${w}" already exists.`);((f,_)=>{yr[f]=_})(w,l)}),u.clearPrewarmedResources=function(){const w=Ft;w&&(w.isPreloaded()&&w.numActive()===1?(w.release(wt),Ft=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},u.getMaxParallelImageRequests=function(){return a.a.MAX_PARALLEL_IMAGE_REQUESTS},u.getRTLTextPluginStatus=function(){return vt().getRTLTextPluginStatus()},u.getVersion=function(){return bf},u.getWorkerCount=function(){return pt.workerCount},u.getWorkerUrl=function(){return a.a.WORKER_URL},u.importScriptInWorkers=function(w){return Qt().broadcast("IS",w)},u.prewarm=function(){Bt().acquire(wt)},u.setMaxParallelImageRequests=function(w){a.a.MAX_PARALLEL_IMAGE_REQUESTS=w},u.setRTLTextPlugin=function(w,l){return vt().setRTLTextPlugin(w,l)},u.setWorkerCount=function(w){pt.workerCount=w},u.setWorkerUrl=function(w){a.a.WORKER_URL=w}});var o=t;return o})})(Rb);var Ys=Rb.exports;const ei=Db(Ys),Lx=sx({__proto__:null,default:ei},[Ys]);let nn;const Bb=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&Bb.decode();let Yc=null;function sh(){return(Yc===null||Yc.byteLength===0)&&(Yc=new Uint8Array(nn.memory.buffer)),Yc}function Xo(r,e){return r=r>>>0,Bb.decode(sh().subarray(r,r+e))}const Ws=new Array(128).fill(void 0);Ws.push(void 0,null,!0,!1);let ah=Ws.length;function Qr(r){ah===Ws.length&&Ws.push(Ws.length+1);const e=ah;return ah=Ws[e],Ws[e]=r,e}function Nn(r){return Ws[r]}function Ex(r){r<132||(Ws[r]=ah,ah=r)}function Eu(r){const e=Nn(r);return Ex(r),e}function Up(r){return r==null}let Qc=null;function Ix(){return(Qc===null||Qc.byteLength===0)&&(Qc=new Float64Array(nn.memory.buffer)),Qc}let eh=null;function Hn(){return(eh===null||eh.byteLength===0)&&(eh=new Int32Array(nn.memory.buffer)),eh}let Ta=0;const Qf=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},Ax=typeof Qf.encodeInto=="function"?function(r,e){return Qf.encodeInto(r,e)}:function(r,e){const t=Qf.encode(r);return e.set(t),{read:r.length,written:t.length}};function Vf(r,e,t){if(t===void 0){const a=Qf.encode(r),d=e(a.length,1)>>>0;return sh().subarray(d,d+a.length).set(a),Ta=a.length,d}let n=r.length,i=e(n,1)>>>0;const o=sh();let u=0;for(;u<n;u++){const a=r.charCodeAt(u);if(a>127)break;o[i+u]=a}if(u!==n){u!==0&&(r=r.slice(u)),i=t(i,n,n=u+r.length*3,1)>>>0;const a=sh().subarray(i+u,i+n),d=Ax(r,a);u+=d.written}return Ta=u,i}function om(r){const e=typeof r;if(e=="number"||e=="boolean"||r==null)return`${r}`;if(e=="string")return`"${r}"`;if(e=="symbol"){const i=r.description;return i==null?"Symbol":`Symbol(${i})`}if(e=="function"){const i=r.name;return typeof i=="string"&&i.length>0?`Function(${i})`:"Function"}if(Array.isArray(r)){const i=r.length;let o="[";i>0&&(o+=om(r[0]));for(let u=1;u<i;u++)o+=", "+om(r[u]);return o+="]",o}const t=/\[object ([^\]]+)\]/.exec(toString.call(r));let n;if(t.length>1)n=t[1];else return toString.call(r);if(n=="Object")try{return"Object("+JSON.stringify(r)+")"}catch{return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:n}function Px(r,e){const t=e(r.length*1,1)>>>0;return sh().set(r,t/1),Ta=r.length,t}function Vp(r,e){try{return r.apply(this,e)}catch(t){nn.__wbindgen_exn_store(Qr(t))}}class cd{static __wrap(e){e=e>>>0;const t=Object.create(cd.prototype);return t.__wbg_ptr=e,t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();nn.__wbg_jsroutesnapper_free(e)}constructor(e){try{const o=nn.__wbindgen_add_to_stack_pointer(-16),u=Px(e,nn.__wbindgen_malloc),a=Ta;nn.jsroutesnapper_new(o,u,a);var t=Hn()[o/4+0],n=Hn()[o/4+1],i=Hn()[o/4+2];if(i)throw Eu(n);return cd.__wrap(t)}finally{nn.__wbindgen_add_to_stack_pointer(16)}}setRouteConfig(e){nn.jsroutesnapper_setRouteConfig(this.__wbg_ptr,Qr(e))}setAreaMode(){nn.jsroutesnapper_setAreaMode(this.__wbg_ptr)}getConfig(){let e,t;try{const o=nn.__wbindgen_add_to_stack_pointer(-16);nn.jsroutesnapper_getConfig(o,this.__wbg_ptr);var n=Hn()[o/4+0],i=Hn()[o/4+1];return e=n,t=i,Xo(n,i)}finally{nn.__wbindgen_add_to_stack_pointer(16),nn.__wbindgen_free(e,t,1)}}toFinalFeature(){try{const n=nn.__wbindgen_add_to_stack_pointer(-16);nn.jsroutesnapper_toFinalFeature(n,this.__wbg_ptr);var e=Hn()[n/4+0],t=Hn()[n/4+1];let i;return e!==0&&(i=Xo(e,t).slice(),nn.__wbindgen_free(e,t*1)),i}finally{nn.__wbindgen_add_to_stack_pointer(16)}}renderGeojson(){let e,t;try{const o=nn.__wbindgen_add_to_stack_pointer(-16);nn.jsroutesnapper_renderGeojson(o,this.__wbg_ptr);var n=Hn()[o/4+0],i=Hn()[o/4+1];return e=n,t=i,Xo(n,i)}finally{nn.__wbindgen_add_to_stack_pointer(16),nn.__wbindgen_free(e,t,1)}}toggleSnapMode(){nn.jsroutesnapper_toggleSnapMode(this.__wbg_ptr)}onMouseMove(e,t,n){return nn.jsroutesnapper_onMouseMove(this.__wbg_ptr,e,t,n)!==0}onClick(){nn.jsroutesnapper_onClick(this.__wbg_ptr)}onDragStart(){return nn.jsroutesnapper_onDragStart(this.__wbg_ptr)!==0}onMouseUp(){return nn.jsroutesnapper_onMouseUp(this.__wbg_ptr)!==0}clearState(){nn.jsroutesnapper_clearState(this.__wbg_ptr)}editExisting(e){try{const i=nn.__wbindgen_add_to_stack_pointer(-16);nn.jsroutesnapper_editExisting(i,this.__wbg_ptr,Qr(e));var t=Hn()[i/4+0],n=Hn()[i/4+1];if(n)throw Eu(t)}finally{nn.__wbindgen_add_to_stack_pointer(16)}}debugRenderGraph(){let e,t;try{const o=nn.__wbindgen_add_to_stack_pointer(-16);nn.jsroutesnapper_debugRenderGraph(o,this.__wbg_ptr);var n=Hn()[o/4+0],i=Hn()[o/4+1];return e=n,t=i,Xo(n,i)}finally{nn.__wbindgen_add_to_stack_pointer(16),nn.__wbindgen_free(e,t,1)}}debugSnappableNodes(){let e,t;try{const o=nn.__wbindgen_add_to_stack_pointer(-16);nn.jsroutesnapper_debugSnappableNodes(o,this.__wbg_ptr);var n=Hn()[o/4+0],i=Hn()[o/4+1];return e=n,t=i,Xo(n,i)}finally{nn.__wbindgen_add_to_stack_pointer(16),nn.__wbindgen_free(e,t,1)}}routeNameForWaypoints(e){let t,n;try{const g=nn.__wbindgen_add_to_stack_pointer(-16);nn.jsroutesnapper_routeNameForWaypoints(g,this.__wbg_ptr,Qr(e));var i=Hn()[g/4+0],o=Hn()[g/4+1],u=Hn()[g/4+2],a=Hn()[g/4+3],d=i,p=o;if(a)throw d=0,p=0,Eu(u);return t=d,n=p,Xo(d,p)}finally{nn.__wbindgen_add_to_stack_pointer(16),nn.__wbindgen_free(t,n,1)}}addSnappedWaypoint(e,t){nn.jsroutesnapper_addSnappedWaypoint(this.__wbg_ptr,e,t)}undo(){nn.jsroutesnapper_undo(this.__wbg_ptr)}calculateRoute(e){let t,n;try{const g=nn.__wbindgen_add_to_stack_pointer(-16);nn.jsroutesnapper_calculateRoute(g,this.__wbg_ptr,Qr(e));var i=Hn()[g/4+0],o=Hn()[g/4+1],u=Hn()[g/4+2],a=Hn()[g/4+3],d=i,p=o;if(a)throw d=0,p=0,Eu(u);return t=d,n=p,Xo(d,p)}finally{nn.__wbindgen_add_to_stack_pointer(16),nn.__wbindgen_free(t,n,1)}}getExtraNodes(e,t){let n,i;try{const y=nn.__wbindgen_add_to_stack_pointer(-16);nn.jsroutesnapper_getExtraNodes(y,this.__wbg_ptr,Qr(e),Qr(t));var o=Hn()[y/4+0],u=Hn()[y/4+1],a=Hn()[y/4+2],d=Hn()[y/4+3],p=o,g=u;if(d)throw p=0,g=0,Eu(a);return n=p,i=g,Xo(p,g)}finally{nn.__wbindgen_add_to_stack_pointer(16),nn.__wbindgen_free(n,i,1)}}}async function zx(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(n){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const t=await r.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(r,e);return t instanceof WebAssembly.Instance?{instance:t,module:r}:t}}function Dx(){const r={};return r.wbg={},r.wbg.__wbindgen_string_new=function(e,t){const n=Xo(e,t);return Qr(n)},r.wbg.__wbindgen_object_drop_ref=function(e){Eu(e)},r.wbg.__wbindgen_error_new=function(e,t){const n=new Error(Xo(e,t));return Qr(n)},r.wbg.__wbindgen_number_get=function(e,t){const n=Nn(t),i=typeof n=="number"?n:void 0;Ix()[e/8+1]=Up(i)?0:i,Hn()[e/4+0]=!Up(i)},r.wbg.__wbindgen_is_object=function(e){const t=Nn(e);return typeof t=="object"&&t!==null},r.wbg.__wbindgen_is_undefined=function(e){return Nn(e)===void 0},r.wbg.__wbindgen_in=function(e,t){return Nn(e)in Nn(t)},r.wbg.__wbindgen_boolean_get=function(e){const t=Nn(e);return typeof t=="boolean"?t?1:0:2},r.wbg.__wbindgen_jsval_loose_eq=function(e,t){return Nn(e)==Nn(t)},r.wbg.__wbindgen_string_get=function(e,t){const n=Nn(t),i=typeof n=="string"?n:void 0;var o=Up(i)?0:Vf(i,nn.__wbindgen_malloc,nn.__wbindgen_realloc),u=Ta;Hn()[e/4+1]=u,Hn()[e/4+0]=o},r.wbg.__wbg_String_4370c5505c674d30=function(e,t){const n=String(Nn(t)),i=Vf(n,nn.__wbindgen_malloc,nn.__wbindgen_realloc),o=Ta;Hn()[e/4+1]=o,Hn()[e/4+0]=i},r.wbg.__wbindgen_object_clone_ref=function(e){const t=Nn(e);return Qr(t)},r.wbg.__wbg_getwithrefkey_d1f0d12f1f1b63ea=function(e,t){const n=Nn(e)[Nn(t)];return Qr(n)},r.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return Qr(e)},r.wbg.__wbg_stack_658279fe44541cf6=function(e,t){const n=Nn(t).stack,i=Vf(n,nn.__wbindgen_malloc,nn.__wbindgen_realloc),o=Ta;Hn()[e/4+1]=o,Hn()[e/4+0]=i},r.wbg.__wbg_error_f851667af71bcfc6=function(e,t){let n,i;try{n=e,i=t,console.error(Xo(e,t))}finally{nn.__wbindgen_free(n,i,1)}},r.wbg.__wbg_debug_9a6b3243fbbebb61=function(e){console.debug(Nn(e))},r.wbg.__wbg_error_788ae33f81d3b84b=function(e){console.error(Nn(e))},r.wbg.__wbg_info_2e30e8204b29d91d=function(e){console.info(Nn(e))},r.wbg.__wbg_log_1d3ae0273d8f4f8a=function(e){console.log(Nn(e))},r.wbg.__wbg_warn_d60e832f9882c1b2=function(e){console.warn(Nn(e))},r.wbg.__wbg_get_44be0491f933a435=function(e,t){const n=Nn(e)[t>>>0];return Qr(n)},r.wbg.__wbg_length_fff51ee6522a1a18=function(e){return Nn(e).length},r.wbg.__wbindgen_is_function=function(e){return typeof Nn(e)=="function"},r.wbg.__wbg_next_526fc47e980da008=function(e){const t=Nn(e).next;return Qr(t)},r.wbg.__wbg_next_ddb3312ca1c4e32a=function(){return Vp(function(e){const t=Nn(e).next();return Qr(t)},arguments)},r.wbg.__wbg_done_5c1f01fb660d73b5=function(e){return Nn(e).done},r.wbg.__wbg_value_1695675138684bd5=function(e){const t=Nn(e).value;return Qr(t)},r.wbg.__wbg_iterator_97f0c81209c6c35a=function(){return Qr(Symbol.iterator)},r.wbg.__wbg_get_97b561fb56f034b5=function(){return Vp(function(e,t){const n=Reflect.get(Nn(e),Nn(t));return Qr(n)},arguments)},r.wbg.__wbg_call_cb65541d95d71282=function(){return Vp(function(e,t){const n=Nn(e).call(Nn(t));return Qr(n)},arguments)},r.wbg.__wbg_isArray_4c24b343cb13cfb1=function(e){return Array.isArray(Nn(e))},r.wbg.__wbg_instanceof_ArrayBuffer_39ac22089b74fddb=function(e){let t;try{t=Nn(e)instanceof ArrayBuffer}catch{t=!1}return t},r.wbg.__wbg_buffer_085ec1f694018c4f=function(e){const t=Nn(e).buffer;return Qr(t)},r.wbg.__wbg_new_8125e318e6245eed=function(e){const t=new Uint8Array(Nn(e));return Qr(t)},r.wbg.__wbg_set_5cf90238115182c3=function(e,t,n){Nn(e).set(Nn(t),n>>>0)},r.wbg.__wbg_length_72e2208bbc0efc61=function(e){return Nn(e).length},r.wbg.__wbg_instanceof_Uint8Array_d8d9cb2b8e8ac1d4=function(e){let t;try{t=Nn(e)instanceof Uint8Array}catch{t=!1}return t},r.wbg.__wbindgen_debug_string=function(e,t){const n=om(Nn(t)),i=Vf(n,nn.__wbindgen_malloc,nn.__wbindgen_realloc),o=Ta;Hn()[e/4+1]=o,Hn()[e/4+0]=i},r.wbg.__wbindgen_throw=function(e,t){throw new Error(Xo(e,t))},r.wbg.__wbindgen_memory=function(){const e=nn.memory;return Qr(e)},r}function Rx(r,e){return nn=r.exports,$b.__wbindgen_wasm_module=e,Qc=null,eh=null,Yc=null,nn}async function $b(r){if(nn!==void 0)return nn;typeof r>"u"&&(r="/ltn/assets/route_snapper_bg.wasm");const e=Dx();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:t,module:n}=await zx(await r,e);return Rx(t,n)}var Zi=63710088e-1,qm={centimeters:Zi*100,centimetres:Zi*100,degrees:Zi/111325,feet:Zi*3.28084,inches:Zi*39.37,kilometers:Zi/1e3,kilometres:Zi/1e3,meters:Zi,metres:Zi,miles:Zi/1609.344,millimeters:Zi*1e3,millimetres:Zi*1e3,nauticalmiles:Zi/1852,radians:1,yards:Zi*1.0936},Fx={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/Zi,yards:1.0936133},sm={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function ns(r,e,t){t===void 0&&(t={});var n={type:"Feature"};return(t.id===0||t.id)&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.properties=e||{},n.geometry=r,n}function Bx(r,e,t){switch(r){case"Point":return _o(e).geometry;case"LineString":return Yo(e).geometry;case"Polygon":return Zm(e).geometry;case"MultiPoint":return Nb(e).geometry;case"MultiLineString":return Ob(e).geometry;case"MultiPolygon":return jb(e).geometry;default:throw new Error(r+" is invalid")}}function _o(r,e,t){if(t===void 0&&(t={}),!r)throw new Error("coordinates is required");if(!Array.isArray(r))throw new Error("coordinates must be an Array");if(r.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!hd(r[0])||!hd(r[1]))throw new Error("coordinates must contain numbers");var n={type:"Point",coordinates:r};return ns(n,e,t)}function $x(r,e,t){return t===void 0&&(t={}),_l(r.map(function(n){return _o(n,e)}),t)}function Zm(r,e,t){t===void 0&&(t={});for(var n=0,i=r;n<i.length;n++){var o=i[n];if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var u=0;u<o[o.length-1].length;u++)if(o[o.length-1][u]!==o[0][u])throw new Error("First and last Position are not equivalent.")}var a={type:"Polygon",coordinates:r};return ns(a,e,t)}function Ox(r,e,t){return t===void 0&&(t={}),_l(r.map(function(n){return Zm(n,e)}),t)}function Yo(r,e,t){if(t===void 0&&(t={}),r.length<2)throw new Error("coordinates must be an array of two or more positions");var n={type:"LineString",coordinates:r};return ns(n,e,t)}function Nx(r,e,t){return t===void 0&&(t={}),_l(r.map(function(n){return Yo(n,e)}),t)}function _l(r,e){e===void 0&&(e={});var t={type:"FeatureCollection"};return e.id&&(t.id=e.id),e.bbox&&(t.bbox=e.bbox),t.features=r,t}function Ob(r,e,t){t===void 0&&(t={});var n={type:"MultiLineString",coordinates:r};return ns(n,e,t)}function Nb(r,e,t){t===void 0&&(t={});var n={type:"MultiPoint",coordinates:r};return ns(n,e,t)}function jb(r,e,t){t===void 0&&(t={});var n={type:"MultiPolygon",coordinates:r};return ns(n,e,t)}function jx(r,e,t){t===void 0&&(t={});var n={type:"GeometryCollection",geometries:r};return ns(n,e,t)}function Ux(r,e){if(e===void 0&&(e=0),e&&!(e>=0))throw new Error("precision must be a positive number");var t=Math.pow(10,e||0);return Math.round(r*t)/t}function Gm(r,e){e===void 0&&(e="kilometers");var t=qm[e];if(!t)throw new Error(e+" units is invalid");return r*t}function kd(r,e){e===void 0&&(e="kilometers");var t=qm[e];if(!t)throw new Error(e+" units is invalid");return r/t}function Vx(r,e){return gh(kd(r,e))}function qx(r){var e=r%360;return e<0&&(e+=360),e}function gh(r){var e=r%(2*Math.PI);return e*180/Math.PI}function Qo(r){var e=r%360;return e*Math.PI/180}function Zx(r,e,t){if(e===void 0&&(e="kilometers"),t===void 0&&(t="kilometers"),!(r>=0))throw new Error("length must be a positive number");return Gm(kd(r,e),t)}function Gx(r,e,t){if(e===void 0&&(e="meters"),t===void 0&&(t="kilometers"),!(r>=0))throw new Error("area must be a positive number");var n=sm[e];if(!n)throw new Error("invalid original units");var i=sm[t];if(!i)throw new Error("invalid final units");return r/n*i}function hd(r){return!isNaN(r)&&r!==null&&!Array.isArray(r)}function Hm(r){return!!r&&r.constructor===Object}function Hx(r){if(!r)throw new Error("bbox is required");if(!Array.isArray(r))throw new Error("bbox must be an Array");if(r.length!==4&&r.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");r.forEach(function(e){if(!hd(e))throw new Error("bbox must only contain numbers")})}function Wx(r){if(!r)throw new Error("id is required");if(["string","number"].indexOf(typeof r)===-1)throw new Error("id must be a number or a string")}const Kx=Object.freeze(Object.defineProperty({__proto__:null,areaFactors:sm,bearingToAzimuth:qx,convertArea:Gx,convertLength:Zx,degreesToRadians:Qo,earthRadius:Zi,factors:qm,feature:ns,featureCollection:_l,geometry:Bx,geometryCollection:jx,isNumber:hd,isObject:Hm,lengthToDegrees:Vx,lengthToRadians:kd,lineString:Yo,lineStrings:Nx,multiLineString:Ob,multiPoint:Nb,multiPolygon:jb,point:_o,points:$x,polygon:Zm,polygons:Ox,radiansToDegrees:gh,radiansToLength:Gm,round:Ux,unitsFactors:Fx,validateBBox:Hx,validateId:Wx},Symbol.toStringTag,{value:"Module"}));function _h(r){if(!r)throw new Error("coord is required");if(!Array.isArray(r)){if(r.type==="Feature"&&r.geometry!==null&&r.geometry.type==="Point")return r.geometry.coordinates;if(r.type==="Point")return r.coordinates}if(Array.isArray(r)&&r.length>=2&&!Array.isArray(r[0])&&!Array.isArray(r[1]))return r;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function $u(r){if(Array.isArray(r))return r;if(r.type==="Feature"){if(r.geometry!==null)return r.geometry.coordinates}else if(r.coordinates)return r.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function Lh(r,e,t){if(r!==null)for(var n,i,o,u,a,d,p,g=0,y=0,x,C=r.type,M=C==="FeatureCollection",F=C==="Feature",z=M?r.features.length:1,E=0;E<z;E++){p=M?r.features[E].geometry:F?r.geometry:r,x=p?p.type==="GeometryCollection":!1,a=x?p.geometries.length:1;for(var P=0;P<a;P++){var $=0,U=0;if(u=x?p.geometries[P]:p,u!==null){d=u.coordinates;var K=u.type;switch(g=t&&(K==="Polygon"||K==="MultiPolygon")?1:0,K){case null:break;case"Point":if(e(d,y,E,$,U)===!1)return!1;y++,$++;break;case"LineString":case"MultiPoint":for(n=0;n<d.length;n++){if(e(d[n],y,E,$,U)===!1)return!1;y++,K==="MultiPoint"&&$++}K==="LineString"&&$++;break;case"Polygon":case"MultiLineString":for(n=0;n<d.length;n++){for(i=0;i<d[n].length-g;i++){if(e(d[n][i],y,E,$,U)===!1)return!1;y++}K==="MultiLineString"&&$++,K==="Polygon"&&U++}K==="Polygon"&&$++;break;case"MultiPolygon":for(n=0;n<d.length;n++){for(U=0,i=0;i<d[n].length;i++){for(o=0;o<d[n][i].length-g;o++){if(e(d[n][i][o],y,E,$,U)===!1)return!1;y++}U++}$++}break;case"GeometryCollection":for(n=0;n<u.geometries.length;n++)if(Lh(u.geometries[n],e,t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Xx(r,e,t,n){var i=t;return Lh(r,function(o,u,a,d,p){u===0&&t===void 0?i=o:i=e(i,o,u,a,d,p)},n),i}function Ub(r,e){var t;switch(r.type){case"FeatureCollection":for(t=0;t<r.features.length&&e(r.features[t].properties,t)!==!1;t++);break;case"Feature":e(r.properties,0);break}}function Jx(r,e,t){var n=t;return Ub(r,function(i,o){o===0&&t===void 0?n=i:n=e(n,i,o)}),n}function fd(r,e){if(r.type==="Feature")e(r,0);else if(r.type==="FeatureCollection")for(var t=0;t<r.features.length&&e(r.features[t],t)!==!1;t++);}function Yx(r,e,t){var n=t;return fd(r,function(i,o){o===0&&t===void 0?n=i:n=e(n,i,o)}),n}function Qx(r){var e=[];return Lh(r,function(t){e.push(t)}),e}function Wm(r,e){var t,n,i,o,u,a,d,p,g,y,x=0,C=r.type==="FeatureCollection",M=r.type==="Feature",F=C?r.features.length:1;for(t=0;t<F;t++){for(a=C?r.features[t].geometry:M?r.geometry:r,p=C?r.features[t].properties:M?r.properties:{},g=C?r.features[t].bbox:M?r.bbox:void 0,y=C?r.features[t].id:M?r.id:void 0,d=a?a.type==="GeometryCollection":!1,u=d?a.geometries.length:1,i=0;i<u;i++){if(o=d?a.geometries[i]:a,o===null){if(e(null,x,p,g,y)===!1)return!1;continue}switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(o,x,p,g,y)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<o.geometries.length;n++)if(e(o.geometries[n],x,p,g,y)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}x++}}function ek(r,e,t){var n=t;return Wm(r,function(i,o,u,a,d){o===0&&t===void 0?n=i:n=e(n,i,o,u,a,d)}),n}function Uu(r,e){Wm(r,function(t,n,i,o,u){var a=t===null?null:t.type;switch(a){case null:case"Point":case"LineString":case"Polygon":return e(ns(t,i,{bbox:o,id:u}),n,0)===!1?!1:void 0}var d;switch(a){case"MultiPoint":d="Point";break;case"MultiLineString":d="LineString";break;case"MultiPolygon":d="Polygon";break}for(var p=0;p<t.coordinates.length;p++){var g=t.coordinates[p],y={type:d,coordinates:g};if(e(ns(y,i),n,p)===!1)return!1}})}function tk(r,e,t){var n=t;return Uu(r,function(i,o,u){o===0&&u===0&&t===void 0?n=i:n=e(n,i,o,u)}),n}function Vb(r,e){Uu(r,function(t,n,i){var o=0;if(t.geometry){var u=t.geometry.type;if(!(u==="Point"||u==="MultiPoint")){var a,d=0,p=0,g=0;if(Lh(t,function(y,x,C,M,F){if(a===void 0||n>d||M>p||F>g){a=y,d=n,p=M,g=F,o=0;return}var z=Yo([a,y],t.properties);if(e(z,n,i,F,o)===!1)return!1;o++,a=y})===!1)return!1}}})}function nk(r,e,t){var n=t,i=!1;return Vb(r,function(o,u,a,d,p){i===!1&&t===void 0?n=o:n=e(n,o,u,a,d,p),i=!0}),n}function qb(r,e){if(!r)throw new Error("geojson is required");Uu(r,function(t,n,i){if(t.geometry!==null){var o=t.geometry.type,u=t.geometry.coordinates;switch(o){case"LineString":if(e(t,n,i,0,0)===!1)return!1;break;case"Polygon":for(var a=0;a<u.length;a++)if(e(Yo(u[a],t.properties),n,i,a)===!1)return!1;break}}})}function rk(r,e,t){var n=t;return qb(r,function(i,o,u,a){o===0&&t===void 0?n=i:n=e(n,i,o,u,a)}),n}function ik(r,e){if(e=e||{},!Hm(e))throw new Error("options is invalid");var t=e.featureIndex||0,n=e.multiFeatureIndex||0,i=e.geometryIndex||0,o=e.segmentIndex||0,u=e.properties,a;switch(r.type){case"FeatureCollection":t<0&&(t=r.features.length+t),u=u||r.features[t].properties,a=r.features[t].geometry;break;case"Feature":u=u||r.properties,a=r.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":a=r;break;default:throw new Error("geojson is invalid")}if(a===null)return null;var d=a.coordinates;switch(a.type){case"Point":case"MultiPoint":return null;case"LineString":return o<0&&(o=d.length+o-1),Yo([d[o],d[o+1]],u,e);case"Polygon":return i<0&&(i=d.length+i),o<0&&(o=d[i].length+o-1),Yo([d[i][o],d[i][o+1]],u,e);case"MultiLineString":return n<0&&(n=d.length+n),o<0&&(o=d[n].length+o-1),Yo([d[n][o],d[n][o+1]],u,e);case"MultiPolygon":return n<0&&(n=d.length+n),i<0&&(i=d[n].length+i),o<0&&(o=d[n][i].length-o-1),Yo([d[n][i][o],d[n][i][o+1]],u,e)}throw new Error("geojson is invalid")}function ok(r,e){if(e=e||{},!Hm(e))throw new Error("options is invalid");var t=e.featureIndex||0,n=e.multiFeatureIndex||0,i=e.geometryIndex||0,o=e.coordIndex||0,u=e.properties,a;switch(r.type){case"FeatureCollection":t<0&&(t=r.features.length+t),u=u||r.features[t].properties,a=r.features[t].geometry;break;case"Feature":u=u||r.properties,a=r.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":a=r;break;default:throw new Error("geojson is invalid")}if(a===null)return null;var d=a.coordinates;switch(a.type){case"Point":return _o(d,u,e);case"MultiPoint":return n<0&&(n=d.length+n),_o(d[n],u,e);case"LineString":return o<0&&(o=d.length+o),_o(d[o],u,e);case"Polygon":return i<0&&(i=d.length+i),o<0&&(o=d[i].length+o),_o(d[i][o],u,e);case"MultiLineString":return n<0&&(n=d.length+n),o<0&&(o=d[n].length+o),_o(d[n][o],u,e);case"MultiPolygon":return n<0&&(n=d.length+n),i<0&&(i=d[n].length+i),o<0&&(o=d[n][i].length-o),_o(d[n][i][o],u,e)}throw new Error("geojson is invalid")}const sk=Object.freeze(Object.defineProperty({__proto__:null,coordAll:Qx,coordEach:Lh,coordReduce:Xx,featureEach:fd,featureReduce:Yx,findPoint:ok,findSegment:ik,flattenEach:Uu,flattenReduce:tk,geomEach:Wm,geomReduce:ek,lineEach:qb,lineReduce:rk,propEach:Ub,propReduce:Jx,segmentEach:Vb,segmentReduce:nk},Symbol.toStringTag,{value:"Module"}));function Zb(r,e,t){if(t===void 0&&(t={}),t.final===!0)return ak(r,e);var n=_h(r),i=_h(e),o=Qo(n[0]),u=Qo(i[0]),a=Qo(n[1]),d=Qo(i[1]),p=Math.sin(u-o)*Math.cos(d),g=Math.cos(a)*Math.sin(d)-Math.sin(a)*Math.cos(d)*Math.cos(u-o);return gh(Math.atan2(p,g))}function ak(r,e){var t=Zb(e,r);return t=(t+180)%360,t}function Vc(r,e,t){t===void 0&&(t={});var n=_h(r),i=_h(e),o=Qo(i[1]-n[1]),u=Qo(i[0]-n[0]),a=Qo(n[1]),d=Qo(i[1]),p=Math.pow(Math.sin(o/2),2)+Math.pow(Math.sin(u/2),2)*Math.cos(a)*Math.cos(d);return Gm(2*Math.atan2(Math.sqrt(p),Math.sqrt(1-p)),t.units)}function H_(r,e,t,n){n===void 0&&(n={});var i=_h(r),o=Qo(i[0]),u=Qo(i[1]),a=Qo(t),d=kd(e,n.units),p=Math.asin(Math.sin(u)*Math.cos(d)+Math.cos(u)*Math.sin(d)*Math.cos(a)),g=o+Math.atan2(Math.sin(a)*Math.sin(d)*Math.cos(u),Math.cos(d)-Math.sin(u)*Math.sin(p)),y=gh(g),x=gh(p);return _o([y,x],n.properties)}function W_(r){if(!r)throw new Error("geojson is required");var e=[];return Uu(r,function(t){lk(t,e)}),_l(e)}function lk(r,e){var t=[],n=r.geometry;if(n!==null){switch(n.type){case"Polygon":t=$u(n);break;case"LineString":t=[$u(n)]}t.forEach(function(i){var o=uk(i,r.properties);o.forEach(function(u){u.id=e.length,e.push(u)})})}}function uk(r,e){var t=[];return r.reduce(function(n,i){var o=Yo([n,i],e);return o.bbox=ck(n,i),t.push(o),i}),t}function ck(r,e){var t=r[0],n=r[1],i=e[0],o=e[1],u=t<i?t:i,a=n<o?n:o,d=t>i?t:i,p=n>o?n:o;return[u,a,d,p]}var Km={exports:{}},Gb={exports:{}};(function(r,e){(function(t,n){r.exports=n()})(zb,function(){function t(P,$,U,K,ee){(function W(J,he,Ae,ne,fe){for(;ne>Ae;){if(ne-Ae>600){var Ce=ne-Ae+1,_e=he-Ae+1,Ze=Math.log(Ce),Oe=.5*Math.exp(2*Ze/3),je=.5*Math.sqrt(Ze*Oe*(Ce-Oe)/Ce)*(_e-Ce/2<0?-1:1),De=Math.max(Ae,Math.floor(he-_e*Oe/Ce+je)),At=Math.min(ne,Math.floor(he+(Ce-_e)*Oe/Ce+je));W(J,he,De,At,fe)}var ut=J[he],ht=Ae,wt=ne;for(n(J,Ae,he),fe(J[ne],ut)>0&&n(J,Ae,ne);ht<wt;){for(n(J,ht,wt),ht++,wt--;fe(J[ht],ut)<0;)ht++;for(;fe(J[wt],ut)>0;)wt--}fe(J[Ae],ut)===0?n(J,Ae,wt):n(J,++wt,ne),wt<=he&&(Ae=wt+1),he<=wt&&(ne=wt-1)}})(P,$,U||0,K||P.length-1,ee||i)}function n(P,$,U){var K=P[$];P[$]=P[U],P[U]=K}function i(P,$){return P<$?-1:P>$?1:0}var o=function(P){P===void 0&&(P=9),this._maxEntries=Math.max(4,P),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function u(P,$,U){if(!U)return $.indexOf(P);for(var K=0;K<$.length;K++)if(U(P,$[K]))return K;return-1}function a(P,$){d(P,0,P.children.length,$,P)}function d(P,$,U,K,ee){ee||(ee=z(null)),ee.minX=1/0,ee.minY=1/0,ee.maxX=-1/0,ee.maxY=-1/0;for(var W=$;W<U;W++){var J=P.children[W];p(ee,P.leaf?K(J):J)}return ee}function p(P,$){return P.minX=Math.min(P.minX,$.minX),P.minY=Math.min(P.minY,$.minY),P.maxX=Math.max(P.maxX,$.maxX),P.maxY=Math.max(P.maxY,$.maxY),P}function g(P,$){return P.minX-$.minX}function y(P,$){return P.minY-$.minY}function x(P){return(P.maxX-P.minX)*(P.maxY-P.minY)}function C(P){return P.maxX-P.minX+(P.maxY-P.minY)}function M(P,$){return P.minX<=$.minX&&P.minY<=$.minY&&$.maxX<=P.maxX&&$.maxY<=P.maxY}function F(P,$){return $.minX<=P.maxX&&$.minY<=P.maxY&&$.maxX>=P.minX&&$.maxY>=P.minY}function z(P){return{children:P,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function E(P,$,U,K,ee){for(var W=[$,U];W.length;)if(!((U=W.pop())-($=W.pop())<=K)){var J=$+Math.ceil((U-$)/K/2)*K;t(P,J,$,U,ee),W.push($,J,J,U)}}return o.prototype.all=function(){return this._all(this.data,[])},o.prototype.search=function(P){var $=this.data,U=[];if(!F(P,$))return U;for(var K=this.toBBox,ee=[];$;){for(var W=0;W<$.children.length;W++){var J=$.children[W],he=$.leaf?K(J):J;F(P,he)&&($.leaf?U.push(J):M(P,he)?this._all(J,U):ee.push(J))}$=ee.pop()}return U},o.prototype.collides=function(P){var $=this.data;if(!F(P,$))return!1;for(var U=[];$;){for(var K=0;K<$.children.length;K++){var ee=$.children[K],W=$.leaf?this.toBBox(ee):ee;if(F(P,W)){if($.leaf||M(P,W))return!0;U.push(ee)}}$=U.pop()}return!1},o.prototype.load=function(P){if(!P||!P.length)return this;if(P.length<this._minEntries){for(var $=0;$<P.length;$++)this.insert(P[$]);return this}var U=this._build(P.slice(),0,P.length-1,0);if(this.data.children.length)if(this.data.height===U.height)this._splitRoot(this.data,U);else{if(this.data.height<U.height){var K=this.data;this.data=U,U=K}this._insert(U,this.data.height-U.height-1,!0)}else this.data=U;return this},o.prototype.insert=function(P){return P&&this._insert(P,this.data.height-1),this},o.prototype.clear=function(){return this.data=z([]),this},o.prototype.remove=function(P,$){if(!P)return this;for(var U,K,ee,W=this.data,J=this.toBBox(P),he=[],Ae=[];W||he.length;){if(W||(W=he.pop(),K=he[he.length-1],U=Ae.pop(),ee=!0),W.leaf){var ne=u(P,W.children,$);if(ne!==-1)return W.children.splice(ne,1),he.push(W),this._condense(he),this}ee||W.leaf||!M(W,J)?K?(U++,W=K.children[U],ee=!1):W=null:(he.push(W),Ae.push(U),U=0,K=W,W=W.children[0])}return this},o.prototype.toBBox=function(P){return P},o.prototype.compareMinX=function(P,$){return P.minX-$.minX},o.prototype.compareMinY=function(P,$){return P.minY-$.minY},o.prototype.toJSON=function(){return this.data},o.prototype.fromJSON=function(P){return this.data=P,this},o.prototype._all=function(P,$){for(var U=[];P;)P.leaf?$.push.apply($,P.children):U.push.apply(U,P.children),P=U.pop();return $},o.prototype._build=function(P,$,U,K){var ee,W=U-$+1,J=this._maxEntries;if(W<=J)return a(ee=z(P.slice($,U+1)),this.toBBox),ee;K||(K=Math.ceil(Math.log(W)/Math.log(J)),J=Math.ceil(W/Math.pow(J,K-1))),(ee=z([])).leaf=!1,ee.height=K;var he=Math.ceil(W/J),Ae=he*Math.ceil(Math.sqrt(J));E(P,$,U,Ae,this.compareMinX);for(var ne=$;ne<=U;ne+=Ae){var fe=Math.min(ne+Ae-1,U);E(P,ne,fe,he,this.compareMinY);for(var Ce=ne;Ce<=fe;Ce+=he){var _e=Math.min(Ce+he-1,fe);ee.children.push(this._build(P,Ce,_e,K-1))}}return a(ee,this.toBBox),ee},o.prototype._chooseSubtree=function(P,$,U,K){for(;K.push($),!$.leaf&&K.length-1!==U;){for(var ee=1/0,W=1/0,J=void 0,he=0;he<$.children.length;he++){var Ae=$.children[he],ne=x(Ae),fe=(Ce=P,_e=Ae,(Math.max(_e.maxX,Ce.maxX)-Math.min(_e.minX,Ce.minX))*(Math.max(_e.maxY,Ce.maxY)-Math.min(_e.minY,Ce.minY))-ne);fe<W?(W=fe,ee=ne<ee?ne:ee,J=Ae):fe===W&&ne<ee&&(ee=ne,J=Ae)}$=J||$.children[0]}var Ce,_e;return $},o.prototype._insert=function(P,$,U){var K=U?P:this.toBBox(P),ee=[],W=this._chooseSubtree(K,this.data,$,ee);for(W.children.push(P),p(W,K);$>=0&&ee[$].children.length>this._maxEntries;)this._split(ee,$),$--;this._adjustParentBBoxes(K,ee,$)},o.prototype._split=function(P,$){var U=P[$],K=U.children.length,ee=this._minEntries;this._chooseSplitAxis(U,ee,K);var W=this._chooseSplitIndex(U,ee,K),J=z(U.children.splice(W,U.children.length-W));J.height=U.height,J.leaf=U.leaf,a(U,this.toBBox),a(J,this.toBBox),$?P[$-1].children.push(J):this._splitRoot(U,J)},o.prototype._splitRoot=function(P,$){this.data=z([P,$]),this.data.height=P.height+1,this.data.leaf=!1,a(this.data,this.toBBox)},o.prototype._chooseSplitIndex=function(P,$,U){for(var K,ee,W,J,he,Ae,ne,fe=1/0,Ce=1/0,_e=$;_e<=U-$;_e++){var Ze=d(P,0,_e,this.toBBox),Oe=d(P,_e,U,this.toBBox),je=(ee=Ze,W=Oe,J=void 0,he=void 0,Ae=void 0,ne=void 0,J=Math.max(ee.minX,W.minX),he=Math.max(ee.minY,W.minY),Ae=Math.min(ee.maxX,W.maxX),ne=Math.min(ee.maxY,W.maxY),Math.max(0,Ae-J)*Math.max(0,ne-he)),De=x(Ze)+x(Oe);je<fe?(fe=je,K=_e,Ce=De<Ce?De:Ce):je===fe&&De<Ce&&(Ce=De,K=_e)}return K||U-$},o.prototype._chooseSplitAxis=function(P,$,U){var K=P.leaf?this.compareMinX:g,ee=P.leaf?this.compareMinY:y;this._allDistMargin(P,$,U,K)<this._allDistMargin(P,$,U,ee)&&P.children.sort(K)},o.prototype._allDistMargin=function(P,$,U,K){P.children.sort(K);for(var ee=this.toBBox,W=d(P,0,$,ee),J=d(P,U-$,U,ee),he=C(W)+C(J),Ae=$;Ae<U-$;Ae++){var ne=P.children[Ae];p(W,P.leaf?ee(ne):ne),he+=C(W)}for(var fe=U-$-1;fe>=$;fe--){var Ce=P.children[fe];p(J,P.leaf?ee(Ce):Ce),he+=C(J)}return he},o.prototype._adjustParentBBoxes=function(P,$,U){for(var K=U;K>=0;K--)p($[K],P)},o.prototype._condense=function(P){for(var $=P.length-1,U=void 0;$>=0;$--)P[$].children.length===0?$>0?(U=P[$-1].children).splice(U.indexOf(P[$]),1):this.clear():a(P[$],this.toBBox)},o})})(Gb);var hk=Gb.exports;const fk=Vm(Kx),dk=Vm(sk);function Hb(r,e,t){if(r!==null)for(var n,i,o,u,a,d,p,g=0,y=0,x,C=r.type,M=C==="FeatureCollection",F=C==="Feature",z=M?r.features.length:1,E=0;E<z;E++){p=M?r.features[E].geometry:F?r.geometry:r,x=p?p.type==="GeometryCollection":!1,a=x?p.geometries.length:1;for(var P=0;P<a;P++){var $=0,U=0;if(u=x?p.geometries[P]:p,u!==null){d=u.coordinates;var K=u.type;switch(g=t&&(K==="Polygon"||K==="MultiPolygon")?1:0,K){case null:break;case"Point":if(e(d,y,E,$,U)===!1)return!1;y++,$++;break;case"LineString":case"MultiPoint":for(n=0;n<d.length;n++){if(e(d[n],y,E,$,U)===!1)return!1;y++,K==="MultiPoint"&&$++}K==="LineString"&&$++;break;case"Polygon":case"MultiLineString":for(n=0;n<d.length;n++){for(i=0;i<d[n].length-g;i++){if(e(d[n][i],y,E,$,U)===!1)return!1;y++}K==="MultiLineString"&&$++,K==="Polygon"&&U++}K==="Polygon"&&$++;break;case"MultiPolygon":for(n=0;n<d.length;n++){for(U=0,i=0;i<d[n].length;i++){for(o=0;o<d[n][i].length-g;o++){if(e(d[n][i][o],y,E,$,U)===!1)return!1;y++}U++}$++}break;case"GeometryCollection":for(n=0;n<u.geometries.length;n++)if(Hb(u.geometries[n],e,t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Wb(r,e={}){if(r.bbox!=null&&e.recompute!==!0)return r.bbox;const t=[1/0,1/0,-1/0,-1/0];return Hb(r,n=>{t[0]>n[0]&&(t[0]=n[0]),t[1]>n[1]&&(t[1]=n[1]),t[2]<n[0]&&(t[2]=n[0]),t[3]<n[1]&&(t[3]=n[1])}),t}var pk=Wb;const mk=Object.freeze(Object.defineProperty({__proto__:null,bbox:Wb,default:pk},Symbol.toStringTag,{value:"Module"})),gk=Vm(mk);var Ls=hk,Kb=fk,Xb=dk,xu=gk.default,_k=Xb.featureEach;Xb.coordEach;Kb.polygon;var K_=Kb.featureCollection;function Jb(r){var e=new Ls(r);return e.insert=function(t){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:xu(t),Ls.prototype.insert.call(this,t)},e.load=function(t){var n=[];return Array.isArray(t)?t.forEach(function(i){if(i.type!=="Feature")throw new Error("invalid features");i.bbox=i.bbox?i.bbox:xu(i),n.push(i)}):_k(t,function(i){if(i.type!=="Feature")throw new Error("invalid features");i.bbox=i.bbox?i.bbox:xu(i),n.push(i)}),Ls.prototype.load.call(this,n)},e.remove=function(t,n){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:xu(t),Ls.prototype.remove.call(this,t,n)},e.clear=function(){return Ls.prototype.clear.call(this)},e.search=function(t){var n=Ls.prototype.search.call(this,this.toBBox(t));return K_(n)},e.collides=function(t){return Ls.prototype.collides.call(this,this.toBBox(t))},e.all=function(){var t=Ls.prototype.all.call(this);return K_(t)},e.toJSON=function(){return Ls.prototype.toJSON.call(this)},e.fromJSON=function(t){return Ls.prototype.fromJSON.call(this,t)},e.toBBox=function(t){var n;if(t.bbox)n=t.bbox;else if(Array.isArray(t)&&t.length===4)n=t;else if(Array.isArray(t)&&t.length===6)n=[t[0],t[1],t[3],t[4]];else if(t.type==="Feature")n=xu(t);else if(t.type==="FeatureCollection")n=xu(t);else throw new Error("invalid geojson");return{minX:n[0],minY:n[1],maxX:n[2],maxY:n[3]}},e}Km.exports=Jb;Km.exports.default=Jb;var yk=Km.exports;const bk=Db(yk);function vk(r,e){var t={},n=[];if(r.type==="LineString"&&(r=ns(r)),e.type==="LineString"&&(e=ns(e)),r.type==="Feature"&&e.type==="Feature"&&r.geometry!==null&&e.geometry!==null&&r.geometry.type==="LineString"&&e.geometry.type==="LineString"&&r.geometry.coordinates.length===2&&e.geometry.coordinates.length===2){var i=X_(r,e);return i&&n.push(i),_l(n)}var o=bk();return o.load(W_(e)),fd(W_(r),function(u){fd(o.search(u),function(a){var d=X_(u,a);if(d){var p=$u(d).join(",");t[p]||(t[p]=!0,n.push(d))}})}),_l(n)}function X_(r,e){var t=$u(r),n=$u(e);if(t.length!==2)throw new Error("<intersects> line1 must only contain 2 coordinates");if(n.length!==2)throw new Error("<intersects> line2 must only contain 2 coordinates");var i=t[0][0],o=t[0][1],u=t[1][0],a=t[1][1],d=n[0][0],p=n[0][1],g=n[1][0],y=n[1][1],x=(y-p)*(u-i)-(g-d)*(a-o),C=(g-d)*(o-p)-(y-p)*(i-d),M=(u-i)*(o-p)-(a-o)*(i-d);if(x===0)return null;var F=C/x,z=M/x;if(F>=0&&F<=1&&z>=0&&z<=1){var E=i+F*(u-i),P=o+F*(a-o);return _o([E,P])}return null}function wk(r,e,t){t===void 0&&(t={});var n=_o([1/0,1/0],{dist:1/0}),i=0;return Uu(r,function(o){for(var u=$u(o),a=0;a<u.length-1;a++){var d=_o(u[a]);d.properties.dist=Vc(e,d,t);var p=_o(u[a+1]);p.properties.dist=Vc(e,p,t);var g=Vc(d,p,t),y=Math.max(d.properties.dist,p.properties.dist),x=Zb(d,p),C=H_(e,y,x+90,t),M=H_(e,y,x-90,t),F=vk(Yo([C.geometry.coordinates,M.geometry.coordinates]),Yo([d.geometry.coordinates,p.geometry.coordinates])),z=null;F.features.length>0&&(z=F.features[0],z.properties.dist=Vc(e,z,t),z.properties.location=i+Vc(d,z,t)),d.properties.dist<n.properties.dist&&(n=d,n.properties.index=a,n.properties.location=i),p.properties.dist<n.properties.dist&&(n=p,n.properties.index=a+1,n.properties.location=i+g),z&&z.properties.dist<n.properties.dist&&(n=z,n.properties.index=a),i+=g}}),n}const xk=30;class kk{constructor(e,t,n,i,o){this.onMouseMove=u=>{if(!this.active)return;const a=[u.point.x-xk,u.point.y],d=this.map.unproject(u.point).distanceTo(this.map.unproject(a));this.inner.onMouseMove(u.lngLat.lng,u.lngLat.lat,d)&&(this.redraw(),this.dataUpdated())},this.onClick=()=>{this.active&&(this.inner.onClick(),this.redraw(),this.dataUpdated())},this.onDoubleClick=u=>{this.active&&(u.preventDefault(),this.inner.onClick(),this.finish())},this.onDragStart=()=>{this.active&&this.inner.onDragStart()&&this.map.dragPan.disable()},this.onMouseUp=()=>{this.active&&this.inner.onMouseUp()&&this.map.dragPan.enable()},this.onKeyDown=u=>{if(!this.active)return;let a=u.target.tagName;a=="INPUT"||a=="TEXTAREA"||u.key=="Escape"&&(u.stopPropagation(),this.cancel())},this.onKeyPress=u=>{if(!this.active)return;let a=u.target.tagName;a=="INPUT"||a=="TEXTAREA"||(u.key=="Enter"?(u.stopPropagation(),this.finish()):u.key=="s"||u.key=="S"?(u.stopPropagation(),this.inner.toggleSnapMode(),this.redraw()):u.key=="z"&&u.ctrlKey&&this.undo())},this.map=e,console.time("Deserialize and setup JsRouteSnapper"),this.inner=new cd(t),console.timeEnd("Deserialize and setup JsRouteSnapper"),this.active=!1,this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[],this.routeToolGj=n,this.snapMode=i,this.undoLength=o,this.map.on("mousemove",this.onMouseMove),this.map.on("click",this.onClick),this.map.on("dblclick",this.onDoubleClick),this.map.on("dragstart",this.onDragStart),this.map.on("mouseup",this.onMouseUp),document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keypress",this.onKeyPress)}tearDown(){this.map.off("mousemove",this.onMouseMove),this.map.off("click",this.onClick),this.map.off("dblclick",this.onDoubleClick),this.map.off("dragstart",this.onDragStart),this.map.off("mouseup",this.onMouseUp),document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keypress",this.onKeyPress)}startRoute(){this.active||(this.active=!0,this.map.boxZoom.disable(),this.map.doubleClickZoom.disable())}startArea(){this.active||(this.inner.setAreaMode(),this.active=!0,this.map.boxZoom.disable(),this.map.doubleClickZoom.disable())}stop(){this.active=!1,this.inner.clearState(),this.redraw(),this.map.boxZoom.enable(),this.map.doubleClickZoom.enable()}editExistingRoute(e){this.active&&window.alert("Bug: editExistingRoute called when tool is already active"),e.properties.waypoints||(e.properties.waypoints=[{lon:e.geometry.coordinates[0][0],lat:e.geometry.coordinates[0][1],snapped:!0},{lon:e.geometry.coordinates[e.geometry.coordinates.length-1][0],lat:e.geometry.coordinates[e.geometry.coordinates.length-1][1],snapped:!0}]),this.startRoute(),this.inner.editExisting(e.properties.waypoints),this.redraw()}editExistingArea(e){this.active&&window.alert("Bug: editExistingArea called when tool is already active"),e.properties.waypoints||window.alert("Bug: editExistingArea called for a polygon not produced by the route-snapper"),this.startArea(),this.inner.editExisting(e.properties.waypoints),this.redraw()}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerUpdated(e){this.eventListenersUpdated.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}clearEventListeners(){this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[]}isActive(){return this.active}finish(){let e=this.inner.toFinalFeature();if(e)for(let t of this.eventListenersSuccess)t(JSON.parse(e));else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){this.inner.clearState(),this.finish()}setRouteConfig(e){this.inner.setRouteConfig(e),this.redraw()}addSnappedWaypoint(e){this.inner.addSnappedWaypoint(e[0],e[1]),this.redraw()}undo(){this.inner.undo(),this.redraw()}toggleSnapMode(){this.inner.toggleSnapMode(),this.redraw()}redraw(){let e=JSON.parse(this.inner.renderGeojson());this.routeToolGj.set(e),this.map.getCanvas().style.cursor=e.cursor,this.snapMode.set(e.snap_mode),this.undoLength.set(e.undo_length)}dataUpdated(){let e=this.inner.toFinalFeature();if(e)for(let t of this.eventListenersUpdated)t(JSON.parse(e))}}const ku=[];function qp(r,e){return{subscribe:Ln(r,e).subscribe}}function Ln(r,e=ot){let t;const n=new Set;function i(a){if(_t(r,a)&&(r=a,t)){const d=!ku.length;for(const p of n)p[1](),ku.push(p,r);if(d){for(let p=0;p<ku.length;p+=2)ku[p][0](ku[p+1]);ku.length=0}}}function o(a){i(a(r))}function u(a,d=ot){const p=[a,d];return n.add(p),n.size===1&&(t=e(i,o)||ot),a(r),()=>{n.delete(p),n.size===0&&t&&(t(),t=null)}}return{set:i,update:o,subscribe:u}}class Sk{constructor(){Yn(this,"rootKey","ltn")}get schemaVersionKey(){return`${this.rootKey}/_meta/schema-version`}get storedSchemaVersion(){let e,t=window.localStorage.getItem(this.schemaVersionKey);return t?(e=parseInt(t),Number.isNaN(e)&&(e=0)):e=0,e}ensureMigrated(){if(localStorage.length==0){console.log("localStorage is empty  nothing to migrate."),window.localStorage.setItem(this.schemaVersionKey,2 .toString());return}if(this.storedSchemaVersion==2){console.debug("Schema is already up to date.");return}if(this.storedSchemaVersion<1){console.log(`Migrating storage from version ${this.storedSchemaVersion} to 2`);for(const t of["cnt","global"]){const n=t,i=new Zp(n,1,ed);for(const[o,u]of Tk(n))for(const{projectKey:a,projectName:d}of u){let p=window.localStorage.getItem(a);if(!p){console.warn(`Project features not found for ${a}, skipping migration`);continue}let g=JSON.parse(p);g.app_focus=n,g.study_area_name=o,g.project_name=d,console.log(`migrating project ${a}`);let y=i.createProject(g);console.log(`Successfully migrated v0->v1 project ${a} -> ${i.projectKey(y)}`),window.localStorage.removeItem(a)}}}if(this.storedSchemaVersion<2)for(const t of["cnt","global"]){const n=t,i=new Zp(n,2,ed);for(const[o,u]of i.projects()){if(u.db_schema_version>=2){console.log(`skipping previously migrated project: ${o}`);continue}u.db_schema_version=2,i.saveProject(o,u),console.log(`Successfully migrated v1->v2 project: ${i.projectKey(o)}`)}}window.localStorage.setItem(this.schemaVersionKey,2 .toString()),console.debug("Completed migrating database to v2")}projectStorage(e){return this.ensureMigrated(),new Zp(e,this.storedSchemaVersion,ed)}}const ed=Symbol("internal_method_token");class Zp{constructor(e,t,n){Yn(this,"appFocus");Yn(this,"dbSchemaVersion");if(n!==ed)throw new Error("ProjectStorage must be created via Database.projectStorage()");this.appFocus=e,this.dbSchemaVersion=t}get collectionKey(){return"ltn/projects"}projectKey(e){if(!e)throw new Error("Cannot get project. ProjectID was blank/missing.");return`${this.collectionKey}/${e}`}projectName(e){return this.project(e).project_name}projectNameAlreadyExists(e){for(const[t,n]of this.projects())if(n.project_name==e)return!0;return!1}nextAvailableProjectName(e){if(this.projectNameAlreadyExists(e)){let t=e,n=2;do e=`${t} (${n})`,n++;while(this.projectNameAlreadyExists(e))}return e}nextAvailableNeighbourhoodName(e){let t=this.project(e),n=`${t.project_name} LTN`,i=t.features.filter(a=>{var d;return((d=a.properties)==null?void 0:d.kind)=="boundary"}),o=n,u=1;for(;i.some(a=>{var d;return((d=a.properties)==null?void 0:d.name)==o});)u++,o=`${n} #${u}`;return o}createEmptyProject(e,t){const n={type:"FeatureCollection",features:[],study_area_name:t,project_name:e,app_focus:this.appFocus};return this.createProject(n)}createProject(e){if(this.projectNameAlreadyExists(e.project_name))throw new Error(`Project name already taken: ${e.project_name}`);e.db_schema_version||(e.db_schema_version=this.dbSchemaVersion);let t=crypto.randomUUID();return this.saveProject(t,e),t}studyAreaProjects(){let e=new Map;for(const[t,n]of this.projects()){const i=n.study_area_name;e.has(i)||e.set(i,[]),e.get(i).push({projectID:t,projectName:n.project_name})}for(const[t,n]of e.entries())n.sort((i,o)=>i.projectName.localeCompare(o.projectName));return Array.from(e.entries()).sort((t,n)=>t[0]==null?1:n[0]==null?-1:t[0].localeCompare(n[0]))}projectIDFromKey(e){let t=e.match(/ltn\/projects\/([a-z0-9-]+)/);if(!t)return;let n=t[1];if(n)return n}projects(){return this.globalAndCntProjectKeys().map(e=>{let t=this.projectIDFromKey(e);if(!t)throw new Error(`Cannot get project: no projectID parsed from ${e}`);let n=window.localStorage.getItem(e);if(!n)throw new Error(`Cannot get project: no project found for ${e}`);let i=JSON.parse(n);return i.app_focus!=this.appFocus?null:[t,i]}).filter(e=>e!==null)}globalAndCntProjectKeys(){const e=this.collectionKey;let t=[];for(let n=0;n<localStorage.length;n++){const i=localStorage.key(n);i&&i.startsWith(e)&&t.push(i)}return t}saveProject(e,t){let n=this.projectKey(e);t.study_area_name||delete t.study_area_name,window.localStorage.setItem(n,JSON.stringify(t))}removeProject(e){let t=this.projectKey(e);window.localStorage.removeItem(t)}renameProject(e,t){let n=this.project(e);if(!n)throw new Error(`Cannot rename project: no existing project found for ${e}`);if(n.project_name==t){console.debug("Ignoring rename, since it's the same name.");return}if(this.projectNameAlreadyExists(t))throw new Error(`Project name ${t} already taken. Choose a different name.`);n.project_name=t,this.saveProject(e,n)}project(e){let t=this.projectKey(e),n=window.localStorage.getItem(t);if(!n)throw new Error(`Cannot get project: no project found for ${e}`);let i=JSON.parse(n);return console.assert(i.study_area_name||i.app_focus!="cnt","missing study area name for cnt project"),console.assert(i.project_name,"missing project name"),i}}function Tk(r){let e=new Map,t=[];for(let i=0;i<window.localStorage.length;i++){let o=window.localStorage.key(i);if(o.startsWith("ltn_cnt/")){if(r!="cnt")continue;try{let[u,a,d]=o.split("/");e.has(a)||e.set(a,[]),e.get(a).push({projectKey:o,projectName:d})}catch(u){console.log(`error loading cnt project: ${o}`,u)}}else if(o.startsWith("ltn_")){if(r!="global")continue;let u=o.split("ltn_"),a=u[u.length-1],d="";try{d=JSON.parse(window.localStorage.getItem(o)).study_area_name}catch(p){console.log(`error loading global project: ${o}`,p)}d&&d.length>0?(e.has(d)||e.set(d,[]),e.get(d).push({projectKey:o,projectName:a})):t.push({projectKey:o,projectName:a})}}let n=[...e.entries()];return n.sort((i,o)=>i[0].localeCompare(o[0])),t.length>0&&n.push([void 0,t]),n}const Yb="MZEJTanw3WpxRvt7qDfo";let rs=Ln(null),is=Ln("global"),yl=Ln(void 0),Xm=new Sk,ta=Ln(Xm.projectStorage(Ci(is)));is.subscribe(r=>{ta.set(Xm.projectStorage(r))});let J_=Ln(!0),dd=Ln(!1),Cr=Ln(null),lh=Ln(new Ys.LngLat(0,0)),uh=Ln(new Ys.LngLat(0,0)),qf=Ln(new Ys.LngLat(0,0)),Y_=Ln(1),Gi=Ln(1),Kn=Ln({mode:"title",firstLoad:!0}),ch=Ln(!1),am=Ln("streets-v2"),lm=Ln("walk_cycle_only"),Q_=Ln(!1),um=Ln(!0),pd=Ln(!0),md=Ln("shortcuts"),cm=Ln(!1),hm=Ln(!0),e0=Ln(500);function yh(){const r=Ci(yl);try{Ci(ta).saveProject(r,Ci(Cr).toSavefile())}catch(e){window.alert(`Autosave failed: ${e}`)}}let fm=Ln(!1);function Bo(r){return Ci(fm)?`/${r}`:`https://assets.od2net.org/${r}`}function dm(r){var n;function e(i){const o=i.getEast()-i.getWest();let u=i.getWest()+Math.random()*o;const a=i.getNorth()-i.getSouth();let d=i.getSouth()+Math.random()*a;return new Ys.LngLat(u,d)}const t=(n=Ci(rs))==null?void 0:n.getBounds();if(!t){console.assert(!1,"missing map bounds");return}t.contains(Ci(r))||r.set(e(t))}function Ck(r){let e,t,n,i,o,u,a,d,p,g,y,x,C,M,F;return{c(){e=j("h1"),e.textContent="The low-traffic neighbourhood (LTN) tool, v2",t=ie(),n=j("p"),n.innerHTML=`This is the second version of the A/B Street LTN tool, <a href="https://github.com/a-b-street/ltn" target="_blank">an open source project</a>. This version, called the Connected Neighbourhoods Tool, has been funded
    by
    <a href="https://www.transport.gov.scot/" target="_blank">Transport Scotland</a>
    and designed by
    <a href="https://www.sustrans.org.uk" target="_blank">Sustrans Scotland</a>.
    The team includes:`,i=ie(),o=j("ul"),o.innerHTML=`<li>Dustin Carlino, lead developer and director of <a href="https://find-and-update.company-information.service.gov.uk/company/16217327" target="_blank">A/B Street Ltd</a></li> <li><a href="https://github.com/michaelkirk/" target="_blank">Michael Kirk</a>, software developer</li> <li>Sustrans Scotland
      <ul><li><a href="https://www.linkedin.com/in/congying-hu/" target="_blank">Congying (Cici) Hu</a>, mobility planner</li> <li><a href="https://www.linkedin.com/in/angus-calder-a69543206" target="_blank">Angus Calder</a>, senior mobility planner</li> <li>Michael Naysmith, senior mobility planner (project manager)</li> <li><a href="https://www.linkedin.com/in/matthew-davis-6b3a8124/" target="_blank">Matthew Davis</a>, principal mobility planner</li></ul></li>`,u=ie(),a=j("p"),a.innerHTML=`This second version of the tool is an evolution from the original A/B Street
    tool, with <a href="https://a-b-street.github.io/docs/software/ltn/index.html#credits" target="_blank">many people</a> to thank there. Of the dozens of users giving excellent feedback and shaping
    the tools development, particular thanks to:`,d=ie(),p=j("ul"),p.innerHTML='<li><a href="https://github.com/XioNoX" target="_blank">Arzhel Younsi</a></li> <li><a href="https://github.com/rouelibre1" target="_blank">Rouelibre1</a></li>',g=ie(),y=j("p"),y.textContent="This tool would not be possible without:",x=ie(),C=j("ul"),C.innerHTML='<li><a href="https://www.openstreetmap.org/about" target="_blank">OpenStreetMap contributors</a></li> <li><a href="https://www.maptiler.com/" target="_blank">Maptiler</a></li> <li><a href="https://georust.org/" target="_blank">GeoRust</a></li> <li><a href="https://lucide.dev/" target="_blank">Lucide icons</a></li> <li>And countless other open source libraries</li>',M=ie(),F=j("p"),F.textContent="Some road signs images  Crown copyright."},m(z,E){Z(z,e,E),Z(z,t,E),Z(z,n,E),Z(z,i,E),Z(z,o,E),Z(z,u,E),Z(z,a,E),Z(z,d,E),Z(z,p,E),Z(z,g,E),Z(z,y,E),Z(z,x,E),Z(z,C,E),Z(z,M,E),Z(z,F,E)},p:ot,d(z){z&&(q(e),q(t),q(n),q(i),q(o),q(u),q(a),q(d),q(p),q(g),q(y),q(x),q(C),q(M),q(F))}}}function Mk(r){let e,t,n;function i(u){r[1](u)}let o={$$slots:{default:[Ck]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.show=r[0]),e=new Um({props:o}),un.push(()=>Pn(e,"show",i)),{c(){ce(e.$$.fragment)},m(u,a){le(e,u,a),n=!0},p(u,[a]){const d={};a&4&&(d.$$scope={dirty:a,ctx:u}),!t&&a&1&&(t=!0,d.show=u[0],An(()=>t=!1)),e.$set(d)},i(u){n||(N(e.$$.fragment,u),n=!0)},o(u){V(e.$$.fragment,u),n=!1},d(u){ue(e,u)}}}function Lk(r,e,t){let n;st(r,dd,o=>t(0,n=o));function i(o){n=o,dd.set(n)}return[n,i]}class Ek extends St{constructor(e){super(),kt(this,e,Lk,Mk,_t,{})}}/**
 * @license lucide-svelte v0.475.0 - ISC
 *
 * ISC License
 * 
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2022 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2022.
 * 
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 * 
 */const Ik={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"},t0=Ik;function n0(r,e,t){const n=r.slice();return n[11]=e[t][0],n[12]=e[t][1],n}function Gp(r){let e,t=[r[12]],n={};for(let i=0;i<t.length;i+=1)n=Mt(n,t[i]);return{c(){e=ms(r[11]),ud(e,n)},m(i,o){Z(i,e,o)},p(i,o){ud(e,n=En(t,[o&32&&i[12]]))},d(i){i&&q(e)}}}function r0(r){let e=r[11],t,n=r[11]&&Gp(r);return{c(){n&&n.c(),t=Xn()},m(i,o){n&&n.m(i,o),Z(i,t,o)},p(i,o){i[11]?e?_t(e,i[11])?(n.d(1),n=Gp(i),e=i[11],n.c(),n.m(t.parentNode,t)):n.p(i,o):(n=Gp(i),e=i[11],n.c(),n.m(t.parentNode,t)):e&&(n.d(1),n=null,e=i[11])},d(i){i&&q(t),n&&n.d(i)}}}function Ak(r){let e,t,n,i,o,u=Rn(r[5]),a=[];for(let x=0;x<u.length;x+=1)a[x]=r0(n0(r,u,x));const d=r[10].default,p=mn(d,r,r[9],null);let g=[t0,r[7],{width:r[2]},{height:r[2]},{stroke:r[1]},{"stroke-width":n=r[4]?Number(r[3])*24/Number(r[2]):r[3]},{class:i=r[6]("lucide-icon","lucide",r[0]?`lucide-${r[0]}`:"",r[8].class)}],y={};for(let x=0;x<g.length;x+=1)y=Mt(y,g[x]);return{c(){e=ms("svg");for(let x=0;x<a.length;x+=1)a[x].c();t=Xn(),p&&p.c(),ud(e,y)},m(x,C){Z(x,e,C);for(let M=0;M<a.length;M+=1)a[M]&&a[M].m(e,null);D(e,t),p&&p.m(e,null),o=!0},p(x,[C]){if(C&32){u=Rn(x[5]);let M;for(M=0;M<u.length;M+=1){const F=n0(x,u,M);a[M]?a[M].p(F,C):(a[M]=r0(F),a[M].c(),a[M].m(e,t))}for(;M<a.length;M+=1)a[M].d(1);a.length=u.length}p&&p.p&&(!o||C&512)&&_n(p,d,x,x[9],o?gn(d,x[9],C,null):yn(x[9]),null),ud(e,y=En(g,[t0,C&128&&x[7],(!o||C&4)&&{width:x[2]},(!o||C&4)&&{height:x[2]},(!o||C&2)&&{stroke:x[1]},(!o||C&28&&n!==(n=x[4]?Number(x[3])*24/Number(x[2]):x[3]))&&{"stroke-width":n},(!o||C&257&&i!==(i=x[6]("lucide-icon","lucide",x[0]?`lucide-${x[0]}`:"",x[8].class)))&&{class:i}]))},i(x){o||(N(p,x),o=!0)},o(x){V(p,x),o=!1},d(x){x&&q(e),gi(a,x),p&&p.d(x)}}}function Pk(r,e,t){const n=["name","color","size","strokeWidth","absoluteStrokeWidth","iconNode"];let i=j_(e,n),{$$slots:o={},$$scope:u}=e,{name:a=void 0}=e,{color:d="currentColor"}=e,{size:p=24}=e,{strokeWidth:g=2}=e,{absoluteStrokeWidth:y=!1}=e,{iconNode:x=[]}=e;const C=(...M)=>M.filter((F,z,E)=>!!F&&E.indexOf(F)===z).join(" ");return r.$$set=M=>{t(8,e=Mt(Mt({},e),pr(M))),t(7,i=j_(e,n)),"name"in M&&t(0,a=M.name),"color"in M&&t(1,d=M.color),"size"in M&&t(2,p=M.size),"strokeWidth"in M&&t(3,g=M.strokeWidth),"absoluteStrokeWidth"in M&&t(4,y=M.absoluteStrokeWidth),"iconNode"in M&&t(5,x=M.iconNode),"$$scope"in M&&t(9,u=M.$$scope)},e=pr(e),[a,d,p,g,y,x,C,i,e,u,o]}class zk extends St{constructor(e){super(),kt(this,e,Pk,Ak,_t,{name:0,color:1,size:2,strokeWidth:3,absoluteStrokeWidth:4,iconNode:5})}}const vo=zk;function Dk(r){let e;const t=r[2].default,n=mn(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&_n(n,t,i,i[3],e?gn(t,i[3],o,null):yn(i[3]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function Rk(r){let e,t;const n=[{name:"circle-help"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[Dk]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=Mt(i,n[o]);return e=new vo({props:i}),{c(){ce(e.$$.fragment)},m(o,u){le(e,o,u),t=!0},p(o,[u]){const a=u&3?En(n,[n[0],u&2&&bo(o[1]),u&1&&{iconNode:o[0]}]):{};u&8&&(a.$$scope={dirty:u,ctx:o}),e.$set(a)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){ue(e,o)}}}function Fk(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["circle",{cx:"12",cy:"12",r:"10"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"}],["path",{d:"M12 17h.01"}]];return r.$$set=u=>{t(1,e=Mt(Mt({},e),pr(u))),"$$scope"in u&&t(3,i=u.$$scope)},e=pr(e),[o,e,n,i]}class Bk extends St{constructor(e){super(),kt(this,e,Fk,Rk,_t,{})}}const $k=Bk;function Ok(r){let e;const t=r[2].default,n=mn(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&_n(n,t,i,i[3],e?gn(t,i[3],o,null):yn(i[3]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function Nk(r){let e,t;const n=[{name:"circle-plus"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[Ok]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=Mt(i,n[o]);return e=new vo({props:i}),{c(){ce(e.$$.fragment)},m(o,u){le(e,o,u),t=!0},p(o,[u]){const a=u&3?En(n,[n[0],u&2&&bo(o[1]),u&1&&{iconNode:o[0]}]):{};u&8&&(a.$$scope={dirty:u,ctx:o}),e.$set(a)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){ue(e,o)}}}function jk(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["circle",{cx:"12",cy:"12",r:"10"}],["path",{d:"M8 12h8"}],["path",{d:"M12 8v8"}]];return r.$$set=u=>{t(1,e=Mt(Mt({},e),pr(u))),"$$scope"in u&&t(3,i=u.$$scope)},e=pr(e),[o,e,n,i]}class Uk extends St{constructor(e){super(),kt(this,e,jk,Nk,_t,{})}}const Vk=Uk;function qk(r){let e;const t=r[2].default,n=mn(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&_n(n,t,i,i[3],e?gn(t,i[3],o,null):yn(i[3]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function Zk(r){let e,t;const n=[{name:"eraser"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[qk]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=Mt(i,n[o]);return e=new vo({props:i}),{c(){ce(e.$$.fragment)},m(o,u){le(e,o,u),t=!0},p(o,[u]){const a=u&3?En(n,[n[0],u&2&&bo(o[1]),u&1&&{iconNode:o[0]}]):{};u&8&&(a.$$scope={dirty:u,ctx:o}),e.$set(a)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){ue(e,o)}}}function Gk(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["path",{d:"m7 21-4.3-4.3c-1-1-1-2.5 0-3.4l9.6-9.6c1-1 2.5-1 3.4 0l5.6 5.6c1 1 1 2.5 0 3.4L13 21"}],["path",{d:"M22 21H7"}],["path",{d:"m5 11 9 9"}]];return r.$$set=u=>{t(1,e=Mt(Mt({},e),pr(u))),"$$scope"in u&&t(3,i=u.$$scope)},e=pr(e),[o,e,n,i]}class Hk extends St{constructor(e){super(),kt(this,e,Gk,Zk,_t,{})}}const Wk=Hk;function Kk(r){let e;const t=r[2].default,n=mn(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&_n(n,t,i,i[3],e?gn(t,i[3],o,null):yn(i[3]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function Xk(r){let e,t;const n=[{name:"eye-closed"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[Kk]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=Mt(i,n[o]);return e=new vo({props:i}),{c(){ce(e.$$.fragment)},m(o,u){le(e,o,u),t=!0},p(o,[u]){const a=u&3?En(n,[n[0],u&2&&bo(o[1]),u&1&&{iconNode:o[0]}]):{};u&8&&(a.$$scope={dirty:u,ctx:o}),e.$set(a)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){ue(e,o)}}}function Jk(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["path",{d:"m15 18-.722-3.25"}],["path",{d:"M2 8a10.645 10.645 0 0 0 20 0"}],["path",{d:"m20 15-1.726-2.05"}],["path",{d:"m4 15 1.726-2.05"}],["path",{d:"m9 18 .722-3.25"}]];return r.$$set=u=>{t(1,e=Mt(Mt({},e),pr(u))),"$$scope"in u&&t(3,i=u.$$scope)},e=pr(e),[o,e,n,i]}class Yk extends St{constructor(e){super(),kt(this,e,Jk,Xk,_t,{})}}const Qk=Yk;function e3(r){let e;const t=r[2].default,n=mn(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&_n(n,t,i,i[3],e?gn(t,i[3],o,null):yn(i[3]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function t3(r){let e,t;const n=[{name:"eye"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[e3]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=Mt(i,n[o]);return e=new vo({props:i}),{c(){ce(e.$$.fragment)},m(o,u){le(e,o,u),t=!0},p(o,[u]){const a=u&3?En(n,[n[0],u&2&&bo(o[1]),u&1&&{iconNode:o[0]}]):{};u&8&&(a.$$scope={dirty:u,ctx:o}),e.$set(a)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){ue(e,o)}}}function n3(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0"}],["circle",{cx:"12",cy:"12",r:"3"}]];return r.$$set=u=>{t(1,e=Mt(Mt({},e),pr(u))),"$$scope"in u&&t(3,i=u.$$scope)},e=pr(e),[o,e,n,i]}class r3 extends St{constructor(e){super(),kt(this,e,n3,t3,_t,{})}}const i3=r3;function o3(r){let e;const t=r[2].default,n=mn(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&_n(n,t,i,i[3],e?gn(t,i[3],o,null):yn(i[3]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function s3(r){let e,t;const n=[{name:"file-down"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[o3]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=Mt(i,n[o]);return e=new vo({props:i}),{c(){ce(e.$$.fragment)},m(o,u){le(e,o,u),t=!0},p(o,[u]){const a=u&3?En(n,[n[0],u&2&&bo(o[1]),u&1&&{iconNode:o[0]}]):{};u&8&&(a.$$scope={dirty:u,ctx:o}),e.$set(a)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){ue(e,o)}}}function a3(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4"}],["path",{d:"M12 18v-6"}],["path",{d:"m9 15 3 3 3-3"}]];return r.$$set=u=>{t(1,e=Mt(Mt({},e),pr(u))),"$$scope"in u&&t(3,i=u.$$scope)},e=pr(e),[o,e,n,i]}class l3 extends St{constructor(e){super(),kt(this,e,a3,s3,_t,{})}}const Qb=l3;function u3(r){let e;const t=r[2].default,n=mn(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&_n(n,t,i,i[3],e?gn(t,i[3],o,null):yn(i[3]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function c3(r){let e,t;const n=[{name:"house"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[u3]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=Mt(i,n[o]);return e=new vo({props:i}),{c(){ce(e.$$.fragment)},m(o,u){le(e,o,u),t=!0},p(o,[u]){const a=u&3?En(n,[n[0],u&2&&bo(o[1]),u&1&&{iconNode:o[0]}]):{};u&8&&(a.$$scope={dirty:u,ctx:o}),e.$set(a)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){ue(e,o)}}}function h3(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"}]];return r.$$set=u=>{t(1,e=Mt(Mt({},e),pr(u))),"$$scope"in u&&t(3,i=u.$$scope)},e=pr(e),[o,e,n,i]}class f3 extends St{constructor(e){super(),kt(this,e,h3,c3,_t,{})}}const d3=f3;function p3(r){let e;const t=r[2].default,n=mn(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&_n(n,t,i,i[3],e?gn(t,i[3],o,null):yn(i[3]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function m3(r){let e,t;const n=[{name:"layers"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[p3]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=Mt(i,n[o]);return e=new vo({props:i}),{c(){ce(e.$$.fragment)},m(o,u){le(e,o,u),t=!0},p(o,[u]){const a=u&3?En(n,[n[0],u&2&&bo(o[1]),u&1&&{iconNode:o[0]}]):{};u&8&&(a.$$scope={dirty:u,ctx:o}),e.$set(a)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){ue(e,o)}}}function g3(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17"}]];return r.$$set=u=>{t(1,e=Mt(Mt({},e),pr(u))),"$$scope"in u&&t(3,i=u.$$scope)},e=pr(e),[o,e,n,i]}class _3 extends St{constructor(e){super(),kt(this,e,g3,m3,_t,{})}}const y3=_3;function b3(r){let e;const t=r[2].default,n=mn(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&_n(n,t,i,i[3],e?gn(t,i[3],o,null):yn(i[3]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function v3(r){let e,t;const n=[{name:"paintbrush"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[b3]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=Mt(i,n[o]);return e=new vo({props:i}),{c(){ce(e.$$.fragment)},m(o,u){le(e,o,u),t=!0},p(o,[u]){const a=u&3?En(n,[n[0],u&2&&bo(o[1]),u&1&&{iconNode:o[0]}]):{};u&8&&(a.$$scope={dirty:u,ctx:o}),e.$set(a)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){ue(e,o)}}}function w3(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["path",{d:"m14.622 17.897-10.68-2.913"}],["path",{d:"M18.376 2.622a1 1 0 1 1 3.002 3.002L17.36 9.643a.5.5 0 0 0 0 .707l.944.944a2.41 2.41 0 0 1 0 3.408l-.944.944a.5.5 0 0 1-.707 0L8.354 7.348a.5.5 0 0 1 0-.707l.944-.944a2.41 2.41 0 0 1 3.408 0l.944.944a.5.5 0 0 0 .707 0z"}],["path",{d:"M9 8c-1.804 2.71-3.97 3.46-6.583 3.948a.507.507 0 0 0-.302.819l7.32 8.883a1 1 0 0 0 1.185.204C12.735 20.405 16 16.792 16 15"}]];return r.$$set=u=>{t(1,e=Mt(Mt({},e),pr(u))),"$$scope"in u&&t(3,i=u.$$scope)},e=pr(e),[o,e,n,i]}class x3 extends St{constructor(e){super(),kt(this,e,w3,v3,_t,{})}}const ev=x3;function k3(r){let e;const t=r[2].default,n=mn(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&_n(n,t,i,i[3],e?gn(t,i[3],o,null):yn(i[3]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function S3(r){let e,t;const n=[{name:"pencil"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[k3]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=Mt(i,n[o]);return e=new vo({props:i}),{c(){ce(e.$$.fragment)},m(o,u){le(e,o,u),t=!0},p(o,[u]){const a=u&3?En(n,[n[0],u&2&&bo(o[1]),u&1&&{iconNode:o[0]}]):{};u&8&&(a.$$scope={dirty:u,ctx:o}),e.$set(a)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){ue(e,o)}}}function T3(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z"}],["path",{d:"m15 5 4 4"}]];return r.$$set=u=>{t(1,e=Mt(Mt({},e),pr(u))),"$$scope"in u&&t(3,i=u.$$scope)},e=pr(e),[o,e,n,i]}class C3 extends St{constructor(e){super(),kt(this,e,T3,S3,_t,{})}}const tv=C3;function M3(r){let e;const t=r[2].default,n=mn(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&_n(n,t,i,i[3],e?gn(t,i[3],o,null):yn(i[3]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function L3(r){let e,t;const n=[{name:"pointer"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[M3]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=Mt(i,n[o]);return e=new vo({props:i}),{c(){ce(e.$$.fragment)},m(o,u){le(e,o,u),t=!0},p(o,[u]){const a=u&3?En(n,[n[0],u&2&&bo(o[1]),u&1&&{iconNode:o[0]}]):{};u&8&&(a.$$scope={dirty:u,ctx:o}),e.$set(a)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){ue(e,o)}}}function E3(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["path",{d:"M22 14a8 8 0 0 1-8 8"}],["path",{d:"M18 11v-1a2 2 0 0 0-2-2a2 2 0 0 0-2 2"}],["path",{d:"M14 10V9a2 2 0 0 0-2-2a2 2 0 0 0-2 2v1"}],["path",{d:"M10 9.5V4a2 2 0 0 0-2-2a2 2 0 0 0-2 2v10"}],["path",{d:"M18 11a2 2 0 1 1 4 0v3a8 8 0 0 1-8 8h-2c-2.8 0-4.5-.86-5.99-2.34l-3.6-3.6a2 2 0 0 1 2.83-2.82L7 15"}]];return r.$$set=u=>{t(1,e=Mt(Mt({},e),pr(u))),"$$scope"in u&&t(3,i=u.$$scope)},e=pr(e),[o,e,n,i]}class I3 extends St{constructor(e){super(),kt(this,e,E3,L3,_t,{})}}const A3=I3;function P3(r){let e;const t=r[2].default,n=mn(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&_n(n,t,i,i[3],e?gn(t,i[3],o,null):yn(i[3]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function z3(r){let e,t;const n=[{name:"redo"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[P3]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=Mt(i,n[o]);return e=new vo({props:i}),{c(){ce(e.$$.fragment)},m(o,u){le(e,o,u),t=!0},p(o,[u]){const a=u&3?En(n,[n[0],u&2&&bo(o[1]),u&1&&{iconNode:o[0]}]):{};u&8&&(a.$$scope={dirty:u,ctx:o}),e.$set(a)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){ue(e,o)}}}function D3(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["path",{d:"M21 7v6h-6"}],["path",{d:"M3 17a9 9 0 0 1 9-9 9 9 0 0 1 6 2.3l3 2.7"}]];return r.$$set=u=>{t(1,e=Mt(Mt({},e),pr(u))),"$$scope"in u&&t(3,i=u.$$scope)},e=pr(e),[o,e,n,i]}class R3 extends St{constructor(e){super(),kt(this,e,D3,z3,_t,{})}}const F3=R3;function B3(r){let e;const t=r[2].default,n=mn(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&_n(n,t,i,i[3],e?gn(t,i[3],o,null):yn(i[3]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function $3(r){let e,t;const n=[{name:"trash-2"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[B3]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=Mt(i,n[o]);return e=new vo({props:i}),{c(){ce(e.$$.fragment)},m(o,u){le(e,o,u),t=!0},p(o,[u]){const a=u&3?En(n,[n[0],u&2&&bo(o[1]),u&1&&{iconNode:o[0]}]):{};u&8&&(a.$$scope={dirty:u,ctx:o}),e.$set(a)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){ue(e,o)}}}function O3(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["path",{d:"M3 6h18"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17"}]];return r.$$set=u=>{t(1,e=Mt(Mt({},e),pr(u))),"$$scope"in u&&t(3,i=u.$$scope)},e=pr(e),[o,e,n,i]}class N3 extends St{constructor(e){super(),kt(this,e,O3,$3,_t,{})}}const Jm=N3;function j3(r){let e;const t=r[2].default,n=mn(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&_n(n,t,i,i[3],e?gn(t,i[3],o,null):yn(i[3]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function U3(r){let e,t;const n=[{name:"undo"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[j3]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=Mt(i,n[o]);return e=new vo({props:i}),{c(){ce(e.$$.fragment)},m(o,u){le(e,o,u),t=!0},p(o,[u]){const a=u&3?En(n,[n[0],u&2&&bo(o[1]),u&1&&{iconNode:o[0]}]):{};u&8&&(a.$$scope={dirty:u,ctx:o}),e.$set(a)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){ue(e,o)}}}function V3(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["path",{d:"M3 7v6h6"}],["path",{d:"M21 17a9 9 0 0 0-9-9 9 9 0 0 0-6 2.3L3 13"}]];return r.$$set=u=>{t(1,e=Mt(Mt({},e),pr(u))),"$$scope"in u&&t(3,i=u.$$scope)},e=pr(e),[o,e,n,i]}class q3 extends St{constructor(e){super(),kt(this,e,V3,U3,_t,{})}}const Z3=q3;let G3=Date.now();function wl(r){return`${r}-${G3++}`}const Ym=Symbol.for("svelte-maplibre");function Da(){return Th(Ym)}function H3(r){let e=new WeakMap;return t=>{var u;let n=e.get(t.originalEvent);if(n!==void 0)return n;let o=(u=t.target.queryRenderedFeatures(t.point).find(a=>{var d;return(d=r.get(a.layer.id))==null?void 0:d.interactive}))==null?void 0:u.layer.id;return e.set(t.originalEvent,o),o}}function W3(){let r=new Map;return wd(Ym,{map:Ln(null),source:qp(null),layer:qp(null),popupTarget:qp(null),cluster:Ln(),loadedImages:Ln(new Set),minzoom:Ln(0),maxzoom:Ln(24),layerEvent:Ln(null),layerInfo:r,eventTopMost:H3(r),markerClickManager:new J3})}function i0(r){return{subscribe:r.subscribe}}function Qm({key:r,setPopupTarget:e=!1,setCluster:t=!1,setMouseEvent:n=!1}){let i=Da(),o=Ln(null),u=i0(o),a={...i,[r]:i0(o)};if(e&&(a.popupTarget=u),n){let d=Ln(null);a.layerEvent=d,i.layerEvent=d}return t&&(a.cluster=Ln()),wd(Ym,a),{...i,self:o}}function nv(){return Qm({key:"source",setCluster:!0})}function rv(r=!0){return Qm({key:"layer",setPopupTarget:r,setMouseEvent:r})}function K3(){return Qm({key:"popupTarget",setPopupTarget:!0,setMouseEvent:!0})}function X3(r){return"layerType"in r&&r.layerType==="deckgl"}class J3{constructor(){Yn(this,"_handlers",new Set)}add(e){this._handlers.add(e)}remove(e){this._handlers.delete(e)}handleClick(e){for(const t of this._handlers)t(e)}}function o0(r){let e;return t=>{if(t)for(let n in t){let i=e==null?void 0:e[n],o=t[n];i!==o&&r(n,o,i)}else if(e)for(let n in e)r(n,void 0,e[n]);e=t}}function Y3(r,...e){let t=[r];for(let n of e)if(n)Array.isArray(n)&&n[0]===r?t.push(...n.slice(1)):t.push(n);else continue;if(t.length!==1)return t.length===2?t[1]:t}function Q3(r){return r===!0?["has","point_count"]:r===!1?["!",["has","point_count"]]:void 0}function Wn(r,e){return["case",["boolean",["feature-state","hover"],!1],e,r]}var La=e4;function e4(r){var e,t,n;if(r){if(Array.isArray(r)){for(e=[],t=r.length,n=0;n<t;n++){var i=r[n];i!=null&&e.push(i)}return e}if(typeof r=="object"){e={};var o=Object.keys(r);for(t=o.length,n=0;n<t;n++){var u=o[n],a=r[u];a!=null&&(e[u]=a)}return e}}}function s0(r){let e=r[0],t,n,i=a0(r);return{c(){i.c(),t=Xn()},m(o,u){i.m(o,u),Z(o,t,u),n=!0},p(o,u){u[0]&1&&_t(e,e=o[0])?(Kt(),V(i,1,1,ot),Xt(),i=a0(o),i.c(),N(i,1),i.m(t.parentNode,t)):i.p(o,u)},i(o){n||(N(i),n=!0)},o(o){V(i),n=!1},d(o){o&&q(t),i.d(o)}}}function a0(r){let e;const t=r[36].default,n=mn(t,r,r[35],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o[1]&16)&&_n(n,t,i,i[35],e?gn(t,i[35],o,null):yn(i[35]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function t4(r){let e,t,n=r[0]&&s0(r);return{c(){n&&n.c(),e=Xn()},m(i,o){n&&n.m(i,o),Z(i,e,o),t=!0},p(i,o){i[0]?n?(n.p(i,o),o[0]&1&&N(n,1)):(n=s0(i),n.c(),N(n,1),n.m(e.parentNode,e)):n&&(Kt(),V(n,1,1,()=>{n=null}),Xt())},i(i){t||(N(n),t=!0)},o(i){V(n),t=!1},d(i){i&&q(e),n&&n.d(i)}}}function n4(r,e,t){let n,i,o,u,a,d,p,g,y,x,C,M,{$$slots:F={},$$scope:z}=e,{id:E=wl("layer")}=e,{source:P=void 0}=e,{sourceLayer:$=void 0}=e,{beforeId:U=void 0}=e,{beforeLayerType:K=void 0}=e,{type:ee}=e,{paint:W=void 0}=e,{layout:J=void 0}=e,{filter:he=void 0}=e,{applyToClusters:Ae=void 0}=e,{minzoom:ne=void 0}=e,{maxzoom:fe=void 0}=e,{manageHoverState:Ce=!1}=e,{hovered:_e=null}=e,{interactive:Ze=!0}=e,{hoverCursor:Oe=void 0}=e,{eventsIfTopMost:je=!1}=e;const De=Is(),{map:At,source:ut,self:ht,minzoom:wt,maxzoom:pt,eventTopMost:Qe,layerInfo:Ft}=rv();st(r,At,Ge=>t(31,y=Ge)),st(r,ut,Ge=>t(32,x=Ge)),st(r,ht,Ge=>t(0,g=Ge)),st(r,wt,Ge=>t(34,M=Ge)),st(r,pt,Ge=>t(33,C=Ge)),ti(()=>{g&&y&&(Ft.delete(g),y==null||y.removeLayer(g))});let bt;function Bt(Ge){var ye,kn;if(!Ze||!g||!y||je&&Qe(Ge)!==g)return;let qe=Ge.features??[],Je=(kn=(ye=qe[0])==null?void 0:ye.properties)==null?void 0:kn.cluster_id,Et={event:Ge,map:y,clusterId:Je,layer:g,source:a,features:qe};De(Ge.type,Et)}function Pt(Ge){var ye,kn;if(!Ze||!g||!y||je&&Qe(Ge)!==g)return;Oe&&(y.getCanvas().style.cursor=Oe);let qe=Ge.features??[];t(6,_e=qe[0]??null);let Je=(kn=(ye=qe[0])==null?void 0:ye.properties)==null?void 0:kn.cluster_id;De("mouseenter",{event:Ge,map:y,clusterId:Je,layer:g,source:a,features:qe})}function Qt(Ge){var ye,kn,Ue;if(!Ze||!y)return;if(je&&Qe(Ge)!==g){t(6,_e=null),Ce&&bt!==void 0&&(y==null||y.setFeatureState({source:a,sourceLayer:$,id:bt},{hover:!1}),bt=void 0);return}y.getCanvas().style.cursor=Oe;let qe=Ge.features??[],Je=(kn=(ye=qe[0])==null?void 0:ye.properties)==null?void 0:kn.cluster_id,Et=(Ue=qe[0])==null?void 0:Ue.id;Et!==bt&&(Ce&&(bt!==void 0&&(y==null||y.setFeatureState({source:a,id:bt,sourceLayer:$},{hover:!1})),y==null||y.setFeatureState({source:a,id:Et,sourceLayer:$},{hover:!0})),bt=Et,t(6,_e=qe[0]??null)),De("mousemove",{event:Ge,map:y,clusterId:Je,layer:g,source:a,features:qe})}function vn(Ge){if(!(!Ze||!g||!y)){if(Oe&&(y.getCanvas().style.cursor=""),t(6,_e=null),Ce&&bt!==void 0){const qe={source:a,id:bt,sourceLayer:$};y==null||y.setFeatureState(qe,{hover:!1}),bt=void 0}De("mouseleave",{map:y,layer:g,source:a})}}let qt=!0;function rn(Ge){y&&(y.off("click",Ge,Bt),y.off("dblclick",Ge,Bt),y.off("contextmenu",Ge,Bt),y.off("mouseenter",Ge,Pt),y.off("mousemove",Ge,Qt),y.off("mouseleave",Ge,vn))}return ti(()=>{y&&g&&rn(g)}),r.$$set=Ge=>{"id"in Ge&&t(7,E=Ge.id),"source"in Ge&&t(8,P=Ge.source),"sourceLayer"in Ge&&t(9,$=Ge.sourceLayer),"beforeId"in Ge&&t(10,U=Ge.beforeId),"beforeLayerType"in Ge&&t(11,K=Ge.beforeLayerType),"type"in Ge&&t(12,ee=Ge.type),"paint"in Ge&&t(13,W=Ge.paint),"layout"in Ge&&t(14,J=Ge.layout),"filter"in Ge&&t(15,he=Ge.filter),"applyToClusters"in Ge&&t(16,Ae=Ge.applyToClusters),"minzoom"in Ge&&t(17,ne=Ge.minzoom),"maxzoom"in Ge&&t(18,fe=Ge.maxzoom),"manageHoverState"in Ge&&t(19,Ce=Ge.manageHoverState),"hovered"in Ge&&t(6,_e=Ge.hovered),"interactive"in Ge&&t(20,Ze=Ge.interactive),"hoverCursor"in Ge&&t(21,Oe=Ge.hoverCursor),"eventsIfTopMost"in Ge&&t(22,je=Ge.eventsIfTopMost),"$$scope"in Ge&&t(35,z=Ge.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&65536&&t(30,n=Q3(Ae)),r.$$.dirty[0]&1073774592&&t(24,i=Y3("all",n,he)),r.$$.dirty[0]&131072|r.$$.dirty[1]&8&&t(26,o=ne??M),r.$$.dirty[0]&262144|r.$$.dirty[1]&4&&t(25,u=fe??C),r.$$.dirty[0]&256|r.$$.dirty[1]&2&&t(29,a=P||x),r.$$.dirty[0]&654343809|r.$$.dirty[1]&1&&y&&g!==E&&a){g&&(rn(g),Ft.delete(g));let Ge=U;if(!U&&K){let qe=y.getStyle().layers,Je=typeof K=="function"?K:ye=>ye.type===K,Et=qe==null?void 0:qe.find(Je);Et&&(Ge=Et.id)}an(ht,g=E,g),y.addLayer(La({id:g,type:ee,source:a,"source-layer":$,filter:i,paint:W,layout:J,minzoom:o,maxzoom:u}),Ge),t(23,qt=!0),y.on("click",g,Bt),y.on("dblclick",g,Bt),y.on("contextmenu",g,Bt),y.on("mouseenter",g,Pt),y.on("mousemove",g,Qt),y.on("mouseleave",g,vn)}r.$$.dirty[0]&1048577&&g&&Ft.set(g,{interactive:Ze}),r.$$.dirty[0]&1|r.$$.dirty[1]&1&&t(28,d=g?o0((Ge,qe)=>{y!=null&&y.style._loaded?y.setPaintProperty(g,Ge,qe):y==null||y.once("styledata",()=>y==null?void 0:y.setPaintProperty(g,Ge,qe))}):void 0),r.$$.dirty[0]&1|r.$$.dirty[1]&1&&t(27,p=g?o0((Ge,qe)=>{y!=null&&y.style._loaded?y.setLayoutProperty(g,Ge,qe):y==null||y.once("styledata",()=>y==null?void 0:y.setLayoutProperty(g,Ge,qe))}):void 0),r.$$.dirty[0]&268443648&&(d==null||d(W)),r.$$.dirty[0]&134234112&&(p==null||p(J)),r.$$.dirty[0]&100663297|r.$$.dirty[1]&1&&g&&(y==null||y.setLayerZoomRange(g,o,u)),r.$$.dirty[0]&25165825|r.$$.dirty[1]&1&&g&&(qt?t(23,qt=!1):y==null||y.setFilter(g,i))},[g,At,ut,ht,wt,pt,_e,E,P,$,U,K,ee,W,J,he,Ae,ne,fe,Ce,Ze,Oe,je,qt,i,u,o,p,d,a,n,y,x,C,M,z,F]}let Sd=class extends St{constructor(e){super(),kt(this,e,n4,t4,_t,{id:7,source:8,sourceLayer:9,beforeId:10,beforeLayerType:11,type:12,paint:13,layout:14,filter:15,applyToClusters:16,minzoom:17,maxzoom:18,manageHoverState:19,hovered:6,interactive:20,hoverCursor:21,eventsIfTopMost:22},null,[-1,-1])}};function r4(r){let e;const t=r[16].default,n=mn(t,r,r[24],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&16777216)&&_n(n,t,i,i[24],e?gn(t,i[24],o,null):yn(i[24]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function i4(r){let e,t,n;function i(u){r[17](u)}let o={id:r[1],type:"circle",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],applyToClusters:r[9],minzoom:r[10],maxzoom:r[11],hoverCursor:r[12],manageHoverState:r[13],eventsIfTopMost:r[14],interactive:r[15],$$slots:{default:[r4]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.hovered=r[0]),e=new Sd({props:o}),un.push(()=>Pn(e,"hovered",i)),e.$on("click",r[18]),e.$on("dblclick",r[19]),e.$on("contextmenu",r[20]),e.$on("mouseenter",r[21]),e.$on("mousemove",r[22]),e.$on("mouseleave",r[23]),{c(){ce(e.$$.fragment)},m(u,a){le(e,u,a),n=!0},p(u,[a]){const d={};a&2&&(d.id=u[1]),a&4&&(d.source=u[2]),a&8&&(d.sourceLayer=u[3]),a&16&&(d.beforeId=u[4]),a&32&&(d.beforeLayerType=u[5]),a&64&&(d.paint=u[6]),a&128&&(d.layout=u[7]),a&256&&(d.filter=u[8]),a&512&&(d.applyToClusters=u[9]),a&1024&&(d.minzoom=u[10]),a&2048&&(d.maxzoom=u[11]),a&4096&&(d.hoverCursor=u[12]),a&8192&&(d.manageHoverState=u[13]),a&16384&&(d.eventsIfTopMost=u[14]),a&32768&&(d.interactive=u[15]),a&16777216&&(d.$$scope={dirty:a,ctx:u}),!t&&a&1&&(t=!0,d.hovered=u[0],An(()=>t=!1)),e.$set(d)},i(u){n||(N(e.$$.fragment,u),n=!0)},o(u){V(e.$$.fragment,u),n=!1},d(u){ue(e,u)}}}function o4(r,e,t){let{$$slots:n={},$$scope:i}=e,{id:o=wl("circle")}=e,{source:u=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:d=void 0}=e,{beforeLayerType:p=void 0}=e,{paint:g}=e,{layout:y=void 0}=e,{filter:x=void 0}=e,{applyToClusters:C=void 0}=e,{minzoom:M=void 0}=e,{maxzoom:F=void 0}=e,{hoverCursor:z=void 0}=e,{manageHoverState:E=!1}=e,{hovered:P=null}=e,{eventsIfTopMost:$=!1}=e,{interactive:U=!0}=e;function K(fe){P=fe,t(0,P)}function ee(fe){In.call(this,r,fe)}function W(fe){In.call(this,r,fe)}function J(fe){In.call(this,r,fe)}function he(fe){In.call(this,r,fe)}function Ae(fe){In.call(this,r,fe)}function ne(fe){In.call(this,r,fe)}return r.$$set=fe=>{"id"in fe&&t(1,o=fe.id),"source"in fe&&t(2,u=fe.source),"sourceLayer"in fe&&t(3,a=fe.sourceLayer),"beforeId"in fe&&t(4,d=fe.beforeId),"beforeLayerType"in fe&&t(5,p=fe.beforeLayerType),"paint"in fe&&t(6,g=fe.paint),"layout"in fe&&t(7,y=fe.layout),"filter"in fe&&t(8,x=fe.filter),"applyToClusters"in fe&&t(9,C=fe.applyToClusters),"minzoom"in fe&&t(10,M=fe.minzoom),"maxzoom"in fe&&t(11,F=fe.maxzoom),"hoverCursor"in fe&&t(12,z=fe.hoverCursor),"manageHoverState"in fe&&t(13,E=fe.manageHoverState),"hovered"in fe&&t(0,P=fe.hovered),"eventsIfTopMost"in fe&&t(14,$=fe.eventsIfTopMost),"interactive"in fe&&t(15,U=fe.interactive),"$$scope"in fe&&t(24,i=fe.$$scope)},[P,o,u,a,d,p,g,y,x,C,M,F,z,E,$,U,n,K,ee,W,J,he,Ae,ne,i]}let xl=class extends St{constructor(e){super(),kt(this,e,o4,i4,_t,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}};function s4(r){let e,t;const n=r[7].default,i=mn(n,r,r[6],null);return{c(){e=j("div"),i&&i.c(),ae(e,"class",r[1]),jt(e,"maplibregl-ctrl",r[0])},m(o,u){Z(o,e,u),i&&i.m(e,null),r[8](e),t=!0},p(o,[u]){i&&i.p&&(!t||u&64)&&_n(i,n,o,o[6],t?gn(n,o[6],u,null):yn(o[6]),null),(!t||u&2)&&ae(e,"class",o[1]),(!t||u&3)&&jt(e,"maplibregl-ctrl",o[0])},i(o){t||(N(i,o),t=!0)},o(o){V(i,o),t=!1},d(o){o&&q(e),i&&i.d(o),r[8](null)}}}function a4(r,e,t){let n,{$$slots:i={},$$scope:o}=e,{defaultStyling:u=!0}=e,{position:a="top-right"}=e,{class:d=void 0}=e;const{map:p}=Da();st(r,p,C=>t(5,n=C));let g,y={onAdd(){return g},onRemove(){var C;(C=g==null?void 0:g.parentNode)==null||C.removeChild(g)}};ti(()=>{n==null||n.removeControl(y)});function x(C){un[C?"unshift":"push"](()=>{g=C,t(2,g)})}return r.$$set=C=>{"defaultStyling"in C&&t(0,u=C.defaultStyling),"position"in C&&t(4,a=C.position),"class"in C&&t(1,d=C.class),"$$scope"in C&&t(6,o=C.$$scope)},r.$$.update=()=>{r.$$.dirty&52&&n&&g&&n.addControl(y,a)},[u,d,g,p,a,n,o,i,x]}class pm extends St{constructor(e){super(),kt(this,e,a4,s4,_t,{defaultStyling:0,position:4,class:1})}}function l4(r){let e,t,n,i,o,u;const a=r[5].default,d=mn(a,r,r[4],null);return{c(){e=j("button"),t=j("div"),d&&d.c(),ae(t,"class",n=Bu(r[3])+" svelte-1s83zbq"),jt(t,"maplibregl-ctrl-icon",r[0]),jt(t,"ctrl-btn-center",r[1]),ae(e,"type","button"),ae(e,"title",r[2])},m(p,g){Z(p,e,g),D(e,t),d&&d.m(t,null),i=!0,o||(u=Tt(e,"click",r[6]),o=!0)},p(p,[g]){d&&d.p&&(!i||g&16)&&_n(d,a,p,p[4],i?gn(a,p[4],g,null):yn(p[4]),null),(!i||g&8&&n!==(n=Bu(p[3])+" svelte-1s83zbq"))&&ae(t,"class",n),(!i||g&9)&&jt(t,"maplibregl-ctrl-icon",p[0]),(!i||g&10)&&jt(t,"ctrl-btn-center",p[1]),(!i||g&4)&&ae(e,"title",p[2])},i(p){i||(N(d,p),i=!0)},o(p){V(d,p),i=!1},d(p){p&&q(e),d&&d.d(p),o=!1,u()}}}function u4(r,e,t){let{$$slots:n={},$$scope:i}=e,{icon:o=!0}=e,{center:u=!0}=e,{title:a=void 0}=e,{class:d=void 0}=e;function p(g){In.call(this,r,g)}return r.$$set=g=>{"icon"in g&&t(0,o=g.icon),"center"in g&&t(1,u=g.center),"title"in g&&t(2,a=g.title),"class"in g&&t(3,d=g.class),"$$scope"in g&&t(4,i=g.$$scope)},[o,u,a,d,i,n,p]}class iv extends St{constructor(e){super(),kt(this,e,u4,l4,_t,{icon:0,center:1,title:2,class:3})}}function c4(r){let e,t,n;const i=r[2].default,o=mn(i,r,r[1],null);return{c(){e=j("div"),o&&o.c(),ae(e,"class",t="maplibregl-ctrl-group "+r[0])},m(u,a){Z(u,e,a),o&&o.m(e,null),n=!0},p(u,[a]){o&&o.p&&(!n||a&2)&&_n(o,i,u,u[1],n?gn(i,u[1],a,null):yn(u[1]),null),(!n||a&1&&t!==(t="maplibregl-ctrl-group "+u[0]))&&ae(e,"class",t)},i(u){n||(N(o,u),n=!0)},o(u){V(o,u),n=!1},d(u){u&&q(e),o&&o.d(u)}}}function h4(r,e,t){let{$$slots:n={},$$scope:i}=e,{class:o=""}=e;return r.$$set=u=>{"class"in u&&t(0,o=u.class),"$$scope"in u&&t(1,i=u.$$scope)},[o,i,n]}class ov extends St{constructor(e){super(),kt(this,e,h4,c4,_t,{class:0})}}function f4(r){let e;const t=r[15].default,n=mn(t,r,r[23],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8388608)&&_n(n,t,i,i[23],e?gn(t,i[23],o,null):yn(i[23]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function d4(r){let e,t,n;function i(u){r[16](u)}let o={id:r[1],type:"fill",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],minzoom:r[9],maxzoom:r[10],hoverCursor:r[11],manageHoverState:r[12],eventsIfTopMost:r[13],interactive:r[14],$$slots:{default:[f4]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.hovered=r[0]),e=new Sd({props:o}),un.push(()=>Pn(e,"hovered",i)),e.$on("click",r[17]),e.$on("dblclick",r[18]),e.$on("contextmenu",r[19]),e.$on("mouseenter",r[20]),e.$on("mousemove",r[21]),e.$on("mouseleave",r[22]),{c(){ce(e.$$.fragment)},m(u,a){le(e,u,a),n=!0},p(u,[a]){const d={};a&2&&(d.id=u[1]),a&4&&(d.source=u[2]),a&8&&(d.sourceLayer=u[3]),a&16&&(d.beforeId=u[4]),a&32&&(d.beforeLayerType=u[5]),a&64&&(d.paint=u[6]),a&128&&(d.layout=u[7]),a&256&&(d.filter=u[8]),a&512&&(d.minzoom=u[9]),a&1024&&(d.maxzoom=u[10]),a&2048&&(d.hoverCursor=u[11]),a&4096&&(d.manageHoverState=u[12]),a&8192&&(d.eventsIfTopMost=u[13]),a&16384&&(d.interactive=u[14]),a&8388608&&(d.$$scope={dirty:a,ctx:u}),!t&&a&1&&(t=!0,d.hovered=u[0],An(()=>t=!1)),e.$set(d)},i(u){n||(N(e.$$.fragment,u),n=!0)},o(u){V(e.$$.fragment,u),n=!1},d(u){ue(e,u)}}}function p4(r,e,t){let{$$slots:n={},$$scope:i}=e,{id:o=wl("fill")}=e,{source:u=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:d=void 0}=e,{beforeLayerType:p=void 0}=e,{paint:g}=e,{layout:y=void 0}=e,{filter:x=void 0}=e,{minzoom:C=void 0}=e,{maxzoom:M=void 0}=e,{hoverCursor:F=void 0}=e,{manageHoverState:z=!1}=e,{hovered:E=null}=e,{eventsIfTopMost:P=!1}=e,{interactive:$=!0}=e;function U(ne){E=ne,t(0,E)}function K(ne){In.call(this,r,ne)}function ee(ne){In.call(this,r,ne)}function W(ne){In.call(this,r,ne)}function J(ne){In.call(this,r,ne)}function he(ne){In.call(this,r,ne)}function Ae(ne){In.call(this,r,ne)}return r.$$set=ne=>{"id"in ne&&t(1,o=ne.id),"source"in ne&&t(2,u=ne.source),"sourceLayer"in ne&&t(3,a=ne.sourceLayer),"beforeId"in ne&&t(4,d=ne.beforeId),"beforeLayerType"in ne&&t(5,p=ne.beforeLayerType),"paint"in ne&&t(6,g=ne.paint),"layout"in ne&&t(7,y=ne.layout),"filter"in ne&&t(8,x=ne.filter),"minzoom"in ne&&t(9,C=ne.minzoom),"maxzoom"in ne&&t(10,M=ne.maxzoom),"hoverCursor"in ne&&t(11,F=ne.hoverCursor),"manageHoverState"in ne&&t(12,z=ne.manageHoverState),"hovered"in ne&&t(0,E=ne.hovered),"eventsIfTopMost"in ne&&t(13,P=ne.eventsIfTopMost),"interactive"in ne&&t(14,$=ne.interactive),"$$scope"in ne&&t(23,i=ne.$$scope)},[E,o,u,a,d,p,g,y,x,C,M,F,z,P,$,n,U,K,ee,W,J,he,Ae,i]}let Ki=class extends St{constructor(e){super(),kt(this,e,p4,d4,_t,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}};function m4(r,e,t){let n;const{map:i}=Da();st(r,i,d=>t(4,n=d));let{position:o="top-left"}=e,{container:u=void 0}=e,a=null;return ti(()=>{n!=null&&n.loaded()&&a&&n.removeControl(a)}),r.$$set=d=>{"position"in d&&t(1,o=d.position),"container"in d&&t(2,u=d.container)},r.$$.update=()=>{if(r.$$.dirty&30&&n&&!a){let d;typeof u=="string"?d=document.querySelector(u)??void 0:d=u,t(3,a=new ei.FullscreenControl({container:d})),n.addControl(a,o)}},[i,o,u,a,n]}class g4 extends St{constructor(e){super(),kt(this,e,m4,null,_t,{position:1,container:2})}}function sv(r,e,t,n,i){let o=!1;r.getSource(e)&&(o=!0,r.removeSource(e));const u=()=>{n(e)&&(r.addSource(e,t),i())};if(o){const a=()=>{e&&(r.getSource(e)?setTimeout(a,1):u())};a()}else u()}function av(r,e,t){Ab().then(()=>{let n=Ci(r);if(!n)return;n.getSource(e)===t&&n.removeSource(e)})}function l0(r){let e=r[0],t,n,i=u0(r);return{c(){i.c(),t=Xn()},m(o,u){i.m(o,u),Z(o,t,u),n=!0},p(o,u){u&1&&_t(e,e=o[0])?(Kt(),V(i,1,1,ot),Xt(),i=u0(o),i.c(),N(i,1),i.m(t.parentNode,t)):i.p(o,u)},i(o){n||(N(i),n=!0)},o(o){V(i),n=!1},d(o){o&&q(t),i.d(o)}}}function u0(r){let e;const t=r[19].default,n=mn(t,r,r[18],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&262144)&&_n(n,t,i,i[18],e?gn(t,i[18],o,null):yn(i[18]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function _4(r){let e,t,n=r[0]&&l0(r);return{c(){n&&n.c(),e=Xn()},m(i,o){n&&n.m(i,o),Z(i,e,o),t=!0},p(i,[o]){i[0]?n?(n.p(i,o),o&1&&N(n,1)):(n=l0(i),n.c(),N(n,1),n.m(e.parentNode,e)):n&&(Kt(),V(n,1,1,()=>{n=null}),Xt())},i(i){t||(N(n),t=!0)},o(i){V(n),t=!1},d(i){i&&q(e),n&&n.d(i)}}}function y4(r,e,t){let n,i,o,{$$slots:u={},$$scope:a}=e,{id:d=wl("geojson")}=e,{data:p}=e,{generateId:g=!1}=e,{promoteId:y=void 0}=e,{filter:x=void 0}=e,{lineMetrics:C=void 0}=e,{cluster:M=void 0}=e,{maxzoom:F=void 0}=e,{attribution:z=void 0}=e,{buffer:E=void 0}=e,{tolerance:P=void 0}=e;const{map:$,cluster:U,self:K}=nv();st(r,$,J=>t(17,i=J)),st(r,U,J=>t(20,o=J)),st(r,K,J=>t(0,n=J));let ee,W=!0;return ti(()=>{n&&ee&&i&&(av($,n,ee),an(K,n=null,n),t(15,ee=void 0))}),r.$$set=J=>{"id"in J&&t(4,d=J.id),"data"in J&&t(5,p=J.data),"generateId"in J&&t(6,g=J.generateId),"promoteId"in J&&t(7,y=J.promoteId),"filter"in J&&t(8,x=J.filter),"lineMetrics"in J&&t(9,C=J.lineMetrics),"cluster"in J&&t(10,M=J.cluster),"maxzoom"in J&&t(11,F=J.maxzoom),"attribution"in J&&t(12,z=J.attribution),"buffer"in J&&t(13,E=J.buffer),"tolerance"in J&&t(14,P=J.tolerance),"$$scope"in J&&t(18,a=J.$$scope)},r.$$.update=()=>{r.$$.dirty&1024&&an(U,o=M,o),r.$$.dirty&196593&&i&&n!==d&&(an(K,n=d,n),sv(i,n,La({type:"geojson",data:p,filter:x,lineMetrics:C,generateId:g,promoteId:y,cluster:!!M,clusterMinPoints:M==null?void 0:M.minPoints,clusterMaxZoom:M==null?void 0:M.maxZoom,clusterRadius:M==null?void 0:M.radius,clusterProperties:M==null?void 0:M.properties,maxzoom:F,attribution:z,buffer:E,tolerance:P}),J=>i&&J===n,()=>{n&&(t(15,ee=i==null?void 0:i.getSource(n)),t(16,W=!0))})),r.$$.dirty&131088&&(i==null||i.on("style.load",()=>{t(15,ee=i==null?void 0:i.getSource(d))})),r.$$.dirty&98336&&ee&&(W?t(16,W=!1):ee.setData(p)),r.$$.dirty&33792&&(ee==null||ee.setClusterOptions(La({cluster:!!M,clusterMaxZoom:M==null?void 0:M.maxZoom,clusterRadius:M==null?void 0:M.radius})))},[n,$,U,K,d,p,g,y,x,C,M,F,z,E,P,ee,W,i,a,u]}let mr=class extends St{constructor(e){super(),kt(this,e,y4,_4,_t,{id:4,data:5,generateId:6,promoteId:7,filter:8,lineMetrics:9,cluster:10,maxzoom:11,attribution:12,buffer:13,tolerance:14})}};function b4(r,e,t){let n;const{map:i}=Da();st(r,i,x=>t(8,n=x));let{position:o="top-left"}=e,{positionOptions:u=void 0}=e,{fitBoundsOptions:a=void 0}=e,{trackUserLocation:d=!1}=e,{showAccuracyCircle:p=!0}=e,{showUserLocation:g=!0}=e,{control:y=null}=e;return ti(()=>{n!=null&&n.loaded()&&y&&n.removeControl(y)}),r.$$set=x=>{"position"in x&&t(2,o=x.position),"positionOptions"in x&&t(3,u=x.positionOptions),"fitBoundsOptions"in x&&t(4,a=x.fitBoundsOptions),"trackUserLocation"in x&&t(5,d=x.trackUserLocation),"showAccuracyCircle"in x&&t(6,p=x.showAccuracyCircle),"showUserLocation"in x&&t(7,g=x.showUserLocation),"control"in x&&t(1,y=x.control)},r.$$.update=()=>{r.$$.dirty&510&&n&&!y&&(t(1,y=new ei.GeolocateControl({positionOptions:u,fitBoundsOptions:a,trackUserLocation:d,showAccuracyCircle:p,showUserLocation:g})),n.addControl(y,o))},[i,y,o,u,a,d,p,g,n]}class v4 extends St{constructor(e){super(),kt(this,e,b4,null,_t,{position:2,positionOptions:3,fitBoundsOptions:4,trackUserLocation:5,showAccuracyCircle:6,showUserLocation:7,control:1})}}function w4(r,e,t){let n,i,{data:o}=e,{idCol:u}=e,{sourceLayer:a=void 0}=e,d=new Set;const{map:p,source:g}=rv();return st(r,p,y=>t(6,n=y)),st(r,g,y=>t(7,i=y)),r.$$set=y=>{"data"in y&&t(2,o=y.data),"idCol"in y&&t(3,u=y.idCol),"sourceLayer"in y&&t(4,a=y.sourceLayer)},r.$$.update=()=>{if(r.$$.dirty&252&&o&&n&&i){let y=new Set;for(const x of o){const C=x[u];if(!C)continue;d.delete(C),y.add(C);const M={id:C,source:i,sourceLayer:a},F=n.getFeatureState(M);let z=!1;for(const E of Object.keys(x))if(F[E]!==x[E]){z=!0;break}z&&n.setFeatureState(M,x)}for(const x of d){const C={id:x,source:i,sourceLayer:a},M=n.getFeatureState(C);for(const F of Object.keys(M))n.removeFeatureState(C,F)}t(5,d=y)}},[p,g,o,u,a,d,n,i]}class x4 extends St{constructor(e){super(),kt(this,e,w4,null,_t,{data:2,idCol:3,sourceLayer:4})}}function k4(r){let e;const t=r[15].default,n=mn(t,r,r[23],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8388608)&&_n(n,t,i,i[23],e?gn(t,i[23],o,null):yn(i[23]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function S4(r){let e,t,n;function i(u){r[16](u)}let o={id:r[1],type:"line",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],minzoom:r[9],maxzoom:r[10],hoverCursor:r[11],manageHoverState:r[12],eventsIfTopMost:r[13],interactive:r[14],$$slots:{default:[k4]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.hovered=r[0]),e=new Sd({props:o}),un.push(()=>Pn(e,"hovered",i)),e.$on("click",r[17]),e.$on("dblclick",r[18]),e.$on("contextmenu",r[19]),e.$on("mouseenter",r[20]),e.$on("mousemove",r[21]),e.$on("mouseleave",r[22]),{c(){ce(e.$$.fragment)},m(u,a){le(e,u,a),n=!0},p(u,[a]){const d={};a&2&&(d.id=u[1]),a&4&&(d.source=u[2]),a&8&&(d.sourceLayer=u[3]),a&16&&(d.beforeId=u[4]),a&32&&(d.beforeLayerType=u[5]),a&64&&(d.paint=u[6]),a&128&&(d.layout=u[7]),a&256&&(d.filter=u[8]),a&512&&(d.minzoom=u[9]),a&1024&&(d.maxzoom=u[10]),a&2048&&(d.hoverCursor=u[11]),a&4096&&(d.manageHoverState=u[12]),a&8192&&(d.eventsIfTopMost=u[13]),a&16384&&(d.interactive=u[14]),a&8388608&&(d.$$scope={dirty:a,ctx:u}),!t&&a&1&&(t=!0,d.hovered=u[0],An(()=>t=!1)),e.$set(d)},i(u){n||(N(e.$$.fragment,u),n=!0)},o(u){V(e.$$.fragment,u),n=!1},d(u){ue(e,u)}}}function T4(r,e,t){let{$$slots:n={},$$scope:i}=e,{id:o=wl("line")}=e,{source:u=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:d=void 0}=e,{beforeLayerType:p=void 0}=e,{paint:g}=e,{layout:y=void 0}=e,{filter:x=void 0}=e,{minzoom:C=void 0}=e,{maxzoom:M=void 0}=e,{hoverCursor:F=void 0}=e,{manageHoverState:z=!1}=e,{hovered:E=null}=e,{eventsIfTopMost:P=!1}=e,{interactive:$=!0}=e;function U(ne){E=ne,t(0,E)}function K(ne){In.call(this,r,ne)}function ee(ne){In.call(this,r,ne)}function W(ne){In.call(this,r,ne)}function J(ne){In.call(this,r,ne)}function he(ne){In.call(this,r,ne)}function Ae(ne){In.call(this,r,ne)}return r.$$set=ne=>{"id"in ne&&t(1,o=ne.id),"source"in ne&&t(2,u=ne.source),"sourceLayer"in ne&&t(3,a=ne.sourceLayer),"beforeId"in ne&&t(4,d=ne.beforeId),"beforeLayerType"in ne&&t(5,p=ne.beforeLayerType),"paint"in ne&&t(6,g=ne.paint),"layout"in ne&&t(7,y=ne.layout),"filter"in ne&&t(8,x=ne.filter),"minzoom"in ne&&t(9,C=ne.minzoom),"maxzoom"in ne&&t(10,M=ne.maxzoom),"hoverCursor"in ne&&t(11,F=ne.hoverCursor),"manageHoverState"in ne&&t(12,z=ne.manageHoverState),"hovered"in ne&&t(0,E=ne.hovered),"eventsIfTopMost"in ne&&t(13,P=ne.eventsIfTopMost),"interactive"in ne&&t(14,$=ne.interactive),"$$scope"in ne&&t(23,i=ne.$$scope)},[E,o,u,a,d,p,g,y,x,C,M,F,z,P,$,n,U,K,ee,W,J,he,Ae,i]}let sr=class extends St{constructor(e){super(),kt(this,e,T4,S4,_t,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}};function C4(r,e,t){let n;const i=Is();let{layer:o=void 0}=e;const{map:u}=Da();st(r,u,g=>t(2,n=g));function a(g){i(g.type,{...g,map:u})}const d=["click","dblclick","mousedown","mouseup","mousemove","mouseenter","mouseleave","contextmenu","mouseover","mouseout"],p=["click","dblclick","contextmenu","mousemove","movestart","moveend","zoomstart","zoom","zoomend"];return ti(()=>{if(n)if(o)for(const g of d)n.off(g,o,a);else for(const g of p)n.off(g,a)}),r.$$set=g=>{"layer"in g&&t(1,o=g.layer)},r.$$.update=()=>{if(r.$$.dirty&6&&n)if(o)for(const g of d)n.on(g,o,a);else for(const g of p)n.on(g,a)},[u,o,n]}class eg extends St{constructor(e){super(),kt(this,e,C4,null,_t,{layer:1})}}function M4(r){let e=r.getCenter(),t=Math.round(r.getZoom()*100)/100,n=Math.ceil((t*Math.LN2+Math.log(512/360/.5))/Math.LN10),i=Math.pow(10,n),o=Math.round(e.lat*i)/i,u=Math.round(e.lng*i)/i,a=`${t}/${o}/${u}`,d=r.getBearing(),p=r.getPitch();return(d||p)&&(a+=`/${Math.round(d*10)/10}`),p&&(a+=`/${Math.round(p)}`),`#${a}`}function L4(r){return r.replace("#","").split("/").map(parseFloat)}var Su=tg;function tg(r,e){return r===e||r!==r&&e!==e?!0:typeof r!=typeof e||{}.toString.call(r)!={}.toString.call(e)||r!==Object(r)||!r?!1:Array.isArray(r)?c0(r,e):{}.toString.call(r)=="[object Set]"?c0(Array.from(r),Array.from(e)):{}.toString.call(r)=="[object Object]"?I4(r,e):E4(r,e)}function E4(r,e){return r.toString()===e.toString()}function c0(r,e){var t=r.length;if(t!=e.length)return!1;for(var n=0;n<t;n++)if(!tg(r[n],e[n]))return!1;return!0}function I4(r,e){var t=Object.keys(r),n=t.length;if(n!=Object.keys(e).length)return!1;for(var i=0;i<n;i++){var o=t[i];if(!(e.hasOwnProperty(o)&&tg(r[o],e[o])))return!1}return!0}function A4(r,e,t){let n;const{map:i}=Da();st(r,i,g=>t(6,n=g));let{position:o="top-left"}=e,{showCompass:u=!0}=e,{showZoom:a=!0}=e,{visualizePitch:d=!1}=e,p=null;return ti(()=>{n!=null&&n.loaded()&&p&&n.removeControl(p)}),r.$$set=g=>{"position"in g&&t(1,o=g.position),"showCompass"in g&&t(2,u=g.showCompass),"showZoom"in g&&t(3,a=g.showZoom),"visualizePitch"in g&&t(4,d=g.visualizePitch)},r.$$.update=()=>{r.$$.dirty&126&&n&&!p&&(t(5,p=new ei.NavigationControl({showCompass:u,showZoom:a,visualizePitch:d})),n.addControl(p,o))},[i,o,u,a,d,p,n]}class lv extends St{constructor(e){super(),kt(this,e,A4,null,_t,{position:1,showCompass:2,showZoom:3,visualizePitch:4})}}function P4(r,e,t){let n;const{map:i}=Da();st(r,i,p=>t(5,n=p));let{position:o="bottom-left"}=e,{maxWidth:u=void 0}=e,{unit:a="metric"}=e,d=null;return ti(()=>{n!=null&&n.loaded()&&d&&n.removeControl(d)}),r.$$set=p=>{"position"in p&&t(1,o=p.position),"maxWidth"in p&&t(2,u=p.maxWidth),"unit"in p&&t(3,a=p.unit)},r.$$.update=()=>{r.$$.dirty&62&&n&&!d&&(t(4,d=new ei.ScaleControl({maxWidth:u,unit:a})),n.addControl(d,o))},[i,o,u,a,d,n]}class uv extends St{constructor(e){super(),kt(this,e,P4,null,_t,{position:1,maxWidth:2,unit:3})}}const{window:z4}=Lb,D4=r=>({map:r[0]&16,loadedImages:r[0]&32,allImagesLoaded:r[0]&64}),h0=r=>({map:r[4],loadedImages:r[5],allImagesLoaded:r[6]});function f0(r){let e,t,n=r[3]&&d0(r);const i=r[46].default,o=mn(i,r,r[45],h0);return{c(){n&&n.c(),e=ie(),o&&o.c()},m(u,a){n&&n.m(u,a),Z(u,e,a),o&&o.m(u,a),t=!0},p(u,a){u[3]?n?(n.p(u,a),a[0]&8&&N(n,1)):(n=d0(u),n.c(),N(n,1),n.m(e.parentNode,e)):n&&(Kt(),V(n,1,1,()=>{n=null}),Xt()),o&&o.p&&(!t||a[0]&112|a[1]&16384)&&_n(o,i,u,u[45],t?gn(i,u[45],a,D4):yn(u[45]),h0)},i(u){t||(N(n),N(o,u),t=!0)},o(u){V(n),V(o,u),t=!1},d(u){u&&q(e),n&&n.d(u),o&&o.d(u)}}}function d0(r){let e,t,n,i,o,u,a,d;return e=new lv({props:{position:r[7]}}),n=new v4({props:{position:r[7],fitBoundsOptions:{maxZoom:12}}}),o=new g4({props:{position:r[7]}}),a=new uv({props:{position:r[7]}}),{c(){ce(e.$$.fragment),t=ie(),ce(n.$$.fragment),i=ie(),ce(o.$$.fragment),u=ie(),ce(a.$$.fragment)},m(p,g){le(e,p,g),Z(p,t,g),le(n,p,g),Z(p,i,g),le(o,p,g),Z(p,u,g),le(a,p,g),d=!0},p(p,g){const y={};g[0]&128&&(y.position=p[7]),e.$set(y);const x={};g[0]&128&&(x.position=p[7]),n.$set(x);const C={};g[0]&128&&(C.position=p[7]),o.$set(C);const M={};g[0]&128&&(M.position=p[7]),a.$set(M)},i(p){d||(N(e.$$.fragment,p),N(n.$$.fragment,p),N(o.$$.fragment,p),N(a.$$.fragment,p),d=!0)},o(p){V(e.$$.fragment,p),V(n.$$.fragment,p),V(o.$$.fragment,p),V(a.$$.fragment,p),d=!1},d(p){p&&(q(t),q(i),q(u)),ue(e,p),ue(n,p),ue(o,p),ue(a,p)}}}function R4(r){let e,t,n,i,o,u=r[4]&&r[0]&&f0(r);return{c(){e=j("div"),u&&u.c(),ae(e,"class",t=Bu(r[2])+" svelte-p00lfq"),ae(e,"data-testid","map-container"),jt(e,"expand-map",!r[2])},m(a,d){Z(a,e,d),u&&u.m(e,null),r[47](e),n=!0,i||(o=[Tt(z4,"hashchange",r[11]),nm(r[10].call(null,e))],i=!0)},p(a,d){a[4]&&a[0]?u?(u.p(a,d),d[0]&17&&N(u,1)):(u=f0(a),u.c(),N(u,1),u.m(e,null)):u&&(Kt(),V(u,1,1,()=>{u=null}),Xt()),(!n||d[0]&4&&t!==(t=Bu(a[2])+" svelte-p00lfq"))&&ae(e,"class",t),(!n||d[0]&4)&&jt(e,"expand-map",!a[2])},i(a){n||(N(u),n=!0)},o(a){V(u),n=!1},d(a){a&&q(e),u&&u.d(),r[47](null),i=!1,ur(o)}}}function F4(r,e,t){let n,i,o,u,{$$slots:a={},$$scope:d}=e,{map:p=null}=e,{mapContainer:g=void 0}=e,{class:y=void 0}=e,{style:x}=e,{diffStyleUpdates:C=!1}=e,{center:M=void 0}=e,{zoom:F=void 0}=e,{pitch:z=0}=e,{bearing:E=0}=e,{bounds:P=void 0}=e,{hash:$=!1}=e,{updateHash:U=Ue=>{window.history.replaceState(window.history.state,"",Ue)}}=e,{loaded:K=!1}=e,{minZoom:ee=0}=e,{maxZoom:W=22}=e,{minPitch:J=0}=e,{maxPitch:he=60}=e,{renderWorldCopies:Ae=void 0}=e,{dragPan:ne=void 0}=e,{dragRotate:fe=void 0}=e,{pitchWithRotate:Ce=void 0}=e,{antialias:_e=void 0}=e,{zoomOnDoubleClick:Ze=!0}=e,{locale:Oe=void 0}=e,{interactive:je=!0}=e,{attributionControl:De=!0}=e,{cooperativeGestures:At=!1}=e,{preserveDrawingBuffer:ut=!1}=e,{maxBounds:ht=void 0}=e,{images:wt=[]}=e,{standardControls:pt=!1}=e,{filterLayers:Qe=void 0}=e,{transformRequest:Ft=void 0}=e;const bt=Is(),{map:Bt,loadedImages:Pt}=W3();st(r,Bt,Ue=>t(4,o=Ue)),st(r,Pt,Ue=>t(5,u=Ue));let Qt=new Set;async function vn(Ue,it=!1){if(o&&!(!o.loaded()&&!it))if("url"in Ue){Qt.add(Ue.id);try{let Wt=await o.loadImage(Ue.url);o==null||o.addImage(Ue.id,Wt.data,Ue.options),u.add(Ue.id),Pt.set(u)}catch(Wt){bt("error",Wt)}finally{Qt.delete(Ue.id)}}else o.addImage(Ue.id,Ue.data,Ue.options),u.add(Ue.id),Pt.set(u)}let qt,rn,Ge,qe;function Je(Ue){return ye(),an(Bt,o=new ei.Map(La({container:Ue,style:x,locale:Oe,center:M,zoom:F,pitch:z,bearing:E,minZoom:ee,maxZoom:W,minPitch:J,maxPitch:he,renderWorldCopies:Ae,dragPan:ne,dragRotate:fe,pitchWithRotate:Ce,antialias:_e,interactive:je,preserveDrawingBuffer:ut,maxBounds:ht,bounds:P,attributionControl:De,transformRequest:Ft,cooperativeGestures:At})),o),o.on("load",it=>{it.target.getContainer().setAttribute("data-testid","map"),it.target.getCanvas().setAttribute("data-testid","map-canvas"),t(0,K=!0),bt("load",o)}),o.on("error",it=>bt("error",{...it,map:o})),o.on("movestart",it=>bt("movestart",{...it,map:o})),o.on("moveend",it=>{if(t(12,M=it.target.getCenter()),t(13,F=it.target.getZoom()),t(14,z=it.target.getPitch()),t(15,E=it.target.getBearing()),t(16,P=it.target.getBounds()),bt("moveend",{...it,map:o}),$){let Wt=new URL(window.location.href.replace(/(#.+)?$/,M4(o)));U(Wt)}}),o.on("click",it=>bt("click",{...it,map:o})),o.on("dblclick",it=>bt("dblclick",{...it,map:o})),o.on("contextmenu",it=>bt("contextmenu",{...it,map:o})),o.on("zoomstart",it=>bt("zoomstart",{...it,map:o})),o.on("zoom",it=>{bt("zoom",{...it,map:o})}),o.on("zoomend",it=>{bt("zoomend",{...it,map:o})}),o.on("style.load",()=>{if(o){const it=o.getStyle();if(t(42,qt=it.layers.map(Wt=>Wt.id)),t(43,rn=Object.keys(it.sources)),qe)for(const[Wt,cr]of Object.entries(qe))o.addSource(Wt,cr);if(Ge)for(const Wt of Ge)o.addLayer(Wt);for(const Wt of wt)vn(Wt,!0)}}),o.on("styledata",it=>{if(o&&Qe){const Wt=o.getStyle().layers;if(Wt)for(let cr of Wt)Qe(cr)||o.setLayoutProperty(cr.id,"visibility","none")}bt("styledata",{...it,map:o})}),{destroy(){t(0,K=!1),o==null||o.remove(),an(Bt,o=null,o)}}}let Et=x;function ye(){if($){let Ue=L4(window.location.hash);Ue.length>=3&&(t(13,F=Ue[0]),t(12,M=[Ue[2],Ue[1]])),Ue.length==5&&(t(15,E=Ue[3]),t(14,z=Ue[4]))}}function kn(Ue){un[Ue?"unshift":"push"](()=>{g=Ue,t(1,g)})}return r.$$set=Ue=>{"map"in Ue&&t(17,p=Ue.map),"mapContainer"in Ue&&t(1,g=Ue.mapContainer),"class"in Ue&&t(2,y=Ue.class),"style"in Ue&&t(18,x=Ue.style),"diffStyleUpdates"in Ue&&t(19,C=Ue.diffStyleUpdates),"center"in Ue&&t(12,M=Ue.center),"zoom"in Ue&&t(13,F=Ue.zoom),"pitch"in Ue&&t(14,z=Ue.pitch),"bearing"in Ue&&t(15,E=Ue.bearing),"bounds"in Ue&&t(16,P=Ue.bounds),"hash"in Ue&&t(20,$=Ue.hash),"updateHash"in Ue&&t(21,U=Ue.updateHash),"loaded"in Ue&&t(0,K=Ue.loaded),"minZoom"in Ue&&t(22,ee=Ue.minZoom),"maxZoom"in Ue&&t(23,W=Ue.maxZoom),"minPitch"in Ue&&t(24,J=Ue.minPitch),"maxPitch"in Ue&&t(25,he=Ue.maxPitch),"renderWorldCopies"in Ue&&t(26,Ae=Ue.renderWorldCopies),"dragPan"in Ue&&t(27,ne=Ue.dragPan),"dragRotate"in Ue&&t(28,fe=Ue.dragRotate),"pitchWithRotate"in Ue&&t(29,Ce=Ue.pitchWithRotate),"antialias"in Ue&&t(30,_e=Ue.antialias),"zoomOnDoubleClick"in Ue&&t(31,Ze=Ue.zoomOnDoubleClick),"locale"in Ue&&t(32,Oe=Ue.locale),"interactive"in Ue&&t(33,je=Ue.interactive),"attributionControl"in Ue&&t(34,De=Ue.attributionControl),"cooperativeGestures"in Ue&&t(35,At=Ue.cooperativeGestures),"preserveDrawingBuffer"in Ue&&t(36,ut=Ue.preserveDrawingBuffer),"maxBounds"in Ue&&t(37,ht=Ue.maxBounds),"images"in Ue&&t(38,wt=Ue.images),"standardControls"in Ue&&t(3,pt=Ue.standardControls),"filterLayers"in Ue&&t(39,Qe=Ue.filterLayers),"transformRequest"in Ue&&t(40,Ft=Ue.transformRequest),"$$scope"in Ue&&t(45,d=Ue.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&8&&t(7,n=typeof pt=="boolean"?void 0:pt),r.$$.dirty[0]&16&&t(17,p=o),r.$$.dirty[0]&786448|r.$$.dirty[1]&14336&&o&&!Su(x,Et)){const Ue=o.getStyle();if(qt&&(Ge=Ue.layers.filter(it=>!qt.includes(it.id))),rn){const it=Object.keys(Ue.sources).filter(Wt=>!rn.includes(Wt));qe={};for(const Wt of it)qe[Wt]=Ue.sources[Wt]}t(44,Et=x),o.setStyle(x,{diff:C}),an(Pt,u=new Set,u),t(41,Qt=new Set)}if(r.$$.dirty[0]&49|r.$$.dirty[1]&1152&&K&&o!=null&&o.loaded())for(let Ue of wt)!u.has(Ue.id)&&!Qt.has(Ue.id)&&!o.hasImage(Ue.id)&&vn(Ue);if(r.$$.dirty[0]&32|r.$$.dirty[1]&128&&t(6,i=wt.every(Ue=>u.has(Ue.id))),r.$$.dirty[0]&61456&&o){let Ue={};M!=null&&!Su(M,o==null?void 0:o.getCenter())&&(Ue.center=M),F!=null&&!Su(F,o==null?void 0:o.getZoom())&&(Ue.zoom=F),E!=null&&!Su(E,o==null?void 0:o.getBearing())&&(Ue.bearing=E),z!=null&&!Su(z,o==null?void 0:o.getPitch())&&(Ue.pitch=z),Object.keys(Ue).length&&o.easeTo(Ue)}r.$$.dirty[0]&65552&&P&&!Su(P,o==null?void 0:o.getBounds())&&(o==null||o.fitBounds(P)),r.$$.dirty[0]&16|r.$$.dirty[1]&1&&(Ze?o==null||o.doubleClickZoom.enable():o==null||o.doubleClickZoom.disable())},[K,g,y,pt,o,u,i,n,Bt,Pt,Je,ye,M,F,z,E,P,p,x,C,$,U,ee,W,J,he,Ae,ne,fe,Ce,_e,Ze,Oe,je,De,At,ut,ht,wt,Qe,Ft,Qt,qt,rn,Et,d,a,kn]}class B4 extends St{constructor(e){super(),kt(this,e,F4,R4,_t,{map:17,mapContainer:1,class:2,style:18,diffStyleUpdates:19,center:12,zoom:13,pitch:14,bearing:15,bounds:16,hash:20,updateHash:21,loaded:0,minZoom:22,maxZoom:23,minPitch:24,maxPitch:25,renderWorldCopies:26,dragPan:27,dragRotate:28,pitchWithRotate:29,antialias:30,zoomOnDoubleClick:31,locale:32,interactive:33,attributionControl:34,cooperativeGestures:35,preserveDrawingBuffer:36,maxBounds:37,images:38,standardControls:3,filterLayers:39,transformRequest:40},null,[-1,-1])}}const $4=r=>({marker:r&8}),p0=r=>({marker:r[3]});function O4(r){let e,t,n,i,o,u,a;const d=r[19].default,p=mn(d,r,r[18],p0);return{c(){e=j("div"),p&&p.c(),ae(e,"tabindex",t=r[1]?0:void 0),ae(e,"role",n=r[1]?"button":void 0),Ye(e,"z-index",r[2])},m(g,y){Z(g,e,y),p&&p.m(e,null),o=!0,u||(a=[nm(r[7].call(null,e)),nm(i=N4.call(null,e,r[0])),Tt(e,"click",oh(r[20])),Tt(e,"dblclick",oh(r[21])),Tt(e,"contextmenu",oh(Om(r[22]))),Tt(e,"mouseenter",r[23]),Tt(e,"mouseleave",r[24]),Tt(e,"mousemove",r[25]),Tt(e,"keydown",r[8])],u=!0)},p(g,[y]){p&&p.p&&(!o||y&262152)&&_n(p,d,g,g[18],o?gn(d,g[18],y,$4):yn(g[18]),p0),(!o||y&2&&t!==(t=g[1]?0:void 0))&&ae(e,"tabindex",t),(!o||y&2&&n!==(n=g[1]?"button":void 0))&&ae(e,"role",n),i&&vl(i.update)&&y&1&&i.update.call(null,g[0]),y&4&&Ye(e,"z-index",g[2])},i(g){o||(N(p,g),o=!0)},o(g){V(p,g),o=!1},d(g){g&&q(e),p&&p.d(g),u=!1,ur(a)}}}function N4(r,e){const t=r.className;function n(i){i?r.className=`${t} ${i}`:r.className=t}return n(e),{update:n}}function j4(r,e,t){let n,i,o,{$$slots:u={},$$scope:a}=e,{marker:d=void 0}=e,{lngLat:p}=e,{class:g=void 0}=e,{interactive:y=!0}=e,{asButton:x=!1}=e,{draggable:C=!1}=e,{feature:M=null}=e,{offset:F=void 0}=e,{zIndex:z=void 0}=e,{rotation:E=0}=e,{opacity:P=1}=e;const $=Is(),{map:U,layerEvent:K,self:ee,markerClickManager:W}=K3();st(r,U,De=>t(27,o=De)),st(r,K,De=>t(26,n=De)),st(r,ee,De=>t(3,i=De));function J(De){an(ee,i=new ei.Marker({element:De,rotation:E,draggable:C,offset:F,opacity:P.toString()}).setLngLat(p).addTo(o),i),t(11,d=i);const At=()=>ne("dragstart"),ut=()=>{he(),ne("drag")},ht=()=>{he(),ne("dragend")};return C&&(i.on("dragstart",At),i.on("drag",ut),i.on("dragend",ht)),{destroy(){C&&(i==null||i.off("dragstart",At),i==null||i.off("drag",ut),i==null||i.off("dragend",ht)),t(11,d=void 0),i==null||i.remove()}}}function he(){let De=i==null?void 0:i.getLngLat();De&&(Array.isArray(p)?t(10,p=[De.lng,De.lat]):p&&"lon"in p?t(10,p={lon:De.lng,lat:De.lat}):t(10,p=De))}function Ae(De){De.key===" "&&(De.preventDefault(),De.stopPropagation(),ne("click"))}function ne(De){if(!y)return;let At=i==null?void 0:i.getLngLat();if(!At)return;const ut=[At.lng,At.lat];let ht={map:o,marker:i,lngLat:ut,features:[{type:"Feature",properties:(M==null?void 0:M.properties)??{},geometry:{type:"Point",coordinates:ut}}]};(De==="click"||De==="contextmenu")&&W.handleClick(ht),an(K,n={...ht,layerType:"marker",type:De},n),$(De,ht)}const fe=()=>ne("click"),Ce=()=>ne("dblclick"),_e=()=>{ne("contextmenu")},Ze=()=>{ne("mouseenter")},Oe=()=>{ne("mouseleave")},je=()=>ne("mousemove");return r.$$set=De=>{"marker"in De&&t(11,d=De.marker),"lngLat"in De&&t(10,p=De.lngLat),"class"in De&&t(0,g=De.class),"interactive"in De&&t(12,y=De.interactive),"asButton"in De&&t(1,x=De.asButton),"draggable"in De&&t(13,C=De.draggable),"feature"in De&&t(14,M=De.feature),"offset"in De&&t(15,F=De.offset),"zIndex"in De&&t(2,z=De.zIndex),"rotation"in De&&t(16,E=De.rotation),"opacity"in De&&t(17,P=De.opacity),"$$scope"in De&&t(18,a=De.$$scope)},r.$$.update=()=>{r.$$.dirty&1032&&(i==null||i.setLngLat(p)),r.$$.dirty&32776&&(i==null||i.setOffset(F??[0,0])),r.$$.dirty&65544&&(i==null||i.setRotation(E)),r.$$.dirty&131080&&(i==null||i.setOpacity(P.toString()))},[g,x,z,i,U,K,ee,J,Ae,ne,p,d,y,C,M,F,E,P,a,u,fe,Ce,_e,Ze,Oe,je]}class Td extends St{constructor(e){super(),kt(this,e,j4,O4,_t,{marker:11,lngLat:10,class:0,interactive:12,asButton:1,draggable:13,feature:14,offset:15,zIndex:2,rotation:16,opacity:17})}}const U4=r=>({features:r[0]&16,data:r[0]&16,map:r[0]&4,close:r[0]&1}),m0=r=>{var e;return{features:r[4],data:((e=r[4])==null?void 0:e[0])??null,map:r[2],close:r[31]}};function g0(r){var i;let e,t,n=(((i=r[4])==null?void 0:i.length)||r[3]instanceof ei.Marker)&&_0(r);return{c(){e=j("div"),n&&n.c()},m(o,u){Z(o,e,u),n&&n.m(e,null),r[32](e),t=!0},p(o,u){var a;(a=o[4])!=null&&a.length||o[3]instanceof ei.Marker?n?(n.p(o,u),u[0]&24&&N(n,1)):(n=_0(o),n.c(),N(n,1),n.m(e,null)):n&&(Kt(),V(n,1,1,()=>{n=null}),Xt())},i(o){t||(N(n),t=!0)},o(o){V(n),t=!1},d(o){o&&q(e),n&&n.d(),r[32](null)}}}function _0(r){let e;const t=r[30].default,n=mn(t,r,r[29],m0);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o[0]&536870933)&&_n(n,t,i,i[29],e?gn(t,i[29],o,U4):yn(i[29]),m0)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function V4(r){let e,t,n=r[9].default&&g0(r);return{c(){n&&n.c(),e=Xn()},m(i,o){n&&n.m(i,o),Z(i,e,o),t=!0},p(i,o){i[9].default?n?(n.p(i,o),o[0]&512&&N(n,1)):(n=g0(i),n.c(),N(n,1),n.m(e.parentNode,e)):n&&(Kt(),V(n,1,1,()=>{n=null}),Xt())},i(i){t||(N(n),t=!0)},o(i){V(n),t=!1},d(i){i&&q(e),n&&n.d(i)}}}function q4(r,e,t){let n,i,o,u,a,d,{$$slots:p={},$$scope:g}=e;const y=$m(p);let{closeButton:x=void 0}=e,{closeOnClickOutside:C=!0}=e,{closeOnClickInside:M=!1}=e,{closeOnMove:F=!1}=e,{openOn:z="click"}=e,{openIfTopMost:E=!0}=e,{focusAfterOpen:P=!0}=e,{anchor:$=void 0}=e,{offset:U=void 0}=e,{popupClass:K=void 0}=e,{maxWidth:ee=void 0}=e,{lngLat:W=void 0}=e,{html:J=void 0}=e,{open:he=!1}=e;const Ae=Is(),{map:ne,popupTarget:fe,layerEvent:Ce,layer:_e,eventTopMost:Ze,markerClickManager:Oe}=Da();st(r,ne,ye=>t(2,o=ye)),st(r,fe,ye=>t(3,a=ye)),st(r,Ce,ye=>t(28,u=ye)),st(r,_e,ye=>t(35,d=ye));const je=["click","dblclick","contextmenu"];let De,At=!1,ut;function ht(){if(!De)return;let ye=De.getElement();!ye||ye===ut||(ut=ye,z==="hover"&&(ut.style.pointerEvents="none"),ut.addEventListener("mouseenter",()=>{t(24,At=!0)},{passive:!0}),ut.addEventListener("mouseleave",()=>{t(24,At=!1)},{passive:!0}),ut.addEventListener("click",()=>{M&&t(0,he=!1)},{passive:!0}))}Es(()=>{if(o)return o.on("click",rn),o.on("contextmenu",rn),Oe.add(Ge),typeof a=="string"&&(o.on("click",a,bt),o.on("dblclick",a,bt),o.on("contextmenu",a,bt),o.on("mousemove",a,qt),o.on("mouseleave",a,vn),o.on("touchstart",a,Pt),o.on("touchend",a,Qt)),()=>{o!=null&&o.loaded()&&(De==null||De.remove(),o.off("click",rn),o.off("contextmenu",rn),Oe.remove(Ge),a instanceof ei.Marker?a.getPopup()===De&&a.setPopup(void 0):typeof a=="string"&&(o.off("click",a,bt),o.off("dblclick",a,bt),o.off("contextmenu",a,bt),o.off("mousemove",a,qt),o.off("mouseleave",a,vn),o.off("touchstart",a,Pt),o.off("touchend",a,Qt)))}});function wt(ye){return E?!("marker"in ye)&&!X3(ye)&&Ze(ye)!==d:!1}let pt=null,Qe="normal";function Ft(ye){"layerType"in ye&&ye.layerType==="deckgl"?(t(10,W=ye.coordinate),t(4,pt=ye.object?[ye.object]:null)):(t(10,W=ye.lngLat),t(4,pt=ye.features??[]))}function bt(ye){ye.type!==z||wt(ye)||(Ft(ye),setTimeout(()=>t(0,he=!0)))}let Bt=null;function Pt(ye){Bt=ye.point}function Qt(ye){if(!Bt||z!=="hover")return;let kn=Bt.dist(ye.point);Bt=null,kn<3&&(t(10,W=ye.lngLat),t(4,pt=ye.features??[]),De.isOpen()?t(25,Qe="justOpened"):(t(25,Qe="opening"),t(0,he=!0)))}function vn(ye){z!=="hover"||Bt||Qe!=="normal"||(t(0,he=!1),t(4,pt=null))}function qt(ye){if(!(z!=="hover"||Bt||Qe!=="normal")){if(wt(ye)){t(0,he=!1),t(4,pt=null);return}t(0,he=!0),t(4,pt=ye.features??[]),t(10,W=ye.lngLat)}}function rn(ye){if(Qe==="justOpened"){t(25,Qe="normal");return}if(!C)return;let kn=[ut,a instanceof ei.Marker?a==null?void 0:a.getElement():null];he&&De.isOpen()&&!kn.some(Ue=>Ue==null?void 0:Ue.contains(ye.originalEvent.target))&&(ye.type==="contextmenu"&&z==="contextmenu"||ye.type!=="contextmenu")&&t(0,he=!1)}function Ge(ye){C&&he&&De.isOpen()&&ye.marker!==a&&t(0,he=!1)}ti(()=>{o&&(De!=null&&De.isOpen())&&De.remove()});let qe;const Je=()=>t(0,he=!1);function Et(ye){un[ye?"unshift":"push"](()=>{qe=ye,t(1,qe)})}return r.$$set=ye=>{"closeButton"in ye&&t(11,x=ye.closeButton),"closeOnClickOutside"in ye&&t(12,C=ye.closeOnClickOutside),"closeOnClickInside"in ye&&t(13,M=ye.closeOnClickInside),"closeOnMove"in ye&&t(14,F=ye.closeOnMove),"openOn"in ye&&t(15,z=ye.openOn),"openIfTopMost"in ye&&t(16,E=ye.openIfTopMost),"focusAfterOpen"in ye&&t(17,P=ye.focusAfterOpen),"anchor"in ye&&t(18,$=ye.anchor),"offset"in ye&&t(19,U=ye.offset),"popupClass"in ye&&t(20,K=ye.popupClass),"maxWidth"in ye&&t(21,ee=ye.maxWidth),"lngLat"in ye&&t(10,W=ye.lngLat),"html"in ye&&t(22,J=ye.html),"open"in ye&&t(0,he=ye.open),"$$scope"in ye&&t(29,g=ye.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&14336&&t(27,n=x??(!C&&!M)),r.$$.dirty[0]&146685952&&(De||(t(23,De=new ei.Popup({closeButton:n,closeOnClick:!1,closeOnMove:F,focusAfterOpen:P,maxWidth:ee,className:K,anchor:$,offset:U})),ut=De.getElement(),De.on("open",()=>{t(0,he=!0),ht(),Ae("open",De)}),De.on("close",()=>{t(0,he=!1),Ae("close",De)}),De.on("hover",()=>{Ae("hover",De)}))),r.$$.dirty[0]&8421384&&De&&a instanceof ei.Marker&&(z==="click"?a.setPopup(De):a.getPopup()===De&&a.setPopup(void 0)),r.$$.dirty[0]&268468224&&je.includes(z)&&(u==null?void 0:u.type)===z&&(bt(u),an(Ce,u=null,u)),r.$$.dirty[0]&268468224&&t(26,i=z==="hover"&&((u==null?void 0:u.type)==="mousemove"||(u==null?void 0:u.type)==="mouseenter")),r.$$.dirty[0]&352354304&&z==="hover"&&Ce&&(i&&u&&Ft(u),t(0,he=(i||At)??!1)),r.$$.dirty[0]&12582914&&(qe?De.setDOMContent(qe):J&&De.setHTML(J)),r.$$.dirty[0]&8389632&&W&&De.setLngLat(W),r.$$.dirty[0]&41943045&&o){let ye=De.isOpen();he&&!ye?(De.addTo(o),Qe==="opening"&&t(25,Qe="justOpened")):!he&&ye&&De.remove()}},[he,qe,o,a,pt,ne,fe,Ce,_e,y,W,x,C,M,F,z,E,P,$,U,K,ee,J,De,At,Qe,i,n,u,g,p,Je,Et]}let cv=class extends St{constructor(e){super(),kt(this,e,q4,V4,_t,{closeButton:11,closeOnClickOutside:12,closeOnClickInside:13,closeOnMove:14,openOn:15,openIfTopMost:16,focusAfterOpen:17,anchor:18,offset:19,popupClass:20,maxWidth:21,lngLat:10,html:22,open:0},null,[-1,-1])}};var Du=Math.pow,Wi=(r,e,t)=>new Promise((n,i)=>{var o=d=>{try{a(t.next(d))}catch(p){i(p)}},u=d=>{try{a(t.throw(d))}catch(p){i(p)}},a=d=>d.done?n(d.value):Promise.resolve(d.value).then(o,u);a((t=t.apply(r,e)).next())}),Oo=Uint8Array,Pu=Uint16Array,Z4=Int32Array,hv=new Oo([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),fv=new Oo([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),G4=new Oo([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),dv=function(r,e){for(var t=new Pu(31),n=0;n<31;++n)t[n]=e+=1<<r[n-1];for(var i=new Z4(t[30]),n=1;n<30;++n)for(var o=t[n];o<t[n+1];++o)i[o]=o-t[n]<<5|n;return{b:t,r:i}},pv=dv(hv,2),mv=pv.b,H4=pv.r;mv[28]=258,H4[258]=28;var W4=dv(fv,0),K4=W4.b,mm=new Pu(32768);for(lr=0;lr<32768;++lr)Gs=(lr&43690)>>1|(lr&21845)<<1,Gs=(Gs&52428)>>2|(Gs&13107)<<2,Gs=(Gs&61680)>>4|(Gs&3855)<<4,mm[lr]=((Gs&65280)>>8|(Gs&255)<<8)>>1;var Gs,lr,hh=function(r,e,t){for(var n=r.length,i=0,o=new Pu(e);i<n;++i)r[i]&&++o[r[i]-1];var u=new Pu(e);for(i=1;i<e;++i)u[i]=u[i-1]+o[i-1]<<1;var a;if(t){a=new Pu(1<<e);var d=15-e;for(i=0;i<n;++i)if(r[i])for(var p=i<<4|r[i],g=e-r[i],y=u[r[i]-1]++<<g,x=y|(1<<g)-1;y<=x;++y)a[mm[y]>>d]=p}else for(a=new Pu(n),i=0;i<n;++i)r[i]&&(a[i]=mm[u[r[i]-1]++]>>15-r[i]);return a},Eh=new Oo(288);for(lr=0;lr<144;++lr)Eh[lr]=8;var lr;for(lr=144;lr<256;++lr)Eh[lr]=9;var lr;for(lr=256;lr<280;++lr)Eh[lr]=7;var lr;for(lr=280;lr<288;++lr)Eh[lr]=8;var lr,gv=new Oo(32);for(lr=0;lr<32;++lr)gv[lr]=5;var lr,X4=hh(Eh,9,1),J4=hh(gv,5,1),Hp=function(r){for(var e=r[0],t=1;t<r.length;++t)r[t]>e&&(e=r[t]);return e},hs=function(r,e,t){var n=e/8|0;return(r[n]|r[n+1]<<8)>>(e&7)&t},Wp=function(r,e){var t=e/8|0;return(r[t]|r[t+1]<<8|r[t+2]<<16)>>(e&7)},Y4=function(r){return(r+7)/8|0},Q4=function(r,e,t){(e==null||e<0)&&(e=0),(t==null||t>r.length)&&(t=r.length);var n=new Oo(t-e);return n.set(r.subarray(e,t)),n},eS=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Ro=function(r,e,t){var n=new Error(e||eS[r]);if(n.code=r,Error.captureStackTrace&&Error.captureStackTrace(n,Ro),!t)throw n;return n},ng=function(r,e,t,n){var i=r.length,o=n?n.length:0;if(!i||e.f&&!e.l)return t||new Oo(0);var u=!t||e.i!=2,a=e.i;t||(t=new Oo(i*3));var d=function(vn){var qt=t.length;if(vn>qt){var rn=new Oo(Math.max(qt*2,vn));rn.set(t),t=rn}},p=e.f||0,g=e.p||0,y=e.b||0,x=e.l,C=e.d,M=e.m,F=e.n,z=i*8;do{if(!x){p=hs(r,g,1);var E=hs(r,g+1,3);if(g+=3,E)if(E==1)x=X4,C=J4,M=9,F=5;else if(E==2){var K=hs(r,g,31)+257,ee=hs(r,g+10,15)+4,W=K+hs(r,g+5,31)+1;g+=14;for(var J=new Oo(W),he=new Oo(19),Ae=0;Ae<ee;++Ae)he[G4[Ae]]=hs(r,g+Ae*3,7);g+=ee*3;for(var ne=Hp(he),fe=(1<<ne)-1,Ce=hh(he,ne,1),Ae=0;Ae<W;){var _e=Ce[hs(r,g,fe)];g+=_e&15;var P=_e>>4;if(P<16)J[Ae++]=P;else{var Ze=0,Oe=0;for(P==16?(Oe=3+hs(r,g,3),g+=2,Ze=J[Ae-1]):P==17?(Oe=3+hs(r,g,7),g+=3):P==18&&(Oe=11+hs(r,g,127),g+=7);Oe--;)J[Ae++]=Ze}}var je=J.subarray(0,K),De=J.subarray(K);M=Hp(je),F=Hp(De),x=hh(je,M,1),C=hh(De,F,1)}else Ro(1);else{var P=Y4(g)+4,$=r[P-4]|r[P-3]<<8,U=P+$;if(U>i){a&&Ro(0);break}u&&d(y+$),t.set(r.subarray(P,U),y),e.b=y+=$,e.p=g=U*8,e.f=p;continue}if(g>z){a&&Ro(0);break}}u&&d(y+131072);for(var At=(1<<M)-1,ut=(1<<F)-1,ht=g;;ht=g){var Ze=x[Wp(r,g)&At],wt=Ze>>4;if(g+=Ze&15,g>z){a&&Ro(0);break}if(Ze||Ro(2),wt<256)t[y++]=wt;else if(wt==256){ht=g,x=null;break}else{var pt=wt-254;if(wt>264){var Ae=wt-257,Qe=hv[Ae];pt=hs(r,g,(1<<Qe)-1)+mv[Ae],g+=Qe}var Ft=C[Wp(r,g)&ut],bt=Ft>>4;Ft||Ro(3),g+=Ft&15;var De=K4[bt];if(bt>3){var Qe=fv[bt];De+=Wp(r,g)&(1<<Qe)-1,g+=Qe}if(g>z){a&&Ro(0);break}u&&d(y+131072);var Bt=y+pt;if(y<De){var Pt=o-De,Qt=Math.min(De,Bt);for(Pt+y<0&&Ro(3);y<Qt;++y)t[y]=n[Pt+y]}for(;y<Bt;y+=4)t[y]=t[y-De],t[y+1]=t[y+1-De],t[y+2]=t[y+2-De],t[y+3]=t[y+3-De];y=Bt}}e.l=x,e.p=ht,e.b=y,e.f=p,x&&(p=1,e.m=M,e.d=C,e.n=F)}while(!p);return y==t.length?t:Q4(t,0,y)},tS=new Oo(0),nS=function(r){(r[0]!=31||r[1]!=139||r[2]!=8)&&Ro(6,"invalid gzip data");var e=r[3],t=10;e&4&&(t+=(r[10]|r[11]<<8)+2);for(var n=(e>>3&1)+(e>>4&1);n>0;n-=!r[t++]);return t+(e&2)},rS=function(r){var e=r.length;return(r[e-4]|r[e-3]<<8|r[e-2]<<16|r[e-1]<<24)>>>0},iS=function(r,e){return((r[0]&15)!=8||r[0]>>4>7||(r[0]<<8|r[1])%31)&&Ro(6,"invalid zlib data"),(r[1]>>5&1)==+!e&&Ro(6,"invalid zlib data: "+(r[1]&32?"need":"unexpected")+" dictionary"),(r[1]>>3&4)+2};function oS(r,e){return ng(r,{i:2},e&&e.out,e&&e.dictionary)}function sS(r,e){var t=nS(r);return t+8>r.length&&Ro(6,"invalid gzip data"),ng(r.subarray(t,-8),{i:2},e&&e.out||new Oo(rS(r)),e&&e.dictionary)}function aS(r,e){return ng(r.subarray(iS(r,e&&e.dictionary),-4),{i:2},e&&e.out,e&&e.dictionary)}function gm(r,e){return r[0]==31&&r[1]==139&&r[2]==8?sS(r,e):(r[0]&15)!=8||r[0]>>4>7||(r[0]<<8|r[1])%31?oS(r,e):aS(r,e)}var lS=typeof TextDecoder<"u"&&new TextDecoder,uS=0;try{lS.decode(tS,{stream:!0}),uS=1}catch{}var _v=(r,e)=>r*Du(2,e),qc=(r,e)=>Math.floor(r/Du(2,e)),gd=(r,e)=>_v(r.getUint16(e+1,!0),8)+r.getUint8(e),yv=(r,e)=>_v(r.getUint32(e+2,!0),16)+r.getUint16(e,!0),cS=(r,e,t,n,i)=>{if(r!==n.getUint8(i))return r-n.getUint8(i);const o=gd(n,i+1);if(e!==o)return e-o;const u=gd(n,i+4);return t!==u?t-u:0},hS=(r,e,t,n)=>{const i=bv(r,e|128,t,n);return i?{z:e,x:t,y:n,offset:i[0],length:i[1],isDir:!0}:null},y0=(r,e,t,n)=>{const i=bv(r,e,t,n);return i?{z:e,x:t,y:n,offset:i[0],length:i[1],isDir:!1}:null},bv=(r,e,t,n)=>{let i=0,o=r.byteLength/17-1;for(;i<=o;){const u=o+i>>1,a=cS(e,t,n,r,u*17);if(a>0)i=u+1;else if(a<0)o=u-1;else return[yv(r,u*17+7),r.getUint32(u*17+13,!0)]}return null},fS=(r,e)=>r.isDir&&!e.isDir?1:!r.isDir&&e.isDir?-1:r.z!==e.z?r.z-e.z:r.x!==e.x?r.x-e.x:r.y-e.y,vv=(r,e)=>{const t=r.getUint8(e*17);return{z:t&127,x:gd(r,e*17+1),y:gd(r,e*17+4),offset:yv(r,e*17+7),length:r.getUint32(e*17+13,!0),isDir:t>>7===1}},b0=r=>{const e=[],t=new DataView(r);for(let n=0;n<t.byteLength/17;n++)e.push(vv(t,n));return dS(e)},dS=r=>{r.sort(fS);const e=new ArrayBuffer(17*r.length),t=new Uint8Array(e);for(let n=0;n<r.length;n++){const i=r[n];let o=i.z;i.isDir&&(o=o|128),t[n*17]=o,t[n*17+1]=i.x&255,t[n*17+2]=i.x>>8&255,t[n*17+3]=i.x>>16&255,t[n*17+4]=i.y&255,t[n*17+5]=i.y>>8&255,t[n*17+6]=i.y>>16&255,t[n*17+7]=i.offset&255,t[n*17+8]=qc(i.offset,8)&255,t[n*17+9]=qc(i.offset,16)&255,t[n*17+10]=qc(i.offset,24)&255,t[n*17+11]=qc(i.offset,32)&255,t[n*17+12]=qc(i.offset,48)&255,t[n*17+13]=i.length&255,t[n*17+14]=i.length>>8&255,t[n*17+15]=i.length>>16&255,t[n*17+16]=i.length>>24&255}return e},pS=(r,e)=>{if(r.byteLength<17)return null;const t=r.byteLength/17,n=vv(r,t-1);if(n.isDir){const i=n.z,o=e.z-i,u=Math.trunc(e.x/(1<<o)),a=Math.trunc(e.y/(1<<o));return{z:i,x:u,y:a}}return null};function mS(r){return Wi(this,null,function*(){const e=yield r.getBytes(0,512e3),t=new DataView(e.data),n=t.getUint32(4,!0),i=t.getUint16(8,!0),o=new TextDecoder("utf-8"),u=JSON.parse(o.decode(new DataView(e.data,10,n)));let a=0;u.compression==="gzip"&&(a=2);let d=0;"minzoom"in u&&(d=+u.minzoom);let p=0;"maxzoom"in u&&(p=+u.maxzoom);let g=0,y=0,x=0,C=-180,M=-85,F=180,z=85;if(u.bounds){const P=u.bounds.split(",");C=+P[0],M=+P[1],F=+P[2],z=+P[3]}if(u.center){const P=u.center.split(",");g=+P[0],y=+P[1],x=+P[2]}return{specVersion:t.getUint16(2,!0),rootDirectoryOffset:10+n,rootDirectoryLength:i*17,jsonMetadataOffset:10,jsonMetadataLength:n,leafDirectoryOffset:0,leafDirectoryLength:void 0,tileDataOffset:0,tileDataLength:void 0,numAddressedTiles:0,numTileEntries:0,numTileContents:0,clustered:!1,internalCompression:1,tileCompression:a,tileType:1,minZoom:d,maxZoom:p,minLon:C,minLat:M,maxLon:F,maxLat:z,centerZoom:x,centerLon:g,centerLat:y,etag:e.etag}})}function gS(r,e,t,n,i,o,u){return Wi(this,null,function*(){let a=yield t.getArrayBuffer(e,r.rootDirectoryOffset,r.rootDirectoryLength,r);r.specVersion===1&&(a=b0(a));const d=y0(new DataView(a),n,i,o);if(d){let y=(yield e.getBytes(d.offset,d.length,u)).data;const x=new DataView(y);return x.getUint8(0)===31&&x.getUint8(1)===139&&(y=gm(new Uint8Array(y))),{data:y}}const p=pS(new DataView(a),{z:n,x:i,y:o});if(p){const g=hS(new DataView(a),p.z,p.x,p.y);if(g){let y=yield t.getArrayBuffer(e,g.offset,g.length,r);r.specVersion===1&&(y=b0(y));const x=y0(new DataView(y),n,i,o);if(x){let M=(yield e.getBytes(x.offset,x.length,u)).data;const F=new DataView(M);return F.getUint8(0)===31&&F.getUint8(1)===139&&(M=gm(new Uint8Array(M))),{data:M}}}}})}var wv={getHeader:mS,getZxy:gS},_S=r=>(e,t)=>{if(t instanceof AbortController)return r(e,t);const n=new AbortController;return r(e,n).then(i=>t(void 0,i.data,i.cacheControl||"",i.expires||""),i=>t(i)).catch(i=>t(i)),{cancel:()=>n.abort()}},yS=class{constructor(){this.tilev4=(r,e)=>Wi(this,null,function*(){if(r.type==="json"){const y=r.url.substr(10);let x=this.tiles.get(y);x||(x=new v0(y),this.tiles.set(y,x));const C=yield x.getHeader();return{data:{tiles:[`${r.url}/{z}/{x}/{y}`],minzoom:C.minZoom,maxzoom:C.maxZoom,bounds:[C.minLon,C.minLat,C.maxLon,C.maxLat]}}}const t=new RegExp(/pmtiles:\/\/(.+)\/(\d+)\/(\d+)\/(\d+)/),n=r.url.match(t);if(!n)throw new Error("Invalid PMTiles protocol URL");const i=n[1];let o=this.tiles.get(i);o||(o=new v0(i),this.tiles.set(i,o));const u=n[2],a=n[3],d=n[4],p=yield o.getHeader(),g=yield o==null?void 0:o.getZxy(+u,+a,+d,e.signal);return g?{data:new Uint8Array(g.data),cacheControl:g.cacheControl,expires:g.expires}:p.tileType===1?{data:new Uint8Array}:{data:null}}),this.tile=_S(this.tilev4),this.tiles=new Map}add(r){this.tiles.set(r.source.getKey(),r)}get(r){return this.tiles.get(r)}};function Tu(r,e){return(e>>>0)*4294967296+(r>>>0)}function bS(r,e){const t=e.buf;let n=t[e.pos++],i=(n&112)>>4;if(n<128||(n=t[e.pos++],i|=(n&127)<<3,n<128)||(n=t[e.pos++],i|=(n&127)<<10,n<128)||(n=t[e.pos++],i|=(n&127)<<17,n<128)||(n=t[e.pos++],i|=(n&127)<<24,n<128)||(n=t[e.pos++],i|=(n&1)<<31,n<128))return Tu(r,i);throw new Error("Expected varint not more than 10 bytes")}function Zc(r){const e=r.buf;let t=e[r.pos++],n=t&127;return t<128||(t=e[r.pos++],n|=(t&127)<<7,t<128)||(t=e[r.pos++],n|=(t&127)<<14,t<128)||(t=e[r.pos++],n|=(t&127)<<21,t<128)?n:(t=e[r.pos],n|=(t&15)<<28,bS(n,r))}function vS(r,e,t,n){if(n===0){t===1&&(e[0]=r-1-e[0],e[1]=r-1-e[1]);const i=e[0];e[0]=e[1],e[1]=i}}var wS=[0,1,5,21,85,341,1365,5461,21845,87381,349525,1398101,5592405,22369621,89478485,357913941,1431655765,5726623061,22906492245,91625968981,366503875925,1466015503701,5864062014805,23456248059221,93824992236885,375299968947541,0x5555555555555];function xS(r,e,t){if(r>26)throw Error("Tile zoom level exceeds max safe number limit (26)");if(e>Du(2,r)-1||t>Du(2,r)-1)throw Error("tile x/y outside zoom level bounds");const n=wS[r],i=Du(2,r);let o=0,u=0,a=0;const d=[e,t];let p=i/2;for(;p>0;)o=(d[0]&p)>0?1:0,u=(d[1]&p)>0?1:0,a+=p*p*(3*o^u),vS(p,d,o,u),p=p/2;return n+a}function xv(r,e){return Wi(this,null,function*(){if(e===1||e===0)return r;if(e===2){if(typeof globalThis.DecompressionStream>"u")return gm(new Uint8Array(r));const t=new Response(r).body;if(!t)throw Error("Failed to read response stream");const n=t.pipeThrough(new globalThis.DecompressionStream("gzip"));return new Response(n).arrayBuffer()}throw Error("Compression method not supported")})}var kS=127;function SS(r,e){let t=0,n=r.length-1;for(;t<=n;){const i=n+t>>1,o=e-r[i].tileId;if(o>0)t=i+1;else if(o<0)n=i-1;else return r[i]}return n>=0&&(r[n].runLength===0||e-r[n].tileId<r[n].runLength)?r[n]:null}var TS=class{constructor(r,e=new Headers){this.url=r,this.customHeaders=e,this.mustReload=!1}getKey(){return this.url}setHeaders(r){this.customHeaders=r}getBytes(r,e,t,n){return Wi(this,null,function*(){let i,o;t?o=t:(i=new AbortController,o=i.signal);const u=new Headers(this.customHeaders);u.set("range",`bytes=${r}-${r+e-1}`);let a;this.mustReload&&(a="reload");let d=yield fetch(this.url,{signal:o,cache:a,headers:u});if(r===0&&d.status===416){const x=d.headers.get("Content-Range");if(!x||!x.startsWith("bytes */"))throw Error("Missing content-length on 416 response");const C=+x.substr(8);d=yield fetch(this.url,{signal:o,cache:"reload",headers:{range:`bytes=0-${C-1}`}})}let p=d.headers.get("Etag");if(p!=null&&p.startsWith("W/")&&(p=null),d.status===416||n&&p&&p!==n)throw this.mustReload=!0,new _m(n);if(d.status>=300)throw Error(`Bad response code: ${d.status}`);const g=d.headers.get("Content-Length");if(d.status===200&&(!g||+g>e))throw i&&i.abort(),Error("Server returned no content-length header or content-length exceeding request. Check that your storage backend supports HTTP Byte Serving.");return{data:yield d.arrayBuffer(),etag:p||void 0,cacheControl:d.headers.get("Cache-Control")||void 0,expires:d.headers.get("Expires")||void 0}})}};function fs(r,e){const t=r.getUint32(e+4,!0),n=r.getUint32(e+0,!0);return t*Du(2,32)+n}function CS(r,e){const t=new DataView(r),n=t.getUint8(7);if(n>3)throw Error(`Archive is spec version ${n} but this library supports up to spec version 3`);return{specVersion:n,rootDirectoryOffset:fs(t,8),rootDirectoryLength:fs(t,16),jsonMetadataOffset:fs(t,24),jsonMetadataLength:fs(t,32),leafDirectoryOffset:fs(t,40),leafDirectoryLength:fs(t,48),tileDataOffset:fs(t,56),tileDataLength:fs(t,64),numAddressedTiles:fs(t,72),numTileEntries:fs(t,80),numTileContents:fs(t,88),clustered:t.getUint8(96)===1,internalCompression:t.getUint8(97),tileCompression:t.getUint8(98),tileType:t.getUint8(99),minZoom:t.getUint8(100),maxZoom:t.getUint8(101),minLon:t.getInt32(102,!0)/1e7,minLat:t.getInt32(106,!0)/1e7,maxLon:t.getInt32(110,!0)/1e7,maxLat:t.getInt32(114,!0)/1e7,centerZoom:t.getUint8(118),centerLon:t.getInt32(119,!0)/1e7,centerLat:t.getInt32(123,!0)/1e7,etag:e}}function kv(r){const e={buf:new Uint8Array(r),pos:0},t=Zc(e),n=[];let i=0;for(let o=0;o<t;o++){const u=Zc(e);n.push({tileId:i+u,offset:0,length:0,runLength:1}),i+=u}for(let o=0;o<t;o++)n[o].runLength=Zc(e);for(let o=0;o<t;o++)n[o].length=Zc(e);for(let o=0;o<t;o++){const u=Zc(e);u===0&&o>0?n[o].offset=n[o-1].offset+n[o-1].length:n[o].offset=u-1}return n}function MS(r){const e=new DataView(r);return e.getUint16(2,!0)===2?(console.warn("PMTiles spec version 2 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),2):e.getUint16(2,!0)===1?(console.warn("PMTiles spec version 1 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),1):3}var _m=class extends Error{};function LS(r,e){return Wi(this,null,function*(){const t=yield r.getBytes(0,16384);if(new DataView(t.data).getUint16(0,!0)!==19792)throw new Error("Wrong magic number for PMTiles archive");if(MS(t.data)<3)return[yield wv.getHeader(r)];const i=t.data.slice(0,kS),o=CS(i,t.etag),u=t.data.slice(o.rootDirectoryOffset,o.rootDirectoryOffset+o.rootDirectoryLength),a=`${r.getKey()}|${o.etag||""}|${o.rootDirectoryOffset}|${o.rootDirectoryLength}`,d=kv(yield e(u,o.internalCompression));return[o,[a,d.length,d]]})}function ES(r,e,t,n,i){return Wi(this,null,function*(){const o=yield r.getBytes(t,n,void 0,i.etag),u=yield e(o.data,i.internalCompression),a=kv(u);if(a.length===0)throw new Error("Empty directory is invalid");return a})}var IS=class{constructor(r=100,e=!0,t=xv){this.cache=new Map,this.invalidations=new Map,this.maxCacheEntries=r,this.counter=1,this.decompress=t}getHeader(r){return Wi(this,null,function*(){const e=r.getKey(),t=this.cache.get(e);if(t)return t.lastUsed=this.counter++,yield t.data;const n=new Promise((i,o)=>{LS(r,this.decompress).then(u=>{u[1]&&this.cache.set(u[1][0],{lastUsed:this.counter++,data:Promise.resolve(u[1][2])}),i(u[0]),this.prune()}).catch(u=>{o(u)})});return this.cache.set(e,{lastUsed:this.counter++,data:n}),n})}getDirectory(r,e,t,n){return Wi(this,null,function*(){const i=`${r.getKey()}|${n.etag||""}|${e}|${t}`,o=this.cache.get(i);if(o)return o.lastUsed=this.counter++,yield o.data;const u=new Promise((a,d)=>{ES(r,this.decompress,e,t,n).then(p=>{a(p),this.prune()}).catch(p=>{d(p)})});return this.cache.set(i,{lastUsed:this.counter++,data:u}),u})}getArrayBuffer(r,e,t,n){return Wi(this,null,function*(){const i=`${r.getKey()}|${n.etag||""}|${e}|${t}`,o=this.cache.get(i);if(o)return o.lastUsed=this.counter++,yield o.data;const u=new Promise((a,d)=>{r.getBytes(e,t,void 0,n.etag).then(p=>{a(p.data),this.cache.has(i),this.prune()}).catch(p=>{d(p)})});return this.cache.set(i,{lastUsed:this.counter++,data:u}),u})}prune(){if(this.cache.size>=this.maxCacheEntries){let r=1/0,e;this.cache.forEach((t,n)=>{t.lastUsed<r&&(r=t.lastUsed,e=n)}),e&&this.cache.delete(e)}}invalidate(r){return Wi(this,null,function*(){const e=r.getKey();if(this.invalidations.get(e))return yield this.invalidations.get(e);this.cache.delete(r.getKey());const t=new Promise((n,i)=>{this.getHeader(r).then(o=>{n(),this.invalidations.delete(e)}).catch(o=>{i(o)})});this.invalidations.set(e,t)})}},v0=class{constructor(r,e,t){typeof r=="string"?this.source=new TS(r):this.source=r,t?this.decompress=t:this.decompress=xv,e?this.cache=e:this.cache=new IS}getHeader(){return Wi(this,null,function*(){return yield this.cache.getHeader(this.source)})}getZxyAttempt(r,e,t,n){return Wi(this,null,function*(){const i=xS(r,e,t),o=yield this.cache.getHeader(this.source);if(o.specVersion<3)return wv.getZxy(o,this.source,this.cache,r,e,t,n);if(r<o.minZoom||r>o.maxZoom)return;let u=o.rootDirectoryOffset,a=o.rootDirectoryLength;for(let d=0;d<=3;d++){const p=yield this.cache.getDirectory(this.source,u,a,o),g=SS(p,i);if(g){if(g.runLength>0){const y=yield this.source.getBytes(o.tileDataOffset+g.offset,g.length,n,o.etag);return{data:yield this.decompress(y.data,o.tileCompression),cacheControl:y.cacheControl,expires:y.expires}}u=o.leafDirectoryOffset+g.offset,a=g.length}else return}throw Error("Maximum directory depth exceeded")})}getZxy(r,e,t,n){return Wi(this,null,function*(){try{return yield this.getZxyAttempt(r,e,t,n)}catch(i){if(i instanceof _m)return this.cache.invalidate(this.source),yield this.getZxyAttempt(r,e,t,n);throw i}})}getMetadataAttempt(){return Wi(this,null,function*(){const r=yield this.cache.getHeader(this.source),e=yield this.source.getBytes(r.jsonMetadataOffset,r.jsonMetadataLength,void 0,r.etag),t=yield this.decompress(e.data,r.internalCompression),n=new TextDecoder("utf-8");return JSON.parse(n.decode(t))})}getMetadata(){return Wi(this,null,function*(){try{return yield this.getMetadataAttempt()}catch(r){if(r instanceof _m)return this.cache.invalidate(this.source),yield this.getMetadataAttempt();throw r}})}};function AS(r){let e;const t=r[16].default,n=mn(t,r,r[24],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&16777216)&&_n(n,t,i,i[24],e?gn(t,i[24],o,null):yn(i[24]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function PS(r){let e,t,n;function i(u){r[17](u)}let o={id:r[1],type:"symbol",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],applyToClusters:r[9],minzoom:r[10],maxzoom:r[11],hoverCursor:r[12],manageHoverState:r[13],eventsIfTopMost:r[14],interactive:r[15],$$slots:{default:[AS]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.hovered=r[0]),e=new Sd({props:o}),un.push(()=>Pn(e,"hovered",i)),e.$on("click",r[18]),e.$on("dblclick",r[19]),e.$on("contextmenu",r[20]),e.$on("mouseenter",r[21]),e.$on("mousemove",r[22]),e.$on("mouseleave",r[23]),{c(){ce(e.$$.fragment)},m(u,a){le(e,u,a),n=!0},p(u,[a]){const d={};a&2&&(d.id=u[1]),a&4&&(d.source=u[2]),a&8&&(d.sourceLayer=u[3]),a&16&&(d.beforeId=u[4]),a&32&&(d.beforeLayerType=u[5]),a&64&&(d.paint=u[6]),a&128&&(d.layout=u[7]),a&256&&(d.filter=u[8]),a&512&&(d.applyToClusters=u[9]),a&1024&&(d.minzoom=u[10]),a&2048&&(d.maxzoom=u[11]),a&4096&&(d.hoverCursor=u[12]),a&8192&&(d.manageHoverState=u[13]),a&16384&&(d.eventsIfTopMost=u[14]),a&32768&&(d.interactive=u[15]),a&16777216&&(d.$$scope={dirty:a,ctx:u}),!t&&a&1&&(t=!0,d.hovered=u[0],An(()=>t=!1)),e.$set(d)},i(u){n||(N(e.$$.fragment,u),n=!0)},o(u){V(e.$$.fragment,u),n=!1},d(u){ue(e,u)}}}function zS(r,e,t){let{$$slots:n={},$$scope:i}=e,{id:o=wl("symbol")}=e,{source:u=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:d=void 0}=e,{beforeLayerType:p=void 0}=e,{paint:g=void 0}=e,{layout:y=void 0}=e,{filter:x=void 0}=e,{applyToClusters:C=void 0}=e,{minzoom:M=void 0}=e,{maxzoom:F=void 0}=e,{hoverCursor:z=void 0}=e,{manageHoverState:E=!1}=e,{hovered:P=null}=e,{eventsIfTopMost:$=!1}=e,{interactive:U=!0}=e;function K(fe){P=fe,t(0,P)}function ee(fe){In.call(this,r,fe)}function W(fe){In.call(this,r,fe)}function J(fe){In.call(this,r,fe)}function he(fe){In.call(this,r,fe)}function Ae(fe){In.call(this,r,fe)}function ne(fe){In.call(this,r,fe)}return r.$$set=fe=>{"id"in fe&&t(1,o=fe.id),"source"in fe&&t(2,u=fe.source),"sourceLayer"in fe&&t(3,a=fe.sourceLayer),"beforeId"in fe&&t(4,d=fe.beforeId),"beforeLayerType"in fe&&t(5,p=fe.beforeLayerType),"paint"in fe&&t(6,g=fe.paint),"layout"in fe&&t(7,y=fe.layout),"filter"in fe&&t(8,x=fe.filter),"applyToClusters"in fe&&t(9,C=fe.applyToClusters),"minzoom"in fe&&t(10,M=fe.minzoom),"maxzoom"in fe&&t(11,F=fe.maxzoom),"hoverCursor"in fe&&t(12,z=fe.hoverCursor),"manageHoverState"in fe&&t(13,E=fe.manageHoverState),"hovered"in fe&&t(0,P=fe.hovered),"eventsIfTopMost"in fe&&t(14,$=fe.eventsIfTopMost),"interactive"in fe&&t(15,U=fe.interactive),"$$scope"in fe&&t(24,i=fe.$$scope)},[P,o,u,a,d,p,g,y,x,C,M,F,z,E,$,U,n,K,ee,W,J,he,Ae,ne,i]}class Ou extends St{constructor(e){super(),kt(this,e,zS,PS,_t,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}function w0(r){let e=r[0],t,n,i=x0(r);return{c(){i.c(),t=Xn()},m(o,u){i.m(o,u),Z(o,t,u),n=!0},p(o,u){u&1&&_t(e,e=o[0])?(Kt(),V(i,1,1,ot),Xt(),i=x0(o),i.c(),N(i,1),i.m(t.parentNode,t)):i.p(o,u)},i(o){n||(N(i),n=!0)},o(o){V(i),n=!1},d(o){o&&q(t),i.d(o)}}}function x0(r){let e;const t=r[15].default,n=mn(t,r,r[14],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&16384)&&_n(n,t,i,i[14],e?gn(t,i[14],o,null):yn(i[14]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function DS(r){let e,t,n=r[0]&&w0(r);return{c(){n&&n.c(),e=Xn()},m(i,o){n&&n.m(i,o),Z(i,e,o),t=!0},p(i,[o]){i[0]?n?(n.p(i,o),o&1&&N(n,1)):(n=w0(i),n.c(),N(n,1),n.m(e.parentNode,e)):n&&(Kt(),V(n,1,1,()=>{n=null}),Xt())},i(i){t||(N(n),t=!0)},o(i){V(n),t=!1},d(i){i&&q(e),n&&n.d(i)}}}function RS(r,e,t){let n,i,{$$slots:o={},$$scope:u}=e,{id:a=wl("vector")}=e,{url:d=null}=e,{tiles:p=null}=e,{promoteId:g=null}=e,{bounds:y=null}=e,{scheme:x=null}=e,{attribution:C=null}=e,{minzoom:M=null}=e,{maxzoom:F=null}=e,{volatile:z=null}=e;if(d&&d.includes("pmtiles://")&&!ei.config.REGISTERED_PROTOCOLS.hasOwnProperty("pmtiles")){let U=new yS;ei.addProtocol("pmtiles",U.tile)}const{map:E,self:P}=nv();st(r,E,U=>t(13,i=U)),st(r,P,U=>t(0,n=U));let $;return ti(()=>{n&&i&&(av(E,n,$),an(P,n=null,n),$=void 0)}),r.$$set=U=>{"id"in U&&t(3,a=U.id),"url"in U&&t(4,d=U.url),"tiles"in U&&t(5,p=U.tiles),"promoteId"in U&&t(6,g=U.promoteId),"bounds"in U&&t(7,y=U.bounds),"scheme"in U&&t(8,x=U.scheme),"attribution"in U&&t(9,C=U.attribution),"minzoom"in U&&t(10,M=U.minzoom),"maxzoom"in U&&t(11,F=U.maxzoom),"volatile"in U&&t(12,z=U.volatile),"$$scope"in U&&t(14,u=U.$$scope)},r.$$.update=()=>{r.$$.dirty&16377&&i&&n!==a&&(an(P,n=a,n),sv(i,n,La({type:"vector",url:d,tiles:p,promoteId:g,bounds:y,scheme:x,attribution:C,minzoom:M,maxzoom:F,volatile:z}),U=>i&&U===n,()=>{n&&($=i==null?void 0:i.getSource(n))})),r.$$.dirty&8200&&(i==null||i.on("style.load",()=>{$=i==null?void 0:i.getSource(a)}))},[n,E,P,a,d,p,g,y,x,C,M,F,z,i,u,o]}class Ih extends St{constructor(e){super(),kt(this,e,RS,DS,_t,{id:3,url:4,tiles:5,promoteId:6,bounds:7,scheme:8,attribution:9,minzoom:10,maxzoom:11,volatile:12})}}const FS=r=>({}),k0=r=>({}),BS=r=>({}),S0=r=>({});function T0(r){let e,t;return e=new rg({props:{$$slots:{default:[$S]},$$scope:{ctx:r}}}),{c(){ce(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p(n,i){const o={};i&64&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){ue(e,n)}}}function $S(r){let e,t;const n=r[3].help,i=mn(n,r,r[6],S0);return{c(){e=j("div"),i&&i.c(),ae(e,"class","context-layer-help-content")},m(o,u){Z(o,e,u),i&&i.m(e,null),t=!0},p(o,u){i&&i.p&&(!t||u&64)&&_n(i,n,o,o[6],t?gn(n,o[6],u,BS):yn(o[6]),S0)},i(o){t||(N(i,o),t=!0)},o(o){V(i,o),t=!1},d(o){o&&q(e),i&&i.d(o)}}}function C0(r){let e,t;const n=r[3].legend,i=mn(n,r,r[6],k0);return{c(){e=j("div"),i&&i.c(),ae(e,"class","legend svelte-1cu2wie")},m(o,u){Z(o,e,u),i&&i.m(e,null),t=!0},p(o,u){i&&i.p&&(!t||u&64)&&_n(i,n,o,o[6],t?gn(n,o[6],u,FS):yn(o[6]),k0)},i(o){t||(N(i,o),t=!0)},o(o){V(i,o),t=!1},d(o){o&&q(e),i&&i.d(o)}}}function OS(r){let e,t,n,i,o,u,a,d,p,g,y=r[2].help&&T0(r),x=r[0]&&r[2].legend&&C0(r);return{c(){e=j("button"),t=j("input"),n=ie(),i=Ee(r[1]),o=ie(),y&&y.c(),u=ie(),x&&x.c(),a=Xn(),Ye(t,"aspect-ratio","1.0"),ae(t,"type","checkbox"),ae(e,"class","context-control"),Ye(e,"display","flex"),Ye(e,"align-items","center"),Ye(e,"justify-content","leading"),Ye(e,"gap","8px"),Ye(e,"text-align","left")},m(C,M){Z(C,e,M),D(e,t),t.checked=r[0],D(e,n),D(e,i),D(e,o),y&&y.m(e,null),Z(C,u,M),x&&x.m(C,M),Z(C,a,M),d=!0,p||(g=[Tt(t,"change",r[4]),Tt(e,"click",r[5])],p=!0)},p(C,[M]){M&1&&(t.checked=C[0]),(!d||M&2)&&gt(i,C[1]),C[2].help?y?(y.p(C,M),M&4&&N(y,1)):(y=T0(C),y.c(),N(y,1),y.m(e,null)):y&&(Kt(),V(y,1,1,()=>{y=null}),Xt()),C[0]&&C[2].legend?x?(x.p(C,M),M&5&&N(x,1)):(x=C0(C),x.c(),N(x,1),x.m(a.parentNode,a)):x&&(Kt(),V(x,1,1,()=>{x=null}),Xt())},i(C){d||(N(y),N(x),d=!0)},o(C){V(y),V(x),d=!1},d(C){C&&(q(e),q(u),q(a)),y&&y.d(),x&&x.d(C),p=!1,ur(g)}}}function NS(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=$m(n);let{label:u}=e,{show:a=!1}=e;function d(){a=this.checked,t(0,a)}const p=()=>t(0,a=!a);return r.$$set=g=>{"label"in g&&t(1,u=g.label),"show"in g&&t(0,a=g.show),"$$scope"in g&&t(6,i=g.$$scope)},[a,u,o,n,d,p,i]}class ts extends St{constructor(e){super(),kt(this,e,NS,OS,_t,{label:1,show:0})}}let td=Ln(!0);function jS(r){let e,t;return e=new Ki({props:{paint:{"fill-color":"black","fill-opacity":0},layout:{visibility:r[0]?"none":"visible"}}}),{c(){ce(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p(n,i){const o={};i&1&&(o.layout={visibility:n[0]?"none":"visible"}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){ue(e,n)}}}function US(r){let e,t;return e=new mr({props:{data:r[1],$$slots:{default:[jS]},$$scope:{ctx:r}}}),{c(){ce(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p(n,[i]){const o={};i&5&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){ue(e,n)}}}function VS(r,e,t){let n;return st(r,td,o=>t(0,n=o)),[n,{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]]}}]}class qS extends St{constructor(e){super(),kt(this,e,VS,US,_t,{})}}function ZS(r){let e,t;return e=new Td({props:{lngLat:r[0],$$slots:{default:[HS]},$$scope:{ctx:r}}}),{c(){ce(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p(n,i){const o={};i&1&&(o.lngLat=n[0]),i&16&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){ue(e,n)}}}function GS(r){let e,t,n;function i(u){r[3](u)}let o={draggable:!0,$$slots:{default:[WS]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.lngLat=r[0]),e=new Td({props:o}),un.push(()=>Pn(e,"lngLat",i)),{c(){ce(e.$$.fragment)},m(u,a){le(e,u,a),n=!0},p(u,a){const d={};a&16&&(d.$$scope={dirty:a,ctx:u}),!t&&a&1&&(t=!0,d.lngLat=u[0],An(()=>t=!1)),e.$set(d)},i(u){n||(N(e.$$.fragment,u),n=!0)},o(u){V(e.$$.fragment,u),n=!1},d(u){ue(e,u)}}}function HS(r){let e,t;const n=r[2].default,i=mn(n,r,r[4],null);return{c(){e=j("span"),i&&i.c(),ae(e,"class","dot svelte-nb4dgc")},m(o,u){Z(o,e,u),i&&i.m(e,null),t=!0},p(o,u){i&&i.p&&(!t||u&16)&&_n(i,n,o,o[4],t?gn(n,o[4],u,null):yn(o[4]),null)},i(o){t||(N(i,o),t=!0)},o(o){V(i,o),t=!1},d(o){o&&q(e),i&&i.d(o)}}}function WS(r){let e,t;const n=r[2].default,i=mn(n,r,r[4],null);return{c(){e=j("span"),i&&i.c(),ae(e,"class","dot svelte-nb4dgc")},m(o,u){Z(o,e,u),i&&i.m(e,null),t=!0},p(o,u){i&&i.p&&(!t||u&16)&&_n(i,n,o,o[4],t?gn(n,o[4],u,null):yn(o[4]),null)},i(o){t||(N(i,o),t=!0)},o(o){V(i,o),t=!1},d(o){o&&q(e),i&&i.d(o)}}}function KS(r){let e,t,n,i;const o=[GS,ZS],u=[];function a(d,p){return d[1]?0:1}return e=a(r),t=u[e]=o[e](r),{c(){t.c(),n=Xn()},m(d,p){u[e].m(d,p),Z(d,n,p),i=!0},p(d,[p]){let g=e;e=a(d),e===g?u[e].p(d,p):(Kt(),V(u[g],1,1,()=>{u[g]=null}),Xt(),t=u[e],t?t.p(d,p):(t=u[e]=o[e](d),t.c()),N(t,1),t.m(n.parentNode,n))},i(d){i||(N(t),i=!0)},o(d){V(t),i=!1},d(d){d&&q(n),u[e].d(d)}}}function XS(r,e,t){let{$$slots:n={},$$scope:i}=e,{lngLat:o}=e,{draggable:u=!1}=e;function a(d){o=d,t(0,o)}return r.$$set=d=>{"lngLat"in d&&t(0,o=d.lngLat),"draggable"in d&&t(1,u=d.draggable),"$$scope"in d&&t(4,i=d.$$scope)},[o,u,n,a,i]}class bl extends St{constructor(e){super(),kt(this,e,XS,KS,_t,{lngLat:0,draggable:1})}}function JS(r){let e,t,n;const i=r[2].default,o=mn(i,r,r[5],null);return{c(){e=j("h2"),e.textContent="Help",t=ie(),o&&o.c()},m(u,a){Z(u,e,a),Z(u,t,a),o&&o.m(u,a),n=!0},p(u,a){o&&o.p&&(!n||a&32)&&_n(o,i,u,u[5],n?gn(i,u[5],a,null):yn(u[5]),null)},i(u){n||(N(o,u),n=!0)},o(u){V(o,u),n=!1},d(u){u&&(q(e),q(t)),o&&o.d(u)}}}function YS(r){let e,t,n,i,o,u,a,d;t=new $k({props:{color:r[0]}});function p(y){r[4](y)}let g={$$slots:{default:[JS]},$$scope:{ctx:r}};return r[1]!==void 0&&(g.show=r[1]),i=new Um({props:g}),un.push(()=>Pn(i,"show",p)),{c(){e=j("button"),ce(t.$$.fragment),n=ie(),ce(i.$$.fragment),ae(e,"class","icon-btn help svelte-my65h"),ae(e,"title","Help")},m(y,x){Z(y,e,x),le(t,e,null),Z(y,n,x),le(i,y,x),u=!0,a||(d=Tt(e,"click",oh(r[3])),a=!0)},p(y,[x]){const C={};x&1&&(C.color=y[0]),t.$set(C);const M={};x&32&&(M.$$scope={dirty:x,ctx:y}),!o&&x&2&&(o=!0,M.show=y[1],An(()=>o=!1)),i.$set(M)},i(y){u||(N(t.$$.fragment,y),N(i.$$.fragment,y),u=!0)},o(y){V(t.$$.fragment,y),V(i.$$.fragment,y),u=!1},d(y){y&&(q(e),q(n)),ue(t),ue(i,y),a=!1,d()}}}function QS(r,e,t){let{$$slots:n={},$$scope:i}=e,o=!1,{color:u="black"}=e;const a=()=>t(1,o=!0);function d(p){o=p,t(1,o)}return r.$$set=p=>{"color"in p&&t(0,u=p.color),"$$scope"in p&&t(5,i=p.$$scope)},[u,o,n,a,d,i]}class rg extends St{constructor(e){super(),kt(this,e,QS,YS,_t,{color:0})}}function e5(r){let e,t,n,i;const o=r[1].default,u=mn(o,r,r[0],null);return{c(){e=j("a"),u&&u.c(),ae(e,"href","#")},m(a,d){Z(a,e,d),u&&u.m(e,null),t=!0,n||(i=Tt(e,"click",Om(r[2])),n=!0)},p(a,[d]){u&&u.p&&(!t||d&1)&&_n(u,o,a,a[0],t?gn(o,a[0],d,null):yn(a[0]),null)},i(a){t||(N(u,a),t=!0)},o(a){V(u,a),t=!1},d(a){a&&q(e),u&&u.d(a),n=!1,i()}}}function t5(r,e,t){let{$$slots:n={},$$scope:i}=e;function o(u){In.call(this,r,u)}return r.$$set=u=>{"$$scope"in u&&t(0,i=u.$$scope)},[i,n,o]}class Ah extends St{constructor(e){super(),kt(this,e,t5,e5,_t,{})}}function gr(r){switch(r){case"title":return"Choose project";case"new-project":return"New project";case"pick-neighbourhood":return"Pick neighbourhood";case"set-boundary":return"Adjust boundary";case"add-neighbourhood":return"Add a neighbourhood";case"neighbourhood":return"Editing";case"view-shortcuts":return"View shortcuts";case"impact-one-destination":return"Impact on one destination";case"route":return"Route";case"predict-impact":return"Predict impact";case"impact-detail":return"Impact detail";case"debug-intersections":return"Debug intersections";case"debug-neighbourhood":return"Debug neighbourhood";case"debug-demand":return"Explore origin/destination demand data"}}function n5(r){let e=gr(r[0].mode)+"",t;return{c(){t=Ee(e)},m(n,i){Z(n,t,i)},p(n,i){i&1&&e!==(e=gr(n[0].mode)+"")&&gt(t,e)},d(n){n&&q(t)}}}function r5(r){let e;const t=r[3].default,n=mn(t,r,r[5],null),i=n||n5(r);return{c(){i&&i.c()},m(o,u){i&&i.m(o,u),e=!0},p(o,u){n?n.p&&(!e||u&32)&&_n(n,t,o,o[5],e?gn(t,o[5],u,null):yn(o[5]),null):i&&i.p&&(!e||u&1)&&i.p(o,e?u:-1)},i(o){e||(N(i,o),e=!0)},o(o){V(i,o),e=!1},d(o){i&&i.d(o)}}}function i5(r){let e,t;return e=new Ah({props:{$$slots:{default:[r5]},$$scope:{ctx:r}}}),e.$on("click",r[4]),{c(){ce(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p(n,[i]){const o={};i&33&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){ue(e,n)}}}function o5(r,e,t){let n;st(r,Kn,p=>t(2,n=p));let{$$slots:i={},$$scope:o}=e,{mode:u}=e,{afterLink:a=void 0}=e;const d=()=>{an(Kn,n=u,n),a&&a()};return r.$$set=p=>{"mode"in p&&t(0,u=p.mode),"afterLink"in p&&t(1,a=p.afterLink),"$$scope"in p&&t(5,o=p.$$scope)},[u,a,n,i,d,o]}class jn extends St{constructor(e){super(),kt(this,e,o5,i5,_t,{mode:0,afterLink:1})}}function s5(r){let e,t,n,i,o,u=r[0]+1+"",a,d,p=r[1].length+"",g,y,x,C,M,F,z;return{c(){e=j("div"),t=j("button"),n=Ee("Previous"),o=ie(),a=Ee(u),d=Ee(" / "),g=Ee(p),y=ie(),x=j("button"),C=Ee("Next"),t.disabled=i=r[0]==0,ae(t,"data-tooltip","Left"),x.disabled=M=r[0]==r[1].length-1,ae(x,"data-tooltip","Right"),Ye(e,"display","flex"),Ye(e,"justify-content","space-between"),Ye(e,"align-items","center")},m(E,P){Z(E,e,P),D(e,t),D(t,n),D(e,o),D(e,a),D(e,d),D(e,g),D(e,y),D(e,x),D(x,C),F||(z=[Tt(window,"keydown",r[2]),Tt(t,"click",r[3]),Tt(x,"click",r[4])],F=!0)},p(E,[P]){P&1&&i!==(i=E[0]==0)&&(t.disabled=i),P&1&&u!==(u=E[0]+1+"")&&gt(a,u),P&2&&p!==(p=E[1].length+"")&&gt(g,p),P&3&&M!==(M=E[0]==E[1].length-1)&&(x.disabled=M)},i:ot,o:ot,d(E){E&&q(e),F=!1,ur(z)}}}function a5(r,e,t){let n;st(r,rs,p=>t(5,n=p));let{list:i}=e,{idx:o=0}=e;Es(()=>{n==null||n.keyboard.disable()}),ti(()=>{n==null||n.keyboard.enable()});function u(p){p.key=="ArrowLeft"&&(p.stopPropagation(),a()),p.key=="ArrowRight"&&(p.stopPropagation(),d())}function a(){o!=0&&t(0,o--,o)}function d(){o!=i.length-1&&t(0,o++,o)}return r.$$set=p=>{"list"in p&&t(1,i=p.list),"idx"in p&&t(0,o=p.idx)},[o,i,u,a,d]}class Cd extends St{constructor(e){super(),kt(this,e,a5,s5,_t,{list:1,idx:0})}}function M0(r,e,t){const n=r.slice();return n[4]=e[t][0],n[5]=e[t][1],n}function L0(r){let e,t,n,i,o=r[4]+"",u,a;return{c(){e=j("div"),t=j("span"),i=ie(),u=Ee(o),a=ie(),ae(t,"class",n="color-swatch "+r[1]+" svelte-1enycr6"),Ye(t,"background",r[5]),Ye(e,"display","flex"),Ye(e,"align-items","center"),Ye(e,"gap","6px")},m(d,p){Z(d,e,p),D(e,t),D(e,i),D(e,u),D(e,a)},p(d,p){p&2&&n!==(n="color-swatch "+d[1]+" svelte-1enycr6")&&ae(t,"class",n),p&1&&Ye(t,"background",d[5]),p&1&&o!==(o=d[4]+"")&&gt(u,o)},d(d){d&&q(e)}}}function l5(r){let e,t=Rn(Object.entries(r[0])),n=[];for(let i=0;i<t.length;i+=1)n[i]=L0(M0(r,t,i));return{c(){e=j("div");for(let i=0;i<n.length;i+=1)n[i].c();Ye(e,"display","grid"),Ye(e,"grid-template-columns","repeat(auto-fill, calc("+r[2]+" - 10px))"),Ye(e,"gap","10px")},m(i,o){Z(i,e,o);for(let u=0;u<n.length;u+=1)n[u]&&n[u].m(e,null)},p(i,[o]){if(o&3){t=Rn(Object.entries(i[0]));let u;for(u=0;u<t.length;u+=1){const a=M0(i,t,u);n[u]?n[u].p(a,o):(n[u]=L0(a),n[u].c(),n[u].m(e,null))}for(;u<n.length;u+=1)n[u].d(1);n.length=t.length}},i:ot,o:ot,d(i){i&&q(e),gi(n,i)}}}function u5(r,e,t){let{labelColors:n}=e,{swatchClass:i="rectangle"}=e,{itemsPerRow:o=2}=e,u=`${100/o}%`;return r.$$set=a=>{"labelColors"in a&&t(0,n=a.labelColors),"swatchClass"in a&&t(1,i=a.swatchClass),"itemsPerRow"in a&&t(3,o=a.itemsPerRow)},[n,i,u,o]}class ig extends St{constructor(e){super(),kt(this,e,u5,l5,_t,{labelColors:0,swatchClass:1,itemsPerRow:3})}}function E0(r,e,t){const n=r.slice();return n[6]=e[t],n}function I0(r,e,t){const n=r.slice();return n[9]=e[t],n}function A0(r){let e,t;return{c(){e=j("span"),t=Ee(""),ae(e,"class","bucket svelte-3plrz9"),Ye(e,"background",r[9])},m(n,i){Z(n,e,i),D(e,t)},p(n,i){i&1&&Ye(e,"background",n[9])},d(n){n&&q(e)}}}function P0(r){let e;return{c(){e=j("span"),e.textContent=`${r[6]}`,ae(e,"class","svelte-3plrz9")},m(t,n){Z(t,e,n)},p:ot,d(t){t&&q(e)}}}function c5(r){let e,t,n,i,o=Rn(r[0]),u=[];for(let p=0;p<o.length;p+=1)u[p]=A0(I0(r,o,p));let a=Rn(r[3]),d=[];for(let p=0;p<a.length;p+=1)d[p]=P0(E0(r,a,p));return{c(){e=j("div"),t=j("div");for(let p=0;p<u.length;p+=1)u[p].c();n=ie(),i=j("div");for(let p=0;p<d.length;p+=1)d[p].c();ae(t,"class","colors svelte-3plrz9"),ae(i,"class","labels svelte-3plrz9"),ae(e,"class","svelte-3plrz9"),jt(e,"full-width-bucket-legend",r[2]),jt(e,"bucketed",r[1].hasOwnProperty("buckets")),jt(e,"limits",r[1].hasOwnProperty("limits"))},m(p,g){Z(p,e,g),D(e,t);for(let y=0;y<u.length;y+=1)u[y]&&u[y].m(t,null);D(e,n),D(e,i);for(let y=0;y<d.length;y+=1)d[y]&&d[y].m(i,null)},p(p,[g]){if(g&1){o=Rn(p[0]);let y;for(y=0;y<o.length;y+=1){const x=I0(p,o,y);u[y]?u[y].p(x,g):(u[y]=A0(x),u[y].c(),u[y].m(t,null))}for(;y<u.length;y+=1)u[y].d(1);u.length=o.length}if(g&8){a=Rn(p[3]);let y;for(y=0;y<a.length;y+=1){const x=E0(p,a,y);d[y]?d[y].p(x,g):(d[y]=P0(x),d[y].c(),d[y].m(i,null))}for(;y<d.length;y+=1)d[y].d(1);d.length=a.length}g&4&&jt(e,"full-width-bucket-legend",p[2]),g&2&&jt(e,"bucketed",p[1].hasOwnProperty("buckets")),g&2&&jt(e,"limits",p[1].hasOwnProperty("limits"))},i:ot,o:ot,d(p){p&&q(e),gi(u,p),gi(d,p)}}}function h5(r,e,t){let{colorScale:n}=e,{labels:i}=e,{decimalPlaces:o=0}=e,{fullWidthBucketLegend:u=!1}=e,a=[];"limits"in i?a=i.limits:a=i.buckets;let d=a.map(p=>typeof p=="number"?o>0?p.toFixed(o):p.toLocaleString():p);return r.$$set=p=>{"colorScale"in p&&t(0,n=p.colorScale),"labels"in p&&t(1,i=p.labels),"decimalPlaces"in p&&t(4,o=p.decimalPlaces),"fullWidthBucketLegend"in p&&t(2,u=p.fullWidthBucketLegend)},[n,i,u,d,o]}class No extends St{constructor(e){super(),kt(this,e,h5,c5,_t,{colorScale:0,labels:1,decimalPlaces:4,fullWidthBucketLegend:2})}}function f5(r,e){let t=new Set(r.getStyle().layers.filter(n=>n.type=="line").map(n=>n.id));return e=="dataviz"?["Road network","Path"].filter(n=>t.has(n)):e=="hybrid"?["Path","Road","Tunnel"].filter(n=>t.has(n)):e=="streets-v2"?r.getStyle().layers.filter(n=>n["source-layer"]=="transportation"&&n.type=="line").map(n=>n.id):e=="uk-openzoomstack-light"?r.getStyle().layers.filter(n=>n["source-layer"]=="roads"&&n.type=="line").map(n=>n.id):[]}const{window:d5}=Lb;function p5(r){let e,t;return e=new i3({}),{c(){ce(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){ue(e,n)}}}function m5(r){let e,t;return e=new Qk({}),{c(){ce(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){ue(e,n)}}}function z0(r){let e,t,n,i,o,u,a,d,p,g,y,x,C,M,F,z,E,P;return z=Nm(r[9][0]),{c(){e=j("div"),t=Ee(`Click the map to see street view
      `),n=j("br"),i=ie(),o=j("br"),u=ie(),a=j("b"),a.textContent="Street view source",d=ie(),p=j("label"),g=j("input"),y=Ee(`
        Google Street View`),x=ie(),C=j("label"),M=j("input"),F=Ee(`
        Bing Streetside`),ae(g,"type","radio"),g.__value="google",Vn(g,g.__value),ae(g,"class","svelte-1kgc7zz"),ae(p,"class","svelte-1kgc7zz"),ae(M,"type","radio"),M.__value="bing",Vn(M,M.__value),ae(M,"class","svelte-1kgc7zz"),ae(C,"class","svelte-1kgc7zz"),ae(e,"class","street-view-control-source svelte-1kgc7zz"),jt(e,"expanded",r[0]),z.p(g,M)},m($,U){Z($,e,U),D(e,t),D(e,n),D(e,i),D(e,o),D(e,u),D(e,a),D(e,d),D(e,p),D(p,g),g.checked=g.__value===r[1],D(p,y),D(e,x),D(e,C),D(C,M),M.checked=M.__value===r[1],D(C,F),E||(P=[Tt(g,"change",r[8]),Tt(M,"change",r[10])],E=!0)},p($,U){U&2&&(g.checked=g.__value===$[1]),U&2&&(M.checked=M.__value===$[1]),U&1&&jt(e,"expanded",$[0])},d($){$&&q(e),z.r(),E=!1,ur(P)}}}function g5(r){let e,t,n,i,o,u,a,d,p;const g=[m5,p5],y=[];function x(M,F){return M[0]?0:1}n=x(r),i=y[n]=g[n](r);let C=r[0]&&z0(r);return{c(){e=j("button"),t=j("div"),i.c(),o=ie(),C&&C.c(),u=Xn(),ae(t,"class","ltn-map-btn"),ae(e,"title","Street view")},m(M,F){Z(M,e,F),D(e,t),y[n].m(t,null),Z(M,o,F),C&&C.m(M,F),Z(M,u,F),a=!0,d||(p=Tt(e,"click",r[7]),d=!0)},p(M,F){let z=n;n=x(M),n!==z&&(Kt(),V(y[z],1,1,()=>{y[z]=null}),Xt(),i=y[n],i||(i=y[n]=g[n](M),i.c()),N(i,1),i.m(t,null)),M[0]?C?C.p(M,F):(C=z0(M),C.c(),C.m(u.parentNode,u)):C&&(C.d(1),C=null)},i(M){a||(N(i),a=!0)},o(M){V(i),a=!1},d(M){M&&(q(e),q(o),q(u)),y[n].d(),C&&C.d(M),d=!1,p()}}}function _5(r){let e,t,n,i;return e=new iv({props:{$$slots:{default:[g5]},$$scope:{ctx:r}}}),{c(){ce(e.$$.fragment)},m(o,u){le(e,o,u),t=!0,n||(i=Tt(d5,"keydown",r[4]),n=!0)},p(o,[u]){const a={};u&16387&&(a.$$scope={dirty:u,ctx:o}),e.$set(a)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){ue(e,o),n=!1,i()}}}function y5(r,e,t){let n;st(r,td,E=>t(12,n=E));let{map:i}=e,{maptilerBasemap:o}=e,u=!1,a="google",d=[];function p(){an(td,n=!1,n),i.on("click",y),i.getCanvas().style.cursor="crosshair";for(let E of f5(i,o))d.push([E,i.getPaintProperty(E,"line-color")]),i.setPaintProperty(E,"line-color","cyan")}function g(){an(td,n=!0,n),i.off("click",y),i.getCanvas().style.cursor="inherit";for(let[E,P]of d)i.setPaintProperty(E,"line-color",P);d=[]}ti(g);function y(E){let P=E.lngLat.lng,$=E.lngLat.lat;a=="google"?window.open(`http://maps.google.com/maps?q=&layer=c&cbll=${$},${P}&cbp=11,0,0,0,0`,"_blank"):a=="bing"&&window.open(`https://www.bing.com/maps?cp=${$}~${P}&style=x`,"_blank")}function x(E){!n&&E.key=="Escape"&&(E.stopPropagation(),g())}const C=[[]],M=()=>{t(0,u=!u),u?p():g()};function F(){a=this.__value,t(1,a)}function z(){a=this.__value,t(1,a)}return r.$$set=E=>{"map"in E&&t(5,i=E.map),"maptilerBasemap"in E&&t(6,o=E.maptilerBasemap)},[u,a,p,g,x,i,o,M,F,C,z]}class b5 extends St{constructor(e){super(),kt(this,e,y5,_5,_t,{map:5,maptilerBasemap:6})}}function dn(r,e=!0){return{id:r,beforeId:v5(r),eventsIfTopMost:e}}function v5(r){let e=Ci(rs);if(!e){console.warn(`getBeforeId(${r}) called before map is ready. Z-ordering may be incorrect.`);return}let t,n=!1;for(let i=D0.length-1;i>=0;i--){let o=D0[i];if(o==r){n=!0;break}e.getLayer(o)&&(t=o)}if(!n)throw new Error(`Layer ID ${r} not defined in layerZorder`);return t}let Kp=r=>r,Xp=r=>r;const D0=[Kp(Xp("Background")),"neighbourhood-boundaries",Kp("Ferry line"),"neighbourhood-boundaries-outline","neighbourhood-boundaries-selected-outline-base","neighbourhood-boundaries-selected-outline","debug-borders","debug-filters","cells","main-roads-outlines","main-roads","interior-roads-outlines","interior-roads","turn-restriction-targets","debug-intersections","debug-movements-outline","debug-movements-fill","debug-editable-intersections","editable-intersections","intersection-filters","border-entries","compare-route","shortcuts","shortcuts-focus","predict-impact-outline","predict-impact",Xp("Building"),"draw-area-lines","draw-area-area","draw-area-lines-preview","debug-demand-fill","debug-demand-outline","one-ways","context-population-car-ownership","context-simd","context-population-density","context-population-outline","context-traffic","context-los","context-existing-infra","context-route-network","context-bus-routes","context-pois","context-railway-stations","context-stats19",Xp("Road labels"),Kp("road_label"),"animate-shortcuts","modal-filters","turn-restrictions","turn-restrictions-debug-arrows","boundary","neighbourhood-boundary","freehand-line","edit-polygon-fill","edit-polygon-lines","edit-polygon-vertices"];let Sv=["#8a9a5b","#ffc300","#cc5500","#c70039","#900c3f","#581845"],Tv=[20,30,40,50,60,70],kl=["#080C54","#186290","#1F9EB7","#80C6A3","#CDE594"],Md=kl,Ld=[0,20,40,60,80,100],Ed=kl.toReversed(),Id=[0,1300,3e3,4200,5900,52e3],nd=kl.toReversed(),w5=[0,.3,.6,1,1.5,2],x5=kl.toReversed(),Cv=[0,1,10,50,100,1e3],Mv=kl.toReversed(),Lv=[0,1,10,50,100,1e3],Ev=kl.toReversed(),Ad=[0,20,40,60,80,100],Pd=kl;function Iv(r){let e=[];for(let t=1;t<r.length;t++)e.push(t);return e}const k5="#0C793A",yo={mapFeature:{hover:{backgroundColor:"rgb(72, 96, 202)"}}};function Hs(r){return["interpolate",["linear"],["zoom"],5,.5+r,10,1+r,12,1.5+r,14,4+r,16,7+r,20,24+r]}function Ea(r){return r<1e3?Math.round(r)+"m":(r/1e3).toFixed(1)+"km"}function Ia(r){if(r<60)return Math.round(r)+"s";let e=Math.floor(r/60),t=Math.round(r-e*60);return`${e}m${t}s`}function Nu(r,e){return e===0?"0%":`${Math.round(r/e*100)}%`}function fh(r){return r?Ci(is)=="cnt"?bm(r,"LAD_"):r:"custom area"}function Av(r){let e=Ci(ta).project(r),t=new Date().toISOString().split("T")[0],n=`${e.project_name}-${t}.geojson`;xd(n,JSON.stringify(e))}function ym(r,e=4){return["interpolate",["exponential",2],["zoom"],0,["max",["/",r,15654.303392],e],22,["max",["/",r,.0597164283],e]]}async function xa(r){let e=await fetch(r);if(!e.ok)throw new Error(`${r} not OK: ${e.status}`);return e}function R0(r){return r.reduce((e,t)=>e+t,0)}function bm(r,e){return r.startsWith(e)?r.slice(e.length):r}function F0(r,e){return r.endsWith(e)?r.slice(0,-e.length):r}function S5(r){let e;return{c(){e=j("p"),e.innerHTML=`These are all <a href="https://wiki.openstreetmap.org/wiki/Tag:route%3Dbus" target="_blank">bus routes</a>
    according to OpenStreetMap.`,ae(e,"slot","help")},m(t,n){Z(t,e,n)},p:ot,d(t){t&&q(e)}}}function T5(r){let e,t;const n=[dn("context-bus-routes"),{sourceLayer:"bus_routes"},{paint:{"line-color":"blue","line-width":Hs(0)}},{layout:{visibility:r[0]?"visible":"none"}}];let i={};for(let o=0;o<n.length;o+=1)i=Mt(i,n[o]);return e=new sr({props:i}),{c(){ce(e.$$.fragment)},m(o,u){le(e,o,u),t=!0},p(o,u){const a=u&1?En(n,[n[0],n[1],n[2],{layout:{visibility:o[0]?"visible":"none"}}]):{};e.$set(a)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){ue(e,o)}}}function C5(r){let e,t,n,i,o;function u(d){r[1](d)}let a={label:"Bus routes",$$slots:{help:[S5]},$$scope:{ctx:r}};return r[0]!==void 0&&(a.show=r[0]),e=new ts({props:a}),un.push(()=>Pn(e,"show",u)),i=new Ih({props:{url:`pmtiles://${Bo("cnt_layers/bus_routes.pmtiles")}`,$$slots:{default:[T5]},$$scope:{ctx:r}}}),{c(){ce(e.$$.fragment),n=ie(),ce(i.$$.fragment)},m(d,p){le(e,d,p),Z(d,n,p),le(i,d,p),o=!0},p(d,[p]){const g={};p&4&&(g.$$scope={dirty:p,ctx:d}),!t&&p&1&&(t=!0,g.show=d[0],An(()=>t=!1)),e.$set(g);const y={};p&5&&(y.$$scope={dirty:p,ctx:d}),i.$set(y)},i(d){o||(N(e.$$.fragment,d),N(i.$$.fragment,d),o=!0)},o(d){V(e.$$.fragment,d),V(i.$$.fragment,d),o=!1},d(d){d&&q(n),ue(e,d),ue(i,d)}}}function M5(r,e,t){let n=!1;function i(o){n=o,t(0,n)}return[n,i]}class L5 extends St{constructor(e){super(),kt(this,e,M5,C5,_t,{})}}var E5=Object.defineProperty,Pv=r=>{throw TypeError(r)},I5=(r,e,t)=>e in r?E5(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,zo=(r,e,t)=>I5(r,typeof e!="symbol"?e+"":e,t),zv=(r,e,t)=>e.has(r)||Pv("Cannot "+t),yi=(r,e,t)=>(zv(r,e,"read from private field"),t?t.call(r):e.get(r)),B0=(r,e,t)=>e.has(r)?Pv("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(r):e.set(r,t),$0=(r,e,t,n)=>(zv(r,e,"write to private field"),n?n.call(r,t):e.set(r,t),t);function Or(){}function A5(r,e){for(const t in e)r[t]=e[t];return r}function Dv(r){return r()}function O0(){return Object.create(null)}function na(r){r.forEach(Dv)}function Rv(r){return typeof r=="function"}function Ra(r,e){return r!=r?e==e:r!==e||r&&typeof r=="object"||typeof r=="function"}let Zf;function Xi(r,e){return r===e?!0:(Zf||(Zf=document.createElement("a")),Zf.href=e,r===Zf.href)}function P5(r){return Object.keys(r).length===0}function z5(r,e,t,n){if(r){const i=Fv(r,e,t,n);return r[0](i)}}function Fv(r,e,t,n){return r[1]&&n?A5(t.ctx.slice(),r[1](n(e))):t.ctx}function D5(r,e,t,n){if(r[2]&&n){const i=r[2](n(t));if(e.dirty===void 0)return i;if(typeof i=="object"){const o=[],u=Math.max(e.dirty.length,i.length);for(let a=0;a<u;a+=1)o[a]=e.dirty[a]|i[a];return o}return e.dirty|i}return e.dirty}function R5(r,e,t,n,i,o){if(i){const u=Fv(e,t,n,o);r.p(u,i)}}function F5(r){if(r.ctx.length>32){const e=[],t=r.ctx.length/32;for(let n=0;n<t;n++)e[n]=-1;return e}return-1}function N0(r){return r??""}function Jn(r,e){r.appendChild(e)}function Vr(r,e,t){r.insertBefore(e,t||null)}function Nr(r){r.parentNode&&r.parentNode.removeChild(r)}function wr(r){return document.createElement(r)}function gs(r){return document.createElementNS("http://www.w3.org/2000/svg",r)}function Aa(r){return document.createTextNode(r)}function Fo(){return Aa(" ")}function B5(){return Aa("")}function lo(r,e,t,n){return r.addEventListener(e,t,n),()=>r.removeEventListener(e,t,n)}function $5(r){return function(e){return e.preventDefault(),r.call(this,e)}}function xt(r,e,t){t==null?r.removeAttribute(e):r.getAttribute(e)!==t&&r.setAttribute(e,t)}function O5(r){return Array.from(r.childNodes)}function bh(r,e){e=""+e,r.data!==e&&(r.data=e)}function j0(r,e){r.value=e??""}function es(r,e,t){r.classList.toggle(e,!!t)}function N5(r,e,{bubbles:t=!1,cancelable:n=!1}={}){return new CustomEvent(r,{detail:e,bubbles:t,cancelable:n})}let vh;function dh(r){vh=r}function Bv(){if(!vh)throw new Error("Function called outside component initialization");return vh}function j5(r){Bv().$$.on_destroy.push(r)}function U5(){const r=Bv();return(e,t,{cancelable:n=!1}={})=>{const i=r.$$.callbacks[e];if(i){const o=N5(e,t,{cancelable:n});return i.slice().forEach(u=>{u.call(r,o)}),!o.defaultPrevented}return!0}}function U0(r,e){const t=r.$$.callbacks[e.type];t&&t.slice().forEach(n=>n.call(this,e))}const Iu=[],vm=[];let Ru=[];const V0=[],V5=Promise.resolve();let wm=!1;function q5(){wm||(wm=!0,V5.then($v))}function xm(r){Ru.push(r)}const Jp=new Set;let Cu=0;function $v(){if(Cu!==0)return;const r=vh;do{try{for(;Cu<Iu.length;){const e=Iu[Cu];Cu++,dh(e),Z5(e.$$)}}catch(e){throw Iu.length=0,Cu=0,e}for(dh(null),Iu.length=0,Cu=0;vm.length;)vm.pop()();for(let e=0;e<Ru.length;e+=1){const t=Ru[e];Jp.has(t)||(Jp.add(t),t())}Ru.length=0}while(Iu.length);for(;V0.length;)V0.pop()();wm=!1,Jp.clear(),dh(r)}function Z5(r){if(r.fragment!==null){r.update(),na(r.before_update);const e=r.dirty;r.dirty=[-1],r.fragment&&r.fragment.p(r.ctx,e),r.after_update.forEach(xm)}}function G5(r){const e=[],t=[];Ru.forEach(n=>r.indexOf(n)===-1?e.push(n):t.push(n)),t.forEach(n=>n()),Ru=e}const rd=new Set;let pl;function id(){pl={r:0,c:[],p:pl}}function od(){pl.r||na(pl.c),pl=pl.p}function fi(r,e){r&&r.i&&(rd.delete(r),r.i(e))}function Ti(r,e,t,n){if(r&&r.o){if(rd.has(r))return;rd.add(r),pl.c.push(()=>{rd.delete(r),n&&(t&&r.d(1),n())}),r.o(e)}else n&&n()}function q0(r){return(r==null?void 0:r.length)!==void 0?r:Array.from(r)}function H5(r,e){Ti(r,1,1,()=>{e.delete(r.key)})}function W5(r,e,t,n,i,o,u,a,d,p,g,y){let x=r.length,C=o.length,M=x;const F={};for(;M--;)F[r[M].key]=M;const z=[],E=new Map,P=new Map,$=[];for(M=C;M--;){const W=y(i,o,M),J=t(W);let he=u.get(J);he?$.push(()=>he.p(W,e)):(he=p(J,W),he.c()),E.set(J,z[M]=he),J in F&&P.set(J,Math.abs(M-F[J]))}const U=new Set,K=new Set;function ee(W){fi(W,1),W.m(a,g),u.set(W.key,W),g=W.first,C--}for(;x&&C;){const W=z[C-1],J=r[x-1],he=W.key,Ae=J.key;W===J?(g=W.first,x--,C--):E.has(Ae)?!u.has(he)||U.has(he)?ee(W):K.has(Ae)?x--:P.get(he)>P.get(Ae)?(K.add(he),ee(W)):(U.add(Ae),x--):(d(J,u),x--)}for(;x--;){const W=r[x];E.has(W.key)||d(W,u)}for(;C;)ee(z[C-1]);return na($),z}function Pa(r){r&&r.c()}function Qs(r,e,t){const{fragment:n,after_update:i}=r.$$;n&&n.m(e,t),xm(()=>{const o=r.$$.on_mount.map(Dv).filter(Rv);r.$$.on_destroy?r.$$.on_destroy.push(...o):na(o),r.$$.on_mount=[]}),i.forEach(xm)}function ea(r,e){const t=r.$$;t.fragment!==null&&(G5(t.after_update),na(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function K5(r,e){r.$$.dirty[0]===-1&&(Iu.push(r),q5(),r.$$.dirty.fill(0)),r.$$.dirty[e/31|0]|=1<<e%31}function Fa(r,e,t,n,i,o,u=null,a=[-1]){const d=vh;dh(r);const p=r.$$={fragment:null,ctx:[],props:o,update:Or,not_equal:i,bound:O0(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(d?d.$$.context:[])),callbacks:O0(),dirty:a,skip_bound:!1,root:e.target||d.$$.root};u&&u(p.root);let g=!1;if(p.ctx=t?t(r,e.props||{},(y,x,...C)=>{const M=C.length?C[0]:x;return p.ctx&&i(p.ctx[y],p.ctx[y]=M)&&(!p.skip_bound&&p.bound[y]&&p.bound[y](M),g&&K5(r,y)),x}):[],p.update(),g=!0,na(p.before_update),p.fragment=n?n(p.ctx):!1,e.target){if(e.hydrate){const y=O5(e.target);p.fragment&&p.fragment.l(y),y.forEach(Nr)}else p.fragment&&p.fragment.c();e.intro&&fi(r.$$.fragment),Qs(r,e.target,e.anchor),$v()}dh(d)}class Ba{constructor(){zo(this,"$$"),zo(this,"$$set")}$destroy(){ea(this,1),this.$destroy=Or}$on(e,t){if(!Rv(t))return Or;const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const i=n.indexOf(t);i!==-1&&n.splice(i,1)}}$set(e){this.$$set&&!P5(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const X5="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(X5);function J5(r){let e,t;return{c(){e=gs("svg"),t=gs("path"),xt(t,"d","M13.12.706a.982.982 0 0 0-1.391 0L6.907 5.517 2.087.696a.982.982 0 1 0-1.391 1.39l4.821 4.821L.696 11.73a.982.982 0 1 0 1.39 1.39l4.821-4.821 4.822 4.821a.982.982 0 1 0 1.39-1.39L8.298 6.908l4.821-4.822a.988.988 0 0 0 0-1.38Z"),xt(e,"viewBox","0 0 14 14"),xt(e,"width","13"),xt(e,"height","13"),xt(e,"class","svelte-en2qvf")},m(n,i){Vr(n,e,i),Jn(e,t)},p:Or,i:Or,o:Or,d(n){n&&Nr(e)}}}class Ov extends Ba{constructor(e){super(),Fa(this,e,null,J5,Ra,{})}}function Y5(r){let e,t;return{c(){e=gs("svg"),t=gs("path"),xt(t,"d","M15 0C6.705 0 0 6.705 0 15C0 23.295 6.705 30 15 30C23.295 30 30 23.295 30 15C30 6.705 23.295 0 15 0ZM22.5 20.385L20.385 22.5L15 17.115L9.615 22.5L7.5 20.385L12.885 15L7.5 9.615L9.615 7.5L15 12.885L20.385 7.5L22.5 9.615L17.115 15L22.5 20.385Z"),xt(e,"viewBox","0 0 30 30"),xt(e,"fill","none"),xt(e,"xmlns","http://www.w3.org/2000/svg"),xt(e,"class","svelte-d2loi5")},m(n,i){Vr(n,e,i),Jn(e,t)},p:Or,i:Or,o:Or,d(n){n&&Nr(e)}}}class Nv extends Ba{constructor(e){super(),Fa(this,e,null,Y5,Ra,{})}}function Q5(r){let e,t;return{c(){e=wr("img"),Xi(e.src,t=r[3]+"area.svg")||xt(e,"src",t),xt(e,"alt",r[6]),xt(e,"class","svelte-ltkwvy")},m(n,i){Vr(n,e,i)},p(n,i){i&8&&!Xi(e.src,t=n[3]+"area.svg")&&xt(e,"src",t),i&64&&xt(e,"alt",n[6])},d(n){n&&Nr(e)}}}function eT(r){let e,t;return{c(){e=wr("img"),Xi(e.src,t=r[3]+"reverse.svg")||xt(e,"src",t),xt(e,"alt",r[6]),xt(e,"class","svelte-ltkwvy")},m(n,i){Vr(n,e,i)},p(n,i){i&8&&!Xi(e.src,t=n[3]+"reverse.svg")&&xt(e,"src",t),i&64&&xt(e,"alt",n[6])},d(n){n&&Nr(e)}}}function tT(r){let e,t;return{c(){e=wr("img"),Xi(e.src,t=r[3]+"poi.svg")||xt(e,"src",t),xt(e,"alt",r[6]),xt(e,"class","svelte-ltkwvy")},m(n,i){Vr(n,e,i)},p(n,i){i&8&&!Xi(e.src,t=n[3]+"poi.svg")&&xt(e,"src",t),i&64&&xt(e,"alt",n[6])},d(n){n&&Nr(e)}}}function nT(r){let e,t;return{c(){e=wr("img"),Xi(e.src,t=r[3]+"postal_code.svg")||xt(e,"src",t),xt(e,"alt",r[6]),xt(e,"class","svelte-ltkwvy")},m(n,i){Vr(n,e,i)},p(n,i){i&8&&!Xi(e.src,t=n[3]+"postal_code.svg")&&xt(e,"src",t),i&64&&xt(e,"alt",n[6])},d(n){n&&Nr(e)}}}function rT(r){let e,t;return{c(){e=wr("img"),Xi(e.src,t=r[3]+"street.svg")||xt(e,"src",t),xt(e,"alt",r[6]),xt(e,"class","svelte-ltkwvy")},m(n,i){Vr(n,e,i)},p(n,i){i&8&&!Xi(e.src,t=n[3]+"street.svg")&&xt(e,"src",t),i&64&&xt(e,"alt",n[6])},d(n){n&&Nr(e)}}}function iT(r){let e,t;return{c(){e=wr("img"),Xi(e.src,t=r[3]+"road.svg")||xt(e,"src",t),xt(e,"alt",r[6]),xt(e,"class","svelte-ltkwvy")},m(n,i){Vr(n,e,i)},p(n,i){i&8&&!Xi(e.src,t=n[3]+"road.svg")&&xt(e,"src",t),i&64&&xt(e,"alt",n[6])},d(n){n&&Nr(e)}}}function oT(r){let e,t;return{c(){e=wr("img"),Xi(e.src,t=r[3]+"housenumber.svg")||xt(e,"src",t),xt(e,"alt",r[6]),xt(e,"class","svelte-ltkwvy")},m(n,i){Vr(n,e,i)},p(n,i){i&8&&!Xi(e.src,t=n[3]+"housenumber.svg")&&xt(e,"src",t),i&64&&xt(e,"alt",n[6])},d(n){n&&Nr(e)}}}function sT(r){let e,t,n,i;return{c(){e=wr("img"),Xi(e.src,t=r[5])||xt(e,"src",t),xt(e,"alt",r[4]),xt(e,"class","svelte-ltkwvy")},m(o,u){Vr(o,e,u),n||(i=lo(e,"error",r[14]),n=!0)},p(o,u){u&32&&!Xi(e.src,t=o[5])&&xt(e,"src",t),u&16&&xt(e,"alt",o[4])},d(o){o&&Nr(e),n=!1,i()}}}function Z0(r){let e,t;return{c(){e=wr("span"),t=Aa(r[6]),xt(e,"class","secondary svelte-ltkwvy")},m(n,i){Vr(n,e,i),Jn(e,t)},p(n,i){i&64&&bh(t,n[6])},d(n){n&&Nr(e)}}}function aT(r){let e,t,n,i,o,u,a,d,p,g=(r[7]?r[0].place_name:r[0].place_name.replace(/,.*/,""))+"",y,x,C=r[2]==="always"||r[2]!=="never"&&!r[0].address&&!r[0].id.startsWith("road.")&&!r[0].id.startsWith("address.")&&!r[0].id.startsWith("postal_code.")&&(!r[0].id.startsWith("poi.")||!r[5])&&!r[7],M,F,z=(r[7]?"":r[0].place_name.replace(/[^,]*,?\s*/,""))+"",E,P,$;function U(J,he){return he&1&&(t=null),he&1&&(n=null),he&1&&(i=null),he&1&&(o=null),J[5]?sT:J[0].address?oT:(t==null&&(t=!!J[0].id.startsWith("road.")),t?iT:(n==null&&(n=!!J[0].id.startsWith("address.")),n?rT:(i==null&&(i=!!J[0].id.startsWith("postal_code.")),i?nT:(o==null&&(o=!!J[0].id.startsWith("poi.")),o?tT:J[7]?eT:Q5))))}let K=U(r,-1),ee=K(r),W=C&&Z0(r);return{c(){e=wr("li"),ee.c(),u=Fo(),a=wr("span"),d=wr("span"),p=wr("span"),y=Aa(g),x=Fo(),W&&W.c(),M=Fo(),F=wr("span"),E=Aa(z),xt(p,"class","primary svelte-ltkwvy"),xt(d,"class","svelte-ltkwvy"),xt(F,"class","line2 svelte-ltkwvy"),xt(a,"class","texts svelte-ltkwvy"),xt(e,"tabindex","0"),xt(e,"data-selected",r[1]),xt(e,"class","svelte-ltkwvy"),es(e,"selected",r[1])},m(J,he){Vr(J,e,he),ee.m(e,null),Jn(e,u),Jn(e,a),Jn(a,d),Jn(d,p),Jn(p,y),Jn(d,x),W&&W.m(d,null),Jn(a,M),Jn(a,F),Jn(F,E),P||($=[lo(e,"mouseenter",r[12]),lo(e,"focus",r[13])],P=!0)},p(J,[he]){K===(K=U(J,he))&&ee?ee.p(J,he):(ee.d(1),ee=K(J),ee&&(ee.c(),ee.m(e,u))),he&1&&g!==(g=(J[7]?J[0].place_name:J[0].place_name.replace(/,.*/,""))+"")&&bh(y,g),he&37&&(C=J[2]==="always"||J[2]!=="never"&&!J[0].address&&!J[0].id.startsWith("road.")&&!J[0].id.startsWith("address.")&&!J[0].id.startsWith("postal_code.")&&(!J[0].id.startsWith("poi.")||!J[5])&&!J[7]),C?W?W.p(J,he):(W=Z0(J),W.c(),W.m(d,null)):W&&(W.d(1),W=null),he&1&&z!==(z=(J[7]?"":J[0].place_name.replace(/[^,]*,?\s*/,""))+"")&&bh(E,z),he&2&&xt(e,"data-selected",J[1]),he&2&&es(e,"selected",J[1])},i:Or,o:Or,d(J){J&&Nr(e),ee.d(),W&&W.d(),P=!1,na($)}}}function lT(r,e,t){var n;let i,o,{feature:u}=e,{selected:a=!1}=e,{showPlaceType:d}=e,{missingIconsCache:p}=e,{iconsBaseUrl:g}=e;const y=(n=u.properties)==null?void 0:n.categories;let x,C,M=0,F=u.place_type[0]==="reverse";function z(){C&&p.add(C),t(10,M++,M)}function E(U){U0.call(this,r,U)}function P(U){U0.call(this,r,U)}const $=()=>z();return r.$$set=U=>{"feature"in U&&t(0,u=U.feature),"selected"in U&&t(1,a=U.selected),"showPlaceType"in U&&t(2,d=U.showPlaceType),"missingIconsCache"in U&&t(9,p=U.missingIconsCache),"iconsBaseUrl"in U&&t(3,g=U.iconsBaseUrl)},r.$$.update=()=>{var U,K,ee,W;if(r.$$.dirty&3640)do t(11,i--,i),t(4,x=y==null?void 0:y[i]),t(5,C=x?g+x.replace(/ /g,"_")+".svg":void 0);while(i>-1&&(!C||p.has(C)));r.$$.dirty&1&&t(6,o=((K=(U=u.properties)==null?void 0:U.categories)==null?void 0:K.join(", "))??((W=(ee=u.properties)==null?void 0:ee.place_type_name)==null?void 0:W[0])??u.place_type[0])},t(11,i=(y==null?void 0:y.length)??0),[u,a,d,g,x,C,o,F,z,p,M,i,E,P,$]}class uT extends Ba{constructor(e){super(),Fa(this,e,lT,aT,Ra,{feature:0,selected:1,showPlaceType:2,missingIconsCache:9,iconsBaseUrl:3})}}function cT(r){let e;return{c(){e=wr("div"),e.innerHTML='<svg viewBox="0 0 18 18" width="24" height="24" class="svelte-7cmwmc"><path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"></path><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"></path></svg>',xt(e,"class","svelte-7cmwmc")},m(t,n){Vr(t,e,n)},p:Or,i:Or,o:Or,d(t){t&&Nr(e)}}}class hT extends Ba{constructor(e){super(),Fa(this,e,null,cT,Ra,{})}}function fT(r){let e,t,n;return{c(){e=gs("svg"),t=gs("path"),xt(t,"stroke-width","4"),xt(t,"d","M 5,33.103579 C 5,17.607779 18.457,5 35,5 C 51.543,5 65,17.607779 65,33.103579 C 65,56.388679 40.4668,76.048179 36.6112,79.137779 C 36.3714,79.329879 36.2116,79.457979 36.1427,79.518879 C 35.8203,79.800879 35.4102,79.942779 35,79.942779 C 34.5899,79.942779 34.1797,79.800879 33.8575,79.518879 C 33.7886,79.457979 33.6289,79.330079 33.3893,79.138079 C 29.5346,76.049279 5,56.389379 5,33.103579 Z M 35.0001,49.386379 C 43.1917,49.386379 49.8323,42.646079 49.8323,34.331379 C 49.8323,26.016779 43.1917,19.276479 35.0001,19.276479 C 26.8085,19.276479 20.1679,26.016779 20.1679,34.331379 C 20.1679,42.646079 26.8085,49.386379 35.0001,49.386379 Z"),xt(t,"class","svelte-gzo3ar"),xt(e,"width",n=r[0]==="list"?20:void 0),xt(e,"viewBox","0 0 70 85"),xt(e,"fill","none"),xt(e,"class","svelte-gzo3ar"),es(e,"in-map",r[0]!=="list"),es(e,"list-icon",r[0]==="list")},m(i,o){Vr(i,e,o),Jn(e,t)},p(i,[o]){o&1&&n!==(n=i[0]==="list"?20:void 0)&&xt(e,"width",n),o&1&&es(e,"in-map",i[0]!=="list"),o&1&&es(e,"list-icon",i[0]==="list")},i:Or,o:Or,d(i){i&&Nr(e)}}}function dT(r,e,t){let{displayIn:n}=e;return r.$$set=i=>{"displayIn"in i&&t(0,n=i.displayIn)},[n]}class pT extends Ba{constructor(e){super(),Fa(this,e,dT,fT,Ra,{displayIn:0})}}function mT(r){let e,t;return{c(){e=gs("svg"),t=gs("path"),xt(t,"d","M30.003-26.765C13.46-26.765 0-14.158 0 1.337c0 23.286 24.535 42.952 28.39 46.04.24.192.402.316.471.376.323.282.732.424 1.142.424.41 0 .82-.142 1.142-.424.068-.06.231-.183.471-.376 3.856-3.09 28.39-22.754 28.39-46.04 0-15.495-13.46-28.102-30.003-28.102Zm1.757 12.469c4.38 0 7.858 1.052 10.431 3.158 2.595 2.105 3.89 4.913 3.89 8.422 0 2.34-.53 4.362-1.593 6.063-1.063 1.702-3.086 3.616-6.063 5.742-2.042 1.51-3.337 2.659-3.89 3.446-.532.787-.8 1.82-.8 3.096v1.914h-8.449V15.18c0-2.041.434-3.815 1.306-5.325.872-1.51 2.467-3.118 4.785-4.82 2.233-1.594 3.7-2.89 4.402-3.889a5.582 5.582 0 0 0 1.087-3.35c0-1.382-.51-2.435-1.531-3.158-1.02-.723-2.45-1.087-4.28-1.087-3.19 0-6.826 1.047-10.91 3.131l-3.472-6.986c4.742-2.659 9.77-3.992 15.087-3.992Zm-1.88 37.324c1.765 0 3.124.472 4.08 1.408.98.936 1.47 2.276 1.47 4.02 0 1.68-.49 3.007-1.47 3.985-.977.957-2.336 1.435-4.08 1.435-1.787 0-3.171-.465-4.15-1.4-.978-.958-1.47-2.298-1.47-4.02 0-1.787.48-3.14 1.436-4.054.957-.915 2.355-1.374 4.184-1.374Z"),xt(e,"viewBox","0 0 60.006 21.412"),xt(e,"width","14"),xt(e,"height","20"),xt(e,"class","svelte-en2qvf")},m(n,i){Vr(n,e,i),Jn(e,t)},p:Or,i:Or,o:Or,d(n){n&&Nr(e)}}}class gT extends Ba{constructor(e){super(),Fa(this,e,null,mT,Ra,{})}}function _T(r){let e,t,n;return{c(){e=gs("svg"),t=gs("circle"),n=gs("path"),xt(t,"cx","4.789"),xt(t,"cy","4.787"),xt(t,"r","3.85"),xt(t,"class","svelte-1aq105l"),xt(n,"d","M12.063 12.063 7.635 7.635"),xt(n,"class","svelte-1aq105l"),xt(e,"xmlns","http://www.w3.org/2000/svg"),xt(e,"width","13"),xt(e,"height","13"),xt(e,"viewBox","0 0 13 13"),xt(e,"class","svelte-1aq105l")},m(i,o){Vr(i,e,o),Jn(e,t),Jn(e,n)},p:Or,i:Or,o:Or,d(i){i&&Nr(e)}}}class yT extends Ba{constructor(e){super(),Fa(this,e,null,_T,Ra,{})}}function bT(r,e,t){const n=e[1],i=e[0],o=n-i;return r===n&&t?r:((r-i)%o+o)%o+i}function _d(r){const e=[...r];return e[2]<e[0]&&(Math.abs((e[0]+e[2]+360)/2)>Math.abs((e[0]-360+e[2])/2)?e[0]-=360:e[2]+=360),e}let Gc;async function vT(r,e,t){const n=r==null?void 0:r.getCenterAndZoom();for(const i of e??[])if(!(n&&(i.minZoom!=null&&i.minZoom>n[0]||i.maxZoom!=null&&i.maxZoom<n[0]))){if(i.type==="fixed")return i.coordinates.join(",");e:if(i.type==="client-geolocation"){if(Gc&&i.cachedLocationExpiry&&Gc.time+i.cachedLocationExpiry>Date.now()){if(!Gc.coords)break e;return Gc.coords}let o;try{return o=await new Promise((u,a)=>{t.signal.addEventListener("abort",()=>{a(Error("aborted"))}),navigator.geolocation.getCurrentPosition(d=>{u([d.coords.longitude,d.coords.latitude].map(p=>p.toFixed(6)).join(","))},d=>{a(d)},i)}),o}catch{}finally{i.cachedLocationExpiry&&(Gc={time:Date.now(),coords:o})}if(t.signal.aborted)return}if(i.type==="server-geolocation")return"ip";if(n&&i.type==="map-center")return n[1].toFixed(6)+","+n[2].toFixed(6)}}const wT=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*(EAST|WEST|[EW])?$/i,G0=/^([+-]?[0-8]?[0-9])\s+([0-5]?[0-9]\.\d{3,})[\s,]{1,}([+-]?[0-1]?[0-9]?[0-9])\s+([0-5]?[0-9]\.\d{3,})$/,H0=/^(NORTH|SOUTH|[NS])?[\s]*([+-]?[0-8]?[0-9](?:[\.,]\d{3,}))[\s]*([]?)[\s]*(NORTH|SOUTH|[NS])?[\s]*[,/;]?[\s]*(EAST|WEST|[EW])?[\s]*([+-]?[0-1]?[0-9]?[0-9](?:[\.,]\d{3,}))[\s]*([]?)[\s]*(EAST|WEST|[EW])?$/i,W0=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(EAST|WEST|[EW])?$/i,K0=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)\s*(EAST|WEST|[EW])?$/i,X0=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''||||["\.])?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''||||["\.])?\s*(EAST|WEST|[EW])?$/i;function xT(r){if(!["DMS","DM","DD"].includes(r))throw new Error("invalid format specified");if(this.decimalCoordinates&&this.decimalCoordinates.trim()){const e=this.decimalCoordinates.split(",").map(C=>Number(C.trim())),t=Number(e[0]),n=Number(e[1]),i=Math.abs(t),o=Math.abs(n),u=t>0?"N":"S",a=n>0?"E":"W";let d;r=="DD"&&(d=`${i} ${u}, ${o} ${a}`);const p=Math.floor(i),g=Math.floor(o),y=(i-p)*60,x=(o-g)*60;if(r=="DM"){let C=J0(y,3).toFixed(3).padStart(6,"0"),M=J0(x,3).toFixed(3).padStart(6,"0");C.endsWith(".000")&&M.endsWith(".000")&&(C=C.replace(/\.000$/,""),M=M.replace(/\.000$/,"")),d=`${p} ${C}' ${u}, ${g} ${M}' ${a}`}if(r=="DMS"){const C=Math.floor(y),M=Math.floor(x);let F=((y-C)*60).toFixed(1).padStart(4,"0"),z=((x-M)*60).toFixed(1).padStart(4,"0");const E=C.toString().padStart(2,"0"),P=M.toString().padStart(2,"0");F.endsWith(".0")&&z.endsWith(".0")&&(F=F.replace(/\.0$/,""),z=z.replace(/\.0$/,"")),d=`${p} ${E}' ${F}" ${u}, ${g} ${P}' ${z}" ${a}`}return d}else throw new Error("no decimal coordinates to convert")}function J0(r,e){const t=Math.pow(10,e);return Math.round((r+Number.EPSILON)*t)/t}function og(r,e){e||(e=5),r=r.replace(/\s+/g," ").trim();let t=null,n=null,i="",o="",u=null,a=[],d=!1;if(wT.test(r))throw new Error("invalid coordinate value");if(G0.test(r))if(a=G0.exec(r),d=Hc(a),d)t=Math.abs(a[1])+a[2]/60,Number(a[1])<0&&(t*=-1),n=Math.abs(a[3])+a[4]/60,Number(a[3])<0&&(n*=-1),u="DM";else throw new Error("invalid coordinate format");else if(H0.test(r))if(a=H0.exec(r),d=Hc(a),d){if(t=a[2],n=a[6],t.includes(",")&&(t=t.replace(",",".")),n.includes(",")&&(n=n.replace(",",".")),u="DD",Number(Math.round(t))==Number(t))throw new Error("integer only coordinate provided");if(Number(Math.round(n))==Number(n))throw new Error("integer only coordinate provided");a[1]?(i=a[1],o=a[5]):a[4]&&(i=a[4],o=a[8])}else throw new Error("invalid decimal coordinate format");else if(W0.test(r))if(a=W0.exec(r),d=Hc(a),d)t=Math.abs(parseInt(a[2])),a[4]&&(t+=a[4]/60,u="DM"),a[6]&&(t+=a[6].replace(",",".")/3600,u="DMS"),parseInt(a[2])<0&&(t=-1*t),n=Math.abs(parseInt(a[9])),a[11]&&(n+=a[11]/60),a[13]&&(n+=a[13].replace(",",".")/3600),parseInt(a[9])<0&&(n=-1*n),a[1]?(i=a[1],o=a[8]):a[7]&&(i=a[7],o=a[14]);else throw new Error("invalid DMS coordinates format");else if(K0.test(r))if(a=K0.exec(r),d=Hc(a),d)t=Math.abs(parseInt(a[2])),a[4]&&(t+=a[4]/60,u="DM"),a[6]&&(t+=a[6]/3600,u="DMS"),parseInt(a[2])<0&&(t=-1*t),n=Math.abs(parseInt(a[10])),a[12]&&(n+=a[12]/60),a[14]&&(n+=a[14]/3600),parseInt(a[10])<0&&(n=-1*n),a[1]?(i=a[1],o=a[9]):a[8]&&(i=a[8],o=a[16]);else throw new Error("invalid DMS coordinates format");else if(X0.test(r)){if(a=X0.exec(r),d=Hc(a),a.filter(p=>p).length<=5)throw new Error("invalid coordinates format");if(d)t=Math.abs(parseInt(a[2])),a[4]&&(t+=a[4].replace(",",".")/60,u="DM"),a[6]&&(t+=a[6].replace(",",".")/3600,u="DMS"),parseInt(a[2])<0&&(t=-1*t),n=Math.abs(parseInt(a[10])),a[12]&&(n+=a[12].replace(",",".")/60),a[14]&&(n+=a[14].replace(",",".")/3600),parseInt(a[10])<0&&(n=-1*n),a[1]?(i=a[1],o=a[9]):a[8]&&(i=a[8],o=a[16]);else throw new Error("invalid coordinates format")}if(d){if(Math.abs(n)>=180)throw new Error("invalid longitude value");if(Math.abs(t)>=90)throw new Error("invalid latitude value");if(i&&!o||!i&&o)throw new Error("invalid coordinates value");if(i&&i==o)throw new Error("invalid coordinates format");t.toString().includes(",")&&(t=t.replace(",",".")),n.toString().includes(",")&&(n=n.replace(",","."));let p=/S|SOUTH/i;p.test(i)&&t>0&&(t=-1*t),p=/W|WEST/i,p.test(o)&&n>0&&(n=-1*n);const g=a[0].trim();let y,x;const C=/[,/;\u0020]/g,M=g.match(C);if(M==null){const E=Math.floor(r.length/2);y=g.substring(0,E).trim(),x=g.substring(E).trim()}else{let E;M.length%2==1?E=Math.floor(M.length/2):E=M.length/2-1;let P=0;if(E==0)P=g.indexOf(M[0]),y=g.substring(0,P).trim(),x=g.substring(P+1).trim();else{let $=0,U=0;for(;$<=E;)P=g.indexOf(M[$],U),U=P+1,$++;y=g.substring(0,P).trim(),x=g.substring(P+1).trim()}}const F=y.split(".");if(F.length==2&&F[1]==0&&F[1].length!=2)throw new Error("invalid coordinates format");const z=x.split(".");if(z.length==2&&z[1]==0&&z[1].length!=2)throw new Error("invalid coordinates format");if(/^\d+$/.test(y)||/^\d+$/.test(x))throw new Error("degree only coordinate/s provided");return t=Number(Number(t).toFixed(e)),n=Number(Number(n).toFixed(e)),Object.freeze({verbatimCoordinates:g,verbatimLatitude:y,verbatimLongitude:x,decimalLatitude:t,decimalLongitude:n,decimalCoordinates:`${t},${n}`,originalFormat:u,closeEnough:kT,toCoordinateFormat:xT})}else throw new Error("coordinates pattern match failed")}function Hc(r){if(!isNaN(r[0]))return!1;const e=[...r];if(e.shift(),e.length%2>0)return!1;const t=/^[-+]?\d+([\.,]\d+)?$/,n=/[eastsouthnorthwest]+/i,i=e.length/2;for(let o=0;o<i;o++){const u=e[o],a=e[o+i],d=t.test(u)&&t.test(a),p=n.test(u)&&n.test(a),g=u==a;if(!(u==null&&a==null)){if(u==null||a==null)return!1;if(d||p||g)continue;return!1}}return!0}function Y0(r,e){const t=Math.abs(r-e);return Number(t.toFixed(6))<=1e-5}function kT(r){if(!r)throw new Error("coords must be provided");if(r.includes(",")){const e=r.split(",");if(Number(e[0])==NaN||Number(e[1])==NaN)throw new Error("coords are not valid decimals");return Y0(this.decimalLatitude,Number(e[0]))&&Y0(this.decimalLongitude,e[1])}else throw new Error("coords being tested must be separated by a comma")}const ST=Object.freeze({DMS:"DMS",DM:"DM",DD:"DD"});og.to=ST;const TT=[{verbatimCoordinates:"40.123, -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123 N 74.123 W",verbatimLatitude:"40.123 N",verbatimLongitude:"74.123 W"},{verbatimCoordinates:"40.123 N 74.123 W",verbatimLatitude:"40.123 N",verbatimLongitude:"74.123 W"},{verbatimCoordinates:'40 7 22.8" N 74 7 22.8" W',verbatimLatitude:'40 7 22.8" N',verbatimLongitude:'74 7 22.8" W'},{verbatimCoordinates:"40 7.38 , -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"N40722.8, W74722.8",verbatimLatitude:"N40722.8",verbatimLongitude:"W74722.8"},{verbatimCoordinates:'40722.8"N, 74722.8"W',verbatimLatitude:'40722.8"N',verbatimLongitude:'74722.8"W'},{verbatimCoordinates:`407'22.8"N, 747'22.8"W`,verbatimLatitude:`407'22.8"N`,verbatimLongitude:`747'22.8"W`},{verbatimCoordinates:"40 7 22.8, -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"},{verbatimCoordinates:"40.123 -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123,-74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123N74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"4007.38N7407.38W",verbatimLatitude:"4007.38N",verbatimLongitude:"7407.38W"},{verbatimCoordinates:'40722.8"N, 74722.8"W',verbatimLatitude:'40722.8"N',verbatimLongitude:'74722.8"W'},{verbatimCoordinates:"400722.8N740722.8W",verbatimLatitude:"400722.8N",verbatimLongitude:"740722.8W"},{verbatimCoordinates:"N 40 7.38 W 74 7.38",verbatimLatitude:"N 40 7.38",verbatimLongitude:"W 74 7.38"},{verbatimCoordinates:"40:7:22.8N 74:7:22.8W",verbatimLatitude:"40:7:22.8N",verbatimLongitude:"74:7:22.8W"},{verbatimCoordinates:"40:7:23N,74:7:23W",verbatimLatitude:"40:7:23N",verbatimLongitude:"74:7:23W",decimalLatitude:40.1230555555,decimalLongitude:-74.1230555555},{verbatimCoordinates:'40723"N 74723"W',verbatimLatitude:'40723"N',verbatimLongitude:'74723"W',decimalLatitude:40.1230555555,decimalLongitude:-74.12305555555555},{verbatimCoordinates:'40723"S 74723"E',verbatimLatitude:'40723"S',verbatimLongitude:'74723"E',decimalLatitude:-40.1230555555,decimalLongitude:74.12305555555555},{verbatimCoordinates:'40723" -74723"',verbatimLatitude:'40723"',verbatimLongitude:'-74723"',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:'40d 7 23" N 74d 7 23" W',verbatimLatitude:'40d 7 23" N',verbatimLongitude:'74d 7 23" W',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:"40.123N 74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"40 7.38, -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"40 7.38, -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"40 7 22.8; -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"}],CT={decimalLatitude:40.123,decimalLongitude:-74.123},MT=[{verbatimCoordinates:`504'17.698"south, 1424'2.826"east`,verbatimLatitude:`504'17.698"south`,verbatimLongitude:`1424'2.826"east`,decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"50d4m17.698S 14d24m2.826E",verbatimLatitude:"50d4m17.698S",verbatimLongitude:"14d24m2.826E",decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"40:26:46N,79:56:55W",verbatimLatitude:"40:26:46N",verbatimLongitude:"79:56:55W",decimalLatitude:40.44611111111111,decimalLongitude:-79.9486111111111},{verbatimCoordinates:"40:26:46.302N 79:56:55.903W",verbatimLatitude:"40:26:46.302N",verbatimLongitude:"79:56:55.903W",decimalLatitude:40.446195,decimalLongitude:-79.94886194444445},{verbatimCoordinates:"402647N 795836W",verbatimLatitude:"402647N",verbatimLongitude:"795836W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40d 26 47 N 79d 58 36 W",verbatimLatitude:"40d 26 47 N",verbatimLongitude:"79d 58 36 W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40.446195N 79.948862W",verbatimLatitude:"40.446195N",verbatimLongitude:"79.948862W",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40,446195 79,948862",verbatimLatitude:"40,446195",verbatimLongitude:"79,948862",decimalLatitude:40.446195,decimalLongitude:79.948862},{verbatimCoordinates:"40 26.7717, -79 56.93172",verbatimLatitude:"40 26.7717",verbatimLongitude:"-79 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.446195, -79.948862",verbatimLatitude:"40.446195",verbatimLongitude:"-79.948862",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.123256; -74.123256",verbatimLatitude:"40.123256",verbatimLongitude:"-74.123256",decimalLatitude:40.123256,decimalLongitude:-74.123256},{verbatimCoordinates:"1824S 2245E",verbatimLatitude:"1824S",verbatimLongitude:"2245E",decimalLatitude:-18.4,decimalLongitude:22.75}],LT=[{verbatimCoordinates:"10.432342S 10.6345345E",verbatimLatitude:"10.432342S",verbatimLongitude:"10.6345345E",decimalLatitude:-10.432342,decimalLongitude:10.6345345},{verbatimCoordinates:"10.00S 10.00E",verbatimLatitude:"10.00S",verbatimLongitude:"10.00E",decimalLatitude:-10,decimalLongitude:10},{verbatimCoordinates:"00.00S 01.00E",verbatimLatitude:"00.00S",verbatimLongitude:"01.00E",decimalLatitude:0,decimalLongitude:1},{verbatimCoordinates:"18.24S 22.45E",verbatimLatitude:"18.24S",verbatimLongitude:"22.45E",decimalLatitude:-18.4,decimalLongitude:22.75},{verbatimCoordinates:"27deg 15min 45.2sec S 18deg 32min 53.7sec E",verbatimLatitude:"27deg 15min 45.2sec S",verbatimLongitude:"18deg 32min 53.7sec E",decimalLatitude:-27.262555555555554,decimalLongitude:18.54825},{verbatimCoordinates:"-23.3245 S / 28.2344 E",verbatimLatitude:"-23.3245 S",verbatimLongitude:"28.2344 E",decimalLatitude:-23.3245,decimalLongitude:28.2344},{verbatimCoordinates:"40 26.7717 -79 56.93172",verbatimLatitude:"40 26.7717",verbatimLongitude:"-79 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"27.15.45S 18.32.53E",verbatimLatitude:"27.15.45S",verbatimLongitude:"18.32.53E",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"-27.15.45 18.32.53",verbatimLatitude:"-27.15.45",verbatimLongitude:"18.32.53",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"27.15.45.2S 18.32.53.4E",verbatimLatitude:"27.15.45.2S",verbatimLongitude:"18.32.53.4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"27.15.45,2S 18.32.53,4E",verbatimLatitude:"27.15.45,2S",verbatimLongitude:"18.32.53,4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"S23.43563   E22.45634 ",verbatimLatitude:"S23.43563 ",verbatimLongitude:"E22.45634 ",decimalLatitude:-23.43563,decimalLongitude:22.45634},{verbatimCoordinates:"27,71372 S 23,07771 E",verbatimLatitude:"27,71372 S",verbatimLongitude:"23,07771 E",decimalLatitude:-27.71372,decimalLongitude:23.07771},{verbatimCoordinates:"27.45.34 S 23.23.23 E",verbatimLatitude:"27.45.34 S",verbatimLongitude:"23.23.23 E",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"S 27.45.34 E 23.23.23",verbatimLatitude:"S 27.45.34",verbatimLongitude:"E 23.23.23",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"53 16.3863,4 52.8171",verbatimLatitude:"53 16.3863",verbatimLongitude:"4 52.8171",decimalLatitude:53.273105,decimalLongitude:4.88029},{verbatimCoordinates:"50 8.2914,-5 2.4447",verbatimLatitude:"50 8.2914",verbatimLongitude:"-5 2.4447",decimalLatitude:50.13819,decimalLongitude:-5.040745},{verbatimCoordinates:"N 48 30,6410', E 18 57,4583'",verbatimLatitude:"N 48 30,6410'",verbatimLongitude:"E 18 57,4583'",decimalLatitude:48.51068,decimalLongitude:18.95764},{verbatimCoordinates:"1.23456, 18.33453",verbatimLatitude:"1.23456",verbatimLongitude:"18.33453",decimalLatitude:1.23456,decimalLongitude:18.33453}];function ET(){const r=[];return TT.forEach(e=>{e.decimalLatitude?r.push(e):r.push({...e,...CT})}),[...r,...MT,...LT]}const IT=ET();og.formats=IT.map(r=>r.verbatimCoordinates);const AT=og;function Q0(r,e,t){const n=r.slice();return n[84]=e[t],n[86]=t,n}function ey(r){let e,t;return e=new hT({}),{c(){Pa(e.$$.fragment)},m(n,i){Qs(e,n,i),t=!0},i(n){t||(fi(e.$$.fragment,n),t=!0)},o(n){Ti(e.$$.fragment,n),t=!1},d(n){ea(e,n)}}}function ty(r){let e,t,n,i,o;return t=new gT({}),{c(){e=wr("button"),Pa(t.$$.fragment),xt(e,"type","button"),xt(e,"title",r[9]),xt(e,"class","svelte-bz0zu3"),es(e,"active",r[0])},m(u,a){Vr(u,e,a),Qs(t,e,null),n=!0,i||(o=lo(e,"click",r[69]),i=!0)},p(u,a){(!n||a[0]&512)&&xt(e,"title",u[9]),(!n||a[0]&1)&&es(e,"active",u[0])},i(u){n||(fi(t.$$.fragment,u),n=!0)},o(u){Ti(t.$$.fragment,u),n=!1},d(u){u&&Nr(e),ea(t),i=!1,o()}}}function PT(r){let e,t=[],n=new Map,i,o,u,a=q0(r[14]);const d=p=>p[84].id+(p[84].address?","+p[84].address:"");for(let p=0;p<a.length;p+=1){let g=Q0(r,a,p),y=d(g);n.set(y,t[p]=ny(y,g))}return{c(){e=wr("ul");for(let p=0;p<t.length;p+=1)t[p].c();xt(e,"class","options svelte-bz0zu3")},m(p,g){Vr(p,e,g);for(let y=0;y<t.length;y+=1)t[y]&&t[y].m(e,null);i=!0,o||(u=[lo(e,"mouseleave",r[73]),lo(e,"blur",r[74])],o=!0)},p(p,g){g[0]&17880064&&(a=q0(p[14]),id(),t=W5(t,g,d,1,p,a,n,e,H5,ny,null,Q0),od())},i(p){if(!i){for(let g=0;g<a.length;g+=1)fi(t[g]);i=!0}},o(p){for(let g=0;g<t.length;g+=1)Ti(t[g]);i=!1},d(p){p&&Nr(e);for(let g=0;g<t.length;g+=1)t[g].d();o=!1,na(u)}}}function zT(r){let e,t,n,i,o,u;return t=new Nv({}),{c(){e=wr("div"),Pa(t.$$.fragment),n=Fo(),i=wr("div"),o=Aa(r[7]),xt(i,"class","svelte-bz0zu3"),xt(e,"class","no-results svelte-bz0zu3")},m(a,d){Vr(a,e,d),Qs(t,e,null),Jn(e,n),Jn(e,i),Jn(i,o),u=!0},p(a,d){(!u||d[0]&128)&&bh(o,a[7])},i(a){u||(fi(t.$$.fragment,a),u=!0)},o(a){Ti(t.$$.fragment,a),u=!1},d(a){a&&Nr(e),ea(t)}}}function DT(r){let e="",t;return{c(){t=Aa(e)},m(n,i){Vr(n,t,i)},p:Or,i:Or,o:Or,d(n){n&&Nr(t)}}}function RT(r){let e,t,n,i,o,u,a,d,p,g,y;return t=new Nv({}),d=new Ov({}),{c(){e=wr("div"),Pa(t.$$.fragment),n=Fo(),i=wr("div"),o=Aa(r[6]),u=Fo(),a=wr("button"),Pa(d.$$.fragment),xt(i,"class","svelte-bz0zu3"),xt(a,"class","svelte-bz0zu3"),xt(e,"class","error svelte-bz0zu3")},m(x,C){Vr(x,e,C),Qs(t,e,null),Jn(e,n),Jn(e,i),Jn(i,o),Jn(e,u),Jn(e,a),Qs(d,a,null),p=!0,g||(y=lo(a,"click",r[70]),g=!0)},p(x,C){(!p||C[0]&64)&&bh(o,x[6])},i(x){p||(fi(t.$$.fragment,x),fi(d.$$.fragment,x),p=!0)},o(x){Ti(t.$$.fragment,x),Ti(d.$$.fragment,x),p=!1},d(x){x&&Nr(e),ea(t),ea(d),g=!1,y()}}}function ny(r,e){let t,n,i;function o(){return e[71](e[86])}function u(){return e[72](e[84])}return n=new uT({props:{feature:e[84],showPlaceType:e[10],selected:e[15]===e[86],missingIconsCache:e[20],iconsBaseUrl:e[12]}}),n.$on("mouseenter",o),n.$on("focus",u),{key:r,first:null,c(){t=B5(),Pa(n.$$.fragment),this.first=t},m(a,d){Vr(a,t,d),Qs(n,a,d),i=!0},p(a,d){e=a;const p={};d[0]&16384&&(p.feature=e[84]),d[0]&1024&&(p.showPlaceType=e[10]),d[0]&49152&&(p.selected=e[15]===e[86]),d[0]&4096&&(p.iconsBaseUrl=e[12]),n.$set(p)},i(a){i||(fi(n.$$.fragment,a),i=!0)},o(a){Ti(n.$$.fragment,a),i=!1},d(a){a&&Nr(t),ea(n,a)}}}function FT(r){let e,t,n,i,o,u,a,d,p,g,y,x,C,M,F,z,E,P,$,U,K,ee=!1;o=new yT({}),y=new Ov({});let W=r[19]&&ey(),J=r[5]==="button"&&ty(r);const he=r[61].default,Ae=z5(he,r,r[60],null),ne=[RT,DT,zT,PT],fe=[];function Ce(_e,Ze){var Oe,je;return _e[18]?0:_e[16]?((Oe=_e[14])==null?void 0:Oe.length)===0?2:_e[16]&&(je=_e[14])!=null&&je.length?3:-1:1}return~(z=Ce(r))&&(E=fe[z]=ne[z](r)),{c(){e=Fo(),t=wr("form"),n=wr("div"),i=wr("button"),Pa(o.$$.fragment),u=Fo(),a=wr("input"),d=Fo(),p=wr("div"),g=wr("button"),Pa(y.$$.fragment),x=Fo(),W&&W.c(),C=Fo(),J&&J.c(),M=Fo(),Ae&&Ae.c(),F=Fo(),E&&E.c(),xt(i,"class","search-button svelte-bz0zu3"),xt(i,"type","button"),xt(a,"placeholder",r[8]),xt(a,"aria-label",r[8]),xt(a,"class","svelte-bz0zu3"),xt(g,"type","button"),xt(g,"title",r[3]),xt(g,"class","svelte-bz0zu3"),xt(p,"class","clear-button-container svelte-bz0zu3"),es(p,"displayable",r[1]!==""),xt(n,"class","input-group svelte-bz0zu3"),xt(t,"tabindex","0"),xt(t,"class",P=N0(r[2])+" svelte-bz0zu3"),es(t,"can-collapse",r[4]&&r[1]==="")},m(_e,Ze){Vr(_e,e,Ze),Vr(_e,t,Ze),Jn(t,n),Jn(n,i),Qs(o,i,null),Jn(n,u),Jn(n,a),r[63](a),j0(a,r[1]),Jn(n,d),Jn(n,p),Jn(p,g),Qs(y,g,null),Jn(p,x),W&&W.m(p,null),Jn(n,C),J&&J.m(n,null),Jn(n,M),Ae&&Ae.m(n,null),Jn(t,F),~z&&fe[z].m(t,null),$=!0,U||(K=[lo(i,"click",r[62]),lo(a,"input",r[64]),lo(a,"focus",r[65]),lo(a,"blur",r[66]),lo(a,"keydown",r[22]),lo(a,"input",r[67]),lo(g,"click",r[68]),lo(t,"submit",$5(r[21]))],U=!0)},p(_e,Ze){(!$||Ze[0]&256)&&xt(a,"placeholder",_e[8]),(!$||Ze[0]&256)&&xt(a,"aria-label",_e[8]),Ze[0]&2&&a.value!==_e[1]&&j0(a,_e[1]),(!$||Ze[0]&8)&&xt(g,"title",_e[3]),_e[19]?W?Ze[0]&524288&&fi(W,1):(W=ey(),W.c(),fi(W,1),W.m(p,null)):W&&(id(),Ti(W,1,1,()=>{W=null}),od()),(!$||Ze[0]&2)&&es(p,"displayable",_e[1]!==""),_e[5]==="button"?J?(J.p(_e,Ze),Ze[0]&32&&fi(J,1)):(J=ty(_e),J.c(),fi(J,1),J.m(n,M)):J&&(id(),Ti(J,1,1,()=>{J=null}),od()),Ae&&Ae.p&&(!$||Ze[1]&536870912)&&R5(Ae,he,_e,_e[60],$?D5(he,_e[60],Ze,null):F5(_e[60]),null);let Oe=z;z=Ce(_e),z===Oe?~z&&fe[z].p(_e,Ze):(E&&(id(),Ti(fe[Oe],1,1,()=>{fe[Oe]=null}),od()),~z?(E=fe[z],E?E.p(_e,Ze):(E=fe[z]=ne[z](_e),E.c()),fi(E,1),E.m(t,null)):E=null),(!$||Ze[0]&4&&P!==(P=N0(_e[2])+" svelte-bz0zu3"))&&xt(t,"class",P),(!$||Ze[0]&22)&&es(t,"can-collapse",_e[4]&&_e[1]==="")},i(_e){$||(fi(ee),fi(o.$$.fragment,_e),fi(y.$$.fragment,_e),fi(W),fi(J),fi(Ae,_e),fi(E),$=!0)},o(_e){Ti(ee),Ti(o.$$.fragment,_e),Ti(y.$$.fragment,_e),Ti(W),Ti(J),Ti(Ae,_e),Ti(E),$=!1},d(_e){_e&&(Nr(e),Nr(t)),ea(o),r[63](null),ea(y),W&&W.d(),J&&J.d(),Ae&&Ae.d(_e),~z&&fe[z].d(),U=!1,na(K)}}}function BT(r,e,t){let n,i,{$$slots:o={},$$scope:u}=e;const a={continental_marine:4,country:4,major_landform:8,region:5,subregion:6,county:7,joint_municipality:8,joint_submunicipality:9,municipality:10,municipal_district:11,locality:12,neighbourhood:13,place:14,postal_code:14,road:16,poi:17,address:18,"poi.peak":15,"poi.shop":18,"poi.cafe":18,"poi.restaurant":18,"poi.aerodrome":13};let{class:d=void 0}=e,{apiKey:p}=e,{bbox:g=void 0}=e,{clearButtonTitle:y="clear"}=e,{clearOnBlur:x=!1}=e,{collapsed:C=!1}=e,{country:M=void 0}=e,{debounceSearch:F=200}=e,{enableReverse:z="never"}=e,{errorMessage:E="Something went wrong"}=e,{filter:P=()=>!0}=e,{flyTo:$=!0}=e,{fuzzyMatch:U=!0}=e,{language:K=void 0}=e,{limit:ee=void 0}=e,{mapController:W=void 0}=e,{minLength:J=2}=e,{noResultsMessage:he="Oops! Looks like you're trying to predict something that's not quite right. We can't seem to find what you're looking for. Maybe try double-checking your spelling or try a different search term. Keep on typing - we'll do our best to get you where you need to go!"}=e,{placeholder:Ae="Search"}=e,{proximity:ne=[{type:"server-geolocation"}]}=e,{reverseActive:fe=z==="always"}=e,{reverseButtonTitle:Ce="toggle reverse geocoding"}=e,{searchValue:_e=""}=e,{pickedResultStyle:Ze="full-geometry"}=e,{showPlaceType:Oe="if-needed"}=e,{showResultsWhileTyping:je=!0}=e,{selectFirst:De=!0}=e,{flyToSelected:At=!1}=e,{markerOnSelected:ut=!0}=e,{types:ht=void 0}=e,{exhaustiveReverseGeocoding:wt=!1}=e,{excludeTypes:pt=!1}=e,{zoom:Qe=a}=e,{apiUrl:Ft="https://api.maptiler.com/geocoding"}=e,{fetchParameters:bt={}}=e,{iconsBaseUrl:Bt="https://cdn.maptiler.com/maptiler-geocoding-control/v2.0.1/icons/"}=e,{adjustUrlQuery:Pt=()=>{}}=e;function Qt(){Ue.focus()}function vn(){Ue.blur()}function qt(Q,We=!0,Xe=!1){t(1,_e=Q),We?(t(15,it=-1),vt()):(on(!Xe,Xe),setTimeout(()=>{Ue.focus(),Ue.select()}))}function rn(){t(14,Je=void 0),t(56,ye=void 0),t(15,it=-1)}function Ge(){t(55,Et=[]),t(56,ye=void 0)}let qe=!1,Je,Et,ye,kn="",Ue,it=-1,Wt,cr=[],_r,yr,ni,jr;const xo=new Set,hr=U5();j5(()=>{W&&(W.setEventHandler(void 0),W.indicateReverse(!1),W.setSelectedMarker(-1),W.setFeatures(void 0,void 0,!1))});function vt(Q){if(yr&&(clearTimeout(yr),yr=void 0),it>-1&&Je)t(56,ye=Je[it]),t(1,_e=ye.place_type[0]==="reverse"?ye.place_name:ye.place_name.replace(/,.*/,"")),t(18,Wt=void 0),t(55,Et=void 0),t(15,it=-1);else if(_e){const We=Q||!Pr(_e);Mr(_e,{exact:!0}).then(()=>{t(55,Et=Je),t(56,ye=void 0),We&&zr()}).catch(Xe=>t(18,Wt=Xe))}}function Pr(Q){try{return AT(Q,6)}catch{return!1}}async function Mr(Q,{byId:We=!1,exact:Xe=!1}={}){t(18,Wt=void 0),_r==null||_r.abort();const tt=new AbortController;t(19,_r=tt);try{const lt=Pr(Q),Lt=new URLSearchParams;if(K!==void 0&&Lt.set("language",Array.isArray(K)?K.join(","):K??""),ht&&Lt.set("types",ht.join(",")),pt&&Lt.set("excludeTypes",String(pt)),g&&Lt.set("bbox",g.map(Fn=>Fn.toFixed(6)).join(",")),M&&Lt.set("country",Array.isArray(M)?M.join(","):M),!We&&!lt){const Fn=await vT(W,ne,tt);Fn&&Lt.set("proximity",Fn),(Xe||!je)&&Lt.set("autocomplete","false"),Lt.set("fuzzyMatch",String(U))}ee!==void 0&&(wt||!lt||(ht==null?void 0:ht.length)===1)&&Lt.set("limit",String(ee)),Lt.set("key",p),Pt(Lt);const Jt=Ft+"/"+encodeURIComponent(lt?lt.decimalLongitude+","+lt.decimalLatitude:Q)+".json?"+Lt.toString();if(Jt===kn){We?(t(14,Je=void 0),t(56,ye=cr[0])):t(14,Je=cr);return}kn=Jt;const cn=await fetch(Jt,{signal:tt.signal,...bt});if(!cn.ok)throw new Error(await cn.text());const Sn=await cn.json();hr("response",{url:Jt,featureCollection:Sn}),We?(t(14,Je=void 0),t(56,ye=Sn.features[0]),cr=[ye]):(t(14,Je=Sn.features.filter(P)),lt&&Je.unshift({type:"Feature",properties:{},id:"reverse_"+lt.decimalLongitude+"_"+lt.decimalLatitude,text:lt.decimalLatitude+", "+lt.decimalLongitude,place_name:lt.decimalLatitude+", "+lt.decimalLongitude,place_type:["reverse"],center:[lt.decimalLongitude,lt.decimalLatitude],bbox:[lt.decimalLongitude,lt.decimalLatitude,lt.decimalLongitude,lt.decimalLatitude],geometry:{type:"Point",coordinates:[lt.decimalLongitude,lt.decimalLatitude]}}),cr=Je,lt&&Ue.focus())}catch(lt){if(lt&&typeof lt=="object"&&"name"in lt&&lt.name==="AbortError")return;throw lt}finally{tt===_r&&t(19,_r=void 0)}}function zr(){var Q;if(!(Et!=null&&Et.length)||!$)return;const We=[180,90,-180,-90],Xe=!Et.some(lt=>!lt.matching_text);let tt;for(const lt of Et){const Lt=qn(lt);if(tt=tt===void 0?Lt:Lt===void 0?tt:Math.max(tt,Lt),Xe||!lt.matching_text)for(const Jt of[0,1,2,3])We[Jt]=Math[Jt<2?"min":"max"](We[Jt],((Q=lt.bbox)==null?void 0:Q[Jt])??lt.center[Jt%2])}W&&Et.length>0&&(ye&&We[0]===We[2]&&We[1]===We[3]?W.flyTo(ye.center,qn(ye)):W.fitBounds(_d(We),50,tt))}function qn(Q){var We;if(!Q.bbox||Q.bbox[0]!==Q.bbox[2]&&Q.bbox[1]!==Q.bbox[3])return;const Xe=Q.id.replace(/\..*/,"");return(Array.isArray((We=Q.properties)==null?void 0:We.categories)?Q.properties.categories.reduce((tt,lt)=>{const Lt=Qe[Xe+"."+lt];return tt===void 0?Lt:Lt===void 0?tt:Math.max(tt,Lt)},void 0):void 0)??Qe[Xe]}function It(Q){t(0,fe=z==="always"),t(14,Je=void 0),t(56,ye=void 0),t(15,it=-1),qt(Q[1].toFixed(6)+", "+bT(Q[0],[-180,180],!0).toFixed(6),!1,!0)}function fn(Q){if(!Je)return;let We=Q.key==="ArrowDown"?1:Q.key==="ArrowUp"?-1:0;We&&(it===(De?0:-1)&&We===-1&&t(15,it=Je.length),t(15,it+=We),it>=Je.length&&t(15,it=-1),it<0&&De&&t(15,it=0),Q.preventDefault())}function on(Q=!0,We=!1){if(t(18,Wt=void 0),je||We){if(yr&&clearTimeout(yr),_e.length<J)return;const Xe=_e;yr=window.setTimeout(()=>{Mr(Xe).catch(tt=>t(18,Wt=tt))},Q?F:0)}else t(14,Je=void 0),t(18,Wt=void 0)}function Qn(Q){t(56,ye=Q),t(1,_e=Q.place_name),t(15,it=-1)}const pi=()=>Ue.focus();function pn(Q){vm[Q?"unshift":"push"](()=>{Ue=Q,t(17,Ue)})}function Di(){_e=this.value,t(1,_e),t(13,qe),t(28,x)}const er=()=>t(13,qe=!0),we=()=>t(13,qe=!1),re=()=>on(),se=()=>{t(1,_e=""),Ue.focus()},pe=()=>t(0,fe=!fe),xe=()=>t(18,Wt=void 0),Fe=Q=>t(15,it=Q),Be=Q=>Qn(Q),$e=()=>{De||t(15,it=-1)},Se=()=>{};return r.$$set=Q=>{"class"in Q&&t(2,d=Q.class),"apiKey"in Q&&t(26,p=Q.apiKey),"bbox"in Q&&t(27,g=Q.bbox),"clearButtonTitle"in Q&&t(3,y=Q.clearButtonTitle),"clearOnBlur"in Q&&t(28,x=Q.clearOnBlur),"collapsed"in Q&&t(4,C=Q.collapsed),"country"in Q&&t(29,M=Q.country),"debounceSearch"in Q&&t(30,F=Q.debounceSearch),"enableReverse"in Q&&t(5,z=Q.enableReverse),"errorMessage"in Q&&t(6,E=Q.errorMessage),"filter"in Q&&t(31,P=Q.filter),"flyTo"in Q&&t(32,$=Q.flyTo),"fuzzyMatch"in Q&&t(33,U=Q.fuzzyMatch),"language"in Q&&t(34,K=Q.language),"limit"in Q&&t(35,ee=Q.limit),"mapController"in Q&&t(36,W=Q.mapController),"minLength"in Q&&t(37,J=Q.minLength),"noResultsMessage"in Q&&t(7,he=Q.noResultsMessage),"placeholder"in Q&&t(8,Ae=Q.placeholder),"proximity"in Q&&t(38,ne=Q.proximity),"reverseActive"in Q&&t(0,fe=Q.reverseActive),"reverseButtonTitle"in Q&&t(9,Ce=Q.reverseButtonTitle),"searchValue"in Q&&t(1,_e=Q.searchValue),"pickedResultStyle"in Q&&t(39,Ze=Q.pickedResultStyle),"showPlaceType"in Q&&t(10,Oe=Q.showPlaceType),"showResultsWhileTyping"in Q&&t(40,je=Q.showResultsWhileTyping),"selectFirst"in Q&&t(11,De=Q.selectFirst),"flyToSelected"in Q&&t(41,At=Q.flyToSelected),"markerOnSelected"in Q&&t(42,ut=Q.markerOnSelected),"types"in Q&&t(43,ht=Q.types),"exhaustiveReverseGeocoding"in Q&&t(44,wt=Q.exhaustiveReverseGeocoding),"excludeTypes"in Q&&t(45,pt=Q.excludeTypes),"zoom"in Q&&t(46,Qe=Q.zoom),"apiUrl"in Q&&t(47,Ft=Q.apiUrl),"fetchParameters"in Q&&t(48,bt=Q.fetchParameters),"iconsBaseUrl"in Q&&t(12,Bt=Q.iconsBaseUrl),"adjustUrlQuery"in Q&&t(49,Pt=Q.adjustUrlQuery),"$$scope"in Q&&t(60,u=Q.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&32&&t(0,fe=z==="always"),r.$$.dirty[0]&268443648&&setTimeout(()=>{t(16,ni=qe),x&&!qe&&t(1,_e="")}),r.$$.dirty[0]&16386|r.$$.dirty[1]&64&&_e.length<J&&(t(56,ye=void 0),t(14,Je=void 0),t(18,Wt=void 0),t(55,Et=Je)),r.$$.dirty[1]&33554688&&Ze!=="marker-only"&&ye&&!ye.address&&ye.geometry.type==="Point"&&ye.place_type[0]!=="reverse"&&Mr(ye.id,{byId:!0}).catch(Q=>t(18,Wt=Q)),r.$$.dirty[1]&100663330&&(W&&ye&&ye.id!==jr&&$&&(!ye.bbox||ye.bbox[0]===ye.bbox[2]&&ye.bbox[1]===ye.bbox[3]?W.flyTo(ye.center,qn(ye)):W.fitBounds(_d(ye.bbox),50,qn(ye)),t(14,Je=void 0),t(55,Et=void 0),t(15,it=-1)),t(57,jr=ye==null?void 0:ye.id)),r.$$.dirty[0]&18432&&De&&Je!=null&&Je.length&&t(15,it=0),r.$$.dirty[0]&2&&t(15,it=-1),r.$$.dirty[0]&16384|r.$$.dirty[1]&16777216&&Et!==Je&&t(55,Et=void 0),r.$$.dirty[0]&81921|r.$$.dirty[1]&16777248&&W&&W.setEventHandler(Q=>{switch(Q.type){case"mapClick":fe&&It(Q.coordinates);break;case"markerClick":{const We=Je==null?void 0:Je.find(Xe=>Xe.id===Q.id);We&&Qn(We)}break;case"markerMouseEnter":Et&&t(15,it=ni?(Je==null?void 0:Je.findIndex(We=>We.id===Q.id))??-1:-1);break;case"markerMouseLeave":Et&&t(15,it=-1);break}}),r.$$.dirty[0]&49152&&t(58,i=Je==null?void 0:Je[it]),r.$$.dirty[1]&134218786&&W&&i&&$&&At&&W.flyTo(i.center,qn(i)),r.$$.dirty[1]&256&&t(59,n=Ze==="full-geometry-including-polygon-center-marker"),r.$$.dirty[1]&268437536&&(ut||W==null||W.setFeatures(void 0,void 0,n)),r.$$.dirty[1]&419432480&&W&&ut&&!Et&&(W.setFeatures(i?[i]:void 0,void 0,n),W.setSelectedMarker(i?0:-1)),r.$$.dirty[1]&318767136&&W&&W.setFeatures(Et,ye,n),r.$$.dirty[0]&32768|r.$$.dirty[1]&16777248&&Et&&W&&W.setSelectedMarker(it),r.$$.dirty[0]&2|r.$$.dirty[1]&32&&W){const Q=Pr(_e);W.setReverseMarker(Q?[Q.decimalLongitude,Q.decimalLatitude]:void 0)}r.$$.dirty[1]&134217728&&hr("select",{feature:i}),r.$$.dirty[1]&33554432&&hr("pick",{feature:ye}),r.$$.dirty[0]&81920&&hr("optionsvisibilitychange",{optionsVisible:ni&&!!Je}),r.$$.dirty[0]&16384&&hr("featureslisted",{features:Je}),r.$$.dirty[1]&16777216&&hr("featuresmarked",{features:Et}),r.$$.dirty[0]&1&&hr("reversetoggle",{reverse:fe}),r.$$.dirty[0]&2&&hr("querychange",{query:_e}),r.$$.dirty[0]&1|r.$$.dirty[1]&32&&W&&W.indicateReverse(fe)},[fe,_e,d,y,C,z,E,he,Ae,Ce,Oe,De,Bt,qe,Je,it,ni,Ue,Wt,_r,xo,vt,fn,on,Qn,a,p,g,x,M,F,P,$,U,K,ee,W,J,ne,Ze,je,At,ut,ht,wt,pt,Qe,Ft,bt,Pt,Qt,vn,qt,rn,Ge,Et,ye,jr,i,n,u,o,pi,pn,Di,er,we,re,se,pe,xe,Fe,Be,$e,Se]}let $T=class extends Ba{constructor(r){super(),Fa(this,r,BT,FT,Ra,{ZOOM_DEFAULTS:25,class:2,apiKey:26,bbox:27,clearButtonTitle:3,clearOnBlur:28,collapsed:4,country:29,debounceSearch:30,enableReverse:5,errorMessage:6,filter:31,flyTo:32,fuzzyMatch:33,language:34,limit:35,mapController:36,minLength:37,noResultsMessage:7,placeholder:8,proximity:38,reverseActive:0,reverseButtonTitle:9,searchValue:1,pickedResultStyle:39,showPlaceType:10,showResultsWhileTyping:40,selectFirst:11,flyToSelected:41,markerOnSelected:42,types:43,exhaustiveReverseGeocoding:44,excludeTypes:45,zoom:46,apiUrl:47,fetchParameters:48,iconsBaseUrl:12,adjustUrlQuery:49,focus:50,blur:51,setQuery:52,clearList:53,clearMap:54},null,[-1,-1,-1])}get ZOOM_DEFAULTS(){return this.$$.ctx[25]}get focus(){return this.$$.ctx[50]}get blur(){return this.$$.ctx[51]}get setQuery(){return this.$$.ctx[52]}get clearList(){return this.$$.ctx[53]}get clearMap(){return this.$$.ctx[54]}};function wh(r,e,t={}){const n={type:"Feature"};return(t.id===0||t.id)&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.properties=e||{},n.geometry=r,n}function sg(r,e,t={}){for(const n of r){if(n.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(n[n.length-1].length!==n[0].length)throw new Error("First and last Position are not equivalent.");for(let i=0;i<n[n.length-1].length;i++)if(n[n.length-1][i]!==n[0][i])throw new Error("First and last Position are not equivalent.")}return wh({type:"Polygon",coordinates:r},e,t)}function xh(r,e={}){const t={type:"FeatureCollection"};return e.id&&(t.id=e.id),e.bbox&&(t.bbox=e.bbox),t.features=r,t}function jv(r,e,t={}){return wh({type:"MultiPolygon",coordinates:r},e,t)}/**
 * splaytree v3.1.2
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function OT(r,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,u;return u={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function a(p){return function(g){return d([p,g])}}function d(p){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(o=p[0]&2?i.return:p[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,p[1])).done)return o;switch(i=0,o&&(p=[p[0]&2,o.value]),p[0]){case 0:case 1:o=p;break;case 4:return t.label++,{value:p[1],done:!1};case 5:t.label++,i=p[1],p=[0];continue;case 7:p=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(p[0]===6||p[0]===2)){t=0;continue}if(p[0]===3&&(!o||p[1]>o[0]&&p[1]<o[3])){t.label=p[1];break}if(p[0]===6&&t.label<o[1]){t.label=o[1],o=p;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(p);break}o[2]&&t.ops.pop(),t.trys.pop();continue}p=e.call(r,t)}catch(g){p=[6,g],i=0}finally{n=o=0}if(p[0]&5)throw p[1];return{value:p[0]?p[1]:void 0,done:!0}}}var za=function(){function r(e,t){this.next=null,this.key=e,this.data=t,this.left=null,this.right=null}return r}();function NT(r,e){return r>e?1:r<e?-1:0}function ka(r,e,t){for(var n=new za(null,null),i=n,o=n;;){var u=t(r,e.key);if(u<0){if(e.left===null)break;if(t(r,e.left.key)<0){var a=e.left;if(e.left=a.right,a.right=e,e=a,e.left===null)break}o.left=e,o=e,e=e.left}else if(u>0){if(e.right===null)break;if(t(r,e.right.key)>0){var a=e.right;if(e.right=a.left,a.left=e,e=a,e.right===null)break}i.right=e,i=e,e=e.right}else break}return i.right=e.left,o.left=e.right,e.left=n.right,e.right=n.left,e}function Yp(r,e,t,n){var i=new za(r,e);if(t===null)return i.left=i.right=null,i;t=ka(r,t,n);var o=n(r,t.key);return o<0?(i.left=t.left,i.right=t,t.left=null):o>=0&&(i.right=t.right,i.left=t,t.right=null),i}function ry(r,e,t){var n=null,i=null;if(e){e=ka(r,e,t);var o=t(e.key,r);o===0?(n=e.left,i=e.right):o<0?(i=e.right,e.right=null,n=e):(n=e.left,e.left=null,i=e)}return{left:n,right:i}}function jT(r,e,t){return e===null?r:(r===null||(e=ka(r.key,e,t),e.left=r),e)}function km(r,e,t,n,i){if(r){n(""+e+(t?" ":" ")+i(r)+`
`);var o=e+(t?"    ":"   ");r.left&&km(r.left,o,!1,n,i),r.right&&km(r.right,o,!0,n,i)}}var ag=function(){function r(e){e===void 0&&(e=NT),this._root=null,this._size=0,this._comparator=e}return r.prototype.insert=function(e,t){return this._size++,this._root=Yp(e,t,this._root,this._comparator)},r.prototype.add=function(e,t){var n=new za(e,t);this._root===null&&(n.left=n.right=null,this._size++,this._root=n);var i=this._comparator,o=ka(e,this._root,i),u=i(e,o.key);return u===0?this._root=o:(u<0?(n.left=o.left,n.right=o,o.left=null):u>0&&(n.right=o.right,n.left=o,o.right=null),this._size++,this._root=n),this._root},r.prototype.remove=function(e){this._root=this._remove(e,this._root,this._comparator)},r.prototype._remove=function(e,t,n){var i;if(t===null)return null;t=ka(e,t,n);var o=n(e,t.key);return o===0?(t.left===null?i=t.right:(i=ka(e,t.left,n),i.right=t.right),this._size--,i):t},r.prototype.pop=function(){var e=this._root;if(e){for(;e.left;)e=e.left;return this._root=ka(e.key,this._root,this._comparator),this._root=this._remove(e.key,this._root,this._comparator),{key:e.key,data:e.data}}return null},r.prototype.findStatic=function(e){for(var t=this._root,n=this._comparator;t;){var i=n(e,t.key);if(i===0)return t;i<0?t=t.left:t=t.right}return null},r.prototype.find=function(e){return this._root&&(this._root=ka(e,this._root,this._comparator),this._comparator(e,this._root.key)!==0)?null:this._root},r.prototype.contains=function(e){for(var t=this._root,n=this._comparator;t;){var i=n(e,t.key);if(i===0)return!0;i<0?t=t.left:t=t.right}return!1},r.prototype.forEach=function(e,t){for(var n=this._root,i=[],o=!1;!o;)n!==null?(i.push(n),n=n.left):i.length!==0?(n=i.pop(),e.call(t,n),n=n.right):o=!0;return this},r.prototype.range=function(e,t,n,i){for(var o=[],u=this._comparator,a=this._root,d;o.length!==0||a;)if(a)o.push(a),a=a.left;else{if(a=o.pop(),d=u(a.key,t),d>0)break;if(u(a.key,e)>=0&&n.call(i,a))return this;a=a.right}return this},r.prototype.keys=function(){var e=[];return this.forEach(function(t){var n=t.key;return e.push(n)}),e},r.prototype.values=function(){var e=[];return this.forEach(function(t){var n=t.data;return e.push(n)}),e},r.prototype.min=function(){return this._root?this.minNode(this._root).key:null},r.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},r.prototype.minNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.left;)e=e.left;return e},r.prototype.maxNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.right;)e=e.right;return e},r.prototype.at=function(e){for(var t=this._root,n=!1,i=0,o=[];!n;)if(t)o.push(t),t=t.left;else if(o.length>0){if(t=o.pop(),i===e)return t;i++,t=t.right}else n=!0;return null},r.prototype.next=function(e){var t=this._root,n=null;if(e.right){for(n=e.right;n.left;)n=n.left;return n}for(var i=this._comparator;t;){var o=i(e.key,t.key);if(o===0)break;o<0?(n=t,t=t.left):t=t.right}return n},r.prototype.prev=function(e){var t=this._root,n=null;if(e.left!==null){for(n=e.left;n.right;)n=n.right;return n}for(var i=this._comparator;t;){var o=i(e.key,t.key);if(o===0)break;o<0?t=t.left:(n=t,t=t.right)}return n},r.prototype.clear=function(){return this._root=null,this._size=0,this},r.prototype.toList=function(){return VT(this._root)},r.prototype.load=function(e,t,n){t===void 0&&(t=[]),n===void 0&&(n=!1);var i=e.length,o=this._comparator;if(n&&Cm(e,t,0,i-1,o),this._root===null)this._root=Sm(e,t,0,i),this._size=i;else{var u=qT(this.toList(),UT(e,t),o);i=this._size+i,this._root=Tm({head:u},0,i)}return this},r.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(r.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),r.prototype.toString=function(e){e===void 0&&(e=function(n){return String(n.key)});var t=[];return km(this._root,"",!0,function(n){return t.push(n)},e),t.join("")},r.prototype.update=function(e,t,n){var i=this._comparator,o=ry(e,this._root,i),u=o.left,a=o.right;i(e,t)<0?a=Yp(t,n,a,i):u=Yp(t,n,u,i),this._root=jT(u,a,i)},r.prototype.split=function(e){return ry(e,this._root,this._comparator)},r.prototype[Symbol.iterator]=function(){var e,t,n;return OT(this,function(i){switch(i.label){case 0:e=this._root,t=[],n=!1,i.label=1;case 1:return n?[3,6]:e===null?[3,2]:(t.push(e),e=e.left,[3,5]);case 2:return t.length===0?[3,4]:(e=t.pop(),[4,e]);case 3:return i.sent(),e=e.right,[3,5];case 4:n=!0,i.label=5;case 5:return[3,1];case 6:return[2]}})},r}();function Sm(r,e,t,n){var i=n-t;if(i>0){var o=t+Math.floor(i/2),u=r[o],a=e[o],d=new za(u,a);return d.left=Sm(r,e,t,o),d.right=Sm(r,e,o+1,n),d}return null}function UT(r,e){for(var t=new za(null,null),n=t,i=0;i<r.length;i++)n=n.next=new za(r[i],e[i]);return n.next=null,t.next}function VT(r){for(var e=r,t=[],n=!1,i=new za(null,null),o=i;!n;)e?(t.push(e),e=e.left):t.length>0?(e=o=o.next=t.pop(),e=e.right):n=!0;return o.next=null,i.next}function Tm(r,e,t){var n=t-e;if(n>0){var i=e+Math.floor(n/2),o=Tm(r,e,i),u=r.head;return u.left=o,r.head=r.head.next,u.right=Tm(r,i+1,t),u}return null}function qT(r,e,t){for(var n=new za(null,null),i=n,o=r,u=e;o!==null&&u!==null;)t(o.key,u.key)<0?(i.next=o,o=o.next):(i.next=u,u=u.next),i=i.next;return o!==null?i.next=o:u!==null&&(i.next=u),n.next}function Cm(r,e,t,n,i){if(!(t>=n)){for(var o=r[t+n>>1],u=t-1,a=n+1;;){do u++;while(i(r[u],o)<0);do a--;while(i(r[a],o)>0);if(u>=a)break;var d=r[u];r[u]=r[a],r[a]=d,d=e[u],e[u]=e[a],e[a]=d}Cm(r,e,t,a,i),Cm(r,e,a+1,n,i)}}const Js=11102230246251565e-32,qi=134217729,ZT=(3+8*Js)*Js;function Qp(r,e,t,n,i){let o,u,a,d,p=e[0],g=n[0],y=0,x=0;g>p==g>-p?(o=p,p=e[++y]):(o=g,g=n[++x]);let C=0;if(y<r&&x<t)for(g>p==g>-p?(u=p+o,a=o-(u-p),p=e[++y]):(u=g+o,a=o-(u-g),g=n[++x]),o=u,a!==0&&(i[C++]=a);y<r&&x<t;)g>p==g>-p?(u=o+p,d=u-o,a=o-(u-d)+(p-d),p=e[++y]):(u=o+g,d=u-o,a=o-(u-d)+(g-d),g=n[++x]),o=u,a!==0&&(i[C++]=a);for(;y<r;)u=o+p,d=u-o,a=o-(u-d)+(p-d),p=e[++y],o=u,a!==0&&(i[C++]=a);for(;x<t;)u=o+g,d=u-o,a=o-(u-d)+(g-d),g=n[++x],o=u,a!==0&&(i[C++]=a);return(o!==0||C===0)&&(i[C++]=o),C}function GT(r,e){let t=e[0];for(let n=1;n<r;n++)t+=e[n];return t}function Ph(r){return new Float64Array(r)}const HT=(3+16*Js)*Js,WT=(2+12*Js)*Js,KT=(9+64*Js)*Js*Js,Mu=Ph(4),iy=Ph(8),oy=Ph(12),sy=Ph(16),ao=Ph(4);function XT(r,e,t,n,i,o,u){let a,d,p,g,y,x,C,M,F,z,E,P,$,U,K,ee,W,J;const he=r-i,Ae=t-i,ne=e-o,fe=n-o;U=he*fe,x=qi*he,C=x-(x-he),M=he-C,x=qi*fe,F=x-(x-fe),z=fe-F,K=M*z-(U-C*F-M*F-C*z),ee=ne*Ae,x=qi*ne,C=x-(x-ne),M=ne-C,x=qi*Ae,F=x-(x-Ae),z=Ae-F,W=M*z-(ee-C*F-M*F-C*z),E=K-W,y=K-E,Mu[0]=K-(E+y)+(y-W),P=U+E,y=P-U,$=U-(P-y)+(E-y),E=$-ee,y=$-E,Mu[1]=$-(E+y)+(y-ee),J=P+E,y=J-P,Mu[2]=P-(J-y)+(E-y),Mu[3]=J;let Ce=GT(4,Mu),_e=WT*u;if(Ce>=_e||-Ce>=_e||(y=r-he,a=r-(he+y)+(y-i),y=t-Ae,p=t-(Ae+y)+(y-i),y=e-ne,d=e-(ne+y)+(y-o),y=n-fe,g=n-(fe+y)+(y-o),a===0&&d===0&&p===0&&g===0)||(_e=KT*u+ZT*Math.abs(Ce),Ce+=he*g+fe*a-(ne*p+Ae*d),Ce>=_e||-Ce>=_e))return Ce;U=a*fe,x=qi*a,C=x-(x-a),M=a-C,x=qi*fe,F=x-(x-fe),z=fe-F,K=M*z-(U-C*F-M*F-C*z),ee=d*Ae,x=qi*d,C=x-(x-d),M=d-C,x=qi*Ae,F=x-(x-Ae),z=Ae-F,W=M*z-(ee-C*F-M*F-C*z),E=K-W,y=K-E,ao[0]=K-(E+y)+(y-W),P=U+E,y=P-U,$=U-(P-y)+(E-y),E=$-ee,y=$-E,ao[1]=$-(E+y)+(y-ee),J=P+E,y=J-P,ao[2]=P-(J-y)+(E-y),ao[3]=J;const Ze=Qp(4,Mu,4,ao,iy);U=he*g,x=qi*he,C=x-(x-he),M=he-C,x=qi*g,F=x-(x-g),z=g-F,K=M*z-(U-C*F-M*F-C*z),ee=ne*p,x=qi*ne,C=x-(x-ne),M=ne-C,x=qi*p,F=x-(x-p),z=p-F,W=M*z-(ee-C*F-M*F-C*z),E=K-W,y=K-E,ao[0]=K-(E+y)+(y-W),P=U+E,y=P-U,$=U-(P-y)+(E-y),E=$-ee,y=$-E,ao[1]=$-(E+y)+(y-ee),J=P+E,y=J-P,ao[2]=P-(J-y)+(E-y),ao[3]=J;const Oe=Qp(Ze,iy,4,ao,oy);U=a*g,x=qi*a,C=x-(x-a),M=a-C,x=qi*g,F=x-(x-g),z=g-F,K=M*z-(U-C*F-M*F-C*z),ee=d*p,x=qi*d,C=x-(x-d),M=d-C,x=qi*p,F=x-(x-p),z=p-F,W=M*z-(ee-C*F-M*F-C*z),E=K-W,y=K-E,ao[0]=K-(E+y)+(y-W),P=U+E,y=P-U,$=U-(P-y)+(E-y),E=$-ee,y=$-E,ao[1]=$-(E+y)+(y-ee),J=P+E,y=J-P,ao[2]=P-(J-y)+(E-y),ao[3]=J;const je=Qp(Oe,oy,4,ao,sy);return sy[je-1]}function JT(r,e,t,n,i,o){const u=(e-o)*(t-i),a=(r-i)*(n-o),d=u-a,p=Math.abs(u+a);return Math.abs(d)>=HT*p?d:-XT(r,e,t,n,i,o,p)}const Wc=(r,e)=>r.ll.x<=e.x&&e.x<=r.ur.x&&r.ll.y<=e.y&&e.y<=r.ur.y,Mm=(r,e)=>{if(e.ur.x<r.ll.x||r.ur.x<e.ll.x||e.ur.y<r.ll.y||r.ur.y<e.ll.y)return null;const t=r.ll.x<e.ll.x?e.ll.x:r.ll.x,n=r.ur.x<e.ur.x?r.ur.x:e.ur.x,i=r.ll.y<e.ll.y?e.ll.y:r.ll.y,o=r.ur.y<e.ur.y?r.ur.y:e.ur.y;return{ll:{x:t,y:i},ur:{x:n,y:o}}};let Ca=Number.EPSILON;Ca===void 0&&(Ca=Math.pow(2,-52));const YT=Ca*Ca,ay=(r,e)=>{if(-Ca<r&&r<Ca&&-Ca<e&&e<Ca)return 0;const t=r-e;return t*t<YT*r*e?0:r<e?-1:1};class QT{constructor(){this.reset()}reset(){this.xRounder=new ly,this.yRounder=new ly}round(e,t){return{x:this.xRounder.round(e),y:this.yRounder.round(t)}}}class ly{constructor(){this.tree=new ag,this.round(0)}round(e){const t=this.tree.add(e),n=this.tree.prev(t);if(n!==null&&ay(t.key,n.key)===0)return this.tree.remove(e),n.key;const i=this.tree.next(t);return i!==null&&ay(t.key,i.key)===0?(this.tree.remove(e),i.key):e}}const kh=new QT,sd=(r,e)=>r.x*e.y-r.y*e.x,Uv=(r,e)=>r.x*e.x+r.y*e.y,uy=(r,e,t)=>{const n=JT(r.x,r.y,e.x,e.y,t.x,t.y);return n>0?-1:n<0?1:0},yd=r=>Math.sqrt(Uv(r,r)),eC=(r,e,t)=>{const n={x:e.x-r.x,y:e.y-r.y},i={x:t.x-r.x,y:t.y-r.y};return sd(i,n)/yd(i)/yd(n)},tC=(r,e,t)=>{const n={x:e.x-r.x,y:e.y-r.y},i={x:t.x-r.x,y:t.y-r.y};return Uv(i,n)/yd(i)/yd(n)},cy=(r,e,t)=>e.y===0?null:{x:r.x+e.x/e.y*(t-r.y),y:t},hy=(r,e,t)=>e.x===0?null:{x:t,y:r.y+e.y/e.x*(t-r.x)},nC=(r,e,t,n)=>{if(e.x===0)return hy(t,n,r.x);if(n.x===0)return hy(r,e,t.x);if(e.y===0)return cy(t,n,r.y);if(n.y===0)return cy(r,e,t.y);const i=sd(e,n);if(i==0)return null;const o={x:t.x-r.x,y:t.y-r.y},u=sd(o,e)/i,a=sd(o,n)/i,d=r.x+a*e.x,p=t.x+u*n.x,g=r.y+a*e.y,y=t.y+u*n.y,x=(d+p)/2,C=(g+y)/2;return{x,y:C}};class Jo{static compare(e,t){const n=Jo.comparePoints(e.point,t.point);return n!==0?n:(e.point!==t.point&&e.link(t),e.isLeft!==t.isLeft?e.isLeft?1:-1:Ma.compare(e.segment,t.segment))}static comparePoints(e,t){return e.x<t.x?-1:e.x>t.x?1:e.y<t.y?-1:e.y>t.y?1:0}constructor(e,t){e.events===void 0?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=t}link(e){if(e.point===this.point)throw new Error("Tried to link already linked events");const t=e.point.events;for(let n=0,i=t.length;n<i;n++){const o=t[n];this.point.events.push(o),o.point=this.point}this.checkForConsuming()}checkForConsuming(){const e=this.point.events.length;for(let t=0;t<e;t++){const n=this.point.events[t];if(n.segment.consumedBy===void 0)for(let i=t+1;i<e;i++){const o=this.point.events[i];o.consumedBy===void 0&&n.otherSE.point.events===o.otherSE.point.events&&n.segment.consume(o.segment)}}}getAvailableLinkedEvents(){const e=[];for(let t=0,n=this.point.events.length;t<n;t++){const i=this.point.events[t];i!==this&&!i.segment.ringOut&&i.segment.isInResult()&&e.push(i)}return e}getLeftmostComparator(e){const t=new Map,n=i=>{const o=i.otherSE;t.set(i,{sine:eC(this.point,e.point,o.point),cosine:tC(this.point,e.point,o.point)})};return(i,o)=>{t.has(i)||n(i),t.has(o)||n(o);const{sine:u,cosine:a}=t.get(i),{sine:d,cosine:p}=t.get(o);return u>=0&&d>=0?a<p?1:a>p?-1:0:u<0&&d<0?a<p?-1:a>p?1:0:d<u?-1:d>u?1:0}}}let rC=0;class Ma{static compare(e,t){const n=e.leftSE.point.x,i=t.leftSE.point.x,o=e.rightSE.point.x,u=t.rightSE.point.x;if(u<n)return 1;if(o<i)return-1;const a=e.leftSE.point.y,d=t.leftSE.point.y,p=e.rightSE.point.y,g=t.rightSE.point.y;if(n<i){if(d<a&&d<p)return 1;if(d>a&&d>p)return-1;const y=e.comparePoint(t.leftSE.point);if(y<0)return 1;if(y>0)return-1;const x=t.comparePoint(e.rightSE.point);return x!==0?x:-1}if(n>i){if(a<d&&a<g)return-1;if(a>d&&a>g)return 1;const y=t.comparePoint(e.leftSE.point);if(y!==0)return y;const x=e.comparePoint(t.rightSE.point);return x<0?1:x>0?-1:1}if(a<d)return-1;if(a>d)return 1;if(o<u){const y=t.comparePoint(e.rightSE.point);if(y!==0)return y}if(o>u){const y=e.comparePoint(t.rightSE.point);if(y<0)return 1;if(y>0)return-1}if(o!==u){const y=p-a,x=o-n,C=g-d,M=u-i;if(y>x&&C<M)return 1;if(y<x&&C>M)return-1}return o>u?1:o<u||p<g?-1:p>g?1:e.id<t.id?-1:e.id>t.id?1:0}constructor(e,t,n,i){this.id=++rC,this.leftSE=e,e.segment=this,e.otherSE=t,this.rightSE=t,t.segment=this,t.otherSE=e,this.rings=n,this.windings=i}static fromRing(e,t,n){let i,o,u;const a=Jo.comparePoints(e,t);if(a<0)i=e,o=t,u=1;else if(a>0)i=t,o=e,u=-1;else throw new Error(`Tried to create degenerate segment at [${e.x}, ${e.y}]`);const d=new Jo(i,!0),p=new Jo(o,!1);return new Ma(d,p,[n],[u])}replaceRightSE(e){this.rightSE=e,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}bbox(){const e=this.leftSE.point.y,t=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:e<t?e:t},ur:{x:this.rightSE.point.x,y:e>t?e:t}}}vector(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}isAnEndpoint(e){return e.x===this.leftSE.point.x&&e.y===this.leftSE.point.y||e.x===this.rightSE.point.x&&e.y===this.rightSE.point.y}comparePoint(e){if(this.isAnEndpoint(e))return 0;const t=this.leftSE.point,n=this.rightSE.point,i=this.vector();if(t.x===n.x)return e.x===t.x?0:e.x<t.x?1:-1;const o=(e.y-t.y)/i.y,u=t.x+o*i.x;if(e.x===u)return 0;const a=(e.x-t.x)/i.x,d=t.y+a*i.y;return e.y===d?0:e.y<d?-1:1}getIntersection(e){const t=this.bbox(),n=e.bbox(),i=Mm(t,n);if(i===null)return null;const o=this.leftSE.point,u=this.rightSE.point,a=e.leftSE.point,d=e.rightSE.point,p=Wc(t,a)&&this.comparePoint(a)===0,g=Wc(n,o)&&e.comparePoint(o)===0,y=Wc(t,d)&&this.comparePoint(d)===0,x=Wc(n,u)&&e.comparePoint(u)===0;if(g&&p)return x&&!y?u:!x&&y?d:null;if(g)return y&&o.x===d.x&&o.y===d.y?null:o;if(p)return x&&u.x===a.x&&u.y===a.y?null:a;if(x&&y)return null;if(x)return u;if(y)return d;const C=nC(o,this.vector(),a,e.vector());return C===null||!Wc(i,C)?null:kh.round(C.x,C.y)}split(e){const t=[],n=e.events!==void 0,i=new Jo(e,!0),o=new Jo(e,!1),u=this.rightSE;this.replaceRightSE(o),t.push(o),t.push(i);const a=new Ma(i,u,this.rings.slice(),this.windings.slice());return Jo.comparePoints(a.leftSE.point,a.rightSE.point)>0&&a.swapEvents(),Jo.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),n&&(i.checkForConsuming(),o.checkForConsuming()),t}swapEvents(){const e=this.rightSE;this.rightSE=this.leftSE,this.leftSE=e,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(let t=0,n=this.windings.length;t<n;t++)this.windings[t]*=-1}consume(e){let t=this,n=e;for(;t.consumedBy;)t=t.consumedBy;for(;n.consumedBy;)n=n.consumedBy;const i=Ma.compare(t,n);if(i!==0){if(i>0){const o=t;t=n,n=o}if(t.prev===n){const o=t;t=n,n=o}for(let o=0,u=n.rings.length;o<u;o++){const a=n.rings[o],d=n.windings[o],p=t.rings.indexOf(a);p===-1?(t.rings.push(a),t.windings.push(d)):t.windings[p]+=d}n.rings=null,n.windings=null,n.consumedBy=t,n.leftSE.consumedBy=t.leftSE,n.rightSE.consumedBy=t.rightSE}}prevInResult(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}beforeState(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{const e=this.prev.consumedBy||this.prev;this._beforeState=e.afterState()}return this._beforeState}afterState(){if(this._afterState!==void 0)return this._afterState;const e=this.beforeState();this._afterState={rings:e.rings.slice(0),windings:e.windings.slice(0),multiPolys:[]};const t=this._afterState.rings,n=this._afterState.windings,i=this._afterState.multiPolys;for(let a=0,d=this.rings.length;a<d;a++){const p=this.rings[a],g=this.windings[a],y=t.indexOf(p);y===-1?(t.push(p),n.push(g)):n[y]+=g}const o=[],u=[];for(let a=0,d=t.length;a<d;a++){if(n[a]===0)continue;const p=t[a],g=p.poly;if(u.indexOf(g)===-1)if(p.isExterior)o.push(g);else{u.indexOf(g)===-1&&u.push(g);const y=o.indexOf(p.poly);y!==-1&&o.splice(y,1)}}for(let a=0,d=o.length;a<d;a++){const p=o[a].multiPoly;i.indexOf(p)===-1&&i.push(p)}return this._afterState}isInResult(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;const e=this.beforeState().multiPolys,t=this.afterState().multiPolys;switch(ps.type){case"union":{const n=e.length===0,i=t.length===0;this._isInResult=n!==i;break}case"intersection":{let n,i;e.length<t.length?(n=e.length,i=t.length):(n=t.length,i=e.length),this._isInResult=i===ps.numMultiPolys&&n<i;break}case"xor":{const n=Math.abs(e.length-t.length);this._isInResult=n%2===1;break}case"difference":{const n=i=>i.length===1&&i[0].isSubject;this._isInResult=n(e)!==n(t);break}default:throw new Error(`Unrecognized operation type found ${ps.type}`)}return this._isInResult}}class fy{constructor(e,t,n){if(!Array.isArray(e)||e.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=t,this.isExterior=n,this.segments=[],typeof e[0][0]!="number"||typeof e[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const i=kh.round(e[0][0],e[0][1]);this.bbox={ll:{x:i.x,y:i.y},ur:{x:i.x,y:i.y}};let o=i;for(let u=1,a=e.length;u<a;u++){if(typeof e[u][0]!="number"||typeof e[u][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");let d=kh.round(e[u][0],e[u][1]);d.x===o.x&&d.y===o.y||(this.segments.push(Ma.fromRing(o,d,this)),d.x<this.bbox.ll.x&&(this.bbox.ll.x=d.x),d.y<this.bbox.ll.y&&(this.bbox.ll.y=d.y),d.x>this.bbox.ur.x&&(this.bbox.ur.x=d.x),d.y>this.bbox.ur.y&&(this.bbox.ur.y=d.y),o=d)}(i.x!==o.x||i.y!==o.y)&&this.segments.push(Ma.fromRing(o,i,this))}getSweepEvents(){const e=[];for(let t=0,n=this.segments.length;t<n;t++){const i=this.segments[t];e.push(i.leftSE),e.push(i.rightSE)}return e}}class iC{constructor(e,t){if(!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new fy(e[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(let n=1,i=e.length;n<i;n++){const o=new fy(e[n],this,!1);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.interiorRings.push(o)}this.multiPoly=t}getSweepEvents(){const e=this.exteriorRing.getSweepEvents();for(let t=0,n=this.interiorRings.length;t<n;t++){const i=this.interiorRings[t].getSweepEvents();for(let o=0,u=i.length;o<u;o++)e.push(i[o])}return e}}class dy{constructor(e,t){if(!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof e[0][0][0]=="number"&&(e=[e])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(let n=0,i=e.length;n<i;n++){const o=new iC(e[n],this);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.polys.push(o)}this.isSubject=t}getSweepEvents(){const e=[];for(let t=0,n=this.polys.length;t<n;t++){const i=this.polys[t].getSweepEvents();for(let o=0,u=i.length;o<u;o++)e.push(i[o])}return e}}class bd{static factory(e){const t=[];for(let n=0,i=e.length;n<i;n++){const o=e[n];if(!o.isInResult()||o.ringOut)continue;let u=null,a=o.leftSE,d=o.rightSE;const p=[a],g=a.point,y=[];for(;u=a,a=d,p.push(a),a.point!==g;)for(;;){const x=a.getAvailableLinkedEvents();if(x.length===0){const F=p[0].point,z=p[p.length-1].point;throw new Error(`Unable to complete output ring starting at [${F.x}, ${F.y}]. Last matching segment found ends at [${z.x}, ${z.y}].`)}if(x.length===1){d=x[0].otherSE;break}let C=null;for(let F=0,z=y.length;F<z;F++)if(y[F].point===a.point){C=F;break}if(C!==null){const F=y.splice(C)[0],z=p.splice(F.index);z.unshift(z[0].otherSE),t.push(new bd(z.reverse()));continue}y.push({index:p.length,point:a.point});const M=a.getLeftmostComparator(u);d=x.sort(M)[0].otherSE;break}t.push(new bd(p))}return t}constructor(e){this.events=e;for(let t=0,n=e.length;t<n;t++)e[t].segment.ringOut=this;this.poly=null}getGeom(){let e=this.events[0].point;const t=[e];for(let p=1,g=this.events.length-1;p<g;p++){const y=this.events[p].point,x=this.events[p+1].point;uy(y,e,x)!==0&&(t.push(y),e=y)}if(t.length===1)return null;const n=t[0],i=t[1];uy(n,e,i)===0&&t.shift(),t.push(t[0]);const o=this.isExteriorRing()?1:-1,u=this.isExteriorRing()?0:t.length-1,a=this.isExteriorRing()?t.length:-1,d=[];for(let p=u;p!=a;p+=o)d.push([t[p].x,t[p].y]);return d}isExteriorRing(){if(this._isExteriorRing===void 0){const e=this.enclosingRing();this._isExteriorRing=e?!e.isExteriorRing():!0}return this._isExteriorRing}enclosingRing(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}_calcEnclosingRing(){let e=this.events[0];for(let i=1,o=this.events.length;i<o;i++){const u=this.events[i];Jo.compare(e,u)>0&&(e=u)}let t=e.segment.prevInResult(),n=t?t.prevInResult():null;for(;;){if(!t)return null;if(!n)return t.ringOut;if(n.ringOut!==t.ringOut)return n.ringOut.enclosingRing()!==t.ringOut?t.ringOut:t.ringOut.enclosingRing();t=n.prevInResult(),n=t?t.prevInResult():null}}}class py{constructor(e){this.exteriorRing=e,e.poly=this,this.interiorRings=[]}addInterior(e){this.interiorRings.push(e),e.poly=this}getGeom(){const e=[this.exteriorRing.getGeom()];if(e[0]===null)return null;for(let t=0,n=this.interiorRings.length;t<n;t++){const i=this.interiorRings[t].getGeom();i!==null&&e.push(i)}return e}}class oC{constructor(e){this.rings=e,this.polys=this._composePolys(e)}getGeom(){const e=[];for(let t=0,n=this.polys.length;t<n;t++){const i=this.polys[t].getGeom();i!==null&&e.push(i)}return e}_composePolys(e){const t=[];for(let n=0,i=e.length;n<i;n++){const o=e[n];if(!o.poly)if(o.isExteriorRing())t.push(new py(o));else{const u=o.enclosingRing();u.poly||t.push(new py(u)),u.poly.addInterior(o)}}return t}}class sC{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Ma.compare;this.queue=e,this.tree=new ag(t),this.segments=[]}process(e){const t=e.segment,n=[];if(e.consumedBy)return e.isLeft?this.queue.remove(e.otherSE):this.tree.remove(t),n;const i=e.isLeft?this.tree.add(t):this.tree.find(t);if(!i)throw new Error(`Unable to find segment #${t.id} [${t.leftSE.point.x}, ${t.leftSE.point.y}] -> [${t.rightSE.point.x}, ${t.rightSE.point.y}] in SweepLine tree.`);let o=i,u=i,a,d;for(;a===void 0;)o=this.tree.prev(o),o===null?a=null:o.key.consumedBy===void 0&&(a=o.key);for(;d===void 0;)u=this.tree.next(u),u===null?d=null:u.key.consumedBy===void 0&&(d=u.key);if(e.isLeft){let p=null;if(a){const y=a.getIntersection(t);if(y!==null&&(t.isAnEndpoint(y)||(p=y),!a.isAnEndpoint(y))){const x=this._splitSafely(a,y);for(let C=0,M=x.length;C<M;C++)n.push(x[C])}}let g=null;if(d){const y=d.getIntersection(t);if(y!==null&&(t.isAnEndpoint(y)||(g=y),!d.isAnEndpoint(y))){const x=this._splitSafely(d,y);for(let C=0,M=x.length;C<M;C++)n.push(x[C])}}if(p!==null||g!==null){let y=null;p===null?y=g:g===null?y=p:y=Jo.comparePoints(p,g)<=0?p:g,this.queue.remove(t.rightSE),n.push(t.rightSE);const x=t.split(y);for(let C=0,M=x.length;C<M;C++)n.push(x[C])}n.length>0?(this.tree.remove(t),n.push(e)):(this.segments.push(t),t.prev=a)}else{if(a&&d){const p=a.getIntersection(d);if(p!==null){if(!a.isAnEndpoint(p)){const g=this._splitSafely(a,p);for(let y=0,x=g.length;y<x;y++)n.push(g[y])}if(!d.isAnEndpoint(p)){const g=this._splitSafely(d,p);for(let y=0,x=g.length;y<x;y++)n.push(g[y])}}}this.tree.remove(t)}return n}_splitSafely(e,t){this.tree.remove(e);const n=e.rightSE;this.queue.remove(n);const i=e.split(t);return i.push(n),e.consumedBy===void 0&&this.tree.add(e),i}}const my=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,aC=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6;class lC{run(e,t,n){ps.type=e,kh.reset();const i=[new dy(t,!0)];for(let g=0,y=n.length;g<y;g++)i.push(new dy(n[g],!1));if(ps.numMultiPolys=i.length,ps.type==="difference"){const g=i[0];let y=1;for(;y<i.length;)Mm(i[y].bbox,g.bbox)!==null?y++:i.splice(y,1)}if(ps.type==="intersection")for(let g=0,y=i.length;g<y;g++){const x=i[g];for(let C=g+1,M=i.length;C<M;C++)if(Mm(x.bbox,i[C].bbox)===null)return[]}const o=new ag(Jo.compare);for(let g=0,y=i.length;g<y;g++){const x=i[g].getSweepEvents();for(let C=0,M=x.length;C<M;C++)if(o.insert(x[C]),o.size>my)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big).")}const u=new sC(o);let a=o.size,d=o.pop();for(;d;){const g=d.key;if(o.size===a){const x=g.segment;throw new Error(`Unable to pop() ${g.isLeft?"left":"right"} SweepEvent [${g.point.x}, ${g.point.y}] from segment #${x.id} [${x.leftSE.point.x}, ${x.leftSE.point.y}] -> [${x.rightSE.point.x}, ${x.rightSE.point.y}] from queue.`)}if(o.size>my)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big).");if(u.segments.length>aC)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments).");const y=u.process(g);for(let x=0,C=y.length;x<C;x++){const M=y[x];M.consumedBy===void 0&&o.insert(M)}a=o.size,d=o.pop()}kh.reset();const p=bd.factory(u.segments);return new oC(p).getGeom()}}const ps=new lC,uC=function(r){for(var e=arguments.length,t=new Array(e>1?e-1:0),n=1;n<e;n++)t[n-1]=arguments[n];return ps.run("union",r,t)},cC=function(r){for(var e=arguments.length,t=new Array(e>1?e-1:0),n=1;n<e;n++)t[n-1]=arguments[n];return ps.run("intersection",r,t)},hC=function(r){for(var e=arguments.length,t=new Array(e>1?e-1:0),n=1;n<e;n++)t[n-1]=arguments[n];return ps.run("xor",r,t)},fC=function(r){for(var e=arguments.length,t=new Array(e>1?e-1:0),n=1;n<e;n++)t[n-1]=arguments[n];return ps.run("difference",r,t)};var Vv={union:uC,intersection:cC,xor:hC,difference:fC};function qv(r,e,t){if(r!==null)for(var n,i,o,u,a,d,p,g=0,y=0,x,C=r.type,M=C==="FeatureCollection",F=C==="Feature",z=M?r.features.length:1,E=0;E<z;E++){p=M?r.features[E].geometry:F?r.geometry:r,x=p?p.type==="GeometryCollection":!1,a=x?p.geometries.length:1;for(var P=0;P<a;P++){var $=0,U=0;if(u=x?p.geometries[P]:p,u!==null){d=u.coordinates;var K=u.type;switch(g=0,K){case null:break;case"Point":if(e(d,y,E,$,U)===!1)return!1;y++,$++;break;case"LineString":case"MultiPoint":for(n=0;n<d.length;n++){if(e(d[n],y,E,$,U)===!1)return!1;y++,K==="MultiPoint"&&$++}K==="LineString"&&$++;break;case"Polygon":case"MultiLineString":for(n=0;n<d.length;n++){for(i=0;i<d[n].length-g;i++){if(e(d[n][i],y,E,$,U)===!1)return!1;y++}K==="MultiLineString"&&$++,K==="Polygon"&&U++}K==="Polygon"&&$++;break;case"MultiPolygon":for(n=0;n<d.length;n++){for(U=0,i=0;i<d[n].length;i++){for(o=0;o<d[n][i].length-g;o++){if(e(d[n][i][o],y,E,$,U)===!1)return!1;y++}U++}$++}break;case"GeometryCollection":for(n=0;n<u.geometries.length;n++)if(qv(u.geometries[n],e)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function lg(r,e){var t,n,i,o,u,a,d,p,g,y,x=0,C=r.type==="FeatureCollection",M=r.type==="Feature",F=C?r.features.length:1;for(t=0;t<F;t++){for(a=C?r.features[t].geometry:M?r.geometry:r,p=C?r.features[t].properties:M?r.properties:{},g=C?r.features[t].bbox:M?r.bbox:void 0,y=C?r.features[t].id:M?r.id:void 0,d=a?a.type==="GeometryCollection":!1,u=d?a.geometries.length:1,i=0;i<u;i++){if(o=d?a.geometries[i]:a,o===null){if(e(null,x,p,g,y)===!1)return!1;continue}switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(o,x,p,g,y)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<o.geometries.length;n++)if(e(o.geometries[n],x,p,g,y)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}x++}}function dC(r,e){lg(r,function(t,n,i,o,u){var a=t===null?null:t.type;switch(a){case null:case"Point":case"LineString":case"Polygon":return e(wh(t,i,{bbox:o,id:u}),n,0)===!1?!1:void 0}var d;switch(a){case"MultiPoint":d="Point";break;case"MultiLineString":d="LineString";break;case"MultiPolygon":d="Polygon";break}for(var p=0;p<t.coordinates.length;p++){var g=t.coordinates[p],y={type:d,coordinates:g};if(e(wh(y,i),n,p)===!1)return!1}})}function pC(r,e={}){const t=[];if(lg(r,i=>{t.push(i.coordinates)}),t.length<2)throw new Error("Must have at least 2 geometries");const n=Vv.union(t[0],...t.slice(1));return n.length===0?null:n.length===1?sg(n[0],e.properties):jv(n,e.properties)}var Zv=pC;function mC(r,e={}){if(r.bbox!=null&&e.recompute!==!0)return r.bbox;const t=[1/0,1/0,-1/0,-1/0];return qv(r,n=>{t[0]>n[0]&&(t[0]=n[0]),t[1]>n[1]&&(t[1]=n[1]),t[2]<n[0]&&(t[2]=n[0]),t[3]<n[1]&&(t[3]=n[1])}),t}var gy=mC;function gC(r){const e=[];if(lg(r,i=>{e.push(i.coordinates)}),e.length<2)throw new Error("Must have at least two features");const t=r.features[0].properties||{},n=Vv.difference(e[0],...e.slice(1));return n.length===0?null:n.length===1?sg(n[0],t):jv(n,t)}var _C=gC;function yC(r){if(!r)throw new Error("geojson is required");var e=[];return dC(r,function(t){e.push(t)}),xh(e)}var bC=yC;function _y(r,e){const t=_C(xh([sg([[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]]),r]));if(!t)return;t.properties={isMask:!0};const n=_d(gy(r)),i=(n[2]-n[0])/360/1e3,o=n[0]<-180,u=n[2]>180,a=bC(r);if(a.features.length>1&&(o||u))for(const d of a.features){const p=_d(gy(d));if(u&&p[0]<-180+i)for(const g of d.geometry.coordinates)for(const y of g)y[0]+=360-i;if(o&&p[2]>180-i)for(const g of d.geometry.coordinates)for(const y of g)y[0]-=360-i}e(xh([a.features.length<2?r:Zv(a)??r,t]))}const yy={fill:{paint:{"fill-color":"#000","fill-opacity":.1},filter:["all",["==",["geometry-type"],"Polygon"],["has","isMask"]]},line:{layout:{"line-cap":"square"},paint:{"line-width":["case",["==",["geometry-type"],"Polygon"],2,3],"line-dasharray":[1,1],"line-color":"#3170fe"},filter:["!",["has","isMask"]]}},Gf="mtlr-gc-full-geom",by="mtlr-gc-full-geom-fill",vy="mtlr-gc-full-geom-line";function Gv(r,e,t=!0,n=!0,i={},o={},u=yy){let a;const d=[];let p,g,y;function x(){if(!r.loaded){r.once("load",x);return}const z=u?u===!0?yy:u:void 0;if(!(z!=null&&z.fill)&&!(z!=null&&z.line))return;const E=r.getSource(Gf);if(E)E.setData(y??xh([]));else if(y)r.addSource(Gf,{type:"geojson",data:y});else return;!r.getLayer(by)&&z!=null&&z.fill&&r.addLayer({...z==null?void 0:z.fill,id:by,type:"fill",source:Gf}),!r.getLayer(vy)&&z!=null&&z.line&&r.addLayer({...z==null?void 0:z.line,id:vy,type:"line",source:Gf})}function C(z){y=z,x()}r.on("styledata",()=>{setTimeout(()=>{y&&x()})});const M=z=>{a==null||a({type:"mapClick",coordinates:[z.lngLat.lng,z.lngLat.lat]})};function F(z=!1){if(!e)throw new Error;const E=document.createElement("div");return z&&E.classList.add("marker-interactive"),new pT({props:{displayIn:"maplibre"},target:E}),new e.Marker({element:E,offset:[1,-13]})}return{setEventHandler(z){z?(a=z,r.on("click",M)):(a=void 0,r.off("click",M))},flyTo(z,E){r.flyTo({center:z,...E?{zoom:E}:{},...i})},fitBounds(z,E,P){r.fitBounds([[z[0],z[1]],[z[2],z[3]]],{padding:E,...P?{maxZoom:P}:{},...o})},indicateReverse(z){r.getCanvasContainer().style.cursor=z?"crosshair":""},setReverseMarker(z){!e||!t||(g?z?g.setLngLat(z):(g.remove(),g=void 0):z&&(t instanceof Function?g=t(r)??void 0:(g=(typeof t=="object"?new e.Marker(t):F()).setLngLat(z).addTo(r),g.getElement().classList.add("marker-reverse"))))},setFeatures(z,E,P){for(const $ of d)$.remove();if(d.length=0,C(void 0),!!e){if(E){let $=!1;if(E.geometry.type==="GeometryCollection"){const U=E.geometry.geometries.filter(K=>K.type==="Polygon"||K.type==="MultiPolygon");e:if(U.length>0){const K=Zv(xh(U.map(ee=>wh(ee))));if(!K)break e;_y({...E,geometry:K.geometry},C),$=!0}else{const K=E.geometry.geometries.filter(ee=>ee.type==="LineString"||ee.type==="MultiLineString");K.length>0&&(C({...E,geometry:{type:"GeometryCollection",geometries:K}}),$=!0)}}if(!$){if(E.geometry.type==="Polygon"||E.geometry.type==="MultiPolygon")_y(E,C);else if(E.geometry.type==="LineString"||E.geometry.type==="MultiLineString"){C(E);return}}if(!P&&E.geometry.type!=="Point")return;if(t instanceof Function){const U=t(r,E);U&&d.push(U)}else t&&d.push(typeof t=="object"?new e.Marker(t):F().setLngLat(E.center).addTo(r))}if(n)for(const $ of z??[]){if($===E)continue;let U;if(n instanceof Function){if(U=n(r,$),!U)continue}else U=(typeof n=="object"?new e.Marker(n):F(!0)).setLngLat($.center).setPopup(new e.Popup({offset:[1,-27],closeButton:!1,closeOnMove:!0,className:"maptiler-gc-popup"}).setText($.place_type[0]==="reverse"?$.place_name:$.place_name.replace(/,.*/,""))).addTo(r);const K=U.getElement();K.addEventListener("click",ee=>{ee.stopPropagation(),a==null||a({type:"markerClick",id:$.id})}),K.addEventListener("mouseenter",()=>{a==null||a({type:"markerMouseEnter",id:$.id}),U.togglePopup()}),K.addEventListener("mouseleave",()=>{a==null||a({type:"markerMouseLeave",id:$.id}),U.togglePopup()}),d.push(U)}}},setSelectedMarker(z){p&&p.getElement().classList.toggle("marker-selected",!1),p=z>-1?d[z]:void 0,p==null||p.getElement().classList.toggle("marker-selected",!0)},getCenterAndZoom(){const z=r.getCenter();return[r.getZoom(),z.lng,z.lat]}}}function vC(r,e,t){var n,i;class o{constructor(z,E){zo(this,"type"),zo(this,"target"),this.type=E,this.target=z}}class u extends o{constructor(z,E){super(z,"select"),zo(this,"feature"),Object.assign(this,E)}}class a extends o{constructor(z,E){super(z,"featureslisted"),zo(this,"features"),this.features=E}}class d extends o{constructor(z,E){super(z,"featuresmarked"),zo(this,"features"),this.features=E}}class p extends o{constructor(z,E){super(z,"optionsvisibilitychange"),zo(this,"optionsVisible"),this.optionsVisible=E}}class g extends o{constructor(z,E){super(z,"pick"),zo(this,"feature"),this.feature=E}}class y extends o{constructor(z,E){super(z,"querychange"),zo(this,"query"),this.query=E}}class x extends o{constructor(z,E,P){super(z,"response"),zo(this,"url"),zo(this,"featureCollection"),this.url=E,this.featureCollection=P}}class C extends o{constructor(z,E){super(z,"reversetoggle"),zo(this,"reverse"),this.reverse=E}}class M extends r{constructor(z={}){super(),B0(this,n),B0(this,i),$0(this,i,z)}onAddInt(z){const E=document.createElement("div");E.className="mapboxgl-ctrl-geocoder mapboxgl-ctrl maplibregl-ctrl-geocoder maplibregl-ctrl mapboxgl-ctrl-group";const{marker:P,showResultMarkers:$,flyTo:U,fullGeometryStyle:K,...ee}=yi(this,i),W=typeof U=="boolean"?{}:U,J={mapController:Gv(z,e,P,$,W,W,K),flyTo:U===void 0?!0:!!U,apiKey:"",...t==null?void 0:t(z,E),...ee};if(!J.apiKey)throw new Error("no apiKey provided");return $0(this,n,new $T({target:E,props:J})),yi(this,n).$on("select",he=>{this.fire(new u(this,he.detail))}),yi(this,n).$on("pick",he=>{this.fire(new g(this,he.detail.feature))}),yi(this,n).$on("featureslisted",he=>{this.fire(new a(this,he.detail.features))}),yi(this,n).$on("featuresmarked",he=>{this.fire(new d(this,he.detail.features))}),yi(this,n).$on("response",he=>{this.fire(new x(this,he.detail.url,he.detail.featureCollection))}),yi(this,n).$on("optionsvisibilitychange",he=>{this.fire(new p(this,he.detail.optionsVisible))}),yi(this,n).$on("reversetoggle",he=>{this.fire(new C(this,he.detail.reverse))}),yi(this,n).$on("querychange",he=>{this.fire(new y(this,he.detail.query))}),E}on(z,E){return super.on(z,E)}once(z,E){return super.once(z,E)}off(z,E){return super.off(z,E)}listens(z){return super.listens(z)}setOptions(z){var E;Object.assign(yi(this,i),z);const{marker:P,showResultMarkers:$,flyTo:U,fullGeometryStyle:K,...ee}=yi(this,i);(E=yi(this,n))==null||E.$set(ee)}setQuery(z,E=!0){var P;(P=yi(this,n))==null||P.setQuery(z,E)}clearMap(){var z;(z=yi(this,n))==null||z.clearMap()}clearList(){var z;(z=yi(this,n))==null||z.clearList()}setReverseMode(z){var E;(E=yi(this,n))==null||E.$set({reverseActive:z})}focus(){var z;(z=yi(this,n))==null||z.focus()}blur(){var z;(z=yi(this,n))==null||z.blur()}onRemove(){var z;(z=yi(this,n))==null||z.$destroy()}}return n=new WeakMap,i=new WeakMap,{MapLibreBasedGeocodingControl:M,events:{SelectEvent:u,FeaturesListedEvent:a,FeaturesMarkedEvent:d,OptionsVisibilityChangeEvent:p,PickEvent:g,QueryChangeEvent:y,ResponseEvent:x,ReverseToggleEvent:C}}}const{MapLibreBasedGeocodingControl:n7,events:$a}=vC(Ys.Evented,Lx);$a.SelectEvent;$a.FeaturesListedEvent;$a.FeaturesMarkedEvent;$a.OptionsVisibilityChangeEvent;$a.PickEvent;$a.QueryChangeEvent;$a.ResponseEvent;$a.ReverseToggleEvent;function wC(r){let e,t;return{c(){e=ms("svg"),t=ms("path"),ae(t,"d","M13.12.706a.982.982 0 0 0-1.391 0L6.907 5.517 2.087.696a.982.982 0 1 0-1.391 1.39l4.821 4.821L.696 11.73a.982.982 0 1 0 1.39 1.39l4.821-4.821 4.822 4.821a.982.982 0 1 0 1.39-1.39L8.298 6.908l4.821-4.822a.988.988 0 0 0 0-1.38Z"),ae(e,"viewBox","0 0 14 14"),ae(e,"width","13"),ae(e,"height","13"),ae(e,"class","svelte-en2qvf")},m(n,i){Z(n,e,i),D(e,t)},p:ot,i:ot,o:ot,d(n){n&&q(e)}}}class Hv extends St{constructor(e){super(),kt(this,e,null,wC,_t,{})}}function xC(r){let e,t;return{c(){e=ms("svg"),t=ms("path"),ae(t,"d","M15 0C6.705 0 0 6.705 0 15C0 23.295 6.705 30 15 30C23.295 30 30 23.295 30 15C30 6.705 23.295 0 15 0ZM22.5 20.385L20.385 22.5L15 17.115L9.615 22.5L7.5 20.385L12.885 15L7.5 9.615L9.615 7.5L15 12.885L20.385 7.5L22.5 9.615L17.115 15L22.5 20.385Z"),ae(e,"viewBox","0 0 30 30"),ae(e,"fill","none"),ae(e,"xmlns","http://www.w3.org/2000/svg"),ae(e,"class","svelte-d2loi5")},m(n,i){Z(n,e,i),D(e,t)},p:ot,i:ot,o:ot,d(n){n&&q(e)}}}class Wv extends St{constructor(e){super(),kt(this,e,null,xC,_t,{})}}function kC(r){let e,t;return{c(){e=j("img"),dr(e.src,t=r[3]+"area.svg")||ae(e,"src",t),ae(e,"alt",r[6]),ae(e,"class","svelte-ltkwvy")},m(n,i){Z(n,e,i)},p(n,i){i&8&&!dr(e.src,t=n[3]+"area.svg")&&ae(e,"src",t),i&64&&ae(e,"alt",n[6])},d(n){n&&q(e)}}}function SC(r){let e,t;return{c(){e=j("img"),dr(e.src,t=r[3]+"reverse.svg")||ae(e,"src",t),ae(e,"alt",r[6]),ae(e,"class","svelte-ltkwvy")},m(n,i){Z(n,e,i)},p(n,i){i&8&&!dr(e.src,t=n[3]+"reverse.svg")&&ae(e,"src",t),i&64&&ae(e,"alt",n[6])},d(n){n&&q(e)}}}function TC(r){let e,t;return{c(){e=j("img"),dr(e.src,t=r[3]+"poi.svg")||ae(e,"src",t),ae(e,"alt",r[6]),ae(e,"class","svelte-ltkwvy")},m(n,i){Z(n,e,i)},p(n,i){i&8&&!dr(e.src,t=n[3]+"poi.svg")&&ae(e,"src",t),i&64&&ae(e,"alt",n[6])},d(n){n&&q(e)}}}function CC(r){let e,t;return{c(){e=j("img"),dr(e.src,t=r[3]+"postal_code.svg")||ae(e,"src",t),ae(e,"alt",r[6]),ae(e,"class","svelte-ltkwvy")},m(n,i){Z(n,e,i)},p(n,i){i&8&&!dr(e.src,t=n[3]+"postal_code.svg")&&ae(e,"src",t),i&64&&ae(e,"alt",n[6])},d(n){n&&q(e)}}}function MC(r){let e,t;return{c(){e=j("img"),dr(e.src,t=r[3]+"street.svg")||ae(e,"src",t),ae(e,"alt",r[6]),ae(e,"class","svelte-ltkwvy")},m(n,i){Z(n,e,i)},p(n,i){i&8&&!dr(e.src,t=n[3]+"street.svg")&&ae(e,"src",t),i&64&&ae(e,"alt",n[6])},d(n){n&&q(e)}}}function LC(r){let e,t;return{c(){e=j("img"),dr(e.src,t=r[3]+"road.svg")||ae(e,"src",t),ae(e,"alt",r[6]),ae(e,"class","svelte-ltkwvy")},m(n,i){Z(n,e,i)},p(n,i){i&8&&!dr(e.src,t=n[3]+"road.svg")&&ae(e,"src",t),i&64&&ae(e,"alt",n[6])},d(n){n&&q(e)}}}function EC(r){let e,t;return{c(){e=j("img"),dr(e.src,t=r[3]+"housenumber.svg")||ae(e,"src",t),ae(e,"alt",r[6]),ae(e,"class","svelte-ltkwvy")},m(n,i){Z(n,e,i)},p(n,i){i&8&&!dr(e.src,t=n[3]+"housenumber.svg")&&ae(e,"src",t),i&64&&ae(e,"alt",n[6])},d(n){n&&q(e)}}}function IC(r){let e,t,n,i;return{c(){e=j("img"),dr(e.src,t=r[5])||ae(e,"src",t),ae(e,"alt",r[4]),ae(e,"class","svelte-ltkwvy")},m(o,u){Z(o,e,u),n||(i=Tt(e,"error",r[14]),n=!0)},p(o,u){u&32&&!dr(e.src,t=o[5])&&ae(e,"src",t),u&16&&ae(e,"alt",o[4])},d(o){o&&q(e),n=!1,i()}}}function wy(r){let e,t;return{c(){e=j("span"),t=Ee(r[6]),ae(e,"class","secondary svelte-ltkwvy")},m(n,i){Z(n,e,i),D(e,t)},p(n,i){i&64&&gt(t,n[6])},d(n){n&&q(e)}}}function AC(r){let e,t,n,i,o,u,a,d,p,g=(r[7]?r[0].place_name:r[0].place_name.replace(/,.*/,""))+"",y,x,C=r[2]==="always"||r[2]!=="never"&&!r[0].address&&!r[0].id.startsWith("road.")&&!r[0].id.startsWith("address.")&&!r[0].id.startsWith("postal_code.")&&(!r[0].id.startsWith("poi.")||!r[5])&&!r[7],M,F,z=(r[7]?"":r[0].place_name.replace(/[^,]*,?\s*/,""))+"",E,P,$;function U(J,he){return he&1&&(t=null),he&1&&(n=null),he&1&&(i=null),he&1&&(o=null),J[5]?IC:J[0].address?EC:(t==null&&(t=!!J[0].id.startsWith("road.")),t?LC:(n==null&&(n=!!J[0].id.startsWith("address.")),n?MC:(i==null&&(i=!!J[0].id.startsWith("postal_code.")),i?CC:(o==null&&(o=!!J[0].id.startsWith("poi.")),o?TC:J[7]?SC:kC))))}let K=U(r,-1),ee=K(r),W=C&&wy(r);return{c(){e=j("li"),ee.c(),u=ie(),a=j("span"),d=j("span"),p=j("span"),y=Ee(g),x=ie(),W&&W.c(),M=ie(),F=j("span"),E=Ee(z),ae(p,"class","primary svelte-ltkwvy"),ae(d,"class","svelte-ltkwvy"),ae(F,"class","line2 svelte-ltkwvy"),ae(a,"class","texts svelte-ltkwvy"),ae(e,"tabindex","0"),ae(e,"data-selected",r[1]),ae(e,"class","svelte-ltkwvy"),jt(e,"selected",r[1])},m(J,he){Z(J,e,he),ee.m(e,null),D(e,u),D(e,a),D(a,d),D(d,p),D(p,y),D(d,x),W&&W.m(d,null),D(a,M),D(a,F),D(F,E),P||($=[Tt(e,"mouseenter",r[12]),Tt(e,"focus",r[13])],P=!0)},p(J,[he]){K===(K=U(J,he))&&ee?ee.p(J,he):(ee.d(1),ee=K(J),ee&&(ee.c(),ee.m(e,u))),he&1&&g!==(g=(J[7]?J[0].place_name:J[0].place_name.replace(/,.*/,""))+"")&&gt(y,g),he&37&&(C=J[2]==="always"||J[2]!=="never"&&!J[0].address&&!J[0].id.startsWith("road.")&&!J[0].id.startsWith("address.")&&!J[0].id.startsWith("postal_code.")&&(!J[0].id.startsWith("poi.")||!J[5])&&!J[7]),C?W?W.p(J,he):(W=wy(J),W.c(),W.m(d,null)):W&&(W.d(1),W=null),he&1&&z!==(z=(J[7]?"":J[0].place_name.replace(/[^,]*,?\s*/,""))+"")&&gt(E,z),he&2&&ae(e,"data-selected",J[1]),he&2&&jt(e,"selected",J[1])},i:ot,o:ot,d(J){J&&q(e),ee.d(),W&&W.d(),P=!1,ur($)}}}function PC(r,e,t){var $;let n,i,{feature:o}=e,{selected:u=!1}=e,{showPlaceType:a}=e,{missingIconsCache:d}=e,{iconsBaseUrl:p}=e;const g=($=o.properties)==null?void 0:$.categories;let y,x,C=0,M=o.place_type[0]==="reverse";function F(){x&&d.add(x),t(10,C++,C)}function z(U){In.call(this,r,U)}function E(U){In.call(this,r,U)}const P=()=>F();return r.$$set=U=>{"feature"in U&&t(0,o=U.feature),"selected"in U&&t(1,u=U.selected),"showPlaceType"in U&&t(2,a=U.showPlaceType),"missingIconsCache"in U&&t(9,d=U.missingIconsCache),"iconsBaseUrl"in U&&t(3,p=U.iconsBaseUrl)},r.$$.update=()=>{var U,K,ee,W;if(r.$$.dirty&3640)do t(11,n--,n),t(4,y=g==null?void 0:g[n]),t(5,x=y?p+y.replace(/ /g,"_")+".svg":void 0);while(n>-1&&(!x||d.has(x)));r.$$.dirty&1&&t(6,i=((K=(U=o.properties)==null?void 0:U.categories)==null?void 0:K.join(", "))??((W=(ee=o.properties)==null?void 0:ee.place_type_name)==null?void 0:W[0])??o.place_type[0])},t(11,n=(g==null?void 0:g.length)??0),[o,u,a,p,y,x,i,M,F,d,C,n,z,E,P]}class zC extends St{constructor(e){super(),kt(this,e,PC,AC,_t,{feature:0,selected:1,showPlaceType:2,missingIconsCache:9,iconsBaseUrl:3})}}function DC(r){let e;return{c(){e=j("div"),e.innerHTML='<svg viewBox="0 0 18 18" width="24" height="24" class="svelte-7cmwmc"><path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"></path><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"></path></svg>',ae(e,"class","svelte-7cmwmc")},m(t,n){Z(t,e,n)},p:ot,i:ot,o:ot,d(t){t&&q(e)}}}class RC extends St{constructor(e){super(),kt(this,e,null,DC,_t,{})}}function FC(r){let e,t;return{c(){e=ms("svg"),t=ms("path"),ae(t,"d","M30.003-26.765C13.46-26.765 0-14.158 0 1.337c0 23.286 24.535 42.952 28.39 46.04.24.192.402.316.471.376.323.282.732.424 1.142.424.41 0 .82-.142 1.142-.424.068-.06.231-.183.471-.376 3.856-3.09 28.39-22.754 28.39-46.04 0-15.495-13.46-28.102-30.003-28.102Zm1.757 12.469c4.38 0 7.858 1.052 10.431 3.158 2.595 2.105 3.89 4.913 3.89 8.422 0 2.34-.53 4.362-1.593 6.063-1.063 1.702-3.086 3.616-6.063 5.742-2.042 1.51-3.337 2.659-3.89 3.446-.532.787-.8 1.82-.8 3.096v1.914h-8.449V15.18c0-2.041.434-3.815 1.306-5.325.872-1.51 2.467-3.118 4.785-4.82 2.233-1.594 3.7-2.89 4.402-3.889a5.582 5.582 0 0 0 1.087-3.35c0-1.382-.51-2.435-1.531-3.158-1.02-.723-2.45-1.087-4.28-1.087-3.19 0-6.826 1.047-10.91 3.131l-3.472-6.986c4.742-2.659 9.77-3.992 15.087-3.992Zm-1.88 37.324c1.765 0 3.124.472 4.08 1.408.98.936 1.47 2.276 1.47 4.02 0 1.68-.49 3.007-1.47 3.985-.977.957-2.336 1.435-4.08 1.435-1.787 0-3.171-.465-4.15-1.4-.978-.958-1.47-2.298-1.47-4.02 0-1.787.48-3.14 1.436-4.054.957-.915 2.355-1.374 4.184-1.374Z"),ae(e,"viewBox","0 0 60.006 21.412"),ae(e,"width","14"),ae(e,"height","20"),ae(e,"class","svelte-en2qvf")},m(n,i){Z(n,e,i),D(e,t)},p:ot,i:ot,o:ot,d(n){n&&q(e)}}}class BC extends St{constructor(e){super(),kt(this,e,null,FC,_t,{})}}function $C(r){let e,t,n;return{c(){e=ms("svg"),t=ms("circle"),n=ms("path"),ae(t,"cx","4.789"),ae(t,"cy","4.787"),ae(t,"r","3.85"),ae(t,"class","svelte-1aq105l"),ae(n,"d","M12.063 12.063 7.635 7.635"),ae(n,"class","svelte-1aq105l"),ae(e,"xmlns","http://www.w3.org/2000/svg"),ae(e,"width","13"),ae(e,"height","13"),ae(e,"viewBox","0 0 13 13"),ae(e,"class","svelte-1aq105l")},m(i,o){Z(i,e,o),D(e,t),D(e,n)},p:ot,i:ot,o:ot,d(i){i&&q(e)}}}class OC extends St{constructor(e){super(),kt(this,e,null,$C,_t,{})}}function NC(r,e,t){const n=e[1],i=e[0],o=n-i;return r===n&&t?r:((r-i)%o+o)%o+i}function xy(r){const e=[...r];return e[2]<e[0]&&(Math.abs((e[0]+e[2]+360)/2)>Math.abs((e[0]-360+e[2])/2)?e[0]-=360:e[2]+=360),e}let Kc;async function jC(r,e,t){const n=r==null?void 0:r.getCenterAndZoom();for(const i of e??[])if(!(n&&(i.minZoom!=null&&i.minZoom>n[0]||i.maxZoom!=null&&i.maxZoom<n[0]))){if(i.type==="fixed")return i.coordinates.join(",");e:if(i.type==="client-geolocation"){if(Kc&&i.cachedLocationExpiry&&Kc.time+i.cachedLocationExpiry>Date.now()){if(!Kc.coords)break e;return Kc.coords}let o;try{return o=await new Promise((u,a)=>{t.signal.addEventListener("abort",()=>{a(Error("aborted"))}),navigator.geolocation.getCurrentPosition(d=>{u([d.coords.longitude,d.coords.latitude].map(p=>p.toFixed(6)).join(","))},d=>{a(d)},i)}),o}catch{}finally{i.cachedLocationExpiry&&(Kc={time:Date.now(),coords:o})}if(t.signal.aborted)return}if(i.type==="server-geolocation")return"ip";if(n&&i.type==="map-center")return n[1].toFixed(6)+","+n[2].toFixed(6)}}const UC=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*(EAST|WEST|[EW])?$/i,ky=/^([+-]?[0-8]?[0-9])\s+([0-5]?[0-9]\.\d{3,})[\s,]{1,}([+-]?[0-1]?[0-9]?[0-9])\s+([0-5]?[0-9]\.\d{3,})$/,Sy=/^(NORTH|SOUTH|[NS])?[\s]*([+-]?[0-8]?[0-9](?:[\.,]\d{3,}))[\s]*([]?)[\s]*(NORTH|SOUTH|[NS])?[\s]*[,/;]?[\s]*(EAST|WEST|[EW])?[\s]*([+-]?[0-1]?[0-9]?[0-9](?:[\.,]\d{3,}))[\s]*([]?)[\s]*(EAST|WEST|[EW])?$/i,Ty=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(EAST|WEST|[EW])?$/i,Cy=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)\s*(EAST|WEST|[EW])?$/i,My=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''||||["\.])?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''||||["\.])?\s*(EAST|WEST|[EW])?$/i;function VC(r){if(!["DMS","DM","DD"].includes(r))throw new Error("invalid format specified");if(this.decimalCoordinates&&this.decimalCoordinates.trim()){const e=this.decimalCoordinates.split(",").map(C=>Number(C.trim())),t=Number(e[0]),n=Number(e[1]),i=Math.abs(t),o=Math.abs(n),u=t>0?"N":"S",a=n>0?"E":"W";let d;r=="DD"&&(d=`${i} ${u}, ${o} ${a}`);const p=Math.floor(i),g=Math.floor(o),y=(i-p)*60,x=(o-g)*60;if(r=="DM"){let C=Ly(y,3).toFixed(3).padStart(6,"0"),M=Ly(x,3).toFixed(3).padStart(6,"0");C.endsWith(".000")&&M.endsWith(".000")&&(C=C.replace(/\.000$/,""),M=M.replace(/\.000$/,"")),d=`${p} ${C}' ${u}, ${g} ${M}' ${a}`}if(r=="DMS"){const C=Math.floor(y),M=Math.floor(x);let F=((y-C)*60).toFixed(1).padStart(4,"0"),z=((x-M)*60).toFixed(1).padStart(4,"0");const E=C.toString().padStart(2,"0"),P=M.toString().padStart(2,"0");F.endsWith(".0")&&z.endsWith(".0")&&(F=F.replace(/\.0$/,""),z=z.replace(/\.0$/,"")),d=`${p} ${E}' ${F}" ${u}, ${g} ${P}' ${z}" ${a}`}return d}else throw new Error("no decimal coordinates to convert")}function Ly(r,e){const t=Math.pow(10,e);return Math.round((r+Number.EPSILON)*t)/t}function ug(r,e){e||(e=5),r=r.replace(/\s+/g," ").trim();let t=null,n=null,i="",o="",u=null,a=[],d=!1;if(UC.test(r))throw new Error("invalid coordinate value");if(ky.test(r))if(a=ky.exec(r),d=Xc(a),d)t=Math.abs(a[1])+a[2]/60,Number(a[1])<0&&(t*=-1),n=Math.abs(a[3])+a[4]/60,Number(a[3])<0&&(n*=-1),u="DM";else throw new Error("invalid coordinate format");else if(Sy.test(r))if(a=Sy.exec(r),d=Xc(a),d){if(t=a[2],n=a[6],t.includes(",")&&(t=t.replace(",",".")),n.includes(",")&&(n=n.replace(",",".")),u="DD",Number(Math.round(t))==Number(t))throw new Error("integer only coordinate provided");if(Number(Math.round(n))==Number(n))throw new Error("integer only coordinate provided");a[1]?(i=a[1],o=a[5]):a[4]&&(i=a[4],o=a[8])}else throw new Error("invalid decimal coordinate format");else if(Ty.test(r))if(a=Ty.exec(r),d=Xc(a),d)t=Math.abs(parseInt(a[2])),a[4]&&(t+=a[4]/60,u="DM"),a[6]&&(t+=a[6].replace(",",".")/3600,u="DMS"),parseInt(a[2])<0&&(t=-1*t),n=Math.abs(parseInt(a[9])),a[11]&&(n+=a[11]/60),a[13]&&(n+=a[13].replace(",",".")/3600),parseInt(a[9])<0&&(n=-1*n),a[1]?(i=a[1],o=a[8]):a[7]&&(i=a[7],o=a[14]);else throw new Error("invalid DMS coordinates format");else if(Cy.test(r))if(a=Cy.exec(r),d=Xc(a),d)t=Math.abs(parseInt(a[2])),a[4]&&(t+=a[4]/60,u="DM"),a[6]&&(t+=a[6]/3600,u="DMS"),parseInt(a[2])<0&&(t=-1*t),n=Math.abs(parseInt(a[10])),a[12]&&(n+=a[12]/60),a[14]&&(n+=a[14]/3600),parseInt(a[10])<0&&(n=-1*n),a[1]?(i=a[1],o=a[9]):a[8]&&(i=a[8],o=a[16]);else throw new Error("invalid DMS coordinates format");else if(My.test(r)){if(a=My.exec(r),d=Xc(a),a.filter(p=>p).length<=5)throw new Error("invalid coordinates format");if(d)t=Math.abs(parseInt(a[2])),a[4]&&(t+=a[4].replace(",",".")/60,u="DM"),a[6]&&(t+=a[6].replace(",",".")/3600,u="DMS"),parseInt(a[2])<0&&(t=-1*t),n=Math.abs(parseInt(a[10])),a[12]&&(n+=a[12].replace(",",".")/60),a[14]&&(n+=a[14].replace(",",".")/3600),parseInt(a[10])<0&&(n=-1*n),a[1]?(i=a[1],o=a[9]):a[8]&&(i=a[8],o=a[16]);else throw new Error("invalid coordinates format")}if(d){if(Math.abs(n)>=180)throw new Error("invalid longitude value");if(Math.abs(t)>=90)throw new Error("invalid latitude value");if(i&&!o||!i&&o)throw new Error("invalid coordinates value");if(i&&i==o)throw new Error("invalid coordinates format");t.toString().includes(",")&&(t=t.replace(",",".")),n.toString().includes(",")&&(n=n.replace(",","."));let p=/S|SOUTH/i;p.test(i)&&t>0&&(t=-1*t),p=/W|WEST/i,p.test(o)&&n>0&&(n=-1*n);const g=a[0].trim();let y,x;const C=/[,/;\u0020]/g,M=g.match(C);if(M==null){const E=Math.floor(r.length/2);y=g.substring(0,E).trim(),x=g.substring(E).trim()}else{let E;M.length%2==1?E=Math.floor(M.length/2):E=M.length/2-1;let P=0;if(E==0)P=g.indexOf(M[0]),y=g.substring(0,P).trim(),x=g.substring(P+1).trim();else{let $=0,U=0;for(;$<=E;)P=g.indexOf(M[$],U),U=P+1,$++;y=g.substring(0,P).trim(),x=g.substring(P+1).trim()}}const F=y.split(".");if(F.length==2&&F[1]==0&&F[1].length!=2)throw new Error("invalid coordinates format");const z=x.split(".");if(z.length==2&&z[1]==0&&z[1].length!=2)throw new Error("invalid coordinates format");if(/^\d+$/.test(y)||/^\d+$/.test(x))throw new Error("degree only coordinate/s provided");return t=Number(Number(t).toFixed(e)),n=Number(Number(n).toFixed(e)),Object.freeze({verbatimCoordinates:g,verbatimLatitude:y,verbatimLongitude:x,decimalLatitude:t,decimalLongitude:n,decimalCoordinates:`${t},${n}`,originalFormat:u,closeEnough:qC,toCoordinateFormat:VC})}else throw new Error("coordinates pattern match failed")}function Xc(r){if(!isNaN(r[0]))return!1;const e=[...r];if(e.shift(),e.length%2>0)return!1;const t=/^[-+]?\d+([\.,]\d+)?$/,n=/[eastsouthnorthwest]+/i,i=e.length/2;for(let o=0;o<i;o++){const u=e[o],a=e[o+i],d=t.test(u)&&t.test(a),p=n.test(u)&&n.test(a),g=u==a;if(!(u==null&&a==null)){if(u==null||a==null)return!1;if(d||p||g)continue;return!1}}return!0}function Ey(r,e){const t=Math.abs(r-e);return Number(t.toFixed(6))<=1e-5}function qC(r){if(!r)throw new Error("coords must be provided");if(r.includes(",")){const e=r.split(",");if(Number(e[0])==NaN||Number(e[1])==NaN)throw new Error("coords are not valid decimals");return Ey(this.decimalLatitude,Number(e[0]))&&Ey(this.decimalLongitude,e[1])}else throw new Error("coords being tested must be separated by a comma")}const ZC=Object.freeze({DMS:"DMS",DM:"DM",DD:"DD"});ug.to=ZC;const GC=[{verbatimCoordinates:"40.123, -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123 N 74.123 W",verbatimLatitude:"40.123 N",verbatimLongitude:"74.123 W"},{verbatimCoordinates:"40.123 N 74.123 W",verbatimLatitude:"40.123 N",verbatimLongitude:"74.123 W"},{verbatimCoordinates:'40 7 22.8" N 74 7 22.8" W',verbatimLatitude:'40 7 22.8" N',verbatimLongitude:'74 7 22.8" W'},{verbatimCoordinates:"40 7.38 , -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"N40722.8, W74722.8",verbatimLatitude:"N40722.8",verbatimLongitude:"W74722.8"},{verbatimCoordinates:'40722.8"N, 74722.8"W',verbatimLatitude:'40722.8"N',verbatimLongitude:'74722.8"W'},{verbatimCoordinates:`407'22.8"N, 747'22.8"W`,verbatimLatitude:`407'22.8"N`,verbatimLongitude:`747'22.8"W`},{verbatimCoordinates:"40 7 22.8, -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"},{verbatimCoordinates:"40.123 -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123,-74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123N74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"4007.38N7407.38W",verbatimLatitude:"4007.38N",verbatimLongitude:"7407.38W"},{verbatimCoordinates:'40722.8"N, 74722.8"W',verbatimLatitude:'40722.8"N',verbatimLongitude:'74722.8"W'},{verbatimCoordinates:"400722.8N740722.8W",verbatimLatitude:"400722.8N",verbatimLongitude:"740722.8W"},{verbatimCoordinates:"N 40 7.38 W 74 7.38",verbatimLatitude:"N 40 7.38",verbatimLongitude:"W 74 7.38"},{verbatimCoordinates:"40:7:22.8N 74:7:22.8W",verbatimLatitude:"40:7:22.8N",verbatimLongitude:"74:7:22.8W"},{verbatimCoordinates:"40:7:23N,74:7:23W",verbatimLatitude:"40:7:23N",verbatimLongitude:"74:7:23W",decimalLatitude:40.1230555555,decimalLongitude:-74.1230555555},{verbatimCoordinates:'40723"N 74723"W',verbatimLatitude:'40723"N',verbatimLongitude:'74723"W',decimalLatitude:40.1230555555,decimalLongitude:-74.12305555555555},{verbatimCoordinates:'40723"S 74723"E',verbatimLatitude:'40723"S',verbatimLongitude:'74723"E',decimalLatitude:-40.1230555555,decimalLongitude:74.12305555555555},{verbatimCoordinates:'40723" -74723"',verbatimLatitude:'40723"',verbatimLongitude:'-74723"',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:'40d 7 23" N 74d 7 23" W',verbatimLatitude:'40d 7 23" N',verbatimLongitude:'74d 7 23" W',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:"40.123N 74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"40 7.38, -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"40 7.38, -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"40 7 22.8; -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"}],HC={decimalLatitude:40.123,decimalLongitude:-74.123},WC=[{verbatimCoordinates:`504'17.698"south, 1424'2.826"east`,verbatimLatitude:`504'17.698"south`,verbatimLongitude:`1424'2.826"east`,decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"50d4m17.698S 14d24m2.826E",verbatimLatitude:"50d4m17.698S",verbatimLongitude:"14d24m2.826E",decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"40:26:46N,79:56:55W",verbatimLatitude:"40:26:46N",verbatimLongitude:"79:56:55W",decimalLatitude:40.44611111111111,decimalLongitude:-79.9486111111111},{verbatimCoordinates:"40:26:46.302N 79:56:55.903W",verbatimLatitude:"40:26:46.302N",verbatimLongitude:"79:56:55.903W",decimalLatitude:40.446195,decimalLongitude:-79.94886194444445},{verbatimCoordinates:"402647N 795836W",verbatimLatitude:"402647N",verbatimLongitude:"795836W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40d 26 47 N 79d 58 36 W",verbatimLatitude:"40d 26 47 N",verbatimLongitude:"79d 58 36 W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40.446195N 79.948862W",verbatimLatitude:"40.446195N",verbatimLongitude:"79.948862W",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40,446195 79,948862",verbatimLatitude:"40,446195",verbatimLongitude:"79,948862",decimalLatitude:40.446195,decimalLongitude:79.948862},{verbatimCoordinates:"40 26.7717, -79 56.93172",verbatimLatitude:"40 26.7717",verbatimLongitude:"-79 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.446195, -79.948862",verbatimLatitude:"40.446195",verbatimLongitude:"-79.948862",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.123256; -74.123256",verbatimLatitude:"40.123256",verbatimLongitude:"-74.123256",decimalLatitude:40.123256,decimalLongitude:-74.123256},{verbatimCoordinates:"1824S 2245E",verbatimLatitude:"1824S",verbatimLongitude:"2245E",decimalLatitude:-18.4,decimalLongitude:22.75}],KC=[{verbatimCoordinates:"10.432342S 10.6345345E",verbatimLatitude:"10.432342S",verbatimLongitude:"10.6345345E",decimalLatitude:-10.432342,decimalLongitude:10.6345345},{verbatimCoordinates:"10.00S 10.00E",verbatimLatitude:"10.00S",verbatimLongitude:"10.00E",decimalLatitude:-10,decimalLongitude:10},{verbatimCoordinates:"00.00S 01.00E",verbatimLatitude:"00.00S",verbatimLongitude:"01.00E",decimalLatitude:0,decimalLongitude:1},{verbatimCoordinates:"18.24S 22.45E",verbatimLatitude:"18.24S",verbatimLongitude:"22.45E",decimalLatitude:-18.4,decimalLongitude:22.75},{verbatimCoordinates:"27deg 15min 45.2sec S 18deg 32min 53.7sec E",verbatimLatitude:"27deg 15min 45.2sec S",verbatimLongitude:"18deg 32min 53.7sec E",decimalLatitude:-27.262555555555554,decimalLongitude:18.54825},{verbatimCoordinates:"-23.3245 S / 28.2344 E",verbatimLatitude:"-23.3245 S",verbatimLongitude:"28.2344 E",decimalLatitude:-23.3245,decimalLongitude:28.2344},{verbatimCoordinates:"40 26.7717 -79 56.93172",verbatimLatitude:"40 26.7717",verbatimLongitude:"-79 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"27.15.45S 18.32.53E",verbatimLatitude:"27.15.45S",verbatimLongitude:"18.32.53E",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"-27.15.45 18.32.53",verbatimLatitude:"-27.15.45",verbatimLongitude:"18.32.53",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"27.15.45.2S 18.32.53.4E",verbatimLatitude:"27.15.45.2S",verbatimLongitude:"18.32.53.4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"27.15.45,2S 18.32.53,4E",verbatimLatitude:"27.15.45,2S",verbatimLongitude:"18.32.53,4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"S23.43563   E22.45634 ",verbatimLatitude:"S23.43563 ",verbatimLongitude:"E22.45634 ",decimalLatitude:-23.43563,decimalLongitude:22.45634},{verbatimCoordinates:"27,71372 S 23,07771 E",verbatimLatitude:"27,71372 S",verbatimLongitude:"23,07771 E",decimalLatitude:-27.71372,decimalLongitude:23.07771},{verbatimCoordinates:"27.45.34 S 23.23.23 E",verbatimLatitude:"27.45.34 S",verbatimLongitude:"23.23.23 E",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"S 27.45.34 E 23.23.23",verbatimLatitude:"S 27.45.34",verbatimLongitude:"E 23.23.23",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"53 16.3863,4 52.8171",verbatimLatitude:"53 16.3863",verbatimLongitude:"4 52.8171",decimalLatitude:53.273105,decimalLongitude:4.88029},{verbatimCoordinates:"50 8.2914,-5 2.4447",verbatimLatitude:"50 8.2914",verbatimLongitude:"-5 2.4447",decimalLatitude:50.13819,decimalLongitude:-5.040745},{verbatimCoordinates:"N 48 30,6410', E 18 57,4583'",verbatimLatitude:"N 48 30,6410'",verbatimLongitude:"E 18 57,4583'",decimalLatitude:48.51068,decimalLongitude:18.95764},{verbatimCoordinates:"1.23456, 18.33453",verbatimLatitude:"1.23456",verbatimLongitude:"18.33453",decimalLatitude:1.23456,decimalLongitude:18.33453}];function XC(){const r=[];return GC.forEach(e=>{e.decimalLatitude?r.push(e):r.push({...e,...HC})}),[...r,...WC,...KC]}const JC=XC();ug.formats=JC.map(r=>r.verbatimCoordinates);const YC=ug;function Iy(r,e,t){const n=r.slice();return n[84]=e[t],n[86]=t,n}function Ay(r){let e,t;return e=new RC({}),{c(){ce(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){ue(e,n)}}}function Py(r){let e,t,n,i,o;return t=new BC({}),{c(){e=j("button"),ce(t.$$.fragment),ae(e,"type","button"),ae(e,"title",r[9]),ae(e,"class","svelte-bz0zu3"),jt(e,"active",r[0])},m(u,a){Z(u,e,a),le(t,e,null),n=!0,i||(o=Tt(e,"click",r[69]),i=!0)},p(u,a){(!n||a[0]&512)&&ae(e,"title",u[9]),(!n||a[0]&1)&&jt(e,"active",u[0])},i(u){n||(N(t.$$.fragment,u),n=!0)},o(u){V(t.$$.fragment,u),n=!1},d(u){u&&q(e),ue(t),i=!1,o()}}}function QC(r){let e,t=[],n=new Map,i,o,u,a=Rn(r[14]);const d=p=>p[84].id+(p[84].address?","+p[84].address:"");for(let p=0;p<a.length;p+=1){let g=Iy(r,a,p),y=d(g);n.set(y,t[p]=zy(y,g))}return{c(){e=j("ul");for(let p=0;p<t.length;p+=1)t[p].c();ae(e,"class","options svelte-bz0zu3")},m(p,g){Z(p,e,g);for(let y=0;y<t.length;y+=1)t[y]&&t[y].m(e,null);i=!0,o||(u=[Tt(e,"mouseleave",r[73]),Tt(e,"blur",r[74])],o=!0)},p(p,g){g[0]&17880064&&(a=Rn(p[14]),Kt(),t=gx(t,g,d,1,p,a,n,e,mx,zy,null,Iy),Xt())},i(p){if(!i){for(let g=0;g<a.length;g+=1)N(t[g]);i=!0}},o(p){for(let g=0;g<t.length;g+=1)V(t[g]);i=!1},d(p){p&&q(e);for(let g=0;g<t.length;g+=1)t[g].d();o=!1,ur(u)}}}function e6(r){let e,t,n,i,o,u;return t=new Wv({}),{c(){e=j("div"),ce(t.$$.fragment),n=ie(),i=j("div"),o=Ee(r[7]),ae(i,"class","svelte-bz0zu3"),ae(e,"class","no-results svelte-bz0zu3")},m(a,d){Z(a,e,d),le(t,e,null),D(e,n),D(e,i),D(i,o),u=!0},p(a,d){(!u||d[0]&128)&&gt(o,a[7])},i(a){u||(N(t.$$.fragment,a),u=!0)},o(a){V(t.$$.fragment,a),u=!1},d(a){a&&q(e),ue(t)}}}function t6(r){let e="",t;return{c(){t=Ee(e)},m(n,i){Z(n,t,i)},p:ot,i:ot,o:ot,d(n){n&&q(t)}}}function n6(r){let e,t,n,i,o,u,a,d,p,g,y;return t=new Wv({}),d=new Hv({}),{c(){e=j("div"),ce(t.$$.fragment),n=ie(),i=j("div"),o=Ee(r[6]),u=ie(),a=j("button"),ce(d.$$.fragment),ae(i,"class","svelte-bz0zu3"),ae(a,"class","svelte-bz0zu3"),ae(e,"class","error svelte-bz0zu3")},m(x,C){Z(x,e,C),le(t,e,null),D(e,n),D(e,i),D(i,o),D(e,u),D(e,a),le(d,a,null),p=!0,g||(y=Tt(a,"click",r[70]),g=!0)},p(x,C){(!p||C[0]&64)&&gt(o,x[6])},i(x){p||(N(t.$$.fragment,x),N(d.$$.fragment,x),p=!0)},o(x){V(t.$$.fragment,x),V(d.$$.fragment,x),p=!1},d(x){x&&q(e),ue(t),ue(d),g=!1,y()}}}function zy(r,e){let t,n,i;function o(){return e[71](e[86])}function u(){return e[72](e[84])}return n=new zC({props:{feature:e[84],showPlaceType:e[10],selected:e[15]===e[86],missingIconsCache:e[20],iconsBaseUrl:e[12]}}),n.$on("mouseenter",o),n.$on("focus",u),{key:r,first:null,c(){t=Xn(),ce(n.$$.fragment),this.first=t},m(a,d){Z(a,t,d),le(n,a,d),i=!0},p(a,d){e=a;const p={};d[0]&16384&&(p.feature=e[84]),d[0]&1024&&(p.showPlaceType=e[10]),d[0]&49152&&(p.selected=e[15]===e[86]),d[0]&4096&&(p.iconsBaseUrl=e[12]),n.$set(p)},i(a){i||(N(n.$$.fragment,a),i=!0)},o(a){V(n.$$.fragment,a),i=!1},d(a){a&&q(t),ue(n,a)}}}function r6(r){let e,t,n,i,o,u,a,d,p,g,y,x,C,M,F,z,E,P,$,U,K,ee=!1;o=new OC({}),y=new Hv({});let W=r[19]&&Ay(),J=r[5]==="button"&&Py(r);const he=r[61].default,Ae=mn(he,r,r[60],null),ne=[n6,t6,e6,QC],fe=[];function Ce(_e,Ze){var Oe,je;return _e[18]?0:_e[16]?((Oe=_e[14])==null?void 0:Oe.length)===0?2:_e[16]&&((je=_e[14])!=null&&je.length)?3:-1:1}return~(z=Ce(r))&&(E=fe[z]=ne[z](r)),{c(){e=ie(),t=j("form"),n=j("div"),i=j("button"),ce(o.$$.fragment),u=ie(),a=j("input"),d=ie(),p=j("div"),g=j("button"),ce(y.$$.fragment),x=ie(),W&&W.c(),C=ie(),J&&J.c(),M=ie(),Ae&&Ae.c(),F=ie(),E&&E.c(),ae(i,"class","search-button svelte-bz0zu3"),ae(i,"type","button"),ae(a,"placeholder",r[8]),ae(a,"aria-label",r[8]),ae(a,"class","svelte-bz0zu3"),ae(g,"type","button"),ae(g,"title",r[3]),ae(g,"class","svelte-bz0zu3"),ae(p,"class","clear-button-container svelte-bz0zu3"),jt(p,"displayable",r[1]!==""),ae(n,"class","input-group svelte-bz0zu3"),ae(t,"tabindex","0"),ae(t,"class",P=Bu(r[2])+" svelte-bz0zu3"),jt(t,"can-collapse",r[4]&&r[1]==="")},m(_e,Ze){Z(_e,e,Ze),Z(_e,t,Ze),D(t,n),D(n,i),le(o,i,null),D(n,u),D(n,a),r[63](a),Vn(a,r[1]),D(n,d),D(n,p),D(p,g),le(y,g,null),D(p,x),W&&W.m(p,null),D(n,C),J&&J.m(n,null),D(n,M),Ae&&Ae.m(n,null),D(t,F),~z&&fe[z].m(t,null),$=!0,U||(K=[Tt(i,"click",r[62]),Tt(a,"input",r[64]),Tt(a,"focus",r[65]),Tt(a,"blur",r[66]),Tt(a,"keydown",r[22]),Tt(a,"input",r[67]),Tt(g,"click",r[68]),Tt(t,"submit",Om(r[21]))],U=!0)},p(_e,Ze){(!$||Ze[0]&256)&&ae(a,"placeholder",_e[8]),(!$||Ze[0]&256)&&ae(a,"aria-label",_e[8]),Ze[0]&2&&a.value!==_e[1]&&Vn(a,_e[1]),(!$||Ze[0]&8)&&ae(g,"title",_e[3]),_e[19]?W?Ze[0]&524288&&N(W,1):(W=Ay(),W.c(),N(W,1),W.m(p,null)):W&&(Kt(),V(W,1,1,()=>{W=null}),Xt()),(!$||Ze[0]&2)&&jt(p,"displayable",_e[1]!==""),_e[5]==="button"?J?(J.p(_e,Ze),Ze[0]&32&&N(J,1)):(J=Py(_e),J.c(),N(J,1),J.m(n,M)):J&&(Kt(),V(J,1,1,()=>{J=null}),Xt()),Ae&&Ae.p&&(!$||Ze[1]&536870912)&&_n(Ae,he,_e,_e[60],$?gn(he,_e[60],Ze,null):yn(_e[60]),null);let Oe=z;z=Ce(_e),z===Oe?~z&&fe[z].p(_e,Ze):(E&&(Kt(),V(fe[Oe],1,1,()=>{fe[Oe]=null}),Xt()),~z?(E=fe[z],E?E.p(_e,Ze):(E=fe[z]=ne[z](_e),E.c()),N(E,1),E.m(t,null)):E=null),(!$||Ze[0]&4&&P!==(P=Bu(_e[2])+" svelte-bz0zu3"))&&ae(t,"class",P),(!$||Ze[0]&22)&&jt(t,"can-collapse",_e[4]&&_e[1]==="")},i(_e){$||(N(ee),N(o.$$.fragment,_e),N(y.$$.fragment,_e),N(W),N(J),N(Ae,_e),N(E),$=!0)},o(_e){V(ee),V(o.$$.fragment,_e),V(y.$$.fragment,_e),V(W),V(J),V(Ae,_e),V(E),$=!1},d(_e){_e&&(q(e),q(t)),ue(o),r[63](null),ue(y),W&&W.d(),J&&J.d(),Ae&&Ae.d(_e),~z&&fe[z].d(),U=!1,ur(K)}}}function i6(r,e,t){let n,i,{$$slots:o={},$$scope:u}=e;const a={continental_marine:4,country:4,major_landform:8,region:5,subregion:6,county:7,joint_municipality:8,joint_submunicipality:9,municipality:10,municipal_district:11,locality:12,neighbourhood:13,place:14,postal_code:14,road:16,poi:17,address:18,"poi.peak":15,"poi.shop":18,"poi.cafe":18,"poi.restaurant":18,"poi.aerodrome":13};let{class:d=void 0}=e,{apiKey:p}=e,{bbox:g=void 0}=e,{clearButtonTitle:y="clear"}=e,{clearOnBlur:x=!1}=e,{collapsed:C=!1}=e,{country:M=void 0}=e,{debounceSearch:F=200}=e,{enableReverse:z="never"}=e,{errorMessage:E="Something went wrong"}=e,{filter:P=()=>!0}=e,{flyTo:$=!0}=e,{fuzzyMatch:U=!0}=e,{language:K=void 0}=e,{limit:ee=void 0}=e,{mapController:W=void 0}=e,{minLength:J=2}=e,{noResultsMessage:he="Oops! Looks like you're trying to predict something that's not quite right. We can't seem to find what you're looking for. Maybe try double-checking your spelling or try a different search term. Keep on typing - we'll do our best to get you where you need to go!"}=e,{placeholder:Ae="Search"}=e,{proximity:ne=[{type:"server-geolocation"}]}=e,{reverseActive:fe=z==="always"}=e,{reverseButtonTitle:Ce="toggle reverse geocoding"}=e,{searchValue:_e=""}=e,{pickedResultStyle:Ze="full-geometry"}=e,{showPlaceType:Oe="if-needed"}=e,{showResultsWhileTyping:je=!0}=e,{selectFirst:De=!0}=e,{flyToSelected:At=!1}=e,{markerOnSelected:ut=!0}=e,{types:ht=void 0}=e,{exhaustiveReverseGeocoding:wt=!1}=e,{excludeTypes:pt=!1}=e,{zoom:Qe=a}=e,{apiUrl:Ft="https://api.maptiler.com/geocoding"}=e,{fetchParameters:bt={}}=e,{iconsBaseUrl:Bt="https://cdn.maptiler.com/maptiler-geocoding-control/v2.0.1/icons/"}=e,{adjustUrlQuery:Pt=()=>{}}=e;function Qt(){Ue.focus()}function vn(){Ue.blur()}function qt(Q,We=!0,Xe=!1){t(1,_e=Q),We?(t(15,it=-1),vt()):(on(!Xe,Xe),setTimeout(()=>{Ue.focus(),Ue.select()}))}function rn(){t(14,Je=void 0),t(56,ye=void 0),t(15,it=-1)}function Ge(){t(55,Et=[]),t(56,ye=void 0)}let qe=!1,Je,Et,ye,kn="",Ue,it=-1,Wt,cr=[],_r,yr,ni,jr;const xo=new Set,hr=Is();ti(()=>{W&&(W.setEventHandler(void 0),W.indicateReverse(!1),W.setSelectedMarker(-1),W.setFeatures(void 0,void 0,!1))});function vt(Q){if(yr&&(clearTimeout(yr),yr=void 0),it>-1&&Je)t(56,ye=Je[it]),t(1,_e=ye.place_type[0]==="reverse"?ye.place_name:ye.place_name.replace(/,.*/,"")),t(18,Wt=void 0),t(55,Et=void 0),t(15,it=-1);else if(_e){const We=Q||!Pr(_e);Mr(_e,{exact:!0}).then(()=>{t(55,Et=Je),t(56,ye=void 0),We&&zr()}).catch(Xe=>t(18,Wt=Xe))}}function Pr(Q){try{return YC(Q,6)}catch{return!1}}async function Mr(Q,{byId:We=!1,exact:Xe=!1}={}){t(18,Wt=void 0),_r==null||_r.abort();const tt=new AbortController;t(19,_r=tt);try{const lt=Pr(Q),Lt=new URLSearchParams;if(K!==void 0&&Lt.set("language",Array.isArray(K)?K.join(","):K??""),ht&&Lt.set("types",ht.join(",")),pt&&Lt.set("excludeTypes",String(pt)),g&&Lt.set("bbox",g.map(Fn=>Fn.toFixed(6)).join(",")),M&&Lt.set("country",Array.isArray(M)?M.join(","):M),!We&&!lt){const Fn=await jC(W,ne,tt);Fn&&Lt.set("proximity",Fn),(Xe||!je)&&Lt.set("autocomplete","false"),Lt.set("fuzzyMatch",String(U))}ee!==void 0&&(wt||!lt||(ht==null?void 0:ht.length)===1)&&Lt.set("limit",String(ee)),Lt.set("key",p),Pt(Lt);const Jt=Ft+"/"+encodeURIComponent(lt?lt.decimalLongitude+","+lt.decimalLatitude:Q)+".json?"+Lt.toString();if(Jt===kn){We?(t(14,Je=void 0),t(56,ye=cr[0])):t(14,Je=cr);return}kn=Jt;const cn=await fetch(Jt,{signal:tt.signal,...bt});if(!cn.ok)throw new Error(await cn.text());const Sn=await cn.json();hr("response",{url:Jt,featureCollection:Sn}),We?(t(14,Je=void 0),t(56,ye=Sn.features[0]),cr=[ye]):(t(14,Je=Sn.features.filter(P)),lt&&Je.unshift({type:"Feature",properties:{},id:"reverse_"+lt.decimalLongitude+"_"+lt.decimalLatitude,text:lt.decimalLatitude+", "+lt.decimalLongitude,place_name:lt.decimalLatitude+", "+lt.decimalLongitude,place_type:["reverse"],center:[lt.decimalLongitude,lt.decimalLatitude],bbox:[lt.decimalLongitude,lt.decimalLatitude,lt.decimalLongitude,lt.decimalLatitude],geometry:{type:"Point",coordinates:[lt.decimalLongitude,lt.decimalLatitude]}}),cr=Je,lt&&Ue.focus())}catch(lt){if(lt&&typeof lt=="object"&&"name"in lt&&lt.name==="AbortError")return;throw lt}finally{tt===_r&&t(19,_r=void 0)}}function zr(){var tt;if(!(Et!=null&&Et.length)||!$)return;const Q=[180,90,-180,-90],We=!Et.some(lt=>!lt.matching_text);let Xe;for(const lt of Et){const Lt=qn(lt);if(Xe=Xe===void 0?Lt:Lt===void 0?Xe:Math.max(Xe,Lt),We||!lt.matching_text)for(const Jt of[0,1,2,3])Q[Jt]=Math[Jt<2?"min":"max"](Q[Jt],((tt=lt.bbox)==null?void 0:tt[Jt])??lt.center[Jt%2])}W&&Et.length>0&&(ye&&Q[0]===Q[2]&&Q[1]===Q[3]?W.flyTo(ye.center,qn(ye)):W.fitBounds(xy(Q),50,Xe))}function qn(Q){var Xe;if(!Q.bbox||Q.bbox[0]!==Q.bbox[2]&&Q.bbox[1]!==Q.bbox[3])return;const We=Q.id.replace(/\..*/,"");return(Array.isArray((Xe=Q.properties)==null?void 0:Xe.categories)?Q.properties.categories.reduce((tt,lt)=>{const Lt=Qe[We+"."+lt];return tt===void 0?Lt:Lt===void 0?tt:Math.max(tt,Lt)},void 0):void 0)??Qe[We]}function It(Q){t(0,fe=z==="always"),t(14,Je=void 0),t(56,ye=void 0),t(15,it=-1),qt(Q[1].toFixed(6)+", "+NC(Q[0],[-180,180],!0).toFixed(6),!1,!0)}function fn(Q){if(!Je)return;let We=Q.key==="ArrowDown"?1:Q.key==="ArrowUp"?-1:0;We&&(it===(De?0:-1)&&We===-1&&t(15,it=Je.length),t(15,it+=We),it>=Je.length&&t(15,it=-1),it<0&&De&&t(15,it=0),Q.preventDefault())}function on(Q=!0,We=!1){if(t(18,Wt=void 0),je||We){if(yr&&clearTimeout(yr),_e.length<J)return;const Xe=_e;yr=window.setTimeout(()=>{Mr(Xe).catch(tt=>t(18,Wt=tt))},Q?F:0)}else t(14,Je=void 0),t(18,Wt=void 0)}function Qn(Q){t(56,ye=Q),t(1,_e=Q.place_name),t(15,it=-1)}const pi=()=>Ue.focus();function pn(Q){un[Q?"unshift":"push"](()=>{Ue=Q,t(17,Ue)})}function Di(){_e=this.value,t(1,_e),t(13,qe),t(28,x)}const er=()=>t(13,qe=!0),we=()=>t(13,qe=!1),re=()=>on(),se=()=>{t(1,_e=""),Ue.focus()},pe=()=>t(0,fe=!fe),xe=()=>t(18,Wt=void 0),Fe=Q=>t(15,it=Q),Be=Q=>Qn(Q),$e=()=>{De||t(15,it=-1)},Se=()=>{};return r.$$set=Q=>{"class"in Q&&t(2,d=Q.class),"apiKey"in Q&&t(26,p=Q.apiKey),"bbox"in Q&&t(27,g=Q.bbox),"clearButtonTitle"in Q&&t(3,y=Q.clearButtonTitle),"clearOnBlur"in Q&&t(28,x=Q.clearOnBlur),"collapsed"in Q&&t(4,C=Q.collapsed),"country"in Q&&t(29,M=Q.country),"debounceSearch"in Q&&t(30,F=Q.debounceSearch),"enableReverse"in Q&&t(5,z=Q.enableReverse),"errorMessage"in Q&&t(6,E=Q.errorMessage),"filter"in Q&&t(31,P=Q.filter),"flyTo"in Q&&t(32,$=Q.flyTo),"fuzzyMatch"in Q&&t(33,U=Q.fuzzyMatch),"language"in Q&&t(34,K=Q.language),"limit"in Q&&t(35,ee=Q.limit),"mapController"in Q&&t(36,W=Q.mapController),"minLength"in Q&&t(37,J=Q.minLength),"noResultsMessage"in Q&&t(7,he=Q.noResultsMessage),"placeholder"in Q&&t(8,Ae=Q.placeholder),"proximity"in Q&&t(38,ne=Q.proximity),"reverseActive"in Q&&t(0,fe=Q.reverseActive),"reverseButtonTitle"in Q&&t(9,Ce=Q.reverseButtonTitle),"searchValue"in Q&&t(1,_e=Q.searchValue),"pickedResultStyle"in Q&&t(39,Ze=Q.pickedResultStyle),"showPlaceType"in Q&&t(10,Oe=Q.showPlaceType),"showResultsWhileTyping"in Q&&t(40,je=Q.showResultsWhileTyping),"selectFirst"in Q&&t(11,De=Q.selectFirst),"flyToSelected"in Q&&t(41,At=Q.flyToSelected),"markerOnSelected"in Q&&t(42,ut=Q.markerOnSelected),"types"in Q&&t(43,ht=Q.types),"exhaustiveReverseGeocoding"in Q&&t(44,wt=Q.exhaustiveReverseGeocoding),"excludeTypes"in Q&&t(45,pt=Q.excludeTypes),"zoom"in Q&&t(46,Qe=Q.zoom),"apiUrl"in Q&&t(47,Ft=Q.apiUrl),"fetchParameters"in Q&&t(48,bt=Q.fetchParameters),"iconsBaseUrl"in Q&&t(12,Bt=Q.iconsBaseUrl),"adjustUrlQuery"in Q&&t(49,Pt=Q.adjustUrlQuery),"$$scope"in Q&&t(60,u=Q.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&32&&t(0,fe=z==="always"),r.$$.dirty[0]&268443648&&setTimeout(()=>{t(16,ni=qe),x&&!qe&&t(1,_e="")}),r.$$.dirty[0]&16386|r.$$.dirty[1]&64&&_e.length<J&&(t(56,ye=void 0),t(14,Je=void 0),t(18,Wt=void 0),t(55,Et=Je)),r.$$.dirty[1]&33554688&&Ze!=="marker-only"&&ye&&!ye.address&&ye.geometry.type==="Point"&&ye.place_type[0]!=="reverse"&&Mr(ye.id,{byId:!0}).catch(Q=>t(18,Wt=Q)),r.$$.dirty[1]&100663330&&(W&&ye&&ye.id!==jr&&$&&(!ye.bbox||ye.bbox[0]===ye.bbox[2]&&ye.bbox[1]===ye.bbox[3]?W.flyTo(ye.center,qn(ye)):W.fitBounds(xy(ye.bbox),50,qn(ye)),t(14,Je=void 0),t(55,Et=void 0),t(15,it=-1)),t(57,jr=ye==null?void 0:ye.id)),r.$$.dirty[0]&18432&&De&&Je!=null&&Je.length&&t(15,it=0),r.$$.dirty[0]&2&&t(15,it=-1),r.$$.dirty[0]&16384|r.$$.dirty[1]&16777216&&Et!==Je&&t(55,Et=void 0),r.$$.dirty[0]&81921|r.$$.dirty[1]&16777248&&W&&W.setEventHandler(Q=>{switch(Q.type){case"mapClick":fe&&It(Q.coordinates);break;case"markerClick":{const We=Je==null?void 0:Je.find(Xe=>Xe.id===Q.id);We&&Qn(We)}break;case"markerMouseEnter":Et&&t(15,it=ni?(Je==null?void 0:Je.findIndex(We=>We.id===Q.id))??-1:-1);break;case"markerMouseLeave":Et&&t(15,it=-1);break}}),r.$$.dirty[0]&49152&&t(58,i=Je==null?void 0:Je[it]),r.$$.dirty[1]&134218786&&W&&i&&$&&At&&W.flyTo(i.center,qn(i)),r.$$.dirty[1]&256&&t(59,n=Ze==="full-geometry-including-polygon-center-marker"),r.$$.dirty[1]&268437536&&(ut||W==null||W.setFeatures(void 0,void 0,n)),r.$$.dirty[1]&419432480&&W&&ut&&!Et&&(W.setFeatures(i?[i]:void 0,void 0,n),W.setSelectedMarker(i?0:-1)),r.$$.dirty[1]&318767136&&W&&W.setFeatures(Et,ye,n),r.$$.dirty[0]&32768|r.$$.dirty[1]&16777248&&Et&&W&&W.setSelectedMarker(it),r.$$.dirty[0]&2|r.$$.dirty[1]&32&&W){const Q=Pr(_e);W.setReverseMarker(Q?[Q.decimalLongitude,Q.decimalLatitude]:void 0)}r.$$.dirty[1]&134217728&&hr("select",{feature:i}),r.$$.dirty[1]&33554432&&hr("pick",{feature:ye}),r.$$.dirty[0]&81920&&hr("optionsvisibilitychange",{optionsVisible:ni&&!!Je}),r.$$.dirty[0]&16384&&hr("featureslisted",{features:Je}),r.$$.dirty[1]&16777216&&hr("featuresmarked",{features:Et}),r.$$.dirty[0]&1&&hr("reversetoggle",{reverse:fe}),r.$$.dirty[0]&2&&hr("querychange",{query:_e}),r.$$.dirty[0]&1|r.$$.dirty[1]&32&&W&&W.indicateReverse(fe)},[fe,_e,d,y,C,z,E,he,Ae,Ce,Oe,De,Bt,qe,Je,it,ni,Ue,Wt,_r,xo,vt,fn,on,Qn,a,p,g,x,M,F,P,$,U,K,ee,W,J,ne,Ze,je,At,ut,ht,wt,pt,Qe,Ft,bt,Pt,Qt,vn,qt,rn,Ge,Et,ye,jr,i,n,u,o,pi,pn,Di,er,we,re,se,pe,xe,Fe,Be,$e,Se]}class o6 extends St{constructor(e){super(),kt(this,e,i6,r6,_t,{ZOOM_DEFAULTS:25,class:2,apiKey:26,bbox:27,clearButtonTitle:3,clearOnBlur:28,collapsed:4,country:29,debounceSearch:30,enableReverse:5,errorMessage:6,filter:31,flyTo:32,fuzzyMatch:33,language:34,limit:35,mapController:36,minLength:37,noResultsMessage:7,placeholder:8,proximity:38,reverseActive:0,reverseButtonTitle:9,searchValue:1,pickedResultStyle:39,showPlaceType:10,showResultsWhileTyping:40,selectFirst:11,flyToSelected:41,markerOnSelected:42,types:43,exhaustiveReverseGeocoding:44,excludeTypes:45,zoom:46,apiUrl:47,fetchParameters:48,iconsBaseUrl:12,adjustUrlQuery:49,focus:50,blur:51,setQuery:52,clearList:53,clearMap:54},null,[-1,-1,-1])}get ZOOM_DEFAULTS(){return this.$$.ctx[25]}get focus(){return this.$$.ctx[50]}get blur(){return this.$$.ctx[51]}get setQuery(){return this.$$.ctx[52]}get clearList(){return this.$$.ctx[53]}get clearMap(){return this.$$.ctx[54]}}function Dy(r){let e,t,n;return t=new o6({props:{mapController:r[2],apiKey:r[0],country:r[1],types:r[3],proximity:[{type:"map-center"}]}}),{c(){e=j("div"),ce(t.$$.fragment),ae(e,"class","svelte-ixhnie")},m(i,o){Z(i,e,o),le(t,e,null),n=!0},p(i,o){const u={};o&4&&(u.mapController=i[2]),o&1&&(u.apiKey=i[0]),o&2&&(u.country=i[1]),t.$set(u)},i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){V(t.$$.fragment,i),n=!1},d(i){i&&q(e),ue(t)}}}function s6(r){let e,t,n=r[2]&&Dy(r);return{c(){n&&n.c(),e=Xn()},m(i,o){n&&n.m(i,o),Z(i,e,o),t=!0},p(i,[o]){i[2]?n?(n.p(i,o),o&4&&N(n,1)):(n=Dy(i),n.c(),N(n,1),n.m(e.parentNode,e)):n&&(Kt(),V(n,1,1,()=>{n=null}),Xt())},i(i){t||(N(n),t=!0)},o(i){V(n),t=!1},d(i){i&&q(e),n&&n.d(i)}}}function a6(r,e,t){let n,{apiKey:i}=e,{map:o}=e,{country:u}=e,a=["continental_marine","country","major_landform","region","subregion","county","joint_municipality","joint_submunicipality","municipality","municipal_district","locality","neighbourhood","place","postal_code","address","road","poi"];function d(p){return p?Gv(p,ei,!0,!0,{duration:1e3},{duration:1e3}):null}return r.$$set=p=>{"apiKey"in p&&t(0,i=p.apiKey),"map"in p&&t(4,o=p.map),"country"in p&&t(1,u=p.country)},r.$$.update=()=>{r.$$.dirty&16&&t(2,n=d(o))},[i,u,n,a,o]}class l6 extends St{constructor(e){super(),kt(this,e,a6,s6,_t,{apiKey:0,map:4,country:1})}}const u6=Symbol.for("svelte-maplibre");function c6(){return Th(u6)}function h6(r){return"layerType"in r&&r.layerType==="deckgl"}const f6=r=>({features:r[0]&16,data:r[0]&16,map:r[0]&4,close:r[0]&1}),Ry=r=>{var e;return{features:r[4],data:(e=r[4])==null?void 0:e[0],map:r[2],close:r[31]}};function Fy(r){let e,t,n=(r[4]||r[3]instanceof ei.Marker)&&By(r);return{c(){e=j("div"),n&&n.c()},m(i,o){Z(i,e,o),n&&n.m(e,null),r[32](e),t=!0},p(i,o){i[4]||i[3]instanceof ei.Marker?n?(n.p(i,o),o[0]&24&&N(n,1)):(n=By(i),n.c(),N(n,1),n.m(e,null)):n&&(Kt(),V(n,1,1,()=>{n=null}),Xt())},i(i){t||(N(n),t=!0)},o(i){V(n),t=!1},d(i){i&&q(e),n&&n.d(),r[32](null)}}}function By(r){let e;const t=r[30].default,n=mn(t,r,r[29],Ry);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o[0]&536870933)&&_n(n,t,i,i[29],e?gn(t,i[29],o,f6):yn(i[29]),Ry)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function d6(r){let e,t,n=r[9].default&&Fy(r);return{c(){n&&n.c(),e=Xn()},m(i,o){n&&n.m(i,o),Z(i,e,o),t=!0},p(i,o){i[9].default?n?(n.p(i,o),o[0]&512&&N(n,1)):(n=Fy(i),n.c(),N(n,1),n.m(e.parentNode,e)):n&&(Kt(),V(n,1,1,()=>{n=null}),Xt())},i(i){t||(N(n),t=!0)},o(i){V(n),t=!1},d(i){i&&q(e),n&&n.d(i)}}}function p6(r,e,t){let n,i,o,u,a,d,{$$slots:p={},$$scope:g}=e;const y=$m(p);let{closeButton:x=void 0}=e,{closeOnClickOutside:C=!0}=e,{closeOnClickInside:M=!1}=e,{closeOnMove:F=!1}=e,{openOn:z="click"}=e,{openIfTopMost:E=!0}=e,{focusAfterOpen:P=!0}=e,{anchor:$=void 0}=e,{offset:U=void 0}=e,{popupClass:K=void 0}=e,{maxWidth:ee=void 0}=e,{lngLat:W=void 0}=e,{html:J=void 0}=e,{open:he=!1}=e;const Ae=Is(),{map:ne,popupTarget:fe,layerEvent:Ce,layer:_e,eventTopMost:Ze}=c6();st(r,ne,qe=>t(2,o=qe)),st(r,fe,qe=>t(3,a=qe)),st(r,Ce,qe=>t(28,u=qe)),st(r,_e,qe=>t(35,d=qe));const Oe=["click","dblclick","contextmenu"];let je,De=!1,At;function ut(){if(!je)return;let qe=je.getElement();!qe||qe===At||(At=qe,z==="hover"&&(At.style.pointerEvents="none"),At.addEventListener("mouseenter",()=>{t(24,De=!0)},{passive:!0}),At.addEventListener("mouseleave",()=>{t(24,De=!1)},{passive:!0}),At.addEventListener("click",()=>{M&&t(0,he=!1)},{passive:!0}))}Es(()=>{if(o)return o.on("click",vn),o.on("contextmenu",vn),typeof a=="string"&&(o.on("click",a,Qe),o.on("dblclick",a,Qe),o.on("contextmenu",a,Qe),o.on("mousemove",a,Qt),o.on("mouseleave",a,Pt),o.on("touchstart",a,bt),o.on("touchend",a,Bt)),()=>{o!=null&&o.loaded()&&(je==null||je.remove(),o.off("click",vn),o.off("contextmenu",vn),a instanceof ei.Marker?a.getPopup()===je&&a.setPopup(void 0):typeof a=="string"&&(o.off("click",a,Qe),o.off("dblclick",a,Qe),o.off("contextmenu",a,Qe),o.off("mousemove",a,Qt),o.off("mouseleave",a,Pt),o.off("touchstart",a,bt),o.off("touchend",a,Bt)))}});function ht(qe){return E?!("marker"in qe)&&!h6(qe)&&Ze(qe)!==d:!1}let wt=null,pt="normal";function Qe(qe){qe.type===z&&(ht(qe)||("layerType"in qe?qe.layerType==="deckgl"?(t(10,W=qe.coordinate),t(4,wt=qe.object?[qe.object]:null)):(t(10,W=qe.lngLat),t(4,wt=qe.features??[])):(t(10,W=qe.lngLat),t(4,wt=qe.features??[])),setTimeout(()=>t(0,he=!0))))}let Ft=null;function bt(qe){Ft=qe.point}function Bt(qe){if(!Ft||z!=="hover")return;let Je=Ft.dist(qe.point);Ft=null,Je<3&&(t(10,W=qe.lngLat),t(4,wt=qe.features??[]),je.isOpen()?t(25,pt="justOpened"):(t(25,pt="opening"),t(0,he=!0)))}function Pt(qe){z!=="hover"||Ft||pt!=="normal"||(t(0,he=!1),t(4,wt=null))}function Qt(qe){if(!(z!=="hover"||Ft||pt!=="normal")){if(ht(qe)){t(0,he=!1),t(4,wt=null);return}t(0,he=!0),t(4,wt=qe.features??[]),t(10,W=qe.lngLat)}}function vn(qe){if(pt==="justOpened"){t(25,pt="normal");return}if(!C)return;let Je=[At,a instanceof ei.Marker?a==null?void 0:a.getElement():null];he&&je.isOpen()&&!Je.some(Et=>Et==null?void 0:Et.contains(qe.originalEvent.target))&&(qe.type==="contextmenu"&&z==="contextmenu"||qe.type!=="contextmenu")&&t(0,he=!1)}ti(()=>{o&&(je!=null&&je.isOpen())&&je.remove()});let qt;const rn=()=>t(0,he=!1);function Ge(qe){un[qe?"unshift":"push"](()=>{qt=qe,t(1,qt)})}return r.$$set=qe=>{"closeButton"in qe&&t(11,x=qe.closeButton),"closeOnClickOutside"in qe&&t(12,C=qe.closeOnClickOutside),"closeOnClickInside"in qe&&t(13,M=qe.closeOnClickInside),"closeOnMove"in qe&&t(14,F=qe.closeOnMove),"openOn"in qe&&t(15,z=qe.openOn),"openIfTopMost"in qe&&t(16,E=qe.openIfTopMost),"focusAfterOpen"in qe&&t(17,P=qe.focusAfterOpen),"anchor"in qe&&t(18,$=qe.anchor),"offset"in qe&&t(19,U=qe.offset),"popupClass"in qe&&t(20,K=qe.popupClass),"maxWidth"in qe&&t(21,ee=qe.maxWidth),"lngLat"in qe&&t(10,W=qe.lngLat),"html"in qe&&t(22,J=qe.html),"open"in qe&&t(0,he=qe.open),"$$scope"in qe&&t(29,g=qe.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&14336&&t(27,n=x??(!C&&!M)),r.$$.dirty[0]&146685952&&(je||(t(23,je=new ei.Popup({closeButton:n,closeOnClick:!1,closeOnMove:F,focusAfterOpen:P,maxWidth:ee,className:K,anchor:$,offset:U})),At=je.getElement(),je.on("open",()=>{t(0,he=!0),ut(),Ae("open",je)}),je.on("close",()=>{t(0,he=!1),Ae("close",je)}),je.on("hover",()=>{Ae("hover",je)}))),r.$$.dirty[0]&8421384&&je&&a instanceof ei.Marker&&(z==="click"?a.setPopup(je):a.getPopup()===je&&a.setPopup(void 0)),r.$$.dirty[0]&268468224&&Oe.includes(z)&&(u==null?void 0:u.type)===z&&(Qe(u),an(Ce,u=null,u)),r.$$.dirty[0]&268468224&&t(26,i=z==="hover"&&((u==null?void 0:u.type)==="mousemove"||(u==null?void 0:u.type)==="mouseenter")),r.$$.dirty[0]&352354304&&z==="hover"&&Ce&&(i&&u&&(u.layerType==="deckgl"?(t(10,W=u.coordinate),t(4,wt=u.object?[u.object]:null)):(t(10,W=u.lngLat),t(4,wt=u.features??[]))),t(0,he=(i||De)??!1)),r.$$.dirty[0]&12582914&&(qt?je.setDOMContent(qt):J&&je.setHTML(J)),r.$$.dirty[0]&8389632&&W&&je.setLngLat(W),r.$$.dirty[0]&41943045&&o){let qe=je.isOpen();he&&!qe?(je.addTo(o),pt==="opening"&&t(25,pt="justOpened")):!he&&qe&&je.remove()}},[he,qt,o,a,wt,ne,fe,Ce,_e,y,W,x,C,M,F,z,E,P,$,U,K,ee,J,je,De,pt,i,n,u,g,p,rn,Ge]}class m6 extends St{constructor(e){super(),kt(this,e,p6,d6,_t,{closeButton:11,closeOnClickOutside:12,closeOnClickInside:13,closeOnMove:14,openOn:15,openIfTopMost:16,focusAfterOpen:17,anchor:18,offset:19,popupClass:20,maxWidth:21,lngLat:10,html:22,open:0},null,[-1,-1])}}const g6=r=>({props:r&8}),$y=r=>({props:b6(r[3])});function _6(r){let e;const t=r[1].default,n=mn(t,r,r[2],$y);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&12)&&_n(n,t,i,i[2],e?gn(t,i[2],o,g6):yn(i[2]),$y)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function y6(r){let e,t;return e=new m6({props:{openOn:r[0],$$slots:{default:[_6,({features:n})=>({3:n}),({features:n})=>n?8:0]},$$scope:{ctx:r}}}),{c(){ce(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p(n,[i]){const o={};i&1&&(o.openOn=n[0]),i&12&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){ue(e,n)}}}function b6(r){return r?r[0].properties??{}:(console.log("A Popup with null features should be impossible"),{})}function v6(r,e,t){let{$$slots:n={},$$scope:i}=e,{openOn:o="hover"}=e;return r.$$set=u=>{"openOn"in u&&t(0,o=u.openOn),"$$scope"in u&&t(2,i=u.$$scope)},[o,n,i]}class di extends St{constructor(e){super(),kt(this,e,v6,y6,_t,{openOn:0})}}function $o(r,e,t){let n=["match",r];for(let[i,o]of Object.entries(e))n.push(i),n.push(o);return n.push(t),n}function co(r,e,t){let n=["step",r];for(let i=1;i<e.length;i++)n.push(t[i-1]),n.push(e[i]);return n.push(t[t.length-1]),n}function Ji(){return{type:"FeatureCollection",features:[]}}function w6(r){let e,t,n;return t=new No({props:{colorScale:r[3].colorScale,labels:{limits:r[3].limits}}}),{c(){e=j("div"),ce(t.$$.fragment),ae(e,"slot","legend")},m(i,o){Z(i,e,o),le(t,e,null),n=!0},p:ot,i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){V(t.$$.fragment,i),n=!1},d(i){i&&q(e),ue(t)}}}function x6(r){let e;return{c(){e=j("p"),e.innerHTML='<a href="https://nptscot.github.io/manual/#infrastructureandtraffic" target="_blank">Data from NPT</a>',ae(e,"slot","help")},m(t,n){Z(t,e,n)},p:ot,d(t){t&&q(e)}}}function k6(r){let e,t,n;return t=new No({props:{colorScale:Object.values(r[4]),labels:{buckets:Object.keys(r[4])},fullWidthBucketLegend:!0}}),{c(){e=j("div"),ce(t.$$.fragment),ae(e,"slot","legend")},m(i,o){Z(i,e,o),le(t,e,null),n=!0},p:ot,i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){V(t.$$.fragment,i),n=!1},d(i){i&&q(e),ue(t)}}}function S6(r){let e;return{c(){e=j("p"),e.innerHTML='<a href="https://nptscot.github.io/manual/#infrastructureandtraffic" target="_blank">Data from NPT</a>',ae(e,"slot","help")},m(t,n){Z(t,e,n)},p:ot,d(t){t&&q(e)}}}function T6(r){let e,t,n;return t=new ig({props:{labelColors:r[5]}}),{c(){e=j("div"),ce(t.$$.fragment),ae(e,"slot","legend")},m(i,o){Z(i,e,o),le(t,e,null),n=!0},p:ot,i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){V(t.$$.fragment,i),n=!1},d(i){i&&q(e),ue(t)}}}function C6(r){let e;return{c(){e=j("p"),e.innerHTML='<a href="https://nptscot.github.io/manual/#infrastructureandtraffic" target="_blank">Data from NPT</a>',ae(e,"slot","help")},m(t,n){Z(t,e,n)},p:ot,d(t){t&&q(e)}}}function M6(r){let e,t,n,i,o,u;const a=[dn("context-traffic"),{sourceLayer:"cbd_layer"},{filter:["has","Traffic volume category"]},{paint:{"line-color":$o(["get","Traffic volume category"],{"0 to 1999":r[3].colorScale[0],"2000 to 3999":r[3].colorScale[1],"4000+":r[3].colorScale[2]},"cyan"),"line-width":Hs(0)}},{layout:{visibility:r[0]?"visible":"none"}}];let d={};for(let C=0;C<a.length;C+=1)d=Mt(d,a[C]);e=new sr({props:d});const p=[dn("context-los"),{sourceLayer:"cbd_layer"},{paint:{"line-color":$o(["get","Level of Service"],r[4],"cyan"),"line-width":Hs(1)}},{layout:{visibility:r[1]?"visible":"none"}}];let g={};for(let C=0;C<p.length;C+=1)g=Mt(g,p[C]);n=new sr({props:g});const y=[dn("context-existing-infra"),{sourceLayer:"cbd_layer"},{filter:["!=",["get","Infrastructure type"],"Mixed Traffic Street"]},{paint:{"line-color":$o(["get","Infrastructure type"],r[5],"cyan"),"line-width":Hs(1)}},{layout:{visibility:r[2]?"visible":"none"}}];let x={};for(let C=0;C<y.length;C+=1)x=Mt(x,y[C]);return o=new sr({props:x}),{c(){ce(e.$$.fragment),t=ie(),ce(n.$$.fragment),i=ie(),ce(o.$$.fragment)},m(C,M){le(e,C,M),Z(C,t,M),le(n,C,M),Z(C,i,M),le(o,C,M),u=!0},p(C,M){const F=M&9?En(a,[a[0],a[1],a[2],M&8&&{paint:{"line-color":$o(["get","Traffic volume category"],{"0 to 1999":C[3].colorScale[0],"2000 to 3999":C[3].colorScale[1],"4000+":C[3].colorScale[2]},"cyan"),"line-width":Hs(0)}},M&1&&{layout:{visibility:C[0]?"visible":"none"}}]):{};e.$set(F);const z=M&18?En(p,[p[0],p[1],M&16&&{paint:{"line-color":$o(["get","Level of Service"],C[4],"cyan"),"line-width":Hs(1)}},M&2&&{layout:{visibility:C[1]?"visible":"none"}}]):{};n.$set(z);const E=M&36?En(y,[y[0],y[1],y[2],M&32&&{paint:{"line-color":$o(["get","Infrastructure type"],C[5],"cyan"),"line-width":Hs(1)}},M&4&&{layout:{visibility:C[2]?"visible":"none"}}]):{};o.$set(E)},i(C){u||(N(e.$$.fragment,C),N(n.$$.fragment,C),N(o.$$.fragment,C),u=!0)},o(C){V(e.$$.fragment,C),V(n.$$.fragment,C),V(o.$$.fragment,C),u=!1},d(C){C&&(q(t),q(i)),ue(e,C),ue(n,C),ue(o,C)}}}function L6(r){let e,t,n,i,o,u,a,d,p,g,y;function x(P){r[6](P)}let C={label:"Traffic",$$slots:{help:[x6],legend:[w6]},$$scope:{ctx:r}};r[0]!==void 0&&(C.show=r[0]),e=new ts({props:C}),un.push(()=>Pn(e,"show",x));function M(P){r[7](P)}let F={label:"Level of Service",$$slots:{help:[S6],legend:[k6]},$$scope:{ctx:r}};r[1]!==void 0&&(F.show=r[1]),i=new ts({props:F}),un.push(()=>Pn(i,"show",M));function z(P){r[8](P)}let E={label:"Cycle infrastructure",$$slots:{help:[C6],legend:[T6]},$$scope:{ctx:r}};return r[2]!==void 0&&(E.show=r[2]),a=new ts({props:E}),un.push(()=>Pn(a,"show",z)),g=new Ih({props:{url:`pmtiles://${Bo("cnt_layers/cbd.pmtiles")}`,$$slots:{default:[M6]},$$scope:{ctx:r}}}),{c(){ce(e.$$.fragment),n=ie(),ce(i.$$.fragment),u=ie(),ce(a.$$.fragment),p=ie(),ce(g.$$.fragment)},m(P,$){le(e,P,$),Z(P,n,$),le(i,P,$),Z(P,u,$),le(a,P,$),Z(P,p,$),le(g,P,$),y=!0},p(P,[$]){const U={};$&512&&(U.$$scope={dirty:$,ctx:P}),!t&&$&1&&(t=!0,U.show=P[0],An(()=>t=!1)),e.$set(U);const K={};$&512&&(K.$$scope={dirty:$,ctx:P}),!o&&$&2&&(o=!0,K.show=P[1],An(()=>o=!1)),i.$set(K);const ee={};$&512&&(ee.$$scope={dirty:$,ctx:P}),!d&&$&4&&(d=!0,ee.show=P[2],An(()=>d=!1)),a.$set(ee);const W={};$&519&&(W.$$scope={dirty:$,ctx:P}),g.$set(W)},i(P){y||(N(e.$$.fragment,P),N(i.$$.fragment,P),N(a.$$.fragment,P),N(g.$$.fragment,P),y=!0)},o(P){V(e.$$.fragment,P),V(i.$$.fragment,P),V(a.$$.fragment,P),V(g.$$.fragment,P),y=!1},d(P){P&&(q(n),q(u),q(p)),ue(e,P),ue(i,P),ue(a,P),ue(g,P)}}}function E6(r,e,t){let n=!1,i=!1,o=!1,u={colorScale:["#27918d","#ffaa33","#440154"],limits:[0,2e3,4e3,1e4]},a={High:"mediumseagreen",Medium:"orange",Low:"red","Should not be used":"brown"},d={"Segregated Track (wide)":"#054d05","Off Road Cycleway":"#3a9120","Segregated Track (narrow)":"#87d668","Shared Footway":"#ffbf00","Painted Cycle Lane":"#7faedd"};function p(x){n=x,t(0,n)}function g(x){i=x,t(1,i)}function y(x){o=x,t(2,o)}return[n,i,o,u,a,d,p,g,y]}class I6 extends St{constructor(e){super(),kt(this,e,E6,L6,_t,{})}}function A6(r){let e,t,n;return t=new ig({props:{labelColors:r[2],swatchClass:"circle"}}),{c(){e=j("div"),ce(t.$$.fragment),ae(e,"slot","legend")},m(i,o){Z(i,e,o),le(t,e,null),n=!0},p:ot,i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){V(t.$$.fragment,i),n=!1},d(i){i&&q(e),ue(t)}}}function P6(r){let e;return{c(){e=j("p"),e.innerHTML=`See Scottish data sources for
    <a href="https://www.data.gov.uk/dataset/9a6f9d86-9698-4a5d-a2c8-89f3b212c52c/scottish-school-roll-and-locations" target="_blank">schools</a>
    ,
    <a href="https://data.spatialhub.scot/dataset/gp_practices-is" target="_blank">GP practices</a>
    , and
    <a href="https://data.spatialhub.scot/dataset/nhs_hospitals-is" target="_blank">hospitals</a>
    . Other data is from
    <a href="https://www.openstreetmap.org/about" target="_blank">OpenStreetMap</a>
    .`,ae(e,"slot","help")},m(t,n){Z(t,e,n)},p:ot,d(t){t&&q(e)}}}function Oy(r){let e,t;return e=new mr({props:{data:r[1].getPOIs(),generateId:!0,$$slots:{default:[R6]},$$scope:{ctx:r}}}),{c(){ce(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p(n,i){const o={};i&2&&(o.data=n[1].getPOIs()),i&33&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){ue(e,n)}}}function z6(r){let e=(r[4].name||`unnamed ${r[4].kind}`)+"",t;return{c(){t=Ee(e)},m(n,i){Z(n,t,i)},p(n,i){i&16&&e!==(e=(n[4].name||`unnamed ${n[4].kind}`)+"")&&gt(t,e)},d(n){n&&q(t)}}}function D6(r){let e,t;return e=new di({props:{openOn:"hover",$$slots:{default:[z6,({props:n})=>({4:n}),({props:n})=>n?16:0]},$$scope:{ctx:r}}}),{c(){ce(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p(n,i){const o={};i&48&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){ue(e,n)}}}function R6(r){let e,t;const n=[dn("context-pois"),{paint:{"circle-color":$o(["get","kind"],r[2],"black"),"circle-radius":10,"circle-stroke-color":"black","circle-stroke-width":1}},{layout:{visibility:r[0]?"visible":"none"}}];let i={$$slots:{default:[D6]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=Mt(i,n[o]);return e=new xl({props:i}),{c(){ce(e.$$.fragment)},m(o,u){le(e,o,u),t=!0},p(o,u){const a=u&5?En(n,[n[0],u&4&&{paint:{"circle-color":$o(["get","kind"],o[2],"black"),"circle-radius":10,"circle-stroke-color":"black","circle-stroke-width":1}},u&1&&{layout:{visibility:o[0]?"visible":"none"}}]):{};u&32&&(a.$$scope={dirty:u,ctx:o}),e.$set(a)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){ue(e,o)}}}function F6(r){let e,t,n,i,o;function u(p){r[3](p)}let a={label:"POIs",$$slots:{help:[P6],legend:[A6]},$$scope:{ctx:r}};r[0]!==void 0&&(a.show=r[0]),e=new ts({props:a}),un.push(()=>Pn(e,"show",u));let d=r[1]&&Oy(r);return{c(){ce(e.$$.fragment),n=ie(),d&&d.c(),i=Xn()},m(p,g){le(e,p,g),Z(p,n,g),d&&d.m(p,g),Z(p,i,g),o=!0},p(p,[g]){const y={};g&32&&(y.$$scope={dirty:g,ctx:p}),!t&&g&1&&(t=!0,y.show=p[0],An(()=>t=!1)),e.$set(y),p[1]?d?(d.p(p,g),g&2&&N(d,1)):(d=Oy(p),d.c(),N(d,1),d.m(i.parentNode,i)):d&&(Kt(),V(d,1,1,()=>{d=null}),Xt())},i(p){o||(N(e.$$.fragment,p),N(d),o=!0)},o(p){V(e.$$.fragment,p),V(d),o=!1},d(p){p&&(q(n),q(i)),ue(e,p),d&&d.d(p)}}}function B6(r,e,t){let n;st(r,Cr,a=>t(1,n=a));let i=!1,o={School:"#7fc97f",GP:"#beaed4",Hospital:"#fdc086",Grocery:"#386cb0",CommunityCenter:"#ffff99"};function u(a){i=a,t(0,i)}return[i,n,o,u]}class $6 extends St{constructor(e){super(),kt(this,e,B6,F6,_t,{})}}function O6(r){let e,t,n,i,o;return t=new No({props:{colorScale:Md,labels:{buckets:Iv(Ld)}}}),{c(){e=j("div"),ce(t.$$.fragment),n=ie(),i=j("div"),i.innerHTML="<span>More deprived</span> <span>Less deprived</span>",Ye(i,"display","flex"),Ye(i,"justify-content","space-between"),ae(e,"slot","legend")},m(u,a){Z(u,e,a),le(t,e,null),D(e,n),D(e,i),o=!0},p:ot,i(u){o||(N(t.$$.fragment,u),o=!0)},o(u){V(t.$$.fragment,u),o=!1},d(u){u&&q(e),ue(t)}}}function N6(r){let e;return{c(){e=j("p"),e.innerHTML=`This shows the Scottish Index of Multiple Deprivation (SIMD) from <a href="https://www.data.gov.uk/dataset/1102bf85-ed49-440a-b211-da87e8d752eb/scottish-index-of-multiple-deprivation-simd-2020" target="_blank">2020 data</a>
    . SIMD combines different domains: income; employment; health; education, skills
    and training; geographic access to services; crime; and housing.`,ae(e,"slot","help")},m(t,n){Z(t,e,n)},p:ot,d(t){t&&q(e)}}}function j6(r){let e,t,n,i,o;return t=new No({props:{colorScale:Ed,labels:{limits:Id}}}),{c(){e=j("div"),ce(t.$$.fragment),n=ie(),i=j("div"),i.innerHTML="<span>Less dense</span> <span>people / km</span> <span>More dense</span>",Ye(i,"display","flex"),Ye(i,"justify-content","space-between"),ae(e,"slot","legend")},m(u,a){Z(u,e,a),le(t,e,null),D(e,n),D(e,i),o=!0},p:ot,i(u){o||(N(t.$$.fragment,u),o=!0)},o(u){V(t.$$.fragment,u),o=!1},d(u){u&&q(e),ue(t)}}}function U6(r){let e;return{c(){e=j("p"),e.innerHTML=`This shows population data from <a href="https://www.data.gov.uk/dataset/1102bf85-ed49-440a-b211-da87e8d752eb/scottish-index-of-multiple-deprivation-simd-2020" target="_blank">2020 data</a>
    .`,ae(e,"slot","help")},m(t,n){Z(t,e,n)},p:ot,d(t){t&&q(e)}}}function V6(r){let e,t,n,i,o;return t=new No({props:{colorScale:Pd,labels:{limits:Ad.map(Q6)}}}),{c(){e=j("div"),ce(t.$$.fragment),n=ie(),i=j("div"),i.innerHTML='<span style="text-align: center; width: 100%">Households with at least one car or van</span>',Ye(i,"display","flex"),Ye(i,"justify-content","space-between"),ae(e,"slot","legend")},m(u,a){Z(u,e,a),le(t,e,null),D(e,n),D(e,i),o=!0},p:ot,i(u){o||(N(t.$$.fragment,u),o=!0)},o(u){V(t.$$.fragment,u),o=!1},d(u){u&&q(e),ue(t)}}}function q6(r){let e;return{c(){e=j("p"),e.textContent="Show households from the Scottish census with at least one car.",ae(e,"slot","help")},m(t,n){Z(t,e,n)},p:ot,d(t){t&&q(e)}}}function Z6(r){let e,t,n=r[6].id+"",i,o,u=r[6].population.toLocaleString()+"",a,d,p=r[6].imd_rank+"",g,y,x=r[6].imd_percentile+"",C,M;return{c(){e=j("p"),t=Ee("Data zone "),i=Ee(n),o=Ee(`
        has `),a=Ee(u),d=Ee(`
        people, and a SIMD rank of `),g=Ee(p),y=Ee(`, making it less deprived
        than `),C=Ee(x),M=Ee("% of data zones.")},m(F,z){Z(F,e,z),D(e,t),D(e,i),D(e,o),D(e,a),D(e,d),D(e,g),D(e,y),D(e,C),D(e,M)},p(F,z){z&64&&n!==(n=F[6].id+"")&&gt(i,n),z&64&&u!==(u=F[6].population.toLocaleString()+"")&&gt(a,u),z&64&&p!==(p=F[6].imd_rank+"")&&gt(g,p),z&64&&x!==(x=F[6].imd_percentile+"")&&gt(C,x)},d(F){F&&q(e)}}}function G6(r){let e,t;return e=new di({props:{openOn:"hover",$$slots:{default:[Z6,({props:n})=>({6:n}),({props:n})=>n?64:0]},$$scope:{ctx:r}}}),{c(){ce(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p(n,i){const o={};i&192&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){ue(e,n)}}}function H6(r){let e,t,n=r[6].id+"",i,o,u=Nu(r[6].households_with_cars_or_vans,r[6].total_households)+"",a,d,p=r[6].total_households.toLocaleString()+"",g,y;return{c(){e=j("p"),t=Ee("In data zone "),i=Ee(n),o=ie(),a=Ee(u),d=Ee(" of approximately "),g=Ee(p),y=Ee(`
        households have at least one car or van.`)},m(x,C){Z(x,e,C),D(e,t),D(e,i),D(e,o),D(e,a),D(e,d),D(e,g),D(e,y)},p(x,C){C&64&&n!==(n=x[6].id+"")&&gt(i,n),C&64&&u!==(u=Nu(x[6].households_with_cars_or_vans,x[6].total_households)+"")&&gt(a,u),C&64&&p!==(p=x[6].total_households.toLocaleString()+"")&&gt(g,p)},d(x){x&&q(e)}}}function W6(r){let e,t;return e=new di({props:{openOn:"hover",$$slots:{default:[H6,({props:n})=>({6:n}),({props:n})=>n?64:0]},$$scope:{ctx:r}}}),{c(){ce(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p(n,i){const o={};i&192&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){ue(e,n)}}}function K6(r){let e,t,n=r[6].id+"",i,o,u=r[6].population.toLocaleString()+"",a,d,p=Math.round(r[6].population/(r[6].area/1e6)).toLocaleString()+"",g,y;return{c(){e=j("p"),t=Ee("Data zone "),i=Ee(n),o=Ee(`
        has `),a=Ee(u),d=Ee(`
        people, with a density of `),g=Ee(p),y=Ee(" people per square kilometer")},m(x,C){Z(x,e,C),D(e,t),D(e,i),D(e,o),D(e,a),D(e,d),D(e,g),D(e,y)},p(x,C){C&64&&n!==(n=x[6].id+"")&&gt(i,n),C&64&&u!==(u=x[6].population.toLocaleString()+"")&&gt(a,u),C&64&&p!==(p=Math.round(x[6].population/(x[6].area/1e6)).toLocaleString()+"")&&gt(g,p)},d(x){x&&q(e)}}}function X6(r){let e,t;return e=new di({props:{openOn:"hover",$$slots:{default:[K6,({props:n})=>({6:n}),({props:n})=>n?64:0]},$$scope:{ctx:r}}}),{c(){ce(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p(n,i){const o={};i&192&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){ue(e,n)}}}function J6(r){let e,t,n,i,o,u,a,d;const p=[dn("context-simd"),{sourceLayer:"population"},{manageHoverState:!0},{paint:{"fill-color":co(["get","imd_percentile"],Ld,Md),"fill-opacity":Wn(.7,.9)}},{layout:{visibility:r[0]?"visible":"none"}}];let g={$$slots:{default:[G6]},$$scope:{ctx:r}};for(let E=0;E<p.length;E+=1)g=Mt(g,p[E]);e=new Ki({props:g});const y=[dn("context-population-car-ownership"),{sourceLayer:"population"},{manageHoverState:!0},{paint:{"fill-color":co(["*",100,["/",["get","households_with_cars_or_vans"],["get","total_households"]]],Ad,Pd),"fill-opacity":Wn(.7,.9)}},{layout:{visibility:r[2]?"visible":"none"}}];let x={$$slots:{default:[W6]},$$scope:{ctx:r}};for(let E=0;E<y.length;E+=1)x=Mt(x,y[E]);n=new Ki({props:x});const C=[dn("context-population-density"),{sourceLayer:"population"},{manageHoverState:!0},{paint:{"fill-color":co(["/",["get","population"],["/",["get","area"],1e6]],Id,Ed),"fill-opacity":Wn(.7,.9)}},{layout:{visibility:r[1]?"visible":"none"}}];let M={$$slots:{default:[X6]},$$scope:{ctx:r}};for(let E=0;E<C.length;E+=1)M=Mt(M,C[E]);o=new Ki({props:M});const F=[dn("context-population-outline"),{sourceLayer:"population"},{paint:{"line-color":"black","line-width":1}},{layout:{visibility:r[0]||r[1]||r[2]?"visible":"none"}}];let z={};for(let E=0;E<F.length;E+=1)z=Mt(z,F[E]);return a=new sr({props:z}),{c(){ce(e.$$.fragment),t=ie(),ce(n.$$.fragment),i=ie(),ce(o.$$.fragment),u=ie(),ce(a.$$.fragment)},m(E,P){le(e,E,P),Z(E,t,P),le(n,E,P),Z(E,i,P),le(o,E,P),Z(E,u,P),le(a,E,P),d=!0},p(E,P){const $=P&1?En(p,[p[0],p[1],p[2],p[3],{layout:{visibility:E[0]?"visible":"none"}}]):{};P&128&&($.$$scope={dirty:P,ctx:E}),e.$set($);const U=P&4?En(y,[y[0],y[1],y[2],y[3],{layout:{visibility:E[2]?"visible":"none"}}]):{};P&128&&(U.$$scope={dirty:P,ctx:E}),n.$set(U);const K=P&2?En(C,[C[0],C[1],C[2],C[3],{layout:{visibility:E[1]?"visible":"none"}}]):{};P&128&&(K.$$scope={dirty:P,ctx:E}),o.$set(K);const ee=P&7?En(F,[F[0],F[1],F[2],{layout:{visibility:E[0]||E[1]||E[2]?"visible":"none"}}]):{};a.$set(ee)},i(E){d||(N(e.$$.fragment,E),N(n.$$.fragment,E),N(o.$$.fragment,E),N(a.$$.fragment,E),d=!0)},o(E){V(e.$$.fragment,E),V(n.$$.fragment,E),V(o.$$.fragment,E),V(a.$$.fragment,E),d=!1},d(E){E&&(q(t),q(i),q(u)),ue(e,E),ue(n,E),ue(o,E),ue(a,E)}}}function Y6(r){let e,t,n,i,o,u,a,d,p,g,y;function x(P){r[3](P)}let C={label:"SIMD",$$slots:{help:[N6],legend:[O6]},$$scope:{ctx:r}};r[0]!==void 0&&(C.show=r[0]),e=new ts({props:C}),un.push(()=>Pn(e,"show",x));function M(P){r[4](P)}let F={label:"Population density",$$slots:{help:[U6],legend:[j6]},$$scope:{ctx:r}};r[1]!==void 0&&(F.show=r[1]),i=new ts({props:F}),un.push(()=>Pn(i,"show",M));function z(P){r[5](P)}let E={label:"Car ownership",$$slots:{help:[q6],legend:[V6]},$$scope:{ctx:r}};return r[2]!==void 0&&(E.show=r[2]),a=new ts({props:E}),un.push(()=>Pn(a,"show",z)),g=new Ih({props:{url:`pmtiles://${Bo("cnt_layers/population.pmtiles")}`,$$slots:{default:[J6]},$$scope:{ctx:r}}}),{c(){ce(e.$$.fragment),n=ie(),ce(i.$$.fragment),u=ie(),ce(a.$$.fragment),p=ie(),ce(g.$$.fragment)},m(P,$){le(e,P,$),Z(P,n,$),le(i,P,$),Z(P,u,$),le(a,P,$),Z(P,p,$),le(g,P,$),y=!0},p(P,[$]){const U={};$&128&&(U.$$scope={dirty:$,ctx:P}),!t&&$&1&&(t=!0,U.show=P[0],An(()=>t=!1)),e.$set(U);const K={};$&128&&(K.$$scope={dirty:$,ctx:P}),!o&&$&2&&(o=!0,K.show=P[1],An(()=>o=!1)),i.$set(K);const ee={};$&128&&(ee.$$scope={dirty:$,ctx:P}),!d&&$&4&&(d=!0,ee.show=P[2],An(()=>d=!1)),a.$set(ee);const W={};$&135&&(W.$$scope={dirty:$,ctx:P}),g.$set(W)},i(P){y||(N(e.$$.fragment,P),N(i.$$.fragment,P),N(a.$$.fragment,P),N(g.$$.fragment,P),y=!0)},o(P){V(e.$$.fragment,P),V(i.$$.fragment,P),V(a.$$.fragment,P),V(g.$$.fragment,P),y=!1},d(P){P&&(q(n),q(u),q(p)),ue(e,P),ue(i,P),ue(a,P),ue(g,P)}}}const Q6=r=>`${r}%`;function eM(r,e,t){let n=!1,i=!1,o=!1;function u(p){n=p,t(0,n)}function a(p){i=p,t(1,i)}function d(p){o=p,t(2,o)}return[n,i,o,u,a,d]}class tM extends St{constructor(e){super(),kt(this,e,eM,Y6,_t,{})}}function nM(r){let e;return{c(){e=j("div"),e.innerHTML=`<img src="${Pb}" alt="National Rail logo"/>
    Station`,ae(e,"slot","legend"),Ye(e,"display","flex"),Ye(e,"gap","8px"),Ye(e,"align-items","center")},m(t,n){Z(t,e,n)},p:ot,d(t){t&&q(e)}}}function rM(r){let e;return{c(){e=j("p"),e.innerHTML=`These are all <a href="https://wiki.openstreetmap.org/wiki/Tag:railway%3Dstation" target="_blank">railway stations</a>
    according to OpenStreetMap.`,ae(e,"slot","help")},m(t,n){Z(t,e,n)},p:ot,d(t){t&&q(e)}}}function iM(r){let e,t=(r[2].name??"Unnamed railway station")+"",n;return{c(){e=j("p"),n=Ee(t)},m(i,o){Z(i,e,o),D(e,n)},p(i,o){o&4&&t!==(t=(i[2].name??"Unnamed railway station")+"")&&gt(n,t)},d(i){i&&q(e)}}}function oM(r){let e,t;return e=new di({props:{$$slots:{default:[iM,({props:n})=>({2:n}),({props:n})=>n?4:0]},$$scope:{ctx:r}}}),{c(){ce(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p(n,i){const o={};i&12&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){ue(e,n)}}}function sM(r){let e,t;const n=[dn("context-railway-stations"),{layout:{"icon-image":"national_rail","icon-size":1,"icon-allow-overlap":!0,visibility:r[0]?"visible":"none"}}];let i={$$slots:{default:[oM]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=Mt(i,n[o]);return e=new Ou({props:i}),{c(){ce(e.$$.fragment)},m(o,u){le(e,o,u),t=!0},p(o,u){const a=u&1?En(n,[n[0],{layout:{"icon-image":"national_rail","icon-size":1,"icon-allow-overlap":!0,visibility:o[0]?"visible":"none"}}]):{};u&8&&(a.$$scope={dirty:u,ctx:o}),e.$set(a)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){ue(e,o)}}}function aM(r){let e,t,n,i,o;function u(d){r[1](d)}let a={label:"Railway stations",$$slots:{help:[rM],legend:[nM]},$$scope:{ctx:r}};return r[0]!==void 0&&(a.show=r[0]),e=new ts({props:a}),un.push(()=>Pn(e,"show",u)),i=new mr({props:{data:Bo("cnt_layers/railways.geojson"),generateId:!0,$$slots:{default:[sM]},$$scope:{ctx:r}}}),{c(){ce(e.$$.fragment),n=ie(),ce(i.$$.fragment)},m(d,p){le(e,d,p),Z(d,n,p),le(i,d,p),o=!0},p(d,[p]){const g={};p&8&&(g.$$scope={dirty:p,ctx:d}),!t&&p&1&&(t=!0,g.show=d[0],An(()=>t=!1)),e.$set(g);const y={};p&9&&(y.$$scope={dirty:p,ctx:d}),i.$set(y)},i(d){o||(N(e.$$.fragment,d),N(i.$$.fragment,d),o=!0)},o(d){V(e.$$.fragment,d),V(i.$$.fragment,d),o=!1},d(d){d&&q(n),ue(e,d),ue(i,d)}}}function lM(r,e,t){let n=!1;function i(o){n=o,t(0,n)}return[n,i]}class uM extends St{constructor(e){super(),kt(this,e,lM,aM,_t,{})}}function Ny(r,e,t){const n=r.slice();return n[18]=e[t][0],n[19]=e[t][1],n}function jy(r,e,t){const n=r.slice();return n[18]=e[t][0],n[19]=e[t][1],n}function Uy(r,e,t){const n=r.slice();return n[18]=e[t][0],n[19]=e[t][1],n}function Vy(r,e,t){const n=r.slice();return n[18]=e[t][0],n[19]=e[t][1],n}function qy(r,e,t){const n=r.slice();return n[18]=e[t][0],n[19]=e[t][1],n}function Zy(r,e,t){const n=r.slice();return n[18]=e[t][0],n[19]=e[t][1],n}function cM(r){let e;return{c(){e=j("p"),e.innerHTML='<a href="https://nptscot.github.io/manual/#routenetwork" target="_blank">Data from NPT</a>',ae(e,"slot","help")},m(t,n){Z(t,e,n)},p:ot,d(t){t&&q(e)}}}function Gy(r){let e,t=r[19]+"",n;return{c(){e=j("option"),n=Ee(t),e.__value=r[18],Vn(e,e.__value)},m(i,o){Z(i,e,o),D(e,n)},p:ot,d(i){i&&q(e)}}}function Hy(r){let e,t=r[19]+"",n;return{c(){e=j("option"),n=Ee(t),e.__value=r[18],Vn(e,e.__value)},m(i,o){Z(i,e,o),D(e,n)},p:ot,d(i){i&&q(e)}}}function Wy(r){let e,t=r[19]+"",n;return{c(){e=j("option"),n=Ee(t),e.__value=r[18],Vn(e,e.__value)},m(i,o){Z(i,e,o),D(e,n)},p:ot,d(i){i&&q(e)}}}function Ky(r){let e,t=r[19]+"",n;return{c(){e=j("option"),n=Ee(t),e.__value=r[18],Vn(e,e.__value)},m(i,o){Z(i,e,o),D(e,n)},p:ot,d(i){i&&q(e)}}}function hM(r){let e,t,n,i,o,u,a,d,p,g,y,x,C,M,F,z,E,P,$=Rn(r[7]),U=[];for(let ne=0;ne<$.length;ne+=1)U[ne]=Gy(Zy(r,$,ne));let K=Rn(r[8]),ee=[];for(let ne=0;ne<K.length;ne+=1)ee[ne]=Hy(qy(r,K,ne));let W=Rn(r[9]),J=[];for(let ne=0;ne<W.length;ne+=1)J[ne]=Wy(Vy(r,W,ne));let he=Rn(r[10]),Ae=[];for(let ne=0;ne<he.length;ne+=1)Ae[ne]=Ky(Uy(r,he,ne));return{c(){e=j("div"),t=j("label"),n=Ee(`Trip purpose:
      `),i=j("select");for(let ne=0;ne<U.length;ne+=1)U[ne].c();o=ie(),u=j("label"),a=Ee(`Scenario:
      `),d=j("select");for(let ne=0;ne<ee.length;ne+=1)ee[ne].c();p=ie(),g=j("label"),y=Ee(`Network type:
      `),x=j("select");for(let ne=0;ne<J.length;ne+=1)J[ne].c();C=ie(),M=j("label"),F=Ee(`Color by:
      `),z=j("select");for(let ne=0;ne<Ae.length;ne+=1)Ae[ne].c();r[0]===void 0&&ds(()=>r[11].call(i)),r[1]===void 0&&ds(()=>r[12].call(d)),r[2]===void 0&&ds(()=>r[13].call(x)),r[3]===void 0&&ds(()=>r[14].call(z)),ae(e,"slot","legend")},m(ne,fe){Z(ne,e,fe),D(e,t),D(t,n),D(t,i);for(let Ce=0;Ce<U.length;Ce+=1)U[Ce]&&U[Ce].m(i,null);Hi(i,r[0],!0),D(e,o),D(e,u),D(u,a),D(u,d);for(let Ce=0;Ce<ee.length;Ce+=1)ee[Ce]&&ee[Ce].m(d,null);Hi(d,r[1],!0),D(e,p),D(e,g),D(g,y),D(g,x);for(let Ce=0;Ce<J.length;Ce+=1)J[Ce]&&J[Ce].m(x,null);Hi(x,r[2],!0),D(e,C),D(e,M),D(M,F),D(M,z);for(let Ce=0;Ce<Ae.length;Ce+=1)Ae[Ce]&&Ae[Ce].m(z,null);Hi(z,r[3],!0),E||(P=[Tt(i,"change",r[11]),Tt(d,"change",r[12]),Tt(x,"change",r[13]),Tt(z,"change",r[14])],E=!0)},p(ne,fe){if(fe[0]&128){$=Rn(ne[7]);let Ce;for(Ce=0;Ce<$.length;Ce+=1){const _e=Zy(ne,$,Ce);U[Ce]?U[Ce].p(_e,fe):(U[Ce]=Gy(_e),U[Ce].c(),U[Ce].m(i,null))}for(;Ce<U.length;Ce+=1)U[Ce].d(1);U.length=$.length}if(fe[0]&129&&Hi(i,ne[0]),fe[0]&256){K=Rn(ne[8]);let Ce;for(Ce=0;Ce<K.length;Ce+=1){const _e=qy(ne,K,Ce);ee[Ce]?ee[Ce].p(_e,fe):(ee[Ce]=Hy(_e),ee[Ce].c(),ee[Ce].m(d,null))}for(;Ce<ee.length;Ce+=1)ee[Ce].d(1);ee.length=K.length}if(fe[0]&258&&Hi(d,ne[1]),fe[0]&512){W=Rn(ne[9]);let Ce;for(Ce=0;Ce<W.length;Ce+=1){const _e=Vy(ne,W,Ce);J[Ce]?J[Ce].p(_e,fe):(J[Ce]=Wy(_e),J[Ce].c(),J[Ce].m(x,null))}for(;Ce<J.length;Ce+=1)J[Ce].d(1);J.length=W.length}if(fe[0]&516&&Hi(x,ne[2]),fe[0]&1024){he=Rn(ne[10]);let Ce;for(Ce=0;Ce<he.length;Ce+=1){const _e=Uy(ne,he,Ce);Ae[Ce]?Ae[Ce].p(_e,fe):(Ae[Ce]=Ky(_e),Ae[Ce].c(),Ae[Ce].m(z,null))}for(;Ce<Ae.length;Ce+=1)Ae[Ce].d(1);Ae.length=he.length}fe[0]&1032&&Hi(z,ne[3])},d(ne){ne&&q(e),gi(U,ne),gi(ee,ne),gi(J,ne),gi(Ae,ne),E=!1,ur(P)}}}function Xy(r){let e,t,n,i,o=r[17][`${r[18]}_fastest_bicycle`].toLocaleString()+"",u,a,d,p=r[17][`${r[18]}_fastest_bicycle_go_dutch`].toLocaleString()+"",g,y,x,C=r[17][`${r[18]}_fastest_bicycle_ebike`].toLocaleString()+"",M,F;return{c(){e=j("tr"),t=j("th"),t.textContent=`${r[19]}`,n=ie(),i=j("td"),u=Ee(o),a=ie(),d=j("td"),g=Ee(p),y=ie(),x=j("td"),M=Ee(C),F=ie()},m(z,E){Z(z,e,E),D(e,t),D(e,n),D(e,i),D(i,u),D(e,a),D(e,d),D(d,g),D(e,y),D(e,x),D(x,M),D(e,F)},p(z,E){E[0]&131072&&o!==(o=z[17][`${z[18]}_fastest_bicycle`].toLocaleString()+"")&&gt(u,o),E[0]&131072&&p!==(p=z[17][`${z[18]}_fastest_bicycle_go_dutch`].toLocaleString()+"")&&gt(g,p),E[0]&131072&&C!==(C=z[17][`${z[18]}_fastest_bicycle_ebike`].toLocaleString()+"")&&gt(M,C)},d(z){z&&q(e)}}}function Jy(r){let e,t,n,i,o=r[17][`${r[18]}_quietest_bicycle`].toLocaleString()+"",u,a,d,p=r[17][`${r[18]}_quietest_bicycle_go_dutch`].toLocaleString()+"",g,y,x,C=r[17][`${r[18]}_quietest_bicycle_ebike`].toLocaleString()+"",M,F;return{c(){e=j("tr"),t=j("th"),t.textContent=`${r[19]}`,n=ie(),i=j("td"),u=Ee(o),a=ie(),d=j("td"),g=Ee(p),y=ie(),x=j("td"),M=Ee(C),F=ie()},m(z,E){Z(z,e,E),D(e,t),D(e,n),D(e,i),D(i,u),D(e,a),D(e,d),D(d,g),D(e,y),D(e,x),D(x,M),D(e,F)},p(z,E){E[0]&131072&&o!==(o=z[17][`${z[18]}_quietest_bicycle`].toLocaleString()+"")&&gt(u,o),E[0]&131072&&p!==(p=z[17][`${z[18]}_quietest_bicycle_go_dutch`].toLocaleString()+"")&&gt(g,p),E[0]&131072&&C!==(C=z[17][`${z[18]}_quietest_bicycle_ebike`].toLocaleString()+"")&&gt(M,C)},d(z){z&&q(e)}}}function fM(r){let e,t,n,i=r[17][r[4]].toLocaleString()+"",o,u,a,d,p=r[17].gradient+"",g,y,x,C,M,F=r[17].quietness+"",z,E,P,$,U,K,ee,W,J,he,Ae,ne,fe,Ce,_e,Ze,Oe,je=Rn(r[7]),De=[];for(let ht=0;ht<je.length;ht+=1)De[ht]=Xy(jy(r,je,ht));let At=Rn(r[7]),ut=[];for(let ht=0;ht<At.length;ht+=1)ut[ht]=Jy(Ny(r,At,ht));return{c(){e=j("div"),t=j("p"),n=Ee("Cyclists: "),o=Ee(i),u=ie(),a=j("p"),d=Ee("Gradient: "),g=Ee(p),y=Ee("%"),x=ie(),C=j("p"),M=Ee("Cycle-friendliness: "),z=Ee(F),E=Ee("%"),P=ie(),$=j("details"),U=j("summary"),U.textContent="All network details",K=ie(),ee=j("p"),ee.textContent="Fast/Direct network",W=ie(),J=j("table"),he=j("tr"),he.innerHTML="<td></td> <th>Baseline</th> <th>Go Dutch</th> <th>E-bikes</th>",Ae=ie();for(let ht=0;ht<De.length;ht+=1)De[ht].c();ne=ie(),fe=j("p"),fe.textContent="Quiet/Indirect network",Ce=ie(),_e=j("table"),Ze=j("tr"),Ze.innerHTML="<td></td> <th>Baseline</th> <th>Go Dutch</th> <th>E-bikes</th>",Oe=ie();for(let ht=0;ht<ut.length;ht+=1)ut[ht].c();Ye(e,"max-width","30vw"),Ye(e,"max-height","60vh"),Ye(e,"overflow","auto")},m(ht,wt){Z(ht,e,wt),D(e,t),D(t,n),D(t,o),D(e,u),D(e,a),D(a,d),D(a,g),D(a,y),D(e,x),D(e,C),D(C,M),D(C,z),D(C,E),D(e,P),D(e,$),D($,U),D($,K),D($,ee),D($,W),D($,J),D(J,he),D(J,Ae);for(let pt=0;pt<De.length;pt+=1)De[pt]&&De[pt].m(J,null);D($,ne),D($,fe),D($,Ce),D($,_e),D(_e,Ze),D(_e,Oe);for(let pt=0;pt<ut.length;pt+=1)ut[pt]&&ut[pt].m(_e,null)},p(ht,wt){if(wt[0]&131088&&i!==(i=ht[17][ht[4]].toLocaleString()+"")&&gt(o,i),wt[0]&131072&&p!==(p=ht[17].gradient+"")&&gt(g,p),wt[0]&131072&&F!==(F=ht[17].quietness+"")&&gt(z,F),wt[0]&131200){je=Rn(ht[7]);let pt;for(pt=0;pt<je.length;pt+=1){const Qe=jy(ht,je,pt);De[pt]?De[pt].p(Qe,wt):(De[pt]=Xy(Qe),De[pt].c(),De[pt].m(J,null))}for(;pt<De.length;pt+=1)De[pt].d(1);De.length=je.length}if(wt[0]&131200){At=Rn(ht[7]);let pt;for(pt=0;pt<At.length;pt+=1){const Qe=Ny(ht,At,pt);ut[pt]?ut[pt].p(Qe,wt):(ut[pt]=Jy(Qe),ut[pt].c(),ut[pt].m(_e,null))}for(;pt<ut.length;pt+=1)ut[pt].d(1);ut.length=At.length}},d(ht){ht&&q(e),gi(De,ht),gi(ut,ht)}}}function dM(r){let e,t;return e=new di({props:{openOn:"click",$$slots:{default:[fM,({props:n})=>({17:n}),({props:n})=>[n?131072:0]]},$$scope:{ctx:r}}}),{c(){ce(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p(n,i){const o={};i[0]&131088|i[1]&2&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){ue(e,n)}}}function pM(r){let e,t;const n=[dn("context-route-network"),{sourceLayer:"rnet"},{paint:{"line-color":r[6],"line-width":Yy(["get",r[4]])}},{layout:{visibility:r[5]?"visible":"none"}},{hoverCursor:"pointer"}];let i={$$slots:{default:[dM]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=Mt(i,n[o]);return e=new sr({props:i}),{c(){ce(e.$$.fragment)},m(o,u){le(e,o,u),t=!0},p(o,u){const a=u[0]&112?En(n,[n[0],n[1],u[0]&80&&{paint:{"line-color":o[6],"line-width":Yy(["get",o[4]])}},u[0]&32&&{layout:{visibility:o[5]?"visible":"none"}},n[4]]):{};u[0]&16|u[1]&2&&(a.$$scope={dirty:u,ctx:o}),e.$set(a)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){ue(e,o)}}}function mM(r){let e,t,n,i,o;function u(d){r[15](d)}let a={label:"Route network",$$slots:{legend:[hM],help:[cM]},$$scope:{ctx:r}};return r[5]!==void 0&&(a.show=r[5]),e=new ts({props:a}),un.push(()=>Pn(e,"show",u)),i=new Ih({props:{url:`pmtiles://${Bo("cnt_layers/route_network.pmtiles")}`,$$slots:{default:[pM]},$$scope:{ctx:r}}}),{c(){ce(e.$$.fragment),n=ie(),ce(i.$$.fragment)},m(d,p){le(e,d,p),Z(d,n,p),le(i,d,p),o=!0},p(d,p){const g={};p[0]&15|p[1]&2&&(g.$$scope={dirty:p,ctx:d}),!t&&p[0]&32&&(t=!0,g.show=d[5],An(()=>t=!1)),e.$set(g);const y={};p[0]&112|p[1]&2&&(y.$$scope={dirty:p,ctx:d}),i.$set(y)},i(d){o||(N(e.$$.fragment,d),N(i.$$.fragment,d),o=!0)},o(d){V(e.$$.fragment,d),V(i.$$.fragment,d),o=!1},d(d){d&&q(n),ue(e,d),ue(i,d)}}}function Yy(r){return["let","base",["+",.3,["/",3,["+",1,["^",2.718,["-",2.94,["*",r,.0021]]]]]],["interpolate",["linear"],["zoom"],12,["*",2.1,["var","base"]],14,["*",5.25,["var","base"]],15,["*",7.5,["var","base"]],16,["*",18,["var","base"]],18,["*",52.5,["var","base"]]]]}function gM(r){return["step",r,"rgba(0,0,0,0)",1,"#9C9C9C",50,"#FFFF73",100,"#AFFF00",250,"#00FFFF",500,"#30B0FF",1e3,"#2E5FFF",2e3,"#0000FF",3e3,"#FF00C5"]}function _M(r,e,t){let n,i,o=!1,u="all",a="bicycle_go_dutch",d="fastest",p="flow",g=[["all","All"],["commute","Commute"],["primary","Primary School"],["secondary","Secondary"],["utility","Other everyday"]],y=[["bicycle","Baseline"],["bicycle_go_dutch","Go Dutch"],["bicycle_ebike","E-bike"]],x=[["fastest","Fast/Direct"],["quietest","Quiet/Indirect"]],C=[["none","None"],["flow","People cycling per day"],["quietness","Cycle friendliness"],["gradient","Gradient"]],M={colorScale:["#59ee19","#37a009","#FFC300","#C70039","#581845","#000000"],limits:[3,5,7,10,100]};function F(){u=Sa(this),t(0,u),t(7,g)}function z(){a=Sa(this),t(1,a),t(8,y)}function E(){d=Sa(this),t(2,d),t(9,x)}function P(){p=Sa(this),t(3,p),t(10,C)}function $(U){o=U,t(5,o)}return r.$$.update=()=>{r.$$.dirty[0]&7&&t(4,n=`${u}_${d}_${a}`),r.$$.dirty[0]&24&&t(6,i={none:"#304ce7",flow:gM(["get",n]),quietness:["step",["get","quietness"],"#882255",25,"#CC6677",50,"#44AA99",75,"#117733",101,"#000000"],gradient:co(["abs",["get","gradient"]],M.limits,M.colorScale)}[p])},[u,a,d,p,n,o,i,g,y,x,C,F,z,E,P,$]}class yM extends St{constructor(e){super(),kt(this,e,_M,mM,_t,{},null,[-1,-1])}}function bM(r){let e;return{c(){e=j("div"),e.innerHTML=`<p>This layer shows collisions recorded in the <a href="https://www.data.gov.uk/dataset/cb7ae6f0-4be6-4935-9277-47e5ce24a11f/road-safety-data" target="_blank">DfT stats19</a>
      dataset, as of 30 September 2024. Please note these limitations:</p> <ul><li>Only collisions between 2017 and 2023 are included</li> <li>This tool is intended to be used when zoomed into the map, while
        inspecting a scheme or development area. Not all points are shown when
        zoomed out and showing large areas. Do not use this to look for trends
        across a city or region scale.</li> <li>Approximately 150 collisions from the source data aren&#39;t included, due
        to problems with the recorded location</li> <li>The &quot;pedestrians&quot; category also include mobility scooters</li> <li>All limitations <a href="https://www.gov.uk/guidance/road-accident-and-safety-statistics-guidance" target="_blank">documented by DfT</a>
        also apply. Not all collisions or near misses are reported. There&#39;s nuance
        with the severity categories.</li></ul> <p>You can click a point to open the full report, thanks to CycleStreets.</p> <p>License: <a href="http://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/" target="_blank">Open Government License</a>
      . Contains OS data  Crown copyright and database right 2025.</p>`,ae(e,"slot","help")},m(t,n){Z(t,e,n)},p:ot,d(t){t&&q(e)}}}function vM(r){let e,t,n,i,o,u,a,d,p,g,y,x,C,M,F,z,E,P,$,U,K,ee,W;return U=new ig({props:{labelColors:r[6],swatchClass:"circle",itemsPerRow:3}}),{c(){e=j("div"),t=j("fieldset"),n=j("label"),i=j("input"),o=Ee(`
        Pedestrians`),u=ie(),a=j("label"),d=j("input"),p=Ee(`
        Cyclists`),g=ie(),y=j("fieldset"),x=j("label"),C=Ee(`From
        `),M=j("input"),F=ie(),z=j("label"),E=Ee(`To
        `),P=j("input"),$=ie(),ce(U.$$.fragment),ae(i,"type","checkbox"),ae(i,"class","svelte-rvrx5w"),ae(d,"type","checkbox"),ae(d,"class","svelte-rvrx5w"),Ye(t,"display","flex"),Ye(t,"gap","3em"),ae(t,"class","svelte-rvrx5w"),ae(M,"type","number"),ae(M,"min",2017),ae(M,"max",2023),ae(M,"class","svelte-rvrx5w"),ae(P,"type","number"),ae(P,"min",2017),ae(P,"max",2023),ae(P,"class","svelte-rvrx5w"),ae(y,"class","year-filter svelte-rvrx5w"),ae(e,"slot","legend")},m(J,he){Z(J,e,he),D(e,t),D(t,n),D(n,i),i.checked=r[1].pedestrians,D(n,o),D(t,u),D(t,a),D(a,d),d.checked=r[1].cyclists,D(a,p),D(e,g),D(e,y),D(y,x),D(x,C),D(x,M),Vn(M,r[1].minYear),D(y,F),D(y,z),D(z,E),D(z,P),Vn(P,r[1].maxYear),D(e,$),le(U,e,null),K=!0,ee||(W=[Tt(i,"change",r[7]),Tt(d,"change",r[8]),Tt(M,"input",r[9]),Tt(P,"input",r[10])],ee=!0)},p(J,he){he&2&&(i.checked=J[1].pedestrians),he&2&&(d.checked=J[1].cyclists),he&2&&gl(M.value)!==J[1].minYear&&Vn(M,J[1].minYear),he&2&&gl(P.value)!==J[1].maxYear&&Vn(P,J[1].maxYear)},i(J){K||(N(U.$$.fragment,J),K=!0)},o(J){V(U.$$.fragment,J),K=!1},d(J){J&&q(e),ue(U),ee=!1,ur(W)}}}function Qy(r){let e,t,n,i=r[3][r[12].pedestrian_location]+"",o;return{c(){e=j("p"),t=Ee("Pedestrian location: "),n=j("b"),o=Ee(i)},m(u,a){Z(u,e,a),D(e,t),D(e,n),D(n,o)},p(u,a){a&4096&&i!==(i=u[3][u[12].pedestrian_location]+"")&&gt(o,i)},d(u){u&&q(e)}}}function e1(r){let e,t,n,i=r[4][r[12].pedestrian_movement]+"",o;return{c(){e=j("p"),t=Ee("Pedestrian movement: "),n=j("b"),o=Ee(i)},m(u,a){Z(u,e,a),D(e,t),D(e,n),D(n,o)},p(u,a){a&4096&&i!==(i=u[4][u[12].pedestrian_movement]+"")&&gt(o,i)},d(u){u&&q(e)}}}function wM(r){let e,t,n,i=r[12].year+"",o,u,a,d,p,g=r[5][r[12].severity]+"",y,x,C,M,F,z=t1(r[12])+"",E,P,$,U,K,ee=r[12].pedestrian_location&&Qy(r),W=r[12].pedestrian_movement&&e1(r);return{c(){e=j("p"),t=Ee("Year: "),n=j("b"),o=Ee(i),u=ie(),a=j("p"),d=Ee("Severity: "),p=j("b"),y=Ee(g),x=ie(),C=j("p"),M=Ee("Casualties: "),F=j("b"),E=Ee(z),P=ie(),ee&&ee.c(),$=ie(),W&&W.c(),U=ie(),K=j("p"),K.textContent="Click to open full report in CycleStreets"},m(J,he){Z(J,e,he),D(e,t),D(e,n),D(n,o),Z(J,u,he),Z(J,a,he),D(a,d),D(a,p),D(p,y),Z(J,x,he),Z(J,C,he),D(C,M),D(C,F),D(F,E),Z(J,P,he),ee&&ee.m(J,he),Z(J,$,he),W&&W.m(J,he),Z(J,U,he),Z(J,K,he)},p(J,he){he&4096&&i!==(i=J[12].year+"")&&gt(o,i),he&4096&&g!==(g=J[5][J[12].severity]+"")&&gt(y,g),he&4096&&z!==(z=t1(J[12])+"")&&gt(E,z),J[12].pedestrian_location?ee?ee.p(J,he):(ee=Qy(J),ee.c(),ee.m($.parentNode,$)):ee&&(ee.d(1),ee=null),J[12].pedestrian_movement?W?W.p(J,he):(W=e1(J),W.c(),W.m(U.parentNode,U)):W&&(W.d(1),W=null)},d(J){J&&(q(e),q(u),q(a),q(x),q(C),q(P),q($),q(U),q(K)),ee&&ee.d(J),W&&W.d(J)}}}function xM(r){let e,t;return e=new di({props:{$$slots:{default:[wM,({props:n})=>({12:n}),({props:n})=>n?4096:0]},$$scope:{ctx:r}}}),{c(){ce(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p(n,i){const o={};i&12288&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){ue(e,n)}}}function kM(r){let e,t;const n=[dn("context-stats19"),{sourceLayer:"stats19"},{paint:{"circle-color":co(["get","severity"],[1,2,3],[Lm,Em,Im]),"circle-opacity":.9,"circle-radius":["interpolate",["linear"],["zoom"],1,2,8,3,13,15],"circle-stroke-color":"black","circle-stroke-width":.1}},{filter:r[2](r[1])},{layout:{visibility:r[0]?"visible":"none"}},{hoverCursor:"pointer"}];let i={$$slots:{default:[xM]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=Mt(i,n[o]);return e=new xl({props:i}),e.$on("click",TM),{c(){ce(e.$$.fragment)},m(o,u){le(e,o,u),t=!0},p(o,u){const a=u&7?En(n,[n[0],n[1],u&0&&{paint:{"circle-color":co(["get","severity"],[1,2,3],[Lm,Em,Im]),"circle-opacity":.9,"circle-radius":["interpolate",["linear"],["zoom"],1,2,8,3,13,15],"circle-stroke-color":"black","circle-stroke-width":.1}},u&6&&{filter:o[2](o[1])},u&1&&{layout:{visibility:o[0]?"visible":"none"}},n[5]]):{};u&8192&&(a.$$scope={dirty:u,ctx:o}),e.$set(a)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){ue(e,o)}}}function SM(r){let e,t,n,i,o;function u(d){r[11](d)}let a={label:"Collisions",$$slots:{legend:[vM],help:[bM]},$$scope:{ctx:r}};return r[0]!==void 0&&(a.show=r[0]),e=new ts({props:a}),un.push(()=>Pn(e,"show",u)),i=new Ih({props:{url:`pmtiles://${Bo("cnt_layers/stats19.pmtiles")}`,$$slots:{default:[kM]},$$scope:{ctx:r}}}),{c(){ce(e.$$.fragment),n=ie(),ce(i.$$.fragment)},m(d,p){le(e,d,p),Z(d,n,p),le(i,d,p),o=!0},p(d,[p]){const g={};p&8194&&(g.$$scope={dirty:p,ctx:d}),!t&&p&1&&(t=!0,g.show=d[0],An(()=>t=!1)),e.$set(g);const y={};p&8195&&(y.$$scope={dirty:p,ctx:d}),i.$set(y)},i(d){o||(N(e.$$.fragment,d),N(i.$$.fragment,d),o=!0)},o(d){V(e.$$.fragment,d),V(i.$$.fragment,d),o=!1},d(d){d&&q(n),ue(e,d),ue(i,d)}}}let Lm="#080C54",Em="#1F9EB7",Im="#CDE594";function t1(r){let e=[];return r.pedestrian&&e.push("pedestrian"),r.cyclist&&e.push("cyclist"),e.join(", ")}function TM(r){window.open(`https://www.cyclestreets.net/collisions/reports/${r.detail.features[0].properties.accident_index}`,"_blank")}function CM(r,e,t){let n=!1,i={pedestrians:!0,cyclists:!0,minYear:2017,maxYear:2023};function o(F){let z=["any"];return i.pedestrians&&z.push(["get","pedestrian"]),i.cyclists&&z.push(["get","cyclist"]),["all",[">=",["get","year"],i.minYear],["<=",["get","year"],i.maxYear],z]}let u={1:"Crossing on pedestrian crossing facility",2:"Crossing in zig-zag approach lines",3:"Crossing in zig-zag exit lines",4:"Crossing elsewhere within 50m. of pedestrian crossing",5:"In carriageway, crossing elsewhere",6:"On footway or verge",7:"On refuge, central island or central reservation",8:"In centre of carriageway - not on refuge, island or central reservation",9:"In carriageway, not crossing"},a={1:"Crossing from driver's nearside",2:"Crossing from nearside - masked by parked or stationary vehicle",3:"Crossing from driver's offside",4:"Crossing from offside - masked by parked or stationary vehicle",5:"In carriageway, stationary - not crossing (standing or playing)",6:"In carriageway, stationary - not crossing (standing or playing - masked by parked or stationary vehicle)",7:"Walking along in carriageway, facing traffic",8:"Walking along in carriageway, back to traffic"},d={1:"Fatal",2:"Serious",3:"Slight"},p={Slight:Im,Serious:Em,Fatal:Lm};function g(){i.pedestrians=this.checked,t(1,i)}function y(){i.cyclists=this.checked,t(1,i)}function x(){i.minYear=gl(this.value),t(1,i)}function C(){i.maxYear=gl(this.value),t(1,i)}function M(F){n=F,t(0,n)}return[n,i,o,u,a,d,p,g,y,x,C,M]}class MM extends St{constructor(e){super(),kt(this,e,CM,SM,_t,{})}}function n1(r){let e;return{c(){e=Ee("Layers")},m(t,n){Z(t,e,n)},d(t){t&&q(e)}}}function r1(r){let e,t,n,i,o;function u(p){r[6](p)}let a={label:"Existing modal filters and turn restrictions"};r[2]!==void 0&&(a.show=r[2]),e=new ts({props:a}),un.push(()=>Pn(e,"show",u));let d=r[3]=="cnt"&&i1();return{c(){ce(e.$$.fragment),n=ie(),d&&d.c(),i=Xn()},m(p,g){le(e,p,g),Z(p,n,g),d&&d.m(p,g),Z(p,i,g),o=!0},p(p,g){const y={};!t&&g&4&&(t=!0,y.show=p[2],An(()=>t=!1)),e.$set(y),p[3]=="cnt"?d?g&8&&N(d,1):(d=i1(),d.c(),N(d,1),d.m(i.parentNode,i)):d&&(Kt(),V(d,1,1,()=>{d=null}),Xt())},i(p){o||(N(e.$$.fragment,p),N(d),o=!0)},o(p){V(e.$$.fragment,p),V(d),o=!1},d(p){p&&(q(n),q(i)),ue(e,p),d&&d.d(p)}}}function i1(r){let e,t,n,i,o,u,a,d,p,g,y,x,C,M;return e=new $6({}),n=new tM({}),o=new uM({}),a=new L5({}),p=new I6({}),y=new yM({}),C=new MM({}),{c(){ce(e.$$.fragment),t=ie(),ce(n.$$.fragment),i=ie(),ce(o.$$.fragment),u=ie(),ce(a.$$.fragment),d=ie(),ce(p.$$.fragment),g=ie(),ce(y.$$.fragment),x=ie(),ce(C.$$.fragment)},m(F,z){le(e,F,z),Z(F,t,z),le(n,F,z),Z(F,i,z),le(o,F,z),Z(F,u,z),le(a,F,z),Z(F,d,z),le(p,F,z),Z(F,g,z),le(y,F,z),Z(F,x,z),le(C,F,z),M=!0},i(F){M||(N(e.$$.fragment,F),N(n.$$.fragment,F),N(o.$$.fragment,F),N(a.$$.fragment,F),N(p.$$.fragment,F),N(y.$$.fragment,F),N(C.$$.fragment,F),M=!0)},o(F){V(e.$$.fragment,F),V(n.$$.fragment,F),V(o.$$.fragment,F),V(a.$$.fragment,F),V(p.$$.fragment,F),V(y.$$.fragment,F),V(C.$$.fragment,F),M=!1},d(F){F&&(q(t),q(i),q(u),q(d),q(g),q(x)),ue(e,F),ue(n,F),ue(o,F),ue(a,F),ue(p,F),ue(y,F),ue(C,F)}}}function LM(r){let e,t,n,i,o,u,a,d,p,g,y,x,C,M,F,z,E,P,$,U;i=new y3({props:{color:"#333"}});let K=r[0]&&n1(),ee=r[1]&&r1(r);return{c(){e=j("div"),t=j("button"),n=j("div"),ce(i.$$.fragment),o=ie(),K&&K.c(),a=ie(),d=j("div"),ee&&ee.c(),p=ie(),g=j("div"),y=j("span"),y.textContent="Basemap",x=ie(),C=j("select"),M=j("option"),M.textContent="MapTiler Dataviz",F=j("option"),F.textContent="MapTiler Streets",z=j("option"),z.textContent="MapTiler Satellite",E=j("option"),E.textContent="OS Open Zoomstack",Ye(n,"display","flex"),Ye(n,"gap","12px"),Ye(n,"color","#333"),Ye(n,"align-items","center"),Ye(n,"justify-content","center"),ae(t,"class",u="show-layers-button icon-btn "+(r[0]?"expanded":"")+" svelte-1nl5dst"),ae(t,"aria-label","Layers"),Ye(y,"font-size","20px"),Ye(y,"margin-left","8px"),Ye(y,"margin-top","4px"),M.__value="dataviz",Vn(M,M.__value),F.__value="streets-v2",Vn(F,F.__value),z.__value="hybrid",Vn(z,z.__value),E.__value="uk-openzoomstack-light",Vn(E,E.__value),Ye(C,"width","auto"),Ye(C,"font-size","20px"),Ye(C,"margin","8px"),Ye(C,"padding","8px"),Ye(C,"text-overflow","ellipsis"),r[4]===void 0&&ds(()=>r[7].call(C)),ae(g,"class","context-control"),ae(d,"class","contextual-layer-controls svelte-1nl5dst"),Ye(d,"flex-direction","column"),Ye(d,"display",r[0]?"flex":"none"),ae(e,"class","pico contextual-layers svelte-1nl5dst"),Ye(e,"display","flex"),Ye(e,"flex-direction","column"),Ye(e,"border-radius","5px"),Ye(e,"width",r[0]?"300px":"auto")},m(W,J){Z(W,e,J),D(e,t),D(t,n),le(i,n,null),D(n,o),K&&K.m(n,null),D(e,a),D(e,d),ee&&ee.m(d,null),D(d,p),D(d,g),D(g,y),D(g,x),D(g,C),D(C,M),D(C,F),D(C,z),D(C,E),Hi(C,r[4],!0),P=!0,$||(U=[Tt(t,"click",r[5]),Tt(C,"change",r[7])],$=!0)},p(W,J){W[0]?K||(K=n1(),K.c(),K.m(n,null)):K&&(K.d(1),K=null),(!P||J&1&&u!==(u="show-layers-button icon-btn "+(W[0]?"expanded":"")+" svelte-1nl5dst"))&&ae(t,"class",u),W[1]?ee?(ee.p(W,J),J&2&&N(ee,1)):(ee=r1(W),ee.c(),N(ee,1),ee.m(d,p)):ee&&(Kt(),V(ee,1,1,()=>{ee=null}),Xt()),J&16&&Hi(C,W[4]),J&1&&Ye(d,"display",W[0]?"flex":"none"),J&1&&Ye(e,"width",W[0]?"300px":"auto")},i(W){P||(N(i.$$.fragment,W),N(ee),P=!0)},o(W){V(i.$$.fragment,W),V(ee),P=!1},d(W){W&&q(e),ue(i),K&&K.d(),ee&&ee.d(),$=!1,ur(U)}}}function EM(r){let e,t;return e=new pm({props:{defaultStyling:!0,$$slots:{default:[LM]},$$scope:{ctx:r}}}),{c(){ce(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p(n,[i]){const o={};i&287&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){ue(e,n)}}}function IM(r,e,t){let n,i,o,u;st(r,Cr,y=>t(1,n=y)),st(r,pd,y=>t(2,i=y)),st(r,is,y=>t(3,o=y)),st(r,am,y=>t(4,u=y));let a=!1;const d=()=>t(0,a=!a);function p(y){i=y,pd.set(i)}function g(){u=Sa(this),am.set(u)}return[a,n,i,o,u,d,p,g]}class AM extends St{constructor(e){super(),kt(this,e,IM,EM,_t,{})}}let Ke;const Kv=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&Kv.decode();let th=null;function Fu(){return(th===null||th.byteLength===0)&&(th=new Uint8Array(Ke.memory.buffer)),th}function $r(r,e){return r=r>>>0,Kv.decode(Fu().subarray(r,r+e))}const Ks=new Array(128).fill(void 0);Ks.push(void 0,null,!0,!1);let ph=Ks.length;function ir(r){ph===Ks.length&&Ks.push(Ks.length+1);const e=ph;return ph=Ks[e],Ks[e]=r,e}function Mn(r){return Ks[r]}function PM(r){r<132||(Ks[r]=ph,ph=r)}function Gn(r){const e=Mn(r);return PM(r),e}function Au(r){return r==null}let nh=null;function Xv(){return(nh===null||nh.byteLength===0)&&(nh=new Float64Array(Ke.memory.buffer)),nh}let rh=null;function dt(){return(rh===null||rh.byteLength===0)&&(rh=new Int32Array(Ke.memory.buffer)),rh}let vi=0;const ad=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},zM=typeof ad.encodeInto=="function"?function(r,e){return ad.encodeInto(r,e)}:function(r,e){const t=ad.encode(r);return e.set(t),{read:r.length,written:t.length}};function Do(r,e,t){if(t===void 0){const a=ad.encode(r),d=e(a.length,1)>>>0;return Fu().subarray(d,d+a.length).set(a),vi=a.length,d}let n=r.length,i=e(n,1)>>>0;const o=Fu();let u=0;for(;u<n;u++){const a=r.charCodeAt(u);if(a>127)break;o[i+u]=a}if(u!==n){u!==0&&(r=r.slice(u)),i=t(i,n,n=u+r.length*3,1)>>>0;const a=Fu().subarray(i+u,i+n),d=zM(r,a);u+=d.written}return vi=u,i}let ih=null;function DM(){return(ih===null||ih.byteLength===0)&&(ih=new BigInt64Array(Ke.memory.buffer)),ih}function Am(r){const e=typeof r;if(e=="number"||e=="boolean"||r==null)return`${r}`;if(e=="string")return`"${r}"`;if(e=="symbol"){const i=r.description;return i==null?"Symbol":`Symbol(${i})`}if(e=="function"){const i=r.name;return typeof i=="string"&&i.length>0?`Function(${i})`:"Function"}if(Array.isArray(r)){const i=r.length;let o="[";i>0&&(o+=Am(r[0]));for(let u=1;u<i;u++)o+=", "+Am(r[u]);return o+="]",o}const t=/\[object ([^\]]+)\]/.exec(toString.call(r));let n;if(t.length>1)n=t[1];else return toString.call(r);if(n=="Object")try{return"Object("+JSON.stringify(r)+")"}catch{return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:n}function em(r,e){const t=e(r.length*1,1)>>>0;return Fu().set(r,t/1),vi=r.length,t}function RM(r,e){return r=r>>>0,Xv().subarray(r/8,r/8+e)}function FM(r,e){return r=r>>>0,Fu().subarray(r/1,r/1+e)}function fl(r,e){try{return r.apply(this,e)}catch(t){Ke.__wbindgen_exn_store(ir(t))}}class BM{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();Ke.__wbg_ltn_free(e)}constructor(e,t,n,i,o,u,a,d){try{const M=Ke.__wbindgen_add_to_stack_pointer(-16),F=em(e,Ke.__wbindgen_malloc),z=vi,E=em(t,Ke.__wbindgen_malloc),P=vi,$=em(n,Ke.__wbindgen_malloc),U=vi,K=Do(o,Ke.__wbindgen_malloc,Ke.__wbindgen_realloc),ee=vi;var p=Au(u)?0:Do(u,Ke.__wbindgen_malloc,Ke.__wbindgen_realloc),g=vi;const W=Do(a,Ke.__wbindgen_malloc,Ke.__wbindgen_realloc),J=vi;Ke.ltn_new(M,F,z,E,P,$,U,ir(i),K,ee,p,g,W,J,d);var y=dt()[M/4+0],x=dt()[M/4+1],C=dt()[M/4+2];if(C)throw Gn(x);return this.__wbg_ptr=y>>>0,this}finally{Ke.__wbindgen_add_to_stack_pointer(16)}}getInvertedBoundary(){let e,t;try{const p=Ke.__wbindgen_add_to_stack_pointer(-16);Ke.ltn_getInvertedBoundary(p,this.__wbg_ptr);var n=dt()[p/4+0],i=dt()[p/4+1],o=dt()[p/4+2],u=dt()[p/4+3],a=n,d=i;if(u)throw a=0,d=0,Gn(o);return e=a,t=d,$r(a,d)}finally{Ke.__wbindgen_add_to_stack_pointer(16),Ke.__wbindgen_free(e,t,1)}}getBounds(){try{const i=Ke.__wbindgen_add_to_stack_pointer(-16);Ke.ltn_getBounds(i,this.__wbg_ptr);var e=dt()[i/4+0],t=dt()[i/4+1],n=RM(e,t).slice();return Ke.__wbindgen_free(e,t*8,8),n}finally{Ke.__wbindgen_add_to_stack_pointer(16)}}toRouteSnapper(){try{const i=Ke.__wbindgen_add_to_stack_pointer(-16);Ke.ltn_toRouteSnapper(i,this.__wbg_ptr);var e=dt()[i/4+0],t=dt()[i/4+1],n=FM(e,t).slice();return Ke.__wbindgen_free(e,t*1,1),n}finally{Ke.__wbindgen_add_to_stack_pointer(16)}}toRouteSnapperGj(){let e,t;try{const p=Ke.__wbindgen_add_to_stack_pointer(-16);Ke.ltn_toRouteSnapperGj(p,this.__wbg_ptr);var n=dt()[p/4+0],i=dt()[p/4+1],o=dt()[p/4+2],u=dt()[p/4+3],a=n,d=i;if(u)throw a=0,d=0,Gn(o);return e=a,t=d,$r(a,d)}finally{Ke.__wbindgen_add_to_stack_pointer(16),Ke.__wbindgen_free(e,t,1)}}renderModalFilters(){let e,t;try{const p=Ke.__wbindgen_add_to_stack_pointer(-16);Ke.ltn_renderModalFilters(p,this.__wbg_ptr);var n=dt()[p/4+0],i=dt()[p/4+1],o=dt()[p/4+2],u=dt()[p/4+3],a=n,d=i;if(u)throw a=0,d=0,Gn(o);return e=a,t=d,$r(a,d)}finally{Ke.__wbindgen_add_to_stack_pointer(16),Ke.__wbindgen_free(e,t,1)}}renderTurnRestrictions(){let e,t;try{const p=Ke.__wbindgen_add_to_stack_pointer(-16);Ke.ltn_renderTurnRestrictions(p,this.__wbg_ptr);var n=dt()[p/4+0],i=dt()[p/4+1],o=dt()[p/4+2],u=dt()[p/4+3],a=n,d=i;if(u)throw a=0,d=0,Gn(o);return e=a,t=d,$r(a,d)}finally{Ke.__wbindgen_add_to_stack_pointer(16),Ke.__wbindgen_free(e,t,1)}}renderNeighbourhood(){let e,t;try{const p=Ke.__wbindgen_add_to_stack_pointer(-16);Ke.ltn_renderNeighbourhood(p,this.__wbg_ptr);var n=dt()[p/4+0],i=dt()[p/4+1],o=dt()[p/4+2],u=dt()[p/4+3],a=n,d=i;if(u)throw a=0,d=0,Gn(o);return e=a,t=d,$r(a,d)}finally{Ke.__wbindgen_add_to_stack_pointer(16),Ke.__wbindgen_free(e,t,1)}}generatedBoundaries(){let e,t;try{const p=Ke.__wbindgen_add_to_stack_pointer(-16);Ke.ltn_generatedBoundaries(p,this.__wbg_ptr);var n=dt()[p/4+0],i=dt()[p/4+1],o=dt()[p/4+2],u=dt()[p/4+3],a=n,d=i;if(u)throw a=0,d=0,Gn(o);return e=a,t=d,$r(a,d)}finally{Ke.__wbindgen_add_to_stack_pointer(16),Ke.__wbindgen_free(e,t,1)}}generateMergedBoundary(e){let t,n;try{const g=Ke.__wbindgen_add_to_stack_pointer(-16);Ke.ltn_generateMergedBoundary(g,this.__wbg_ptr,ir(e));var i=dt()[g/4+0],o=dt()[g/4+1],u=dt()[g/4+2],a=dt()[g/4+3],d=i,p=o;if(a)throw d=0,p=0,Gn(u);return t=d,n=p,$r(d,p)}finally{Ke.__wbindgen_add_to_stack_pointer(16),Ke.__wbindgen_free(t,n,1)}}setNeighbourhoodBoundary(e,t){try{const o=Ke.__wbindgen_add_to_stack_pointer(-16),u=Do(e,Ke.__wbindgen_malloc,Ke.__wbindgen_realloc),a=vi;Ke.ltn_setNeighbourhoodBoundary(o,this.__wbg_ptr,u,a,ir(t));var n=dt()[o/4+0],i=dt()[o/4+1];if(i)throw Gn(n)}finally{Ke.__wbindgen_add_to_stack_pointer(16)}}deleteNeighbourhoodBoundary(e){const t=Do(e,Ke.__wbindgen_malloc,Ke.__wbindgen_realloc),n=vi;Ke.ltn_deleteNeighbourhoodBoundary(this.__wbg_ptr,t,n)}renameNeighbourhoodBoundary(e,t){const n=Do(e,Ke.__wbindgen_malloc,Ke.__wbindgen_realloc),i=vi,o=Do(t,Ke.__wbindgen_malloc,Ke.__wbindgen_realloc),u=vi;Ke.ltn_renameNeighbourhoodBoundary(this.__wbg_ptr,n,i,o,u)}setCurrentNeighbourhood(e){try{const i=Ke.__wbindgen_add_to_stack_pointer(-16),o=Do(e,Ke.__wbindgen_malloc,Ke.__wbindgen_realloc),u=vi;Ke.ltn_setCurrentNeighbourhood(i,this.__wbg_ptr,o,u);var t=dt()[i/4+0],n=dt()[i/4+1];if(n)throw Gn(t)}finally{Ke.__wbindgen_add_to_stack_pointer(16)}}addModalFilter(e,t){try{const o=Ke.__wbindgen_add_to_stack_pointer(-16),u=Do(t,Ke.__wbindgen_malloc,Ke.__wbindgen_realloc),a=vi;Ke.ltn_addModalFilter(o,this.__wbg_ptr,ir(e),u,a);var n=dt()[o/4+0],i=dt()[o/4+1];if(i)throw Gn(n)}finally{Ke.__wbindgen_add_to_stack_pointer(16)}}addManyModalFilters(e,t){try{const o=Ke.__wbindgen_add_to_stack_pointer(-16),u=Do(t,Ke.__wbindgen_malloc,Ke.__wbindgen_realloc),a=vi;Ke.ltn_addManyModalFilters(o,this.__wbg_ptr,ir(e),u,a);var n=dt()[o/4+0],i=dt()[o/4+1];if(i)throw Gn(n)}finally{Ke.__wbindgen_add_to_stack_pointer(16)}}deleteModalFilter(e){Ke.ltn_deleteModalFilter(this.__wbg_ptr,e)}addDiagonalFilter(e){try{const i=Ke.__wbindgen_add_to_stack_pointer(-16);Ke.ltn_addDiagonalFilter(i,this.__wbg_ptr,e);var t=dt()[i/4+0],n=dt()[i/4+1];if(n)throw Gn(t)}finally{Ke.__wbindgen_add_to_stack_pointer(16)}}rotateDiagonalFilter(e){try{const i=Ke.__wbindgen_add_to_stack_pointer(-16);Ke.ltn_rotateDiagonalFilter(i,this.__wbg_ptr,e);var t=dt()[i/4+0],n=dt()[i/4+1];if(n)throw Gn(t)}finally{Ke.__wbindgen_add_to_stack_pointer(16)}}deleteDiagonalFilter(e){try{const i=Ke.__wbindgen_add_to_stack_pointer(-16);Ke.ltn_deleteDiagonalFilter(i,this.__wbg_ptr,e);var t=dt()[i/4+0],n=dt()[i/4+1];if(n)throw Gn(t)}finally{Ke.__wbindgen_add_to_stack_pointer(16)}}addTurnRestriction(e,t){try{const o=Ke.__wbindgen_add_to_stack_pointer(-16);Ke.ltn_addTurnRestriction(o,this.__wbg_ptr,e,t);var n=dt()[o/4+0],i=dt()[o/4+1];if(i)throw Gn(n)}finally{Ke.__wbindgen_add_to_stack_pointer(16)}}deleteTurnRestriction(e,t,n){try{const u=Ke.__wbindgen_add_to_stack_pointer(-16);Ke.ltn_deleteTurnRestriction(u,this.__wbg_ptr,e,t,n);var i=dt()[u/4+0],o=dt()[u/4+1];if(o)throw Gn(i)}finally{Ke.__wbindgen_add_to_stack_pointer(16)}}getTurnRestrictionTargets(e){let t,n;try{const g=Ke.__wbindgen_add_to_stack_pointer(-16);Ke.ltn_getTurnRestrictionTargets(g,this.__wbg_ptr,e);var i=dt()[g/4+0],o=dt()[g/4+1],u=dt()[g/4+2],a=dt()[g/4+3],d=i,p=o;if(a)throw d=0,p=0,Gn(u);return t=d,n=p,$r(d,p)}finally{Ke.__wbindgen_add_to_stack_pointer(16),Ke.__wbindgen_free(t,n,1)}}toggleTravelFlow(e){Ke.ltn_toggleTravelFlow(this.__wbg_ptr,e)}toggleMainRoad(e){try{const i=Ke.__wbindgen_add_to_stack_pointer(-16);Ke.ltn_toggleMainRoad(i,this.__wbg_ptr,e);var t=dt()[i/4+0],n=dt()[i/4+1];if(n)throw Gn(t)}finally{Ke.__wbindgen_add_to_stack_pointer(16)}}reclassifyRoadsAlongLine(e,t,n){try{const u=Ke.__wbindgen_add_to_stack_pointer(-16);Ke.ltn_reclassifyRoadsAlongLine(u,this.__wbg_ptr,ir(e),t,n);var i=dt()[u/4+0],o=dt()[u/4+1];if(o)throw Gn(i)}finally{Ke.__wbindgen_add_to_stack_pointer(16)}}undo(){try{const n=Ke.__wbindgen_add_to_stack_pointer(-16);Ke.ltn_undo(n,this.__wbg_ptr);var e=dt()[n/4+0],t=dt()[n/4+1];if(t)throw Gn(e)}finally{Ke.__wbindgen_add_to_stack_pointer(16)}}redo(){try{const n=Ke.__wbindgen_add_to_stack_pointer(-16);Ke.ltn_redo(n,this.__wbg_ptr);var e=dt()[n/4+0],t=dt()[n/4+1];if(t)throw Gn(e)}finally{Ke.__wbindgen_add_to_stack_pointer(16)}}getShortcutsCrossingRoad(e){let t,n;try{const g=Ke.__wbindgen_add_to_stack_pointer(-16);Ke.ltn_getShortcutsCrossingRoad(g,this.__wbg_ptr,e);var i=dt()[g/4+0],o=dt()[g/4+1],u=dt()[g/4+2],a=dt()[g/4+3],d=i,p=o;if(a)throw d=0,p=0,Gn(u);return t=d,n=p,$r(d,p)}finally{Ke.__wbindgen_add_to_stack_pointer(16),Ke.__wbindgen_free(t,n,1)}}getAllShortcuts(){let e,t;try{const p=Ke.__wbindgen_add_to_stack_pointer(-16);Ke.ltn_getAllShortcuts(p,this.__wbg_ptr);var n=dt()[p/4+0],i=dt()[p/4+1],o=dt()[p/4+2],u=dt()[p/4+3],a=n,d=i;if(u)throw a=0,d=0,Gn(o);return e=a,t=d,$r(a,d)}finally{Ke.__wbindgen_add_to_stack_pointer(16),Ke.__wbindgen_free(e,t,1)}}toSavefile(){let e,t;try{const p=Ke.__wbindgen_add_to_stack_pointer(-16);Ke.ltn_toSavefile(p,this.__wbg_ptr);var n=dt()[p/4+0],i=dt()[p/4+1],o=dt()[p/4+2],u=dt()[p/4+3],a=n,d=i;if(u)throw a=0,d=0,Gn(o);return e=a,t=d,$r(a,d)}finally{Ke.__wbindgen_add_to_stack_pointer(16),Ke.__wbindgen_free(e,t,1)}}loadSavefile(e){try{const i=Ke.__wbindgen_add_to_stack_pointer(-16);Ke.ltn_loadSavefile(i,this.__wbg_ptr,ir(e));var t=dt()[i/4+0],n=dt()[i/4+1];if(n)throw Gn(t)}finally{Ke.__wbindgen_add_to_stack_pointer(16)}}compareRoute(e,t,n,i,o){let u,a;try{const M=Ke.__wbindgen_add_to_stack_pointer(-16);Ke.ltn_compareRoute(M,this.__wbg_ptr,e,t,n,i,o);var d=dt()[M/4+0],p=dt()[M/4+1],g=dt()[M/4+2],y=dt()[M/4+3],x=d,C=p;if(y)throw x=0,C=0,Gn(g);return u=x,a=C,$r(x,C)}finally{Ke.__wbindgen_add_to_stack_pointer(16),Ke.__wbindgen_free(u,a,1)}}impactToOneDestination(e,t){let n,i;try{const y=Ke.__wbindgen_add_to_stack_pointer(-16);Ke.ltn_impactToOneDestination(y,this.__wbg_ptr,e,t);var o=dt()[y/4+0],u=dt()[y/4+1],a=dt()[y/4+2],d=dt()[y/4+3],p=o,g=u;if(d)throw p=0,g=0,Gn(a);return n=p,i=g,$r(p,g)}finally{Ke.__wbindgen_add_to_stack_pointer(16),Ke.__wbindgen_free(n,i,1)}}predictImpact(e){let t,n;try{const g=Ke.__wbindgen_add_to_stack_pointer(-16);Ke.ltn_predictImpact(g,this.__wbg_ptr,e);var i=dt()[g/4+0],o=dt()[g/4+1],u=dt()[g/4+2],a=dt()[g/4+3],d=i,p=o;if(a)throw d=0,p=0,Gn(u);return t=d,n=p,$r(d,p)}finally{Ke.__wbindgen_add_to_stack_pointer(16),Ke.__wbindgen_free(t,n,1)}}getImpactsOnRoad(e,t){let n,i;try{const y=Ke.__wbindgen_add_to_stack_pointer(-16);Ke.ltn_getImpactsOnRoad(y,this.__wbg_ptr,e,t);var o=dt()[y/4+0],u=dt()[y/4+1],a=dt()[y/4+2],d=dt()[y/4+3],p=o,g=u;if(d)throw p=0,g=0,Gn(a);return n=p,i=g,$r(p,g)}finally{Ke.__wbindgen_add_to_stack_pointer(16),Ke.__wbindgen_free(n,i,1)}}getAllNeighbourhoods(){let e,t;try{const p=Ke.__wbindgen_add_to_stack_pointer(-16);Ke.ltn_getAllNeighbourhoods(p,this.__wbg_ptr);var n=dt()[p/4+0],i=dt()[p/4+1],o=dt()[p/4+2],u=dt()[p/4+3],a=n,d=i;if(u)throw a=0,d=0,Gn(o);return e=a,t=d,$r(a,d)}finally{Ke.__wbindgen_add_to_stack_pointer(16),Ke.__wbindgen_free(e,t,1)}}getAllIntersections(){let e,t;try{const p=Ke.__wbindgen_add_to_stack_pointer(-16);Ke.ltn_getAllIntersections(p,this.__wbg_ptr);var n=dt()[p/4+0],i=dt()[p/4+1],o=dt()[p/4+2],u=dt()[p/4+3],a=n,d=i;if(u)throw a=0,d=0,Gn(o);return e=a,t=d,$r(a,d)}finally{Ke.__wbindgen_add_to_stack_pointer(16),Ke.__wbindgen_free(e,t,1)}}getMovements(e){let t,n;try{const g=Ke.__wbindgen_add_to_stack_pointer(-16);Ke.ltn_getMovements(g,this.__wbg_ptr,e);var i=dt()[g/4+0],o=dt()[g/4+1],u=dt()[g/4+2],a=dt()[g/4+3],d=i,p=o;if(a)throw d=0,p=0,Gn(u);return t=d,n=p,$r(d,p)}finally{Ke.__wbindgen_add_to_stack_pointer(16),Ke.__wbindgen_free(t,n,1)}}getDemandModel(){let e,t;try{const p=Ke.__wbindgen_add_to_stack_pointer(-16);Ke.ltn_getDemandModel(p,this.__wbg_ptr);var n=dt()[p/4+0],i=dt()[p/4+1],o=dt()[p/4+2],u=dt()[p/4+3],a=n,d=i;if(u)throw a=0,d=0,Gn(o);return e=a,t=d,$r(a,d)}finally{Ke.__wbindgen_add_to_stack_pointer(16),Ke.__wbindgen_free(e,t,1)}}getPOIs(){let e,t;try{const p=Ke.__wbindgen_add_to_stack_pointer(-16);Ke.ltn_getPOIs(p,this.__wbg_ptr);var n=dt()[p/4+0],i=dt()[p/4+1],o=dt()[p/4+2],u=dt()[p/4+3],a=n,d=i;if(u)throw a=0,d=0,Gn(o);return e=a,t=d,$r(a,d)}finally{Ke.__wbindgen_add_to_stack_pointer(16),Ke.__wbindgen_free(e,t,1)}}}async function $M(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(n){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const t=await r.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(r,e);return t instanceof WebAssembly.Instance?{instance:t,module:r}:t}}function OM(){const r={};return r.wbg={},r.wbg.__wbindgen_error_new=function(e,t){const n=new Error($r(e,t));return ir(n)},r.wbg.__wbindgen_string_new=function(e,t){const n=$r(e,t);return ir(n)},r.wbg.__wbindgen_object_drop_ref=function(e){Gn(e)},r.wbg.__wbindgen_boolean_get=function(e){const t=Mn(e);return typeof t=="boolean"?t?1:0:2},r.wbg.__wbindgen_is_bigint=function(e){return typeof Mn(e)=="bigint"},r.wbg.__wbindgen_number_get=function(e,t){const n=Mn(t),i=typeof n=="number"?n:void 0;Xv()[e/8+1]=Au(i)?0:i,dt()[e/4+0]=!Au(i)},r.wbg.__wbindgen_string_get=function(e,t){const n=Mn(t),i=typeof n=="string"?n:void 0;var o=Au(i)?0:Do(i,Ke.__wbindgen_malloc,Ke.__wbindgen_realloc),u=vi;dt()[e/4+1]=u,dt()[e/4+0]=o},r.wbg.__wbindgen_is_object=function(e){const t=Mn(e);return typeof t=="object"&&t!==null},r.wbg.__wbindgen_in=function(e,t){return Mn(e)in Mn(t)},r.wbg.__wbindgen_bigint_from_i64=function(e){return ir(e)},r.wbg.__wbindgen_jsval_eq=function(e,t){return Mn(e)===Mn(t)},r.wbg.__wbindgen_bigint_from_u64=function(e){const t=BigInt.asUintN(64,e);return ir(t)},r.wbg.__wbindgen_is_undefined=function(e){return Mn(e)===void 0},r.wbg.__wbindgen_jsval_loose_eq=function(e,t){return Mn(e)==Mn(t)},r.wbg.__wbindgen_object_clone_ref=function(e){const t=Mn(e);return ir(t)},r.wbg.__wbg_getwithrefkey_3b3c46ba20582127=function(e,t){const n=Mn(e)[Mn(t)];return ir(n)},r.wbg.__wbg_debug_34c9290896ec9856=function(e){console.debug(Mn(e))},r.wbg.__wbg_error_e60eff06f24ab7a4=function(e){console.error(Mn(e))},r.wbg.__wbg_info_d7d58472d0bab115=function(e){console.info(Mn(e))},r.wbg.__wbg_log_a4530b4fe289336f=function(e){console.log(Mn(e))},r.wbg.__wbg_warn_f260f49434e45e62=function(e){console.warn(Mn(e))},r.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return ir(e)},r.wbg.__wbg_stack_658279fe44541cf6=function(e,t){const n=Mn(t).stack,i=Do(n,Ke.__wbindgen_malloc,Ke.__wbindgen_realloc),o=vi;dt()[e/4+1]=o,dt()[e/4+0]=i},r.wbg.__wbg_error_f851667af71bcfc6=function(e,t){let n,i;try{n=e,i=t,console.error($r(e,t))}finally{Ke.__wbindgen_free(n,i,1)}},r.wbg.__wbg_performance_3f3012faa4463882=function(e){const t=Mn(e).performance;return ir(t)},r.wbg.__wbg_now_2fd65358804c9485=function(e){return Mn(e).now()},r.wbg.__wbg_get_f01601b5a68d10e3=function(e,t){const n=Mn(e)[t>>>0];return ir(n)},r.wbg.__wbg_length_1009b1af0c481d7b=function(e){return Mn(e).length},r.wbg.__wbindgen_is_function=function(e){return typeof Mn(e)=="function"},r.wbg.__wbg_newnoargs_c62ea9419c21fbac=function(e,t){const n=new Function($r(e,t));return ir(n)},r.wbg.__wbg_next_9b877f231f476d01=function(e){const t=Mn(e).next;return ir(t)},r.wbg.__wbg_next_6529ee0cca8d57ed=function(){return fl(function(e){const t=Mn(e).next();return ir(t)},arguments)},r.wbg.__wbg_done_5fe336b092d60cf2=function(e){return Mn(e).done},r.wbg.__wbg_value_0c248a78fdc8e19f=function(e){const t=Mn(e).value;return ir(t)},r.wbg.__wbg_iterator_db7ca081358d4fb2=function(){return ir(Symbol.iterator)},r.wbg.__wbg_get_7b48513de5dc5ea4=function(){return fl(function(e,t){const n=Reflect.get(Mn(e),Mn(t));return ir(n)},arguments)},r.wbg.__wbg_call_90c26b09837aba1c=function(){return fl(function(e,t){const n=Mn(e).call(Mn(t));return ir(n)},arguments)},r.wbg.__wbg_self_f0e34d89f33b99fd=function(){return fl(function(){const e=self.self;return ir(e)},arguments)},r.wbg.__wbg_window_d3b084224f4774d7=function(){return fl(function(){const e=window.window;return ir(e)},arguments)},r.wbg.__wbg_globalThis_9caa27ff917c6860=function(){return fl(function(){const e=globalThis.globalThis;return ir(e)},arguments)},r.wbg.__wbg_global_35dfdd59a4da3e74=function(){return fl(function(){const e=global.global;return ir(e)},arguments)},r.wbg.__wbg_isArray_74fb723e24f76012=function(e){return Array.isArray(Mn(e))},r.wbg.__wbg_instanceof_ArrayBuffer_e7d53d51371448e2=function(e){let t;try{t=Mn(e)instanceof ArrayBuffer}catch{t=!1}return t},r.wbg.__wbg_isSafeInteger_f93fde0dca9820f8=function(e){return Number.isSafeInteger(Mn(e))},r.wbg.__wbg_entries_9e2e2aa45aa5094a=function(e){const t=Object.entries(Mn(e));return ir(t)},r.wbg.__wbg_buffer_a448f833075b71ba=function(e){const t=Mn(e).buffer;return ir(t)},r.wbg.__wbg_new_8f67e318f15d7254=function(e){const t=new Uint8Array(Mn(e));return ir(t)},r.wbg.__wbg_set_2357bf09366ee480=function(e,t,n){Mn(e).set(Mn(t),n>>>0)},r.wbg.__wbg_length_1d25fa9e4ac21ce7=function(e){return Mn(e).length},r.wbg.__wbg_instanceof_Uint8Array_bced6f43aed8c1aa=function(e){let t;try{t=Mn(e)instanceof Uint8Array}catch{t=!1}return t},r.wbg.__wbindgen_bigint_get_as_i64=function(e,t){const n=Mn(t),i=typeof n=="bigint"?n:void 0;DM()[e/8+1]=Au(i)?BigInt(0):i,dt()[e/4+0]=!Au(i)},r.wbg.__wbindgen_debug_string=function(e,t){const n=Am(Mn(t)),i=Do(n,Ke.__wbindgen_malloc,Ke.__wbindgen_realloc),o=vi;dt()[e/4+1]=o,dt()[e/4+0]=i},r.wbg.__wbindgen_throw=function(e,t){throw new Error($r(e,t))},r.wbg.__wbindgen_memory=function(){const e=Ke.memory;return ir(e)},r}function NM(r,e){return Ke=r.exports,Jv.__wbindgen_wasm_module=e,ih=null,nh=null,rh=null,th=null,Ke}async function Jv(r){if(Ke!==void 0)return Ke;typeof r>"u"&&(r="/ltn/assets/backend_bg.wasm");const e=OM();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:t,module:n}=await $M(await r,e);return NM(t,n)}const jM=r=>({}),o1=r=>({}),UM=r=>({}),s1=r=>({}),VM=r=>({}),a1=r=>({});function qM(r){let e,t,n,i,o,u,a,d;const p=r[1].top,g=mn(p,r,r[0],a1),y=r[1].left,x=mn(y,r,r[0],s1),C=r[1].main,M=mn(C,r,r[0],o1);return{c(){e=j("div"),t=j("div"),g&&g.c(),n=ie(),i=j("div"),o=j("div"),x&&x.c(),u=ie(),a=j("div"),M&&M.c(),ae(t,"class","top svelte-29q570"),ae(o,"class","left svelte-29q570"),ae(a,"class","main svelte-29q570"),ae(i,"class","content svelte-29q570"),ae(e,"class","flex-container svelte-29q570")},m(F,z){Z(F,e,z),D(e,t),g&&g.m(t,null),D(e,n),D(e,i),D(i,o),x&&x.m(o,null),D(i,u),D(i,a),M&&M.m(a,null),d=!0},p(F,[z]){g&&g.p&&(!d||z&1)&&_n(g,p,F,F[0],d?gn(p,F[0],z,VM):yn(F[0]),a1),x&&x.p&&(!d||z&1)&&_n(x,y,F,F[0],d?gn(y,F[0],z,UM):yn(F[0]),s1),M&&M.p&&(!d||z&1)&&_n(M,C,F,F[0],d?gn(C,F[0],z,jM):yn(F[0]),o1)},i(F){d||(N(g,F),N(x,F),N(M,F),d=!0)},o(F){V(g,F),V(x,F),V(M,F),d=!1},d(F){F&&q(e),g&&g.d(F),x&&x.d(F),M&&M.d(F)}}}function ZM(r,e,t){let{$$slots:n={},$$scope:i}=e;return r.$$set=o=>{"$$scope"in o&&t(0,i=o.$$scope)},[i,n]}class GM extends St{constructor(e){super(),kt(this,e,ZM,qM,_t,{})}}const HM=r=>({}),l1=r=>({}),WM=r=>({}),u1=r=>({}),KM=r=>({}),c1=r=>({});function XM(r){let e,t,n,i,o,u;const a=r[4].top,d=mn(a,r,r[3],c1),p=r[4].sidebar,g=mn(p,r,r[3],u1),y=r[4].map,x=mn(y,r,r[3],l1);return{c(){e=j("div"),d&&d.c(),t=ie(),n=j("div"),g&&g.c(),i=ie(),o=j("div"),x&&x.c()},m(C,M){Z(C,e,M),d&&d.m(e,null),r[5](e),Z(C,t,M),Z(C,n,M),g&&g.m(n,null),r[6](n),Z(C,i,M),Z(C,o,M),x&&x.m(o,null),r[7](o),u=!0},p(C,[M]){d&&d.p&&(!u||M&8)&&_n(d,a,C,C[3],u?gn(a,C[3],M,KM):yn(C[3]),c1),g&&g.p&&(!u||M&8)&&_n(g,p,C,C[3],u?gn(p,C[3],M,WM):yn(C[3]),u1),x&&x.p&&(!u||M&8)&&_n(x,y,C,C[3],u?gn(y,C[3],M,HM):yn(C[3]),l1)},i(C){u||(N(d,C),N(g,C),N(x,C),u=!0)},o(C){V(d,C),V(g,C),V(x,C),u=!1},d(C){C&&(q(e),q(t),q(n),q(i),q(o)),d&&d.d(C),r[5](null),g&&g.d(C),r[6](null),x&&x.d(C),r[7](null)}}}function JM(r,e,t){let n,i,o;st(r,Pm,y=>t(0,n=y)),st(r,zm,y=>t(1,i=y)),st(r,Dm,y=>t(2,o=y));let{$$slots:u={},$$scope:a}=e;function d(y){un[y?"unshift":"push"](()=>{n=y,Pm.set(n)})}function p(y){un[y?"unshift":"push"](()=>{i=y,zm.set(i)})}function g(y){un[y?"unshift":"push"](()=>{o=y,Dm.set(o)})}return r.$$set=y=>{"$$scope"in y&&t(3,a=y.$$scope)},[n,i,o,a,u,d,p,g]}class wo extends St{constructor(e){super(),kt(this,e,JM,XM,_t,{})}}let Pm=Ln(null),zm=Ln(null),Dm=Ln(null);const YM="/ltn/assets/streets-v2-style-b76f3b8b.json";function QM(r){let e;return{c(){e=Ee("Back")},m(t,n){Z(t,e,n)},d(t){t&&q(e)}}}function eL(r){let e,t,n,i;return e=new Ah({props:{$$slots:{default:[QM]},$$scope:{ctx:r}}}),e.$on("click",r[3]),{c(){ce(e.$$.fragment)},m(o,u){le(e,o,u),t=!0,n||(i=Tt(window,"keydown",r[2]),n=!0)},p(o,[u]){const a={};u&16&&(a.$$scope={dirty:u,ctx:o}),e.$set(a)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){ue(e,o),n=!1,i()}}}function tL(r,e,t){let n;st(r,Kn,a=>t(1,n=a));let{mode:i}=e;function o(a){a.key=="Escape"&&(a.stopPropagation(),an(Kn,n=i,n))}const u=()=>an(Kn,n=i,n);return r.$$set=a=>{"mode"in a&&t(0,i=a.mode)},[i,n,o,u]}class As extends St{constructor(e){super(),kt(this,e,tL,eL,_t,{mode:0})}}let vd=Ln(null);function h1(r,e,t){const n=r.slice();return n[37]=e[t],n[38]=e,n[39]=t,n}function f1(r,e,t){const n=r.slice();return n[40]=e[t],n[41]=e,n[42]=t,n}function nL(r){let e,t=r[6].length+"",n,i;return{c(){e=Ee("Undo ("),n=Ee(t),i=Ee(")")},m(o,u){Z(o,e,u),Z(o,n,u),Z(o,i,u)},p(o,u){u[0]&64&&t!==(t=o[6].length+"")&&gt(n,t)},d(o){o&&(q(e),q(n),q(i))}}}function rL(r){let e;return{c(){e=Ee("Undo")},m(t,n){Z(t,e,n)},p:ot,d(t){t&&q(e)}}}function iL(r){let e;return{c(){e=j("span"),ae(e,"class","dot svelte-11yzwwb"),jt(e,"snapped-node",r[40].snapped),jt(e,"free-node",!r[40].snapped),jt(e,"hide",r[4])},m(t,n){Z(t,e,n)},p(t,n){n[0]&128&&jt(e,"snapped-node",t[40].snapped),n[0]&128&&jt(e,"free-node",!t[40].snapped),n[0]&16&&jt(e,"hide",t[4])},d(t){t&&q(e)}}}function d1(r){let e,t,n;function i(p){r[23](p,r[40])}function o(){return r[24](r[40])}function u(){return r[25](r[40])}function a(){return r[26](r[40])}let d={draggable:!0,zIndex:0,$$slots:{default:[iL]},$$scope:{ctx:r}};return r[40].point!==void 0&&(d.lngLat=r[40].point),e=new Td({props:d}),un.push(()=>Pn(e,"lngLat",i)),e.$on("dragstart",o),e.$on("drag",u),e.$on("dragend",r[16]),e.$on("click",a),{c(){ce(e.$$.fragment)},m(p,g){le(e,p,g),n=!0},p(p,g){r=p;const y={};g[0]&144|g[1]&4096&&(y.$$scope={dirty:g,ctx:r}),!t&&g[0]&128&&(t=!0,y.lngLat=r[40].point,An(()=>t=!1)),e.$set(y)},i(p){n||(N(e.$$.fragment,p),n=!0)},o(p){V(e.$$.fragment,p),n=!1},d(p){ue(e,p)}}}function oL(r){let e;return{c(){e=j("ul"),e.innerHTML=`<li><b>Click and drag</b>
          to move</li> <li><b>Click</b>
          to toggle snapping</li> <li><b>Right click</b>
          to delete</li>`,Ye(e,"padding-right","0"),Ye(e,"padding-left","20px"),Ye(e,"margin","0")},m(t,n){Z(t,e,n)},p:ot,d(t){t&&q(e)}}}function sL(r){let e,t,n,i;return n=new cv({props:{openOn:"hover",popupClass:"edit-waypoint-popup",$$slots:{default:[oL]},$$scope:{ctx:r}}}),{c(){e=j("span"),e.textContent=`${r[39]+1}`,t=ie(),ce(n.$$.fragment),ae(e,"class","dot svelte-11yzwwb"),jt(e,"snapped",r[37].snapped)},m(o,u){Z(o,e,u),Z(o,t,u),le(n,o,u),i=!0},p(o,u){(!i||u[0]&1)&&jt(e,"snapped",o[37].snapped);const a={};u[1]&4096&&(a.$$scope={dirty:u,ctx:o}),n.$set(a)},i(o){i||(N(n.$$.fragment,o),i=!0)},o(o){V(n.$$.fragment,o),i=!1},d(o){o&&(q(e),q(t)),ue(n,o)}}}function p1(r){let e,t,n;function i(d){r[27](d,r[37])}function o(){return r[28](r[39])}function u(){return r[29](r[39])}let a={draggable:!0,zIndex:1,$$slots:{default:[sL]},$$scope:{ctx:r}};return r[37].point!==void 0&&(a.lngLat=r[37].point),e=new Td({props:a}),un.push(()=>Pn(e,"lngLat",i)),e.$on("click",o),e.$on("contextmenu",u),e.$on("mouseenter",r[30]),e.$on("mouseleave",r[31]),e.$on("dragstart",r[17]),e.$on("dragend",r[32]),{c(){ce(e.$$.fragment)},m(d,p){le(e,d,p),n=!0},p(d,p){r=d;const g={};p[0]&1|p[1]&4096&&(g.$$scope={dirty:p,ctx:r}),!t&&p[0]&1&&(t=!0,g.lngLat=r[37].point,An(()=>t=!1)),e.$set(g)},i(d){n||(N(e.$$.fragment,d),n=!0)},o(d){V(e.$$.fragment,d),n=!1},d(d){ue(e,d)}}}function aL(r){let e,t,n,i;const o=[dn("draw-area-lines"),{paint:{"line-color":"black","line-width":10}}];let u={};for(let p=0;p<o.length;p+=1)u=Mt(u,o[p]);e=new sr({props:u});const a=[dn("draw-area-area"),{paint:{"fill-color":"grey","fill-opacity":.5}}];let d={};for(let p=0;p<a.length;p+=1)d=Mt(d,a[p]);return n=new Ki({props:d}),{c(){ce(e.$$.fragment),t=ie(),ce(n.$$.fragment)},m(p,g){le(e,p,g),Z(p,t,g),le(n,p,g),i=!0},p(p,g){const y={};e.$set(y);const x={};n.$set(x)},i(p){i||(N(e.$$.fragment,p),N(n.$$.fragment,p),i=!0)},o(p){V(e.$$.fragment,p),V(n.$$.fragment,p),i=!1},d(p){p&&q(t),ue(e,p),ue(n,p)}}}function lL(r){let e,t;const n=[dn("draw-area-lines-preview"),{paint:{"line-color":"black","line-width":3}}];let i={};for(let o=0;o<n.length;o+=1)i=Mt(i,n[o]);return e=new sr({props:i}),{c(){ce(e.$$.fragment)},m(o,u){le(e,o,u),t=!0},p(o,u){const a={};e.$set(a)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){ue(e,o)}}}function uL(r){let e,t,n,i,o,u,a,d,p,g,y,x,C,M,F,z,E,P,$,U,K,ee;function W(Oe,je){return Oe[6].length==0?rL:nL}let J=W(r),he=J(r);x=new eg({}),x.$on("click",r[10]),x.$on("mousemove",r[11]);let Ae=Rn(r[7]),ne=[];for(let Oe=0;Oe<Ae.length;Oe+=1)ne[Oe]=d1(f1(r,Ae,Oe));const fe=Oe=>V(ne[Oe],1,1,()=>{ne[Oe]=null});let Ce=Rn(r[0]),_e=[];for(let Oe=0;Oe<Ce.length;Oe+=1)_e[Oe]=p1(h1(r,Ce,Oe));const Ze=Oe=>V(_e[Oe],1,1,()=>{_e[Oe]=null});return z=new mr({props:{data:r[1]||Ji(),generateId:!0,$$slots:{default:[aL]},$$scope:{ctx:r}}}),P=new mr({props:{data:r[8],$$slots:{default:[lL]},$$scope:{ctx:r}}}),U=Nm(r[22][0]),{c(){e=j("p"),e.textContent="Click the map to add three points. Then adjust the points or add more.",t=ie(),n=j("div"),i=j("label"),o=j("input"),a=Ee(`
    Snap boundary to roads`),d=ie(),p=j("button"),he.c(),y=ie(),ce(x.$$.fragment),C=ie();for(let Oe=0;Oe<ne.length;Oe+=1)ne[Oe].c();M=ie();for(let Oe=0;Oe<_e.length;Oe+=1)_e[Oe].c();F=ie(),ce(z.$$.fragment),E=ie(),ce(P.$$.fragment),o.disabled=u=r[0].length>=3,ae(o,"type","checkbox"),o.__value="snap",Vn(o,o.__value),ae(p,"class","secondary"),p.disabled=g=r[6].length==0,Ye(n,"display","flex"),Ye(n,"gap","16px"),U.p(o)},m(Oe,je){Z(Oe,e,je),Z(Oe,t,je),Z(Oe,n,je),D(n,i),D(i,o),o.checked=~(r[5]||[]).indexOf(o.__value),D(i,a),D(n,d),D(n,p),he.m(p,null),Z(Oe,y,je),le(x,Oe,je),Z(Oe,C,je);for(let De=0;De<ne.length;De+=1)ne[De]&&ne[De].m(Oe,je);Z(Oe,M,je);for(let De=0;De<_e.length;De+=1)_e[De]&&_e[De].m(Oe,je);Z(Oe,F,je),le(z,Oe,je),Z(Oe,E,je),le(P,Oe,je),$=!0,K||(ee=[Tt(o,"change",r[21]),Tt(p,"click",r[9])],K=!0)},p(Oe,je){if((!$||je[0]&1&&u!==(u=Oe[0].length>=3))&&(o.disabled=u),je[0]&32&&(o.checked=~(Oe[5]||[]).indexOf(o.__value)),J===(J=W(Oe))&&he?he.p(Oe,je):(he.d(1),he=J(Oe),he&&(he.c(),he.m(p,null))),(!$||je[0]&64&&g!==(g=Oe[6].length==0))&&(p.disabled=g),je[0]&114832){Ae=Rn(Oe[7]);let ut;for(ut=0;ut<Ae.length;ut+=1){const ht=f1(Oe,Ae,ut);ne[ut]?(ne[ut].p(ht,je),N(ne[ut],1)):(ne[ut]=d1(ht),ne[ut].c(),N(ne[ut],1),ne[ut].m(M.parentNode,M))}for(Kt(),ut=Ae.length;ut<ne.length;ut+=1)fe(ut);Xt()}if(je[0]&143373){Ce=Rn(Oe[0]);let ut;for(ut=0;ut<Ce.length;ut+=1){const ht=h1(Oe,Ce,ut);_e[ut]?(_e[ut].p(ht,je),N(_e[ut],1)):(_e[ut]=p1(ht),_e[ut].c(),N(_e[ut],1),_e[ut].m(F.parentNode,F))}for(Kt(),ut=Ce.length;ut<_e.length;ut+=1)Ze(ut);Xt()}const De={};je[0]&2&&(De.data=Oe[1]||Ji()),je[1]&4096&&(De.$$scope={dirty:je,ctx:Oe}),z.$set(De);const At={};je[0]&256&&(At.data=Oe[8]),je[1]&4096&&(At.$$scope={dirty:je,ctx:Oe}),P.$set(At)},i(Oe){if(!$){N(x.$$.fragment,Oe);for(let je=0;je<Ae.length;je+=1)N(ne[je]);for(let je=0;je<Ce.length;je+=1)N(_e[je]);N(z.$$.fragment,Oe),N(P.$$.fragment,Oe),$=!0}},o(Oe){V(x.$$.fragment,Oe),ne=ne.filter(Boolean);for(let je=0;je<ne.length;je+=1)V(ne[je]);_e=_e.filter(Boolean);for(let je=0;je<_e.length;je+=1)V(_e[je]);V(z.$$.fragment,Oe),V(P.$$.fragment,Oe),$=!1},d(Oe){Oe&&(q(e),q(t),q(n),q(y),q(C),q(M),q(F),q(E)),he.d(),ue(x,Oe),gi(ne,Oe),gi(_e,Oe),ue(z,Oe),ue(P,Oe),U.r(),K=!1,ur(ee)}}}function cL(r,e){if(e.length<3)return JSON.parse(r.inner.calculateRoute(e));let t=JSON.parse(JSON.stringify(e));t.push(t[0]);let n=JSON.parse(r.inner.calculateRoute(t));return n.properties.waypoints.pop(),n.geometry.type="Polygon",n.geometry.coordinates=[n.geometry.coordinates],n}function hL(r,e,t){let n,i;st(r,vd,Qe=>t(20,i=Qe));let{map:o}=e,{waypoints:u}=e,{drawnShapeOut:a=void 0}=e;ti(()=>{i==null||i.stop(),o.getCanvas().style.cursor="inherit"});let d="snap",p=[],g=[],y=null,x=!1,C=!1,M=!1;function F(Qe){let Ft=Qe.length==0?"crosshair":"inherit";o.getCanvas().style.cursor=Ft}function z(){let Qe=p.pop();t(6,p),Qe&&t(0,u=Qe)}function E(){p.length==100&&p.shift(),t(6,p=[...p,JSON.parse(JSON.stringify(u))])}function P(Qe){u.length>=3||(E(),u.push({point:Qe.detail.lngLat.toArray(),snapped:d=="snap"}),t(0,u))}function $(Qe){t(19,y={point:Qe.detail.lngLat.toArray(),snapped:d=="snap"})}function U(Qe){E(),t(0,u[Qe].snapped=!u[Qe].snapped,u),t(0,u)}function K(Qe){E(),u.splice(Qe,1),t(0,u),t(2,x=!1)}function ee(Qe,Ft,bt,Bt){if(Bt||Ft.length>=3)return Ji();try{if(Qe&&Ft.length>0&&bt)return JSON.parse(Qe.inner.calculateRoute([Ft[Ft.length-1],bt]))}catch{}return Ji()}function W(Qe,Ft,bt){if(bt)return;if(!Qe||Ft.length<3){t(7,g=[]);return}let Bt=[],Pt=1,Qt=JSON.parse(JSON.stringify(Ft));Qt.push(Qt[0]);for(let vn=0;vn<Qt.length-1;vn++){let qt=JSON.parse(Qe.inner.getExtraNodes(Qt[vn],Qt[vn+1]));for(let[rn,Ge,qe]of qt)Bt.push({point:[rn,Ge],snapped:qe,insertIdx:Pt});Pt++}t(7,g=Bt)}function J(Qe){E(),u.splice(Qe.insertIdx,0,{point:Qe.point,snapped:Qe.snapped}),t(0,u),t(4,M=!0)}function he(Qe){t(0,u[Qe.insertIdx].point=Qe.point,u),t(0,u)}function Ae(){t(4,M=!1)}function ne(){E(),t(3,C=!0)}const fe=[[]];function Ce(){d=ux(fe[0],this.__value,this.checked),t(5,d)}function _e(Qe,Ft){r.$$.not_equal(Ft.point,Qe)&&(Ft.point=Qe,t(7,g))}const Ze=Qe=>J(Qe),Oe=Qe=>he(Qe),je=Qe=>{J(Qe),t(4,M=!1)};function De(Qe,Ft){r.$$.not_equal(Ft.point,Qe)&&(Ft.point=Qe,t(0,u))}const At=Qe=>U(Qe),ut=Qe=>K(Qe),ht=()=>t(2,x=!0),wt=()=>t(2,x=!1),pt=()=>t(3,C=!1);return r.$$set=Qe=>{"map"in Qe&&t(18,o=Qe.map),"waypoints"in Qe&&t(0,u=Qe.waypoints),"drawnShapeOut"in Qe&&t(1,a=Qe.drawnShapeOut)},r.$$.update=()=>{if(r.$$.dirty[0]&1048577)try{i&&t(1,a=cL(i,u))}catch(Qe){console.log("error drawing shape",Qe),t(1,a=void 0)}r.$$.dirty[0]&1048593&&W(i,u,M),r.$$.dirty[0]&1572877&&t(8,n=ee(i,u,y,x||C)),r.$$.dirty[0]&1&&F(u)},[u,a,x,C,M,d,p,g,n,z,P,$,U,K,J,he,Ae,ne,o,y,i,Ce,fe,_e,Ze,Oe,je,De,At,ut,ht,wt,pt]}class Yv extends St{constructor(e){super(),kt(this,e,hL,uL,_t,{map:18,waypoints:0,drawnShapeOut:1},null,[-1,-1])}}function m1(r){let e,t,n,i,o=Math.round(r[0].properties.population/r[0].properties.area_km2).toLocaleString()+"",u,a,d,p,g,y,x,C=r[0].properties.simd.toFixed(1)+"",M,F,z,E,P,$,U,K=(r[0].properties.number_stats19_collisions/r[0].properties.area_km2).toFixed(1)+"",ee,W,J,he,Ae,ne,fe,Ce=Nu(r[0].properties.households_with_cars_or_vans,r[0].properties.total_households)+"",_e,Ze,Oe,je,De,At,ut,ht=(r[0].properties.number_pois/r[0].properties.area_km2).toFixed(1)+"",wt,pt;return{c(){e=j("tr"),t=j("th"),t.textContent="Population density",n=ie(),i=j("td"),u=Ee(o),a=Ee(" people / km"),d=ie(),p=j("tr"),g=j("th"),g.textContent="SIMD",y=ie(),x=j("td"),M=Ee(C),F=Ee("%"),z=ie(),E=j("tr"),P=j("th"),P.textContent="Collision density",$=ie(),U=j("td"),ee=Ee(K),W=Ee(" / km"),J=ie(),he=j("tr"),Ae=j("th"),Ae.textContent="Car ownership",ne=ie(),fe=j("td"),_e=Ee(Ce),Ze=Ee(" of households"),Oe=ie(),je=j("tr"),De=j("th"),De.textContent="POI density",At=ie(),ut=j("td"),wt=Ee(ht),pt=Ee(" / km")},m(Qe,Ft){Z(Qe,e,Ft),D(e,t),D(e,n),D(e,i),D(i,u),D(i,a),Z(Qe,d,Ft),Z(Qe,p,Ft),D(p,g),D(p,y),D(p,x),D(x,M),D(x,F),Z(Qe,z,Ft),Z(Qe,E,Ft),D(E,P),D(E,$),D(E,U),D(U,ee),D(U,W),Z(Qe,J,Ft),Z(Qe,he,Ft),D(he,Ae),D(he,ne),D(he,fe),D(fe,_e),D(fe,Ze),Z(Qe,Oe,Ft),Z(Qe,je,Ft),D(je,De),D(je,At),D(je,ut),D(ut,wt),D(ut,pt)},p(Qe,Ft){Ft&1&&o!==(o=Math.round(Qe[0].properties.population/Qe[0].properties.area_km2).toLocaleString()+"")&&gt(u,o),Ft&1&&C!==(C=Qe[0].properties.simd.toFixed(1)+"")&&gt(M,C),Ft&1&&K!==(K=(Qe[0].properties.number_stats19_collisions/Qe[0].properties.area_km2).toFixed(1)+"")&&gt(ee,K),Ft&1&&Ce!==(Ce=Nu(Qe[0].properties.households_with_cars_or_vans,Qe[0].properties.total_households)+"")&&gt(_e,Ce),Ft&1&&ht!==(ht=(Qe[0].properties.number_pois/Qe[0].properties.area_km2).toFixed(1)+"")&&gt(wt,ht)},d(Qe){Qe&&(q(e),q(d),q(p),q(z),q(E),q(J),q(he),q(Oe),q(je))}}}function fL(r){let e,t,n,i,o,u=r[0].properties.area_km2.toFixed(1)+"",a,d,p,g=r[1]=="cnt"&&m1(r);return{c(){e=j("table"),t=j("tr"),n=j("th"),n.textContent="Area",i=ie(),o=j("td"),a=Ee(u),d=Ee(" km"),p=ie(),g&&g.c(),ae(e,"class","svelte-1kpsyee")},m(y,x){Z(y,e,x),D(e,t),D(t,n),D(t,i),D(t,o),D(o,a),D(o,d),D(e,p),g&&g.m(e,null)},p(y,[x]){x&1&&u!==(u=y[0].properties.area_km2.toFixed(1)+"")&&gt(a,u),y[1]=="cnt"?g?g.p(y,x):(g=m1(y),g.c(),g.m(e,null)):g&&(g.d(1),g=null)},i:ot,o:ot,d(y){y&&q(e),g&&g.d()}}}function dL(r,e,t){let n;st(r,is,o=>t(1,n=o));let{neighbourhoodBoundary:i}=e;return r.$$set=o=>{"neighbourhoodBoundary"in o&&t(0,i=o.neighbourhoodBoundary)},[i,n]}class Qv extends St{constructor(e){super(),kt(this,e,dL,fL,_t,{neighbourhoodBoundary:0})}}function ew(r,e,t){let n=new Set(r.toSavefile().features.filter(i=>i.properties.kind=="boundary").map(i=>i.properties.name));for(;;){let i=window.prompt(e,t);if(i===null)return null;if(i=i.trim(),i==="")window.alert("Neighbourhood cannot be blank; please pick a name or cancel");else if(n.has(i))window.alert(`There is already a neighbourhood called ${i}; please pick another name`);else return i}}function pL(r){let e,t,n,i;return e=new No({props:{colorScale:Ev,labels:{limits:Lv}}}),{c(){ce(e.$$.fragment),t=ie(),n=j("div"),n.textContent="POIs / km",Ye(n,"text-align","center")},m(o,u){le(e,o,u),Z(o,t,u),Z(o,n,u),i=!0},i(o){i||(N(e.$$.fragment,o),i=!0)},o(o){V(e.$$.fragment,o),i=!1},d(o){o&&(q(t),q(n)),ue(e,o)}}}function mL(r){let e,t,n,i;return e=new No({props:{colorScale:Mv,labels:{limits:Cv}}}),{c(){ce(e.$$.fragment),t=ie(),n=j("div"),n.textContent="collisions / km",Ye(n,"text-align","center")},m(o,u){le(e,o,u),Z(o,t,u),Z(o,n,u),i=!0},i(o){i||(N(e.$$.fragment,o),i=!0)},o(o){V(e.$$.fragment,o),i=!1},d(o){o&&(q(t),q(n)),ue(e,o)}}}function gL(r){let e,t,n,i;return e=new No({props:{colorScale:Md,labels:{buckets:Iv(Ld)}}}),{c(){ce(e.$$.fragment),t=ie(),n=j("div"),n.innerHTML="<span>More deprived</span> <span>Less deprived</span>",ae(n,"class","sub-labels svelte-3xhwrh")},m(o,u){le(e,o,u),Z(o,t,u),Z(o,n,u),i=!0},i(o){i||(N(e.$$.fragment,o),i=!0)},o(o){V(e.$$.fragment,o),i=!1},d(o){o&&(q(t),q(n)),ue(e,o)}}}function _L(r){let e,t,n,i;return e=new No({props:{colorScale:Pd,labels:{limits:Ad.map(vL)}}}),{c(){ce(e.$$.fragment),t=ie(),n=j("div"),n.innerHTML='<span style="text-align: center; width: 100%">Households with at least one car or van</span>',Ye(n,"display","flex"),Ye(n,"justify-content","space-between")},m(o,u){le(e,o,u),Z(o,t,u),Z(o,n,u),i=!0},i(o){i||(N(e.$$.fragment,o),i=!0)},o(o){V(e.$$.fragment,o),i=!1},d(o){o&&(q(t),q(n)),ue(e,o)}}}function yL(r){let e,t,n,i;return e=new No({props:{colorScale:Ed,labels:{limits:Id}}}),{c(){ce(e.$$.fragment),t=ie(),n=j("div"),n.innerHTML="<span>Less dense</span> <span>people / km</span> <span>More dense</span>",ae(n,"class","sub-labels svelte-3xhwrh")},m(o,u){le(e,o,u),Z(o,t,u),Z(o,n,u),i=!0},i(o){i||(N(e.$$.fragment,o),i=!0)},o(o){V(e.$$.fragment,o),i=!1},d(o){o&&(q(t),q(n)),ue(e,o)}}}function bL(r){let e,t,n,i,o,u,a,d,p,g,y,x,C,M,F,z,E;const P=[yL,_L,gL,mL,pL],$=[];function U(K,ee){return K[0]=="density"?0:K[0]=="car_ownership"?1:K[0]=="simd"?2:K[0]=="stats19"?3:K[0]=="pois"?4:-1}return~(x=U(r))&&(C=$[x]=P[x](r)),{c(){e=j("div"),t=j("label"),t.textContent="Metric",n=ie(),i=j("select"),o=j("option"),o.textContent="None",u=j("option"),u.textContent="Density",a=j("option"),a.textContent="Collisions",d=j("option"),d.textContent="SIMD",p=j("option"),p.textContent="Points of interest",g=j("option"),g.textContent="Car ownership",y=ie(),C&&C.c(),M=Xn(),ae(t,"for","prioritization-selection"),o.__value="none",Vn(o,o.__value),u.__value="density",Vn(u,u.__value),a.__value="stats19",Vn(a,a.__value),d.__value="simd",Vn(d,d.__value),p.__value="pois",Vn(p,p.__value),g.__value="car_ownership",Vn(g,g.__value),ae(i,"id","prioritization-selection"),r[0]===void 0&&ds(()=>r[1].call(i)),Ye(e,"display","flex"),Ye(e,"gap","16px"),Ye(e,"align-items","center")},m(K,ee){Z(K,e,ee),D(e,t),D(e,n),D(e,i),D(i,o),D(i,u),D(i,a),D(i,d),D(i,p),D(i,g),Hi(i,r[0],!0),Z(K,y,ee),~x&&$[x].m(K,ee),Z(K,M,ee),F=!0,z||(E=Tt(i,"change",r[1]),z=!0)},p(K,[ee]){ee&1&&Hi(i,K[0]);let W=x;x=U(K),x!==W&&(C&&(Kt(),V($[W],1,1,()=>{$[W]=null}),Xt()),~x?(C=$[x],C||(C=$[x]=P[x](K),C.c()),N(C,1),C.m(M.parentNode,M)):C=null)},i(K){F||(N(C),F=!0)},o(K){V(C),F=!1},d(K){K&&(q(e),q(y),q(M)),~x&&$[x].d(K),z=!1,E()}}}const vL=r=>`${r}%`;function wL(r,e,t){let n;st(r,is,a=>t(2,n=a));let{selectedPrioritization:i}=e;function o(){let a=new URL(window.location.href).searchParams.get("prioritizationMetric");a=="density"?t(0,i="density"):a=="simd"?t(0,i="simd"):a=="stats19"?t(0,i="stats19"):a=="pois"?t(0,i="pois"):a=="car_ownership"&&t(0,i="car_ownership")}n=="cnt"?o():i="none";function u(){i=Sa(this),t(0,i)}return r.$$set=a=>{"selectedPrioritization"in a&&t(0,i=a.selectedPrioritization)},r.$$.update=()=>{if(r.$$.dirty&1){const a=new URL(window.location.href);i=="none"?a.searchParams.delete("prioritizationMetric"):a.searchParams.set("prioritizationMetric",i),history.replaceState({},"",a)}},[i,u]}class tw extends St{constructor(e){super(),kt(this,e,wL,bL,_t,{selectedPrioritization:0})}}function nw(r,e){return{none:r.none,area:co(["get","area_km2"],w5,x5),car_ownership:co(["*",100,["/",["get","households_with_cars_or_vans"],["get","total_households"]]],Ad,Pd),density:co(["/",["get","population"],["get","area_km2"]],Id,Ed),pois:co(["/",["get","number_pois"],["get","area_km2"]],Lv,Ev),simd:co(["get","simd"],Ld,Md),stats19:co(["/",["get","number_stats19_collisions"],["get","area_km2"]],Cv,Mv)}[e]}function xL(r){let e,t,n,i,o,u,a,d,p,g,y=gr(r[8].mode)+"",x,C;return o=new jn({props:{mode:{mode:"title"}}}),d=new jn({props:{mode:{mode:"pick-neighbourhood"}}}),{c(){e=j("div"),t=j("nav"),n=j("ul"),i=j("li"),ce(o.$$.fragment),u=ie(),a=j("li"),ce(d.$$.fragment),p=ie(),g=j("li"),x=Ee(y),ae(t,"aria-label","breadcrumb"),ae(e,"slot","top")},m(M,F){Z(M,e,F),D(e,t),D(t,n),D(n,i),le(o,i,null),D(n,u),D(n,a),le(d,a,null),D(n,p),D(n,g),D(g,x),C=!0},p(M,F){(!C||F&256)&&y!==(y=gr(M[8].mode)+"")&&gt(x,y)},i(M){C||(N(o.$$.fragment,M),N(d.$$.fragment,M),C=!0)},o(M){V(o.$$.fragment,M),V(d.$$.fragment,M),C=!1},d(M){M&&q(e),ue(o),ue(d)}}}function g1(r){let e,t,n,i,o,u,a;function d(g){r[20](g)}let p={};return r[4]!==void 0&&(p.selectedPrioritization=r[4]),o=new tw({props:p}),un.push(()=>Pn(o,"selectedPrioritization",d)),{c(){e=j("h3"),e.textContent="Prioritization",t=ie(),n=j("p"),n.textContent="Compare metrics across candidate neighbourhoods.",i=ie(),ce(o.$$.fragment)},m(g,y){Z(g,e,y),Z(g,t,y),Z(g,n,y),Z(g,i,y),le(o,g,y),a=!0},p(g,y){const x={};!u&&y&16&&(u=!0,x.selectedPrioritization=g[4],An(()=>u=!1)),o.$set(x)},i(g){a||(N(o.$$.fragment,g),a=!0)},o(g){V(o.$$.fragment,g),a=!1},d(g){g&&(q(e),q(t),q(n),q(i)),ue(o,g)}}}function _1(r){let e;return{c(){e=j("p"),e.textContent="The colors are arbitrary, just to distinguish better."},m(t,n){Z(t,e,n)},d(t){t&&q(e)}}}function kL(r){let e,t,n,i,o,u,a,d;function p(x){r[23](x)}function g(x){r[24](x)}let y={map:or(r[10])};return r[6]!==void 0&&(y.waypoints=r[6]),r[1]!==void 0&&(y.drawnShapeOut=r[1]),n=new Yv({props:y}),un.push(()=>Pn(n,"waypoints",p)),un.push(()=>Pn(n,"drawnShapeOut",g)),{c(){e=j("div"),e.innerHTML='<h3 class="svelte-qlwqvq">1. Draw your neighbourhood</h3>',t=ie(),ce(n.$$.fragment),u=ie(),a=j("div"),a.innerHTML=`<h3 class="svelte-qlwqvq">2. Refine your boundary</h3> <p>Continue to add, delete, and move points until you&#39;re happy with
            your neighbourhood boundary. Don&#39;t worry, you can always adjust the
            boundary more later.</p>`,ae(e,"class","step svelte-qlwqvq"),jt(e,"active",!r[7]),jt(e,"complete",r[7]),ae(a,"class","step svelte-qlwqvq"),Ye(a,"margin-top","16px"),jt(a,"active",r[7]),jt(a,"complete",r[5].size>1)},m(x,C){Z(x,e,C),Z(x,t,C),le(n,x,C),Z(x,u,C),Z(x,a,C),d=!0},p(x,C){(!d||C&128)&&jt(e,"active",!x[7]),(!d||C&128)&&jt(e,"complete",x[7]);const M={};C&1024&&(M.map=or(x[10])),!i&&C&64&&(i=!0,M.waypoints=x[6],An(()=>i=!1)),!o&&C&2&&(o=!0,M.drawnShapeOut=x[1],An(()=>o=!1)),n.$set(M),(!d||C&128)&&jt(a,"active",x[7]),(!d||C&32)&&jt(a,"complete",x[5].size>1)},i(x){d||(N(n.$$.fragment,x),d=!0)},o(x){V(n.$$.fragment,x),d=!1},d(x){x&&(q(e),q(t),q(u),q(a)),ue(n,x)}}}function SL(r){let e,t,n;return{c(){e=j("div"),e.innerHTML=`<h3 class="svelte-qlwqvq">1. Click an area to start your neighbourhood</h3> <p>These particular boundaries are suggested by finding roads,
            railways, and water that form severances.</p>`,t=ie(),n=j("div"),n.innerHTML='<h3 class="svelte-qlwqvq">2. Include additional areas</h3> <p>Click any adjacent areas you&#39;d like to add to your boundary.</p>',ae(e,"class","step svelte-qlwqvq"),jt(e,"active",!r[7]),jt(e,"complete",r[7]),ae(n,"class","step svelte-qlwqvq"),jt(n,"active",r[7]),jt(n,"complete",r[5].size>1)},m(i,o){Z(i,e,o),Z(i,t,o),Z(i,n,o)},p(i,o){o&128&&jt(e,"active",!i[7]),o&128&&jt(e,"complete",i[7]),o&128&&jt(n,"active",i[7]),o&32&&jt(n,"complete",i[5].size>1)},i:ot,o:ot,d(i){i&&(q(e),q(t),q(n))}}}function TL(r){let e;function t(o,u){if(o[0]=="choose-area")return LL;if(o[0]=="draw-area")return ML}let n=t(r),i=n&&n(r);return{c(){e=j("span"),i&&i.c(),Ye(e,"text-align","center")},m(o,u){Z(o,e,u),i&&i.m(e,null)},p(o,u){n===(n=t(o))&&i?i.p(o,u):(i&&i.d(1),i=n&&n(o),i&&(i.c(),i.m(e,null)))},i:ot,o:ot,d(o){o&&q(e),i&&i.d()}}}function CL(r){let e,t;return e=new Qv({props:{neighbourhoodBoundary:r[7]}}),{c(){ce(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p(n,i){const o={};i&128&&(o.neighbourhoodBoundary=n[7]),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){ue(e,n)}}}function ML(r){let e;function t(o,u){return o[6].length<3?IL:EL}let n=t(r),i=n(r);return{c(){i.c(),e=Xn()},m(o,u){i.m(o,u),Z(o,e,u)},p(o,u){n!==(n=t(o))&&(i.d(1),i=n(o),i&&(i.c(),i.m(e.parentNode,e)))},d(o){o&&q(e),i.d(o)}}}function LL(r){let e;return{c(){e=Ee("Empty so far. Click an area to get started.")},m(t,n){Z(t,e,n)},p:ot,d(t){t&&q(e)}}}function EL(r){let e;return{c(){e=Ee(`Not a valid shape yet  try dragging the points into a box
                around your neighbourhood. Note the ordering of the points.`)},m(t,n){Z(t,e,n)},d(t){t&&q(e)}}}function IL(r){let e;return{c(){e=Ee(`Empty so far. Click the map to add points around your
                neighborhood to get started.`)},m(t,n){Z(t,e,n)},d(t){t&&q(e)}}}function AL(r){let e,t,n,i,o,u,a,d,p,g,y,x,C,M,F,z,E,P,$,U,K,ee,W,J,he,Ae,ne,fe,Ce,_e,Ze,Oe,je,De,At,ut,ht,wt,pt,Qe,Ft,bt,Bt,Pt,Qt,vn;t=new As({props:{mode:{mode:"pick-neighbourhood"}}});let qt=r[9]=="cnt"&&g1(r),rn=r[4]=="none"&&_1();const Ge=[SL,kL],qe=[];function Je(Ue,it){return Ue[0]=="choose-area"?0:Ue[0]=="draw-area"?1:-1}~(U=Je(r))&&(K=qe[U]=Ge[U](r)),Ze=new Jm({});const Et=[CL,TL],ye=[];function kn(Ue,it){return Ue[7]?0:1}return wt=kn(r),pt=ye[wt]=Et[wt](r),{c(){e=j("div"),ce(t.$$.fragment),n=ie(),qt&&qt.c(),i=ie(),rn&&rn.c(),o=ie(),u=j("hr"),a=ie(),d=j("div"),p=j("div"),g=j("button"),y=Ee("Choose area"),C=ie(),M=j("span"),M.textContent="or",F=ie(),z=j("button"),E=Ee("Draw area"),$=ie(),K&&K.c(),ee=ie(),W=j("div"),W.innerHTML='<h3 class="svelte-qlwqvq">3. Finished?</h3> <p>When you&#39;re done, click &quot;Create&quot;.</p>',J=ie(),he=j("div"),Ae=j("button"),ne=Ee("Create neighborhood"),Ce=ie(),_e=j("button"),ce(Ze.$$.fragment),Oe=Ee(" Start over"),De=ie(),At=j("h3"),At.textContent="Your neighbourhood overall",ut=ie(),ht=j("div"),pt.c(),Qe=ie(),Ft=j("hr"),bt=ie(),Bt=j("button"),Bt.textContent="Export to GeoJSON",g.disabled=x=r[0]=="choose-area",ae(g,"class","svelte-qlwqvq"),jt(g,"active",r[0]=="choose-area"),Ye(M,"margin","0 16px"),z.disabled=P=r[0]=="draw-area",ae(z,"class","svelte-qlwqvq"),jt(z,"active",r[0]=="draw-area"),ae(p,"class","modes svelte-qlwqvq"),ae(W,"class","step svelte-qlwqvq"),jt(W,"active",r[7]),Ae.disabled=fe=!r[7],ae(_e,"class","destructive"),Ye(_e,"display","flex"),Ye(_e,"gap","8px"),Ye(_e,"align-items","center"),_e.disabled=je=!(r[7]||r[0]=="draw-area"&&r[6].length>0),Ye(he,"display","flex"),Ye(he,"gap","16px"),Ye(he,"justify-content","space-between"),Ye(he,"margin-bottom","16px"),ae(ht,"class","neighbourhood-boundary-summary svelte-qlwqvq"),ae(Bt,"class","secondary"),ae(e,"slot","sidebar")},m(Ue,it){Z(Ue,e,it),le(t,e,null),D(e,n),qt&&qt.m(e,null),D(e,i),rn&&rn.m(e,null),D(e,o),D(e,u),D(e,a),D(e,d),D(d,p),D(p,g),D(g,y),D(p,C),D(p,M),D(p,F),D(p,z),D(z,E),D(d,$),~U&&qe[U].m(d,null),D(d,ee),D(d,W),D(d,J),D(d,he),D(he,Ae),D(Ae,ne),D(he,Ce),D(he,_e),le(Ze,_e,null),D(_e,Oe),D(d,De),D(d,At),D(d,ut),D(d,ht),ye[wt].m(ht,null),D(e,Qe),D(e,Ft),D(e,bt),D(e,Bt),Pt=!0,Qt||(vn=[Tt(g,"click",r[21]),Tt(z,"click",r[22]),Tt(Ae,"click",r[25]),Tt(_e,"click",r[16]),Tt(Bt,"click",r[13])],Qt=!0)},p(Ue,it){Ue[9]=="cnt"?qt?(qt.p(Ue,it),it&512&&N(qt,1)):(qt=g1(Ue),qt.c(),N(qt,1),qt.m(e,i)):qt&&(Kt(),V(qt,1,1,()=>{qt=null}),Xt()),Ue[4]=="none"?rn||(rn=_1(),rn.c(),rn.m(e,o)):rn&&(rn.d(1),rn=null),(!Pt||it&1&&x!==(x=Ue[0]=="choose-area"))&&(g.disabled=x),(!Pt||it&1)&&jt(g,"active",Ue[0]=="choose-area"),(!Pt||it&1&&P!==(P=Ue[0]=="draw-area"))&&(z.disabled=P),(!Pt||it&1)&&jt(z,"active",Ue[0]=="draw-area");let Wt=U;U=Je(Ue),U===Wt?~U&&qe[U].p(Ue,it):(K&&(Kt(),V(qe[Wt],1,1,()=>{qe[Wt]=null}),Xt()),~U?(K=qe[U],K?K.p(Ue,it):(K=qe[U]=Ge[U](Ue),K.c()),N(K,1),K.m(d,ee)):K=null),(!Pt||it&128)&&jt(W,"active",Ue[7]),(!Pt||it&128&&fe!==(fe=!Ue[7]))&&(Ae.disabled=fe),(!Pt||it&193&&je!==(je=!(Ue[7]||Ue[0]=="draw-area"&&Ue[6].length>0)))&&(_e.disabled=je);let cr=wt;wt=kn(Ue),wt===cr?ye[wt].p(Ue,it):(Kt(),V(ye[cr],1,1,()=>{ye[cr]=null}),Xt(),pt=ye[wt],pt?pt.p(Ue,it):(pt=ye[wt]=Et[wt](Ue),pt.c()),N(pt,1),pt.m(ht,null))},i(Ue){Pt||(N(t.$$.fragment,Ue),N(qt),N(K),N(Ze.$$.fragment,Ue),N(pt),Pt=!0)},o(Ue){V(t.$$.fragment,Ue),V(qt),V(K),V(Ze.$$.fragment,Ue),V(pt),Pt=!1},d(Ue){Ue&&q(e),ue(t),qt&&qt.d(),rn&&rn.d(),~U&&qe[U].d(),ue(Ze),ye[wt].d(),Qt=!1,ur(vn)}}}function y1(r){let e,t;return e=new mr({props:{data:{type:"FeatureCollection",features:[r[7]]},$$slots:{default:[PL]},$$scope:{ctx:r}}}),{c(){ce(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p(n,i){const o={};i&128&&(o.data={type:"FeatureCollection",features:[n[7]]}),i&536870912&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){ue(e,n)}}}function PL(r){let e,t,n,i;const o=[dn("neighbourhood-boundaries-selected-outline",!1),{paint:{"line-color":"black","line-width":4,"line-dasharray":[2,2]}}];let u={};for(let p=0;p<o.length;p+=1)u=Mt(u,o[p]);e=new sr({props:u});const a=[dn("neighbourhood-boundaries-selected-outline-base",!1),{paint:{"line-color":"white","line-width":8,"line-opacity":.7}}];let d={};for(let p=0;p<a.length;p+=1)d=Mt(d,a[p]);return n=new sr({props:d}),{c(){ce(e.$$.fragment),t=ie(),ce(n.$$.fragment)},m(p,g){le(e,p,g),Z(p,t,g),le(n,p,g),i=!0},p(p,g){const y={};e.$set(y);const x={};n.$set(x)},i(p){i||(N(e.$$.fragment,p),N(n.$$.fragment,p),i=!0)},o(p){V(e.$$.fragment,p),V(n.$$.fragment,p),i=!1},d(p){p&&q(t),ue(e,p),ue(n,p)}}}function b1(r){let e,t;return e=new mr({props:{data:r[3],generateId:!0,$$slots:{default:[NL]},$$scope:{ctx:r}}}),{c(){ce(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p(n,i){const o={};i&8&&(o.data=n[3]),i&536870928&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){ue(e,n)}}}function v1(r){let e,t;return e=new di({props:{openOn:"hover",$$slots:{default:[$L,({props:n})=>({28:n}),({props:n})=>n?268435456:0]},$$scope:{ctx:r}}}),{c(){ce(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p(n,i){const o={};i&805306384&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){ue(e,n)}}}function zL(r){let e,t,n,i,o=(r[28].number_pois/r[28].area_km2).toFixed(1)+"",u,a;return{c(){e=j("b"),e.textContent="Points of interest",t=ie(),n=j("br"),i=ie(),u=Ee(o),a=Ee(" / km")},m(d,p){Z(d,e,p),Z(d,t,p),Z(d,n,p),Z(d,i,p),Z(d,u,p),Z(d,a,p)},p(d,p){p&268435456&&o!==(o=(d[28].number_pois/d[28].area_km2).toFixed(1)+"")&&gt(u,o)},d(d){d&&(q(e),q(t),q(n),q(i),q(u),q(a))}}}function DL(r){let e,t,n,i,o=(r[28].number_stats19_collisions/r[28].area_km2).toFixed(1)+"",u,a;return{c(){e=j("b"),e.textContent="Pedestrian and cyclist collisions",t=ie(),n=j("br"),i=ie(),u=Ee(o),a=Ee(` /
                km`)},m(d,p){Z(d,e,p),Z(d,t,p),Z(d,n,p),Z(d,i,p),Z(d,u,p),Z(d,a,p)},p(d,p){p&268435456&&o!==(o=(d[28].number_stats19_collisions/d[28].area_km2).toFixed(1)+"")&&gt(u,o)},d(d){d&&(q(e),q(t),q(n),q(i),q(u),q(a))}}}function RL(r){let e,t,n,i,o=Math.round(r[28].population/r[28].area_km2).toLocaleString()+"",u,a;return{c(){e=j("b"),e.textContent="Population density",t=ie(),n=j("br"),i=ie(),u=Ee(o),a=Ee(`
                people / km`)},m(d,p){Z(d,e,p),Z(d,t,p),Z(d,n,p),Z(d,i,p),Z(d,u,p),Z(d,a,p)},p(d,p){p&268435456&&o!==(o=Math.round(d[28].population/d[28].area_km2).toLocaleString()+"")&&gt(u,o)},d(d){d&&(q(e),q(t),q(n),q(i),q(u),q(a))}}}function FL(r){let e,t,n,i,o=Nu(r[28].households_with_cars_or_vans,r[28].total_households)+"",u,a,d=r[28].total_households.toLocaleString()+"",p,g;return{c(){e=j("b"),e.textContent="Car or van ownership",t=ie(),n=j("br"),i=ie(),u=Ee(o),a=Ee(" of approximately "),p=Ee(d),g=Ee(`
                households have at least one car or van.`)},m(y,x){Z(y,e,x),Z(y,t,x),Z(y,n,x),Z(y,i,x),Z(y,u,x),Z(y,a,x),Z(y,p,x),Z(y,g,x)},p(y,x){x&268435456&&o!==(o=Nu(y[28].households_with_cars_or_vans,y[28].total_households)+"")&&gt(u,o),x&268435456&&d!==(d=y[28].total_households.toLocaleString()+"")&&gt(p,d)},d(y){y&&(q(e),q(t),q(n),q(i),q(u),q(a),q(p),q(g))}}}function BL(r){let e,t,n=r[28].area_km2.toFixed(1)+"",i,o;return{c(){e=j("b"),e.textContent="Area:",t=ie(),i=Ee(n),o=Ee(" km")},m(u,a){Z(u,e,a),Z(u,t,a),Z(u,i,a),Z(u,o,a)},p(u,a){a&268435456&&n!==(n=u[28].area_km2.toFixed(1)+"")&&gt(i,n)},d(u){u&&(q(e),q(t),q(i),q(o))}}}function $L(r){let e;function t(o,u){if(o[4]=="none")return BL;if(o[4]=="car_ownership")return FL;if(o[4]=="density")return RL;if(o[4]=="stats19")return DL;if(o[4]=="pois")return zL}let n=t(r),i=n&&n(r);return{c(){i&&i.c(),e=Xn()},m(o,u){i&&i.m(o,u),Z(o,e,u)},p(o,u){n===(n=t(o))&&i?i.p(o,u):(i&&i.d(1),i=n&&n(o),i&&(i.c(),i.m(e.parentNode,e)))},d(o){o&&q(e),i&&i.d(o)}}}function OL(r){let e,t,n=r[4]!="simd"&&v1(r);return{c(){n&&n.c(),e=Xn()},m(i,o){n&&n.m(i,o),Z(i,e,o),t=!0},p(i,o){i[4]!="simd"?n?(n.p(i,o),o&16&&N(n,1)):(n=v1(i),n.c(),N(n,1),n.m(e.parentNode,e)):n&&(Kt(),V(n,1,1,()=>{n=null}),Xt())},i(i){t||(N(n),t=!0)},o(i){V(n),t=!1},d(i){i&&q(e),n&&n.d(i)}}}function NL(r){let e,t,n,i;const o=[dn("neighbourhood-boundaries",!1),{paint:{"fill-color":r[14](r[4]),"fill-opacity":r[15](r[4])}},{manageHoverState:!0},{hoverCursor:"pointer"}];let u={$$slots:{default:[OL]},$$scope:{ctx:r}};for(let p=0;p<o.length;p+=1)u=Mt(u,o[p]);e=new Ki({props:u}),e.$on("click",r[11]);const a=[dn("neighbourhood-boundaries-outline",!1),{paint:{"line-color":"black","line-width":1}}];let d={};for(let p=0;p<a.length;p+=1)d=Mt(d,a[p]);return n=new sr({props:d}),{c(){ce(e.$$.fragment),t=ie(),ce(n.$$.fragment)},m(p,g){le(e,p,g),Z(p,t,g),le(n,p,g),i=!0},p(p,g){const y=g&49168?En(o,[o[0],{paint:{"fill-color":p[14](p[4]),"fill-opacity":p[15](p[4])}},o[2],o[3]]):{};g&536870928&&(y.$$scope={dirty:g,ctx:p}),e.$set(y);const x={};n.$set(x)},i(p){i||(N(e.$$.fragment,p),N(n.$$.fragment,p),i=!0)},o(p){V(e.$$.fragment,p),V(n.$$.fragment,p),i=!1},d(p){p&&q(t),ue(e,p),ue(n,p)}}}function jL(r){let e,t,n,i=r[7]&&y1(r),o=r[0]=="choose-area"&&b1(r);return{c(){e=j("div"),i&&i.c(),t=ie(),o&&o.c(),ae(e,"slot","map")},m(u,a){Z(u,e,a),i&&i.m(e,null),D(e,t),o&&o.m(e,null),n=!0},p(u,a){u[7]?i?(i.p(u,a),a&128&&N(i,1)):(i=y1(u),i.c(),N(i,1),i.m(e,t)):i&&(Kt(),V(i,1,1,()=>{i=null}),Xt()),u[0]=="choose-area"?o?(o.p(u,a),a&1&&N(o,1)):(o=b1(u),o.c(),N(o,1),o.m(e,null)):o&&(Kt(),V(o,1,1,()=>{o=null}),Xt())},i(u){n||(N(i),N(o),n=!0)},o(u){V(i),V(o),n=!1},d(u){u&&q(e),i&&i.d(),o&&o.d()}}}function UL(r){let e,t,n,i;return e=new Ch({props:{loading:r[2]}}),n=new wo({props:{$$slots:{map:[jL],sidebar:[AL],top:[xL]},$$scope:{ctx:r}}}),{c(){ce(e.$$.fragment),t=ie(),ce(n.$$.fragment)},m(o,u){le(e,o,u),Z(o,t,u),le(n,o,u),i=!0},p(o,[u]){const a={};u&4&&(a.loading=o[2]),e.$set(a);const d={};u&536872955&&(d.$$scope={dirty:u,ctx:o}),n.$set(d)},i(o){i||(N(e.$$.fragment,o),N(n.$$.fragment,o),i=!0)},o(o){V(e.$$.fragment,o),V(n.$$.fragment,o),i=!1},d(o){o&&q(t),ue(e,o),ue(n,o)}}}function VL(r,e,t){let n,i,o,u,a,d;st(r,Kn,Ze=>t(8,n=Ze)),st(r,Cr,Ze=>t(19,i=Ze)),st(r,yl,Ze=>t(26,o=Ze)),st(r,ta,Ze=>t(27,u=Ze)),st(r,is,Ze=>t(9,a=Ze)),st(r,rs,Ze=>t(10,d=Ze));let p="Generating severance boundaries...",g=Ji(),y="choose-area",x="none",C=null,M=new Map,F=[],z,E=null,P=null;Es(async()=>{await new Promise(Ze=>{requestAnimationFrame(()=>{requestAnimationFrame(Ze)})}),t(3,g=i.generatedBoundaries()),t(2,p="")});function $(Ze){let Oe=Ze.detail.features[0].id,je=g.features[Oe],De=new Map(M);if(De.has(Oe)?De.delete(Oe):De.set(Oe,je),De.size===0)t(17,C=null),t(5,M=De);else if(De.size===1)t(17,C=De.values().next().value),t(5,M=De);else{let At={type:"FeatureCollection",features:Array.from(De.values())};try{t(17,C=i.generateMergedBoundary(At)),t(5,M=De)}catch(ut){console.log(`error merging boundaries: ${ut}`),window.alert(`Sorry, the boundaries you selected cannot be merged.
Error: ${ut}`)}}}function U(Ze){var De;let Oe=u.nextAvailableNeighbourhoodName(o),je=ew(i,"What do you want to name the neighbourhood?",Oe);if(je)try{const At={};y=="draw-area"&&((De=z==null?void 0:z.properties)!=null&&De.waypoints)&&(At.waypoints=z.properties.waypoints);let ut={type:"Feature",properties:At,geometry:Ze.geometry};i.setNeighbourhoodBoundary(je,ut),yh(),i.setCurrentNeighbourhood(je),an(Kn,n={mode:"neighbourhood"},n)}catch(At){window.alert(`Sorry, this boundary is invalid: ${At}`)}}function K(){xd("auto_boundaries.geojson",JSON.stringify(g,null,"  "))}function ee(Ze){return nw({none:["match",["%",["id"],5],0,"blue",1,"yellow",2,"green",3,"purple",4,"orange","black"]},Ze)}function W(Ze){return{none:Wn(.3,.5),area:Wn(.7,.9),car_ownership:Wn(.7,.9),density:Wn(.7,.9),pois:Wn(.7,.9),simd:Wn(.7,.9),stats19:Wn(.7,.9)}[Ze]}function J(){t(17,C=null),M.clear(),t(5,M),t(6,F=[]),t(18,E=null),t(7,P=null)}function he(Ze){x=Ze,t(4,x)}const Ae=()=>t(0,y="choose-area"),ne=()=>t(0,y="draw-area");function fe(Ze){F=Ze,t(6,F)}function Ce(Ze){z=Ze,t(1,z)}const _e=()=>U(or(P));return r.$$.update=()=>{if(r.$$.dirty&524290){let Ze=null;if(z&&z.geometry.coordinates[0].length>3){let Oe={type:"FeatureCollection",features:[z]};try{Ze=i.generateMergedBoundary(Oe)}catch(je){console.log(`error merging boundaries: ${je}`)}}t(18,E=Ze)}r.$$.dirty&393217&&(y=="draw-area"?t(7,P=E):t(7,P=C))},[y,z,p,g,x,M,F,P,n,a,d,$,U,K,ee,W,J,C,E,i,he,Ae,ne,fe,Ce,_e]}class qL extends St{constructor(e){super(),kt(this,e,VL,UL,_t,{})}}const bi=class bi{constructor(e,t,n){Yn(this,"filterType");Yn(this,"label");Yn(this,"description");this.filterType=e,this.label=t,this.description=n}get iconURL(){return`/ltn//filters/${this.filterType}_icon.gif`}get largeImageURL(){return`/ltn//filters/${this.filterType}.gif`}static getFilter(e){switch(e){case"walk_cycle_only":return bi.walkCycleOnly;case"no_entry":return bi.noEntry;case"bus_gate":return bi.busGate;case"school_street":return bi.schoolStreet;default:console.assert(`unknown filter type: "${e}"`);return}}};Yn(bi,"walkCycleOnly",new bi("walk_cycle_only","Walking/cycling only","A physical barrier that only allows people walking, cycling, and rolling to pass. Often planters or bollards. Larger vehicles cannot enter.")),Yn(bi,"noEntry",new bi("no_entry","No entry","An alternative sign to indicate vehicles are not allowed to enter the street. Only people walking, cycling, and rolling may pass through.")),Yn(bi,"busGate",new bi("bus_gate","Bus gate","A bus gate sign and traffic cameras are installed to allow buses, pedestrians, and cyclists to pass. There is no physical barrier.")),Yn(bi,"schoolStreet",new bi("school_street","School street","A closure during school hours only. The barrier usually allows teachers and staff to access the school.")),Yn(bi,"allTypes",[bi.walkCycleOnly,bi.noEntry,bi.busGate,bi.schoolStreet]);let uo=bi;function ZL(r){let e,t,n,i,o,u,a,d,p,g,y,x,C,M=gr(r[7].mode)+"",F,z;return o=new jn({props:{mode:{mode:"title"}}}),d=new jn({props:{mode:{mode:"pick-neighbourhood"}}}),y=new jn({props:{mode:{mode:"predict-impact"}}}),{c(){e=j("div"),t=j("nav"),n=j("ul"),i=j("li"),ce(o.$$.fragment),u=ie(),a=j("li"),ce(d.$$.fragment),p=ie(),g=j("li"),ce(y.$$.fragment),x=ie(),C=j("li"),F=Ee(M),ae(t,"aria-label","breadcrumb"),ae(e,"slot","top")},m(E,P){Z(E,e,P),D(e,t),D(t,n),D(n,i),le(o,i,null),D(n,u),D(n,a),le(d,a,null),D(n,p),D(n,g),le(y,g,null),D(n,x),D(n,C),D(C,F),z=!0},p(E,P){(!z||P&128)&&M!==(M=gr(E[7].mode)+"")&&gt(F,M)},i(E){z||(N(o.$$.fragment,E),N(d.$$.fragment,E),N(y.$$.fragment,E),z=!0)},o(E){V(o.$$.fragment,E),V(d.$$.fragment,E),V(y.$$.fragment,E),z=!1},d(E){E&&q(e),ue(o),ue(d),ue(y)}}}function GL(r){let e;return{c(){e=j("p"),e.textContent="Hover on a zone"},m(t,n){Z(t,e,n)},p:ot,d(t){t&&q(e)}}}function HL(r){let e,t=r[6].properties.name+"",n,i,o,u,a=r[6].properties.sum_from.toLocaleString()+"",d,p,g,y,x=r[6].properties.sum_to.toLocaleString()+"",C,M,F,z,E=r[6].properties.counts_from[r[3]]+"",P;return{c(){e=j("u"),n=Ee(t),i=ie(),o=j("p"),u=Ee("Total trips from here: "),d=Ee(a),p=ie(),g=j("p"),y=Ee("Total trips to here: "),C=Ee(x),M=ie(),F=j("p"),z=Ee("Total intra-zonal trips starting and ending here: "),P=Ee(E)},m($,U){Z($,e,U),D(e,n),Z($,i,U),Z($,o,U),D(o,u),D(o,d),Z($,p,U),Z($,g,U),D(g,y),D(g,C),Z($,M,U),Z($,F,U),D(F,z),D(F,P)},p($,U){U&64&&t!==(t=$[6].properties.name+"")&&gt(n,t),U&64&&a!==(a=$[6].properties.sum_from.toLocaleString()+"")&&gt(d,a),U&64&&x!==(x=$[6].properties.sum_to.toLocaleString()+"")&&gt(C,x),U&72&&E!==(E=$[6].properties.counts_from[$[3]]+"")&&gt(P,E)},d($){$&&(q(e),q(i),q(o),q(p),q(g),q(M),q(F))}}}function WL(r){let e,t,n,i,o,u=r[0].features.length.toLocaleString()+"",a,d,p,g,y,x,C,M,F,z,E=r[1]?"from":"to",P,$,U=r[3]==null?"each zone":"this zone",K,ee,W,J,he,Ae,ne,fe,Ce,_e;t=new As({props:{mode:{mode:"predict-impact"}}}),J=new No({props:{colorScale:nd,labels:{limits:r[5]}}});function Ze(De,At){return De[6]&&De[3]!=null?HL:GL}let Oe=Ze(r),je=Oe(r);return{c(){e=j("div"),ce(t.$$.fragment),n=ie(),i=j("p"),o=Ee("Trips begin and end in "),a=Ee(u),d=Ee(" zones"),p=ie(),g=j("label"),y=Ee(`Trips from
      `),x=j("input"),C=Ee(`
      Trips to`),M=ie(),F=j("p"),z=Ee("Trips "),P=Ee(E),$=ie(),K=Ee(U),ee=Ee(":"),W=ie(),ce(J.$$.fragment),he=ie(),Ae=j("hr"),ne=ie(),je.c(),ae(x,"type","checkbox"),ae(x,"role","switch"),ae(e,"slot","sidebar")},m(De,At){Z(De,e,At),le(t,e,null),D(e,n),D(e,i),D(i,o),D(i,a),D(i,d),D(e,p),D(e,g),D(g,y),D(g,x),x.checked=r[1],D(g,C),D(e,M),D(e,F),D(F,z),D(F,P),D(F,$),D(F,K),D(F,ee),D(e,W),le(J,e,null),D(e,he),D(e,Ae),D(e,ne),je.m(e,null),fe=!0,Ce||(_e=Tt(x,"change",r[9]),Ce=!0)},p(De,At){(!fe||At&1)&&u!==(u=De[0].features.length.toLocaleString()+"")&&gt(a,u),At&2&&(x.checked=De[1]),(!fe||At&2)&&E!==(E=De[1]?"from":"to")&&gt(P,E),(!fe||At&8)&&U!==(U=De[3]==null?"each zone":"this zone")&&gt(K,U);const ut={};At&32&&(ut.labels={limits:De[5]}),J.$set(ut),Oe===(Oe=Ze(De))&&je?je.p(De,At):(je.d(1),je=Oe(De),je&&(je.c(),je.m(e,null)))},i(De){fe||(N(t.$$.fragment,De),N(J.$$.fragment,De),fe=!0)},o(De){V(t.$$.fragment,De),V(J.$$.fragment,De),fe=!1},d(De){De&&q(e),ue(t),ue(J),je.d(),Ce=!1,_e()}}}function KL(r){let e,t,n,i,o;const u=[dn("debug-demand-fill"),{paint:{"fill-color":r[4],"fill-opacity":Wn(.5,.1)}},{manageHoverState:!0}];function a(y){r[8](y)}let d={};for(let y=0;y<u.length;y+=1)d=Mt(d,u[y]);r[2]!==void 0&&(d.hovered=r[2]),e=new Ki({props:d}),un.push(()=>Pn(e,"hovered",a));const p=[dn("debug-demand-outline"),{paint:{"line-width":2,"line-color":"black"}}];let g={};for(let y=0;y<p.length;y+=1)g=Mt(g,p[y]);return i=new sr({props:g}),{c(){ce(e.$$.fragment),n=ie(),ce(i.$$.fragment)},m(y,x){le(e,y,x),Z(y,n,x),le(i,y,x),o=!0},p(y,x){const C=x&16?En(u,[u[0],{paint:{"fill-color":y[4],"fill-opacity":Wn(.5,.1)}},u[2]]):{};!t&&x&4&&(t=!0,C.hovered=y[2],An(()=>t=!1)),e.$set(C);const M={};i.$set(M)},i(y){o||(N(e.$$.fragment,y),N(i.$$.fragment,y),o=!0)},o(y){V(e.$$.fragment,y),V(i.$$.fragment,y),o=!1},d(y){y&&q(n),ue(e,y),ue(i,y)}}}function XL(r){let e,t,n;return t=new mr({props:{data:r[0],generateId:!0,$$slots:{default:[KL]},$$scope:{ctx:r}}}),{c(){e=j("div"),ce(t.$$.fragment),ae(e,"slot","map")},m(i,o){Z(i,e,o),le(t,e,null),n=!0},p(i,o){const u={};o&1&&(u.data=i[0]),o&8212&&(u.$$scope={dirty:o,ctx:i}),t.$set(u)},i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){V(t.$$.fragment,i),n=!1},d(i){i&&q(e),ue(t)}}}function JL(r){let e,t;return e=new wo({props:{$$slots:{map:[XL],sidebar:[WL],top:[ZL]},$$scope:{ctx:r}}}),{c(){ce(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p(n,[i]){const o={};i&8447&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){ue(e,n)}}}function YL(r,e,t){let n,i,o,u,a,d;st(r,Kn,z=>t(7,a=z)),st(r,Cr,z=>t(10,d=z));let p=Ji();try{p=d.getDemandModel()}catch{window.alert("No demand model for this area"),an(Kn,a={mode:"pick-neighbourhood"},a)}let g=!1,y=null;function x(z,E){if(z==null){let P=E?"sum_to":"sum_from",$=Math.max(...p.features.map(K=>K.properties[P])),U=C($);return[U,co(["get",P],U,nd)]}else{let P=E?"counts_to":"counts_from",$=[...p.features.map(ee=>ee.properties[P][z])],U=Math.max(...$),K=C(U);return[K,co(["at",["id"],["literal",$]],K,nd)]}}function C(z){let E=nd.length+1;return Array.from(Array(E).keys()).map(P=>Math.round(z/(E-1)*P))}function M(z){y=z,t(2,y)}function F(){g=this.checked,t(1,g)}return r.$$.update=()=>{r.$$.dirty&4&&t(3,n=y==null?null:y.id),r.$$.dirty&9&&t(6,i=n!=null?p.features[n]:null),r.$$.dirty&10&&t(5,[o,u]=x(n,g),o,(t(4,u),t(3,n),t(1,g),t(2,y)))},[p,g,y,n,u,o,i,a,M,F]}class QL extends St{constructor(e){super(),kt(this,e,YL,JL,_t,{})}}function eE(r){let e,t,n,i,o,u,a,d,p,g,y=gr(r[4].mode)+"",x,C;return o=new jn({props:{mode:{mode:"title"}}}),d=new jn({props:{mode:{mode:"pick-neighbourhood"}}}),{c(){e=j("div"),t=j("nav"),n=j("ul"),i=j("li"),ce(o.$$.fragment),u=ie(),a=j("li"),ce(d.$$.fragment),p=ie(),g=j("li"),x=Ee(y),ae(t,"aria-label","breadcrumb"),ae(e,"slot","top")},m(M,F){Z(M,e,F),D(e,t),D(t,n),D(n,i),le(o,i,null),D(n,u),D(n,a),le(d,a,null),D(n,p),D(n,g),D(g,x),C=!0},p(M,F){(!C||F&16)&&y!==(y=gr(M[4].mode)+"")&&gt(x,y)},i(M){C||(N(o.$$.fragment,M),N(d.$$.fragment,M),C=!0)},o(M){V(o.$$.fragment,M),V(d.$$.fragment,M),C=!1},d(M){M&&q(e),ue(o),ue(d)}}}function w1(r){let e,t,n,i,o,u,a;function d(g){r[7](g)}let p={list:r[1].features};return r[2]!==void 0&&(p.idx=r[2]),n=new Cd({props:p}),un.push(()=>Pn(n,"idx",d)),{c(){e=j("button"),e.textContent="Pick another intersection",t=ie(),ce(n.$$.fragment),ae(e,"class","secondary")},m(g,y){Z(g,e,y),Z(g,t,y),le(n,g,y),o=!0,u||(a=Tt(e,"click",r[6]),u=!0)},p(g,y){const x={};y&2&&(x.list=g[1].features),!i&&y&4&&(i=!0,x.idx=g[2],An(()=>i=!1)),n.$set(x)},i(g){o||(N(n.$$.fragment,g),o=!0)},o(g){V(n.$$.fragment,g),o=!1},d(g){g&&(q(e),q(t)),ue(n,g),u=!1,a()}}}function x1(r){let e,t;return{c(){e=j("a"),t=Ee("Open OSM"),ae(e,"href",r[0]),ae(e,"target","_blank")},m(n,i){Z(n,e,i),D(e,t)},p(n,i){i&1&&ae(e,"href",n[0])},d(n){n&&q(e)}}}function tE(r){let e,t,n,i,o,u,a;t=new As({props:{mode:{mode:"pick-neighbourhood"}}});let d=r[1].features.length>0&&w1(r),p=r[0]&&x1(r);return{c(){e=j("div"),ce(t.$$.fragment),n=ie(),i=j("p"),i.textContent="Purple intersections have some kind of turn restriction.",o=ie(),d&&d.c(),u=ie(),p&&p.c(),ae(e,"slot","sidebar")},m(g,y){Z(g,e,y),le(t,e,null),D(e,n),D(e,i),D(e,o),d&&d.m(e,null),D(e,u),p&&p.m(e,null),a=!0},p(g,y){g[1].features.length>0?d?(d.p(g,y),y&2&&N(d,1)):(d=w1(g),d.c(),N(d,1),d.m(e,u)):d&&(Kt(),V(d,1,1,()=>{d=null}),Xt()),g[0]?p?p.p(g,y):(p=x1(g),p.c(),p.m(e,null)):p&&(p.d(1),p=null)},i(g){a||(N(t.$$.fragment,g),N(d),a=!0)},o(g){V(t.$$.fragment,g),V(d),a=!1},d(g){g&&q(e),ue(t),d&&d.d(),p&&p.d()}}}function nE(r){let e,t;const n=[dn("debug-intersections"),{paint:{"circle-radius":15,"circle-color":["case",["get","has_turn_restrictions"],"purple","black"]}},{manageHoverState:!0},{hoverCursor:"pointer"}];let i={};for(let o=0;o<n.length;o+=1)i=Mt(i,n[o]);return e=new xl({props:i}),e.$on("click",r[5]),{c(){ce(e.$$.fragment)},m(o,u){le(e,o,u),t=!0},p(o,u){const a={};e.$set(a)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){ue(e,o)}}}function rE(r){let e,t,n,i;const o=[dn("debug-movements-outline"),{paint:{"line-width":2,"line-color":"red"}}];let u={};for(let p=0;p<o.length;p+=1)u=Mt(u,o[p]);e=new sr({props:u});const a=[dn("debug-movements-fill"),{filter:["==",["id"],r[2]]},{paint:{"fill-color":"cyan"}}];let d={};for(let p=0;p<a.length;p+=1)d=Mt(d,a[p]);return n=new Ki({props:d}),{c(){ce(e.$$.fragment),t=ie(),ce(n.$$.fragment)},m(p,g){le(e,p,g),Z(p,t,g),le(n,p,g),i=!0},p(p,g){const y={};e.$set(y);const x=g&4?En(a,[a[0],{filter:["==",["id"],p[2]]},a[2]]):{};n.$set(x)},i(p){i||(N(e.$$.fragment,p),N(n.$$.fragment,p),i=!0)},o(p){V(e.$$.fragment,p),V(n.$$.fragment,p),i=!1},d(p){p&&q(t),ue(e,p),ue(n,p)}}}function iE(r){let e,t,n,i,o;return t=new mr({props:{data:or(r[3]).getAllIntersections(),generateId:!0,$$slots:{default:[nE]},$$scope:{ctx:r}}}),i=new mr({props:{data:r[1],generateId:!0,$$slots:{default:[rE]},$$scope:{ctx:r}}}),{c(){e=j("div"),ce(t.$$.fragment),n=ie(),ce(i.$$.fragment),ae(e,"slot","map")},m(u,a){Z(u,e,a),le(t,e,null),D(e,n),le(i,e,null),o=!0},p(u,a){const d={};a&8&&(d.data=or(u[3]).getAllIntersections()),a&256&&(d.$$scope={dirty:a,ctx:u}),t.$set(d);const p={};a&2&&(p.data=u[1]),a&260&&(p.$$scope={dirty:a,ctx:u}),i.$set(p)},i(u){o||(N(t.$$.fragment,u),N(i.$$.fragment,u),o=!0)},o(u){V(t.$$.fragment,u),V(i.$$.fragment,u),o=!1},d(u){u&&q(e),ue(t),ue(i)}}}function oE(r){let e,t;return e=new wo({props:{$$slots:{map:[iE],sidebar:[tE],top:[eE]},$$scope:{ctx:r}}}),{c(){ce(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p(n,[i]){const o={};i&287&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){ue(e,n)}}}function sE(r,e,t){let n,i;st(r,Cr,y=>t(3,n=y)),st(r,Kn,y=>t(4,i=y));let o=null,u=Ji(),a=0;function d(y){t(0,o=y.detail.features[0].properties.osm),t(1,u=n.getMovements(y.detail.features[0].id)),t(2,a=0)}const p=()=>t(1,u=Ji());function g(y){a=y,t(2,a)}return[o,u,a,n,i,d,p,g]}class aE extends St{constructor(e){super(),kt(this,e,sE,oE,_t,{})}}function lE(r){let e,t,n,i;const o=[dn("cells"),{filter:["==",["get","kind"],"cell"]},{layout:{visibility:r[0]=="cells"?"none":"visible"}},{paint:{"fill-color":ld(),"fill-opacity":.5,"fill-outline-color":"hsla(0, 0%, 0%, 0.3)"}}];let u={};for(let p=0;p<o.length;p+=1)u=Mt(u,o[p]);e=new Ki({props:u});const a=[dn("border-entries"),{filter:["==",["get","kind"],"border_entry"]},{layout:{"icon-image":"border_entry_arrow","icon-rotate":["get","bearing_upon_entry"],"icon-allow-overlap":!0,"icon-size":Hf(1),"icon-offset":k1(1),"symbol-sort-key":["get","bearing_upon_entry"],visibility:r[1]?"visible":"none"}},{paint:{"icon-color":ld(),"icon-halo-color":"black","icon-opacity":S1(),"icon-halo-width":Hf(1.5),"icon-halo-blur":0}},{minzoom:13},{interactive:!1}];let d={};for(let p=0;p<a.length;p+=1)d=Mt(d,a[p]);return n=new Ou({props:d}),{c(){ce(e.$$.fragment),t=ie(),ce(n.$$.fragment)},m(p,g){le(e,p,g),Z(p,t,g),le(n,p,g),i=!0},p(p,[g]){const y=g&1?En(o,[o[0],o[1],{layout:{visibility:p[0]=="cells"?"none":"visible"}},o[3]]):{};e.$set(y);const x=g&2?En(a,[a[0],a[1],g&2&&{layout:{"icon-image":"border_entry_arrow","icon-rotate":["get","bearing_upon_entry"],"icon-allow-overlap":!0,"icon-size":Hf(1),"icon-offset":k1(1),"symbol-sort-key":["get","bearing_upon_entry"],visibility:p[1]?"visible":"none"}},g&0&&{paint:{"icon-color":ld(),"icon-halo-color":"black","icon-opacity":S1(),"icon-halo-width":Hf(1.5),"icon-halo-blur":0}},a[4],a[5]]):{};n.$set(x)},i(p){i||(N(e.$$.fragment,p),N(n.$$.fragment,p),i=!0)},o(p){V(e.$$.fragment,p),V(n.$$.fragment,p),i=!1},d(p){p&&q(t),ue(e,p),ue(n,p)}}}function Hf(r){return["interpolate",["linear"],["zoom"],14,.08*r,22,.7*r]}function k1(r){return[0,-50*r]}function S1(){return["interpolate",["linear"],["zoom"],14,1,22,.7]}function uE(r,e,t){let n,i;return st(r,md,o=>t(0,n=o)),st(r,um,o=>t(1,i=o)),[n,i]}class zd extends St{constructor(e){super(),kt(this,e,uE,lE,_t,{})}}function cE(r){let e,t;const n=[dn("neighbourhood-boundary"),{filter:["==",["get","kind"],"boundary"]},{paint:{"fill-color":"black","fill-opacity":.3}}];let i={};for(let o=0;o<n.length;o+=1)i=Mt(i,n[o]);return e=new Ki({props:i}),{c(){ce(e.$$.fragment)},m(o,u){le(e,o,u),t=!0},p(o,[u]){const a={};e.$set(a)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){ue(e,o)}}}class Dd extends St{constructor(e){super(),kt(this,e,null,cE,_t,{})}}const hE=r=>({}),T1=r=>({}),fE=r=>({}),C1=r=>({});function M1(r){let e;const t=r[7]["line-popup"],n=mn(t,r,r[10],C1);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&1024)&&_n(n,t,i,i[10],e?gn(t,i[10],o,fE):yn(i[10]),C1)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function dE(r){let e,t,n=r[0]&&M1(r);return{c(){n&&n.c(),e=Xn()},m(i,o){n&&n.m(i,o),Z(i,e,o),t=!0},p(i,o){i[0]?n?(n.p(i,o),o&1&&N(n,1)):(n=M1(i),n.c(),N(n,1),n.m(e.parentNode,e)):n&&(Kt(),V(n,1,1,()=>{n=null}),Xt())},i(i){t||(N(n),t=!0)},o(i){V(n),t=!1},d(i){i&&q(e),n&&n.d(i)}}}function L1(r){let e;const t=r[7]["line-popup"],n=mn(t,r,r[10],T1);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&1024)&&_n(n,t,i,i[10],e?gn(t,i[10],o,hE):yn(i[10]),T1)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function pE(r){let e,t,n=r[0]&&L1(r);return{c(){n&&n.c(),e=Xn()},m(i,o){n&&n.m(i,o),Z(i,e,o),t=!0},p(i,o){i[0]?n?(n.p(i,o),o&1&&N(n,1)):(n=L1(i),n.c(),N(n,1),n.m(e.parentNode,e)):n&&(Kt(),V(n,1,1,()=>{n=null}),Xt())},i(i){t||(N(n),t=!0)},o(i){V(n),t=!1},d(i){i&&q(e),n&&n.d(i)}}}function mE(r){let e,t,n,i,o,u,a,d;const p=[dn("interior-roads-outlines"),{filter:["==",["get","kind"],"interior_road"]},{paint:{"line-width":r[6](r[2],r[4].maxShortcuts,1),"line-color":"black"}},{minzoom:13}];let g={};for(let E=0;E<p.length;E+=1)g=Mt(g,p[E]);e=new sr({props:g});const y=[dn("interior-roads"),{filter:["==",["get","kind"],"interior_road"]},{paint:{"line-width":r[6](r[2],r[4].maxShortcuts,0),"line-color":r[5](r[3],r[4].maxShortcuts),"line-opacity":Wn(1,.5)}},{layout:{"line-sort-key":["get","shortcuts"]}},{minzoom:13},{manageHoverState:r[0]},{hoverCursor:r[0]?"pointer":void 0}];let x={$$slots:{default:[dE]},$$scope:{ctx:r}};for(let E=0;E<y.length;E+=1)x=Mt(x,y[E]);n=new sr({props:x}),n.$on("click",r[8]);const C=[dn("main-roads-outlines"),{filter:["==",["get","kind"],"main_road"]},{paint:{"line-width":r[6](r[2],r[4].maxShortcuts,6),"line-color":"black"}},{minzoom:13}];let M={};for(let E=0;E<C.length;E+=1)M=Mt(M,C[E]);o=new sr({props:M});const F=[dn("main-roads"),{filter:["==",["get","kind"],"main_road"]},{paint:{"line-width":r[6](r[2],r[4].maxShortcuts,4),"line-color":Wn("gray",yo.mapFeature.hover.backgroundColor),"line-opacity":Wn(1,.5)}},{layout:{"line-sort-key":["get","shortcuts"]}},{minzoom:13},{manageHoverState:r[0]},{hoverCursor:r[0]?"pointer":void 0}];let z={$$slots:{default:[pE]},$$scope:{ctx:r}};for(let E=0;E<F.length;E+=1)z=Mt(z,F[E]);return a=new sr({props:z}),a.$on("click",r[9]),{c(){ce(e.$$.fragment),t=ie(),ce(n.$$.fragment),i=ie(),ce(o.$$.fragment),u=ie(),ce(a.$$.fragment)},m(E,P){le(e,E,P),Z(E,t,P),le(n,E,P),Z(E,i,P),le(o,E,P),Z(E,u,P),le(a,E,P),d=!0},p(E,[P]){const $=P&84?En(p,[p[0],p[1],{paint:{"line-width":E[6](E[2],E[4].maxShortcuts,1),"line-color":"black"}},p[3]]):{};e.$set($);const U=P&125?En(y,[y[0],y[1],P&124&&{paint:{"line-width":E[6](E[2],E[4].maxShortcuts,0),"line-color":E[5](E[3],E[4].maxShortcuts),"line-opacity":Wn(1,.5)}},y[3],y[4],P&1&&{manageHoverState:E[0]},P&1&&{hoverCursor:E[0]?"pointer":void 0}]):{};P&1025&&(U.$$scope={dirty:P,ctx:E}),n.$set(U);const K=P&84?En(C,[C[0],C[1],{paint:{"line-width":E[6](E[2],E[4].maxShortcuts,6),"line-color":"black"}},C[3]]):{};o.$set(K);const ee=P&85?En(F,[F[0],F[1],P&84&&{paint:{"line-width":E[6](E[2],E[4].maxShortcuts,4),"line-color":Wn("gray",yo.mapFeature.hover.backgroundColor),"line-opacity":Wn(1,.5)}},F[3],F[4],P&1&&{manageHoverState:E[0]},P&1&&{hoverCursor:E[0]?"pointer":void 0}]):{};P&1025&&(ee.$$scope={dirty:P,ctx:E}),a.$set(ee)},i(E){d||(N(e.$$.fragment,E),N(n.$$.fragment,E),N(o.$$.fragment,E),N(a.$$.fragment,E),d=!0)},o(E){V(e.$$.fragment,E),V(n.$$.fragment,E),V(o.$$.fragment,E),V(a.$$.fragment,E),d=!1},d(E){E&&(q(t),q(i),q(u)),ue(e,E),ue(n,E),ue(o,E),ue(a,E)}}}function gE(r,e,t){let n,i;st(r,cm,M=>t(2,n=M)),st(r,md,M=>t(3,i=M));let{$$slots:o={},$$scope:u}=e,a=Th("neighbourhoodGj"),{interactive:d=!0}=e,{onClickLine:p=(M,F)=>{}}=e;function g(M,F){return M=="cells"?ld():M=="edits"?Wn(["case",["get","edited"],k5,"white"],yo.mapFeature.hover.backgroundColor):M=="speeds"?co(["get","speed_mph"],Tv,Sv):F<=2?Wn("white","blue"):(console.assert(M=="shortcuts"),Wn(["interpolate-hcl",["linear"],["get","shortcuts"],0,"white",1,"#F19A93",F,"#A32015"],yo.mapFeature.hover.backgroundColor))}function y(M,F,z){return!M||F<=2?Hs(z):["interpolate",["linear"],["get","shortcuts"],0,5+z,F,25+z]}const x=M=>d&&p(M.detail.features[0],M.detail.event.lngLat),C=M=>d&&p(M.detail.features[0],M.detail.event.lngLat);return r.$$set=M=>{"interactive"in M&&t(0,d=M.interactive),"onClickLine"in M&&t(1,p=M.onClickLine),"$$scope"in M&&t(10,u=M.$$scope)},[d,p,n,i,a,g,y,o,x,C,u]}class zh extends St{constructor(e){super(),kt(this,e,gE,mE,_t,{interactive:0,onClickLine:1})}}function _E(r){let e;const t=r[7].default,n=mn(t,r,r[9],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&512)&&_n(n,t,i,i[9],e?gn(t,i[9],o,null):yn(i[9]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function yE(r){let e,t,n;const i=[dn("turn-restrictions"),{minzoom:13},{filter:r[4]?void 0:["get","edited"]},{layout:{"icon-image":["concat","no_",["get","kind"],"_turn"],"icon-rotate":["get","icon_angle"],"icon-allow-overlap":!0,"icon-size":.05}},{paint:{"icon-opacity":["case",["get","edited"],1,.5]}}];function o(a){r[8](a)}let u={$$slots:{default:[_E]},$$scope:{ctx:r}};for(let a=0;a<i.length;a+=1)u=Mt(u,i[a]);return r[1]!==void 0&&(u.hovered=r[1]),e=new Ou({props:u}),un.push(()=>Pn(e,"hovered",o)),e.$on("click",function(){vl(r[0])&&r[0].apply(this,arguments)}),{c(){ce(e.$$.fragment)},m(a,d){le(e,a,d),n=!0},p(a,d){r=a;const p=d&16?En(i,[i[0],i[1],{filter:r[4]?void 0:["get","edited"]},i[3],i[4]]):{};d&512&&(p.$$scope={dirty:d,ctx:r}),!t&&d&2&&(t=!0,p.hovered=r[1],An(()=>t=!1)),e.$set(p)},i(a){n||(N(e.$$.fragment,a),n=!0)},o(a){V(e.$$.fragment,a),n=!1},d(a){ue(e,a)}}}function bE(r){let e,t;const n=[dn("turn-restrictions-debug-arrows"),{interactive:!1},{paint:{"line-width":4,"line-color":"red"}}];let i={};for(let o=0;o<n.length;o+=1)i=Mt(i,n[o]);return e=new sr({props:i}),{c(){ce(e.$$.fragment)},m(o,u){le(e,o,u),t=!0},p(o,u){const a={};e.$set(a)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){ue(e,o)}}}function vE(r){let e,t,n,i;return e=new mr({props:{data:r[2],generateId:!0,$$slots:{default:[yE]},$$scope:{ctx:r}}}),n=new mr({props:{data:r[3],$$slots:{default:[bE]},$$scope:{ctx:r}}}),{c(){ce(e.$$.fragment),t=ie(),ce(n.$$.fragment)},m(o,u){le(e,o,u),Z(o,t,u),le(n,o,u),i=!0},p(o,[u]){const a={};u&4&&(a.data=o[2]),u&531&&(a.$$scope={dirty:u,ctx:o}),e.$set(a);const d={};u&8&&(d.data=o[3]),u&512&&(d.$$scope={dirty:u,ctx:o}),n.$set(d)},i(o){i||(N(e.$$.fragment,o),N(n.$$.fragment,o),i=!0)},o(o){V(e.$$.fragment,o),V(n.$$.fragment,o),i=!1},d(o){o&&q(t),ue(e,o),ue(n,o)}}}function wE(r,e,t){let n,i,o,u,a;st(r,Cr,C=>t(5,o=C)),st(r,Gi,C=>t(6,u=C)),st(r,pd,C=>t(4,a=C));let{$$slots:d={},$$scope:p}=e,{onClickTurnRestriction:g=()=>{}}=e,y=null;function x(C){y=C,t(1,y)}return r.$$set=C=>{"onClickTurnRestriction"in C&&t(0,g=C.onClickTurnRestriction),"$$scope"in C&&t(9,p=C.$$scope)},r.$$.update=()=>{r.$$.dirty&2&&t(3,n=y==null?Ji():{type:"FeatureCollection",features:[{type:"Feature",geometry:JSON.parse(y.properties.from_geometry),properties:{}},{type:"Feature",geometry:JSON.parse(y.properties.to_geometry),properties:{}}]}),r.$$.dirty&96&&t(2,i=u>0?o.renderTurnRestrictions():Ji())},[g,y,i,n,a,o,u,d,x,p]}class xE extends St{constructor(e){super(),kt(this,e,wE,vE,_t,{onClickTurnRestriction:0})}}const kE=r=>({}),E1=r=>({}),SE=r=>({}),I1=r=>({});function TE(r){let e;const t=r[7]["modal-filter"],n=mn(t,r,r[8],I1);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&256)&&_n(n,t,i,i[8],e?gn(t,i[8],o,SE):yn(i[8]),I1)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function CE(r){let e,t,n,i;const o=[dn("modal-filters"),{interactive:r[2]},{filter:["all",["!=",["get","filter_kind"],"diagonal_filter"],r[4]?["literal",!0]:["get","edited"]]},{minzoom:Wf},{layout:{"icon-image":["get","filter_kind"],"icon-rotate":["get","angle"],"icon-allow-overlap":!0,"icon-size":.1}},{paint:{"icon-opacity":["case",["get","edited"],1,.5]}}];let u={$$slots:{default:[TE]},$$scope:{ctx:r}};for(let p=0;p<o.length;p+=1)u=Mt(u,o[p]);e=new Ou({props:u}),e.$on("click",function(){vl(r[0])&&r[0].apply(this,arguments)});const a=[dn("intersection-filters"),{filter:["==",["get","filter_kind"],"diagonal_filter"]},{minzoom:Wf},{layout:{"icon-image":"diagonal_filter","icon-rotate":["get","angle",["get","filter"]],"icon-allow-overlap":!0,"icon-size":.07}},{interactive:!1}];let d={};for(let p=0;p<a.length;p+=1)d=Mt(d,a[p]);return n=new Ou({props:d}),{c(){ce(e.$$.fragment),t=ie(),ce(n.$$.fragment)},m(p,g){le(e,p,g),Z(p,t,g),le(n,p,g),i=!0},p(p,g){r=p;const y=g&20?En(o,[o[0],g&4&&{interactive:r[2]},g&16&&{filter:["all",["!=",["get","filter_kind"],"diagonal_filter"],r[4]?["literal",!0]:["get","edited"]]},g&0&&{minzoom:Wf},o[4],o[5]]):{};g&256&&(y.$$scope={dirty:g,ctx:r}),e.$set(y);const x=g&0?En(a,[a[0],a[1],{minzoom:Wf},a[3],a[4]]):{};n.$set(x)},i(p){i||(N(e.$$.fragment,p),N(n.$$.fragment,p),i=!0)},o(p){V(e.$$.fragment,p),V(n.$$.fragment,p),i=!1},d(p){p&&q(t),ue(e,p),ue(n,p)}}}function ME(r){let e;const t=r[7]["turn-restriction"],n=mn(t,r,r[8],E1);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&256)&&_n(n,t,i,i[8],e?gn(t,i[8],o,kE):yn(i[8]),E1)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function LE(r){let e,t,n,i;return e=new mr({props:{data:r[3],generateId:!0,$$slots:{default:[CE]},$$scope:{ctx:r}}}),n=new xE({props:{onClickTurnRestriction:r[1],$$slots:{default:[ME]},$$scope:{ctx:r}}}),{c(){ce(e.$$.fragment),t=ie(),ce(n.$$.fragment)},m(o,u){le(e,o,u),Z(o,t,u),le(n,o,u),i=!0},p(o,[u]){const a={};u&8&&(a.data=o[3]),u&277&&(a.$$scope={dirty:u,ctx:o}),e.$set(a);const d={};u&2&&(d.onClickTurnRestriction=o[1]),u&256&&(d.$$scope={dirty:u,ctx:o}),n.$set(d)},i(o){i||(N(e.$$.fragment,o),N(n.$$.fragment,o),i=!0)},o(o){V(e.$$.fragment,o),V(n.$$.fragment,o),i=!1},d(o){o&&q(t),ue(e,o),ue(n,o)}}}let Wf=13;function EE(r,e,t){let n,i,o,u;st(r,Cr,x=>t(5,i=x)),st(r,Gi,x=>t(6,o=x)),st(r,pd,x=>t(4,u=x));let{$$slots:a={},$$scope:d}=e,{onClickModalFilter:p=()=>{}}=e,{onClickTurnRestriction:g=()=>{}}=e,{interactive:y}=e;return r.$$set=x=>{"onClickModalFilter"in x&&t(0,p=x.onClickModalFilter),"onClickTurnRestriction"in x&&t(1,g=x.onClickTurnRestriction),"interactive"in x&&t(2,y=x.interactive),"$$scope"in x&&t(8,d=x.$$scope)},r.$$.update=()=>{r.$$.dirty&96&&t(3,n=o>0?i.renderModalFilters():Ji())},[p,g,y,n,u,i,o,a,d]}class Oa extends St{constructor(e){super(),kt(this,e,EE,LE,_t,{onClickModalFilter:0,onClickTurnRestriction:1,interactive:2})}}function IE(r){let e,t;const n=[dn("one-ways"),{filter:["all",["in",["get","kind"],["literal",["interior_road","main_road"]]],["!=",["get","travel_flow"],"both"]]},{layout:{"icon-image":"oneway_arrow","icon-size":1,"symbol-placement":"line","symbol-spacing":50,"icon-allow-overlap":!0,"icon-rotate":["case",["==",["get","travel_flow"],"forwards"],0,180]}},{paint:{"icon-opacity":["case",["get","travel_flow_edited"],1,.5]}},{minzoom:13},{interactive:!1},{hoverCursor:"pointer"}];let i={};for(let o=0;o<n.length;o+=1)i=Mt(i,n[o]);return e=new Ou({props:i}),{c(){ce(e.$$.fragment)},m(o,u){le(e,o,u),t=!0},p(o,[u]){const a={};e.$set(a)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){ue(e,o)}}}class Rd extends St{constructor(e){super(),kt(this,e,null,IE,_t,{})}}function AE(r){let e;const t=r[3].default,n=mn(t,r,r[4],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&16)&&_n(n,t,i,i[4],e?gn(t,i[4],o,null):yn(i[4]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function PE(r){let e,t;return e=new mr({props:{data:r[0],generateId:!0,$$slots:{default:[AE]},$$scope:{ctx:r}}}),{c(){ce(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p(n,[i]){const o={};i&1&&(o.data=n[0]),i&16&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){ue(e,n)}}}function zE(r,e,t){let n,i;st(r,Cr,d=>t(2,i=d));let{$$slots:o={},$$scope:u}=e,{input:a=null}=e;return r.$$set=d=>{"input"in d&&t(1,a=d.input),"$$scope"in d&&t(4,u=d.$$scope)},r.$$.update=()=>{r.$$.dirty&6&&t(0,n=a||i.renderNeighbourhood()),r.$$.dirty&1&&wd("neighbourhoodGj",n)},[n,a,i,o,u]}class Dh extends St{constructor(e){super(),kt(this,e,zE,PE,_t,{input:1})}}function ld(){return["match",["get","cell_color"],"disconnected","red",["let","index",["%",["to-number",["get","cell_color"]],10],["match",["var","index"],0,"#8dd3c7",1,"#ffffb3",2,"#bebada",3,"#80b1d3",4,"#fdb462",5,"#b3de69",6,"#fccde5",7,"#bc80bd",8,"#ccebc5",9,"#ffed6f","blue"]]]}function DE(r){let e,t,n,i,o,u,a,d,p,g,y,x,C,M=gr(r[2].mode)+"",F,z;return o=new jn({props:{mode:{mode:"title"}}}),d=new jn({props:{mode:{mode:"pick-neighbourhood"}}}),y=new jn({props:{mode:{mode:"neighbourhood"}}}),{c(){e=j("div"),t=j("nav"),n=j("ul"),i=j("li"),ce(o.$$.fragment),u=ie(),a=j("li"),ce(d.$$.fragment),p=ie(),g=j("li"),ce(y.$$.fragment),x=ie(),C=j("li"),F=Ee(M),ae(t,"aria-label","breadcrumb"),ae(e,"slot","top")},m(E,P){Z(E,e,P),D(e,t),D(t,n),D(n,i),le(o,i,null),D(n,u),D(n,a),le(d,a,null),D(n,p),D(n,g),le(y,g,null),D(n,x),D(n,C),D(C,F),z=!0},p(E,P){(!z||P&4)&&M!==(M=gr(E[2].mode)+"")&&gt(F,M)},i(E){z||(N(o.$$.fragment,E),N(d.$$.fragment,E),N(y.$$.fragment,E),z=!0)},o(E){V(o.$$.fragment,E),V(d.$$.fragment,E),V(y.$$.fragment,E),z=!1},d(E){E&&q(e),ue(o),ue(d),ue(y)}}}function A1(r){let e,t,n;return{c(){e=j("button"),e.textContent="",ae(e,"class","close-btn svelte-khnvno")},m(i,o){Z(i,e,o),t||(n=Tt(e,"click",r[5]),t=!0)},p:ot,d(i){i&&q(e),t=!1,n()}}}function RE(r){let e;return{c(){e=j("p"),e.textContent="Click an intersection to inspect its movements."},m(t,n){Z(t,e,n)},p:ot,i:ot,o:ot,d(t){t&&q(e)}}}function FE(r){let e,t,n,i,o,u,a;e=new Mh({props:{properties:r[0].feature.properties}});function d(g){r[6](g)}let p={list:r[0].movements.features};return r[0].movementIdx!==void 0&&(p.idx=r[0].movementIdx),o=new Cd({props:p}),un.push(()=>Pn(o,"idx",d)),{c(){ce(e.$$.fragment),t=ie(),n=j("h5"),n.textContent="Turn restrictions:",i=ie(),ce(o.$$.fragment)},m(g,y){le(e,g,y),Z(g,t,y),Z(g,n,y),Z(g,i,y),le(o,g,y),a=!0},p(g,y){const x={};y&1&&(x.properties=g[0].feature.properties),e.$set(x);const C={};y&1&&(C.list=g[0].movements.features),!u&&y&1&&(u=!0,C.idx=g[0].movementIdx,An(()=>u=!1)),o.$set(C)},i(g){a||(N(e.$$.fragment,g),N(o.$$.fragment,g),a=!0)},o(g){V(e.$$.fragment,g),V(o.$$.fragment,g),a=!1},d(g){g&&(q(t),q(n),q(i)),ue(e,g),ue(o,g)}}}function BE(r){let e,t,n,i,o,u,a,d,p,g,y,x,C,M;t=new As({props:{mode:{mode:"neighbourhood"}}});let F=r[0]&&A1(r);const z=[FE,RE],E=[];function P($,U){return $[0]?0:1}return x=P(r),C=E[x]=z[x](r),{c(){e=j("div"),ce(t.$$.fragment),n=ie(),i=j("h4"),i.textContent="Roads",o=ie(),u=j("p"),u.textContent="Click a road to visit its OSM object.",a=ie(),d=j("div"),p=j("h4"),p.textContent="Intersections",g=ie(),F&&F.c(),y=ie(),C.c(),Ye(d,"display","flex"),Ye(d,"align-items","start"),Ye(d,"justify-content","space-between"),ae(e,"slot","sidebar")},m($,U){Z($,e,U),le(t,e,null),D(e,n),D(e,i),D(e,o),D(e,u),D(e,a),D(e,d),D(d,p),D(d,g),F&&F.m(d,null),D(e,y),E[x].m(e,null),M=!0},p($,U){$[0]?F?F.p($,U):(F=A1($),F.c(),F.m(d,null)):F&&(F.d(1),F=null);let K=x;x=P($),x===K?E[x].p($,U):(Kt(),V(E[K],1,1,()=>{E[K]=null}),Xt(),C=E[x],C?C.p($,U):(C=E[x]=z[x]($),C.c()),N(C,1),C.m(e,null))},i($){M||(N(t.$$.fragment,$),N(C),M=!0)},o($){V(t.$$.fragment,$),V(C),M=!1},d($){$&&q(e),ue(t),F&&F.d(),E[x].d()}}}function $E(r){let e,t;return e=new Mh({props:{properties:r[7]}}),{c(){ce(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p(n,i){const o={};i&128&&(o.properties=n[7]),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){ue(e,n)}}}function OE(r){let e,t;return e=new di({props:{openOn:"hover",$$slots:{default:[$E,({props:n})=>({7:n}),({props:n})=>n?128:0]},$$scope:{ctx:r}}}),{c(){ce(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p(n,i){const o={};i&384&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){ue(e,n)}}}function NE(r){let e,t;return e=new Mh({props:{properties:r[7]}}),{c(){ce(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p(n,i){const o={};i&128&&(o.properties=n[7]),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){ue(e,n)}}}function jE(r){let e,t,n;return t=new di({props:{openOn:"hover",$$slots:{default:[NE,({props:i})=>({7:i}),({props:i})=>i?128:0]},$$scope:{ctx:r}}}),{c(){e=j("div"),ce(t.$$.fragment),ae(e,"slot","line-popup")},m(i,o){Z(i,e,o),le(t,e,null),n=!0},p(i,o){const u={};o&384&&(u.$$scope={dirty:o,ctx:i}),t.$set(u)},i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){V(t.$$.fragment,i),n=!1},d(i){i&&q(e),ue(t)}}}function UE(r){let e,t,n,i,o,u,a,d,p,g;e=new Dd({}),n=new zd({}),o=new Rd({});const y=[dn("debug-borders"),{filter:["==",["get","kind"],"border_intersection"]},{paint:{"circle-radius":15,"circle-color":"green"}}];let x={$$slots:{default:[OE]},$$scope:{ctx:r}};for(let C=0;C<y.length;C+=1)x=Mt(x,y[C]);return a=new xl({props:x}),p=new zh({props:{interactive:!0,onClickLine:r[4],$$slots:{"line-popup":[jE]},$$scope:{ctx:r}}}),{c(){ce(e.$$.fragment),t=ie(),ce(n.$$.fragment),i=ie(),ce(o.$$.fragment),u=ie(),ce(a.$$.fragment),d=ie(),ce(p.$$.fragment)},m(C,M){le(e,C,M),Z(C,t,M),le(n,C,M),Z(C,i,M),le(o,C,M),Z(C,u,M),le(a,C,M),Z(C,d,M),le(p,C,M),g=!0},p(C,M){const F={};M&256&&(F.$$scope={dirty:M,ctx:C}),a.$set(F);const z={};M&256&&(z.$$scope={dirty:M,ctx:C}),p.$set(z)},i(C){g||(N(e.$$.fragment,C),N(n.$$.fragment,C),N(o.$$.fragment,C),N(a.$$.fragment,C),N(p.$$.fragment,C),g=!0)},o(C){V(e.$$.fragment,C),V(n.$$.fragment,C),V(o.$$.fragment,C),V(a.$$.fragment,C),V(p.$$.fragment,C),g=!1},d(C){C&&(q(t),q(i),q(u),q(d)),ue(e,C),ue(n,C),ue(o,C),ue(a,C),ue(p,C)}}}function VE(r){let e,t;return e=new Mh({props:{properties:r[7]}}),{c(){ce(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p(n,i){const o={};i&128&&(o.properties=n[7]),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){ue(e,n)}}}function qE(r){let e,t;return e=new di({props:{openOn:"hover",$$slots:{default:[VE,({props:n})=>({7:n}),({props:n})=>n?128:0]},$$scope:{ctx:r}}}),{c(){ce(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p(n,i){const o={};i&384&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){ue(e,n)}}}function ZE(r){let e,t;return e=new Mh({props:{properties:r[7]}}),{c(){ce(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p(n,i){const o={};i&128&&(o.properties=n[7]),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){ue(e,n)}}}function GE(r){let e,t;return e=new di({props:{openOn:"hover",$$slots:{default:[ZE,({props:n})=>({7:n}),({props:n})=>n?128:0]},$$scope:{ctx:r}}}),{c(){ce(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p(n,i){const o={};i&384&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){ue(e,n)}}}function HE(r){var o,u,a;let e,t;const n=[dn("debug-intersections"),{paint:{"circle-radius":ym(30),"circle-color":yo.mapFeature.hover.backgroundColor,"circle-stroke-color":yo.mapFeature.hover.backgroundColor,"circle-stroke-opacity":.8,"circle-stroke-width":Wn(0,3),"circle-opacity":["case",["==",["get","intersection_id"],((a=(u=(o=r[0])==null?void 0:o.feature)==null?void 0:u.properties)==null?void 0:a.intersection_id)??-1],.3,Wn(0,.5)]}},{manageHoverState:!0},{hoverCursor:"pointer"}];let i={$$slots:{default:[GE]},$$scope:{ctx:r}};for(let d=0;d<n.length;d+=1)i=Mt(i,n[d]);return e=new xl({props:i}),e.$on("click",r[3]),{c(){ce(e.$$.fragment)},m(d,p){le(e,d,p),t=!0},p(d,p){var y,x,C;const g=p&1?En(n,[n[0],{paint:{"circle-radius":ym(30),"circle-color":yo.mapFeature.hover.backgroundColor,"circle-stroke-color":yo.mapFeature.hover.backgroundColor,"circle-stroke-opacity":.8,"circle-stroke-width":Wn(0,3),"circle-opacity":["case",["==",["get","intersection_id"],((C=(x=(y=d[0])==null?void 0:y.feature)==null?void 0:x.properties)==null?void 0:C.intersection_id)??-1],.3,Wn(0,.5)]}},n[2],n[3]]):{};p&256&&(g.$$scope={dirty:p,ctx:d}),e.$set(g)},i(d){t||(N(e.$$.fragment,d),t=!0)},o(d){V(e.$$.fragment,d),t=!1},d(d){ue(e,d)}}}function P1(r){let e,t;return e=new mr({props:{data:r[0].movements,generateId:!0,$$slots:{default:[WE]},$$scope:{ctx:r}}}),{c(){ce(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p(n,i){const o={};i&1&&(o.data=n[0].movements),i&257&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){ue(e,n)}}}function WE(r){let e,t,n,i;const o=[dn("debug-movements-outline"),{paint:{"line-width":2,"line-color":"red"}}];let u={};for(let p=0;p<o.length;p+=1)u=Mt(u,o[p]);e=new sr({props:u});const a=[dn("debug-movements-fill"),{filter:["==",["id"],r[0].movementIdx]},{paint:{"fill-color":"cyan"}}];let d={};for(let p=0;p<a.length;p+=1)d=Mt(d,a[p]);return n=new Ki({props:d}),{c(){ce(e.$$.fragment),t=ie(),ce(n.$$.fragment)},m(p,g){le(e,p,g),Z(p,t,g),le(n,p,g),i=!0},p(p,g){const y={};e.$set(y);const x=g&1?En(a,[a[0],{filter:["==",["id"],p[0].movementIdx]},a[2]]):{};n.$set(x)},i(p){i||(N(e.$$.fragment,p),N(n.$$.fragment,p),i=!0)},o(p){V(e.$$.fragment,p),V(n.$$.fragment,p),i=!1},d(p){p&&q(t),ue(e,p),ue(n,p)}}}function KE(r){let e,t,n,i,o,u,a,d;t=new Dh({props:{$$slots:{default:[UE]},$$scope:{ctx:r}}}),i=new Oa({props:{interactive:!0,$$slots:{default:[qE]},$$scope:{ctx:r}}}),u=new mr({props:{data:or(r[1]).getAllIntersections(),generateId:!0,$$slots:{default:[HE]},$$scope:{ctx:r}}});let p=r[0]&&P1(r);return{c(){e=j("div"),ce(t.$$.fragment),n=ie(),ce(i.$$.fragment),o=ie(),ce(u.$$.fragment),a=ie(),p&&p.c(),ae(e,"slot","map")},m(g,y){Z(g,e,y),le(t,e,null),D(e,n),le(i,e,null),D(e,o),le(u,e,null),D(e,a),p&&p.m(e,null),d=!0},p(g,y){const x={};y&256&&(x.$$scope={dirty:y,ctx:g}),t.$set(x);const C={};y&256&&(C.$$scope={dirty:y,ctx:g}),i.$set(C);const M={};y&2&&(M.data=or(g[1]).getAllIntersections()),y&257&&(M.$$scope={dirty:y,ctx:g}),u.$set(M),g[0]?p?(p.p(g,y),y&1&&N(p,1)):(p=P1(g),p.c(),N(p,1),p.m(e,null)):p&&(Kt(),V(p,1,1,()=>{p=null}),Xt())},i(g){d||(N(t.$$.fragment,g),N(i.$$.fragment,g),N(u.$$.fragment,g),N(p),d=!0)},o(g){V(t.$$.fragment,g),V(i.$$.fragment,g),V(u.$$.fragment,g),V(p),d=!1},d(g){g&&q(e),ue(t),ue(i),ue(u),p&&p.d()}}}function XE(r){let e,t;return e=new wo({props:{$$slots:{map:[KE],sidebar:[BE],top:[DE]},$$scope:{ctx:r}}}),{c(){ce(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p(n,[i]){const o={};i&263&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){ue(e,n)}}}function JE(r,e,t){let n,i;st(r,Cr,g=>t(1,n=g)),st(r,Kn,g=>t(2,i=g));let o=null;function u(g){let y=g.detail.features[0],x=n.getMovements(y.properties.intersection_id);t(0,o={feature:y,movements:x,movementIdx:0})}const a=(g,y)=>window.open(or(g.properties).way,"_blank"),d=()=>t(0,o=null);function p(g){r.$$.not_equal(o.movementIdx,g)&&(o.movementIdx=g,t(0,o))}return[o,n,i,u,a,d,p]}class YE extends St{constructor(e){super(),kt(this,e,JE,XE,_t,{})}}const QE="/ltn/assets/eraser-894c4bbc.svg",eI="/ltn/assets/paintbrush-511a1297.svg",z1="/ltn/assets/one_way_left-9368d5dd.svg",tI="/ltn/assets/traffic_1-a90740ec.svg";var Ao=63710088e-1,nI={centimeters:Ao*100,centimetres:Ao*100,degrees:360/(2*Math.PI),feet:Ao*3.28084,inches:Ao*39.37,kilometers:Ao/1e3,kilometres:Ao/1e3,meters:Ao,metres:Ao,miles:Ao/1609.344,millimeters:Ao*1e3,millimetres:Ao*1e3,nauticalmiles:Ao/1852,radians:1,yards:Ao*1.0936};function rI(r,e,t={}){const n={type:"Feature"};return(t.id===0||t.id)&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.properties=e||{},n.geometry=r,n}function Rm(r,e,t={}){if(!r)throw new Error("coordinates is required");if(!Array.isArray(r))throw new Error("coordinates must be an Array");if(r.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!D1(r[0])||!D1(r[1]))throw new Error("coordinates must contain numbers");return rI({type:"Point",coordinates:r},e,t)}function iI(r,e="kilometers"){const t=nI[e];if(!t)throw new Error(e+" units is invalid");return r/t}function Fm(r){return r%(2*Math.PI)*180/Math.PI}function ml(r){return r%360*Math.PI/180}function D1(r){return!isNaN(r)&&r!==null&&!Array.isArray(r)}function Bm(r){if(!r)throw new Error("coord is required");if(!Array.isArray(r)){if(r.type==="Feature"&&r.geometry!==null&&r.geometry.type==="Point")return[...r.geometry.coordinates];if(r.type==="Point")return[...r.coordinates]}if(Array.isArray(r)&&r.length>=2&&!Array.isArray(r[0])&&!Array.isArray(r[1]))return[...r];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function oI(r){return r.type==="Feature"?r.geometry:r}function rw(r,e,t={}){if(t.final===!0)return sI(r,e);const n=Bm(r),i=Bm(e),o=ml(n[0]),u=ml(i[0]),a=ml(n[1]),d=ml(i[1]),p=Math.sin(u-o)*Math.cos(d),g=Math.cos(a)*Math.sin(d)-Math.sin(a)*Math.cos(d)*Math.cos(u-o);return Fm(Math.atan2(p,g))}function sI(r,e){let t=rw(e,r);return t=(t+180)%360,t}function aI(r,e,t,n={}){const i=Bm(r),o=ml(i[0]),u=ml(i[1]),a=ml(t),d=iI(e,n.units),p=Math.asin(Math.sin(u)*Math.cos(d)+Math.cos(u)*Math.sin(d)*Math.cos(a)),g=o+Math.atan2(Math.sin(a)*Math.sin(d)*Math.cos(u),Math.cos(d)-Math.sin(u)*Math.sin(p)),y=Fm(g),x=Fm(p);return Rm([y,x],n.properties)}var Po=63710088e-1,lI={centimeters:Po*100,centimetres:Po*100,degrees:360/(2*Math.PI),feet:Po*3.28084,inches:Po*39.37,kilometers:Po/1e3,kilometres:Po/1e3,meters:Po,metres:Po,miles:Po/1609.344,millimeters:Po*1e3,millimetres:Po*1e3,nauticalmiles:Po/1852,radians:1,yards:Po*1.0936};function uI(r,e="kilometers"){const t=lI[e];if(!t)throw new Error(e+" units is invalid");return r*t}function Kf(r){return r%360*Math.PI/180}function R1(r){if(!r)throw new Error("coord is required");if(!Array.isArray(r)){if(r.type==="Feature"&&r.geometry!==null&&r.geometry.type==="Point")return[...r.geometry.coordinates];if(r.type==="Point")return[...r.coordinates]}if(Array.isArray(r)&&r.length>=2&&!Array.isArray(r[0])&&!Array.isArray(r[1]))return[...r];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function iw(r,e,t={}){var n=R1(r),i=R1(e),o=Kf(i[1]-n[1]),u=Kf(i[0]-n[0]),a=Kf(n[1]),d=Kf(i[1]),p=Math.pow(Math.sin(o/2),2)+Math.pow(Math.sin(u/2),2)*Math.cos(a)*Math.cos(d);return uI(2*Math.atan2(Math.sqrt(p),Math.sqrt(1-p)),t.units)}var cI=iw;function hI(r,e,t={}){const i=oI(r).coordinates;let o=0;for(let u=0;u<i.length&&!(e>=o&&u===i.length-1);u++)if(o>=e){const a=e-o;if(a){const d=rw(i[u],i[u-1])-180;return aI(i[u],a,d,t)}else return Rm(i[u])}else o+=iw(i[u],i[u+1],t);return Rm(i[i.length-1])}var fI=hI;function dI(r){let e,t;const n=[dn("animate-shortcuts"),{paint:{"circle-radius":10,"circle-color":"purple","circle-stroke-color":"black","circle-stroke-width":1}}];let i={};for(let o=0;o<n.length;o+=1)i=Mt(i,n[o]);return e=new xl({props:i}),{c(){ce(e.$$.fragment)},m(o,u){le(e,o,u),t=!0},p(o,u){const a={};e.$set(a)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){ue(e,o)}}}function pI(r){let e,t;return e=new mr({props:{data:r[0],$$slots:{default:[dI]},$$scope:{ctx:r}}}),{c(){ce(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p(n,[i]){const o={};i&1&&(o.data=n[0]),i&1024&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){ue(e,n)}}}let mI=50,gI=100,_I=.01;function yI(r,e,t){let{paths:n}=e,i=d(),o=p(),u=y(),a=setInterval(x,gI);ti(()=>clearInterval(a));function d(){return n.features.map(C=>1/C.properties.directness).reduce((C,M)=>C+M,0)}function p(){return n.features.length==0?[]:Array.from({length:mI},g)}function g(){let C=Math.random()*i,M=0;for(let[F,z]of n.features.entries())if(M+=1/z.properties.directness,C<M)return{idx:F,distance:0};throw new Error(`didnt pick dot, totalDirectness is ${i}`)}function y(){return{type:"FeatureCollection",features:o.map(({idx:C,distance:M})=>fI(n.features[C],M,{units:"kilometers"}))}}function x(){for(let[C,M]of o.entries())M.distance+=_I,M.distance>=n.features[M.idx].properties.length_meters/1e3&&(o[C]=g());t(0,u=y())}return r.$$set=C=>{"paths"in C&&t(1,n=C.paths)},r.$$.update=()=>{r.$$.dirty&2&&n&&(i=d(),o=p())},[u,n]}class bI extends St{constructor(e){super(),kt(this,e,yI,pI,_t,{paths:1})}}class vI{constructor(e){Yn(this,"feature");this.feature=e}get intersectionId(){return this.feature.properties.intersection_id}get filter(){return this.feature.properties.filter}get filterAngle(){var e;return(e=this.feature.properties.filter)==null?void 0:e.angle}get hasRotatedFilter(){var e;return((e=this.feature.properties.filter)==null?void 0:e.is_rotated)??!1}}function wI(r){let e,t,n,i,o;return{c(){e=j("div"),e.textContent="+",t=ie(),n=j("img"),o=Ee(`
    Add diagonal filter`),Ye(e,"font-size","200%"),Ye(e,"margin-top","-12px"),ae(e,"class","icon"),dr(n.src,i="/ltn//filters/diagonal_filter_icon.png")||ae(n,"src",i),ae(n,"alt","Add diagonal filter"),Ye(n,"transform","rotate(135deg)"),ae(n,"class","svelte-j2s60j")},m(u,a){Z(u,e,a),Z(u,t,a),Z(u,n,a),Z(u,o,a)},p:ot,d(u){u&&(q(e),q(t),q(n),q(o))}}}function xI(r){let e;function t(o,u){return o[0].hasRotatedFilter?SI:kI}let n=t(r),i=n(r);return{c(){i.c(),e=Xn()},m(o,u){i.m(o,u),Z(o,e,u)},p(o,u){n!==(n=t(o))&&(i.d(1),i=n(o),i&&(i.c(),i.m(e.parentNode,e)))},d(o){o&&q(e),i.d(o)}}}function kI(r){let e,t,n,i,o;return{c(){e=j("div"),e.textContent="",t=ie(),n=j("img"),o=Ee(`
      Rotate diagonal filter`),Ye(e,"font-size","200%"),Ye(e,"padding-bottom","4px"),ae(e,"class","icon"),dr(n.src,i="/ltn//filters/diagonal_filter_icon.png")||ae(n,"src",i),ae(n,"alt","Rotate diagonal filter"),Ye(n,"transform","rotate(45deg)"),ae(n,"class","svelte-j2s60j")},m(u,a){Z(u,e,a),Z(u,t,a),Z(u,n,a),Z(u,o,a)},d(u){u&&(q(e),q(t),q(n),q(o))}}}function SI(r){let e,t,n,i,o;return{c(){e=j("div"),e.textContent="",t=ie(),n=j("img"),o=Ee(`
      Delete diagonal filter`),ae(e,"class","icon"),dr(n.src,i="/ltn//filters/diagonal_filter_icon.png")||ae(n,"src",i),ae(n,"alt","Remove diagonal filter"),Ye(n,"transform","rotate(45deg)"),ae(n,"class","svelte-j2s60j")},m(u,a){Z(u,e,a),Z(u,t,a),Z(u,n,a),Z(u,o,a)},d(u){u&&(q(e),q(t),q(n),q(o))}}}function TI(r){let e;function t(o,u){return o[0].filter?xI:wI}let n=t(r),i=n(r);return{c(){e=j("div"),i.c(),Ye(e,"display","flex"),Ye(e,"align-items","center")},m(o,u){Z(o,e,u),i.m(e,null)},p(o,[u]){n===(n=t(o))&&i?i.p(o,u):(i.d(1),i=n(o),i&&(i.c(),i.m(e,null)))},i:ot,o:ot,d(o){o&&q(e),i.d()}}}function CI(r,e,t){let{intersection:n}=e;return r.$$set=i=>{"intersection"in i&&t(0,n=i.intersection)},[n]}class MI extends St{constructor(e){super(),kt(this,e,CI,TI,_t,{intersection:0})}}function LI(r){let e,t;return e=new MI({props:{intersection:r[2](r[6])}}),{c(){ce(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p(n,i){const o={};i&64&&(o.intersection=n[2](n[6])),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){ue(e,n)}}}function EI(r){let e,t;return e=new cv({props:{openOn:"hover",$$slots:{default:[LI,({features:n})=>({6:n}),({features:n})=>n?64:0]},$$scope:{ctx:r}}}),{c(){ce(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p(n,i){const o={};i&192&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){ue(e,n)}}}function II(r){let e,t;const n=[dn("editable-intersections"),{filter:["==",["get","kind"],"editable_intersection"]},{paint:{"circle-radius":ym(30),"circle-color":yo.mapFeature.hover.backgroundColor,"circle-opacity":Wn(0,.5),"circle-stroke-color":yo.mapFeature.hover.backgroundColor,"circle-stroke-opacity":.8,"circle-stroke-width":Wn(0,3)}},{minzoom:13},{interactive:r[1]},{manageHoverState:!0},{hoverCursor:"pointer"}];let i={$$slots:{default:[EI]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=Mt(i,n[o]);return e=new xl({props:i}),e.$on("click",r[4]),{c(){ce(e.$$.fragment)},m(o,u){le(e,o,u),t=!0},p(o,[u]){const a=u&2?En(n,[n[0],n[1],n[2],n[3],{interactive:o[1]},n[5],n[6]]):{};u&128&&(a.$$scope={dirty:u,ctx:o}),e.$set(a)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){ue(e,o)}}}function AI(r,e,t){let{neighbourhood:n=Th("neighbourhoodGj")}=e,{onClickIntersection:i=p=>{}}=e,{interactive:o=!1}=e;function u(p){let g=n.features[p];return new vI(g)}function a(p){return u(p[0].id)}const d=p=>i(a(p.detail.features));return r.$$set=p=>{"neighbourhood"in p&&t(3,n=p.neighbourhood),"onClickIntersection"in p&&t(0,i=p.onClickIntersection),"interactive"in p&&t(1,o=p.interactive)},[i,o,a,n,d]}class PI extends St{constructor(e){super(),kt(this,e,AI,II,_t,{neighbourhood:3,onClickIntersection:0,interactive:1})}}function F1(r,e,t){const n=r.slice();return n[6]=e[t],n}function B1(r){let e,t,n,i,o,u,a=r[6].label+"",d,p,g,y,x;function C(){return r[3](r[6])}return{c(){e=j("button"),t=j("img"),i=ie(),o=j("br"),u=ie(),d=Ee(a),p=ie(),dr(t.src,n=r[6].iconURL)||ae(t,"src",n),ae(t,"width","80"),ae(t,"alt",r[6].label),ae(e,"class","outline"),Ye(e,"width","100%"),e.disabled=g=r[1]==r[6].filterType},m(M,F){Z(M,e,F),D(e,t),D(e,i),D(e,o),D(e,u),D(e,d),D(e,p),y||(x=Tt(e,"click",C),y=!0)},p(M,F){r=M,F&2&&g!==(g=r[1]==r[6].filterType)&&(e.disabled=g)},d(M){M&&q(e),y=!1,x()}}}function zI(r){let e,t,n,i,o,u,a,d,p,g,y,x,C=r[2].description+"",M,F,z,E,P,$,U=Rn(uo.allTypes),K=[];for(let ee=0;ee<U.length;ee+=1)K[ee]=B1(F1(r,U,ee));return{c(){e=j("h3"),e.textContent="Choose a modal filter to place on streets",t=ie(),n=j("table"),i=j("tr"),o=j("td");for(let ee=0;ee<K.length;ee+=1)K[ee].c();u=ie(),a=j("td"),d=j("img"),y=ie(),x=j("p"),M=Ee(C),F=ie(),z=j("center"),E=j("button"),E.textContent="Confirm",dr(d.src,p=r[2].largeImageURL)||ae(d,"src",p),ae(d,"height","300"),ae(d,"alt",g=r[2].label)},m(ee,W){Z(ee,e,W),Z(ee,t,W),Z(ee,n,W),D(n,i),D(i,o);for(let J=0;J<K.length;J+=1)K[J]&&K[J].m(o,null);D(i,u),D(i,a),D(a,d),D(a,y),D(a,x),D(x,M),Z(ee,F,W),Z(ee,z,W),D(z,E),P||($=Tt(E,"click",r[4]),P=!0)},p(ee,W){if(W&2){U=Rn(uo.allTypes);let J;for(J=0;J<U.length;J+=1){const he=F1(ee,U,J);K[J]?K[J].p(he,W):(K[J]=B1(he),K[J].c(),K[J].m(o,null))}for(;J<K.length;J+=1)K[J].d(1);K.length=U.length}W&4&&!dr(d.src,p=ee[2].largeImageURL)&&ae(d,"src",p),W&4&&g!==(g=ee[2].label)&&ae(d,"alt",g),W&4&&C!==(C=ee[2].description+"")&&gt(M,C)},d(ee){ee&&(q(e),q(t),q(n),q(F),q(z)),gi(K,ee),P=!1,$()}}}function DI(r){let e,t,n;function i(u){r[5](u)}let o={$$slots:{default:[zI]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.show=r[0]),e=new Um({props:o}),un.push(()=>Pn(e,"show",i)),{c(){ce(e.$$.fragment)},m(u,a){le(e,u,a),n=!0},p(u,[a]){const d={};a&519&&(d.$$scope={dirty:a,ctx:u}),!t&&a&1&&(t=!0,d.show=u[0],An(()=>t=!1)),e.$set(d)},i(u){n||(N(e.$$.fragment,u),n=!0)},o(u){V(e.$$.fragment,u),n=!1},d(u){ue(e,u)}}}function RI(r,e,t){let n,i;st(r,lm,p=>t(1,i=p));let{show:o}=e;const u=p=>an(lm,i=p.filterType,i),a=()=>t(0,o=!1);function d(p){o=p,t(0,o)}return r.$$set=p=>{"show"in p&&t(0,o=p.show)},r.$$.update=()=>{r.$$.dirty&2&&t(2,n=uo.allTypes.find(p=>p.filterType==i))},[o,i,n,u,a,d]}class FI extends St{constructor(e){super(),kt(this,e,RI,DI,_t,{show:0})}}function $1(r){let e,t;return e=new mr({props:{data:r[0],$$slots:{default:[BI]},$$scope:{ctx:r}}}),{c(){ce(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p(n,i){const o={};i&1&&(o.data=n[0]),i&64&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){ue(e,n)}}}function BI(r){let e,t;const n=[dn("freehand-line"),{paint:{"line-width":5,"line-color":"red"}}];let i={};for(let o=0;o<n.length;o+=1)i=Mt(i,n[o]);return e=new sr({props:i}),{c(){ce(e.$$.fragment)},m(o,u){le(e,o,u),t=!0},p(o,u){const a={};e.$set(a)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){ue(e,o)}}}function $I(r){let e,t,n=r[0]&&$1(r);return{c(){n&&n.c(),e=Xn()},m(i,o){n&&n.m(i,o),Z(i,e,o),t=!0},p(i,[o]){i[0]?n?(n.p(i,o),o&1&&N(n,1)):(n=$1(i),n.c(),N(n,1),n.m(e.parentNode,e)):n&&(Kt(),V(n,1,1,()=>{n=null}),Xt())},i(i){t||(N(n),t=!0)},o(i){V(n),t=!1},d(i){i&&q(e),n&&n.d(i)}}}function OI(r,e,t){let{map:n}=e,i=null;const o=Is();n.on("dragstart",u),n.on("mousemove",a),n.on("mouseup",d),ti(()=>{n.dragPan.enable(),n.off("dragstart",u),n.off("mousemove",a),n.off("mouseup",d)});function u(){n.dragPan.disable(),t(0,i={type:"Feature",properties:{},geometry:{type:"LineString",coordinates:[]}})}function a(p){if(i){let g=p.lngLat.toArray(),y=i.geometry.coordinates.at(-1);if(y&&cI(y,g)*1e3<.5)return;i.geometry.coordinates.push(g),t(0,i),i.geometry.coordinates.length%10==0&&o("progress",i)}}function d(){!i||i.geometry.coordinates.length==0?o("done",null):o("done",i),t(0,i=null),n.dragPan.enable()}return r.$$set=p=>{"map"in p&&t(1,n=p.map)},[i,n]}class ow extends St{constructor(e){super(),kt(this,e,OI,$I,_t,{map:1})}}function NI(r){let e;return{c(){e=j("p"),e.textContent=`Now that you've defined a neighbourhood boundary, you can see the
              possible shortcuts that vehicles are currently able to take
              through it. You can add a new modal filter to try and solve this.
              The colored "cell" areas show what's reachable for drivers without
              leaving the boundary you've drawn.`},m(t,n){Z(t,e,n)},p:ot,d(t){t&&q(e)}}}function O1(r){let e,t,n;return t=new jn({props:{mode:{mode:"debug-neighbourhood"},$$slots:{default:[jI]},$$scope:{ctx:r}}}),{c(){e=j("li"),ce(t.$$.fragment)},m(i,o){Z(i,e,o),le(t,e,null),n=!0},i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){V(t.$$.fragment,i),n=!1},d(i){i&&q(e),ue(t)}}}function jI(r){let e;return{c(){e=Ee("Debug")},m(t,n){Z(t,e,n)},d(t){t&&q(e)}}}function UI(r){let e,t,n,i,o,u,a,d,p,g,y=gr(r[14].mode)+"",x,C,M,F,z,E,P,$,U,K,ee,W,J,he,Ae,ne,fe,Ce,_e;o=new jn({props:{mode:{mode:"title"}}}),d=new jn({props:{mode:{mode:"pick-neighbourhood"}}}),M=new rg({props:{$$slots:{default:[NI]},$$scope:{ctx:r}}}),$=new jn({props:{mode:{mode:"view-shortcuts"}}}),ee=new jn({props:{mode:{mode:"route",prevMode:"neighbourhood"}}}),he=new jn({props:{mode:{mode:"impact-one-destination"}}}),fe=new jn({props:{mode:{mode:"set-boundary",name:or(r[6]).properties.name,existing:or(r[6])}}});let Ze=r[15]&&O1(r);return{c(){e=j("div"),t=j("nav"),n=j("ul"),i=j("li"),ce(o.$$.fragment),u=ie(),a=j("li"),ce(d.$$.fragment),p=ie(),g=j("li"),x=Ee(y),C=ie(),ce(M.$$.fragment),F=ie(),z=j("nav"),E=j("ul"),P=j("li"),ce($.$$.fragment),U=ie(),K=j("li"),ce(ee.$$.fragment),W=ie(),J=j("li"),ce(he.$$.fragment),Ae=ie(),ne=j("li"),ce(fe.$$.fragment),Ce=ie(),Ze&&Ze.c(),ae(t,"aria-label","breadcrumb"),ae(e,"slot","top"),Ye(e,"display","flex"),Ye(e,"justify-content","space-between")},m(Oe,je){Z(Oe,e,je),D(e,t),D(t,n),D(n,i),le(o,i,null),D(n,u),D(n,a),le(d,a,null),D(n,p),D(n,g),D(g,x),D(g,C),le(M,g,null),D(e,F),D(e,z),D(z,E),D(E,P),le($,P,null),D(E,U),D(E,K),le(ee,K,null),D(E,W),D(E,J),le(he,J,null),D(E,Ae),D(E,ne),le(fe,ne,null),D(E,Ce),Ze&&Ze.m(E,null),_e=!0},p(Oe,je){(!_e||je[0]&16384)&&y!==(y=gr(Oe[14].mode)+"")&&gt(x,y);const De={};je[1]&262144&&(De.$$scope={dirty:je,ctx:Oe}),M.$set(De);const At={};je[0]&64&&(At.mode={mode:"set-boundary",name:or(Oe[6]).properties.name,existing:or(Oe[6])}),fe.$set(At),Oe[15]?Ze?je[0]&32768&&N(Ze,1):(Ze=O1(Oe),Ze.c(),N(Ze,1),Ze.m(E,null)):Ze&&(Kt(),V(Ze,1,1,()=>{Ze=null}),Xt())},i(Oe){_e||(N(o.$$.fragment,Oe),N(d.$$.fragment,Oe),N(M.$$.fragment,Oe),N($.$$.fragment,Oe),N(ee.$$.fragment,Oe),N(he.$$.fragment,Oe),N(fe.$$.fragment,Oe),N(Ze),_e=!0)},o(Oe){V(o.$$.fragment,Oe),V(d.$$.fragment,Oe),V(M.$$.fragment,Oe),V($.$$.fragment,Oe),V(ee.$$.fragment,Oe),V(he.$$.fragment,Oe),V(fe.$$.fragment,Oe),V(Ze),_e=!1},d(Oe){Oe&&q(e),ue(o),ue(d),ue(M),ue($),ue(ee),ue(he),ue(fe),Ze&&Ze.d()}}}function N1(r){let e;return{c(){e=j("mark"),e.textContent=`Some parts of the neighbourhood aren't reachable by drivers, shown in
        red`},m(t,n){Z(t,e,n)},d(t){t&&q(e)}}}function VI(r){let e,t,n,i,o,u,a,d,p,g,y,x,C,M,F,z,E,P,$,U,K,ee,W,J,he,Ae,ne;return g=new A3({}),z=new ev({}),ee=new Wk({}),{c(){e=j("h3"),e.textContent="Reclassify main roads",t=ie(),n=j("p"),n.innerHTML=`<i>Main roads</i>, drawn in grey, were classified automatically using
          data from
          <a href="https://openstreetmap.org/about" target="_blank">OpenStreetMap</a>, but you can reclassify a road segment by clicking on it.`,i=ie(),o=j("p"),o.textContent=`Main roads are typically better suited to support higher levels of
          traffic than neighbourhood roads.`,u=ie(),a=j("div"),d=j("button"),p=j("div"),ce(g.$$.fragment),y=ie(),x=j("span"),x.textContent="Toggle segment or pan map",C=ie(),M=j("button"),F=j("div"),ce(z.$$.fragment),E=ie(),P=j("span"),P.textContent="Mark as main along a line",$=ie(),U=j("button"),K=j("div"),ce(ee.$$.fragment),W=ie(),J=j("span"),J.textContent="Erase main classification",Ye(p,"display","flex"),Ye(p,"align-items","center"),Ye(p,"gap","8px"),ae(d,"data-tooltip","Click a road to reclassify it"),jt(d,"active",!r[0].freehand),jt(d,"outline",r[0].freehand),Ye(F,"display","flex"),Ye(F,"align-items","center"),Ye(F,"gap","8px"),ae(M,"data-tooltip","Reclassify multiple roads by drawing a line along them"),jt(M,"active",r[0].freehand&&r[0].isMain),jt(M,"outline",!(r[0].freehand&&r[0].isMain)),Ye(K,"display","flex"),Ye(K,"align-items","center"),Ye(K,"gap","8px"),ae(U,"data-tooltip","Reclassify multiple roads by drawing a line along them"),jt(U,"active",r[0].freehand&&!r[0].isMain),jt(U,"outline",!(r[0].freehand&&!r[0].isMain)),ae(a,"class","classification-buttons svelte-1fjbnz9"),Ye(a,"display","flex"),Ye(a,"flex-direction","column"),Ye(a,"gap","8px"),Ye(a,"justify-content","left")},m(fe,Ce){Z(fe,e,Ce),Z(fe,t,Ce),Z(fe,n,Ce),Z(fe,i,Ce),Z(fe,o,Ce),Z(fe,u,Ce),Z(fe,a,Ce),D(a,d),D(d,p),le(g,p,null),D(p,y),D(p,x),D(a,C),D(a,M),D(M,F),le(z,F,null),D(F,E),D(F,P),D(a,$),D(a,U),D(U,K),le(ee,K,null),D(K,W),D(K,J),he=!0,Ae||(ne=[Tt(d,"click",r[39]),Tt(M,"click",r[40]),Tt(U,"click",r[41])],Ae=!0)},p(fe,Ce){(!he||Ce[0]&1)&&jt(d,"active",!fe[0].freehand),(!he||Ce[0]&1)&&jt(d,"outline",fe[0].freehand),(!he||Ce[0]&1)&&jt(M,"active",fe[0].freehand&&fe[0].isMain),(!he||Ce[0]&1)&&jt(M,"outline",!(fe[0].freehand&&fe[0].isMain)),(!he||Ce[0]&1)&&jt(U,"active",fe[0].freehand&&!fe[0].isMain),(!he||Ce[0]&1)&&jt(U,"outline",!(fe[0].freehand&&!fe[0].isMain))},i(fe){he||(N(g.$$.fragment,fe),N(z.$$.fragment,fe),N(ee.$$.fragment,fe),he=!0)},o(fe){V(g.$$.fragment,fe),V(z.$$.fragment,fe),V(ee.$$.fragment,fe),he=!1},d(fe){fe&&(q(e),q(t),q(n),q(i),q(o),q(u),q(a)),ue(g),ue(z),ue(ee),Ae=!1,ur(ne)}}}function qI(r){let e,t,n;return{c(){e=j("h3"),e.textContent="Restrict turns",t=ie(),n=j("p"),n.textContent=`To restrict certain turns, first click on the source road, then the
          destination road. Traffic will no longer be able to turn from the
          source road to the destination road.`},m(i,o){Z(i,e,o),Z(i,t,o),Z(i,n,o)},p:ot,i:ot,o:ot,d(i){i&&(q(e),q(t),q(n))}}}function ZI(r){let e,t,n;return{c(){e=j("h3"),e.textContent="Toggle one-way",t=ie(),n=j("p"),n.textContent=`Click on a road segment to toggle its direction. This will change the
          direction of traffic flow on that road.`},m(i,o){Z(i,e,o),Z(i,t,o),Z(i,n,o)},p:ot,i:ot,o:ot,d(i){i&&(q(e),q(t),q(n))}}}function GI(r){let e,t,n,i,o,u,a,d,p,g,y,x,C,M,F,z,E,P;function $(K){r[35](K)}let U={};return r[3]!==void 0&&(U.show=r[3]),o=new FI({props:U}),un.push(()=>Pn(o,"show",$)),C=new ev({}),{c(){e=j("h3"),e.textContent="Add modal filter",t=ie(),n=j("p"),n.textContent=`Modal filters restrict what kind of traffic can pass through a road
          segment. Place them strategically to deter shortcuts through your
          neighbourhood.`,i=ie(),ce(o.$$.fragment),a=ie(),d=j("div"),p=j("button"),p.textContent="Change modal filter type",g=ie(),y=j("button"),x=j("div"),ce(C.$$.fragment),M=ie(),F=j("span"),F.textContent="Add along a line",ae(p,"class","outline"),Ye(x,"display","flex"),Ye(x,"align-items","center"),Ye(x,"gap","8px"),ae(y,"data-tooltip","Add many modal filters along a line"),jt(y,"active",r[0].freehand),jt(y,"outline",!r[0].freehand),Ye(d,"display","flex"),Ye(d,"gap","8px"),Ye(d,"align-items","center")},m(K,ee){Z(K,e,ee),Z(K,t,ee),Z(K,n,ee),Z(K,i,ee),le(o,K,ee),Z(K,a,ee),Z(K,d,ee),D(d,p),D(d,g),D(d,y),D(y,x),le(C,x,null),D(x,M),D(x,F),z=!0,E||(P=[Tt(p,"click",r[36]),Tt(y,"click",function(){vl(r[0].freehand?r[37]:r[38])&&(r[0].freehand?r[37]:r[38]).apply(this,arguments)})],E=!0)},p(K,ee){r=K;const W={};!u&&ee[0]&8&&(u=!0,W.show=r[3],An(()=>u=!1)),o.$set(W),(!z||ee[0]&1)&&jt(y,"active",r[0].freehand),(!z||ee[0]&1)&&jt(y,"outline",!r[0].freehand)},i(K){z||(N(o.$$.fragment,K),N(C.$$.fragment,K),z=!0)},o(K){V(o.$$.fragment,K),V(C.$$.fragment,K),z=!1},d(K){K&&(q(e),q(t),q(n),q(i),q(a),q(d)),ue(o,K),ue(C),E=!1,ur(P)}}}function j1(r){let e,t;return e=new No({props:{colorScale:Sv,labels:{limits:Tv}}}),{c(){ce(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){ue(e,n)}}}function HI(r){let e,t,n=or(r[6]).properties.name+"",i,o,u,a,d,p,g,y,x,C,M,F,z,E,P,$,U,K,ee,W,J,he,Ae,ne,fe,Ce,_e,Ze,Oe,je,De,At,ut,ht,wt,pt,Qe,Ft,bt,Bt,Pt,Qt,vn,qt,rn,Ge,qe,Je,Et,ye,kn,Ue,it,Wt,cr,_r,yr,ni,jr,xo,hr,vt,Pr,Mr,zr,qn,It,fn,on,Qn,pi,pn,Di,er,we,re,se,pe=r[8]>0&&N1();Oe=new Z3({}),ht=new F3({});const xe=[GI,ZI,qI,VI],Fe=[];function Be(Se,Q){return Se[0].kind=="filter"?0:Se[0].kind=="oneway"?1:Se[0].kind=="turn_restriction"?2:Se[0].kind=="main-roads"?3:-1}~(bt=Be(r))&&(Bt=Fe[bt]=xe[bt](r));let $e=r[13]=="speeds"&&j1();return er=new Qv({props:{neighbourhoodBoundary:or(r[6])}}),{c(){e=j("div"),t=j("h1"),i=Ee(n),o=ie(),pe&&pe.c(),u=ie(),a=j("h2"),a.textContent="Editing tools",d=ie(),p=j("div"),g=j("div"),y=j("button"),x=j("img"),F=ie(),z=j("button"),E=j("div"),E.innerHTML=`<img style="position: absolute; width: 60%; height: 60%; top: -1px; left: -1px;" src="${z1}" alt="Reverse directions" class="svelte-1fjbnz9"/> <img style="position: absolute; width: 60%; height: 60%; bottom: -1px; right: -1px; transform: rotate(180deg);" src="${z1}" alt="Reverse directions" class="svelte-1fjbnz9"/>`,$=ie(),U=j("button"),K=j("img"),J=ie(),he=j("button"),Ae=j("img"),Ce=ie(),_e=j("div"),Ze=j("button"),ce(Oe.$$.fragment),At=ie(),ut=j("button"),ce(ht.$$.fragment),Qe=ie(),Ft=j("div"),Bt&&Bt.c(),Pt=ie(),Qt=j("h2"),Qt.textContent="Map style",vn=ie(),qt=j("label"),rn=j("input"),Ge=Ee(`
      Animate shortcuts`),qe=j("span"),Je=Ee("1"),Et=ie(),ye=j("label"),kn=j("input"),Ue=Ee(`
      Show entries into cells`),it=j("span"),Wt=Ee("2"),cr=ie(),_r=j("label"),yr=j("input"),ni=Ee(`
      Road thickness depends on shortcuts`),jr=j("span"),xo=Ee("1"),hr=ie(),vt=j("label"),Pr=j("span"),Pr.textContent="Draw roads:",Mr=ie(),zr=j("select"),qn=j("option"),qn.textContent="Worst shortcuts",It=j("option"),It.textContent="Cell",fn=j("option"),fn.textContent="Edits (either filter or direction)",on=j("option"),on.textContent="Speed limit",Qn=ie(),$e&&$e.c(),pi=ie(),pn=j("h2"),pn.textContent="Neighbourhood stats",Di=ie(),ce(er.$$.fragment),dr(x.src,C=or(uo.getFilter(r[9])).iconURL)||ae(x,"src",C),ae(x,"alt","Add a modal filter"),ae(x,"class","svelte-1fjbnz9"),y.disabled=M=r[0].kind=="filter",ae(y,"class","icon-btn svelte-1fjbnz9"),ae(y,"data-tooltip","Add a modal filter (hotkey 1)"),jt(y,"active",r[0].kind=="filter"),jt(y,"outline",r[0].kind!="filter"),Ye(E,"height","100%"),Ye(E,"width","100%"),Ye(E,"position","relative"),z.disabled=P=r[0].kind=="oneway",ae(z,"class","icon-btn svelte-1fjbnz9"),ae(z,"data-tooltip","Toggle one-way (hotkey 2)"),jt(z,"active",r[0].kind=="oneway"),jt(z,"outline",r[0].kind!="oneway"),dr(K.src,ee="/ltn//filters/no_right_turn.svg")||ae(K,"src",ee),ae(K,"alt","Restrict turns"),ae(K,"class","svelte-1fjbnz9"),U.disabled=W=r[0].kind=="turn_restriction",ae(U,"class","icon-btn svelte-1fjbnz9"),ae(U,"data-tooltip","Restrict turns (hotkey 3)"),jt(U,"active",r[0].kind=="turn_restriction"),jt(U,"outline",r[0].kind!="turn_restriction"),dr(Ae.src,ne=tI)||ae(Ae,"src",ne),ae(Ae,"alt","Change main/minor roads"),ae(Ae,"class","svelte-1fjbnz9"),he.disabled=fe=r[0].kind=="main-roads",ae(he,"class","icon-btn svelte-1fjbnz9"),ae(he,"data-tooltip","Reclassify main roads (hotkey 4)"),jt(he,"active",r[0].kind=="main-roads"),jt(he,"outline",r[0].kind!="main-roads"),Ye(g,"display","flex"),Ye(g,"justify-content","left"),Ye(g,"gap","8px"),ae(Ze,"class","outline icon-btn svelte-1fjbnz9"),Ze.disabled=je=r[4]==0,ae(Ze,"data-tooltip",De=r[4]==0?"Undo Ctrl+Z":`Undo (${r[4]}) Ctrl+Z`),ae(ut,"class","outline icon-btn svelte-1fjbnz9"),ut.disabled=wt=r[5]==0,ae(ut,"data-tooltip",pt=r[5]==0?"Redo Ctrl+Y":`Redo (${r[5]}) Ctrl+Y`),Ye(_e,"display","flex"),Ye(_e,"justify-content","right"),Ye(_e,"gap","8px"),ae(p,"class","tool-palette svelte-1fjbnz9"),Ye(p,"height","54px"),Ye(p,"display","flex"),Ye(p,"justify-content","space-between"),Ye(p,"gap","32px"),Ye(Ft,"min-height","200px"),Ye(Ft,"padding-bottom","16px"),Ye(Ft,"border-bottom","solid var(--pico-muted-border-color) 1px"),ae(rn,"type","checkbox"),ae(qe,"class","footnote-ref svelte-1fjbnz9"),ae(qe,"data-tooltip",q1),ae(kn,"type","checkbox"),ae(it,"class","footnote-ref svelte-1fjbnz9"),ae(it,"data-tooltip",p8),ae(yr,"type","checkbox"),ae(jr,"class","footnote-ref svelte-1fjbnz9"),ae(jr,"data-tooltip",q1),Ye(Pr,"text-wrap","nowrap"),qn.__value="shortcuts",Vn(qn,qn.__value),It.__value="cells",Vn(It,It.__value),fn.__value="edits",Vn(fn,fn.__value),on.__value="speeds",Vn(on,on.__value),Ye(zr,"margin","0"),Ye(zr,"padding","8px"),Ye(zr,"width","auto"),r[13]===void 0&&ds(()=>r[45].call(zr)),Ye(vt,"display","flex"),Ye(vt,"align-items","center"),Ye(vt,"gap","8px"),ae(e,"slot","sidebar")},m(Se,Q){Z(Se,e,Q),D(e,t),D(t,i),D(e,o),pe&&pe.m(e,null),D(e,u),D(e,a),D(e,d),D(e,p),D(p,g),D(g,y),D(y,x),D(g,F),D(g,z),D(z,E),D(g,$),D(g,U),D(U,K),D(g,J),D(g,he),D(he,Ae),D(p,Ce),D(p,_e),D(_e,Ze),le(Oe,Ze,null),D(_e,At),D(_e,ut),le(ht,ut,null),D(e,Qe),D(e,Ft),~bt&&Fe[bt].m(Ft,null),D(e,Pt),D(e,Qt),D(e,vn),D(e,qt),D(qt,rn),rn.checked=r[10],D(qt,Ge),D(qt,qe),D(qe,Je),D(e,Et),D(e,ye),D(ye,kn),kn.checked=r[11],D(ye,Ue),D(ye,it),D(it,Wt),D(e,cr),D(e,_r),D(_r,yr),yr.checked=r[12],D(_r,ni),D(_r,jr),D(jr,xo),D(e,hr),D(e,vt),D(vt,Pr),D(vt,Mr),D(vt,zr),D(zr,qn),D(zr,It),D(zr,fn),D(zr,on),Hi(zr,r[13],!0),D(e,Qn),$e&&$e.m(e,null),D(e,pi),D(e,pn),D(e,Di),le(er,e,null),we=!0,re||(se=[Tt(y,"click",r[31]),Tt(z,"click",r[32]),Tt(U,"click",r[33]),Tt(he,"click",r[34]),Tt(Ze,"click",r[24]),Tt(ut,"click",r[25]),Tt(rn,"change",r[42]),Tt(kn,"change",r[43]),Tt(yr,"change",r[44]),Tt(zr,"change",r[45])],re=!0)},p(Se,Q){(!we||Q[0]&64)&&n!==(n=or(Se[6]).properties.name+"")&&gt(i,n),Se[8]>0?pe||(pe=N1(),pe.c(),pe.m(e,u)):pe&&(pe.d(1),pe=null),(!we||Q[0]&512&&!dr(x.src,C=or(uo.getFilter(Se[9])).iconURL))&&ae(x,"src",C),(!we||Q[0]&1&&M!==(M=Se[0].kind=="filter"))&&(y.disabled=M),(!we||Q[0]&1)&&jt(y,"active",Se[0].kind=="filter"),(!we||Q[0]&1)&&jt(y,"outline",Se[0].kind!="filter"),(!we||Q[0]&1&&P!==(P=Se[0].kind=="oneway"))&&(z.disabled=P),(!we||Q[0]&1)&&jt(z,"active",Se[0].kind=="oneway"),(!we||Q[0]&1)&&jt(z,"outline",Se[0].kind!="oneway"),(!we||Q[0]&1&&W!==(W=Se[0].kind=="turn_restriction"))&&(U.disabled=W),(!we||Q[0]&1)&&jt(U,"active",Se[0].kind=="turn_restriction"),(!we||Q[0]&1)&&jt(U,"outline",Se[0].kind!="turn_restriction"),(!we||Q[0]&1&&fe!==(fe=Se[0].kind=="main-roads"))&&(he.disabled=fe),(!we||Q[0]&1)&&jt(he,"active",Se[0].kind=="main-roads"),(!we||Q[0]&1)&&jt(he,"outline",Se[0].kind!="main-roads"),(!we||Q[0]&16&&je!==(je=Se[4]==0))&&(Ze.disabled=je),(!we||Q[0]&16&&De!==(De=Se[4]==0?"Undo Ctrl+Z":`Undo (${Se[4]}) Ctrl+Z`))&&ae(Ze,"data-tooltip",De),(!we||Q[0]&32&&wt!==(wt=Se[5]==0))&&(ut.disabled=wt),(!we||Q[0]&32&&pt!==(pt=Se[5]==0?"Redo Ctrl+Y":`Redo (${Se[5]}) Ctrl+Y`))&&ae(ut,"data-tooltip",pt);let We=bt;bt=Be(Se),bt===We?~bt&&Fe[bt].p(Se,Q):(Bt&&(Kt(),V(Fe[We],1,1,()=>{Fe[We]=null}),Xt()),~bt?(Bt=Fe[bt],Bt?Bt.p(Se,Q):(Bt=Fe[bt]=xe[bt](Se),Bt.c()),N(Bt,1),Bt.m(Ft,null)):Bt=null),Q[0]&1024&&(rn.checked=Se[10]),Q[0]&2048&&(kn.checked=Se[11]),Q[0]&4096&&(yr.checked=Se[12]),Q[0]&8192&&Hi(zr,Se[13]),Se[13]=="speeds"?$e?Q[0]&8192&&N($e,1):($e=j1(),$e.c(),N($e,1),$e.m(e,pi)):$e&&(Kt(),V($e,1,1,()=>{$e=null}),Xt());const Xe={};Q[0]&64&&(Xe.neighbourhoodBoundary=or(Se[6])),er.$set(Xe)},i(Se){we||(N(Oe.$$.fragment,Se),N(ht.$$.fragment,Se),N(Bt),N($e),N(er.$$.fragment,Se),we=!0)},o(Se){V(Oe.$$.fragment,Se),V(ht.$$.fragment,Se),V(Bt),V($e),V(er.$$.fragment,Se),we=!1},d(Se){Se&&q(e),pe&&pe.d(),ue(Oe),ue(ht),~bt&&Fe[bt].d(),$e&&$e.d(),ue(er),re=!1,ur(se)}}}function WI(r){let e,t,n=(r[48].name??"unnamed road")+"",i,o,u=Math.round(r[48].speed_mph)+"",a,d;return{c(){e=j("p"),t=Ee("Main road: "),i=Ee(n),o=Ee(`
                (`),a=Ee(u),d=Ee(" mph)")},m(p,g){Z(p,e,g),D(e,t),D(e,i),D(e,o),D(e,a),D(e,d)},p(p,g){g[1]&131072&&n!==(n=(p[48].name??"unnamed road")+"")&&gt(i,n),g[1]&131072&&u!==(u=Math.round(p[48].speed_mph)+"")&&gt(a,u)},d(p){p&&q(e)}}}function KI(r){let e,t=r[48].shortcuts+"",n,i,o=(r[48].name??"unnamed road")+"",u,a,d=Math.round(r[48].speed_mph)+"",p,g;return{c(){e=j("p"),n=Ee(t),i=Ee(" shortcuts through "),u=Ee(o),a=Ee(`
                (`),p=Ee(d),g=Ee(" mph)")},m(y,x){Z(y,e,x),D(e,n),D(e,i),D(e,u),D(e,a),D(e,p),D(e,g)},p(y,x){x[1]&131072&&t!==(t=y[48].shortcuts+"")&&gt(n,t),x[1]&131072&&o!==(o=(y[48].name??"unnamed road")+"")&&gt(u,o),x[1]&131072&&d!==(d=Math.round(y[48].speed_mph)+"")&&gt(p,d)},d(y){y&&q(e)}}}function XI(r){let e;return{c(){e=j("p"),e.textContent="Click to create a turn restriction from here"},m(t,n){Z(t,e,n)},p:ot,d(t){t&&q(e)}}}function JI(r){let e;return{c(){e=j("p"),e.textContent="Click to designate a main road or not"},m(t,n){Z(t,e,n)},p:ot,d(t){t&&q(e)}}}function YI(r){let e;return{c(){e=j("p"),e.textContent="Click to change direction"},m(t,n){Z(t,e,n)},p:ot,d(t){t&&q(e)}}}function QI(r){let e,t,n,i;return{c(){e=j("div"),t=j("img"),i=Ee(`
                Click to add modal filter`),dr(t.src,n=`/ltn//filters/${r[9]}_icon.gif`)||ae(t,"src",n),ae(t,"width","20"),ae(t,"alt","Add modal filter")},m(o,u){Z(o,e,u),D(e,t),D(e,i)},p(o,u){u[0]&512&&!dr(t.src,n=`/ltn//filters/${o[9]}_icon.gif`)&&ae(t,"src",n)},d(o){o&&q(e)}}}function e8(r){let e,t;function n(p,g){if(p[48].kind=="interior_road")return KI;if(p[48].kind=="main_road")return WI}let i=n(r),o=i&&i(r);function u(p,g){if(p[0].kind=="filter")return QI;if(p[0].kind=="oneway")return YI;if(p[0].kind=="main-roads"&&!p[0].freehand)return JI;if(p[0].kind=="turn_restriction")return XI}let a=u(r),d=a&&a(r);return{c(){o&&o.c(),e=ie(),d&&d.c(),t=Xn()},m(p,g){o&&o.m(p,g),Z(p,e,g),d&&d.m(p,g),Z(p,t,g)},p(p,g){i===(i=n(p))&&o?o.p(p,g):(o&&o.d(1),o=i&&i(p),o&&(o.c(),o.m(e.parentNode,e))),a===(a=u(p))&&d?d.p(p,g):(d&&d.d(1),d=a&&a(p),d&&(d.c(),d.m(t.parentNode,t)))},d(p){p&&(q(e),q(t)),o&&o.d(p),d&&d.d(p)}}}function t8(r){let e,t,n;return t=new di({props:{openOn:"hover",$$slots:{default:[e8,({props:i})=>({48:i}),({props:i})=>[0,i?131072:0]]},$$scope:{ctx:r}}}),{c(){e=j("div"),ce(t.$$.fragment),ae(e,"slot","line-popup")},m(i,o){Z(i,e,o),le(t,e,null),n=!0},p(i,o){const u={};o[0]&513|o[1]&393216&&(u.$$scope={dirty:o,ctx:i}),t.$set(u)},i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){V(t.$$.fragment,i),n=!1},d(i){i&&q(e),ue(t)}}}function n8(r){let e,t,n,i,o,u,a,d,p,g;return e=new Dd({}),n=new zd({}),o=new Rd({}),a=new zh({props:{interactive:r[0].kind=="filter"&&!r[0].freehand||r[0].kind=="oneway"||r[0].kind=="main-roads"&&!r[0].freehand||r[0].kind=="turn_restriction"&&r[0].from_road_id==null,onClickLine:r[17],$$slots:{"line-popup":[t8]},$$scope:{ctx:r}}}),p=new PI({props:{interactive:r[0].kind=="filter",neighbourhood:r[1],onClickIntersection:r[22]}}),{c(){ce(e.$$.fragment),t=ie(),ce(n.$$.fragment),i=ie(),ce(o.$$.fragment),u=ie(),ce(a.$$.fragment),d=ie(),ce(p.$$.fragment)},m(y,x){le(e,y,x),Z(y,t,x),le(n,y,x),Z(y,i,x),le(o,y,x),Z(y,u,x),le(a,y,x),Z(y,d,x),le(p,y,x),g=!0},p(y,x){const C={};x[0]&1&&(C.interactive=y[0].kind=="filter"&&!y[0].freehand||y[0].kind=="oneway"||y[0].kind=="main-roads"&&!y[0].freehand||y[0].kind=="turn_restriction"&&y[0].from_road_id==null),x[0]&513|x[1]&262144&&(C.$$scope={dirty:x,ctx:y}),a.$set(C);const M={};x[0]&1&&(M.interactive=y[0].kind=="filter"),x[0]&2&&(M.neighbourhood=y[1]),p.$set(M)},i(y){g||(N(e.$$.fragment,y),N(n.$$.fragment,y),N(o.$$.fragment,y),N(a.$$.fragment,y),N(p.$$.fragment,y),g=!0)},o(y){V(e.$$.fragment,y),V(n.$$.fragment,y),V(o.$$.fragment,y),V(a.$$.fragment,y),V(p.$$.fragment,y),g=!1},d(y){y&&(q(t),q(i),q(u),q(d)),ue(e,y),ue(n,y),ue(o,y),ue(a,y),ue(p,y)}}}function U1(r){let e,t;return e=new bI({props:{paths:r[7]}}),{c(){ce(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p(n,i){const o={};i[0]&128&&(o.paths=n[7]),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){ue(e,n)}}}function r8(r){let e;return{c(){e=Ee("Click to delete filter")},m(t,n){Z(t,e,n)},d(t){t&&q(e)}}}function i8(r){let e,t,n;return t=new di({props:{openOn:"hover",$$slots:{default:[r8]},$$scope:{ctx:r}}}),{c(){e=j("div"),ce(t.$$.fragment),ae(e,"slot","modal-filter")},m(i,o){Z(i,e,o),le(t,e,null),n=!0},p(i,o){const u={};o[1]&262144&&(u.$$scope={dirty:o,ctx:i}),t.$set(u)},i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){V(t.$$.fragment,i),n=!1},d(i){i&&q(e),ue(t)}}}function o8(r){let e;return{c(){e=Ee("Click to delete turn restriction")},m(t,n){Z(t,e,n)},d(t){t&&q(e)}}}function s8(r){let e,t,n;return t=new di({props:{openOn:"hover",$$slots:{default:[o8]},$$scope:{ctx:r}}}),{c(){e=j("div"),ce(t.$$.fragment),ae(e,"slot","turn-restriction")},m(i,o){Z(i,e,o),le(t,e,null),n=!0},p(i,o){const u={};o[1]&262144&&(u.$$scope={dirty:o,ctx:i}),t.$set(u)},i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){V(t.$$.fragment,i),n=!1},d(i){i&&q(e),ue(t)}}}function a8(r){let e,t;return e=new ow({props:{map:or(r[2])}}),e.$on("done",r[29]),e.$on("progress",r[30]),{c(){ce(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p(n,i){const o={};i[0]&4&&(o.map=or(n[2])),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){ue(e,n)}}}function l8(r){let e,t;return e=new ow({props:{map:or(r[2])}}),e.$on("done",r[26]),{c(){ce(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p(n,i){const o={};i[0]&4&&(o.map=or(n[2])),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){ue(e,n)}}}function V1(r){let e,t;return e=new mr({props:{data:r[0].possible_targets||Ji(),generateId:!0,$$slots:{default:[h8]},$$scope:{ctx:r}}}),{c(){ce(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p(n,i){const o={};i[0]&1&&(o.data=n[0].possible_targets||Ji()),i[0]&1|i[1]&262144&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){ue(e,n)}}}function u8(r){let e,t,n,i,o=r[0].from_road_name+"",u,a,d=(r[48].name||"unnamed road")+"",p;return{c(){e=j("div"),t=j("img"),i=Ee(`

              Create a turn restriction from `),u=Ee(o),a=Ee(" to "),p=Ee(d),dr(t.src,n=`/ltn//filters/no_${r[48].kind}_turn.png`)||ae(t,"src",n),ae(t,"width","20"),ae(t,"alt","Add turn restriction")},m(g,y){Z(g,e,y),D(e,t),D(e,i),D(e,u),D(e,a),D(e,p)},p(g,y){y[1]&131072&&!dr(t.src,n=`/ltn//filters/no_${g[48].kind}_turn.png`)&&ae(t,"src",n),y[0]&1&&o!==(o=g[0].from_road_name+"")&&gt(u,o),y[1]&131072&&d!==(d=(g[48].name||"unnamed road")+"")&&gt(p,d)},d(g){g&&q(e)}}}function c8(r){let e,t;return e=new di({props:{openOn:"hover",$$slots:{default:[u8,({props:n})=>({48:n}),({props:n})=>[0,n?131072:0]]},$$scope:{ctx:r}}}),{c(){ce(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p(n,i){const o={};i[0]&1|i[1]&393216&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){ue(e,n)}}}function h8(r){let e,t;const n=[dn("turn-restriction-targets"),{manageHoverState:!0},{paint:{"line-color":"yellow","line-opacity":Wn(.5,1),"line-width":Hs(1)}}];let i={$$slots:{default:[c8]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=Mt(i,n[o]);return e=new sr({props:i}),e.$on("click",r[19]),{c(){ce(e.$$.fragment)},m(o,u){le(e,o,u),t=!0},p(o,u){const a={};u[0]&1|u[1]&262144&&(a.$$scope={dirty:u,ctx:o}),e.$set(a)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){ue(e,o)}}}function f8(r){let e,t,n,i,o,u,a,d,p,g,y,x;t=new eg({}),t.$on("click",r[18]),i=new Dh({props:{input:r[1],$$slots:{default:[n8]},$$scope:{ctx:r}}});let C=r[10]&&U1(r);a=new Oa({props:{onClickModalFilter:r[20],onClickTurnRestriction:r[21],interactive:r[0].kind=="filter",$$slots:{"turn-restriction":[s8],"modal-filter":[i8]},$$scope:{ctx:r}}});const M=[l8,a8],F=[];function z(P,$){return P[0].kind=="filter"&&P[0].freehand?0:P[0].kind=="main-roads"&&P[0].freehand?1:-1}~(p=z(r))&&(g=F[p]=M[p](r));let E=r[0].kind=="turn_restriction"&&V1(r);return{c(){e=j("div"),ce(t.$$.fragment),n=ie(),ce(i.$$.fragment),o=ie(),C&&C.c(),u=ie(),ce(a.$$.fragment),d=ie(),g&&g.c(),y=ie(),E&&E.c(),ae(e,"slot","map")},m(P,$){Z(P,e,$),le(t,e,null),D(e,n),le(i,e,null),D(e,o),C&&C.m(e,null),D(e,u),le(a,e,null),D(e,d),~p&&F[p].m(e,null),D(e,y),E&&E.m(e,null),x=!0},p(P,$){const U={};$[0]&2&&(U.input=P[1]),$[0]&515|$[1]&262144&&(U.$$scope={dirty:$,ctx:P}),i.$set(U),P[10]?C?(C.p(P,$),$[0]&1024&&N(C,1)):(C=U1(P),C.c(),N(C,1),C.m(e,u)):C&&(Kt(),V(C,1,1,()=>{C=null}),Xt());const K={};$[0]&1&&(K.interactive=P[0].kind=="filter"),$[1]&262144&&(K.$$scope={dirty:$,ctx:P}),a.$set(K);let ee=p;p=z(P),p===ee?~p&&F[p].p(P,$):(g&&(Kt(),V(F[ee],1,1,()=>{F[ee]=null}),Xt()),~p?(g=F[p],g?g.p(P,$):(g=F[p]=M[p](P),g.c()),N(g,1),g.m(e,y)):g=null),P[0].kind=="turn_restriction"?E?(E.p(P,$),$[0]&1&&N(E,1)):(E=V1(P),E.c(),N(E,1),E.m(e,null)):E&&(Kt(),V(E,1,1,()=>{E=null}),Xt())},i(P){x||(N(t.$$.fragment,P),N(i.$$.fragment,P),N(C),N(a.$$.fragment,P),N(g),N(E),x=!0)},o(P){V(t.$$.fragment,P),V(i.$$.fragment,P),V(C),V(a.$$.fragment,P),V(g),V(E),x=!1},d(P){P&&q(e),ue(t),ue(i),C&&C.d(),ue(a),~p&&F[p].d(),E&&E.d()}}}function d8(r){let e,t,n,i;return e=new wo({props:{$$slots:{map:[f8],sidebar:[HI],top:[UI]},$$scope:{ctx:r}}}),{c(){ce(e.$$.fragment)},m(o,u){le(e,o,u),t=!0,n||(i=Tt(window,"keydown",r[23]),n=!0)},p(o,u){const a={};u[0]&65535|u[1]&262144&&(a.$$scope={dirty:u,ctx:o}),e.$set(a)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){ue(e,o),n=!1,i()}}}let q1="Shortcuts are routes from one main road to another, which cut through the neighborhood's interior.",p8="Cells are the colored area reachable without travelling along a main road.";function m8(r,e,t){let n,i,o,u,a,d,p,g,y,x,C;st(r,Gi,Je=>t(28,i=Je)),st(r,Cr,Je=>t(46,o=Je)),st(r,lm,Je=>t(9,u=Je)),st(r,rs,Je=>t(2,a=Je)),st(r,Q_,Je=>t(10,d=Je)),st(r,um,Je=>t(11,p=Je)),st(r,cm,Je=>t(12,g=Je)),st(r,md,Je=>t(13,y=Je)),st(r,Kn,Je=>t(14,x=Je)),st(r,ch,Je=>t(15,C=Je));function M(){return{kind:"turn_restriction",from_road_id:null,from_road_name:"",possible_targets:Ji()}}let F={kind:"filter",freehand:!1},z=!1,E=0,P=0,$,U,K=o.getAllShortcuts();ti(()=>{a.doubleClickZoom.enable()});function ee(Je){t(1,U=o.renderNeighbourhood()),t(6,$=U.features.find(Et=>Et.properties.kind=="boundary")),t(4,E=U.undo_length),t(5,P=U.redo_length),t(7,K=o.getAllShortcuts()),yh()}function W(Je,Et){F.kind=="filter"?(o.addModalFilter(Et,u),an(Gi,i++,i)):F.kind=="oneway"?(o.toggleTravelFlow(Je.properties.road),an(Gi,i++,i)):F.kind=="main-roads"&&!F.freehand?(o.toggleMainRoad(Je.properties.road),an(Gi,i++,i)):F.kind=="turn_restriction"&&(t(0,F.from_road_id=Je.properties.road,F),t(0,F.from_road_name=Je.properties.name||"unnamed road",F),t(0,F.possible_targets=o.getTurnRestrictionTargets(Je.properties.road),F))}function J(Je){F.kind=="turn_restriction"&&(a.queryRenderedFeatures(Je.detail.point,{layers:["interior-roads","turn-restriction-targets"]}).length>0||t(0,F=M()))}function he(Je){if(F.kind=="turn_restriction"&&F.from_road_id!=null){let Et=Je.detail.features[0].properties.road;o.addTurnRestriction(F.from_road_id,Et),an(Gi,i++,i)}t(0,F=M())}function Ae(Je){let Et=Je.detail.features[0];o.deleteModalFilter(Et.properties.road),an(Gi,i++,i)}function ne(Je){let Et=Je.detail.features[0];o.deleteTurnRestriction(Et.properties.intersection,Et.properties.from_road,Et.properties.to_road),an(Gi,i++,i)}function fe(Je){if(F.kind!="filter"){console.assert(!1,`this shouldn't happen - intersections should only be clickable when in 'filter' mode, not ${F.kind}`);return}Je.hasRotatedFilter?(o.deleteDiagonalFilter(Je),an(Gi,i++,i)):Je.filter?(o.rotateDiagonalFilter(Je),an(Gi,i++,i)):(o.addDiagonalFilter(Je),an(Gi,i++,i))}function Ce(Je){Je.target.tagName!="INPUT"&&(Je.ctrlKey&&Je.key=="z"&&_e(),Je.ctrlKey&&Je.key=="y"&&Ze(),Je.key=="1"&&t(0,F={kind:"filter",freehand:!1}),Je.key=="2"&&t(0,F={kind:"oneway"}),Je.key=="3"&&t(0,F=M()),Je.key=="4"&&t(0,F={kind:"main-roads",freehand:!1,isMain:!1}))}function _e(){o.undo(),an(Gi,i++,i)}function Ze(){o.redo(),an(Gi,i++,i)}function Oe(Je){let Et=Je.detail;Et&&(o.addManyModalFilters(Et,u),an(Gi,i++,i)),t(0,F={kind:"filter",freehand:!1})}function je(Je,Et){if(F.kind!="main-roads"){console.assert(!1,"cant paint line unless in main-roads mode");return}let ye=Je.detail;ye&&(o.reclassifyRoadsAlongLine(ye,F.isMain,Et),an(Gi,i++,i))}const De=Je=>je(Je,!0),At=Je=>je(Je,!1),ut=()=>t(0,F={kind:"filter",freehand:!1}),ht=()=>t(0,F={kind:"oneway"}),wt=()=>t(0,F=M()),pt=()=>t(0,F={kind:"main-roads",freehand:!1,isMain:!1});function Qe(Je){z=Je,t(3,z)}const Ft=()=>t(3,z=!0),bt=()=>t(0,F={kind:"filter",freehand:!1}),Bt=()=>t(0,F={kind:"filter",freehand:!0}),Pt=()=>{t(0,F={kind:"main-roads",freehand:!1,isMain:!0})},Qt=()=>{t(0,F={kind:"main-roads",freehand:!0,isMain:!0})},vn=()=>{t(0,F={kind:"main-roads",freehand:!0,isMain:!1})};function qt(){d=this.checked,Q_.set(d)}function rn(){p=this.checked,um.set(p)}function Ge(){g=this.checked,cm.set(g)}function qe(){y=Sa(this),md.set(y)}return r.$$.update=()=>{r.$$.dirty[0]&5&&(F.kind=="oneway"||F.kind=="main-roads"?a.doubleClickZoom.disable():a.doubleClickZoom.enable()),r.$$.dirty[0]&5&&(F.kind=="filter"&&F.freehand||F.kind=="main-roads"&&F.freehand&&F.isMain?a.getCanvas().style.cursor=`url(${eI}) 8 22, cell`:F.kind=="main-roads"&&F.freehand&&!F.isMain?a.getCanvas().style.cursor=`url(${QE}) 8 22, cell`:a.getCanvas().style.cursor=""),r.$$.dirty[0]&268435456&&ee(),r.$$.dirty[0]&2&&t(8,n=U.features.filter(Je=>Je.properties.kind=="cell"&&Je.properties.cell_color=="disconnected").length)},[F,U,a,z,E,P,$,K,n,u,d,p,g,y,x,C,M,W,J,he,Ae,ne,fe,Ce,_e,Ze,Oe,je,i,De,At,ut,ht,wt,pt,Qe,Ft,bt,Bt,Pt,Qt,vn,qt,rn,Ge,qe]}class g8 extends St{constructor(e){super(),kt(this,e,m8,d8,_t,{},null,[-1,-1])}}function _8(r){let e,t,n,i,o,u,a,d,p,g,y=gr(r[4].mode)+"",x,C;return o=new jn({props:{mode:{mode:"title"}}}),d=new jn({props:{mode:{mode:"pick-neighbourhood"}}}),{c(){e=j("div"),t=j("nav"),n=j("ul"),i=j("li"),ce(o.$$.fragment),u=ie(),a=j("li"),ce(d.$$.fragment),p=ie(),g=j("li"),x=Ee(y),ae(t,"aria-label","breadcrumb"),ae(e,"slot","top")},m(M,F){Z(M,e,F),D(e,t),D(t,n),D(n,i),le(o,i,null),D(n,u),D(n,a),le(d,a,null),D(n,p),D(n,g),D(g,x),C=!0},p(M,F){(!C||F&16)&&y!==(y=gr(M[4].mode)+"")&&gt(x,y)},i(M){C||(N(o.$$.fragment,M),N(d.$$.fragment,M),C=!0)},o(M){V(o.$$.fragment,M),V(d.$$.fragment,M),C=!1},d(M){M&&q(e),ue(o),ue(d)}}}function Z1(r){let e,t,n,i,o,u,a;function d(C){r[9](C)}let p={list:r[1]};r[2]!==void 0&&(p.idx=r[2]),e=new Cd({props:p}),un.push(()=>Pn(e,"idx",d));let g=r[1][r[2]].count>1&&G1(r),y=r[1][r[2]].before==null&&H1(),x=r[1][r[2]].after==null&&W1();return{c(){ce(e.$$.fragment),n=ie(),g&&g.c(),i=ie(),y&&y.c(),o=ie(),x&&x.c(),u=Xn()},m(C,M){le(e,C,M),Z(C,n,M),g&&g.m(C,M),Z(C,i,M),y&&y.m(C,M),Z(C,o,M),x&&x.m(C,M),Z(C,u,M),a=!0},p(C,M){const F={};M&2&&(F.list=C[1]),!t&&M&4&&(t=!0,F.idx=C[2],An(()=>t=!1)),e.$set(F),C[1][C[2]].count>1?g?g.p(C,M):(g=G1(C),g.c(),g.m(i.parentNode,i)):g&&(g.d(1),g=null),C[1][C[2]].before==null?y||(y=H1(),y.c(),y.m(o.parentNode,o)):y&&(y.d(1),y=null),C[1][C[2]].after==null?x||(x=W1(),x.c(),x.m(u.parentNode,u)):x&&(x.d(1),x=null)},i(C){a||(N(e.$$.fragment,C),a=!0)},o(C){V(e.$$.fragment,C),a=!1},d(C){C&&(q(n),q(i),q(o),q(u)),ue(e,C),g&&g.d(C),y&&y.d(C),x&&x.d(C)}}}function G1(r){let e,t,n=r[1][r[2]].count.toLocaleString()+"",i,o,u,a;return{c(){e=j("p"),t=Ee(`The routes are currently sampled, to speed things up. This one sample
          route represents `),i=Ee(n),o=Ee(` trips between the
          same points.`),u=ie(),a=j("i"),a.textContent=`Note: if these don't sum to the total above, that's likely a known
          software bug`},m(d,p){Z(d,e,p),D(e,t),D(e,i),D(e,o),Z(d,u,p),Z(d,a,p)},p(d,p){p&6&&n!==(n=d[1][d[2]].count.toLocaleString()+"")&&gt(i,n)},d(d){d&&(q(e),q(u),q(a))}}}function H1(r){let e;return{c(){e=j("p"),e.innerHTML=`No possible route before changes (
          <i>This is usually a known software bug</i>`,Ye(e,"color","red")},m(t,n){Z(t,e,n)},d(t){t&&q(e)}}}function W1(r){let e;return{c(){e=j("p"),e.innerHTML=`No possible route after changes (
          <i>This is usually a known software bug</i>`,Ye(e,"color","blue")},m(t,n){Z(t,e,n)},d(t){t&&q(e)}}}function y8(r){let e,t,n,i,o=r[0].before.toLocaleString()+"",u,a,d,p,g=r[0].after.toLocaleString()+"",y,x,C,M,F=Math.round(100*r[0].after/r[0].before)+"",z,E,P,$;t=new As({props:{mode:{mode:"predict-impact"}}});let U=r[1].length>0&&Z1(r);return{c(){e=j("div"),ce(t.$$.fragment),n=ie(),i=j("p"),u=Ee(o),a=Ee(` routes cross here
      `),d=j("span"),d.textContent="before your changes",p=Ee(`
      , and `),y=Ee(g),x=ie(),C=j("span"),C.textContent="after your changes",M=Ee(`
      . That's
      `),z=Ee(F),E=Ee("% of the original traffic."),P=ie(),U&&U.c(),Ye(d,"color","red"),Ye(C,"color","blue"),ae(e,"slot","sidebar")},m(K,ee){Z(K,e,ee),le(t,e,null),D(e,n),D(e,i),D(i,u),D(i,a),D(i,d),D(i,p),D(i,y),D(i,x),D(i,C),D(i,M),D(i,z),D(i,E),D(e,P),U&&U.m(e,null),$=!0},p(K,ee){(!$||ee&1)&&o!==(o=K[0].before.toLocaleString()+"")&&gt(u,o),(!$||ee&1)&&g!==(g=K[0].after.toLocaleString()+"")&&gt(y,g),(!$||ee&1)&&F!==(F=Math.round(100*K[0].after/K[0].before)+"")&&gt(z,F),K[1].length>0?U?(U.p(K,ee),ee&2&&N(U,1)):(U=Z1(K),U.c(),N(U,1),U.m(e,null)):U&&(Kt(),V(U,1,1,()=>{U=null}),Xt())},i(K){$||(N(t.$$.fragment,K),N(U),$=!0)},o(K){V(t.$$.fragment,K),V(U),$=!1},d(K){K&&q(e),ue(t),U&&U.d()}}}function K1(r){let e,t,n,i,o,u;return e=new mr({props:{data:r[5](r[2]),$$slots:{default:[b8]},$$scope:{ctx:r}}}),n=new bl({props:{lngLat:r[6](r[2]),$$slots:{default:[v8]},$$scope:{ctx:r}}}),o=new bl({props:{lngLat:r[7](r[2]),$$slots:{default:[w8]},$$scope:{ctx:r}}}),{c(){ce(e.$$.fragment),t=ie(),ce(n.$$.fragment),i=ie(),ce(o.$$.fragment)},m(a,d){le(e,a,d),Z(a,t,d),le(n,a,d),Z(a,i,d),le(o,a,d),u=!0},p(a,d){const p={};d&4&&(p.data=a[5](a[2])),d&4096&&(p.$$scope={dirty:d,ctx:a}),e.$set(p);const g={};d&4&&(g.lngLat=a[6](a[2])),d&4096&&(g.$$scope={dirty:d,ctx:a}),n.$set(g);const y={};d&4&&(y.lngLat=a[7](a[2])),d&4096&&(y.$$scope={dirty:d,ctx:a}),o.$set(y)},i(a){u||(N(e.$$.fragment,a),N(n.$$.fragment,a),N(o.$$.fragment,a),u=!0)},o(a){V(e.$$.fragment,a),V(n.$$.fragment,a),V(o.$$.fragment,a),u=!1},d(a){a&&(q(t),q(i)),ue(e,a),ue(n,a),ue(o,a)}}}function b8(r){let e,t;const n=[dn("predict-impact"),{paint:{"line-width":$o(["get","kind"],{focus:8},5),"line-color":$o(["get","kind"],{focus:"black",before:"red",after:"blue"},"cyan"),"line-opacity":$o(["get","kind"],{focus:1},.5)}}];let i={};for(let o=0;o<n.length;o+=1)i=Mt(i,n[o]);return e=new sr({props:i}),{c(){ce(e.$$.fragment)},m(o,u){le(e,o,u),t=!0},p(o,u){const a={};e.$set(a)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){ue(e,o)}}}function v8(r){let e;return{c(){e=Ee("A")},m(t,n){Z(t,e,n)},d(t){t&&q(e)}}}function w8(r){let e;return{c(){e=Ee("B")},m(t,n){Z(t,e,n)},d(t){t&&q(e)}}}function x8(r){let e,t,n,i,o=r[1].length>0&&K1(r);return n=new Oa({props:{interactive:!1}}),{c(){e=j("div"),o&&o.c(),t=ie(),ce(n.$$.fragment),ae(e,"slot","map")},m(u,a){Z(u,e,a),o&&o.m(e,null),D(e,t),le(n,e,null),i=!0},p(u,a){u[1].length>0?o?(o.p(u,a),a&2&&N(o,1)):(o=K1(u),o.c(),N(o,1),o.m(e,t)):o&&(Kt(),V(o,1,1,()=>{o=null}),Xt())},i(u){i||(N(o),N(n.$$.fragment,u),i=!0)},o(u){V(o),V(n.$$.fragment,u),i=!1},d(u){u&&q(e),o&&o.d(),ue(n)}}}function k8(r){let e,t,n,i;return e=new Ch({props:{loading:r[3]}}),n=new wo({props:{$$slots:{map:[x8],sidebar:[y8],top:[_8]},$$scope:{ctx:r}}}),{c(){ce(e.$$.fragment),t=ie(),ce(n.$$.fragment)},m(o,u){le(e,o,u),Z(o,t,u),le(n,o,u),i=!0},p(o,[u]){const a={};u&8&&(a.loading=o[3]),e.$set(a);const d={};u&4119&&(d.$$scope={dirty:u,ctx:o}),n.$set(d)},i(o){i||(N(e.$$.fragment,o),N(n.$$.fragment,o),i=!0)},o(o){V(e.$$.fragment,o),V(n.$$.fragment,o),i=!1},d(o){o&&q(t),ue(e,o),ue(n,o)}}}function S8(r,e,t){let n,i,o;st(r,Kn,F=>t(4,n=F)),st(r,hm,F=>t(10,i=F)),st(r,Cr,F=>t(11,o=F));let{road:u}=e,a=u.properties;a.kind="focus";let d=[],p=0,g="Finding changes to this road";Es(async()=>{await new Promise(F=>{requestAnimationFrame(()=>{requestAnimationFrame(F)})}),t(1,d=o.getImpactsOnRoad(a.id,i)),t(3,g=""),d.length==0&&(window.alert("No routes over this road change. (This is a bug in progress of being fixed.)"),an(Kn,n={mode:"predict-impact"},n))});function y(F){return{type:"FeatureCollection",features:[d[F].before,d[F].after,u].filter(z=>z!=null)}}function x(F){return d[F].before!=null?d[F].before.geometry.coordinates[0]:d[F].after.geometry.coordinates[0]}function C(F){let z=d[F].before!=null?d[F].before.geometry.coordinates:d[F].after.geometry.coordinates;return z[z.length-1]}function M(F){p=F,t(2,p)}return r.$$set=F=>{"road"in F&&t(8,u=F.road)},[a,d,p,g,n,y,x,C,u,M]}class T8 extends St{constructor(e){super(),kt(this,e,S8,k8,_t,{road:8})}}function C8(r){let e,t,n,i,o,u,a,d,p,g,y,x,C,M=gr(r[6].mode)+"",F,z;return o=new jn({props:{mode:{mode:"title"}}}),d=new jn({props:{mode:{mode:"pick-neighbourhood"}}}),y=new jn({props:{mode:{mode:"neighbourhood"}}}),{c(){e=j("div"),t=j("nav"),n=j("ul"),i=j("li"),ce(o.$$.fragment),u=ie(),a=j("li"),ce(d.$$.fragment),p=ie(),g=j("li"),ce(y.$$.fragment),x=ie(),C=j("li"),F=Ee(M),ae(t,"aria-label","breadcrumb"),ae(e,"slot","top")},m(E,P){Z(E,e,P),D(e,t),D(t,n),D(n,i),le(o,i,null),D(n,u),D(n,a),le(d,a,null),D(n,p),D(n,g),le(y,g,null),D(n,x),D(n,C),D(C,F),z=!0},p(E,P){(!z||P&64)&&M!==(M=gr(E[6].mode)+"")&&gt(F,M)},i(E){z||(N(o.$$.fragment,E),N(d.$$.fragment,E),N(y.$$.fragment,E),z=!0)},o(E){V(o.$$.fragment,E),V(d.$$.fragment,E),V(y.$$.fragment,E),z=!1},d(E){E&&q(e),ue(o),ue(d),ue(y)}}}function M8(r){let e;return{c(){e=j("p"),e.textContent="Hover on a road to compare"},m(t,n){Z(t,e,n)},p:ot,d(t){t&&q(e)}}}function L8(r){let e;return{c(){e=j("p"),e.innerHTML=`No possible route (
        <i>This is usually a known software bug</i>
        )`},m(t,n){Z(t,e,n)},p:ot,d(t){t&&q(e)}}}function E8(r){let e,t=Ea(r[4].properties.distance)+"",n,i,o=Ia(r[4].properties.time)+"",u;return{c(){e=j("p"),n=Ee(t),i=Ee(", "),u=Ee(o)},m(a,d){Z(a,e,d),D(e,n),D(e,i),D(e,u)},p(a,d){d&16&&t!==(t=Ea(a[4].properties.distance)+"")&&gt(n,t),d&16&&o!==(o=Ia(a[4].properties.time)+"")&&gt(u,o)},d(a){a&&q(e)}}}function I8(r){let e;return{c(){e=j("p"),e.textContent="Hover on a road to compare"},m(t,n){Z(t,e,n)},p:ot,d(t){t&&q(e)}}}function A8(r){let e;return{c(){e=j("p"),e.innerHTML=`No possible route (
        <i>This is usually a known software bug</i>
        )`},m(t,n){Z(t,e,n)},p:ot,d(t){t&&q(e)}}}function P8(r){let e,t=Ea(r[3].properties.distance)+"",n,i,o=Ia(r[3].properties.time)+"",u;return{c(){e=j("p"),n=Ee(t),i=Ee(", "),u=Ee(o)},m(a,d){Z(a,e,d),D(e,n),D(e,i),D(e,u)},p(a,d){d&8&&t!==(t=Ea(a[3].properties.distance)+"")&&gt(n,t),d&8&&o!==(o=Ia(a[3].properties.time)+"")&&gt(u,o)},d(a){a&&q(e)}}}function z8(r){let e,t,n,i,o,u,a,d,p,g,y;t=new As({props:{mode:{mode:"neighbourhood"}}});function x(P,$){return P[4]?E8:P[3]?L8:M8}let C=x(r),M=C(r);function F(P,$){return P[3]?P8:P[4]?A8:I8}let z=F(r),E=z(r);return{c(){e=j("div"),ce(t.$$.fragment),n=ie(),i=j("p"),i.textContent=`This shows the change in driving time to one destination from everywhere
      within the neighbourhood. Drag the pin around to change that destination.`,o=ie(),u=j("u"),u.textContent="Route before changes",a=ie(),M.c(),d=ie(),p=j("u"),p.textContent="Route after changes",g=ie(),E.c(),Ye(u,"color","red"),Ye(p,"color","blue"),ae(e,"slot","sidebar")},m(P,$){Z(P,e,$),le(t,e,null),D(e,n),D(e,i),D(e,o),D(e,u),D(e,a),M.m(e,null),D(e,d),D(e,p),D(e,g),E.m(e,null),y=!0},p(P,$){C===(C=x(P))&&M?M.p(P,$):(M.d(1),M=C(P),M&&(M.c(),M.m(e,d))),z===(z=F(P))&&E?E.p(P,$):(E.d(1),E=z(P),E&&(E.c(),E.m(e,null)))},i(P){y||(N(t.$$.fragment,P),y=!0)},o(P){V(t.$$.fragment,P),y=!1},d(P){P&&q(e),ue(t),M.d(),E.d()}}}function D8(r){let e,t;const n=[dn("cells"),{filter:["==",["get","kind"],"cell"]},{paint:{"fill-color":["get","color"],"fill-opacity":.6}}];let i={};for(let o=0;o<n.length;o+=1)i=Mt(i,n[o]);return e=new Ki({props:i}),{c(){ce(e.$$.fragment)},m(o,u){le(e,o,u),t=!0},p(o,u){const a={};e.$set(a)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){ue(e,o)}}}function R8(r){let e,t,n=(r[16].time_after/r[16].time_before).toFixed(1)+"",i;return{c(){e=j("p"),t=Ee("Time ratio: "),i=Ee(n)},m(o,u){Z(o,e,u),D(e,t),D(e,i)},p(o,u){u&65536&&n!==(n=(o[16].time_after/o[16].time_before).toFixed(1)+"")&&gt(i,n)},d(o){o&&q(e)}}}function F8(r){let e,t;return e=new di({props:{openOn:"hover",$$slots:{default:[R8,({props:n})=>({16:n}),({props:n})=>n?65536:0]},$$scope:{ctx:r}}}),{c(){ce(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p(n,i){const o={};i&196608&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){ue(e,n)}}}function B8(r){let e,t,n;const i=[dn("interior-roads"),{paint:{"line-color":["interpolate-hcl",["linear"],["/",["get","time_after"],["get","time_before"]],1,"white",Math.max(r[5].highest_time_ratio,1.1),"red"],"line-width":5}},{manageHoverState:!0}];function o(a){r[10](a)}let u={$$slots:{default:[F8]},$$scope:{ctx:r}};for(let a=0;a<i.length;a+=1)u=Mt(u,i[a]);return r[0]!==void 0&&(u.hovered=r[0]),e=new sr({props:u}),un.push(()=>Pn(e,"hovered",o)),e.$on("click",r[11]),{c(){ce(e.$$.fragment)},m(a,d){le(e,a,d),n=!0},p(a,d){const p=d&32?En(i,[i[0],{paint:{"line-color":["interpolate-hcl",["linear"],["/",["get","time_after"],["get","time_before"]],1,"white",Math.max(a[5].highest_time_ratio,1.1),"red"],"line-width":5}},i[2]]):{};d&131072&&(p.$$scope={dirty:d,ctx:a}),!t&&d&1&&(t=!0,p.hovered=a[0],An(()=>t=!1)),e.$set(p)},i(a){n||(N(e.$$.fragment,a),n=!0)},o(a){V(e.$$.fragment,a),n=!1},d(a){ue(e,a)}}}function $8(r){let e,t;const n=[dn("compare-route"),{interactive:!1},{paint:{"line-width":10,"line-color":$o(["get","kind"],{before:"red",after:"blue"},"red")}}];let i={};for(let o=0;o<n.length;o+=1)i=Mt(i,n[o]);return e=new sr({props:i}),{c(){ce(e.$$.fragment)},m(o,u){le(e,o,u),t=!0},p(o,u){const a={};e.$set(a)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){ue(e,o)}}}function O8(r){let e;return{c(){e=Ee("X")},m(t,n){Z(t,e,n)},d(t){t&&q(e)}}}function N8(r){let e,t,n,i,o,u,a,d,p,g,y,x;t=new Dh({props:{$$slots:{default:[D8]},$$scope:{ctx:r}}}),i=new mr({props:{data:r[5],generateId:!0,$$slots:{default:[B8]},$$scope:{ctx:r}}}),u=new mr({props:{data:r[1],$$slots:{default:[$8]},$$scope:{ctx:r}}}),d=new Oa({props:{interactive:!1}});function C(F){r[12](F)}let M={draggable:!0,$$slots:{default:[O8]},$$scope:{ctx:r}};return r[2]!==void 0&&(M.lngLat=r[2]),g=new bl({props:M}),un.push(()=>Pn(g,"lngLat",C)),{c(){e=j("div"),ce(t.$$.fragment),n=ie(),ce(i.$$.fragment),o=ie(),ce(u.$$.fragment),a=ie(),ce(d.$$.fragment),p=ie(),ce(g.$$.fragment),ae(e,"slot","map")},m(F,z){Z(F,e,z),le(t,e,null),D(e,n),le(i,e,null),D(e,o),le(u,e,null),D(e,a),le(d,e,null),D(e,p),le(g,e,null),x=!0},p(F,z){const E={};z&131072&&(E.$$scope={dirty:z,ctx:F}),t.$set(E);const P={};z&32&&(P.data=F[5]),z&131105&&(P.$$scope={dirty:z,ctx:F}),i.$set(P);const $={};z&2&&($.data=F[1]),z&131072&&($.$$scope={dirty:z,ctx:F}),u.$set($);const U={};z&131072&&(U.$$scope={dirty:z,ctx:F}),!y&&z&4&&(y=!0,U.lngLat=F[2],An(()=>y=!1)),g.$set(U)},i(F){x||(N(t.$$.fragment,F),N(i.$$.fragment,F),N(u.$$.fragment,F),N(d.$$.fragment,F),N(g.$$.fragment,F),x=!0)},o(F){V(t.$$.fragment,F),V(i.$$.fragment,F),V(u.$$.fragment,F),V(d.$$.fragment,F),V(g.$$.fragment,F),x=!1},d(F){F&&q(e),ue(t),ue(i),ue(u),ue(d),ue(g)}}}function j8(r){let e,t,n,i;return e=new eg({}),e.$on("contextmenu",r[8]),n=new wo({props:{$$slots:{map:[N8],sidebar:[z8],top:[C8]},$$scope:{ctx:r}}}),{c(){ce(e.$$.fragment),t=ie(),ce(n.$$.fragment)},m(o,u){le(e,o,u),Z(o,t,u),le(n,o,u),i=!0},p(o,[u]){const a={};u&131199&&(a.$$scope={dirty:u,ctx:o}),n.$set(a)},i(o){i||(N(e.$$.fragment,o),N(n.$$.fragment,o),i=!0)},o(o){V(e.$$.fragment,o),V(n.$$.fragment,o),i=!1},d(o){o&&q(t),ue(e,o),ue(n,o)}}}function U8(r,e,t){let n,i,o,u,a,d,p,g,y;st(r,qf,$=>t(2,a=$)),st(r,Kn,$=>t(6,d=$)),st(r,uh,$=>t(13,p=$)),st(r,lh,$=>t(14,g=$)),st(r,Cr,$=>t(9,y=$));let x=null;Es(()=>{setTimeout(()=>{a&&dm(qf)},10)});function C($){return $?y.compareRoute(new Ys.LngLat($.properties.pt1_x,$.properties.pt1_y),a,1):Ji()}function M($){an(lh,g=new Ys.LngLat($.properties.pt1_x,$.properties.pt1_y),g),an(uh,p=a,p),an(Kn,d={mode:"route",prevMode:"impact-one-destination"},d)}function F($){an(qf,a=$.detail.lngLat,a)}function z($){x=$,t(0,x)}const E=$=>M($.detail.features[0]);function P($){a=$,qf.set(a)}return r.$$.update=()=>{r.$$.dirty&516&&t(5,n=y.impactToOneDestination(a)),r.$$.dirty&1&&t(1,i=C(x)),r.$$.dirty&2&&t(4,o=i.features.find($=>$.properties.kind=="before")),r.$$.dirty&2&&t(3,u=i.features.find($=>$.properties.kind=="after"))},[x,i,a,u,o,n,d,M,F,y,z,E,P]}class V8 extends St{constructor(e){super(),kt(this,e,U8,j8,_t,{})}}function X1(r,e,t){const n=r.slice();return n[27]=e[t].properties.name,n}function q8(r){let e;return{c(){e=j("p"),e.textContent=`Inside the neighbourhood you define, the goal is to eliminate (or
              deliberately permit) through-traffic. An appropriate neighbourhood
              boundary depends on many factors. The simplest approach is to find
              the area bounded on all sides by "main" roads, which are designed
              for higher traffic volumes. There are many other considerations,
              though -- maybe severances like rivers or rail should be part of a
              boundary. Bridges and tunnels near a boundary may be confusing as
              well. And note that your boundary may not match the conventional
              definition of "neighbourhood."`},m(t,n){Z(t,e,n)},p:ot,d(t){t&&q(e)}}}function J1(r){let e,t,n;return t=new jn({props:{mode:{mode:"debug-intersections"}}}),{c(){e=j("li"),ce(t.$$.fragment)},m(i,o){Z(i,e,o),le(t,e,null),n=!0},i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){V(t.$$.fragment,i),n=!1},d(i){i&&q(e),ue(t)}}}function Z8(r){let e,t,n,i,o,u,a,d=gr(r[5].mode)+"",p,g,y,x,C,M,F,z,E,P,$,U,K;o=new jn({props:{mode:{mode:"title"}}}),y=new rg({props:{$$slots:{default:[q8]},$$scope:{ctx:r}}}),z=new jn({props:{mode:{mode:"route",prevMode:"pick-neighbourhood"}}}),$=new jn({props:{mode:{mode:"predict-impact"}}});let ee=r[9]&&J1();return{c(){e=j("div"),t=j("nav"),n=j("ul"),i=j("li"),ce(o.$$.fragment),u=ie(),a=j("li"),p=Ee(d),g=ie(),ce(y.$$.fragment),x=ie(),C=j("nav"),M=j("ul"),F=j("li"),ce(z.$$.fragment),E=ie(),P=j("li"),ce($.$$.fragment),U=ie(),ee&&ee.c(),ae(t,"aria-label","breadcrumb"),ae(e,"slot","top"),Ye(e,"display","flex"),Ye(e,"justify-content","space-between")},m(W,J){Z(W,e,J),D(e,t),D(t,n),D(n,i),le(o,i,null),D(n,u),D(n,a),D(a,p),D(a,g),le(y,a,null),D(e,x),D(e,C),D(C,M),D(M,F),le(z,F,null),D(M,E),D(M,P),le($,P,null),D(M,U),ee&&ee.m(M,null),K=!0},p(W,J){(!K||J&32)&&d!==(d=gr(W[5].mode)+"")&&gt(p,d);const he={};J&1073741824&&(he.$$scope={dirty:J,ctx:W}),y.$set(he),W[9]?ee?J&512&&N(ee,1):(ee=J1(),ee.c(),N(ee,1),ee.m(M,null)):ee&&(Kt(),V(ee,1,1,()=>{ee=null}),Xt())},i(W){K||(N(o.$$.fragment,W),N(y.$$.fragment,W),N(z.$$.fragment,W),N($.$$.fragment,W),N(ee),K=!0)},o(W){V(o.$$.fragment,W),V(y.$$.fragment,W),V(z.$$.fragment,W),V($.$$.fragment,W),V(ee),K=!1},d(W){W&&q(e),ue(o),ue(y),ue(z),ue($),ee&&ee.d()}}}function G8(r){let e=r[27]+"",t;return{c(){t=Ee(e)},m(n,i){Z(n,t,i)},p(n,i){i&1&&e!==(e=n[27]+"")&&gt(t,e)},d(n){n&&q(t)}}}function Y1(r){let e,t,n,i,o,u,a,d,p,g,y,x,C;function M(){return r[20](r[27])}n=new Ah({props:{$$slots:{default:[G8]},$$scope:{ctx:r}}}),n.$on("click",M),a=new tv({props:{color:"black"}});function F(){return r[21](r[27])}g=new Jm({props:{color:"white"}});function z(){return r[22](r[27])}function E(){return r[23](r[27])}return{c(){var P;e=j("li"),t=j("h3"),ce(n.$$.fragment),i=ie(),o=j("span"),u=j("button"),ce(a.$$.fragment),d=ie(),p=j("button"),ce(g.$$.fragment),ae(u,"class","outline icon-btn"),ae(u,"title","Rename neighbourhood"),ae(p,"class","icon-btn destructive"),ae(p,"title","Delete neighbourhood"),ae(o,"class","actions"),ae(e,"class","actionable-cell svelte-qhjp0j"),jt(e,"highlighted",((P=r[3])==null?void 0:P.properties.name)==r[27]||r[2]==r[27])},m(P,$){Z(P,e,$),D(e,t),le(n,t,null),D(e,i),D(e,o),D(o,u),le(a,u,null),D(o,d),D(o,p),le(g,p,null),y=!0,x||(C=[Tt(u,"click",F),Tt(p,"click",z),Tt(e,"mouseenter",E),Tt(e,"mouseleave",r[24])],x=!0)},p(P,$){var K;r=P;const U={};$&1073741825&&(U.$$scope={dirty:$,ctx:r}),n.$set(U),(!y||$&13)&&jt(e,"highlighted",((K=r[3])==null?void 0:K.properties.name)==r[27]||r[2]==r[27])},i(P){y||(N(n.$$.fragment,P),N(a.$$.fragment,P),N(g.$$.fragment,P),y=!0)},o(P){V(n.$$.fragment,P),V(a.$$.fragment,P),V(g.$$.fragment,P),y=!1},d(P){P&&q(e),ue(n),ue(a),ue(g),x=!1,ur(C)}}}function H8(r){let e,t,n;return e=new Vk({}),{c(){ce(e.$$.fragment),t=Ee(`
          Add a new neighbourhood`)},m(i,o){le(e,i,o),Z(i,t,o),n=!0},i(i){n||(N(e.$$.fragment,i),n=!0)},o(i){V(e.$$.fragment,i),n=!1},d(i){i&&q(t),ue(e,i)}}}function Q1(r){let e,t,n,i,o,u,a,d,p;function g(x){r[25](x)}let y={};return r[1]!==void 0&&(y.selectedPrioritization=r[1]),o=new tw({props:y}),un.push(()=>Pn(o,"selectedPrioritization",g)),{c(){e=j("h3"),e.textContent="Prioritization",t=ie(),n=j("p"),n.textContent="Compare metrics across your neighbourhoods.",i=ie(),ce(o.$$.fragment),a=ie(),d=j("hr")},m(x,C){Z(x,e,C),Z(x,t,C),Z(x,n,C),Z(x,i,C),le(o,x,C),Z(x,a,C),Z(x,d,C),p=!0},p(x,C){const M={};!u&&C&2&&(u=!0,M.selectedPrioritization=x[1],An(()=>u=!1)),o.$set(M)},i(x){p||(N(o.$$.fragment,x),p=!0)},o(x){V(o.$$.fragment,x),p=!1},d(x){x&&(q(e),q(t),q(n),q(i),q(a),q(d)),ue(o,x)}}}function eb(r){let e,t,n;return{c(){e=j("button"),e.textContent="Debug route-snapper",ae(e,"class","secondary")},m(i,o){Z(i,e,o),t||(n=Tt(e,"click",r[13]),t=!0)},p:ot,d(i){i&&q(e),t=!1,n()}}}function W8(r){let e,t,n,i=r[6].projectName(or(r[7]))+"",o,u,a,d,p,g,y,x,C,M,F,z,E,P,$,U,K,ee=r[4].modalFilters+"",W,J,he,Ae,ne=r[4].deletedModalFilters+"",fe,Ce,_e,Ze,Oe=r[4].travelFlows+"",je,De,At,ut,ht,wt;p=new Qb({});let pt=Rn(r[0].features),Qe=[];for(let Pt=0;Pt<pt.length;Pt+=1)Qe[Pt]=Y1(X1(r,pt,Pt));const Ft=Pt=>V(Qe[Pt],1,1,()=>{Qe[Pt]=null});P=new jn({props:{mode:{mode:"add-neighbourhood"},$$slots:{default:[H8]},$$scope:{ctx:r}}});let bt=r[8]=="cnt"&&Q1(r),Bt=r[9]&&eb(r);return{c(){e=j("div"),t=j("div"),n=j("h1"),o=Ee(i),u=ie(),a=j("button"),d=j("div"),ce(p.$$.fragment),g=ie(),y=j("span"),y.textContent="Export",x=ie(),C=j("h2"),C.textContent="Neighbourhoods",M=ie(),F=j("ul");for(let Pt=0;Pt<Qe.length;Pt+=1)Qe[Pt].c();z=ie(),E=j("li"),ce(P.$$.fragment),$=ie(),bt&&bt.c(),U=ie(),K=j("p"),W=Ee(ee),J=Ee(" new modal filter(s) added"),he=ie(),Ae=j("p"),fe=Ee(ne),Ce=Ee(`
      existing modal filter(s) removed`),_e=ie(),Ze=j("p"),je=Ee(Oe),De=Ee(" road segment direction(s) changed"),At=ie(),Bt&&Bt.c(),Ye(y,"margin-right","2px"),Ye(d,"display","flex"),Ye(d,"align-items","center"),Ye(d,"gap","8px"),Ye(d,"color","black"),ae(a,"class","outline icon-btn"),Ye(a,"margin-right","8px"),ae(a,"title","Download project as GeoJSON"),Ye(t,"display","flex"),Ye(t,"justify-content","space-between"),Ye(t,"align-items","center"),Ye(t,"gap","16px"),ae(F,"class","navigable-list"),ae(e,"slot","sidebar")},m(Pt,Qt){Z(Pt,e,Qt),D(e,t),D(t,n),D(n,o),D(t,u),D(t,a),D(a,d),le(p,d,null),D(d,g),D(d,y),D(e,x),D(e,C),D(e,M),D(e,F);for(let vn=0;vn<Qe.length;vn+=1)Qe[vn]&&Qe[vn].m(F,null);D(F,z),D(F,E),le(P,E,null),D(e,$),bt&&bt.m(e,null),D(e,U),D(e,K),D(K,W),D(K,J),D(e,he),D(e,Ae),D(Ae,fe),D(Ae,Ce),D(e,_e),D(e,Ze),D(Ze,je),D(Ze,De),D(e,At),Bt&&Bt.m(e,null),ut=!0,ht||(wt=Tt(a,"click",r[19]),ht=!0)},p(Pt,Qt){if((!ut||Qt&192)&&i!==(i=Pt[6].projectName(or(Pt[7]))+"")&&gt(o,i),Qt&7181){pt=Rn(Pt[0].features);let qt;for(qt=0;qt<pt.length;qt+=1){const rn=X1(Pt,pt,qt);Qe[qt]?(Qe[qt].p(rn,Qt),N(Qe[qt],1)):(Qe[qt]=Y1(rn),Qe[qt].c(),N(Qe[qt],1),Qe[qt].m(F,z))}for(Kt(),qt=pt.length;qt<Qe.length;qt+=1)Ft(qt);Xt()}const vn={};Qt&1073741824&&(vn.$$scope={dirty:Qt,ctx:Pt}),P.$set(vn),Pt[8]=="cnt"?bt?(bt.p(Pt,Qt),Qt&256&&N(bt,1)):(bt=Q1(Pt),bt.c(),N(bt,1),bt.m(e,U)):bt&&(Kt(),V(bt,1,1,()=>{bt=null}),Xt()),(!ut||Qt&16)&&ee!==(ee=Pt[4].modalFilters+"")&&gt(W,ee),(!ut||Qt&16)&&ne!==(ne=Pt[4].deletedModalFilters+"")&&gt(fe,ne),(!ut||Qt&16)&&Oe!==(Oe=Pt[4].travelFlows+"")&&gt(je,Oe),Pt[9]?Bt?Bt.p(Pt,Qt):(Bt=eb(Pt),Bt.c(),Bt.m(e,null)):Bt&&(Bt.d(1),Bt=null)},i(Pt){if(!ut){N(p.$$.fragment,Pt);for(let Qt=0;Qt<pt.length;Qt+=1)N(Qe[Qt]);N(P.$$.fragment,Pt),N(bt),ut=!0}},o(Pt){V(p.$$.fragment,Pt),Qe=Qe.filter(Boolean);for(let Qt=0;Qt<Qe.length;Qt+=1)V(Qe[Qt]);V(P.$$.fragment,Pt),V(bt),ut=!1},d(Pt){Pt&&q(e),ue(p),gi(Qe,Pt),ue(P),bt&&bt.d(),Bt&&Bt.d(),ht=!1,wt()}}}function K8(r){let e,t,n=(r[26].number_pois/r[26].area_km2).toFixed(1)+"",i,o;return{c(){e=j("b"),e.textContent="Points of interest:",t=ie(),i=Ee(n),o=Ee(" / km")},m(u,a){Z(u,e,a),Z(u,t,a),Z(u,i,a),Z(u,o,a)},p(u,a){a&67108864&&n!==(n=(u[26].number_pois/u[26].area_km2).toFixed(1)+"")&&gt(i,n)},d(u){u&&(q(e),q(t),q(i),q(o))}}}function X8(r){let e,t,n=(r[26].number_stats19_collisions/r[26].area_km2).toFixed(1)+"",i,o;return{c(){e=j("b"),e.textContent="Pedestrian and cyclist collisions:",t=ie(),i=Ee(n),o=Ee(" / km")},m(u,a){Z(u,e,a),Z(u,t,a),Z(u,i,a),Z(u,o,a)},p(u,a){a&67108864&&n!==(n=(u[26].number_stats19_collisions/u[26].area_km2).toFixed(1)+"")&&gt(i,n)},d(u){u&&(q(e),q(t),q(i),q(o))}}}function J8(r){let e,t,n=Math.round(r[26].population/r[26].area_km2).toLocaleString()+"",i,o;return{c(){e=j("b"),e.textContent="Population density:",t=ie(),i=Ee(n),o=Ee(` people
            / km`)},m(u,a){Z(u,e,a),Z(u,t,a),Z(u,i,a),Z(u,o,a)},p(u,a){a&67108864&&n!==(n=Math.round(u[26].population/u[26].area_km2).toLocaleString()+"")&&gt(i,n)},d(u){u&&(q(e),q(t),q(i),q(o))}}}function Y8(r){let e,t=r[26].name+"",n,i,o;function u(p,g){if(p[1]=="density")return J8;if(p[1]=="stats19")return X8;if(p[1]=="pois")return K8}let a=u(r),d=a&&a(r);return{c(){e=j("h2"),n=Ee(t),i=ie(),d&&d.c(),o=Xn()},m(p,g){Z(p,e,g),D(e,n),Z(p,i,g),d&&d.m(p,g),Z(p,o,g)},p(p,g){g&67108864&&t!==(t=p[26].name+"")&&gt(n,t),a===(a=u(p))&&d?d.p(p,g):(d&&d.d(1),d=a&&a(p),d&&(d.c(),d.m(o.parentNode,o)))},d(p){p&&(q(e),q(i),q(o)),d&&d.d(p)}}}function Q8(r){let e,t;return e=new di({props:{openOn:"hover",$$slots:{default:[Y8,({props:n})=>({26:n}),({props:n})=>n?67108864:0]},$$scope:{ctx:r}}}),{c(){ce(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p(n,i){const o={};i&1140850690&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){ue(e,n)}}}function eA(r){let e,t,n,i,o,u,a,d,p;e=new x4({props:{data:r[2]?[{name:r[2],highlight:"yes"}]:[],idCol:"name"}});const g=[{filter:["==",["get","kind"],"boundary"]},dn("neighbourhood-boundaries-selected-outline",!1),{manageHoverState:!1},{paint:{"line-color":"black","line-width":4,"line-dasharray":[2,2]}}];let y={};for(let E=0;E<g.length;E+=1)y=Mt(y,g[E]);n=new sr({props:y});const x=[{filter:["==",["get","kind"],"boundary"]},dn("neighbourhood-boundaries-selected-outline-base",!1),{manageHoverState:!1},{paint:{"line-color":"white","line-width":8,"line-opacity":.7}}];let C={};for(let E=0;E<x.length;E+=1)C=Mt(C,x[E]);o=new sr({props:C});const M=[dn("neighbourhood-boundaries",!1),{filter:["==",["get","kind"],"boundary"]},{paint:{"fill-color":r[14](r[1]),"fill-opacity":r[15](r[1])}},{manageHoverState:!0},{hoverCursor:"pointer"}];function F(E){r[17](E)}let z={$$slots:{default:[Q8]},$$scope:{ctx:r}};for(let E=0;E<M.length;E+=1)z=Mt(z,M[E]);return r[3]!==void 0&&(z.hovered=r[3]),a=new Ki({props:z}),un.push(()=>Pn(a,"hovered",F)),a.$on("click",r[18]),{c(){ce(e.$$.fragment),t=ie(),ce(n.$$.fragment),i=ie(),ce(o.$$.fragment),u=ie(),ce(a.$$.fragment)},m(E,P){le(e,E,P),Z(E,t,P),le(n,E,P),Z(E,i,P),le(o,E,P),Z(E,u,P),le(a,E,P),p=!0},p(E,P){const $={};P&4&&($.data=E[2]?[{name:E[2],highlight:"yes"}]:[]),e.$set($);const U={};n.$set(U);const K={};o.$set(K);const ee=P&49154?En(M,[M[0],M[1],{paint:{"fill-color":E[14](E[1]),"fill-opacity":E[15](E[1])}},M[3],M[4]]):{};P&1073741826&&(ee.$$scope={dirty:P,ctx:E}),!d&&P&8&&(d=!0,ee.hovered=E[3],An(()=>d=!1)),a.$set(ee)},i(E){p||(N(e.$$.fragment,E),N(n.$$.fragment,E),N(o.$$.fragment,E),N(a.$$.fragment,E),p=!0)},o(E){V(e.$$.fragment,E),V(n.$$.fragment,E),V(o.$$.fragment,E),V(a.$$.fragment,E),p=!1},d(E){E&&(q(t),q(i),q(u)),ue(e,E),ue(n,E),ue(o,E),ue(a,E)}}}function tA(r){let e,t,n,i,o;return t=new mr({props:{data:r[0],promoteId:"name",$$slots:{default:[eA]},$$scope:{ctx:r}}}),i=new Oa({props:{interactive:!1}}),{c(){e=j("div"),ce(t.$$.fragment),n=ie(),ce(i.$$.fragment),ae(e,"slot","map")},m(u,a){Z(u,e,a),le(t,e,null),D(e,n),le(i,e,null),o=!0},p(u,a){const d={};a&1&&(d.data=u[0]),a&1073741838&&(d.$$scope={dirty:a,ctx:u}),t.$set(d)},i(u){o||(N(t.$$.fragment,u),N(i.$$.fragment,u),o=!0)},o(u){V(t.$$.fragment,u),V(i.$$.fragment,u),o=!1},d(u){u&&q(e),ue(t),ue(i)}}}function nA(r){let e,t;return e=new wo({props:{$$slots:{map:[tA],sidebar:[W8],top:[Z8]},$$scope:{ctx:r}}}),{c(){ce(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p(n,[i]){const o={};i&1073742847&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){ue(e,n)}}}function rA(r){let e=0,t=0,n=0;for(let i of r.features)i.properties.kind=="modal_filter"?e++:i.properties.kind=="deleted_existing_modal_filter"?t++:i.properties.kind=="travel_flow"&&n++;return{modalFilters:e,deletedModalFilters:t,travelFlows:n}}function iA(r,e,t){let n,i,o,u,a,d,p,g;st(r,Cr,Ce=>t(16,o=Ce)),st(r,Kn,Ce=>t(5,u=Ce)),st(r,ta,Ce=>t(6,a=Ce)),st(r,yl,Ce=>t(7,d=Ce)),st(r,is,Ce=>t(8,p=Ce)),st(r,ch,Ce=>t(9,g=Ce));let y="none",x=null,C=null;function M(Ce){o.setCurrentNeighbourhood(Ce),an(Kn,u={mode:"neighbourhood"},u)}function F(Ce){window.confirm(`Really delete neighbourhood ${Ce}? You can't undo this.`)&&(o.deleteNeighbourhoodBoundary(Ce),yh(),t(0,n=o.getAllNeighbourhoods()))}function z(Ce){let _e=ew(o,`Rename neighbourhood ${Ce} to what?`,Ce);_e&&(o.renameNeighbourhoodBoundary(Ce,_e),yh(),t(0,n=o.getAllNeighbourhoods()))}function E(){xd("debug_route_snapper.geojson",o.toRouteSnapperGj())}function P(Ce){let _e=yo.mapFeature.hover.backgroundColor,Ze=nw({none:_e},Ce);return["case",["==",["feature-state","highlight"],"yes"],_e,Ze]}function $(Ce){let _e=.7;return{none:["case",["==",["feature-state","highlight"],"yes"],_e,Wn(.3,_e)],area:Wn(.7,.9),density:Wn(.7,.9),simd:Wn(.7,.9),stats19:Wn(.7,.9),pois:Wn(.7,.9),car_ownership:Wn(.7,.9)}[Ce]}function U(Ce){C=Ce,t(3,C)}const K=Ce=>M(or(Ce.detail.features[0].properties).name),ee=()=>Av(or(d)),W=Ce=>M(Ce),J=Ce=>z(Ce),he=Ce=>F(Ce),Ae=Ce=>t(2,x=Ce),ne=()=>t(2,x=null);function fe(Ce){y=Ce,t(1,y)}return r.$$.update=()=>{r.$$.dirty&65536&&t(0,n=o.getAllNeighbourhoods()),r.$$.dirty&1&&t(4,i=rA(n))},[n,y,x,C,i,u,a,d,p,g,M,F,z,E,P,$,o,U,K,ee,W,J,he,Ae,ne,fe]}class oA extends St{constructor(e){super(),kt(this,e,iA,nA,_t,{})}}function sA(r){let e,t,n,i,o,u,a,d,p,g,y=gr(r[3].mode)+"",x,C;return o=new jn({props:{mode:{mode:"title"}}}),d=new jn({props:{mode:{mode:"pick-neighbourhood"}}}),{c(){e=j("div"),t=j("nav"),n=j("ul"),i=j("li"),ce(o.$$.fragment),u=ie(),a=j("li"),ce(d.$$.fragment),p=ie(),g=j("li"),x=Ee(y),ae(t,"aria-label","breadcrumb"),ae(e,"slot","top")},m(M,F){Z(M,e,F),D(e,t),D(t,n),D(n,i),le(o,i,null),D(n,u),D(n,a),le(d,a,null),D(n,p),D(n,g),D(g,x),C=!0},p(M,F){(!C||F&8)&&y!==(y=gr(M[3].mode)+"")&&gt(x,y)},i(M){C||(N(o.$$.fragment,M),N(d.$$.fragment,M),C=!0)},o(M){V(o.$$.fragment,M),V(d.$$.fragment,M),C=!1},d(M){M&&q(e),ue(o),ue(d)}}}function aA(r){let e;return{c(){e=Ee("Explore the origin/destination demand data used")},m(t,n){Z(t,e,n)},d(t){t&&q(e)}}}function lA(r){let e,t,n,i,o,u,a,d,p,g,y,x,C,M,F,z,E,P,$,U,K,ee,W,J,he,Ae,ne;return t=new As({props:{mode:{mode:"pick-neighbourhood"}}}),u=new jn({props:{mode:{mode:"debug-demand"},$$slots:{default:[aA]},$$scope:{ctx:r}}}),W=new No({props:{colorScale:r[5],labels:{limits:["0%","50%","same","150%","200%"]}}}),he=Nm(r[12][0]),{c(){e=j("div"),ce(t.$$.fragment),n=ie(),i=j("p"),o=Ee(`This mode estimates the impact of all your changes on traffic around the
      entire area. It's based on many assumptions and must be interpreted very
      carefully. `),ce(u.$$.fragment),a=ie(),d=j("fieldset"),p=j("label"),g=j("input"),y=Ee(`
        Calculate quickly`),x=ie(),C=j("label"),M=j("input"),F=Ee(`
        Calculate more accurately`),z=ie(),E=j("p"),E.textContent=`Red roads have increased traffic, and green roads have decreased. Thicker
      roads have more traffic after edits. If hovering on a road doesn't show
      anything, there was no change there. Click a road to see example routes
      through it that've changed.`,P=ie(),$=j("label"),U=Ee(`Only show roads with at least this many daily trips before or after
      `),K=j("input"),ee=ie(),ce(W.$$.fragment),ae(g,"type","radio"),g.__value="fast",Vn(g,g.__value),ae(M,"type","radio"),M.__value="accurate",Vn(M,M.__value),ae(K,"type","number"),ae(K,"min",0),ae(e,"slot","sidebar"),he.p(g,M)},m(fe,Ce){Z(fe,e,Ce),le(t,e,null),D(e,n),D(e,i),D(i,o),le(u,i,null),D(e,a),D(e,d),D(d,p),D(p,g),g.checked=g.__value===r[2],D(p,y),D(d,x),D(d,C),D(C,M),M.checked=M.__value===r[2],D(C,F),D(e,z),D(e,E),D(e,P),D(e,$),D($,U),D($,K),Vn(K,r[4]),D(e,ee),le(W,e,null),J=!0,Ae||(ne=[Tt(g,"change",r[11]),Tt(g,"change",r[8]),Tt(M,"change",r[13]),Tt(M,"change",r[8]),Tt(K,"input",r[14])],Ae=!0)},p(fe,Ce){const _e={};Ce&262144&&(_e.$$scope={dirty:Ce,ctx:fe}),u.$set(_e),Ce&4&&(g.checked=g.__value===fe[2]),Ce&4&&(M.checked=M.__value===fe[2]),Ce&16&&gl(K.value)!==fe[4]&&Vn(K,fe[4])},i(fe){J||(N(t.$$.fragment,fe),N(u.$$.fragment,fe),N(W.$$.fragment,fe),J=!0)},o(fe){V(t.$$.fragment,fe),V(u.$$.fragment,fe),V(W.$$.fragment,fe),J=!1},d(fe){fe&&q(e),ue(t),ue(u),ue(W),he.r(),Ae=!1,ur(ne)}}}function uA(r){let e,t;const n=[dn("neighbourhood-boundaries",!1),{filter:["==",["get","kind"],"boundary"]},{paint:{"fill-color":"grey","fill-opacity":.5}}];let i={};for(let o=0;o<n.length;o+=1)i=Mt(i,n[o]);return e=new Ki({props:i}),{c(){ce(e.$$.fragment)},m(o,u){le(e,o,u),t=!0},p(o,u){const a={};e.$set(a)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){ue(e,o)}}}function cA(r){let e,t=r[17].before.toLocaleString()+"",n,i,o=r[17].after.toLocaleString()+"",u,a,d,p,g=Math.round(100*r[17].after/r[17].before)+"",y,x;return{c(){e=j("p"),n=Ee(t),i=Ee(" before, "),u=Ee(o),a=Ee(`
            after`),d=ie(),p=j("p"),y=Ee(g),x=Ee("%")},m(C,M){Z(C,e,M),D(e,n),D(e,i),D(e,u),D(e,a),Z(C,d,M),Z(C,p,M),D(p,y),D(p,x)},p(C,M){M&131072&&t!==(t=C[17].before.toLocaleString()+"")&&gt(n,t),M&131072&&o!==(o=C[17].after.toLocaleString()+"")&&gt(u,o),M&131072&&g!==(g=Math.round(100*C[17].after/C[17].before)+"")&&gt(y,g)},d(C){C&&(q(e),q(d),q(p))}}}function hA(r){let e,t;return e=new di({props:{openOn:"hover",$$slots:{default:[cA,({props:n})=>({17:n}),({props:n})=>n?131072:0]},$$scope:{ctx:r}}}),{c(){ce(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p(n,i){const o={};i&393216&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){ue(e,n)}}}function fA(r){let e,t,n,i;const o=[dn("predict-impact-outline"),{filter:[">=",["max",["get","before"],["get","after"]],r[4]]},{paint:{"line-width":["interpolate",["linear"],["get","after"],0,1.5*Xf,r[1].max_count,1.5*Jf],"line-color":"black"}}];let u={};for(let p=0;p<o.length;p+=1)u=Mt(u,o[p]);e=new sr({props:u});const a=[dn("predict-impact"),{filter:[">=",["max",["get","before"],["get","after"]],r[4]]},{paint:{"line-width":["interpolate",["linear"],["get","after"],0,Xf,r[1].max_count,Jf],"line-color":["let","ratio",["*",100,["/",["get","after"],["get","before"]]],["interpolate-hcl",["linear"],["var","ratio"],0,r[5][0],50,r[5][1],100,r[5][2],150,r[5][3],200,r[5][4]]]}},{manageHoverState:!0},{hoverCursor:"pointer"}];let d={$$slots:{default:[hA]},$$scope:{ctx:r}};for(let p=0;p<a.length;p+=1)d=Mt(d,a[p]);return n=new sr({props:d}),n.$on("click",r[10]),{c(){ce(e.$$.fragment),t=ie(),ce(n.$$.fragment)},m(p,g){le(e,p,g),Z(p,t,g),le(n,p,g),i=!0},p(p,g){const y=g&18?En(o,[o[0],g&16&&{filter:[">=",["max",["get","before"],["get","after"]],p[4]]},g&2&&{paint:{"line-width":["interpolate",["linear"],["get","after"],0,1.5*Xf,p[1].max_count,1.5*Jf],"line-color":"black"}}]):{};e.$set(y);const x=g&50?En(a,[a[0],g&16&&{filter:[">=",["max",["get","before"],["get","after"]],p[4]]},g&34&&{paint:{"line-width":["interpolate",["linear"],["get","after"],0,Xf,p[1].max_count,Jf],"line-color":["let","ratio",["*",100,["/",["get","after"],["get","before"]]],["interpolate-hcl",["linear"],["var","ratio"],0,p[5][0],50,p[5][1],100,p[5][2],150,p[5][3],200,p[5][4]]]}},a[3],a[4]]):{};g&262144&&(x.$$scope={dirty:g,ctx:p}),n.$set(x)},i(p){i||(N(e.$$.fragment,p),N(n.$$.fragment,p),i=!0)},o(p){V(e.$$.fragment,p),V(n.$$.fragment,p),i=!1},d(p){p&&q(t),ue(e,p),ue(n,p)}}}function dA(r){let e,t,n,i,o,u,a;return t=new mr({props:{data:r[6],$$slots:{default:[uA]},$$scope:{ctx:r}}}),i=new mr({props:{data:r[1],generateId:!0,$$slots:{default:[fA]},$$scope:{ctx:r}}}),u=new Oa({props:{interactive:!1}}),{c(){e=j("div"),ce(t.$$.fragment),n=ie(),ce(i.$$.fragment),o=ie(),ce(u.$$.fragment),ae(e,"slot","map")},m(d,p){Z(d,e,p),le(t,e,null),D(e,n),le(i,e,null),D(e,o),le(u,e,null),a=!0},p(d,p){const g={};p&262144&&(g.$$scope={dirty:p,ctx:d}),t.$set(g);const y={};p&2&&(y.data=d[1]),p&262162&&(y.$$scope={dirty:p,ctx:d}),i.$set(y)},i(d){a||(N(t.$$.fragment,d),N(i.$$.fragment,d),N(u.$$.fragment,d),a=!0)},o(d){V(t.$$.fragment,d),V(i.$$.fragment,d),V(u.$$.fragment,d),a=!1},d(d){d&&q(e),ue(t),ue(i),ue(u)}}}function pA(r){let e,t,n,i;return e=new Ch({props:{loading:r[0]}}),n=new wo({props:{$$slots:{map:[dA],sidebar:[lA],top:[sA]},$$scope:{ctx:r}}}),{c(){ce(e.$$.fragment),t=ie(),ce(n.$$.fragment)},m(o,u){le(e,o,u),Z(o,t,u),le(n,o,u),i=!0},p(o,[u]){const a={};u&1&&(a.loading=o[0]),e.$set(a);const d={};u&262174&&(d.$$scope={dirty:u,ctx:o}),n.$set(d)},i(o){i||(N(e.$$.fragment,o),N(n.$$.fragment,o),i=!0)},o(o){V(e.$$.fragment,o),V(n.$$.fragment,o),i=!1},d(o){o&&q(t),ue(e,o),ue(n,o)}}}let Xf=3,Jf=10;function mA(r,e,t){let n,i,o,u;st(r,hm,U=>t(9,n=U)),st(r,Cr,U=>t(15,i=U)),st(r,Kn,U=>t(3,o=U)),st(r,e0,U=>t(4,u=U));let a=["#1a9641","#a6d96a","white","#fdae61","#d7191c"],d="",p={type:"FeatureCollection",features:[],max_count:1},g=i.getAllNeighbourhoods();function y(U){an(Kn,o={mode:"impact-detail",road:U},o)}async function x(U){t(0,d="Calculating impact"),await new Promise(K=>{requestAnimationFrame(()=>{requestAnimationFrame(K)})}),t(1,p=i.predictImpact(U)),t(0,d="")}let C=n?"fast":"accurate";function M(){an(hm,n=C=="fast",n)}const F=[[]],z=U=>y(U.detail.features[0]);function E(){C=this.__value,t(2,C)}function P(){C=this.__value,t(2,C)}function $(){u=gl(this.value),e0.set(u)}return r.$$.update=()=>{r.$$.dirty&512&&x(n)},[d,p,C,o,u,a,g,y,M,n,z,E,F,P,$]}class gA extends St{constructor(e){super(),kt(this,e,mA,pA,_t,{})}}function tb(r){let e,t,n;return t=new jn({props:{mode:{mode:"neighbourhood"}}}),{c(){e=j("li"),ce(t.$$.fragment)},m(i,o){Z(i,e,o),le(t,e,null),n=!0},i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){V(t.$$.fragment,i),n=!1},d(i){i&&q(e),ue(t)}}}function _A(r){let e,t,n,i,o,u,a,d,p,g,y,x=gr(r[7].mode)+"",C,M;o=new jn({props:{mode:{mode:"title"}}}),d=new jn({props:{mode:{mode:"pick-neighbourhood"}}});let F=r[0]=="neighbourhood"&&tb();return{c(){e=j("div"),t=j("nav"),n=j("ul"),i=j("li"),ce(o.$$.fragment),u=ie(),a=j("li"),ce(d.$$.fragment),p=ie(),F&&F.c(),g=ie(),y=j("li"),C=Ee(x),ae(t,"aria-label","breadcrumb"),ae(e,"slot","top")},m(z,E){Z(z,e,E),D(e,t),D(t,n),D(n,i),le(o,i,null),D(n,u),D(n,a),le(d,a,null),D(n,p),F&&F.m(n,null),D(n,g),D(n,y),D(y,C),M=!0},p(z,E){z[0]=="neighbourhood"?F?E&1&&N(F,1):(F=tb(),F.c(),N(F,1),F.m(n,g)):F&&(Kt(),V(F,1,1,()=>{F=null}),Xt()),(!M||E&128)&&x!==(x=gr(z[7].mode)+"")&&gt(C,x)},i(z){M||(N(o.$$.fragment,z),N(d.$$.fragment,z),N(F),M=!0)},o(z){V(o.$$.fragment,z),V(d.$$.fragment,z),V(F),M=!1},d(z){z&&q(e),ue(o),ue(d),F&&F.d()}}}function yA(r){let e;return{c(){e=j("p"),e.innerHTML=`No possible route (
        <i>This is usually a known software bug</i>
        )`},m(t,n){Z(t,e,n)},p:ot,d(t){t&&q(e)}}}function bA(r){let e,t=Ea(r[6].properties.distance)+"",n,i,o=Ia(r[6].properties.time)+"",u;return{c(){e=j("p"),n=Ee(t),i=Ee(", "),u=Ee(o)},m(a,d){Z(a,e,d),D(e,n),D(e,i),D(e,u)},p(a,d){d&64&&t!==(t=Ea(a[6].properties.distance)+"")&&gt(n,t),d&64&&o!==(o=Ia(a[6].properties.time)+"")&&gt(u,o)},d(a){a&&q(e)}}}function vA(r){let e;return{c(){e=j("p"),e.innerHTML=`No possible route (
        <i>This is usually a known software bug</i>
        )`},m(t,n){Z(t,e,n)},p:ot,d(t){t&&q(e)}}}function wA(r){let e,t=Ea(r[5].properties.distance)+"",n,i,o=Ia(r[5].properties.time)+"",u;return{c(){e=j("p"),n=Ee(t),i=Ee(", "),u=Ee(o)},m(a,d){Z(a,e,d),D(e,n),D(e,i),D(e,u)},p(a,d){d&32&&t!==(t=Ea(a[5].properties.distance)+"")&&gt(n,t),d&32&&o!==(o=Ia(a[5].properties.time)+"")&&gt(u,o)},d(a){a&&q(e)}}}function xA(r){let e,t,n,i,o,u,a,d,p,g,y,x,C,M,F,z,E,P,$,U,K;t=new As({props:{mode:{mode:r[0]}}});function ee(fe,Ce){return fe[6]?bA:yA}let W=ee(r),J=W(r);function he(fe,Ce){return fe[5]?wA:vA}let Ae=he(r),ne=Ae(r);return{c(){e=j("div"),ce(t.$$.fragment),n=ie(),i=j("p"),i.textContent="Drag markers for a route",o=ie(),u=j("u"),u.textContent="Route before changes",a=ie(),J.c(),d=ie(),p=j("u"),p.textContent="Route after changes",g=ie(),ne.c(),y=ie(),x=j("label"),C=Ee("Slow-down factor for main roads: "),M=Ee(r[2]),F=ie(),z=j("input"),E=ie(),P=j("i"),P.textContent=`Increase to see how drivers may detour in heavy traffic. 1 means
      free-flow.`,Ye(u,"color","red"),Ye(p,"color","blue"),ae(z,"type","range"),ae(z,"min","1.0"),ae(z,"max","5.0"),ae(z,"step","0.1"),ae(e,"slot","sidebar")},m(fe,Ce){Z(fe,e,Ce),le(t,e,null),D(e,n),D(e,i),D(e,o),D(e,u),D(e,a),J.m(e,null),D(e,d),D(e,p),D(e,g),ne.m(e,null),D(e,y),D(e,x),D(x,C),D(x,M),D(x,F),D(x,z),Vn(z,r[2]),D(e,E),D(e,P),$=!0,U||(K=[Tt(z,"change",r[11]),Tt(z,"input",r[11])],U=!0)},p(fe,Ce){const _e={};Ce&1&&(_e.mode={mode:fe[0]}),t.$set(_e),W===(W=ee(fe))&&J?J.p(fe,Ce):(J.d(1),J=W(fe),J&&(J.c(),J.m(e,d))),Ae===(Ae=he(fe))&&ne?ne.p(fe,Ce):(ne.d(1),ne=Ae(fe),ne&&(ne.c(),ne.m(e,y))),(!$||Ce&4)&&gt(M,fe[2]),Ce&4&&Vn(z,fe[2])},i(fe){$||(N(t.$$.fragment,fe),$=!0)},o(fe){V(t.$$.fragment,fe),$=!1},d(fe){fe&&q(e),ue(t),J.d(),ne.d(),U=!1,ur(K)}}}function nb(r){let e,t;return e=new Dh({props:{$$slots:{default:[kA]},$$scope:{ctx:r}}}),{c(){ce(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){ue(e,n)}}}function kA(r){let e,t,n,i,o,u,a,d;return e=new Dd({}),n=new zd({}),o=new Rd({}),a=new zh({props:{interactive:!1}}),{c(){ce(e.$$.fragment),t=ie(),ce(n.$$.fragment),i=ie(),ce(o.$$.fragment),u=ie(),ce(a.$$.fragment)},m(p,g){le(e,p,g),Z(p,t,g),le(n,p,g),Z(p,i,g),le(o,p,g),Z(p,u,g),le(a,p,g),d=!0},p:ot,i(p){d||(N(e.$$.fragment,p),N(n.$$.fragment,p),N(o.$$.fragment,p),N(a.$$.fragment,p),d=!0)},o(p){V(e.$$.fragment,p),V(n.$$.fragment,p),V(o.$$.fragment,p),V(a.$$.fragment,p),d=!1},d(p){p&&(q(t),q(i),q(u)),ue(e,p),ue(n,p),ue(o,p),ue(a,p)}}}function SA(r){let e,t;const n=[dn("compare-route"),{paint:{"line-width":10,"line-color":$o(["get","kind"],{before:"red",after:"blue"},"red")}}];let i={};for(let o=0;o<n.length;o+=1)i=Mt(i,n[o]);return e=new sr({props:i}),{c(){ce(e.$$.fragment)},m(o,u){le(e,o,u),t=!0},p(o,u){const a={};e.$set(a)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){ue(e,o)}}}function TA(r){let e;return{c(){e=Ee("A")},m(t,n){Z(t,e,n)},d(t){t&&q(e)}}}function CA(r){let e;return{c(){e=Ee("B")},m(t,n){Z(t,e,n)},d(t){t&&q(e)}}}function MA(r){let e,t,n,i,o,u,a,d,p,g,y,x,C=r[0]=="neighbourhood"&&nb(r);n=new Oa({props:{interactive:!1}}),o=new mr({props:{data:r[1],$$slots:{default:[SA]},$$scope:{ctx:r}}});function M(P){r[9](P)}let F={draggable:!0,$$slots:{default:[TA]},$$scope:{ctx:r}};r[4]!==void 0&&(F.lngLat=r[4]),a=new bl({props:F}),un.push(()=>Pn(a,"lngLat",M));function z(P){r[10](P)}let E={draggable:!0,$$slots:{default:[CA]},$$scope:{ctx:r}};return r[3]!==void 0&&(E.lngLat=r[3]),g=new bl({props:E}),un.push(()=>Pn(g,"lngLat",z)),{c(){e=j("div"),C&&C.c(),t=ie(),ce(n.$$.fragment),i=ie(),ce(o.$$.fragment),u=ie(),ce(a.$$.fragment),p=ie(),ce(g.$$.fragment),ae(e,"slot","map")},m(P,$){Z(P,e,$),C&&C.m(e,null),D(e,t),le(n,e,null),D(e,i),le(o,e,null),D(e,u),le(a,e,null),D(e,p),le(g,e,null),x=!0},p(P,$){P[0]=="neighbourhood"?C?$&1&&N(C,1):(C=nb(P),C.c(),N(C,1),C.m(e,t)):C&&(Kt(),V(C,1,1,()=>{C=null}),Xt());const U={};$&2&&(U.data=P[1]),$&4096&&(U.$$scope={dirty:$,ctx:P}),o.$set(U);const K={};$&4096&&(K.$$scope={dirty:$,ctx:P}),!d&&$&16&&(d=!0,K.lngLat=P[4],An(()=>d=!1)),a.$set(K);const ee={};$&4096&&(ee.$$scope={dirty:$,ctx:P}),!y&&$&8&&(y=!0,ee.lngLat=P[3],An(()=>y=!1)),g.$set(ee)},i(P){x||(N(C),N(n.$$.fragment,P),N(o.$$.fragment,P),N(a.$$.fragment,P),N(g.$$.fragment,P),x=!0)},o(P){V(C),V(n.$$.fragment,P),V(o.$$.fragment,P),V(a.$$.fragment,P),V(g.$$.fragment,P),x=!1},d(P){P&&q(e),C&&C.d(),ue(n),ue(o),ue(a),ue(g)}}}function LA(r){let e,t;return e=new wo({props:{$$slots:{map:[MA],sidebar:[xA],top:[_A]},$$scope:{ctx:r}}}),{c(){ce(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p(n,[i]){const o={};i&4351&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){ue(e,n)}}}function EA(r,e,t){let n,i,o,u,a,d,p,g;st(r,Y_,F=>t(2,u=F)),st(r,uh,F=>t(3,a=F)),st(r,lh,F=>t(4,d=F)),st(r,Cr,F=>t(8,p=F)),st(r,Kn,F=>t(7,g=F));let{prevMode:y}=e;Es(()=>{setTimeout(()=>{dm(lh),dm(uh)},10)});function x(F){d=F,lh.set(d)}function C(F){a=F,uh.set(a)}function M(){u=gl(this.value),Y_.set(u)}return r.$$set=F=>{"prevMode"in F&&t(0,y=F.prevMode)},r.$$.update=()=>{r.$$.dirty&284&&t(1,n=p.compareRoute(d,a,u)),r.$$.dirty&2&&t(6,i=n.features.find(F=>F.properties.kind=="before")),r.$$.dirty&2&&t(5,o=n.features.find(F=>F.properties.kind=="after"))},[y,n,u,a,d,o,i,g,p,x,C,M]}class IA extends St{constructor(e){super(),kt(this,e,EA,LA,_t,{prevMode:0})}}function AA(r){let e,t,n,i,o,u,a,d,p,g,y,x,C,M=gr(r[2].mode)+"",F,z;return o=new jn({props:{mode:{mode:"title"}}}),d=new jn({props:{mode:{mode:"pick-neighbourhood"}}}),y=new jn({props:{mode:{mode:"neighbourhood"}}}),{c(){e=j("div"),t=j("nav"),n=j("ul"),i=j("li"),ce(o.$$.fragment),u=ie(),a=j("li"),ce(d.$$.fragment),p=ie(),g=j("li"),ce(y.$$.fragment),x=ie(),C=j("li"),F=Ee(M),ae(t,"aria-label","breadcrumb"),ae(e,"slot","top")},m(E,P){Z(E,e,P),D(e,t),D(t,n),D(n,i),le(o,i,null),D(n,u),D(n,a),le(d,a,null),D(n,p),D(n,g),le(y,g,null),D(n,x),D(n,C),D(C,F),z=!0},p(E,P){(!z||P&4)&&M!==(M=gr(E[2].mode)+"")&&gt(F,M)},i(E){z||(N(o.$$.fragment,E),N(d.$$.fragment,E),N(y.$$.fragment,E),z=!0)},o(E){V(o.$$.fragment,E),V(d.$$.fragment,E),V(y.$$.fragment,E),z=!1},d(E){E&&q(e),ue(o),ue(d),ue(y)}}}function PA(r){let e,t,n,i,o,u,a,d,p,g,y,x,C,M,F,z,E,P;t=new As({props:{mode:{mode:"neighbourhood"}}});function $(ee){r[8](ee)}function U(ee){r[9](ee)}let K={map:or(r[3])};return r[0]!==void 0&&(K.waypoints=r[0]),r[1]!==void 0&&(K.drawnShapeOut=r[1]),u=new Yv({props:K}),un.push(()=>Pn(u,"waypoints",$)),un.push(()=>Pn(u,"drawnShapeOut",U)),{c(){e=j("div"),ce(t.$$.fragment),n=ie(),i=j("h1"),i.textContent="Adjust boundary",o=ie(),ce(u.$$.fragment),p=ie(),g=j("div"),y=j("button"),x=Ee("Finish"),M=ie(),F=j("button"),F.textContent="Cancel",y.disabled=C=r[0].length<3,ae(F,"class","secondary"),Ye(g,"display","flex"),Ye(g,"gap","16px"),ae(e,"slot","sidebar")},m(ee,W){Z(ee,e,W),le(t,e,null),D(e,n),D(e,i),D(e,o),le(u,e,null),D(e,p),D(e,g),D(g,y),D(y,x),D(g,M),D(g,F),z=!0,E||(P=[Tt(y,"click",r[4]),Tt(F,"click",r[5])],E=!0)},p(ee,W){const J={};W&8&&(J.map=or(ee[3])),!a&&W&1&&(a=!0,J.waypoints=ee[0],An(()=>a=!1)),!d&&W&2&&(d=!0,J.drawnShapeOut=ee[1],An(()=>d=!1)),u.$set(J),(!z||W&1&&C!==(C=ee[0].length<3))&&(y.disabled=C)},i(ee){z||(N(t.$$.fragment,ee),N(u.$$.fragment,ee),z=!0)},o(ee){V(t.$$.fragment,ee),V(u.$$.fragment,ee),z=!1},d(ee){ee&&q(e),ue(t),ue(u),E=!1,ur(P)}}}function zA(r){let e,t;return e=new wo({props:{$$slots:{sidebar:[PA],top:[AA]},$$scope:{ctx:r}}}),{c(){ce(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p(n,[i]){const o={};i&2063&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){ue(e,n)}}}function DA(r,e,t){let n,i,o;st(r,Kn,M=>t(2,n=M)),st(r,Cr,M=>t(10,i=M)),st(r,rs,M=>t(3,o=M));let{name:u}=e,{existing:a}=e,d=[],p;a.properties.waypoints?d=a.properties.waypoints.map(M=>({point:[M.lon,M.lat],snapped:M.snapped})):d=a.geometry.coordinates[1].slice(1).map(M=>({point:M,snapped:!1}));function g(){if(p)try{i.setNeighbourhoodBoundary(u,p),yh(),i.setCurrentNeighbourhood(u),an(Kn,n={mode:"neighbourhood"},n)}catch(M){window.alert(`Sorry, this boundary is invalid: ${M}`),y()}}function y(){an(Kn,n={mode:"neighbourhood"},n)}function x(M){d=M,t(0,d)}function C(M){p=M,t(1,p)}return r.$$set=M=>{"name"in M&&t(6,u=M.name),"existing"in M&&t(7,a=M.existing)},[d,p,n,o,g,y,u,a,x,C]}class RA extends St{constructor(e){super(),kt(this,e,DA,zA,_t,{name:6,existing:7})}}const FA=["==",["geometry-type"],"Polygon"],BA=["==",["geometry-type"],"LineString"],$A=["==",["geometry-type"],"Point"];function sw(){return{type:"FeatureCollection",features:[]}}function tm(r){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:aw(r)}}}function aw(r){return[Math.round(r[0]*1e7)/1e7,Math.round(r[1]*1e7)/1e7]}const lw=Ln(sw()),uw=Ln(0),OA=100;class NA{constructor(e){Yn(this,"map");Yn(this,"active");Yn(this,"eventListenersSuccess");Yn(this,"eventListenersUpdated");Yn(this,"eventListenersFailure");Yn(this,"points");Yn(this,"cursor");Yn(this,"hover");Yn(this,"dragFrom");Yn(this,"previousStates");Yn(this,"onMouseMove",e=>{if(this.active&&!this.dragFrom)this.recalculateHovering(e);else if(this.active&&this.dragFrom){if(this.hover=="polygon"){let t=this.dragFrom[0]-e.lngLat.lng,n=this.dragFrom[1]-e.lngLat.lat;for(let i of this.points)i[0]-=t,i[1]-=n}else this.points[this.hover]=e.lngLat.toArray();this.dragFrom=e.lngLat.toArray(),this.redraw()}});Yn(this,"onClick",e=>{if(this.beforeUpdate(),this.active&&this.cursor){let t=[];if(rb(this.points).forEach((n,i)=>{t.push([i+1,wk(n,this.cursor).properties.dist])}),t.sort((n,i)=>n[1]-i[1]),t.length>0){let n=t[0][0];this.points.splice(n,0,this.cursor.geometry.coordinates),this.hover=n}else this.points.push(this.cursor.geometry.coordinates),this.hover=this.points.length-1;this.redraw(),this.pointsUpdated()}else this.active&&typeof this.hover=="number"&&(this.points.splice(this.hover,1),this.hover=null,this.redraw(),this.pointsUpdated(),this.recalculateHovering(e))});Yn(this,"onDoubleClick",e=>{this.active&&(e.preventDefault(),this.cursor=tm(e.lngLat.toArray()),this.onClick(e),this.finish())});Yn(this,"onMouseDown",e=>{this.active&&!this.dragFrom&&this.hover!=null&&(e.preventDefault(),this.cursor=null,this.dragFrom=e.lngLat.toArray(),this.beforeUpdate(),this.redraw())});Yn(this,"onMouseUp",()=>{this.active&&this.dragFrom&&(this.dragFrom=null,this.redraw(),this.pointsUpdated())});Yn(this,"onKeypress",e=>{this.active&&(e.key=="Enter"?(e.stopPropagation(),this.finish()):e.key=="z"&&e.ctrlKey&&this.undo())});Yn(this,"onKeyDown",e=>{this.active&&e.key=="Escape"&&(e.stopPropagation(),this.cancel())});this.map=e,this.active=!1,this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[],this.points=[],this.cursor=null,this.hover=null,this.dragFrom=null,this.previousStates=[],this.map.on("mousemove",this.onMouseMove),this.map.on("click",this.onClick),this.map.on("dblclick",this.onDoubleClick),this.map.on("mousedown",this.onMouseDown),this.map.on("mouseup",this.onMouseUp),document.addEventListener("keypress",this.onKeypress),document.addEventListener("keydown",this.onKeyDown)}tearDown(){this.map.off("mousemove",this.onMouseMove),this.map.off("click",this.onClick),this.map.off("dblclick",this.onDoubleClick),this.map.off("mousedown",this.onMouseDown),this.map.off("mouseup",this.onMouseUp),document.removeEventListener("keypress",this.onKeypress),document.removeEventListener("keydown",this.onKeyDown)}finish(){let e=this.polygonFeature();if(e)for(let t of this.eventListenersSuccess)t(e);else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){for(let e of this.eventListenersFailure)e();this.stop()}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerUpdated(e){this.eventListenersUpdated.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}clearEventListeners(){this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[]}startNew(){this.active=!0,this.map.doubleClickZoom.disable()}editExisting(e){this.active=!0,this.map.doubleClickZoom.disable(),this.points=JSON.parse(JSON.stringify(e.geometry.coordinates[0])),this.points.pop(),this.redraw()}stop(){this.map.doubleClickZoom.enable(),this.points=[],this.cursor=null,this.active=!1,this.hover=null,this.dragFrom=null,this.previousStates=[],this.redraw(),this.map.getCanvas().style.cursor="inherit"}undo(){this.dragFrom!=null||this.previousStates.length==0||(this.points=this.previousStates.pop(),this.hover=null,this.redraw())}redraw(){let e=sw();this.points.forEach((i,o)=>{let u=tm(i);u.properties.hover=this.hover==o,u.properties.idx=o,e.features.push(u)}),e.features=e.features.concat(rb(this.points));let t=this.polygonFeature();t&&(t.properties.hover=this.hover=="polygon",e.features.push(t)),lw.set(e);let n="crosshair";this.hover!=null&&(n=this.dragFrom?"grabbing":"pointer"),this.map.getCanvas().style.cursor=n,uw.set(this.previousStates.length)}pointsUpdated(){let e=this.polygonFeature();if(e)for(let t of this.eventListenersUpdated)t(e)}recalculateHovering(e){this.cursor=null,this.hover=null;for(let t of this.map.queryRenderedFeatures(e.point,{layers:["edit-polygon-fill","edit-polygon-vertices"]}))if(t.geometry.type=="Polygon"){this.hover="polygon";break}else if(t.geometry.type=="Point"&&Object.hasOwn(t.properties,"idx")){this.hover=t.properties.idx;break}this.hover==null&&(this.cursor=tm(e.lngLat.toArray())),this.redraw()}polygonFeature(){if(this.points.length<3)return null;let e=this.points.map(aw),t=[JSON.parse(JSON.stringify(e))];return t[0].push(JSON.parse(JSON.stringify(t[0][0]))),{type:"Feature",geometry:{type:"Polygon",coordinates:t},properties:{}}}beforeUpdate(){this.previousStates.push(JSON.parse(JSON.stringify(this.points))),this.previousStates.length>OA&&this.previousStates.shift()}}function rb(r){let e=[];for(let t=0;t<r.length-1;t++)e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[t],r[t+1]]},properties:{}});return r.length>=3&&e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[r.length-1],r[0]]},properties:{}}),e}function jA(r){let e,t,n;return{c(){e=Ee("Undo ("),t=Ee(r[1]),n=Ee(")")},m(i,o){Z(i,e,o),Z(i,t,o),Z(i,n,o)},p(i,o){o&2&&gt(t,i[1])},d(i){i&&(q(e),q(t),q(n))}}}function UA(r){let e;return{c(){e=Ee("Undo")},m(t,n){Z(t,e,n)},p:ot,d(t){t&&q(e)}}}function VA(r){let e,t,n,i,o,u,a,d,p,g,y;function x(F,z){return F[1]==0?UA:jA}let C=x(r),M=C(r);return{c(){e=j("div"),t=j("button"),t.textContent="Finish",n=ie(),i=j("button"),i.textContent="Cancel",o=ie(),u=j("button"),M.c(),d=ie(),p=j("ul"),p.innerHTML=`<li><b>Click</b>
    the map to add a vertex</li> <li><b>Click</b>
    a vertex to delete it</li> <li><b>Drag</b>
    a vertex or the polygon to move it</li> <li>Press <b>Control+Z</b>
    to undo your last change</li> <li>Press <b>Enter</b>
    or
    <b>double click</b>
    to finish</li> <li>Press <b>Escape</b>
    to cancel</li>`,u.disabled=a=r[1]==0,Ye(e,"display","flex"),Ye(e,"justify-content","space-between")},m(F,z){Z(F,e,z),D(e,t),D(e,n),D(e,i),D(e,o),D(e,u),M.m(u,null),Z(F,d,z),Z(F,p,z),g||(y=[Tt(t,"click",r[2]),Tt(i,"click",r[3]),Tt(u,"click",r[4])],g=!0)},p(F,[z]){C===(C=x(F))&&M?M.p(F,z):(M.d(1),M=C(F),M&&(M.c(),M.m(u,null))),z&2&&a!==(a=F[1]==0)&&(u.disabled=a)},i:ot,o:ot,d(F){F&&(q(e),q(d),q(p)),M.d(),g=!1,ur(y)}}}function qA(r,e,t){let n;st(r,uw,d=>t(1,n=d));let{polygonTool:i}=e;const o=()=>i.finish(),u=()=>i.cancel(),a=()=>i.undo();return r.$$set=d=>{"polygonTool"in d&&t(0,i=d.polygonTool)},[i,n,o,u,a]}class ZA extends St{constructor(e){super(),kt(this,e,qA,VA,_t,{polygonTool:0})}}let GA=Date.now();function Rh(r){return`${r}-${GA++}`}const cw=Symbol.for("svelte-maplibre");function HA(){return Th(cw)}function ib(r){return{subscribe:r.subscribe}}function hw({key:r,setPopupTarget:e=!1,setCluster:t=!1,setMouseEvent:n=!1}){let i=HA(),o=Ln(null),u=ib(o),a={...i,[r]:ib(o)};if(e&&(a.popupTarget=u),n){let d=Ln(null);a.layerEvent=d,i.layerEvent=d}return t&&(a.cluster=Ln()),wd(cw,a),{...i,self:o}}function WA(){return hw({key:"source",setCluster:!0})}function KA(r=!0){return hw({key:"layer",setPopupTarget:r,setMouseEvent:r})}function ob(r){let e;return t=>{if(t)for(let n in t){let i=e==null?void 0:e[n],o=t[n];i!==o&&r(n,o,i)}else if(e)for(let n in e)r(n,void 0,e[n]);e=t}}function XA(r,...e){let t=[r];for(let n of e)if(n)Array.isArray(n)&&n[0]===r?t.push(...n.slice(1)):t.push(n);else continue;if(t.length!==1)return t.length===2?t[1]:t}function JA(r){return r===!0?["has","point_count"]:r===!1?["!",["has","point_count"]]:void 0}function sb(r){let e=r[0],t,n,i=ab(r);return{c(){i.c(),t=Xn()},m(o,u){i.m(o,u),Z(o,t,u),n=!0},p(o,u){u[0]&1&&_t(e,e=o[0])?(Kt(),V(i,1,1,ot),Xt(),i=ab(o),i.c(),N(i,1),i.m(t.parentNode,t)):i.p(o,u)},i(o){n||(N(i),n=!0)},o(o){V(i),n=!1},d(o){o&&q(t),i.d(o)}}}function ab(r){let e;const t=r[36].default,n=mn(t,r,r[35],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o[1]&16)&&_n(n,t,i,i[35],e?gn(t,i[35],o,null):yn(i[35]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function YA(r){let e,t,n=r[0]&&sb(r);return{c(){n&&n.c(),e=Xn()},m(i,o){n&&n.m(i,o),Z(i,e,o),t=!0},p(i,o){i[0]?n?(n.p(i,o),o[0]&1&&N(n,1)):(n=sb(i),n.c(),N(n,1),n.m(e.parentNode,e)):n&&(Kt(),V(n,1,1,()=>{n=null}),Xt())},i(i){t||(N(n),t=!0)},o(i){V(n),t=!1},d(i){i&&q(e),n&&n.d(i)}}}function QA(r,e,t){let n,i,o,u,a,d,p,g,y,x,C,M,{$$slots:F={},$$scope:z}=e,{id:E=Rh("layer")}=e,{source:P=void 0}=e,{sourceLayer:$=void 0}=e,{beforeId:U=void 0}=e,{beforeLayerType:K=void 0}=e,{type:ee}=e,{paint:W=void 0}=e,{layout:J=void 0}=e,{filter:he=void 0}=e,{applyToClusters:Ae=void 0}=e,{minzoom:ne=void 0}=e,{maxzoom:fe=void 0}=e,{manageHoverState:Ce=!1}=e,{hovered:_e=null}=e,{interactive:Ze=!0}=e,{hoverCursor:Oe=void 0}=e,{eventsIfTopMost:je=!1}=e;const De=Is(),{map:At,source:ut,self:ht,minzoom:wt,maxzoom:pt,eventTopMost:Qe,layerInfo:Ft}=KA();st(r,At,Ge=>t(31,y=Ge)),st(r,ut,Ge=>t(32,x=Ge)),st(r,ht,Ge=>t(0,g=Ge)),st(r,wt,Ge=>t(34,M=Ge)),st(r,pt,Ge=>t(33,C=Ge)),ti(()=>{g&&y&&(Ft.delete(g),y==null||y.removeLayer(g))});let bt;function Bt(Ge){var ye,kn;if(!Ze||!g||!y||je&&Qe(Ge)!==g)return;let qe=Ge.features??[],Je=(kn=(ye=qe[0])==null?void 0:ye.properties)==null?void 0:kn.cluster_id,Et={event:Ge,map:y,clusterId:Je,layer:g,source:a,features:qe};De(Ge.type,Et)}function Pt(Ge){var ye,kn;if(!Ze||!g||!y||je&&Qe(Ge)!==g)return;Oe&&(y.getCanvas().style.cursor=Oe);let qe=Ge.features??[];t(6,_e=qe[0]??null);let Je=(kn=(ye=qe[0])==null?void 0:ye.properties)==null?void 0:kn.cluster_id;De("mouseenter",{event:Ge,map:y,clusterId:Je,layer:g,source:a,features:qe})}function Qt(Ge){var ye,kn,Ue;if(!Ze||!y)return;if(je&&Qe(Ge)!==g){t(6,_e=null),Ce&&bt!==void 0&&(y==null||y.setFeatureState({source:a,sourceLayer:$,id:bt},{hover:!1}),bt=void 0);return}y.getCanvas().style.cursor=Oe;let qe=Ge.features??[],Je=(kn=(ye=qe[0])==null?void 0:ye.properties)==null?void 0:kn.cluster_id,Et=(Ue=qe[0])==null?void 0:Ue.id;Et!==bt&&(Ce&&(bt!==void 0&&(y==null||y.setFeatureState({source:a,id:bt,sourceLayer:$},{hover:!1})),y==null||y.setFeatureState({source:a,id:Et,sourceLayer:$},{hover:!0})),bt=Et,t(6,_e=qe[0]??null)),De("mousemove",{event:Ge,map:y,clusterId:Je,layer:g,source:a,features:qe})}function vn(Ge){if(!(!Ze||!g||!y)){if(Oe&&(y.getCanvas().style.cursor=""),t(6,_e=null),Ce&&bt!==void 0){const qe={source:a,id:bt,sourceLayer:$};y==null||y.setFeatureState(qe,{hover:!1}),bt=void 0}De("mouseleave",{map:y,layer:g,source:a})}}let qt=!0;function rn(Ge){y&&(y.off("click",Ge,Bt),y.off("dblclick",Ge,Bt),y.off("contextmenu",Ge,Bt),y.off("mouseenter",Ge,Pt),y.off("mousemove",Ge,Qt),y.off("mouseleave",Ge,vn))}return ti(()=>{y&&g&&rn(g)}),r.$$set=Ge=>{"id"in Ge&&t(7,E=Ge.id),"source"in Ge&&t(8,P=Ge.source),"sourceLayer"in Ge&&t(9,$=Ge.sourceLayer),"beforeId"in Ge&&t(10,U=Ge.beforeId),"beforeLayerType"in Ge&&t(11,K=Ge.beforeLayerType),"type"in Ge&&t(12,ee=Ge.type),"paint"in Ge&&t(13,W=Ge.paint),"layout"in Ge&&t(14,J=Ge.layout),"filter"in Ge&&t(15,he=Ge.filter),"applyToClusters"in Ge&&t(16,Ae=Ge.applyToClusters),"minzoom"in Ge&&t(17,ne=Ge.minzoom),"maxzoom"in Ge&&t(18,fe=Ge.maxzoom),"manageHoverState"in Ge&&t(19,Ce=Ge.manageHoverState),"hovered"in Ge&&t(6,_e=Ge.hovered),"interactive"in Ge&&t(20,Ze=Ge.interactive),"hoverCursor"in Ge&&t(21,Oe=Ge.hoverCursor),"eventsIfTopMost"in Ge&&t(22,je=Ge.eventsIfTopMost),"$$scope"in Ge&&t(35,z=Ge.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&65536&&t(30,n=JA(Ae)),r.$$.dirty[0]&1073774592&&t(24,i=XA("all",n,he)),r.$$.dirty[0]&131072|r.$$.dirty[1]&8&&t(26,o=ne??M),r.$$.dirty[0]&262144|r.$$.dirty[1]&4&&t(25,u=fe??C),r.$$.dirty[0]&256|r.$$.dirty[1]&2&&t(29,a=P||x),r.$$.dirty[0]&654343809|r.$$.dirty[1]&1&&y&&g!==E&&a){g&&(rn(g),Ft.delete(g));let Ge=U;if(!U&&K){let qe=y.getStyle().layers,Je=typeof K=="function"?K:ye=>ye.type===K,Et=qe==null?void 0:qe.find(Je);Et&&(Ge=Et.id)}an(ht,g=E,g),y.addLayer(La({id:g,type:ee,source:a,"source-layer":$,filter:i,paint:W,layout:J,minzoom:o,maxzoom:u}),Ge),t(23,qt=!0),y.on("click",g,Bt),y.on("dblclick",g,Bt),y.on("contextmenu",g,Bt),y.on("mouseenter",g,Pt),y.on("mousemove",g,Qt),y.on("mouseleave",g,vn)}r.$$.dirty[0]&1048577&&g&&Ft.set(g,{interactive:Ze}),r.$$.dirty[0]&1|r.$$.dirty[1]&1&&t(28,d=g?ob((Ge,qe)=>y==null?void 0:y.setPaintProperty(g,Ge,qe)):void 0),r.$$.dirty[0]&1|r.$$.dirty[1]&1&&t(27,p=g?ob((Ge,qe)=>y==null?void 0:y.setLayoutProperty(g,Ge,qe)):void 0),r.$$.dirty[0]&268443648&&(d==null||d(W)),r.$$.dirty[0]&134234112&&(p==null||p(J)),r.$$.dirty[0]&100663297|r.$$.dirty[1]&1&&g&&(y==null||y.setLayerZoomRange(g,o,u)),r.$$.dirty[0]&25165825|r.$$.dirty[1]&1&&g&&(qt?t(23,qt=!1):y==null||y.setFilter(g,i))},[g,At,ut,ht,wt,pt,_e,E,P,$,U,K,ee,W,J,he,Ae,ne,fe,Ce,Ze,Oe,je,qt,i,u,o,p,d,a,n,y,x,C,M,z,F]}class cg extends St{constructor(e){super(),kt(this,e,QA,YA,_t,{id:7,source:8,sourceLayer:9,beforeId:10,beforeLayerType:11,type:12,paint:13,layout:14,filter:15,applyToClusters:16,minzoom:17,maxzoom:18,manageHoverState:19,hovered:6,interactive:20,hoverCursor:21,eventsIfTopMost:22},null,[-1,-1])}}function eP(r){let e;const t=r[16].default,n=mn(t,r,r[24],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&16777216)&&_n(n,t,i,i[24],e?gn(t,i[24],o,null):yn(i[24]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function tP(r){let e,t,n;function i(u){r[17](u)}let o={id:r[1],type:"circle",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],applyToClusters:r[9],minzoom:r[10],maxzoom:r[11],hoverCursor:r[12],manageHoverState:r[13],eventsIfTopMost:r[14],interactive:r[15],$$slots:{default:[eP]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.hovered=r[0]),e=new cg({props:o}),un.push(()=>Pn(e,"hovered",i)),e.$on("click",r[18]),e.$on("dblclick",r[19]),e.$on("contextmenu",r[20]),e.$on("mouseenter",r[21]),e.$on("mousemove",r[22]),e.$on("mouseleave",r[23]),{c(){ce(e.$$.fragment)},m(u,a){le(e,u,a),n=!0},p(u,[a]){const d={};a&2&&(d.id=u[1]),a&4&&(d.source=u[2]),a&8&&(d.sourceLayer=u[3]),a&16&&(d.beforeId=u[4]),a&32&&(d.beforeLayerType=u[5]),a&64&&(d.paint=u[6]),a&128&&(d.layout=u[7]),a&256&&(d.filter=u[8]),a&512&&(d.applyToClusters=u[9]),a&1024&&(d.minzoom=u[10]),a&2048&&(d.maxzoom=u[11]),a&4096&&(d.hoverCursor=u[12]),a&8192&&(d.manageHoverState=u[13]),a&16384&&(d.eventsIfTopMost=u[14]),a&32768&&(d.interactive=u[15]),a&16777216&&(d.$$scope={dirty:a,ctx:u}),!t&&a&1&&(t=!0,d.hovered=u[0],An(()=>t=!1)),e.$set(d)},i(u){n||(N(e.$$.fragment,u),n=!0)},o(u){V(e.$$.fragment,u),n=!1},d(u){ue(e,u)}}}function nP(r,e,t){let{$$slots:n={},$$scope:i}=e,{id:o=Rh("circle")}=e,{source:u=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:d=void 0}=e,{beforeLayerType:p=void 0}=e,{paint:g}=e,{layout:y=void 0}=e,{filter:x=void 0}=e,{applyToClusters:C=void 0}=e,{minzoom:M=void 0}=e,{maxzoom:F=void 0}=e,{hoverCursor:z=void 0}=e,{manageHoverState:E=!1}=e,{hovered:P=null}=e,{eventsIfTopMost:$=!1}=e,{interactive:U=!0}=e;function K(fe){P=fe,t(0,P)}function ee(fe){In.call(this,r,fe)}function W(fe){In.call(this,r,fe)}function J(fe){In.call(this,r,fe)}function he(fe){In.call(this,r,fe)}function Ae(fe){In.call(this,r,fe)}function ne(fe){In.call(this,r,fe)}return r.$$set=fe=>{"id"in fe&&t(1,o=fe.id),"source"in fe&&t(2,u=fe.source),"sourceLayer"in fe&&t(3,a=fe.sourceLayer),"beforeId"in fe&&t(4,d=fe.beforeId),"beforeLayerType"in fe&&t(5,p=fe.beforeLayerType),"paint"in fe&&t(6,g=fe.paint),"layout"in fe&&t(7,y=fe.layout),"filter"in fe&&t(8,x=fe.filter),"applyToClusters"in fe&&t(9,C=fe.applyToClusters),"minzoom"in fe&&t(10,M=fe.minzoom),"maxzoom"in fe&&t(11,F=fe.maxzoom),"hoverCursor"in fe&&t(12,z=fe.hoverCursor),"manageHoverState"in fe&&t(13,E=fe.manageHoverState),"hovered"in fe&&t(0,P=fe.hovered),"eventsIfTopMost"in fe&&t(14,$=fe.eventsIfTopMost),"interactive"in fe&&t(15,U=fe.interactive),"$$scope"in fe&&t(24,i=fe.$$scope)},[P,o,u,a,d,p,g,y,x,C,M,F,z,E,$,U,n,K,ee,W,J,he,Ae,ne,i]}class rP extends St{constructor(e){super(),kt(this,e,nP,tP,_t,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}function iP(r){let e;const t=r[15].default,n=mn(t,r,r[23],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8388608)&&_n(n,t,i,i[23],e?gn(t,i[23],o,null):yn(i[23]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function oP(r){let e,t,n;function i(u){r[16](u)}let o={id:r[1],type:"fill",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],minzoom:r[9],maxzoom:r[10],hoverCursor:r[11],manageHoverState:r[12],eventsIfTopMost:r[13],interactive:r[14],$$slots:{default:[iP]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.hovered=r[0]),e=new cg({props:o}),un.push(()=>Pn(e,"hovered",i)),e.$on("click",r[17]),e.$on("dblclick",r[18]),e.$on("contextmenu",r[19]),e.$on("mouseenter",r[20]),e.$on("mousemove",r[21]),e.$on("mouseleave",r[22]),{c(){ce(e.$$.fragment)},m(u,a){le(e,u,a),n=!0},p(u,[a]){const d={};a&2&&(d.id=u[1]),a&4&&(d.source=u[2]),a&8&&(d.sourceLayer=u[3]),a&16&&(d.beforeId=u[4]),a&32&&(d.beforeLayerType=u[5]),a&64&&(d.paint=u[6]),a&128&&(d.layout=u[7]),a&256&&(d.filter=u[8]),a&512&&(d.minzoom=u[9]),a&1024&&(d.maxzoom=u[10]),a&2048&&(d.hoverCursor=u[11]),a&4096&&(d.manageHoverState=u[12]),a&8192&&(d.eventsIfTopMost=u[13]),a&16384&&(d.interactive=u[14]),a&8388608&&(d.$$scope={dirty:a,ctx:u}),!t&&a&1&&(t=!0,d.hovered=u[0],An(()=>t=!1)),e.$set(d)},i(u){n||(N(e.$$.fragment,u),n=!0)},o(u){V(e.$$.fragment,u),n=!1},d(u){ue(e,u)}}}function sP(r,e,t){let{$$slots:n={},$$scope:i}=e,{id:o=Rh("fill")}=e,{source:u=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:d=void 0}=e,{beforeLayerType:p=void 0}=e,{paint:g}=e,{layout:y=void 0}=e,{filter:x=void 0}=e,{minzoom:C=void 0}=e,{maxzoom:M=void 0}=e,{hoverCursor:F=void 0}=e,{manageHoverState:z=!1}=e,{hovered:E=null}=e,{eventsIfTopMost:P=!1}=e,{interactive:$=!0}=e;function U(ne){E=ne,t(0,E)}function K(ne){In.call(this,r,ne)}function ee(ne){In.call(this,r,ne)}function W(ne){In.call(this,r,ne)}function J(ne){In.call(this,r,ne)}function he(ne){In.call(this,r,ne)}function Ae(ne){In.call(this,r,ne)}return r.$$set=ne=>{"id"in ne&&t(1,o=ne.id),"source"in ne&&t(2,u=ne.source),"sourceLayer"in ne&&t(3,a=ne.sourceLayer),"beforeId"in ne&&t(4,d=ne.beforeId),"beforeLayerType"in ne&&t(5,p=ne.beforeLayerType),"paint"in ne&&t(6,g=ne.paint),"layout"in ne&&t(7,y=ne.layout),"filter"in ne&&t(8,x=ne.filter),"minzoom"in ne&&t(9,C=ne.minzoom),"maxzoom"in ne&&t(10,M=ne.maxzoom),"hoverCursor"in ne&&t(11,F=ne.hoverCursor),"manageHoverState"in ne&&t(12,z=ne.manageHoverState),"hovered"in ne&&t(0,E=ne.hovered),"eventsIfTopMost"in ne&&t(13,P=ne.eventsIfTopMost),"interactive"in ne&&t(14,$=ne.interactive),"$$scope"in ne&&t(23,i=ne.$$scope)},[E,o,u,a,d,p,g,y,x,C,M,F,z,P,$,n,U,K,ee,W,J,he,Ae,i]}class aP extends St{constructor(e){super(),kt(this,e,sP,oP,_t,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}function lP(r,e,t,n,i){let o=!1;r.getSource(e)&&(o=!0,r.removeSource(e));const u=()=>{n(e)&&(r.addSource(e,t),i())};if(o){const a=()=>{e&&(r.getSource(e)?setTimeout(a,1):u())};a()}else u()}function uP(r,e,t){Ab().then(()=>{let n=Ci(r);if(!n)return;n.getSource(e)===t&&n.removeSource(e)})}function lb(r){let e=r[0],t,n,i=ub(r);return{c(){i.c(),t=Xn()},m(o,u){i.m(o,u),Z(o,t,u),n=!0},p(o,u){u&1&&_t(e,e=o[0])?(Kt(),V(i,1,1,ot),Xt(),i=ub(o),i.c(),N(i,1),i.m(t.parentNode,t)):i.p(o,u)},i(o){n||(N(i),n=!0)},o(o){V(i),n=!1},d(o){o&&q(t),i.d(o)}}}function ub(r){let e;const t=r[15].default,n=mn(t,r,r[14],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&16384)&&_n(n,t,i,i[14],e?gn(t,i[14],o,null):yn(i[14]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function cP(r){let e,t,n=r[0]&&lb(r);return{c(){n&&n.c(),e=Xn()},m(i,o){n&&n.m(i,o),Z(i,e,o),t=!0},p(i,[o]){i[0]?n?(n.p(i,o),o&1&&N(n,1)):(n=lb(i),n.c(),N(n,1),n.m(e.parentNode,e)):n&&(Kt(),V(n,1,1,()=>{n=null}),Xt())},i(i){t||(N(n),t=!0)},o(i){V(n),t=!1},d(i){i&&q(e),n&&n.d(i)}}}function hP(r,e,t){let n,i,o,{$$slots:u={},$$scope:a}=e,{id:d=Rh("geojson")}=e,{data:p}=e,{generateId:g=!1}=e,{promoteId:y=void 0}=e,{filter:x=void 0}=e,{lineMetrics:C=void 0}=e,{cluster:M=void 0}=e;const{map:F,cluster:z,self:E}=WA();st(r,F,U=>t(13,i=U)),st(r,z,U=>t(16,o=U)),st(r,E,U=>t(0,n=U));let P,$=!0;return ti(()=>{n&&P&&i&&(uP(F,n,P),an(E,n=null,n),t(11,P=void 0))}),r.$$set=U=>{"id"in U&&t(4,d=U.id),"data"in U&&t(5,p=U.data),"generateId"in U&&t(6,g=U.generateId),"promoteId"in U&&t(7,y=U.promoteId),"filter"in U&&t(8,x=U.filter),"lineMetrics"in U&&t(9,C=U.lineMetrics),"cluster"in U&&t(10,M=U.cluster),"$$scope"in U&&t(14,a=U.$$scope)},r.$$.update=()=>{r.$$.dirty&1024&&an(z,o=M,o),r.$$.dirty&12273&&i&&n!==d&&(an(E,n=d,n),lP(i,n,La({type:"geojson",data:p,filter:x,lineMetrics:C,generateId:g,promoteId:y,cluster:!!M,clusterMinPoints:M==null?void 0:M.minPoints,clusterMaxZoom:M==null?void 0:M.maxZoom,clusterRadius:M==null?void 0:M.radius,clusterProperties:M==null?void 0:M.properties}),U=>i&&U===n,()=>{n&&(t(11,P=i==null?void 0:i.getSource(n)),t(12,$=!0))})),r.$$.dirty&8208&&(i==null||i.on("style.load",()=>{t(11,P=i==null?void 0:i.getSource(d))})),r.$$.dirty&6176&&P&&($?t(12,$=!1):P.setData(p)),r.$$.dirty&3072&&(P==null||P.setClusterOptions(La({cluster:!!M,clusterMaxZoom:M==null?void 0:M.maxZoom,clusterRadius:M==null?void 0:M.radius})))},[n,F,z,E,d,p,g,y,x,C,M,P,$,i,a,u]}class fP extends St{constructor(e){super(),kt(this,e,hP,cP,_t,{id:4,data:5,generateId:6,promoteId:7,filter:8,lineMetrics:9,cluster:10})}}function dP(r){let e;const t=r[15].default,n=mn(t,r,r[23],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8388608)&&_n(n,t,i,i[23],e?gn(t,i[23],o,null):yn(i[23]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function pP(r){let e,t,n;function i(u){r[16](u)}let o={id:r[1],type:"line",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],minzoom:r[9],maxzoom:r[10],hoverCursor:r[11],manageHoverState:r[12],eventsIfTopMost:r[13],interactive:r[14],$$slots:{default:[dP]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.hovered=r[0]),e=new cg({props:o}),un.push(()=>Pn(e,"hovered",i)),e.$on("click",r[17]),e.$on("dblclick",r[18]),e.$on("contextmenu",r[19]),e.$on("mouseenter",r[20]),e.$on("mousemove",r[21]),e.$on("mouseleave",r[22]),{c(){ce(e.$$.fragment)},m(u,a){le(e,u,a),n=!0},p(u,[a]){const d={};a&2&&(d.id=u[1]),a&4&&(d.source=u[2]),a&8&&(d.sourceLayer=u[3]),a&16&&(d.beforeId=u[4]),a&32&&(d.beforeLayerType=u[5]),a&64&&(d.paint=u[6]),a&128&&(d.layout=u[7]),a&256&&(d.filter=u[8]),a&512&&(d.minzoom=u[9]),a&1024&&(d.maxzoom=u[10]),a&2048&&(d.hoverCursor=u[11]),a&4096&&(d.manageHoverState=u[12]),a&8192&&(d.eventsIfTopMost=u[13]),a&16384&&(d.interactive=u[14]),a&8388608&&(d.$$scope={dirty:a,ctx:u}),!t&&a&1&&(t=!0,d.hovered=u[0],An(()=>t=!1)),e.$set(d)},i(u){n||(N(e.$$.fragment,u),n=!0)},o(u){V(e.$$.fragment,u),n=!1},d(u){ue(e,u)}}}function mP(r,e,t){let{$$slots:n={},$$scope:i}=e,{id:o=Rh("line")}=e,{source:u=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:d=void 0}=e,{beforeLayerType:p=void 0}=e,{paint:g}=e,{layout:y=void 0}=e,{filter:x=void 0}=e,{minzoom:C=void 0}=e,{maxzoom:M=void 0}=e,{hoverCursor:F=void 0}=e,{manageHoverState:z=!1}=e,{hovered:E=null}=e,{eventsIfTopMost:P=!1}=e,{interactive:$=!0}=e;function U(ne){E=ne,t(0,E)}function K(ne){In.call(this,r,ne)}function ee(ne){In.call(this,r,ne)}function W(ne){In.call(this,r,ne)}function J(ne){In.call(this,r,ne)}function he(ne){In.call(this,r,ne)}function Ae(ne){In.call(this,r,ne)}return r.$$set=ne=>{"id"in ne&&t(1,o=ne.id),"source"in ne&&t(2,u=ne.source),"sourceLayer"in ne&&t(3,a=ne.sourceLayer),"beforeId"in ne&&t(4,d=ne.beforeId),"beforeLayerType"in ne&&t(5,p=ne.beforeLayerType),"paint"in ne&&t(6,g=ne.paint),"layout"in ne&&t(7,y=ne.layout),"filter"in ne&&t(8,x=ne.filter),"minzoom"in ne&&t(9,C=ne.minzoom),"maxzoom"in ne&&t(10,M=ne.maxzoom),"hoverCursor"in ne&&t(11,F=ne.hoverCursor),"manageHoverState"in ne&&t(12,z=ne.manageHoverState),"hovered"in ne&&t(0,E=ne.hovered),"eventsIfTopMost"in ne&&t(13,P=ne.eventsIfTopMost),"interactive"in ne&&t(14,$=ne.interactive),"$$scope"in ne&&t(23,i=ne.$$scope)},[E,o,u,a,d,p,g,y,x,C,M,F,z,P,$,n,U,K,ee,W,J,he,Ae,i]}class gP extends St{constructor(e){super(),kt(this,e,mP,pP,_t,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}function _P(r){let e,t,n,i,o,u;return e=new aP({props:{id:"edit-polygon-fill",filter:FA,paint:{"fill-color":"red","fill-opacity":["case",["boolean",["get","hover"],"false"],1,.5]}}}),n=new gP({props:{id:"edit-polygon-lines",filter:BA,paint:{"line-color":"black","line-width":8,"line-opacity":.5}}}),o=new rP({props:{id:"edit-polygon-vertices",filter:$A,paint:{"circle-color":"black","circle-opacity":["case",["has","hovered"],1,.5],"circle-radius":10}}}),{c(){ce(e.$$.fragment),t=ie(),ce(n.$$.fragment),i=ie(),ce(o.$$.fragment)},m(a,d){le(e,a,d),Z(a,t,d),le(n,a,d),Z(a,i,d),le(o,a,d),u=!0},p:ot,i(a){u||(N(e.$$.fragment,a),N(n.$$.fragment,a),N(o.$$.fragment,a),u=!0)},o(a){V(e.$$.fragment,a),V(n.$$.fragment,a),V(o.$$.fragment,a),u=!1},d(a){a&&(q(t),q(i)),ue(e,a),ue(n,a),ue(o,a)}}}function yP(r){let e,t;return e=new fP({props:{data:r[0],$$slots:{default:[_P]},$$scope:{ctx:r}}}),{c(){ce(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p(n,[i]){const o={};i&1&&(o.data=n[0]),i&2&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){ue(e,n)}}}function bP(r,e,t){let n;return st(r,lw,i=>t(0,n=i)),[n]}class vP extends St{constructor(e){super(),kt(this,e,bP,yP,_t,{})}}function wP(r){let e,t,n,i,o,u,a;return{c(){e=j("button"),e.textContent="Import current view",t=ie(),n=j("i"),n.textContent="or...",i=ie(),o=j("button"),o.textContent="Draw an area to import on the map",ae(e,"type","button"),ae(o,"type","button")},m(d,p){Z(d,e,p),Z(d,t,p),Z(d,n,p),Z(d,i,p),Z(d,o,p),u||(a=[Tt(e,"click",r[2]),Tt(o,"click",r[3])],u=!0)},p:ot,i:ot,o:ot,d(d){d&&(q(e),q(t),q(n),q(i),q(o)),u=!1,ur(a)}}}function xP(r){let e,t;return e=new ZA({props:{polygonTool:r[0]}}),{c(){ce(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p(n,i){const o={};i&1&&(o.polygonTool=n[0]),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){ue(e,n)}}}function kP(r){let e,t,n,i,o,u,a,d,p;const g=[xP,wP],y=[];function x(C,M){return C[0]?0:1}return e=x(r),t=y[e]=g[e](r),{c(){t.c(),n=ie(),i=j("label"),o=j("input"),u=Ee(`Save a copy of the osm.xml
  after importing`),ae(o,"type","checkbox")},m(C,M){y[e].m(C,M),Z(C,n,M),Z(C,i,M),D(i,o),o.checked=r[1],D(i,u),a=!0,d||(p=Tt(o,"change",r[5]),d=!0)},p(C,[M]){let F=e;e=x(C),e===F?y[e].p(C,M):(Kt(),V(y[F],1,1,()=>{y[F]=null}),Xt(),t=y[e],t?t.p(C,M):(t=y[e]=g[e](C),t.c()),N(t,1),t.m(n.parentNode,n)),M&2&&(o.checked=C[1])},i(C){a||(N(t),a=!0)},o(C){V(t),a=!1},d(C){C&&(q(n),q(i)),y[e].d(C),d=!1,p()}}}function Jc(r){return[r.lng,r.lat]}function SP(r,e,t){let{map:n}=e;const i=Is();let o=null,u=!1;async function a(x){try{i("loading","Loading from Overpass");let M=await(await fetch(fw(x))).text();u&&xd("osm.xml",M),i("gotXml",{xml:M,boundary:x})}catch(C){i("error",C.toString())}}function d(){let x=n.getBounds();return{type:"Feature",properties:{},geometry:{coordinates:[[Jc(x.getSouthWest()),Jc(x.getNorthWest()),Jc(x.getNorthEast()),Jc(x.getSouthEast()),Jc(x.getSouthWest())]],type:"Polygon"}}}async function p(){if(n){if(n.getZoom()<13){i("error","Zoom in more to import");return}await a(d())}}function g(){n&&(t(0,o=new NA(n)),o.startNew(),o.addEventListenerSuccess(async x=>{t(0,o=null),await a(x)}),o.addEventListenerFailure(()=>{t(0,o=null)}))}function y(){u=this.checked,t(1,u)}return r.$$set=x=>{"map"in x&&t(4,n=x.map)},[o,u,p,g,n,y]}class TP extends St{constructor(e){super(),kt(this,e,SP,kP,_t,{map:4})}}function fw(r){let e='poly:"';if(r.geometry.type=="Polygon")for(let[n,i]of r.geometry.coordinates[0])e+=`${i} ${n} `;else if(r.geometry.type=="MultiPolygon")for(let[n,i]of r.geometry.coordinates[0][0])e+=`${i} ${n} `;else throw new Error("overpassQueryForPolygon needs a Polygon or MultiPolygon");return e=e.slice(0,-1)+'"',`https://overpass-api.de/api/interpreter?data=${`(nwr(${e}); node(w)->.x; <;); out meta;`}`}class dw{constructor(e,t,n,i,o,u,a,d){Yn(this,"inner");this.inner=new BM(e,t||new Uint8Array,n||new Uint8Array,i,o,u,a,d)}getInvertedBoundary(){return JSON.parse(this.inner.getInvertedBoundary())}getBounds(){return Array.from(this.inner.getBounds())}toRouteSnapper(){return this.inner.toRouteSnapper()}toRouteSnapperGj(){return this.inner.toRouteSnapperGj()}renderModalFilters(){return JSON.parse(this.inner.renderModalFilters())}renderTurnRestrictions(){return JSON.parse(this.inner.renderTurnRestrictions())}renderNeighbourhood(){let e=JSON.parse(this.inner.renderNeighbourhood());return e.maxShortcuts=Math.max(...e.features.map(t=>t.properties.kind=="interior_road"?t.properties.shortcuts:0))??0,e}generatedBoundaries(){return JSON.parse(this.inner.generatedBoundaries())}generateMergedBoundary(e){let t=this.inner.generateMergedBoundary(e);return JSON.parse(t)}setNeighbourhoodBoundary(e,t){this.inner.setNeighbourhoodBoundary(e,t)}deleteNeighbourhoodBoundary(e){this.inner.deleteNeighbourhoodBoundary(e)}renameNeighbourhoodBoundary(e,t){this.inner.renameNeighbourhoodBoundary(e,t)}setCurrentNeighbourhood(e){this.inner.setCurrentNeighbourhood(e)}addModalFilter(e,t){this.inner.addModalFilter(e,t)}addManyModalFilters(e,t){this.inner.addManyModalFilters(e,t)}deleteModalFilter(e){this.inner.deleteModalFilter(e)}addDiagonalFilter(e){this.inner.addDiagonalFilter(e.intersectionId)}rotateDiagonalFilter(e){this.inner.rotateDiagonalFilter(e.intersectionId)}deleteDiagonalFilter(e){this.inner.deleteDiagonalFilter(e.intersectionId)}toggleTravelFlow(e){this.inner.toggleTravelFlow(e)}toggleMainRoad(e){this.inner.toggleMainRoad(e)}reclassifyRoadsAlongLine(e,t,n){this.inner.reclassifyRoadsAlongLine(e,t,n)}addTurnRestriction(e,t){this.inner.addTurnRestriction(e,t)}deleteTurnRestriction(e,t,n){this.inner.deleteTurnRestriction(e,t,n)}getTurnRestrictionTargets(e){return JSON.parse(this.inner.getTurnRestrictionTargets(e))}undo(){this.inner.undo()}redo(){this.inner.redo()}getShortcutsCrossingRoad(e){return JSON.parse(this.inner.getShortcutsCrossingRoad(e))}getAllShortcuts(){return JSON.parse(this.inner.getAllShortcuts())}toSavefile(){return JSON.parse(this.inner.toSavefile())}loadSavefile(e){this.inner.loadSavefile(e)}compareRoute(e,t,n){return JSON.parse(this.inner.compareRoute(e.lng,e.lat,t.lng,t.lat,n))}impactToOneDestination(e){return JSON.parse(this.inner.impactToOneDestination(e.lng,e.lat))}predictImpact(e){return JSON.parse(this.inner.predictImpact(e))}getImpactsOnRoad(e,t){return JSON.parse(this.inner.getImpactsOnRoad(e,t)).map(n=>{let[i,o,u]=n;return{count:i,before:o,after:u}})}getAllNeighbourhoods(){return JSON.parse(this.inner.getAllNeighbourhoods())}getAllIntersections(){return JSON.parse(this.inner.getAllIntersections())}getMovements(e){return JSON.parse(this.inner.getMovements(e))}getDemandModel(){let e=JSON.parse(this.inner.getDemandModel());for(let t of e.features)t.properties.sum_from=R0(t.properties.counts_from),t.properties.sum_to=R0(t.properties.counts_to);return e}getPOIs(){return JSON.parse(this.inner.getPOIs())}}async function Sh(r){let e=Ci(ta).project(r);try{console.time("get input files");let{osmBuffer:t,demandBuffer:n,contextDataBuffer:i,boundary:o}=await CP(e);console.timeEnd("get input files"),console.time("load"),Cr.set(new dw(new Uint8Array(t),n?new Uint8Array(n):void 0,i?new Uint8Array(i):void 0,o,e.app_focus,e.study_area_name,e.project_name,e.db_schema_version)),Ci(Cr).loadSavefile(e),yl.set(r),console.timeEnd("load"),MP(r)}catch(t){window.alert(`Couldn't open project: ${t}`),yl.set(void 0)}}async function CP(r){if(r.app_focus=="cnt"){console.assert(r.study_area_name,"CNT projects must have a study area name");let e=Bo(`cnt_osm/${r.study_area_name}.osm.pbf`);console.log(`Grabbing ${e}`);let n=await(await xa(e)).arrayBuffer(),i=Bo(`cnt_boundaries/${r.study_area_name}.geojson`),u=await(await xa(i)).json(),a=Bo(`cnt_demand/demand_${r.study_area_name}.bin`);console.log(`Grabbing ${a}`);let d;try{d=await(await xa(a)).arrayBuffer()}catch(y){console.log(`No demand model: ${y}`)}let p=Bo(`cnt_prioritization/context_${r.study_area_name}.bin`);console.log(`Grabbing ${p}`);let g;try{g=await(await xa(p)).arrayBuffer()}catch(y){console.log(`No context data for prioritization: ${y}`)}return{osmBuffer:n,boundary:u,demandBuffer:d,contextDataBuffer:g}}else if(r.study_area_name){let e=Bo(`severance_pbfs/${r.study_area_name}.pbf`);console.log(`Grabbing ${e}`);let n=await(await xa(e)).arrayBuffer(),i=Bo(`boundaries/${r.study_area_name}.geojson`),u=await(await xa(i)).json();return{osmBuffer:n,boundary:u}}else{console.log("Grabbing from Overpass");let e=r.features.find(i=>i.properties.kind=="study_area_boundary");return{osmBuffer:await(await xa(fw(e))).arrayBuffer(),boundary:e}}}function MP(r){vd.set(new kk(Ci(rs),Ci(Cr).toRouteSnapper(),Ln(Ji()),Ln(!0),Ln(0))),Ci(rs).fitBounds(Ci(Cr).getBounds(),{duration:500});let e=new URL(window.location.href);e.searchParams.set("project",r),window.history.replaceState(null,"",e.toString())}function cb(r,e,t){const n=r.slice();return n[16]=e[t][0],n[17]=e[t][1],n}function hb(r,e,t){const n=r.slice();return n[20]=e[t][0],n[21]=e[t][1],n}function LP(r){let e,t,n,i,o,u,a,d=gr(r[5].mode)+"",p,g;return o=new jn({props:{mode:{mode:"title"}}}),{c(){e=j("div"),t=j("nav"),n=j("ul"),i=j("li"),ce(o.$$.fragment),u=ie(),a=j("li"),p=Ee(d),ae(t,"aria-label","breadcrumb"),ae(e,"slot","top")},m(y,x){Z(y,e,x),D(e,t),D(t,n),D(n,i),le(o,i,null),D(n,u),D(n,a),D(a,p),g=!0},p(y,x){(!g||x&32)&&d!==(d=gr(y[5].mode)+"")&&gt(p,d)},i(y){g||(N(o.$$.fragment,y),g=!0)},o(y){V(o.$$.fragment,y),g=!1},d(y){y&&q(e),ue(o)}}}function fb(r){let e,t,n,i,o,u,a,d,p,g,y,x,C,M;e=new Ch({props:{loading:r[4]}});let F=Rn(r[3]),z=[];for(let E=0;E<F.length;E+=1)z[E]=pb(cb(r,F,E));return y=new TP({props:{map:r[6]}}),y.$on("gotXml",r[7]),y.$on("loading",r[11]),y.$on("error",r[12]),{c(){ce(e.$$.fragment),t=ie(),n=j("label"),i=Ee(`Load a built-in area:
        `),o=j("select"),u=j("option");for(let E=0;E<z.length;E+=1)z[E].c();a=ie(),d=j("i"),d.textContent="or...",p=ie(),g=j("div"),ce(y.$$.fragment),u.__value="",Vn(u,u.__value),r[2]===void 0&&ds(()=>r[9].call(o))},m(E,P){le(e,E,P),Z(E,t,P),Z(E,n,P),D(n,i),D(n,o),D(o,u);for(let $=0;$<z.length;$+=1)z[$]&&z[$].m(o,null);Hi(o,r[2],!0),Z(E,a,P),Z(E,d,P),Z(E,p,P),Z(E,g,P),le(y,g,null),x=!0,C||(M=[Tt(o,"change",r[9]),Tt(o,"change",r[10])],C=!0)},p(E,P){const $={};if(P&16&&($.loading=E[4]),e.$set($),P&8){F=Rn(E[3]);let K;for(K=0;K<F.length;K+=1){const ee=cb(E,F,K);z[K]?z[K].p(ee,P):(z[K]=pb(ee),z[K].c(),z[K].m(o,null))}for(;K<z.length;K+=1)z[K].d(1);z.length=F.length}P&12&&Hi(o,E[2]);const U={};P&64&&(U.map=E[6]),y.$set(U)},i(E){x||(N(e.$$.fragment,E),N(y.$$.fragment,E),x=!0)},o(E){V(e.$$.fragment,E),V(y.$$.fragment,E),x=!1},d(E){E&&(q(t),q(n),q(a),q(d),q(p),q(g)),ue(e,E),gi(z,E),ue(y),C=!1,ur(M)}}}function db(r){let e,t=r[21]+"",n,i;return{c(){e=j("option"),n=Ee(t),e.__value=i=r[20],Vn(e,e.__value)},m(o,u){Z(o,e,u),D(e,n)},p(o,u){u&8&&t!==(t=o[21]+"")&&gt(n,t),u&8&&i!==(i=o[20])&&(e.__value=i,Vn(e,e.__value))},d(o){o&&q(e)}}}function pb(r){let e,t,n=Rn(r[17]),i=[];for(let o=0;o<n.length;o+=1)i[o]=db(hb(r,n,o));return{c(){e=j("optgroup");for(let o=0;o<i.length;o+=1)i[o].c();ae(e,"label",t=r[16])},m(o,u){Z(o,e,u);for(let a=0;a<i.length;a+=1)i[a]&&i[a].m(e,null)},p(o,u){if(u&8){n=Rn(o[17]);let a;for(a=0;a<n.length;a+=1){const d=hb(o,n,a);i[a]?i[a].p(d,u):(i[a]=db(d),i[a].c(),i[a].m(e,null))}for(;a<i.length;a+=1)i[a].d(1);i.length=n.length}u&8&&t!==(t=o[16])&&ae(e,"label",t)},d(o){o&&q(e),gi(i,o)}}}function EP(r){let e,t,n,i,o,u,a,d,p,g=r[1]&&fb(r);return{c(){e=j("div"),t=j("div"),n=j("label"),i=Ee(`Project name:
        `),o=j("input"),u=ie(),g&&g.c(),ae(o,"type","text"),ae(e,"slot","sidebar")},m(y,x){Z(y,e,x),D(e,t),D(t,n),D(n,i),D(n,o),Vn(o,r[1]),D(e,u),g&&g.m(e,null),a=!0,d||(p=Tt(o,"input",r[8]),d=!0)},p(y,x){x&2&&o.value!==y[1]&&Vn(o,y[1]),y[1]?g?(g.p(y,x),x&2&&N(g,1)):(g=fb(y),g.c(),N(g,1),g.m(e,null)):g&&(Kt(),V(g,1,1,()=>{g=null}),Xt())},i(y){a||(N(g),a=!0)},o(y){V(g),a=!1},d(y){y&&q(e),g&&g.d(),d=!1,p()}}}function IP(r){let e,t,n;return t=new vP({}),{c(){e=j("div"),ce(t.$$.fragment),ae(e,"slot","map")},m(i,o){Z(i,e,o),le(t,e,null),n=!0},p:ot,i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){V(t.$$.fragment,i),n=!1},d(i){i&&q(e),ue(t)}}}function AP(r){let e,t;return e=new wo({props:{$$slots:{map:[IP],sidebar:[EP],top:[LP]},$$scope:{ctx:r}}}),{c(){ce(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p(n,[i]){const o={};i&16777342&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){ue(e,n)}}}function PP(r,e,t){let n,i,o,u,a;st(r,Kn,$=>t(5,n=$)),st(r,ta,$=>t(13,i=$)),st(r,Cr,$=>t(14,o=$)),st(r,is,$=>t(15,u=$)),st(r,rs,$=>t(6,a=$));let d="",p=null,g=[],y="";Es(async()=>{let $=await xa(Bo("severance_pbfs/areas.json"));t(3,g=await $.json())});async function x($){t(4,y="Loading OSM");try{let U;an(Cr,o=new dw(new TextEncoder().encode($.detail.xml),void 0,void 0,$.detail.boundary,u,U,d,i.dbSchemaVersion),o);const K=i.createProject(o.toSavefile());await Sh(K),an(Kn,n={mode:"add-neighbourhood"},n)}catch(U){window.alert(`Couldn't import from Overpass: ${U}`)}t(4,y="")}async function C(){if(!p)return;let $;try{$=i.createEmptyProject(d,p)}catch(U){t(2,p=null),window.alert(`Couldn't create project: ${U}`);return}t(4,y=`Loading pre-clipped OSM area ${p}`),await Sh($),an(Kn,n={mode:"add-neighbourhood"},n),t(4,y="")}function M(){d=this.value,t(1,d)}function F(){p=Sa(this),t(2,p),t(3,g)}return[C,d,p,g,y,n,a,x,M,F,()=>C(),$=>t(4,y=$.detail),$=>window.alert($.detail)]}class zP extends St{constructor(e){super(),kt(this,e,PP,AP,_t,{loadExample:0})}get loadExample(){return this.$$.ctx[0]}}const DP="/ltn/assets/boundaries-2701bb3b.geojson";function mb(r,e,t){const n=r.slice();return n[9]=e[t],n}function RP(r){let e=r[9]+"",t;return{c(){t=Ee(e)},m(n,i){Z(n,t,i)},p(n,i){i&2&&e!==(e=n[9]+"")&&gt(t,e)},d(n){n&&q(t)}}}function gb(r){let e,t,n;function i(){return r[5](r[9])}return t=new Ah({props:{$$slots:{default:[RP]},$$scope:{ctx:r}}}),t.$on("click",i),{c(){e=j("li"),ce(t.$$.fragment)},m(o,u){Z(o,e,u),le(t,e,null),n=!0},p(o,u){r=o;const a={};u&4098&&(a.$$scope={dirty:u,ctx:r}),t.$set(a)},i(o){n||(N(t.$$.fragment,o),n=!0)},o(o){V(t.$$.fragment,o),n=!1},d(o){o&&q(e),ue(t)}}}function FP(r){let e,t,n=r[8].name+"",i;return{c(){e=j("p"),t=Ee("Click to start a new project in "),i=Ee(n)},m(o,u){Z(o,e,u),D(e,t),D(e,i)},p(o,u){u&256&&n!==(n=o[8].name+"")&&gt(i,n)},d(o){o&&q(e)}}}function BP(r){let e,t;return e=new di({props:{openOn:"hover",$$slots:{default:[FP,({props:n})=>({8:n}),({props:n})=>n?256:0]},$$scope:{ctx:r}}}),{c(){ce(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p(n,i){const o={};i&4352&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){ue(e,n)}}}function $P(r){let e,t,n,i;return e=new Ki({props:{paint:{"fill-color":yo.mapFeature.hover.backgroundColor,"fill-outline-color":yo.mapFeature.hover.backgroundColor,"fill-opacity":Wn(0,.5)},beforeId:"Road labels",manageHoverState:!0,hoverCursor:"pointer",$$slots:{default:[BP]},$$scope:{ctx:r}}}),e.$on("click",r[2]),n=new sr({props:{paint:{"line-color":yo.mapFeature.hover.backgroundColor,"line-width":2.5},beforeId:"Road labels",manageHoverState:!1}}),{c(){ce(e.$$.fragment),t=ie(),ce(n.$$.fragment)},m(o,u){le(e,o,u),Z(o,t,u),le(n,o,u),i=!0},p(o,u){const a={};u&4096&&(a.$$scope={dirty:u,ctx:o}),e.$set(a)},i(o){i||(N(e.$$.fragment,o),N(n.$$.fragment,o),i=!0)},o(o){V(e.$$.fragment,o),V(n.$$.fragment,o),i=!1},d(o){o&&q(t),ue(e,o),ue(n,o)}}}function OP(r){let e,t,n,i,o,u,a=Rn(r[1]),d=[];for(let g=0;g<a.length;g+=1)d[g]=gb(mb(r,a,g));const p=g=>V(d[g],1,1,()=>{d[g]=null});return o=new mr({props:{data:r[0],generateId:!0,$$slots:{default:[$P]},$$scope:{ctx:r}}}),{c(){e=j("p"),e.textContent="Choose a boundary below or on the map to begin sketching:",t=ie(),n=j("ul");for(let g=0;g<d.length;g+=1)d[g].c();i=ie(),ce(o.$$.fragment),Ye(n,"columns","3")},m(g,y){Z(g,e,y),Z(g,t,y),Z(g,n,y);for(let x=0;x<d.length;x+=1)d[x]&&d[x].m(n,null);Z(g,i,y),le(o,g,y),u=!0},p(g,[y]){if(y&10){a=Rn(g[1]);let C;for(C=0;C<a.length;C+=1){const M=mb(g,a,C);d[C]?(d[C].p(M,y),N(d[C],1)):(d[C]=gb(M),d[C].c(),N(d[C],1),d[C].m(n,null))}for(Kt(),C=a.length;C<d.length;C+=1)p(C);Xt()}const x={};y&1&&(x.data=g[0]),y&4096&&(x.$$scope={dirty:y,ctx:g}),o.$set(x)},i(g){if(!u){for(let y=0;y<a.length;y+=1)N(d[y]);N(o.$$.fragment,g),u=!0}},o(g){d=d.filter(Boolean);for(let y=0;y<d.length;y+=1)V(d[y]);V(o.$$.fragment,g),u=!1},d(g){g&&(q(e),q(t),q(n),q(i)),gi(d,g),ue(o,g)}}}function NP(r,e,t){let n,i;st(r,Kn,y=>t(6,n=y)),st(r,ta,y=>t(7,i=y));let{activityIndicatorText:o}=e,u={type:"FeatureCollection",features:[]},a=[];Es(async()=>{let y=await fetch(DP);t(0,u=await y.json());for(let x of u.features)a.push(x.properties.name);a.sort(),t(1,a)});function d(y){let x=y.detail.features[0].properties;p(`${x.kind}_${x.name}`)}async function p(y){let x,C=!1;for(;!C;){let M=x||i.nextAvailableProjectName(fh(y));if(x=window.prompt(`Please pick a project name to create in ${fh(y)}`,M),x===null)return;if(x=x.trim(),x===""){window.alert("Project name cannot be blank; Please pick a name or cancel.");continue}t(4,o=`Loading pre-clipped OSM area ${fh(y)}`);try{let F=i.createEmptyProject(x,y);await Sh(F),an(Kn,n={mode:"add-neighbourhood"},n),C=!0}catch(F){window.alert(F)}t(4,o="")}}const g=y=>p(`LAD_${y}`);return r.$$set=y=>{"activityIndicatorText"in y&&t(4,o=y.activityIndicatorText)},[u,a,d,p,o,g]}class jP extends St{constructor(e){super(),kt(this,e,NP,OP,_t,{activityIndicatorText:4})}}function UP(r){let e,t,n,i,o,u;return{c(){e=j("label"),t=j("strong"),t.textContent="Load a project from a file",n=ie(),i=j("input"),ae(i,"type","file"),Ye(e,"margin-top","16px")},m(a,d){Z(a,e,d),D(e,t),D(e,n),D(e,i),r[3](i),o||(u=Tt(i,"change",r[1]),o=!0)},p:ot,i:ot,o:ot,d(a){a&&q(e),r[3](null),o=!1,u()}}}function VP(r,e,t){let n;st(r,Kn,d=>t(4,n=d));let{loading:i}=e,o;async function u(d){let p=o.files[0].name;t(2,i=`Loading from file ${p}`);let g=await o.files[0].text(),y=JSON.parse(g),x,C,M;y.app_focus&&(console.assert(y.app_focus=="global"||y.app_focus=="cnt"),x=y.app_focus),y.study_area_name&&(C=y.study_area_name),y.project_name&&(M=y.project_name),(!y.app_focus||!y.project_name)&&(y.study_area_name&&y.study_area_name.startsWith("LAD_")?(x="cnt",M=F0(bm(p,`ltn_cnt_${y.study_area_name}_`),".geojson")):(x="global",M=F0(bm(p,"ltn_"),".geojson"))),M=M,x=x;let F=Xm.projectStorage(x);M=F.nextAvailableProjectName(M),y.project_name=M,y.app_focus=x,y.study_area_name=C;let z=F.createProject(y);await Sh(z),an(Kn,n={mode:"pick-neighbourhood"},n),t(2,i="")}function a(d){un[d?"unshift":"push"](()=>{o=d,t(0,o)})}return r.$$set=d=>{"loading"in d&&t(2,i=d.loading)},[o,u,i,a]}class qP extends St{constructor(e){super(),kt(this,e,VP,UP,_t,{loading:2})}}function _b(r,e,t){const n=r.slice();return n[22]=e[t][0],n[23]=e[t][1],n}function yb(r,e,t){const n=r.slice();return n[26]=e[t].projectID,n[27]=e[t].projectName,n}function ZP(r){let e,t,n,i,o=gr(r[3].mode)+"",u;return{c(){e=j("div"),t=j("nav"),n=j("ul"),i=j("li"),u=Ee(o),ae(t,"aria-label","breadcrumb"),ae(e,"slot","top")},m(a,d){Z(a,e,d),D(e,t),D(t,n),D(n,i),D(i,u)},p(a,d){d&8&&o!==(o=gr(a[3].mode)+"")&&gt(u,o)},d(a){a&&q(e)}}}function GP(r){let e;return{c(){e=j("p"),e.textContent="Waiting for MapLibre and WASM to load..."},m(t,n){Z(t,e,n)},p:ot,i:ot,o:ot,d(t){t&&q(e)}}}function HP(r){let e,t,n,i,o,u,a,d,p,g=r[2].length>0&&bb(r);const y=[XP,KP],x=[];function C(z,E){return z[5]=="global"?0:z[5]=="cnt"?1:-1}~(i=C(r))&&(o=x[i]=y[i](r));function M(z){r[15](z)}let F={};return r[1]!==void 0&&(F.loading=r[1]),a=new qP({props:F}),un.push(()=>Pn(a,"loading",M)),{c(){g&&g.c(),e=ie(),t=j("h1"),t.textContent="Start a new project",n=ie(),o&&o.c(),u=ie(),ce(a.$$.fragment)},m(z,E){g&&g.m(z,E),Z(z,e,E),Z(z,t,E),Z(z,n,E),~i&&x[i].m(z,E),Z(z,u,E),le(a,z,E),p=!0},p(z,E){z[2].length>0?g?(g.p(z,E),E&4&&N(g,1)):(g=bb(z),g.c(),N(g,1),g.m(e.parentNode,e)):g&&(Kt(),V(g,1,1,()=>{g=null}),Xt());let P=i;i=C(z),i===P?~i&&x[i].p(z,E):(o&&(Kt(),V(x[P],1,1,()=>{x[P]=null}),Xt()),~i?(o=x[i],o?o.p(z,E):(o=x[i]=y[i](z),o.c()),N(o,1),o.m(u.parentNode,u)):o=null);const $={};!d&&E&2&&(d=!0,$.loading=z[1],An(()=>d=!1)),a.$set($)},i(z){p||(N(g),N(o),N(a.$$.fragment,z),p=!0)},o(z){V(g),V(o),V(a.$$.fragment,z),p=!1},d(z){z&&(q(e),q(t),q(n),q(u)),g&&g.d(z),~i&&x[i].d(z),ue(a,z)}}}function bb(r){let e,t,n,i,o=Rn(r[2]),u=[];for(let d=0;d<o.length;d+=1)u[d]=wb(_b(r,o,d));const a=d=>V(u[d],1,1,()=>{u[d]=null});return{c(){e=j("h1"),e.textContent="Your projects",t=ie(),n=j("div");for(let d=0;d<u.length;d+=1)u[d].c();ae(n,"class","project-list svelte-s5f8l2")},m(d,p){Z(d,e,p),Z(d,t,p),Z(d,n,p);for(let g=0;g<u.length;g+=1)u[g]&&u[g].m(n,null);i=!0},p(d,p){if(p&452){o=Rn(d[2]);let g;for(g=0;g<o.length;g+=1){const y=_b(d,o,g);u[g]?(u[g].p(y,p),N(u[g],1)):(u[g]=wb(y),u[g].c(),N(u[g],1),u[g].m(n,null))}for(Kt(),g=o.length;g<u.length;g+=1)a(g);Xt()}},i(d){if(!i){for(let p=0;p<o.length;p+=1)N(u[p]);i=!0}},o(d){u=u.filter(Boolean);for(let p=0;p<u.length;p+=1)V(u[p]);i=!1},d(d){d&&(q(e),q(t),q(n)),gi(u,d)}}}function WP(r){let e=r[27]+"",t;return{c(){t=Ee(e)},m(n,i){Z(n,t,i)},p(n,i){i&4&&e!==(e=n[27]+"")&&gt(t,e)},d(n){n&&q(t)}}}function vb(r){let e,t,n,i,o,u,a,d,p,g,y,x,C,M,F,z;function E(){return r[9](r[26],r[27])}n=new Ah({props:{$$slots:{default:[WP]},$$scope:{ctx:r}}}),n.$on("click",E),a=new Qb({props:{color:"black"}});function P(){return r[10](r[26])}g=new tv({props:{color:"black"}});function $(){return r[11](r[26],r[27])}C=new Jm({props:{color:"white"}});function U(){return r[12](r[26],r[27])}return{c(){e=j("li"),t=j("h3"),ce(n.$$.fragment),i=ie(),o=j("span"),u=j("button"),ce(a.$$.fragment),d=ie(),p=j("button"),ce(g.$$.fragment),y=ie(),x=j("button"),ce(C.$$.fragment),ae(u,"class","outline icon-btn"),ae(u,"title","Download project as GeoJSON"),ae(p,"class","outline icon-btn"),ae(p,"title","Rename project"),ae(x,"class","icon-btn destructive"),ae(x,"title","Delete project"),ae(o,"class","actions"),ae(e,"class","actionable-cell svelte-s5f8l2")},m(K,ee){Z(K,e,ee),D(e,t),le(n,t,null),D(e,i),D(e,o),D(o,u),le(a,u,null),D(o,d),D(o,p),le(g,p,null),D(o,y),D(o,x),le(C,x,null),M=!0,F||(z=[Tt(u,"click",P),Tt(p,"click",$),Tt(x,"click",U)],F=!0)},p(K,ee){r=K;const W={};ee&1073741828&&(W.$$scope={dirty:ee,ctx:r}),n.$set(W)},i(K){M||(N(n.$$.fragment,K),N(a.$$.fragment,K),N(g.$$.fragment,K),N(C.$$.fragment,K),M=!0)},o(K){V(n.$$.fragment,K),V(a.$$.fragment,K),V(g.$$.fragment,K),V(C.$$.fragment,K),M=!1},d(K){K&&q(e),ue(n),ue(a),ue(g),ue(C),F=!1,ur(z)}}}function wb(r){let e,t=fh(r[22])+"",n,i,o,u,a,d=Rn(r[23]),p=[];for(let y=0;y<d.length;y+=1)p[y]=vb(yb(r,d,y));const g=y=>V(p[y],1,1,()=>{p[y]=null});return{c(){e=j("h2"),n=Ee(t),i=ie(),o=j("ul");for(let y=0;y<p.length;y+=1)p[y].c();u=ie(),ae(e,"class","study-area-name svelte-s5f8l2"),ae(o,"class","navigable-list")},m(y,x){Z(y,e,x),D(e,n),Z(y,i,x),Z(y,o,x);for(let C=0;C<p.length;C+=1)p[C]&&p[C].m(o,null);D(o,u),a=!0},p(y,x){if((!a||x&4)&&t!==(t=fh(y[22])+"")&&gt(n,t),x&452){d=Rn(y[23]);let C;for(C=0;C<d.length;C+=1){const M=yb(y,d,C);p[C]?(p[C].p(M,x),N(p[C],1)):(p[C]=vb(M),p[C].c(),N(p[C],1),p[C].m(o,u))}for(Kt(),C=d.length;C<p.length;C+=1)g(C);Xt()}},i(y){if(!a){for(let x=0;x<d.length;x+=1)N(p[x]);a=!0}},o(y){p=p.filter(Boolean);for(let x=0;x<p.length;x+=1)V(p[x]);a=!1},d(y){y&&(q(e),q(i),q(o)),gi(p,y)}}}function KP(r){let e,t,n;function i(u){r[14](u)}let o={};return r[1]!==void 0&&(o.activityIndicatorText=r[1]),e=new jP({props:o}),un.push(()=>Pn(e,"activityIndicatorText",i)),{c(){ce(e.$$.fragment)},m(u,a){le(e,u,a),n=!0},p(u,a){const d={};!t&&a&2&&(t=!0,d.activityIndicatorText=u[1],An(()=>t=!1)),e.$set(d)},i(u){n||(N(e.$$.fragment,u),n=!0)},o(u){V(e.$$.fragment,u),n=!1},d(u){ue(e,u)}}}function XP(r){let e,t,n;return{c(){e=j("button"),e.textContent="New project"},m(i,o){Z(i,e,o),t||(n=Tt(e,"click",r[13]),t=!0)},p:ot,i:ot,o:ot,d(i){i&&q(e),t=!1,n()}}}function JP(r){let e,t,n,i;const o=[HP,GP],u=[];function a(d,p){return d[4]&&d[0]?0:1}return t=a(r),n=u[t]=o[t](r),{c(){e=j("div"),n.c(),ae(e,"slot","sidebar")},m(d,p){Z(d,e,p),u[t].m(e,null),i=!0},p(d,p){let g=t;t=a(d),t===g?u[t].p(d,p):(Kt(),V(u[g],1,1,()=>{u[g]=null}),Xt(),n=u[t],n?n.p(d,p):(n=u[t]=o[t](d),n.c()),N(n,1),n.m(e,null))},i(d){i||(N(n),i=!0)},o(d){V(n),i=!1},d(d){d&&q(e),u[t].d()}}}function YP(r){let e,t,n,i;return e=new Ch({props:{loading:r[1]}}),n=new wo({props:{$$slots:{sidebar:[JP],top:[ZP]},$$scope:{ctx:r}}}),{c(){ce(e.$$.fragment),t=ie(),ce(n.$$.fragment)},m(o,u){le(e,o,u),Z(o,t,u),le(n,o,u),i=!0},p(o,[u]){const a={};u&2&&(a.loading=o[1]),e.$set(a);const d={};u&1073741887&&(d.$$scope={dirty:u,ctx:o}),n.$set(d)},i(o){i||(N(e.$$.fragment,o),N(n.$$.fragment,o),i=!0)},o(o){V(e.$$.fragment,o),V(n.$$.fragment,o),i=!1},d(o){o&&q(t),ue(e,o),ue(n,o)}}}function QP(r,e,t){let n,i,o,u,a,d,p,g;st(r,Kn,he=>t(3,n=he)),st(r,ta,he=>t(16,i=he)),st(r,rs,he=>t(4,o=he)),st(r,is,he=>t(5,u=he)),st(r,J_,he=>t(17,a=he)),st(r,yl,he=>t(18,d=he)),st(r,vd,he=>t(19,p=he)),st(r,Cr,he=>t(20,g=he));let{wasmReady:y}=e,x="";if(an(Cr,g=null,g),an(vd,p=null,p),an(yl,d=void 0,d),a){let Ae=new URLSearchParams(window.location.search).get("project");Ae&&M(Ae),an(J_,a=!1,a)}else{let he=new URL(window.location.href);he.searchParams.delete("project"),window.history.replaceState(null,"",he.toString())}if(o&&!a){let he=[-180,-90,180,90];u=="cnt"&&(he=[-8.943,54.631,-.901,59.489]),o.fitBounds(he,{duration:500})}let C=i.studyAreaProjects();function M(he){let Ae=he;try{let ne=i.projectName(Ae);if(!ne){console.error(`Project ${Ae} from URL not found`);return}E(Ae,ne)}catch{console.error(`Error trying to fetch project from URL: ${Ae}`)}}function F(he,Ae){window.confirm(`Really delete project ${Ae}? You can't undo this.`)&&(i.removeProject(he),t(2,C=i.studyAreaProjects()))}function z(he,Ae){let ne=window.prompt(`Rename project ${Ae} to what?`,Ae);if(ne){try{i.renameProject(he,ne)}catch(fe){window.alert(`Couldn't rename project: ${fe}`)}t(2,C=i.studyAreaProjects())}}async function E(he,Ae){t(1,x=`Loading project ${Ae}`),await Sh(he),an(Kn,n={mode:"pick-neighbourhood"},n),t(1,x="")}const P=(he,Ae)=>E(he,Ae),$=he=>Av(he),U=(he,Ae)=>z(he,Ae),K=(he,Ae)=>F(he,Ae),ee=()=>an(Kn,n={mode:"new-project"},n);function W(he){x=he,t(1,x)}function J(he){x=he,t(1,x)}return r.$$set=he=>{"wasmReady"in he&&t(0,y=he.wasmReady)},[y,x,C,n,o,u,F,z,E,P,$,U,K,ee,W,J]}class ez extends St{constructor(e){super(),kt(this,e,QP,YP,_t,{wasmReady:0})}}function tz(r){let e,t,n,i,o,u,a,d,p,g,y,x,C,M=gr(r[1].mode)+"",F,z;return o=new jn({props:{mode:{mode:"title"}}}),d=new jn({props:{mode:{mode:"pick-neighbourhood"}}}),y=new jn({props:{mode:{mode:"neighbourhood"}}}),{c(){e=j("div"),t=j("nav"),n=j("ul"),i=j("li"),ce(o.$$.fragment),u=ie(),a=j("li"),ce(d.$$.fragment),p=ie(),g=j("li"),ce(y.$$.fragment),x=ie(),C=j("li"),F=Ee(M),ae(t,"aria-label","breadcrumb"),ae(e,"slot","top")},m(E,P){Z(E,e,P),D(e,t),D(t,n),D(n,i),le(o,i,null),D(n,u),D(n,a),le(d,a,null),D(n,p),D(n,g),le(y,g,null),D(n,x),D(n,C),D(C,F),z=!0},p(E,P){(!z||P&2)&&M!==(M=gr(E[1].mode)+"")&&gt(F,M)},i(E){z||(N(o.$$.fragment,E),N(d.$$.fragment,E),N(y.$$.fragment,E),z=!0)},o(E){V(o.$$.fragment,E),V(d.$$.fragment,E),V(y.$$.fragment,E),z=!1},d(E){E&&q(e),ue(o),ue(d),ue(y)}}}function nz(r){let e,t,n,i,o,u,a,d,p,g,y=or(r[0].gj.features[r[0].shortcutIndex].properties).directness.toFixed(1)+"",x,C,M,F,z,E;function P(U){r[4](U)}let $={list:r[0].gj.features};return r[0].shortcutIndex!==void 0&&($.idx=r[0].shortcutIndex),o=new Cd({props:$}),un.push(()=>Pn(o,"idx",P)),{c(){e=j("p"),e.textContent=`This shows all possible shortcuts crossing the blue road you've chosen.
        A shortcut is defined as a route starting and ending on main (busy)
        roads, then cutting through smaller streets. It might not actually be
        considered a "good shortcut" in practice -- this tool doesn't know any
        real traffic patterns; it's just looking for any possible path. This
        view lets you understand the limits of this assumption.`,t=ie(),n=j("button"),n.textContent="Pick a different road",i=ie(),ce(o.$$.fragment),a=ie(),d=j("p"),p=Ee("This shortcut is "),g=j("b"),x=Ee(y),C=Ee("x"),M=Ee(`
        the length of the shortest route using all roads, not just this neighbourhood`)},m(U,K){Z(U,e,K),Z(U,t,K),Z(U,n,K),Z(U,i,K),le(o,U,K),Z(U,a,K),Z(U,d,K),D(d,p),D(d,g),D(g,x),D(g,C),D(d,M),F=!0,z||(E=Tt(n,"click",r[3]),z=!0)},p(U,K){const ee={};K&1&&(ee.list=U[0].gj.features),!u&&K&1&&(u=!0,ee.idx=U[0].shortcutIndex,An(()=>u=!1)),o.$set(ee),(!F||K&1)&&y!==(y=or(U[0].gj.features[U[0].shortcutIndex].properties).directness.toFixed(1)+"")&&gt(x,y)},i(U){F||(N(o.$$.fragment,U),F=!0)},o(U){V(o.$$.fragment,U),F=!1},d(U){U&&(q(e),q(t),q(n),q(i),q(a),q(d)),ue(o,U),z=!1,E()}}}function rz(r){let e;return{c(){e=j("p"),e.textContent="Click a road to see shortcuts"},m(t,n){Z(t,e,n)},p:ot,i:ot,o:ot,d(t){t&&q(e)}}}function iz(r){let e,t,n,i,o,u;t=new As({props:{mode:{mode:"neighbourhood"}}});const a=[rz,nz],d=[];function p(g,y){return g[0].state=="neutral"?0:g[0].state=="chose-road"?1:-1}return~(i=p(r))&&(o=d[i]=a[i](r)),{c(){e=j("div"),ce(t.$$.fragment),n=ie(),o&&o.c(),ae(e,"slot","sidebar")},m(g,y){Z(g,e,y),le(t,e,null),D(e,n),~i&&d[i].m(e,null),u=!0},p(g,y){let x=i;i=p(g),i===x?~i&&d[i].p(g,y):(o&&(Kt(),V(d[x],1,1,()=>{d[x]=null}),Xt()),~i?(o=d[i],o?o.p(g,y):(o=d[i]=a[i](g),o.c()),N(o,1),o.m(e,null)):o=null)},i(g){u||(N(t.$$.fragment,g),N(o),u=!0)},o(g){V(t.$$.fragment,g),V(o),u=!1},d(g){g&&q(e),ue(t),~i&&d[i].d()}}}function oz(r){let e,t;return e=new zh({props:{interactive:!1}}),{c(){ce(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p:ot,i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){ue(e,n)}}}function sz(r){let e,t;return e=new zh({props:{onClickLine:r[2],$$slots:{"line-popup":[cz]},$$scope:{ctx:r}}}),{c(){ce(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p(n,i){const o={};i&128&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){ue(e,n)}}}function az(r){let e,t,n=(r[6].name??"unnamed road")+"",i;return{c(){e=j("p"),t=Ee("Main road: "),i=Ee(n)},m(o,u){Z(o,e,u),D(e,t),D(e,i)},p(o,u){u&64&&n!==(n=(o[6].name??"unnamed road")+"")&&gt(i,n)},d(o){o&&q(e)}}}function lz(r){let e,t=r[6].shortcuts+"",n,i,o=(r[6].name??"unnamed road")+"",u;return{c(){e=j("p"),n=Ee(t),i=Ee(" shortcuts through "),u=Ee(o)},m(a,d){Z(a,e,d),D(e,n),D(e,i),D(e,u)},p(a,d){d&64&&t!==(t=a[6].shortcuts+"")&&gt(n,t),d&64&&o!==(o=(a[6].name??"unnamed road")+"")&&gt(u,o)},d(a){a&&q(e)}}}function uz(r){let e;function t(o,u){if(o[6].kind=="interior_road")return lz;if(o[6].kind=="main_road")return az}let n=t(r),i=n&&n(r);return{c(){i&&i.c(),e=Xn()},m(o,u){i&&i.m(o,u),Z(o,e,u)},p(o,u){n===(n=t(o))&&i?i.p(o,u):(i&&i.d(1),i=n&&n(o),i&&(i.c(),i.m(e.parentNode,e)))},d(o){o&&q(e),i&&i.d(o)}}}function cz(r){let e,t,n;return t=new di({props:{openOn:"hover",$$slots:{default:[uz,({props:i})=>({6:i}),({props:i})=>i?64:0]},$$scope:{ctx:r}}}),{c(){e=j("div"),ce(t.$$.fragment),ae(e,"slot","line-popup")},m(i,o){Z(i,e,o),le(t,e,null),n=!0},p(i,o){const u={};o&192&&(u.$$scope={dirty:o,ctx:i}),t.$set(u)},i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){V(t.$$.fragment,i),n=!1},d(i){i&&q(e),ue(t)}}}function hz(r){let e,t,n,i,o,u,a,d,p,g;e=new Dd({}),n=new zd({}),o=new Rd({});const y=[sz,oz],x=[];function C(M,F){return M[0].state=="neutral"?0:M[0].state=="chose-road"?1:-1}return~(a=C(r))&&(d=x[a]=y[a](r)),{c(){ce(e.$$.fragment),t=ie(),ce(n.$$.fragment),i=ie(),ce(o.$$.fragment),u=ie(),d&&d.c(),p=Xn()},m(M,F){le(e,M,F),Z(M,t,F),le(n,M,F),Z(M,i,F),le(o,M,F),Z(M,u,F),~a&&x[a].m(M,F),Z(M,p,F),g=!0},p(M,F){let z=a;a=C(M),a===z?~a&&x[a].p(M,F):(d&&(Kt(),V(x[z],1,1,()=>{x[z]=null}),Xt()),~a?(d=x[a],d?d.p(M,F):(d=x[a]=y[a](M),d.c()),N(d,1),d.m(p.parentNode,p)):d=null)},i(M){g||(N(e.$$.fragment,M),N(n.$$.fragment,M),N(o.$$.fragment,M),N(d),g=!0)},o(M){V(e.$$.fragment,M),V(n.$$.fragment,M),V(o.$$.fragment,M),V(d),g=!1},d(M){M&&(q(t),q(i),q(u),q(p)),ue(e,M),ue(n,M),ue(o,M),~a&&x[a].d(M)}}}function xb(r){let e,t,n,i,o,u,a,d;return e=new mr({props:{data:r[0].gj.features[r[0].shortcutIndex],$$slots:{default:[fz]},$$scope:{ctx:r}}}),n=new mr({props:{data:r[0].roadGj,$$slots:{default:[dz]},$$scope:{ctx:r}}}),o=new bl({props:{lngLat:r[0].gj.features[r[0].shortcutIndex].geometry.coordinates[0],$$slots:{default:[pz]},$$scope:{ctx:r}}}),a=new bl({props:{lngLat:r[0].gj.features[r[0].shortcutIndex].geometry.coordinates[r[0].gj.features[r[0].shortcutIndex].geometry.coordinates.length-1],$$slots:{default:[mz]},$$scope:{ctx:r}}}),{c(){ce(e.$$.fragment),t=ie(),ce(n.$$.fragment),i=ie(),ce(o.$$.fragment),u=ie(),ce(a.$$.fragment)},m(p,g){le(e,p,g),Z(p,t,g),le(n,p,g),Z(p,i,g),le(o,p,g),Z(p,u,g),le(a,p,g),d=!0},p(p,g){const y={};g&1&&(y.data=p[0].gj.features[p[0].shortcutIndex]),g&128&&(y.$$scope={dirty:g,ctx:p}),e.$set(y);const x={};g&1&&(x.data=p[0].roadGj),g&128&&(x.$$scope={dirty:g,ctx:p}),n.$set(x);const C={};g&1&&(C.lngLat=p[0].gj.features[p[0].shortcutIndex].geometry.coordinates[0]),g&128&&(C.$$scope={dirty:g,ctx:p}),o.$set(C);const M={};g&1&&(M.lngLat=p[0].gj.features[p[0].shortcutIndex].geometry.coordinates[p[0].gj.features[p[0].shortcutIndex].geometry.coordinates.length-1]),g&128&&(M.$$scope={dirty:g,ctx:p}),a.$set(M)},i(p){d||(N(e.$$.fragment,p),N(n.$$.fragment,p),N(o.$$.fragment,p),N(a.$$.fragment,p),d=!0)},o(p){V(e.$$.fragment,p),V(n.$$.fragment,p),V(o.$$.fragment,p),V(a.$$.fragment,p),d=!1},d(p){p&&(q(t),q(i),q(u)),ue(e,p),ue(n,p),ue(o,p),ue(a,p)}}}function fz(r){let e,t;const n=[dn("shortcuts"),{paint:{"line-width":10,"line-color":"cyan"}}];let i={};for(let o=0;o<n.length;o+=1)i=Mt(i,n[o]);return e=new sr({props:i}),{c(){ce(e.$$.fragment)},m(o,u){le(e,o,u),t=!0},p(o,u){const a={};e.$set(a)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){ue(e,o)}}}function dz(r){let e,t;const n=[dn("shortcuts-focus"),{paint:{"line-width":5,"line-color":"blue"}}];let i={};for(let o=0;o<n.length;o+=1)i=Mt(i,n[o]);return e=new sr({props:i}),{c(){ce(e.$$.fragment)},m(o,u){le(e,o,u),t=!0},p(o,u){const a={};e.$set(a)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){ue(e,o)}}}function pz(r){let e;return{c(){e=Ee("A")},m(t,n){Z(t,e,n)},d(t){t&&q(e)}}}function mz(r){let e;return{c(){e=Ee("B")},m(t,n){Z(t,e,n)},d(t){t&&q(e)}}}function gz(r){let e,t,n,i,o,u;t=new Dh({props:{$$slots:{default:[hz]},$$scope:{ctx:r}}});let a=r[0].state=="chose-road"&&xb(r);return o=new Oa({props:{interactive:!1}}),{c(){e=j("div"),ce(t.$$.fragment),n=ie(),a&&a.c(),i=ie(),ce(o.$$.fragment),ae(e,"slot","map")},m(d,p){Z(d,e,p),le(t,e,null),D(e,n),a&&a.m(e,null),D(e,i),le(o,e,null),u=!0},p(d,p){const g={};p&129&&(g.$$scope={dirty:p,ctx:d}),t.$set(g),d[0].state=="chose-road"?a?(a.p(d,p),p&1&&N(a,1)):(a=xb(d),a.c(),N(a,1),a.m(e,i)):a&&(Kt(),V(a,1,1,()=>{a=null}),Xt())},i(d){u||(N(t.$$.fragment,d),N(a),N(o.$$.fragment,d),u=!0)},o(d){V(t.$$.fragment,d),V(a),V(o.$$.fragment,d),u=!1},d(d){d&&q(e),ue(t),a&&a.d(),ue(o)}}}function _z(r){let e,t;return e=new wo({props:{$$slots:{map:[gz],sidebar:[iz],top:[tz]},$$scope:{ctx:r}}}),{c(){ce(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p(n,[i]){const o={};i&131&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){ue(e,n)}}}function yz(r,e,t){let n,i;st(r,Cr,p=>t(5,n=p)),st(r,Kn,p=>t(1,i=p));let o={state:"neutral"};function u(p,g){let y=n.getShortcutsCrossingRoad(p.properties.id);if(y.features.length==0){window.alert("No shortcuts here");return}t(0,o={state:"chose-road",roadGj:p,gj:y,shortcutIndex:0})}const a=()=>t(0,o={state:"neutral"});function d(p){r.$$.not_equal(o.shortcutIndex,p)&&(o.shortcutIndex=p,t(0,o))}return[o,i,u,a,d]}class bz extends St{constructor(e){super(),kt(this,e,yz,_z,_t,{})}}function vz(r){let e,t,n,i,o,u;return{c(){e=j("div"),t=j("button"),t.innerHTML=`<img src="${wx}" style="height: 32px;" alt="A/B Street logo"/>`,n=ie(),i=j("span"),ae(t,"class","outline"),Ye(i,"width","100%"),ae(e,"slot","top"),ae(e,"class","pico"),Ye(e,"display","flex"),Ye(e,"align-items","center"),Ye(e,"gap","8px")},m(a,d){Z(a,e,d),D(e,t),D(e,n),D(e,i),r[24](i),o||(u=Tt(t,"click",r[23]),o=!0)},p:ot,d(a){a&&q(e),r[24](null),o=!1,u()}}}function wz(r){let e,t;return{c(){e=j("div"),t=j("div"),ae(e,"class","pico"),ae(e,"slot","left")},m(n,i){Z(n,e,i),D(e,t),r[22](t)},p:ot,d(n){n&&q(e),r[22](null)}}}function xz(r){return{c:ot,m:ot,p:ot,i:ot,o:ot,d:ot}}function kz(r){let e,t,n;function i(u){r[20](u)}let o={style:r[27],hash:!0,bounds:r[5],maxZoom:19,images:[{id:uo.walkCycleOnly.filterType,url:uo.walkCycleOnly.iconURL},{id:uo.noEntry.filterType,url:uo.noEntry.iconURL},{id:uo.busGate.filterType,url:uo.busGate.iconURL},{id:uo.schoolStreet.filterType,url:uo.schoolStreet.iconURL},{id:"diagonal_filter",url:"/ltn//filters/diagonal_filter_icon.png"},{id:"no_straight_turn",url:"/ltn//filters/no_straight_turn.png"},{id:"no_left_turn",url:"/ltn//filters/no_left_turn.png"},{id:"no_right_turn",url:"/ltn//filters/no_right_turn.png"},{id:"no_u_left_to_right_turn",url:"/ltn//filters/no_u_left_to_right_turn.png"},{id:"no_u_right_to_left_turn",url:"/ltn//filters/no_u_right_to_left_turn.png"},{id:"oneway_arrow",url:vx},{id:"border_entry_arrow",url:bx,options:{sdf:!0}},{id:"national_rail",url:Pb}],$$slots:{default:[qz]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.map=r[0]),e=new B4({props:o}),un.push(()=>Pn(e,"map",i)),e.$on("error",r[21]),{c(){ce(e.$$.fragment)},m(u,a){le(e,u,a),n=!0},p(u,a){const d={};a&512&&(d.style=u[27]),a&32&&(d.bounds=u[5]),a&268437209&&(d.$$scope={dirty:a,ctx:u}),!t&&a&1&&(t=!0,d.map=u[0],An(()=>t=!1)),e.$set(d)},i(u){n||(N(e.$$.fragment,u),n=!0)},o(u){V(e.$$.fragment,u),n=!1},d(u){ue(e,u)}}}function kb(r){let e,t,n,i;return e=new pm({props:{position:"top-left",$$slots:{default:[Cz]},$$scope:{ctx:r}}}),n=new pm({props:{position:"top-left",$$slots:{default:[Lz]},$$scope:{ctx:r}}}),{c(){ce(e.$$.fragment),t=ie(),ce(n.$$.fragment)},m(o,u){le(e,o,u),Z(o,t,u),le(n,o,u),i=!0},p(o,u){const a={};u&268435456&&(a.$$scope={dirty:u,ctx:o}),e.$set(a);const d={};u&268436096&&(d.$$scope={dirty:u,ctx:o}),n.$set(d)},i(o){i||(N(e.$$.fragment,o),N(n.$$.fragment,o),i=!0)},o(o){V(e.$$.fragment,o),V(n.$$.fragment,o),i=!1},d(o){o&&q(t),ue(e,o),ue(n,o)}}}function Sz(r){let e,t,n;return t=new d3({}),{c(){e=j("div"),ce(t.$$.fragment),ae(e,"class","ltn-map-btn zoom-to-fit-btn")},m(i,o){Z(i,e,o),le(t,e,null),n=!0},p:ot,i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){V(t.$$.fragment,i),n=!1},d(i){i&&q(e),ue(t)}}}function Tz(r){let e,t;return e=new iv({props:{title:"Zoom to fit study area",$$slots:{default:[Sz]},$$scope:{ctx:r}}}),e.$on("click",r[18]),{c(){ce(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p(n,i){const o={};i&268435456&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){ue(e,n)}}}function Cz(r){let e,t;return e=new ov({props:{$$slots:{default:[Tz]},$$scope:{ctx:r}}}),{c(){ce(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p(n,i){const o={};i&268435456&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){ue(e,n)}}}function Mz(r){let e,t;return e=new b5({props:{map:or(r[7]),maptilerBasemap:r[9]}}),{c(){ce(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p(n,i){const o={};i&128&&(o.map=or(n[7])),i&512&&(o.maptilerBasemap=n[9]),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){ue(e,n)}}}function Lz(r){let e,t;return e=new ov({props:{$$slots:{default:[Mz]},$$scope:{ctx:r}}}),{c(){ce(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p(n,i){const o={};i&268436096&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){ue(e,n)}}}function Ez(r){let e,t;return e=new zP({}),{c(){ce(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p:ot,i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){ue(e,n)}}}function Iz(r){let e,t;return e=new ez({props:{wasmReady:r[4]}}),{c(){ce(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p(n,i){const o={};i&16&&(o.wasmReady=n[4]),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){ue(e,n)}}}function Sb(r){let e,t,n,i,o,u;e=new mr({props:{data:r[6].getInvertedBoundary(),$$slots:{default:[Az]},$$scope:{ctx:r}}});const a=[Vz,Uz,jz,Nz,Oz,$z,Bz,Fz,Rz,Dz,zz,Pz],d=[];function p(g,y){return g[10].mode=="pick-neighbourhood"?0:g[10].mode=="set-boundary"?1:g[10].mode=="add-neighbourhood"?2:g[10].mode=="neighbourhood"?3:g[10].mode=="view-shortcuts"?4:g[10].mode=="impact-one-destination"?5:g[10].mode=="route"?6:g[10].mode=="predict-impact"?7:g[10].mode=="impact-detail"?8:g[10].mode=="debug-neighbourhood"?9:g[10].mode=="debug-intersections"?10:g[10].mode=="debug-demand"?11:-1}return~(n=p(r))&&(i=d[n]=a[n](r)),{c(){ce(e.$$.fragment),t=ie(),i&&i.c(),o=Xn()},m(g,y){le(e,g,y),Z(g,t,y),~n&&d[n].m(g,y),Z(g,o,y),u=!0},p(g,y){const x={};y&64&&(x.data=g[6].getInvertedBoundary()),y&268435456&&(x.$$scope={dirty:y,ctx:g}),e.$set(x);let C=n;n=p(g),n===C?~n&&d[n].p(g,y):(i&&(Kt(),V(d[C],1,1,()=>{d[C]=null}),Xt()),~n?(i=d[n],i?i.p(g,y):(i=d[n]=a[n](g),i.c()),N(i,1),i.m(o.parentNode,o)):i=null)},i(g){u||(N(e.$$.fragment,g),N(i),u=!0)},o(g){V(e.$$.fragment,g),V(i),u=!1},d(g){g&&(q(t),q(o)),ue(e,g),~n&&d[n].d(g)}}}function Az(r){let e,t;const n=[dn("boundary"),{paint:{"fill-color":"black","fill-opacity":.3}}];let i={};for(let o=0;o<n.length;o+=1)i=Mt(i,n[o]);return e=new Ki({props:i}),{c(){ce(e.$$.fragment)},m(o,u){le(e,o,u),t=!0},p(o,u){const a={};e.$set(a)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){ue(e,o)}}}function Pz(r){let e,t;return e=new QL({}),{c(){ce(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p:ot,i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){ue(e,n)}}}function zz(r){let e,t;return e=new aE({}),{c(){ce(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p:ot,i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){ue(e,n)}}}function Dz(r){let e,t;return e=new YE({}),{c(){ce(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p:ot,i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){ue(e,n)}}}function Rz(r){let e,t;return e=new T8({props:{road:r[10].road}}),{c(){ce(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p(n,i){const o={};i&1024&&(o.road=n[10].road),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){ue(e,n)}}}function Fz(r){let e,t;return e=new gA({}),{c(){ce(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p:ot,i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){ue(e,n)}}}function Bz(r){let e,t;return e=new IA({props:{prevMode:r[10].prevMode}}),{c(){ce(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p(n,i){const o={};i&1024&&(o.prevMode=n[10].prevMode),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){ue(e,n)}}}function $z(r){let e,t;return e=new V8({}),{c(){ce(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p:ot,i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){ue(e,n)}}}function Oz(r){let e,t;return e=new bz({}),{c(){ce(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p:ot,i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){ue(e,n)}}}function Nz(r){let e,t;return e=new g8({}),{c(){ce(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p:ot,i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){ue(e,n)}}}function jz(r){let e,t;return e=new qL({}),{c(){ce(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p:ot,i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){ue(e,n)}}}function Uz(r){let e,t;return e=new RA({props:{name:r[10].name,existing:r[10].existing}}),{c(){ce(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p(n,i){const o={};i&1024&&(o.name=n[10].name),i&1024&&(o.existing=n[10].existing),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){ue(e,n)}}}function Vz(r){let e,t;return e=new oA({}),{c(){ce(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p:ot,i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){ue(e,n)}}}function qz(r){let e,t,n,i,o,u,a,d,p,g,y,x,C,M,F,z,E;e=new lv({});let P=r[6]&&kb(r);i=new l6({props:{map:r[0],apiKey:Yb,country:void 0}}),u=new uv({});const $=[Iz,Ez],U=[];function K(W,J){return W[10].mode=="title"?0:W[10].mode=="new-project"?1:-1}~(g=K(r))&&(y=U[g]=$[g](r)),C=new AM({});let ee=r[6]&&Sb(r);return z=new qS({}),{c(){ce(e.$$.fragment),t=ie(),P&&P.c(),n=ie(),ce(i.$$.fragment),o=ie(),ce(u.$$.fragment),a=ie(),d=j("div"),p=ie(),y&&y.c(),x=ie(),ce(C.$$.fragment),M=ie(),ee&&ee.c(),F=ie(),ce(z.$$.fragment)},m(W,J){le(e,W,J),Z(W,t,J),P&&P.m(W,J),Z(W,n,J),le(i,W,J),Z(W,o,J),le(u,W,J),Z(W,a,J),Z(W,d,J),r[19](d),Z(W,p,J),~g&&U[g].m(W,J),Z(W,x,J),le(C,W,J),Z(W,M,J),ee&&ee.m(W,J),Z(W,F,J),le(z,W,J),E=!0},p(W,J){W[6]?P?(P.p(W,J),J&64&&N(P,1)):(P=kb(W),P.c(),N(P,1),P.m(n.parentNode,n)):P&&(Kt(),V(P,1,1,()=>{P=null}),Xt());const he={};J&1&&(he.map=W[0]),i.$set(he);let Ae=g;g=K(W),g===Ae?~g&&U[g].p(W,J):(y&&(Kt(),V(U[Ae],1,1,()=>{U[Ae]=null}),Xt()),~g?(y=U[g],y?y.p(W,J):(y=U[g]=$[g](W),y.c()),N(y,1),y.m(x.parentNode,x)):y=null),W[6]?ee?(ee.p(W,J),J&64&&N(ee,1)):(ee=Sb(W),ee.c(),N(ee,1),ee.m(F.parentNode,F)):ee&&(Kt(),V(ee,1,1,()=>{ee=null}),Xt())},i(W){E||(N(e.$$.fragment,W),N(P),N(i.$$.fragment,W),N(u.$$.fragment,W),N(y),N(C.$$.fragment,W),N(ee),N(z.$$.fragment,W),E=!0)},o(W){V(e.$$.fragment,W),V(P),V(i.$$.fragment,W),V(u.$$.fragment,W),V(y),V(C.$$.fragment,W),V(ee),V(z.$$.fragment,W),E=!1},d(W){W&&(q(t),q(n),q(o),q(a),q(d),q(p),q(x),q(M),q(F)),ue(e,W),P&&P.d(W),ue(i,W),ue(u,W),r[19](null),~g&&U[g].d(W),ue(C,W),ee&&ee.d(W),ue(z,W)}}}function Zz(r){return{c:ot,m:ot,p:ot,i:ot,o:ot,d:ot}}function Gz(r){let e,t,n,i={ctx:r,current:null,token:null,hasCatch:!1,pending:Zz,then:kz,catch:xz,value:27,blocks:[,,,]};return U_(t=r[13](r[9]),i),{c(){e=j("div"),i.block.c(),ae(e,"slot","main"),Ye(e,"position","relative"),Ye(e,"width","100%"),Ye(e,"height","100%")},m(o,u){Z(o,e,u),i.block.m(e,i.anchor=null),i.mount=()=>e,i.anchor=null,n=!0},p(o,u){r=o,i.ctx=r,u&512&&t!==(t=r[13](r[9]))&&U_(t,i)||px(i,r,u)},i(o){n||(N(i.block),n=!0)},o(o){for(let u=0;u<3;u+=1){const a=i.blocks[u];V(a)}n=!1},d(o){o&&q(e),i.block.d(),i.token=null,i=null}}}function Hz(r){let e,t,n,i,o,u,a;return t=new Ek({}),o=new GM({props:{$$slots:{main:[Gz],left:[wz],top:[vz]},$$scope:{ctx:r}}}),{c(){e=j("div"),ce(t.$$.fragment),n=ie(),i=j("div"),ce(o.$$.fragment),ae(e,"class","pico"),ae(i,"class",u="app-focus-"+r[8])},m(d,p){Z(d,e,p),le(t,e,null),Z(d,n,p),Z(d,i,p),le(o,i,null),a=!0},p(d,[p]){const g={};p&268439295&&(g.$$scope={dirty:p,ctx:d}),o.$set(g),(!a||p&256&&u!==(u="app-focus-"+d[8]))&&ae(i,"class",u)},i(d){a||(N(t.$$.fragment,d),N(o.$$.fragment,d),a=!0)},o(d){V(t.$$.fragment,d),V(o.$$.fragment,d),a=!1},d(d){d&&(q(e),q(n),q(i)),ue(t),ue(o)}}}function Wz(r,e,t){let n,i,o,u,a,d,p,g,y,x,C;st(r,Dm,_e=>t(15,n=_e)),st(r,zm,_e=>t(16,i=_e)),st(r,Pm,_e=>t(17,o=_e)),st(r,Cr,_e=>t(6,u=_e)),st(r,rs,_e=>t(7,a=_e)),st(r,ch,_e=>t(25,d=_e)),st(r,fm,_e=>t(26,p=_e)),st(r,is,_e=>t(8,g=_e)),st(r,am,_e=>t(9,y=_e)),st(r,Kn,_e=>t(10,x=_e)),st(r,dd,_e=>t(11,C=_e));let{appFocus:M="global"}=e;is.set(M);let F=!1;Es(async()=>{await Jv(),await $b(),t(4,F=!0);try{(await fetch("/severance_pbfs/areas.json")).ok&&(an(fm,p=!0,p),console.log("Using local cache, not od2net.org"))}catch{}let _e=new URLSearchParams(window.location.search).get("dev");_e==="true"||_e===""?an(ch,d=!0,d):(console.assert(_e===null||_e=="false",`unknown dev mode value: ${_e}, should be "true", "false", or empty`),an(ch,d=!1,d))});let z=null;function E(_e){a.fitBounds(u.getBounds(),{animate:_e})}let P,$,U,K;M=="cnt"&&(K=[-8.943,54.631,-.901,59.489]);async function ee(_e){return _e=="streets-v2"?YM:`https://api.maptiler.com/maps/${_e}/style.json?key=${Yb}`}const W=()=>E(!0);function J(_e){un[_e?"unshift":"push"](()=>{U=_e,t(3,U),t(15,n)})}function he(_e){z=_e,t(0,z)}const Ae=_e=>{console.log(_e.detail.error)};function ne(_e){un[_e?"unshift":"push"](()=>{$=_e,t(2,$),t(16,i)})}const fe=()=>an(dd,C=!0,C);function Ce(_e){un[_e?"unshift":"push"](()=>{P=_e,t(1,P),t(17,o)})}return r.$$set=_e=>{"appFocus"in _e&&t(14,M=_e.appFocus)},r.$$.update=()=>{r.$$.dirty&1&&z&&rs.set(z),r.$$.dirty&131074&&P&&o&&(t(1,P.innerHTML="",P),P.appendChild(o)),r.$$.dirty&65540&&$&&i&&(t(2,$.innerHTML="",$),$.appendChild(i)),r.$$.dirty&32776&&U&&n&&(t(3,U.innerHTML="",U),U.appendChild(n))},[z,P,$,U,F,K,u,a,g,y,x,C,E,ee,M,n,i,o,W,J,he,Ae,ne,fe,Ce]}class r7 extends St{constructor(e){super(),kt(this,e,Wz,Hz,_t,{appFocus:14})}}export{r7 as A};
