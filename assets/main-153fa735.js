var CS=Object.defineProperty;var TS=(e,t,n)=>t in e?CS(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var Zn=(e,t,n)=>(TS(e,typeof t!="symbol"?t+"":t,n),n);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const l of r)if(l.type==="childList")for(const f of l.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&i(f)}).observe(document,{childList:!0,subtree:!0});function n(r){const l={};return r.integrity&&(l.integrity=r.integrity),r.referrerPolicy&&(l.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?l.credentials="include":r.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function i(r){if(r.ep)return;r.ep=!0;const l=n(r);fetch(r.href,l)}})();function Ie(){}function Tr(e,t){for(const n in t)e[n]=t[n];return e}function Fb(e){return e()}function Bv(){return Object.create(null)}function No(e){e.forEach(Fb)}function pg(e){return typeof e=="function"}function He(e,t){return e!=e?t==t:e!==t||e&&typeof e=="object"||typeof e=="function"}let Lm;function hr(e,t){return e===t?!0:(Lm||(Lm=document.createElement("a")),Lm.href=t,e===Lm.href)}function LS(e){return Object.keys(e).length===0}function Bb(e,...t){if(e==null){for(const i of t)i(void 0);return Ie}const n=e.subscribe(...t);return n.unsubscribe?()=>n.unsubscribe():n}function Vb(e){let t;return Bb(e,n=>t=n)(),t}function Se(e,t,n){e.$$.on_destroy.push(Bb(t,n))}function sr(e,t,n,i){if(e){const r=Ub(e,t,n,i);return e[0](r)}}function Ub(e,t,n,i){return e[1]&&i?Tr(n.ctx.slice(),e[1](i(t))):n.ctx}function ar(e,t,n,i){if(e[2]&&i){const r=e[2](i(n));if(t.dirty===void 0)return r;if(typeof r=="object"){const l=[],f=Math.max(t.dirty.length,r.length);for(let a=0;a<f;a+=1)l[a]=t.dirty[a]|r[a];return l}return t.dirty|r}return t.dirty}function lr(e,t,n,i,r,l){if(r){const f=Ub(t,n,i,l);e.p(f,r)}}function ur(e){if(e.ctx.length>32){const t=[],n=e.ctx.length/32;for(let i=0;i<n;i++)t[i]=-1;return t}return-1}function MS(e){const t={};for(const n in e)t[n]=!0;return t}function Zm(e){return e??""}function je(e,t,n){return e.set(n),t}function Q_(e){return e&&pg(e.destroy)?e.destroy:Ie}const PS=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function dt(e,t){e.appendChild(t)}function Ct(e,t,n){e.insertBefore(t,n||null)}function It(e){e.parentNode&&e.parentNode.removeChild(e)}function ud(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function wt(e){return document.createElement(e)}function $l(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function ge(e){return document.createTextNode(e)}function Xt(){return ge(" ")}function ts(){return ge("")}function Ze(e,t,n,i){return e.addEventListener(t,n,i),()=>e.removeEventListener(t,n,i)}function kS(e){return function(t){return t.preventDefault(),e.call(this,t)}}function Rt(e,t,n){n==null?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function AS(e){return Array.from(e.childNodes)}function zi(e,t){t=""+t,e.data!==t&&(e.data=t)}function ql(e,t){e.value=t??""}function gi(e,t,n,i){n==null?e.style.removeProperty(t):e.style.setProperty(t,n,i?"important":"")}function $m(e,t,n){for(let i=0;i<e.options.length;i+=1){const r=e.options[i];if(r.__value===t){r.selected=!0;return}}(!n||t!==void 0)&&(e.selectedIndex=-1)}function Gb(e){const t=e.querySelector(":checked");return t&&t.__value}function hl(e,t,n){e.classList.toggle(t,!!n)}function NS(e,t,{bubbles:n=!1,cancelable:i=!1}={}){return new CustomEvent(e,{detail:t,bubbles:n,cancelable:i})}let Gp;function Op(e){Gp=e}function cd(){if(!Gp)throw new Error("Function called outside component initialization");return Gp}function dg(e){cd().$$.on_mount.push(e)}function aa(e){cd().$$.on_destroy.push(e)}function Dc(){const e=cd();return(t,n,{cancelable:i=!1}={})=>{const r=e.$$.callbacks[t];if(r){const l=NS(t,n,{cancelable:i});return r.slice().forEach(f=>{f.call(e,l)}),!l.defaultPrevented}return!0}}function jb(e,t){return cd().$$.context.set(e,t),t}function DS(e){return cd().$$.context.get(e)}function ii(e,t){const n=e.$$.callbacks[t.type];n&&n.slice().forEach(i=>i.call(this,t))}const Mh=[],cr=[];let Nh=[];const ty=[],qb=Promise.resolve();let ey=!1;function Zb(){ey||(ey=!0,qb.then($b))}function RS(){return Zb(),qb}function jp(e){Nh.push(e)}function yc(e){ty.push(e)}const j_=new Set;let Ih=0;function $b(){if(Ih!==0)return;const e=Gp;do{try{for(;Ih<Mh.length;){const t=Mh[Ih];Ih++,Op(t),OS(t.$$)}}catch(t){throw Mh.length=0,Ih=0,t}for(Op(null),Mh.length=0,Ih=0;cr.length;)cr.pop()();for(let t=0;t<Nh.length;t+=1){const n=Nh[t];j_.has(n)||(j_.add(n),n())}Nh.length=0}while(Mh.length);for(;ty.length;)ty.pop()();ey=!1,j_.clear(),Op(e)}function OS(e){if(e.fragment!==null){e.update(),No(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(jp)}}function zS(e){const t=[],n=[];Nh.forEach(i=>e.indexOf(i)===-1?t.push(i):n.push(i)),n.forEach(i=>i()),Nh=t}const Bm=new Set;let _c;function ci(){_c={r:0,c:[],p:_c}}function hi(){_c.r||No(_c.c),_c=_c.p}function mt(e,t){e&&e.i&&(Bm.delete(e),e.i(t))}function xt(e,t,n,i){if(e&&e.o){if(Bm.has(e))return;Bm.add(e),_c.c.push(()=>{Bm.delete(e),i&&(n&&e.d(1),i())}),e.o(t)}else i&&i()}function la(e){return(e==null?void 0:e.length)!==void 0?e:Array.from(e)}function FS(e,t){xt(e,1,1,()=>{t.delete(e.key)})}function BS(e,t,n,i,r,l,f,a,_,x,S,L){let A=e.length,P=l.length,O=A;const B={};for(;O--;)B[e[O].key]=O;const U=[],Y=new Map,V=new Map,$=[];for(O=P;O--;){const pt=L(r,l,O),gt=n(pt);let ut=f.get(gt);ut?i&&$.push(()=>ut.p(pt,t)):(ut=x(gt,pt),ut.c()),Y.set(gt,U[O]=ut),gt in B&&V.set(gt,Math.abs(O-B[gt]))}const K=new Set,it=new Set;function ft(pt){mt(pt,1),pt.m(a,S),f.set(pt.key,pt),S=pt.first,P--}for(;A&&P;){const pt=U[P-1],gt=e[A-1],ut=pt.key,St=gt.key;pt===gt?(S=pt.first,A--,P--):Y.has(St)?!f.has(ut)||K.has(ut)?ft(pt):it.has(St)?A--:V.get(ut)>V.get(St)?(it.add(ut),ft(pt)):(K.add(St),A--):(_(gt,f),A--)}for(;A--;){const pt=e[A];Y.has(pt.key)||_(pt,f)}for(;P;)ft(U[P-1]);return No($),U}function Wb(e,t){const n={},i={},r={$$scope:1};let l=e.length;for(;l--;){const f=e[l],a=t[l];if(a){for(const _ in f)_ in a||(i[_]=1);for(const _ in a)r[_]||(n[_]=a[_],r[_]=1);e[l]=a}else for(const _ in f)r[_]=1}for(const f in i)f in n||(n[f]=void 0);return n}function vc(e,t,n){const i=e.$$.props[t];i!==void 0&&(e.$$.bound[i]=n,n(e.$$.ctx[i]))}function Zt(e){e&&e.c()}function jt(e,t,n){const{fragment:i,after_update:r}=e.$$;i&&i.m(t,n),jp(()=>{const l=e.$$.on_mount.map(Fb).filter(pg);e.$$.on_destroy?e.$$.on_destroy.push(...l):No(l),e.$$.on_mount=[]}),r.forEach(jp)}function qt(e,t){const n=e.$$;n.fragment!==null&&(zS(n.after_update),No(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function VS(e,t){e.$$.dirty[0]===-1&&(Mh.push(e),Zb(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function en(e,t,n,i,r,l,f=null,a=[-1]){const _=Gp;Op(e);const x=e.$$={fragment:null,ctx:[],props:l,update:Ie,not_equal:r,bound:Bv(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(_?_.$$.context:[])),callbacks:Bv(),dirty:a,skip_bound:!1,root:t.target||_.$$.root};f&&f(x.root);let S=!1;if(x.ctx=n?n(e,t.props||{},(L,A,...P)=>{const O=P.length?P[0]:A;return x.ctx&&r(x.ctx[L],x.ctx[L]=O)&&(!x.skip_bound&&x.bound[L]&&x.bound[L](O),S&&VS(e,L)),A}):[],x.update(),S=!0,No(x.before_update),x.fragment=i?i(x.ctx):!1,t.target){if(t.hydrate){const L=AS(t.target);x.fragment&&x.fragment.l(L),L.forEach(It)}else x.fragment&&x.fragment.c();t.intro&&mt(e.$$.fragment),jt(e,t.target,t.anchor),$b()}Op(_)}class nn{constructor(){Zn(this,"$$");Zn(this,"$$set")}$destroy(){qt(this,1),this.$destroy=Ie}$on(t,n){if(!pg(n))return Ie;const i=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return i.push(n),()=>{const r=i.indexOf(n);r!==-1&&i.splice(r,1)}}$set(t){this.$$set&&!LS(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const US="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(US);const GS="/ltn/assets/logo-7ace0a42.png";let me;const Xb=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&Xb.decode();let Cp=null;function Dh(){return(Cp===null||Cp.byteLength===0)&&(Cp=new Uint8Array(me.memory.buffer)),Cp}function ea(e,t){return e=e>>>0,Xb.decode(Dh().subarray(e,e+t))}const Ul=new Array(128).fill(void 0);Ul.push(void 0,null,!0,!1);let zp=Ul.length;function ai(e){zp===Ul.length&&Ul.push(Ul.length+1);const t=zp;return zp=Ul[t],Ul[t]=e,t}function cn(e){return Ul[e]}function jS(e){e<132||(Ul[e]=zp,zp=e)}function fs(e){const t=cn(e);return jS(e),t}let Ls=0;const Vm=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},qS=typeof Vm.encodeInto=="function"?function(e,t){return Vm.encodeInto(e,t)}:function(e,t){const n=Vm.encode(e);return t.set(n),{read:e.length,written:n.length}};function Vl(e,t,n){if(n===void 0){const a=Vm.encode(e),_=t(a.length,1)>>>0;return Dh().subarray(_,_+a.length).set(a),Ls=a.length,_}let i=e.length,r=t(i,1)>>>0;const l=Dh();let f=0;for(;f<i;f++){const a=e.charCodeAt(f);if(a>127)break;l[r+f]=a}if(f!==i){f!==0&&(e=e.slice(f)),r=n(r,i,i=f+e.length*3,1)>>>0;const a=Dh().subarray(r+f,r+i),_=qS(e,a);f+=_.written}return Ls=f,r}function Ph(e){return e==null}let Tp=null;function Je(){return(Tp===null||Tp.byteLength===0)&&(Tp=new Int32Array(me.memory.buffer)),Tp}let Lp=null;function Hb(){return(Lp===null||Lp.byteLength===0)&&(Lp=new Float64Array(me.memory.buffer)),Lp}let Mp=null;function ZS(){return(Mp===null||Mp.byteLength===0)&&(Mp=new BigInt64Array(me.memory.buffer)),Mp}function ny(e){const t=typeof e;if(t=="number"||t=="boolean"||e==null)return`${e}`;if(t=="string")return`"${e}"`;if(t=="symbol"){const r=e.description;return r==null?"Symbol":`Symbol(${r})`}if(t=="function"){const r=e.name;return typeof r=="string"&&r.length>0?`Function(${r})`:"Function"}if(Array.isArray(e)){const r=e.length;let l="[";r>0&&(l+=ny(e[0]));for(let f=1;f<r;f++)l+=", "+ny(e[f]);return l+="]",l}const n=/\[object ([^\]]+)\]/.exec(toString.call(e));let i;if(n.length>1)i=n[1];else return toString.call(e);if(i=="Object")try{return"Object("+JSON.stringify(e)+")"}catch{return"Object"}return e instanceof Error?`${e.name}: ${e.message}
${e.stack}`:i}function $S(e,t){const n=t(e.length*1,1)>>>0;return Dh().set(e,n/1),Ls=e.length,n}function WS(e,t){return e=e>>>0,Hb().subarray(e/8,e/8+t)}function XS(e,t){return e=e>>>0,Dh().subarray(e/1,e/1+t)}function mc(e,t){try{return e.apply(this,t)}catch(n){me.__wbindgen_exn_store(ai(n))}}class HS{__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,t}free(){const t=this.__destroy_into_raw();me.__wbg_ltn_free(t)}constructor(t,n){try{const _=me.__wbindgen_add_to_stack_pointer(-16),x=$S(t,me.__wbindgen_malloc),S=Ls;var i=Ph(n)?0:Vl(n,me.__wbindgen_malloc,me.__wbindgen_realloc),r=Ls;me.ltn_new(_,x,S,i,r);var l=Je()[_/4+0],f=Je()[_/4+1],a=Je()[_/4+2];if(a)throw fs(f);return this.__wbg_ptr=l>>>0,this}finally{me.__wbindgen_add_to_stack_pointer(16)}}getInvertedBoundary(){let t,n;try{const x=me.__wbindgen_add_to_stack_pointer(-16);me.ltn_getInvertedBoundary(x,this.__wbg_ptr);var i=Je()[x/4+0],r=Je()[x/4+1],l=Je()[x/4+2],f=Je()[x/4+3],a=i,_=r;if(f)throw a=0,_=0,fs(l);return t=a,n=_,ea(a,_)}finally{me.__wbindgen_add_to_stack_pointer(16),me.__wbindgen_free(t,n,1)}}getBounds(){try{const r=me.__wbindgen_add_to_stack_pointer(-16);me.ltn_getBounds(r,this.__wbg_ptr);var t=Je()[r/4+0],n=Je()[r/4+1],i=WS(t,n).slice();return me.__wbindgen_free(t,n*8,8),i}finally{me.__wbindgen_add_to_stack_pointer(16)}}toRouteSnapper(){try{const r=me.__wbindgen_add_to_stack_pointer(-16);me.ltn_toRouteSnapper(r,this.__wbg_ptr);var t=Je()[r/4+0],n=Je()[r/4+1],i=XS(t,n).slice();return me.__wbindgen_free(t,n*1,1),i}finally{me.__wbindgen_add_to_stack_pointer(16)}}toRouteSnapperGj(){let t,n;try{const x=me.__wbindgen_add_to_stack_pointer(-16);me.ltn_toRouteSnapperGj(x,this.__wbg_ptr);var i=Je()[x/4+0],r=Je()[x/4+1],l=Je()[x/4+2],f=Je()[x/4+3],a=i,_=r;if(f)throw a=0,_=0,fs(l);return t=a,n=_,ea(a,_)}finally{me.__wbindgen_add_to_stack_pointer(16),me.__wbindgen_free(t,n,1)}}renderModalFilters(){let t,n;try{const x=me.__wbindgen_add_to_stack_pointer(-16);me.ltn_renderModalFilters(x,this.__wbg_ptr);var i=Je()[x/4+0],r=Je()[x/4+1],l=Je()[x/4+2],f=Je()[x/4+3],a=i,_=r;if(f)throw a=0,_=0,fs(l);return t=a,n=_,ea(a,_)}finally{me.__wbindgen_add_to_stack_pointer(16),me.__wbindgen_free(t,n,1)}}renderNeighbourhood(){let t,n;try{const x=me.__wbindgen_add_to_stack_pointer(-16);me.ltn_renderNeighbourhood(x,this.__wbg_ptr);var i=Je()[x/4+0],r=Je()[x/4+1],l=Je()[x/4+2],f=Je()[x/4+3],a=i,_=r;if(f)throw a=0,_=0,fs(l);return t=a,n=_,ea(a,_)}finally{me.__wbindgen_add_to_stack_pointer(16),me.__wbindgen_free(t,n,1)}}setNeighbourhoodBoundary(t,n){try{const l=me.__wbindgen_add_to_stack_pointer(-16),f=Vl(t,me.__wbindgen_malloc,me.__wbindgen_realloc),a=Ls;me.ltn_setNeighbourhoodBoundary(l,this.__wbg_ptr,f,a,ai(n));var i=Je()[l/4+0],r=Je()[l/4+1];if(r)throw fs(i)}finally{me.__wbindgen_add_to_stack_pointer(16)}}deleteNeighbourhoodBoundary(t){const n=Vl(t,me.__wbindgen_malloc,me.__wbindgen_realloc),i=Ls;me.ltn_deleteNeighbourhoodBoundary(this.__wbg_ptr,n,i)}setCurrentNeighbourhood(t){try{const r=me.__wbindgen_add_to_stack_pointer(-16),l=Vl(t,me.__wbindgen_malloc,me.__wbindgen_realloc),f=Ls;me.ltn_setCurrentNeighbourhood(r,this.__wbg_ptr,l,f);var n=Je()[r/4+0],i=Je()[r/4+1];if(i)throw fs(n)}finally{me.__wbindgen_add_to_stack_pointer(16)}}addModalFilter(t,n){try{const l=me.__wbindgen_add_to_stack_pointer(-16),f=Vl(n,me.__wbindgen_malloc,me.__wbindgen_realloc),a=Ls;me.ltn_addModalFilter(l,this.__wbg_ptr,ai(t),f,a);var i=Je()[l/4+0],r=Je()[l/4+1];if(r)throw fs(i)}finally{me.__wbindgen_add_to_stack_pointer(16)}}addManyModalFilters(t,n){try{const l=me.__wbindgen_add_to_stack_pointer(-16),f=Vl(n,me.__wbindgen_malloc,me.__wbindgen_realloc),a=Ls;me.ltn_addManyModalFilters(l,this.__wbg_ptr,ai(t),f,a);var i=Je()[l/4+0],r=Je()[l/4+1];if(r)throw fs(i)}finally{me.__wbindgen_add_to_stack_pointer(16)}}deleteModalFilter(t){me.ltn_deleteModalFilter(this.__wbg_ptr,t)}undo(){me.ltn_undo(this.__wbg_ptr)}redo(){me.ltn_redo(this.__wbg_ptr)}getShortcutsCrossingRoad(t){let n,i;try{const S=me.__wbindgen_add_to_stack_pointer(-16);me.ltn_getShortcutsCrossingRoad(S,this.__wbg_ptr,t);var r=Je()[S/4+0],l=Je()[S/4+1],f=Je()[S/4+2],a=Je()[S/4+3],_=r,x=l;if(a)throw _=0,x=0,fs(f);return n=_,i=x,ea(_,x)}finally{me.__wbindgen_add_to_stack_pointer(16),me.__wbindgen_free(n,i,1)}}toSavefile(){let t,n;try{const x=me.__wbindgen_add_to_stack_pointer(-16);me.ltn_toSavefile(x,this.__wbg_ptr);var i=Je()[x/4+0],r=Je()[x/4+1],l=Je()[x/4+2],f=Je()[x/4+3],a=i,_=r;if(f)throw a=0,_=0,fs(l);return t=a,n=_,ea(a,_)}finally{me.__wbindgen_add_to_stack_pointer(16),me.__wbindgen_free(t,n,1)}}loadSavefile(t){try{const r=me.__wbindgen_add_to_stack_pointer(-16);me.ltn_loadSavefile(r,this.__wbg_ptr,ai(t));var n=Je()[r/4+0],i=Je()[r/4+1];if(i)throw fs(n)}finally{me.__wbindgen_add_to_stack_pointer(16)}}compareRoute(t,n,i,r){let l,f;try{const P=me.__wbindgen_add_to_stack_pointer(-16);me.ltn_compareRoute(P,this.__wbg_ptr,t,n,i,r);var a=Je()[P/4+0],_=Je()[P/4+1],x=Je()[P/4+2],S=Je()[P/4+3],L=a,A=_;if(S)throw L=0,A=0,fs(x);return l=L,f=A,ea(L,A)}finally{me.__wbindgen_add_to_stack_pointer(16),me.__wbindgen_free(l,f,1)}}}async function YS(e,t){if(typeof Response=="function"&&e instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(e,t)}catch(i){if(e.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",i);else throw i}const n=await e.arrayBuffer();return await WebAssembly.instantiate(n,t)}else{const n=await WebAssembly.instantiate(e,t);return n instanceof WebAssembly.Instance?{instance:n,module:e}:n}}function KS(){const e={};return e.wbg={},e.wbg.__wbindgen_error_new=function(t,n){const i=new Error(ea(t,n));return ai(i)},e.wbg.__wbindgen_string_new=function(t,n){const i=ea(t,n);return ai(i)},e.wbg.__wbindgen_object_drop_ref=function(t){fs(t)},e.wbg.__wbindgen_string_get=function(t,n){const i=cn(n),r=typeof i=="string"?i:void 0;var l=Ph(r)?0:Vl(r,me.__wbindgen_malloc,me.__wbindgen_realloc),f=Ls;Je()[t/4+1]=f,Je()[t/4+0]=l},e.wbg.__wbindgen_boolean_get=function(t){const n=cn(t);return typeof n=="boolean"?n?1:0:2},e.wbg.__wbindgen_is_bigint=function(t){return typeof cn(t)=="bigint"},e.wbg.__wbindgen_bigint_from_i64=function(t){return ai(t)},e.wbg.__wbindgen_jsval_eq=function(t,n){return cn(t)===cn(n)},e.wbg.__wbindgen_bigint_from_u64=function(t){const n=BigInt.asUintN(64,t);return ai(n)},e.wbg.__wbindgen_number_get=function(t,n){const i=cn(n),r=typeof i=="number"?i:void 0;Hb()[t/8+1]=Ph(r)?0:r,Je()[t/4+0]=!Ph(r)},e.wbg.__wbindgen_is_object=function(t){const n=cn(t);return typeof n=="object"&&n!==null},e.wbg.__wbindgen_in=function(t,n){return cn(t)in cn(n)},e.wbg.__wbindgen_is_undefined=function(t){return cn(t)===void 0},e.wbg.__wbindgen_object_clone_ref=function(t){const n=cn(t);return ai(n)},e.wbg.__wbindgen_jsval_loose_eq=function(t,n){return cn(t)==cn(n)},e.wbg.__wbg_getwithrefkey_3b3c46ba20582127=function(t,n){const i=cn(t)[cn(n)];return ai(i)},e.wbg.__wbg_debug_34c9290896ec9856=function(t){console.debug(cn(t))},e.wbg.__wbg_error_e60eff06f24ab7a4=function(t){console.error(cn(t))},e.wbg.__wbg_info_d7d58472d0bab115=function(t){console.info(cn(t))},e.wbg.__wbg_log_a4530b4fe289336f=function(t){console.log(cn(t))},e.wbg.__wbg_warn_f260f49434e45e62=function(t){console.warn(cn(t))},e.wbg.__wbg_new_abda76e883ba8a5f=function(){const t=new Error;return ai(t)},e.wbg.__wbg_stack_658279fe44541cf6=function(t,n){const i=cn(n).stack,r=Vl(i,me.__wbindgen_malloc,me.__wbindgen_realloc),l=Ls;Je()[t/4+1]=l,Je()[t/4+0]=r},e.wbg.__wbg_error_f851667af71bcfc6=function(t,n){let i,r;try{i=t,r=n,console.error(ea(t,n))}finally{me.__wbindgen_free(i,r,1)}},e.wbg.__wbg_performance_3f3012faa4463882=function(t){const n=cn(t).performance;return ai(n)},e.wbg.__wbg_now_2fd65358804c9485=function(t){return cn(t).now()},e.wbg.__wbg_get_f01601b5a68d10e3=function(t,n){const i=cn(t)[n>>>0];return ai(i)},e.wbg.__wbg_length_1009b1af0c481d7b=function(t){return cn(t).length},e.wbg.__wbindgen_is_function=function(t){return typeof cn(t)=="function"},e.wbg.__wbg_newnoargs_c62ea9419c21fbac=function(t,n){const i=new Function(ea(t,n));return ai(i)},e.wbg.__wbg_next_9b877f231f476d01=function(t){const n=cn(t).next;return ai(n)},e.wbg.__wbg_next_6529ee0cca8d57ed=function(){return mc(function(t){const n=cn(t).next();return ai(n)},arguments)},e.wbg.__wbg_done_5fe336b092d60cf2=function(t){return cn(t).done},e.wbg.__wbg_value_0c248a78fdc8e19f=function(t){const n=cn(t).value;return ai(n)},e.wbg.__wbg_iterator_db7ca081358d4fb2=function(){return ai(Symbol.iterator)},e.wbg.__wbg_get_7b48513de5dc5ea4=function(){return mc(function(t,n){const i=Reflect.get(cn(t),cn(n));return ai(i)},arguments)},e.wbg.__wbg_call_90c26b09837aba1c=function(){return mc(function(t,n){const i=cn(t).call(cn(n));return ai(i)},arguments)},e.wbg.__wbg_self_f0e34d89f33b99fd=function(){return mc(function(){const t=self.self;return ai(t)},arguments)},e.wbg.__wbg_window_d3b084224f4774d7=function(){return mc(function(){const t=window.window;return ai(t)},arguments)},e.wbg.__wbg_globalThis_9caa27ff917c6860=function(){return mc(function(){const t=globalThis.globalThis;return ai(t)},arguments)},e.wbg.__wbg_global_35dfdd59a4da3e74=function(){return mc(function(){const t=global.global;return ai(t)},arguments)},e.wbg.__wbg_isArray_74fb723e24f76012=function(t){return Array.isArray(cn(t))},e.wbg.__wbg_instanceof_ArrayBuffer_e7d53d51371448e2=function(t){let n;try{n=cn(t)instanceof ArrayBuffer}catch{n=!1}return n},e.wbg.__wbg_isSafeInteger_f93fde0dca9820f8=function(t){return Number.isSafeInteger(cn(t))},e.wbg.__wbg_entries_9e2e2aa45aa5094a=function(t){const n=Object.entries(cn(t));return ai(n)},e.wbg.__wbg_buffer_a448f833075b71ba=function(t){const n=cn(t).buffer;return ai(n)},e.wbg.__wbg_new_8f67e318f15d7254=function(t){const n=new Uint8Array(cn(t));return ai(n)},e.wbg.__wbg_set_2357bf09366ee480=function(t,n,i){cn(t).set(cn(n),i>>>0)},e.wbg.__wbg_length_1d25fa9e4ac21ce7=function(t){return cn(t).length},e.wbg.__wbg_instanceof_Uint8Array_bced6f43aed8c1aa=function(t){let n;try{n=cn(t)instanceof Uint8Array}catch{n=!1}return n},e.wbg.__wbindgen_bigint_get_as_i64=function(t,n){const i=cn(n),r=typeof i=="bigint"?i:void 0;ZS()[t/8+1]=Ph(r)?BigInt(0):r,Je()[t/4+0]=!Ph(r)},e.wbg.__wbindgen_debug_string=function(t,n){const i=ny(cn(n)),r=Vl(i,me.__wbindgen_malloc,me.__wbindgen_realloc),l=Ls;Je()[t/4+1]=l,Je()[t/4+0]=r},e.wbg.__wbindgen_throw=function(t,n){throw new Error(ea(t,n))},e.wbg.__wbindgen_memory=function(){const t=me.memory;return ai(t)},e}function JS(e,t){return me=e.exports,Yb.__wbindgen_wasm_module=t,Mp=null,Lp=null,Tp=null,Cp=null,me}async function Yb(e){if(me!==void 0)return me;typeof e>"u"&&(e="/ltn/assets/backend_bg.wasm");const t=KS();(typeof e=="string"||typeof Request=="function"&&e instanceof Request||typeof URL=="function"&&e instanceof URL)&&(e=fetch(e));const{instance:n,module:i}=await YS(await e,t);return JS(n,i)}let Xe;const Kb=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&Kb.decode();let Pp=null;function Fp(){return(Pp===null||Pp.byteLength===0)&&(Pp=new Uint8Array(Xe.memory.buffer)),Pp}function Gl(e,t){return e=e>>>0,Kb.decode(Fp().subarray(e,e+t))}const jl=new Array(128).fill(void 0);jl.push(void 0,null,!0,!1);let Bp=jl.length;function Fr(e){Bp===jl.length&&jl.push(jl.length+1);const t=Bp;return Bp=jl[t],jl[t]=e,t}function Ln(e){return jl[e]}function QS(e){e<132||(jl[e]=Bp,Bp=e)}function Um(e){const t=Ln(e);return QS(e),t}function q_(e){return e==null}let kp=null;function tE(){return(kp===null||kp.byteLength===0)&&(kp=new Float64Array(Xe.memory.buffer)),kp}let Ap=null;function Li(){return(Ap===null||Ap.byteLength===0)&&(Ap=new Int32Array(Xe.memory.buffer)),Ap}let Mu=0;const Gm=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},eE=typeof Gm.encodeInto=="function"?function(e,t){return Gm.encodeInto(e,t)}:function(e,t){const n=Gm.encode(e);return t.set(n),{read:e.length,written:n.length}};function Mm(e,t,n){if(n===void 0){const a=Gm.encode(e),_=t(a.length,1)>>>0;return Fp().subarray(_,_+a.length).set(a),Mu=a.length,_}let i=e.length,r=t(i,1)>>>0;const l=Fp();let f=0;for(;f<i;f++){const a=e.charCodeAt(f);if(a>127)break;l[r+f]=a}if(f!==i){f!==0&&(e=e.slice(f)),r=n(r,i,i=f+e.length*3,1)>>>0;const a=Fp().subarray(r+f,r+i),_=eE(e,a);f+=_.written}return Mu=f,r}function iy(e){const t=typeof e;if(t=="number"||t=="boolean"||e==null)return`${e}`;if(t=="string")return`"${e}"`;if(t=="symbol"){const r=e.description;return r==null?"Symbol":`Symbol(${r})`}if(t=="function"){const r=e.name;return typeof r=="string"&&r.length>0?`Function(${r})`:"Function"}if(Array.isArray(e)){const r=e.length;let l="[";r>0&&(l+=iy(e[0]));for(let f=1;f<r;f++)l+=", "+iy(e[f]);return l+="]",l}const n=/\[object ([^\]]+)\]/.exec(toString.call(e));let i;if(n.length>1)i=n[1];else return toString.call(e);if(i=="Object")try{return"Object("+JSON.stringify(e)+")"}catch{return"Object"}return e instanceof Error?`${e.name}: ${e.message}
${e.stack}`:i}function nE(e,t){const n=t(e.length*1,1)>>>0;return Fp().set(e,n/1),Mu=e.length,n}function Z_(e,t){try{return e.apply(this,t)}catch(n){Xe.__wbindgen_exn_store(Fr(n))}}class Wm{static __wrap(t){t=t>>>0;const n=Object.create(Wm.prototype);return n.__wbg_ptr=t,n}__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,t}free(){const t=this.__destroy_into_raw();Xe.__wbg_jsroutesnapper_free(t)}constructor(t){try{const l=Xe.__wbindgen_add_to_stack_pointer(-16),f=nE(t,Xe.__wbindgen_malloc),a=Mu;Xe.jsroutesnapper_new(l,f,a);var n=Li()[l/4+0],i=Li()[l/4+1],r=Li()[l/4+2];if(r)throw Um(i);return Wm.__wrap(n)}finally{Xe.__wbindgen_add_to_stack_pointer(16)}}setRouteConfig(t){Xe.jsroutesnapper_setRouteConfig(this.__wbg_ptr,Fr(t))}setAreaMode(){Xe.jsroutesnapper_setAreaMode(this.__wbg_ptr)}getConfig(){let t,n;try{const l=Xe.__wbindgen_add_to_stack_pointer(-16);Xe.jsroutesnapper_getConfig(l,this.__wbg_ptr);var i=Li()[l/4+0],r=Li()[l/4+1];return t=i,n=r,Gl(i,r)}finally{Xe.__wbindgen_add_to_stack_pointer(16),Xe.__wbindgen_free(t,n,1)}}toFinalFeature(){try{const i=Xe.__wbindgen_add_to_stack_pointer(-16);Xe.jsroutesnapper_toFinalFeature(i,this.__wbg_ptr);var t=Li()[i/4+0],n=Li()[i/4+1];let r;return t!==0&&(r=Gl(t,n).slice(),Xe.__wbindgen_free(t,n*1)),r}finally{Xe.__wbindgen_add_to_stack_pointer(16)}}renderGeojson(){let t,n;try{const l=Xe.__wbindgen_add_to_stack_pointer(-16);Xe.jsroutesnapper_renderGeojson(l,this.__wbg_ptr);var i=Li()[l/4+0],r=Li()[l/4+1];return t=i,n=r,Gl(i,r)}finally{Xe.__wbindgen_add_to_stack_pointer(16),Xe.__wbindgen_free(t,n,1)}}toggleSnapMode(){Xe.jsroutesnapper_toggleSnapMode(this.__wbg_ptr)}onMouseMove(t,n,i){return Xe.jsroutesnapper_onMouseMove(this.__wbg_ptr,t,n,i)!==0}onClick(){Xe.jsroutesnapper_onClick(this.__wbg_ptr)}onDragStart(){return Xe.jsroutesnapper_onDragStart(this.__wbg_ptr)!==0}onMouseUp(){return Xe.jsroutesnapper_onMouseUp(this.__wbg_ptr)!==0}clearState(){Xe.jsroutesnapper_clearState(this.__wbg_ptr)}editExisting(t){try{const r=Xe.__wbindgen_add_to_stack_pointer(-16);Xe.jsroutesnapper_editExisting(r,this.__wbg_ptr,Fr(t));var n=Li()[r/4+0],i=Li()[r/4+1];if(i)throw Um(n)}finally{Xe.__wbindgen_add_to_stack_pointer(16)}}debugRenderGraph(){let t,n;try{const l=Xe.__wbindgen_add_to_stack_pointer(-16);Xe.jsroutesnapper_debugRenderGraph(l,this.__wbg_ptr);var i=Li()[l/4+0],r=Li()[l/4+1];return t=i,n=r,Gl(i,r)}finally{Xe.__wbindgen_add_to_stack_pointer(16),Xe.__wbindgen_free(t,n,1)}}routeNameForWaypoints(t){let n,i;try{const S=Xe.__wbindgen_add_to_stack_pointer(-16);Xe.jsroutesnapper_routeNameForWaypoints(S,this.__wbg_ptr,Fr(t));var r=Li()[S/4+0],l=Li()[S/4+1],f=Li()[S/4+2],a=Li()[S/4+3],_=r,x=l;if(a)throw _=0,x=0,Um(f);return n=_,i=x,Gl(_,x)}finally{Xe.__wbindgen_add_to_stack_pointer(16),Xe.__wbindgen_free(n,i,1)}}addSnappedWaypoint(t,n){Xe.jsroutesnapper_addSnappedWaypoint(this.__wbg_ptr,t,n)}undo(){Xe.jsroutesnapper_undo(this.__wbg_ptr)}}async function iE(e,t){if(typeof Response=="function"&&e instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(e,t)}catch(i){if(e.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",i);else throw i}const n=await e.arrayBuffer();return await WebAssembly.instantiate(n,t)}else{const n=await WebAssembly.instantiate(e,t);return n instanceof WebAssembly.Instance?{instance:n,module:e}:n}}function rE(){const e={};return e.wbg={},e.wbg.__wbindgen_string_new=function(t,n){const i=Gl(t,n);return Fr(i)},e.wbg.__wbindgen_object_drop_ref=function(t){Um(t)},e.wbg.__wbindgen_error_new=function(t,n){const i=new Error(Gl(t,n));return Fr(i)},e.wbg.__wbindgen_is_object=function(t){const n=Ln(t);return typeof n=="object"&&n!==null},e.wbg.__wbindgen_is_undefined=function(t){return Ln(t)===void 0},e.wbg.__wbindgen_in=function(t,n){return Ln(t)in Ln(n)},e.wbg.__wbindgen_number_get=function(t,n){const i=Ln(n),r=typeof i=="number"?i:void 0;tE()[t/8+1]=q_(r)?0:r,Li()[t/4+0]=!q_(r)},e.wbg.__wbindgen_boolean_get=function(t){const n=Ln(t);return typeof n=="boolean"?n?1:0:2},e.wbg.__wbindgen_object_clone_ref=function(t){const n=Ln(t);return Fr(n)},e.wbg.__wbindgen_jsval_loose_eq=function(t,n){return Ln(t)==Ln(n)},e.wbg.__wbindgen_string_get=function(t,n){const i=Ln(n),r=typeof i=="string"?i:void 0;var l=q_(r)?0:Mm(r,Xe.__wbindgen_malloc,Xe.__wbindgen_realloc),f=Mu;Li()[t/4+1]=f,Li()[t/4+0]=l},e.wbg.__wbg_String_4370c5505c674d30=function(t,n){const i=String(Ln(n)),r=Mm(i,Xe.__wbindgen_malloc,Xe.__wbindgen_realloc),l=Mu;Li()[t/4+1]=l,Li()[t/4+0]=r},e.wbg.__wbg_getwithrefkey_d1f0d12f1f1b63ea=function(t,n){const i=Ln(t)[Ln(n)];return Fr(i)},e.wbg.__wbg_new_abda76e883ba8a5f=function(){const t=new Error;return Fr(t)},e.wbg.__wbg_stack_658279fe44541cf6=function(t,n){const i=Ln(n).stack,r=Mm(i,Xe.__wbindgen_malloc,Xe.__wbindgen_realloc),l=Mu;Li()[t/4+1]=l,Li()[t/4+0]=r},e.wbg.__wbg_error_f851667af71bcfc6=function(t,n){let i,r;try{i=t,r=n,console.error(Gl(t,n))}finally{Xe.__wbindgen_free(i,r,1)}},e.wbg.__wbg_debug_9a6b3243fbbebb61=function(t){console.debug(Ln(t))},e.wbg.__wbg_error_788ae33f81d3b84b=function(t){console.error(Ln(t))},e.wbg.__wbg_info_2e30e8204b29d91d=function(t){console.info(Ln(t))},e.wbg.__wbg_log_1d3ae0273d8f4f8a=function(t){console.log(Ln(t))},e.wbg.__wbg_warn_d60e832f9882c1b2=function(t){console.warn(Ln(t))},e.wbg.__wbg_get_44be0491f933a435=function(t,n){const i=Ln(t)[n>>>0];return Fr(i)},e.wbg.__wbg_length_fff51ee6522a1a18=function(t){return Ln(t).length},e.wbg.__wbindgen_is_function=function(t){return typeof Ln(t)=="function"},e.wbg.__wbg_next_526fc47e980da008=function(t){const n=Ln(t).next;return Fr(n)},e.wbg.__wbg_next_ddb3312ca1c4e32a=function(){return Z_(function(t){const n=Ln(t).next();return Fr(n)},arguments)},e.wbg.__wbg_done_5c1f01fb660d73b5=function(t){return Ln(t).done},e.wbg.__wbg_value_1695675138684bd5=function(t){const n=Ln(t).value;return Fr(n)},e.wbg.__wbg_iterator_97f0c81209c6c35a=function(){return Fr(Symbol.iterator)},e.wbg.__wbg_get_97b561fb56f034b5=function(){return Z_(function(t,n){const i=Reflect.get(Ln(t),Ln(n));return Fr(i)},arguments)},e.wbg.__wbg_call_cb65541d95d71282=function(){return Z_(function(t,n){const i=Ln(t).call(Ln(n));return Fr(i)},arguments)},e.wbg.__wbg_isArray_4c24b343cb13cfb1=function(t){return Array.isArray(Ln(t))},e.wbg.__wbg_instanceof_ArrayBuffer_39ac22089b74fddb=function(t){let n;try{n=Ln(t)instanceof ArrayBuffer}catch{n=!1}return n},e.wbg.__wbg_buffer_085ec1f694018c4f=function(t){const n=Ln(t).buffer;return Fr(n)},e.wbg.__wbg_new_8125e318e6245eed=function(t){const n=new Uint8Array(Ln(t));return Fr(n)},e.wbg.__wbg_set_5cf90238115182c3=function(t,n,i){Ln(t).set(Ln(n),i>>>0)},e.wbg.__wbg_length_72e2208bbc0efc61=function(t){return Ln(t).length},e.wbg.__wbg_instanceof_Uint8Array_d8d9cb2b8e8ac1d4=function(t){let n;try{n=Ln(t)instanceof Uint8Array}catch{n=!1}return n},e.wbg.__wbindgen_debug_string=function(t,n){const i=iy(Ln(n)),r=Mm(i,Xe.__wbindgen_malloc,Xe.__wbindgen_realloc),l=Mu;Li()[t/4+1]=l,Li()[t/4+0]=r},e.wbg.__wbindgen_throw=function(t,n){throw new Error(Gl(t,n))},e.wbg.__wbindgen_memory=function(){const t=Xe.memory;return Fr(t)},e}function oE(e,t){return Xe=e.exports,Jb.__wbindgen_wasm_module=t,kp=null,Ap=null,Pp=null,Xe}async function Jb(e){if(Xe!==void 0)return Xe;typeof e>"u"&&(e="/ltn/assets/route_snapper_bg.wasm");const t=rE();(typeof e=="string"||typeof Request=="function"&&e instanceof Request||typeof URL=="function"&&e instanceof URL)&&(e=fetch(e));const{instance:n,module:i}=await iE(await e,t);return oE(n,i)}const Ch=[];function $_(e,t){return{subscribe:li(e,t).subscribe}}function li(e,t=Ie){let n;const i=new Set;function r(a){if(He(e,a)&&(e=a,n)){const _=!Ch.length;for(const x of i)x[1](),Ch.push(x,e);if(_){for(let x=0;x<Ch.length;x+=2)Ch[x][0](Ch[x+1]);Ch.length=0}}}function l(a){r(a(e))}function f(a,_=Ie){const x=[a,_];return i.add(x),i.size===1&&(n=t(r,l)||Ie),a(e),()=>{i.delete(x),i.size===0&&n&&(n(),n=null)}}return{set:r,update:l,subscribe:f}}let sE=Date.now();function of(e){return`${e}-${sE++}`}const Ly=Symbol.for("svelte-maplibre");function sf(){return DS(Ly)}function aE(e){let t=new WeakMap;return n=>{var f;let i=t.get(n.originalEvent);if(i!==void 0)return i;let l=(f=n.target.queryRenderedFeatures(n.point).find(a=>{var _;return(_=e.get(a.layer.id))==null?void 0:_.interactive}))==null?void 0:f.layer.id;return t.set(n.originalEvent,l),l}}function lE(){let e=new Map;return jb(Ly,{map:li(null),source:$_(null),layer:$_(null),popupTarget:$_(null),cluster:li(),loadedImages:li(new Set),minzoom:li(0),maxzoom:li(24),layerEvent:li(null),layerInfo:e,eventTopMost:aE(e)})}function Vv(e){return{subscribe:e.subscribe}}function My({key:e,setPopupTarget:t=!1,setCluster:n=!1,setMouseEvent:i=!1}){let r=sf(),l=li(null),f=Vv(l),a={...r,[e]:Vv(l)};if(t&&(a.popupTarget=f),i){let _=li(null);a.layerEvent=_,r.layerEvent=_}return n&&(a.cluster=li()),jb(Ly,a),{...r,self:l}}function uE(){return My({key:"source",setCluster:!0})}function cE(e=!0){return My({key:"layer",setPopupTarget:e,setMouseEvent:e})}function hE(){return My({key:"popupTarget",setPopupTarget:!0,setMouseEvent:!0})}function fE(e){return"layerType"in e&&e.layerType==="deckgl"}var Qb=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function tx(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function ex(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var n=function i(){return this instanceof i?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};n.prototype=t.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(e).forEach(function(i){var r=Object.getOwnPropertyDescriptor(e,i);Object.defineProperty(n,i,r.get?r:{enumerable:!0,get:function(){return e[i]}})}),n}var nx={exports:{}};(function(e,t){(function(n,i){e.exports=i()})(Qb,function(){var n,i,r;function l(a,_){if(!n)n=_;else if(!i)i=_;else{var x="var sharedChunk = {}; ("+n+")(sharedChunk); ("+i+")(sharedChunk);",S={};n(S),r=_(S),typeof window<"u"&&(r.workerUrl=window.URL.createObjectURL(new Blob([x],{type:"text/javascript"})))}}l(["exports"],function(a){function _(u,o,c,p){return new(c||(c=Promise))(function(m,v){function w(k){try{T(p.next(k))}catch(D){v(D)}}function E(k){try{T(p.throw(k))}catch(D){v(D)}}function T(k){var D;k.done?m(k.value):(D=k.value,D instanceof c?D:new c(function(F){F(D)})).then(w,E)}T((p=p.apply(u,o||[])).next())})}function x(u){return u&&u.__esModule&&Object.prototype.hasOwnProperty.call(u,"default")?u.default:u}typeof SuppressedError=="function"&&SuppressedError;var S=L;function L(u,o){this.x=u,this.y=o}L.prototype={clone:function(){return new L(this.x,this.y)},add:function(u){return this.clone()._add(u)},sub:function(u){return this.clone()._sub(u)},multByPoint:function(u){return this.clone()._multByPoint(u)},divByPoint:function(u){return this.clone()._divByPoint(u)},mult:function(u){return this.clone()._mult(u)},div:function(u){return this.clone()._div(u)},rotate:function(u){return this.clone()._rotate(u)},rotateAround:function(u,o){return this.clone()._rotateAround(u,o)},matMult:function(u){return this.clone()._matMult(u)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(u){return this.x===u.x&&this.y===u.y},dist:function(u){return Math.sqrt(this.distSqr(u))},distSqr:function(u){var o=u.x-this.x,c=u.y-this.y;return o*o+c*c},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(u){return Math.atan2(this.y-u.y,this.x-u.x)},angleWith:function(u){return this.angleWithSep(u.x,u.y)},angleWithSep:function(u,o){return Math.atan2(this.x*o-this.y*u,this.x*u+this.y*o)},_matMult:function(u){var o=u[2]*this.x+u[3]*this.y;return this.x=u[0]*this.x+u[1]*this.y,this.y=o,this},_add:function(u){return this.x+=u.x,this.y+=u.y,this},_sub:function(u){return this.x-=u.x,this.y-=u.y,this},_mult:function(u){return this.x*=u,this.y*=u,this},_div:function(u){return this.x/=u,this.y/=u,this},_multByPoint:function(u){return this.x*=u.x,this.y*=u.y,this},_divByPoint:function(u){return this.x/=u.x,this.y/=u.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var u=this.y;return this.y=this.x,this.x=-u,this},_rotate:function(u){var o=Math.cos(u),c=Math.sin(u),p=c*this.x+o*this.y;return this.x=o*this.x-c*this.y,this.y=p,this},_rotateAround:function(u,o){var c=Math.cos(u),p=Math.sin(u),m=o.y+p*(this.x-o.x)+c*(this.y-o.y);return this.x=o.x+c*(this.x-o.x)-p*(this.y-o.y),this.y=m,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},L.convert=function(u){return u instanceof L?u:Array.isArray(u)?new L(u[0],u[1]):u};var A=x(S),P=O;function O(u,o,c,p){this.cx=3*u,this.bx=3*(c-u)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*o,this.by=3*(p-o)-this.cy,this.ay=1-this.cy-this.by,this.p1x=u,this.p1y=o,this.p2x=c,this.p2y=p}O.prototype={sampleCurveX:function(u){return((this.ax*u+this.bx)*u+this.cx)*u},sampleCurveY:function(u){return((this.ay*u+this.by)*u+this.cy)*u},sampleCurveDerivativeX:function(u){return(3*this.ax*u+2*this.bx)*u+this.cx},solveCurveX:function(u,o){if(o===void 0&&(o=1e-6),u<0)return 0;if(u>1)return 1;for(var c=u,p=0;p<8;p++){var m=this.sampleCurveX(c)-u;if(Math.abs(m)<o)return c;var v=this.sampleCurveDerivativeX(c);if(Math.abs(v)<1e-6)break;c-=m/v}var w=0,E=1;for(c=u,p=0;p<20&&(m=this.sampleCurveX(c),!(Math.abs(m-u)<o));p++)u>m?w=c:E=c,c=.5*(E-w)+w;return c},solve:function(u,o){return this.sampleCurveY(this.solveCurveX(u,o))}};var B=x(P);let U,Y;function V(){return U==null&&(U=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),U}function $(){if(Y==null&&(Y=!1,V())){const o=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(o){for(let p=0;p<5*5;p++){const m=4*p;o.fillStyle=`rgb(${m},${m+1},${m+2})`,o.fillRect(p%5,Math.floor(p/5),1,1)}const c=o.getImageData(0,0,5,5).data;for(let p=0;p<5*5*4;p++)if(p%4!=3&&c[p]!==p){Y=!0;break}}}return Y||!1}function K(u,o,c,p){const m=new B(u,o,c,p);return function(v){return m.solve(v)}}const it=K(.25,.1,.25,1);function ft(u,o,c){return Math.min(c,Math.max(o,u))}function pt(u,o,c){const p=c-o,m=((u-o)%p+p)%p+o;return m===o?c:m}function gt(u,...o){for(const c of o)for(const p in c)u[p]=c[p];return u}let ut=1;function St(u,o,c){const p={};for(const m in u)p[m]=o.call(c||this,u[m],m,u);return p}function _t(u,o,c){const p={};for(const m in u)o.call(c||this,u[m],m,u)&&(p[m]=u[m]);return p}function vt(u){return Array.isArray(u)?u.map(vt):typeof u=="object"&&u?St(u,vt):u}const ee={};function kt(u){ee[u]||(typeof console<"u"&&console.warn(u),ee[u]=!0)}function Gt(u,o,c){return(c.y-u.y)*(o.x-u.x)>(o.y-u.y)*(c.x-u.x)}function Qt(u){let o=0;for(let c,p,m=0,v=u.length,w=v-1;m<v;w=m++)c=u[m],p=u[w],o+=(p.x-c.x)*(c.y+p.y);return o}function se(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}let Ce=null;function yn(u){return typeof ImageBitmap<"u"&&u instanceof ImageBitmap}const jn="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Qe(u,o,c,p,m){return _(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const v=new VideoFrame(u,{timestamp:0});try{const w=v==null?void 0:v.format;if(!w||!w.startsWith("BGR")&&!w.startsWith("RGB"))throw new Error(`Unrecognized format ${w}`);const E=w.startsWith("BGR"),T=new Uint8ClampedArray(p*m*4);if(yield v.copyTo(T,function(k,D,F,j,X){const H=4*Math.max(-D,0),tt=(Math.max(0,F)-F)*j*4+H,lt=4*j,ht=Math.max(0,D),At=Math.max(0,F);return{rect:{x:ht,y:At,width:Math.min(k.width,D+j)-ht,height:Math.min(k.height,F+X)-At},layout:[{offset:tt,stride:lt}]}}(u,o,c,p,m)),E)for(let k=0;k<T.length;k+=4){const D=T[k];T[k]=T[k+2],T[k+2]=D}return T}finally{v.close()}})}let Fe,ke,fn,Kn;const qn={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(u){const o=requestAnimationFrame(u);return{cancel:()=>cancelAnimationFrame(o)}},getImageData(u,o=0){return this.getImageCanvasContext(u).getImageData(-o,-o,u.width+2*o,u.height+2*o)},getImageCanvasContext(u){const o=window.document.createElement("canvas"),c=o.getContext("2d",{willReadFrequently:!0});if(!c)throw new Error("failed to create canvas 2d context");return o.width=u.width,o.height=u.height,c.drawImage(u,0,0,u.width,u.height),c},resolveURL:u=>(fn||(fn=document.createElement("a")),fn.href=u,fn.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(Kn==null&&(Kn=matchMedia("(prefers-reduced-motion: reduce)")),Kn.matches)}},re={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};class De extends Error{constructor(o,c,p,m){super(`AJAXError: ${c} (${o}): ${p}`),this.status=o,this.statusText=c,this.url=p,this.body=m}}const hn=se()?()=>self.worker&&self.worker.referrer:()=>(window.location.protocol==="blob:"?window.parent:window).location.href,On=u=>re.REGISTERED_PROTOCOLS[u.substring(0,u.indexOf("://"))];function yi(u,o){const c=new AbortController,p=new Request(u.url,{method:u.method||"GET",body:u.body,credentials:u.credentials,headers:u.headers,cache:u.cache,referrer:hn(),signal:c.signal});let m=!1,v=!1;return u.type==="json"&&p.headers.set("Accept","application/json"),v||fetch(p).then(w=>w.ok?(E=>{(u.type==="arrayBuffer"||u.type==="image"?E.arrayBuffer():u.type==="json"?E.json():E.text()).then(T=>{v||(m=!0,o(null,T,E.headers.get("Cache-Control"),E.headers.get("Expires")))}).catch(T=>{v||o(new Error(T.message))})})(w):w.blob().then(E=>o(new De(w.status,w.statusText,u.url,E)))).catch(w=>{w.code!==20&&o(new Error(w.message))}),{cancel:()=>{v=!0,m||c.abort()}}}const wn=function(u,o){if(/:\/\//.test(u.url)&&!/^https?:|^file:/.test(u.url)){if(se()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",u,o);if(!se())return(On(u.url)||yi)(u,o)}if(!(/^file:/.test(c=u.url)||/^file:/.test(hn())&&!/^\w+:/.test(c))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return yi(u,o);if(se()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",u,o,void 0,!0)}var c;return function(p,m){const v=new XMLHttpRequest;v.open(p.method||"GET",p.url,!0),p.type!=="arrayBuffer"&&p.type!=="image"||(v.responseType="arraybuffer");for(const w in p.headers)v.setRequestHeader(w,p.headers[w]);return p.type==="json"&&(v.responseType="text",v.setRequestHeader("Accept","application/json")),v.withCredentials=p.credentials==="include",v.onerror=()=>{m(new Error(v.statusText))},v.onload=()=>{if((v.status>=200&&v.status<300||v.status===0)&&v.response!==null){let w=v.response;if(p.type==="json")try{w=JSON.parse(v.response)}catch(E){return m(E)}m(null,w,v.getResponseHeader("Cache-Control"),v.getResponseHeader("Expires"))}else{const w=new Blob([v.response],{type:v.getResponseHeader("Content-Type")});m(new De(v.status,v.statusText,p.url,w))}},v.send(p.body),{cancel:()=>v.abort()}}(u,o)},yt=function(u,o){return wn(gt(u,{type:"arrayBuffer"}),o)};function Ee(u){if(!u||u.indexOf("://")<=0||u.indexOf("data:image/")===0||u.indexOf("blob:")===0)return!0;const o=new URL(u),c=window.location;return o.protocol===c.protocol&&o.host===c.host}function qe(u,o,c){c[u]&&c[u].indexOf(o)!==-1||(c[u]=c[u]||[],c[u].push(o))}function nr(u,o,c){if(c&&c[u]){const p=c[u].indexOf(o);p!==-1&&c[u].splice(p,1)}}class Wn{constructor(o,c={}){gt(this,c),this.type=o}}class pn extends Wn{constructor(o,c={}){super("error",gt({error:o},c))}}class Wi{on(o,c){return this._listeners=this._listeners||{},qe(o,c,this._listeners),this}off(o,c){return nr(o,c,this._listeners),nr(o,c,this._oneTimeListeners),this}once(o,c){return c?(this._oneTimeListeners=this._oneTimeListeners||{},qe(o,c,this._oneTimeListeners),this):new Promise(p=>this.once(o,p))}fire(o,c){typeof o=="string"&&(o=new Wn(o,c||{}));const p=o.type;if(this.listens(p)){o.target=this;const m=this._listeners&&this._listeners[p]?this._listeners[p].slice():[];for(const E of m)E.call(this,o);const v=this._oneTimeListeners&&this._oneTimeListeners[p]?this._oneTimeListeners[p].slice():[];for(const E of v)nr(p,E,this._oneTimeListeners),E.call(this,o);const w=this._eventedParent;w&&(gt(o,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),w.fire(o))}else o instanceof pn&&console.error(o.error);return this}listens(o){return this._listeners&&this._listeners[o]&&this._listeners[o].length>0||this._oneTimeListeners&&this._oneTimeListeners[o]&&this._oneTimeListeners[o].length>0||this._eventedParent&&this._eventedParent.listens(o)}setEventedParent(o,c){return this._eventedParent=o,this._eventedParentData=c,this}}var $t={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const Vi=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function fr(u,o){const c={};for(const p in u)p!=="ref"&&(c[p]=u[p]);return Vi.forEach(p=>{p in o&&(c[p]=o[p])}),c}function zn(u,o){if(Array.isArray(u)){if(!Array.isArray(o)||u.length!==o.length)return!1;for(let c=0;c<u.length;c++)if(!zn(u[c],o[c]))return!1;return!0}if(typeof u=="object"&&u!==null&&o!==null){if(typeof o!="object"||Object.keys(u).length!==Object.keys(o).length)return!1;for(const c in u)if(!zn(u[c],o[c]))return!1;return!0}return u===o}const In={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function es(u,o,c){c.push({command:In.addSource,args:[u,o[u]]})}function oo(u,o,c){o.push({command:In.removeSource,args:[u]}),c[u]=!0}function ns(u,o,c,p){oo(u,c,p),es(u,o,c)}function Ha(u,o,c){let p;for(p in u[c])if(Object.prototype.hasOwnProperty.call(u[c],p)&&p!=="data"&&!zn(u[c][p],o[c][p]))return!1;for(p in o[c])if(Object.prototype.hasOwnProperty.call(o[c],p)&&p!=="data"&&!zn(u[c][p],o[c][p]))return!1;return!0}function Gs(u,o,c,p,m,v){let w;for(w in o=o||{},u=u||{})Object.prototype.hasOwnProperty.call(u,w)&&(zn(u[w],o[w])||c.push({command:v,args:[p,w,o[w],m]}));for(w in o)Object.prototype.hasOwnProperty.call(o,w)&&!Object.prototype.hasOwnProperty.call(u,w)&&(zn(u[w],o[w])||c.push({command:v,args:[p,w,o[w],m]}))}function js(u){return u.id}function Sa(u,o){return u[o.id]=o,u}class le{constructor(o,c,p,m){this.message=(o?`${o}: `:"")+p,m&&(this.identifier=m),c!=null&&c.__line__&&(this.line=c.__line__)}}function yo(u,...o){for(const c of o)for(const p in c)u[p]=c[p];return u}class ri extends Error{constructor(o,c){super(c),this.message=c,this.key=o}}class Ea{constructor(o,c=[]){this.parent=o,this.bindings={};for(const[p,m]of c)this.bindings[p]=m}concat(o){return new Ea(this,o)}get(o){if(this.bindings[o])return this.bindings[o];if(this.parent)return this.parent.get(o);throw new Error(`${o} not found in scope.`)}has(o){return!!this.bindings[o]||!!this.parent&&this.parent.has(o)}}const ws={kind:"null"},ce={kind:"number"},ln={kind:"string"},Ke={kind:"boolean"},Ar={kind:"color"},is={kind:"object"},on={kind:"value"},Ss={kind:"collator"},st={kind:"formatted"},G={kind:"padding"},q={kind:"resolvedImage"},J={kind:"variableAnchorOffsetCollection"};function Z(u,o){return{kind:"array",itemType:u,N:o}}function ot(u){if(u.kind==="array"){const o=ot(u.itemType);return typeof u.N=="number"?`array<${o}, ${u.N}>`:u.itemType.kind==="value"?"array":`array<${o}>`}return u.kind}const Mt=[ws,ce,ln,Ke,Ar,st,is,Z(on),G,q,J];function bt(u,o){if(o.kind==="error")return null;if(u.kind==="array"){if(o.kind==="array"&&(o.N===0&&o.itemType.kind==="value"||!bt(u.itemType,o.itemType))&&(typeof u.N!="number"||u.N===o.N))return null}else{if(u.kind===o.kind)return null;if(u.kind==="value"){for(const c of Mt)if(!bt(c,o))return null}}return`Expected ${ot(u)} but found ${ot(o)} instead.`}function rt(u,o){return o.some(c=>c.kind===u.kind)}function Tt(u,o){return o.some(c=>c==="null"?u===null:c==="array"?Array.isArray(u):c==="object"?u&&!Array.isArray(u)&&typeof u=="object":c===typeof u)}function Wt(u,o){return u.kind==="array"&&o.kind==="array"?u.itemType.kind===o.itemType.kind&&typeof u.N=="number":u.kind===o.kind}const Ht=.96422,Kt=.82521,Ne=4/29,Ye=6/29,Te=3*Ye*Ye,Ve=Ye*Ye*Ye,rn=Math.PI/180,Gn=180/Math.PI;function Jn(u){return(u%=360)<0&&(u+=360),u}function kn([u,o,c,p]){let m,v;const w=qr((.2225045*(u=Pn(u))+.7168786*(o=Pn(o))+.0606169*(c=Pn(c)))/1);u===o&&o===c?m=v=w:(m=qr((.4360747*u+.3850649*o+.1430804*c)/Ht),v=qr((.0139322*u+.0971045*o+.7141733*c)/Kt));const E=116*w-16;return[E<0?0:E,500*(m-w),200*(w-v),p]}function Pn(u){return u<=.04045?u/12.92:Math.pow((u+.055)/1.055,2.4)}function qr(u){return u>Ve?Math.pow(u,1/3):u/Te+Ne}function oi([u,o,c,p]){let m=(u+16)/116,v=isNaN(o)?m:m+o/500,w=isNaN(c)?m:m-c/200;return m=1*Nr(m),v=Ht*Nr(v),w=Kt*Nr(w),[ir(3.1338561*v-1.6168667*m-.4906146*w),ir(-.9787684*v+1.9161415*m+.033454*w),ir(.0719453*v-.2289914*m+1.4052427*w),p]}function ir(u){return(u=u<=.00304?12.92*u:1.055*Math.pow(u,1/2.4)-.055)<0?0:u>1?1:u}function Nr(u){return u>Ye?u*u*u:Te*(u-Ne)}function rs(u){return parseInt(u.padEnd(2,u),16)/255}function xd(u,o){return ou(o?u/100:u,0,1)}function ou(u,o,c){return Math.min(Math.max(o,u),c)}function su(u){return!u.some(Number.isNaN)}const Og={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class Xn{constructor(o,c,p,m=1,v=!0){this.r=o,this.g=c,this.b=p,this.a=m,v||(this.r*=m,this.g*=m,this.b*=m,m||this.overwriteGetter("rgb",[o,c,p,m]))}static parse(o){if(o instanceof Xn)return o;if(typeof o!="string")return;const c=function(p){if((p=p.toLowerCase().trim())==="transparent")return[0,0,0,0];const m=Og[p];if(m){const[w,E,T]=m;return[w/255,E/255,T/255,1]}if(p.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(p)){const w=p.length<6?1:2;let E=1;return[rs(p.slice(E,E+=w)),rs(p.slice(E,E+=w)),rs(p.slice(E,E+=w)),rs(p.slice(E,E+w)||"ff")]}if(p.startsWith("rgb")){const w=p.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(w){const[E,T,k,D,F,j,X,H,tt,lt,ht,At]=w,Et=[D||" ",X||" ",lt].join("");if(Et==="  "||Et==="  /"||Et===",,"||Et===",,,"){const Nt=[k,j,tt].join(""),Ft=Nt==="%%%"?100:Nt===""?255:0;if(Ft){const Jt=[ou(+T/Ft,0,1),ou(+F/Ft,0,1),ou(+H/Ft,0,1),ht?xd(+ht,At):1];if(su(Jt))return Jt}}return}}const v=p.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(v){const[w,E,T,k,D,F,j,X,H]=v,tt=[T||" ",D||" ",j].join("");if(tt==="  "||tt==="  /"||tt===",,"||tt===",,,"){const lt=[+E,ou(+k,0,100),ou(+F,0,100),X?xd(+X,H):1];if(su(lt))return function([ht,At,Et,Nt]){function Ft(Jt){const ve=(Jt+ht/30)%12,Me=At*Math.min(Et,1-Et);return Et-Me*Math.max(-1,Math.min(ve-3,9-ve,1))}return ht=Jn(ht),At/=100,Et/=100,[Ft(0),Ft(8),Ft(4),Nt]}(lt)}}}(o);return c?new Xn(...c,!1):void 0}get rgb(){const{r:o,g:c,b:p,a:m}=this,v=m||1/0;return this.overwriteGetter("rgb",[o/v,c/v,p/v,m])}get hcl(){return this.overwriteGetter("hcl",function(o){const[c,p,m,v]=kn(o),w=Math.sqrt(p*p+m*m);return[Math.round(1e4*w)?Jn(Math.atan2(m,p)*Gn):NaN,w,c,v]}(this.rgb))}get lab(){return this.overwriteGetter("lab",kn(this.rgb))}overwriteGetter(o,c){return Object.defineProperty(this,o,{value:c}),c}toString(){const[o,c,p,m]=this.rgb;return`rgba(${[o,c,p].map(v=>Math.round(255*v)).join(",")},${m})`}}Xn.black=new Xn(0,0,0,1),Xn.white=new Xn(1,1,1,1),Xn.transparent=new Xn(0,0,0,0),Xn.red=new Xn(1,0,0,1);class mf{constructor(o,c,p){this.sensitivity=o?c?"variant":"case":c?"accent":"base",this.locale=p,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(o,c){return this.collator.compare(o,c)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Vc{constructor(o,c,p,m,v){this.text=o,this.image=c,this.scale=p,this.fontStack=m,this.textColor=v}}class Zr{constructor(o){this.sections=o}static fromString(o){return new Zr([new Vc(o,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(o=>o.text.length!==0||o.image&&o.image.name.length!==0)}static factory(o){return o instanceof Zr?o:Zr.fromString(o)}toString(){return this.sections.length===0?"":this.sections.map(o=>o.text).join("")}}class Do{constructor(o){this.values=o.slice()}static parse(o){if(o instanceof Do)return o;if(typeof o=="number")return new Do([o,o,o,o]);if(Array.isArray(o)&&!(o.length<1||o.length>4)){for(const c of o)if(typeof c!="number")return;switch(o.length){case 1:o=[o[0],o[0],o[0],o[0]];break;case 2:o=[o[0],o[1],o[0],o[1]];break;case 3:o=[o[0],o[1],o[2],o[1]]}return new Do(o)}}toString(){return JSON.stringify(this.values)}}const zg=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class os{constructor(o){this.values=o.slice()}static parse(o){if(o instanceof os)return o;if(Array.isArray(o)&&!(o.length<1)&&o.length%2==0){for(let c=0;c<o.length;c+=2){const p=o[c],m=o[c+1];if(typeof p!="string"||!zg.has(p)||!Array.isArray(m)||m.length!==2||typeof m[0]!="number"||typeof m[1]!="number")return}return new os(o)}}toString(){return JSON.stringify(this.values)}}class Dr{constructor(o){this.name=o.name,this.available=o.available}toString(){return this.name}static fromString(o){return o?new Dr({name:o,available:!1}):null}}function Uc(u,o,c,p){return typeof u=="number"&&u>=0&&u<=255&&typeof o=="number"&&o>=0&&o<=255&&typeof c=="number"&&c>=0&&c<=255?p===void 0||typeof p=="number"&&p>=0&&p<=1?null:`Invalid rgba value [${[u,o,c,p].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof p=="number"?[u,o,c,p]:[u,o,c]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function au(u){if(u===null||typeof u=="string"||typeof u=="boolean"||typeof u=="number"||u instanceof Xn||u instanceof mf||u instanceof Zr||u instanceof Do||u instanceof os||u instanceof Dr)return!0;if(Array.isArray(u)){for(const o of u)if(!au(o))return!1;return!0}if(typeof u=="object"){for(const o in u)if(!au(u[o]))return!1;return!0}return!1}function Ei(u){if(u===null)return ws;if(typeof u=="string")return ln;if(typeof u=="boolean")return Ke;if(typeof u=="number")return ce;if(u instanceof Xn)return Ar;if(u instanceof mf)return Ss;if(u instanceof Zr)return st;if(u instanceof Do)return G;if(u instanceof os)return J;if(u instanceof Dr)return q;if(Array.isArray(u)){const o=u.length;let c;for(const p of u){const m=Ei(p);if(c){if(c===m)continue;c=on;break}c=m}return Z(c||on,o)}return is}function Fn(u){const o=typeof u;return u===null?"":o==="string"||o==="number"||o==="boolean"?String(u):u instanceof Xn||u instanceof Zr||u instanceof Do||u instanceof os||u instanceof Dr?u.toString():JSON.stringify(u)}class Sl{constructor(o,c){this.type=o,this.value=c}static parse(o,c){if(o.length!==2)return c.error(`'literal' expression requires exactly one argument, but found ${o.length-1} instead.`);if(!au(o[1]))return c.error("invalid value");const p=o[1];let m=Ei(p);const v=c.expectedType;return m.kind!=="array"||m.N!==0||!v||v.kind!=="array"||typeof v.N=="number"&&v.N!==0||(m=v),new Sl(m,p)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class Ai{constructor(o){this.name="ExpressionEvaluationError",this.message=o}toJSON(){return this.message}}const Gc={string:ln,number:ce,boolean:Ke,object:is};class ss{constructor(o,c){this.type=o,this.args=c}static parse(o,c){if(o.length<2)return c.error("Expected at least one argument.");let p,m=1;const v=o[0];if(v==="array"){let E,T;if(o.length>2){const k=o[1];if(typeof k!="string"||!(k in Gc)||k==="object")return c.error('The item type argument of "array" must be one of string, number, boolean',1);E=Gc[k],m++}else E=on;if(o.length>3){if(o[2]!==null&&(typeof o[2]!="number"||o[2]<0||o[2]!==Math.floor(o[2])))return c.error('The length argument to "array" must be a positive integer literal',2);T=o[2],m++}p=Z(E,T)}else{if(!Gc[v])throw new Error(`Types doesn't contain name = ${v}`);p=Gc[v]}const w=[];for(;m<o.length;m++){const E=c.parse(o[m],m,on);if(!E)return null;w.push(E)}return new ss(p,w)}evaluate(o){for(let c=0;c<this.args.length;c++){const p=this.args[c].evaluate(o);if(!bt(this.type,Ei(p)))return p;if(c===this.args.length-1)throw new Ai(`Expected value to be of type ${ot(this.type)}, but found ${ot(Ei(p))} instead.`)}throw new Error}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}}const gf={"to-boolean":Ke,"to-color":Ar,"to-number":ce,"to-string":ln};class Ya{constructor(o,c){this.type=o,this.args=c}static parse(o,c){if(o.length<2)return c.error("Expected at least one argument.");const p=o[0];if(!gf[p])throw new Error(`Can't parse ${p} as it is not part of the known types`);if((p==="to-boolean"||p==="to-string")&&o.length!==2)return c.error("Expected one argument.");const m=gf[p],v=[];for(let w=1;w<o.length;w++){const E=c.parse(o[w],w,on);if(!E)return null;v.push(E)}return new Ya(m,v)}evaluate(o){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(o);case"color":{let c,p;for(const m of this.args){if(c=m.evaluate(o),p=null,c instanceof Xn)return c;if(typeof c=="string"){const v=o.parseColor(c);if(v)return v}else if(Array.isArray(c)&&(p=c.length<3||c.length>4?`Invalid rbga value ${JSON.stringify(c)}: expected an array containing either three or four numeric values.`:Uc(c[0],c[1],c[2],c[3]),!p))return new Xn(c[0]/255,c[1]/255,c[2]/255,c[3])}throw new Ai(p||`Could not parse color from value '${typeof c=="string"?c:JSON.stringify(c)}'`)}case"padding":{let c;for(const p of this.args){c=p.evaluate(o);const m=Do.parse(c);if(m)return m}throw new Ai(`Could not parse padding from value '${typeof c=="string"?c:JSON.stringify(c)}'`)}case"variableAnchorOffsetCollection":{let c;for(const p of this.args){c=p.evaluate(o);const m=os.parse(c);if(m)return m}throw new Ai(`Could not parse variableAnchorOffsetCollection from value '${typeof c=="string"?c:JSON.stringify(c)}'`)}case"number":{let c=null;for(const p of this.args){if(c=p.evaluate(o),c===null)return 0;const m=Number(c);if(!isNaN(m))return m}throw new Ai(`Could not convert ${JSON.stringify(c)} to number.`)}case"formatted":return Zr.fromString(Fn(this.args[0].evaluate(o)));case"resolvedImage":return Dr.fromString(Fn(this.args[0].evaluate(o)));default:return Fn(this.args[0].evaluate(o))}}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}}const wd=["Unknown","Point","LineString","Polygon"];class _f{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?wd[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(o){let c=this._parseColorCache[o];return c||(c=this._parseColorCache[o]=Xn.parse(o)),c}}class jc{constructor(o,c,p=[],m,v=new Ea,w=[]){this.registry=o,this.path=p,this.key=p.map(E=>`[${E}]`).join(""),this.scope=v,this.errors=w,this.expectedType=m,this._isConstant=c}parse(o,c,p,m,v={}){return c?this.concat(c,p,m)._parse(o,v):this._parse(o,v)}_parse(o,c){function p(m,v,w){return w==="assert"?new ss(v,[m]):w==="coerce"?new Ya(v,[m]):m}if(o!==null&&typeof o!="string"&&typeof o!="boolean"&&typeof o!="number"||(o=["literal",o]),Array.isArray(o)){if(o.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const m=o[0];if(typeof m!="string")return this.error(`Expression name must be a string, but found ${typeof m} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const v=this.registry[m];if(v){let w=v.parse(o,this);if(!w)return null;if(this.expectedType){const E=this.expectedType,T=w.type;if(E.kind!=="string"&&E.kind!=="number"&&E.kind!=="boolean"&&E.kind!=="object"&&E.kind!=="array"||T.kind!=="value")if(E.kind!=="color"&&E.kind!=="formatted"&&E.kind!=="resolvedImage"||T.kind!=="value"&&T.kind!=="string")if(E.kind!=="padding"||T.kind!=="value"&&T.kind!=="number"&&T.kind!=="array")if(E.kind!=="variableAnchorOffsetCollection"||T.kind!=="value"&&T.kind!=="array"){if(this.checkSubtype(E,T))return null}else w=p(w,E,c.typeAnnotation||"coerce");else w=p(w,E,c.typeAnnotation||"coerce");else w=p(w,E,c.typeAnnotation||"coerce");else w=p(w,E,c.typeAnnotation||"assert")}if(!(w instanceof Sl)&&w.type.kind!=="resolvedImage"&&this._isConstant(w)){const E=new _f;try{w=new Sl(w.type,w.evaluate(E))}catch(T){return this.error(T.message),null}}return w}return this.error(`Unknown expression "${m}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(o===void 0?"'undefined' value invalid. Use null instead.":typeof o=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof o} instead.`)}concat(o,c,p){const m=typeof o=="number"?this.path.concat(o):this.path,v=p?this.scope.concat(p):this.scope;return new jc(this.registry,this._isConstant,m,c||null,v,this.errors)}error(o,...c){const p=`${this.key}${c.map(m=>`[${m}]`).join("")}`;this.errors.push(new ri(p,o))}checkSubtype(o,c){const p=bt(o,c);return p&&this.error(p),p}}class qc{constructor(o,c,p){this.type=Ss,this.locale=p,this.caseSensitive=o,this.diacriticSensitive=c}static parse(o,c){if(o.length!==2)return c.error("Expected one argument.");const p=o[1];if(typeof p!="object"||Array.isArray(p))return c.error("Collator options argument must be an object.");const m=c.parse(p["case-sensitive"]!==void 0&&p["case-sensitive"],1,Ke);if(!m)return null;const v=c.parse(p["diacritic-sensitive"]!==void 0&&p["diacritic-sensitive"],1,Ke);if(!v)return null;let w=null;return p.locale&&(w=c.parse(p.locale,1,ln),!w)?null:new qc(m,v,w)}evaluate(o){return new mf(this.caseSensitive.evaluate(o),this.diacriticSensitive.evaluate(o),this.locale?this.locale.evaluate(o):null)}eachChild(o){o(this.caseSensitive),o(this.diacriticSensitive),this.locale&&o(this.locale)}outputDefined(){return!1}}const Ka=8192;function yf(u,o){u[0]=Math.min(u[0],o[0]),u[1]=Math.min(u[1],o[1]),u[2]=Math.max(u[2],o[0]),u[3]=Math.max(u[3],o[1])}function Xu(u,o){return!(u[0]<=o[0]||u[2]>=o[2]||u[1]<=o[1]||u[3]>=o[3])}function Sd(u,o){const c=(180+u[0])/360,p=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+u[1]*Math.PI/360)))/360,m=Math.pow(2,o.z);return[Math.round(c*m*Ka),Math.round(p*m*Ka)]}function Fg(u,o,c){const p=u[0]-o[0],m=u[1]-o[1],v=u[0]-c[0],w=u[1]-c[1];return p*w-v*m==0&&p*v<=0&&m*w<=0}function vf(u,o){let c=!1;for(let w=0,E=o.length;w<E;w++){const T=o[w];for(let k=0,D=T.length;k<D-1;k++){if(Fg(u,T[k],T[k+1]))return!1;(m=T[k])[1]>(p=u)[1]!=(v=T[k+1])[1]>p[1]&&p[0]<(v[0]-m[0])*(p[1]-m[1])/(v[1]-m[1])+m[0]&&(c=!c)}}var p,m,v;return c}function bf(u,o){for(let c=0;c<o.length;c++)if(vf(u,o[c]))return!0;return!1}function Ed(u,o,c,p){const m=p[0]-c[0],v=p[1]-c[1],w=(u[0]-c[0])*v-m*(u[1]-c[1]),E=(o[0]-c[0])*v-m*(o[1]-c[1]);return w>0&&E<0||w<0&&E>0}function Bg(u,o,c){for(const k of c)for(let D=0;D<k.length-1;++D)if((E=[(w=k[D+1])[0]-(v=k[D])[0],w[1]-v[1]])[0]*(T=[(m=o)[0]-(p=u)[0],m[1]-p[1]])[1]-E[1]*T[0]!=0&&Ed(p,m,v,w)&&Ed(v,w,p,m))return!0;var p,m,v,w,E,T;return!1}function Id(u,o){for(let c=0;c<u.length;++c)if(!vf(u[c],o))return!1;for(let c=0;c<u.length-1;++c)if(Bg(u[c],u[c+1],o))return!1;return!0}function Cd(u,o){for(let c=0;c<o.length;c++)if(Id(u,o[c]))return!0;return!1}function Zc(u,o,c){const p=[];for(let m=0;m<u.length;m++){const v=[];for(let w=0;w<u[m].length;w++){const E=Sd(u[m][w],c);yf(o,E),v.push(E)}p.push(v)}return p}function Td(u,o,c){const p=[];for(let m=0;m<u.length;m++){const v=Zc(u[m],o,c);p.push(v)}return p}function Ld(u,o,c,p){if(u[0]<c[0]||u[0]>c[2]){const m=.5*p;let v=u[0]-c[0]>m?-p:c[0]-u[0]>m?p:0;v===0&&(v=u[0]-c[2]>m?-p:c[2]-u[0]>m?p:0),u[0]+=v}yf(o,u)}function xf(u,o,c,p){const m=Math.pow(2,p.z)*Ka,v=[p.x*Ka,p.y*Ka],w=[];for(const E of u)for(const T of E){const k=[T.x+v[0],T.y+v[1]];Ld(k,o,c,m),w.push(k)}return w}function wf(u,o,c,p){const m=Math.pow(2,p.z)*Ka,v=[p.x*Ka,p.y*Ka],w=[];for(const T of u){const k=[];for(const D of T){const F=[D.x+v[0],D.y+v[1]];yf(o,F),k.push(F)}w.push(k)}if(o[2]-o[0]<=m/2){(E=o)[0]=E[1]=1/0,E[2]=E[3]=-1/0;for(const T of w)for(const k of T)Ld(k,o,c,m)}var E;return w}class El{constructor(o,c){this.type=Ke,this.geojson=o,this.geometries=c}static parse(o,c){if(o.length!==2)return c.error(`'within' expression requires exactly one argument, but found ${o.length-1} instead.`);if(au(o[1])){const p=o[1];if(p.type==="FeatureCollection")for(let m=0;m<p.features.length;++m){const v=p.features[m].geometry.type;if(v==="Polygon"||v==="MultiPolygon")return new El(p,p.features[m].geometry)}else if(p.type==="Feature"){const m=p.geometry.type;if(m==="Polygon"||m==="MultiPolygon")return new El(p,p.geometry)}else if(p.type==="Polygon"||p.type==="MultiPolygon")return new El(p,p)}return c.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(o){if(o.geometry()!=null&&o.canonicalID()!=null){if(o.geometryType()==="Point")return function(c,p){const m=[1/0,1/0,-1/0,-1/0],v=[1/0,1/0,-1/0,-1/0],w=c.canonicalID();if(p.type==="Polygon"){const E=Zc(p.coordinates,v,w),T=xf(c.geometry(),m,v,w);if(!Xu(m,v))return!1;for(const k of T)if(!vf(k,E))return!1}if(p.type==="MultiPolygon"){const E=Td(p.coordinates,v,w),T=xf(c.geometry(),m,v,w);if(!Xu(m,v))return!1;for(const k of T)if(!bf(k,E))return!1}return!0}(o,this.geometries);if(o.geometryType()==="LineString")return function(c,p){const m=[1/0,1/0,-1/0,-1/0],v=[1/0,1/0,-1/0,-1/0],w=c.canonicalID();if(p.type==="Polygon"){const E=Zc(p.coordinates,v,w),T=wf(c.geometry(),m,v,w);if(!Xu(m,v))return!1;for(const k of T)if(!Id(k,E))return!1}if(p.type==="MultiPolygon"){const E=Td(p.coordinates,v,w),T=wf(c.geometry(),m,v,w);if(!Xu(m,v))return!1;for(const k of T)if(!Cd(k,E))return!1}return!0}(o,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class $c{constructor(o,c){this.type=c.type,this.name=o,this.boundExpression=c}static parse(o,c){if(o.length!==2||typeof o[1]!="string")return c.error("'var' expression requires exactly one string literal argument.");const p=o[1];return c.scope.has(p)?new $c(p,c.scope.get(p)):c.error(`Unknown variable "${p}". Make sure "${p}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(o){return this.boundExpression.evaluate(o)}eachChild(){}outputDefined(){return!1}}class as{constructor(o,c,p,m){this.name=o,this.type=c,this._evaluate=p,this.args=m}evaluate(o){return this._evaluate(o,this.args)}eachChild(o){this.args.forEach(o)}outputDefined(){return!1}static parse(o,c){const p=o[0],m=as.definitions[p];if(!m)return c.error(`Unknown expression "${p}". If you wanted a literal array, use ["literal", [...]].`,0);const v=Array.isArray(m)?m[0]:m.type,w=Array.isArray(m)?[[m[1],m[2]]]:m.overloads,E=w.filter(([k])=>!Array.isArray(k)||k.length===o.length-1);let T=null;for(const[k,D]of E){T=new jc(c.registry,Wc,c.path,null,c.scope);const F=[];let j=!1;for(let X=1;X<o.length;X++){const H=o[X],tt=Array.isArray(k)?k[X-1]:k.type,lt=T.parse(H,1+F.length,tt);if(!lt){j=!0;break}F.push(lt)}if(!j)if(Array.isArray(k)&&k.length!==F.length)T.error(`Expected ${k.length} arguments, but found ${F.length} instead.`);else{for(let X=0;X<F.length;X++){const H=Array.isArray(k)?k[X]:k.type,tt=F[X];T.concat(X+1).checkSubtype(H,tt.type)}if(T.errors.length===0)return new as(p,v,D,F)}}if(E.length===1)c.errors.push(...T.errors);else{const k=(E.length?E:w).map(([F])=>{return j=F,Array.isArray(j)?`(${j.map(ot).join(", ")})`:`(${ot(j.type)}...)`;var j}).join(" | "),D=[];for(let F=1;F<o.length;F++){const j=c.parse(o[F],1+D.length);if(!j)return null;D.push(ot(j.type))}c.error(`Expected arguments of type ${k}, but found (${D.join(", ")}) instead.`)}return null}static register(o,c){as.definitions=c;for(const p in c)o[p]=as}}function Wc(u){if(u instanceof $c)return Wc(u.boundExpression);if(u instanceof as&&u.name==="error"||u instanceof qc||u instanceof El)return!1;const o=u instanceof Ya||u instanceof ss;let c=!0;return u.eachChild(p=>{c=o?c&&Wc(p):c&&p instanceof Sl}),!!c&&Xc(u)&&Hc(u,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Xc(u){if(u instanceof as&&(u.name==="get"&&u.args.length===1||u.name==="feature-state"||u.name==="has"&&u.args.length===1||u.name==="properties"||u.name==="geometry-type"||u.name==="id"||/^filter-/.test(u.name))||u instanceof El)return!1;let o=!0;return u.eachChild(c=>{o&&!Xc(c)&&(o=!1)}),o}function Hu(u){if(u instanceof as&&u.name==="feature-state")return!1;let o=!0;return u.eachChild(c=>{o&&!Hu(c)&&(o=!1)}),o}function Hc(u,o){if(u instanceof as&&o.indexOf(u.name)>=0)return!1;let c=!0;return u.eachChild(p=>{c&&!Hc(p,o)&&(c=!1)}),c}function lu(u,o){const c=u.length-1;let p,m,v=0,w=c,E=0;for(;v<=w;)if(E=Math.floor((v+w)/2),p=u[E],m=u[E+1],p<=o){if(E===c||o<m)return E;v=E+1}else{if(!(p>o))throw new Ai("Input is not a number.");w=E-1}return 0}class Ja{constructor(o,c,p){this.type=o,this.input=c,this.labels=[],this.outputs=[];for(const[m,v]of p)this.labels.push(m),this.outputs.push(v)}static parse(o,c){if(o.length-1<4)return c.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if((o.length-1)%2!=0)return c.error("Expected an even number of arguments.");const p=c.parse(o[1],1,ce);if(!p)return null;const m=[];let v=null;c.expectedType&&c.expectedType.kind!=="value"&&(v=c.expectedType);for(let w=1;w<o.length;w+=2){const E=w===1?-1/0:o[w],T=o[w+1],k=w,D=w+1;if(typeof E!="number")return c.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',k);if(m.length&&m[m.length-1][0]>=E)return c.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',k);const F=c.parse(T,D,v);if(!F)return null;v=v||F.type,m.push([E,F])}return new Ja(v,p,m)}evaluate(o){const c=this.labels,p=this.outputs;if(c.length===1)return p[0].evaluate(o);const m=this.input.evaluate(o);if(m<=c[0])return p[0].evaluate(o);const v=c.length;return m>=c[v-1]?p[v-1].evaluate(o):p[lu(c,m)].evaluate(o)}eachChild(o){o(this.input);for(const c of this.outputs)o(c)}outputDefined(){return this.outputs.every(o=>o.outputDefined())}}function Cn(u,o,c){return u+c*(o-u)}function Yc(u,o,c){return u.map((p,m)=>Cn(p,o[m],c))}const Ro={number:Cn,color:function(u,o,c,p="rgb"){switch(p){case"rgb":{const[m,v,w,E]=Yc(u.rgb,o.rgb,c);return new Xn(m,v,w,E,!1)}case"hcl":{const[m,v,w,E]=u.hcl,[T,k,D,F]=o.hcl;let j,X;if(isNaN(m)||isNaN(T))isNaN(m)?isNaN(T)?j=NaN:(j=T,w!==1&&w!==0||(X=k)):(j=m,D!==1&&D!==0||(X=v));else{let At=T-m;T>m&&At>180?At-=360:T<m&&m-T>180&&(At+=360),j=m+c*At}const[H,tt,lt,ht]=function([At,Et,Nt,Ft]){return At=isNaN(At)?0:At*rn,oi([Nt,Math.cos(At)*Et,Math.sin(At)*Et,Ft])}([j,X??Cn(v,k,c),Cn(w,D,c),Cn(E,F,c)]);return new Xn(H,tt,lt,ht,!1)}case"lab":{const[m,v,w,E]=oi(Yc(u.lab,o.lab,c));return new Xn(m,v,w,E,!1)}}},array:Yc,padding:function(u,o,c){return new Do(Yc(u.values,o.values,c))},variableAnchorOffsetCollection:function(u,o,c){const p=u.values,m=o.values;if(p.length!==m.length)throw new Ai(`Cannot interpolate values of different length. from: ${u.toString()}, to: ${o.toString()}`);const v=[];for(let w=0;w<p.length;w+=2){if(p[w]!==m[w])throw new Ai(`Cannot interpolate values containing mismatched anchors. from[${w}]: ${p[w]}, to[${w}]: ${m[w]}`);v.push(p[w]);const[E,T]=p[w+1],[k,D]=m[w+1];v.push([Cn(E,k,c),Cn(T,D,c)])}return new os(v)}};class Oo{constructor(o,c,p,m,v){this.type=o,this.operator=c,this.interpolation=p,this.input=m,this.labels=[],this.outputs=[];for(const[w,E]of v)this.labels.push(w),this.outputs.push(E)}static interpolationFactor(o,c,p,m){let v=0;if(o.name==="exponential")v=Sf(c,o.base,p,m);else if(o.name==="linear")v=Sf(c,1,p,m);else if(o.name==="cubic-bezier"){const w=o.controlPoints;v=new B(w[0],w[1],w[2],w[3]).solve(Sf(c,1,p,m))}return v}static parse(o,c){let[p,m,v,...w]=o;if(!Array.isArray(m)||m.length===0)return c.error("Expected an interpolation type expression.",1);if(m[0]==="linear")m={name:"linear"};else if(m[0]==="exponential"){const k=m[1];if(typeof k!="number")return c.error("Exponential interpolation requires a numeric base.",1,1);m={name:"exponential",base:k}}else{if(m[0]!=="cubic-bezier")return c.error(`Unknown interpolation type ${String(m[0])}`,1,0);{const k=m.slice(1);if(k.length!==4||k.some(D=>typeof D!="number"||D<0||D>1))return c.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);m={name:"cubic-bezier",controlPoints:k}}}if(o.length-1<4)return c.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if((o.length-1)%2!=0)return c.error("Expected an even number of arguments.");if(v=c.parse(v,2,ce),!v)return null;const E=[];let T=null;p==="interpolate-hcl"||p==="interpolate-lab"?T=Ar:c.expectedType&&c.expectedType.kind!=="value"&&(T=c.expectedType);for(let k=0;k<w.length;k+=2){const D=w[k],F=w[k+1],j=k+3,X=k+4;if(typeof D!="number")return c.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',j);if(E.length&&E[E.length-1][0]>=D)return c.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',j);const H=c.parse(F,X,T);if(!H)return null;T=T||H.type,E.push([D,H])}return Wt(T,ce)||Wt(T,Ar)||Wt(T,G)||Wt(T,J)||Wt(T,Z(ce))?new Oo(T,p,m,v,E):c.error(`Type ${ot(T)} is not interpolatable.`)}evaluate(o){const c=this.labels,p=this.outputs;if(c.length===1)return p[0].evaluate(o);const m=this.input.evaluate(o);if(m<=c[0])return p[0].evaluate(o);const v=c.length;if(m>=c[v-1])return p[v-1].evaluate(o);const w=lu(c,m),E=Oo.interpolationFactor(this.interpolation,m,c[w],c[w+1]),T=p[w].evaluate(o),k=p[w+1].evaluate(o);switch(this.operator){case"interpolate":return Ro[this.type.kind](T,k,E);case"interpolate-hcl":return Ro.color(T,k,E,"hcl");case"interpolate-lab":return Ro.color(T,k,E,"lab")}}eachChild(o){o(this.input);for(const c of this.outputs)o(c)}outputDefined(){return this.outputs.every(o=>o.outputDefined())}}function Sf(u,o,c,p){const m=p-c,v=u-c;return m===0?0:o===1?v/m:(Math.pow(o,v)-1)/(Math.pow(o,m)-1)}class Kc{constructor(o,c){this.type=o,this.args=c}static parse(o,c){if(o.length<2)return c.error("Expectected at least one argument.");let p=null;const m=c.expectedType;m&&m.kind!=="value"&&(p=m);const v=[];for(const E of o.slice(1)){const T=c.parse(E,1+v.length,p,void 0,{typeAnnotation:"omit"});if(!T)return null;p=p||T.type,v.push(T)}if(!p)throw new Error("No output type");const w=m&&v.some(E=>bt(m,E.type));return new Kc(w?on:p,v)}evaluate(o){let c,p=null,m=0;for(const v of this.args)if(m++,p=v.evaluate(o),p&&p instanceof Dr&&!p.available&&(c||(c=p.name),p=null,m===this.args.length&&(p=c)),p!==null)break;return p}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}}class Jc{constructor(o,c){this.type=c.type,this.bindings=[].concat(o),this.result=c}evaluate(o){return this.result.evaluate(o)}eachChild(o){for(const c of this.bindings)o(c[1]);o(this.result)}static parse(o,c){if(o.length<4)return c.error(`Expected at least 3 arguments, but found ${o.length-1} instead.`);const p=[];for(let v=1;v<o.length-1;v+=2){const w=o[v];if(typeof w!="string")return c.error(`Expected string, but found ${typeof w} instead.`,v);if(/[^a-zA-Z0-9_]/.test(w))return c.error("Variable names must contain only alphanumeric characters or '_'.",v);const E=c.parse(o[v+1],v+1);if(!E)return null;p.push([w,E])}const m=c.parse(o[o.length-1],o.length-1,c.expectedType,p);return m?new Jc(p,m):null}outputDefined(){return this.result.outputDefined()}}class Ef{constructor(o,c,p){this.type=o,this.index=c,this.input=p}static parse(o,c){if(o.length!==3)return c.error(`Expected 2 arguments, but found ${o.length-1} instead.`);const p=c.parse(o[1],1,ce),m=c.parse(o[2],2,Z(c.expectedType||on));return p&&m?new Ef(m.type.itemType,p,m):null}evaluate(o){const c=this.index.evaluate(o),p=this.input.evaluate(o);if(c<0)throw new Ai(`Array index out of bounds: ${c} < 0.`);if(c>=p.length)throw new Ai(`Array index out of bounds: ${c} > ${p.length-1}.`);if(c!==Math.floor(c))throw new Ai(`Array index must be an integer, but found ${c} instead.`);return p[c]}eachChild(o){o(this.index),o(this.input)}outputDefined(){return!1}}class If{constructor(o,c){this.type=Ke,this.needle=o,this.haystack=c}static parse(o,c){if(o.length!==3)return c.error(`Expected 2 arguments, but found ${o.length-1} instead.`);const p=c.parse(o[1],1,on),m=c.parse(o[2],2,on);return p&&m?rt(p.type,[Ke,ln,ce,ws,on])?new If(p,m):c.error(`Expected first argument to be of type boolean, string, number or null, but found ${ot(p.type)} instead`):null}evaluate(o){const c=this.needle.evaluate(o),p=this.haystack.evaluate(o);if(!p)return!1;if(!Tt(c,["boolean","string","number","null"]))throw new Ai(`Expected first argument to be of type boolean, string, number or null, but found ${ot(Ei(c))} instead.`);if(!Tt(p,["string","array"]))throw new Ai(`Expected second argument to be of type array or string, but found ${ot(Ei(p))} instead.`);return p.indexOf(c)>=0}eachChild(o){o(this.needle),o(this.haystack)}outputDefined(){return!0}}class Qc{constructor(o,c,p){this.type=ce,this.needle=o,this.haystack=c,this.fromIndex=p}static parse(o,c){if(o.length<=2||o.length>=5)return c.error(`Expected 3 or 4 arguments, but found ${o.length-1} instead.`);const p=c.parse(o[1],1,on),m=c.parse(o[2],2,on);if(!p||!m)return null;if(!rt(p.type,[Ke,ln,ce,ws,on]))return c.error(`Expected first argument to be of type boolean, string, number or null, but found ${ot(p.type)} instead`);if(o.length===4){const v=c.parse(o[3],3,ce);return v?new Qc(p,m,v):null}return new Qc(p,m)}evaluate(o){const c=this.needle.evaluate(o),p=this.haystack.evaluate(o);if(!Tt(c,["boolean","string","number","null"]))throw new Ai(`Expected first argument to be of type boolean, string, number or null, but found ${ot(Ei(c))} instead.`);if(!Tt(p,["string","array"]))throw new Ai(`Expected second argument to be of type array or string, but found ${ot(Ei(p))} instead.`);if(this.fromIndex){const m=this.fromIndex.evaluate(o);return p.indexOf(c,m)}return p.indexOf(c)}eachChild(o){o(this.needle),o(this.haystack),this.fromIndex&&o(this.fromIndex)}outputDefined(){return!1}}class Cf{constructor(o,c,p,m,v,w){this.inputType=o,this.type=c,this.input=p,this.cases=m,this.outputs=v,this.otherwise=w}static parse(o,c){if(o.length<5)return c.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if(o.length%2!=1)return c.error("Expected an even number of arguments.");let p,m;c.expectedType&&c.expectedType.kind!=="value"&&(m=c.expectedType);const v={},w=[];for(let k=2;k<o.length-1;k+=2){let D=o[k];const F=o[k+1];Array.isArray(D)||(D=[D]);const j=c.concat(k);if(D.length===0)return j.error("Expected at least one branch label.");for(const H of D){if(typeof H!="number"&&typeof H!="string")return j.error("Branch labels must be numbers or strings.");if(typeof H=="number"&&Math.abs(H)>Number.MAX_SAFE_INTEGER)return j.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof H=="number"&&Math.floor(H)!==H)return j.error("Numeric branch labels must be integer values.");if(p){if(j.checkSubtype(p,Ei(H)))return null}else p=Ei(H);if(v[String(H)]!==void 0)return j.error("Branch labels must be unique.");v[String(H)]=w.length}const X=c.parse(F,k,m);if(!X)return null;m=m||X.type,w.push(X)}const E=c.parse(o[1],1,on);if(!E)return null;const T=c.parse(o[o.length-1],o.length-1,m);return T?E.type.kind!=="value"&&c.concat(1).checkSubtype(p,E.type)?null:new Cf(p,m,E,v,w,T):null}evaluate(o){const c=this.input.evaluate(o);return(Ei(c)===this.inputType&&this.outputs[this.cases[c]]||this.otherwise).evaluate(o)}eachChild(o){o(this.input),this.outputs.forEach(o),o(this.otherwise)}outputDefined(){return this.outputs.every(o=>o.outputDefined())&&this.otherwise.outputDefined()}}class Tf{constructor(o,c,p){this.type=o,this.branches=c,this.otherwise=p}static parse(o,c){if(o.length<4)return c.error(`Expected at least 3 arguments, but found only ${o.length-1}.`);if(o.length%2!=0)return c.error("Expected an odd number of arguments.");let p;c.expectedType&&c.expectedType.kind!=="value"&&(p=c.expectedType);const m=[];for(let w=1;w<o.length-1;w+=2){const E=c.parse(o[w],w,Ke);if(!E)return null;const T=c.parse(o[w+1],w+1,p);if(!T)return null;m.push([E,T]),p=p||T.type}const v=c.parse(o[o.length-1],o.length-1,p);if(!v)return null;if(!p)throw new Error("Can't infer output type");return new Tf(p,m,v)}evaluate(o){for(const[c,p]of this.branches)if(c.evaluate(o))return p.evaluate(o);return this.otherwise.evaluate(o)}eachChild(o){for(const[c,p]of this.branches)o(c),o(p);o(this.otherwise)}outputDefined(){return this.branches.every(([o,c])=>c.outputDefined())&&this.otherwise.outputDefined()}}class th{constructor(o,c,p,m){this.type=o,this.input=c,this.beginIndex=p,this.endIndex=m}static parse(o,c){if(o.length<=2||o.length>=5)return c.error(`Expected 3 or 4 arguments, but found ${o.length-1} instead.`);const p=c.parse(o[1],1,on),m=c.parse(o[2],2,ce);if(!p||!m)return null;if(!rt(p.type,[Z(on),ln,on]))return c.error(`Expected first argument to be of type array or string, but found ${ot(p.type)} instead`);if(o.length===4){const v=c.parse(o[3],3,ce);return v?new th(p.type,p,m,v):null}return new th(p.type,p,m)}evaluate(o){const c=this.input.evaluate(o),p=this.beginIndex.evaluate(o);if(!Tt(c,["string","array"]))throw new Ai(`Expected first argument to be of type array or string, but found ${ot(Ei(c))} instead.`);if(this.endIndex){const m=this.endIndex.evaluate(o);return c.slice(p,m)}return c.slice(p)}eachChild(o){o(this.input),o(this.beginIndex),this.endIndex&&o(this.endIndex)}outputDefined(){return!1}}function Md(u,o){return u==="=="||u==="!="?o.kind==="boolean"||o.kind==="string"||o.kind==="number"||o.kind==="null"||o.kind==="value":o.kind==="string"||o.kind==="number"||o.kind==="value"}function Pd(u,o,c,p){return p.compare(o,c)===0}function uu(u,o,c){const p=u!=="=="&&u!=="!=";return class ix{constructor(v,w,E){this.type=Ke,this.lhs=v,this.rhs=w,this.collator=E,this.hasUntypedArgument=v.type.kind==="value"||w.type.kind==="value"}static parse(v,w){if(v.length!==3&&v.length!==4)return w.error("Expected two or three arguments.");const E=v[0];let T=w.parse(v[1],1,on);if(!T)return null;if(!Md(E,T.type))return w.concat(1).error(`"${E}" comparisons are not supported for type '${ot(T.type)}'.`);let k=w.parse(v[2],2,on);if(!k)return null;if(!Md(E,k.type))return w.concat(2).error(`"${E}" comparisons are not supported for type '${ot(k.type)}'.`);if(T.type.kind!==k.type.kind&&T.type.kind!=="value"&&k.type.kind!=="value")return w.error(`Cannot compare types '${ot(T.type)}' and '${ot(k.type)}'.`);p&&(T.type.kind==="value"&&k.type.kind!=="value"?T=new ss(k.type,[T]):T.type.kind!=="value"&&k.type.kind==="value"&&(k=new ss(T.type,[k])));let D=null;if(v.length===4){if(T.type.kind!=="string"&&k.type.kind!=="string"&&T.type.kind!=="value"&&k.type.kind!=="value")return w.error("Cannot use collator to compare non-string types.");if(D=w.parse(v[3],3,Ss),!D)return null}return new ix(T,k,D)}evaluate(v){const w=this.lhs.evaluate(v),E=this.rhs.evaluate(v);if(p&&this.hasUntypedArgument){const T=Ei(w),k=Ei(E);if(T.kind!==k.kind||T.kind!=="string"&&T.kind!=="number")throw new Ai(`Expected arguments for "${u}" to be (string, string) or (number, number), but found (${T.kind}, ${k.kind}) instead.`)}if(this.collator&&!p&&this.hasUntypedArgument){const T=Ei(w),k=Ei(E);if(T.kind!=="string"||k.kind!=="string")return o(v,w,E)}return this.collator?c(v,w,E,this.collator.evaluate(v)):o(v,w,E)}eachChild(v){v(this.lhs),v(this.rhs),this.collator&&v(this.collator)}outputDefined(){return!0}}}const Vg=uu("==",function(u,o,c){return o===c},Pd),Ug=uu("!=",function(u,o,c){return o!==c},function(u,o,c,p){return!Pd(0,o,c,p)}),Gg=uu("<",function(u,o,c){return o<c},function(u,o,c,p){return p.compare(o,c)<0}),jg=uu(">",function(u,o,c){return o>c},function(u,o,c,p){return p.compare(o,c)>0}),qg=uu("<=",function(u,o,c){return o<=c},function(u,o,c,p){return p.compare(o,c)<=0}),Zg=uu(">=",function(u,o,c){return o>=c},function(u,o,c,p){return p.compare(o,c)>=0});class Lf{constructor(o,c,p,m,v){this.type=ln,this.number=o,this.locale=c,this.currency=p,this.minFractionDigits=m,this.maxFractionDigits=v}static parse(o,c){if(o.length!==3)return c.error("Expected two arguments.");const p=c.parse(o[1],1,ce);if(!p)return null;const m=o[2];if(typeof m!="object"||Array.isArray(m))return c.error("NumberFormat options argument must be an object.");let v=null;if(m.locale&&(v=c.parse(m.locale,1,ln),!v))return null;let w=null;if(m.currency&&(w=c.parse(m.currency,1,ln),!w))return null;let E=null;if(m["min-fraction-digits"]&&(E=c.parse(m["min-fraction-digits"],1,ce),!E))return null;let T=null;return m["max-fraction-digits"]&&(T=c.parse(m["max-fraction-digits"],1,ce),!T)?null:new Lf(p,v,w,E,T)}evaluate(o){return new Intl.NumberFormat(this.locale?this.locale.evaluate(o):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(o):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(o):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(o):void 0}).format(this.number.evaluate(o))}eachChild(o){o(this.number),this.locale&&o(this.locale),this.currency&&o(this.currency),this.minFractionDigits&&o(this.minFractionDigits),this.maxFractionDigits&&o(this.maxFractionDigits)}outputDefined(){return!1}}class eh{constructor(o){this.type=st,this.sections=o}static parse(o,c){if(o.length<2)return c.error("Expected at least one argument.");const p=o[1];if(!Array.isArray(p)&&typeof p=="object")return c.error("First argument must be an image or text section.");const m=[];let v=!1;for(let w=1;w<=o.length-1;++w){const E=o[w];if(v&&typeof E=="object"&&!Array.isArray(E)){v=!1;let T=null;if(E["font-scale"]&&(T=c.parse(E["font-scale"],1,ce),!T))return null;let k=null;if(E["text-font"]&&(k=c.parse(E["text-font"],1,Z(ln)),!k))return null;let D=null;if(E["text-color"]&&(D=c.parse(E["text-color"],1,Ar),!D))return null;const F=m[m.length-1];F.scale=T,F.font=k,F.textColor=D}else{const T=c.parse(o[w],1,on);if(!T)return null;const k=T.type.kind;if(k!=="string"&&k!=="value"&&k!=="null"&&k!=="resolvedImage")return c.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");v=!0,m.push({content:T,scale:null,font:null,textColor:null})}}return new eh(m)}evaluate(o){return new Zr(this.sections.map(c=>{const p=c.content.evaluate(o);return Ei(p)===q?new Vc("",p,null,null,null):new Vc(Fn(p),null,c.scale?c.scale.evaluate(o):null,c.font?c.font.evaluate(o).join(","):null,c.textColor?c.textColor.evaluate(o):null)}))}eachChild(o){for(const c of this.sections)o(c.content),c.scale&&o(c.scale),c.font&&o(c.font),c.textColor&&o(c.textColor)}outputDefined(){return!1}}class Mf{constructor(o){this.type=q,this.input=o}static parse(o,c){if(o.length!==2)return c.error("Expected two arguments.");const p=c.parse(o[1],1,ln);return p?new Mf(p):c.error("No image name provided.")}evaluate(o){const c=this.input.evaluate(o),p=Dr.fromString(c);return p&&o.availableImages&&(p.available=o.availableImages.indexOf(c)>-1),p}eachChild(o){o(this.input)}outputDefined(){return!1}}class Pf{constructor(o){this.type=ce,this.input=o}static parse(o,c){if(o.length!==2)return c.error(`Expected 1 argument, but found ${o.length-1} instead.`);const p=c.parse(o[1],1);return p?p.type.kind!=="array"&&p.type.kind!=="string"&&p.type.kind!=="value"?c.error(`Expected argument of type string or array, but found ${ot(p.type)} instead.`):new Pf(p):null}evaluate(o){const c=this.input.evaluate(o);if(typeof c=="string"||Array.isArray(c))return c.length;throw new Ai(`Expected value to be of type string or array, but found ${ot(Ei(c))} instead.`)}eachChild(o){o(this.input)}outputDefined(){return!1}}const cu={"==":Vg,"!=":Ug,">":jg,"<":Gg,">=":Zg,"<=":qg,array:ss,at:Ef,boolean:ss,case:Tf,coalesce:Kc,collator:qc,format:eh,image:Mf,in:If,"index-of":Qc,interpolate:Oo,"interpolate-hcl":Oo,"interpolate-lab":Oo,length:Pf,let:Jc,literal:Sl,match:Cf,number:ss,"number-format":Lf,object:ss,slice:th,step:Ja,string:ss,"to-boolean":Ya,"to-color":Ya,"to-number":Ya,"to-string":Ya,var:$c,within:El};function kd(u,[o,c,p,m]){o=o.evaluate(u),c=c.evaluate(u),p=p.evaluate(u);const v=m?m.evaluate(u):1,w=Uc(o,c,p,v);if(w)throw new Ai(w);return new Xn(o/255,c/255,p/255,v,!1)}function Ad(u,o){return u in o}function kf(u,o){const c=o[u];return c===void 0?null:c}function Il(u){return{type:u}}function Nd(u){return{result:"success",value:u}}function Qa(u){return{result:"error",value:u}}function hu(u){return u["property-type"]==="data-driven"||u["property-type"]==="cross-faded-data-driven"}function Dd(u){return!!u.expression&&u.expression.parameters.indexOf("zoom")>-1}function Af(u){return!!u.expression&&u.expression.interpolated}function Bn(u){return u instanceof Number?"number":u instanceof String?"string":u instanceof Boolean?"boolean":Array.isArray(u)?"array":u===null?"null":typeof u}function Ii(u){return typeof u=="object"&&u!==null&&!Array.isArray(u)}function $g(u){return u}function Tn(u,o){const c=o.type==="color",p=u.stops&&typeof u.stops[0][0]=="object",m=p||!(p||u.property!==void 0),v=u.type||(Af(o)?"exponential":"interval");if(c||o.type==="padding"){const D=c?Xn.parse:Do.parse;(u=yo({},u)).stops&&(u.stops=u.stops.map(F=>[F[0],D(F[1])])),u.default=D(u.default?u.default:o.default)}if(u.colorSpace&&(w=u.colorSpace)!=="rgb"&&w!=="hcl"&&w!=="lab")throw new Error(`Unknown color space: "${u.colorSpace}"`);var w;let E,T,k;if(v==="exponential")E=Yu;else if(v==="interval")E=vi;else if(v==="categorical"){E=Ci,T=Object.create(null);for(const D of u.stops)T[D[0]]=D[1];k=typeof u.stops[0][0]}else{if(v!=="identity")throw new Error(`Unknown function type "${v}"`);E=Rd}if(p){const D={},F=[];for(let H=0;H<u.stops.length;H++){const tt=u.stops[H],lt=tt[0].zoom;D[lt]===void 0&&(D[lt]={zoom:lt,type:u.type,property:u.property,default:u.default,stops:[]},F.push(lt)),D[lt].stops.push([tt[0].value,tt[1]])}const j=[];for(const H of F)j.push([D[H].zoom,Tn(D[H],o)]);const X={name:"linear"};return{kind:"composite",interpolationType:X,interpolationFactor:Oo.interpolationFactor.bind(void 0,X),zoomStops:j.map(H=>H[0]),evaluate:({zoom:H},tt)=>Yu({stops:j,base:u.base},o,H).evaluate(H,tt)}}if(m){const D=v==="exponential"?{name:"exponential",base:u.base!==void 0?u.base:1}:null;return{kind:"camera",interpolationType:D,interpolationFactor:Oo.interpolationFactor.bind(void 0,D),zoomStops:u.stops.map(F=>F[0]),evaluate:({zoom:F})=>E(u,o,F,T,k)}}return{kind:"source",evaluate(D,F){const j=F&&F.properties?F.properties[u.property]:void 0;return j===void 0?Cl(u.default,o.default):E(u,o,j,T,k)}}}function Cl(u,o,c){return u!==void 0?u:o!==void 0?o:c!==void 0?c:void 0}function Ci(u,o,c,p,m){return Cl(typeof c===m?p[c]:void 0,u.default,o.default)}function vi(u,o,c){if(Bn(c)!=="number")return Cl(u.default,o.default);const p=u.stops.length;if(p===1||c<=u.stops[0][0])return u.stops[0][1];if(c>=u.stops[p-1][0])return u.stops[p-1][1];const m=lu(u.stops.map(v=>v[0]),c);return u.stops[m][1]}function Yu(u,o,c){const p=u.base!==void 0?u.base:1;if(Bn(c)!=="number")return Cl(u.default,o.default);const m=u.stops.length;if(m===1||c<=u.stops[0][0])return u.stops[0][1];if(c>=u.stops[m-1][0])return u.stops[m-1][1];const v=lu(u.stops.map(D=>D[0]),c),w=function(D,F,j,X){const H=X-j,tt=D-j;return H===0?0:F===1?tt/H:(Math.pow(F,tt)-1)/(Math.pow(F,H)-1)}(c,p,u.stops[v][0],u.stops[v+1][0]),E=u.stops[v][1],T=u.stops[v+1][1],k=Ro[o.type]||$g;return typeof E.evaluate=="function"?{evaluate(...D){const F=E.evaluate.apply(void 0,D),j=T.evaluate.apply(void 0,D);if(F!==void 0&&j!==void 0)return k(F,j,w,u.colorSpace)}}:k(E,T,w,u.colorSpace)}function Rd(u,o,c){switch(o.type){case"color":c=Xn.parse(c);break;case"formatted":c=Zr.fromString(c.toString());break;case"resolvedImage":c=Dr.fromString(c.toString());break;case"padding":c=Do.parse(c);break;default:Bn(c)===o.type||o.type==="enum"&&o.values[c]||(c=void 0)}return Cl(c,u.default,o.default)}as.register(cu,{error:[{kind:"error"},[ln],(u,[o])=>{throw new Ai(o.evaluate(u))}],typeof:[ln,[on],(u,[o])=>ot(Ei(o.evaluate(u)))],"to-rgba":[Z(ce,4),[Ar],(u,[o])=>{const[c,p,m,v]=o.evaluate(u).rgb;return[255*c,255*p,255*m,v]}],rgb:[Ar,[ce,ce,ce],kd],rgba:[Ar,[ce,ce,ce,ce],kd],has:{type:Ke,overloads:[[[ln],(u,[o])=>Ad(o.evaluate(u),u.properties())],[[ln,is],(u,[o,c])=>Ad(o.evaluate(u),c.evaluate(u))]]},get:{type:on,overloads:[[[ln],(u,[o])=>kf(o.evaluate(u),u.properties())],[[ln,is],(u,[o,c])=>kf(o.evaluate(u),c.evaluate(u))]]},"feature-state":[on,[ln],(u,[o])=>kf(o.evaluate(u),u.featureState||{})],properties:[is,[],u=>u.properties()],"geometry-type":[ln,[],u=>u.geometryType()],id:[on,[],u=>u.id()],zoom:[ce,[],u=>u.globals.zoom],"heatmap-density":[ce,[],u=>u.globals.heatmapDensity||0],"line-progress":[ce,[],u=>u.globals.lineProgress||0],accumulated:[on,[],u=>u.globals.accumulated===void 0?null:u.globals.accumulated],"+":[ce,Il(ce),(u,o)=>{let c=0;for(const p of o)c+=p.evaluate(u);return c}],"*":[ce,Il(ce),(u,o)=>{let c=1;for(const p of o)c*=p.evaluate(u);return c}],"-":{type:ce,overloads:[[[ce,ce],(u,[o,c])=>o.evaluate(u)-c.evaluate(u)],[[ce],(u,[o])=>-o.evaluate(u)]]},"/":[ce,[ce,ce],(u,[o,c])=>o.evaluate(u)/c.evaluate(u)],"%":[ce,[ce,ce],(u,[o,c])=>o.evaluate(u)%c.evaluate(u)],ln2:[ce,[],()=>Math.LN2],pi:[ce,[],()=>Math.PI],e:[ce,[],()=>Math.E],"^":[ce,[ce,ce],(u,[o,c])=>Math.pow(o.evaluate(u),c.evaluate(u))],sqrt:[ce,[ce],(u,[o])=>Math.sqrt(o.evaluate(u))],log10:[ce,[ce],(u,[o])=>Math.log(o.evaluate(u))/Math.LN10],ln:[ce,[ce],(u,[o])=>Math.log(o.evaluate(u))],log2:[ce,[ce],(u,[o])=>Math.log(o.evaluate(u))/Math.LN2],sin:[ce,[ce],(u,[o])=>Math.sin(o.evaluate(u))],cos:[ce,[ce],(u,[o])=>Math.cos(o.evaluate(u))],tan:[ce,[ce],(u,[o])=>Math.tan(o.evaluate(u))],asin:[ce,[ce],(u,[o])=>Math.asin(o.evaluate(u))],acos:[ce,[ce],(u,[o])=>Math.acos(o.evaluate(u))],atan:[ce,[ce],(u,[o])=>Math.atan(o.evaluate(u))],min:[ce,Il(ce),(u,o)=>Math.min(...o.map(c=>c.evaluate(u)))],max:[ce,Il(ce),(u,o)=>Math.max(...o.map(c=>c.evaluate(u)))],abs:[ce,[ce],(u,[o])=>Math.abs(o.evaluate(u))],round:[ce,[ce],(u,[o])=>{const c=o.evaluate(u);return c<0?-Math.round(-c):Math.round(c)}],floor:[ce,[ce],(u,[o])=>Math.floor(o.evaluate(u))],ceil:[ce,[ce],(u,[o])=>Math.ceil(o.evaluate(u))],"filter-==":[Ke,[ln,on],(u,[o,c])=>u.properties()[o.value]===c.value],"filter-id-==":[Ke,[on],(u,[o])=>u.id()===o.value],"filter-type-==":[Ke,[ln],(u,[o])=>u.geometryType()===o.value],"filter-<":[Ke,[ln,on],(u,[o,c])=>{const p=u.properties()[o.value],m=c.value;return typeof p==typeof m&&p<m}],"filter-id-<":[Ke,[on],(u,[o])=>{const c=u.id(),p=o.value;return typeof c==typeof p&&c<p}],"filter->":[Ke,[ln,on],(u,[o,c])=>{const p=u.properties()[o.value],m=c.value;return typeof p==typeof m&&p>m}],"filter-id->":[Ke,[on],(u,[o])=>{const c=u.id(),p=o.value;return typeof c==typeof p&&c>p}],"filter-<=":[Ke,[ln,on],(u,[o,c])=>{const p=u.properties()[o.value],m=c.value;return typeof p==typeof m&&p<=m}],"filter-id-<=":[Ke,[on],(u,[o])=>{const c=u.id(),p=o.value;return typeof c==typeof p&&c<=p}],"filter->=":[Ke,[ln,on],(u,[o,c])=>{const p=u.properties()[o.value],m=c.value;return typeof p==typeof m&&p>=m}],"filter-id->=":[Ke,[on],(u,[o])=>{const c=u.id(),p=o.value;return typeof c==typeof p&&c>=p}],"filter-has":[Ke,[on],(u,[o])=>o.value in u.properties()],"filter-has-id":[Ke,[],u=>u.id()!==null&&u.id()!==void 0],"filter-type-in":[Ke,[Z(ln)],(u,[o])=>o.value.indexOf(u.geometryType())>=0],"filter-id-in":[Ke,[Z(on)],(u,[o])=>o.value.indexOf(u.id())>=0],"filter-in-small":[Ke,[ln,Z(on)],(u,[o,c])=>c.value.indexOf(u.properties()[o.value])>=0],"filter-in-large":[Ke,[ln,Z(on)],(u,[o,c])=>function(p,m,v,w){for(;v<=w;){const E=v+w>>1;if(m[E]===p)return!0;m[E]>p?w=E-1:v=E+1}return!1}(u.properties()[o.value],c.value,0,c.value.length-1)],all:{type:Ke,overloads:[[[Ke,Ke],(u,[o,c])=>o.evaluate(u)&&c.evaluate(u)],[Il(Ke),(u,o)=>{for(const c of o)if(!c.evaluate(u))return!1;return!0}]]},any:{type:Ke,overloads:[[[Ke,Ke],(u,[o,c])=>o.evaluate(u)||c.evaluate(u)],[Il(Ke),(u,o)=>{for(const c of o)if(c.evaluate(u))return!0;return!1}]]},"!":[Ke,[Ke],(u,[o])=>!o.evaluate(u)],"is-supported-script":[Ke,[ln],(u,[o])=>{const c=u.globals&&u.globals.isSupportedScript;return!c||c(o.evaluate(u))}],upcase:[ln,[ln],(u,[o])=>o.evaluate(u).toUpperCase()],downcase:[ln,[ln],(u,[o])=>o.evaluate(u).toLowerCase()],concat:[ln,Il(on),(u,o)=>o.map(c=>Fn(c.evaluate(u))).join("")],"resolved-locale":[ln,[Ss],(u,[o])=>o.evaluate(u).resolvedLocale()]});class Nf{constructor(o,c){var p;this.expression=o,this._warningHistory={},this._evaluator=new _f,this._defaultValue=c?(p=c).type==="color"&&Ii(p.default)?new Xn(0,0,0,0):p.type==="color"?Xn.parse(p.default)||null:p.type==="padding"?Do.parse(p.default)||null:p.type==="variableAnchorOffsetCollection"?os.parse(p.default)||null:p.default===void 0?null:p.default:null,this._enumValues=c&&c.type==="enum"?c.values:null}evaluateWithoutErrorHandling(o,c,p,m,v,w){return this._evaluator.globals=o,this._evaluator.feature=c,this._evaluator.featureState=p,this._evaluator.canonical=m,this._evaluator.availableImages=v||null,this._evaluator.formattedSection=w,this.expression.evaluate(this._evaluator)}evaluate(o,c,p,m,v,w){this._evaluator.globals=o,this._evaluator.feature=c||null,this._evaluator.featureState=p||null,this._evaluator.canonical=m,this._evaluator.availableImages=v||null,this._evaluator.formattedSection=w||null;try{const E=this.expression.evaluate(this._evaluator);if(E==null||typeof E=="number"&&E!=E)return this._defaultValue;if(this._enumValues&&!(E in this._enumValues))throw new Ai(`Expected value to be one of ${Object.keys(this._enumValues).map(T=>JSON.stringify(T)).join(", ")}, but found ${JSON.stringify(E)} instead.`);return E}catch(E){return this._warningHistory[E.message]||(this._warningHistory[E.message]=!0,typeof console<"u"&&console.warn(E.message)),this._defaultValue}}}function nh(u){return Array.isArray(u)&&u.length>0&&typeof u[0]=="string"&&u[0]in cu}function ih(u,o){const c=new jc(cu,Wc,[],o?function(m){const v={color:Ar,string:ln,number:ce,enum:ln,boolean:Ke,formatted:st,padding:G,resolvedImage:q,variableAnchorOffsetCollection:J};return m.type==="array"?Z(v[m.value]||on,m.length):v[m.type]}(o):void 0),p=c.parse(u,void 0,void 0,void 0,o&&o.type==="string"?{typeAnnotation:"coerce"}:void 0);return p?Nd(new Nf(p,o)):Qa(c.errors)}class Df{constructor(o,c){this.kind=o,this._styleExpression=c,this.isStateDependent=o!=="constant"&&!Hu(c.expression)}evaluateWithoutErrorHandling(o,c,p,m,v,w){return this._styleExpression.evaluateWithoutErrorHandling(o,c,p,m,v,w)}evaluate(o,c,p,m,v,w){return this._styleExpression.evaluate(o,c,p,m,v,w)}}class rh{constructor(o,c,p,m){this.kind=o,this.zoomStops=p,this._styleExpression=c,this.isStateDependent=o!=="camera"&&!Hu(c.expression),this.interpolationType=m}evaluateWithoutErrorHandling(o,c,p,m,v,w){return this._styleExpression.evaluateWithoutErrorHandling(o,c,p,m,v,w)}evaluate(o,c,p,m,v,w){return this._styleExpression.evaluate(o,c,p,m,v,w)}interpolationFactor(o,c,p){return this.interpolationType?Oo.interpolationFactor(this.interpolationType,o,c,p):0}}function Rf(u,o){const c=ih(u,o);if(c.result==="error")return c;const p=c.value.expression,m=Xc(p);if(!m&&!hu(o))return Qa([new ri("","data expressions not supported")]);const v=Hc(p,["zoom"]);if(!v&&!Dd(o))return Qa([new ri("","zoom expressions not supported")]);const w=Ju(p);return w||v?w instanceof ri?Qa([w]):w instanceof Oo&&!Af(o)?Qa([new ri("",'"interpolate" expressions cannot be used with this property')]):Nd(w?new rh(m?"camera":"composite",c.value,w.labels,w instanceof Oo?w.interpolation:void 0):new Df(m?"constant":"source",c.value)):Qa([new ri("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Ku{constructor(o,c){this._parameters=o,this._specification=c,yo(this,Tn(this._parameters,this._specification))}static deserialize(o){return new Ku(o._parameters,o._specification)}static serialize(o){return{_parameters:o._parameters,_specification:o._specification}}}function Ju(u){let o=null;if(u instanceof Jc)o=Ju(u.result);else if(u instanceof Kc){for(const c of u.args)if(o=Ju(c),o)break}else(u instanceof Ja||u instanceof Oo)&&u.input instanceof as&&u.input.name==="zoom"&&(o=u);return o instanceof ri||u.eachChild(c=>{const p=Ju(c);p instanceof ri?o=p:!o&&p?o=new ri("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):o&&p&&o!==p&&(o=new ri("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),o}function Qu(u){if(u===!0||u===!1)return!0;if(!Array.isArray(u)||u.length===0)return!1;switch(u[0]){case"has":return u.length>=2&&u[1]!=="$id"&&u[1]!=="$type";case"in":return u.length>=3&&(typeof u[1]!="string"||Array.isArray(u[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return u.length!==3||Array.isArray(u[1])||Array.isArray(u[2]);case"any":case"all":for(const o of u.slice(1))if(!Qu(o)&&typeof o!="boolean")return!1;return!0;default:return!0}}const Wg={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Of(u){if(u==null)return{filter:()=>!0,needGeometry:!1};Qu(u)||(u=oh(u));const o=ih(u,Wg);if(o.result==="error")throw new Error(o.value.map(c=>`${c.key}: ${c.message}`).join(", "));return{filter:(c,p,m)=>o.value.evaluate(c,p,{},m),needGeometry:Od(u)}}function Xg(u,o){return u<o?-1:u>o?1:0}function Od(u){if(!Array.isArray(u))return!1;if(u[0]==="within")return!0;for(let o=1;o<u.length;o++)if(Od(u[o]))return!0;return!1}function oh(u){if(!u)return!0;const o=u[0];return u.length<=1?o!=="any":o==="=="?zf(u[1],u[2],"=="):o==="!="?tc(zf(u[1],u[2],"==")):o==="<"||o===">"||o==="<="||o===">="?zf(u[1],u[2],o):o==="any"?(c=u.slice(1),["any"].concat(c.map(oh))):o==="all"?["all"].concat(u.slice(1).map(oh)):o==="none"?["all"].concat(u.slice(1).map(oh).map(tc)):o==="in"?zd(u[1],u.slice(2)):o==="!in"?tc(zd(u[1],u.slice(2))):o==="has"?Fd(u[1]):o==="!has"?tc(Fd(u[1])):o!=="within"||u;var c}function zf(u,o,c){switch(u){case"$type":return[`filter-type-${c}`,o];case"$id":return[`filter-id-${c}`,o];default:return[`filter-${c}`,u,o]}}function zd(u,o){if(o.length===0)return!1;switch(u){case"$type":return["filter-type-in",["literal",o]];case"$id":return["filter-id-in",["literal",o]];default:return o.length>200&&!o.some(c=>typeof c!=typeof o[0])?["filter-in-large",u,["literal",o.sort(Xg)]]:["filter-in-small",u,["literal",o]]}}function Fd(u){switch(u){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",u]}}function tc(u){return["!",u]}function sh(u){const o=typeof u;if(o==="number"||o==="boolean"||o==="string"||u==null)return JSON.stringify(u);if(Array.isArray(u)){let m="[";for(const v of u)m+=`${sh(v)},`;return`${m}]`}const c=Object.keys(u).sort();let p="{";for(let m=0;m<c.length;m++)p+=`${JSON.stringify(c[m])}:${sh(u[c[m]])},`;return`${p}}`}function ah(u){let o="";for(const c of Vi)o+=`/${sh(u[c])}`;return o}function Bd(u){const o=u.value;return o?[new le(u.key,o,"constants have been deprecated as of v8")]:[]}function Ni(u){return u instanceof Number||u instanceof String||u instanceof Boolean?u.valueOf():u}function Tl(u){if(Array.isArray(u))return u.map(Tl);if(u instanceof Object&&!(u instanceof Number||u instanceof String||u instanceof Boolean)){const o={};for(const c in u)o[c]=Tl(u[c]);return o}return Ni(u)}function vo(u){const o=u.key,c=u.value,p=u.valueSpec||{},m=u.objectElementValidators||{},v=u.style,w=u.styleSpec,E=u.validateSpec;let T=[];const k=Bn(c);if(k!=="object")return[new le(o,c,`object expected, ${k} found`)];for(const D in c){const F=D.split(".")[0],j=p[F]||p["*"];let X;if(m[F])X=m[F];else if(p[F])X=E;else if(m["*"])X=m["*"];else{if(!p["*"]){T.push(new le(o,c[D],`unknown property "${D}"`));continue}X=E}T=T.concat(X({key:(o&&`${o}.`)+D,value:c[D],valueSpec:j,style:v,styleSpec:w,object:c,objectKey:D,validateSpec:E},c))}for(const D in p)m[D]||p[D].required&&p[D].default===void 0&&c[D]===void 0&&T.push(new le(o,c,`missing required property "${D}"`));return T}function fu(u){const o=u.value,c=u.valueSpec,p=u.style,m=u.styleSpec,v=u.key,w=u.arrayElementValidator||u.validateSpec;if(Bn(o)!=="array")return[new le(v,o,`array expected, ${Bn(o)} found`)];if(c.length&&o.length!==c.length)return[new le(v,o,`array length ${c.length} expected, length ${o.length} found`)];if(c["min-length"]&&o.length<c["min-length"])return[new le(v,o,`array length at least ${c["min-length"]} expected, length ${o.length} found`)];let E={type:c.value,values:c.values};m.$version<7&&(E.function=c.function),Bn(c.value)==="object"&&(E=c.value);let T=[];for(let k=0;k<o.length;k++)T=T.concat(w({array:o,arrayIndex:k,value:o[k],valueSpec:E,validateSpec:u.validateSpec,style:p,styleSpec:m,key:`${v}[${k}]`}));return T}function ec(u){const o=u.key,c=u.value,p=u.valueSpec;let m=Bn(c);return m==="number"&&c!=c&&(m="NaN"),m!=="number"?[new le(o,c,`number expected, ${m} found`)]:"minimum"in p&&c<p.minimum?[new le(o,c,`${c} is less than the minimum value ${p.minimum}`)]:"maximum"in p&&c>p.maximum?[new le(o,c,`${c} is greater than the maximum value ${p.maximum}`)]:[]}function lh(u){const o=u.valueSpec,c=Ni(u.value.type);let p,m,v,w={};const E=c!=="categorical"&&u.value.property===void 0,T=!E,k=Bn(u.value.stops)==="array"&&Bn(u.value.stops[0])==="array"&&Bn(u.value.stops[0][0])==="object",D=vo({key:u.key,value:u.value,valueSpec:u.styleSpec.function,validateSpec:u.validateSpec,style:u.style,styleSpec:u.styleSpec,objectElementValidators:{stops:function(X){if(c==="identity")return[new le(X.key,X.value,'identity function may not have a "stops" property')];let H=[];const tt=X.value;return H=H.concat(fu({key:X.key,value:tt,valueSpec:X.valueSpec,validateSpec:X.validateSpec,style:X.style,styleSpec:X.styleSpec,arrayElementValidator:F})),Bn(tt)==="array"&&tt.length===0&&H.push(new le(X.key,tt,"array must have at least one stop")),H},default:function(X){return X.validateSpec({key:X.key,value:X.value,valueSpec:o,validateSpec:X.validateSpec,style:X.style,styleSpec:X.styleSpec})}}});return c==="identity"&&E&&D.push(new le(u.key,u.value,'missing required property "property"')),c==="identity"||u.value.stops||D.push(new le(u.key,u.value,'missing required property "stops"')),c==="exponential"&&u.valueSpec.expression&&!Af(u.valueSpec)&&D.push(new le(u.key,u.value,"exponential functions not supported")),u.styleSpec.$version>=8&&(T&&!hu(u.valueSpec)?D.push(new le(u.key,u.value,"property functions not supported")):E&&!Dd(u.valueSpec)&&D.push(new le(u.key,u.value,"zoom functions not supported"))),c!=="categorical"&&!k||u.value.property!==void 0||D.push(new le(u.key,u.value,'"property" property is required')),D;function F(X){let H=[];const tt=X.value,lt=X.key;if(Bn(tt)!=="array")return[new le(lt,tt,`array expected, ${Bn(tt)} found`)];if(tt.length!==2)return[new le(lt,tt,`array length 2 expected, length ${tt.length} found`)];if(k){if(Bn(tt[0])!=="object")return[new le(lt,tt,`object expected, ${Bn(tt[0])} found`)];if(tt[0].zoom===void 0)return[new le(lt,tt,"object stop key must have zoom")];if(tt[0].value===void 0)return[new le(lt,tt,"object stop key must have value")];if(v&&v>Ni(tt[0].zoom))return[new le(lt,tt[0].zoom,"stop zoom values must appear in ascending order")];Ni(tt[0].zoom)!==v&&(v=Ni(tt[0].zoom),m=void 0,w={}),H=H.concat(vo({key:`${lt}[0]`,value:tt[0],valueSpec:{zoom:{}},validateSpec:X.validateSpec,style:X.style,styleSpec:X.styleSpec,objectElementValidators:{zoom:ec,value:j}}))}else H=H.concat(j({key:`${lt}[0]`,value:tt[0],valueSpec:{},validateSpec:X.validateSpec,style:X.style,styleSpec:X.styleSpec},tt));return nh(Tl(tt[1]))?H.concat([new le(`${lt}[1]`,tt[1],"expressions are not allowed in function stops.")]):H.concat(X.validateSpec({key:`${lt}[1]`,value:tt[1],valueSpec:o,validateSpec:X.validateSpec,style:X.style,styleSpec:X.styleSpec}))}function j(X,H){const tt=Bn(X.value),lt=Ni(X.value),ht=X.value!==null?X.value:H;if(p){if(tt!==p)return[new le(X.key,ht,`${tt} stop domain type must match previous stop domain type ${p}`)]}else p=tt;if(tt!=="number"&&tt!=="string"&&tt!=="boolean")return[new le(X.key,ht,"stop domain value must be a number, string, or boolean")];if(tt!=="number"&&c!=="categorical"){let At=`number expected, ${tt} found`;return hu(o)&&c===void 0&&(At+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new le(X.key,ht,At)]}return c!=="categorical"||tt!=="number"||isFinite(lt)&&Math.floor(lt)===lt?c!=="categorical"&&tt==="number"&&m!==void 0&&lt<m?[new le(X.key,ht,"stop domain values must appear in ascending order")]:(m=lt,c==="categorical"&&lt in w?[new le(X.key,ht,"stop domain values must be unique")]:(w[lt]=!0,[])):[new le(X.key,ht,`integer expected, found ${lt}`)]}}function Ll(u){const o=(u.expressionContext==="property"?Rf:ih)(Tl(u.value),u.valueSpec);if(o.result==="error")return o.value.map(p=>new le(`${u.key}${p.key}`,u.value,p.message));const c=o.value.expression||o.value._styleExpression.expression;if(u.expressionContext==="property"&&u.propertyKey==="text-font"&&!c.outputDefined())return[new le(u.key,u.value,`Invalid data expression for "${u.propertyKey}". Output values must be contained as literals within the expression.`)];if(u.expressionContext==="property"&&u.propertyType==="layout"&&!Hu(c))return[new le(u.key,u.value,'"feature-state" data expressions are not supported with layout properties.')];if(u.expressionContext==="filter"&&!Hu(c))return[new le(u.key,u.value,'"feature-state" data expressions are not supported with filters.')];if(u.expressionContext&&u.expressionContext.indexOf("cluster")===0){if(!Hc(c,["zoom","feature-state"]))return[new le(u.key,u.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(u.expressionContext==="cluster-initial"&&!Xc(c))return[new le(u.key,u.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function nc(u){const o=u.key,c=u.value,p=u.valueSpec,m=[];return Array.isArray(p.values)?p.values.indexOf(Ni(c))===-1&&m.push(new le(o,c,`expected one of [${p.values.join(", ")}], ${JSON.stringify(c)} found`)):Object.keys(p.values).indexOf(Ni(c))===-1&&m.push(new le(o,c,`expected one of [${Object.keys(p.values).join(", ")}], ${JSON.stringify(c)} found`)),m}function pu(u){return Qu(Tl(u.value))?Ll(yo({},u,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Vd(u)}function Vd(u){const o=u.value,c=u.key;if(Bn(o)!=="array")return[new le(c,o,`array expected, ${Bn(o)} found`)];const p=u.styleSpec;let m,v=[];if(o.length<1)return[new le(c,o,"filter array must have at least 1 element")];switch(v=v.concat(nc({key:`${c}[0]`,value:o[0],valueSpec:p.filter_operator,style:u.style,styleSpec:u.styleSpec})),Ni(o[0])){case"<":case"<=":case">":case">=":o.length>=2&&Ni(o[1])==="$type"&&v.push(new le(c,o,`"$type" cannot be use with operator "${o[0]}"`));case"==":case"!=":o.length!==3&&v.push(new le(c,o,`filter array for operator "${o[0]}" must have 3 elements`));case"in":case"!in":o.length>=2&&(m=Bn(o[1]),m!=="string"&&v.push(new le(`${c}[1]`,o[1],`string expected, ${m} found`)));for(let w=2;w<o.length;w++)m=Bn(o[w]),Ni(o[1])==="$type"?v=v.concat(nc({key:`${c}[${w}]`,value:o[w],valueSpec:p.geometry_type,style:u.style,styleSpec:u.styleSpec})):m!=="string"&&m!=="number"&&m!=="boolean"&&v.push(new le(`${c}[${w}]`,o[w],`string, number, or boolean expected, ${m} found`));break;case"any":case"all":case"none":for(let w=1;w<o.length;w++)v=v.concat(Vd({key:`${c}[${w}]`,value:o[w],style:u.style,styleSpec:u.styleSpec}));break;case"has":case"!has":m=Bn(o[1]),o.length!==2?v.push(new le(c,o,`filter array for "${o[0]}" operator must have 2 elements`)):m!=="string"&&v.push(new le(`${c}[1]`,o[1],`string expected, ${m} found`));break;case"within":m=Bn(o[1]),o.length!==2?v.push(new le(c,o,`filter array for "${o[0]}" operator must have 2 elements`)):m!=="object"&&v.push(new le(`${c}[1]`,o[1],`object expected, ${m} found`))}return v}function Ud(u,o){const c=u.key,p=u.validateSpec,m=u.style,v=u.styleSpec,w=u.value,E=u.objectKey,T=v[`${o}_${u.layerType}`];if(!T)return[];const k=E.match(/^(.*)-transition$/);if(o==="paint"&&k&&T[k[1]]&&T[k[1]].transition)return p({key:c,value:w,valueSpec:v.transition,style:m,styleSpec:v});const D=u.valueSpec||T[E];if(!D)return[new le(c,w,`unknown property "${E}"`)];let F;if(Bn(w)==="string"&&hu(D)&&!D.tokens&&(F=/^{([^}]+)}$/.exec(w)))return[new le(c,w,`"${E}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(F[1])} }\`.`)];const j=[];return u.layerType==="symbol"&&(E==="text-field"&&m&&!m.glyphs&&j.push(new le(c,w,'use of "text-field" requires a style "glyphs" property')),E==="text-font"&&Ii(Tl(w))&&Ni(w.type)==="identity"&&j.push(new le(c,w,'"text-font" does not support identity functions'))),j.concat(p({key:u.key,value:w,valueSpec:D,style:m,styleSpec:v,expressionContext:"property",propertyType:o,propertyKey:E}))}function Gd(u){return Ud(u,"paint")}function jd(u){return Ud(u,"layout")}function qd(u){let o=[];const c=u.value,p=u.key,m=u.style,v=u.styleSpec;c.type||c.ref||o.push(new le(p,c,'either "type" or "ref" is required'));let w=Ni(c.type);const E=Ni(c.ref);if(c.id){const T=Ni(c.id);for(let k=0;k<u.arrayIndex;k++){const D=m.layers[k];Ni(D.id)===T&&o.push(new le(p,c.id,`duplicate layer id "${c.id}", previously used at line ${D.id.__line__}`))}}if("ref"in c){let T;["type","source","source-layer","filter","layout"].forEach(k=>{k in c&&o.push(new le(p,c[k],`"${k}" is prohibited for ref layers`))}),m.layers.forEach(k=>{Ni(k.id)===E&&(T=k)}),T?T.ref?o.push(new le(p,c.ref,"ref cannot reference another ref layer")):w=Ni(T.type):o.push(new le(p,c.ref,`ref layer "${E}" not found`))}else if(w!=="background")if(c.source){const T=m.sources&&m.sources[c.source],k=T&&Ni(T.type);T?k==="vector"&&w==="raster"?o.push(new le(p,c.source,`layer "${c.id}" requires a raster source`)):k!=="raster-dem"&&w==="hillshade"?o.push(new le(p,c.source,`layer "${c.id}" requires a raster-dem source`)):k==="raster"&&w!=="raster"?o.push(new le(p,c.source,`layer "${c.id}" requires a vector source`)):k!=="vector"||c["source-layer"]?k==="raster-dem"&&w!=="hillshade"?o.push(new le(p,c.source,"raster-dem source can only be used with layer type 'hillshade'.")):w!=="line"||!c.paint||!c.paint["line-gradient"]||k==="geojson"&&T.lineMetrics||o.push(new le(p,c,`layer "${c.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):o.push(new le(p,c,`layer "${c.id}" must specify a "source-layer"`)):o.push(new le(p,c.source,`source "${c.source}" not found`))}else o.push(new le(p,c,'missing required property "source"'));return o=o.concat(vo({key:p,value:c,valueSpec:v.layer,style:u.style,styleSpec:u.styleSpec,validateSpec:u.validateSpec,objectElementValidators:{"*":()=>[],type:()=>u.validateSpec({key:`${p}.type`,value:c.type,valueSpec:v.layer.type,style:u.style,styleSpec:u.styleSpec,validateSpec:u.validateSpec,object:c,objectKey:"type"}),filter:pu,layout:T=>vo({layer:c,key:T.key,value:T.value,style:T.style,styleSpec:T.styleSpec,validateSpec:T.validateSpec,objectElementValidators:{"*":k=>jd(yo({layerType:w},k))}}),paint:T=>vo({layer:c,key:T.key,value:T.value,style:T.style,styleSpec:T.styleSpec,validateSpec:T.validateSpec,objectElementValidators:{"*":k=>Gd(yo({layerType:w},k))}})}})),o}function qs(u){const o=u.value,c=u.key,p=Bn(o);return p!=="string"?[new le(c,o,`string expected, ${p} found`)]:[]}const ic={promoteId:function({key:u,value:o}){if(Bn(o)==="string")return qs({key:u,value:o});{const c=[];for(const p in o)c.push(...qs({key:`${u}.${p}`,value:o[p]}));return c}}};function zo(u){const o=u.value,c=u.key,p=u.styleSpec,m=u.style,v=u.validateSpec;if(!o.type)return[new le(c,o,'"type" is required')];const w=Ni(o.type);let E;switch(w){case"vector":case"raster":return E=vo({key:c,value:o,valueSpec:p[`source_${w.replace("-","_")}`],style:u.style,styleSpec:p,objectElementValidators:ic,validateSpec:v}),E;case"raster-dem":return E=function(T){var k;const D=(k=T.sourceName)!==null&&k!==void 0?k:"",F=T.value,j=T.styleSpec,X=j.source_raster_dem,H=T.style;let tt=[];const lt=Bn(F);if(F===void 0)return tt;if(lt!=="object")return tt.push(new le("source_raster_dem",F,`object expected, ${lt} found`)),tt;const ht=Ni(F.encoding)==="custom",At=["redFactor","greenFactor","blueFactor","baseShift"],Et=T.value.encoding?`"${T.value.encoding}"`:"Default";for(const Nt in F)!ht&&At.includes(Nt)?tt.push(new le(Nt,F[Nt],`In "${D}": "${Nt}" is only valid when "encoding" is set to "custom". ${Et} encoding found`)):X[Nt]?tt=tt.concat(T.validateSpec({key:Nt,value:F[Nt],valueSpec:X[Nt],validateSpec:T.validateSpec,style:H,styleSpec:j})):tt.push(new le(Nt,F[Nt],`unknown property "${Nt}"`));return tt}({sourceName:c,value:o,style:u.style,styleSpec:p,validateSpec:v}),E;case"geojson":if(E=vo({key:c,value:o,valueSpec:p.source_geojson,style:m,styleSpec:p,validateSpec:v,objectElementValidators:ic}),o.cluster)for(const T in o.clusterProperties){const[k,D]=o.clusterProperties[T],F=typeof k=="string"?[k,["accumulated"],["get",T]]:k;E.push(...Ll({key:`${c}.${T}.map`,value:D,validateSpec:v,expressionContext:"cluster-map"})),E.push(...Ll({key:`${c}.${T}.reduce`,value:F,validateSpec:v,expressionContext:"cluster-reduce"}))}return E;case"video":return vo({key:c,value:o,valueSpec:p.source_video,style:m,validateSpec:v,styleSpec:p});case"image":return vo({key:c,value:o,valueSpec:p.source_image,style:m,validateSpec:v,styleSpec:p});case"canvas":return[new le(c,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return nc({key:`${c}.type`,value:o.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:m,validateSpec:v,styleSpec:p})}}function rc(u){const o=u.value,c=u.styleSpec,p=c.light,m=u.style;let v=[];const w=Bn(o);if(o===void 0)return v;if(w!=="object")return v=v.concat([new le("light",o,`object expected, ${w} found`)]),v;for(const E in o){const T=E.match(/^(.*)-transition$/);v=v.concat(T&&p[T[1]]&&p[T[1]].transition?u.validateSpec({key:E,value:o[E],valueSpec:c.transition,validateSpec:u.validateSpec,style:m,styleSpec:c}):p[E]?u.validateSpec({key:E,value:o[E],valueSpec:p[E],validateSpec:u.validateSpec,style:m,styleSpec:c}):[new le(E,o[E],`unknown property "${E}"`)])}return v}function Zd(u){const o=u.value,c=u.styleSpec,p=c.terrain,m=u.style;let v=[];const w=Bn(o);if(o===void 0)return v;if(w!=="object")return v=v.concat([new le("terrain",o,`object expected, ${w} found`)]),v;for(const E in o)v=v.concat(p[E]?u.validateSpec({key:E,value:o[E],valueSpec:p[E],validateSpec:u.validateSpec,style:m,styleSpec:c}):[new le(E,o[E],`unknown property "${E}"`)]);return v}function $d(u){let o=[];const c=u.value,p=u.key;if(Array.isArray(c)){const m=[],v=[];for(const w in c)c[w].id&&m.includes(c[w].id)&&o.push(new le(p,c,`all the sprites' ids must be unique, but ${c[w].id} is duplicated`)),m.push(c[w].id),c[w].url&&v.includes(c[w].url)&&o.push(new le(p,c,`all the sprites' URLs must be unique, but ${c[w].url} is duplicated`)),v.push(c[w].url),o=o.concat(vo({key:`${p}[${w}]`,value:c[w],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:u.validateSpec}));return o}return qs({key:p,value:c})}const Wd={"*":()=>[],array:fu,boolean:function(u){const o=u.value,c=u.key,p=Bn(o);return p!=="boolean"?[new le(c,o,`boolean expected, ${p} found`)]:[]},number:ec,color:function(u){const o=u.key,c=u.value,p=Bn(c);return p!=="string"?[new le(o,c,`color expected, ${p} found`)]:Xn.parse(String(c))?[]:[new le(o,c,`color expected, "${c}" found`)]},constants:Bd,enum:nc,filter:pu,function:lh,layer:qd,object:vo,source:zo,light:rc,terrain:Zd,string:qs,formatted:function(u){return qs(u).length===0?[]:Ll(u)},resolvedImage:function(u){return qs(u).length===0?[]:Ll(u)},padding:function(u){const o=u.key,c=u.value;if(Bn(c)==="array"){if(c.length<1||c.length>4)return[new le(o,c,`padding requires 1 to 4 values; ${c.length} values found`)];const p={type:"number"};let m=[];for(let v=0;v<c.length;v++)m=m.concat(u.validateSpec({key:`${o}[${v}]`,value:c[v],validateSpec:u.validateSpec,valueSpec:p}));return m}return ec({key:o,value:c,valueSpec:{}})},variableAnchorOffsetCollection:function(u){const o=u.key,c=u.value,p=Bn(c),m=u.styleSpec;if(p!=="array"||c.length<1||c.length%2!=0)return[new le(o,c,"variableAnchorOffsetCollection requires a non-empty array of even length")];let v=[];for(let w=0;w<c.length;w+=2)v=v.concat(nc({key:`${o}[${w}]`,value:c[w],valueSpec:m.layout_symbol["text-anchor"]})),v=v.concat(fu({key:`${o}[${w+1}]`,value:c[w+1],valueSpec:{length:2,value:"number"},validateSpec:u.validateSpec,style:u.style,styleSpec:m}));return v},sprite:$d};function Ia(u){const o=u.value,c=u.valueSpec,p=u.styleSpec;return u.validateSpec=Ia,c.expression&&Ii(Ni(o))?lh(u):c.expression&&nh(Tl(o))?Ll(u):c.type&&Wd[c.type]?Wd[c.type](u):vo(yo({},u,{valueSpec:c.type?p[c.type]:c}))}function Xd(u){const o=u.value,c=u.key,p=qs(u);return p.length||(o.indexOf("{fontstack}")===-1&&p.push(new le(c,o,'"glyphs" url must include a "{fontstack}" token')),o.indexOf("{range}")===-1&&p.push(new le(c,o,'"glyphs" url must include a "{range}" token'))),p}function ls(u,o=$t){let c=[];return c=c.concat(Ia({key:"",value:u,valueSpec:o.$root,styleSpec:o,style:u,validateSpec:Ia,objectElementValidators:{glyphs:Xd,"*":()=>[]}})),u.constants&&(c=c.concat(Bd({key:"constants",value:u.constants,style:u,styleSpec:o,validateSpec:Ia}))),uh(c)}function Ca(u){return function(o){return u({...o,validateSpec:Ia})}}function uh(u){return[].concat(u).sort((o,c)=>o.line-c.line)}function Ta(u){return function(...o){return uh(u.apply(this,o))}}ls.source=Ta(Ca(zo)),ls.sprite=Ta(Ca($d)),ls.glyphs=Ta(Ca(Xd)),ls.light=Ta(Ca(rc)),ls.terrain=Ta(Ca(Zd)),ls.layer=Ta(Ca(qd)),ls.filter=Ta(Ca(pu)),ls.paintProperty=Ta(Ca(Gd)),ls.layoutProperty=Ta(Ca(jd));const La=ls,Hg=La.light,Ff=La.paintProperty,Hd=La.layoutProperty;function ch(u,o){let c=!1;if(o&&o.length)for(const p of o)u.fire(new pn(new Error(p.message))),c=!0;return c}class du{constructor(o,c,p){const m=this.cells=[];if(o instanceof ArrayBuffer){this.arrayBuffer=o;const w=new Int32Array(this.arrayBuffer);o=w[0],this.d=(c=w[1])+2*(p=w[2]);for(let T=0;T<this.d*this.d;T++){const k=w[3+T],D=w[3+T+1];m.push(k===D?null:w.subarray(k,D))}const E=w[3+m.length+1];this.keys=w.subarray(w[3+m.length],E),this.bboxes=w.subarray(E),this.insert=this._insertReadonly}else{this.d=c+2*p;for(let w=0;w<this.d*this.d;w++)m.push([]);this.keys=[],this.bboxes=[]}this.n=c,this.extent=o,this.padding=p,this.scale=c/o,this.uid=0;const v=p/c*o;this.min=-v,this.max=o+v}insert(o,c,p,m,v){this._forEachCell(c,p,m,v,this._insertCell,this.uid++,void 0,void 0),this.keys.push(o),this.bboxes.push(c),this.bboxes.push(p),this.bboxes.push(m),this.bboxes.push(v)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(o,c,p,m,v,w){this.cells[v].push(w)}query(o,c,p,m,v){const w=this.min,E=this.max;if(o<=w&&c<=w&&E<=p&&E<=m&&!v)return Array.prototype.slice.call(this.keys);{const T=[];return this._forEachCell(o,c,p,m,this._queryCell,T,{},v),T}}_queryCell(o,c,p,m,v,w,E,T){const k=this.cells[v];if(k!==null){const D=this.keys,F=this.bboxes;for(let j=0;j<k.length;j++){const X=k[j];if(E[X]===void 0){const H=4*X;(T?T(F[H+0],F[H+1],F[H+2],F[H+3]):o<=F[H+2]&&c<=F[H+3]&&p>=F[H+0]&&m>=F[H+1])?(E[X]=!0,w.push(D[X])):E[X]=!1}}}}_forEachCell(o,c,p,m,v,w,E,T){const k=this._convertToCellCoord(o),D=this._convertToCellCoord(c),F=this._convertToCellCoord(p),j=this._convertToCellCoord(m);for(let X=k;X<=F;X++)for(let H=D;H<=j;H++){const tt=this.d*H+X;if((!T||T(this._convertFromCellCoord(X),this._convertFromCellCoord(H),this._convertFromCellCoord(X+1),this._convertFromCellCoord(H+1)))&&v.call(this,o,c,p,m,tt,w,E,T))return}}_convertFromCellCoord(o){return(o-this.padding)/this.scale}_convertToCellCoord(o){return Math.max(0,Math.min(this.d-1,Math.floor(o*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const o=this.cells,c=3+this.cells.length+1+1;let p=0;for(let w=0;w<this.cells.length;w++)p+=this.cells[w].length;const m=new Int32Array(c+p+this.keys.length+this.bboxes.length);m[0]=this.extent,m[1]=this.n,m[2]=this.padding;let v=c;for(let w=0;w<o.length;w++){const E=o[w];m[3+w]=v,m.set(E,v),v+=E.length}return m[3+o.length]=v,m.set(this.keys,v),v+=this.keys.length,m[3+o.length+1]=v,m.set(this.bboxes,v),v+=this.bboxes.length,m.buffer}static serialize(o,c){const p=o.toArrayBuffer();return c&&c.push(p),{buffer:p}}static deserialize(o){return new du(o.buffer)}}const Ma={};function xe(u,o,c={}){if(Ma[u])throw new Error(`${u} is already registered.`);Object.defineProperty(o,"_classRegistryKey",{value:u,writeable:!1}),Ma[u]={klass:o,omit:c.omit||[],shallow:c.shallow||[]}}xe("Object",Object),xe("TransferableGridIndex",du),xe("Color",Xn),xe("Error",Error),xe("AJAXError",De),xe("ResolvedImage",Dr),xe("StylePropertyFunction",Ku),xe("StyleExpression",Nf,{omit:["_evaluator"]}),xe("ZoomDependentExpression",rh),xe("ZoomConstantExpression",Df),xe("CompoundExpression",as,{omit:["_evaluate"]});for(const u in cu)cu[u]._classRegistryKey||xe(`Expression_${u}`,cu[u]);function hh(u){return u&&typeof ArrayBuffer<"u"&&(u instanceof ArrayBuffer||u.constructor&&u.constructor.name==="ArrayBuffer")}function tl(u,o){if(u==null||typeof u=="boolean"||typeof u=="number"||typeof u=="string"||u instanceof Boolean||u instanceof Number||u instanceof String||u instanceof Date||u instanceof RegExp||u instanceof Blob)return u;if(hh(u)||yn(u))return o&&o.push(u),u;if(ArrayBuffer.isView(u)){const c=u;return o&&o.push(c.buffer),c}if(u instanceof ImageData)return o&&o.push(u.data.buffer),u;if(Array.isArray(u)){const c=[];for(const p of u)c.push(tl(p,o));return c}if(typeof u=="object"){const c=u.constructor,p=c._classRegistryKey;if(!p)throw new Error("can't serialize object of unregistered class");if(!Ma[p])throw new Error(`${p} is not registered.`);const m=c.serialize?c.serialize(u,o):{};if(c.serialize){if(o&&m===o[o.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const v in u){if(!u.hasOwnProperty(v)||Ma[p].omit.indexOf(v)>=0)continue;const w=u[v];m[v]=Ma[p].shallow.indexOf(v)>=0?w:tl(w,o)}u instanceof Error&&(m.message=u.message)}if(m.$name)throw new Error("$name property is reserved for worker serialization logic.");return p!=="Object"&&(m.$name=p),m}throw new Error("can't serialize object of type "+typeof u)}function mu(u){if(u==null||typeof u=="boolean"||typeof u=="number"||typeof u=="string"||u instanceof Boolean||u instanceof Number||u instanceof String||u instanceof Date||u instanceof RegExp||u instanceof Blob||hh(u)||yn(u)||ArrayBuffer.isView(u)||u instanceof ImageData)return u;if(Array.isArray(u))return u.map(mu);if(typeof u=="object"){const o=u.$name||"Object";if(!Ma[o])throw new Error(`can't deserialize unregistered class ${o}`);const{klass:c}=Ma[o];if(!c)throw new Error(`can't deserialize unregistered class ${o}`);if(c.deserialize)return c.deserialize(u);const p=Object.create(c.prototype);for(const m of Object.keys(u)){if(m==="$name")continue;const v=u[m];p[m]=Ma[o].shallow.indexOf(m)>=0?v:mu(v)}return p}throw new Error("can't deserialize object of type "+typeof u)}class Yd{constructor(){this.first=!0}update(o,c){const p=Math.floor(o);return this.first?(this.first=!1,this.lastIntegerZoom=p,this.lastIntegerZoomTime=0,this.lastZoom=o,this.lastFloorZoom=p,!0):(this.lastFloorZoom>p?(this.lastIntegerZoom=p+1,this.lastIntegerZoomTime=c):this.lastFloorZoom<p&&(this.lastIntegerZoom=p,this.lastIntegerZoomTime=c),o!==this.lastZoom&&(this.lastZoom=o,this.lastFloorZoom=p,!0))}}const ye={"Latin-1 Supplement":u=>u>=128&&u<=255,Arabic:u=>u>=1536&&u<=1791,"Arabic Supplement":u=>u>=1872&&u<=1919,"Arabic Extended-A":u=>u>=2208&&u<=2303,"Hangul Jamo":u=>u>=4352&&u<=4607,"Unified Canadian Aboriginal Syllabics":u=>u>=5120&&u<=5759,Khmer:u=>u>=6016&&u<=6143,"Unified Canadian Aboriginal Syllabics Extended":u=>u>=6320&&u<=6399,"General Punctuation":u=>u>=8192&&u<=8303,"Letterlike Symbols":u=>u>=8448&&u<=8527,"Number Forms":u=>u>=8528&&u<=8591,"Miscellaneous Technical":u=>u>=8960&&u<=9215,"Control Pictures":u=>u>=9216&&u<=9279,"Optical Character Recognition":u=>u>=9280&&u<=9311,"Enclosed Alphanumerics":u=>u>=9312&&u<=9471,"Geometric Shapes":u=>u>=9632&&u<=9727,"Miscellaneous Symbols":u=>u>=9728&&u<=9983,"Miscellaneous Symbols and Arrows":u=>u>=11008&&u<=11263,"CJK Radicals Supplement":u=>u>=11904&&u<=12031,"Kangxi Radicals":u=>u>=12032&&u<=12255,"Ideographic Description Characters":u=>u>=12272&&u<=12287,"CJK Symbols and Punctuation":u=>u>=12288&&u<=12351,Hiragana:u=>u>=12352&&u<=12447,Katakana:u=>u>=12448&&u<=12543,Bopomofo:u=>u>=12544&&u<=12591,"Hangul Compatibility Jamo":u=>u>=12592&&u<=12687,Kanbun:u=>u>=12688&&u<=12703,"Bopomofo Extended":u=>u>=12704&&u<=12735,"CJK Strokes":u=>u>=12736&&u<=12783,"Katakana Phonetic Extensions":u=>u>=12784&&u<=12799,"Enclosed CJK Letters and Months":u=>u>=12800&&u<=13055,"CJK Compatibility":u=>u>=13056&&u<=13311,"CJK Unified Ideographs Extension A":u=>u>=13312&&u<=19903,"Yijing Hexagram Symbols":u=>u>=19904&&u<=19967,"CJK Unified Ideographs":u=>u>=19968&&u<=40959,"Yi Syllables":u=>u>=40960&&u<=42127,"Yi Radicals":u=>u>=42128&&u<=42191,"Hangul Jamo Extended-A":u=>u>=43360&&u<=43391,"Hangul Syllables":u=>u>=44032&&u<=55215,"Hangul Jamo Extended-B":u=>u>=55216&&u<=55295,"Private Use Area":u=>u>=57344&&u<=63743,"CJK Compatibility Ideographs":u=>u>=63744&&u<=64255,"Arabic Presentation Forms-A":u=>u>=64336&&u<=65023,"Vertical Forms":u=>u>=65040&&u<=65055,"CJK Compatibility Forms":u=>u>=65072&&u<=65103,"Small Form Variants":u=>u>=65104&&u<=65135,"Arabic Presentation Forms-B":u=>u>=65136&&u<=65279,"Halfwidth and Fullwidth Forms":u=>u>=65280&&u<=65519};function Bf(u){for(const o of u)if(Uf(o.charCodeAt(0)))return!0;return!1}function Vf(u){for(const o of u)if(!Yg(o.charCodeAt(0)))return!1;return!0}function Yg(u){return!(ye.Arabic(u)||ye["Arabic Supplement"](u)||ye["Arabic Extended-A"](u)||ye["Arabic Presentation Forms-A"](u)||ye["Arabic Presentation Forms-B"](u))}function Uf(u){return!(u!==746&&u!==747&&(u<4352||!(ye["Bopomofo Extended"](u)||ye.Bopomofo(u)||ye["CJK Compatibility Forms"](u)&&!(u>=65097&&u<=65103)||ye["CJK Compatibility Ideographs"](u)||ye["CJK Compatibility"](u)||ye["CJK Radicals Supplement"](u)||ye["CJK Strokes"](u)||!(!ye["CJK Symbols and Punctuation"](u)||u>=12296&&u<=12305||u>=12308&&u<=12319||u===12336)||ye["CJK Unified Ideographs Extension A"](u)||ye["CJK Unified Ideographs"](u)||ye["Enclosed CJK Letters and Months"](u)||ye["Hangul Compatibility Jamo"](u)||ye["Hangul Jamo Extended-A"](u)||ye["Hangul Jamo Extended-B"](u)||ye["Hangul Jamo"](u)||ye["Hangul Syllables"](u)||ye.Hiragana(u)||ye["Ideographic Description Characters"](u)||ye.Kanbun(u)||ye["Kangxi Radicals"](u)||ye["Katakana Phonetic Extensions"](u)||ye.Katakana(u)&&u!==12540||!(!ye["Halfwidth and Fullwidth Forms"](u)||u===65288||u===65289||u===65293||u>=65306&&u<=65310||u===65339||u===65341||u===65343||u>=65371&&u<=65503||u===65507||u>=65512&&u<=65519)||!(!ye["Small Form Variants"](u)||u>=65112&&u<=65118||u>=65123&&u<=65126)||ye["Unified Canadian Aboriginal Syllabics"](u)||ye["Unified Canadian Aboriginal Syllabics Extended"](u)||ye["Vertical Forms"](u)||ye["Yijing Hexagram Symbols"](u)||ye["Yi Syllables"](u)||ye["Yi Radicals"](u))))}function Kd(u){return!(Uf(u)||function(o){return!!(ye["Latin-1 Supplement"](o)&&(o===167||o===169||o===174||o===177||o===188||o===189||o===190||o===215||o===247)||ye["General Punctuation"](o)&&(o===8214||o===8224||o===8225||o===8240||o===8241||o===8251||o===8252||o===8258||o===8263||o===8264||o===8265||o===8273)||ye["Letterlike Symbols"](o)||ye["Number Forms"](o)||ye["Miscellaneous Technical"](o)&&(o>=8960&&o<=8967||o>=8972&&o<=8991||o>=8996&&o<=9e3||o===9003||o>=9085&&o<=9114||o>=9150&&o<=9165||o===9167||o>=9169&&o<=9179||o>=9186&&o<=9215)||ye["Control Pictures"](o)&&o!==9251||ye["Optical Character Recognition"](o)||ye["Enclosed Alphanumerics"](o)||ye["Geometric Shapes"](o)||ye["Miscellaneous Symbols"](o)&&!(o>=9754&&o<=9759)||ye["Miscellaneous Symbols and Arrows"](o)&&(o>=11026&&o<=11055||o>=11088&&o<=11097||o>=11192&&o<=11243)||ye["CJK Symbols and Punctuation"](o)||ye.Katakana(o)||ye["Private Use Area"](o)||ye["CJK Compatibility Forms"](o)||ye["Small Form Variants"](o)||ye["Halfwidth and Fullwidth Forms"](o)||o===8734||o===8756||o===8757||o>=9984&&o<=10087||o>=10102&&o<=10131||o===65532||o===65533)}(u))}function Jd(u){return u>=1424&&u<=2303||ye["Arabic Presentation Forms-A"](u)||ye["Arabic Presentation Forms-B"](u)}function Qd(u,o){return!(!o&&Jd(u)||u>=2304&&u<=3583||u>=3840&&u<=4255||ye.Khmer(u))}function Kg(u){for(const o of u)if(Jd(o.charCodeAt(0)))return!0;return!1}const Gf="deferred",jf="loading",qf="loaded";let Zf=null,bo="unavailable",el=null;const oc=function(u){u&&typeof u=="string"&&u.indexOf("NetworkError")>-1&&(bo="error"),Zf&&Zf(u)};function $f(){sc.fire(new Wn("pluginStateChange",{pluginStatus:bo,pluginURL:el}))}const sc=new Wi,Wf=function(){return bo},tm=function(){if(bo!==Gf||!el)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");bo=jf,$f(),el&&yt({url:el},u=>{u?oc(u):(bo=qf,$f())})},Fo={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>bo===qf||Fo.applyArabicShaping!=null,isLoading:()=>bo===jf,setState(u){if(!se())throw new Error("Cannot set the state of the rtl-text-plugin when not in the web-worker context");bo=u.pluginStatus,el=u.pluginURL},isParsed(){if(!se())throw new Error("rtl-text-plugin is only parsed on the worker-threads");return Fo.applyArabicShaping!=null&&Fo.processBidirectionalText!=null&&Fo.processStyledBidirectionalText!=null},getPluginURL(){if(!se())throw new Error("rtl-text-plugin url can only be queried from the worker threads");return el}};class pi{constructor(o,c){this.zoom=o,c?(this.now=c.now,this.fadeDuration=c.fadeDuration,this.zoomHistory=c.zoomHistory,this.transition=c.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Yd,this.transition={})}isSupportedScript(o){return function(c,p){for(const m of c)if(!Qd(m.charCodeAt(0),p))return!1;return!0}(o,Fo.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const o=this.zoom,c=o-Math.floor(o),p=this.crossFadingFactor();return o>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:c+(1-c)*p}:{fromScale:.5,toScale:1,t:1-(1-p)*c}}}class fh{constructor(o,c){this.property=o,this.value=c,this.expression=function(p,m){if(Ii(p))return new Ku(p,m);if(nh(p)){const v=Rf(p,m);if(v.result==="error")throw new Error(v.value.map(w=>`${w.key}: ${w.message}`).join(", "));return v.value}{let v=p;return m.type==="color"&&typeof p=="string"?v=Xn.parse(p):m.type!=="padding"||typeof p!="number"&&!Array.isArray(p)?m.type==="variableAnchorOffsetCollection"&&Array.isArray(p)&&(v=os.parse(p)):v=Do.parse(p),{kind:"constant",evaluate:()=>v}}}(c===void 0?o.specification.default:c,o.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(o,c,p){return this.property.possiblyEvaluate(this,o,c,p)}}class Xf{constructor(o){this.property=o,this.value=new fh(o,void 0)}transitioned(o,c){return new nm(this.property,this.value,c,gt({},o.transition,this.transition),o.now)}untransitioned(){return new nm(this.property,this.value,null,{},0)}}class em{constructor(o){this._properties=o,this._values=Object.create(o.defaultTransitionablePropertyValues)}getValue(o){return vt(this._values[o].value.value)}setValue(o,c){Object.prototype.hasOwnProperty.call(this._values,o)||(this._values[o]=new Xf(this._values[o].property)),this._values[o].value=new fh(this._values[o].property,c===null?void 0:vt(c))}getTransition(o){return vt(this._values[o].transition)}setTransition(o,c){Object.prototype.hasOwnProperty.call(this._values,o)||(this._values[o]=new Xf(this._values[o].property)),this._values[o].transition=vt(c)||void 0}serialize(){const o={};for(const c of Object.keys(this._values)){const p=this.getValue(c);p!==void 0&&(o[c]=p);const m=this.getTransition(c);m!==void 0&&(o[`${c}-transition`]=m)}return o}transitioned(o,c){const p=new im(this._properties);for(const m of Object.keys(this._values))p._values[m]=this._values[m].transitioned(o,c._values[m]);return p}untransitioned(){const o=new im(this._properties);for(const c of Object.keys(this._values))o._values[c]=this._values[c].untransitioned();return o}}class nm{constructor(o,c,p,m,v){this.property=o,this.value=c,this.begin=v+m.delay||0,this.end=this.begin+m.duration||0,o.specification.transition&&(m.delay||m.duration)&&(this.prior=p)}possiblyEvaluate(o,c,p){const m=o.now||0,v=this.value.possiblyEvaluate(o,c,p),w=this.prior;if(w){if(m>this.end)return this.prior=null,v;if(this.value.isDataDriven())return this.prior=null,v;if(m<this.begin)return w.possiblyEvaluate(o,c,p);{const E=(m-this.begin)/(this.end-this.begin);return this.property.interpolate(w.possiblyEvaluate(o,c,p),v,function(T){if(T<=0)return 0;if(T>=1)return 1;const k=T*T,D=k*T;return 4*(T<.5?D:3*(T-k)+D-.75)}(E))}}return v}}class im{constructor(o){this._properties=o,this._values=Object.create(o.defaultTransitioningPropertyValues)}possiblyEvaluate(o,c,p){const m=new ph(this._properties);for(const v of Object.keys(this._values))m._values[v]=this._values[v].possiblyEvaluate(o,c,p);return m}hasTransition(){for(const o of Object.keys(this._values))if(this._values[o].prior)return!0;return!1}}class Jg{constructor(o){this._properties=o,this._values=Object.create(o.defaultPropertyValues)}hasValue(o){return this._values[o].value!==void 0}getValue(o){return vt(this._values[o].value)}setValue(o,c){this._values[o]=new fh(this._values[o].property,c===null?void 0:vt(c))}serialize(){const o={};for(const c of Object.keys(this._values)){const p=this.getValue(c);p!==void 0&&(o[c]=p)}return o}possiblyEvaluate(o,c,p){const m=new ph(this._properties);for(const v of Object.keys(this._values))m._values[v]=this._values[v].possiblyEvaluate(o,c,p);return m}}class so{constructor(o,c,p){this.property=o,this.value=c,this.parameters=p}isConstant(){return this.value.kind==="constant"}constantOr(o){return this.value.kind==="constant"?this.value.value:o}evaluate(o,c,p,m){return this.property.evaluate(this.value,this.parameters,o,c,p,m)}}class ph{constructor(o){this._properties=o,this._values=Object.create(o.defaultPossiblyEvaluatedValues)}get(o){return this._values[o]}}class Re{constructor(o){this.specification=o}possiblyEvaluate(o,c){if(o.isDataDriven())throw new Error("Value should not be data driven");return o.expression.evaluate(c)}interpolate(o,c,p){const m=Ro[this.specification.type];return m?m(o,c,p):o}}class Ue{constructor(o,c){this.specification=o,this.overrides=c}possiblyEvaluate(o,c,p,m){return new so(this,o.expression.kind==="constant"||o.expression.kind==="camera"?{kind:"constant",value:o.expression.evaluate(c,null,{},p,m)}:o.expression,c)}interpolate(o,c,p){if(o.value.kind!=="constant"||c.value.kind!=="constant")return o;if(o.value.value===void 0||c.value.value===void 0)return new so(this,{kind:"constant",value:void 0},o.parameters);const m=Ro[this.specification.type];if(m){const v=m(o.value.value,c.value.value,p);return new so(this,{kind:"constant",value:v},o.parameters)}return o}evaluate(o,c,p,m,v,w){return o.kind==="constant"?o.value:o.evaluate(c,p,m,v,w)}}class ac extends Ue{possiblyEvaluate(o,c,p,m){if(o.value===void 0)return new so(this,{kind:"constant",value:void 0},c);if(o.expression.kind==="constant"){const v=o.expression.evaluate(c,null,{},p,m),w=o.property.specification.type==="resolvedImage"&&typeof v!="string"?v.name:v,E=this._calculate(w,w,w,c);return new so(this,{kind:"constant",value:E},c)}if(o.expression.kind==="camera"){const v=this._calculate(o.expression.evaluate({zoom:c.zoom-1}),o.expression.evaluate({zoom:c.zoom}),o.expression.evaluate({zoom:c.zoom+1}),c);return new so(this,{kind:"constant",value:v},c)}return new so(this,o.expression,c)}evaluate(o,c,p,m,v,w){if(o.kind==="source"){const E=o.evaluate(c,p,m,v,w);return this._calculate(E,E,E,c)}return o.kind==="composite"?this._calculate(o.evaluate({zoom:Math.floor(c.zoom)-1},p,m),o.evaluate({zoom:Math.floor(c.zoom)},p,m),o.evaluate({zoom:Math.floor(c.zoom)+1},p,m),c):o.value}_calculate(o,c,p,m){return m.zoom>m.zoomHistory.lastIntegerZoom?{from:o,to:c}:{from:p,to:c}}interpolate(o){return o}}class Hf{constructor(o){this.specification=o}possiblyEvaluate(o,c,p,m){if(o.value!==void 0){if(o.expression.kind==="constant"){const v=o.expression.evaluate(c,null,{},p,m);return this._calculate(v,v,v,c)}return this._calculate(o.expression.evaluate(new pi(Math.floor(c.zoom-1),c)),o.expression.evaluate(new pi(Math.floor(c.zoom),c)),o.expression.evaluate(new pi(Math.floor(c.zoom+1),c)),c)}}_calculate(o,c,p,m){return m.zoom>m.zoomHistory.lastIntegerZoom?{from:o,to:c}:{from:p,to:c}}interpolate(o){return o}}class Yf{constructor(o){this.specification=o}possiblyEvaluate(o,c,p,m){return!!o.expression.evaluate(c,null,{},p,m)}interpolate(){return!1}}class Xi{constructor(o){this.properties=o,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const c in o){const p=o[c];p.specification.overridable&&this.overridableProperties.push(c);const m=this.defaultPropertyValues[c]=new fh(p,void 0),v=this.defaultTransitionablePropertyValues[c]=new Xf(p);this.defaultTransitioningPropertyValues[c]=v.untransitioned(),this.defaultPossiblyEvaluatedValues[c]=m.possiblyEvaluate({})}}}xe("DataDrivenProperty",Ue),xe("DataConstantProperty",Re),xe("CrossFadedDataDrivenProperty",ac),xe("CrossFadedProperty",Hf),xe("ColorRampProperty",Yf);const Kf="-transition";class us extends Wi{constructor(o,c){if(super(),this.id=o.id,this.type=o.type,this._featureFilter={filter:()=>!0,needGeometry:!1},o.type!=="custom"&&(this.metadata=o.metadata,this.minzoom=o.minzoom,this.maxzoom=o.maxzoom,o.type!=="background"&&(this.source=o.source,this.sourceLayer=o["source-layer"],this.filter=o.filter),c.layout&&(this._unevaluatedLayout=new Jg(c.layout)),c.paint)){this._transitionablePaint=new em(c.paint);for(const p in o.paint)this.setPaintProperty(p,o.paint[p],{validate:!1});for(const p in o.layout)this.setLayoutProperty(p,o.layout[p],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new ph(c.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(o){return o==="visibility"?this.visibility:this._unevaluatedLayout.getValue(o)}setLayoutProperty(o,c,p={}){c!=null&&this._validate(Hd,`layers.${this.id}.layout.${o}`,o,c,p)||(o!=="visibility"?this._unevaluatedLayout.setValue(o,c):this.visibility=c)}getPaintProperty(o){return o.endsWith(Kf)?this._transitionablePaint.getTransition(o.slice(0,-11)):this._transitionablePaint.getValue(o)}setPaintProperty(o,c,p={}){if(c!=null&&this._validate(Ff,`layers.${this.id}.paint.${o}`,o,c,p))return!1;if(o.endsWith(Kf))return this._transitionablePaint.setTransition(o.slice(0,-11),c||void 0),!1;{const m=this._transitionablePaint._values[o],v=m.property.specification["property-type"]==="cross-faded-data-driven",w=m.value.isDataDriven(),E=m.value;this._transitionablePaint.setValue(o,c),this._handleSpecialPaintPropertyUpdate(o);const T=this._transitionablePaint._values[o].value;return T.isDataDriven()||w||v||this._handleOverridablePaintPropertyUpdate(o,E,T)}}_handleSpecialPaintPropertyUpdate(o){}_handleOverridablePaintPropertyUpdate(o,c,p){return!1}isHidden(o){return!!(this.minzoom&&o<this.minzoom)||!!(this.maxzoom&&o>=this.maxzoom)||this.visibility==="none"}updateTransitions(o){this._transitioningPaint=this._transitionablePaint.transitioned(o,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(o,c){o.getCrossfadeParameters&&(this._crossfadeParameters=o.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(o,void 0,c)),this.paint=this._transitioningPaint.possiblyEvaluate(o,void 0,c)}serialize(){const o={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(o.layout=o.layout||{},o.layout.visibility=this.visibility),_t(o,(c,p)=>!(c===void 0||p==="layout"&&!Object.keys(c).length||p==="paint"&&!Object.keys(c).length))}_validate(o,c,p,m,v={}){return(!v||v.validate!==!1)&&ch(this,o.call(La,{key:c,layerType:this.type,objectKey:p,value:m,styleSpec:$t,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const o in this.paint._values){const c=this.paint.get(o);if(c instanceof so&&hu(c.property.specification)&&(c.value.kind==="source"||c.value.kind==="composite")&&c.value.isStateDependent)return!0}return!1}}const rm={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Ml{constructor(o,c){this._structArray=o,this._pos1=c*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Di{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(o,c){return o._trim(),c&&(o.isTransferred=!0,c.push(o.arrayBuffer)),{length:o.length,arrayBuffer:o.arrayBuffer}}static deserialize(o){const c=Object.create(this.prototype);return c.arrayBuffer=o.arrayBuffer,c.length=o.length,c.capacity=o.arrayBuffer.byteLength/c.bytesPerElement,c._refreshViews(),c}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(o){this.reserve(o),this.length=o}reserve(o){if(o>this.capacity){this.capacity=Math.max(o,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const c=this.uint8;this._refreshViews(),c&&this.uint8.set(c)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Ti(u,o=1){let c=0,p=0;return{members:u.map(m=>{const v=rm[m.type].BYTES_PER_ELEMENT,w=c=gu(c,Math.max(o,v)),E=m.components||1;return p=Math.max(p,v),c+=v*E,{name:m.name,type:m.type,components:E,offset:w}}),size:gu(c,Math.max(p,o)),alignment:o}}function gu(u,o){return Math.ceil(u/o)*o}class lc extends Di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,c){const p=this.length;return this.resize(p+1),this.emplace(p,o,c)}emplace(o,c,p){const m=2*o;return this.int16[m+0]=c,this.int16[m+1]=p,o}}lc.prototype.bytesPerElement=4,xe("StructArrayLayout2i4",lc);class uc extends Di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,c,p){const m=this.length;return this.resize(m+1),this.emplace(m,o,c,p)}emplace(o,c,p,m){const v=3*o;return this.int16[v+0]=c,this.int16[v+1]=p,this.int16[v+2]=m,o}}uc.prototype.bytesPerElement=6,xe("StructArrayLayout3i6",uc);class Pl extends Di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,c,p,m){const v=this.length;return this.resize(v+1),this.emplace(v,o,c,p,m)}emplace(o,c,p,m,v){const w=4*o;return this.int16[w+0]=c,this.int16[w+1]=p,this.int16[w+2]=m,this.int16[w+3]=v,o}}Pl.prototype.bytesPerElement=8,xe("StructArrayLayout4i8",Pl);class Jf extends Di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,c,p,m,v,w){const E=this.length;return this.resize(E+1),this.emplace(E,o,c,p,m,v,w)}emplace(o,c,p,m,v,w,E){const T=6*o;return this.int16[T+0]=c,this.int16[T+1]=p,this.int16[T+2]=m,this.int16[T+3]=v,this.int16[T+4]=w,this.int16[T+5]=E,o}}Jf.prototype.bytesPerElement=12,xe("StructArrayLayout2i4i12",Jf);class Qf extends Di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,c,p,m,v,w){const E=this.length;return this.resize(E+1),this.emplace(E,o,c,p,m,v,w)}emplace(o,c,p,m,v,w,E){const T=4*o,k=8*o;return this.int16[T+0]=c,this.int16[T+1]=p,this.uint8[k+4]=m,this.uint8[k+5]=v,this.uint8[k+6]=w,this.uint8[k+7]=E,o}}Qf.prototype.bytesPerElement=8,xe("StructArrayLayout2i4ub8",Qf);class _u extends Di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,c){const p=this.length;return this.resize(p+1),this.emplace(p,o,c)}emplace(o,c,p){const m=2*o;return this.float32[m+0]=c,this.float32[m+1]=p,o}}_u.prototype.bytesPerElement=8,xe("StructArrayLayout2f8",_u);class tp extends Di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,c,p,m,v,w,E,T,k,D){const F=this.length;return this.resize(F+1),this.emplace(F,o,c,p,m,v,w,E,T,k,D)}emplace(o,c,p,m,v,w,E,T,k,D,F){const j=10*o;return this.uint16[j+0]=c,this.uint16[j+1]=p,this.uint16[j+2]=m,this.uint16[j+3]=v,this.uint16[j+4]=w,this.uint16[j+5]=E,this.uint16[j+6]=T,this.uint16[j+7]=k,this.uint16[j+8]=D,this.uint16[j+9]=F,o}}tp.prototype.bytesPerElement=20,xe("StructArrayLayout10ui20",tp);class ep extends Di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,c,p,m,v,w,E,T,k,D,F,j){const X=this.length;return this.resize(X+1),this.emplace(X,o,c,p,m,v,w,E,T,k,D,F,j)}emplace(o,c,p,m,v,w,E,T,k,D,F,j,X){const H=12*o;return this.int16[H+0]=c,this.int16[H+1]=p,this.int16[H+2]=m,this.int16[H+3]=v,this.uint16[H+4]=w,this.uint16[H+5]=E,this.uint16[H+6]=T,this.uint16[H+7]=k,this.int16[H+8]=D,this.int16[H+9]=F,this.int16[H+10]=j,this.int16[H+11]=X,o}}ep.prototype.bytesPerElement=24,xe("StructArrayLayout4i4ui4i24",ep);class Vn extends Di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,c,p){const m=this.length;return this.resize(m+1),this.emplace(m,o,c,p)}emplace(o,c,p,m){const v=3*o;return this.float32[v+0]=c,this.float32[v+1]=p,this.float32[v+2]=m,o}}Vn.prototype.bytesPerElement=12,xe("StructArrayLayout3f12",Vn);class y extends Di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(o){const c=this.length;return this.resize(c+1),this.emplace(c,o)}emplace(o,c){return this.uint32[1*o+0]=c,o}}y.prototype.bytesPerElement=4,xe("StructArrayLayout1ul4",y);class s extends Di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,c,p,m,v,w,E,T,k){const D=this.length;return this.resize(D+1),this.emplace(D,o,c,p,m,v,w,E,T,k)}emplace(o,c,p,m,v,w,E,T,k,D){const F=10*o,j=5*o;return this.int16[F+0]=c,this.int16[F+1]=p,this.int16[F+2]=m,this.int16[F+3]=v,this.int16[F+4]=w,this.int16[F+5]=E,this.uint32[j+3]=T,this.uint16[F+8]=k,this.uint16[F+9]=D,o}}s.prototype.bytesPerElement=20,xe("StructArrayLayout6i1ul2ui20",s);class h extends Di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,c,p,m,v,w){const E=this.length;return this.resize(E+1),this.emplace(E,o,c,p,m,v,w)}emplace(o,c,p,m,v,w,E){const T=6*o;return this.int16[T+0]=c,this.int16[T+1]=p,this.int16[T+2]=m,this.int16[T+3]=v,this.int16[T+4]=w,this.int16[T+5]=E,o}}h.prototype.bytesPerElement=12,xe("StructArrayLayout2i2i2i12",h);class d extends Di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,c,p,m,v){const w=this.length;return this.resize(w+1),this.emplace(w,o,c,p,m,v)}emplace(o,c,p,m,v,w){const E=4*o,T=8*o;return this.float32[E+0]=c,this.float32[E+1]=p,this.float32[E+2]=m,this.int16[T+6]=v,this.int16[T+7]=w,o}}d.prototype.bytesPerElement=16,xe("StructArrayLayout2f1f2i16",d);class g extends Di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,c,p,m){const v=this.length;return this.resize(v+1),this.emplace(v,o,c,p,m)}emplace(o,c,p,m,v){const w=12*o,E=3*o;return this.uint8[w+0]=c,this.uint8[w+1]=p,this.float32[E+1]=m,this.float32[E+2]=v,o}}g.prototype.bytesPerElement=12,xe("StructArrayLayout2ub2f12",g);class b extends Di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,c,p){const m=this.length;return this.resize(m+1),this.emplace(m,o,c,p)}emplace(o,c,p,m){const v=3*o;return this.uint16[v+0]=c,this.uint16[v+1]=p,this.uint16[v+2]=m,o}}b.prototype.bytesPerElement=6,xe("StructArrayLayout3ui6",b);class I extends Di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,c,p,m,v,w,E,T,k,D,F,j,X,H,tt,lt,ht){const At=this.length;return this.resize(At+1),this.emplace(At,o,c,p,m,v,w,E,T,k,D,F,j,X,H,tt,lt,ht)}emplace(o,c,p,m,v,w,E,T,k,D,F,j,X,H,tt,lt,ht,At){const Et=24*o,Nt=12*o,Ft=48*o;return this.int16[Et+0]=c,this.int16[Et+1]=p,this.uint16[Et+2]=m,this.uint16[Et+3]=v,this.uint32[Nt+2]=w,this.uint32[Nt+3]=E,this.uint32[Nt+4]=T,this.uint16[Et+10]=k,this.uint16[Et+11]=D,this.uint16[Et+12]=F,this.float32[Nt+7]=j,this.float32[Nt+8]=X,this.uint8[Ft+36]=H,this.uint8[Ft+37]=tt,this.uint8[Ft+38]=lt,this.uint32[Nt+10]=ht,this.int16[Et+22]=At,o}}I.prototype.bytesPerElement=48,xe("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",I);class C extends Di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,c,p,m,v,w,E,T,k,D,F,j,X,H,tt,lt,ht,At,Et,Nt,Ft,Jt,ve,Me,_e,de,ue,we){const he=this.length;return this.resize(he+1),this.emplace(he,o,c,p,m,v,w,E,T,k,D,F,j,X,H,tt,lt,ht,At,Et,Nt,Ft,Jt,ve,Me,_e,de,ue,we)}emplace(o,c,p,m,v,w,E,T,k,D,F,j,X,H,tt,lt,ht,At,Et,Nt,Ft,Jt,ve,Me,_e,de,ue,we,he){const ie=32*o,Be=16*o;return this.int16[ie+0]=c,this.int16[ie+1]=p,this.int16[ie+2]=m,this.int16[ie+3]=v,this.int16[ie+4]=w,this.int16[ie+5]=E,this.int16[ie+6]=T,this.int16[ie+7]=k,this.uint16[ie+8]=D,this.uint16[ie+9]=F,this.uint16[ie+10]=j,this.uint16[ie+11]=X,this.uint16[ie+12]=H,this.uint16[ie+13]=tt,this.uint16[ie+14]=lt,this.uint16[ie+15]=ht,this.uint16[ie+16]=At,this.uint16[ie+17]=Et,this.uint16[ie+18]=Nt,this.uint16[ie+19]=Ft,this.uint16[ie+20]=Jt,this.uint16[ie+21]=ve,this.uint16[ie+22]=Me,this.uint32[Be+12]=_e,this.float32[Be+13]=de,this.float32[Be+14]=ue,this.uint16[ie+30]=we,this.uint16[ie+31]=he,o}}C.prototype.bytesPerElement=64,xe("StructArrayLayout8i15ui1ul2f2ui64",C);class M extends Di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o){const c=this.length;return this.resize(c+1),this.emplace(c,o)}emplace(o,c){return this.float32[1*o+0]=c,o}}M.prototype.bytesPerElement=4,xe("StructArrayLayout1f4",M);class N extends Di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,c,p){const m=this.length;return this.resize(m+1),this.emplace(m,o,c,p)}emplace(o,c,p,m){const v=3*o;return this.uint16[6*o+0]=c,this.float32[v+1]=p,this.float32[v+2]=m,o}}N.prototype.bytesPerElement=12,xe("StructArrayLayout1ui2f12",N);class R extends Di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,c,p){const m=this.length;return this.resize(m+1),this.emplace(m,o,c,p)}emplace(o,c,p,m){const v=4*o;return this.uint32[2*o+0]=c,this.uint16[v+2]=p,this.uint16[v+3]=m,o}}R.prototype.bytesPerElement=8,xe("StructArrayLayout1ul2ui8",R);class z extends Di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,c){const p=this.length;return this.resize(p+1),this.emplace(p,o,c)}emplace(o,c,p){const m=2*o;return this.uint16[m+0]=c,this.uint16[m+1]=p,o}}z.prototype.bytesPerElement=4,xe("StructArrayLayout2ui4",z);class W extends Di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o){const c=this.length;return this.resize(c+1),this.emplace(c,o)}emplace(o,c){return this.uint16[1*o+0]=c,o}}W.prototype.bytesPerElement=2,xe("StructArrayLayout1ui2",W);class nt extends Di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,c,p,m){const v=this.length;return this.resize(v+1),this.emplace(v,o,c,p,m)}emplace(o,c,p,m,v){const w=4*o;return this.float32[w+0]=c,this.float32[w+1]=p,this.float32[w+2]=m,this.float32[w+3]=v,o}}nt.prototype.bytesPerElement=16,xe("StructArrayLayout4f16",nt);class et extends Ml{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new A(this.anchorPointX,this.anchorPointY)}}et.prototype.size=20;class at extends s{get(o){return new et(this,o)}}xe("CollisionBoxArray",at);class Q extends Ml{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(o){this._structArray.uint8[this._pos1+37]=o}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(o){this._structArray.uint8[this._pos1+38]=o}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(o){this._structArray.uint32[this._pos4+10]=o}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}Q.prototype.size=48;class Lt extends I{get(o){return new Q(this,o)}}xe("PlacedSymbolArray",Lt);class Ot extends Ml{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(o){this._structArray.uint32[this._pos4+12]=o}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}Ot.prototype.size=64;class ct extends C{get(o){return new Ot(this,o)}}xe("SymbolInstanceArray",ct);class Pt extends M{getoffsetX(o){return this.float32[1*o+0]}}xe("GlyphOffsetArray",Pt);class Bt extends uc{getx(o){return this.int16[3*o+0]}gety(o){return this.int16[3*o+1]}gettileUnitDistanceFromAnchor(o){return this.int16[3*o+2]}}xe("SymbolLineVertexArray",Bt);class Vt extends Ml{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}Vt.prototype.size=12;class Yt extends N{get(o){return new Vt(this,o)}}xe("TextAnchorOffsetArray",Yt);class ne extends Ml{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}ne.prototype.size=8;class te extends R{get(o){return new ne(this,o)}}xe("FeatureIndexArray",te);class ae extends lc{}class Le extends lc{}class vn extends lc{}class pe extends Jf{}class Ge extends Qf{}class Pe extends _u{}class Hn extends tp{}class _n extends ep{}class un extends Vn{}class bn extends y{}class Ui extends h{}class si extends g{}class Rr extends b{}class pr extends z{}const Hi=Ti([{name:"a_pos",components:2,type:"Int16"}],4),{members:Bo}=Hi;class di{constructor(o=[]){this.segments=o}prepareSegment(o,c,p,m){let v=this.segments[this.segments.length-1];return o>di.MAX_VERTEX_ARRAY_LENGTH&&kt(`Max vertices per segment is ${di.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${o}`),(!v||v.vertexLength+o>di.MAX_VERTEX_ARRAY_LENGTH||v.sortKey!==m)&&(v={vertexOffset:c.length,primitiveOffset:p.length,vertexLength:0,primitiveLength:0},m!==void 0&&(v.sortKey=m),this.segments.push(v)),v}get(){return this.segments}destroy(){for(const o of this.segments)for(const c in o.vaos)o.vaos[c].destroy()}static simpleSegment(o,c,p,m){return new di([{vertexOffset:o,primitiveOffset:c,vertexLength:p,primitiveLength:m,vaos:{},sortKey:0}])}}function Zs(u,o){return 256*(u=ft(Math.floor(u),0,255))+ft(Math.floor(o),0,255)}di.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,xe("SegmentVector",di);const $s=Ti([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var nl={exports:{}},kl={exports:{}};kl.exports=function(u,o){var c,p,m,v,w,E,T,k;for(p=u.length-(c=3&u.length),m=o,w=3432918353,E=461845907,k=0;k<p;)T=255&u.charCodeAt(k)|(255&u.charCodeAt(++k))<<8|(255&u.charCodeAt(++k))<<16|(255&u.charCodeAt(++k))<<24,++k,m=27492+(65535&(v=5*(65535&(m=(m^=T=(65535&(T=(T=(65535&T)*w+(((T>>>16)*w&65535)<<16)&4294967295)<<15|T>>>17))*E+(((T>>>16)*E&65535)<<16)&4294967295)<<13|m>>>19))+((5*(m>>>16)&65535)<<16)&4294967295))+((58964+(v>>>16)&65535)<<16);switch(T=0,c){case 3:T^=(255&u.charCodeAt(k+2))<<16;case 2:T^=(255&u.charCodeAt(k+1))<<8;case 1:m^=T=(65535&(T=(T=(65535&(T^=255&u.charCodeAt(k)))*w+(((T>>>16)*w&65535)<<16)&4294967295)<<15|T>>>17))*E+(((T>>>16)*E&65535)<<16)&4294967295}return m^=u.length,m=2246822507*(65535&(m^=m>>>16))+((2246822507*(m>>>16)&65535)<<16)&4294967295,m=3266489909*(65535&(m^=m>>>13))+((3266489909*(m>>>16)&65535)<<16)&4294967295,(m^=m>>>16)>>>0};var yu=kl.exports,$r={exports:{}};$r.exports=function(u,o){for(var c,p=u.length,m=o^p,v=0;p>=4;)c=1540483477*(65535&(c=255&u.charCodeAt(v)|(255&u.charCodeAt(++v))<<8|(255&u.charCodeAt(++v))<<16|(255&u.charCodeAt(++v))<<24))+((1540483477*(c>>>16)&65535)<<16),m=1540483477*(65535&m)+((1540483477*(m>>>16)&65535)<<16)^(c=1540483477*(65535&(c^=c>>>24))+((1540483477*(c>>>16)&65535)<<16)),p-=4,++v;switch(p){case 3:m^=(255&u.charCodeAt(v+2))<<16;case 2:m^=(255&u.charCodeAt(v+1))<<8;case 1:m=1540483477*(65535&(m^=255&u.charCodeAt(v)))+((1540483477*(m>>>16)&65535)<<16)}return m=1540483477*(65535&(m^=m>>>13))+((1540483477*(m>>>16)&65535)<<16),(m^=m>>>15)>>>0};var Or=yu,ao=$r.exports;nl.exports=Or,nl.exports.murmur3=Or,nl.exports.murmur2=ao;var Al=x(nl.exports);class Gi{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(o,c,p,m){this.ids.push(dr(o)),this.positions.push(c,p,m)}getPositions(o){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const c=dr(o);let p=0,m=this.ids.length-1;for(;p<m;){const w=p+m>>1;this.ids[w]>=c?m=w:p=w+1}const v=[];for(;this.ids[p]===c;)v.push({index:this.positions[3*p],start:this.positions[3*p+1],end:this.positions[3*p+2]}),p++;return v}static serialize(o,c){const p=new Float64Array(o.ids),m=new Uint32Array(o.positions);return xo(p,m,0,p.length-1),c&&c.push(p.buffer,m.buffer),{ids:p,positions:m}}static deserialize(o){const c=new Gi;return c.ids=o.ids,c.positions=o.positions,c.indexed=!0,c}}function dr(u){const o=+u;return!isNaN(o)&&o<=Number.MAX_SAFE_INTEGER?o:Al(String(u))}function xo(u,o,c,p){for(;c<p;){const m=u[c+p>>1];let v=c-1,w=p+1;for(;;){do v++;while(u[v]<m);do w--;while(u[w]>m);if(v>=w)break;ji(u,v,w),ji(o,3*v,3*w),ji(o,3*v+1,3*w+1),ji(o,3*v+2,3*w+2)}w-c<p-w?(xo(u,o,c,w),c=w+1):(xo(u,o,w+1,p),p=w)}}function ji(u,o,c){const p=u[o];u[o]=u[c],u[c]=p}xe("FeaturePositionMap",Gi);class Nl{constructor(o,c){this.gl=o.gl,this.location=c}}class dh extends Nl{constructor(o,c){super(o,c),this.current=0}set(o){this.current!==o&&(this.current=o,this.gl.uniform1f(this.location,o))}}class om extends Nl{constructor(o,c){super(o,c),this.current=[0,0,0,0]}set(o){o[0]===this.current[0]&&o[1]===this.current[1]&&o[2]===this.current[2]&&o[3]===this.current[3]||(this.current=o,this.gl.uniform4f(this.location,o[0],o[1],o[2],o[3]))}}class sm extends Nl{constructor(o,c){super(o,c),this.current=Xn.transparent}set(o){o.r===this.current.r&&o.g===this.current.g&&o.b===this.current.b&&o.a===this.current.a||(this.current=o,this.gl.uniform4f(this.location,o.r,o.g,o.b,o.a))}}const Qg=new Float32Array(16);function np(u){return[Zs(255*u.r,255*u.g),Zs(255*u.b,255*u.a)]}class Ws{constructor(o,c,p){this.value=o,this.uniformNames=c.map(m=>`u_${m}`),this.type=p}setUniform(o,c,p){o.set(p.constantOr(this.value))}getBinding(o,c,p){return this.type==="color"?new sm(o,c):new dh(o,c)}}class Dl{constructor(o,c){this.uniformNames=c.map(p=>`u_${p}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(o,c){this.pixelRatioFrom=c.pixelRatio,this.pixelRatioTo=o.pixelRatio,this.patternFrom=c.tlbr,this.patternTo=o.tlbr}setUniform(o,c,p,m){const v=m==="u_pattern_to"?this.patternTo:m==="u_pattern_from"?this.patternFrom:m==="u_pixel_ratio_to"?this.pixelRatioTo:m==="u_pixel_ratio_from"?this.pixelRatioFrom:null;v&&o.set(v)}getBinding(o,c,p){return p.substr(0,9)==="u_pattern"?new om(o,c):new dh(o,c)}}class Xs{constructor(o,c,p,m){this.expression=o,this.type=p,this.maxValue=0,this.paintVertexAttributes=c.map(v=>({name:`a_${v}`,type:"Float32",components:p==="color"?2:1,offset:0})),this.paintVertexArray=new m}populatePaintArray(o,c,p,m,v){const w=this.paintVertexArray.length,E=this.expression.evaluate(new pi(0),c,{},m,[],v);this.paintVertexArray.resize(o),this._setPaintValue(w,o,E)}updatePaintArray(o,c,p,m){const v=this.expression.evaluate({zoom:0},p,m);this._setPaintValue(o,c,v)}_setPaintValue(o,c,p){if(this.type==="color"){const m=np(p);for(let v=o;v<c;v++)this.paintVertexArray.emplace(v,m[0],m[1])}else{for(let m=o;m<c;m++)this.paintVertexArray.emplace(m,p);this.maxValue=Math.max(this.maxValue,Math.abs(p))}}upload(o){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class cs{constructor(o,c,p,m,v,w){this.expression=o,this.uniformNames=c.map(E=>`u_${E}_t`),this.type=p,this.useIntegerZoom=m,this.zoom=v,this.maxValue=0,this.paintVertexAttributes=c.map(E=>({name:`a_${E}`,type:"Float32",components:p==="color"?4:2,offset:0})),this.paintVertexArray=new w}populatePaintArray(o,c,p,m,v){const w=this.expression.evaluate(new pi(this.zoom),c,{},m,[],v),E=this.expression.evaluate(new pi(this.zoom+1),c,{},m,[],v),T=this.paintVertexArray.length;this.paintVertexArray.resize(o),this._setPaintValue(T,o,w,E)}updatePaintArray(o,c,p,m){const v=this.expression.evaluate({zoom:this.zoom},p,m),w=this.expression.evaluate({zoom:this.zoom+1},p,m);this._setPaintValue(o,c,v,w)}_setPaintValue(o,c,p,m){if(this.type==="color"){const v=np(p),w=np(m);for(let E=o;E<c;E++)this.paintVertexArray.emplace(E,v[0],v[1],w[0],w[1])}else{for(let v=o;v<c;v++)this.paintVertexArray.emplace(v,p,m);this.maxValue=Math.max(this.maxValue,Math.abs(p),Math.abs(m))}}upload(o){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(o,c){const p=this.useIntegerZoom?Math.floor(c.zoom):c.zoom,m=ft(this.expression.interpolationFactor(p,this.zoom,this.zoom+1),0,1);o.set(m)}getBinding(o,c,p){return new dh(o,c)}}class Hs{constructor(o,c,p,m,v,w){this.expression=o,this.type=c,this.useIntegerZoom=p,this.zoom=m,this.layerId=w,this.zoomInPaintVertexArray=new v,this.zoomOutPaintVertexArray=new v}populatePaintArray(o,c,p){const m=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(o),this.zoomOutPaintVertexArray.resize(o),this._setPaintValues(m,o,c.patterns&&c.patterns[this.layerId],p)}updatePaintArray(o,c,p,m,v){this._setPaintValues(o,c,p.patterns&&p.patterns[this.layerId],v)}_setPaintValues(o,c,p,m){if(!m||!p)return;const{min:v,mid:w,max:E}=p,T=m[v],k=m[w],D=m[E];if(T&&k&&D)for(let F=o;F<c;F++)this.zoomInPaintVertexArray.emplace(F,k.tl[0],k.tl[1],k.br[0],k.br[1],T.tl[0],T.tl[1],T.br[0],T.br[1],k.pixelRatio,T.pixelRatio),this.zoomOutPaintVertexArray.emplace(F,k.tl[0],k.tl[1],k.br[0],k.br[1],D.tl[0],D.tl[1],D.br[0],D.br[1],k.pixelRatio,D.pixelRatio)}upload(o){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=o.createVertexBuffer(this.zoomInPaintVertexArray,$s.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=o.createVertexBuffer(this.zoomOutPaintVertexArray,$s.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class ip{constructor(o,c,p){this.binders={},this._buffers=[];const m=[];for(const v in o.paint._values){if(!p(v))continue;const w=o.paint.get(v);if(!(w instanceof so&&hu(w.property.specification)))continue;const E=Aw(v,o.type),T=w.value,k=w.property.specification.type,D=w.property.useIntegerZoom,F=w.property.specification["property-type"],j=F==="cross-faded"||F==="cross-faded-data-driven";if(T.kind==="constant")this.binders[v]=j?new Dl(T.value,E):new Ws(T.value,E,k),m.push(`/u_${v}`);else if(T.kind==="source"||j){const X=o0(v,k,"source");this.binders[v]=j?new Hs(T,k,D,c,X,o.id):new Xs(T,E,k,X),m.push(`/a_${v}`)}else{const X=o0(v,k,"composite");this.binders[v]=new cs(T,E,k,D,c,X),m.push(`/z_${v}`)}}this.cacheKey=m.sort().join("")}getMaxValue(o){const c=this.binders[o];return c instanceof Xs||c instanceof cs?c.maxValue:0}populatePaintArrays(o,c,p,m,v){for(const w in this.binders){const E=this.binders[w];(E instanceof Xs||E instanceof cs||E instanceof Hs)&&E.populatePaintArray(o,c,p,m,v)}}setConstantPatternPositions(o,c){for(const p in this.binders){const m=this.binders[p];m instanceof Dl&&m.setConstantPatternPositions(o,c)}}updatePaintArrays(o,c,p,m,v){let w=!1;for(const E in o){const T=c.getPositions(E);for(const k of T){const D=p.feature(k.index);for(const F in this.binders){const j=this.binders[F];if((j instanceof Xs||j instanceof cs||j instanceof Hs)&&j.expression.isStateDependent===!0){const X=m.paint.get(F);j.expression=X.value,j.updatePaintArray(k.start,k.end,D,o[E],v),w=!0}}}}return w}defines(){const o=[];for(const c in this.binders){const p=this.binders[c];(p instanceof Ws||p instanceof Dl)&&o.push(...p.uniformNames.map(m=>`#define HAS_UNIFORM_${m}`))}return o}getBinderAttributes(){const o=[];for(const c in this.binders){const p=this.binders[c];if(p instanceof Xs||p instanceof cs)for(let m=0;m<p.paintVertexAttributes.length;m++)o.push(p.paintVertexAttributes[m].name);else if(p instanceof Hs)for(let m=0;m<$s.members.length;m++)o.push($s.members[m].name)}return o}getBinderUniforms(){const o=[];for(const c in this.binders){const p=this.binders[c];if(p instanceof Ws||p instanceof Dl||p instanceof cs)for(const m of p.uniformNames)o.push(m)}return o}getPaintVertexBuffers(){return this._buffers}getUniforms(o,c){const p=[];for(const m in this.binders){const v=this.binders[m];if(v instanceof Ws||v instanceof Dl||v instanceof cs){for(const w of v.uniformNames)if(c[w]){const E=v.getBinding(o,c[w],w);p.push({name:w,property:m,binding:E})}}}return p}setUniforms(o,c,p,m){for(const{name:v,property:w,binding:E}of c)this.binders[w].setUniform(E,m,p.get(w),v)}updatePaintBuffers(o){this._buffers=[];for(const c in this.binders){const p=this.binders[c];if(o&&p instanceof Hs){const m=o.fromScale===2?p.zoomInPaintVertexBuffer:p.zoomOutPaintVertexBuffer;m&&this._buffers.push(m)}else(p instanceof Xs||p instanceof cs)&&p.paintVertexBuffer&&this._buffers.push(p.paintVertexBuffer)}}upload(o){for(const c in this.binders){const p=this.binders[c];(p instanceof Xs||p instanceof cs||p instanceof Hs)&&p.upload(o)}this.updatePaintBuffers()}destroy(){for(const o in this.binders){const c=this.binders[o];(c instanceof Xs||c instanceof cs||c instanceof Hs)&&c.destroy()}}}class Pa{constructor(o,c,p=()=>!0){this.programConfigurations={};for(const m of o)this.programConfigurations[m.id]=new ip(m,c,p);this.needsUpload=!1,this._featureMap=new Gi,this._bufferOffset=0}populatePaintArrays(o,c,p,m,v,w){for(const E in this.programConfigurations)this.programConfigurations[E].populatePaintArrays(o,c,m,v,w);c.id!==void 0&&this._featureMap.add(c.id,p,this._bufferOffset,o),this._bufferOffset=o,this.needsUpload=!0}updatePaintArrays(o,c,p,m){for(const v of p)this.needsUpload=this.programConfigurations[v.id].updatePaintArrays(o,this._featureMap,c,v,m)||this.needsUpload}get(o){return this.programConfigurations[o]}upload(o){if(this.needsUpload){for(const c in this.programConfigurations)this.programConfigurations[c].upload(o);this.needsUpload=!1}}destroy(){for(const o in this.programConfigurations)this.programConfigurations[o].destroy()}}function Aw(u,o){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[u]||[u.replace(`${o}-`,"").replace(/-/g,"_")]}function o0(u,o,c){const p={color:{source:_u,composite:nt},number:{source:M,composite:_u}},m=function(v){return{"line-pattern":{source:Hn,composite:Hn},"fill-pattern":{source:Hn,composite:Hn},"fill-extrusion-pattern":{source:Hn,composite:Hn}}[v]}(u);return m&&m[c]||p[o][c]}xe("ConstantBinder",Ws),xe("CrossFadedConstantBinder",Dl),xe("SourceExpressionBinder",Xs),xe("CrossFadedCompositeBinder",Hs),xe("CompositeExpressionBinder",cs),xe("ProgramConfiguration",ip,{omit:["_buffers"]}),xe("ProgramConfigurationSet",Pa);const rr=8192,t_=Math.pow(2,14)-1,s0=-t_-1;function cc(u){const o=rr/u.extent,c=u.loadGeometry();for(let p=0;p<c.length;p++){const m=c[p];for(let v=0;v<m.length;v++){const w=m[v],E=Math.round(w.x*o),T=Math.round(w.y*o);w.x=ft(E,s0,t_),w.y=ft(T,s0,t_),(E<w.x||E>w.x+1||T<w.y||T>w.y+1)&&kt("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return c}function hc(u,o){return{type:u.type,id:u.id,properties:u.properties,geometry:o?cc(u):[]}}function am(u,o,c,p,m){u.emplaceBack(2*o+(p+1)/2,2*c+(m+1)/2)}class e_{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(c=>c.id),this.index=o.index,this.hasPattern=!1,this.layoutVertexArray=new Le,this.indexArray=new Rr,this.segments=new di,this.programConfigurations=new Pa(o.layers,o.zoom),this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id)}populate(o,c,p){const m=this.layers[0],v=[];let w=null,E=!1;m.type==="circle"&&(w=m.layout.get("circle-sort-key"),E=!w.isConstant());for(const{feature:T,id:k,index:D,sourceLayerIndex:F}of o){const j=this.layers[0]._featureFilter.needGeometry,X=hc(T,j);if(!this.layers[0]._featureFilter.filter(new pi(this.zoom),X,p))continue;const H=E?w.evaluate(X,{},p):void 0,tt={id:k,properties:T.properties,type:T.type,sourceLayerIndex:F,index:D,geometry:j?X.geometry:cc(T),patterns:{},sortKey:H};v.push(tt)}E&&v.sort((T,k)=>T.sortKey-k.sortKey);for(const T of v){const{geometry:k,index:D,sourceLayerIndex:F}=T,j=o[D].feature;this.addFeature(T,k,D,p),c.featureIndex.insert(j,k,D,F,this.index)}}update(o,c,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,c,this.stateDependentLayers,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,Bo),this.indexBuffer=o.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(o,c,p,m){for(const v of c)for(const w of v){const E=w.x,T=w.y;if(E<0||E>=rr||T<0||T>=rr)continue;const k=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,o.sortKey),D=k.vertexLength;am(this.layoutVertexArray,E,T,-1,-1),am(this.layoutVertexArray,E,T,1,-1),am(this.layoutVertexArray,E,T,1,1),am(this.layoutVertexArray,E,T,-1,1),this.indexArray.emplaceBack(D,D+1,D+2),this.indexArray.emplaceBack(D,D+3,D+2),k.vertexLength+=4,k.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,p,{},m)}}function a0(u,o){for(let c=0;c<u.length;c++)if(mh(o,u[c]))return!0;for(let c=0;c<o.length;c++)if(mh(u,o[c]))return!0;return!!n_(u,o)}function Nw(u,o,c){return!!mh(u,o)||!!i_(o,u,c)}function l0(u,o){if(u.length===1)return c0(o,u[0]);for(let c=0;c<o.length;c++){const p=o[c];for(let m=0;m<p.length;m++)if(mh(u,p[m]))return!0}for(let c=0;c<u.length;c++)if(c0(o,u[c]))return!0;for(let c=0;c<o.length;c++)if(n_(u,o[c]))return!0;return!1}function Dw(u,o,c){if(u.length>1){if(n_(u,o))return!0;for(let p=0;p<o.length;p++)if(i_(o[p],u,c))return!0}for(let p=0;p<u.length;p++)if(i_(u[p],o,c))return!0;return!1}function n_(u,o){if(u.length===0||o.length===0)return!1;for(let c=0;c<u.length-1;c++){const p=u[c],m=u[c+1];for(let v=0;v<o.length-1;v++)if(Rw(p,m,o[v],o[v+1]))return!0}return!1}function Rw(u,o,c,p){return Gt(u,c,p)!==Gt(o,c,p)&&Gt(u,o,c)!==Gt(u,o,p)}function i_(u,o,c){const p=c*c;if(o.length===1)return u.distSqr(o[0])<p;for(let m=1;m<o.length;m++)if(u0(u,o[m-1],o[m])<p)return!0;return!1}function u0(u,o,c){const p=o.distSqr(c);if(p===0)return u.distSqr(o);const m=((u.x-o.x)*(c.x-o.x)+(u.y-o.y)*(c.y-o.y))/p;return u.distSqr(m<0?o:m>1?c:c.sub(o)._mult(m)._add(o))}function c0(u,o){let c,p,m,v=!1;for(let w=0;w<u.length;w++){c=u[w];for(let E=0,T=c.length-1;E<c.length;T=E++)p=c[E],m=c[T],p.y>o.y!=m.y>o.y&&o.x<(m.x-p.x)*(o.y-p.y)/(m.y-p.y)+p.x&&(v=!v)}return v}function mh(u,o){let c=!1;for(let p=0,m=u.length-1;p<u.length;m=p++){const v=u[p],w=u[m];v.y>o.y!=w.y>o.y&&o.x<(w.x-v.x)*(o.y-v.y)/(w.y-v.y)+v.x&&(c=!c)}return c}function Ow(u,o,c){const p=c[0],m=c[2];if(u.x<p.x&&o.x<p.x||u.x>m.x&&o.x>m.x||u.y<p.y&&o.y<p.y||u.y>m.y&&o.y>m.y)return!1;const v=Gt(u,o,c[0]);return v!==Gt(u,o,c[1])||v!==Gt(u,o,c[2])||v!==Gt(u,o,c[3])}function rp(u,o,c){const p=o.paint.get(u).value;return p.kind==="constant"?p.value:c.programConfigurations.get(o.id).getMaxValue(u)}function lm(u){return Math.sqrt(u[0]*u[0]+u[1]*u[1])}function um(u,o,c,p,m){if(!o[0]&&!o[1])return u;const v=A.convert(o)._mult(m);c==="viewport"&&v._rotate(-p);const w=[];for(let E=0;E<u.length;E++)w.push(u[E].sub(v));return w}let h0,f0;xe("CircleBucket",e_,{omit:["layers"]});var zw={get paint(){return f0=f0||new Xi({"circle-radius":new Ue($t.paint_circle["circle-radius"]),"circle-color":new Ue($t.paint_circle["circle-color"]),"circle-blur":new Ue($t.paint_circle["circle-blur"]),"circle-opacity":new Ue($t.paint_circle["circle-opacity"]),"circle-translate":new Re($t.paint_circle["circle-translate"]),"circle-translate-anchor":new Re($t.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Re($t.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Re($t.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Ue($t.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Ue($t.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Ue($t.paint_circle["circle-stroke-opacity"])})},get layout(){return h0=h0||new Xi({"circle-sort-key":new Ue($t.layout_circle["circle-sort-key"])})}},wo=1e-6,gh=typeof Float32Array<"u"?Float32Array:Array;function r_(u){return u[0]=1,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=1,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=1,u[11]=0,u[12]=0,u[13]=0,u[14]=0,u[15]=1,u}function p0(u,o,c){var p=o[0],m=o[1],v=o[2],w=o[3],E=o[4],T=o[5],k=o[6],D=o[7],F=o[8],j=o[9],X=o[10],H=o[11],tt=o[12],lt=o[13],ht=o[14],At=o[15],Et=c[0],Nt=c[1],Ft=c[2],Jt=c[3];return u[0]=Et*p+Nt*E+Ft*F+Jt*tt,u[1]=Et*m+Nt*T+Ft*j+Jt*lt,u[2]=Et*v+Nt*k+Ft*X+Jt*ht,u[3]=Et*w+Nt*D+Ft*H+Jt*At,u[4]=(Et=c[4])*p+(Nt=c[5])*E+(Ft=c[6])*F+(Jt=c[7])*tt,u[5]=Et*m+Nt*T+Ft*j+Jt*lt,u[6]=Et*v+Nt*k+Ft*X+Jt*ht,u[7]=Et*w+Nt*D+Ft*H+Jt*At,u[8]=(Et=c[8])*p+(Nt=c[9])*E+(Ft=c[10])*F+(Jt=c[11])*tt,u[9]=Et*m+Nt*T+Ft*j+Jt*lt,u[10]=Et*v+Nt*k+Ft*X+Jt*ht,u[11]=Et*w+Nt*D+Ft*H+Jt*At,u[12]=(Et=c[12])*p+(Nt=c[13])*E+(Ft=c[14])*F+(Jt=c[15])*tt,u[13]=Et*m+Nt*T+Ft*j+Jt*lt,u[14]=Et*v+Nt*k+Ft*X+Jt*ht,u[15]=Et*w+Nt*D+Ft*H+Jt*At,u}Math.hypot||(Math.hypot=function(){for(var u=0,o=arguments.length;o--;)u+=arguments[o]*arguments[o];return Math.sqrt(u)});var op,Fw=p0;function cm(u,o,c){var p=o[0],m=o[1],v=o[2],w=o[3];return u[0]=c[0]*p+c[4]*m+c[8]*v+c[12]*w,u[1]=c[1]*p+c[5]*m+c[9]*v+c[13]*w,u[2]=c[2]*p+c[6]*m+c[10]*v+c[14]*w,u[3]=c[3]*p+c[7]*m+c[11]*v+c[15]*w,u}op=new gh(4),gh!=Float32Array&&(op[0]=0,op[1]=0,op[2]=0,op[3]=0);class Bw extends us{constructor(o){super(o,zw)}createBucket(o){return new e_(o)}queryRadius(o){const c=o;return rp("circle-radius",this,c)+rp("circle-stroke-width",this,c)+lm(this.paint.get("circle-translate"))}queryIntersectsFeature(o,c,p,m,v,w,E,T){const k=um(o,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),w.angle,E),D=this.paint.get("circle-radius").evaluate(c,p)+this.paint.get("circle-stroke-width").evaluate(c,p),F=this.paint.get("circle-pitch-alignment")==="map",j=F?k:function(H,tt){return H.map(lt=>d0(lt,tt))}(k,T),X=F?D*E:D;for(const H of m)for(const tt of H){const lt=F?tt:d0(tt,T);let ht=X;const At=cm([],[tt.x,tt.y,0,1],T);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?ht*=At[3]/w.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(ht*=w.cameraToCenterDistance/At[3]),Nw(j,lt,ht))return!0}return!1}}function d0(u,o){const c=cm([],[u.x,u.y,0,1],o);return new A(c[0]/c[3],c[1]/c[3])}class m0 extends e_{}let g0;xe("HeatmapBucket",m0,{omit:["layers"]});var Vw={get paint(){return g0=g0||new Xi({"heatmap-radius":new Ue($t.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Ue($t.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Re($t.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Yf($t.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Re($t.paint_heatmap["heatmap-opacity"])})}};function o_(u,{width:o,height:c},p,m){if(m){if(m instanceof Uint8ClampedArray)m=new Uint8Array(m.buffer);else if(m.length!==o*c*p)throw new RangeError(`mismatched image size. expected: ${m.length} but got: ${o*c*p}`)}else m=new Uint8Array(o*c*p);return u.width=o,u.height=c,u.data=m,u}function _0(u,{width:o,height:c},p){if(o===u.width&&c===u.height)return;const m=o_({},{width:o,height:c},p);s_(u,m,{x:0,y:0},{x:0,y:0},{width:Math.min(u.width,o),height:Math.min(u.height,c)},p),u.width=o,u.height=c,u.data=m.data}function s_(u,o,c,p,m,v){if(m.width===0||m.height===0)return o;if(m.width>u.width||m.height>u.height||c.x>u.width-m.width||c.y>u.height-m.height)throw new RangeError("out of range source coordinates for image copy");if(m.width>o.width||m.height>o.height||p.x>o.width-m.width||p.y>o.height-m.height)throw new RangeError("out of range destination coordinates for image copy");const w=u.data,E=o.data;if(w===E)throw new Error("srcData equals dstData, so image is already copied");for(let T=0;T<m.height;T++){const k=((c.y+T)*u.width+c.x)*v,D=((p.y+T)*o.width+p.x)*v;for(let F=0;F<m.width*v;F++)E[D+F]=w[k+F]}return o}class sp{constructor(o,c){o_(this,o,1,c)}resize(o){_0(this,o,1)}clone(){return new sp({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(o,c,p,m,v){s_(o,c,p,m,v,1)}}class Es{constructor(o,c){o_(this,o,4,c)}resize(o){_0(this,o,4)}replace(o,c){c?this.data.set(o):this.data=o instanceof Uint8ClampedArray?new Uint8Array(o.buffer):o}clone(){return new Es({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(o,c,p,m,v){s_(o,c,p,m,v,4)}}function y0(u){const o={},c=u.resolution||256,p=u.clips?u.clips.length:1,m=u.image||new Es({width:c,height:p});if(Math.log(c)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${c}`);const v=(w,E,T)=>{o[u.evaluationKey]=T;const k=u.expression.evaluate(o);m.data[w+E+0]=Math.floor(255*k.r/k.a),m.data[w+E+1]=Math.floor(255*k.g/k.a),m.data[w+E+2]=Math.floor(255*k.b/k.a),m.data[w+E+3]=Math.floor(255*k.a)};if(u.clips)for(let w=0,E=0;w<p;++w,E+=4*c)for(let T=0,k=0;T<c;T++,k+=4){const D=T/(c-1),{start:F,end:j}=u.clips[w];v(E,k,F*(1-D)+j*D)}else for(let w=0,E=0;w<c;w++,E+=4)v(0,E,w/(c-1));return m}xe("AlphaImage",sp),xe("RGBAImage",Es);class Uw extends us{createBucket(o){return new m0(o)}constructor(o){super(o,Vw),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(o){o==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=y0({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let v0;var Gw={get paint(){return v0=v0||new Xi({"hillshade-illumination-direction":new Re($t.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Re($t.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Re($t.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Re($t.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Re($t.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Re($t.paint_hillshade["hillshade-accent-color"])})}};class jw extends us{constructor(o){super(o,Gw)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const qw=Ti([{name:"a_pos",components:2,type:"Int16"}],4),{members:Zw}=qw;var a_={exports:{}};function hm(u,o,c){c=c||2;var p,m,v,w,E,T,k,D=o&&o.length,F=D?o[0]*c:u.length,j=b0(u,0,F,c,!0),X=[];if(!j||j.next===j.prev)return X;if(D&&(j=function(tt,lt,ht,At){var Et,Nt,Ft,Jt=[];for(Et=0,Nt=lt.length;Et<Nt;Et++)(Ft=b0(tt,lt[Et]*At,Et<Nt-1?lt[Et+1]*At:tt.length,At,!1))===Ft.next&&(Ft.steiner=!0),Jt.push(Qw(Ft));for(Jt.sort(Yw),Et=0;Et<Jt.length;Et++)ht=Kw(Jt[Et],ht);return ht}(u,o,j,c)),u.length>80*c){p=v=u[0],m=w=u[1];for(var H=c;H<F;H+=c)(E=u[H])<p&&(p=E),(T=u[H+1])<m&&(m=T),E>v&&(v=E),T>w&&(w=T);k=(k=Math.max(v-p,w-m))!==0?32767/k:0}return ap(j,X,c,p,m,k,0),X}function b0(u,o,c,p,m){var v,w;if(m===c_(u,o,c,p)>0)for(v=o;v<c;v+=p)w=S0(v,u[v],u[v+1],w);else for(v=c-p;v>=o;v-=p)w=S0(v,u[v],u[v+1],w);return w&&fm(w,w.next)&&(up(w),w=w.next),w}function fc(u,o){if(!u)return u;o||(o=u);var c,p=u;do if(c=!1,p.steiner||!fm(p,p.next)&&Yi(p.prev,p,p.next)!==0)p=p.next;else{if(up(p),(p=o=p.prev)===p.next)break;c=!0}while(c||p!==o);return o}function ap(u,o,c,p,m,v,w){if(u){!w&&v&&function(D,F,j,X){var H=D;do H.z===0&&(H.z=l_(H.x,H.y,F,j,X)),H.prevZ=H.prev,H.nextZ=H.next,H=H.next;while(H!==D);H.prevZ.nextZ=null,H.prevZ=null,function(tt){var lt,ht,At,Et,Nt,Ft,Jt,ve,Me=1;do{for(ht=tt,tt=null,Nt=null,Ft=0;ht;){for(Ft++,At=ht,Jt=0,lt=0;lt<Me&&(Jt++,At=At.nextZ);lt++);for(ve=Me;Jt>0||ve>0&&At;)Jt!==0&&(ve===0||!At||ht.z<=At.z)?(Et=ht,ht=ht.nextZ,Jt--):(Et=At,At=At.nextZ,ve--),Nt?Nt.nextZ=Et:tt=Et,Et.prevZ=Nt,Nt=Et;ht=At}Nt.nextZ=null,Me*=2}while(Ft>1)}(H)}(u,p,m,v);for(var E,T,k=u;u.prev!==u.next;)if(E=u.prev,T=u.next,v?Ww(u,p,m,v):$w(u))o.push(E.i/c|0),o.push(u.i/c|0),o.push(T.i/c|0),up(u),u=T.next,k=T.next;else if((u=T)===k){w?w===1?ap(u=Xw(fc(u),o,c),o,c,p,m,v,2):w===2&&Hw(u,o,c,p,m,v):ap(fc(u),o,c,p,m,v,1);break}}}function $w(u){var o=u.prev,c=u,p=u.next;if(Yi(o,c,p)>=0)return!1;for(var m=o.x,v=c.x,w=p.x,E=o.y,T=c.y,k=p.y,D=m<v?m<w?m:w:v<w?v:w,F=E<T?E<k?E:k:T<k?T:k,j=m>v?m>w?m:w:v>w?v:w,X=E>T?E>k?E:k:T>k?T:k,H=p.next;H!==o;){if(H.x>=D&&H.x<=j&&H.y>=F&&H.y<=X&&_h(m,E,v,T,w,k,H.x,H.y)&&Yi(H.prev,H,H.next)>=0)return!1;H=H.next}return!0}function Ww(u,o,c,p){var m=u.prev,v=u,w=u.next;if(Yi(m,v,w)>=0)return!1;for(var E=m.x,T=v.x,k=w.x,D=m.y,F=v.y,j=w.y,X=E<T?E<k?E:k:T<k?T:k,H=D<F?D<j?D:j:F<j?F:j,tt=E>T?E>k?E:k:T>k?T:k,lt=D>F?D>j?D:j:F>j?F:j,ht=l_(X,H,o,c,p),At=l_(tt,lt,o,c,p),Et=u.prevZ,Nt=u.nextZ;Et&&Et.z>=ht&&Nt&&Nt.z<=At;){if(Et.x>=X&&Et.x<=tt&&Et.y>=H&&Et.y<=lt&&Et!==m&&Et!==w&&_h(E,D,T,F,k,j,Et.x,Et.y)&&Yi(Et.prev,Et,Et.next)>=0||(Et=Et.prevZ,Nt.x>=X&&Nt.x<=tt&&Nt.y>=H&&Nt.y<=lt&&Nt!==m&&Nt!==w&&_h(E,D,T,F,k,j,Nt.x,Nt.y)&&Yi(Nt.prev,Nt,Nt.next)>=0))return!1;Nt=Nt.nextZ}for(;Et&&Et.z>=ht;){if(Et.x>=X&&Et.x<=tt&&Et.y>=H&&Et.y<=lt&&Et!==m&&Et!==w&&_h(E,D,T,F,k,j,Et.x,Et.y)&&Yi(Et.prev,Et,Et.next)>=0)return!1;Et=Et.prevZ}for(;Nt&&Nt.z<=At;){if(Nt.x>=X&&Nt.x<=tt&&Nt.y>=H&&Nt.y<=lt&&Nt!==m&&Nt!==w&&_h(E,D,T,F,k,j,Nt.x,Nt.y)&&Yi(Nt.prev,Nt,Nt.next)>=0)return!1;Nt=Nt.nextZ}return!0}function Xw(u,o,c){var p=u;do{var m=p.prev,v=p.next.next;!fm(m,v)&&x0(m,p,p.next,v)&&lp(m,v)&&lp(v,m)&&(o.push(m.i/c|0),o.push(p.i/c|0),o.push(v.i/c|0),up(p),up(p.next),p=u=v),p=p.next}while(p!==u);return fc(p)}function Hw(u,o,c,p,m,v){var w=u;do{for(var E=w.next.next;E!==w.prev;){if(w.i!==E.i&&t2(w,E)){var T=w0(w,E);return w=fc(w,w.next),T=fc(T,T.next),ap(w,o,c,p,m,v,0),void ap(T,o,c,p,m,v,0)}E=E.next}w=w.next}while(w!==u)}function Yw(u,o){return u.x-o.x}function Kw(u,o){var c=function(m,v){var w,E=v,T=m.x,k=m.y,D=-1/0;do{if(k<=E.y&&k>=E.next.y&&E.next.y!==E.y){var F=E.x+(k-E.y)*(E.next.x-E.x)/(E.next.y-E.y);if(F<=T&&F>D&&(D=F,w=E.x<E.next.x?E:E.next,F===T))return w}E=E.next}while(E!==v);if(!w)return null;var j,X=w,H=w.x,tt=w.y,lt=1/0;E=w;do T>=E.x&&E.x>=H&&T!==E.x&&_h(k<tt?T:D,k,H,tt,k<tt?D:T,k,E.x,E.y)&&(j=Math.abs(k-E.y)/(T-E.x),lp(E,m)&&(j<lt||j===lt&&(E.x>w.x||E.x===w.x&&Jw(w,E)))&&(w=E,lt=j)),E=E.next;while(E!==X);return w}(u,o);if(!c)return o;var p=w0(c,u);return fc(p,p.next),fc(c,c.next)}function Jw(u,o){return Yi(u.prev,u,o.prev)<0&&Yi(o.next,u,u.next)<0}function l_(u,o,c,p,m){return(u=1431655765&((u=858993459&((u=252645135&((u=16711935&((u=(u-c)*m|0)|u<<8))|u<<4))|u<<2))|u<<1))|(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=(o-p)*m|0)|o<<8))|o<<4))|o<<2))|o<<1))<<1}function Qw(u){var o=u,c=u;do(o.x<c.x||o.x===c.x&&o.y<c.y)&&(c=o),o=o.next;while(o!==u);return c}function _h(u,o,c,p,m,v,w,E){return(m-w)*(o-E)>=(u-w)*(v-E)&&(u-w)*(p-E)>=(c-w)*(o-E)&&(c-w)*(v-E)>=(m-w)*(p-E)}function t2(u,o){return u.next.i!==o.i&&u.prev.i!==o.i&&!function(c,p){var m=c;do{if(m.i!==c.i&&m.next.i!==c.i&&m.i!==p.i&&m.next.i!==p.i&&x0(m,m.next,c,p))return!0;m=m.next}while(m!==c);return!1}(u,o)&&(lp(u,o)&&lp(o,u)&&function(c,p){var m=c,v=!1,w=(c.x+p.x)/2,E=(c.y+p.y)/2;do m.y>E!=m.next.y>E&&m.next.y!==m.y&&w<(m.next.x-m.x)*(E-m.y)/(m.next.y-m.y)+m.x&&(v=!v),m=m.next;while(m!==c);return v}(u,o)&&(Yi(u.prev,u,o.prev)||Yi(u,o.prev,o))||fm(u,o)&&Yi(u.prev,u,u.next)>0&&Yi(o.prev,o,o.next)>0)}function Yi(u,o,c){return(o.y-u.y)*(c.x-o.x)-(o.x-u.x)*(c.y-o.y)}function fm(u,o){return u.x===o.x&&u.y===o.y}function x0(u,o,c,p){var m=dm(Yi(u,o,c)),v=dm(Yi(u,o,p)),w=dm(Yi(c,p,u)),E=dm(Yi(c,p,o));return m!==v&&w!==E||!(m!==0||!pm(u,c,o))||!(v!==0||!pm(u,p,o))||!(w!==0||!pm(c,u,p))||!(E!==0||!pm(c,o,p))}function pm(u,o,c){return o.x<=Math.max(u.x,c.x)&&o.x>=Math.min(u.x,c.x)&&o.y<=Math.max(u.y,c.y)&&o.y>=Math.min(u.y,c.y)}function dm(u){return u>0?1:u<0?-1:0}function lp(u,o){return Yi(u.prev,u,u.next)<0?Yi(u,o,u.next)>=0&&Yi(u,u.prev,o)>=0:Yi(u,o,u.prev)<0||Yi(u,u.next,o)<0}function w0(u,o){var c=new u_(u.i,u.x,u.y),p=new u_(o.i,o.x,o.y),m=u.next,v=o.prev;return u.next=o,o.prev=u,c.next=m,m.prev=c,p.next=c,c.prev=p,v.next=p,p.prev=v,p}function S0(u,o,c,p){var m=new u_(u,o,c);return p?(m.next=p.next,m.prev=p,p.next.prev=m,p.next=m):(m.prev=m,m.next=m),m}function up(u){u.next.prev=u.prev,u.prev.next=u.next,u.prevZ&&(u.prevZ.nextZ=u.nextZ),u.nextZ&&(u.nextZ.prevZ=u.prevZ)}function u_(u,o,c){this.i=u,this.x=o,this.y=c,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function c_(u,o,c,p){for(var m=0,v=o,w=c-p;v<c;v+=p)m+=(u[w]-u[v])*(u[v+1]+u[w+1]),w=v;return m}a_.exports=hm,a_.exports.default=hm,hm.deviation=function(u,o,c,p){var m=o&&o.length,v=Math.abs(c_(u,0,m?o[0]*c:u.length,c));if(m)for(var w=0,E=o.length;w<E;w++)v-=Math.abs(c_(u,o[w]*c,w<E-1?o[w+1]*c:u.length,c));var T=0;for(w=0;w<p.length;w+=3){var k=p[w]*c,D=p[w+1]*c,F=p[w+2]*c;T+=Math.abs((u[k]-u[F])*(u[D+1]-u[k+1])-(u[k]-u[D])*(u[F+1]-u[k+1]))}return v===0&&T===0?0:Math.abs((T-v)/v)},hm.flatten=function(u){for(var o=u[0][0].length,c={vertices:[],holes:[],dimensions:o},p=0,m=0;m<u.length;m++){for(var v=0;v<u[m].length;v++)for(var w=0;w<o;w++)c.vertices.push(u[m][v][w]);m>0&&c.holes.push(p+=u[m-1].length)}return c};var E0=x(a_.exports);function e2(u,o,c,p,m){I0(u,o,c||0,p||u.length-1,m||n2)}function I0(u,o,c,p,m){for(;p>c;){if(p-c>600){var v=p-c+1,w=o-c+1,E=Math.log(v),T=.5*Math.exp(2*E/3),k=.5*Math.sqrt(E*T*(v-T)/v)*(w-v/2<0?-1:1);I0(u,o,Math.max(c,Math.floor(o-w*T/v+k)),Math.min(p,Math.floor(o+(v-w)*T/v+k)),m)}var D=u[o],F=c,j=p;for(cp(u,c,o),m(u[p],D)>0&&cp(u,c,p);F<j;){for(cp(u,F,j),F++,j--;m(u[F],D)<0;)F++;for(;m(u[j],D)>0;)j--}m(u[c],D)===0?cp(u,c,j):cp(u,++j,p),j<=o&&(c=j+1),o<=j&&(p=j-1)}}function cp(u,o,c){var p=u[o];u[o]=u[c],u[c]=p}function n2(u,o){return u<o?-1:u>o?1:0}function h_(u,o){const c=u.length;if(c<=1)return[u];const p=[];let m,v;for(let w=0;w<c;w++){const E=Qt(u[w]);E!==0&&(u[w].area=Math.abs(E),v===void 0&&(v=E<0),v===E<0?(m&&p.push(m),m=[u[w]]):m.push(u[w]))}if(m&&p.push(m),o>1)for(let w=0;w<p.length;w++)p[w].length<=o||(e2(p[w],o,1,p[w].length-1,i2),p[w]=p[w].slice(0,o));return p}function i2(u,o){return o.area-u.area}function f_(u,o,c){const p=c.patternDependencies;let m=!1;for(const v of o){const w=v.paint.get(`${u}-pattern`);w.isConstant()||(m=!0);const E=w.constantOr(null);E&&(m=!0,p[E.to]=!0,p[E.from]=!0)}return m}function p_(u,o,c,p,m){const v=m.patternDependencies;for(const w of o){const E=w.paint.get(`${u}-pattern`).value;if(E.kind!=="constant"){let T=E.evaluate({zoom:p-1},c,{},m.availableImages),k=E.evaluate({zoom:p},c,{},m.availableImages),D=E.evaluate({zoom:p+1},c,{},m.availableImages);T=T&&T.name?T.name:T,k=k&&k.name?k.name:k,D=D&&D.name?D.name:D,v[T]=!0,v[k]=!0,v[D]=!0,c.patterns[w.id]={min:T,mid:k,max:D}}}return c}class d_{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(c=>c.id),this.index=o.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new vn,this.indexArray=new Rr,this.indexArray2=new pr,this.programConfigurations=new Pa(o.layers,o.zoom),this.segments=new di,this.segments2=new di,this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id)}populate(o,c,p){this.hasPattern=f_("fill",this.layers,c);const m=this.layers[0].layout.get("fill-sort-key"),v=!m.isConstant(),w=[];for(const{feature:E,id:T,index:k,sourceLayerIndex:D}of o){const F=this.layers[0]._featureFilter.needGeometry,j=hc(E,F);if(!this.layers[0]._featureFilter.filter(new pi(this.zoom),j,p))continue;const X=v?m.evaluate(j,{},p,c.availableImages):void 0,H={id:T,properties:E.properties,type:E.type,sourceLayerIndex:D,index:k,geometry:F?j.geometry:cc(E),patterns:{},sortKey:X};w.push(H)}v&&w.sort((E,T)=>E.sortKey-T.sortKey);for(const E of w){const{geometry:T,index:k,sourceLayerIndex:D}=E;if(this.hasPattern){const F=p_("fill",this.layers,E,this.zoom,c);this.patternFeatures.push(F)}else this.addFeature(E,T,k,p,{});c.featureIndex.insert(o[k].feature,T,k,D,this.index)}}update(o,c,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,c,this.stateDependentLayers,p)}addFeatures(o,c,p){for(const m of this.patternFeatures)this.addFeature(m,m.geometry,m.index,c,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,Zw),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.indexBuffer2=o.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(o,c,p,m,v){for(const w of h_(c,500)){let E=0;for(const X of w)E+=X.length;const T=this.segments.prepareSegment(E,this.layoutVertexArray,this.indexArray),k=T.vertexLength,D=[],F=[];for(const X of w){if(X.length===0)continue;X!==w[0]&&F.push(D.length/2);const H=this.segments2.prepareSegment(X.length,this.layoutVertexArray,this.indexArray2),tt=H.vertexLength;this.layoutVertexArray.emplaceBack(X[0].x,X[0].y),this.indexArray2.emplaceBack(tt+X.length-1,tt),D.push(X[0].x),D.push(X[0].y);for(let lt=1;lt<X.length;lt++)this.layoutVertexArray.emplaceBack(X[lt].x,X[lt].y),this.indexArray2.emplaceBack(tt+lt-1,tt+lt),D.push(X[lt].x),D.push(X[lt].y);H.vertexLength+=X.length,H.primitiveLength+=X.length}const j=E0(D,F);for(let X=0;X<j.length;X+=3)this.indexArray.emplaceBack(k+j[X],k+j[X+1],k+j[X+2]);T.vertexLength+=E,T.primitiveLength+=j.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,p,v,m)}}let C0,T0;xe("FillBucket",d_,{omit:["layers","patternFeatures"]});var r2={get paint(){return T0=T0||new Xi({"fill-antialias":new Re($t.paint_fill["fill-antialias"]),"fill-opacity":new Ue($t.paint_fill["fill-opacity"]),"fill-color":new Ue($t.paint_fill["fill-color"]),"fill-outline-color":new Ue($t.paint_fill["fill-outline-color"]),"fill-translate":new Re($t.paint_fill["fill-translate"]),"fill-translate-anchor":new Re($t.paint_fill["fill-translate-anchor"]),"fill-pattern":new ac($t.paint_fill["fill-pattern"])})},get layout(){return C0=C0||new Xi({"fill-sort-key":new Ue($t.layout_fill["fill-sort-key"])})}};class o2 extends us{constructor(o){super(o,r2)}recalculate(o,c){super.recalculate(o,c);const p=this.paint._values["fill-outline-color"];p.value.kind==="constant"&&p.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(o){return new d_(o)}queryRadius(){return lm(this.paint.get("fill-translate"))}queryIntersectsFeature(o,c,p,m,v,w,E){return l0(um(o,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),w.angle,E),m)}isTileClipped(){return!0}}const s2=Ti([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),a2=Ti([{name:"a_centroid",components:2,type:"Int16"}],4),{members:l2}=s2;var vu={},u2=S,L0=yh;function yh(u,o,c,p,m){this.properties={},this.extent=c,this.type=0,this._pbf=u,this._geometry=-1,this._keys=p,this._values=m,u.readFields(c2,this,o)}function c2(u,o,c){u==1?o.id=c.readVarint():u==2?function(p,m){for(var v=p.readVarint()+p.pos;p.pos<v;){var w=m._keys[p.readVarint()],E=m._values[p.readVarint()];m.properties[w]=E}}(c,o):u==3?o.type=c.readVarint():u==4&&(o._geometry=c.pos)}function h2(u){for(var o,c,p=0,m=0,v=u.length,w=v-1;m<v;w=m++)p+=((c=u[w]).x-(o=u[m]).x)*(o.y+c.y);return p}yh.types=["Unknown","Point","LineString","Polygon"],yh.prototype.loadGeometry=function(){var u=this._pbf;u.pos=this._geometry;for(var o,c=u.readVarint()+u.pos,p=1,m=0,v=0,w=0,E=[];u.pos<c;){if(m<=0){var T=u.readVarint();p=7&T,m=T>>3}if(m--,p===1||p===2)v+=u.readSVarint(),w+=u.readSVarint(),p===1&&(o&&E.push(o),o=[]),o.push(new u2(v,w));else{if(p!==7)throw new Error("unknown command "+p);o&&o.push(o[0].clone())}}return o&&E.push(o),E},yh.prototype.bbox=function(){var u=this._pbf;u.pos=this._geometry;for(var o=u.readVarint()+u.pos,c=1,p=0,m=0,v=0,w=1/0,E=-1/0,T=1/0,k=-1/0;u.pos<o;){if(p<=0){var D=u.readVarint();c=7&D,p=D>>3}if(p--,c===1||c===2)(m+=u.readSVarint())<w&&(w=m),m>E&&(E=m),(v+=u.readSVarint())<T&&(T=v),v>k&&(k=v);else if(c!==7)throw new Error("unknown command "+c)}return[w,T,E,k]},yh.prototype.toGeoJSON=function(u,o,c){var p,m,v=this.extent*Math.pow(2,c),w=this.extent*u,E=this.extent*o,T=this.loadGeometry(),k=yh.types[this.type];function D(X){for(var H=0;H<X.length;H++){var tt=X[H];X[H]=[360*(tt.x+w)/v-180,360/Math.PI*Math.atan(Math.exp((180-360*(tt.y+E)/v)*Math.PI/180))-90]}}switch(this.type){case 1:var F=[];for(p=0;p<T.length;p++)F[p]=T[p][0];D(T=F);break;case 2:for(p=0;p<T.length;p++)D(T[p]);break;case 3:for(T=function(X){var H=X.length;if(H<=1)return[X];for(var tt,lt,ht=[],At=0;At<H;At++){var Et=h2(X[At]);Et!==0&&(lt===void 0&&(lt=Et<0),lt===Et<0?(tt&&ht.push(tt),tt=[X[At]]):tt.push(X[At]))}return tt&&ht.push(tt),ht}(T),p=0;p<T.length;p++)for(m=0;m<T[p].length;m++)D(T[p][m])}T.length===1?T=T[0]:k="Multi"+k;var j={type:"Feature",geometry:{type:k,coordinates:T},properties:this.properties};return"id"in this&&(j.id=this.id),j};var f2=L0,M0=P0;function P0(u,o){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=u,this._keys=[],this._values=[],this._features=[],u.readFields(p2,this,o),this.length=this._features.length}function p2(u,o,c){u===15?o.version=c.readVarint():u===1?o.name=c.readString():u===5?o.extent=c.readVarint():u===2?o._features.push(c.pos):u===3?o._keys.push(c.readString()):u===4&&o._values.push(function(p){for(var m=null,v=p.readVarint()+p.pos;p.pos<v;){var w=p.readVarint()>>3;m=w===1?p.readString():w===2?p.readFloat():w===3?p.readDouble():w===4?p.readVarint64():w===5?p.readVarint():w===6?p.readSVarint():w===7?p.readBoolean():null}return m}(c))}P0.prototype.feature=function(u){if(u<0||u>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[u];var o=this._pbf.readVarint()+this._pbf.pos;return new f2(this._pbf,o,this.extent,this._keys,this._values)};var d2=M0;function m2(u,o,c){if(u===3){var p=new d2(c,c.readVarint()+c.pos);p.length&&(o[p.name]=p)}}vu.VectorTile=function(u,o){this.layers=u.readFields(m2,{},o)},vu.VectorTileFeature=L0,vu.VectorTileLayer=M0;const g2=vu.VectorTileFeature.types,m_=Math.pow(2,13);function hp(u,o,c,p,m,v,w,E){u.emplaceBack(o,c,2*Math.floor(p*m_)+w,m*m_*2,v*m_*2,Math.round(E))}class g_{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(c=>c.id),this.index=o.index,this.hasPattern=!1,this.layoutVertexArray=new pe,this.centroidVertexArray=new ae,this.indexArray=new Rr,this.programConfigurations=new Pa(o.layers,o.zoom),this.segments=new di,this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id)}populate(o,c,p){this.features=[],this.hasPattern=f_("fill-extrusion",this.layers,c);for(const{feature:m,id:v,index:w,sourceLayerIndex:E}of o){const T=this.layers[0]._featureFilter.needGeometry,k=hc(m,T);if(!this.layers[0]._featureFilter.filter(new pi(this.zoom),k,p))continue;const D={id:v,sourceLayerIndex:E,index:w,geometry:T?k.geometry:cc(m),properties:m.properties,type:m.type,patterns:{}};this.hasPattern?this.features.push(p_("fill-extrusion",this.layers,D,this.zoom,c)):this.addFeature(D,D.geometry,w,p,{}),c.featureIndex.insert(m,D.geometry,w,E,this.index,!0)}}addFeatures(o,c,p){for(const m of this.features){const{geometry:v}=m;this.addFeature(m,v,m.index,c,p)}}update(o,c,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,c,this.stateDependentLayers,p)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,l2),this.centroidVertexBuffer=o.createVertexBuffer(this.centroidVertexArray,a2.members,!0),this.indexBuffer=o.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(o,c,p,m,v){const w={x:0,y:0,vertexCount:0};for(const E of h_(c,500)){let T=0;for(const H of E)T+=H.length;let k=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const H of E){if(H.length===0||y2(H))continue;let tt=0;for(let lt=0;lt<H.length;lt++){const ht=H[lt];if(lt>=1){const At=H[lt-1];if(!_2(ht,At)){k.vertexLength+4>di.MAX_VERTEX_ARRAY_LENGTH&&(k=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const Et=ht.sub(At)._perp()._unit(),Nt=At.dist(ht);tt+Nt>32768&&(tt=0),hp(this.layoutVertexArray,ht.x,ht.y,Et.x,Et.y,0,0,tt),hp(this.layoutVertexArray,ht.x,ht.y,Et.x,Et.y,0,1,tt),w.x+=2*ht.x,w.y+=2*ht.y,w.vertexCount+=2,tt+=Nt,hp(this.layoutVertexArray,At.x,At.y,Et.x,Et.y,0,0,tt),hp(this.layoutVertexArray,At.x,At.y,Et.x,Et.y,0,1,tt),w.x+=2*At.x,w.y+=2*At.y,w.vertexCount+=2;const Ft=k.vertexLength;this.indexArray.emplaceBack(Ft,Ft+2,Ft+1),this.indexArray.emplaceBack(Ft+1,Ft+2,Ft+3),k.vertexLength+=4,k.primitiveLength+=2}}}}if(k.vertexLength+T>di.MAX_VERTEX_ARRAY_LENGTH&&(k=this.segments.prepareSegment(T,this.layoutVertexArray,this.indexArray)),g2[o.type]!=="Polygon")continue;const D=[],F=[],j=k.vertexLength;for(const H of E)if(H.length!==0){H!==E[0]&&F.push(D.length/2);for(let tt=0;tt<H.length;tt++){const lt=H[tt];hp(this.layoutVertexArray,lt.x,lt.y,0,0,1,1,0),w.x+=lt.x,w.y+=lt.y,w.vertexCount+=1,D.push(lt.x),D.push(lt.y)}}const X=E0(D,F);for(let H=0;H<X.length;H+=3)this.indexArray.emplaceBack(j+X[H],j+X[H+2],j+X[H+1]);k.primitiveLength+=X.length/3,k.vertexLength+=T}for(let E=0;E<w.vertexCount;E++)this.centroidVertexArray.emplaceBack(Math.floor(w.x/w.vertexCount),Math.floor(w.y/w.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,p,v,m)}}function _2(u,o){return u.x===o.x&&(u.x<0||u.x>rr)||u.y===o.y&&(u.y<0||u.y>rr)}function y2(u){return u.every(o=>o.x<0)||u.every(o=>o.x>rr)||u.every(o=>o.y<0)||u.every(o=>o.y>rr)}let k0;xe("FillExtrusionBucket",g_,{omit:["layers","features"]});var v2={get paint(){return k0=k0||new Xi({"fill-extrusion-opacity":new Re($t["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Ue($t["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Re($t["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Re($t["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new ac($t["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Ue($t["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Ue($t["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Re($t["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class b2 extends us{constructor(o){super(o,v2)}createBucket(o){return new g_(o)}queryRadius(){return lm(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(o,c,p,m,v,w,E,T){const k=um(o,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),w.angle,E),D=this.paint.get("fill-extrusion-height").evaluate(c,p),F=this.paint.get("fill-extrusion-base").evaluate(c,p),j=function(H,tt,lt,ht){const At=[];for(const Et of H){const Nt=[Et.x,Et.y,0,1];cm(Nt,Nt,tt),At.push(new A(Nt[0]/Nt[3],Nt[1]/Nt[3]))}return At}(k,T),X=function(H,tt,lt,ht){const At=[],Et=[],Nt=ht[8]*tt,Ft=ht[9]*tt,Jt=ht[10]*tt,ve=ht[11]*tt,Me=ht[8]*lt,_e=ht[9]*lt,de=ht[10]*lt,ue=ht[11]*lt;for(const we of H){const he=[],ie=[];for(const Be of we){const Ae=Be.x,dn=Be.y,mi=ht[0]*Ae+ht[4]*dn+ht[12],bi=ht[1]*Ae+ht[5]*dn+ht[13],gr=ht[2]*Ae+ht[6]*dn+ht[14],hs=ht[3]*Ae+ht[7]*dn+ht[15],So=gr+Jt,or=hs+ve,zr=mi+Me,Xr=bi+_e,Eo=gr+de,Io=hs+ue,_r=new A((mi+Nt)/or,(bi+Ft)/or);_r.z=So/or,he.push(_r);const yr=new A(zr/Io,Xr/Io);yr.z=Eo/Io,ie.push(yr)}At.push(he),Et.push(ie)}return[At,Et]}(m,F,D,T);return function(H,tt,lt){let ht=1/0;l0(lt,tt)&&(ht=A0(lt,tt[0]));for(let At=0;At<tt.length;At++){const Et=tt[At],Nt=H[At];for(let Ft=0;Ft<Et.length-1;Ft++){const Jt=Et[Ft],ve=[Jt,Et[Ft+1],Nt[Ft+1],Nt[Ft],Jt];a0(lt,ve)&&(ht=Math.min(ht,A0(lt,ve)))}}return ht!==1/0&&ht}(X[0],X[1],j)}}function fp(u,o){return u.x*o.x+u.y*o.y}function A0(u,o){if(u.length===1){let c=0;const p=o[c++];let m;for(;!m||p.equals(m);)if(m=o[c++],!m)return 1/0;for(;c<o.length;c++){const v=o[c],w=u[0],E=m.sub(p),T=v.sub(p),k=w.sub(p),D=fp(E,E),F=fp(E,T),j=fp(T,T),X=fp(k,E),H=fp(k,T),tt=D*j-F*F,lt=(j*X-F*H)/tt,ht=(D*H-F*X)/tt,At=p.z*(1-lt-ht)+m.z*lt+v.z*ht;if(isFinite(At))return At}return 1/0}{let c=1/0;for(const p of o)c=Math.min(c,p.z);return c}}const x2=Ti([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:w2}=x2,S2=Ti([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:E2}=S2,I2=vu.VectorTileFeature.types,C2=Math.cos(Math.PI/180*37.5),N0=Math.pow(2,14)/.5;class __{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(c=>c.id),this.index=o.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(c=>{this.gradients[c.id]={}}),this.layoutVertexArray=new Ge,this.layoutVertexArray2=new Pe,this.indexArray=new Rr,this.programConfigurations=new Pa(o.layers,o.zoom),this.segments=new di,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id)}populate(o,c,p){this.hasPattern=f_("line",this.layers,c);const m=this.layers[0].layout.get("line-sort-key"),v=!m.isConstant(),w=[];for(const{feature:E,id:T,index:k,sourceLayerIndex:D}of o){const F=this.layers[0]._featureFilter.needGeometry,j=hc(E,F);if(!this.layers[0]._featureFilter.filter(new pi(this.zoom),j,p))continue;const X=v?m.evaluate(j,{},p):void 0,H={id:T,properties:E.properties,type:E.type,sourceLayerIndex:D,index:k,geometry:F?j.geometry:cc(E),patterns:{},sortKey:X};w.push(H)}v&&w.sort((E,T)=>E.sortKey-T.sortKey);for(const E of w){const{geometry:T,index:k,sourceLayerIndex:D}=E;if(this.hasPattern){const F=p_("line",this.layers,E,this.zoom,c);this.patternFeatures.push(F)}else this.addFeature(E,T,k,p,{});c.featureIndex.insert(o[k].feature,T,k,D,this.index)}}update(o,c,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,c,this.stateDependentLayers,p)}addFeatures(o,c,p){for(const m of this.patternFeatures)this.addFeature(m,m.geometry,m.index,c,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=o.createVertexBuffer(this.layoutVertexArray2,E2)),this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,w2),this.indexBuffer=o.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(o){if(o.properties&&Object.prototype.hasOwnProperty.call(o.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(o.properties,"mapbox_clip_end"))return{start:+o.properties.mapbox_clip_start,end:+o.properties.mapbox_clip_end}}addFeature(o,c,p,m,v){const w=this.layers[0].layout,E=w.get("line-join").evaluate(o,{}),T=w.get("line-cap"),k=w.get("line-miter-limit"),D=w.get("line-round-limit");this.lineClips=this.lineFeatureClips(o);for(const F of c)this.addLine(F,o,E,T,k,D);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,p,v,m)}addLine(o,c,p,m,v,w){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ht=0;ht<o.length-1;ht++)this.totalDistance+=o[ht].dist(o[ht+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const E=I2[c.type]==="Polygon";let T=o.length;for(;T>=2&&o[T-1].equals(o[T-2]);)T--;let k=0;for(;k<T-1&&o[k].equals(o[k+1]);)k++;if(T<(E?3:2))return;p==="bevel"&&(v=1.05);const D=this.overscaling<=16?15*rr/(512*this.overscaling):0,F=this.segments.prepareSegment(10*T,this.layoutVertexArray,this.indexArray);let j,X,H,tt,lt;this.e1=this.e2=-1,E&&(j=o[T-2],lt=o[k].sub(j)._unit()._perp());for(let ht=k;ht<T;ht++){if(H=ht===T-1?E?o[k+1]:void 0:o[ht+1],H&&o[ht].equals(H))continue;lt&&(tt=lt),j&&(X=j),j=o[ht],lt=H?H.sub(j)._unit()._perp():tt,tt=tt||lt;let At=tt.add(lt);At.x===0&&At.y===0||At._unit();const Et=tt.x*lt.x+tt.y*lt.y,Nt=At.x*lt.x+At.y*lt.y,Ft=Nt!==0?1/Nt:1/0,Jt=2*Math.sqrt(2-2*Nt),ve=Nt<C2&&X&&H,Me=tt.x*lt.y-tt.y*lt.x>0;if(ve&&ht>k){const ue=j.dist(X);if(ue>2*D){const we=j.sub(j.sub(X)._mult(D/ue)._round());this.updateDistance(X,we),this.addCurrentVertex(we,tt,0,0,F),X=we}}const _e=X&&H;let de=_e?p:E?"butt":m;if(_e&&de==="round"&&(Ft<w?de="miter":Ft<=2&&(de="fakeround")),de==="miter"&&Ft>v&&(de="bevel"),de==="bevel"&&(Ft>2&&(de="flipbevel"),Ft<v&&(de="miter")),X&&this.updateDistance(X,j),de==="miter")At._mult(Ft),this.addCurrentVertex(j,At,0,0,F);else if(de==="flipbevel"){if(Ft>100)At=lt.mult(-1);else{const ue=Ft*tt.add(lt).mag()/tt.sub(lt).mag();At._perp()._mult(ue*(Me?-1:1))}this.addCurrentVertex(j,At,0,0,F),this.addCurrentVertex(j,At.mult(-1),0,0,F)}else if(de==="bevel"||de==="fakeround"){const ue=-Math.sqrt(Ft*Ft-1),we=Me?ue:0,he=Me?0:ue;if(X&&this.addCurrentVertex(j,tt,we,he,F),de==="fakeround"){const ie=Math.round(180*Jt/Math.PI/20);for(let Be=1;Be<ie;Be++){let Ae=Be/ie;if(Ae!==.5){const mi=Ae-.5;Ae+=Ae*mi*(Ae-1)*((1.0904+Et*(Et*(3.55645-1.43519*Et)-3.2452))*mi*mi+(.848013+Et*(.215638*Et-1.06021)))}const dn=lt.sub(tt)._mult(Ae)._add(tt)._unit()._mult(Me?-1:1);this.addHalfVertex(j,dn.x,dn.y,!1,Me,0,F)}}H&&this.addCurrentVertex(j,lt,-we,-he,F)}else if(de==="butt")this.addCurrentVertex(j,At,0,0,F);else if(de==="square"){const ue=X?1:-1;this.addCurrentVertex(j,At,ue,ue,F)}else de==="round"&&(X&&(this.addCurrentVertex(j,tt,0,0,F),this.addCurrentVertex(j,tt,1,1,F,!0)),H&&(this.addCurrentVertex(j,lt,-1,-1,F,!0),this.addCurrentVertex(j,lt,0,0,F)));if(ve&&ht<T-1){const ue=j.dist(H);if(ue>2*D){const we=j.add(H.sub(j)._mult(D/ue)._round());this.updateDistance(j,we),this.addCurrentVertex(we,lt,0,0,F),j=we}}}}addCurrentVertex(o,c,p,m,v,w=!1){const E=c.y*m-c.x,T=-c.y-c.x*m;this.addHalfVertex(o,c.x+c.y*p,c.y-c.x*p,w,!1,p,v),this.addHalfVertex(o,E,T,w,!0,-m,v),this.distance>N0/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(o,c,p,m,v,w))}addHalfVertex({x:o,y:c},p,m,v,w,E,T){const k=.5*(this.lineClips?this.scaledDistance*(N0-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((o<<1)+(v?1:0),(c<<1)+(w?1:0),Math.round(63*p)+128,Math.round(63*m)+128,1+(E===0?0:E<0?-1:1)|(63&k)<<2,k>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const D=T.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,D),T.primitiveLength++),w?this.e2=D:this.e1=D}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(o,c){this.distance+=o.dist(c),this.updateScaledDistance()}}let D0,R0;xe("LineBucket",__,{omit:["layers","patternFeatures"]});var O0={get paint(){return R0=R0||new Xi({"line-opacity":new Ue($t.paint_line["line-opacity"]),"line-color":new Ue($t.paint_line["line-color"]),"line-translate":new Re($t.paint_line["line-translate"]),"line-translate-anchor":new Re($t.paint_line["line-translate-anchor"]),"line-width":new Ue($t.paint_line["line-width"]),"line-gap-width":new Ue($t.paint_line["line-gap-width"]),"line-offset":new Ue($t.paint_line["line-offset"]),"line-blur":new Ue($t.paint_line["line-blur"]),"line-dasharray":new Hf($t.paint_line["line-dasharray"]),"line-pattern":new ac($t.paint_line["line-pattern"]),"line-gradient":new Yf($t.paint_line["line-gradient"])})},get layout(){return D0=D0||new Xi({"line-cap":new Re($t.layout_line["line-cap"]),"line-join":new Ue($t.layout_line["line-join"]),"line-miter-limit":new Re($t.layout_line["line-miter-limit"]),"line-round-limit":new Re($t.layout_line["line-round-limit"]),"line-sort-key":new Ue($t.layout_line["line-sort-key"])})}};class T2 extends Ue{possiblyEvaluate(o,c){return c=new pi(Math.floor(c.zoom),{now:c.now,fadeDuration:c.fadeDuration,zoomHistory:c.zoomHistory,transition:c.transition}),super.possiblyEvaluate(o,c)}evaluate(o,c,p,m){return c=gt({},c,{zoom:Math.floor(c.zoom)}),super.evaluate(o,c,p,m)}}let mm;class L2 extends us{constructor(o){super(o,O0),this.gradientVersion=0,mm||(mm=new T2(O0.paint.properties["line-width"].specification),mm.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(o){if(o==="line-gradient"){const c=this.gradientExpression();this.stepInterpolant=!!function(p){return p._styleExpression!==void 0}(c)&&c._styleExpression.expression instanceof Ja,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(o,c){super.recalculate(o,c),this.paint._values["line-floorwidth"]=mm.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,o)}createBucket(o){return new __(o)}queryRadius(o){const c=o,p=z0(rp("line-width",this,c),rp("line-gap-width",this,c)),m=rp("line-offset",this,c);return p/2+Math.abs(m)+lm(this.paint.get("line-translate"))}queryIntersectsFeature(o,c,p,m,v,w,E){const T=um(o,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),w.angle,E),k=E/2*z0(this.paint.get("line-width").evaluate(c,p),this.paint.get("line-gap-width").evaluate(c,p)),D=this.paint.get("line-offset").evaluate(c,p);return D&&(m=function(F,j){const X=[];for(let H=0;H<F.length;H++){const tt=F[H],lt=[];for(let ht=0;ht<tt.length;ht++){const At=tt[ht-1],Et=tt[ht],Nt=tt[ht+1],Ft=ht===0?new A(0,0):Et.sub(At)._unit()._perp(),Jt=ht===tt.length-1?new A(0,0):Nt.sub(Et)._unit()._perp(),ve=Ft._add(Jt)._unit(),Me=ve.x*Jt.x+ve.y*Jt.y;Me!==0&&ve._mult(1/Me),lt.push(ve._mult(j)._add(Et))}X.push(lt)}return X}(m,D*E)),function(F,j,X){for(let H=0;H<j.length;H++){const tt=j[H];if(F.length>=3){for(let lt=0;lt<tt.length;lt++)if(mh(F,tt[lt]))return!0}if(Dw(F,tt,X))return!0}return!1}(T,m,k)}isTileClipped(){return!0}}function z0(u,o){return o>0?o+2*u:u}const M2=Ti([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),P2=Ti([{name:"a_projected_pos",components:3,type:"Float32"}],4);Ti([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const k2=Ti([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);Ti([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const F0=Ti([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),A2=Ti([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function N2(u,o,c){return u.sections.forEach(p=>{p.text=function(m,v,w){const E=v.layout.get("text-transform").evaluate(w,{});return E==="uppercase"?m=m.toLocaleUpperCase():E==="lowercase"&&(m=m.toLocaleLowerCase()),Fo.applyArabicShaping&&(m=Fo.applyArabicShaping(m)),m}(p.text,o,c)}),u}Ti([{name:"triangle",components:3,type:"Uint16"}]),Ti([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Ti([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Ti([{type:"Float32",name:"offsetX"}]),Ti([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Ti([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const pp={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var mr=24,B0=Qn,V0=function(u,o,c,p,m){var v,w,E=8*m-p-1,T=(1<<E)-1,k=T>>1,D=-7,F=c?m-1:0,j=c?-1:1,X=u[o+F];for(F+=j,v=X&(1<<-D)-1,X>>=-D,D+=E;D>0;v=256*v+u[o+F],F+=j,D-=8);for(w=v&(1<<-D)-1,v>>=-D,D+=p;D>0;w=256*w+u[o+F],F+=j,D-=8);if(v===0)v=1-k;else{if(v===T)return w?NaN:1/0*(X?-1:1);w+=Math.pow(2,p),v-=k}return(X?-1:1)*w*Math.pow(2,v-p)},U0=function(u,o,c,p,m,v){var w,E,T,k=8*v-m-1,D=(1<<k)-1,F=D>>1,j=m===23?Math.pow(2,-24)-Math.pow(2,-77):0,X=p?0:v-1,H=p?1:-1,tt=o<0||o===0&&1/o<0?1:0;for(o=Math.abs(o),isNaN(o)||o===1/0?(E=isNaN(o)?1:0,w=D):(w=Math.floor(Math.log(o)/Math.LN2),o*(T=Math.pow(2,-w))<1&&(w--,T*=2),(o+=w+F>=1?j/T:j*Math.pow(2,1-F))*T>=2&&(w++,T/=2),w+F>=D?(E=0,w=D):w+F>=1?(E=(o*T-1)*Math.pow(2,m),w+=F):(E=o*Math.pow(2,F-1)*Math.pow(2,m),w=0));m>=8;u[c+X]=255&E,X+=H,E/=256,m-=8);for(w=w<<m|E,k+=m;k>0;u[c+X]=255&w,X+=H,w/=256,k-=8);u[c+X-H]|=128*tt};function Qn(u){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(u)?u:new Uint8Array(u||0),this.pos=0,this.type=0,this.length=this.buf.length}Qn.Varint=0,Qn.Fixed64=1,Qn.Bytes=2,Qn.Fixed32=5;var y_=4294967296,G0=1/y_,j0=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Rl(u){return u.type===Qn.Bytes?u.readVarint()+u.pos:u.pos+1}function vh(u,o,c){return c?4294967296*o+(u>>>0):4294967296*(o>>>0)+(u>>>0)}function q0(u,o,c){var p=o<=16383?1:o<=2097151?2:o<=268435455?3:Math.floor(Math.log(o)/(7*Math.LN2));c.realloc(p);for(var m=c.pos-1;m>=u;m--)c.buf[m+p]=c.buf[m]}function D2(u,o){for(var c=0;c<u.length;c++)o.writeVarint(u[c])}function R2(u,o){for(var c=0;c<u.length;c++)o.writeSVarint(u[c])}function O2(u,o){for(var c=0;c<u.length;c++)o.writeFloat(u[c])}function z2(u,o){for(var c=0;c<u.length;c++)o.writeDouble(u[c])}function F2(u,o){for(var c=0;c<u.length;c++)o.writeBoolean(u[c])}function B2(u,o){for(var c=0;c<u.length;c++)o.writeFixed32(u[c])}function V2(u,o){for(var c=0;c<u.length;c++)o.writeSFixed32(u[c])}function U2(u,o){for(var c=0;c<u.length;c++)o.writeFixed64(u[c])}function G2(u,o){for(var c=0;c<u.length;c++)o.writeSFixed64(u[c])}function gm(u,o){return(u[o]|u[o+1]<<8|u[o+2]<<16)+16777216*u[o+3]}function bh(u,o,c){u[c]=o,u[c+1]=o>>>8,u[c+2]=o>>>16,u[c+3]=o>>>24}function Z0(u,o){return(u[o]|u[o+1]<<8|u[o+2]<<16)+(u[o+3]<<24)}Qn.prototype={destroy:function(){this.buf=null},readFields:function(u,o,c){for(c=c||this.length;this.pos<c;){var p=this.readVarint(),m=p>>3,v=this.pos;this.type=7&p,u(m,o,this),this.pos===v&&this.skip(p)}return o},readMessage:function(u,o){return this.readFields(u,o,this.readVarint()+this.pos)},readFixed32:function(){var u=gm(this.buf,this.pos);return this.pos+=4,u},readSFixed32:function(){var u=Z0(this.buf,this.pos);return this.pos+=4,u},readFixed64:function(){var u=gm(this.buf,this.pos)+gm(this.buf,this.pos+4)*y_;return this.pos+=8,u},readSFixed64:function(){var u=gm(this.buf,this.pos)+Z0(this.buf,this.pos+4)*y_;return this.pos+=8,u},readFloat:function(){var u=V0(this.buf,this.pos,!0,23,4);return this.pos+=4,u},readDouble:function(){var u=V0(this.buf,this.pos,!0,52,8);return this.pos+=8,u},readVarint:function(u){var o,c,p=this.buf;return o=127&(c=p[this.pos++]),c<128?o:(o|=(127&(c=p[this.pos++]))<<7,c<128?o:(o|=(127&(c=p[this.pos++]))<<14,c<128?o:(o|=(127&(c=p[this.pos++]))<<21,c<128?o:function(m,v,w){var E,T,k=w.buf;if(E=(112&(T=k[w.pos++]))>>4,T<128||(E|=(127&(T=k[w.pos++]))<<3,T<128)||(E|=(127&(T=k[w.pos++]))<<10,T<128)||(E|=(127&(T=k[w.pos++]))<<17,T<128)||(E|=(127&(T=k[w.pos++]))<<24,T<128)||(E|=(1&(T=k[w.pos++]))<<31,T<128))return vh(m,E,v);throw new Error("Expected varint not more than 10 bytes")}(o|=(15&(c=p[this.pos]))<<28,u,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var u=this.readVarint();return u%2==1?(u+1)/-2:u/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var u=this.readVarint()+this.pos,o=this.pos;return this.pos=u,u-o>=12&&j0?function(c,p,m){return j0.decode(c.subarray(p,m))}(this.buf,o,u):function(c,p,m){for(var v="",w=p;w<m;){var E,T,k,D=c[w],F=null,j=D>239?4:D>223?3:D>191?2:1;if(w+j>m)break;j===1?D<128&&(F=D):j===2?(192&(E=c[w+1]))==128&&(F=(31&D)<<6|63&E)<=127&&(F=null):j===3?(T=c[w+2],(192&(E=c[w+1]))==128&&(192&T)==128&&((F=(15&D)<<12|(63&E)<<6|63&T)<=2047||F>=55296&&F<=57343)&&(F=null)):j===4&&(T=c[w+2],k=c[w+3],(192&(E=c[w+1]))==128&&(192&T)==128&&(192&k)==128&&((F=(15&D)<<18|(63&E)<<12|(63&T)<<6|63&k)<=65535||F>=1114112)&&(F=null)),F===null?(F=65533,j=1):F>65535&&(F-=65536,v+=String.fromCharCode(F>>>10&1023|55296),F=56320|1023&F),v+=String.fromCharCode(F),w+=j}return v}(this.buf,o,u)},readBytes:function(){var u=this.readVarint()+this.pos,o=this.buf.subarray(this.pos,u);return this.pos=u,o},readPackedVarint:function(u,o){if(this.type!==Qn.Bytes)return u.push(this.readVarint(o));var c=Rl(this);for(u=u||[];this.pos<c;)u.push(this.readVarint(o));return u},readPackedSVarint:function(u){if(this.type!==Qn.Bytes)return u.push(this.readSVarint());var o=Rl(this);for(u=u||[];this.pos<o;)u.push(this.readSVarint());return u},readPackedBoolean:function(u){if(this.type!==Qn.Bytes)return u.push(this.readBoolean());var o=Rl(this);for(u=u||[];this.pos<o;)u.push(this.readBoolean());return u},readPackedFloat:function(u){if(this.type!==Qn.Bytes)return u.push(this.readFloat());var o=Rl(this);for(u=u||[];this.pos<o;)u.push(this.readFloat());return u},readPackedDouble:function(u){if(this.type!==Qn.Bytes)return u.push(this.readDouble());var o=Rl(this);for(u=u||[];this.pos<o;)u.push(this.readDouble());return u},readPackedFixed32:function(u){if(this.type!==Qn.Bytes)return u.push(this.readFixed32());var o=Rl(this);for(u=u||[];this.pos<o;)u.push(this.readFixed32());return u},readPackedSFixed32:function(u){if(this.type!==Qn.Bytes)return u.push(this.readSFixed32());var o=Rl(this);for(u=u||[];this.pos<o;)u.push(this.readSFixed32());return u},readPackedFixed64:function(u){if(this.type!==Qn.Bytes)return u.push(this.readFixed64());var o=Rl(this);for(u=u||[];this.pos<o;)u.push(this.readFixed64());return u},readPackedSFixed64:function(u){if(this.type!==Qn.Bytes)return u.push(this.readSFixed64());var o=Rl(this);for(u=u||[];this.pos<o;)u.push(this.readSFixed64());return u},skip:function(u){var o=7&u;if(o===Qn.Varint)for(;this.buf[this.pos++]>127;);else if(o===Qn.Bytes)this.pos=this.readVarint()+this.pos;else if(o===Qn.Fixed32)this.pos+=4;else{if(o!==Qn.Fixed64)throw new Error("Unimplemented type: "+o);this.pos+=8}},writeTag:function(u,o){this.writeVarint(u<<3|o)},realloc:function(u){for(var o=this.length||16;o<this.pos+u;)o*=2;if(o!==this.length){var c=new Uint8Array(o);c.set(this.buf),this.buf=c,this.length=o}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(u){this.realloc(4),bh(this.buf,u,this.pos),this.pos+=4},writeSFixed32:function(u){this.realloc(4),bh(this.buf,u,this.pos),this.pos+=4},writeFixed64:function(u){this.realloc(8),bh(this.buf,-1&u,this.pos),bh(this.buf,Math.floor(u*G0),this.pos+4),this.pos+=8},writeSFixed64:function(u){this.realloc(8),bh(this.buf,-1&u,this.pos),bh(this.buf,Math.floor(u*G0),this.pos+4),this.pos+=8},writeVarint:function(u){(u=+u||0)>268435455||u<0?function(o,c){var p,m;if(o>=0?(p=o%4294967296|0,m=o/4294967296|0):(m=~(-o/4294967296),4294967295^(p=~(-o%4294967296))?p=p+1|0:(p=0,m=m+1|0)),o>=18446744073709552e3||o<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");c.realloc(10),function(v,w,E){E.buf[E.pos++]=127&v|128,v>>>=7,E.buf[E.pos++]=127&v|128,v>>>=7,E.buf[E.pos++]=127&v|128,v>>>=7,E.buf[E.pos++]=127&v|128,E.buf[E.pos]=127&(v>>>=7)}(p,0,c),function(v,w){var E=(7&v)<<4;w.buf[w.pos++]|=E|((v>>>=3)?128:0),v&&(w.buf[w.pos++]=127&v|((v>>>=7)?128:0),v&&(w.buf[w.pos++]=127&v|((v>>>=7)?128:0),v&&(w.buf[w.pos++]=127&v|((v>>>=7)?128:0),v&&(w.buf[w.pos++]=127&v|((v>>>=7)?128:0),v&&(w.buf[w.pos++]=127&v)))))}(m,c)}(u,this):(this.realloc(4),this.buf[this.pos++]=127&u|(u>127?128:0),u<=127||(this.buf[this.pos++]=127&(u>>>=7)|(u>127?128:0),u<=127||(this.buf[this.pos++]=127&(u>>>=7)|(u>127?128:0),u<=127||(this.buf[this.pos++]=u>>>7&127))))},writeSVarint:function(u){this.writeVarint(u<0?2*-u-1:2*u)},writeBoolean:function(u){this.writeVarint(!!u)},writeString:function(u){u=String(u),this.realloc(4*u.length),this.pos++;var o=this.pos;this.pos=function(p,m,v){for(var w,E,T=0;T<m.length;T++){if((w=m.charCodeAt(T))>55295&&w<57344){if(!E){w>56319||T+1===m.length?(p[v++]=239,p[v++]=191,p[v++]=189):E=w;continue}if(w<56320){p[v++]=239,p[v++]=191,p[v++]=189,E=w;continue}w=E-55296<<10|w-56320|65536,E=null}else E&&(p[v++]=239,p[v++]=191,p[v++]=189,E=null);w<128?p[v++]=w:(w<2048?p[v++]=w>>6|192:(w<65536?p[v++]=w>>12|224:(p[v++]=w>>18|240,p[v++]=w>>12&63|128),p[v++]=w>>6&63|128),p[v++]=63&w|128)}return v}(this.buf,u,this.pos);var c=this.pos-o;c>=128&&q0(o,c,this),this.pos=o-1,this.writeVarint(c),this.pos+=c},writeFloat:function(u){this.realloc(4),U0(this.buf,u,this.pos,!0,23,4),this.pos+=4},writeDouble:function(u){this.realloc(8),U0(this.buf,u,this.pos,!0,52,8),this.pos+=8},writeBytes:function(u){var o=u.length;this.writeVarint(o),this.realloc(o);for(var c=0;c<o;c++)this.buf[this.pos++]=u[c]},writeRawMessage:function(u,o){this.pos++;var c=this.pos;u(o,this);var p=this.pos-c;p>=128&&q0(c,p,this),this.pos=c-1,this.writeVarint(p),this.pos+=p},writeMessage:function(u,o,c){this.writeTag(u,Qn.Bytes),this.writeRawMessage(o,c)},writePackedVarint:function(u,o){o.length&&this.writeMessage(u,D2,o)},writePackedSVarint:function(u,o){o.length&&this.writeMessage(u,R2,o)},writePackedBoolean:function(u,o){o.length&&this.writeMessage(u,F2,o)},writePackedFloat:function(u,o){o.length&&this.writeMessage(u,O2,o)},writePackedDouble:function(u,o){o.length&&this.writeMessage(u,z2,o)},writePackedFixed32:function(u,o){o.length&&this.writeMessage(u,B2,o)},writePackedSFixed32:function(u,o){o.length&&this.writeMessage(u,V2,o)},writePackedFixed64:function(u,o){o.length&&this.writeMessage(u,U2,o)},writePackedSFixed64:function(u,o){o.length&&this.writeMessage(u,G2,o)},writeBytesField:function(u,o){this.writeTag(u,Qn.Bytes),this.writeBytes(o)},writeFixed32Field:function(u,o){this.writeTag(u,Qn.Fixed32),this.writeFixed32(o)},writeSFixed32Field:function(u,o){this.writeTag(u,Qn.Fixed32),this.writeSFixed32(o)},writeFixed64Field:function(u,o){this.writeTag(u,Qn.Fixed64),this.writeFixed64(o)},writeSFixed64Field:function(u,o){this.writeTag(u,Qn.Fixed64),this.writeSFixed64(o)},writeVarintField:function(u,o){this.writeTag(u,Qn.Varint),this.writeVarint(o)},writeSVarintField:function(u,o){this.writeTag(u,Qn.Varint),this.writeSVarint(o)},writeStringField:function(u,o){this.writeTag(u,Qn.Bytes),this.writeString(o)},writeFloatField:function(u,o){this.writeTag(u,Qn.Fixed32),this.writeFloat(o)},writeDoubleField:function(u,o){this.writeTag(u,Qn.Fixed64),this.writeDouble(o)},writeBooleanField:function(u,o){this.writeVarintField(u,!!o)}};var v_=x(B0);const b_=3;function j2(u,o,c){u===1&&c.readMessage(q2,o)}function q2(u,o,c){if(u===3){const{id:p,bitmap:m,width:v,height:w,left:E,top:T,advance:k}=c.readMessage(Z2,{});o.push({id:p,bitmap:new sp({width:v+2*b_,height:w+2*b_},m),metrics:{width:v,height:w,left:E,top:T,advance:k}})}}function Z2(u,o,c){u===1?o.id=c.readVarint():u===2?o.bitmap=c.readBytes():u===3?o.width=c.readVarint():u===4?o.height=c.readVarint():u===5?o.left=c.readSVarint():u===6?o.top=c.readSVarint():u===7&&(o.advance=c.readVarint())}const $0=b_;function W0(u){let o=0,c=0;for(const w of u)o+=w.w*w.h,c=Math.max(c,w.w);u.sort((w,E)=>E.h-w.h);const p=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(o/.95)),c),h:1/0}];let m=0,v=0;for(const w of u)for(let E=p.length-1;E>=0;E--){const T=p[E];if(!(w.w>T.w||w.h>T.h)){if(w.x=T.x,w.y=T.y,v=Math.max(v,w.y+w.h),m=Math.max(m,w.x+w.w),w.w===T.w&&w.h===T.h){const k=p.pop();E<p.length&&(p[E]=k)}else w.h===T.h?(T.x+=w.w,T.w-=w.w):w.w===T.w?(T.y+=w.h,T.h-=w.h):(p.push({x:T.x+w.w,y:T.y,w:T.w-w.w,h:w.h}),T.y+=w.h,T.h-=w.h);break}}return{w:m,h:v,fill:o/(m*v)||0}}const Vo=1;class x_{constructor(o,{pixelRatio:c,version:p,stretchX:m,stretchY:v,content:w}){this.paddedRect=o,this.pixelRatio=c,this.stretchX=m,this.stretchY=v,this.content=w,this.version=p}get tl(){return[this.paddedRect.x+Vo,this.paddedRect.y+Vo]}get br(){return[this.paddedRect.x+this.paddedRect.w-Vo,this.paddedRect.y+this.paddedRect.h-Vo]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*Vo)/this.pixelRatio,(this.paddedRect.h-2*Vo)/this.pixelRatio]}}class X0{constructor(o,c){const p={},m={};this.haveRenderCallbacks=[];const v=[];this.addImages(o,p,v),this.addImages(c,m,v);const{w,h:E}=W0(v),T=new Es({width:w||1,height:E||1});for(const k in o){const D=o[k],F=p[k].paddedRect;Es.copy(D.data,T,{x:0,y:0},{x:F.x+Vo,y:F.y+Vo},D.data)}for(const k in c){const D=c[k],F=m[k].paddedRect,j=F.x+Vo,X=F.y+Vo,H=D.data.width,tt=D.data.height;Es.copy(D.data,T,{x:0,y:0},{x:j,y:X},D.data),Es.copy(D.data,T,{x:0,y:tt-1},{x:j,y:X-1},{width:H,height:1}),Es.copy(D.data,T,{x:0,y:0},{x:j,y:X+tt},{width:H,height:1}),Es.copy(D.data,T,{x:H-1,y:0},{x:j-1,y:X},{width:1,height:tt}),Es.copy(D.data,T,{x:0,y:0},{x:j+H,y:X},{width:1,height:tt})}this.image=T,this.iconPositions=p,this.patternPositions=m}addImages(o,c,p){for(const m in o){const v=o[m],w={x:0,y:0,w:v.data.width+2*Vo,h:v.data.height+2*Vo};p.push(w),c[m]=new x_(w,v),v.hasRenderCallback&&this.haveRenderCallbacks.push(m)}}patchUpdatedImages(o,c){o.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const p in o.updatedImages)this.patchUpdatedImage(this.iconPositions[p],o.getImage(p),c),this.patchUpdatedImage(this.patternPositions[p],o.getImage(p),c)}patchUpdatedImage(o,c,p){if(!o||!c||o.version===c.version)return;o.version=c.version;const[m,v]=o.tl;p.update(c.data,void 0,{x:m,y:v})}}var bu;xe("ImagePosition",x_),xe("ImageAtlas",X0),a.ai=void 0,(bu=a.ai||(a.ai={}))[bu.none=0]="none",bu[bu.horizontal=1]="horizontal",bu[bu.vertical=2]="vertical",bu[bu.horizontalOnly=3]="horizontalOnly";const dp=-17;class mp{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(o,c){const p=new mp;return p.scale=o||1,p.fontStack=c,p}static forImage(o){const c=new mp;return c.imageName=o,c}}class xh{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(o,c){const p=new xh;for(let m=0;m<o.sections.length;m++){const v=o.sections[m];v.image?p.addImageSection(v):p.addTextSection(v,c)}return p}length(){return this.text.length}getSection(o){return this.sections[this.sectionIndex[o]]}getSectionIndex(o){return this.sectionIndex[o]}getCharCode(o){return this.text.charCodeAt(o)}verticalizePunctuation(){this.text=function(o){let c="";for(let p=0;p<o.length;p++){const m=o.charCodeAt(p+1)||null,v=o.charCodeAt(p-1)||null;c+=m&&Kd(m)&&!pp[o[p+1]]||v&&Kd(v)&&!pp[o[p-1]]||!pp[o[p]]?o[p]:pp[o[p]]}return c}(this.text)}trim(){let o=0;for(let p=0;p<this.text.length&&ym[this.text.charCodeAt(p)];p++)o++;let c=this.text.length;for(let p=this.text.length-1;p>=0&&p>=o&&ym[this.text.charCodeAt(p)];p--)c--;this.text=this.text.substring(o,c),this.sectionIndex=this.sectionIndex.slice(o,c)}substring(o,c){const p=new xh;return p.text=this.text.substring(o,c),p.sectionIndex=this.sectionIndex.slice(o,c),p.sections=this.sections,p}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((o,c)=>Math.max(o,this.sections[c].scale),0)}addTextSection(o,c){this.text+=o.text,this.sections.push(mp.forText(o.scale,o.fontStack||c));const p=this.sections.length-1;for(let m=0;m<o.text.length;++m)this.sectionIndex.push(p)}addImageSection(o){const c=o.image?o.image.name:"";if(c.length===0)return void kt("Can't add FormattedSection with an empty image.");const p=this.getNextImageSectionCharCode();p?(this.text+=String.fromCharCode(p),this.sections.push(mp.forImage(c)),this.sectionIndex.push(this.sections.length-1)):kt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function _m(u,o,c,p,m,v,w,E,T,k,D,F,j,X,H,tt){const lt=xh.fromFeature(u,m);let ht;F===a.ai.vertical&&lt.verticalizePunctuation();const{processBidirectionalText:At,processStyledBidirectionalText:Et}=Fo;if(At&&lt.sections.length===1){ht=[];const Jt=At(lt.toString(),w_(lt,k,v,o,p,X,H));for(const ve of Jt){const Me=new xh;Me.text=ve,Me.sections=lt.sections;for(let _e=0;_e<ve.length;_e++)Me.sectionIndex.push(0);ht.push(Me)}}else if(Et){ht=[];const Jt=Et(lt.text,lt.sectionIndex,w_(lt,k,v,o,p,X,H));for(const ve of Jt){const Me=new xh;Me.text=ve[0],Me.sectionIndex=ve[1],Me.sections=lt.sections,ht.push(Me)}}else ht=function(Jt,ve){const Me=[],_e=Jt.text;let de=0;for(const ue of ve)Me.push(Jt.substring(de,ue)),de=ue;return de<_e.length&&Me.push(Jt.substring(de,_e.length)),Me}(lt,w_(lt,k,v,o,p,X,H));const Nt=[],Ft={positionedLines:Nt,text:lt.toString(),top:D[1],bottom:D[1],left:D[0],right:D[0],writingMode:F,iconsInText:!1,verticalizable:!1};return function(Jt,ve,Me,_e,de,ue,we,he,ie,Be,Ae,dn){let mi=0,bi=dp,gr=0,hs=0;const So=he==="right"?1:he==="left"?0:.5;let or=0;for(const _r of de){_r.trim();const yr=_r.getMaxScale(),lo=(yr-1)*mr,Co={positionedGlyphs:[],lineOffset:0};Jt.positionedLines[or]=Co;const uo=Co.positionedGlyphs;let Uo=0;if(!_r.length()){bi+=ue,++or;continue}for(let vr=0;vr<_r.length();vr++){const Sn=_r.getSection(vr),co=_r.getSectionIndex(vr),Hr=_r.getCharCode(vr);let br=0,Ys=null,ka=null,Aa=null,Ol=mr;const Ks=!(ie===a.ai.horizontal||!Ae&&!Uf(Hr)||Ae&&(ym[Hr]||(zr=Hr,ye.Arabic(zr)||ye["Arabic Supplement"](zr)||ye["Arabic Extended-A"](zr)||ye["Arabic Presentation Forms-A"](zr)||ye["Arabic Presentation Forms-B"](zr))));if(Sn.imageName){const Cs=_e[Sn.imageName];if(!Cs)continue;Aa=Sn.imageName,Jt.iconsInText=Jt.iconsInText||!0,ka=Cs.paddedRect;const jo=Cs.displaySize;Sn.scale=Sn.scale*mr/dn,Ys={width:jo[0],height:jo[1],left:Vo,top:-$0,advance:Ks?jo[1]:jo[0]},br=lo+(mr-jo[1]*Sn.scale),Ol=Ys.advance;const zl=Ks?jo[0]*Sn.scale-mr*yr:jo[1]*Sn.scale-mr*yr;zl>0&&zl>Uo&&(Uo=zl)}else{const Cs=Me[Sn.fontStack],jo=Cs&&Cs[Hr];if(jo&&jo.rect)ka=jo.rect,Ys=jo.metrics;else{const zl=ve[Sn.fontStack],bp=zl&&zl[Hr];if(!bp)continue;Ys=bp.metrics}br=(yr-Sn.scale)*mr}Ks?(Jt.verticalizable=!0,uo.push({glyph:Hr,imageName:Aa,x:mi,y:bi+br,vertical:Ks,scale:Sn.scale,fontStack:Sn.fontStack,sectionIndex:co,metrics:Ys,rect:ka}),mi+=Ol*Sn.scale+Be):(uo.push({glyph:Hr,imageName:Aa,x:mi,y:bi+br,vertical:Ks,scale:Sn.scale,fontStack:Sn.fontStack,sectionIndex:co,metrics:Ys,rect:ka}),mi+=Ys.advance*Sn.scale+Be)}uo.length!==0&&(gr=Math.max(mi-Be,gr),X2(uo,0,uo.length-1,So,Uo)),mi=0;const Go=ue*yr+Uo;Co.lineOffset=Math.max(Uo,lo),bi+=Go,hs=Math.max(Go,hs),++or}var zr;const Xr=bi-dp,{horizontalAlign:Eo,verticalAlign:Io}=S_(we);(function(_r,yr,lo,Co,uo,Uo,Go,vr,Sn){const co=(yr-lo)*uo;let Hr=0;Hr=Uo!==Go?-vr*Co-dp:(-Co*Sn+.5)*Go;for(const br of _r)for(const Ys of br.positionedGlyphs)Ys.x+=co,Ys.y+=Hr})(Jt.positionedLines,So,Eo,Io,gr,hs,ue,Xr,de.length),Jt.top+=-Io*Xr,Jt.bottom=Jt.top+Xr,Jt.left+=-Eo*gr,Jt.right=Jt.left+gr}(Ft,o,c,p,ht,w,E,T,F,k,j,tt),!function(Jt){for(const ve of Jt)if(ve.positionedGlyphs.length!==0)return!1;return!0}(Nt)&&Ft}const ym={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},$2={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function H0(u,o,c,p,m,v){if(o.imageName){const w=p[o.imageName];return w?w.displaySize[0]*o.scale*mr/v+m:0}{const w=c[o.fontStack],E=w&&w[u];return E?E.metrics.advance*o.scale+m:0}}function Y0(u,o,c,p){const m=Math.pow(u-o,2);return p?u<o?m/2:2*m:m+Math.abs(c)*c}function W2(u,o,c){let p=0;return u===10&&(p-=1e4),c&&(p+=150),u!==40&&u!==65288||(p+=50),o!==41&&o!==65289||(p+=50),p}function K0(u,o,c,p,m,v){let w=null,E=Y0(o,c,m,v);for(const T of p){const k=Y0(o-T.x,c,m,v)+T.badness;k<=E&&(w=T,E=k)}return{index:u,x:o,priorBreak:w,badness:E}}function J0(u){return u?J0(u.priorBreak).concat(u.index):[]}function w_(u,o,c,p,m,v,w){if(v!=="point")return[];if(!u)return[];const E=[],T=function(j,X,H,tt,lt,ht){let At=0;for(let Et=0;Et<j.length();Et++){const Nt=j.getSection(Et);At+=H0(j.getCharCode(Et),Nt,tt,lt,X,ht)}return At/Math.max(1,Math.ceil(At/H))}(u,o,c,p,m,w),k=u.text.indexOf("")>=0;let D=0;for(let j=0;j<u.length();j++){const X=u.getSection(j),H=u.getCharCode(j);if(ym[H]||(D+=H0(H,X,p,m,o,w)),j<u.length()-1){const tt=!((F=H)<11904||!(ye["Bopomofo Extended"](F)||ye.Bopomofo(F)||ye["CJK Compatibility Forms"](F)||ye["CJK Compatibility Ideographs"](F)||ye["CJK Compatibility"](F)||ye["CJK Radicals Supplement"](F)||ye["CJK Strokes"](F)||ye["CJK Symbols and Punctuation"](F)||ye["CJK Unified Ideographs Extension A"](F)||ye["CJK Unified Ideographs"](F)||ye["Enclosed CJK Letters and Months"](F)||ye["Halfwidth and Fullwidth Forms"](F)||ye.Hiragana(F)||ye["Ideographic Description Characters"](F)||ye["Kangxi Radicals"](F)||ye["Katakana Phonetic Extensions"](F)||ye.Katakana(F)||ye["Vertical Forms"](F)||ye["Yi Radicals"](F)||ye["Yi Syllables"](F)));($2[H]||tt||X.imageName)&&E.push(K0(j+1,D,T,E,W2(H,u.getCharCode(j+1),tt&&k),!1))}}var F;return J0(K0(u.length(),D,T,E,0,!0))}function S_(u){let o=.5,c=.5;switch(u){case"right":case"top-right":case"bottom-right":o=1;break;case"left":case"top-left":case"bottom-left":o=0}switch(u){case"bottom":case"bottom-right":case"bottom-left":c=1;break;case"top":case"top-right":case"top-left":c=0}return{horizontalAlign:o,verticalAlign:c}}function X2(u,o,c,p,m){if(!p&&!m)return;const v=u[c],w=(u[c].x+v.metrics.advance*v.scale)*p;for(let E=o;E<=c;E++)u[E].x-=w,u[E].y+=m}function H2(u,o,c){const{horizontalAlign:p,verticalAlign:m}=S_(c),v=o[0]-u.displaySize[0]*p,w=o[1]-u.displaySize[1]*m;return{image:u,top:w,bottom:w+u.displaySize[1],left:v,right:v+u.displaySize[0]}}function Q0(u,o,c,p,m,v){const w=u.image;let E;if(w.content){const lt=w.content,ht=w.pixelRatio||1;E=[lt[0]/ht,lt[1]/ht,w.displaySize[0]-lt[2]/ht,w.displaySize[1]-lt[3]/ht]}const T=o.left*v,k=o.right*v;let D,F,j,X;c==="width"||c==="both"?(X=m[0]+T-p[3],F=m[0]+k+p[1]):(X=m[0]+(T+k-w.displaySize[0])/2,F=X+w.displaySize[0]);const H=o.top*v,tt=o.bottom*v;return c==="height"||c==="both"?(D=m[1]+H-p[0],j=m[1]+tt+p[2]):(D=m[1]+(H+tt-w.displaySize[1])/2,j=D+w.displaySize[1]),{image:w,top:D,right:F,bottom:j,left:X,collisionPadding:E}}const gp=255,il=128,xu=gp*il;function tv(u,o){const{expression:c}=o;if(c.kind==="constant")return{kind:"constant",layoutSize:c.evaluate(new pi(u+1))};if(c.kind==="source")return{kind:"source"};{const{zoomStops:p,interpolationType:m}=c;let v=0;for(;v<p.length&&p[v]<=u;)v++;v=Math.max(0,v-1);let w=v;for(;w<p.length&&p[w]<u+1;)w++;w=Math.min(p.length-1,w);const E=p[v],T=p[w];return c.kind==="composite"?{kind:"composite",minZoom:E,maxZoom:T,interpolationType:m}:{kind:"camera",minZoom:E,maxZoom:T,minSize:c.evaluate(new pi(E)),maxSize:c.evaluate(new pi(T)),interpolationType:m}}}function E_(u,o,c){let p="never";const m=u.get(o);return m?p=m:u.get(c)&&(p="always"),p}const Y2=vu.VectorTileFeature.types,K2=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function vm(u,o,c,p,m,v,w,E,T,k,D,F,j){const X=E?Math.min(xu,Math.round(E[0])):0,H=E?Math.min(xu,Math.round(E[1])):0;u.emplaceBack(o,c,Math.round(32*p),Math.round(32*m),v,w,(X<<1)+(T?1:0),H,16*k,16*D,256*F,256*j)}function I_(u,o,c){u.emplaceBack(o.x,o.y,c),u.emplaceBack(o.x,o.y,c),u.emplaceBack(o.x,o.y,c),u.emplaceBack(o.x,o.y,c)}function J2(u){for(const o of u.sections)if(Kg(o.text))return!0;return!1}class C_{constructor(o){this.layoutVertexArray=new _n,this.indexArray=new Rr,this.programConfigurations=o,this.segments=new di,this.dynamicLayoutVertexArray=new un,this.opacityVertexArray=new bn,this.hasVisibleVertices=!1,this.placedSymbolArray=new Lt}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(o,c,p,m){this.isEmpty()||(p&&(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,M2.members),this.indexBuffer=o.createIndexBuffer(this.indexArray,c),this.dynamicLayoutVertexBuffer=o.createVertexBuffer(this.dynamicLayoutVertexArray,P2.members,!0),this.opacityVertexBuffer=o.createVertexBuffer(this.opacityVertexArray,K2,!0),this.opacityVertexBuffer.itemSize=1),(p||m)&&this.programConfigurations.upload(o))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}xe("SymbolBuffers",C_);class T_{constructor(o,c,p){this.layoutVertexArray=new o,this.layoutAttributes=c,this.indexArray=new p,this.segments=new di,this.collisionVertexArray=new si}upload(o){this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=o.createVertexBuffer(this.collisionVertexArray,k2.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}xe("CollisionBuffers",T_);class wh{constructor(o){this.collisionBoxArray=o.collisionBoxArray,this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(w=>w.id),this.index=o.index,this.pixelRatio=o.pixelRatio,this.sourceLayerIndex=o.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=r_([]),this.placementViewportMatrix=r_([]);const c=this.layers[0]._unevaluatedLayout._values;this.textSizeData=tv(this.zoom,c["text-size"]),this.iconSizeData=tv(this.zoom,c["icon-size"]);const p=this.layers[0].layout,m=p.get("symbol-sort-key"),v=p.get("symbol-z-order");this.canOverlap=E_(p,"text-overlap","text-allow-overlap")!=="never"||E_(p,"icon-overlap","icon-allow-overlap")!=="never"||p.get("text-ignore-placement")||p.get("icon-ignore-placement"),this.sortFeaturesByKey=v!=="viewport-y"&&!m.isConstant(),this.sortFeaturesByY=(v==="viewport-y"||v==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,p.get("symbol-placement")==="point"&&(this.writingModes=p.get("text-writing-mode").map(w=>a.ai[w])),this.stateDependentLayerIds=this.layers.filter(w=>w.isStateDependent()).map(w=>w.id),this.sourceID=o.sourceID}createArrays(){this.text=new C_(new Pa(this.layers,this.zoom,o=>/^text/.test(o))),this.icon=new C_(new Pa(this.layers,this.zoom,o=>/^icon/.test(o))),this.glyphOffsetArray=new Pt,this.lineVertexArray=new Bt,this.symbolInstances=new ct,this.textAnchorOffsets=new Yt}calculateGlyphDependencies(o,c,p,m,v){for(let w=0;w<o.length;w++)if(c[o.charCodeAt(w)]=!0,(p||m)&&v){const E=pp[o.charAt(w)];E&&(c[E.charCodeAt(0)]=!0)}}populate(o,c,p){const m=this.layers[0],v=m.layout,w=v.get("text-font"),E=v.get("text-field"),T=v.get("icon-image"),k=(E.value.kind!=="constant"||E.value.value instanceof Zr&&!E.value.value.isEmpty()||E.value.value.toString().length>0)&&(w.value.kind!=="constant"||w.value.value.length>0),D=T.value.kind!=="constant"||!!T.value.value||Object.keys(T.parameters).length>0,F=v.get("symbol-sort-key");if(this.features=[],!k&&!D)return;const j=c.iconDependencies,X=c.glyphDependencies,H=c.availableImages,tt=new pi(this.zoom);for(const{feature:lt,id:ht,index:At,sourceLayerIndex:Et}of o){const Nt=m._featureFilter.needGeometry,Ft=hc(lt,Nt);if(!m._featureFilter.filter(tt,Ft,p))continue;let Jt,ve;if(Nt||(Ft.geometry=cc(lt)),k){const _e=m.getValueAndResolveTokens("text-field",Ft,p,H),de=Zr.factory(_e);J2(de)&&(this.hasRTLText=!0),(!this.hasRTLText||Wf()==="unavailable"||this.hasRTLText&&Fo.isParsed())&&(Jt=N2(de,m,Ft))}if(D){const _e=m.getValueAndResolveTokens("icon-image",Ft,p,H);ve=_e instanceof Dr?_e:Dr.fromString(_e)}if(!Jt&&!ve)continue;const Me=this.sortFeaturesByKey?F.evaluate(Ft,{},p):void 0;if(this.features.push({id:ht,text:Jt,icon:ve,index:At,sourceLayerIndex:Et,geometry:Ft.geometry,properties:lt.properties,type:Y2[lt.type],sortKey:Me}),ve&&(j[ve.name]=!0),Jt){const _e=w.evaluate(Ft,{},p).join(","),de=v.get("text-rotation-alignment")!=="viewport"&&v.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(a.ai.vertical)>=0;for(const ue of Jt.sections)if(ue.image)j[ue.image.name]=!0;else{const we=Bf(Jt.toString()),he=ue.fontStack||_e,ie=X[he]=X[he]||{};this.calculateGlyphDependencies(ue.text,ie,de,this.allowVerticalPlacement,we)}}}v.get("symbol-placement")==="line"&&(this.features=function(lt){const ht={},At={},Et=[];let Nt=0;function Ft(_e){Et.push(lt[_e]),Nt++}function Jt(_e,de,ue){const we=At[_e];return delete At[_e],At[de]=we,Et[we].geometry[0].pop(),Et[we].geometry[0]=Et[we].geometry[0].concat(ue[0]),we}function ve(_e,de,ue){const we=ht[de];return delete ht[de],ht[_e]=we,Et[we].geometry[0].shift(),Et[we].geometry[0]=ue[0].concat(Et[we].geometry[0]),we}function Me(_e,de,ue){const we=ue?de[0][de[0].length-1]:de[0][0];return`${_e}:${we.x}:${we.y}`}for(let _e=0;_e<lt.length;_e++){const de=lt[_e],ue=de.geometry,we=de.text?de.text.toString():null;if(!we){Ft(_e);continue}const he=Me(we,ue),ie=Me(we,ue,!0);if(he in At&&ie in ht&&At[he]!==ht[ie]){const Be=ve(he,ie,ue),Ae=Jt(he,ie,Et[Be].geometry);delete ht[he],delete At[ie],At[Me(we,Et[Ae].geometry,!0)]=Ae,Et[Be].geometry=null}else he in At?Jt(he,ie,ue):ie in ht?ve(he,ie,ue):(Ft(_e),ht[he]=Nt-1,At[ie]=Nt-1)}return Et.filter(_e=>_e.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((lt,ht)=>lt.sortKey-ht.sortKey)}update(o,c,p){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(o,c,this.layers,p),this.icon.programConfigurations.updatePaintArrays(o,c,this.layers,p))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(o){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(o),this.iconCollisionBox.upload(o)),this.text.upload(o,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(o,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(o,c){const p=this.lineVertexArray.length;if(o.segment!==void 0){let m=o.dist(c[o.segment+1]),v=o.dist(c[o.segment]);const w={};for(let E=o.segment+1;E<c.length;E++)w[E]={x:c[E].x,y:c[E].y,tileUnitDistanceFromAnchor:m},E<c.length-1&&(m+=c[E+1].dist(c[E]));for(let E=o.segment||0;E>=0;E--)w[E]={x:c[E].x,y:c[E].y,tileUnitDistanceFromAnchor:v},E>0&&(v+=c[E-1].dist(c[E]));for(let E=0;E<c.length;E++){const T=w[E];this.lineVertexArray.emplaceBack(T.x,T.y,T.tileUnitDistanceFromAnchor)}}return{lineStartIndex:p,lineLength:this.lineVertexArray.length-p}}addSymbols(o,c,p,m,v,w,E,T,k,D,F,j){const X=o.indexArray,H=o.layoutVertexArray,tt=o.segments.prepareSegment(4*c.length,H,X,this.canOverlap?w.sortKey:void 0),lt=this.glyphOffsetArray.length,ht=tt.vertexLength,At=this.allowVerticalPlacement&&E===a.ai.vertical?Math.PI/2:0,Et=w.text&&w.text.sections;for(let Nt=0;Nt<c.length;Nt++){const{tl:Ft,tr:Jt,bl:ve,br:Me,tex:_e,pixelOffsetTL:de,pixelOffsetBR:ue,minFontScaleX:we,minFontScaleY:he,glyphOffset:ie,isSDF:Be,sectionIndex:Ae}=c[Nt],dn=tt.vertexLength,mi=ie[1];vm(H,T.x,T.y,Ft.x,mi+Ft.y,_e.x,_e.y,p,Be,de.x,de.y,we,he),vm(H,T.x,T.y,Jt.x,mi+Jt.y,_e.x+_e.w,_e.y,p,Be,ue.x,de.y,we,he),vm(H,T.x,T.y,ve.x,mi+ve.y,_e.x,_e.y+_e.h,p,Be,de.x,ue.y,we,he),vm(H,T.x,T.y,Me.x,mi+Me.y,_e.x+_e.w,_e.y+_e.h,p,Be,ue.x,ue.y,we,he),I_(o.dynamicLayoutVertexArray,T,At),X.emplaceBack(dn,dn+1,dn+2),X.emplaceBack(dn+1,dn+2,dn+3),tt.vertexLength+=4,tt.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(ie[0]),Nt!==c.length-1&&Ae===c[Nt+1].sectionIndex||o.programConfigurations.populatePaintArrays(H.length,w,w.index,{},j,Et&&Et[Ae])}o.placedSymbolArray.emplaceBack(T.x,T.y,lt,this.glyphOffsetArray.length-lt,ht,k,D,T.segment,p?p[0]:0,p?p[1]:0,m[0],m[1],E,0,!1,0,F)}_addCollisionDebugVertex(o,c,p,m,v,w){return c.emplaceBack(0,0),o.emplaceBack(p.x,p.y,m,v,Math.round(w.x),Math.round(w.y))}addCollisionDebugVertices(o,c,p,m,v,w,E){const T=v.segments.prepareSegment(4,v.layoutVertexArray,v.indexArray),k=T.vertexLength,D=v.layoutVertexArray,F=v.collisionVertexArray,j=E.anchorX,X=E.anchorY;this._addCollisionDebugVertex(D,F,w,j,X,new A(o,c)),this._addCollisionDebugVertex(D,F,w,j,X,new A(p,c)),this._addCollisionDebugVertex(D,F,w,j,X,new A(p,m)),this._addCollisionDebugVertex(D,F,w,j,X,new A(o,m)),T.vertexLength+=4;const H=v.indexArray;H.emplaceBack(k,k+1),H.emplaceBack(k+1,k+2),H.emplaceBack(k+2,k+3),H.emplaceBack(k+3,k),T.primitiveLength+=4}addDebugCollisionBoxes(o,c,p,m){for(let v=o;v<c;v++){const w=this.collisionBoxArray.get(v);this.addCollisionDebugVertices(w.x1,w.y1,w.x2,w.y2,m?this.textCollisionBox:this.iconCollisionBox,w.anchorPoint,p)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new T_(Ui,F0.members,pr),this.iconCollisionBox=new T_(Ui,F0.members,pr);for(let o=0;o<this.symbolInstances.length;o++){const c=this.symbolInstances.get(o);this.addDebugCollisionBoxes(c.textBoxStartIndex,c.textBoxEndIndex,c,!0),this.addDebugCollisionBoxes(c.verticalTextBoxStartIndex,c.verticalTextBoxEndIndex,c,!0),this.addDebugCollisionBoxes(c.iconBoxStartIndex,c.iconBoxEndIndex,c,!1),this.addDebugCollisionBoxes(c.verticalIconBoxStartIndex,c.verticalIconBoxEndIndex,c,!1)}}_deserializeCollisionBoxesForSymbol(o,c,p,m,v,w,E,T,k){const D={};for(let F=c;F<p;F++){const j=o.get(F);D.textBox={x1:j.x1,y1:j.y1,x2:j.x2,y2:j.y2,anchorPointX:j.anchorPointX,anchorPointY:j.anchorPointY},D.textFeatureIndex=j.featureIndex;break}for(let F=m;F<v;F++){const j=o.get(F);D.verticalTextBox={x1:j.x1,y1:j.y1,x2:j.x2,y2:j.y2,anchorPointX:j.anchorPointX,anchorPointY:j.anchorPointY},D.verticalTextFeatureIndex=j.featureIndex;break}for(let F=w;F<E;F++){const j=o.get(F);D.iconBox={x1:j.x1,y1:j.y1,x2:j.x2,y2:j.y2,anchorPointX:j.anchorPointX,anchorPointY:j.anchorPointY},D.iconFeatureIndex=j.featureIndex;break}for(let F=T;F<k;F++){const j=o.get(F);D.verticalIconBox={x1:j.x1,y1:j.y1,x2:j.x2,y2:j.y2,anchorPointX:j.anchorPointX,anchorPointY:j.anchorPointY},D.verticalIconFeatureIndex=j.featureIndex;break}return D}deserializeCollisionBoxes(o){this.collisionArrays=[];for(let c=0;c<this.symbolInstances.length;c++){const p=this.symbolInstances.get(c);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(o,p.textBoxStartIndex,p.textBoxEndIndex,p.verticalTextBoxStartIndex,p.verticalTextBoxEndIndex,p.iconBoxStartIndex,p.iconBoxEndIndex,p.verticalIconBoxStartIndex,p.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(o,c){const p=o.placedSymbolArray.get(c),m=p.vertexStartIndex+4*p.numGlyphs;for(let v=p.vertexStartIndex;v<m;v+=4)o.indexArray.emplaceBack(v,v+1,v+2),o.indexArray.emplaceBack(v+1,v+2,v+3)}getSortedSymbolIndexes(o){if(this.sortedAngle===o&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const c=Math.sin(o),p=Math.cos(o),m=[],v=[],w=[];for(let E=0;E<this.symbolInstances.length;++E){w.push(E);const T=this.symbolInstances.get(E);m.push(0|Math.round(c*T.anchorX+p*T.anchorY)),v.push(T.featureIndex)}return w.sort((E,T)=>m[E]-m[T]||v[T]-v[E]),w}addToSortKeyRanges(o,c){const p=this.sortKeyRanges[this.sortKeyRanges.length-1];p&&p.sortKey===c?p.symbolInstanceEnd=o+1:this.sortKeyRanges.push({sortKey:c,symbolInstanceStart:o,symbolInstanceEnd:o+1})}sortFeatures(o){if(this.sortFeaturesByY&&this.sortedAngle!==o&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(o),this.sortedAngle=o,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const c of this.symbolInstanceIndexes){const p=this.symbolInstances.get(c);this.featureSortOrder.push(p.featureIndex),[p.rightJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.leftJustifiedTextSymbolIndex].forEach((m,v,w)=>{m>=0&&w.indexOf(m)===v&&this.addIndicesForPlacedSymbol(this.text,m)}),p.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,p.verticalPlacedTextSymbolIndex),p.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,p.placedIconSymbolIndex),p.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,p.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let ev,nv;xe("SymbolBucket",wh,{omit:["layers","collisionBoxArray","features","compareText"]}),wh.MAX_GLYPHS=65535,wh.addDynamicAttributes=I_;var L_={get paint(){return nv=nv||new Xi({"icon-opacity":new Ue($t.paint_symbol["icon-opacity"]),"icon-color":new Ue($t.paint_symbol["icon-color"]),"icon-halo-color":new Ue($t.paint_symbol["icon-halo-color"]),"icon-halo-width":new Ue($t.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Ue($t.paint_symbol["icon-halo-blur"]),"icon-translate":new Re($t.paint_symbol["icon-translate"]),"icon-translate-anchor":new Re($t.paint_symbol["icon-translate-anchor"]),"text-opacity":new Ue($t.paint_symbol["text-opacity"]),"text-color":new Ue($t.paint_symbol["text-color"],{runtimeType:Ar,getOverride:u=>u.textColor,hasOverride:u=>!!u.textColor}),"text-halo-color":new Ue($t.paint_symbol["text-halo-color"]),"text-halo-width":new Ue($t.paint_symbol["text-halo-width"]),"text-halo-blur":new Ue($t.paint_symbol["text-halo-blur"]),"text-translate":new Re($t.paint_symbol["text-translate"]),"text-translate-anchor":new Re($t.paint_symbol["text-translate-anchor"])})},get layout(){return ev=ev||new Xi({"symbol-placement":new Re($t.layout_symbol["symbol-placement"]),"symbol-spacing":new Re($t.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Re($t.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Ue($t.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Re($t.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Re($t.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Re($t.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Re($t.layout_symbol["icon-ignore-placement"]),"icon-optional":new Re($t.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Re($t.layout_symbol["icon-rotation-alignment"]),"icon-size":new Ue($t.layout_symbol["icon-size"]),"icon-text-fit":new Re($t.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Re($t.layout_symbol["icon-text-fit-padding"]),"icon-image":new Ue($t.layout_symbol["icon-image"]),"icon-rotate":new Ue($t.layout_symbol["icon-rotate"]),"icon-padding":new Ue($t.layout_symbol["icon-padding"]),"icon-keep-upright":new Re($t.layout_symbol["icon-keep-upright"]),"icon-offset":new Ue($t.layout_symbol["icon-offset"]),"icon-anchor":new Ue($t.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Re($t.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Re($t.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Re($t.layout_symbol["text-rotation-alignment"]),"text-field":new Ue($t.layout_symbol["text-field"]),"text-font":new Ue($t.layout_symbol["text-font"]),"text-size":new Ue($t.layout_symbol["text-size"]),"text-max-width":new Ue($t.layout_symbol["text-max-width"]),"text-line-height":new Re($t.layout_symbol["text-line-height"]),"text-letter-spacing":new Ue($t.layout_symbol["text-letter-spacing"]),"text-justify":new Ue($t.layout_symbol["text-justify"]),"text-radial-offset":new Ue($t.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Re($t.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Ue($t.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Ue($t.layout_symbol["text-anchor"]),"text-max-angle":new Re($t.layout_symbol["text-max-angle"]),"text-writing-mode":new Re($t.layout_symbol["text-writing-mode"]),"text-rotate":new Ue($t.layout_symbol["text-rotate"]),"text-padding":new Re($t.layout_symbol["text-padding"]),"text-keep-upright":new Re($t.layout_symbol["text-keep-upright"]),"text-transform":new Ue($t.layout_symbol["text-transform"]),"text-offset":new Ue($t.layout_symbol["text-offset"]),"text-allow-overlap":new Re($t.layout_symbol["text-allow-overlap"]),"text-overlap":new Re($t.layout_symbol["text-overlap"]),"text-ignore-placement":new Re($t.layout_symbol["text-ignore-placement"]),"text-optional":new Re($t.layout_symbol["text-optional"])})}};class iv{constructor(o){if(o.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=o.property.overrides?o.property.overrides.runtimeType:ws,this.defaultValue=o}evaluate(o){if(o.formattedSection){const c=this.defaultValue.property.overrides;if(c&&c.hasOverride(o.formattedSection))return c.getOverride(o.formattedSection)}return o.feature&&o.featureState?this.defaultValue.evaluate(o.feature,o.featureState):this.defaultValue.property.specification.default}eachChild(o){this.defaultValue.isConstant()||o(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}xe("FormatSectionOverride",iv,{omit:["defaultValue"]});class bm extends us{constructor(o){super(o,L_)}recalculate(o,c){if(super.recalculate(o,c),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const p=this.layout.get("text-writing-mode");if(p){const m=[];for(const v of p)m.indexOf(v)<0&&m.push(v);this.layout._values["text-writing-mode"]=m}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(o,c,p,m){const v=this.layout.get(o).evaluate(c,{},p,m),w=this._unevaluatedLayout._values[o];return w.isDataDriven()||nh(w.value)||!v?v:function(E,T){return T.replace(/{([^{}]+)}/g,(k,D)=>E&&D in E?String(E[D]):"")}(c.properties,v)}createBucket(o){return new wh(o)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const o of L_.paint.overridableProperties){if(!bm.hasPaintOverride(this.layout,o))continue;const c=this.paint.get(o),p=new iv(c),m=new Nf(p,c.property.specification);let v=null;v=c.value.kind==="constant"||c.value.kind==="source"?new Df("source",m):new rh("composite",m,c.value.zoomStops),this.paint._values[o]=new so(c.property,v,c.parameters)}}_handleOverridablePaintPropertyUpdate(o,c,p){return!(!this.layout||c.isDataDriven()||p.isDataDriven())&&bm.hasPaintOverride(this.layout,o)}static hasPaintOverride(o,c){const p=o.get("text-field"),m=L_.paint.properties[c];let v=!1;const w=E=>{for(const T of E)if(m.overrides&&m.overrides.hasOverride(T))return void(v=!0)};if(p.value.kind==="constant"&&p.value.value instanceof Zr)w(p.value.value.sections);else if(p.value.kind==="source"){const E=k=>{v||(k instanceof Sl&&Ei(k.value)===st?w(k.value.sections):k instanceof eh?w(k.sections):k.eachChild(E))},T=p.value;T._styleExpression&&E(T._styleExpression.expression)}return v}}let rv;var Q2={get paint(){return rv=rv||new Xi({"background-color":new Re($t.paint_background["background-color"]),"background-pattern":new Hf($t.paint_background["background-pattern"]),"background-opacity":new Re($t.paint_background["background-opacity"])})}};class tS extends us{constructor(o){super(o,Q2)}}let ov;var eS={get paint(){return ov=ov||new Xi({"raster-opacity":new Re($t.paint_raster["raster-opacity"]),"raster-hue-rotate":new Re($t.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Re($t.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Re($t.paint_raster["raster-brightness-max"]),"raster-saturation":new Re($t.paint_raster["raster-saturation"]),"raster-contrast":new Re($t.paint_raster["raster-contrast"]),"raster-resampling":new Re($t.paint_raster["raster-resampling"]),"raster-fade-duration":new Re($t.paint_raster["raster-fade-duration"])})}};class nS extends us{constructor(o){super(o,eS)}}class iS extends us{constructor(o){super(o,{}),this.onAdd=c=>{this.implementation.onAdd&&this.implementation.onAdd(c,c.painter.context.gl)},this.onRemove=c=>{this.implementation.onRemove&&this.implementation.onRemove(c,c.painter.context.gl)},this.implementation=o}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class rS{constructor(o){this._callback=o,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const M_=63710088e-1;class wu{constructor(o,c){if(isNaN(o)||isNaN(c))throw new Error(`Invalid LngLat object: (${o}, ${c})`);if(this.lng=+o,this.lat=+c,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new wu(pt(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(o){const c=Math.PI/180,p=this.lat*c,m=o.lat*c,v=Math.sin(p)*Math.sin(m)+Math.cos(p)*Math.cos(m)*Math.cos((o.lng-this.lng)*c);return M_*Math.acos(Math.min(v,1))}static convert(o){if(o instanceof wu)return o;if(Array.isArray(o)&&(o.length===2||o.length===3))return new wu(Number(o[0]),Number(o[1]));if(!Array.isArray(o)&&typeof o=="object"&&o!==null)return new wu(Number("lng"in o?o.lng:o.lon),Number(o.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const sv=2*Math.PI*M_;function av(u){return sv*Math.cos(u*Math.PI/180)}function lv(u){return(180+u)/360}function uv(u){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+u*Math.PI/360)))/360}function cv(u,o){return u/av(o)}function hv(u){return 360*u-180}function P_(u){return 360/Math.PI*Math.atan(Math.exp((180-360*u)*Math.PI/180))-90}class xm{constructor(o,c,p=0){this.x=+o,this.y=+c,this.z=+p}static fromLngLat(o,c=0){const p=wu.convert(o);return new xm(lv(p.lng),uv(p.lat),cv(c,p.lat))}toLngLat(){return new wu(hv(this.x),P_(this.y))}toAltitude(){return this.z*av(P_(this.y))}meterInMercatorCoordinateUnits(){return 1/sv*(o=P_(this.y),1/Math.cos(o*Math.PI/180));var o}}function fv(u,o,c){var p=2*Math.PI*6378137/256/Math.pow(2,c);return[u*p-2*Math.PI*6378137/2,o*p-2*Math.PI*6378137/2]}class k_{constructor(o,c,p){if(o<0||o>25||p<0||p>=Math.pow(2,o)||c<0||c>=Math.pow(2,o))throw new Error(`x=${c}, y=${p}, z=${o} outside of bounds. 0<=x<${Math.pow(2,o)}, 0<=y<${Math.pow(2,o)} 0<=z<=25 `);this.z=o,this.x=c,this.y=p,this.key=_p(0,o,o,c,p)}equals(o){return this.z===o.z&&this.x===o.x&&this.y===o.y}url(o,c,p){const m=(w=this.y,E=this.z,T=fv(256*(v=this.x),256*(w=Math.pow(2,E)-w-1),E),k=fv(256*(v+1),256*(w+1),E),T[0]+","+T[1]+","+k[0]+","+k[1]);var v,w,E,T,k;const D=function(F,j,X){let H,tt="";for(let lt=F;lt>0;lt--)H=1<<lt-1,tt+=(j&H?1:0)+(X&H?2:0);return tt}(this.z,this.x,this.y);return o[(this.x+this.y)%o.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(p==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,c>1?"@2x":"").replace(/{quadkey}/g,D).replace(/{bbox-epsg-3857}/g,m)}isChildOf(o){const c=this.z-o.z;return c>0&&o.x===this.x>>c&&o.y===this.y>>c}getTilePoint(o){const c=Math.pow(2,this.z);return new A((o.x*c-this.x)*rr,(o.y*c-this.y)*rr)}toString(){return`${this.z}/${this.x}/${this.y}`}}class pv{constructor(o,c){this.wrap=o,this.canonical=c,this.key=_p(o,c.z,c.z,c.x,c.y)}}class Is{constructor(o,c,p,m,v){if(o<p)throw new Error(`overscaledZ should be >= z; overscaledZ = ${o}; z = ${p}`);this.overscaledZ=o,this.wrap=c,this.canonical=new k_(p,+m,+v),this.key=_p(c,o,p,m,v)}clone(){return new Is(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(o){return this.overscaledZ===o.overscaledZ&&this.wrap===o.wrap&&this.canonical.equals(o.canonical)}scaledTo(o){if(o>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${o}; overscaledZ = ${this.overscaledZ}`);const c=this.canonical.z-o;return o>this.canonical.z?new Is(o,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Is(o,this.wrap,o,this.canonical.x>>c,this.canonical.y>>c)}calculateScaledKey(o,c){if(o>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${o}; overscaledZ = ${this.overscaledZ}`);const p=this.canonical.z-o;return o>this.canonical.z?_p(this.wrap*+c,o,this.canonical.z,this.canonical.x,this.canonical.y):_p(this.wrap*+c,o,o,this.canonical.x>>p,this.canonical.y>>p)}isChildOf(o){if(o.wrap!==this.wrap)return!1;const c=this.canonical.z-o.canonical.z;return o.overscaledZ===0||o.overscaledZ<this.overscaledZ&&o.canonical.x===this.canonical.x>>c&&o.canonical.y===this.canonical.y>>c}children(o){if(this.overscaledZ>=o)return[new Is(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const c=this.canonical.z+1,p=2*this.canonical.x,m=2*this.canonical.y;return[new Is(c,this.wrap,c,p,m),new Is(c,this.wrap,c,p+1,m),new Is(c,this.wrap,c,p,m+1),new Is(c,this.wrap,c,p+1,m+1)]}isLessThan(o){return this.wrap<o.wrap||!(this.wrap>o.wrap)&&(this.overscaledZ<o.overscaledZ||!(this.overscaledZ>o.overscaledZ)&&(this.canonical.x<o.canonical.x||!(this.canonical.x>o.canonical.x)&&this.canonical.y<o.canonical.y))}wrapped(){return new Is(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(o){return new Is(this.overscaledZ,o,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new pv(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(o){return this.canonical.getTilePoint(new xm(o.x-this.wrap,o.y))}}function _p(u,o,c,p,m){(u*=2)<0&&(u=-1*u-1);const v=1<<c;return(v*v*u+v*m+p).toString(36)+c.toString(36)+o.toString(36)}xe("CanonicalTileID",k_),xe("OverscaledTileID",Is,{omit:["posMatrix"]});class dv{constructor(o,c,p,m=1,v=1,w=1,E=0){if(this.uid=o,c.height!==c.width)throw new RangeError("DEM tiles must be square");if(p&&!["mapbox","terrarium","custom"].includes(p))return void kt(`"${p}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=c.height;const T=this.dim=c.height-2;switch(this.data=new Uint32Array(c.data.buffer),p){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=m,this.greenFactor=v,this.blueFactor=w,this.baseShift=E;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let k=0;k<T;k++)this.data[this._idx(-1,k)]=this.data[this._idx(0,k)],this.data[this._idx(T,k)]=this.data[this._idx(T-1,k)],this.data[this._idx(k,-1)]=this.data[this._idx(k,0)],this.data[this._idx(k,T)]=this.data[this._idx(k,T-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(T,-1)]=this.data[this._idx(T-1,0)],this.data[this._idx(-1,T)]=this.data[this._idx(0,T-1)],this.data[this._idx(T,T)]=this.data[this._idx(T-1,T-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let k=0;k<T;k++)for(let D=0;D<T;D++){const F=this.get(k,D);F>this.max&&(this.max=F),F<this.min&&(this.min=F)}}get(o,c){const p=new Uint8Array(this.data.buffer),m=4*this._idx(o,c);return this.unpack(p[m],p[m+1],p[m+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(o,c){if(o<-1||o>=this.dim+1||c<-1||c>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(c+1)*this.stride+(o+1)}unpack(o,c,p){return o*this.redFactor+c*this.greenFactor+p*this.blueFactor-this.baseShift}getPixels(){return new Es({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(o,c,p){if(this.dim!==o.dim)throw new Error("dem dimension mismatch");let m=c*this.dim,v=c*this.dim+this.dim,w=p*this.dim,E=p*this.dim+this.dim;switch(c){case-1:m=v-1;break;case 1:v=m+1}switch(p){case-1:w=E-1;break;case 1:E=w+1}const T=-c*this.dim,k=-p*this.dim;for(let D=w;D<E;D++)for(let F=m;F<v;F++)this.data[this._idx(F,D)]=o.data[this._idx(F+T,D+k)]}}xe("DEMData",dv);class mv{constructor(o){this._stringToNumber={},this._numberToString=[];for(let c=0;c<o.length;c++){const p=o[c];this._stringToNumber[p]=c,this._numberToString[c]=p}}encode(o){return this._stringToNumber[o]}decode(o){if(o>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${o} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[o]}}class gv{constructor(o,c,p,m,v){this.type="Feature",this._vectorTileFeature=o,o._z=c,o._x=p,o._y=m,this.properties=o.properties,this.id=v}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(o){this._geometry=o}toJSON(){const o={geometry:this.geometry};for(const c in this)c!=="_geometry"&&c!=="_vectorTileFeature"&&(o[c]=this[c]);return o}}class _v{constructor(o,c){this.tileID=o,this.x=o.canonical.x,this.y=o.canonical.y,this.z=o.canonical.z,this.grid=new du(rr,16,0),this.grid3D=new du(rr,16,0),this.featureIndexArray=new te,this.promoteId=c}insert(o,c,p,m,v,w){const E=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(p,m,v);const T=w?this.grid3D:this.grid;for(let k=0;k<c.length;k++){const D=c[k],F=[1/0,1/0,-1/0,-1/0];for(let j=0;j<D.length;j++){const X=D[j];F[0]=Math.min(F[0],X.x),F[1]=Math.min(F[1],X.y),F[2]=Math.max(F[2],X.x),F[3]=Math.max(F[3],X.y)}F[0]<rr&&F[1]<rr&&F[2]>=0&&F[3]>=0&&T.insert(E,F[0],F[1],F[2],F[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new vu.VectorTile(new v_(this.rawTileData)).layers,this.sourceLayerCoder=new mv(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(o,c,p,m){this.loadVTLayers();const v=o.params||{},w=rr/o.tileSize/o.scale,E=Of(v.filter),T=o.queryGeometry,k=o.queryPadding*w,D=vv(T),F=this.grid.query(D.minX-k,D.minY-k,D.maxX+k,D.maxY+k),j=vv(o.cameraQueryGeometry),X=this.grid3D.query(j.minX-k,j.minY-k,j.maxX+k,j.maxY+k,(lt,ht,At,Et)=>function(Nt,Ft,Jt,ve,Me){for(const de of Nt)if(Ft<=de.x&&Jt<=de.y&&ve>=de.x&&Me>=de.y)return!0;const _e=[new A(Ft,Jt),new A(Ft,Me),new A(ve,Me),new A(ve,Jt)];if(Nt.length>2){for(const de of _e)if(mh(Nt,de))return!0}for(let de=0;de<Nt.length-1;de++)if(Ow(Nt[de],Nt[de+1],_e))return!0;return!1}(o.cameraQueryGeometry,lt-k,ht-k,At+k,Et+k));for(const lt of X)F.push(lt);F.sort(oS);const H={};let tt;for(let lt=0;lt<F.length;lt++){const ht=F[lt];if(ht===tt)continue;tt=ht;const At=this.featureIndexArray.get(ht);let Et=null;this.loadMatchingFeature(H,At.bucketIndex,At.sourceLayerIndex,At.featureIndex,E,v.layers,v.availableImages,c,p,m,(Nt,Ft,Jt)=>(Et||(Et=cc(Nt)),Ft.queryIntersectsFeature(T,Nt,Jt,Et,this.z,o.transform,w,o.pixelPosMatrix)))}return H}loadMatchingFeature(o,c,p,m,v,w,E,T,k,D,F){const j=this.bucketLayerIDs[c];if(w&&!function(lt,ht){for(let At=0;At<lt.length;At++)if(ht.indexOf(lt[At])>=0)return!0;return!1}(w,j))return;const X=this.sourceLayerCoder.decode(p),H=this.vtLayers[X].feature(m);if(v.needGeometry){const lt=hc(H,!0);if(!v.filter(new pi(this.tileID.overscaledZ),lt,this.tileID.canonical))return}else if(!v.filter(new pi(this.tileID.overscaledZ),H))return;const tt=this.getId(H,X);for(let lt=0;lt<j.length;lt++){const ht=j[lt];if(w&&w.indexOf(ht)<0)continue;const At=T[ht];if(!At)continue;let Et={};tt&&D&&(Et=D.getState(At.sourceLayer||"_geojsonTileLayer",tt));const Nt=gt({},k[ht]);Nt.paint=yv(Nt.paint,At.paint,H,Et,E),Nt.layout=yv(Nt.layout,At.layout,H,Et,E);const Ft=!F||F(H,At,Et);if(!Ft)continue;const Jt=new gv(H,this.z,this.x,this.y,tt);Jt.layer=Nt;let ve=o[ht];ve===void 0&&(ve=o[ht]=[]),ve.push({featureIndex:m,feature:Jt,intersectionZ:Ft})}}lookupSymbolFeatures(o,c,p,m,v,w,E,T){const k={};this.loadVTLayers();const D=Of(v);for(const F of o)this.loadMatchingFeature(k,p,m,F,D,w,E,T,c);return k}hasLayer(o){for(const c of this.bucketLayerIDs)for(const p of c)if(o===p)return!0;return!1}getId(o,c){let p=o.id;return this.promoteId&&(p=o.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[c]],typeof p=="boolean"&&(p=Number(p))),p}}function yv(u,o,c,p,m){return St(u,(v,w)=>{const E=o instanceof ph?o.get(w):null;return E&&E.evaluate?E.evaluate(c,p,m):E})}function vv(u){let o=1/0,c=1/0,p=-1/0,m=-1/0;for(const v of u)o=Math.min(o,v.x),c=Math.min(c,v.y),p=Math.max(p,v.x),m=Math.max(m,v.y);return{minX:o,minY:c,maxX:p,maxY:m}}function oS(u,o){return o-u}function bv(u,o,c,p,m){const v=[];for(let w=0;w<u.length;w++){const E=u[w];let T;for(let k=0;k<E.length-1;k++){let D=E[k],F=E[k+1];D.x<o&&F.x<o||(D.x<o?D=new A(o,D.y+(o-D.x)/(F.x-D.x)*(F.y-D.y))._round():F.x<o&&(F=new A(o,D.y+(o-D.x)/(F.x-D.x)*(F.y-D.y))._round()),D.y<c&&F.y<c||(D.y<c?D=new A(D.x+(c-D.y)/(F.y-D.y)*(F.x-D.x),c)._round():F.y<c&&(F=new A(D.x+(c-D.y)/(F.y-D.y)*(F.x-D.x),c)._round()),D.x>=p&&F.x>=p||(D.x>=p?D=new A(p,D.y+(p-D.x)/(F.x-D.x)*(F.y-D.y))._round():F.x>=p&&(F=new A(p,D.y+(p-D.x)/(F.x-D.x)*(F.y-D.y))._round()),D.y>=m&&F.y>=m||(D.y>=m?D=new A(D.x+(m-D.y)/(F.y-D.y)*(F.x-D.x),m)._round():F.y>=m&&(F=new A(D.x+(m-D.y)/(F.y-D.y)*(F.x-D.x),m)._round()),T&&D.equals(T[T.length-1])||(T=[D],v.push(T)),T.push(F)))))}}return v}xe("FeatureIndex",_v,{omit:["rawTileData","sourceLayerCoder"]});class Su extends A{constructor(o,c,p,m){super(o,c),this.angle=p,m!==void 0&&(this.segment=m)}clone(){return new Su(this.x,this.y,this.angle,this.segment)}}function xv(u,o,c,p,m){if(o.segment===void 0||c===0)return!0;let v=o,w=o.segment+1,E=0;for(;E>-c/2;){if(w--,w<0)return!1;E-=u[w].dist(v),v=u[w]}E+=u[w].dist(u[w+1]),w++;const T=[];let k=0;for(;E<c/2;){const D=u[w],F=u[w+1];if(!F)return!1;let j=u[w-1].angleTo(D)-D.angleTo(F);for(j=Math.abs((j+3*Math.PI)%(2*Math.PI)-Math.PI),T.push({distance:E,angleDelta:j}),k+=j;E-T[0].distance>p;)k-=T.shift().angleDelta;if(k>m)return!1;w++,E+=D.dist(F)}return!0}function wv(u){let o=0;for(let c=0;c<u.length-1;c++)o+=u[c].dist(u[c+1]);return o}function Sv(u,o,c){return u?.6*o*c:0}function Ev(u,o){return Math.max(u?u.right-u.left:0,o?o.right-o.left:0)}function sS(u,o,c,p,m,v){const w=Sv(c,m,v),E=Ev(c,p)*v;let T=0;const k=wv(u)/2;for(let D=0;D<u.length-1;D++){const F=u[D],j=u[D+1],X=F.dist(j);if(T+X>k){const H=(k-T)/X,tt=Ro.number(F.x,j.x,H),lt=Ro.number(F.y,j.y,H),ht=new Su(tt,lt,j.angleTo(F),D);return ht._round(),!w||xv(u,ht,E,w,o)?ht:void 0}T+=X}}function aS(u,o,c,p,m,v,w,E,T){const k=Sv(p,v,w),D=Ev(p,m),F=D*w,j=u[0].x===0||u[0].x===T||u[0].y===0||u[0].y===T;return o-F<o/4&&(o=F+o/4),Iv(u,j?o/2*E%o:(D/2+2*v)*w*E%o,o,k,c,F,j,!1,T)}function Iv(u,o,c,p,m,v,w,E,T){const k=v/2,D=wv(u);let F=0,j=o-c,X=[];for(let H=0;H<u.length-1;H++){const tt=u[H],lt=u[H+1],ht=tt.dist(lt),At=lt.angleTo(tt);for(;j+c<F+ht;){j+=c;const Et=(j-F)/ht,Nt=Ro.number(tt.x,lt.x,Et),Ft=Ro.number(tt.y,lt.y,Et);if(Nt>=0&&Nt<T&&Ft>=0&&Ft<T&&j-k>=0&&j+k<=D){const Jt=new Su(Nt,Ft,At,H);Jt._round(),p&&!xv(u,Jt,v,p,m)||X.push(Jt)}}F+=ht}return E||X.length||w||(X=Iv(u,F/2,c,p,m,v,w,!0,T)),X}xe("Anchor",Su);const Sh=Vo;function Cv(u,o,c,p){const m=[],v=u.image,w=v.pixelRatio,E=v.paddedRect.w-2*Sh,T=v.paddedRect.h-2*Sh,k=u.right-u.left,D=u.bottom-u.top,F=v.stretchX||[[0,E]],j=v.stretchY||[[0,T]],X=(ue,we)=>ue+we[1]-we[0],H=F.reduce(X,0),tt=j.reduce(X,0),lt=E-H,ht=T-tt;let At=0,Et=H,Nt=0,Ft=tt,Jt=0,ve=lt,Me=0,_e=ht;if(v.content&&p){const ue=v.content;At=wm(F,0,ue[0]),Nt=wm(j,0,ue[1]),Et=wm(F,ue[0],ue[2]),Ft=wm(j,ue[1],ue[3]),Jt=ue[0]-At,Me=ue[1]-Nt,ve=ue[2]-ue[0]-Et,_e=ue[3]-ue[1]-Ft}const de=(ue,we,he,ie)=>{const Be=Sm(ue.stretch-At,Et,k,u.left),Ae=Em(ue.fixed-Jt,ve,ue.stretch,H),dn=Sm(we.stretch-Nt,Ft,D,u.top),mi=Em(we.fixed-Me,_e,we.stretch,tt),bi=Sm(he.stretch-At,Et,k,u.left),gr=Em(he.fixed-Jt,ve,he.stretch,H),hs=Sm(ie.stretch-Nt,Ft,D,u.top),So=Em(ie.fixed-Me,_e,ie.stretch,tt),or=new A(Be,dn),zr=new A(bi,dn),Xr=new A(bi,hs),Eo=new A(Be,hs),Io=new A(Ae/w,mi/w),_r=new A(gr/w,So/w),yr=o*Math.PI/180;if(yr){const uo=Math.sin(yr),Uo=Math.cos(yr),Go=[Uo,-uo,uo,Uo];or._matMult(Go),zr._matMult(Go),Eo._matMult(Go),Xr._matMult(Go)}const lo=ue.stretch+ue.fixed,Co=we.stretch+we.fixed;return{tl:or,tr:zr,bl:Eo,br:Xr,tex:{x:v.paddedRect.x+Sh+lo,y:v.paddedRect.y+Sh+Co,w:he.stretch+he.fixed-lo,h:ie.stretch+ie.fixed-Co},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Io,pixelOffsetBR:_r,minFontScaleX:ve/w/k,minFontScaleY:_e/w/D,isSDF:c}};if(p&&(v.stretchX||v.stretchY)){const ue=Tv(F,lt,H),we=Tv(j,ht,tt);for(let he=0;he<ue.length-1;he++){const ie=ue[he],Be=ue[he+1];for(let Ae=0;Ae<we.length-1;Ae++)m.push(de(ie,we[Ae],Be,we[Ae+1]))}}else m.push(de({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:E+1},{fixed:0,stretch:T+1}));return m}function wm(u,o,c){let p=0;for(const m of u)p+=Math.max(o,Math.min(c,m[1]))-Math.max(o,Math.min(c,m[0]));return p}function Tv(u,o,c){const p=[{fixed:-Sh,stretch:0}];for(const[m,v]of u){const w=p[p.length-1];p.push({fixed:m-w.stretch,stretch:w.stretch}),p.push({fixed:m-w.stretch,stretch:w.stretch+(v-m)})}return p.push({fixed:o+Sh,stretch:c}),p}function Sm(u,o,c,p){return u/o*c+p}function Em(u,o,c,p){return u-o*c/p}class Im{constructor(o,c,p,m,v,w,E,T,k,D){if(this.boxStartIndex=o.length,k){let F=w.top,j=w.bottom;const X=w.collisionPadding;X&&(F-=X[1],j+=X[3]);let H=j-F;H>0&&(H=Math.max(10,H),this.circleDiameter=H)}else{let F=w.top*E-T[0],j=w.bottom*E+T[2],X=w.left*E-T[3],H=w.right*E+T[1];const tt=w.collisionPadding;if(tt&&(X-=tt[0]*E,F-=tt[1]*E,H+=tt[2]*E,j+=tt[3]*E),D){const lt=new A(X,F),ht=new A(H,F),At=new A(X,j),Et=new A(H,j),Nt=D*Math.PI/180;lt._rotate(Nt),ht._rotate(Nt),At._rotate(Nt),Et._rotate(Nt),X=Math.min(lt.x,ht.x,At.x,Et.x),H=Math.max(lt.x,ht.x,At.x,Et.x),F=Math.min(lt.y,ht.y,At.y,Et.y),j=Math.max(lt.y,ht.y,At.y,Et.y)}o.emplaceBack(c.x,c.y,X,F,H,j,p,m,v)}this.boxEndIndex=o.length}}class lS{constructor(o=[],c=uS){if(this.data=o,this.length=this.data.length,this.compare=c,this.length>0)for(let p=(this.length>>1)-1;p>=0;p--)this._down(p)}push(o){this.data.push(o),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const o=this.data[0],c=this.data.pop();return this.length--,this.length>0&&(this.data[0]=c,this._down(0)),o}peek(){return this.data[0]}_up(o){const{data:c,compare:p}=this,m=c[o];for(;o>0;){const v=o-1>>1,w=c[v];if(p(m,w)>=0)break;c[o]=w,o=v}c[o]=m}_down(o){const{data:c,compare:p}=this,m=this.length>>1,v=c[o];for(;o<m;){let w=1+(o<<1),E=c[w];const T=w+1;if(T<this.length&&p(c[T],E)<0&&(w=T,E=c[T]),p(E,v)>=0)break;c[o]=E,o=w}c[o]=v}}function uS(u,o){return u<o?-1:u>o?1:0}function cS(u,o=1,c=!1){let p=1/0,m=1/0,v=-1/0,w=-1/0;const E=u[0];for(let X=0;X<E.length;X++){const H=E[X];(!X||H.x<p)&&(p=H.x),(!X||H.y<m)&&(m=H.y),(!X||H.x>v)&&(v=H.x),(!X||H.y>w)&&(w=H.y)}const T=Math.min(v-p,w-m);let k=T/2;const D=new lS([],hS);if(T===0)return new A(p,m);for(let X=p;X<v;X+=T)for(let H=m;H<w;H+=T)D.push(new Eh(X+k,H+k,k,u));let F=function(X){let H=0,tt=0,lt=0;const ht=X[0];for(let At=0,Et=ht.length,Nt=Et-1;At<Et;Nt=At++){const Ft=ht[At],Jt=ht[Nt],ve=Ft.x*Jt.y-Jt.x*Ft.y;tt+=(Ft.x+Jt.x)*ve,lt+=(Ft.y+Jt.y)*ve,H+=3*ve}return new Eh(tt/H,lt/H,0,X)}(u),j=D.length;for(;D.length;){const X=D.pop();(X.d>F.d||!F.d)&&(F=X,c&&console.log("found best %d after %d probes",Math.round(1e4*X.d)/1e4,j)),X.max-F.d<=o||(k=X.h/2,D.push(new Eh(X.p.x-k,X.p.y-k,k,u)),D.push(new Eh(X.p.x+k,X.p.y-k,k,u)),D.push(new Eh(X.p.x-k,X.p.y+k,k,u)),D.push(new Eh(X.p.x+k,X.p.y+k,k,u)),j+=4)}return c&&(console.log(`num probes: ${j}`),console.log(`best distance: ${F.d}`)),F.p}function hS(u,o){return o.max-u.max}function Eh(u,o,c,p){this.p=new A(u,o),this.h=c,this.d=function(m,v){let w=!1,E=1/0;for(let T=0;T<v.length;T++){const k=v[T];for(let D=0,F=k.length,j=F-1;D<F;j=D++){const X=k[D],H=k[j];X.y>m.y!=H.y>m.y&&m.x<(H.x-X.x)*(m.y-X.y)/(H.y-X.y)+X.x&&(w=!w),E=Math.min(E,u0(m,X,H))}}return(w?1:-1)*Math.sqrt(E)}(this.p,p),this.max=this.d+this.h*Math.SQRT2}var Wr;a.aq=void 0,(Wr=a.aq||(a.aq={}))[Wr.center=1]="center",Wr[Wr.left=2]="left",Wr[Wr.right=3]="right",Wr[Wr.top=4]="top",Wr[Wr.bottom=5]="bottom",Wr[Wr["top-left"]=6]="top-left",Wr[Wr["top-right"]=7]="top-right",Wr[Wr["bottom-left"]=8]="bottom-left",Wr[Wr["bottom-right"]=9]="bottom-right";const Eu=7,A_=Number.POSITIVE_INFINITY;function Lv(u,o){return o[1]!==A_?function(c,p,m){let v=0,w=0;switch(p=Math.abs(p),m=Math.abs(m),c){case"top-right":case"top-left":case"top":w=m-Eu;break;case"bottom-right":case"bottom-left":case"bottom":w=-m+Eu}switch(c){case"top-right":case"bottom-right":case"right":v=-p;break;case"top-left":case"bottom-left":case"left":v=p}return[v,w]}(u,o[0],o[1]):function(c,p){let m=0,v=0;p<0&&(p=0);const w=p/Math.SQRT2;switch(c){case"top-right":case"top-left":v=w-Eu;break;case"bottom-right":case"bottom-left":v=-w+Eu;break;case"bottom":v=-p+Eu;break;case"top":v=p-Eu}switch(c){case"top-right":case"bottom-right":m=-w;break;case"top-left":case"bottom-left":m=w;break;case"left":m=p;break;case"right":m=-p}return[m,v]}(u,o[0])}function Mv(u,o,c){var p;const m=u.layout,v=(p=m.get("text-variable-anchor-offset"))===null||p===void 0?void 0:p.evaluate(o,{},c);if(v){const E=v.values,T=[];for(let k=0;k<E.length;k+=2){const D=T[k]=E[k],F=E[k+1].map(j=>j*mr);D.startsWith("top")?F[1]-=Eu:D.startsWith("bottom")&&(F[1]+=Eu),T[k+1]=F}return new os(T)}const w=m.get("text-variable-anchor");if(w){let E;E=u._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[m.get("text-radial-offset").evaluate(o,{},c)*mr,A_]:m.get("text-offset").evaluate(o,{},c).map(k=>k*mr);const T=[];for(const k of w)T.push(k,Lv(k,E));return new os(T)}return null}function N_(u){switch(u){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function fS(u,o,c,p,m,v,w,E,T,k,D){let F=v.textMaxSize.evaluate(o,{});F===void 0&&(F=w);const j=u.layers[0].layout,X=j.get("icon-offset").evaluate(o,{},D),H=kv(c.horizontal),tt=w/24,lt=u.tilePixelRatio*tt,ht=u.tilePixelRatio*F/24,At=u.tilePixelRatio*E,Et=u.tilePixelRatio*j.get("symbol-spacing"),Nt=j.get("text-padding")*u.tilePixelRatio,Ft=function(ie,Be,Ae,dn=1){const mi=ie.get("icon-padding").evaluate(Be,{},Ae),bi=mi&&mi.values;return[bi[0]*dn,bi[1]*dn,bi[2]*dn,bi[3]*dn]}(j,o,D,u.tilePixelRatio),Jt=j.get("text-max-angle")/180*Math.PI,ve=j.get("text-rotation-alignment")!=="viewport"&&j.get("symbol-placement")!=="point",Me=j.get("icon-rotation-alignment")==="map"&&j.get("symbol-placement")!=="point",_e=j.get("symbol-placement"),de=Et/2,ue=j.get("icon-text-fit");let we;p&&ue!=="none"&&(u.allowVerticalPlacement&&c.vertical&&(we=Q0(p,c.vertical,ue,j.get("icon-text-fit-padding"),X,tt)),H&&(p=Q0(p,H,ue,j.get("icon-text-fit-padding"),X,tt)));const he=(ie,Be)=>{Be.x<0||Be.x>=rr||Be.y<0||Be.y>=rr||function(Ae,dn,mi,bi,gr,hs,So,or,zr,Xr,Eo,Io,_r,yr,lo,Co,uo,Uo,Go,vr,Sn,co,Hr,br,Ys){const ka=Ae.addToLineVertexArray(dn,mi);let Aa,Ol,Ks,Cs,jo=0,zl=0,bp=0,Rv=0,U_=-1,G_=-1;const Fl={};let Ov=Al("");if(Ae.allowVerticalPlacement&&bi.vertical){const ho=or.layout.get("text-rotate").evaluate(Sn,{},br)+90;Ks=new Im(zr,dn,Xr,Eo,Io,bi.vertical,_r,yr,lo,ho),So&&(Cs=new Im(zr,dn,Xr,Eo,Io,So,uo,Uo,lo,ho))}if(gr){const ho=or.layout.get("icon-rotate").evaluate(Sn,{}),Ts=or.layout.get("icon-text-fit")!=="none",pc=Cv(gr,ho,Hr,Ts),Da=So?Cv(So,ho,Hr,Ts):void 0;Ol=new Im(zr,dn,Xr,Eo,Io,gr,uo,Uo,!1,ho),jo=4*pc.length;const dc=Ae.iconSizeData;let rl=null;dc.kind==="source"?(rl=[il*or.layout.get("icon-size").evaluate(Sn,{})],rl[0]>xu&&kt(`${Ae.layerIds[0]}: Value for "icon-size" is >= ${gp}. Reduce your "icon-size".`)):dc.kind==="composite"&&(rl=[il*co.compositeIconSizes[0].evaluate(Sn,{},br),il*co.compositeIconSizes[1].evaluate(Sn,{},br)],(rl[0]>xu||rl[1]>xu)&&kt(`${Ae.layerIds[0]}: Value for "icon-size" is >= ${gp}. Reduce your "icon-size".`)),Ae.addSymbols(Ae.icon,pc,rl,vr,Go,Sn,a.ai.none,dn,ka.lineStartIndex,ka.lineLength,-1,br),U_=Ae.icon.placedSymbolArray.length-1,Da&&(zl=4*Da.length,Ae.addSymbols(Ae.icon,Da,rl,vr,Go,Sn,a.ai.vertical,dn,ka.lineStartIndex,ka.lineLength,-1,br),G_=Ae.icon.placedSymbolArray.length-1)}const zv=Object.keys(bi.horizontal);for(const ho of zv){const Ts=bi.horizontal[ho];if(!Aa){Ov=Al(Ts.text);const Da=or.layout.get("text-rotate").evaluate(Sn,{},br);Aa=new Im(zr,dn,Xr,Eo,Io,Ts,_r,yr,lo,Da)}const pc=Ts.positionedLines.length===1;if(bp+=Pv(Ae,dn,Ts,hs,or,lo,Sn,Co,ka,bi.vertical?a.ai.horizontal:a.ai.horizontalOnly,pc?zv:[ho],Fl,U_,co,br),pc)break}bi.vertical&&(Rv+=Pv(Ae,dn,bi.vertical,hs,or,lo,Sn,Co,ka,a.ai.vertical,["vertical"],Fl,G_,co,br));const mS=Aa?Aa.boxStartIndex:Ae.collisionBoxArray.length,gS=Aa?Aa.boxEndIndex:Ae.collisionBoxArray.length,_S=Ks?Ks.boxStartIndex:Ae.collisionBoxArray.length,yS=Ks?Ks.boxEndIndex:Ae.collisionBoxArray.length,vS=Ol?Ol.boxStartIndex:Ae.collisionBoxArray.length,bS=Ol?Ol.boxEndIndex:Ae.collisionBoxArray.length,xS=Cs?Cs.boxStartIndex:Ae.collisionBoxArray.length,wS=Cs?Cs.boxEndIndex:Ae.collisionBoxArray.length;let Na=-1;const Tm=(ho,Ts)=>ho&&ho.circleDiameter?Math.max(ho.circleDiameter,Ts):Ts;Na=Tm(Aa,Na),Na=Tm(Ks,Na),Na=Tm(Ol,Na),Na=Tm(Cs,Na);const Fv=Na>-1?1:0;Fv&&(Na*=Ys/mr),Ae.glyphOffsetArray.length>=wh.MAX_GLYPHS&&kt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Sn.sortKey!==void 0&&Ae.addToSortKeyRanges(Ae.symbolInstances.length,Sn.sortKey);const SS=Mv(or,Sn,br),[ES,IS]=function(ho,Ts){const pc=ho.length,Da=Ts==null?void 0:Ts.values;if((Da==null?void 0:Da.length)>0)for(let dc=0;dc<Da.length;dc+=2){const rl=Da[dc+1];ho.emplaceBack(a.aq[Da[dc]],rl[0],rl[1])}return[pc,ho.length]}(Ae.textAnchorOffsets,SS);Ae.symbolInstances.emplaceBack(dn.x,dn.y,Fl.right>=0?Fl.right:-1,Fl.center>=0?Fl.center:-1,Fl.left>=0?Fl.left:-1,Fl.vertical||-1,U_,G_,Ov,mS,gS,_S,yS,vS,bS,xS,wS,Xr,bp,Rv,jo,zl,Fv,0,_r,Na,ES,IS)}(u,Be,ie,c,p,m,we,u.layers[0],u.collisionBoxArray,o.index,o.sourceLayerIndex,u.index,lt,[Nt,Nt,Nt,Nt],ve,T,At,Ft,Me,X,o,v,k,D,w)};if(_e==="line")for(const ie of bv(o.geometry,0,0,rr,rr)){const Be=aS(ie,Et,Jt,c.vertical||H,p,24,ht,u.overscaling,rr);for(const Ae of Be)H&&pS(u,H.text,de,Ae)||he(ie,Ae)}else if(_e==="line-center"){for(const ie of o.geometry)if(ie.length>1){const Be=sS(ie,Jt,c.vertical||H,p,24,ht);Be&&he(ie,Be)}}else if(o.type==="Polygon")for(const ie of h_(o.geometry,0)){const Be=cS(ie,16);he(ie[0],new Su(Be.x,Be.y,0))}else if(o.type==="LineString")for(const ie of o.geometry)he(ie,new Su(ie[0].x,ie[0].y,0));else if(o.type==="Point")for(const ie of o.geometry)for(const Be of ie)he([Be],new Su(Be.x,Be.y,0))}function Pv(u,o,c,p,m,v,w,E,T,k,D,F,j,X,H){const tt=function(At,Et,Nt,Ft,Jt,ve,Me,_e){const de=Ft.layout.get("text-rotate").evaluate(ve,{})*Math.PI/180,ue=[];for(const we of Et.positionedLines)for(const he of we.positionedGlyphs){if(!he.rect)continue;const ie=he.rect||{};let Be=$0+1,Ae=!0,dn=1,mi=0;const bi=(Jt||_e)&&he.vertical,gr=he.metrics.advance*he.scale/2;if(_e&&Et.verticalizable&&(mi=we.lineOffset/2-(he.imageName?-(mr-he.metrics.width*he.scale)/2:(he.scale-1)*mr)),he.imageName){const vr=Me[he.imageName];Ae=vr.sdf,dn=vr.pixelRatio,Be=Vo/dn}const hs=Jt?[he.x+gr,he.y]:[0,0];let So=Jt?[0,0]:[he.x+gr+Nt[0],he.y+Nt[1]-mi],or=[0,0];bi&&(or=So,So=[0,0]);const zr=he.metrics.isDoubleResolution?2:1,Xr=(he.metrics.left-Be)*he.scale-gr+So[0],Eo=(-he.metrics.top-Be)*he.scale+So[1],Io=Xr+ie.w/zr*he.scale/dn,_r=Eo+ie.h/zr*he.scale/dn,yr=new A(Xr,Eo),lo=new A(Io,Eo),Co=new A(Xr,_r),uo=new A(Io,_r);if(bi){const vr=new A(-gr,gr-dp),Sn=-Math.PI/2,co=mr/2-gr,Hr=new A(5-dp-co,-(he.imageName?co:0)),br=new A(...or);yr._rotateAround(Sn,vr)._add(Hr)._add(br),lo._rotateAround(Sn,vr)._add(Hr)._add(br),Co._rotateAround(Sn,vr)._add(Hr)._add(br),uo._rotateAround(Sn,vr)._add(Hr)._add(br)}if(de){const vr=Math.sin(de),Sn=Math.cos(de),co=[Sn,-vr,vr,Sn];yr._matMult(co),lo._matMult(co),Co._matMult(co),uo._matMult(co)}const Uo=new A(0,0),Go=new A(0,0);ue.push({tl:yr,tr:lo,bl:Co,br:uo,tex:ie,writingMode:Et.writingMode,glyphOffset:hs,sectionIndex:he.sectionIndex,isSDF:Ae,pixelOffsetTL:Uo,pixelOffsetBR:Go,minFontScaleX:0,minFontScaleY:0})}return ue}(0,c,E,m,v,w,p,u.allowVerticalPlacement),lt=u.textSizeData;let ht=null;lt.kind==="source"?(ht=[il*m.layout.get("text-size").evaluate(w,{})],ht[0]>xu&&kt(`${u.layerIds[0]}: Value for "text-size" is >= ${gp}. Reduce your "text-size".`)):lt.kind==="composite"&&(ht=[il*X.compositeTextSizes[0].evaluate(w,{},H),il*X.compositeTextSizes[1].evaluate(w,{},H)],(ht[0]>xu||ht[1]>xu)&&kt(`${u.layerIds[0]}: Value for "text-size" is >= ${gp}. Reduce your "text-size".`)),u.addSymbols(u.text,tt,ht,E,v,w,k,o,T.lineStartIndex,T.lineLength,j,H);for(const At of D)F[At]=u.text.placedSymbolArray.length-1;return 4*tt.length}function kv(u){for(const o in u)return u[o];return null}function pS(u,o,c,p){const m=u.compareText;if(o in m){const v=m[o];for(let w=v.length-1;w>=0;w--)if(p.dist(v[w])<c)return!0}else m[o]=[];return m[o].push(p),!1}const Av=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class D_{static from(o){if(!(o instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[c,p]=new Uint8Array(o,0,2);if(c!==219)throw new Error("Data does not appear to be in a KDBush format.");const m=p>>4;if(m!==1)throw new Error(`Got v${m} data when expected v1.`);const v=Av[15&p];if(!v)throw new Error("Unrecognized array type.");const[w]=new Uint16Array(o,2,1),[E]=new Uint32Array(o,4,1);return new D_(E,w,v,o)}constructor(o,c=64,p=Float64Array,m){if(isNaN(o)||o<0)throw new Error(`Unpexpected numItems value: ${o}.`);this.numItems=+o,this.nodeSize=Math.min(Math.max(+c,2),65535),this.ArrayType=p,this.IndexArrayType=o<65536?Uint16Array:Uint32Array;const v=Av.indexOf(this.ArrayType),w=2*o*this.ArrayType.BYTES_PER_ELEMENT,E=o*this.IndexArrayType.BYTES_PER_ELEMENT,T=(8-E%8)%8;if(v<0)throw new Error(`Unexpected typed array class: ${p}.`);m&&m instanceof ArrayBuffer?(this.data=m,this.ids=new this.IndexArrayType(this.data,8,o),this.coords=new this.ArrayType(this.data,8+E+T,2*o),this._pos=2*o,this._finished=!0):(this.data=new ArrayBuffer(8+w+E+T),this.ids=new this.IndexArrayType(this.data,8,o),this.coords=new this.ArrayType(this.data,8+E+T,2*o),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+v]),new Uint16Array(this.data,2,1)[0]=c,new Uint32Array(this.data,4,1)[0]=o)}add(o,c){const p=this._pos>>1;return this.ids[p]=p,this.coords[this._pos++]=o,this.coords[this._pos++]=c,p}finish(){const o=this._pos>>1;if(o!==this.numItems)throw new Error(`Added ${o} items when expected ${this.numItems}.`);return R_(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(o,c,p,m){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:v,coords:w,nodeSize:E}=this,T=[0,v.length-1,0],k=[];for(;T.length;){const D=T.pop()||0,F=T.pop()||0,j=T.pop()||0;if(F-j<=E){for(let lt=j;lt<=F;lt++){const ht=w[2*lt],At=w[2*lt+1];ht>=o&&ht<=p&&At>=c&&At<=m&&k.push(v[lt])}continue}const X=j+F>>1,H=w[2*X],tt=w[2*X+1];H>=o&&H<=p&&tt>=c&&tt<=m&&k.push(v[X]),(D===0?o<=H:c<=tt)&&(T.push(j),T.push(X-1),T.push(1-D)),(D===0?p>=H:m>=tt)&&(T.push(X+1),T.push(F),T.push(1-D))}return k}within(o,c,p){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:m,coords:v,nodeSize:w}=this,E=[0,m.length-1,0],T=[],k=p*p;for(;E.length;){const D=E.pop()||0,F=E.pop()||0,j=E.pop()||0;if(F-j<=w){for(let lt=j;lt<=F;lt++)Dv(v[2*lt],v[2*lt+1],o,c)<=k&&T.push(m[lt]);continue}const X=j+F>>1,H=v[2*X],tt=v[2*X+1];Dv(H,tt,o,c)<=k&&T.push(m[X]),(D===0?o-p<=H:c-p<=tt)&&(E.push(j),E.push(X-1),E.push(1-D)),(D===0?o+p>=H:c+p>=tt)&&(E.push(X+1),E.push(F),E.push(1-D))}return T}}function R_(u,o,c,p,m,v){if(m-p<=c)return;const w=p+m>>1;Nv(u,o,w,p,m,v),R_(u,o,c,p,w-1,1-v),R_(u,o,c,w+1,m,1-v)}function Nv(u,o,c,p,m,v){for(;m>p;){if(m-p>600){const k=m-p+1,D=c-p+1,F=Math.log(k),j=.5*Math.exp(2*F/3),X=.5*Math.sqrt(F*j*(k-j)/k)*(D-k/2<0?-1:1);Nv(u,o,c,Math.max(p,Math.floor(c-D*j/k+X)),Math.min(m,Math.floor(c+(k-D)*j/k+X)),v)}const w=o[2*c+v];let E=p,T=m;for(yp(u,o,p,c),o[2*m+v]>w&&yp(u,o,p,m);E<T;){for(yp(u,o,E,T),E++,T--;o[2*E+v]<w;)E++;for(;o[2*T+v]>w;)T--}o[2*p+v]===w?yp(u,o,p,T):(T++,yp(u,o,T,m)),T<=c&&(p=T+1),c<=T&&(m=T-1)}}function yp(u,o,c,p){O_(u,c,p),O_(o,2*c,2*p),O_(o,2*c+1,2*p+1)}function O_(u,o,c){const p=u[o];u[o]=u[c],u[c]=p}function Dv(u,o,c,p){const m=u-c,v=o-p;return m*m+v*v}var z_;a.bh=void 0,(z_=a.bh||(a.bh={})).create="create",z_.load="load",z_.fullLoad="fullLoad";let Cm=null,vp=[];const F_=1e3/60,B_="loadTime",V_="fullLoadTime",dS={mark(u){performance.mark(u)},frame(u){const o=u;Cm!=null&&vp.push(o-Cm),Cm=o},clearMetrics(){Cm=null,vp=[],performance.clearMeasures(B_),performance.clearMeasures(V_);for(const u in a.bh)performance.clearMarks(a.bh[u])},getPerformanceMetrics(){performance.measure(B_,a.bh.create,a.bh.load),performance.measure(V_,a.bh.create,a.bh.fullLoad);const u=performance.getEntriesByName(B_)[0].duration,o=performance.getEntriesByName(V_)[0].duration,c=vp.length,p=1/(vp.reduce((v,w)=>v+w,0)/c/1e3),m=vp.filter(v=>v>F_).reduce((v,w)=>v+(w-F_)/F_,0);return{loadTime:u,fullLoadTime:o,fps:p,percentDroppedFrames:m/(c+m)*100,totalFrames:c}}};a.$=function(u,o,c){var p,m,v,w,E,T,k,D,F,j,X,H,tt=c[0],lt=c[1],ht=c[2];return o===u?(u[12]=o[0]*tt+o[4]*lt+o[8]*ht+o[12],u[13]=o[1]*tt+o[5]*lt+o[9]*ht+o[13],u[14]=o[2]*tt+o[6]*lt+o[10]*ht+o[14],u[15]=o[3]*tt+o[7]*lt+o[11]*ht+o[15]):(m=o[1],v=o[2],w=o[3],E=o[4],T=o[5],k=o[6],D=o[7],F=o[8],j=o[9],X=o[10],H=o[11],u[0]=p=o[0],u[1]=m,u[2]=v,u[3]=w,u[4]=E,u[5]=T,u[6]=k,u[7]=D,u[8]=F,u[9]=j,u[10]=X,u[11]=H,u[12]=p*tt+E*lt+F*ht+o[12],u[13]=m*tt+T*lt+j*ht+o[13],u[14]=v*tt+k*lt+X*ht+o[14],u[15]=w*tt+D*lt+H*ht+o[15]),u},a.A=gh,a.B=Ro,a.C=class{constructor(u,o,c){this.receive=p=>{const m=p.data,v=m.id;if(v&&(!m.targetMapId||this.mapId===m.targetMapId))if(m.type==="<cancel>"){delete this.tasks[v];const w=this.cancelCallbacks[v];delete this.cancelCallbacks[v],w&&w()}else se()||m.mustQueue?(this.tasks[v]=m,this.taskQueue.push(v),this.invoker.trigger()):this.processTask(v,m)},this.process=()=>{if(!this.taskQueue.length)return;const p=this.taskQueue.shift(),m=this.tasks[p];delete this.tasks[p],this.taskQueue.length&&this.invoker.trigger(),m&&this.processTask(p,m)},this.target=u,this.parent=o,this.mapId=c,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},this.invoker=new rS(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=se()?u:window}send(u,o,c,p,m=!1){const v=Math.round(1e18*Math.random()).toString(36).substring(0,10);c&&(this.callbacks[v]=c);const w=[],E={id:v,type:u,hasCallback:!!c,targetMapId:p,mustQueue:m,sourceMapId:this.mapId,data:tl(o,w)};return this.target.postMessage(E,{transfer:w}),{cancel:()=>{c&&delete this.callbacks[v],this.target.postMessage({id:v,type:"<cancel>",targetMapId:p,sourceMapId:this.mapId})}}}processTask(u,o){if(o.type==="<response>"){const c=this.callbacks[u];delete this.callbacks[u],c&&(o.error?c(mu(o.error)):c(null,mu(o.data)))}else{let c=!1;const p=[],m=o.hasCallback?(E,T)=>{c=!0,delete this.cancelCallbacks[u];const k={id:u,type:"<response>",sourceMapId:this.mapId,error:E?tl(E):null,data:tl(T,p)};this.target.postMessage(k,{transfer:p})}:E=>{c=!0};let v=null;const w=mu(o.data);if(this.parent[o.type])v=this.parent[o.type](o.sourceMapId,w,m);else if("getWorkerSource"in this.parent){const E=o.type.split(".");v=this.parent.getWorkerSource(o.sourceMapId,E[0],w.source)[E[1]](w,m)}else m(new Error(`Could not find function ${o.type}`));!c&&v&&v.cancel&&(this.cancelCallbacks[u]=v.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}},a.D=Re,a.E=Wi,a.F=function(u,o){const c={};for(let p=0;p<o.length;p++){const m=o[p];m in u&&(c[m]=u[m])}return c},a.G=lv,a.H=uv,a.I=x_,a.J=V,a.K=$,a.L=wu,a.M=Qe,a.N=rr,a.O=Is,a.P=A,a.Q=Ti,a.R=Es,a.S=di,a.T=em,a.U=xm,a.V=class extends Pl{},a.W=k_,a.X=function(u,o){const c=window.document.createElement("video");c.muted=!0,c.onloadstart=function(){o(null,c)};for(let p=0;p<u.length;p++){const m=window.document.createElement("source");Ee(u[p])||(c.crossOrigin="Anonymous"),m.src=u[p],c.appendChild(m)}return{cancel:()=>{}}},a.Y=le,a.Z=function(){var u=new gh(16);return gh!=Float32Array&&(u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[11]=0,u[12]=0,u[13]=0,u[14]=0),u[0]=1,u[5]=1,u[10]=1,u[15]=1,u},a._=_,a.a=yn,a.a$=class extends W{},a.a0=function(u,o,c){var p=c[0],m=c[1],v=c[2];return u[0]=o[0]*p,u[1]=o[1]*p,u[2]=o[2]*p,u[3]=o[3]*p,u[4]=o[4]*m,u[5]=o[5]*m,u[6]=o[6]*m,u[7]=o[7]*m,u[8]=o[8]*v,u[9]=o[9]*v,u[10]=o[10]*v,u[11]=o[11]*v,u[12]=o[12],u[13]=o[13],u[14]=o[14],u[15]=o[15],u},a.a1=p0,a.a2=function(){return ut++},a.a3=at,a.a4=wh,a.a5=function(){Fo.isLoading()||Fo.isLoaded()||Wf()!=="deferred"||tm()},a.a6=Of,a.a7=hc,a.a8=pi,a.a9=gv,a.aA=oc,a.aB=function(u){u=u.slice();const o=Object.create(null);for(let c=0;c<u.length;c++)o[u[c].id]=u[c];for(let c=0;c<u.length;c++)"ref"in u[c]&&(u[c]=fr(u[c],o[u[c].ref]));return u},a.aC=function(u){if(u.type==="custom")return new iS(u);switch(u.type){case"background":return new tS(u);case"circle":return new Bw(u);case"fill":return new o2(u);case"fill-extrusion":return new b2(u);case"heatmap":return new Uw(u);case"hillshade":return new jw(u);case"line":return new L2(u);case"raster":return new nS(u);case"symbol":return new bm(u)}},a.aD=vt,a.aE=function(u,o){if(!u)return[{command:In.setStyle,args:[o]}];let c=[];try{if(!zn(u.version,o.version))return[{command:In.setStyle,args:[o]}];zn(u.center,o.center)||c.push({command:In.setCenter,args:[o.center]}),zn(u.zoom,o.zoom)||c.push({command:In.setZoom,args:[o.zoom]}),zn(u.bearing,o.bearing)||c.push({command:In.setBearing,args:[o.bearing]}),zn(u.pitch,o.pitch)||c.push({command:In.setPitch,args:[o.pitch]}),zn(u.sprite,o.sprite)||c.push({command:In.setSprite,args:[o.sprite]}),zn(u.glyphs,o.glyphs)||c.push({command:In.setGlyphs,args:[o.glyphs]}),zn(u.transition,o.transition)||c.push({command:In.setTransition,args:[o.transition]}),zn(u.light,o.light)||c.push({command:In.setLight,args:[o.light]});const p={},m=[];(function(w,E,T,k){let D;for(D in E=E||{},w=w||{})Object.prototype.hasOwnProperty.call(w,D)&&(Object.prototype.hasOwnProperty.call(E,D)||oo(D,T,k));for(D in E)Object.prototype.hasOwnProperty.call(E,D)&&(Object.prototype.hasOwnProperty.call(w,D)?zn(w[D],E[D])||(w[D].type==="geojson"&&E[D].type==="geojson"&&Ha(w,E,D)?T.push({command:In.setGeoJSONSourceData,args:[D,E[D].data]}):ns(D,E,T,k)):es(D,E,T))})(u.sources,o.sources,m,p);const v=[];u.layers&&u.layers.forEach(w=>{p[w.source]?c.push({command:In.removeLayer,args:[w.id]}):v.push(w)}),c=c.concat(m),function(w,E,T){E=E||[];const k=(w=w||[]).map(js),D=E.map(js),F=w.reduce(Sa,{}),j=E.reduce(Sa,{}),X=k.slice(),H=Object.create(null);let tt,lt,ht,At,Et,Nt,Ft;for(tt=0,lt=0;tt<k.length;tt++)ht=k[tt],Object.prototype.hasOwnProperty.call(j,ht)?lt++:(T.push({command:In.removeLayer,args:[ht]}),X.splice(X.indexOf(ht,lt),1));for(tt=0,lt=0;tt<D.length;tt++)ht=D[D.length-1-tt],X[X.length-1-tt]!==ht&&(Object.prototype.hasOwnProperty.call(F,ht)?(T.push({command:In.removeLayer,args:[ht]}),X.splice(X.lastIndexOf(ht,X.length-lt),1)):lt++,Nt=X[X.length-tt],T.push({command:In.addLayer,args:[j[ht],Nt]}),X.splice(X.length-tt,0,ht),H[ht]=!0);for(tt=0;tt<D.length;tt++)if(ht=D[tt],At=F[ht],Et=j[ht],!H[ht]&&!zn(At,Et))if(zn(At.source,Et.source)&&zn(At["source-layer"],Et["source-layer"])&&zn(At.type,Et.type)){for(Ft in Gs(At.layout,Et.layout,T,ht,null,In.setLayoutProperty),Gs(At.paint,Et.paint,T,ht,null,In.setPaintProperty),zn(At.filter,Et.filter)||T.push({command:In.setFilter,args:[ht,Et.filter]}),zn(At.minzoom,Et.minzoom)&&zn(At.maxzoom,Et.maxzoom)||T.push({command:In.setLayerZoomRange,args:[ht,Et.minzoom,Et.maxzoom]}),At)Object.prototype.hasOwnProperty.call(At,Ft)&&Ft!=="layout"&&Ft!=="paint"&&Ft!=="filter"&&Ft!=="metadata"&&Ft!=="minzoom"&&Ft!=="maxzoom"&&(Ft.indexOf("paint.")===0?Gs(At[Ft],Et[Ft],T,ht,Ft.slice(6),In.setPaintProperty):zn(At[Ft],Et[Ft])||T.push({command:In.setLayerProperty,args:[ht,Ft,Et[Ft]]}));for(Ft in Et)Object.prototype.hasOwnProperty.call(Et,Ft)&&!Object.prototype.hasOwnProperty.call(At,Ft)&&Ft!=="layout"&&Ft!=="paint"&&Ft!=="filter"&&Ft!=="metadata"&&Ft!=="minzoom"&&Ft!=="maxzoom"&&(Ft.indexOf("paint.")===0?Gs(At[Ft],Et[Ft],T,ht,Ft.slice(6),In.setPaintProperty):zn(At[Ft],Et[Ft])||T.push({command:In.setLayerProperty,args:[ht,Ft,Et[Ft]]}))}else T.push({command:In.removeLayer,args:[ht]}),Nt=X[X.lastIndexOf(ht)+1],T.push({command:In.addLayer,args:[Et,Nt]})}(v,o.layers,c)}catch(p){console.warn("Unable to compute style diff:",p),c=[{command:In.setStyle,args:[o]}]}return c},a.aF=function(u){const o=[],c=u.id;return c===void 0&&o.push({message:`layers.${c}: missing required property "id"`}),u.render===void 0&&o.push({message:`layers.${c}: missing required method "render"`}),u.renderingMode&&u.renderingMode!=="2d"&&u.renderingMode!=="3d"&&o.push({message:`layers.${c}: property "renderingMode" must be either "2d" or "3d"`}),o},a.aG=function u(o,c){if(Array.isArray(o)){if(!Array.isArray(c)||o.length!==c.length)return!1;for(let p=0;p<o.length;p++)if(!u(o[p],c[p]))return!1;return!0}if(typeof o=="object"&&o!==null&&c!==null){if(typeof c!="object"||Object.keys(o).length!==Object.keys(c).length)return!1;for(const p in o)if(!u(o[p],c[p]))return!1;return!0}return o===c},a.aH=St,a.aI=_t,a.aJ=sc,a.aK=function(u){return u({pluginStatus:bo,pluginURL:el}),sc.on("pluginStateChange",u),u},a.aL=class extends Nl{constructor(u,o){super(u,o),this.current=0}set(u){this.current!==u&&(this.current=u,this.gl.uniform1i(this.location,u))}},a.aM=dh,a.aN=class extends Nl{constructor(u,o){super(u,o),this.current=Qg}set(u){if(u[12]!==this.current[12]||u[0]!==this.current[0])return this.current=u,void this.gl.uniformMatrix4fv(this.location,!1,u);for(let o=1;o<16;o++)if(u[o]!==this.current[o]){this.current=u,this.gl.uniformMatrix4fv(this.location,!1,u);break}}},a.aO=om,a.aP=class extends Nl{constructor(u,o){super(u,o),this.current=[0,0,0]}set(u){u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]||(this.current=u,this.gl.uniform3f(this.location,u[0],u[1],u[2]))}},a.aQ=class extends Nl{constructor(u,o){super(u,o),this.current=[0,0]}set(u){u[0]===this.current[0]&&u[1]===this.current[1]||(this.current=u,this.gl.uniform2f(this.location,u[0],u[1]))}},a.aR=sm,a.aS=function(u,o,c,p,m,v,w){var E=1/(o-c),T=1/(p-m),k=1/(v-w);return u[0]=-2*E,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=-2*T,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=2*k,u[11]=0,u[12]=(o+c)*E,u[13]=(m+p)*T,u[14]=(w+v)*k,u[15]=1,u},a.aT=Xn,a.aU=Fw,a.aV=class extends d{},a.aW=A2,a.aX=class extends b{},a.aY=function(u){return u<=1?1:Math.pow(2,Math.ceil(Math.log(u)/Math.LN2))},a.aZ=y0,a.a_=ae,a.aa=function(u){const o={};if(u.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(c,p,m,v)=>{const w=m||v;return o[p]=!w||w.toLowerCase(),""}),o["max-age"]){const c=parseInt(o["max-age"],10);isNaN(c)?delete o["max-age"]:o["max-age"]=c}return o},a.ab=function(u,o){const c=[];for(const p in u)p in o||c.push(p);return c},a.ac=function(u){if(Ce==null){const o=u.navigator?u.navigator.userAgent:null;Ce=!!u.safari||!(!o||!(/\b(iPad|iPhone|iPod)\b/.test(o)||o.match("Safari")&&!o.match("Chrome")))}return Ce},a.ad=ft,a.ae=function(u,o,c){var p=Math.sin(c),m=Math.cos(c),v=o[0],w=o[1],E=o[2],T=o[3],k=o[4],D=o[5],F=o[6],j=o[7];return o!==u&&(u[8]=o[8],u[9]=o[9],u[10]=o[10],u[11]=o[11],u[12]=o[12],u[13]=o[13],u[14]=o[14],u[15]=o[15]),u[0]=v*m+k*p,u[1]=w*m+D*p,u[2]=E*m+F*p,u[3]=T*m+j*p,u[4]=k*m-v*p,u[5]=D*m-w*p,u[6]=F*m-E*p,u[7]=j*m-T*p,u},a.af=function(u){var o=new gh(16);return o[0]=u[0],o[1]=u[1],o[2]=u[2],o[3]=u[3],o[4]=u[4],o[5]=u[5],o[6]=u[6],o[7]=u[7],o[8]=u[8],o[9]=u[9],o[10]=u[10],o[11]=u[11],o[12]=u[12],o[13]=u[13],o[14]=u[14],o[15]=u[15],o},a.ag=cm,a.ah=function(u,o){let c=0,p=0;if(u.kind==="constant")p=u.layoutSize;else if(u.kind!=="source"){const{interpolationType:m,minZoom:v,maxZoom:w}=u,E=m?ft(Oo.interpolationFactor(m,o,v,w),0,1):0;u.kind==="camera"?p=Ro.number(u.minSize,u.maxSize,E):c=E}return{uSizeT:c,uSize:p}},a.aj=function(u,{uSize:o,uSizeT:c},{lowerSize:p,upperSize:m}){return u.kind==="source"?p/il:u.kind==="composite"?Ro.number(p/il,m/il,c):o},a.ak=I_,a.al=function(u,o,c,p){const m=o.y-u.y,v=o.x-u.x,w=p.y-c.y,E=p.x-c.x,T=w*v-E*m;if(T===0)return null;const k=(E*(u.y-c.y)-w*(u.x-c.x))/T;return new A(u.x+k*v,u.y+k*m)},a.am=bv,a.an=a0,a.ao=r_,a.ap=mr,a.ar=E_,a.as=function(u,o){var c=o[0],p=o[1],m=o[2],v=o[3],w=o[4],E=o[5],T=o[6],k=o[7],D=o[8],F=o[9],j=o[10],X=o[11],H=o[12],tt=o[13],lt=o[14],ht=o[15],At=c*E-p*w,Et=c*T-m*w,Nt=c*k-v*w,Ft=p*T-m*E,Jt=p*k-v*E,ve=m*k-v*T,Me=D*tt-F*H,_e=D*lt-j*H,de=D*ht-X*H,ue=F*lt-j*tt,we=F*ht-X*tt,he=j*ht-X*lt,ie=At*he-Et*we+Nt*ue+Ft*de-Jt*_e+ve*Me;return ie?(u[0]=(E*he-T*we+k*ue)*(ie=1/ie),u[1]=(m*we-p*he-v*ue)*ie,u[2]=(tt*ve-lt*Jt+ht*Ft)*ie,u[3]=(j*Jt-F*ve-X*Ft)*ie,u[4]=(T*de-w*he-k*_e)*ie,u[5]=(c*he-m*de+v*_e)*ie,u[6]=(lt*Nt-H*ve-ht*Et)*ie,u[7]=(D*ve-j*Nt+X*Et)*ie,u[8]=(w*we-E*de+k*Me)*ie,u[9]=(p*de-c*we-v*Me)*ie,u[10]=(H*Jt-tt*Nt+ht*At)*ie,u[11]=(F*Nt-D*Jt-X*At)*ie,u[12]=(E*_e-w*ue-T*Me)*ie,u[13]=(c*ue-p*_e+m*Me)*ie,u[14]=(tt*Et-H*Ft-lt*At)*ie,u[15]=(D*Ft-F*Et+j*At)*ie,u):null},a.at=N_,a.au=S_,a.av=D_,a.aw=function(){const u={},o=$t.$version;for(const c in $t.$root){const p=$t.$root[c];if(p.required){let m=null;m=c==="version"?o:p.type==="array"?[]:{},m!=null&&(u[c]=m)}}return u},a.ax=In,a.ay=Yd,a.az=hn,a.b=function(u,o){const c=new Blob([new Uint8Array(u)],{type:"image/png"});createImageBitmap(c).then(p=>{o(null,p)}).catch(p=>{o(new Error(`Could not load image because of ${p.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})},a.b0=Rr,a.b1=function(u,o){var c=u[0],p=u[1],m=u[2],v=u[3],w=u[4],E=u[5],T=u[6],k=u[7],D=u[8],F=u[9],j=u[10],X=u[11],H=u[12],tt=u[13],lt=u[14],ht=u[15],At=o[0],Et=o[1],Nt=o[2],Ft=o[3],Jt=o[4],ve=o[5],Me=o[6],_e=o[7],de=o[8],ue=o[9],we=o[10],he=o[11],ie=o[12],Be=o[13],Ae=o[14],dn=o[15];return Math.abs(c-At)<=wo*Math.max(1,Math.abs(c),Math.abs(At))&&Math.abs(p-Et)<=wo*Math.max(1,Math.abs(p),Math.abs(Et))&&Math.abs(m-Nt)<=wo*Math.max(1,Math.abs(m),Math.abs(Nt))&&Math.abs(v-Ft)<=wo*Math.max(1,Math.abs(v),Math.abs(Ft))&&Math.abs(w-Jt)<=wo*Math.max(1,Math.abs(w),Math.abs(Jt))&&Math.abs(E-ve)<=wo*Math.max(1,Math.abs(E),Math.abs(ve))&&Math.abs(T-Me)<=wo*Math.max(1,Math.abs(T),Math.abs(Me))&&Math.abs(k-_e)<=wo*Math.max(1,Math.abs(k),Math.abs(_e))&&Math.abs(D-de)<=wo*Math.max(1,Math.abs(D),Math.abs(de))&&Math.abs(F-ue)<=wo*Math.max(1,Math.abs(F),Math.abs(ue))&&Math.abs(j-we)<=wo*Math.max(1,Math.abs(j),Math.abs(we))&&Math.abs(X-he)<=wo*Math.max(1,Math.abs(X),Math.abs(he))&&Math.abs(H-ie)<=wo*Math.max(1,Math.abs(H),Math.abs(ie))&&Math.abs(tt-Be)<=wo*Math.max(1,Math.abs(tt),Math.abs(Be))&&Math.abs(lt-Ae)<=wo*Math.max(1,Math.abs(lt),Math.abs(Ae))&&Math.abs(ht-dn)<=wo*Math.max(1,Math.abs(ht),Math.abs(dn))},a.b2=function(u,o){return u[0]=o[0],u[1]=o[1],u[2]=o[2],u[3]=o[3],u[4]=o[4],u[5]=o[5],u[6]=o[6],u[7]=o[7],u[8]=o[8],u[9]=o[9],u[10]=o[10],u[11]=o[11],u[12]=o[12],u[13]=o[13],u[14]=o[14],u[15]=o[15],u},a.b3=function(u,o,c){return u[0]=o[0]*c[0],u[1]=o[1]*c[1],u[2]=o[2]*c[2],u[3]=o[3]*c[3],u},a.b4=function(u,o){return u[0]*o[0]+u[1]*o[1]+u[2]*o[2]+u[3]*o[3]},a.b5=pt,a.b6=pv,a.b7=cv,a.b8=function(u,o,c,p,m){var v,w=1/Math.tan(o/2);return u[0]=w/c,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=w,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[11]=-1,u[12]=0,u[13]=0,u[15]=0,m!=null&&m!==1/0?(u[10]=(m+p)*(v=1/(p-m)),u[14]=2*m*p*v):(u[10]=-1,u[14]=-2*p),u},a.b9=function(u,o,c){var p=Math.sin(c),m=Math.cos(c),v=o[4],w=o[5],E=o[6],T=o[7],k=o[8],D=o[9],F=o[10],j=o[11];return o!==u&&(u[0]=o[0],u[1]=o[1],u[2]=o[2],u[3]=o[3],u[12]=o[12],u[13]=o[13],u[14]=o[14],u[15]=o[15]),u[4]=v*m+k*p,u[5]=w*m+D*p,u[6]=E*m+F*p,u[7]=T*m+j*p,u[8]=k*m-v*p,u[9]=D*m-w*p,u[10]=F*m-E*p,u[11]=j*m-T*p,u},a.bA=S,a.bB=B0,a.bC=ih,a.bD=Fo,a.ba=K,a.bb=it,a.bc=function(u,o){return u[0]=o[0],u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=o[1],u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=o[2],u[11]=0,u[12]=0,u[13]=0,u[14]=0,u[15]=1,u},a.bd=class extends uc{},a.be=M_,a.bf=hv,a.bg=dS,a.bi=De,a.bj=function(u,o,c=!1){if(bo===Gf||bo===jf||bo===qf)throw new Error("setRTLTextPlugin cannot be called multiple times.");el=qn.resolveURL(u),bo=Gf,Zf=o,$f(),c||tm()},a.bk=Wf,a.bl=function(u,o){const c={};for(let m=0;m<u.length;m++){const v=o&&o[u[m].id]||ah(u[m]);o&&(o[u[m].id]=v);let w=c[v];w||(w=c[v]=[]),w.push(u[m])}const p=[];for(const m in c)p.push(c[m]);return p},a.bm=xe,a.bn=mv,a.bo=_v,a.bp=X0,a.bq=function(u){u.bucket.createArrays(),u.bucket.tilePixelRatio=rr/(512*u.bucket.overscaling),u.bucket.compareText={},u.bucket.iconsNeedLinear=!1;const o=u.bucket.layers[0],c=o.layout,p=o._unevaluatedLayout._values,m={layoutIconSize:p["icon-size"].possiblyEvaluate(new pi(u.bucket.zoom+1),u.canonical),layoutTextSize:p["text-size"].possiblyEvaluate(new pi(u.bucket.zoom+1),u.canonical),textMaxSize:p["text-size"].possiblyEvaluate(new pi(18))};if(u.bucket.textSizeData.kind==="composite"){const{minZoom:k,maxZoom:D}=u.bucket.textSizeData;m.compositeTextSizes=[p["text-size"].possiblyEvaluate(new pi(k),u.canonical),p["text-size"].possiblyEvaluate(new pi(D),u.canonical)]}if(u.bucket.iconSizeData.kind==="composite"){const{minZoom:k,maxZoom:D}=u.bucket.iconSizeData;m.compositeIconSizes=[p["icon-size"].possiblyEvaluate(new pi(k),u.canonical),p["icon-size"].possiblyEvaluate(new pi(D),u.canonical)]}const v=c.get("text-line-height")*mr,w=c.get("text-rotation-alignment")!=="viewport"&&c.get("symbol-placement")!=="point",E=c.get("text-keep-upright"),T=c.get("text-size");for(const k of u.bucket.features){const D=c.get("text-font").evaluate(k,{},u.canonical).join(","),F=T.evaluate(k,{},u.canonical),j=m.layoutTextSize.evaluate(k,{},u.canonical),X=m.layoutIconSize.evaluate(k,{},u.canonical),H={horizontal:{},vertical:void 0},tt=k.text;let lt,ht=[0,0];if(tt){const Nt=tt.toString(),Ft=c.get("text-letter-spacing").evaluate(k,{},u.canonical)*mr,Jt=Vf(Nt)?Ft:0,ve=c.get("text-anchor").evaluate(k,{},u.canonical),Me=Mv(o,k,u.canonical);if(!Me){const he=c.get("text-radial-offset").evaluate(k,{},u.canonical);ht=he?Lv(ve,[he*mr,A_]):c.get("text-offset").evaluate(k,{},u.canonical).map(ie=>ie*mr)}let _e=w?"center":c.get("text-justify").evaluate(k,{},u.canonical);const de=c.get("symbol-placement"),ue=de==="point"?c.get("text-max-width").evaluate(k,{},u.canonical)*mr:0,we=()=>{u.bucket.allowVerticalPlacement&&Bf(Nt)&&(H.vertical=_m(tt,u.glyphMap,u.glyphPositions,u.imagePositions,D,ue,v,ve,"left",Jt,ht,a.ai.vertical,!0,de,j,F))};if(!w&&Me){const he=new Set;if(_e==="auto")for(let Be=0;Be<Me.values.length;Be+=2)he.add(N_(Me.values[Be]));else he.add(_e);let ie=!1;for(const Be of he)if(!H.horizontal[Be])if(ie)H.horizontal[Be]=H.horizontal[0];else{const Ae=_m(tt,u.glyphMap,u.glyphPositions,u.imagePositions,D,ue,v,"center",Be,Jt,ht,a.ai.horizontal,!1,de,j,F);Ae&&(H.horizontal[Be]=Ae,ie=Ae.positionedLines.length===1)}we()}else{_e==="auto"&&(_e=N_(ve));const he=_m(tt,u.glyphMap,u.glyphPositions,u.imagePositions,D,ue,v,ve,_e,Jt,ht,a.ai.horizontal,!1,de,j,F);he&&(H.horizontal[_e]=he),we(),Bf(Nt)&&w&&E&&(H.vertical=_m(tt,u.glyphMap,u.glyphPositions,u.imagePositions,D,ue,v,ve,_e,Jt,ht,a.ai.vertical,!1,de,j,F))}}let At=!1;if(k.icon&&k.icon.name){const Nt=u.imageMap[k.icon.name];Nt&&(lt=H2(u.imagePositions[k.icon.name],c.get("icon-offset").evaluate(k,{},u.canonical),c.get("icon-anchor").evaluate(k,{},u.canonical)),At=!!Nt.sdf,u.bucket.sdfIcons===void 0?u.bucket.sdfIcons=At:u.bucket.sdfIcons!==At&&kt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Nt.pixelRatio!==u.bucket.pixelRatio||c.get("icon-rotate").constantOr(1)!==0)&&(u.bucket.iconsNeedLinear=!0))}const Et=kv(H.horizontal)||H.vertical;u.bucket.iconsInText=!!Et&&Et.iconsInText,(Et||lt)&&fS(u.bucket,k,H,lt,u.imageMap,m,j,X,ht,At,u.canonical)}u.showCollisionBoxes&&u.bucket.generateCollisionDebugBuffers()},a.br=__,a.bs=d_,a.bt=g_,a.bu=class{constructor(u){this._marks={start:[u.url,"start"].join("#"),end:[u.url,"end"].join("#"),measure:u.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let u=performance.getEntriesByName(this._marks.measure);return u.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),u=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),u}},a.bv=v_,a.bw=vu,a.bx=function(u,o,c,p,m){return _(this,void 0,void 0,function*(){if($())try{return yield Qe(u,o,c,p,m)}catch{}return function(v,w,E,T,k){const D=v.width,F=v.height;Fe&&ke||(Fe=new OffscreenCanvas(D,F),ke=Fe.getContext("2d",{willReadFrequently:!0})),Fe.width=D,Fe.height=F,ke.drawImage(v,0,0,D,F);const j=ke.getImageData(w,E,T,k);return ke.clearRect(0,0,D,F),j.data}(u,o,c,p,m)})},a.by=dv,a.bz=x,a.c=re,a.d=function(u,o){const c=new Image;c.onload=()=>{o(null,c),URL.revokeObjectURL(c.src),c.onload=null,window.requestAnimationFrame(()=>{c.src=jn})},c.onerror=()=>o(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const p=new Blob([new Uint8Array(u)],{type:"image/png"});c.src=u.byteLength?URL.createObjectURL(p):jn},a.e=gt,a.f=function(u,o){return wn(gt(u,{type:"json"}),o)},a.g=On,a.h=qn,a.i=se,a.j=pn,a.k=Wn,a.l=yt,a.m=wn,a.n=function(u){return new v_(u).readFields(j2,[])},a.o=function(u,o,c){if(!u.length)return c(null,[]);let p=u.length;const m=new Array(u.length);let v=null;u.forEach((w,E)=>{o(w,(T,k)=>{T&&(v=T),m[E]=k,--p==0&&c(v,m)})})},a.p=W0,a.q=sp,a.r=Xi,a.s=Ee,a.t=Hg,a.u=ye,a.v=$t,a.w=kt,a.x=ch,a.y=La,a.z=function([u,o,c]){return o+=90,o*=Math.PI/180,c*=Math.PI/180,{x:u*Math.cos(o)*Math.sin(c),y:u*Math.sin(o)*Math.sin(c),z:u*Math.cos(c)}}}),l(["./shared"],function(a){class _{constructor(G){this.keyCache={},G&&this.replace(G)}replace(G){this._layerConfigs={},this._layers={},this.update(G,[])}update(G,q){for(const Z of G){this._layerConfigs[Z.id]=Z;const ot=this._layers[Z.id]=a.aC(Z);ot._featureFilter=a.a6(ot.filter),this.keyCache[Z.id]&&delete this.keyCache[Z.id]}for(const Z of q)delete this.keyCache[Z],delete this._layerConfigs[Z],delete this._layers[Z];this.familiesBySource={};const J=a.bl(Object.values(this._layerConfigs),this.keyCache);for(const Z of J){const ot=Z.map(Ht=>this._layers[Ht.id]),Mt=ot[0];if(Mt.visibility==="none")continue;const bt=Mt.source||"";let rt=this.familiesBySource[bt];rt||(rt=this.familiesBySource[bt]={});const Tt=Mt.sourceLayer||"_geojsonTileLayer";let Wt=rt[Tt];Wt||(Wt=rt[Tt]=[]),Wt.push(ot)}}}class x{constructor(G){const q={},J=[];for(const bt in G){const rt=G[bt],Tt=q[bt]={};for(const Wt in rt){const Ht=rt[+Wt];if(!Ht||Ht.bitmap.width===0||Ht.bitmap.height===0)continue;const Kt={x:0,y:0,w:Ht.bitmap.width+2,h:Ht.bitmap.height+2};J.push(Kt),Tt[Wt]={rect:Kt,metrics:Ht.metrics}}}const{w:Z,h:ot}=a.p(J),Mt=new a.q({width:Z||1,height:ot||1});for(const bt in G){const rt=G[bt];for(const Tt in rt){const Wt=rt[+Tt];if(!Wt||Wt.bitmap.width===0||Wt.bitmap.height===0)continue;const Ht=q[bt][Tt].rect;a.q.copy(Wt.bitmap,Mt,{x:0,y:0},{x:Ht.x+1,y:Ht.y+1},Wt.bitmap)}}this.image=Mt,this.positions=q}}a.bm("GlyphAtlas",x);class S{constructor(G){this.tileID=new a.O(G.tileID.overscaledZ,G.tileID.wrap,G.tileID.canonical.z,G.tileID.canonical.x,G.tileID.canonical.y),this.uid=G.uid,this.zoom=G.zoom,this.pixelRatio=G.pixelRatio,this.tileSize=G.tileSize,this.source=G.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=G.showCollisionBoxes,this.collectResourceTiming=!!G.collectResourceTiming,this.returnDependencies=!!G.returnDependencies,this.promoteId=G.promoteId,this.inFlightDependencies=[],this.dependencySentinel=-1}parse(G,q,J,Z,ot){this.status="parsing",this.data=G,this.collisionBoxArray=new a.a3;const Mt=new a.bn(Object.keys(G.layers).sort()),bt=new a.bo(this.tileID,this.promoteId);bt.bucketLayerIDs=[];const rt={},Tt={featureIndex:bt,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:J},Wt=q.familiesBySource[this.source];for(const kn in Wt){const Pn=G.layers[kn];if(!Pn)continue;Pn.version===1&&a.w(`Vector tile source "${this.source}" layer "${kn}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const qr=Mt.encode(kn),oi=[];for(let ir=0;ir<Pn.length;ir++){const Nr=Pn.feature(ir),rs=bt.getId(Nr,kn);oi.push({feature:Nr,id:rs,index:ir,sourceLayerIndex:qr})}for(const ir of Wt[kn]){const Nr=ir[0];Nr.source!==this.source&&a.w(`layer.source = ${Nr.source} does not equal this.source = ${this.source}`),Nr.minzoom&&this.zoom<Math.floor(Nr.minzoom)||Nr.maxzoom&&this.zoom>=Nr.maxzoom||Nr.visibility!=="none"&&(L(ir,this.zoom,J),(rt[Nr.id]=Nr.createBucket({index:bt.bucketLayerIDs.length,layers:ir,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:qr,sourceID:this.source})).populate(oi,Tt,this.tileID.canonical),bt.bucketLayerIDs.push(ir.map(rs=>rs.id)))}}let Ht,Kt,Ne,Ye;const Te=a.aH(Tt.glyphDependencies,kn=>Object.keys(kn).map(Number));this.inFlightDependencies.forEach(kn=>kn==null?void 0:kn.cancel()),this.inFlightDependencies=[];const Ve=++this.dependencySentinel;Object.keys(Te).length?this.inFlightDependencies.push(Z.send("getGlyphs",{uid:this.uid,stacks:Te,source:this.source,tileID:this.tileID,type:"glyphs"},(kn,Pn)=>{Ve===this.dependencySentinel&&(Ht||(Ht=kn,Kt=Pn,Jn.call(this)))})):Kt={};const rn=Object.keys(Tt.iconDependencies);rn.length?this.inFlightDependencies.push(Z.send("getImages",{icons:rn,source:this.source,tileID:this.tileID,type:"icons"},(kn,Pn)=>{Ve===this.dependencySentinel&&(Ht||(Ht=kn,Ne=Pn,Jn.call(this)))})):Ne={};const Gn=Object.keys(Tt.patternDependencies);function Jn(){if(Ht)return ot(Ht);if(Kt&&Ne&&Ye){const kn=new x(Kt),Pn=new a.bp(Ne,Ye);for(const qr in rt){const oi=rt[qr];oi instanceof a.a4?(L(oi.layers,this.zoom,J),a.bq({bucket:oi,glyphMap:Kt,glyphPositions:kn.positions,imageMap:Ne,imagePositions:Pn.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):oi.hasPattern&&(oi instanceof a.br||oi instanceof a.bs||oi instanceof a.bt)&&(L(oi.layers,this.zoom,J),oi.addFeatures(Tt,this.tileID.canonical,Pn.patternPositions))}this.status="done",ot(null,{buckets:Object.values(rt).filter(qr=>!qr.isEmpty()),featureIndex:bt,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:kn.image,imageAtlas:Pn,glyphMap:this.returnDependencies?Kt:null,iconMap:this.returnDependencies?Ne:null,glyphPositions:this.returnDependencies?kn.positions:null})}}Gn.length?this.inFlightDependencies.push(Z.send("getImages",{icons:Gn,source:this.source,tileID:this.tileID,type:"patterns"},(kn,Pn)=>{Ve===this.dependencySentinel&&(Ht||(Ht=kn,Ye=Pn,Jn.call(this)))})):Ye={},Jn.call(this)}}function L(st,G,q){const J=new a.a8(G);for(const Z of st)Z.recalculate(J,q)}function A(st,G){const q=a.l(st.request,(J,Z,ot,Mt)=>{if(J)G(J);else if(Z)try{const bt=new a.bw.VectorTile(new a.bv(Z));G(null,{vectorTile:bt,rawData:Z,cacheControl:ot,expires:Mt})}catch(bt){const rt=new Uint8Array(Z);let Tt=`Unable to parse the tile at ${st.request.url}, `;Tt+=rt[0]===31&&rt[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${bt.messge}`,G(new Error(Tt))}});return()=>{q.cancel(),G()}}class P{constructor(G,q,J,Z){this.actor=G,this.layerIndex=q,this.availableImages=J,this.loadVectorData=Z||A,this.fetching={},this.loading={},this.loaded={}}loadTile(G,q){const J=G.uid;this.loading||(this.loading={});const Z=!!(G&&G.request&&G.request.collectResourceTiming)&&new a.bu(G.request),ot=this.loading[J]=new S(G);ot.abort=this.loadVectorData(G,(Mt,bt)=>{if(delete this.loading[J],Mt||!bt)return ot.status="done",this.loaded[J]=ot,q(Mt);const rt=bt.rawData,Tt={};bt.expires&&(Tt.expires=bt.expires),bt.cacheControl&&(Tt.cacheControl=bt.cacheControl);const Wt={};if(Z){const Ht=Z.finish();Ht&&(Wt.resourceTiming=JSON.parse(JSON.stringify(Ht)))}ot.vectorTile=bt.vectorTile,ot.parse(bt.vectorTile,this.layerIndex,this.availableImages,this.actor,(Ht,Kt)=>{if(delete this.fetching[J],Ht||!Kt)return q(Ht);q(null,a.e({rawTileData:rt.slice(0)},Kt,Tt,Wt))}),this.loaded=this.loaded||{},this.loaded[J]=ot,this.fetching[J]={rawTileData:rt,cacheControl:Tt,resourceTiming:Wt}})}reloadTile(G,q){const J=this.loaded,Z=G.uid;if(J&&J[Z]){const ot=J[Z];ot.showCollisionBoxes=G.showCollisionBoxes,ot.status==="parsing"?ot.parse(ot.vectorTile,this.layerIndex,this.availableImages,this.actor,(Mt,bt)=>{if(Mt||!bt)return q(Mt,bt);let rt;if(this.fetching[Z]){const{rawTileData:Tt,cacheControl:Wt,resourceTiming:Ht}=this.fetching[Z];delete this.fetching[Z],rt=a.e({rawTileData:Tt.slice(0)},bt,Wt,Ht)}else rt=bt;q(null,rt)}):ot.status==="done"&&(ot.vectorTile?ot.parse(ot.vectorTile,this.layerIndex,this.availableImages,this.actor,q):q())}}abortTile(G,q){const J=this.loading,Z=G.uid;J&&J[Z]&&J[Z].abort&&(J[Z].abort(),delete J[Z]),q()}removeTile(G,q){const J=this.loaded,Z=G.uid;J&&J[Z]&&delete J[Z],q()}}class O{constructor(){this.loaded={}}loadTile(G,q){return a._(this,void 0,void 0,function*(){const{uid:J,encoding:Z,rawImageData:ot,redFactor:Mt,greenFactor:bt,blueFactor:rt,baseShift:Tt}=G,Wt=ot.width+2,Ht=ot.height+2,Kt=a.a(ot)?new a.R({width:Wt,height:Ht},yield a.bx(ot,-1,-1,Wt,Ht)):ot,Ne=new a.by(J,Kt,Z,Mt,bt,rt,Tt);this.loaded=this.loaded||{},this.loaded[J]=Ne,q(null,Ne)})}removeTile(G){const q=this.loaded,J=G.uid;q&&q[J]&&delete q[J]}}function B(st,G){if(st.length!==0){U(st[0],G);for(var q=1;q<st.length;q++)U(st[q],!G)}}function U(st,G){for(var q=0,J=0,Z=0,ot=st.length,Mt=ot-1;Z<ot;Mt=Z++){var bt=(st[Z][0]-st[Mt][0])*(st[Mt][1]+st[Z][1]),rt=q+bt;J+=Math.abs(q)>=Math.abs(bt)?q-rt+bt:bt-rt+q,q=rt}q+J>=0!=!!G&&st.reverse()}var Y=a.bz(function st(G,q){var J,Z=G&&G.type;if(Z==="FeatureCollection")for(J=0;J<G.features.length;J++)st(G.features[J],q);else if(Z==="GeometryCollection")for(J=0;J<G.geometries.length;J++)st(G.geometries[J],q);else if(Z==="Feature")st(G.geometry,q);else if(Z==="Polygon")B(G.coordinates,q);else if(Z==="MultiPolygon")for(J=0;J<G.coordinates.length;J++)B(G.coordinates[J],q);return G});const V=a.bw.VectorTileFeature.prototype.toGeoJSON;var $={exports:{}},K=a.bA,it=a.bw.VectorTileFeature,ft=pt;function pt(st,G){this.options=G||{},this.features=st,this.length=st.length}function gt(st,G){this.id=typeof st.id=="number"?st.id:void 0,this.type=st.type,this.rawGeometry=st.type===1?[st.geometry]:st.geometry,this.properties=st.tags,this.extent=G||4096}pt.prototype.feature=function(st){return new gt(this.features[st],this.options.extent)},gt.prototype.loadGeometry=function(){var st=this.rawGeometry;this.geometry=[];for(var G=0;G<st.length;G++){for(var q=st[G],J=[],Z=0;Z<q.length;Z++)J.push(new K(q[Z][0],q[Z][1]));this.geometry.push(J)}return this.geometry},gt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var st=this.geometry,G=1/0,q=-1/0,J=1/0,Z=-1/0,ot=0;ot<st.length;ot++)for(var Mt=st[ot],bt=0;bt<Mt.length;bt++){var rt=Mt[bt];G=Math.min(G,rt.x),q=Math.max(q,rt.x),J=Math.min(J,rt.y),Z=Math.max(Z,rt.y)}return[G,J,q,Z]},gt.prototype.toGeoJSON=it.prototype.toGeoJSON;var ut=a.bB,St=ft;function _t(st){var G=new ut;return function(q,J){for(var Z in q.layers)J.writeMessage(3,vt,q.layers[Z])}(st,G),G.finish()}function vt(st,G){var q;G.writeVarintField(15,st.version||1),G.writeStringField(1,st.name||""),G.writeVarintField(5,st.extent||4096);var J={keys:[],values:[],keycache:{},valuecache:{}};for(q=0;q<st.length;q++)J.feature=st.feature(q),G.writeMessage(2,ee,J);var Z=J.keys;for(q=0;q<Z.length;q++)G.writeStringField(3,Z[q]);var ot=J.values;for(q=0;q<ot.length;q++)G.writeMessage(4,Ce,ot[q])}function ee(st,G){var q=st.feature;q.id!==void 0&&G.writeVarintField(1,q.id),G.writeMessage(2,kt,st),G.writeVarintField(3,q.type),G.writeMessage(4,se,q)}function kt(st,G){var q=st.feature,J=st.keys,Z=st.values,ot=st.keycache,Mt=st.valuecache;for(var bt in q.properties){var rt=q.properties[bt],Tt=ot[bt];if(rt!==null){Tt===void 0&&(J.push(bt),ot[bt]=Tt=J.length-1),G.writeVarint(Tt);var Wt=typeof rt;Wt!=="string"&&Wt!=="boolean"&&Wt!=="number"&&(rt=JSON.stringify(rt));var Ht=Wt+":"+rt,Kt=Mt[Ht];Kt===void 0&&(Z.push(rt),Mt[Ht]=Kt=Z.length-1),G.writeVarint(Kt)}}}function Gt(st,G){return(G<<3)+(7&st)}function Qt(st){return st<<1^st>>31}function se(st,G){for(var q=st.loadGeometry(),J=st.type,Z=0,ot=0,Mt=q.length,bt=0;bt<Mt;bt++){var rt=q[bt],Tt=1;J===1&&(Tt=rt.length),G.writeVarint(Gt(1,Tt));for(var Wt=J===3?rt.length-1:rt.length,Ht=0;Ht<Wt;Ht++){Ht===1&&J!==1&&G.writeVarint(Gt(2,Wt-1));var Kt=rt[Ht].x-Z,Ne=rt[Ht].y-ot;G.writeVarint(Qt(Kt)),G.writeVarint(Qt(Ne)),Z+=Kt,ot+=Ne}J===3&&G.writeVarint(Gt(7,1))}}function Ce(st,G){var q=typeof st;q==="string"?G.writeStringField(1,st):q==="boolean"?G.writeBooleanField(7,st):q==="number"&&(st%1!=0?G.writeDoubleField(3,st):st<0?G.writeSVarintField(6,st):G.writeVarintField(5,st))}$.exports=_t,$.exports.fromVectorTileJs=_t,$.exports.fromGeojsonVt=function(st,G){G=G||{};var q={};for(var J in st)q[J]=new St(st[J].features,G),q[J].name=J,q[J].version=G.version,q[J].extent=G.extent;return _t({layers:q})},$.exports.GeoJSONWrapper=St;var yn=a.bz($.exports);const jn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:st=>st},Qe=Math.fround||(Fe=new Float32Array(1),st=>(Fe[0]=+st,Fe[0]));var Fe;const ke=3,fn=5,Kn=6;class qn{constructor(G){this.options=Object.assign(Object.create(jn),G),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(G){const{log:q,minZoom:J,maxZoom:Z}=this.options;q&&console.time("total time");const ot=`prepare ${G.length} points`;q&&console.time(ot),this.points=G;const Mt=[];for(let rt=0;rt<G.length;rt++){const Tt=G[rt];if(!Tt.geometry)continue;const[Wt,Ht]=Tt.geometry.coordinates,Kt=Qe(hn(Wt)),Ne=Qe(On(Ht));Mt.push(Kt,Ne,1/0,rt,-1,1),this.options.reduce&&Mt.push(0)}let bt=this.trees[Z+1]=this._createTree(Mt);q&&console.timeEnd(ot);for(let rt=Z;rt>=J;rt--){const Tt=+Date.now();bt=this.trees[rt]=this._createTree(this._cluster(bt,rt)),q&&console.log("z%d: %d clusters in %dms",rt,bt.numItems,+Date.now()-Tt)}return q&&console.timeEnd("total time"),this}getClusters(G,q){let J=((G[0]+180)%360+360)%360-180;const Z=Math.max(-90,Math.min(90,G[1]));let ot=G[2]===180?180:((G[2]+180)%360+360)%360-180;const Mt=Math.max(-90,Math.min(90,G[3]));if(G[2]-G[0]>=360)J=-180,ot=180;else if(J>ot){const Ht=this.getClusters([J,Z,180,Mt],q),Kt=this.getClusters([-180,Z,ot,Mt],q);return Ht.concat(Kt)}const bt=this.trees[this._limitZoom(q)],rt=bt.range(hn(J),On(Mt),hn(ot),On(Z)),Tt=bt.data,Wt=[];for(const Ht of rt){const Kt=this.stride*Ht;Wt.push(Tt[Kt+fn]>1?re(Tt,Kt,this.clusterProps):this.points[Tt[Kt+ke]])}return Wt}getChildren(G){const q=this._getOriginId(G),J=this._getOriginZoom(G),Z="No cluster with the specified id.",ot=this.trees[J];if(!ot)throw new Error(Z);const Mt=ot.data;if(q*this.stride>=Mt.length)throw new Error(Z);const bt=this.options.radius/(this.options.extent*Math.pow(2,J-1)),rt=ot.within(Mt[q*this.stride],Mt[q*this.stride+1],bt),Tt=[];for(const Wt of rt){const Ht=Wt*this.stride;Mt[Ht+4]===G&&Tt.push(Mt[Ht+fn]>1?re(Mt,Ht,this.clusterProps):this.points[Mt[Ht+ke]])}if(Tt.length===0)throw new Error(Z);return Tt}getLeaves(G,q,J){const Z=[];return this._appendLeaves(Z,G,q=q||10,J=J||0,0),Z}getTile(G,q,J){const Z=this.trees[this._limitZoom(G)],ot=Math.pow(2,G),{extent:Mt,radius:bt}=this.options,rt=bt/Mt,Tt=(J-rt)/ot,Wt=(J+1+rt)/ot,Ht={features:[]};return this._addTileFeatures(Z.range((q-rt)/ot,Tt,(q+1+rt)/ot,Wt),Z.data,q,J,ot,Ht),q===0&&this._addTileFeatures(Z.range(1-rt/ot,Tt,1,Wt),Z.data,ot,J,ot,Ht),q===ot-1&&this._addTileFeatures(Z.range(0,Tt,rt/ot,Wt),Z.data,-1,J,ot,Ht),Ht.features.length?Ht:null}getClusterExpansionZoom(G){let q=this._getOriginZoom(G)-1;for(;q<=this.options.maxZoom;){const J=this.getChildren(G);if(q++,J.length!==1)break;G=J[0].properties.cluster_id}return q}_appendLeaves(G,q,J,Z,ot){const Mt=this.getChildren(q);for(const bt of Mt){const rt=bt.properties;if(rt&&rt.cluster?ot+rt.point_count<=Z?ot+=rt.point_count:ot=this._appendLeaves(G,rt.cluster_id,J,Z,ot):ot<Z?ot++:G.push(bt),G.length===J)break}return ot}_createTree(G){const q=new a.av(G.length/this.stride|0,this.options.nodeSize,Float32Array);for(let J=0;J<G.length;J+=this.stride)q.add(G[J],G[J+1]);return q.finish(),q.data=G,q}_addTileFeatures(G,q,J,Z,ot,Mt){for(const bt of G){const rt=bt*this.stride,Tt=q[rt+fn]>1;let Wt,Ht,Kt;if(Tt)Wt=De(q,rt,this.clusterProps),Ht=q[rt],Kt=q[rt+1];else{const Te=this.points[q[rt+ke]];Wt=Te.properties;const[Ve,rn]=Te.geometry.coordinates;Ht=hn(Ve),Kt=On(rn)}const Ne={type:1,geometry:[[Math.round(this.options.extent*(Ht*ot-J)),Math.round(this.options.extent*(Kt*ot-Z))]],tags:Wt};let Ye;Ye=Tt||this.options.generateId?q[rt+ke]:this.points[q[rt+ke]].id,Ye!==void 0&&(Ne.id=Ye),Mt.features.push(Ne)}}_limitZoom(G){return Math.max(this.options.minZoom,Math.min(Math.floor(+G),this.options.maxZoom+1))}_cluster(G,q){const{radius:J,extent:Z,reduce:ot,minPoints:Mt}=this.options,bt=J/(Z*Math.pow(2,q)),rt=G.data,Tt=[],Wt=this.stride;for(let Ht=0;Ht<rt.length;Ht+=Wt){if(rt[Ht+2]<=q)continue;rt[Ht+2]=q;const Kt=rt[Ht],Ne=rt[Ht+1],Ye=G.within(rt[Ht],rt[Ht+1],bt),Te=rt[Ht+fn];let Ve=Te;for(const rn of Ye){const Gn=rn*Wt;rt[Gn+2]>q&&(Ve+=rt[Gn+fn])}if(Ve>Te&&Ve>=Mt){let rn,Gn=Kt*Te,Jn=Ne*Te,kn=-1;const Pn=((Ht/Wt|0)<<5)+(q+1)+this.points.length;for(const qr of Ye){const oi=qr*Wt;if(rt[oi+2]<=q)continue;rt[oi+2]=q;const ir=rt[oi+fn];Gn+=rt[oi]*ir,Jn+=rt[oi+1]*ir,rt[oi+4]=Pn,ot&&(rn||(rn=this._map(rt,Ht,!0),kn=this.clusterProps.length,this.clusterProps.push(rn)),ot(rn,this._map(rt,oi)))}rt[Ht+4]=Pn,Tt.push(Gn/Ve,Jn/Ve,1/0,Pn,-1,Ve),ot&&Tt.push(kn)}else{for(let rn=0;rn<Wt;rn++)Tt.push(rt[Ht+rn]);if(Ve>1)for(const rn of Ye){const Gn=rn*Wt;if(!(rt[Gn+2]<=q)){rt[Gn+2]=q;for(let Jn=0;Jn<Wt;Jn++)Tt.push(rt[Gn+Jn])}}}}return Tt}_getOriginId(G){return G-this.points.length>>5}_getOriginZoom(G){return(G-this.points.length)%32}_map(G,q,J){if(G[q+fn]>1){const Mt=this.clusterProps[G[q+Kn]];return J?Object.assign({},Mt):Mt}const Z=this.points[G[q+ke]].properties,ot=this.options.map(Z);return J&&ot===Z?Object.assign({},ot):ot}}function re(st,G,q){return{type:"Feature",id:st[G+ke],properties:De(st,G,q),geometry:{type:"Point",coordinates:[(J=st[G],360*(J-.5)),yi(st[G+1])]}};var J}function De(st,G,q){const J=st[G+fn],Z=J>=1e4?`${Math.round(J/1e3)}k`:J>=1e3?Math.round(J/100)/10+"k":J,ot=st[G+Kn],Mt=ot===-1?{}:Object.assign({},q[ot]);return Object.assign(Mt,{cluster:!0,cluster_id:st[G+ke],point_count:J,point_count_abbreviated:Z})}function hn(st){return st/360+.5}function On(st){const G=Math.sin(st*Math.PI/180),q=.5-.25*Math.log((1+G)/(1-G))/Math.PI;return q<0?0:q>1?1:q}function yi(st){const G=(180-360*st)*Math.PI/180;return 360*Math.atan(Math.exp(G))/Math.PI-90}function wn(st,G,q,J){for(var Z,ot=J,Mt=q-G>>1,bt=q-G,rt=st[G],Tt=st[G+1],Wt=st[q],Ht=st[q+1],Kt=G+3;Kt<q;Kt+=3){var Ne=yt(st[Kt],st[Kt+1],rt,Tt,Wt,Ht);if(Ne>ot)Z=Kt,ot=Ne;else if(Ne===ot){var Ye=Math.abs(Kt-Mt);Ye<bt&&(Z=Kt,bt=Ye)}}ot>J&&(Z-G>3&&wn(st,G,Z,J),st[Z+2]=ot,q-Z>3&&wn(st,Z,q,J))}function yt(st,G,q,J,Z,ot){var Mt=Z-q,bt=ot-J;if(Mt!==0||bt!==0){var rt=((st-q)*Mt+(G-J)*bt)/(Mt*Mt+bt*bt);rt>1?(q=Z,J=ot):rt>0&&(q+=Mt*rt,J+=bt*rt)}return(Mt=st-q)*Mt+(bt=G-J)*bt}function Ee(st,G,q,J){var Z={id:st===void 0?null:st,type:G,geometry:q,tags:J,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(ot){var Mt=ot.geometry,bt=ot.type;if(bt==="Point"||bt==="MultiPoint"||bt==="LineString")qe(ot,Mt);else if(bt==="Polygon"||bt==="MultiLineString")for(var rt=0;rt<Mt.length;rt++)qe(ot,Mt[rt]);else if(bt==="MultiPolygon")for(rt=0;rt<Mt.length;rt++)for(var Tt=0;Tt<Mt[rt].length;Tt++)qe(ot,Mt[rt][Tt])}(Z),Z}function qe(st,G){for(var q=0;q<G.length;q+=3)st.minX=Math.min(st.minX,G[q]),st.minY=Math.min(st.minY,G[q+1]),st.maxX=Math.max(st.maxX,G[q]),st.maxY=Math.max(st.maxY,G[q+1])}function nr(st,G,q,J){if(G.geometry){var Z=G.geometry.coordinates,ot=G.geometry.type,Mt=Math.pow(q.tolerance/((1<<q.maxZoom)*q.extent),2),bt=[],rt=G.id;if(q.promoteId?rt=G.properties[q.promoteId]:q.generateId&&(rt=J||0),ot==="Point")Wn(Z,bt);else if(ot==="MultiPoint")for(var Tt=0;Tt<Z.length;Tt++)Wn(Z[Tt],bt);else if(ot==="LineString")pn(Z,bt,Mt,!1);else if(ot==="MultiLineString"){if(q.lineMetrics){for(Tt=0;Tt<Z.length;Tt++)pn(Z[Tt],bt=[],Mt,!1),st.push(Ee(rt,"LineString",bt,G.properties));return}Wi(Z,bt,Mt,!1)}else if(ot==="Polygon")Wi(Z,bt,Mt,!0);else{if(ot!=="MultiPolygon"){if(ot==="GeometryCollection"){for(Tt=0;Tt<G.geometry.geometries.length;Tt++)nr(st,{id:rt,geometry:G.geometry.geometries[Tt],properties:G.properties},q,J);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Tt=0;Tt<Z.length;Tt++){var Wt=[];Wi(Z[Tt],Wt,Mt,!0),bt.push(Wt)}}st.push(Ee(rt,ot,bt,G.properties))}}function Wn(st,G){G.push($t(st[0])),G.push(Vi(st[1])),G.push(0)}function pn(st,G,q,J){for(var Z,ot,Mt=0,bt=0;bt<st.length;bt++){var rt=$t(st[bt][0]),Tt=Vi(st[bt][1]);G.push(rt),G.push(Tt),G.push(0),bt>0&&(Mt+=J?(Z*Tt-rt*ot)/2:Math.sqrt(Math.pow(rt-Z,2)+Math.pow(Tt-ot,2))),Z=rt,ot=Tt}var Wt=G.length-3;G[2]=1,wn(G,0,Wt,q),G[Wt+2]=1,G.size=Math.abs(Mt),G.start=0,G.end=G.size}function Wi(st,G,q,J){for(var Z=0;Z<st.length;Z++){var ot=[];pn(st[Z],ot,q,J),G.push(ot)}}function $t(st){return st/360+.5}function Vi(st){var G=Math.sin(st*Math.PI/180),q=.5-.25*Math.log((1+G)/(1-G))/Math.PI;return q<0?0:q>1?1:q}function fr(st,G,q,J,Z,ot,Mt,bt){if(J/=G,ot>=(q/=G)&&Mt<J)return st;if(Mt<q||ot>=J)return null;for(var rt=[],Tt=0;Tt<st.length;Tt++){var Wt=st[Tt],Ht=Wt.geometry,Kt=Wt.type,Ne=Z===0?Wt.minX:Wt.minY,Ye=Z===0?Wt.maxX:Wt.maxY;if(Ne>=q&&Ye<J)rt.push(Wt);else if(!(Ye<q||Ne>=J)){var Te=[];if(Kt==="Point"||Kt==="MultiPoint")zn(Ht,Te,q,J,Z);else if(Kt==="LineString")In(Ht,Te,q,J,Z,!1,bt.lineMetrics);else if(Kt==="MultiLineString")oo(Ht,Te,q,J,Z,!1);else if(Kt==="Polygon")oo(Ht,Te,q,J,Z,!0);else if(Kt==="MultiPolygon")for(var Ve=0;Ve<Ht.length;Ve++){var rn=[];oo(Ht[Ve],rn,q,J,Z,!0),rn.length&&Te.push(rn)}if(Te.length){if(bt.lineMetrics&&Kt==="LineString"){for(Ve=0;Ve<Te.length;Ve++)rt.push(Ee(Wt.id,Kt,Te[Ve],Wt.tags));continue}Kt!=="LineString"&&Kt!=="MultiLineString"||(Te.length===1?(Kt="LineString",Te=Te[0]):Kt="MultiLineString"),Kt!=="Point"&&Kt!=="MultiPoint"||(Kt=Te.length===3?"Point":"MultiPoint"),rt.push(Ee(Wt.id,Kt,Te,Wt.tags))}}}return rt.length?rt:null}function zn(st,G,q,J,Z){for(var ot=0;ot<st.length;ot+=3){var Mt=st[ot+Z];Mt>=q&&Mt<=J&&(G.push(st[ot]),G.push(st[ot+1]),G.push(st[ot+2]))}}function In(st,G,q,J,Z,ot,Mt){for(var bt,rt,Tt=es(st),Wt=Z===0?Ha:Gs,Ht=st.start,Kt=0;Kt<st.length-3;Kt+=3){var Ne=st[Kt],Ye=st[Kt+1],Te=st[Kt+2],Ve=st[Kt+3],rn=st[Kt+4],Gn=Z===0?Ne:Ye,Jn=Z===0?Ve:rn,kn=!1;Mt&&(bt=Math.sqrt(Math.pow(Ne-Ve,2)+Math.pow(Ye-rn,2))),Gn<q?Jn>q&&(rt=Wt(Tt,Ne,Ye,Ve,rn,q),Mt&&(Tt.start=Ht+bt*rt)):Gn>J?Jn<J&&(rt=Wt(Tt,Ne,Ye,Ve,rn,J),Mt&&(Tt.start=Ht+bt*rt)):ns(Tt,Ne,Ye,Te),Jn<q&&Gn>=q&&(rt=Wt(Tt,Ne,Ye,Ve,rn,q),kn=!0),Jn>J&&Gn<=J&&(rt=Wt(Tt,Ne,Ye,Ve,rn,J),kn=!0),!ot&&kn&&(Mt&&(Tt.end=Ht+bt*rt),G.push(Tt),Tt=es(st)),Mt&&(Ht+=bt)}var Pn=st.length-3;Ne=st[Pn],Ye=st[Pn+1],Te=st[Pn+2],(Gn=Z===0?Ne:Ye)>=q&&Gn<=J&&ns(Tt,Ne,Ye,Te),Pn=Tt.length-3,ot&&Pn>=3&&(Tt[Pn]!==Tt[0]||Tt[Pn+1]!==Tt[1])&&ns(Tt,Tt[0],Tt[1],Tt[2]),Tt.length&&G.push(Tt)}function es(st){var G=[];return G.size=st.size,G.start=st.start,G.end=st.end,G}function oo(st,G,q,J,Z,ot){for(var Mt=0;Mt<st.length;Mt++)In(st[Mt],G,q,J,Z,ot,!1)}function ns(st,G,q,J){st.push(G),st.push(q),st.push(J)}function Ha(st,G,q,J,Z,ot){var Mt=(ot-G)/(J-G);return st.push(ot),st.push(q+(Z-q)*Mt),st.push(1),Mt}function Gs(st,G,q,J,Z,ot){var Mt=(ot-q)/(Z-q);return st.push(G+(J-G)*Mt),st.push(ot),st.push(1),Mt}function js(st,G){for(var q=[],J=0;J<st.length;J++){var Z,ot=st[J],Mt=ot.type;if(Mt==="Point"||Mt==="MultiPoint"||Mt==="LineString")Z=Sa(ot.geometry,G);else if(Mt==="MultiLineString"||Mt==="Polygon"){Z=[];for(var bt=0;bt<ot.geometry.length;bt++)Z.push(Sa(ot.geometry[bt],G))}else if(Mt==="MultiPolygon")for(Z=[],bt=0;bt<ot.geometry.length;bt++){for(var rt=[],Tt=0;Tt<ot.geometry[bt].length;Tt++)rt.push(Sa(ot.geometry[bt][Tt],G));Z.push(rt)}q.push(Ee(ot.id,Mt,Z,ot.tags))}return q}function Sa(st,G){var q=[];q.size=st.size,st.start!==void 0&&(q.start=st.start,q.end=st.end);for(var J=0;J<st.length;J+=3)q.push(st[J]+G,st[J+1],st[J+2]);return q}function le(st,G){if(st.transformed)return st;var q,J,Z,ot=1<<st.z,Mt=st.x,bt=st.y;for(q=0;q<st.features.length;q++){var rt=st.features[q],Tt=rt.geometry,Wt=rt.type;if(rt.geometry=[],Wt===1)for(J=0;J<Tt.length;J+=2)rt.geometry.push(yo(Tt[J],Tt[J+1],G,ot,Mt,bt));else for(J=0;J<Tt.length;J++){var Ht=[];for(Z=0;Z<Tt[J].length;Z+=2)Ht.push(yo(Tt[J][Z],Tt[J][Z+1],G,ot,Mt,bt));rt.geometry.push(Ht)}}return st.transformed=!0,st}function yo(st,G,q,J,Z,ot){return[Math.round(q*(st*J-Z)),Math.round(q*(G*J-ot))]}function ri(st,G,q,J,Z){for(var ot=G===Z.maxZoom?0:Z.tolerance/((1<<G)*Z.extent),Mt={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:q,y:J,z:G,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},bt=0;bt<st.length;bt++){Mt.numFeatures++,Ea(Mt,st[bt],ot,Z);var rt=st[bt].minX,Tt=st[bt].minY,Wt=st[bt].maxX,Ht=st[bt].maxY;rt<Mt.minX&&(Mt.minX=rt),Tt<Mt.minY&&(Mt.minY=Tt),Wt>Mt.maxX&&(Mt.maxX=Wt),Ht>Mt.maxY&&(Mt.maxY=Ht)}return Mt}function Ea(st,G,q,J){var Z=G.geometry,ot=G.type,Mt=[];if(ot==="Point"||ot==="MultiPoint")for(var bt=0;bt<Z.length;bt+=3)Mt.push(Z[bt]),Mt.push(Z[bt+1]),st.numPoints++,st.numSimplified++;else if(ot==="LineString")ws(Mt,Z,st,q,!1,!1);else if(ot==="MultiLineString"||ot==="Polygon")for(bt=0;bt<Z.length;bt++)ws(Mt,Z[bt],st,q,ot==="Polygon",bt===0);else if(ot==="MultiPolygon")for(var rt=0;rt<Z.length;rt++){var Tt=Z[rt];for(bt=0;bt<Tt.length;bt++)ws(Mt,Tt[bt],st,q,!0,bt===0)}if(Mt.length){var Wt=G.tags||null;if(ot==="LineString"&&J.lineMetrics){for(var Ht in Wt={},G.tags)Wt[Ht]=G.tags[Ht];Wt.mapbox_clip_start=Z.start/Z.size,Wt.mapbox_clip_end=Z.end/Z.size}var Kt={geometry:Mt,type:ot==="Polygon"||ot==="MultiPolygon"?3:ot==="LineString"||ot==="MultiLineString"?2:1,tags:Wt};G.id!==null&&(Kt.id=G.id),st.features.push(Kt)}}function ws(st,G,q,J,Z,ot){var Mt=J*J;if(J>0&&G.size<(Z?Mt:J))q.numPoints+=G.length/3;else{for(var bt=[],rt=0;rt<G.length;rt+=3)(J===0||G[rt+2]>Mt)&&(q.numSimplified++,bt.push(G[rt]),bt.push(G[rt+1])),q.numPoints++;Z&&function(Tt,Wt){for(var Ht=0,Kt=0,Ne=Tt.length,Ye=Ne-2;Kt<Ne;Ye=Kt,Kt+=2)Ht+=(Tt[Kt]-Tt[Ye])*(Tt[Kt+1]+Tt[Ye+1]);if(Ht>0===Wt)for(Kt=0,Ne=Tt.length;Kt<Ne/2;Kt+=2){var Te=Tt[Kt],Ve=Tt[Kt+1];Tt[Kt]=Tt[Ne-2-Kt],Tt[Kt+1]=Tt[Ne-1-Kt],Tt[Ne-2-Kt]=Te,Tt[Ne-1-Kt]=Ve}}(bt,ot),st.push(bt)}}function ce(st,G){var q=(G=this.options=function(Z,ot){for(var Mt in ot)Z[Mt]=ot[Mt];return Z}(Object.create(this.options),G)).debug;if(q&&console.time("preprocess data"),G.maxZoom<0||G.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(G.promoteId&&G.generateId)throw new Error("promoteId and generateId cannot be used together.");var J=function(Z,ot){var Mt=[];if(Z.type==="FeatureCollection")for(var bt=0;bt<Z.features.length;bt++)nr(Mt,Z.features[bt],ot,bt);else nr(Mt,Z.type==="Feature"?Z:{geometry:Z},ot);return Mt}(st,G);this.tiles={},this.tileCoords=[],q&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",G.indexMaxZoom,G.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),J=function(Z,ot){var Mt=ot.buffer/ot.extent,bt=Z,rt=fr(Z,1,-1-Mt,Mt,0,-1,2,ot),Tt=fr(Z,1,1-Mt,2+Mt,0,-1,2,ot);return(rt||Tt)&&(bt=fr(Z,1,-Mt,1+Mt,0,-1,2,ot)||[],rt&&(bt=js(rt,1).concat(bt)),Tt&&(bt=bt.concat(js(Tt,-1)))),bt}(J,G),J.length&&this.splitTile(J,0,0,0),q&&(J.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function ln(st,G,q){return 32*((1<<st)*q+G)+st}function Ke(st,G){return G?st.properties[G]:st.id}function Ar(st,G){if(st==null)return!0;if(st.type==="Feature")return Ke(st,G)!=null;if(st.type==="FeatureCollection"){const q=new Set;for(const J of st.features){const Z=Ke(J,G);if(Z==null||q.has(Z))return!1;q.add(Z)}return!0}return!1}function is(st,G){const q=new Map;if(st!=null)if(st.type==="Feature")q.set(Ke(st,G),st);else for(const J of st.features)q.set(Ke(J,G),J);return q}ce.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},ce.prototype.splitTile=function(st,G,q,J,Z,ot,Mt){for(var bt=[st,G,q,J],rt=this.options,Tt=rt.debug;bt.length;){J=bt.pop(),q=bt.pop(),G=bt.pop(),st=bt.pop();var Wt=1<<G,Ht=ln(G,q,J),Kt=this.tiles[Ht];if(!Kt&&(Tt>1&&console.time("creation"),Kt=this.tiles[Ht]=ri(st,G,q,J,rt),this.tileCoords.push({z:G,x:q,y:J}),Tt)){Tt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",G,q,J,Kt.numFeatures,Kt.numPoints,Kt.numSimplified),console.timeEnd("creation"));var Ne="z"+G;this.stats[Ne]=(this.stats[Ne]||0)+1,this.total++}if(Kt.source=st,Z){if(G===rt.maxZoom||G===Z)continue;var Ye=1<<Z-G;if(q!==Math.floor(ot/Ye)||J!==Math.floor(Mt/Ye))continue}else if(G===rt.indexMaxZoom||Kt.numPoints<=rt.indexMaxPoints)continue;if(Kt.source=null,st.length!==0){Tt>1&&console.time("clipping");var Te,Ve,rn,Gn,Jn,kn,Pn=.5*rt.buffer/rt.extent,qr=.5-Pn,oi=.5+Pn,ir=1+Pn;Te=Ve=rn=Gn=null,Jn=fr(st,Wt,q-Pn,q+oi,0,Kt.minX,Kt.maxX,rt),kn=fr(st,Wt,q+qr,q+ir,0,Kt.minX,Kt.maxX,rt),st=null,Jn&&(Te=fr(Jn,Wt,J-Pn,J+oi,1,Kt.minY,Kt.maxY,rt),Ve=fr(Jn,Wt,J+qr,J+ir,1,Kt.minY,Kt.maxY,rt),Jn=null),kn&&(rn=fr(kn,Wt,J-Pn,J+oi,1,Kt.minY,Kt.maxY,rt),Gn=fr(kn,Wt,J+qr,J+ir,1,Kt.minY,Kt.maxY,rt),kn=null),Tt>1&&console.timeEnd("clipping"),bt.push(Te||[],G+1,2*q,2*J),bt.push(Ve||[],G+1,2*q,2*J+1),bt.push(rn||[],G+1,2*q+1,2*J),bt.push(Gn||[],G+1,2*q+1,2*J+1)}}},ce.prototype.getTile=function(st,G,q){var J=this.options,Z=J.extent,ot=J.debug;if(st<0||st>24)return null;var Mt=1<<st,bt=ln(st,G=(G%Mt+Mt)%Mt,q);if(this.tiles[bt])return le(this.tiles[bt],Z);ot>1&&console.log("drilling down to z%d-%d-%d",st,G,q);for(var rt,Tt=st,Wt=G,Ht=q;!rt&&Tt>0;)Tt--,Wt=Math.floor(Wt/2),Ht=Math.floor(Ht/2),rt=this.tiles[ln(Tt,Wt,Ht)];return rt&&rt.source?(ot>1&&console.log("found parent tile z%d-%d-%d",Tt,Wt,Ht),ot>1&&console.time("drilling down"),this.splitTile(rt.source,Tt,Wt,Ht,st,G,q),ot>1&&console.timeEnd("drilling down"),this.tiles[bt]?le(this.tiles[bt],Z):null):null};class on extends P{constructor(G,q,J,Z){super(G,q,J),this._dataUpdateable=new Map,this.loadGeoJSON=(ot,Mt)=>{const{promoteId:bt}=ot;if(ot.request)return a.f(ot.request,(rt,Tt,Wt,Ht)=>{this._dataUpdateable=Ar(Tt,bt)?is(Tt,bt):void 0,Mt(rt,Tt,Wt,Ht)});if(typeof ot.data=="string")try{const rt=JSON.parse(ot.data);this._dataUpdateable=Ar(rt,bt)?is(rt,bt):void 0,Mt(null,rt)}catch{Mt(new Error(`Input data given to '${ot.source}' is not a valid GeoJSON object.`))}else ot.dataDiff?this._dataUpdateable?(function(rt,Tt,Wt){var Ht,Kt,Ne,Ye;if(Tt.removeAll&&rt.clear(),Tt.remove)for(const Te of Tt.remove)rt.delete(Te);if(Tt.add)for(const Te of Tt.add){const Ve=Ke(Te,Wt);Ve!=null&&rt.set(Ve,Te)}if(Tt.update)for(const Te of Tt.update){let Ve=rt.get(Te.id);if(Ve==null)continue;const rn=!Te.removeAllProperties&&(((Ht=Te.removeProperties)===null||Ht===void 0?void 0:Ht.length)>0||((Kt=Te.addOrUpdateProperties)===null||Kt===void 0?void 0:Kt.length)>0);if((Te.newGeometry||Te.removeAllProperties||rn)&&(Ve=Object.assign({},Ve),rt.set(Te.id,Ve),rn&&(Ve.properties=Object.assign({},Ve.properties))),Te.newGeometry&&(Ve.geometry=Te.newGeometry),Te.removeAllProperties)Ve.properties={};else if(((Ne=Te.removeProperties)===null||Ne===void 0?void 0:Ne.length)>0)for(const Gn of Te.removeProperties)Object.prototype.hasOwnProperty.call(Ve.properties,Gn)&&delete Ve.properties[Gn];if(((Ye=Te.addOrUpdateProperties)===null||Ye===void 0?void 0:Ye.length)>0)for(const{key:Gn,value:Jn}of Te.addOrUpdateProperties)Ve.properties[Gn]=Jn}}(this._dataUpdateable,ot.dataDiff,bt),Mt(null,{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())})):Mt(new Error(`Cannot update existing geojson data in ${ot.source}`)):Mt(new Error(`Input data given to '${ot.source}' is not a valid GeoJSON object.`));return{cancel:()=>{}}},this.loadVectorData=this.loadGeoJSONTile,Z&&(this.loadGeoJSON=Z)}loadGeoJSONTile(G,q){const J=G.tileID.canonical;if(!this._geoJSONIndex)return q(null,null);const Z=this._geoJSONIndex.getTile(J.z,J.x,J.y);if(!Z)return q(null,null);const ot=new class{constructor(bt){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=a.N,this.length=bt.length,this._features=bt}feature(bt){return new class{constructor(rt){this._feature=rt,this.extent=a.N,this.type=rt.type,this.properties=rt.tags,"id"in rt&&!isNaN(rt.id)&&(this.id=parseInt(rt.id,10))}loadGeometry(){if(this._feature.type===1){const rt=[];for(const Tt of this._feature.geometry)rt.push([new a.P(Tt[0],Tt[1])]);return rt}{const rt=[];for(const Tt of this._feature.geometry){const Wt=[];for(const Ht of Tt)Wt.push(new a.P(Ht[0],Ht[1]));rt.push(Wt)}return rt}}toGeoJSON(rt,Tt,Wt){return V.call(this,rt,Tt,Wt)}}(this._features[bt])}}(Z.features);let Mt=yn(ot);Mt.byteOffset===0&&Mt.byteLength===Mt.buffer.byteLength||(Mt=new Uint8Array(Mt)),q(null,{vectorTile:ot,rawData:Mt.buffer})}loadData(G,q){var J;(J=this._pendingRequest)===null||J===void 0||J.cancel(),this._pendingCallback&&this._pendingCallback(null,{abandoned:!0});const Z=!!(G&&G.request&&G.request.collectResourceTiming)&&new a.bu(G.request);this._pendingCallback=q,this._pendingRequest=this.loadGeoJSON(G,(ot,Mt)=>{if(delete this._pendingCallback,delete this._pendingRequest,ot||!Mt)return q(ot);if(typeof Mt!="object")return q(new Error(`Input data given to '${G.source}' is not a valid GeoJSON object.`));{Y(Mt,!0);try{if(G.filter){const rt=a.bC(G.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(rt.result==="error")throw new Error(rt.value.map(Wt=>`${Wt.key}: ${Wt.message}`).join(", "));Mt={type:"FeatureCollection",features:Mt.features.filter(Wt=>rt.value.evaluate({zoom:0},Wt))}}this._geoJSONIndex=G.cluster?new qn(function({superclusterOptions:rt,clusterProperties:Tt}){if(!Tt||!rt)return rt;const Wt={},Ht={},Kt={accumulated:null,zoom:0},Ne={properties:null},Ye=Object.keys(Tt);for(const Te of Ye){const[Ve,rn]=Tt[Te],Gn=a.bC(rn),Jn=a.bC(typeof Ve=="string"?[Ve,["accumulated"],["get",Te]]:Ve);Wt[Te]=Gn.value,Ht[Te]=Jn.value}return rt.map=Te=>{Ne.properties=Te;const Ve={};for(const rn of Ye)Ve[rn]=Wt[rn].evaluate(Kt,Ne);return Ve},rt.reduce=(Te,Ve)=>{Ne.properties=Ve;for(const rn of Ye)Kt.accumulated=Te[rn],Te[rn]=Ht[rn].evaluate(Kt,Ne)},rt}(G)).load(Mt.features):function(rt,Tt){return new ce(rt,Tt)}(Mt,G.geojsonVtOptions)}catch(rt){return q(rt)}this.loaded={};const bt={};if(Z){const rt=Z.finish();rt&&(bt.resourceTiming={},bt.resourceTiming[G.source]=JSON.parse(JSON.stringify(rt)))}q(null,bt)}})}reloadTile(G,q){const J=this.loaded;return J&&J[G.uid]?super.reloadTile(G,q):this.loadTile(G,q)}removeSource(G,q){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),q()}getClusterExpansionZoom(G,q){try{q(null,this._geoJSONIndex.getClusterExpansionZoom(G.clusterId))}catch(J){q(J)}}getClusterChildren(G,q){try{q(null,this._geoJSONIndex.getChildren(G.clusterId))}catch(J){q(J)}}getClusterLeaves(G,q){try{q(null,this._geoJSONIndex.getLeaves(G.clusterId,G.limit,G.offset))}catch(J){q(J)}}}class Ss{constructor(G){this.self=G,this.actor=new a.C(G,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:P,geojson:on},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(q,J)=>{if(this.workerSourceTypes[q])throw new Error(`Worker source with name "${q}" already registered.`);this.workerSourceTypes[q]=J},this.self.registerRTLTextPlugin=q=>{if(a.bD.isParsed())throw new Error("RTL text plugin already registered.");a.bD.applyArabicShaping=q.applyArabicShaping,a.bD.processBidirectionalText=q.processBidirectionalText,a.bD.processStyledBidirectionalText=q.processStyledBidirectionalText}}setReferrer(G,q){this.referrer=q}setImages(G,q,J){this.availableImages[G]=q;for(const Z in this.workerSources[G]){const ot=this.workerSources[G][Z];for(const Mt in ot)ot[Mt].availableImages=q}J()}setLayers(G,q,J){this.getLayerIndex(G).replace(q),J()}updateLayers(G,q,J){this.getLayerIndex(G).update(q.layers,q.removedIds),J()}loadTile(G,q,J){this.getWorkerSource(G,q.type,q.source).loadTile(q,J)}loadDEMTile(G,q,J){this.getDEMWorkerSource(G,q.source).loadTile(q,J)}reloadTile(G,q,J){this.getWorkerSource(G,q.type,q.source).reloadTile(q,J)}abortTile(G,q,J){this.getWorkerSource(G,q.type,q.source).abortTile(q,J)}removeTile(G,q,J){this.getWorkerSource(G,q.type,q.source).removeTile(q,J)}removeDEMTile(G,q){this.getDEMWorkerSource(G,q.source).removeTile(q)}removeSource(G,q,J){if(!this.workerSources[G]||!this.workerSources[G][q.type]||!this.workerSources[G][q.type][q.source])return;const Z=this.workerSources[G][q.type][q.source];delete this.workerSources[G][q.type][q.source],Z.removeSource!==void 0?Z.removeSource(q,J):J()}loadWorkerSource(G,q,J){try{this.self.importScripts(q.url),J()}catch(Z){J(Z.toString())}}syncRTLPluginState(G,q,J){try{a.bD.setState(q);const Z=a.bD.getPluginURL();if(a.bD.isLoaded()&&!a.bD.isParsed()&&Z!=null){this.self.importScripts(Z);const ot=a.bD.isParsed();J(ot?void 0:new Error(`RTL Text Plugin failed to import scripts from ${Z}`),ot)}}catch(Z){J(Z.toString())}}getAvailableImages(G){let q=this.availableImages[G];return q||(q=[]),q}getLayerIndex(G){let q=this.layerIndexes[G];return q||(q=this.layerIndexes[G]=new _),q}getWorkerSource(G,q,J){return this.workerSources[G]||(this.workerSources[G]={}),this.workerSources[G][q]||(this.workerSources[G][q]={}),this.workerSources[G][q][J]||(this.workerSources[G][q][J]=new this.workerSourceTypes[q]({send:(Z,ot,Mt)=>{this.actor.send(Z,ot,Mt,G)}},this.getLayerIndex(G),this.getAvailableImages(G))),this.workerSources[G][q][J]}getDEMWorkerSource(G,q){return this.demWorkerSources[G]||(this.demWorkerSources[G]={}),this.demWorkerSources[G][q]||(this.demWorkerSources[G][q]=new O),this.demWorkerSources[G][q]}}return a.i()&&(self.worker=new Ss(self)),Ss}),l(["./shared"],function(a){var _="3.6.2";class x{static testProp(s){if(!x.docStyle)return s[0];for(let h=0;h<s.length;h++)if(s[h]in x.docStyle)return s[h];return s[0]}static create(s,h,d){const g=window.document.createElement(s);return h!==void 0&&(g.className=h),d&&d.appendChild(g),g}static createNS(s,h){return window.document.createElementNS(s,h)}static disableDrag(){x.docStyle&&x.selectProp&&(x.userSelect=x.docStyle[x.selectProp],x.docStyle[x.selectProp]="none")}static enableDrag(){x.docStyle&&x.selectProp&&(x.docStyle[x.selectProp]=x.userSelect)}static setTransform(s,h){s.style[x.transformProp]=h}static addEventListener(s,h,d,g={}){s.addEventListener(h,d,"passive"in g?g:g.capture)}static removeEventListener(s,h,d,g={}){s.removeEventListener(h,d,"passive"in g?g:g.capture)}static suppressClickInternal(s){s.preventDefault(),s.stopPropagation(),window.removeEventListener("click",x.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",x.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",x.suppressClickInternal,!0)},0)}static mousePos(s,h){const d=s.getBoundingClientRect();return new a.P(h.clientX-d.left-s.clientLeft,h.clientY-d.top-s.clientTop)}static touchPos(s,h){const d=s.getBoundingClientRect(),g=[];for(let b=0;b<h.length;b++)g.push(new a.P(h[b].clientX-d.left-s.clientLeft,h[b].clientY-d.top-s.clientTop));return g}static mouseButton(s){return s.button}static remove(s){s.parentNode&&s.parentNode.removeChild(s)}}x.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,x.selectProp=x.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),x.transformProp=x.testProp(["transform","WebkitTransform"]);const S={supported:!1,testSupport:function(y){!P&&A&&(O?B(y):L=y)}};let L,A,P=!1,O=!1;function B(y){const s=y.createTexture();y.bindTexture(y.TEXTURE_2D,s);try{if(y.texImage2D(y.TEXTURE_2D,0,y.RGBA,y.RGBA,y.UNSIGNED_BYTE,A),y.isContextLost())return;S.supported=!0}catch{}y.deleteTexture(s),P=!0}var U,Y;typeof document<"u"&&(A=document.createElement("img"),A.onload=function(){L&&B(L),L=null,O=!0},A.onerror=function(){P=!0,L=null},A.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(y){let s,h,d,g;y.resetRequestQueue=()=>{s=[],h=0,d=0,g={}},y.addThrottleControl=N=>{const R=d++;return g[R]=N,R},y.removeThrottleControl=N=>{delete g[N],C()},y.getImage=(N,R,z=!0)=>{S.supported&&(N.headers||(N.headers={}),N.headers.accept="image/webp,*/*");const W={requestParameters:N,supportImageRefresh:z,callback:R,cancelled:!1,completed:!1,cancel:()=>{W.completed||W.cancelled||(W.cancelled=!0,W.innerRequest&&(W.innerRequest.cancel(),h--),C())}};return s.push(W),C(),W};const b=N=>{const{requestParameters:R,supportImageRefresh:z,callback:W}=N;return a.e(R,{type:"image"}),(z!==!1||a.i()||a.g(R.url)||R.headers&&!Object.keys(R.headers).reduce((nt,et)=>nt&&et==="accept",!0)?a.m:M)(R,(nt,et,at,Q)=>{I(N,W,nt,et,at,Q)})},I=(N,R,z,W,nt,et)=>{z?R(z):W instanceof HTMLImageElement||a.a(W)?R(null,W):W&&((at,Q)=>{typeof createImageBitmap=="function"?a.b(at,Q):a.d(at,Q)})(W,(at,Q)=>{at!=null?R(at):Q!=null&&R(null,Q,{cacheControl:nt,expires:et})}),N.cancelled||(N.completed=!0,h--,C())},C=()=>{const N=(()=>{const R=Object.keys(g);let z=!1;if(R.length>0){for(const W of R)if(z=g[W](),z)break}return z})()?a.c.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:a.c.MAX_PARALLEL_IMAGE_REQUESTS;for(let R=h;R<N&&s.length>0;R++){const z=s.shift();if(z.cancelled){R--;continue}const W=b(z);h++,z.innerRequest=W}},M=(N,R)=>{const z=new Image,W=N.url;let nt=!1;const et=N.credentials;return et&&et==="include"?z.crossOrigin="use-credentials":(et&&et==="same-origin"||!a.s(W))&&(z.crossOrigin="anonymous"),z.fetchPriority="high",z.onload=()=>{R(null,z),z.onerror=z.onload=null},z.onerror=()=>{nt||R(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")),z.onerror=z.onload=null},z.src=W,{cancel:()=>{nt=!0,z.src=""}}}}(U||(U={})),U.resetRequestQueue(),function(y){y.Glyphs="Glyphs",y.Image="Image",y.Source="Source",y.SpriteImage="SpriteImage",y.SpriteJSON="SpriteJSON",y.Style="Style",y.Tile="Tile",y.Unknown="Unknown"}(Y||(Y={}));class V{constructor(s){this._transformRequestFn=s}transformRequest(s,h){return this._transformRequestFn&&this._transformRequestFn(s,h)||{url:s}}normalizeSpriteURL(s,h,d){const g=function(b){const I=b.match($);if(!I)throw new Error(`Unable to parse URL "${b}"`);return{protocol:I[1],authority:I[2],path:I[3]||"/",params:I[4]?I[4].split("&"):[]}}(s);return g.path+=`${h}${d}`,function(b){const I=b.params.length?`?${b.params.join("&")}`:"";return`${b.protocol}://${b.authority}${b.path}${I}`}(g)}setTransformRequest(s){this._transformRequestFn=s}}const $=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function K(y){var s=new a.A(3);return s[0]=y[0],s[1]=y[1],s[2]=y[2],s}var it,ft=function(y,s,h){return y[0]=s[0]-h[0],y[1]=s[1]-h[1],y[2]=s[2]-h[2],y};it=new a.A(3),a.A!=Float32Array&&(it[0]=0,it[1]=0,it[2]=0);var pt=function(y){var s=y[0],h=y[1];return s*s+h*h};function gt(y){const s=[];if(typeof y=="string")s.push({id:"default",url:y});else if(y&&y.length>0){const h=[];for(const{id:d,url:g}of y){const b=`${d}${g}`;h.indexOf(b)===-1&&(h.push(b),s.push({id:d,url:g}))}}return s}function ut(y,s,h,d,g){if(d)return void y(d);if(g!==Object.values(s).length||g!==Object.values(h).length)return;const b={};for(const I in s){b[I]={};const C=a.h.getImageCanvasContext(h[I]),M=s[I];for(const N in M){const{width:R,height:z,x:W,y:nt,sdf:et,pixelRatio:at,stretchX:Q,stretchY:Lt,content:Ot}=M[N];b[I][N]={data:null,pixelRatio:at,sdf:et,stretchX:Q,stretchY:Lt,content:Ot,spriteData:{width:R,height:z,x:W,y:nt,context:C}}}}y(null,b)}(function(){var y=new a.A(2);a.A!=Float32Array&&(y[0]=0,y[1]=0)})();class St{constructor(s,h,d,g){this.context=s,this.format=d,this.texture=s.gl.createTexture(),this.update(h,g)}update(s,h,d){const{width:g,height:b}=s,I=!(this.size&&this.size[0]===g&&this.size[1]===b||d),{context:C}=this,{gl:M}=C;if(this.useMipmap=!!(h&&h.useMipmap),M.bindTexture(M.TEXTURE_2D,this.texture),C.pixelStoreUnpackFlipY.set(!1),C.pixelStoreUnpack.set(1),C.pixelStoreUnpackPremultiplyAlpha.set(this.format===M.RGBA&&(!h||h.premultiply!==!1)),I)this.size=[g,b],s instanceof HTMLImageElement||s instanceof HTMLCanvasElement||s instanceof HTMLVideoElement||s instanceof ImageData||a.a(s)?M.texImage2D(M.TEXTURE_2D,0,this.format,this.format,M.UNSIGNED_BYTE,s):M.texImage2D(M.TEXTURE_2D,0,this.format,g,b,0,this.format,M.UNSIGNED_BYTE,s.data);else{const{x:N,y:R}=d||{x:0,y:0};s instanceof HTMLImageElement||s instanceof HTMLCanvasElement||s instanceof HTMLVideoElement||s instanceof ImageData||a.a(s)?M.texSubImage2D(M.TEXTURE_2D,0,N,R,M.RGBA,M.UNSIGNED_BYTE,s):M.texSubImage2D(M.TEXTURE_2D,0,N,R,g,b,M.RGBA,M.UNSIGNED_BYTE,s.data)}this.useMipmap&&this.isSizePowerOfTwo()&&M.generateMipmap(M.TEXTURE_2D)}bind(s,h,d){const{context:g}=this,{gl:b}=g;b.bindTexture(b.TEXTURE_2D,this.texture),d!==b.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(d=b.LINEAR),s!==this.filter&&(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,s),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,d||s),this.filter=s),h!==this.wrap&&(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,h),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,h),this.wrap=h)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:s}=this.context;s.deleteTexture(this.texture),this.texture=null}}function _t(y){const{userImage:s}=y;return!!(s&&s.render&&s.render())&&(y.data.replace(new Uint8Array(s.data.buffer)),!0)}class vt extends a.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new a.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(s){if(this.loaded!==s&&(this.loaded=s,s)){for(const{ids:h,callback:d}of this.requestors)this._notify(h,d);this.requestors=[]}}getImage(s){const h=this.images[s];if(h&&!h.data&&h.spriteData){const d=h.spriteData;h.data=new a.R({width:d.width,height:d.height},d.context.getImageData(d.x,d.y,d.width,d.height).data),h.spriteData=null}return h}addImage(s,h){if(this.images[s])throw new Error(`Image id ${s} already exist, use updateImage instead`);this._validate(s,h)&&(this.images[s]=h)}_validate(s,h){let d=!0;const g=h.data||h.spriteData;return this._validateStretch(h.stretchX,g&&g.width)||(this.fire(new a.j(new Error(`Image "${s}" has invalid "stretchX" value`))),d=!1),this._validateStretch(h.stretchY,g&&g.height)||(this.fire(new a.j(new Error(`Image "${s}" has invalid "stretchY" value`))),d=!1),this._validateContent(h.content,h)||(this.fire(new a.j(new Error(`Image "${s}" has invalid "content" value`))),d=!1),d}_validateStretch(s,h){if(!s)return!0;let d=0;for(const g of s){if(g[0]<d||g[1]<g[0]||h<g[1])return!1;d=g[1]}return!0}_validateContent(s,h){if(!s)return!0;if(s.length!==4)return!1;const d=h.spriteData,g=d&&d.width||h.data.width,b=d&&d.height||h.data.height;return!(s[0]<0||g<s[0]||s[1]<0||b<s[1]||s[2]<0||g<s[2]||s[3]<0||b<s[3]||s[2]<s[0]||s[3]<s[1])}updateImage(s,h,d=!0){const g=this.getImage(s);if(d&&(g.data.width!==h.data.width||g.data.height!==h.data.height))throw new Error(`size mismatch between old image (${g.data.width}x${g.data.height}) and new image (${h.data.width}x${h.data.height}).`);h.version=g.version+1,this.images[s]=h,this.updatedImages[s]=!0}removeImage(s){const h=this.images[s];delete this.images[s],delete this.patterns[s],h.userImage&&h.userImage.onRemove&&h.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(s,h){let d=!0;if(!this.isLoaded())for(const g of s)this.images[g]||(d=!1);this.isLoaded()||d?this._notify(s,h):this.requestors.push({ids:s,callback:h})}_notify(s,h){const d={};for(const g of s){let b=this.getImage(g);b||(this.fire(new a.k("styleimagemissing",{id:g})),b=this.getImage(g)),b?d[g]={data:b.data.clone(),pixelRatio:b.pixelRatio,sdf:b.sdf,version:b.version,stretchX:b.stretchX,stretchY:b.stretchY,content:b.content,hasRenderCallback:!!(b.userImage&&b.userImage.render)}:a.w(`Image "${g}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}h(null,d)}getPixelSize(){const{width:s,height:h}=this.atlasImage;return{width:s,height:h}}getPattern(s){const h=this.patterns[s],d=this.getImage(s);if(!d)return null;if(h&&h.position.version===d.version)return h.position;if(h)h.position.version=d.version;else{const g={w:d.data.width+2,h:d.data.height+2,x:0,y:0},b=new a.I(g,d);this.patterns[s]={bin:g,position:b}}return this._updatePatternAtlas(),this.patterns[s].position}bind(s){const h=s.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new St(s,this.atlasImage,h.RGBA),this.atlasTexture.bind(h.LINEAR,h.CLAMP_TO_EDGE)}_updatePatternAtlas(){const s=[];for(const b in this.patterns)s.push(this.patterns[b].bin);const{w:h,h:d}=a.p(s),g=this.atlasImage;g.resize({width:h||1,height:d||1});for(const b in this.patterns){const{bin:I}=this.patterns[b],C=I.x+1,M=I.y+1,N=this.getImage(b).data,R=N.width,z=N.height;a.R.copy(N,g,{x:0,y:0},{x:C,y:M},{width:R,height:z}),a.R.copy(N,g,{x:0,y:z-1},{x:C,y:M-1},{width:R,height:1}),a.R.copy(N,g,{x:0,y:0},{x:C,y:M+z},{width:R,height:1}),a.R.copy(N,g,{x:R-1,y:0},{x:C-1,y:M},{width:1,height:z}),a.R.copy(N,g,{x:0,y:0},{x:C+R,y:M},{width:1,height:z})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(s){for(const h of s){if(this.callbackDispatchedThisFrame[h])continue;this.callbackDispatchedThisFrame[h]=!0;const d=this.getImage(h);d||a.w(`Image with ID: "${h}" was not found`),_t(d)&&this.updateImage(h,d)}}}const ee=1e20;function kt(y,s,h,d,g,b,I,C,M){for(let N=s;N<s+d;N++)Gt(y,h*b+N,b,g,I,C,M);for(let N=h;N<h+g;N++)Gt(y,N*b+s,1,d,I,C,M)}function Gt(y,s,h,d,g,b,I){b[0]=0,I[0]=-ee,I[1]=ee,g[0]=y[s];for(let C=1,M=0,N=0;C<d;C++){g[C]=y[s+C*h];const R=C*C;do{const z=b[M];N=(g[C]-g[z]+R-z*z)/(C-z)/2}while(N<=I[M]&&--M>-1);M++,b[M]=C,I[M]=N,I[M+1]=ee}for(let C=0,M=0;C<d;C++){for(;I[M+1]<C;)M++;const N=b[M],R=C-N;y[s+C*h]=g[N]+R*R}}class Qt{constructor(s,h){this.requestManager=s,this.localIdeographFontFamily=h,this.entries={}}setURL(s){this.url=s}getGlyphs(s,h){const d=[];for(const g in s)for(const b of s[g])d.push({stack:g,id:b});a.o(d,({stack:g,id:b},I)=>{let C=this.entries[g];C||(C=this.entries[g]={glyphs:{},requests:{},ranges:{}});let M=C.glyphs[b];if(M!==void 0)return void I(null,{stack:g,id:b,glyph:M});if(M=this._tinySDF(C,g,b),M)return C.glyphs[b]=M,void I(null,{stack:g,id:b,glyph:M});const N=Math.floor(b/256);if(256*N>65535)return void I(new Error("glyphs > 65535 not supported"));if(C.ranges[N])return void I(null,{stack:g,id:b,glyph:M});if(!this.url)return void I(new Error("glyphsUrl is not set"));let R=C.requests[N];R||(R=C.requests[N]=[],Qt.loadGlyphRange(g,N,this.url,this.requestManager,(z,W)=>{if(W){for(const nt in W)this._doesCharSupportLocalGlyph(+nt)||(C.glyphs[+nt]=W[+nt]);C.ranges[N]=!0}for(const nt of R)nt(z,W);delete C.requests[N]})),R.push((z,W)=>{z?I(z):W&&I(null,{stack:g,id:b,glyph:W[b]||null})})},(g,b)=>{if(g)h(g);else if(b){const I={};for(const{stack:C,id:M,glyph:N}of b)(I[C]||(I[C]={}))[M]=N&&{id:N.id,bitmap:N.bitmap.clone(),metrics:N.metrics};h(null,I)}})}_doesCharSupportLocalGlyph(s){return!!this.localIdeographFontFamily&&(a.u["CJK Unified Ideographs"](s)||a.u["Hangul Syllables"](s)||a.u.Hiragana(s)||a.u.Katakana(s))}_tinySDF(s,h,d){const g=this.localIdeographFontFamily;if(!g||!this._doesCharSupportLocalGlyph(d))return;let b=s.tinySDF;if(!b){let C="400";/bold/i.test(h)?C="900":/medium/i.test(h)?C="500":/light/i.test(h)&&(C="200"),b=s.tinySDF=new Qt.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:g,fontWeight:C})}const I=b.draw(String.fromCharCode(d));return{id:d,bitmap:new a.q({width:I.width||60,height:I.height||60},I.data),metrics:{width:I.glyphWidth/2||24,height:I.glyphHeight/2||24,left:I.glyphLeft/2+.5||0,top:I.glyphTop/2-27.5||-8,advance:I.glyphAdvance/2||24,isDoubleResolution:!0}}}}Qt.loadGlyphRange=function(y,s,h,d,g){const b=256*s,I=b+255,C=d.transformRequest(h.replace("{fontstack}",y).replace("{range}",`${b}-${I}`),Y.Glyphs);a.l(C,(M,N)=>{if(M)g(M);else if(N){const R={};for(const z of a.n(N))R[z.id]=z;g(null,R)}})},Qt.TinySDF=class{constructor({fontSize:y=24,buffer:s=3,radius:h=8,cutoff:d=.25,fontFamily:g="sans-serif",fontWeight:b="normal",fontStyle:I="normal"}={}){this.buffer=s,this.cutoff=d,this.radius=h;const C=this.size=y+4*s,M=this._createCanvas(C),N=this.ctx=M.getContext("2d",{willReadFrequently:!0});N.font=`${I} ${b} ${y}px ${g}`,N.textBaseline="alphabetic",N.textAlign="left",N.fillStyle="black",this.gridOuter=new Float64Array(C*C),this.gridInner=new Float64Array(C*C),this.f=new Float64Array(C),this.z=new Float64Array(C+1),this.v=new Uint16Array(C)}_createCanvas(y){const s=document.createElement("canvas");return s.width=s.height=y,s}draw(y){const{width:s,actualBoundingBoxAscent:h,actualBoundingBoxDescent:d,actualBoundingBoxLeft:g,actualBoundingBoxRight:b}=this.ctx.measureText(y),I=Math.ceil(h),C=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(b-g))),M=Math.min(this.size-this.buffer,I+Math.ceil(d)),N=C+2*this.buffer,R=M+2*this.buffer,z=Math.max(N*R,0),W=new Uint8ClampedArray(z),nt={data:W,width:N,height:R,glyphWidth:C,glyphHeight:M,glyphTop:I,glyphLeft:0,glyphAdvance:s};if(C===0||M===0)return nt;const{ctx:et,buffer:at,gridInner:Q,gridOuter:Lt}=this;et.clearRect(at,at,C,M),et.fillText(y,at,at+I);const Ot=et.getImageData(at,at,C,M);Lt.fill(ee,0,z),Q.fill(0,0,z);for(let ct=0;ct<M;ct++)for(let Pt=0;Pt<C;Pt++){const Bt=Ot.data[4*(ct*C+Pt)+3]/255;if(Bt===0)continue;const Vt=(ct+at)*N+Pt+at;if(Bt===1)Lt[Vt]=0,Q[Vt]=ee;else{const Yt=.5-Bt;Lt[Vt]=Yt>0?Yt*Yt:0,Q[Vt]=Yt<0?Yt*Yt:0}}kt(Lt,0,0,N,R,N,this.f,this.v,this.z),kt(Q,at,at,C,M,N,this.f,this.v,this.z);for(let ct=0;ct<z;ct++){const Pt=Math.sqrt(Lt[ct])-Math.sqrt(Q[ct]);W[ct]=Math.round(255-255*(Pt/this.radius+this.cutoff))}return nt}};class se{constructor(){this.specification=a.v.light.position}possiblyEvaluate(s,h){return a.z(s.expression.evaluate(h))}interpolate(s,h,d){return{x:a.B.number(s.x,h.x,d),y:a.B.number(s.y,h.y,d),z:a.B.number(s.z,h.z,d)}}}let Ce;class yn extends a.E{constructor(s){super(),Ce=Ce||new a.r({anchor:new a.D(a.v.light.anchor),position:new se,color:new a.D(a.v.light.color),intensity:new a.D(a.v.light.intensity)}),this._transitionable=new a.T(Ce),this.setLight(s),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(s,h={}){if(!this._validate(a.t,s,h))for(const d in s){const g=s[d];d.endsWith("-transition")?this._transitionable.setTransition(d.slice(0,-11),g):this._transitionable.setValue(d,g)}}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}_validate(s,h,d){return(!d||d.validate!==!1)&&a.x(this,s.call(a.y,a.e({value:h,style:{glyphs:!0,sprite:!0},styleSpec:a.v})))}}class jn{constructor(s,h){this.width=s,this.height=h,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(s,h){const d=s.join(",")+String(h);return this.dashEntry[d]||(this.dashEntry[d]=this.addDash(s,h)),this.dashEntry[d]}getDashRanges(s,h,d){const g=[];let b=s.length%2==1?-s[s.length-1]*d:0,I=s[0]*d,C=!0;g.push({left:b,right:I,isDash:C,zeroLength:s[0]===0});let M=s[0];for(let N=1;N<s.length;N++){C=!C;const R=s[N];b=M*d,M+=R,I=M*d,g.push({left:b,right:I,isDash:C,zeroLength:R===0})}return g}addRoundDash(s,h,d){const g=h/2;for(let b=-d;b<=d;b++){const I=this.width*(this.nextRow+d+b);let C=0,M=s[C];for(let N=0;N<this.width;N++){N/M.right>1&&(M=s[++C]);const R=Math.abs(N-M.left),z=Math.abs(N-M.right),W=Math.min(R,z);let nt;const et=b/d*(g+1);if(M.isDash){const at=g-Math.abs(et);nt=Math.sqrt(W*W+at*at)}else nt=g-Math.sqrt(W*W+et*et);this.data[I+N]=Math.max(0,Math.min(255,nt+128))}}}addRegularDash(s){for(let C=s.length-1;C>=0;--C){const M=s[C],N=s[C+1];M.zeroLength?s.splice(C,1):N&&N.isDash===M.isDash&&(N.left=M.left,s.splice(C,1))}const h=s[0],d=s[s.length-1];h.isDash===d.isDash&&(h.left=d.left-this.width,d.right=h.right+this.width);const g=this.width*this.nextRow;let b=0,I=s[b];for(let C=0;C<this.width;C++){C/I.right>1&&(I=s[++b]);const M=Math.abs(C-I.left),N=Math.abs(C-I.right),R=Math.min(M,N);this.data[g+C]=Math.max(0,Math.min(255,(I.isDash?R:-R)+128))}}addDash(s,h){const d=h?7:0,g=2*d+1;if(this.nextRow+g>this.height)return a.w("LineAtlas out of space"),null;let b=0;for(let C=0;C<s.length;C++)b+=s[C];if(b!==0){const C=this.width/b,M=this.getDashRanges(s,this.width,C);h?this.addRoundDash(M,C,d):this.addRegularDash(M)}const I={y:(this.nextRow+d+.5)/this.height,height:2*d/this.height,width:b};return this.nextRow+=g,this.dirty=!0,I}bind(s){const h=s.gl;this.texture?(h.bindTexture(h.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,h.texSubImage2D(h.TEXTURE_2D,0,0,0,this.width,this.height,h.ALPHA,h.UNSIGNED_BYTE,this.data))):(this.texture=h.createTexture(),h.bindTexture(h.TEXTURE_2D,this.texture),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.LINEAR),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.LINEAR),h.texImage2D(h.TEXTURE_2D,0,h.ALPHA,this.width,this.height,0,h.ALPHA,h.UNSIGNED_BYTE,this.data))}}class Qe{constructor(s,h,d){this.workerPool=s,this.actors=[],this.currentActor=0,this.id=d;const g=this.workerPool.acquire(d);for(let b=0;b<g.length;b++){const I=new a.C(g[b],h,d);I.name=`Worker ${b}`,this.actors.push(I)}if(!this.actors.length)throw new Error("No actors found")}broadcast(s,h,d){a.o(this.actors,(g,b)=>{g.send(s,h,b)},d=d||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(s=!0){this.actors.forEach(h=>{h.remove()}),this.actors=[],s&&this.workerPool.release(this.id)}}function Fe(y,s,h){const d=function(g,b){if(g)return h(g);if(b){const I=a.F(a.e(b,y),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);b.vector_layers&&(I.vectorLayers=b.vector_layers,I.vectorLayerIds=I.vectorLayers.map(C=>C.id)),h(null,I)}};return y.url?a.f(s.transformRequest(y.url,Y.Source),d):a.h.frame(()=>d(null,y))}class ke{constructor(s,h){s&&(h?this.setSouthWest(s).setNorthEast(h):Array.isArray(s)&&(s.length===4?this.setSouthWest([s[0],s[1]]).setNorthEast([s[2],s[3]]):this.setSouthWest(s[0]).setNorthEast(s[1])))}setNorthEast(s){return this._ne=s instanceof a.L?new a.L(s.lng,s.lat):a.L.convert(s),this}setSouthWest(s){return this._sw=s instanceof a.L?new a.L(s.lng,s.lat):a.L.convert(s),this}extend(s){const h=this._sw,d=this._ne;let g,b;if(s instanceof a.L)g=s,b=s;else{if(!(s instanceof ke))return Array.isArray(s)?s.length===4||s.every(Array.isArray)?this.extend(ke.convert(s)):this.extend(a.L.convert(s)):s&&("lng"in s||"lon"in s)&&"lat"in s?this.extend(a.L.convert(s)):this;if(g=s._sw,b=s._ne,!g||!b)return this}return h||d?(h.lng=Math.min(g.lng,h.lng),h.lat=Math.min(g.lat,h.lat),d.lng=Math.max(b.lng,d.lng),d.lat=Math.max(b.lat,d.lat)):(this._sw=new a.L(g.lng,g.lat),this._ne=new a.L(b.lng,b.lat)),this}getCenter(){return new a.L((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new a.L(this.getWest(),this.getNorth())}getSouthEast(){return new a.L(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(s){const{lng:h,lat:d}=a.L.convert(s);let g=this._sw.lng<=h&&h<=this._ne.lng;return this._sw.lng>this._ne.lng&&(g=this._sw.lng>=h&&h>=this._ne.lng),this._sw.lat<=d&&d<=this._ne.lat&&g}static convert(s){return s instanceof ke?s:s&&new ke(s)}static fromLngLat(s,h=0){const d=360*h/40075017,g=d/Math.cos(Math.PI/180*s.lat);return new ke(new a.L(s.lng-g,s.lat-d),new a.L(s.lng+g,s.lat+d))}}class fn{constructor(s,h,d){this.bounds=ke.convert(this.validateBounds(s)),this.minzoom=h||0,this.maxzoom=d||24}validateBounds(s){return Array.isArray(s)&&s.length===4?[Math.max(-180,s[0]),Math.max(-90,s[1]),Math.min(180,s[2]),Math.min(90,s[3])]:[-180,-90,180,90]}contains(s){const h=Math.pow(2,s.z),d=Math.floor(a.G(this.bounds.getWest())*h),g=Math.floor(a.H(this.bounds.getNorth())*h),b=Math.ceil(a.G(this.bounds.getEast())*h),I=Math.ceil(a.H(this.bounds.getSouth())*h);return s.x>=d&&s.x<b&&s.y>=g&&s.y<I}}class Kn extends a.E{constructor(s,h,d,g){if(super(),this.load=()=>{this._loaded=!1,this.fire(new a.k("dataloading",{dataType:"source"})),this._tileJSONRequest=Fe(this._options,this.map._requestManager,(b,I)=>{this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),b?this.fire(new a.j(b)):I&&(a.e(this,I),I.bounds&&(this.tileBounds=new fn(I.bounds,this.minzoom,this.maxzoom)),this.fire(new a.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.k("data",{dataType:"source",sourceDataType:"content"})))})},this.serialize=()=>a.e({},this._options),this.id=s,this.dispatcher=d,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,a.e(this,a.F(h,["url","scheme","tileSize","promoteId"])),this._options=a.e({type:"vector"},h),this._collectResourceTiming=h.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(g)}loaded(){return this._loaded}hasTile(s){return!this.tileBounds||this.tileBounds.contains(s.canonical)}onAdd(s){this.map=s,this.load()}setSourceProperty(s){this._tileJSONRequest&&this._tileJSONRequest.cancel(),s(),this.load()}setTiles(s){return this.setSourceProperty(()=>{this._options.tiles=s}),this}setUrl(s){return this.setSourceProperty(()=>{this.url=s,this._options.url=s}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}loadTile(s,h){const d=s.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),g={request:this.map._requestManager.transformRequest(d,Y.Tile),uid:s.uid,tileID:s.tileID,zoom:s.tileID.overscaledZ,tileSize:this.tileSize*s.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function b(I,C){return delete s.request,s.aborted?h(null):I&&I.status!==404?h(I):(C&&C.resourceTiming&&(s.resourceTiming=C.resourceTiming),this.map._refreshExpiredTiles&&C&&s.setExpiryData(C),s.loadVectorData(C,this.map.painter),h(null),void(s.reloadCallback&&(this.loadTile(s,s.reloadCallback),s.reloadCallback=null)))}g.request.collectResourceTiming=this._collectResourceTiming,s.actor&&s.state!=="expired"?s.state==="loading"?s.reloadCallback=h:s.request=s.actor.send("reloadTile",g,b.bind(this)):(s.actor=this.dispatcher.getActor(),s.request=s.actor.send("loadTile",g,b.bind(this)))}abortTile(s){s.request&&(s.request.cancel(),delete s.request),s.actor&&s.actor.send("abortTile",{uid:s.uid,type:this.type,source:this.id},void 0)}unloadTile(s){s.unloadVectorData(),s.actor&&s.actor.send("removeTile",{uid:s.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}}class qn extends a.E{constructor(s,h,d,g){super(),this.id=s,this.dispatcher=d,this.setEventedParent(g),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=a.e({type:"raster"},h),a.e(this,a.F(h,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new a.k("dataloading",{dataType:"source"})),this._tileJSONRequest=Fe(this._options,this.map._requestManager,(s,h)=>{this._tileJSONRequest=null,this._loaded=!0,s?this.fire(new a.j(s)):h&&(a.e(this,h),h.bounds&&(this.tileBounds=new fn(h.bounds,this.minzoom,this.maxzoom)),this.fire(new a.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.k("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(s){this.map=s,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}setSourceProperty(s){this._tileJSONRequest&&this._tileJSONRequest.cancel(),s(),this.load()}setTiles(s){return this.setSourceProperty(()=>{this._options.tiles=s}),this}serialize(){return a.e({},this._options)}hasTile(s){return!this.tileBounds||this.tileBounds.contains(s.canonical)}loadTile(s,h){const d=s.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);s.request=U.getImage(this.map._requestManager.transformRequest(d,Y.Tile),(g,b,I)=>{if(delete s.request,s.aborted)s.state="unloaded",h(null);else if(g)s.state="errored",h(g);else if(b){this.map._refreshExpiredTiles&&I&&s.setExpiryData(I);const C=this.map.painter.context,M=C.gl;s.texture=this.map.painter.getTileTexture(b.width),s.texture?s.texture.update(b,{useMipmap:!0}):(s.texture=new St(C,b,M.RGBA,{useMipmap:!0}),s.texture.bind(M.LINEAR,M.CLAMP_TO_EDGE,M.LINEAR_MIPMAP_NEAREST),C.extTextureFilterAnisotropic&&M.texParameterf(M.TEXTURE_2D,C.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,C.extTextureFilterAnisotropicMax)),s.state="loaded",h(null)}},this.map._refreshExpiredTiles)}abortTile(s,h){s.request&&(s.request.cancel(),delete s.request),h()}unloadTile(s,h){s.texture&&this.map.painter.saveTileTexture(s.texture),h()}hasTransition(){return!1}}class re extends qn{constructor(s,h,d,g){super(s,h,d,g),this.type="raster-dem",this.maxzoom=22,this._options=a.e({type:"raster-dem"},h),this.encoding=h.encoding||"mapbox",this.redFactor=h.redFactor,this.greenFactor=h.greenFactor,this.blueFactor=h.blueFactor,this.baseShift=h.baseShift}loadTile(s,h){const d=s.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),g=this.map._requestManager.transformRequest(d,Y.Tile);function b(I,C){I&&(s.state="errored",h(I)),C&&(s.dem=C,s.needsHillshadePrepare=!0,s.needsTerrainPrepare=!0,s.state="loaded",h(null))}s.neighboringTiles=this._getNeighboringTiles(s.tileID),s.request=U.getImage(g,(I,C,M)=>a._(this,void 0,void 0,function*(){if(delete s.request,s.aborted)s.state="unloaded",h(null);else if(I)s.state="errored",h(I);else if(C){this.map._refreshExpiredTiles&&s.setExpiryData(M);const N=a.a(C)&&a.J()?C:yield function(z){return a._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&a.K()){const W=z.width+2,nt=z.height+2;try{return new a.R({width:W,height:nt},yield a.M(z,-1,-1,W,nt))}catch{}}return a.h.getImageData(z,1)})}(C),R={uid:s.uid,coord:s.tileID,source:this.id,rawImageData:N,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};s.actor&&s.state!=="expired"||(s.actor=this.dispatcher.getActor(),s.actor.send("loadDEMTile",R,b))}}),this.map._refreshExpiredTiles)}_getNeighboringTiles(s){const h=s.canonical,d=Math.pow(2,h.z),g=(h.x-1+d)%d,b=h.x===0?s.wrap-1:s.wrap,I=(h.x+1+d)%d,C=h.x+1===d?s.wrap+1:s.wrap,M={};return M[new a.O(s.overscaledZ,b,h.z,g,h.y).key]={backfilled:!1},M[new a.O(s.overscaledZ,C,h.z,I,h.y).key]={backfilled:!1},h.y>0&&(M[new a.O(s.overscaledZ,b,h.z,g,h.y-1).key]={backfilled:!1},M[new a.O(s.overscaledZ,s.wrap,h.z,h.x,h.y-1).key]={backfilled:!1},M[new a.O(s.overscaledZ,C,h.z,I,h.y-1).key]={backfilled:!1}),h.y+1<d&&(M[new a.O(s.overscaledZ,b,h.z,g,h.y+1).key]={backfilled:!1},M[new a.O(s.overscaledZ,s.wrap,h.z,h.x,h.y+1).key]={backfilled:!1},M[new a.O(s.overscaledZ,C,h.z,I,h.y+1).key]={backfilled:!1}),M}unloadTile(s){s.demTexture&&this.map.painter.saveTileTexture(s.demTexture),s.fbo&&(s.fbo.destroy(),delete s.fbo),s.dem&&delete s.dem,delete s.neighboringTiles,s.state="unloaded",s.actor&&s.actor.send("removeDEMTile",{uid:s.uid,source:this.id})}}class De extends a.E{constructor(s,h,d,g){super(),this.load=()=>{this._updateWorkerData()},this.serialize=()=>a.e({},this._options,{type:this.type,data:this._data}),this.id=s,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=d.getActor(),this.setEventedParent(g),this._data=h.data,this._options=a.e({},h),this._collectResourceTiming=h.collectResourceTiming,h.maxzoom!==void 0&&(this.maxzoom=h.maxzoom),h.type&&(this.type=h.type),h.attribution&&(this.attribution=h.attribution),this.promoteId=h.promoteId;const b=a.N/this.tileSize;this.workerOptions=a.e({source:this.id,cluster:h.cluster||!1,geojsonVtOptions:{buffer:(h.buffer!==void 0?h.buffer:128)*b,tolerance:(h.tolerance!==void 0?h.tolerance:.375)*b,extent:a.N,maxZoom:this.maxzoom,lineMetrics:h.lineMetrics||!1,generateId:h.generateId||!1},superclusterOptions:{maxZoom:h.clusterMaxZoom!==void 0?h.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,h.clusterMinPoints||2),extent:a.N,radius:(h.clusterRadius||50)*b,log:!1,generateId:h.generateId||!1},clusterProperties:h.clusterProperties,filter:h.filter},h.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}onAdd(s){this.map=s,this.load()}setData(s){return this._data=s,this._updateWorkerData(),this}updateData(s){return this._updateWorkerData(s),this}setClusterOptions(s){return this.workerOptions.cluster=s.cluster,s&&(s.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=s.clusterRadius),s.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=s.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(s,h){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:s,source:this.id},h),this}getClusterChildren(s,h){return this.actor.send("geojson.getClusterChildren",{clusterId:s,source:this.id},h),this}getClusterLeaves(s,h,d,g){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:s,limit:h,offset:d},g),this}_updateWorkerData(s){const h=a.e({},this.workerOptions);s?h.dataDiff=s:typeof this._data=="string"?(h.request=this.map._requestManager.transformRequest(a.h.resolveURL(this._data),Y.Source),h.request.collectResourceTiming=this._collectResourceTiming):h.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new a.k("dataloading",{dataType:"source"})),this.actor.send(`${this.type}.loadData`,h,(d,g)=>{if(this._pendingLoads--,this._removed||g&&g.abandoned)return void this.fire(new a.k("dataabort",{dataType:"source"}));let b=null;if(g&&g.resourceTiming&&g.resourceTiming[this.id]&&(b=g.resourceTiming[this.id].slice(0)),d)return void this.fire(new a.j(d));const I={dataType:"source"};this._collectResourceTiming&&b&&b.length>0&&a.e(I,{resourceTiming:b}),this.fire(new a.k("data",Object.assign(Object.assign({},I),{sourceDataType:"metadata"}))),this.fire(new a.k("data",Object.assign(Object.assign({},I),{sourceDataType:"content"})))})}loaded(){return this._pendingLoads===0}loadTile(s,h){const d=s.actor?"reloadTile":"loadTile";s.actor=this.actor;const g={type:this.type,uid:s.uid,tileID:s.tileID,zoom:s.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};s.request=this.actor.send(d,g,(b,I)=>(delete s.request,s.unloadVectorData(),s.aborted?h(null):b?h(b):(s.loadVectorData(I,this.map.painter,d==="reloadTile"),h(null))))}abortTile(s){s.request&&(s.request.cancel(),delete s.request),s.aborted=!0}unloadTile(s){s.unloadVectorData(),this.actor.send("removeTile",{uid:s.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}hasTransition(){return!1}}var hn=a.Q([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class On extends a.E{constructor(s,h,d,g){super(),this.load=(b,I)=>{this._loaded=!1,this.fire(new a.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=U.getImage(this.map._requestManager.transformRequest(this.url,Y.Image),(C,M)=>{this._request=null,this._loaded=!0,C?this.fire(new a.j(C)):M&&(this.image=M,b&&(this.coordinates=b),I&&I(),this._finishLoading())})},this.prepare=()=>{if(Object.keys(this.tiles).length===0||!this.image)return;const b=this.map.painter.context,I=b.gl;this.boundsBuffer||(this.boundsBuffer=b.createVertexBuffer(this._boundsArray,hn.members)),this.boundsSegments||(this.boundsSegments=a.S.simpleSegment(0,0,4,2)),this.texture||(this.texture=new St(b,this.image,I.RGBA),this.texture.bind(I.LINEAR,I.CLAMP_TO_EDGE));let C=!1;for(const M in this.tiles){const N=this.tiles[M];N.state!=="loaded"&&(N.state="loaded",N.texture=this.texture,C=!0)}C&&this.fire(new a.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"image",url:this.options.url,coordinates:this.coordinates}),this.id=s,this.dispatcher=d,this.coordinates=h.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(g),this.options=h}loaded(){return this._loaded}updateImage(s){return s.url?(this._request&&(this._request.cancel(),this._request=null),this.options.url=s.url,this.load(s.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new a.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(s){this.map=s,this.load()}onRemove(){this._request&&(this._request.cancel(),this._request=null)}setCoordinates(s){this.coordinates=s;const h=s.map(a.U.fromLngLat);this.tileID=function(g){let b=1/0,I=1/0,C=-1/0,M=-1/0;for(const W of g)b=Math.min(b,W.x),I=Math.min(I,W.y),C=Math.max(C,W.x),M=Math.max(M,W.y);const N=Math.max(C-b,M-I),R=Math.max(0,Math.floor(-Math.log(N)/Math.LN2)),z=Math.pow(2,R);return new a.W(R,Math.floor((b+C)/2*z),Math.floor((I+M)/2*z))}(h),this.minzoom=this.maxzoom=this.tileID.z;const d=h.map(g=>this.tileID.getTilePoint(g)._round());return this._boundsArray=new a.V,this._boundsArray.emplaceBack(d[0].x,d[0].y,0,0),this._boundsArray.emplaceBack(d[1].x,d[1].y,a.N,0),this._boundsArray.emplaceBack(d[3].x,d[3].y,0,a.N),this._boundsArray.emplaceBack(d[2].x,d[2].y,a.N,a.N),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new a.k("data",{dataType:"source",sourceDataType:"content"})),this}loadTile(s,h){this.tileID&&this.tileID.equals(s.tileID.canonical)?(this.tiles[String(s.tileID.wrap)]=s,s.buckets={},h(null)):(s.state="errored",h(null))}hasTransition(){return!1}}class yi extends On{constructor(s,h,d,g){super(s,h,d,g),this.load=()=>{this._loaded=!1;const b=this.options;this.urls=[];for(const I of b.urls)this.urls.push(this.map._requestManager.transformRequest(I,Y.Source).url);a.X(this.urls,(I,C)=>{this._loaded=!0,I?this.fire(new a.j(I)):C&&(this.video=C,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})},this.prepare=()=>{if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const b=this.map.painter.context,I=b.gl;this.boundsBuffer||(this.boundsBuffer=b.createVertexBuffer(this._boundsArray,hn.members)),this.boundsSegments||(this.boundsSegments=a.S.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(I.LINEAR,I.CLAMP_TO_EDGE),I.texSubImage2D(I.TEXTURE_2D,0,0,0,I.RGBA,I.UNSIGNED_BYTE,this.video)):(this.texture=new St(b,this.video,I.RGBA),this.texture.bind(I.LINEAR,I.CLAMP_TO_EDGE));let C=!1;for(const M in this.tiles){const N=this.tiles[M];N.state!=="loaded"&&(N.state="loaded",N.texture=this.texture,C=!0)}C&&this.fire(new a.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"video",urls:this.urls,coordinates:this.coordinates}),this.roundZoom=!0,this.type="video",this.options=h}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(s){if(this.video){const h=this.video.seekable;s<h.start(0)||s>h.end(0)?this.fire(new a.j(new a.Y(`sources.${this.id}`,null,`Playback for this video can be set only between the ${h.start(0)} and ${h.end(0)}-second mark.`))):this.video.currentTime=s}}getVideo(){return this.video}onAdd(s){this.map||(this.map=s,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}hasTransition(){return this.video&&!this.video.paused}}class wn extends On{constructor(s,h,d,g){super(s,h,d,g),this.load=()=>{this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new a.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},this.prepare=()=>{let b=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,b=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,b=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const I=this.map.painter.context,C=I.gl;this.boundsBuffer||(this.boundsBuffer=I.createVertexBuffer(this._boundsArray,hn.members)),this.boundsSegments||(this.boundsSegments=a.S.simpleSegment(0,0,4,2)),this.texture?(b||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new St(I,this.canvas,C.RGBA,{premultiply:!0});let M=!1;for(const N in this.tiles){const R=this.tiles[N];R.state!=="loaded"&&(R.state="loaded",R.texture=this.texture,M=!0)}M&&this.fire(new a.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"canvas",coordinates:this.coordinates}),h.coordinates?Array.isArray(h.coordinates)&&h.coordinates.length===4&&!h.coordinates.some(b=>!Array.isArray(b)||b.length!==2||b.some(I=>typeof I!="number"))||this.fire(new a.j(new a.Y(`sources.${s}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new a.j(new a.Y(`sources.${s}`,null,'missing required property "coordinates"'))),h.animate&&typeof h.animate!="boolean"&&this.fire(new a.j(new a.Y(`sources.${s}`,null,'optional "animate" property must be a boolean value'))),h.canvas?typeof h.canvas=="string"||h.canvas instanceof HTMLCanvasElement||this.fire(new a.j(new a.Y(`sources.${s}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new a.j(new a.Y(`sources.${s}`,null,'missing required property "canvas"'))),this.options=h,this.animate=h.animate===void 0||h.animate}getCanvas(){return this.canvas}onAdd(s){this.map=s,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const s of[this.canvas.width,this.canvas.height])if(isNaN(s)||s<=0)return!0;return!1}}const yt={},Ee=y=>{switch(y){case"geojson":return De;case"image":return On;case"raster":return qn;case"raster-dem":return re;case"vector":return Kn;case"video":return yi;case"canvas":return wn}return yt[y]};function qe(y,s){const h=a.Z();return a.$(h,h,[1,1,0]),a.a0(h,h,[.5*y.width,.5*y.height,1]),a.a1(h,h,y.calculatePosMatrix(s.toUnwrapped()))}function nr(y,s,h,d,g,b){const I=function(z,W,nt){if(z)for(const et of z){const at=W[et];if(at&&at.source===nt&&at.type==="fill-extrusion")return!0}else for(const et in W){const at=W[et];if(at.source===nt&&at.type==="fill-extrusion")return!0}return!1}(g&&g.layers,s,y.id),C=b.maxPitchScaleFactor(),M=y.tilesIn(d,C,I);M.sort(Wn);const N=[];for(const z of M)N.push({wrappedTileID:z.tileID.wrapped().key,queryResults:z.tile.queryRenderedFeatures(s,h,y._state,z.queryGeometry,z.cameraQueryGeometry,z.scale,g,b,C,qe(y.transform,z.tileID))});const R=function(z){const W={},nt={};for(const et of z){const at=et.queryResults,Q=et.wrappedTileID,Lt=nt[Q]=nt[Q]||{};for(const Ot in at){const ct=at[Ot],Pt=Lt[Ot]=Lt[Ot]||{},Bt=W[Ot]=W[Ot]||[];for(const Vt of ct)Pt[Vt.featureIndex]||(Pt[Vt.featureIndex]=!0,Bt.push(Vt))}}return W}(N);for(const z in R)R[z].forEach(W=>{const nt=W.feature,et=y.getFeatureState(nt.layer["source-layer"],nt.id);nt.source=nt.layer.source,nt.layer["source-layer"]&&(nt.sourceLayer=nt.layer["source-layer"]),nt.state=et});return R}function Wn(y,s){const h=y.tileID,d=s.tileID;return h.overscaledZ-d.overscaledZ||h.canonical.y-d.canonical.y||h.wrap-d.wrap||h.canonical.x-d.canonical.x}class pn{constructor(s,h){this.timeAdded=0,this.fadeEndTime=0,this.tileID=s,this.uid=a.a2(),this.uses=0,this.tileSize=h,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(s){const h=s+this.timeAdded;h<this.fadeEndTime||(this.fadeEndTime=h)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(s){this.demTexture&&s.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(s,h,d){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",s){s.featureIndex&&(this.latestFeatureIndex=s.featureIndex,s.rawTileData?(this.latestRawTileData=s.rawTileData,this.latestFeatureIndex.rawTileData=s.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=s.collisionBoxArray,this.buckets=function(g,b){const I={};if(!b)return I;for(const C of g){const M=C.layerIds.map(N=>b.getLayer(N)).filter(Boolean);if(M.length!==0){C.layers=M,C.stateDependentLayerIds&&(C.stateDependentLayers=C.stateDependentLayerIds.map(N=>M.filter(R=>R.id===N)[0]));for(const N of M)I[N.id]=C}}return I}(s.buckets,h.style),this.hasSymbolBuckets=!1;for(const g in this.buckets){const b=this.buckets[g];if(b instanceof a.a4){if(this.hasSymbolBuckets=!0,!d)break;b.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const g in this.buckets){const b=this.buckets[g];if(b instanceof a.a4&&b.hasRTLText){this.hasRTLText=!0,a.a5();break}}this.queryPadding=0;for(const g in this.buckets){const b=this.buckets[g];this.queryPadding=Math.max(this.queryPadding,h.style.getLayer(g).queryRadius(b))}s.imageAtlas&&(this.imageAtlas=s.imageAtlas),s.glyphAtlasImage&&(this.glyphAtlasImage=s.glyphAtlasImage)}else this.collisionBoxArray=new a.a3}unloadVectorData(){for(const s in this.buckets)this.buckets[s].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(s){return this.buckets[s.id]}upload(s){for(const d in this.buckets){const g=this.buckets[d];g.uploadPending()&&g.upload(s)}const h=s.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new St(s,this.imageAtlas.image,h.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new St(s,this.glyphAtlasImage,h.ALPHA),this.glyphAtlasImage=null)}prepare(s){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(s,this.imageAtlasTexture)}queryRenderedFeatures(s,h,d,g,b,I,C,M,N,R){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:g,cameraQueryGeometry:b,scale:I,tileSize:this.tileSize,pixelPosMatrix:R,transform:M,params:C,queryPadding:this.queryPadding*N},s,h,d):{}}querySourceFeatures(s,h){const d=this.latestFeatureIndex;if(!d||!d.rawTileData)return;const g=d.loadVTLayers(),b=h&&h.sourceLayer?h.sourceLayer:"",I=g._geojsonTileLayer||g[b];if(!I)return;const C=a.a6(h&&h.filter),{z:M,x:N,y:R}=this.tileID.canonical,z={z:M,x:N,y:R};for(let W=0;W<I.length;W++){const nt=I.feature(W);if(C.needGeometry){const Q=a.a7(nt,!0);if(!C.filter(new a.a8(this.tileID.overscaledZ),Q,this.tileID.canonical))continue}else if(!C.filter(new a.a8(this.tileID.overscaledZ),nt))continue;const et=d.getId(nt,b),at=new a.a9(nt,M,N,R,et);at.tile=z,s.push(at)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(s){const h=this.expirationTime;if(s.cacheControl){const d=a.aa(s.cacheControl);d["max-age"]&&(this.expirationTime=Date.now()+1e3*d["max-age"])}else s.expires&&(this.expirationTime=new Date(s.expires).getTime());if(this.expirationTime){const d=Date.now();let g=!1;if(this.expirationTime>d)g=!1;else if(h)if(this.expirationTime<h)g=!0;else{const b=this.expirationTime-h;b?this.expirationTime=d+Math.max(b,3e4):g=!0}else g=!0;g?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(s,h){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(s).length===0)return;const d=this.latestFeatureIndex.loadVTLayers();for(const g in this.buckets){if(!h.style.hasLayer(g))continue;const b=this.buckets[g],I=b.layers[0].sourceLayer||"_geojsonTileLayer",C=d[I],M=s[I];if(!C||!M||Object.keys(M).length===0)continue;b.update(M,C,this.imageAtlas&&this.imageAtlas.patternPositions||{});const N=h&&h.style&&h.style.getLayer(g);N&&(this.queryPadding=Math.max(this.queryPadding,N.queryRadius(b)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<a.h.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(s){this.symbolFadeHoldUntil=a.h.now()+s}setDependencies(s,h){const d={};for(const g of h)d[g]=!0;this.dependencies[s]=d}hasDependency(s,h){for(const d of s){const g=this.dependencies[d];if(g){for(const b of h)if(g[b])return!0}}return!1}}class Wi{constructor(s,h){this.max=s,this.onRemove=h,this.reset()}reset(){for(const s in this.data)for(const h of this.data[s])h.timeout&&clearTimeout(h.timeout),this.onRemove(h.value);return this.data={},this.order=[],this}add(s,h,d){const g=s.wrapped().key;this.data[g]===void 0&&(this.data[g]=[]);const b={value:h,timeout:void 0};if(d!==void 0&&(b.timeout=setTimeout(()=>{this.remove(s,b)},d)),this.data[g].push(b),this.order.push(g),this.order.length>this.max){const I=this._getAndRemoveByKey(this.order[0]);I&&this.onRemove(I)}return this}has(s){return s.wrapped().key in this.data}getAndRemove(s){return this.has(s)?this._getAndRemoveByKey(s.wrapped().key):null}_getAndRemoveByKey(s){const h=this.data[s].shift();return h.timeout&&clearTimeout(h.timeout),this.data[s].length===0&&delete this.data[s],this.order.splice(this.order.indexOf(s),1),h.value}getByKey(s){const h=this.data[s];return h?h[0].value:null}get(s){return this.has(s)?this.data[s.wrapped().key][0].value:null}remove(s,h){if(!this.has(s))return this;const d=s.wrapped().key,g=h===void 0?0:this.data[d].indexOf(h),b=this.data[d][g];return this.data[d].splice(g,1),b.timeout&&clearTimeout(b.timeout),this.data[d].length===0&&delete this.data[d],this.onRemove(b.value),this.order.splice(this.order.indexOf(d),1),this}setMaxSize(s){for(this.max=s;this.order.length>this.max;){const h=this._getAndRemoveByKey(this.order[0]);h&&this.onRemove(h)}return this}filter(s){const h=[];for(const d in this.data)for(const g of this.data[d])s(g.value)||h.push(g);for(const d of h)this.remove(d.value.tileID,d)}}class $t{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(s,h,d){const g=String(h);if(this.stateChanges[s]=this.stateChanges[s]||{},this.stateChanges[s][g]=this.stateChanges[s][g]||{},a.e(this.stateChanges[s][g],d),this.deletedStates[s]===null){this.deletedStates[s]={};for(const b in this.state[s])b!==g&&(this.deletedStates[s][b]=null)}else if(this.deletedStates[s]&&this.deletedStates[s][g]===null){this.deletedStates[s][g]={};for(const b in this.state[s][g])d[b]||(this.deletedStates[s][g][b]=null)}else for(const b in d)this.deletedStates[s]&&this.deletedStates[s][g]&&this.deletedStates[s][g][b]===null&&delete this.deletedStates[s][g][b]}removeFeatureState(s,h,d){if(this.deletedStates[s]===null)return;const g=String(h);if(this.deletedStates[s]=this.deletedStates[s]||{},d&&h!==void 0)this.deletedStates[s][g]!==null&&(this.deletedStates[s][g]=this.deletedStates[s][g]||{},this.deletedStates[s][g][d]=null);else if(h!==void 0)if(this.stateChanges[s]&&this.stateChanges[s][g])for(d in this.deletedStates[s][g]={},this.stateChanges[s][g])this.deletedStates[s][g][d]=null;else this.deletedStates[s][g]=null;else this.deletedStates[s]=null}getState(s,h){const d=String(h),g=a.e({},(this.state[s]||{})[d],(this.stateChanges[s]||{})[d]);if(this.deletedStates[s]===null)return{};if(this.deletedStates[s]){const b=this.deletedStates[s][h];if(b===null)return{};for(const I in b)delete g[I]}return g}initializeTileState(s,h){s.setFeatureState(this.state,h)}coalesceChanges(s,h){const d={};for(const g in this.stateChanges){this.state[g]=this.state[g]||{};const b={};for(const I in this.stateChanges[g])this.state[g][I]||(this.state[g][I]={}),a.e(this.state[g][I],this.stateChanges[g][I]),b[I]=this.state[g][I];d[g]=b}for(const g in this.deletedStates){this.state[g]=this.state[g]||{};const b={};if(this.deletedStates[g]===null)for(const I in this.state[g])b[I]={},this.state[g][I]={};else for(const I in this.deletedStates[g]){if(this.deletedStates[g][I]===null)this.state[g][I]={};else for(const C of Object.keys(this.deletedStates[g][I]))delete this.state[g][I][C];b[I]=this.state[g][I]}d[g]=d[g]||{},a.e(d[g],b)}if(this.stateChanges={},this.deletedStates={},Object.keys(d).length!==0)for(const g in s)s[g].setFeatureState(d,h)}}class Vi extends a.E{constructor(s,h,d){super(),this.id=s,this.dispatcher=d,this.on("data",g=>{g.dataType==="source"&&g.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&g.dataType==="source"&&g.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((g,b,I,C)=>{const M=new(Ee(b.type))(g,b,I,C);if(M.id!==g)throw new Error(`Expected Source id to be ${g} instead of ${M.id}`);return M})(s,h,d,this),this._tiles={},this._cache=new Wi(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new $t,this._didEmitContent=!1,this._updated=!1}onAdd(s){this.map=s,this._maxTileCacheSize=s?s._maxTileCacheSize:null,this._maxTileCacheZoomLevels=s?s._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(s)}onRemove(s){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(s)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const s in this._tiles){const h=this._tiles[s];if(h.state!=="loaded"&&h.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const s=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,s&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(s,h){return this._source.loadTile(s,h)}_unloadTile(s){if(this._source.unloadTile)return this._source.unloadTile(s,()=>{})}_abortTile(s){this._source.abortTile&&this._source.abortTile(s,()=>{}),this._source.fire(new a.k("dataabort",{tile:s,coord:s.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(s){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const h in this._tiles){const d=this._tiles[h];d.upload(s),d.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(s=>s.tileID).sort(fr).map(s=>s.key)}getRenderableIds(s){const h=[];for(const d in this._tiles)this._isIdRenderable(d,s)&&h.push(this._tiles[d]);return s?h.sort((d,g)=>{const b=d.tileID,I=g.tileID,C=new a.P(b.canonical.x,b.canonical.y)._rotate(this.transform.angle),M=new a.P(I.canonical.x,I.canonical.y)._rotate(this.transform.angle);return b.overscaledZ-I.overscaledZ||M.y-C.y||M.x-C.x}).map(d=>d.tileID.key):h.map(d=>d.tileID).sort(fr).map(d=>d.key)}hasRenderableParent(s){const h=this.findLoadedParent(s,0);return!!h&&this._isIdRenderable(h.tileID.key)}_isIdRenderable(s,h){return this._tiles[s]&&this._tiles[s].hasData()&&!this._coveredTiles[s]&&(h||!this._tiles[s].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const s in this._tiles)this._tiles[s].state!=="errored"&&this._reloadTile(s,"reloading")}}_reloadTile(s,h){const d=this._tiles[s];d&&(d.state!=="loading"&&(d.state=h),this._loadTile(d,this._tileLoaded.bind(this,d,s,h)))}_tileLoaded(s,h,d,g){if(g)return s.state="errored",void(g.status!==404?this._source.fire(new a.j(g,{tile:s})):this.update(this.transform,this.terrain));s.timeAdded=a.h.now(),d==="expired"&&(s.refreshedUponExpiration=!0),this._setTileReloadTimer(h,s),this.getSource().type==="raster-dem"&&s.dem&&this._backfillDEM(s),this._state.initializeTileState(s,this.map?this.map.painter:null),s.aborted||this._source.fire(new a.k("data",{dataType:"source",tile:s,coord:s.tileID}))}_backfillDEM(s){const h=this.getRenderableIds();for(let g=0;g<h.length;g++){const b=h[g];if(s.neighboringTiles&&s.neighboringTiles[b]){const I=this.getTileByID(b);d(s,I),d(I,s)}}function d(g,b){g.needsHillshadePrepare=!0,g.needsTerrainPrepare=!0;let I=b.tileID.canonical.x-g.tileID.canonical.x;const C=b.tileID.canonical.y-g.tileID.canonical.y,M=Math.pow(2,g.tileID.canonical.z),N=b.tileID.key;I===0&&C===0||Math.abs(C)>1||(Math.abs(I)>1&&(Math.abs(I+M)===1?I+=M:Math.abs(I-M)===1&&(I-=M)),b.dem&&g.dem&&(g.dem.backfillBorder(b.dem,I,C),g.neighboringTiles&&g.neighboringTiles[N]&&(g.neighboringTiles[N].backfilled=!0)))}}getTile(s){return this.getTileByID(s.key)}getTileByID(s){return this._tiles[s]}_retainLoadedChildren(s,h,d,g){for(const b in this._tiles){let I=this._tiles[b];if(g[b]||!I.hasData()||I.tileID.overscaledZ<=h||I.tileID.overscaledZ>d)continue;let C=I.tileID;for(;I&&I.tileID.overscaledZ>h+1;){const N=I.tileID.scaledTo(I.tileID.overscaledZ-1);I=this._tiles[N.key],I&&I.hasData()&&(C=N)}let M=C;for(;M.overscaledZ>h;)if(M=M.scaledTo(M.overscaledZ-1),s[M.key]){g[C.key]=C;break}}}findLoadedParent(s,h){if(s.key in this._loadedParentTiles){const d=this._loadedParentTiles[s.key];return d&&d.tileID.overscaledZ>=h?d:null}for(let d=s.overscaledZ-1;d>=h;d--){const g=s.scaledTo(d),b=this._getLoadedTile(g);if(b)return b}}_getLoadedTile(s){const h=this._tiles[s.key];return h&&h.hasData()?h:this._cache.getByKey(s.wrapped().key)}updateCacheSize(s){const h=Math.ceil(s.width/this._source.tileSize)+1,d=Math.ceil(s.height/this._source.tileSize)+1,g=Math.floor(h*d*(this._maxTileCacheZoomLevels===null?a.c.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),b=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,g):g;this._cache.setMaxSize(b)}handleWrapJump(s){const h=Math.round((s-(this._prevLng===void 0?s:this._prevLng))/360);if(this._prevLng=s,h){const d={};for(const g in this._tiles){const b=this._tiles[g];b.tileID=b.tileID.unwrapTo(b.tileID.wrap+h),d[b.tileID.key]=b}this._tiles=d;for(const g in this._timers)clearTimeout(this._timers[g]),delete this._timers[g];for(const g in this._tiles)this._setTileReloadTimer(g,this._tiles[g])}}update(s,h){if(this.transform=s,this.terrain=h,!this._sourceLoaded||this._paused)return;let d;this.updateCacheSize(s),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?d=s.getVisibleUnwrappedCoordinates(this._source.tileID).map(R=>new a.O(R.canonical.z,R.wrap,R.canonical.z,R.canonical.x,R.canonical.y)):(d=s.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:h}),this._source.hasTile&&(d=d.filter(R=>this._source.hasTile(R)))):d=[];const g=s.coveringZoomLevel(this._source),b=Math.max(g-Vi.maxOverzooming,this._source.minzoom),I=Math.max(g+Vi.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const R={};for(const z of d)if(z.canonical.z>this._source.minzoom){const W=z.scaledTo(z.canonical.z-1);R[W.key]=W;const nt=z.scaledTo(Math.max(this._source.minzoom,Math.min(z.canonical.z,5)));R[nt.key]=nt}d=d.concat(Object.values(R))}const C=d.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,C&&this.fire(new a.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const M=this._updateRetainedTiles(d,g);if(zn(this._source.type)){const R={},z={},W=Object.keys(M),nt=a.h.now();for(const et of W){const at=M[et],Q=this._tiles[et];if(!Q||Q.fadeEndTime!==0&&Q.fadeEndTime<=nt)continue;const Lt=this.findLoadedParent(at,b);Lt&&(this._addTile(Lt.tileID),R[Lt.tileID.key]=Lt.tileID),z[et]=at}this._retainLoadedChildren(z,g,I,M);for(const et in R)M[et]||(this._coveredTiles[et]=!0,M[et]=R[et]);if(h){const et={},at={};for(const Q of d)this._tiles[Q.key].hasData()?et[Q.key]=Q:at[Q.key]=Q;for(const Q in at){const Lt=at[Q].children(this._source.maxzoom);this._tiles[Lt[0].key]&&this._tiles[Lt[1].key]&&this._tiles[Lt[2].key]&&this._tiles[Lt[3].key]&&(et[Lt[0].key]=M[Lt[0].key]=Lt[0],et[Lt[1].key]=M[Lt[1].key]=Lt[1],et[Lt[2].key]=M[Lt[2].key]=Lt[2],et[Lt[3].key]=M[Lt[3].key]=Lt[3],delete at[Q])}for(const Q in at){const Lt=this.findLoadedParent(at[Q],this._source.minzoom);if(Lt){et[Lt.tileID.key]=M[Lt.tileID.key]=Lt.tileID;for(const Ot in et)et[Ot].isChildOf(Lt.tileID)&&delete et[Ot]}}for(const Q in this._tiles)et[Q]||(this._coveredTiles[Q]=!0)}}for(const R in M)this._tiles[R].clearFadeHold();const N=a.ab(this._tiles,M);for(const R of N){const z=this._tiles[R];z.hasSymbolBuckets&&!z.holdingForFade()?z.setHoldDuration(this.map._fadeDuration):z.hasSymbolBuckets&&!z.symbolFadeFinished()||this._removeTile(R)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const s in this._tiles)this._tiles[s].holdingForFade()&&this._removeTile(s)}_updateRetainedTiles(s,h){const d={},g={},b=Math.max(h-Vi.maxOverzooming,this._source.minzoom),I=Math.max(h+Vi.maxUnderzooming,this._source.minzoom),C={};for(const M of s){const N=this._addTile(M);d[M.key]=M,N.hasData()||h<this._source.maxzoom&&(C[M.key]=M)}this._retainLoadedChildren(C,h,I,d);for(const M of s){let N=this._tiles[M.key];if(N.hasData())continue;if(h+1>this._source.maxzoom){const z=M.children(this._source.maxzoom)[0],W=this.getTile(z);if(W&&W.hasData()){d[z.key]=z;continue}}else{const z=M.children(this._source.maxzoom);if(d[z[0].key]&&d[z[1].key]&&d[z[2].key]&&d[z[3].key])continue}let R=N.wasRequested();for(let z=M.overscaledZ-1;z>=b;--z){const W=M.scaledTo(z);if(g[W.key])break;if(g[W.key]=!0,N=this.getTile(W),!N&&R&&(N=this._addTile(W)),N){const nt=N.hasData();if((R||nt)&&(d[W.key]=W),R=N.wasRequested(),nt)break}}}return d}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const s in this._tiles){const h=[];let d,g=this._tiles[s].tileID;for(;g.overscaledZ>0;){if(g.key in this._loadedParentTiles){d=this._loadedParentTiles[g.key];break}h.push(g.key);const b=g.scaledTo(g.overscaledZ-1);if(d=this._getLoadedTile(b),d)break;g=b}for(const b of h)this._loadedParentTiles[b]=d}}_addTile(s){let h=this._tiles[s.key];if(h)return h;h=this._cache.getAndRemove(s),h&&(this._setTileReloadTimer(s.key,h),h.tileID=s,this._state.initializeTileState(h,this.map?this.map.painter:null),this._cacheTimers[s.key]&&(clearTimeout(this._cacheTimers[s.key]),delete this._cacheTimers[s.key],this._setTileReloadTimer(s.key,h)));const d=h;return h||(h=new pn(s,this._source.tileSize*s.overscaleFactor()),this._loadTile(h,this._tileLoaded.bind(this,h,s.key,h.state))),h.uses++,this._tiles[s.key]=h,d||this._source.fire(new a.k("dataloading",{tile:h,coord:h.tileID,dataType:"source"})),h}_setTileReloadTimer(s,h){s in this._timers&&(clearTimeout(this._timers[s]),delete this._timers[s]);const d=h.getExpiryTimeout();d&&(this._timers[s]=setTimeout(()=>{this._reloadTile(s,"expired"),delete this._timers[s]},d))}_removeTile(s){const h=this._tiles[s];h&&(h.uses--,delete this._tiles[s],this._timers[s]&&(clearTimeout(this._timers[s]),delete this._timers[s]),h.uses>0||(h.hasData()&&h.state!=="reloading"?this._cache.add(h.tileID,h,h.getExpiryTimeout()):(h.aborted=!0,this._abortTile(h),this._unloadTile(h))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const s in this._tiles)this._removeTile(s);this._cache.reset()}tilesIn(s,h,d){const g=[],b=this.transform;if(!b)return g;const I=d?b.getCameraQueryGeometry(s):s,C=s.map(et=>b.pointCoordinate(et,this.terrain)),M=I.map(et=>b.pointCoordinate(et,this.terrain)),N=this.getIds();let R=1/0,z=1/0,W=-1/0,nt=-1/0;for(const et of M)R=Math.min(R,et.x),z=Math.min(z,et.y),W=Math.max(W,et.x),nt=Math.max(nt,et.y);for(let et=0;et<N.length;et++){const at=this._tiles[N[et]];if(at.holdingForFade())continue;const Q=at.tileID,Lt=Math.pow(2,b.zoom-at.tileID.overscaledZ),Ot=h*at.queryPadding*a.N/at.tileSize/Lt,ct=[Q.getTilePoint(new a.U(R,z)),Q.getTilePoint(new a.U(W,nt))];if(ct[0].x-Ot<a.N&&ct[0].y-Ot<a.N&&ct[1].x+Ot>=0&&ct[1].y+Ot>=0){const Pt=C.map(Vt=>Q.getTilePoint(Vt)),Bt=M.map(Vt=>Q.getTilePoint(Vt));g.push({tile:at,tileID:Q,queryGeometry:Pt,cameraQueryGeometry:Bt,scale:Lt})}}return g}getVisibleCoordinates(s){const h=this.getRenderableIds(s).map(d=>this._tiles[d].tileID);for(const d of h)d.posMatrix=this.transform.calculatePosMatrix(d.toUnwrapped());return h}hasTransition(){if(this._source.hasTransition())return!0;if(zn(this._source.type)){const s=a.h.now();for(const h in this._tiles)if(this._tiles[h].fadeEndTime>=s)return!0}return!1}setFeatureState(s,h,d){this._state.updateState(s=s||"_geojsonTileLayer",h,d)}removeFeatureState(s,h,d){this._state.removeFeatureState(s=s||"_geojsonTileLayer",h,d)}getFeatureState(s,h){return this._state.getState(s=s||"_geojsonTileLayer",h)}setDependencies(s,h,d){const g=this._tiles[s];g&&g.setDependencies(h,d)}reloadTilesForDependencies(s,h){for(const d in this._tiles)this._tiles[d].hasDependency(s,h)&&this._reloadTile(d,"reloading");this._cache.filter(d=>!d.hasDependency(s,h))}}function fr(y,s){const h=Math.abs(2*y.wrap)-+(y.wrap<0),d=Math.abs(2*s.wrap)-+(s.wrap<0);return y.overscaledZ-s.overscaledZ||d-h||s.canonical.y-y.canonical.y||s.canonical.x-y.canonical.x}function zn(y){return y==="raster"||y==="image"||y==="video"}Vi.maxOverzooming=10,Vi.maxUnderzooming=3;const In="mapboxgl_preloaded_worker_pool";class es{constructor(){this.active={}}acquire(s){if(!this.workers)for(this.workers=[];this.workers.length<es.workerCount;)this.workers.push(new Worker(a.c.WORKER_URL));return this.active[s]=!0,this.workers.slice()}release(s){delete this.active[s],this.numActive()===0&&(this.workers.forEach(h=>{h.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[In]}numActive(){return Object.keys(this.active).length}}const oo=Math.floor(a.h.hardwareConcurrency/2);let ns;function Ha(){return ns||(ns=new es),ns}es.workerCount=a.ac(globalThis)?Math.max(Math.min(oo,3),1):1;class Gs{constructor(s,h){this.reset(s,h)}reset(s,h){this.points=s||[],this._distances=[0];for(let d=1;d<this.points.length;d++)this._distances[d]=this._distances[d-1]+this.points[d].dist(this.points[d-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(h||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(s){if(this.points.length===1)return this.points[0];s=a.ad(s,0,1);let h=1,d=this._distances[h];const g=s*this.paddedLength+this.padding;for(;d<g&&h<this._distances.length;)d=this._distances[++h];const b=h-1,I=this._distances[b],C=d-I,M=C>0?(g-I)/C:0;return this.points[b].mult(1-M).add(this.points[h].mult(M))}}function js(y,s){let h=!0;return y==="always"||y!=="never"&&s!=="never"||(h=!1),h}class Sa{constructor(s,h,d){const g=this.boxCells=[],b=this.circleCells=[];this.xCellCount=Math.ceil(s/d),this.yCellCount=Math.ceil(h/d);for(let I=0;I<this.xCellCount*this.yCellCount;I++)g.push([]),b.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=s,this.height=h,this.xScale=this.xCellCount/s,this.yScale=this.yCellCount/h,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(s,h,d,g,b){this._forEachCell(h,d,g,b,this._insertBoxCell,this.boxUid++),this.boxKeys.push(s),this.bboxes.push(h),this.bboxes.push(d),this.bboxes.push(g),this.bboxes.push(b)}insertCircle(s,h,d,g){this._forEachCell(h-g,d-g,h+g,d+g,this._insertCircleCell,this.circleUid++),this.circleKeys.push(s),this.circles.push(h),this.circles.push(d),this.circles.push(g)}_insertBoxCell(s,h,d,g,b,I){this.boxCells[b].push(I)}_insertCircleCell(s,h,d,g,b,I){this.circleCells[b].push(I)}_query(s,h,d,g,b,I,C){if(d<0||s>this.width||g<0||h>this.height)return[];const M=[];if(s<=0&&h<=0&&this.width<=d&&this.height<=g){if(b)return[{key:null,x1:s,y1:h,x2:d,y2:g}];for(let N=0;N<this.boxKeys.length;N++)M.push({key:this.boxKeys[N],x1:this.bboxes[4*N],y1:this.bboxes[4*N+1],x2:this.bboxes[4*N+2],y2:this.bboxes[4*N+3]});for(let N=0;N<this.circleKeys.length;N++){const R=this.circles[3*N],z=this.circles[3*N+1],W=this.circles[3*N+2];M.push({key:this.circleKeys[N],x1:R-W,y1:z-W,x2:R+W,y2:z+W})}}else this._forEachCell(s,h,d,g,this._queryCell,M,{hitTest:b,overlapMode:I,seenUids:{box:{},circle:{}}},C);return M}query(s,h,d,g){return this._query(s,h,d,g,!1,null)}hitTest(s,h,d,g,b,I){return this._query(s,h,d,g,!0,b,I).length>0}hitTestCircle(s,h,d,g,b){const I=s-d,C=s+d,M=h-d,N=h+d;if(C<0||I>this.width||N<0||M>this.height)return!1;const R=[];return this._forEachCell(I,M,C,N,this._queryCellCircle,R,{hitTest:!0,overlapMode:g,circle:{x:s,y:h,radius:d},seenUids:{box:{},circle:{}}},b),R.length>0}_queryCell(s,h,d,g,b,I,C,M){const{seenUids:N,hitTest:R,overlapMode:z}=C,W=this.boxCells[b];if(W!==null){const et=this.bboxes;for(const at of W)if(!N.box[at]){N.box[at]=!0;const Q=4*at,Lt=this.boxKeys[at];if(s<=et[Q+2]&&h<=et[Q+3]&&d>=et[Q+0]&&g>=et[Q+1]&&(!M||M(Lt))&&(!R||!js(z,Lt.overlapMode))&&(I.push({key:Lt,x1:et[Q],y1:et[Q+1],x2:et[Q+2],y2:et[Q+3]}),R))return!0}}const nt=this.circleCells[b];if(nt!==null){const et=this.circles;for(const at of nt)if(!N.circle[at]){N.circle[at]=!0;const Q=3*at,Lt=this.circleKeys[at];if(this._circleAndRectCollide(et[Q],et[Q+1],et[Q+2],s,h,d,g)&&(!M||M(Lt))&&(!R||!js(z,Lt.overlapMode))){const Ot=et[Q],ct=et[Q+1],Pt=et[Q+2];if(I.push({key:Lt,x1:Ot-Pt,y1:ct-Pt,x2:Ot+Pt,y2:ct+Pt}),R)return!0}}}return!1}_queryCellCircle(s,h,d,g,b,I,C,M){const{circle:N,seenUids:R,overlapMode:z}=C,W=this.boxCells[b];if(W!==null){const et=this.bboxes;for(const at of W)if(!R.box[at]){R.box[at]=!0;const Q=4*at,Lt=this.boxKeys[at];if(this._circleAndRectCollide(N.x,N.y,N.radius,et[Q+0],et[Q+1],et[Q+2],et[Q+3])&&(!M||M(Lt))&&!js(z,Lt.overlapMode))return I.push(!0),!0}}const nt=this.circleCells[b];if(nt!==null){const et=this.circles;for(const at of nt)if(!R.circle[at]){R.circle[at]=!0;const Q=3*at,Lt=this.circleKeys[at];if(this._circlesCollide(et[Q],et[Q+1],et[Q+2],N.x,N.y,N.radius)&&(!M||M(Lt))&&!js(z,Lt.overlapMode))return I.push(!0),!0}}}_forEachCell(s,h,d,g,b,I,C,M){const N=this._convertToXCellCoord(s),R=this._convertToYCellCoord(h),z=this._convertToXCellCoord(d),W=this._convertToYCellCoord(g);for(let nt=N;nt<=z;nt++)for(let et=R;et<=W;et++)if(b.call(this,s,h,d,g,this.xCellCount*et+nt,I,C,M))return}_convertToXCellCoord(s){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(s*this.xScale)))}_convertToYCellCoord(s){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(s*this.yScale)))}_circlesCollide(s,h,d,g,b,I){const C=g-s,M=b-h,N=d+I;return N*N>C*C+M*M}_circleAndRectCollide(s,h,d,g,b,I,C){const M=(I-g)/2,N=Math.abs(s-(g+M));if(N>M+d)return!1;const R=(C-b)/2,z=Math.abs(h-(b+R));if(z>R+d)return!1;if(N<=M||z<=R)return!0;const W=N-M,nt=z-R;return W*W+nt*nt<=d*d}}function le(y,s,h,d,g){const b=a.Z();return s?(a.a0(b,b,[1/g,1/g,1]),h||a.ae(b,b,d.angle)):a.a1(b,d.labelPlaneMatrix,y),b}function yo(y,s,h,d,g){if(s){const b=a.af(y);return a.a0(b,b,[g,g,1]),h||a.ae(b,b,-d.angle),b}return d.glCoordMatrix}function ri(y,s,h){let d;h?(d=[y.x,y.y,h(y.x,y.y),1],a.ag(d,d,s)):(d=[y.x,y.y,0,1],Z(d,d,s));const g=d[3];return{point:new a.P(d[0]/g,d[1]/g),signedDistanceFromCamera:g}}function Ea(y,s){return .5+y/s*.5}function ws(y,s){const h=y[0]/y[3],d=y[1]/y[3];return h>=-s[0]&&h<=s[0]&&d>=-s[1]&&d<=s[1]}function ce(y,s,h,d,g,b,I,C,M,N){const R=d?y.textSizeData:y.iconSizeData,z=a.ah(R,h.transform.zoom),W=[256/h.width*2+1,256/h.height*2+1],nt=d?y.text.dynamicLayoutVertexArray:y.icon.dynamicLayoutVertexArray;nt.clear();const et=y.lineVertexArray,at=d?y.text.placedSymbolArray:y.icon.placedSymbolArray,Q=h.transform.width/h.transform.height;let Lt=!1;for(let Ot=0;Ot<at.length;Ot++){const ct=at.get(Ot);if(ct.hidden||ct.writingMode===a.ai.vertical&&!Lt){J(ct.numGlyphs,nt);continue}let Pt;if(Lt=!1,N?(Pt=[ct.anchorX,ct.anchorY,N(ct.anchorX,ct.anchorY),1],a.ag(Pt,Pt,s)):(Pt=[ct.anchorX,ct.anchorY,0,1],Z(Pt,Pt,s)),!ws(Pt,W)){J(ct.numGlyphs,nt);continue}const Bt=Ea(h.transform.cameraToCenterDistance,Pt[3]),Vt=a.aj(R,z,ct),Yt=I?Vt/Bt:Vt*Bt,ne=new a.P(ct.anchorX,ct.anchorY),te=ri(ne,g,N).point,ae={projections:{},offsets:{}},Le=Ar(ct,Yt,!1,C,s,g,b,y.glyphOffsetArray,et,nt,te,ne,ae,Q,M,N);Lt=Le.useVertical,(Le.notEnoughRoom||Lt||Le.needsFlipping&&Ar(ct,Yt,!0,C,s,g,b,y.glyphOffsetArray,et,nt,te,ne,ae,Q,M,N).notEnoughRoom)&&J(ct.numGlyphs,nt)}d?y.text.dynamicLayoutVertexBuffer.updateData(nt):y.icon.dynamicLayoutVertexBuffer.updateData(nt)}function ln(y,s,h,d,g,b,I,C,M,N,R,z,W){const nt=C.glyphStartIndex+C.numGlyphs,et=C.lineStartIndex,at=C.lineStartIndex+C.lineLength,Q=s.getoffsetX(C.glyphStartIndex),Lt=s.getoffsetX(nt-1),Ot=G(y*Q,h,d,g,b,I,C.segment,et,at,M,N,R,z,W);if(!Ot)return null;const ct=G(y*Lt,h,d,g,b,I,C.segment,et,at,M,N,R,z,W);return ct?{first:Ot,last:ct}:null}function Ke(y,s,h,d){return y===a.ai.horizontal&&Math.abs(h.y-s.y)>Math.abs(h.x-s.x)*d?{useVertical:!0}:(y===a.ai.vertical?s.y<h.y:s.x>h.x)?{needsFlipping:!0}:null}function Ar(y,s,h,d,g,b,I,C,M,N,R,z,W,nt,et,at){const Q=s/24,Lt=y.lineOffsetX*Q,Ot=y.lineOffsetY*Q;let ct;if(y.numGlyphs>1){const Pt=y.glyphStartIndex+y.numGlyphs,Bt=y.lineStartIndex,Vt=y.lineStartIndex+y.lineLength,Yt=ln(Q,C,Lt,Ot,h,R,z,y,M,b,W,et,at);if(!Yt)return{notEnoughRoom:!0};const ne=ri(Yt.first.point,I,at).point,te=ri(Yt.last.point,I,at).point;if(d&&!h){const ae=Ke(y.writingMode,ne,te,nt);if(ae)return ae}ct=[Yt.first];for(let ae=y.glyphStartIndex+1;ae<Pt-1;ae++)ct.push(G(Q*C.getoffsetX(ae),Lt,Ot,h,R,z,y.segment,Bt,Vt,M,b,W,et,at));ct.push(Yt.last)}else{if(d&&!h){const Bt=ri(z,g,at).point,Vt=y.lineStartIndex+y.segment+1,Yt=new a.P(M.getx(Vt),M.gety(Vt)),ne=ri(Yt,g,at),te=ne.signedDistanceFromCamera>0?ne.point:is(z,Yt,Bt,1,g,at),ae=Ke(y.writingMode,Bt,te,nt);if(ae)return ae}const Pt=G(Q*C.getoffsetX(y.glyphStartIndex),Lt,Ot,h,R,z,y.segment,y.lineStartIndex,y.lineStartIndex+y.lineLength,M,b,W,et,at);if(!Pt)return{notEnoughRoom:!0};ct=[Pt]}for(const Pt of ct)a.ak(N,Pt.point,Pt.angle);return{}}function is(y,s,h,d,g,b){const I=ri(y.add(y.sub(s)._unit()),g,b).point,C=h.sub(I);return h.add(C._mult(d/C.mag()))}function on(y,s){const{projectionCache:h,lineVertexArray:d,labelPlaneMatrix:g,tileAnchorPoint:b,distanceFromAnchor:I,getElevation:C,previousVertex:M,direction:N,absOffsetX:R}=s;if(h.projections[y])return h.projections[y];const z=new a.P(d.getx(y),d.gety(y)),W=ri(z,g,C);if(W.signedDistanceFromCamera>0)return h.projections[y]=W.point,W.point;const nt=y-N;return is(I===0?b:new a.P(d.getx(nt),d.gety(nt)),z,M,R-I+1,g,C)}function Ss(y,s,h){return y._unit()._perp()._mult(s*h)}function st(y,s,h,d,g,b,I,C){const{projectionCache:M,direction:N}=C;if(M.offsets[y])return M.offsets[y];const R=h.add(s);if(y+N<d||y+N>=g)return M.offsets[y]=R,R;const z=on(y+N,C),W=Ss(z.sub(h),I,N),nt=h.add(W),et=z.add(W);return M.offsets[y]=a.al(b,R,nt,et)||R,M.offsets[y]}function G(y,s,h,d,g,b,I,C,M,N,R,z,W,nt){const et=d?y-s:y+s;let at=et>0?1:-1,Q=0;d&&(at*=-1,Q=Math.PI),at<0&&(Q+=Math.PI);let Lt,Ot,ct=at>0?C+I:C+I+1,Pt=g,Bt=g,Vt=0,Yt=0;const ne=Math.abs(et),te=[];let ae;for(;Vt+Yt<=ne;){if(ct+=at,ct<C||ct>=M)return null;Vt+=Yt,Bt=Pt,Ot=Lt;const pe={projectionCache:z,lineVertexArray:N,labelPlaneMatrix:R,tileAnchorPoint:b,distanceFromAnchor:Vt,getElevation:nt,previousVertex:Bt,direction:at,absOffsetX:ne};if(Pt=on(ct,pe),h===0)te.push(Bt),ae=Pt.sub(Bt);else{let Ge;const Pe=Pt.sub(Bt);Ge=Pe.mag()===0?Ss(on(ct+at,pe).sub(Pt),h,at):Ss(Pe,h,at),Ot||(Ot=Bt.add(Ge)),Lt=st(ct,Ge,Pt,C,M,Ot,h,pe),te.push(Ot),ae=Lt.sub(Ot)}Yt=ae.mag()}const Le=ae._mult((ne-Vt)/Yt)._add(Ot||Bt),vn=Q+Math.atan2(Pt.y-Bt.y,Pt.x-Bt.x);return te.push(Le),{point:Le,angle:W?vn:0,path:te}}const q=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function J(y,s){for(let h=0;h<y;h++){const d=s.length;s.resize(d+4),s.float32.set(q,3*d)}}function Z(y,s,h){const d=s[0],g=s[1];return y[0]=h[0]*d+h[4]*g+h[12],y[1]=h[1]*d+h[5]*g+h[13],y[3]=h[3]*d+h[7]*g+h[15],y}const ot=100;class Mt{constructor(s,h=new Sa(s.width+200,s.height+200,25),d=new Sa(s.width+200,s.height+200,25)){this.transform=s,this.grid=h,this.ignoredGrid=d,this.pitchfactor=Math.cos(s._pitch)*s.cameraToCenterDistance,this.screenRightBoundary=s.width+ot,this.screenBottomBoundary=s.height+ot,this.gridRightBoundary=s.width+200,this.gridBottomBoundary=s.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(s,h,d,g,b,I){const C=this.projectAndGetPerspectiveRatio(g,s.anchorPointX,s.anchorPointY,I),M=d*C.perspectiveRatio,N=s.x1*M+C.point.x,R=s.y1*M+C.point.y,z=s.x2*M+C.point.x,W=s.y2*M+C.point.y;return!this.isInsideGrid(N,R,z,W)||h!=="always"&&this.grid.hitTest(N,R,z,W,h,b)||C.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[N,R,z,W],offscreen:this.isOffscreen(N,R,z,W)}}placeCollisionCircles(s,h,d,g,b,I,C,M,N,R,z,W,nt,et){const at=[],Q=new a.P(h.anchorX,h.anchorY),Lt=ri(Q,I,et),Ot=Ea(this.transform.cameraToCenterDistance,Lt.signedDistanceFromCamera),ct=(R?b/Ot:b*Ot)/a.ap,Pt=ri(Q,C,et).point,Bt=ln(ct,g,h.lineOffsetX*ct,h.lineOffsetY*ct,!1,Pt,Q,h,d,C,{projections:{},offsets:{}},!1,et);let Vt=!1,Yt=!1,ne=!0;if(Bt){const te=.5*W*Ot+nt,ae=new a.P(-100,-100),Le=new a.P(this.screenRightBoundary,this.screenBottomBoundary),vn=new Gs,pe=Bt.first,Ge=Bt.last;let Pe=[];for(let un=pe.path.length-1;un>=1;un--)Pe.push(pe.path[un]);for(let un=1;un<Ge.path.length;un++)Pe.push(Ge.path[un]);const Hn=2.5*te;if(M){const un=Pe.map(bn=>ri(bn,M,et));Pe=un.some(bn=>bn.signedDistanceFromCamera<=0)?[]:un.map(bn=>bn.point)}let _n=[];if(Pe.length>0){const un=Pe[0].clone(),bn=Pe[0].clone();for(let Ui=1;Ui<Pe.length;Ui++)un.x=Math.min(un.x,Pe[Ui].x),un.y=Math.min(un.y,Pe[Ui].y),bn.x=Math.max(bn.x,Pe[Ui].x),bn.y=Math.max(bn.y,Pe[Ui].y);_n=un.x>=ae.x&&bn.x<=Le.x&&un.y>=ae.y&&bn.y<=Le.y?[Pe]:bn.x<ae.x||un.x>Le.x||bn.y<ae.y||un.y>Le.y?[]:a.am([Pe],ae.x,ae.y,Le.x,Le.y)}for(const un of _n){vn.reset(un,.25*te);let bn=0;bn=vn.length<=.5*te?1:Math.ceil(vn.paddedLength/Hn)+1;for(let Ui=0;Ui<bn;Ui++){const si=Ui/Math.max(bn-1,1),Rr=vn.lerp(si),pr=Rr.x+ot,Hi=Rr.y+ot;at.push(pr,Hi,te,0);const Bo=pr-te,di=Hi-te,Zs=pr+te,$s=Hi+te;if(ne=ne&&this.isOffscreen(Bo,di,Zs,$s),Yt=Yt||this.isInsideGrid(Bo,di,Zs,$s),s!=="always"&&this.grid.hitTestCircle(pr,Hi,te,s,z)&&(Vt=!0,!N))return{circles:[],offscreen:!1,collisionDetected:Vt}}}}return{circles:!N&&Vt||!Yt||Ot<this.perspectiveRatioCutoff?[]:at,offscreen:ne,collisionDetected:Vt}}queryRenderedSymbols(s){if(s.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const h=[];let d=1/0,g=1/0,b=-1/0,I=-1/0;for(const R of s){const z=new a.P(R.x+ot,R.y+ot);d=Math.min(d,z.x),g=Math.min(g,z.y),b=Math.max(b,z.x),I=Math.max(I,z.y),h.push(z)}const C=this.grid.query(d,g,b,I).concat(this.ignoredGrid.query(d,g,b,I)),M={},N={};for(const R of C){const z=R.key;if(M[z.bucketInstanceId]===void 0&&(M[z.bucketInstanceId]={}),M[z.bucketInstanceId][z.featureIndex])continue;const W=[new a.P(R.x1,R.y1),new a.P(R.x2,R.y1),new a.P(R.x2,R.y2),new a.P(R.x1,R.y2)];a.an(h,W)&&(M[z.bucketInstanceId][z.featureIndex]=!0,N[z.bucketInstanceId]===void 0&&(N[z.bucketInstanceId]=[]),N[z.bucketInstanceId].push(z.featureIndex))}return N}insertCollisionBox(s,h,d,g,b,I){(d?this.ignoredGrid:this.grid).insert({bucketInstanceId:g,featureIndex:b,collisionGroupID:I,overlapMode:h},s[0],s[1],s[2],s[3])}insertCollisionCircles(s,h,d,g,b,I){const C=d?this.ignoredGrid:this.grid,M={bucketInstanceId:g,featureIndex:b,collisionGroupID:I,overlapMode:h};for(let N=0;N<s.length;N+=4)C.insertCircle(M,s[N],s[N+1],s[N+2])}projectAndGetPerspectiveRatio(s,h,d,g){let b;return g?(b=[h,d,g(h,d),1],a.ag(b,b,s)):(b=[h,d,0,1],Z(b,b,s)),{point:new a.P((b[0]/b[3]+1)/2*this.transform.width+ot,(-b[1]/b[3]+1)/2*this.transform.height+ot),perspectiveRatio:.5+this.transform.cameraToCenterDistance/b[3]*.5}}isOffscreen(s,h,d,g){return d<ot||s>=this.screenRightBoundary||g<ot||h>this.screenBottomBoundary}isInsideGrid(s,h,d,g){return d>=0&&s<this.gridRightBoundary&&g>=0&&h<this.gridBottomBoundary}getViewportMatrix(){const s=a.ao([]);return a.$(s,s,[-100,-100,0]),s}}function bt(y,s,h){return s*(a.N/(y.tileSize*Math.pow(2,h-y.tileID.overscaledZ)))}class rt{constructor(s,h,d,g){this.opacity=s?Math.max(0,Math.min(1,s.opacity+(s.placed?h:-h))):g&&d?1:0,this.placed=d}isHidden(){return this.opacity===0&&!this.placed}}class Tt{constructor(s,h,d,g,b){this.text=new rt(s?s.text:null,h,d,b),this.icon=new rt(s?s.icon:null,h,g,b)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Wt{constructor(s,h,d){this.text=s,this.icon=h,this.skipFade=d}}class Ht{constructor(){this.invProjMatrix=a.Z(),this.viewportMatrix=a.Z(),this.circles=[]}}class Kt{constructor(s,h,d,g,b){this.bucketInstanceId=s,this.featureIndex=h,this.sourceLayerIndex=d,this.bucketIndex=g,this.tileID=b}}class Ne{constructor(s){this.crossSourceCollisions=s,this.maxGroupID=0,this.collisionGroups={}}get(s){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[s]){const h=++this.maxGroupID;this.collisionGroups[s]={ID:h,predicate:d=>d.collisionGroupID===h}}return this.collisionGroups[s]}}function Ye(y,s,h,d,g){const{horizontalAlign:b,verticalAlign:I}=a.au(y);return new a.P(-(b-.5)*s+d[0]*g,-(I-.5)*h+d[1]*g)}function Te(y,s,h,d,g,b){const{x1:I,x2:C,y1:M,y2:N,anchorPointX:R,anchorPointY:z}=y,W=new a.P(s,h);return d&&W._rotate(g?b:-b),{x1:I+W.x,y1:M+W.y,x2:C+W.x,y2:N+W.y,anchorPointX:R,anchorPointY:z}}class Ve{constructor(s,h,d,g,b){this.transform=s.clone(),this.terrain=h,this.collisionIndex=new Mt(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=d,this.retainedQueryData={},this.collisionGroups=new Ne(g),this.collisionCircleArrays={},this.prevPlacement=b,b&&(b.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(s,h,d,g){const b=d.getBucket(h),I=d.latestFeatureIndex;if(!b||!I||h.id!==b.layerIds[0])return;const C=d.collisionBoxArray,M=b.layers[0].layout,N=Math.pow(2,this.transform.zoom-d.tileID.overscaledZ),R=d.tileSize/a.N,z=this.transform.calculatePosMatrix(d.tileID.toUnwrapped()),W=M.get("text-pitch-alignment")==="map",nt=M.get("text-rotation-alignment")==="map",et=bt(d,1,this.transform.zoom),at=le(z,W,nt,this.transform,et);let Q=null;if(W){const Ot=yo(z,W,nt,this.transform,et);Q=a.a1([],this.transform.labelPlaneMatrix,Ot)}this.retainedQueryData[b.bucketInstanceId]=new Kt(b.bucketInstanceId,I,b.sourceLayerIndex,b.index,d.tileID);const Lt={bucket:b,layout:M,posMatrix:z,textLabelPlaneMatrix:at,labelToScreenMatrix:Q,scale:N,textPixelRatio:R,holdingForFade:d.holdingForFade(),collisionBoxArray:C,partiallyEvaluatedTextSize:a.ah(b.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(b.sourceID)};if(g)for(const Ot of b.sortKeyRanges){const{sortKey:ct,symbolInstanceStart:Pt,symbolInstanceEnd:Bt}=Ot;s.push({sortKey:ct,symbolInstanceStart:Pt,symbolInstanceEnd:Bt,parameters:Lt})}else s.push({symbolInstanceStart:0,symbolInstanceEnd:b.symbolInstances.length,parameters:Lt})}attemptAnchorPlacement(s,h,d,g,b,I,C,M,N,R,z,W,nt,et,at,Q){const Lt=a.aq[s.textAnchor],Ot=[s.textOffset0,s.textOffset1],ct=Ye(Lt,d,g,Ot,b),Pt=this.collisionIndex.placeCollisionBox(Te(h,ct.x,ct.y,I,C,this.transform.angle),z,M,N,R.predicate,Q);if((!at||this.collisionIndex.placeCollisionBox(Te(at,ct.x,ct.y,I,C,this.transform.angle),z,M,N,R.predicate,Q).box.length!==0)&&Pt.box.length>0){let Bt;if(this.prevPlacement&&this.prevPlacement.variableOffsets[W.crossTileID]&&this.prevPlacement.placements[W.crossTileID]&&this.prevPlacement.placements[W.crossTileID].text&&(Bt=this.prevPlacement.variableOffsets[W.crossTileID].anchor),W.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[W.crossTileID]={textOffset:Ot,width:d,height:g,anchor:Lt,textBoxScale:b,prevAnchor:Bt},this.markUsedJustification(nt,Lt,W,et),nt.allowVerticalPlacement&&(this.markUsedOrientation(nt,et,W),this.placedOrientations[W.crossTileID]=et),{shift:ct,placedGlyphBoxes:Pt}}}placeLayerBucketPart(s,h,d){const{bucket:g,layout:b,posMatrix:I,textLabelPlaneMatrix:C,labelToScreenMatrix:M,textPixelRatio:N,holdingForFade:R,collisionBoxArray:z,partiallyEvaluatedTextSize:W,collisionGroup:nt}=s.parameters,et=b.get("text-optional"),at=b.get("icon-optional"),Q=a.ar(b,"text-overlap","text-allow-overlap"),Lt=Q==="always",Ot=a.ar(b,"icon-overlap","icon-allow-overlap"),ct=Ot==="always",Pt=b.get("text-rotation-alignment")==="map",Bt=b.get("text-pitch-alignment")==="map",Vt=b.get("icon-text-fit")!=="none",Yt=b.get("symbol-z-order")==="viewport-y",ne=Lt&&(ct||!g.hasIconData()||at),te=ct&&(Lt||!g.hasTextData()||et);!g.collisionArrays&&z&&g.deserializeCollisionBoxes(z);const ae=this.retainedQueryData[g.bucketInstanceId].tileID,Le=this.terrain?(pe,Ge)=>this.terrain.getElevation(ae,pe,Ge):null,vn=(pe,Ge)=>{var Pe,Hn;if(h[pe.crossTileID])return;if(R)return void(this.placements[pe.crossTileID]=new Wt(!1,!1,!1));let _n=!1,un=!1,bn=!0,Ui=null,si={box:null,offscreen:null},Rr={box:null,offscreen:null},pr=null,Hi=null,Bo=null,di=0,Zs=0,$s=0;Ge.textFeatureIndex?di=Ge.textFeatureIndex:pe.useRuntimeCollisionCircles&&(di=pe.featureIndex),Ge.verticalTextFeatureIndex&&(Zs=Ge.verticalTextFeatureIndex);const nl=Ge.textBox;if(nl){const $r=Gi=>{let dr=a.ai.horizontal;if(g.allowVerticalPlacement&&!Gi&&this.prevPlacement){const xo=this.prevPlacement.placedOrientations[pe.crossTileID];xo&&(this.placedOrientations[pe.crossTileID]=xo,dr=xo,this.markUsedOrientation(g,dr,pe))}return dr},Or=(Gi,dr)=>{if(g.allowVerticalPlacement&&pe.numVerticalGlyphVertices>0&&Ge.verticalTextBox){for(const xo of g.writingModes)if(xo===a.ai.vertical?(si=dr(),Rr=si):si=Gi(),si&&si.box&&si.box.length)break}else si=Gi()},ao=pe.textAnchorOffsetStartIndex,Al=pe.textAnchorOffsetEndIndex;if(Al===ao){const Gi=(dr,xo)=>{const ji=this.collisionIndex.placeCollisionBox(dr,Q,N,I,nt.predicate,Le);return ji&&ji.box&&ji.box.length&&(this.markUsedOrientation(g,xo,pe),this.placedOrientations[pe.crossTileID]=xo),ji};Or(()=>Gi(nl,a.ai.horizontal),()=>{const dr=Ge.verticalTextBox;return g.allowVerticalPlacement&&pe.numVerticalGlyphVertices>0&&dr?Gi(dr,a.ai.vertical):{box:null,offscreen:null}}),$r(si&&si.box&&si.box.length)}else{let Gi=a.aq[(Hn=(Pe=this.prevPlacement)===null||Pe===void 0?void 0:Pe.variableOffsets[pe.crossTileID])===null||Hn===void 0?void 0:Hn.anchor];const dr=(ji,Nl,dh)=>{const om=ji.x2-ji.x1,sm=ji.y2-ji.y1,Qg=pe.textBoxScale,np=Vt&&Ot==="never"?Nl:null;let Ws={box:[],offscreen:!1},Dl=Q==="never"?1:2,Xs="never";Gi&&Dl++;for(let cs=0;cs<Dl;cs++){for(let Hs=ao;Hs<Al;Hs++){const ip=g.textAnchorOffsets.get(Hs);if(Gi&&ip.textAnchor!==Gi)continue;const Pa=this.attemptAnchorPlacement(ip,ji,om,sm,Qg,Pt,Bt,N,I,nt,Xs,pe,g,dh,np,Le);if(Pa&&(Ws=Pa.placedGlyphBoxes,Ws&&Ws.box&&Ws.box.length))return _n=!0,Ui=Pa.shift,Ws}Gi?Gi=null:Xs=Q}return Ws};Or(()=>dr(nl,Ge.iconBox,a.ai.horizontal),()=>{const ji=Ge.verticalTextBox;return g.allowVerticalPlacement&&!(si&&si.box&&si.box.length)&&pe.numVerticalGlyphVertices>0&&ji?dr(ji,Ge.verticalIconBox,a.ai.vertical):{box:null,offscreen:null}}),si&&(_n=si.box,bn=si.offscreen);const xo=$r(si&&si.box);if(!_n&&this.prevPlacement){const ji=this.prevPlacement.variableOffsets[pe.crossTileID];ji&&(this.variableOffsets[pe.crossTileID]=ji,this.markUsedJustification(g,ji.anchor,pe,xo))}}}if(pr=si,_n=pr&&pr.box&&pr.box.length>0,bn=pr&&pr.offscreen,pe.useRuntimeCollisionCircles){const $r=g.text.placedSymbolArray.get(pe.centerJustifiedTextSymbolIndex),Or=a.aj(g.textSizeData,W,$r),ao=b.get("text-padding");Hi=this.collisionIndex.placeCollisionCircles(Q,$r,g.lineVertexArray,g.glyphOffsetArray,Or,I,C,M,d,Bt,nt.predicate,pe.collisionCircleDiameter,ao,Le),Hi.circles.length&&Hi.collisionDetected&&!d&&a.w("Collisions detected, but collision boxes are not shown"),_n=Lt||Hi.circles.length>0&&!Hi.collisionDetected,bn=bn&&Hi.offscreen}if(Ge.iconFeatureIndex&&($s=Ge.iconFeatureIndex),Ge.iconBox){const $r=Or=>{const ao=Vt&&Ui?Te(Or,Ui.x,Ui.y,Pt,Bt,this.transform.angle):Or;return this.collisionIndex.placeCollisionBox(ao,Ot,N,I,nt.predicate,Le)};Rr&&Rr.box&&Rr.box.length&&Ge.verticalIconBox?(Bo=$r(Ge.verticalIconBox),un=Bo.box.length>0):(Bo=$r(Ge.iconBox),un=Bo.box.length>0),bn=bn&&Bo.offscreen}const kl=et||pe.numHorizontalGlyphVertices===0&&pe.numVerticalGlyphVertices===0,yu=at||pe.numIconVertices===0;if(kl||yu?yu?kl||(un=un&&_n):_n=un&&_n:un=_n=un&&_n,_n&&pr&&pr.box&&this.collisionIndex.insertCollisionBox(pr.box,Q,b.get("text-ignore-placement"),g.bucketInstanceId,Rr&&Rr.box&&Zs?Zs:di,nt.ID),un&&Bo&&this.collisionIndex.insertCollisionBox(Bo.box,Ot,b.get("icon-ignore-placement"),g.bucketInstanceId,$s,nt.ID),Hi&&(_n&&this.collisionIndex.insertCollisionCircles(Hi.circles,Q,b.get("text-ignore-placement"),g.bucketInstanceId,di,nt.ID),d)){const $r=g.bucketInstanceId;let Or=this.collisionCircleArrays[$r];Or===void 0&&(Or=this.collisionCircleArrays[$r]=new Ht);for(let ao=0;ao<Hi.circles.length;ao+=4)Or.circles.push(Hi.circles[ao+0]),Or.circles.push(Hi.circles[ao+1]),Or.circles.push(Hi.circles[ao+2]),Or.circles.push(Hi.collisionDetected?1:0)}if(pe.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(g.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[pe.crossTileID]=new Wt(_n||ne,un||te,bn||g.justReloaded),h[pe.crossTileID]=!0};if(Yt){if(s.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const pe=g.getSortedSymbolIndexes(this.transform.angle);for(let Ge=pe.length-1;Ge>=0;--Ge){const Pe=pe[Ge];vn(g.symbolInstances.get(Pe),g.collisionArrays[Pe])}}else for(let pe=s.symbolInstanceStart;pe<s.symbolInstanceEnd;pe++)vn(g.symbolInstances.get(pe),g.collisionArrays[pe]);if(d&&g.bucketInstanceId in this.collisionCircleArrays){const pe=this.collisionCircleArrays[g.bucketInstanceId];a.as(pe.invProjMatrix,I),pe.viewportMatrix=this.collisionIndex.getViewportMatrix()}g.justReloaded=!1}markUsedJustification(s,h,d,g){let b;b=g===a.ai.vertical?d.verticalPlacedTextSymbolIndex:{left:d.leftJustifiedTextSymbolIndex,center:d.centerJustifiedTextSymbolIndex,right:d.rightJustifiedTextSymbolIndex}[a.at(h)];const I=[d.leftJustifiedTextSymbolIndex,d.centerJustifiedTextSymbolIndex,d.rightJustifiedTextSymbolIndex,d.verticalPlacedTextSymbolIndex];for(const C of I)C>=0&&(s.text.placedSymbolArray.get(C).crossTileID=b>=0&&C!==b?0:d.crossTileID)}markUsedOrientation(s,h,d){const g=h===a.ai.horizontal||h===a.ai.horizontalOnly?h:0,b=h===a.ai.vertical?h:0,I=[d.leftJustifiedTextSymbolIndex,d.centerJustifiedTextSymbolIndex,d.rightJustifiedTextSymbolIndex];for(const C of I)s.text.placedSymbolArray.get(C).placedOrientation=g;d.verticalPlacedTextSymbolIndex&&(s.text.placedSymbolArray.get(d.verticalPlacedTextSymbolIndex).placedOrientation=b)}commit(s){this.commitTime=s,this.zoomAtLastRecencyCheck=this.transform.zoom;const h=this.prevPlacement;let d=!1;this.prevZoomAdjustment=h?h.zoomAdjustment(this.transform.zoom):0;const g=h?h.symbolFadeChange(s):1,b=h?h.opacities:{},I=h?h.variableOffsets:{},C=h?h.placedOrientations:{};for(const M in this.placements){const N=this.placements[M],R=b[M];R?(this.opacities[M]=new Tt(R,g,N.text,N.icon),d=d||N.text!==R.text.placed||N.icon!==R.icon.placed):(this.opacities[M]=new Tt(null,g,N.text,N.icon,N.skipFade),d=d||N.text||N.icon)}for(const M in b){const N=b[M];if(!this.opacities[M]){const R=new Tt(N,g,!1,!1);R.isHidden()||(this.opacities[M]=R,d=d||N.text.placed||N.icon.placed)}}for(const M in I)this.variableOffsets[M]||!this.opacities[M]||this.opacities[M].isHidden()||(this.variableOffsets[M]=I[M]);for(const M in C)this.placedOrientations[M]||!this.opacities[M]||this.opacities[M].isHidden()||(this.placedOrientations[M]=C[M]);if(h&&h.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");d?this.lastPlacementChangeTime=s:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=h?h.lastPlacementChangeTime:s)}updateLayerOpacities(s,h){const d={};for(const g of h){const b=g.getBucket(s);b&&g.latestFeatureIndex&&s.id===b.layerIds[0]&&this.updateBucketOpacities(b,d,g.collisionBoxArray)}}updateBucketOpacities(s,h,d){s.hasTextData()&&(s.text.opacityVertexArray.clear(),s.text.hasVisibleVertices=!1),s.hasIconData()&&(s.icon.opacityVertexArray.clear(),s.icon.hasVisibleVertices=!1),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexArray.clear(),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexArray.clear();const g=s.layers[0],b=g.layout,I=new Tt(null,0,!1,!1,!0),C=b.get("text-allow-overlap"),M=b.get("icon-allow-overlap"),N=g._unevaluatedLayout.hasValue("text-variable-anchor")||g._unevaluatedLayout.hasValue("text-variable-anchor-offset"),R=b.get("text-rotation-alignment")==="map",z=b.get("text-pitch-alignment")==="map",W=b.get("icon-text-fit")!=="none",nt=new Tt(null,0,C&&(M||!s.hasIconData()||b.get("icon-optional")),M&&(C||!s.hasTextData()||b.get("text-optional")),!0);!s.collisionArrays&&d&&(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData())&&s.deserializeCollisionBoxes(d);const et=(at,Q,Lt)=>{for(let Ot=0;Ot<Q/4;Ot++)at.opacityVertexArray.emplaceBack(Lt);at.hasVisibleVertices=at.hasVisibleVertices||Lt!==rs};for(let at=0;at<s.symbolInstances.length;at++){const Q=s.symbolInstances.get(at),{numHorizontalGlyphVertices:Lt,numVerticalGlyphVertices:Ot,crossTileID:ct}=Q;let Pt=this.opacities[ct];h[ct]?Pt=I:Pt||(Pt=nt,this.opacities[ct]=Pt),h[ct]=!0;const Bt=Q.numIconVertices>0,Vt=this.placedOrientations[Q.crossTileID],Yt=Vt===a.ai.vertical,ne=Vt===a.ai.horizontal||Vt===a.ai.horizontalOnly;if(Lt>0||Ot>0){const te=Nr(Pt.text);et(s.text,Lt,Yt?rs:te),et(s.text,Ot,ne?rs:te);const ae=Pt.text.isHidden();[Q.rightJustifiedTextSymbolIndex,Q.centerJustifiedTextSymbolIndex,Q.leftJustifiedTextSymbolIndex].forEach(pe=>{pe>=0&&(s.text.placedSymbolArray.get(pe).hidden=ae||Yt?1:0)}),Q.verticalPlacedTextSymbolIndex>=0&&(s.text.placedSymbolArray.get(Q.verticalPlacedTextSymbolIndex).hidden=ae||ne?1:0);const Le=this.variableOffsets[Q.crossTileID];Le&&this.markUsedJustification(s,Le.anchor,Q,Vt);const vn=this.placedOrientations[Q.crossTileID];vn&&(this.markUsedJustification(s,"left",Q,vn),this.markUsedOrientation(s,vn,Q))}if(Bt){const te=Nr(Pt.icon),ae=!(W&&Q.verticalPlacedIconSymbolIndex&&Yt);Q.placedIconSymbolIndex>=0&&(et(s.icon,Q.numIconVertices,ae?te:rs),s.icon.placedSymbolArray.get(Q.placedIconSymbolIndex).hidden=Pt.icon.isHidden()),Q.verticalPlacedIconSymbolIndex>=0&&(et(s.icon,Q.numVerticalIconVertices,ae?rs:te),s.icon.placedSymbolArray.get(Q.verticalPlacedIconSymbolIndex).hidden=Pt.icon.isHidden())}if(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData()){const te=s.collisionArrays[at];if(te){let ae=new a.P(0,0);if(te.textBox||te.verticalTextBox){let vn=!0;if(N){const pe=this.variableOffsets[ct];pe?(ae=Ye(pe.anchor,pe.width,pe.height,pe.textOffset,pe.textBoxScale),R&&ae._rotate(z?this.transform.angle:-this.transform.angle)):vn=!1}te.textBox&&rn(s.textCollisionBox.collisionVertexArray,Pt.text.placed,!vn||Yt,ae.x,ae.y),te.verticalTextBox&&rn(s.textCollisionBox.collisionVertexArray,Pt.text.placed,!vn||ne,ae.x,ae.y)}const Le=!!(!ne&&te.verticalIconBox);te.iconBox&&rn(s.iconCollisionBox.collisionVertexArray,Pt.icon.placed,Le,W?ae.x:0,W?ae.y:0),te.verticalIconBox&&rn(s.iconCollisionBox.collisionVertexArray,Pt.icon.placed,!Le,W?ae.x:0,W?ae.y:0)}}}if(s.sortFeatures(this.transform.angle),this.retainedQueryData[s.bucketInstanceId]&&(this.retainedQueryData[s.bucketInstanceId].featureSortOrder=s.featureSortOrder),s.hasTextData()&&s.text.opacityVertexBuffer&&s.text.opacityVertexBuffer.updateData(s.text.opacityVertexArray),s.hasIconData()&&s.icon.opacityVertexBuffer&&s.icon.opacityVertexBuffer.updateData(s.icon.opacityVertexArray),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexBuffer&&s.iconCollisionBox.collisionVertexBuffer.updateData(s.iconCollisionBox.collisionVertexArray),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexBuffer&&s.textCollisionBox.collisionVertexBuffer.updateData(s.textCollisionBox.collisionVertexArray),s.text.opacityVertexArray.length!==s.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${s.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${s.text.layoutVertexArray.length}) / 4`);if(s.icon.opacityVertexArray.length!==s.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${s.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${s.icon.layoutVertexArray.length}) / 4`);if(s.bucketInstanceId in this.collisionCircleArrays){const at=this.collisionCircleArrays[s.bucketInstanceId];s.placementInvProjMatrix=at.invProjMatrix,s.placementViewportMatrix=at.viewportMatrix,s.collisionCircleArray=at.circles,delete this.collisionCircleArrays[s.bucketInstanceId]}}symbolFadeChange(s){return this.fadeDuration===0?1:(s-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(s){return Math.max(0,(this.transform.zoom-s)/1.5)}hasTransitions(s){return this.stale||s-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(s,h){const d=this.zoomAtLastRecencyCheck===h?1-this.zoomAdjustment(h):1;return this.zoomAtLastRecencyCheck=h,this.commitTime+this.fadeDuration*d>s}setStale(){this.stale=!0}}function rn(y,s,h,d,g){y.emplaceBack(s?1:0,h?1:0,d||0,g||0),y.emplaceBack(s?1:0,h?1:0,d||0,g||0),y.emplaceBack(s?1:0,h?1:0,d||0,g||0),y.emplaceBack(s?1:0,h?1:0,d||0,g||0)}const Gn=Math.pow(2,25),Jn=Math.pow(2,24),kn=Math.pow(2,17),Pn=Math.pow(2,16),qr=Math.pow(2,9),oi=Math.pow(2,8),ir=Math.pow(2,1);function Nr(y){if(y.opacity===0&&!y.placed)return 0;if(y.opacity===1&&y.placed)return 4294967295;const s=y.placed?1:0,h=Math.floor(127*y.opacity);return h*Gn+s*Jn+h*kn+s*Pn+h*qr+s*oi+h*ir+s}const rs=0;class xd{constructor(s){this._sortAcrossTiles=s.layout.get("symbol-z-order")!=="viewport-y"&&!s.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(s,h,d,g,b){const I=this._bucketParts;for(;this._currentTileIndex<s.length;)if(h.getBucketParts(I,g,s[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,b())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,I.sort((C,M)=>C.sortKey-M.sortKey));this._currentPartIndex<I.length;)if(h.placeLayerBucketPart(I[this._currentPartIndex],this._seenCrossTileIDs,d),this._currentPartIndex++,b())return!0;return!1}}class ou{constructor(s,h,d,g,b,I,C,M){this.placement=new Ve(s,h,I,C,M),this._currentPlacementIndex=d.length-1,this._forceFullPlacement=g,this._showCollisionBoxes=b,this._done=!1}isDone(){return this._done}continuePlacement(s,h,d){const g=a.h.now(),b=()=>!this._forceFullPlacement&&a.h.now()-g>2;for(;this._currentPlacementIndex>=0;){const I=h[s[this._currentPlacementIndex]],C=this.placement.collisionIndex.transform.zoom;if(I.type==="symbol"&&(!I.minzoom||I.minzoom<=C)&&(!I.maxzoom||I.maxzoom>C)){if(this._inProgressLayer||(this._inProgressLayer=new xd(I)),this._inProgressLayer.continuePlacement(d[I.source],this.placement,this._showCollisionBoxes,I,b))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(s){return this.placement.commit(s),this.placement}}const su=512/a.N/2;class Og{constructor(s,h,d){this.tileID=s,this.bucketInstanceId=d,this._symbolsByKey={};const g=new Map;for(let b=0;b<h.length;b++){const I=h.get(b),C=I.key,M=g.get(C);M?M.push(I):g.set(C,[I])}for(const[b,I]of g){const C={positions:I.map(M=>({x:Math.floor(M.anchorX*su),y:Math.floor(M.anchorY*su)})),crossTileIDs:I.map(M=>M.crossTileID)};if(C.positions.length>128){const M=new a.av(C.positions.length,16,Uint16Array);for(const{x:N,y:R}of C.positions)M.add(N,R);M.finish(),delete C.positions,C.index=M}this._symbolsByKey[b]=C}}getScaledCoordinates(s,h){const{x:d,y:g,z:b}=this.tileID.canonical,{x:I,y:C,z:M}=h.canonical,N=su/Math.pow(2,M-b),R=(C*a.N+s.anchorY)*N,z=g*a.N*su;return{x:Math.floor((I*a.N+s.anchorX)*N-d*a.N*su),y:Math.floor(R-z)}}findMatches(s,h,d){const g=this.tileID.canonical.z<h.canonical.z?1:Math.pow(2,this.tileID.canonical.z-h.canonical.z);for(let b=0;b<s.length;b++){const I=s.get(b);if(I.crossTileID)continue;const C=this._symbolsByKey[I.key];if(!C)continue;const M=this.getScaledCoordinates(I,h);if(C.index){const N=C.index.range(M.x-g,M.y-g,M.x+g,M.y+g).sort();for(const R of N){const z=C.crossTileIDs[R];if(!d[z]){d[z]=!0,I.crossTileID=z;break}}}else if(C.positions)for(let N=0;N<C.positions.length;N++){const R=C.positions[N],z=C.crossTileIDs[N];if(Math.abs(R.x-M.x)<=g&&Math.abs(R.y-M.y)<=g&&!d[z]){d[z]=!0,I.crossTileID=z;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:s})=>s)}}class Xn{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class mf{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(s){const h=Math.round((s-this.lng)/360);if(h!==0)for(const d in this.indexes){const g=this.indexes[d],b={};for(const I in g){const C=g[I];C.tileID=C.tileID.unwrapTo(C.tileID.wrap+h),b[C.tileID.key]=C}this.indexes[d]=b}this.lng=s}addBucket(s,h,d){if(this.indexes[s.overscaledZ]&&this.indexes[s.overscaledZ][s.key]){if(this.indexes[s.overscaledZ][s.key].bucketInstanceId===h.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(s.overscaledZ,this.indexes[s.overscaledZ][s.key])}for(let b=0;b<h.symbolInstances.length;b++)h.symbolInstances.get(b).crossTileID=0;this.usedCrossTileIDs[s.overscaledZ]||(this.usedCrossTileIDs[s.overscaledZ]={});const g=this.usedCrossTileIDs[s.overscaledZ];for(const b in this.indexes){const I=this.indexes[b];if(Number(b)>s.overscaledZ)for(const C in I){const M=I[C];M.tileID.isChildOf(s)&&M.findMatches(h.symbolInstances,s,g)}else{const C=I[s.scaledTo(Number(b)).key];C&&C.findMatches(h.symbolInstances,s,g)}}for(let b=0;b<h.symbolInstances.length;b++){const I=h.symbolInstances.get(b);I.crossTileID||(I.crossTileID=d.generate(),g[I.crossTileID]=!0)}return this.indexes[s.overscaledZ]===void 0&&(this.indexes[s.overscaledZ]={}),this.indexes[s.overscaledZ][s.key]=new Og(s,h.symbolInstances,h.bucketInstanceId),!0}removeBucketCrossTileIDs(s,h){for(const d of h.getCrossTileIDsLists())for(const g of d)delete this.usedCrossTileIDs[s][g]}removeStaleBuckets(s){let h=!1;for(const d in this.indexes){const g=this.indexes[d];for(const b in g)s[g[b].bucketInstanceId]||(this.removeBucketCrossTileIDs(d,g[b]),delete g[b],h=!0)}return h}}class Vc{constructor(){this.layerIndexes={},this.crossTileIDs=new Xn,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(s,h,d){let g=this.layerIndexes[s.id];g===void 0&&(g=this.layerIndexes[s.id]=new mf);let b=!1;const I={};g.handleWrapJump(d);for(const C of h){const M=C.getBucket(s);M&&s.id===M.layerIds[0]&&(M.bucketInstanceId||(M.bucketInstanceId=++this.maxBucketInstanceId),g.addBucket(C.tileID,M,this.crossTileIDs)&&(b=!0),I[M.bucketInstanceId]=!0)}return g.removeStaleBuckets(I)&&(b=!0),b}pruneUnusedLayers(s){const h={};s.forEach(d=>{h[d]=!0});for(const d in this.layerIndexes)h[d]||delete this.layerIndexes[d]}}const Zr=(y,s)=>a.x(y,s&&s.filter(h=>h.identifier!=="source.canvas")),Do=a.F(a.ax,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setGlyphs","setSprite"]),zg=a.F(a.ax,["setCenter","setZoom","setBearing","setPitch"]),os=a.aw();class Dr extends a.E{constructor(s,h={}){super(),this.map=s,this.dispatcher=new Qe(Ha(),this,s._getMapId()),this.imageManager=new vt,this.imageManager.setEventedParent(this),this.glyphManager=new Qt(s._requestManager,h.localIdeographFontFamily),this.lineAtlas=new jn(256,512),this.crossTileSymbolIndex=new Vc,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new a.ay,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",a.az());const d=this;this._rtlTextPluginCallback=Dr.registerForPluginStateChange(g=>{d.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:g.pluginStatus,pluginURL:g.pluginURL},(b,I)=>{if(a.aA(b),I&&I.every(C=>C))for(const C in d.sourceCaches){const M=d.sourceCaches[C].getSource().type;M!=="vector"&&M!=="geojson"||d.sourceCaches[C].reload()}})}),this.on("data",g=>{if(g.dataType!=="source"||g.sourceDataType!=="metadata")return;const b=this.sourceCaches[g.sourceId];if(!b)return;const I=b.getSource();if(I&&I.vectorLayerIds)for(const C in this._layers){const M=this._layers[C];M.source===I.id&&this._validateLayer(M)}})}loadURL(s,h={},d){this.fire(new a.k("dataloading",{dataType:"style"})),h.validate=typeof h.validate!="boolean"||h.validate;const g=this.map._requestManager.transformRequest(s,Y.Style);this._request=a.f(g,(b,I)=>{this._request=null,b?this.fire(new a.j(b)):I&&this._load(I,h,d)})}loadJSON(s,h={},d){this.fire(new a.k("dataloading",{dataType:"style"})),this._request=a.h.frame(()=>{this._request=null,h.validate=h.validate!==!1,this._load(s,h,d)})}loadEmpty(){this.fire(new a.k("dataloading",{dataType:"style"})),this._load(os,{validate:!1})}_load(s,h,d){var g;const b=h.transformStyle?h.transformStyle(d,s):s;if(!h.validate||!Zr(this,a.y(b))){this._loaded=!0,this.stylesheet=b;for(const I in b.sources)this.addSource(I,b.sources[I],{validate:!1});b.sprite?this._loadSprite(b.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(b.glyphs),this._createLayers(),this.light=new yn(this.stylesheet.light),this.map.setTerrain((g=this.stylesheet.terrain)!==null&&g!==void 0?g:null),this.fire(new a.k("data",{dataType:"style"})),this.fire(new a.k("style.load"))}}_createLayers(){const s=a.aB(this.stylesheet.layers);this.dispatcher.broadcast("setLayers",s),this._order=s.map(h=>h.id),this._layers={},this._serializedLayers=null;for(const h of s){const d=a.aC(h);d.setEventedParent(this,{layer:{id:h.id}}),this._layers[h.id]=d}}_loadSprite(s,h=!1,d=void 0){this.imageManager.setLoaded(!1),this._spriteRequest=function(g,b,I,C){const M=gt(g),N=M.length,R=I>1?"@2x":"",z={},W={},nt={};for(const{id:et,url:at}of M){const Q=b.transformRequest(b.normalizeSpriteURL(at,R,".json"),Y.SpriteJSON),Lt=`${et}_${Q.url}`;z[Lt]=a.f(Q,(Pt,Bt)=>{delete z[Lt],W[et]=Bt,ut(C,W,nt,Pt,N)});const Ot=b.transformRequest(b.normalizeSpriteURL(at,R,".png"),Y.SpriteImage),ct=`${et}_${Ot.url}`;z[ct]=U.getImage(Ot,(Pt,Bt)=>{delete z[ct],nt[et]=Bt,ut(C,W,nt,Pt,N)})}return{cancel(){for(const et of Object.values(z))et.cancel()}}}(s,this.map._requestManager,this.map.getPixelRatio(),(g,b)=>{if(this._spriteRequest=null,g)this.fire(new a.j(g));else if(b)for(const I in b){this._spritesImagesIds[I]=[];const C=this._spritesImagesIds[I]?this._spritesImagesIds[I].filter(M=>!(M in b)):[];for(const M of C)this.imageManager.removeImage(M),this._changedImages[M]=!0;for(const M in b[I]){const N=I==="default"?M:`${I}:${M}`;this._spritesImagesIds[I].push(N),N in this.imageManager.images?this.imageManager.updateImage(N,b[I][M],!1):this.imageManager.addImage(N,b[I][M]),h&&(this._changedImages[N]=!0)}}this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),h&&(this._changed=!0),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new a.k("data",{dataType:"style"})),d&&d(g)})}_unloadSprite(){for(const s of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(s),this._changedImages[s]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new a.k("data",{dataType:"style"}))}_validateLayer(s){const h=this.sourceCaches[s.source];if(!h)return;const d=s.sourceLayer;if(!d)return;const g=h.getSource();(g.type==="geojson"||g.vectorLayerIds&&g.vectorLayerIds.indexOf(d)===-1)&&this.fire(new a.j(new Error(`Source layer "${d}" does not exist on source "${g.id}" as specified by style layer "${s.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const s in this.sourceCaches)if(!this.sourceCaches[s].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(s){const h=this._serializedAllLayers();if(!s||s.length===0)return Object.values(h);const d=[];for(const g of s)h[g]&&d.push(h[g]);return d}_serializedAllLayers(){let s=this._serializedLayers;if(s)return s;s=this._serializedLayers={};const h=Object.keys(this._layers);for(const d of h){const g=this._layers[d];g.type!=="custom"&&(s[d]=g.serialize())}return s}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const s in this.sourceCaches)if(this.sourceCaches[s].hasTransition())return!0;for(const s in this._layers)if(this._layers[s].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(s){if(!this._loaded)return;const h=this._changed;if(this._changed){const g=Object.keys(this._updatedLayers),b=Object.keys(this._removedLayers);(g.length||b.length)&&this._updateWorkerLayers(g,b);for(const I in this._updatedSources){const C=this._updatedSources[I];if(C==="reload")this._reloadSource(I);else{if(C!=="clear")throw new Error(`Invalid action ${C}`);this._clearSource(I)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const I in this._updatedPaintProps)this._layers[I].updateTransitions(s);this.light.updateTransitions(s),this._resetUpdates()}const d={};for(const g in this.sourceCaches){const b=this.sourceCaches[g];d[g]=b.used,b.used=!1}for(const g of this._order){const b=this._layers[g];b.recalculate(s,this._availableImages),!b.isHidden(s.zoom)&&b.source&&(this.sourceCaches[b.source].used=!0)}for(const g in d){const b=this.sourceCaches[g];d[g]!==b.used&&b.fire(new a.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:g}))}this.light.recalculate(s),this.z=s.zoom,h&&this.fire(new a.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const s=Object.keys(this._changedImages);if(s.length){for(const h in this.sourceCaches)this.sourceCaches[h].reloadTilesForDependencies(["icons","patterns"],s);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const s in this.sourceCaches)this.sourceCaches[s].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(s,h){this.dispatcher.broadcast("updateLayers",{layers:this._serializeByIds(s),removedIds:h})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(s,h={}){this._checkLoaded();const d=this.serialize();if(s=h.transformStyle?h.transformStyle(d,s):s,Zr(this,a.y(s)))return!1;(s=a.aD(s)).layers=a.aB(s.layers);const g=a.aE(d,s).filter(I=>!(I.command in zg));if(g.length===0)return!1;const b=g.filter(I=>!(I.command in Do));if(b.length>0)throw new Error(`Unimplemented: ${b.map(I=>I.command).join(", ")}.`);for(const I of g)I.command!=="setTransition"&&this[I.command].apply(this,I.args);return this.stylesheet=s,this._serializedLayers=null,!0}addImage(s,h){if(this.getImage(s))return this.fire(new a.j(new Error(`An image named "${s}" already exists.`)));this.imageManager.addImage(s,h),this._afterImageUpdated(s)}updateImage(s,h){this.imageManager.updateImage(s,h)}getImage(s){return this.imageManager.getImage(s)}removeImage(s){if(!this.getImage(s))return this.fire(new a.j(new Error(`An image named "${s}" does not exist.`)));this.imageManager.removeImage(s),this._afterImageUpdated(s)}_afterImageUpdated(s){this._availableImages=this.imageManager.listImages(),this._changedImages[s]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new a.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(s,h,d={}){if(this._checkLoaded(),this.sourceCaches[s]!==void 0)throw new Error(`Source "${s}" already exists.`);if(!h.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(h).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(h.type)>=0&&this._validate(a.y.source,`sources.${s}`,h,null,d))return;this.map&&this.map._collectResourceTiming&&(h.collectResourceTiming=!0);const g=this.sourceCaches[s]=new Vi(s,h,this.dispatcher);g.style=this,g.setEventedParent(this,()=>({isSourceLoaded:g.loaded(),source:g.serialize(),sourceId:s})),g.onAdd(this.map),this._changed=!0}removeSource(s){if(this._checkLoaded(),this.sourceCaches[s]===void 0)throw new Error("There is no source with this ID");for(const d in this._layers)if(this._layers[d].source===s)return this.fire(new a.j(new Error(`Source "${s}" cannot be removed while layer "${d}" is using it.`)));const h=this.sourceCaches[s];delete this.sourceCaches[s],delete this._updatedSources[s],h.fire(new a.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:s})),h.setEventedParent(null),h.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(s,h){if(this._checkLoaded(),this.sourceCaches[s]===void 0)throw new Error(`There is no source with this ID=${s}`);const d=this.sourceCaches[s].getSource();if(d.type!=="geojson")throw new Error(`geojsonSource.type is ${d.type}, which is !== 'geojson`);d.setData(h),this._changed=!0}getSource(s){return this.sourceCaches[s]&&this.sourceCaches[s].getSource()}addLayer(s,h,d={}){this._checkLoaded();const g=s.id;if(this.getLayer(g))return void this.fire(new a.j(new Error(`Layer "${g}" already exists on this map.`)));let b;if(s.type==="custom"){if(Zr(this,a.aF(s)))return;b=a.aC(s)}else{if("source"in s&&typeof s.source=="object"&&(this.addSource(g,s.source),s=a.aD(s),s=a.e(s,{source:g})),this._validate(a.y.layer,`layers.${g}`,s,{arrayIndex:-1},d))return;b=a.aC(s),this._validateLayer(b),b.setEventedParent(this,{layer:{id:g}})}const I=h?this._order.indexOf(h):this._order.length;if(h&&I===-1)this.fire(new a.j(new Error(`Cannot add layer "${g}" before non-existing layer "${h}".`)));else{if(this._order.splice(I,0,g),this._layerOrderChanged=!0,this._layers[g]=b,this._removedLayers[g]&&b.source&&b.type!=="custom"){const C=this._removedLayers[g];delete this._removedLayers[g],C.type!==b.type?this._updatedSources[b.source]="clear":(this._updatedSources[b.source]="reload",this.sourceCaches[b.source].pause())}this._updateLayer(b),b.onAdd&&b.onAdd(this.map)}}moveLayer(s,h){if(this._checkLoaded(),this._changed=!0,!this._layers[s])return void this.fire(new a.j(new Error(`The layer '${s}' does not exist in the map's style and cannot be moved.`)));if(s===h)return;const d=this._order.indexOf(s);this._order.splice(d,1);const g=h?this._order.indexOf(h):this._order.length;h&&g===-1?this.fire(new a.j(new Error(`Cannot move layer "${s}" before non-existing layer "${h}".`))):(this._order.splice(g,0,s),this._layerOrderChanged=!0)}removeLayer(s){this._checkLoaded();const h=this._layers[s];if(!h)return void this.fire(new a.j(new Error(`Cannot remove non-existing layer "${s}".`)));h.setEventedParent(null);const d=this._order.indexOf(s);this._order.splice(d,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[s]=h,delete this._layers[s],this._serializedLayers&&delete this._serializedLayers[s],delete this._updatedLayers[s],delete this._updatedPaintProps[s],h.onRemove&&h.onRemove(this.map)}getLayer(s){return this._layers[s]}getLayersOrder(){return[...this._order]}hasLayer(s){return s in this._layers}setLayerZoomRange(s,h,d){this._checkLoaded();const g=this.getLayer(s);g?g.minzoom===h&&g.maxzoom===d||(h!=null&&(g.minzoom=h),d!=null&&(g.maxzoom=d),this._updateLayer(g)):this.fire(new a.j(new Error(`Cannot set the zoom range of non-existing layer "${s}".`)))}setFilter(s,h,d={}){this._checkLoaded();const g=this.getLayer(s);if(g){if(!a.aG(g.filter,h))return h==null?(g.filter=void 0,void this._updateLayer(g)):void(this._validate(a.y.filter,`layers.${g.id}.filter`,h,null,d)||(g.filter=a.aD(h),this._updateLayer(g)))}else this.fire(new a.j(new Error(`Cannot filter non-existing layer "${s}".`)))}getFilter(s){return a.aD(this.getLayer(s).filter)}setLayoutProperty(s,h,d,g={}){this._checkLoaded();const b=this.getLayer(s);b?a.aG(b.getLayoutProperty(h),d)||(b.setLayoutProperty(h,d,g),this._updateLayer(b)):this.fire(new a.j(new Error(`Cannot style non-existing layer "${s}".`)))}getLayoutProperty(s,h){const d=this.getLayer(s);if(d)return d.getLayoutProperty(h);this.fire(new a.j(new Error(`Cannot get style of non-existing layer "${s}".`)))}setPaintProperty(s,h,d,g={}){this._checkLoaded();const b=this.getLayer(s);b?a.aG(b.getPaintProperty(h),d)||(b.setPaintProperty(h,d,g)&&this._updateLayer(b),this._changed=!0,this._updatedPaintProps[s]=!0):this.fire(new a.j(new Error(`Cannot style non-existing layer "${s}".`)))}getPaintProperty(s,h){return this.getLayer(s).getPaintProperty(h)}setFeatureState(s,h){this._checkLoaded();const d=s.source,g=s.sourceLayer,b=this.sourceCaches[d];if(b===void 0)return void this.fire(new a.j(new Error(`The source '${d}' does not exist in the map's style.`)));const I=b.getSource().type;I==="geojson"&&g?this.fire(new a.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):I!=="vector"||g?(s.id===void 0&&this.fire(new a.j(new Error("The feature id parameter must be provided."))),b.setFeatureState(g,s.id,h)):this.fire(new a.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(s,h){this._checkLoaded();const d=s.source,g=this.sourceCaches[d];if(g===void 0)return void this.fire(new a.j(new Error(`The source '${d}' does not exist in the map's style.`)));const b=g.getSource().type,I=b==="vector"?s.sourceLayer:void 0;b!=="vector"||I?h&&typeof s.id!="string"&&typeof s.id!="number"?this.fire(new a.j(new Error("A feature id is required to remove its specific state property."))):g.removeFeatureState(I,s.id,h):this.fire(new a.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(s){this._checkLoaded();const h=s.source,d=s.sourceLayer,g=this.sourceCaches[h];if(g!==void 0)return g.getSource().type!=="vector"||d?(s.id===void 0&&this.fire(new a.j(new Error("The feature id parameter must be provided."))),g.getFeatureState(d,s.id)):void this.fire(new a.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new a.j(new Error(`The source '${h}' does not exist in the map's style.`)))}getTransition(){return a.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const s=a.aH(this.sourceCaches,b=>b.serialize()),h=this._serializeByIds(this._order),d=this.map.getTerrain()||void 0,g=this.stylesheet;return a.aI({version:g.version,name:g.name,metadata:g.metadata,light:g.light,center:g.center,zoom:g.zoom,bearing:g.bearing,pitch:g.pitch,sprite:g.sprite,glyphs:g.glyphs,transition:g.transition,sources:s,layers:h,terrain:d},b=>b!==void 0)}_updateLayer(s){this._updatedLayers[s.id]=!0,s.source&&!this._updatedSources[s.source]&&this.sourceCaches[s.source].getSource().type!=="raster"&&(this._updatedSources[s.source]="reload",this.sourceCaches[s.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(s){const h=I=>this._layers[I].type==="fill-extrusion",d={},g=[];for(let I=this._order.length-1;I>=0;I--){const C=this._order[I];if(h(C)){d[C]=I;for(const M of s){const N=M[C];if(N)for(const R of N)g.push(R)}}}g.sort((I,C)=>C.intersectionZ-I.intersectionZ);const b=[];for(let I=this._order.length-1;I>=0;I--){const C=this._order[I];if(h(C))for(let M=g.length-1;M>=0;M--){const N=g[M].feature;if(d[N.layer.id]<I)break;b.push(N),g.pop()}else for(const M of s){const N=M[C];if(N)for(const R of N)b.push(R.feature)}}return b}queryRenderedFeatures(s,h,d){h&&h.filter&&this._validate(a.y.filter,"queryRenderedFeatures.filter",h.filter,null,h);const g={};if(h&&h.layers){if(!Array.isArray(h.layers))return this.fire(new a.j(new Error("parameters.layers must be an Array."))),[];for(const C of h.layers){const M=this._layers[C];if(!M)return this.fire(new a.j(new Error(`The layer '${C}' does not exist in the map's style and cannot be queried for features.`))),[];g[M.source]=!0}}const b=[];h.availableImages=this._availableImages;const I=this._serializedAllLayers();for(const C in this.sourceCaches)h.layers&&!g[C]||b.push(nr(this.sourceCaches[C],this._layers,I,s,h,d));return this.placement&&b.push(function(C,M,N,R,z,W,nt){const et={},at=W.queryRenderedSymbols(R),Q=[];for(const Lt of Object.keys(at).map(Number))Q.push(nt[Lt]);Q.sort(Wn);for(const Lt of Q){const Ot=Lt.featureIndex.lookupSymbolFeatures(at[Lt.bucketInstanceId],M,Lt.bucketIndex,Lt.sourceLayerIndex,z.filter,z.layers,z.availableImages,C);for(const ct in Ot){const Pt=et[ct]=et[ct]||[],Bt=Ot[ct];Bt.sort((Vt,Yt)=>{const ne=Lt.featureSortOrder;if(ne){const te=ne.indexOf(Vt.featureIndex);return ne.indexOf(Yt.featureIndex)-te}return Yt.featureIndex-Vt.featureIndex});for(const Vt of Bt)Pt.push(Vt)}}for(const Lt in et)et[Lt].forEach(Ot=>{const ct=Ot.feature,Pt=N[C[Lt].source].getFeatureState(ct.layer["source-layer"],ct.id);ct.source=ct.layer.source,ct.layer["source-layer"]&&(ct.sourceLayer=ct.layer["source-layer"]),ct.state=Pt});return et}(this._layers,I,this.sourceCaches,s,h,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(b)}querySourceFeatures(s,h){h&&h.filter&&this._validate(a.y.filter,"querySourceFeatures.filter",h.filter,null,h);const d=this.sourceCaches[s];return d?function(g,b){const I=g.getRenderableIds().map(N=>g.getTileByID(N)),C=[],M={};for(let N=0;N<I.length;N++){const R=I[N],z=R.tileID.canonical.key;M[z]||(M[z]=!0,R.querySourceFeatures(C,b))}return C}(d,h):[]}addSourceType(s,h,d){return Ee(s)?d(new Error(`A source type called "${s}" already exists.`)):(((g,b)=>{yt[g]=b})(s,h),h.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:s,url:h.workerSourceURL},d):d(null,null))}getLight(){return this.light.getLight()}setLight(s,h={}){this._checkLoaded();const d=this.light.getLight();let g=!1;for(const I in s)if(!a.aG(s[I],d[I])){g=!0;break}if(!g)return;const b={now:a.h.now(),transition:a.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(s,h),this.light.updateTransitions(b)}_validate(s,h,d,g,b={}){return(!b||b.validate!==!1)&&Zr(this,s.call(a.y,a.e({key:h,style:this.serialize(),value:d,styleSpec:a.v},g)))}_remove(s=!0){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),a.aJ.off("pluginStateChange",this._rtlTextPluginCallback);for(const h in this._layers)this._layers[h].setEventedParent(null);for(const h in this.sourceCaches){const d=this.sourceCaches[h];d.setEventedParent(null),d.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove(s)}_clearSource(s){this.sourceCaches[s].clearTiles()}_reloadSource(s){this.sourceCaches[s].resume(),this.sourceCaches[s].reload()}_updateSources(s){for(const h in this.sourceCaches)this.sourceCaches[h].update(s,this.map.terrain)}_generateCollisionBoxes(){for(const s in this.sourceCaches)this._reloadSource(s)}_updatePlacement(s,h,d,g,b=!1){let I=!1,C=!1;const M={};for(const N of this._order){const R=this._layers[N];if(R.type!=="symbol")continue;if(!M[R.source]){const W=this.sourceCaches[R.source];M[R.source]=W.getRenderableIds(!0).map(nt=>W.getTileByID(nt)).sort((nt,et)=>et.tileID.overscaledZ-nt.tileID.overscaledZ||(nt.tileID.isLessThan(et.tileID)?-1:1))}const z=this.crossTileSymbolIndex.addLayer(R,M[R.source],s.center.lng);I=I||z}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((b=b||this._layerOrderChanged||d===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(a.h.now(),s.zoom))&&(this.pauseablePlacement=new ou(s,this.map.terrain,this._order,b,h,d,g,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,M),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(a.h.now()),C=!0),I&&this.pauseablePlacement.placement.setStale()),C||I)for(const N of this._order){const R=this._layers[N];R.type==="symbol"&&this.placement.updateLayerOpacities(R,M[R.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(a.h.now())}_releaseSymbolFadeTiles(){for(const s in this.sourceCaches)this.sourceCaches[s].releaseSymbolFadeTiles()}getImages(s,h,d){this.imageManager.getImages(h.icons,d),this._updateTilesForChangedImages();const g=this.sourceCaches[h.source];g&&g.setDependencies(h.tileID.key,h.type,h.icons)}getGlyphs(s,h,d){this.glyphManager.getGlyphs(h.stacks,d);const g=this.sourceCaches[h.source];g&&g.setDependencies(h.tileID.key,h.type,[""])}getResource(s,h,d){return a.m(h,d)}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(s,h={}){this._checkLoaded(),s&&this._validate(a.y.glyphs,"glyphs",s,null,h)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=s,this.glyphManager.entries={},this.glyphManager.setURL(s))}addSprite(s,h,d={},g){this._checkLoaded();const b=[{id:s,url:h}],I=[...gt(this.stylesheet.sprite),...b];this._validate(a.y.sprite,"sprite",I,null,d)||(this.stylesheet.sprite=I,this._loadSprite(b,!0,g))}removeSprite(s){this._checkLoaded();const h=gt(this.stylesheet.sprite);if(h.find(d=>d.id===s)){if(this._spritesImagesIds[s])for(const d of this._spritesImagesIds[s])this.imageManager.removeImage(d),this._changedImages[d]=!0;h.splice(h.findIndex(d=>d.id===s),1),this.stylesheet.sprite=h.length>0?h:void 0,delete this._spritesImagesIds[s],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new a.k("data",{dataType:"style"}))}else this.fire(new a.j(new Error(`Sprite "${s}" doesn't exists on this map.`)))}getSprite(){return gt(this.stylesheet.sprite)}setSprite(s,h={},d){this._checkLoaded(),s&&this._validate(a.y.sprite,"sprite",s,null,h)||(this.stylesheet.sprite=s,s?this._loadSprite(s,!0,d):(this._unloadSprite(),d&&d(null)))}}Dr.registerForPluginStateChange=a.aK;var Uc=a.Q([{name:"a_pos",type:"Int16",components:2}]),au="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const Ei={prelude:Fn(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:Fn(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Fn(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Fn(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Fn("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Fn(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:Fn(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Fn("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Fn("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Fn("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:Fn(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:Fn(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:Fn(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:Fn(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Fn(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Fn(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Fn(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Fn(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Fn(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Fn(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Fn(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Fn(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Fn(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Fn(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Fn(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Fn(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Fn("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",au),terrainDepth:Fn("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",au),terrainCoords:Fn("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",au)};function Fn(y,s){const h=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,d=s.match(/attribute ([\w]+) ([\w]+)/g),g=y.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),b=s.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),I=b?b.concat(g):g,C={};return{fragmentSource:y=y.replace(h,(M,N,R,z,W)=>(C[W]=!0,N==="define"?`
#ifndef HAS_UNIFORM_u_${W}
varying ${R} ${z} ${W};
#else
uniform ${R} ${z} u_${W};
#endif
`:`
#ifdef HAS_UNIFORM_u_${W}
    ${R} ${z} ${W} = u_${W};
#endif
`)),vertexSource:s=s.replace(h,(M,N,R,z,W)=>{const nt=z==="float"?"vec2":"vec4",et=W.match(/color/)?"color":nt;return C[W]?N==="define"?`
#ifndef HAS_UNIFORM_u_${W}
uniform lowp float u_${W}_t;
attribute ${R} ${nt} a_${W};
varying ${R} ${z} ${W};
#else
uniform ${R} ${z} u_${W};
#endif
`:et==="vec4"?`
#ifndef HAS_UNIFORM_u_${W}
    ${W} = a_${W};
#else
    ${R} ${z} ${W} = u_${W};
#endif
`:`
#ifndef HAS_UNIFORM_u_${W}
    ${W} = unpack_mix_${et}(a_${W}, u_${W}_t);
#else
    ${R} ${z} ${W} = u_${W};
#endif
`:N==="define"?`
#ifndef HAS_UNIFORM_u_${W}
uniform lowp float u_${W}_t;
attribute ${R} ${nt} a_${W};
#else
uniform ${R} ${z} u_${W};
#endif
`:et==="vec4"?`
#ifndef HAS_UNIFORM_u_${W}
    ${R} ${z} ${W} = a_${W};
#else
    ${R} ${z} ${W} = u_${W};
#endif
`:`
#ifndef HAS_UNIFORM_u_${W}
    ${R} ${z} ${W} = unpack_mix_${et}(a_${W}, u_${W}_t);
#else
    ${R} ${z} ${W} = u_${W};
#endif
`}),staticAttributes:d,staticUniforms:I}}class Sl{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(s,h,d,g,b,I,C,M,N){this.context=s;let R=this.boundPaintVertexBuffers.length!==g.length;for(let z=0;!R&&z<g.length;z++)this.boundPaintVertexBuffers[z]!==g[z]&&(R=!0);!this.vao||this.boundProgram!==h||this.boundLayoutVertexBuffer!==d||R||this.boundIndexBuffer!==b||this.boundVertexOffset!==I||this.boundDynamicVertexBuffer!==C||this.boundDynamicVertexBuffer2!==M||this.boundDynamicVertexBuffer3!==N?this.freshBind(h,d,g,b,I,C,M,N):(s.bindVertexArray.set(this.vao),C&&C.bind(),b&&b.dynamicDraw&&b.bind(),M&&M.bind(),N&&N.bind())}freshBind(s,h,d,g,b,I,C,M){const N=s.numAttributes,R=this.context,z=R.gl;this.vao&&this.destroy(),this.vao=R.createVertexArray(),R.bindVertexArray.set(this.vao),this.boundProgram=s,this.boundLayoutVertexBuffer=h,this.boundPaintVertexBuffers=d,this.boundIndexBuffer=g,this.boundVertexOffset=b,this.boundDynamicVertexBuffer=I,this.boundDynamicVertexBuffer2=C,this.boundDynamicVertexBuffer3=M,h.enableAttributes(z,s);for(const W of d)W.enableAttributes(z,s);I&&I.enableAttributes(z,s),C&&C.enableAttributes(z,s),M&&M.enableAttributes(z,s),h.bind(),h.setVertexAttribPointers(z,s,b);for(const W of d)W.bind(),W.setVertexAttribPointers(z,s,b);I&&(I.bind(),I.setVertexAttribPointers(z,s,b)),g&&g.bind(),C&&(C.bind(),C.setVertexAttribPointers(z,s,b)),M&&(M.bind(),M.setVertexAttribPointers(z,s,b)),R.currentNumAttributes=N}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function Ai(y){const s=[];for(let h=0;h<y.length;h++){if(y[h]===null)continue;const d=y[h].split(" ");s.push(d.pop())}return s}class Gc{constructor(s,h,d,g,b,I){const C=s.gl;this.program=C.createProgram();const M=Ai(h.staticAttributes),N=d?d.getBinderAttributes():[],R=M.concat(N),z=Ei.prelude.staticUniforms?Ai(Ei.prelude.staticUniforms):[],W=h.staticUniforms?Ai(h.staticUniforms):[],nt=d?d.getBinderUniforms():[],et=z.concat(W).concat(nt),at=[];for(const Vt of et)at.indexOf(Vt)<0&&at.push(Vt);const Q=d?d.defines():[];b&&Q.push("#define OVERDRAW_INSPECTOR;"),I&&Q.push("#define TERRAIN3D;");const Lt=Q.concat(Ei.prelude.fragmentSource,h.fragmentSource).join(`
`),Ot=Q.concat(Ei.prelude.vertexSource,h.vertexSource).join(`
`),ct=C.createShader(C.FRAGMENT_SHADER);if(C.isContextLost())return void(this.failedToCreate=!0);if(C.shaderSource(ct,Lt),C.compileShader(ct),!C.getShaderParameter(ct,C.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${C.getShaderInfoLog(ct)}`);C.attachShader(this.program,ct);const Pt=C.createShader(C.VERTEX_SHADER);if(C.isContextLost())return void(this.failedToCreate=!0);if(C.shaderSource(Pt,Ot),C.compileShader(Pt),!C.getShaderParameter(Pt,C.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${C.getShaderInfoLog(Pt)}`);C.attachShader(this.program,Pt),this.attributes={};const Bt={};this.numAttributes=R.length;for(let Vt=0;Vt<this.numAttributes;Vt++)R[Vt]&&(C.bindAttribLocation(this.program,Vt,R[Vt]),this.attributes[R[Vt]]=Vt);if(C.linkProgram(this.program),!C.getProgramParameter(this.program,C.LINK_STATUS))throw new Error(`Program failed to link: ${C.getProgramInfoLog(this.program)}`);C.deleteShader(Pt),C.deleteShader(ct);for(let Vt=0;Vt<at.length;Vt++){const Yt=at[Vt];if(Yt&&!Bt[Yt]){const ne=C.getUniformLocation(this.program,Yt);ne&&(Bt[Yt]=ne)}}this.fixedUniforms=g(s,Bt),this.terrainUniforms=((Vt,Yt)=>({u_depth:new a.aL(Vt,Yt.u_depth),u_terrain:new a.aL(Vt,Yt.u_terrain),u_terrain_dim:new a.aM(Vt,Yt.u_terrain_dim),u_terrain_matrix:new a.aN(Vt,Yt.u_terrain_matrix),u_terrain_unpack:new a.aO(Vt,Yt.u_terrain_unpack),u_terrain_exaggeration:new a.aM(Vt,Yt.u_terrain_exaggeration)}))(s,Bt),this.binderUniforms=d?d.getUniforms(s,Bt):[]}draw(s,h,d,g,b,I,C,M,N,R,z,W,nt,et,at,Q,Lt,Ot){const ct=s.gl;if(this.failedToCreate)return;if(s.program.set(this.program),s.setDepthMode(d),s.setStencilMode(g),s.setColorMode(b),s.setCullFace(I),M){s.activeTexture.set(ct.TEXTURE2),ct.bindTexture(ct.TEXTURE_2D,M.depthTexture),s.activeTexture.set(ct.TEXTURE3),ct.bindTexture(ct.TEXTURE_2D,M.texture);for(const Bt in this.terrainUniforms)this.terrainUniforms[Bt].set(M[Bt])}for(const Bt in this.fixedUniforms)this.fixedUniforms[Bt].set(C[Bt]);at&&at.setUniforms(s,this.binderUniforms,nt,{zoom:et});let Pt=0;switch(h){case ct.LINES:Pt=2;break;case ct.TRIANGLES:Pt=3;break;case ct.LINE_STRIP:Pt=1}for(const Bt of W.get()){const Vt=Bt.vaos||(Bt.vaos={});(Vt[N]||(Vt[N]=new Sl)).bind(s,this,R,at?at.getPaintVertexBuffers():[],z,Bt.vertexOffset,Q,Lt,Ot),ct.drawElements(h,Bt.primitiveLength*Pt,ct.UNSIGNED_SHORT,Bt.primitiveOffset*Pt*2)}}}function ss(y,s,h){const d=1/bt(h,1,s.transform.tileZoom),g=Math.pow(2,h.tileID.overscaledZ),b=h.tileSize*Math.pow(2,s.transform.tileZoom)/g,I=b*(h.tileID.canonical.x+h.tileID.wrap*g),C=b*h.tileID.canonical.y;return{u_image:0,u_texsize:h.imageAtlasTexture.size,u_scale:[d,y.fromScale,y.toScale],u_fade:y.t,u_pixel_coord_upper:[I>>16,C>>16],u_pixel_coord_lower:[65535&I,65535&C]}}const gf=(y,s,h,d)=>{const g=s.style.light,b=g.properties.get("position"),I=[b.x,b.y,b.z],C=function(){var N=new a.A(9);return a.A!=Float32Array&&(N[1]=0,N[2]=0,N[3]=0,N[5]=0,N[6]=0,N[7]=0),N[0]=1,N[4]=1,N[8]=1,N}();g.properties.get("anchor")==="viewport"&&function(N,R){var z=Math.sin(R),W=Math.cos(R);N[0]=W,N[1]=z,N[2]=0,N[3]=-z,N[4]=W,N[5]=0,N[6]=0,N[7]=0,N[8]=1}(C,-s.transform.angle),function(N,R,z){var W=R[0],nt=R[1],et=R[2];N[0]=W*z[0]+nt*z[3]+et*z[6],N[1]=W*z[1]+nt*z[4]+et*z[7],N[2]=W*z[2]+nt*z[5]+et*z[8]}(I,I,C);const M=g.properties.get("color");return{u_matrix:y,u_lightpos:I,u_lightintensity:g.properties.get("intensity"),u_lightcolor:[M.r,M.g,M.b],u_vertical_gradient:+h,u_opacity:d}},Ya=(y,s,h,d,g,b,I)=>a.e(gf(y,s,h,d),ss(b,s,I),{u_height_factor:-Math.pow(2,g.overscaledZ)/I.tileSize/8}),wd=y=>({u_matrix:y}),_f=(y,s,h,d)=>a.e(wd(y),ss(h,s,d)),jc=(y,s)=>({u_matrix:y,u_world:s}),qc=(y,s,h,d,g)=>a.e(_f(y,s,h,d),{u_world:g}),Ka=(y,s,h,d)=>{const g=y.transform;let b,I;if(d.paint.get("circle-pitch-alignment")==="map"){const C=bt(h,1,g.zoom);b=!0,I=[C,C]}else b=!1,I=g.pixelsToGLUnits;return{u_camera_to_center_distance:g.cameraToCenterDistance,u_scale_with_map:+(d.paint.get("circle-pitch-scale")==="map"),u_matrix:y.translatePosMatrix(s.posMatrix,h,d.paint.get("circle-translate"),d.paint.get("circle-translate-anchor")),u_pitch_with_map:+b,u_device_pixel_ratio:y.pixelRatio,u_extrude_scale:I}},yf=(y,s,h)=>{const d=bt(h,1,s.zoom),g=Math.pow(2,s.zoom-h.tileID.overscaledZ),b=h.tileID.overscaleFactor();return{u_matrix:y,u_camera_to_center_distance:s.cameraToCenterDistance,u_pixels_to_tile_units:d,u_extrude_scale:[s.pixelsToGLUnits[0]/(d*g),s.pixelsToGLUnits[1]/(d*g)],u_overscale_factor:b}},Xu=(y,s,h=1)=>({u_matrix:y,u_color:s,u_overlay:0,u_overlay_scale:h}),Sd=y=>({u_matrix:y}),Fg=(y,s,h,d)=>({u_matrix:y,u_extrude_scale:bt(s,1,h),u_intensity:d});function vf(y,s){const h=Math.pow(2,s.canonical.z),d=s.canonical.y;return[new a.U(0,d/h).toLngLat().lat,new a.U(0,(d+1)/h).toLngLat().lat]}const bf=(y,s,h,d)=>{const g=y.transform;return{u_matrix:Zc(y,s,h,d),u_ratio:1/bt(s,1,g.zoom),u_device_pixel_ratio:y.pixelRatio,u_units_to_pixels:[1/g.pixelsToGLUnits[0],1/g.pixelsToGLUnits[1]]}},Ed=(y,s,h,d,g)=>a.e(bf(y,s,h,g),{u_image:0,u_image_height:d}),Bg=(y,s,h,d,g)=>{const b=y.transform,I=Cd(s,b);return{u_matrix:Zc(y,s,h,g),u_texsize:s.imageAtlasTexture.size,u_ratio:1/bt(s,1,b.zoom),u_device_pixel_ratio:y.pixelRatio,u_image:0,u_scale:[I,d.fromScale,d.toScale],u_fade:d.t,u_units_to_pixels:[1/b.pixelsToGLUnits[0],1/b.pixelsToGLUnits[1]]}},Id=(y,s,h,d,g,b)=>{const I=y.lineAtlas,C=Cd(s,y.transform),M=h.layout.get("line-cap")==="round",N=I.getDash(d.from,M),R=I.getDash(d.to,M),z=N.width*g.fromScale,W=R.width*g.toScale;return a.e(bf(y,s,h,b),{u_patternscale_a:[C/z,-N.height/2],u_patternscale_b:[C/W,-R.height/2],u_sdfgamma:I.width/(256*Math.min(z,W)*y.pixelRatio)/2,u_image:0,u_tex_y_a:N.y,u_tex_y_b:R.y,u_mix:g.t})};function Cd(y,s){return 1/bt(y,1,s.tileZoom)}function Zc(y,s,h,d){return y.translatePosMatrix(d?d.posMatrix:s.tileID.posMatrix,s,h.paint.get("line-translate"),h.paint.get("line-translate-anchor"))}const Td=(y,s,h,d,g)=>{return{u_matrix:y,u_tl_parent:s,u_scale_parent:h,u_buffer_scale:1,u_fade_t:d.mix,u_opacity:d.opacity*g.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:g.paint.get("raster-brightness-min"),u_brightness_high:g.paint.get("raster-brightness-max"),u_saturation_factor:(I=g.paint.get("raster-saturation"),I>0?1-1/(1.001-I):-I),u_contrast_factor:(b=g.paint.get("raster-contrast"),b>0?1/(1-b):1+b),u_spin_weights:Ld(g.paint.get("raster-hue-rotate"))};var b,I};function Ld(y){y*=Math.PI/180;const s=Math.sin(y),h=Math.cos(y);return[(2*h+1)/3,(-Math.sqrt(3)*s-h+1)/3,(Math.sqrt(3)*s-h+1)/3]}const xf=(y,s,h,d,g,b,I,C,M,N)=>{const R=g.transform;return{u_is_size_zoom_constant:+(y==="constant"||y==="source"),u_is_size_feature_constant:+(y==="constant"||y==="camera"),u_size_t:s?s.uSizeT:0,u_size:s?s.uSize:0,u_camera_to_center_distance:R.cameraToCenterDistance,u_pitch:R.pitch/360*2*Math.PI,u_rotate_symbol:+h,u_aspect_ratio:R.width/R.height,u_fade_change:g.options.fadeDuration?g.symbolFadeChange:1,u_matrix:b,u_label_plane_matrix:I,u_coord_matrix:C,u_is_text:+M,u_pitch_with_map:+d,u_texsize:N,u_texture:0}},wf=(y,s,h,d,g,b,I,C,M,N,R)=>{const z=g.transform;return a.e(xf(y,s,h,d,g,b,I,C,M,N),{u_gamma_scale:d?Math.cos(z._pitch)*z.cameraToCenterDistance:1,u_device_pixel_ratio:g.pixelRatio,u_is_halo:+R})},El=(y,s,h,d,g,b,I,C,M,N)=>a.e(wf(y,s,h,d,g,b,I,C,!0,M,!0),{u_texsize_icon:N,u_texture_icon:1}),$c=(y,s,h)=>({u_matrix:y,u_opacity:s,u_color:h}),as=(y,s,h,d,g,b)=>a.e(function(I,C,M,N){const R=M.imageManager.getPattern(I.from.toString()),z=M.imageManager.getPattern(I.to.toString()),{width:W,height:nt}=M.imageManager.getPixelSize(),et=Math.pow(2,N.tileID.overscaledZ),at=N.tileSize*Math.pow(2,M.transform.tileZoom)/et,Q=at*(N.tileID.canonical.x+N.tileID.wrap*et),Lt=at*N.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:R.tl,u_pattern_br_a:R.br,u_pattern_tl_b:z.tl,u_pattern_br_b:z.br,u_texsize:[W,nt],u_mix:C.t,u_pattern_size_a:R.displaySize,u_pattern_size_b:z.displaySize,u_scale_a:C.fromScale,u_scale_b:C.toScale,u_tile_units_to_pixels:1/bt(N,1,M.transform.tileZoom),u_pixel_coord_upper:[Q>>16,Lt>>16],u_pixel_coord_lower:[65535&Q,65535&Lt]}}(d,b,h,g),{u_matrix:y,u_opacity:s}),Wc={fillExtrusion:(y,s)=>({u_matrix:new a.aN(y,s.u_matrix),u_lightpos:new a.aP(y,s.u_lightpos),u_lightintensity:new a.aM(y,s.u_lightintensity),u_lightcolor:new a.aP(y,s.u_lightcolor),u_vertical_gradient:new a.aM(y,s.u_vertical_gradient),u_opacity:new a.aM(y,s.u_opacity)}),fillExtrusionPattern:(y,s)=>({u_matrix:new a.aN(y,s.u_matrix),u_lightpos:new a.aP(y,s.u_lightpos),u_lightintensity:new a.aM(y,s.u_lightintensity),u_lightcolor:new a.aP(y,s.u_lightcolor),u_vertical_gradient:new a.aM(y,s.u_vertical_gradient),u_height_factor:new a.aM(y,s.u_height_factor),u_image:new a.aL(y,s.u_image),u_texsize:new a.aQ(y,s.u_texsize),u_pixel_coord_upper:new a.aQ(y,s.u_pixel_coord_upper),u_pixel_coord_lower:new a.aQ(y,s.u_pixel_coord_lower),u_scale:new a.aP(y,s.u_scale),u_fade:new a.aM(y,s.u_fade),u_opacity:new a.aM(y,s.u_opacity)}),fill:(y,s)=>({u_matrix:new a.aN(y,s.u_matrix)}),fillPattern:(y,s)=>({u_matrix:new a.aN(y,s.u_matrix),u_image:new a.aL(y,s.u_image),u_texsize:new a.aQ(y,s.u_texsize),u_pixel_coord_upper:new a.aQ(y,s.u_pixel_coord_upper),u_pixel_coord_lower:new a.aQ(y,s.u_pixel_coord_lower),u_scale:new a.aP(y,s.u_scale),u_fade:new a.aM(y,s.u_fade)}),fillOutline:(y,s)=>({u_matrix:new a.aN(y,s.u_matrix),u_world:new a.aQ(y,s.u_world)}),fillOutlinePattern:(y,s)=>({u_matrix:new a.aN(y,s.u_matrix),u_world:new a.aQ(y,s.u_world),u_image:new a.aL(y,s.u_image),u_texsize:new a.aQ(y,s.u_texsize),u_pixel_coord_upper:new a.aQ(y,s.u_pixel_coord_upper),u_pixel_coord_lower:new a.aQ(y,s.u_pixel_coord_lower),u_scale:new a.aP(y,s.u_scale),u_fade:new a.aM(y,s.u_fade)}),circle:(y,s)=>({u_camera_to_center_distance:new a.aM(y,s.u_camera_to_center_distance),u_scale_with_map:new a.aL(y,s.u_scale_with_map),u_pitch_with_map:new a.aL(y,s.u_pitch_with_map),u_extrude_scale:new a.aQ(y,s.u_extrude_scale),u_device_pixel_ratio:new a.aM(y,s.u_device_pixel_ratio),u_matrix:new a.aN(y,s.u_matrix)}),collisionBox:(y,s)=>({u_matrix:new a.aN(y,s.u_matrix),u_camera_to_center_distance:new a.aM(y,s.u_camera_to_center_distance),u_pixels_to_tile_units:new a.aM(y,s.u_pixels_to_tile_units),u_extrude_scale:new a.aQ(y,s.u_extrude_scale),u_overscale_factor:new a.aM(y,s.u_overscale_factor)}),collisionCircle:(y,s)=>({u_matrix:new a.aN(y,s.u_matrix),u_inv_matrix:new a.aN(y,s.u_inv_matrix),u_camera_to_center_distance:new a.aM(y,s.u_camera_to_center_distance),u_viewport_size:new a.aQ(y,s.u_viewport_size)}),debug:(y,s)=>({u_color:new a.aR(y,s.u_color),u_matrix:new a.aN(y,s.u_matrix),u_overlay:new a.aL(y,s.u_overlay),u_overlay_scale:new a.aM(y,s.u_overlay_scale)}),clippingMask:(y,s)=>({u_matrix:new a.aN(y,s.u_matrix)}),heatmap:(y,s)=>({u_extrude_scale:new a.aM(y,s.u_extrude_scale),u_intensity:new a.aM(y,s.u_intensity),u_matrix:new a.aN(y,s.u_matrix)}),heatmapTexture:(y,s)=>({u_matrix:new a.aN(y,s.u_matrix),u_world:new a.aQ(y,s.u_world),u_image:new a.aL(y,s.u_image),u_color_ramp:new a.aL(y,s.u_color_ramp),u_opacity:new a.aM(y,s.u_opacity)}),hillshade:(y,s)=>({u_matrix:new a.aN(y,s.u_matrix),u_image:new a.aL(y,s.u_image),u_latrange:new a.aQ(y,s.u_latrange),u_light:new a.aQ(y,s.u_light),u_shadow:new a.aR(y,s.u_shadow),u_highlight:new a.aR(y,s.u_highlight),u_accent:new a.aR(y,s.u_accent)}),hillshadePrepare:(y,s)=>({u_matrix:new a.aN(y,s.u_matrix),u_image:new a.aL(y,s.u_image),u_dimension:new a.aQ(y,s.u_dimension),u_zoom:new a.aM(y,s.u_zoom),u_unpack:new a.aO(y,s.u_unpack)}),line:(y,s)=>({u_matrix:new a.aN(y,s.u_matrix),u_ratio:new a.aM(y,s.u_ratio),u_device_pixel_ratio:new a.aM(y,s.u_device_pixel_ratio),u_units_to_pixels:new a.aQ(y,s.u_units_to_pixels)}),lineGradient:(y,s)=>({u_matrix:new a.aN(y,s.u_matrix),u_ratio:new a.aM(y,s.u_ratio),u_device_pixel_ratio:new a.aM(y,s.u_device_pixel_ratio),u_units_to_pixels:new a.aQ(y,s.u_units_to_pixels),u_image:new a.aL(y,s.u_image),u_image_height:new a.aM(y,s.u_image_height)}),linePattern:(y,s)=>({u_matrix:new a.aN(y,s.u_matrix),u_texsize:new a.aQ(y,s.u_texsize),u_ratio:new a.aM(y,s.u_ratio),u_device_pixel_ratio:new a.aM(y,s.u_device_pixel_ratio),u_image:new a.aL(y,s.u_image),u_units_to_pixels:new a.aQ(y,s.u_units_to_pixels),u_scale:new a.aP(y,s.u_scale),u_fade:new a.aM(y,s.u_fade)}),lineSDF:(y,s)=>({u_matrix:new a.aN(y,s.u_matrix),u_ratio:new a.aM(y,s.u_ratio),u_device_pixel_ratio:new a.aM(y,s.u_device_pixel_ratio),u_units_to_pixels:new a.aQ(y,s.u_units_to_pixels),u_patternscale_a:new a.aQ(y,s.u_patternscale_a),u_patternscale_b:new a.aQ(y,s.u_patternscale_b),u_sdfgamma:new a.aM(y,s.u_sdfgamma),u_image:new a.aL(y,s.u_image),u_tex_y_a:new a.aM(y,s.u_tex_y_a),u_tex_y_b:new a.aM(y,s.u_tex_y_b),u_mix:new a.aM(y,s.u_mix)}),raster:(y,s)=>({u_matrix:new a.aN(y,s.u_matrix),u_tl_parent:new a.aQ(y,s.u_tl_parent),u_scale_parent:new a.aM(y,s.u_scale_parent),u_buffer_scale:new a.aM(y,s.u_buffer_scale),u_fade_t:new a.aM(y,s.u_fade_t),u_opacity:new a.aM(y,s.u_opacity),u_image0:new a.aL(y,s.u_image0),u_image1:new a.aL(y,s.u_image1),u_brightness_low:new a.aM(y,s.u_brightness_low),u_brightness_high:new a.aM(y,s.u_brightness_high),u_saturation_factor:new a.aM(y,s.u_saturation_factor),u_contrast_factor:new a.aM(y,s.u_contrast_factor),u_spin_weights:new a.aP(y,s.u_spin_weights)}),symbolIcon:(y,s)=>({u_is_size_zoom_constant:new a.aL(y,s.u_is_size_zoom_constant),u_is_size_feature_constant:new a.aL(y,s.u_is_size_feature_constant),u_size_t:new a.aM(y,s.u_size_t),u_size:new a.aM(y,s.u_size),u_camera_to_center_distance:new a.aM(y,s.u_camera_to_center_distance),u_pitch:new a.aM(y,s.u_pitch),u_rotate_symbol:new a.aL(y,s.u_rotate_symbol),u_aspect_ratio:new a.aM(y,s.u_aspect_ratio),u_fade_change:new a.aM(y,s.u_fade_change),u_matrix:new a.aN(y,s.u_matrix),u_label_plane_matrix:new a.aN(y,s.u_label_plane_matrix),u_coord_matrix:new a.aN(y,s.u_coord_matrix),u_is_text:new a.aL(y,s.u_is_text),u_pitch_with_map:new a.aL(y,s.u_pitch_with_map),u_texsize:new a.aQ(y,s.u_texsize),u_texture:new a.aL(y,s.u_texture)}),symbolSDF:(y,s)=>({u_is_size_zoom_constant:new a.aL(y,s.u_is_size_zoom_constant),u_is_size_feature_constant:new a.aL(y,s.u_is_size_feature_constant),u_size_t:new a.aM(y,s.u_size_t),u_size:new a.aM(y,s.u_size),u_camera_to_center_distance:new a.aM(y,s.u_camera_to_center_distance),u_pitch:new a.aM(y,s.u_pitch),u_rotate_symbol:new a.aL(y,s.u_rotate_symbol),u_aspect_ratio:new a.aM(y,s.u_aspect_ratio),u_fade_change:new a.aM(y,s.u_fade_change),u_matrix:new a.aN(y,s.u_matrix),u_label_plane_matrix:new a.aN(y,s.u_label_plane_matrix),u_coord_matrix:new a.aN(y,s.u_coord_matrix),u_is_text:new a.aL(y,s.u_is_text),u_pitch_with_map:new a.aL(y,s.u_pitch_with_map),u_texsize:new a.aQ(y,s.u_texsize),u_texture:new a.aL(y,s.u_texture),u_gamma_scale:new a.aM(y,s.u_gamma_scale),u_device_pixel_ratio:new a.aM(y,s.u_device_pixel_ratio),u_is_halo:new a.aL(y,s.u_is_halo)}),symbolTextAndIcon:(y,s)=>({u_is_size_zoom_constant:new a.aL(y,s.u_is_size_zoom_constant),u_is_size_feature_constant:new a.aL(y,s.u_is_size_feature_constant),u_size_t:new a.aM(y,s.u_size_t),u_size:new a.aM(y,s.u_size),u_camera_to_center_distance:new a.aM(y,s.u_camera_to_center_distance),u_pitch:new a.aM(y,s.u_pitch),u_rotate_symbol:new a.aL(y,s.u_rotate_symbol),u_aspect_ratio:new a.aM(y,s.u_aspect_ratio),u_fade_change:new a.aM(y,s.u_fade_change),u_matrix:new a.aN(y,s.u_matrix),u_label_plane_matrix:new a.aN(y,s.u_label_plane_matrix),u_coord_matrix:new a.aN(y,s.u_coord_matrix),u_is_text:new a.aL(y,s.u_is_text),u_pitch_with_map:new a.aL(y,s.u_pitch_with_map),u_texsize:new a.aQ(y,s.u_texsize),u_texsize_icon:new a.aQ(y,s.u_texsize_icon),u_texture:new a.aL(y,s.u_texture),u_texture_icon:new a.aL(y,s.u_texture_icon),u_gamma_scale:new a.aM(y,s.u_gamma_scale),u_device_pixel_ratio:new a.aM(y,s.u_device_pixel_ratio),u_is_halo:new a.aL(y,s.u_is_halo)}),background:(y,s)=>({u_matrix:new a.aN(y,s.u_matrix),u_opacity:new a.aM(y,s.u_opacity),u_color:new a.aR(y,s.u_color)}),backgroundPattern:(y,s)=>({u_matrix:new a.aN(y,s.u_matrix),u_opacity:new a.aM(y,s.u_opacity),u_image:new a.aL(y,s.u_image),u_pattern_tl_a:new a.aQ(y,s.u_pattern_tl_a),u_pattern_br_a:new a.aQ(y,s.u_pattern_br_a),u_pattern_tl_b:new a.aQ(y,s.u_pattern_tl_b),u_pattern_br_b:new a.aQ(y,s.u_pattern_br_b),u_texsize:new a.aQ(y,s.u_texsize),u_mix:new a.aM(y,s.u_mix),u_pattern_size_a:new a.aQ(y,s.u_pattern_size_a),u_pattern_size_b:new a.aQ(y,s.u_pattern_size_b),u_scale_a:new a.aM(y,s.u_scale_a),u_scale_b:new a.aM(y,s.u_scale_b),u_pixel_coord_upper:new a.aQ(y,s.u_pixel_coord_upper),u_pixel_coord_lower:new a.aQ(y,s.u_pixel_coord_lower),u_tile_units_to_pixels:new a.aM(y,s.u_tile_units_to_pixels)}),terrain:(y,s)=>({u_matrix:new a.aN(y,s.u_matrix),u_texture:new a.aL(y,s.u_texture),u_ele_delta:new a.aM(y,s.u_ele_delta)}),terrainDepth:(y,s)=>({u_matrix:new a.aN(y,s.u_matrix),u_ele_delta:new a.aM(y,s.u_ele_delta)}),terrainCoords:(y,s)=>({u_matrix:new a.aN(y,s.u_matrix),u_texture:new a.aL(y,s.u_texture),u_terrain_coords_id:new a.aM(y,s.u_terrain_coords_id),u_ele_delta:new a.aM(y,s.u_ele_delta)})};class Xc{constructor(s,h,d){this.context=s;const g=s.gl;this.buffer=g.createBuffer(),this.dynamicDraw=!!d,this.context.unbindVAO(),s.bindElementBuffer.set(this.buffer),g.bufferData(g.ELEMENT_ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?g.DYNAMIC_DRAW:g.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(s){const h=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),h.bufferSubData(h.ELEMENT_ARRAY_BUFFER,0,s.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Hu={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Hc{constructor(s,h,d,g){this.length=h.length,this.attributes=d,this.itemSize=h.bytesPerElement,this.dynamicDraw=g,this.context=s;const b=s.gl;this.buffer=b.createBuffer(),s.bindVertexBuffer.set(this.buffer),b.bufferData(b.ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(s){if(s.length!==this.length)throw new Error(`Length of new data is ${s.length}, which doesn't match current length of ${this.length}`);const h=this.context.gl;this.bind(),h.bufferSubData(h.ARRAY_BUFFER,0,s.arrayBuffer)}enableAttributes(s,h){for(let d=0;d<this.attributes.length;d++){const g=h.attributes[this.attributes[d].name];g!==void 0&&s.enableVertexAttribArray(g)}}setVertexAttribPointers(s,h,d){for(let g=0;g<this.attributes.length;g++){const b=this.attributes[g],I=h.attributes[b.name];I!==void 0&&s.vertexAttribPointer(I,b.components,s[Hu[b.type]],!1,this.itemSize,b.offset+this.itemSize*(d||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const lu=new WeakMap;function Ja(y){var s;if(lu.has(y))return lu.get(y);{const h=(s=y.getParameter(y.VERSION))===null||s===void 0?void 0:s.startsWith("WebGL 2.0");return lu.set(y,h),h}}class Cn{constructor(s){this.gl=s.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(s){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Yc extends Cn{getDefault(){return a.aT.transparent}set(s){const h=this.current;(s.r!==h.r||s.g!==h.g||s.b!==h.b||s.a!==h.a||this.dirty)&&(this.gl.clearColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class Ro extends Cn{getDefault(){return 1}set(s){(s!==this.current||this.dirty)&&(this.gl.clearDepth(s),this.current=s,this.dirty=!1)}}class Oo extends Cn{getDefault(){return 0}set(s){(s!==this.current||this.dirty)&&(this.gl.clearStencil(s),this.current=s,this.dirty=!1)}}class Sf extends Cn{getDefault(){return[!0,!0,!0,!0]}set(s){const h=this.current;(s[0]!==h[0]||s[1]!==h[1]||s[2]!==h[2]||s[3]!==h[3]||this.dirty)&&(this.gl.colorMask(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class Kc extends Cn{getDefault(){return!0}set(s){(s!==this.current||this.dirty)&&(this.gl.depthMask(s),this.current=s,this.dirty=!1)}}class Jc extends Cn{getDefault(){return 255}set(s){(s!==this.current||this.dirty)&&(this.gl.stencilMask(s),this.current=s,this.dirty=!1)}}class Ef extends Cn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(s){const h=this.current;(s.func!==h.func||s.ref!==h.ref||s.mask!==h.mask||this.dirty)&&(this.gl.stencilFunc(s.func,s.ref,s.mask),this.current=s,this.dirty=!1)}}class If extends Cn{getDefault(){const s=this.gl;return[s.KEEP,s.KEEP,s.KEEP]}set(s){const h=this.current;(s[0]!==h[0]||s[1]!==h[1]||s[2]!==h[2]||this.dirty)&&(this.gl.stencilOp(s[0],s[1],s[2]),this.current=s,this.dirty=!1)}}class Qc extends Cn{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;s?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),this.current=s,this.dirty=!1}}class Cf extends Cn{getDefault(){return[0,1]}set(s){const h=this.current;(s[0]!==h[0]||s[1]!==h[1]||this.dirty)&&(this.gl.depthRange(s[0],s[1]),this.current=s,this.dirty=!1)}}class Tf extends Cn{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;s?h.enable(h.DEPTH_TEST):h.disable(h.DEPTH_TEST),this.current=s,this.dirty=!1}}class th extends Cn{getDefault(){return this.gl.LESS}set(s){(s!==this.current||this.dirty)&&(this.gl.depthFunc(s),this.current=s,this.dirty=!1)}}class Md extends Cn{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;s?h.enable(h.BLEND):h.disable(h.BLEND),this.current=s,this.dirty=!1}}class Pd extends Cn{getDefault(){const s=this.gl;return[s.ONE,s.ZERO]}set(s){const h=this.current;(s[0]!==h[0]||s[1]!==h[1]||this.dirty)&&(this.gl.blendFunc(s[0],s[1]),this.current=s,this.dirty=!1)}}class uu extends Cn{getDefault(){return a.aT.transparent}set(s){const h=this.current;(s.r!==h.r||s.g!==h.g||s.b!==h.b||s.a!==h.a||this.dirty)&&(this.gl.blendColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class Vg extends Cn{getDefault(){return this.gl.FUNC_ADD}set(s){(s!==this.current||this.dirty)&&(this.gl.blendEquation(s),this.current=s,this.dirty=!1)}}class Ug extends Cn{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;s?h.enable(h.CULL_FACE):h.disable(h.CULL_FACE),this.current=s,this.dirty=!1}}class Gg extends Cn{getDefault(){return this.gl.BACK}set(s){(s!==this.current||this.dirty)&&(this.gl.cullFace(s),this.current=s,this.dirty=!1)}}class jg extends Cn{getDefault(){return this.gl.CCW}set(s){(s!==this.current||this.dirty)&&(this.gl.frontFace(s),this.current=s,this.dirty=!1)}}class qg extends Cn{getDefault(){return null}set(s){(s!==this.current||this.dirty)&&(this.gl.useProgram(s),this.current=s,this.dirty=!1)}}class Zg extends Cn{getDefault(){return this.gl.TEXTURE0}set(s){(s!==this.current||this.dirty)&&(this.gl.activeTexture(s),this.current=s,this.dirty=!1)}}class Lf extends Cn{getDefault(){const s=this.gl;return[0,0,s.drawingBufferWidth,s.drawingBufferHeight]}set(s){const h=this.current;(s[0]!==h[0]||s[1]!==h[1]||s[2]!==h[2]||s[3]!==h[3]||this.dirty)&&(this.gl.viewport(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class eh extends Cn{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.bindFramebuffer(h.FRAMEBUFFER,s),this.current=s,this.dirty=!1}}class Mf extends Cn{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.bindRenderbuffer(h.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class Pf extends Cn{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.bindTexture(h.TEXTURE_2D,s),this.current=s,this.dirty=!1}}class cu extends Cn{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.bindBuffer(h.ARRAY_BUFFER,s),this.current=s,this.dirty=!1}}class kd extends Cn{getDefault(){return null}set(s){const h=this.gl;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,s),this.current=s,this.dirty=!1}}class Ad extends Cn{getDefault(){return null}set(s){var h;if(s===this.current&&!this.dirty)return;const d=this.gl;Ja(d)?d.bindVertexArray(s):(h=d.getExtension("OES_vertex_array_object"))===null||h===void 0||h.bindVertexArrayOES(s),this.current=s,this.dirty=!1}}class kf extends Cn{getDefault(){return 4}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_ALIGNMENT,s),this.current=s,this.dirty=!1}}class Il extends Cn{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s),this.current=s,this.dirty=!1}}class Nd extends Cn{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,s),this.current=s,this.dirty=!1}}class Qa extends Cn{constructor(s,h){super(s),this.context=s,this.parent=h}getDefault(){return null}}class hu extends Qa{setDirty(){this.dirty=!0}set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,s,0),this.current=s,this.dirty=!1}}class Dd extends Qa{set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_ATTACHMENT,h.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class Af extends Qa{set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_STENCIL_ATTACHMENT,h.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class Bn{constructor(s,h,d,g,b){this.context=s,this.width=h,this.height=d;const I=s.gl,C=this.framebuffer=I.createFramebuffer();if(this.colorAttachment=new hu(s,C),g)this.depthAttachment=b?new Af(s,C):new Dd(s,C);else if(b)throw new Error("Stencil cannot be setted without depth");if(I.checkFramebufferStatus(I.FRAMEBUFFER)!==I.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const s=this.context.gl,h=this.colorAttachment.get();if(h&&s.deleteTexture(h),this.depthAttachment){const d=this.depthAttachment.get();d&&s.deleteRenderbuffer(d)}s.deleteFramebuffer(this.framebuffer)}}class Ii{constructor(s,h,d){this.blendFunction=s,this.blendColor=h,this.mask=d}}Ii.Replace=[1,0],Ii.disabled=new Ii(Ii.Replace,a.aT.transparent,[!1,!1,!1,!1]),Ii.unblended=new Ii(Ii.Replace,a.aT.transparent,[!0,!0,!0,!0]),Ii.alphaBlended=new Ii([1,771],a.aT.transparent,[!0,!0,!0,!0]);class $g{constructor(s){var h,d;if(this.gl=s,this.clearColor=new Yc(this),this.clearDepth=new Ro(this),this.clearStencil=new Oo(this),this.colorMask=new Sf(this),this.depthMask=new Kc(this),this.stencilMask=new Jc(this),this.stencilFunc=new Ef(this),this.stencilOp=new If(this),this.stencilTest=new Qc(this),this.depthRange=new Cf(this),this.depthTest=new Tf(this),this.depthFunc=new th(this),this.blend=new Md(this),this.blendFunc=new Pd(this),this.blendColor=new uu(this),this.blendEquation=new Vg(this),this.cullFace=new Ug(this),this.cullFaceSide=new Gg(this),this.frontFace=new jg(this),this.program=new qg(this),this.activeTexture=new Zg(this),this.viewport=new Lf(this),this.bindFramebuffer=new eh(this),this.bindRenderbuffer=new Mf(this),this.bindTexture=new Pf(this),this.bindVertexBuffer=new cu(this),this.bindElementBuffer=new kd(this),this.bindVertexArray=new Ad(this),this.pixelStoreUnpack=new kf(this),this.pixelStoreUnpackPremultiplyAlpha=new Il(this),this.pixelStoreUnpackFlipY=new Nd(this),this.extTextureFilterAnisotropic=s.getExtension("EXT_texture_filter_anisotropic")||s.getExtension("MOZ_EXT_texture_filter_anisotropic")||s.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=s.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=s.getParameter(s.MAX_TEXTURE_SIZE),Ja(s)){this.HALF_FLOAT=s.HALF_FLOAT;const g=s.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(h=s.RGBA16F)!==null&&h!==void 0?h:g==null?void 0:g.RGBA16F_EXT,this.RGB16F=(d=s.RGB16F)!==null&&d!==void 0?d:g==null?void 0:g.RGB16F_EXT,s.getExtension("EXT_color_buffer_float")}else{s.getExtension("EXT_color_buffer_half_float"),s.getExtension("OES_texture_half_float_linear");const g=s.getExtension("OES_texture_half_float");this.HALF_FLOAT=g==null?void 0:g.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(s,h){return new Xc(this,s,h)}createVertexBuffer(s,h,d){return new Hc(this,s,h,d)}createRenderbuffer(s,h,d){const g=this.gl,b=g.createRenderbuffer();return this.bindRenderbuffer.set(b),g.renderbufferStorage(g.RENDERBUFFER,s,h,d),this.bindRenderbuffer.set(null),b}createFramebuffer(s,h,d,g){return new Bn(this,s,h,d,g)}clear({color:s,depth:h,stencil:d}){const g=this.gl;let b=0;s&&(b|=g.COLOR_BUFFER_BIT,this.clearColor.set(s),this.colorMask.set([!0,!0,!0,!0])),h!==void 0&&(b|=g.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(h),this.depthMask.set(!0)),d!==void 0&&(b|=g.STENCIL_BUFFER_BIT,this.clearStencil.set(d),this.stencilMask.set(255)),g.clear(b)}setCullFace(s){s.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(s.mode),this.frontFace.set(s.frontFace))}setDepthMode(s){s.func!==this.gl.ALWAYS||s.mask?(this.depthTest.set(!0),this.depthFunc.set(s.func),this.depthMask.set(s.mask),this.depthRange.set(s.range)):this.depthTest.set(!1)}setStencilMode(s){s.test.func!==this.gl.ALWAYS||s.mask?(this.stencilTest.set(!0),this.stencilMask.set(s.mask),this.stencilOp.set([s.fail,s.depthFail,s.pass]),this.stencilFunc.set({func:s.test.func,ref:s.ref,mask:s.test.mask})):this.stencilTest.set(!1)}setColorMode(s){a.aG(s.blendFunction,Ii.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(s.blendFunction),this.blendColor.set(s.blendColor)),this.colorMask.set(s.mask)}createVertexArray(){var s;return Ja(this.gl)?this.gl.createVertexArray():(s=this.gl.getExtension("OES_vertex_array_object"))===null||s===void 0?void 0:s.createVertexArrayOES()}deleteVertexArray(s){var h;return Ja(this.gl)?this.gl.deleteVertexArray(s):(h=this.gl.getExtension("OES_vertex_array_object"))===null||h===void 0?void 0:h.deleteVertexArrayOES(s)}unbindVAO(){this.bindVertexArray.set(null)}}class Tn{constructor(s,h,d){this.func=s,this.mask=h,this.range=d}}Tn.ReadOnly=!1,Tn.ReadWrite=!0,Tn.disabled=new Tn(519,Tn.ReadOnly,[0,1]);const Cl=7680;class Ci{constructor(s,h,d,g,b,I){this.test=s,this.ref=h,this.mask=d,this.fail=g,this.depthFail=b,this.pass=I}}Ci.disabled=new Ci({func:519,mask:0},0,0,Cl,Cl,Cl);class vi{constructor(s,h,d){this.enable=s,this.mode=h,this.frontFace=d}}let Yu;function Rd(y,s,h,d,g,b,I){const C=y.context,M=C.gl,N=y.useProgram("collisionBox"),R=[];let z=0,W=0;for(let ct=0;ct<d.length;ct++){const Pt=d[ct],Bt=s.getTile(Pt),Vt=Bt.getBucket(h);if(!Vt)continue;let Yt=Pt.posMatrix;g[0]===0&&g[1]===0||(Yt=y.translatePosMatrix(Pt.posMatrix,Bt,g,b));const ne=I?Vt.textCollisionBox:Vt.iconCollisionBox,te=Vt.collisionCircleArray;if(te.length>0){const ae=a.Z(),Le=Yt;a.aU(ae,Vt.placementInvProjMatrix,y.transform.glCoordMatrix),a.aU(ae,ae,Vt.placementViewportMatrix),R.push({circleArray:te,circleOffset:W,transform:Le,invTransform:ae,coord:Pt}),z+=te.length/4,W=z}ne&&N.draw(C,M.LINES,Tn.disabled,Ci.disabled,y.colorModeForRenderPass(),vi.disabled,yf(Yt,y.transform,Bt),y.style.map.terrain&&y.style.map.terrain.getTerrainData(Pt),h.id,ne.layoutVertexBuffer,ne.indexBuffer,ne.segments,null,y.transform.zoom,null,null,ne.collisionVertexBuffer)}if(!I||!R.length)return;const nt=y.useProgram("collisionCircle"),et=new a.aV;et.resize(4*z),et._trim();let at=0;for(const ct of R)for(let Pt=0;Pt<ct.circleArray.length/4;Pt++){const Bt=4*Pt,Vt=ct.circleArray[Bt+0],Yt=ct.circleArray[Bt+1],ne=ct.circleArray[Bt+2],te=ct.circleArray[Bt+3];et.emplace(at++,Vt,Yt,ne,te,0),et.emplace(at++,Vt,Yt,ne,te,1),et.emplace(at++,Vt,Yt,ne,te,2),et.emplace(at++,Vt,Yt,ne,te,3)}(!Yu||Yu.length<2*z)&&(Yu=function(ct){const Pt=2*ct,Bt=new a.aX;Bt.resize(Pt),Bt._trim();for(let Vt=0;Vt<Pt;Vt++){const Yt=6*Vt;Bt.uint16[Yt+0]=4*Vt+0,Bt.uint16[Yt+1]=4*Vt+1,Bt.uint16[Yt+2]=4*Vt+2,Bt.uint16[Yt+3]=4*Vt+2,Bt.uint16[Yt+4]=4*Vt+3,Bt.uint16[Yt+5]=4*Vt+0}return Bt}(z));const Q=C.createIndexBuffer(Yu,!0),Lt=C.createVertexBuffer(et,a.aW.members,!0);for(const ct of R){const Pt={u_matrix:ct.transform,u_inv_matrix:ct.invTransform,u_camera_to_center_distance:(Ot=y.transform).cameraToCenterDistance,u_viewport_size:[Ot.width,Ot.height]};nt.draw(C,M.TRIANGLES,Tn.disabled,Ci.disabled,y.colorModeForRenderPass(),vi.disabled,Pt,y.style.map.terrain&&y.style.map.terrain.getTerrainData(ct.coord),h.id,Lt,Q,a.S.simpleSegment(0,2*ct.circleOffset,ct.circleArray.length,ct.circleArray.length/2),null,y.transform.zoom,null,null,null)}var Ot;Lt.destroy(),Q.destroy()}vi.disabled=new vi(!1,1029,2305),vi.backCCW=new vi(!0,1029,2305);const Nf=a.ao(new Float32Array(16));function nh(y,s,h,d,g,b){const{horizontalAlign:I,verticalAlign:C}=a.au(y);return new a.P((-(I-.5)*s/g+d[0])*b,(-(C-.5)*h/g+d[1])*b)}function ih(y,s,h,d,g,b,I,C,M,N,R){const z=y.text.placedSymbolArray,W=y.text.dynamicLayoutVertexArray,nt=y.icon.dynamicLayoutVertexArray,et={};W.clear();for(let at=0;at<z.length;at++){const Q=z.get(at),Lt=Q.hidden||!Q.crossTileID||y.allowVerticalPlacement&&!Q.placedOrientation?null:d[Q.crossTileID];if(Lt){const Ot=new a.P(Q.anchorX,Q.anchorY),ct=ri(Ot,h?I:b,R),Pt=Ea(g.cameraToCenterDistance,ct.signedDistanceFromCamera);let Bt=a.aj(y.textSizeData,M,Q)*Pt/a.ap;h&&(Bt*=y.tilePixelRatio/C);const{width:Vt,height:Yt,anchor:ne,textOffset:te,textBoxScale:ae}=Lt,Le=nh(ne,Vt,Yt,te,ae,Bt),vn=h?ri(Ot.add(Le),b,R).point:ct.point.add(s?Le.rotate(-g.angle):Le),pe=y.allowVerticalPlacement&&Q.placedOrientation===a.ai.vertical?Math.PI/2:0;for(let Ge=0;Ge<Q.numGlyphs;Ge++)a.ak(W,vn,pe);N&&Q.associatedIconIndex>=0&&(et[Q.associatedIconIndex]={shiftedAnchor:vn,angle:pe})}else J(Q.numGlyphs,W)}if(N){nt.clear();const at=y.icon.placedSymbolArray;for(let Q=0;Q<at.length;Q++){const Lt=at.get(Q);if(Lt.hidden)J(Lt.numGlyphs,nt);else{const Ot=et[Q];if(Ot)for(let ct=0;ct<Lt.numGlyphs;ct++)a.ak(nt,Ot.shiftedAnchor,Ot.angle);else J(Lt.numGlyphs,nt)}}y.icon.dynamicLayoutVertexBuffer.updateData(nt)}y.text.dynamicLayoutVertexBuffer.updateData(W)}function Df(y,s,h){return h.iconsInText&&s?"symbolTextAndIcon":y?"symbolSDF":"symbolIcon"}function rh(y,s,h,d,g,b,I,C,M,N,R,z){const W=y.context,nt=W.gl,et=y.transform,at=C==="map",Q=M==="map",Lt=C!=="viewport"&&h.layout.get("symbol-placement")!=="point",Ot=at&&!Q&&!Lt,ct=!h.layout.get("symbol-sort-key").isConstant();let Pt=!1;const Bt=y.depthModeForSublayer(0,Tn.ReadOnly),Vt=h._unevaluatedLayout.hasValue("text-variable-anchor")||h._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Yt=[];for(const ne of d){const te=s.getTile(ne),ae=te.getBucket(h);if(!ae)continue;const Le=g?ae.text:ae.icon;if(!Le||!Le.segments.get().length||!Le.hasVisibleVertices)continue;const vn=Le.programConfigurations.get(h.id),pe=g||ae.sdfIcons,Ge=g?ae.textSizeData:ae.iconSizeData,Pe=Q||et.pitch!==0,Hn=y.useProgram(Df(pe,g,ae),vn),_n=a.ah(Ge,et.zoom),un=y.style.map.terrain&&y.style.map.terrain.getTerrainData(ne);let bn,Ui,si,Rr,pr=[0,0],Hi=null;if(g)Ui=te.glyphAtlasTexture,si=nt.LINEAR,bn=te.glyphAtlasTexture.size,ae.iconsInText&&(pr=te.imageAtlasTexture.size,Hi=te.imageAtlasTexture,Rr=Pe||y.options.rotating||y.options.zooming||Ge.kind==="composite"||Ge.kind==="camera"?nt.LINEAR:nt.NEAREST);else{const Gi=h.layout.get("icon-size").constantOr(0)!==1||ae.iconsNeedLinear;Ui=te.imageAtlasTexture,si=pe||y.options.rotating||y.options.zooming||Gi||Pe?nt.LINEAR:nt.NEAREST,bn=te.imageAtlasTexture.size}const Bo=bt(te,1,y.transform.zoom),di=le(ne.posMatrix,Q,at,y.transform,Bo),Zs=yo(ne.posMatrix,Q,at,y.transform,Bo),$s=Vt&&ae.hasTextData(),nl=h.layout.get("icon-text-fit")!=="none"&&$s&&ae.hasIconData();if(Lt){const Gi=y.style.map.terrain?(xo,ji)=>y.style.map.terrain.getElevation(ne,xo,ji):null,dr=h.layout.get("text-rotation-alignment")==="map";ce(ae,ne.posMatrix,y,g,di,Zs,Q,N,dr,Gi)}const kl=y.translatePosMatrix(ne.posMatrix,te,b,I),yu=Lt||g&&Vt||nl?Nf:di,$r=y.translatePosMatrix(Zs,te,b,I,!0),Or=pe&&h.paint.get(g?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let ao;ao=pe?ae.iconsInText?El(Ge.kind,_n,Ot,Q,y,kl,yu,$r,bn,pr):wf(Ge.kind,_n,Ot,Q,y,kl,yu,$r,g,bn,!0):xf(Ge.kind,_n,Ot,Q,y,kl,yu,$r,g,bn);const Al={program:Hn,buffers:Le,uniformValues:ao,atlasTexture:Ui,atlasTextureIcon:Hi,atlasInterpolation:si,atlasInterpolationIcon:Rr,isSDF:pe,hasHalo:Or};if(ct&&ae.canOverlap){Pt=!0;const Gi=Le.segments.get();for(const dr of Gi)Yt.push({segments:new a.S([dr]),sortKey:dr.sortKey,state:Al,terrainData:un})}else Yt.push({segments:Le.segments,sortKey:0,state:Al,terrainData:un})}Pt&&Yt.sort((ne,te)=>ne.sortKey-te.sortKey);for(const ne of Yt){const te=ne.state;if(W.activeTexture.set(nt.TEXTURE0),te.atlasTexture.bind(te.atlasInterpolation,nt.CLAMP_TO_EDGE),te.atlasTextureIcon&&(W.activeTexture.set(nt.TEXTURE1),te.atlasTextureIcon&&te.atlasTextureIcon.bind(te.atlasInterpolationIcon,nt.CLAMP_TO_EDGE)),te.isSDF){const ae=te.uniformValues;te.hasHalo&&(ae.u_is_halo=1,Rf(te.buffers,ne.segments,h,y,te.program,Bt,R,z,ae,ne.terrainData)),ae.u_is_halo=0}Rf(te.buffers,ne.segments,h,y,te.program,Bt,R,z,te.uniformValues,ne.terrainData)}}function Rf(y,s,h,d,g,b,I,C,M,N){const R=d.context;g.draw(R,R.gl.TRIANGLES,b,I,C,vi.disabled,M,N,h.id,y.layoutVertexBuffer,y.indexBuffer,s,h.paint,d.transform.zoom,y.programConfigurations.get(h.id),y.dynamicLayoutVertexBuffer,y.opacityVertexBuffer)}function Ku(y,s,h,d,g){if(!h||!d||!d.imageAtlas)return;const b=d.imageAtlas.patternPositions;let I=b[h.to.toString()],C=b[h.from.toString()];if(!I&&C&&(I=C),!C&&I&&(C=I),!I||!C){const M=g.getPaintProperty(s);I=b[M],C=b[M]}I&&C&&y.setConstantPatternPositions(I,C)}function Ju(y,s,h,d,g,b,I){const C=y.context.gl,M="fill-pattern",N=h.paint.get(M),R=N&&N.constantOr(1),z=h.getCrossfadeParameters();let W,nt,et,at,Q;I?(nt=R&&!h.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",W=C.LINES):(nt=R?"fillPattern":"fill",W=C.TRIANGLES);const Lt=N.constantOr(null);for(const Ot of d){const ct=s.getTile(Ot);if(R&&!ct.patternsLoaded())continue;const Pt=ct.getBucket(h);if(!Pt)continue;const Bt=Pt.programConfigurations.get(h.id),Vt=y.useProgram(nt,Bt),Yt=y.style.map.terrain&&y.style.map.terrain.getTerrainData(Ot);R&&(y.context.activeTexture.set(C.TEXTURE0),ct.imageAtlasTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE),Bt.updatePaintBuffers(z)),Ku(Bt,M,Lt,ct,h);const ne=Yt?Ot:null,te=y.translatePosMatrix(ne?ne.posMatrix:Ot.posMatrix,ct,h.paint.get("fill-translate"),h.paint.get("fill-translate-anchor"));if(I){at=Pt.indexBuffer2,Q=Pt.segments2;const ae=[C.drawingBufferWidth,C.drawingBufferHeight];et=nt==="fillOutlinePattern"&&R?qc(te,y,z,ct,ae):jc(te,ae)}else at=Pt.indexBuffer,Q=Pt.segments,et=R?_f(te,y,z,ct):wd(te);Vt.draw(y.context,W,g,y.stencilModeForClipping(Ot),b,vi.disabled,et,Yt,h.id,Pt.layoutVertexBuffer,at,Q,h.paint,y.transform.zoom,Bt)}}function Qu(y,s,h,d,g,b,I){const C=y.context,M=C.gl,N="fill-extrusion-pattern",R=h.paint.get(N),z=R.constantOr(1),W=h.getCrossfadeParameters(),nt=h.paint.get("fill-extrusion-opacity"),et=R.constantOr(null);for(const at of d){const Q=s.getTile(at),Lt=Q.getBucket(h);if(!Lt)continue;const Ot=y.style.map.terrain&&y.style.map.terrain.getTerrainData(at),ct=Lt.programConfigurations.get(h.id),Pt=y.useProgram(z?"fillExtrusionPattern":"fillExtrusion",ct);z&&(y.context.activeTexture.set(M.TEXTURE0),Q.imageAtlasTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),ct.updatePaintBuffers(W)),Ku(ct,N,et,Q,h);const Bt=y.translatePosMatrix(at.posMatrix,Q,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),Vt=h.paint.get("fill-extrusion-vertical-gradient"),Yt=z?Ya(Bt,y,Vt,nt,at,W,Q):gf(Bt,y,Vt,nt);Pt.draw(C,C.gl.TRIANGLES,g,b,I,vi.backCCW,Yt,Ot,h.id,Lt.layoutVertexBuffer,Lt.indexBuffer,Lt.segments,h.paint,y.transform.zoom,ct,y.style.map.terrain&&Lt.centroidVertexBuffer)}}function Wg(y,s,h,d,g,b,I){const C=y.context,M=C.gl,N=h.fbo;if(!N)return;const R=y.useProgram("hillshade"),z=y.style.map.terrain&&y.style.map.terrain.getTerrainData(s);C.activeTexture.set(M.TEXTURE0),M.bindTexture(M.TEXTURE_2D,N.colorAttachment.get()),R.draw(C,M.TRIANGLES,g,b,I,vi.disabled,((W,nt,et,at)=>{const Q=et.paint.get("hillshade-shadow-color"),Lt=et.paint.get("hillshade-highlight-color"),Ot=et.paint.get("hillshade-accent-color");let ct=et.paint.get("hillshade-illumination-direction")*(Math.PI/180);et.paint.get("hillshade-illumination-anchor")==="viewport"&&(ct-=W.transform.angle);const Pt=!W.options.moving;return{u_matrix:at?at.posMatrix:W.transform.calculatePosMatrix(nt.tileID.toUnwrapped(),Pt),u_image:0,u_latrange:vf(0,nt.tileID),u_light:[et.paint.get("hillshade-exaggeration"),ct],u_shadow:Q,u_highlight:Lt,u_accent:Ot}})(y,h,d,z?s:null),z,d.id,y.rasterBoundsBuffer,y.quadTriangleIndexBuffer,y.rasterBoundsSegments)}function Of(y,s,h,d,g,b){const I=y.context,C=I.gl,M=s.dem;if(M&&M.data){const N=M.dim,R=M.stride,z=M.getPixels();if(I.activeTexture.set(C.TEXTURE1),I.pixelStoreUnpackPremultiplyAlpha.set(!1),s.demTexture=s.demTexture||y.getTileTexture(R),s.demTexture){const nt=s.demTexture;nt.update(z,{premultiply:!1}),nt.bind(C.NEAREST,C.CLAMP_TO_EDGE)}else s.demTexture=new St(I,z,C.RGBA,{premultiply:!1}),s.demTexture.bind(C.NEAREST,C.CLAMP_TO_EDGE);I.activeTexture.set(C.TEXTURE0);let W=s.fbo;if(!W){const nt=new St(I,{width:N,height:N,data:null},C.RGBA);nt.bind(C.LINEAR,C.CLAMP_TO_EDGE),W=s.fbo=I.createFramebuffer(N,N,!0,!1),W.colorAttachment.set(nt.texture)}I.bindFramebuffer.set(W.framebuffer),I.viewport.set([0,0,N,N]),y.useProgram("hillshadePrepare").draw(I,C.TRIANGLES,d,g,b,vi.disabled,((nt,et)=>{const at=et.stride,Q=a.Z();return a.aS(Q,0,a.N,-a.N,0,0,1),a.$(Q,Q,[0,-a.N,0]),{u_matrix:Q,u_image:1,u_dimension:[at,at],u_zoom:nt.overscaledZ,u_unpack:et.getUnpackVector()}})(s.tileID,M),null,h.id,y.rasterBoundsBuffer,y.quadTriangleIndexBuffer,y.rasterBoundsSegments),s.needsHillshadePrepare=!1}}function Xg(y,s,h,d,g,b){const I=d.paint.get("raster-fade-duration");if(!b&&I>0){const C=a.h.now(),M=(C-y.timeAdded)/I,N=s?(C-s.timeAdded)/I:-1,R=h.getSource(),z=g.coveringZoomLevel({tileSize:R.tileSize,roundZoom:R.roundZoom}),W=!s||Math.abs(s.tileID.overscaledZ-z)>Math.abs(y.tileID.overscaledZ-z),nt=W&&y.refreshedUponExpiration?1:a.ad(W?M:1-N,0,1);return y.refreshedUponExpiration&&M>=1&&(y.refreshedUponExpiration=!1),s?{opacity:1,mix:1-nt}:{opacity:nt,mix:0}}return{opacity:1,mix:0}}const Od=new a.aT(1,0,0,1),oh=new a.aT(0,1,0,1),zf=new a.aT(0,0,1,1),zd=new a.aT(1,0,1,1),Fd=new a.aT(0,1,1,1);function tc(y,s,h,d){ah(y,0,s+h/2,y.transform.width,h,d)}function sh(y,s,h,d){ah(y,s-h/2,0,h,y.transform.height,d)}function ah(y,s,h,d,g,b){const I=y.context,C=I.gl;C.enable(C.SCISSOR_TEST),C.scissor(s*y.pixelRatio,h*y.pixelRatio,d*y.pixelRatio,g*y.pixelRatio),I.clear({color:b}),C.disable(C.SCISSOR_TEST)}function Bd(y,s,h){const d=y.context,g=d.gl,b=h.posMatrix,I=y.useProgram("debug"),C=Tn.disabled,M=Ci.disabled,N=y.colorModeForRenderPass(),R="$debug",z=y.style.map.terrain&&y.style.map.terrain.getTerrainData(h);d.activeTexture.set(g.TEXTURE0);const W=s.getTileByID(h.key).latestRawTileData,nt=Math.floor((W&&W.byteLength||0)/1024),et=s.getTile(h).tileSize,at=512/Math.min(et,512)*(h.overscaledZ/y.transform.zoom)*.5;let Q=h.canonical.toString();h.overscaledZ!==h.canonical.z&&(Q+=` => ${h.overscaledZ}`),function(Lt,Ot){Lt.initDebugOverlayCanvas();const ct=Lt.debugOverlayCanvas,Pt=Lt.context.gl,Bt=Lt.debugOverlayCanvas.getContext("2d");Bt.clearRect(0,0,ct.width,ct.height),Bt.shadowColor="white",Bt.shadowBlur=2,Bt.lineWidth=1.5,Bt.strokeStyle="white",Bt.textBaseline="top",Bt.font="bold 36px Open Sans, sans-serif",Bt.fillText(Ot,5,5),Bt.strokeText(Ot,5,5),Lt.debugOverlayTexture.update(ct),Lt.debugOverlayTexture.bind(Pt.LINEAR,Pt.CLAMP_TO_EDGE)}(y,`${Q} ${nt}kB`),I.draw(d,g.TRIANGLES,C,M,Ii.alphaBlended,vi.disabled,Xu(b,a.aT.transparent,at),null,R,y.debugBuffer,y.quadTriangleIndexBuffer,y.debugSegments),I.draw(d,g.LINE_STRIP,C,M,N,vi.disabled,Xu(b,a.aT.red),z,R,y.debugBuffer,y.tileBorderIndexBuffer,y.debugSegments)}function Ni(y,s,h){const d=y.context,g=d.gl,b=y.colorModeForRenderPass(),I=new Tn(g.LEQUAL,Tn.ReadWrite,y.depthRangeFor3D),C=y.useProgram("terrain"),M=s.getTerrainMesh();d.bindFramebuffer.set(null),d.viewport.set([0,0,y.width,y.height]);for(const N of h){const R=y.renderToTexture.getTexture(N),z=s.getTerrainData(N.tileID);d.activeTexture.set(g.TEXTURE0),g.bindTexture(g.TEXTURE_2D,R.texture);const W={u_matrix:y.transform.calculatePosMatrix(N.tileID.toUnwrapped()),u_texture:0,u_ele_delta:s.getMeshFrameDelta(y.transform.zoom)};C.draw(d,g.TRIANGLES,I,Ci.disabled,b,vi.backCCW,W,z,"terrain",M.vertexBuffer,M.indexBuffer,M.segments)}}class Tl{constructor(s,h){this.context=new $g(s),this.transform=h,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:a.Z(),renderTime:0},this.setup(),this.numSublayers=Vi.maxUnderzooming+Vi.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Vc}resize(s,h,d){if(this.width=Math.floor(s*d),this.height=Math.floor(h*d),this.pixelRatio=d,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const g of this.style._order)this.style._layers[g].resize()}setup(){const s=this.context,h=new a.a_;h.emplaceBack(0,0),h.emplaceBack(a.N,0),h.emplaceBack(0,a.N),h.emplaceBack(a.N,a.N),this.tileExtentBuffer=s.createVertexBuffer(h,Uc.members),this.tileExtentSegments=a.S.simpleSegment(0,0,4,2);const d=new a.a_;d.emplaceBack(0,0),d.emplaceBack(a.N,0),d.emplaceBack(0,a.N),d.emplaceBack(a.N,a.N),this.debugBuffer=s.createVertexBuffer(d,Uc.members),this.debugSegments=a.S.simpleSegment(0,0,4,5);const g=new a.V;g.emplaceBack(0,0,0,0),g.emplaceBack(a.N,0,a.N,0),g.emplaceBack(0,a.N,0,a.N),g.emplaceBack(a.N,a.N,a.N,a.N),this.rasterBoundsBuffer=s.createVertexBuffer(g,hn.members),this.rasterBoundsSegments=a.S.simpleSegment(0,0,4,2);const b=new a.a_;b.emplaceBack(0,0),b.emplaceBack(1,0),b.emplaceBack(0,1),b.emplaceBack(1,1),this.viewportBuffer=s.createVertexBuffer(b,Uc.members),this.viewportSegments=a.S.simpleSegment(0,0,4,2);const I=new a.a$;I.emplaceBack(0),I.emplaceBack(1),I.emplaceBack(3),I.emplaceBack(2),I.emplaceBack(0),this.tileBorderIndexBuffer=s.createIndexBuffer(I);const C=new a.b0;C.emplaceBack(0,1,2),C.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=s.createIndexBuffer(C);const M=this.context.gl;this.stencilClearMode=new Ci({func:M.ALWAYS,mask:0},0,255,M.ZERO,M.ZERO,M.ZERO)}clearStencil(){const s=this.context,h=s.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const d=a.Z();a.aS(d,0,this.width,this.height,0,0,1),a.a0(d,d,[h.drawingBufferWidth,h.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(s,h.TRIANGLES,Tn.disabled,this.stencilClearMode,Ii.disabled,vi.disabled,Sd(d),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(s,h){if(this.currentStencilSource===s.source||!s.isTileClipped()||!h||!h.length)return;this.currentStencilSource=s.source;const d=this.context,g=d.gl;this.nextStencilID+h.length>256&&this.clearStencil(),d.setColorMode(Ii.disabled),d.setDepthMode(Tn.disabled);const b=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const I of h){const C=this._tileClippingMaskIDs[I.key]=this.nextStencilID++,M=this.style.map.terrain&&this.style.map.terrain.getTerrainData(I);b.draw(d,g.TRIANGLES,Tn.disabled,new Ci({func:g.ALWAYS,mask:0},C,255,g.KEEP,g.KEEP,g.REPLACE),Ii.disabled,vi.disabled,Sd(I.posMatrix),M,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const s=this.nextStencilID++,h=this.context.gl;return new Ci({func:h.NOTEQUAL,mask:255},s,255,h.KEEP,h.KEEP,h.REPLACE)}stencilModeForClipping(s){const h=this.context.gl;return new Ci({func:h.EQUAL,mask:255},this._tileClippingMaskIDs[s.key],0,h.KEEP,h.KEEP,h.REPLACE)}stencilConfigForOverlap(s){const h=this.context.gl,d=s.sort((I,C)=>C.overscaledZ-I.overscaledZ),g=d[d.length-1].overscaledZ,b=d[0].overscaledZ-g+1;if(b>1){this.currentStencilSource=void 0,this.nextStencilID+b>256&&this.clearStencil();const I={};for(let C=0;C<b;C++)I[C+g]=new Ci({func:h.GEQUAL,mask:255},C+this.nextStencilID,255,h.KEEP,h.KEEP,h.REPLACE);return this.nextStencilID+=b,[I,d]}return[{[g]:Ci.disabled},d]}colorModeForRenderPass(){const s=this.context.gl;return this._showOverdrawInspector?new Ii([s.CONSTANT_COLOR,s.ONE],new a.aT(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Ii.unblended:Ii.alphaBlended}depthModeForSublayer(s,h,d){if(!this.opaquePassEnabledForLayer())return Tn.disabled;const g=1-((1+this.currentLayer)*this.numSublayers+s)*this.depthEpsilon;return new Tn(d||this.context.gl.LEQUAL,h,[g,g])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(s,h){this.style=s,this.options=h,this.lineAtlas=s.lineAtlas,this.imageManager=s.imageManager,this.glyphManager=s.glyphManager,this.symbolFadeChange=s.placement.symbolFadeChange(a.h.now()),this.imageManager.beginFrame();const d=this.style._order,g=this.style.sourceCaches,b={},I={},C={};for(const M in g){const N=g[M];N.used&&N.prepare(this.context),b[M]=N.getVisibleCoordinates(),I[M]=b[M].slice().reverse(),C[M]=N.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let M=0;M<d.length;M++)if(this.style._layers[d[M]].is3D()){this.opaquePassCutoff=M;break}if(this.renderToTexture){this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0;const M=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime);(this.terrainFacilitator.dirty||!a.b1(this.terrainFacilitator.matrix,this.transform.projMatrix)||M.length)&&(a.b2(this.terrainFacilitator.matrix,this.transform.projMatrix),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(N,R){const z=N.context,W=z.gl,nt=Ii.unblended,et=new Tn(W.LEQUAL,Tn.ReadWrite,[0,1]),at=R.getTerrainMesh(),Q=R.sourceCache.getRenderableTiles(),Lt=N.useProgram("terrainDepth");z.bindFramebuffer.set(R.getFramebuffer("depth").framebuffer),z.viewport.set([0,0,N.width/devicePixelRatio,N.height/devicePixelRatio]),z.clear({color:a.aT.transparent,depth:1});for(const Ot of Q){const ct=R.getTerrainData(Ot.tileID),Pt={u_matrix:N.transform.calculatePosMatrix(Ot.tileID.toUnwrapped()),u_ele_delta:R.getMeshFrameDelta(N.transform.zoom)};Lt.draw(z,W.TRIANGLES,et,Ci.disabled,nt,vi.backCCW,Pt,ct,"terrain",at.vertexBuffer,at.indexBuffer,at.segments)}z.bindFramebuffer.set(null),z.viewport.set([0,0,N.width,N.height])}(this,this.style.map.terrain),function(N,R){const z=N.context,W=z.gl,nt=Ii.unblended,et=new Tn(W.LEQUAL,Tn.ReadWrite,[0,1]),at=R.getTerrainMesh(),Q=R.getCoordsTexture(),Lt=R.sourceCache.getRenderableTiles(),Ot=N.useProgram("terrainCoords");z.bindFramebuffer.set(R.getFramebuffer("coords").framebuffer),z.viewport.set([0,0,N.width/devicePixelRatio,N.height/devicePixelRatio]),z.clear({color:a.aT.transparent,depth:1}),R.coordsIndex=[];for(const ct of Lt){const Pt=R.getTerrainData(ct.tileID);z.activeTexture.set(W.TEXTURE0),W.bindTexture(W.TEXTURE_2D,Q.texture);const Bt={u_matrix:N.transform.calculatePosMatrix(ct.tileID.toUnwrapped()),u_terrain_coords_id:(255-R.coordsIndex.length)/255,u_texture:0,u_ele_delta:R.getMeshFrameDelta(N.transform.zoom)};Ot.draw(z,W.TRIANGLES,et,Ci.disabled,nt,vi.backCCW,Bt,Pt,"terrain",at.vertexBuffer,at.indexBuffer,at.segments),R.coordsIndex.push(ct.tileID.key)}z.bindFramebuffer.set(null),z.viewport.set([0,0,N.width,N.height])}(this,this.style.map.terrain))}this.renderPass="offscreen";for(const M of d){const N=this.style._layers[M];if(!N.hasOffscreenPass()||N.isHidden(this.transform.zoom))continue;const R=I[N.source];(N.type==="custom"||R.length)&&this.renderLayer(this,g[N.source],N,R)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:h.showOverdrawInspector?a.aT.black:a.aT.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=h.showOverdrawInspector,this.depthRangeFor3D=[0,1-(s._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=d.length-1;this.currentLayer>=0;this.currentLayer--){const M=this.style._layers[d[this.currentLayer]],N=g[M.source],R=b[M.source];this._renderTileClippingMasks(M,R),this.renderLayer(this,N,M,R)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<d.length;this.currentLayer++){const M=this.style._layers[d[this.currentLayer]],N=g[M.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(M))continue;const R=(M.type==="symbol"?C:I)[M.source];this._renderTileClippingMasks(M,b[M.source]),this.renderLayer(this,N,M,R)}if(this.options.showTileBoundaries){const M=function(N,R){let z=null;const W=Object.values(N._layers).flatMap(Q=>Q.source&&!Q.isHidden(R)?[N.sourceCaches[Q.source]]:[]),nt=W.filter(Q=>Q.getSource().type==="vector"),et=W.filter(Q=>Q.getSource().type!=="vector"),at=Q=>{(!z||z.getSource().maxzoom<Q.getSource().maxzoom)&&(z=Q)};return nt.forEach(Q=>at(Q)),z||et.forEach(Q=>at(Q)),z}(this.style,this.transform.zoom);M&&function(N,R,z){for(let W=0;W<z.length;W++)Bd(N,R,z[W])}(this,M,M.getVisibleCoordinates())}this.options.showPadding&&function(M){const N=M.transform.padding;tc(M,M.transform.height-(N.top||0),3,Od),tc(M,N.bottom||0,3,oh),sh(M,N.left||0,3,zf),sh(M,M.transform.width-(N.right||0),3,zd);const R=M.transform.centerPoint;(function(z,W,nt,et){ah(z,W-1,nt-10,2,20,et),ah(z,W-10,nt-1,20,2,et)})(M,R.x,M.transform.height-R.y,Fd)}(this),this.context.setDefault()}renderLayer(s,h,d,g){if(!d.isHidden(this.transform.zoom)&&(d.type==="background"||d.type==="custom"||(g||[]).length))switch(this.id=d.id,d.type){case"symbol":(function(b,I,C,M,N){if(b.renderPass!=="translucent")return;const R=Ci.disabled,z=b.colorModeForRenderPass();(C._unevaluatedLayout.hasValue("text-variable-anchor")||C._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(W,nt,et,at,Q,Lt,Ot){const ct=nt.transform,Pt=Q==="map",Bt=Lt==="map";for(const Vt of W){const Yt=at.getTile(Vt),ne=Yt.getBucket(et);if(!ne||!ne.text||!ne.text.segments.get().length)continue;const te=a.ah(ne.textSizeData,ct.zoom),ae=bt(Yt,1,nt.transform.zoom),Le=le(Vt.posMatrix,Bt,Pt,nt.transform,ae),vn=et.layout.get("icon-text-fit")!=="none"&&ne.hasIconData();if(te){const pe=Math.pow(2,ct.zoom-Yt.tileID.overscaledZ);ih(ne,Pt,Bt,Ot,ct,Le,Vt.posMatrix,pe,te,vn,nt.style.map.terrain?(Ge,Pe)=>nt.style.map.terrain.getElevation(Vt,Ge,Pe):null)}}}(M,b,C,I,C.layout.get("text-rotation-alignment"),C.layout.get("text-pitch-alignment"),N),C.paint.get("icon-opacity").constantOr(1)!==0&&rh(b,I,C,M,!1,C.paint.get("icon-translate"),C.paint.get("icon-translate-anchor"),C.layout.get("icon-rotation-alignment"),C.layout.get("icon-pitch-alignment"),C.layout.get("icon-keep-upright"),R,z),C.paint.get("text-opacity").constantOr(1)!==0&&rh(b,I,C,M,!0,C.paint.get("text-translate"),C.paint.get("text-translate-anchor"),C.layout.get("text-rotation-alignment"),C.layout.get("text-pitch-alignment"),C.layout.get("text-keep-upright"),R,z),I.map.showCollisionBoxes&&(Rd(b,I,C,M,C.paint.get("text-translate"),C.paint.get("text-translate-anchor"),!0),Rd(b,I,C,M,C.paint.get("icon-translate"),C.paint.get("icon-translate-anchor"),!1))})(s,h,d,g,this.style.placement.variableOffsets);break;case"circle":(function(b,I,C,M){if(b.renderPass!=="translucent")return;const N=C.paint.get("circle-opacity"),R=C.paint.get("circle-stroke-width"),z=C.paint.get("circle-stroke-opacity"),W=!C.layout.get("circle-sort-key").isConstant();if(N.constantOr(1)===0&&(R.constantOr(1)===0||z.constantOr(1)===0))return;const nt=b.context,et=nt.gl,at=b.depthModeForSublayer(0,Tn.ReadOnly),Q=Ci.disabled,Lt=b.colorModeForRenderPass(),Ot=[];for(let ct=0;ct<M.length;ct++){const Pt=M[ct],Bt=I.getTile(Pt),Vt=Bt.getBucket(C);if(!Vt)continue;const Yt=Vt.programConfigurations.get(C.id),ne=b.useProgram("circle",Yt),te=Vt.layoutVertexBuffer,ae=Vt.indexBuffer,Le=b.style.map.terrain&&b.style.map.terrain.getTerrainData(Pt),vn={programConfiguration:Yt,program:ne,layoutVertexBuffer:te,indexBuffer:ae,uniformValues:Ka(b,Pt,Bt,C),terrainData:Le};if(W){const pe=Vt.segments.get();for(const Ge of pe)Ot.push({segments:new a.S([Ge]),sortKey:Ge.sortKey,state:vn})}else Ot.push({segments:Vt.segments,sortKey:0,state:vn})}W&&Ot.sort((ct,Pt)=>ct.sortKey-Pt.sortKey);for(const ct of Ot){const{programConfiguration:Pt,program:Bt,layoutVertexBuffer:Vt,indexBuffer:Yt,uniformValues:ne,terrainData:te}=ct.state;Bt.draw(nt,et.TRIANGLES,at,Q,Lt,vi.disabled,ne,te,C.id,Vt,Yt,ct.segments,C.paint,b.transform.zoom,Pt)}})(s,h,d,g);break;case"heatmap":(function(b,I,C,M){if(C.paint.get("heatmap-opacity")!==0)if(b.renderPass==="offscreen"){const N=b.context,R=N.gl,z=Ci.disabled,W=new Ii([R.ONE,R.ONE],a.aT.transparent,[!0,!0,!0,!0]);(function(nt,et,at){const Q=nt.gl;nt.activeTexture.set(Q.TEXTURE1),nt.viewport.set([0,0,et.width/4,et.height/4]);let Lt=at.heatmapFbo;if(Lt)Q.bindTexture(Q.TEXTURE_2D,Lt.colorAttachment.get()),nt.bindFramebuffer.set(Lt.framebuffer);else{const Ot=Q.createTexture();Q.bindTexture(Q.TEXTURE_2D,Ot),Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_WRAP_S,Q.CLAMP_TO_EDGE),Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_WRAP_T,Q.CLAMP_TO_EDGE),Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_MIN_FILTER,Q.LINEAR),Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_MAG_FILTER,Q.LINEAR),Lt=at.heatmapFbo=nt.createFramebuffer(et.width/4,et.height/4,!1,!1),function(ct,Pt,Bt,Vt){var Yt,ne;const te=ct.gl,ae=(Yt=ct.HALF_FLOAT)!==null&&Yt!==void 0?Yt:te.UNSIGNED_BYTE,Le=(ne=ct.RGBA16F)!==null&&ne!==void 0?ne:te.RGBA;te.texImage2D(te.TEXTURE_2D,0,Le,Pt.width/4,Pt.height/4,0,te.RGBA,ae,null),Vt.colorAttachment.set(Bt)}(nt,et,Ot,Lt)}})(N,b,C),N.clear({color:a.aT.transparent});for(let nt=0;nt<M.length;nt++){const et=M[nt];if(I.hasRenderableParent(et))continue;const at=I.getTile(et),Q=at.getBucket(C);if(!Q)continue;const Lt=Q.programConfigurations.get(C.id),Ot=b.useProgram("heatmap",Lt),{zoom:ct}=b.transform;Ot.draw(N,R.TRIANGLES,Tn.disabled,z,W,vi.disabled,Fg(et.posMatrix,at,ct,C.paint.get("heatmap-intensity")),null,C.id,Q.layoutVertexBuffer,Q.indexBuffer,Q.segments,C.paint,b.transform.zoom,Lt)}N.viewport.set([0,0,b.width,b.height])}else b.renderPass==="translucent"&&(b.context.setColorMode(b.colorModeForRenderPass()),function(N,R){const z=N.context,W=z.gl,nt=R.heatmapFbo;if(!nt)return;z.activeTexture.set(W.TEXTURE0),W.bindTexture(W.TEXTURE_2D,nt.colorAttachment.get()),z.activeTexture.set(W.TEXTURE1);let et=R.colorRampTexture;et||(et=R.colorRampTexture=new St(z,R.colorRamp,W.RGBA)),et.bind(W.LINEAR,W.CLAMP_TO_EDGE),N.useProgram("heatmapTexture").draw(z,W.TRIANGLES,Tn.disabled,Ci.disabled,N.colorModeForRenderPass(),vi.disabled,((at,Q,Lt,Ot)=>{const ct=a.Z();a.aS(ct,0,at.width,at.height,0,0,1);const Pt=at.context.gl;return{u_matrix:ct,u_world:[Pt.drawingBufferWidth,Pt.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:Q.paint.get("heatmap-opacity")}})(N,R),null,R.id,N.viewportBuffer,N.quadTriangleIndexBuffer,N.viewportSegments,R.paint,N.transform.zoom)}(b,C))})(s,h,d,g);break;case"line":(function(b,I,C,M){if(b.renderPass!=="translucent")return;const N=C.paint.get("line-opacity"),R=C.paint.get("line-width");if(N.constantOr(1)===0||R.constantOr(1)===0)return;const z=b.depthModeForSublayer(0,Tn.ReadOnly),W=b.colorModeForRenderPass(),nt=C.paint.get("line-dasharray"),et=C.paint.get("line-pattern"),at=et.constantOr(1),Q=C.paint.get("line-gradient"),Lt=C.getCrossfadeParameters(),Ot=at?"linePattern":nt?"lineSDF":Q?"lineGradient":"line",ct=b.context,Pt=ct.gl;let Bt=!0;for(const Vt of M){const Yt=I.getTile(Vt);if(at&&!Yt.patternsLoaded())continue;const ne=Yt.getBucket(C);if(!ne)continue;const te=ne.programConfigurations.get(C.id),ae=b.context.program.get(),Le=b.useProgram(Ot,te),vn=Bt||Le.program!==ae,pe=b.style.map.terrain&&b.style.map.terrain.getTerrainData(Vt),Ge=et.constantOr(null);if(Ge&&Yt.imageAtlas){const _n=Yt.imageAtlas,un=_n.patternPositions[Ge.to.toString()],bn=_n.patternPositions[Ge.from.toString()];un&&bn&&te.setConstantPatternPositions(un,bn)}const Pe=pe?Vt:null,Hn=at?Bg(b,Yt,C,Lt,Pe):nt?Id(b,Yt,C,nt,Lt,Pe):Q?Ed(b,Yt,C,ne.lineClipsArray.length,Pe):bf(b,Yt,C,Pe);if(at)ct.activeTexture.set(Pt.TEXTURE0),Yt.imageAtlasTexture.bind(Pt.LINEAR,Pt.CLAMP_TO_EDGE),te.updatePaintBuffers(Lt);else if(nt&&(vn||b.lineAtlas.dirty))ct.activeTexture.set(Pt.TEXTURE0),b.lineAtlas.bind(ct);else if(Q){const _n=ne.gradients[C.id];let un=_n.texture;if(C.gradientVersion!==_n.version){let bn=256;if(C.stepInterpolant){const Ui=I.getSource().maxzoom,si=Vt.canonical.z===Ui?Math.ceil(1<<b.transform.maxZoom-Vt.canonical.z):1;bn=a.ad(a.aY(ne.maxLineLength/a.N*1024*si),256,ct.maxTextureSize)}_n.gradient=a.aZ({expression:C.gradientExpression(),evaluationKey:"lineProgress",resolution:bn,image:_n.gradient||void 0,clips:ne.lineClipsArray}),_n.texture?_n.texture.update(_n.gradient):_n.texture=new St(ct,_n.gradient,Pt.RGBA),_n.version=C.gradientVersion,un=_n.texture}ct.activeTexture.set(Pt.TEXTURE0),un.bind(C.stepInterpolant?Pt.NEAREST:Pt.LINEAR,Pt.CLAMP_TO_EDGE)}Le.draw(ct,Pt.TRIANGLES,z,b.stencilModeForClipping(Vt),W,vi.disabled,Hn,pe,C.id,ne.layoutVertexBuffer,ne.indexBuffer,ne.segments,C.paint,b.transform.zoom,te,ne.layoutVertexBuffer2),Bt=!1}})(s,h,d,g);break;case"fill":(function(b,I,C,M){const N=C.paint.get("fill-color"),R=C.paint.get("fill-opacity");if(R.constantOr(1)===0)return;const z=b.colorModeForRenderPass(),W=C.paint.get("fill-pattern"),nt=b.opaquePassEnabledForLayer()&&!W.constantOr(1)&&N.constantOr(a.aT.transparent).a===1&&R.constantOr(0)===1?"opaque":"translucent";if(b.renderPass===nt){const et=b.depthModeForSublayer(1,b.renderPass==="opaque"?Tn.ReadWrite:Tn.ReadOnly);Ju(b,I,C,M,et,z,!1)}if(b.renderPass==="translucent"&&C.paint.get("fill-antialias")){const et=b.depthModeForSublayer(C.getPaintProperty("fill-outline-color")?2:0,Tn.ReadOnly);Ju(b,I,C,M,et,z,!0)}})(s,h,d,g);break;case"fill-extrusion":(function(b,I,C,M){const N=C.paint.get("fill-extrusion-opacity");if(N!==0&&b.renderPass==="translucent"){const R=new Tn(b.context.gl.LEQUAL,Tn.ReadWrite,b.depthRangeFor3D);if(N!==1||C.paint.get("fill-extrusion-pattern").constantOr(1))Qu(b,I,C,M,R,Ci.disabled,Ii.disabled),Qu(b,I,C,M,R,b.stencilModeFor3D(),b.colorModeForRenderPass());else{const z=b.colorModeForRenderPass();Qu(b,I,C,M,R,Ci.disabled,z)}}})(s,h,d,g);break;case"hillshade":(function(b,I,C,M){if(b.renderPass!=="offscreen"&&b.renderPass!=="translucent")return;const N=b.context,R=b.depthModeForSublayer(0,Tn.ReadOnly),z=b.colorModeForRenderPass(),[W,nt]=b.renderPass==="translucent"?b.stencilConfigForOverlap(M):[{},M];for(const et of nt){const at=I.getTile(et);at.needsHillshadePrepare!==void 0&&at.needsHillshadePrepare&&b.renderPass==="offscreen"?Of(b,at,C,R,Ci.disabled,z):b.renderPass==="translucent"&&Wg(b,et,at,C,R,W[et.overscaledZ],z)}N.viewport.set([0,0,b.width,b.height])})(s,h,d,g);break;case"raster":(function(b,I,C,M){if(b.renderPass!=="translucent"||C.paint.get("raster-opacity")===0||!M.length)return;const N=b.context,R=N.gl,z=I.getSource(),W=b.useProgram("raster"),nt=b.colorModeForRenderPass(),[et,at]=z instanceof On?[{},M]:b.stencilConfigForOverlap(M),Q=at[at.length-1].overscaledZ,Lt=!b.options.moving;for(const Ot of at){const ct=b.depthModeForSublayer(Ot.overscaledZ-Q,C.paint.get("raster-opacity")===1?Tn.ReadWrite:Tn.ReadOnly,R.LESS),Pt=I.getTile(Ot);Pt.registerFadeDuration(C.paint.get("raster-fade-duration"));const Bt=I.findLoadedParent(Ot,0),Vt=Xg(Pt,Bt,I,C,b.transform,b.style.map.terrain);let Yt,ne;const te=C.paint.get("raster-resampling")==="nearest"?R.NEAREST:R.LINEAR;N.activeTexture.set(R.TEXTURE0),Pt.texture.bind(te,R.CLAMP_TO_EDGE,R.LINEAR_MIPMAP_NEAREST),N.activeTexture.set(R.TEXTURE1),Bt?(Bt.texture.bind(te,R.CLAMP_TO_EDGE,R.LINEAR_MIPMAP_NEAREST),Yt=Math.pow(2,Bt.tileID.overscaledZ-Pt.tileID.overscaledZ),ne=[Pt.tileID.canonical.x*Yt%1,Pt.tileID.canonical.y*Yt%1]):Pt.texture.bind(te,R.CLAMP_TO_EDGE,R.LINEAR_MIPMAP_NEAREST);const ae=b.style.map.terrain&&b.style.map.terrain.getTerrainData(Ot),Le=ae?Ot:null,vn=Le?Le.posMatrix:b.transform.calculatePosMatrix(Ot.toUnwrapped(),Lt),pe=Td(vn,ne||[0,0],Yt||1,Vt,C);z instanceof On?W.draw(N,R.TRIANGLES,ct,Ci.disabled,nt,vi.disabled,pe,ae,C.id,z.boundsBuffer,b.quadTriangleIndexBuffer,z.boundsSegments):W.draw(N,R.TRIANGLES,ct,et[Ot.overscaledZ],nt,vi.disabled,pe,ae,C.id,b.rasterBoundsBuffer,b.quadTriangleIndexBuffer,b.rasterBoundsSegments)}})(s,h,d,g);break;case"background":(function(b,I,C,M){const N=C.paint.get("background-color"),R=C.paint.get("background-opacity");if(R===0)return;const z=b.context,W=z.gl,nt=b.transform,et=nt.tileSize,at=C.paint.get("background-pattern");if(b.isPatternMissing(at))return;const Q=!at&&N.a===1&&R===1&&b.opaquePassEnabledForLayer()?"opaque":"translucent";if(b.renderPass!==Q)return;const Lt=Ci.disabled,Ot=b.depthModeForSublayer(0,Q==="opaque"?Tn.ReadWrite:Tn.ReadOnly),ct=b.colorModeForRenderPass(),Pt=b.useProgram(at?"backgroundPattern":"background"),Bt=M||nt.coveringTiles({tileSize:et,terrain:b.style.map.terrain});at&&(z.activeTexture.set(W.TEXTURE0),b.imageManager.bind(b.context));const Vt=C.getCrossfadeParameters();for(const Yt of Bt){const ne=M?Yt.posMatrix:b.transform.calculatePosMatrix(Yt.toUnwrapped()),te=at?as(ne,R,b,at,{tileID:Yt,tileSize:et},Vt):$c(ne,R,N),ae=b.style.map.terrain&&b.style.map.terrain.getTerrainData(Yt);Pt.draw(z,W.TRIANGLES,Ot,Lt,ct,vi.disabled,te,ae,C.id,b.tileExtentBuffer,b.quadTriangleIndexBuffer,b.tileExtentSegments)}})(s,0,d,g);break;case"custom":(function(b,I,C){const M=b.context,N=C.implementation;if(b.renderPass==="offscreen"){const R=N.prerender;R&&(b.setCustomLayerDefaults(),M.setColorMode(b.colorModeForRenderPass()),R.call(N,M.gl,b.transform.customLayerMatrix()),M.setDirty(),b.setBaseState())}else if(b.renderPass==="translucent"){b.setCustomLayerDefaults(),M.setColorMode(b.colorModeForRenderPass()),M.setStencilMode(Ci.disabled);const R=N.renderingMode==="3d"?new Tn(b.context.gl.LEQUAL,Tn.ReadWrite,b.depthRangeFor3D):b.depthModeForSublayer(0,Tn.ReadOnly);M.setDepthMode(R),N.render(M.gl,b.transform.customLayerMatrix()),M.setDirty(),b.setBaseState(),M.bindFramebuffer.set(null)}})(s,0,d)}}translatePosMatrix(s,h,d,g,b){if(!d[0]&&!d[1])return s;const I=b?g==="map"?this.transform.angle:0:g==="viewport"?-this.transform.angle:0;if(I){const N=Math.sin(I),R=Math.cos(I);d=[d[0]*R-d[1]*N,d[0]*N+d[1]*R]}const C=[b?d[0]:bt(h,d[0],this.transform.zoom),b?d[1]:bt(h,d[1],this.transform.zoom),0],M=new Float32Array(16);return a.$(M,s,C),M}saveTileTexture(s){const h=this._tileTextures[s.size[0]];h?h.push(s):this._tileTextures[s.size[0]]=[s]}getTileTexture(s){const h=this._tileTextures[s];return h&&h.length>0?h.pop():null}isPatternMissing(s){if(!s)return!1;if(!s.from||!s.to)return!0;const h=this.imageManager.getPattern(s.from.toString()),d=this.imageManager.getPattern(s.to.toString());return!h||!d}useProgram(s,h){this.cache=this.cache||{};const d=s+(h?h.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[d]||(this.cache[d]=new Gc(this.context,Ei[s],h,Wc[s],this._showOverdrawInspector,this.style.map.terrain)),this.cache[d]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const s=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(s.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new St(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:s,drawingBufferHeight:h}=this.context.gl;return this.width!==s||this.height!==h}}class vo{constructor(s,h){this.points=s,this.planes=h}static fromInvProjectionMatrix(s,h,d){const g=Math.pow(2,d),b=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(C=>{const M=1/(C=a.ag([],C,s))[3]/h*g;return a.b3(C,C,[M,M,1/C[3],M])}),I=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(C=>{const M=function(W,nt){var et=nt[0],at=nt[1],Q=nt[2],Lt=et*et+at*at+Q*Q;return Lt>0&&(Lt=1/Math.sqrt(Lt)),W[0]=nt[0]*Lt,W[1]=nt[1]*Lt,W[2]=nt[2]*Lt,W}([],function(W,nt,et){var at=nt[0],Q=nt[1],Lt=nt[2],Ot=et[0],ct=et[1],Pt=et[2];return W[0]=Q*Pt-Lt*ct,W[1]=Lt*Ot-at*Pt,W[2]=at*ct-Q*Ot,W}([],ft([],b[C[0]],b[C[1]]),ft([],b[C[2]],b[C[1]]))),N=-((R=M)[0]*(z=b[C[1]])[0]+R[1]*z[1]+R[2]*z[2]);var R,z;return M.concat(N)});return new vo(b,I)}}class fu{constructor(s,h){this.min=s,this.max=h,this.center=function(d,g,b){return d[0]=.5*g[0],d[1]=.5*g[1],d[2]=.5*g[2],d}([],function(d,g,b){return d[0]=g[0]+b[0],d[1]=g[1]+b[1],d[2]=g[2]+b[2],d}([],this.min,this.max))}quadrant(s){const h=[s%2==0,s<2],d=K(this.min),g=K(this.max);for(let b=0;b<h.length;b++)d[b]=h[b]?this.min[b]:this.center[b],g[b]=h[b]?this.center[b]:this.max[b];return g[2]=this.max[2],new fu(d,g)}distanceX(s){return Math.max(Math.min(this.max[0],s[0]),this.min[0])-s[0]}distanceY(s){return Math.max(Math.min(this.max[1],s[1]),this.min[1])-s[1]}intersects(s){const h=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let d=!0;for(let g=0;g<s.planes.length;g++){const b=s.planes[g];let I=0;for(let C=0;C<h.length;C++)a.b4(b,h[C])>=0&&I++;if(I===0)return 0;I!==h.length&&(d=!1)}if(d)return 2;for(let g=0;g<3;g++){let b=Number.MAX_VALUE,I=-Number.MAX_VALUE;for(let C=0;C<s.points.length;C++){const M=s.points[C][g]-this.min[g];b=Math.min(b,M),I=Math.max(I,M)}if(I<0||b>this.max[g]-this.min[g])return 0}return 1}}class ec{constructor(s=0,h=0,d=0,g=0){if(isNaN(s)||s<0||isNaN(h)||h<0||isNaN(d)||d<0||isNaN(g)||g<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=s,this.bottom=h,this.left=d,this.right=g}interpolate(s,h,d){return h.top!=null&&s.top!=null&&(this.top=a.B.number(s.top,h.top,d)),h.bottom!=null&&s.bottom!=null&&(this.bottom=a.B.number(s.bottom,h.bottom,d)),h.left!=null&&s.left!=null&&(this.left=a.B.number(s.left,h.left,d)),h.right!=null&&s.right!=null&&(this.right=a.B.number(s.right,h.right,d)),this}getCenter(s,h){const d=a.ad((this.left+s-this.right)/2,0,s),g=a.ad((this.top+h-this.bottom)/2,0,h);return new a.P(d,g)}equals(s){return this.top===s.top&&this.bottom===s.bottom&&this.left===s.left&&this.right===s.right}clone(){return new ec(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class lh{constructor(s,h,d,g,b){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=b===void 0||!!b,this._minZoom=s||0,this._maxZoom=h||22,this._minPitch=d??0,this._maxPitch=g??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new a.L(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new ec,this._posMatrixCache={},this._alignedPosMatrixCache={},this._minEleveationForCurrentTile=0}clone(){const s=new lh(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return s.apply(this),s}apply(s){this.tileSize=s.tileSize,this.latRange=s.latRange,this.width=s.width,this.height=s.height,this._center=s._center,this._elevation=s._elevation,this._minEleveationForCurrentTile=s._minEleveationForCurrentTile,this.zoom=s.zoom,this.angle=s.angle,this._fov=s._fov,this._pitch=s._pitch,this._unmodified=s._unmodified,this._edgeInsets=s._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(s){this._minZoom!==s&&(this._minZoom=s,this.zoom=Math.max(this.zoom,s))}get maxZoom(){return this._maxZoom}set maxZoom(s){this._maxZoom!==s&&(this._maxZoom=s,this.zoom=Math.min(this.zoom,s))}get minPitch(){return this._minPitch}set minPitch(s){this._minPitch!==s&&(this._minPitch=s,this.pitch=Math.max(this.pitch,s))}get maxPitch(){return this._maxPitch}set maxPitch(s){this._maxPitch!==s&&(this._maxPitch=s,this.pitch=Math.min(this.pitch,s))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(s){s===void 0?s=!0:s===null&&(s=!1),this._renderWorldCopies=s}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new a.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(s){const h=-a.b5(s,-180,180)*Math.PI/180;this.angle!==h&&(this._unmodified=!1,this.angle=h,this._calcMatrices(),this.rotationMatrix=function(){var d=new a.A(4);return a.A!=Float32Array&&(d[1]=0,d[2]=0),d[0]=1,d[3]=1,d}(),function(d,g,b){var I=g[0],C=g[1],M=g[2],N=g[3],R=Math.sin(b),z=Math.cos(b);d[0]=I*z+M*R,d[1]=C*z+N*R,d[2]=I*-R+M*z,d[3]=C*-R+N*z}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(s){const h=a.ad(s,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==h&&(this._unmodified=!1,this._pitch=h,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(s){s=Math.max(.01,Math.min(60,s)),this._fov!==s&&(this._unmodified=!1,this._fov=s/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(s){const h=Math.min(Math.max(s,this.minZoom),this.maxZoom);this._zoom!==h&&(this._unmodified=!1,this._zoom=h,this.tileZoom=Math.max(0,Math.floor(h)),this.scale=this.zoomScale(h),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(s){s.lat===this._center.lat&&s.lng===this._center.lng||(this._unmodified=!1,this._center=s,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(s){s!==this._elevation&&(this._elevation=s,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(s){this._edgeInsets.equals(s)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,s,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(s){return this._edgeInsets.equals(s)}interpolatePadding(s,h,d){this._unmodified=!1,this._edgeInsets.interpolate(s,h,d),this._constrain(),this._calcMatrices()}coveringZoomLevel(s){const h=(s.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/s.tileSize));return Math.max(0,h)}getVisibleUnwrappedCoordinates(s){const h=[new a.b6(0,s)];if(this._renderWorldCopies){const d=this.pointCoordinate(new a.P(0,0)),g=this.pointCoordinate(new a.P(this.width,0)),b=this.pointCoordinate(new a.P(this.width,this.height)),I=this.pointCoordinate(new a.P(0,this.height)),C=Math.floor(Math.min(d.x,g.x,b.x,I.x)),M=Math.floor(Math.max(d.x,g.x,b.x,I.x)),N=1;for(let R=C-N;R<=M+N;R++)R!==0&&h.push(new a.b6(R,s))}return h}coveringTiles(s){var h,d;let g=this.coveringZoomLevel(s);const b=g;if(s.minzoom!==void 0&&g<s.minzoom)return[];s.maxzoom!==void 0&&g>s.maxzoom&&(g=s.maxzoom);const I=this.pointCoordinate(this.getCameraPoint()),C=a.U.fromLngLat(this.center),M=Math.pow(2,g),N=[M*I.x,M*I.y,0],R=[M*C.x,M*C.y,0],z=vo.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,g);let W=s.minzoom||0;!s.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(W=g);const nt=s.terrain?2/Math.min(this.tileSize,s.tileSize)*this.tileSize:3,et=ct=>({aabb:new fu([ct*M,0,0],[(ct+1)*M,M,0]),zoom:0,x:0,y:0,wrap:ct,fullyVisible:!1}),at=[],Q=[],Lt=g,Ot=s.reparseOverscaled?b:g;if(this._renderWorldCopies)for(let ct=1;ct<=3;ct++)at.push(et(-ct)),at.push(et(ct));for(at.push(et(0));at.length>0;){const ct=at.pop(),Pt=ct.x,Bt=ct.y;let Vt=ct.fullyVisible;if(!Vt){const Le=ct.aabb.intersects(z);if(Le===0)continue;Vt=Le===2}const Yt=s.terrain?N:R,ne=ct.aabb.distanceX(Yt),te=ct.aabb.distanceY(Yt),ae=Math.max(Math.abs(ne),Math.abs(te));if(ct.zoom===Lt||ae>nt+(1<<Lt-ct.zoom)-2&&ct.zoom>=W){const Le=Lt-ct.zoom,vn=N[0]-.5-(Pt<<Le),pe=N[1]-.5-(Bt<<Le);Q.push({tileID:new a.O(ct.zoom===Lt?Ot:ct.zoom,ct.wrap,ct.zoom,Pt,Bt),distanceSq:pt([R[0]-.5-Pt,R[1]-.5-Bt]),tileDistanceToCamera:Math.sqrt(vn*vn+pe*pe)})}else for(let Le=0;Le<4;Le++){const vn=(Pt<<1)+Le%2,pe=(Bt<<1)+(Le>>1),Ge=ct.zoom+1;let Pe=ct.aabb.quadrant(Le);if(s.terrain){const Hn=new a.O(Ge,ct.wrap,Ge,vn,pe),_n=s.terrain.getMinMaxElevation(Hn),un=(h=_n.minElevation)!==null&&h!==void 0?h:this.elevation,bn=(d=_n.maxElevation)!==null&&d!==void 0?d:this.elevation;Pe=new fu([Pe.min[0],Pe.min[1],un],[Pe.max[0],Pe.max[1],bn])}at.push({aabb:Pe,zoom:Ge,x:vn,y:pe,wrap:ct.wrap,fullyVisible:Vt})}}return Q.sort((ct,Pt)=>ct.distanceSq-Pt.distanceSq).map(ct=>ct.tileID)}resize(s,h){this.width=s,this.height=h,this.pixelsToGLUnits=[2/s,-2/h],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(s){return Math.pow(2,s)}scaleZoom(s){return Math.log(s)/Math.LN2}project(s){const h=a.ad(s.lat,-this.maxValidLatitude,this.maxValidLatitude);return new a.P(a.G(s.lng)*this.worldSize,a.H(h)*this.worldSize)}unproject(s){return new a.U(s.x/this.worldSize,s.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(s){const h=this.pointLocation(this.centerPoint,s),d=s.getElevationForLngLatZoom(h,this.tileZoom);if(!(this.elevation-d))return;const g=this.getCameraPosition(),b=a.U.fromLngLat(g.lngLat,g.altitude),I=a.U.fromLngLat(h,d),C=b.x-I.x,M=b.y-I.y,N=b.z-I.z,R=Math.sqrt(C*C+M*M+N*N),z=this.scaleZoom(this.cameraToCenterDistance/R/this.tileSize);this._elevation=d,this._center=h,this.zoom=z}setLocationAtPoint(s,h){const d=this.pointCoordinate(h),g=this.pointCoordinate(this.centerPoint),b=this.locationCoordinate(s),I=new a.U(b.x-(d.x-g.x),b.y-(d.y-g.y));this.center=this.coordinateLocation(I),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(s,h){return h?this.coordinatePoint(this.locationCoordinate(s),h.getElevationForLngLatZoom(s,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(s))}pointLocation(s,h){return this.coordinateLocation(this.pointCoordinate(s,h))}locationCoordinate(s){return a.U.fromLngLat(s)}coordinateLocation(s){return s&&s.toLngLat()}pointCoordinate(s,h){if(h){const W=h.pointCoordinate(s);if(W!=null)return W}const d=[s.x,s.y,0,1],g=[s.x,s.y,1,1];a.ag(d,d,this.pixelMatrixInverse),a.ag(g,g,this.pixelMatrixInverse);const b=d[3],I=g[3],C=d[1]/b,M=g[1]/I,N=d[2]/b,R=g[2]/I,z=N===R?0:(0-N)/(R-N);return new a.U(a.B.number(d[0]/b,g[0]/I,z)/this.worldSize,a.B.number(C,M,z)/this.worldSize)}coordinatePoint(s,h=0,d=this.pixelMatrix){const g=[s.x*this.worldSize,s.y*this.worldSize,h,1];return a.ag(g,g,d),new a.P(g[0]/g[3],g[1]/g[3])}getBounds(){const s=Math.max(0,this.height/2-this.getHorizon());return new ke().extend(this.pointLocation(new a.P(0,s))).extend(this.pointLocation(new a.P(this.width,s))).extend(this.pointLocation(new a.P(this.width,this.height))).extend(this.pointLocation(new a.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new ke([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(s){s?(this.lngRange=[s.getWest(),s.getEast()],this.latRange=[s.getSouth(),s.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(s,h=!1){const d=s.key,g=h?this._alignedPosMatrixCache:this._posMatrixCache;if(g[d])return g[d];const b=s.canonical,I=this.worldSize/this.zoomScale(b.z),C=b.x+Math.pow(2,b.z)*s.wrap,M=a.ao(new Float64Array(16));return a.$(M,M,[C*I,b.y*I,0]),a.a0(M,M,[I/a.N,I/a.N,1]),a.a1(M,h?this.alignedProjMatrix:this.projMatrix,M),g[d]=new Float32Array(M),g[d]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let s,h,d,g,b=-90,I=90,C=-180,M=180;const N=this.size,R=this._unmodified;if(this.latRange){const nt=this.latRange;b=a.H(nt[1])*this.worldSize,I=a.H(nt[0])*this.worldSize,s=I-b<N.y?N.y/(I-b):0}if(this.lngRange){const nt=this.lngRange;C=a.b5(a.G(nt[0])*this.worldSize,0,this.worldSize),M=a.b5(a.G(nt[1])*this.worldSize,0,this.worldSize),M<C&&(M+=this.worldSize),h=M-C<N.x?N.x/(M-C):0}const z=this.point,W=Math.max(h||0,s||0);if(W)return this.center=this.unproject(new a.P(h?(M+C)/2:z.x,s?(I+b)/2:z.y)),this.zoom+=this.scaleZoom(W),this._unmodified=R,void(this._constraining=!1);if(this.latRange){const nt=z.y,et=N.y/2;nt-et<b&&(g=b+et),nt+et>I&&(g=I-et)}if(this.lngRange){const nt=(C+M)/2,et=a.b5(z.x,nt-this.worldSize/2,nt+this.worldSize/2),at=N.x/2;et-at<C&&(d=C+at),et+at>M&&(d=M-at)}d===void 0&&g===void 0||(this.center=this.unproject(new a.P(d!==void 0?d:z.x,g!==void 0?g:z.y)).wrap()),this._unmodified=R,this._constraining=!1}_calcMatrices(){if(!this.height)return;const s=this.centerOffset,h=this.point.x,d=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=a.b7(1,this.center.lat)*this.worldSize;let g=a.ao(new Float64Array(16));a.a0(g,g,[this.width/2,-this.height/2,1]),a.$(g,g,[1,-1,0]),this.labelPlaneMatrix=g,g=a.ao(new Float64Array(16)),a.a0(g,g,[1,-1,1]),a.$(g,g,[-1,-1,0]),a.a0(g,g,[2/this.width,2/this.height,1]),this.glCoordMatrix=g;const b=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),I=Math.min(this.elevation,this._minEleveationForCurrentTile),C=b-I*this._pixelPerMeter/Math.cos(this._pitch),M=I<0?C:b,N=Math.PI/2+this._pitch,R=this._fov*(.5+s.y/this.height),z=Math.sin(R)*M/Math.sin(a.ad(Math.PI-N-R,.01,Math.PI-.01)),W=this.getHorizon(),nt=2*Math.atan(W/this.cameraToCenterDistance)*(.5+s.y/(2*W)),et=Math.sin(nt)*M/Math.sin(a.ad(Math.PI-N-nt,.01,Math.PI-.01)),at=Math.min(z,et),Q=1.01*(Math.cos(Math.PI/2-this._pitch)*at+M),Lt=this.height/50;g=new Float64Array(16),a.b8(g,this._fov,this.width/this.height,Lt,Q),g[8]=2*-s.x/this.width,g[9]=2*s.y/this.height,a.a0(g,g,[1,-1,1]),a.$(g,g,[0,0,-this.cameraToCenterDistance]),a.b9(g,g,this._pitch),a.ae(g,g,this.angle),a.$(g,g,[-h,-d,0]),this.mercatorMatrix=a.a0([],g,[this.worldSize,this.worldSize,this.worldSize]),a.a0(g,g,[1,1,this._pixelPerMeter]),this.pixelMatrix=a.a1(new Float64Array(16),this.labelPlaneMatrix,g),a.$(g,g,[0,0,-this.elevation]),this.projMatrix=g,this.invProjMatrix=a.as([],g),this.pixelMatrix3D=a.a1(new Float64Array(16),this.labelPlaneMatrix,g);const Ot=this.width%2/2,ct=this.height%2/2,Pt=Math.cos(this.angle),Bt=Math.sin(this.angle),Vt=h-Math.round(h)+Pt*Ot+Bt*ct,Yt=d-Math.round(d)+Pt*ct+Bt*Ot,ne=new Float64Array(g);if(a.$(ne,ne,[Vt>.5?Vt-1:Vt,Yt>.5?Yt-1:Yt,0]),this.alignedProjMatrix=ne,g=a.as(new Float64Array(16),this.pixelMatrix),!g)throw new Error("failed to invert matrix");this.pixelMatrixInverse=g,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const s=this.pointCoordinate(new a.P(0,0)),h=[s.x*this.worldSize,s.y*this.worldSize,0,1];return a.ag(h,h,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const s=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new a.P(0,s))}getCameraQueryGeometry(s){const h=this.getCameraPoint();if(s.length===1)return[s[0],h];{let d=h.x,g=h.y,b=h.x,I=h.y;for(const C of s)d=Math.min(d,C.x),g=Math.min(g,C.y),b=Math.max(b,C.x),I=Math.max(I,C.y);return[new a.P(d,g),new a.P(b,g),new a.P(b,I),new a.P(d,I),new a.P(d,g)]}}}function Ll(y,s){let h,d=!1,g=null,b=null;const I=()=>{g=null,d&&(y.apply(b,h),g=setTimeout(I,s),d=!1)};return(...C)=>(d=!0,b=this,h=C,g||I(),g)}class nc{constructor(s){this._getCurrentHash=()=>{const h=window.location.hash.replace("#","");if(this._hashName){let d;return h.split("&").map(g=>g.split("=")).forEach(g=>{g[0]===this._hashName&&(d=g)}),(d&&d[1]||"").split("/")}return h.split("/")},this._onHashChange=()=>{const h=this._getCurrentHash();if(h.length>=3&&!h.some(d=>isNaN(d))){const d=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(h[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+h[2],+h[1]],zoom:+h[0],bearing:d,pitch:+(h[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const h=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,h)}catch{}},this._updateHash=Ll(this._updateHashUnthrottled,300),this._hashName=s&&encodeURIComponent(s)}addTo(s){return this._map=s,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(s){const h=this._map.getCenter(),d=Math.round(100*this._map.getZoom())/100,g=Math.ceil((d*Math.LN2+Math.log(512/360/.5))/Math.LN10),b=Math.pow(10,g),I=Math.round(h.lng*b)/b,C=Math.round(h.lat*b)/b,M=this._map.getBearing(),N=this._map.getPitch();let R="";if(R+=s?`/${I}/${C}/${d}`:`${d}/${C}/${I}`,(M||N)&&(R+="/"+Math.round(10*M)/10),N&&(R+=`/${Math.round(N)}`),this._hashName){const z=this._hashName;let W=!1;const nt=window.location.hash.slice(1).split("&").map(et=>{const at=et.split("=")[0];return at===z?(W=!0,`${at}=${R}`):et}).filter(et=>et);return W||nt.push(`${z}=${R}`),`#${nt.join("&")}`}return`#${R}`}}const pu={linearity:.3,easing:a.ba(0,0,.3,1)},Vd=a.e({deceleration:2500,maxSpeed:1400},pu),Ud=a.e({deceleration:20,maxSpeed:1400},pu),Gd=a.e({deceleration:1e3,maxSpeed:360},pu),jd=a.e({deceleration:1e3,maxSpeed:90},pu);class qd{constructor(s){this._map=s,this.clear()}clear(){this._inertiaBuffer=[]}record(s){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:a.h.now(),settings:s})}_drainInertiaBuffer(){const s=this._inertiaBuffer,h=a.h.now();for(;s.length>0&&h-s[0].time>160;)s.shift()}_onMoveEnd(s){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const h={zoom:0,bearing:0,pitch:0,pan:new a.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:b}of this._inertiaBuffer)h.zoom+=b.zoomDelta||0,h.bearing+=b.bearingDelta||0,h.pitch+=b.pitchDelta||0,b.panDelta&&h.pan._add(b.panDelta),b.around&&(h.around=b.around),b.pinchAround&&(h.pinchAround=b.pinchAround);const d=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,g={};if(h.pan.mag()){const b=ic(h.pan.mag(),d,a.e({},Vd,s||{}));g.offset=h.pan.mult(b.amount/h.pan.mag()),g.center=this._map.transform.center,qs(g,b)}if(h.zoom){const b=ic(h.zoom,d,Ud);g.zoom=this._map.transform.zoom+b.amount,qs(g,b)}if(h.bearing){const b=ic(h.bearing,d,Gd);g.bearing=this._map.transform.bearing+a.ad(b.amount,-179,179),qs(g,b)}if(h.pitch){const b=ic(h.pitch,d,jd);g.pitch=this._map.transform.pitch+b.amount,qs(g,b)}if(g.zoom||g.bearing){const b=h.pinchAround===void 0?h.around:h.pinchAround;g.around=b?this._map.unproject(b):this._map.getCenter()}return this.clear(),a.e(g,{noMoveStart:!0})}}function qs(y,s){(!y.duration||y.duration<s.duration)&&(y.duration=s.duration,y.easing=s.easing)}function ic(y,s,h){const{maxSpeed:d,linearity:g,deceleration:b}=h,I=a.ad(y*g/(s/1e3),-d,d),C=Math.abs(I)/(b*g);return{easing:h.easing,duration:1e3*C,amount:I*(C/2)}}class zo extends a.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,h,d,g={}){const b=x.mousePos(h.getCanvasContainer(),d),I=h.unproject(b);super(s,a.e({point:b,lngLat:I,originalEvent:d},g)),this._defaultPrevented=!1,this.target=h}}class rc extends a.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,h,d){const g=s==="touchend"?d.changedTouches:d.touches,b=x.touchPos(h.getCanvasContainer(),g),I=b.map(M=>h.unproject(M)),C=b.reduce((M,N,R,z)=>M.add(N.div(z.length)),new a.P(0,0));super(s,{points:b,point:C,lngLats:I,lngLat:h.unproject(C),originalEvent:d}),this._defaultPrevented=!1}}class Zd extends a.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,h,d){super(s,{originalEvent:d}),this._defaultPrevented=!1}}class $d{constructor(s,h){this._map=s,this._clickTolerance=h.clickTolerance}reset(){delete this._mousedownPos}wheel(s){return this._firePreventable(new Zd(s.type,this._map,s))}mousedown(s,h){return this._mousedownPos=h,this._firePreventable(new zo(s.type,this._map,s))}mouseup(s){this._map.fire(new zo(s.type,this._map,s))}click(s,h){this._mousedownPos&&this._mousedownPos.dist(h)>=this._clickTolerance||this._map.fire(new zo(s.type,this._map,s))}dblclick(s){return this._firePreventable(new zo(s.type,this._map,s))}mouseover(s){this._map.fire(new zo(s.type,this._map,s))}mouseout(s){this._map.fire(new zo(s.type,this._map,s))}touchstart(s){return this._firePreventable(new rc(s.type,this._map,s))}touchmove(s){this._map.fire(new rc(s.type,this._map,s))}touchend(s){this._map.fire(new rc(s.type,this._map,s))}touchcancel(s){this._map.fire(new rc(s.type,this._map,s))}_firePreventable(s){if(this._map.fire(s),s.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Wd{constructor(s){this._map=s}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(s){this._map.fire(new zo(s.type,this._map,s))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new zo("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(s){this._delayContextMenu?this._contextMenuEvent=s:this._ignoreContextMenu||this._map.fire(new zo(s.type,this._map,s)),this._map.listens("contextmenu")&&s.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ia{constructor(s){this._map=s}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(s){return this.transform.pointLocation(a.P.convert(s),this._map.terrain)}}class Xd{constructor(s,h){this._map=s,this._tr=new Ia(s),this._el=s.getCanvasContainer(),this._container=s.getContainer(),this._clickTolerance=h.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(s,h){this.isEnabled()&&s.shiftKey&&s.button===0&&(x.disableDrag(),this._startPos=this._lastPos=h,this._active=!0)}mousemoveWindow(s,h){if(!this._active)return;const d=h;if(this._lastPos.equals(d)||!this._box&&d.dist(this._startPos)<this._clickTolerance)return;const g=this._startPos;this._lastPos=d,this._box||(this._box=x.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",s));const b=Math.min(g.x,d.x),I=Math.max(g.x,d.x),C=Math.min(g.y,d.y),M=Math.max(g.y,d.y);x.setTransform(this._box,`translate(${b}px,${C}px)`),this._box.style.width=I-b+"px",this._box.style.height=M-C+"px"}mouseupWindow(s,h){if(!this._active||s.button!==0)return;const d=this._startPos,g=h;if(this.reset(),x.suppressClick(),d.x!==g.x||d.y!==g.y)return this._map.fire(new a.k("boxzoomend",{originalEvent:s})),{cameraAnimation:b=>b.fitScreenCoordinates(d,g,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",s)}keydown(s){this._active&&s.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",s))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(x.remove(this._box),this._box=null),x.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(s,h){return this._map.fire(new a.k(s,{originalEvent:h}))}}function ls(y,s){if(y.length!==s.length)throw new Error(`The number of touches and points are not equal - touches ${y.length}, points ${s.length}`);const h={};for(let d=0;d<y.length;d++)h[y[d].identifier]=s[d];return h}class Ca{constructor(s){this.reset(),this.numTouches=s.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(s,h,d){(this.centroid||d.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=s.timeStamp),d.length===this.numTouches&&(this.centroid=function(g){const b=new a.P(0,0);for(const I of g)b._add(I);return b.div(g.length)}(h),this.touches=ls(d,h)))}touchmove(s,h,d){if(this.aborted||!this.centroid)return;const g=ls(d,h);for(const b in this.touches){const I=g[b];(!I||I.dist(this.touches[b])>30)&&(this.aborted=!0)}}touchend(s,h,d){if((!this.centroid||s.timeStamp-this.startTime>500)&&(this.aborted=!0),d.length===0){const g=!this.aborted&&this.centroid;if(this.reset(),g)return g}}}class uh{constructor(s){this.singleTap=new Ca(s),this.numTaps=s.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(s,h,d){this.singleTap.touchstart(s,h,d)}touchmove(s,h,d){this.singleTap.touchmove(s,h,d)}touchend(s,h,d){const g=this.singleTap.touchend(s,h,d);if(g){const b=s.timeStamp-this.lastTime<500,I=!this.lastTap||this.lastTap.dist(g)<30;if(b&&I||this.reset(),this.count++,this.lastTime=s.timeStamp,this.lastTap=g,this.count===this.numTaps)return this.reset(),g}}}class Ta{constructor(s){this._tr=new Ia(s),this._zoomIn=new uh({numTouches:1,numTaps:2}),this._zoomOut=new uh({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(s,h,d){this._zoomIn.touchstart(s,h,d),this._zoomOut.touchstart(s,h,d)}touchmove(s,h,d){this._zoomIn.touchmove(s,h,d),this._zoomOut.touchmove(s,h,d)}touchend(s,h,d){const g=this._zoomIn.touchend(s,h,d),b=this._zoomOut.touchend(s,h,d),I=this._tr;return g?(this._active=!0,s.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:C=>C.easeTo({duration:300,zoom:I.zoom+1,around:I.unproject(g)},{originalEvent:s})}):b?(this._active=!0,s.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:C=>C.easeTo({duration:300,zoom:I.zoom-1,around:I.unproject(b)},{originalEvent:s})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class La{constructor(s){this._enabled=!!s.enable,this._moveStateManager=s.moveStateManager,this._clickTolerance=s.clickTolerance||1,this._moveFunction=s.move,this._activateOnStart=!!s.activateOnStart,s.assignEvents(this),this.reset()}reset(s){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(s)}_move(...s){const h=this._moveFunction(...s);if(h.bearingDelta||h.pitchDelta||h.around||h.panDelta)return this._active=!0,h}dragStart(s,h){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(s)&&(this._moveStateManager.startMove(s),this._lastPoint=h.length?h[0]:h,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(s,h){if(!this.isEnabled())return;const d=this._lastPoint;if(!d)return;if(s.preventDefault(),!this._moveStateManager.isValidMoveEvent(s))return void this.reset(s);const g=h.length?h[0]:h;return!this._moved&&g.dist(d)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=g,this._move(d,g))}dragEnd(s){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(s)&&(this._moved&&x.suppressClick(),this.reset(s))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Hg={0:1,2:2};class Ff{constructor(s){this._correctEvent=s.checkCorrectEvent}startMove(s){const h=x.mouseButton(s);this._eventButton=h}endMove(s){delete this._eventButton}isValidStartEvent(s){return this._correctEvent(s)}isValidMoveEvent(s){return!function(h,d){const g=Hg[d];return h.buttons===void 0||(h.buttons&g)!==g}(s,this._eventButton)}isValidEndEvent(s){return x.mouseButton(s)===this._eventButton}}class Hd{constructor(){this._firstTouch=void 0}_isOneFingerTouch(s){return s.targetTouches.length===1}_isSameTouchEvent(s){return s.targetTouches[0].identifier===this._firstTouch}startMove(s){this._firstTouch=s.targetTouches[0].identifier}endMove(s){delete this._firstTouch}isValidStartEvent(s){return this._isOneFingerTouch(s)}isValidMoveEvent(s){return this._isOneFingerTouch(s)&&this._isSameTouchEvent(s)}isValidEndEvent(s){return this._isOneFingerTouch(s)&&this._isSameTouchEvent(s)}}const ch=y=>{y.mousedown=y.dragStart,y.mousemoveWindow=y.dragMove,y.mouseup=y.dragEnd,y.contextmenu=function(s){s.preventDefault()}},du=({enable:y,clickTolerance:s,bearingDegreesPerPixelMoved:h=.8})=>{const d=new Ff({checkCorrectEvent:g=>x.mouseButton(g)===0&&g.ctrlKey||x.mouseButton(g)===2});return new La({clickTolerance:s,move:(g,b)=>({bearingDelta:(b.x-g.x)*h}),moveStateManager:d,enable:y,assignEvents:ch})},Ma=({enable:y,clickTolerance:s,pitchDegreesPerPixelMoved:h=-.5})=>{const d=new Ff({checkCorrectEvent:g=>x.mouseButton(g)===0&&g.ctrlKey||x.mouseButton(g)===2});return new La({clickTolerance:s,move:(g,b)=>({pitchDelta:(b.y-g.y)*h}),moveStateManager:d,enable:y,assignEvents:ch})};class xe{constructor(s,h){this._minTouches=s.cooperativeGestures?2:1,this._clickTolerance=s.clickTolerance||1,this._map=h,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new a.P(0,0),setTimeout(()=>{this._cancelCooperativeMessage=!1},200)}touchstart(s,h,d){return this._calculateTransform(s,h,d)}touchmove(s,h,d){if(this._map._cooperativeGestures&&(this._minTouches===2&&d.length<2&&!this._cancelCooperativeMessage?this._map._onCooperativeGesture(s,!1,d.length):this._cancelCooperativeMessage||(this._cancelCooperativeMessage=!0)),this._active&&!(d.length<this._minTouches))return s.preventDefault(),this._calculateTransform(s,h,d)}touchend(s,h,d){this._calculateTransform(s,h,d),this._active&&d.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(s,h,d){d.length>0&&(this._active=!0);const g=ls(d,h),b=new a.P(0,0),I=new a.P(0,0);let C=0;for(const N in g){const R=g[N],z=this._touches[N];z&&(b._add(R),I._add(R.sub(z)),C++,g[N]=R)}if(this._touches=g,C<this._minTouches||!I.mag())return;const M=I.div(C);return this._sum._add(M),this._sum.mag()<this._clickTolerance?void 0:{around:b.div(C),panDelta:M}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class hh{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(s,h,d){this._firstTwoTouches||d.length<2||(this._firstTwoTouches=[d[0].identifier,d[1].identifier],this._start([h[0],h[1]]))}touchmove(s,h,d){if(!this._firstTwoTouches)return;s.preventDefault();const[g,b]=this._firstTwoTouches,I=tl(d,h,g),C=tl(d,h,b);if(!I||!C)return;const M=this._aroundCenter?null:I.add(C).div(2);return this._move([I,C],M,s)}touchend(s,h,d){if(!this._firstTwoTouches)return;const[g,b]=this._firstTwoTouches,I=tl(d,h,g),C=tl(d,h,b);I&&C||(this._active&&x.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(s){this._enabled=!0,this._aroundCenter=!!s&&s.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function tl(y,s,h){for(let d=0;d<y.length;d++)if(y[d].identifier===h)return s[d]}function mu(y,s){return Math.log(y/s)/Math.LN2}class Yd extends hh{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(s){this._startDistance=this._distance=s[0].dist(s[1])}_move(s,h){const d=this._distance;if(this._distance=s[0].dist(s[1]),this._active||!(Math.abs(mu(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:mu(this._distance,d),pinchAround:h}}}function ye(y,s){return 180*y.angleWith(s)/Math.PI}class Bf extends hh{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(s){this._startVector=this._vector=s[0].sub(s[1]),this._minDiameter=s[0].dist(s[1])}_move(s,h){const d=this._vector;if(this._vector=s[0].sub(s[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:ye(this._vector,d),pinchAround:h}}_isBelowThreshold(s){this._minDiameter=Math.min(this._minDiameter,s.mag());const h=25/(Math.PI*this._minDiameter)*360,d=ye(s,this._startVector);return Math.abs(d)<h}}function Vf(y){return Math.abs(y.y)>Math.abs(y.x)}class Yg extends hh{constructor(s){super(),this._map=s}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(s,h,d){super.touchstart(s,h,d),this._currentTouchCount=d.length}_start(s){this._lastPoints=s,Vf(s[0].sub(s[1]))&&(this._valid=!1)}_move(s,h,d){if(this._map._cooperativeGestures&&this._currentTouchCount<3)return;const g=s[0].sub(this._lastPoints[0]),b=s[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(g,b,d.timeStamp),this._valid?(this._lastPoints=s,this._active=!0,{pitchDelta:(g.y+b.y)/2*-.5}):void 0}gestureBeginsVertically(s,h,d){if(this._valid!==void 0)return this._valid;const g=s.mag()>=2,b=h.mag()>=2;if(!g&&!b)return;if(!g||!b)return this._firstMove===void 0&&(this._firstMove=d),d-this._firstMove<100&&void 0;const I=s.y>0==h.y>0;return Vf(s)&&Vf(h)&&I}}const Uf={panStep:100,bearingStep:15,pitchStep:10};class Kd{constructor(s){this._tr=new Ia(s);const h=Uf;this._panStep=h.panStep,this._bearingStep=h.bearingStep,this._pitchStep=h.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(s){if(s.altKey||s.ctrlKey||s.metaKey)return;let h=0,d=0,g=0,b=0,I=0;switch(s.keyCode){case 61:case 107:case 171:case 187:h=1;break;case 189:case 109:case 173:h=-1;break;case 37:s.shiftKey?d=-1:(s.preventDefault(),b=-1);break;case 39:s.shiftKey?d=1:(s.preventDefault(),b=1);break;case 38:s.shiftKey?g=1:(s.preventDefault(),I=-1);break;case 40:s.shiftKey?g=-1:(s.preventDefault(),I=1);break;default:return}return this._rotationDisabled&&(d=0,g=0),{cameraAnimation:C=>{const M=this._tr;C.easeTo({duration:300,easeId:"keyboardHandler",easing:Jd,zoom:h?Math.round(M.zoom)+h*(s.shiftKey?2:1):M.zoom,bearing:M.bearing+d*this._bearingStep,pitch:M.pitch+g*this._pitchStep,offset:[-b*this._panStep,-I*this._panStep],center:M.center},{originalEvent:s})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Jd(y){return y*(2-y)}const Qd=4.000244140625;class Kg{constructor(s,h){this._onTimeout=d=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(d)},this._map=s,this._tr=new Ia(s),this._el=s.getCanvasContainer(),this._triggerRenderFrame=h,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(s){this._defaultZoomRate=s}setWheelZoomRate(s){this._wheelZoomRate=s}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(s){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!s&&s.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(s){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!s[this._map._metaKey])return;s.preventDefault()}let h=s.deltaMode===WheelEvent.DOM_DELTA_LINE?40*s.deltaY:s.deltaY;const d=a.h.now(),g=d-(this._lastWheelEventTime||0);this._lastWheelEventTime=d,h!==0&&h%Qd==0?this._type="wheel":h!==0&&Math.abs(h)<4?this._type="trackpad":g>400?(this._type=null,this._lastValue=h,this._timeout=setTimeout(this._onTimeout,40,s)):this._type||(this._type=Math.abs(g*h)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,h+=this._lastValue)),s.shiftKey&&h&&(h/=4),this._type&&(this._lastWheelEvent=s,this._delta-=h,this._active||this._start(s)),s.preventDefault()}_start(s){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const h=x.mousePos(this._el,s),d=this._tr;this._around=a.L.convert(this._aroundCenter?d.center:d.unproject(h)),this._aroundPoint=d.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const s=this._tr.transform;if(this._delta!==0){const C=this._type==="wheel"&&Math.abs(this._delta)>Qd?this._wheelZoomRate:this._defaultZoomRate;let M=2/(1+Math.exp(-Math.abs(this._delta*C)));this._delta<0&&M!==0&&(M=1/M);const N=typeof this._targetZoom=="number"?s.zoomScale(this._targetZoom):s.scale;this._targetZoom=Math.min(s.maxZoom,Math.max(s.minZoom,s.scaleZoom(N*M))),this._type==="wheel"&&(this._startZoom=s.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const h=typeof this._targetZoom=="number"?this._targetZoom:s.zoom,d=this._startZoom,g=this._easing;let b,I=!1;if(this._type==="wheel"&&d&&g){const C=Math.min((a.h.now()-this._lastWheelEventTime)/200,1),M=g(C);b=a.B.number(d,h,M),C<1?this._frameId||(this._frameId=!0):I=!0}else b=h,I=!0;return this._active=!0,I&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!I,zoomDelta:b-s.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(s){let h=a.bb;if(this._prevEase){const d=this._prevEase,g=(a.h.now()-d.start)/d.duration,b=d.easing(g+.01)-d.easing(g),I=.27/Math.sqrt(b*b+1e-4)*.01,C=Math.sqrt(.0729-I*I);h=a.ba(I,C,.25,1)}return this._prevEase={start:a.h.now(),duration:s,easing:h},h}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Gf{constructor(s,h){this._clickZoom=s,this._tapZoom=h}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class jf{constructor(s){this._tr=new Ia(s),this.reset()}reset(){this._active=!1}dblclick(s,h){return s.preventDefault(),{cameraAnimation:d=>{d.easeTo({duration:300,zoom:this._tr.zoom+(s.shiftKey?-1:1),around:this._tr.unproject(h)},{originalEvent:s})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class qf{constructor(){this._tap=new uh({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(s,h,d){if(!this._swipePoint)if(this._tapTime){const g=h[0],b=s.timeStamp-this._tapTime<500,I=this._tapPoint.dist(g)<30;b&&I?d.length>0&&(this._swipePoint=g,this._swipeTouch=d[0].identifier):this.reset()}else this._tap.touchstart(s,h,d)}touchmove(s,h,d){if(this._tapTime){if(this._swipePoint){if(d[0].identifier!==this._swipeTouch)return;const g=h[0],b=g.y-this._swipePoint.y;return this._swipePoint=g,s.preventDefault(),this._active=!0,{zoomDelta:b/128}}}else this._tap.touchmove(s,h,d)}touchend(s,h,d){if(this._tapTime)this._swipePoint&&d.length===0&&this.reset();else{const g=this._tap.touchend(s,h,d);g&&(this._tapTime=s.timeStamp,this._tapPoint=g)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Zf{constructor(s,h,d){this._el=s,this._mousePan=h,this._touchPan=d}enable(s){this._inertiaOptions=s||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class bo{constructor(s,h,d){this._pitchWithRotate=s.pitchWithRotate,this._mouseRotate=h,this._mousePitch=d}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class el{constructor(s,h,d,g){this._el=s,this._touchZoom=h,this._touchRotate=d,this._tapDragZoom=g,this._rotationDisabled=!1,this._enabled=!0}enable(s){this._touchZoom.enable(s),this._rotationDisabled||this._touchRotate.enable(s),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const oc=y=>y.zoom||y.drag||y.pitch||y.rotate;class $f extends a.k{}function sc(y){return y.panDelta&&y.panDelta.mag()||y.zoomDelta||y.bearingDelta||y.pitchDelta}class Wf{constructor(s,h){this.handleWindowEvent=g=>{this.handleEvent(g,`${g.type}Window`)},this.handleEvent=(g,b)=>{if(g.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const I=g.type==="renderFrame"?void 0:g,C={needsRenderFrame:!1},M={},N={},R=g.touches,z=R?this._getMapTouches(R):void 0,W=z?x.touchPos(this._el,z):x.mousePos(this._el,g);for(const{handlerName:at,handler:Q,allowed:Lt}of this._handlers){if(!Q.isEnabled())continue;let Ot;this._blockedByActive(N,Lt,at)?Q.reset():Q[b||g.type]&&(Ot=Q[b||g.type](g,W,z),this.mergeHandlerResult(C,M,Ot,at,I),Ot&&Ot.needsRenderFrame&&this._triggerRenderFrame()),(Ot||Q.isActive())&&(N[at]=Q)}const nt={};for(const at in this._previousActiveHandlers)N[at]||(nt[at]=I);this._previousActiveHandlers=N,(Object.keys(nt).length||sc(C))&&(this._changes.push([C,M,nt]),this._triggerRenderFrame()),(Object.keys(N).length||sc(C))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:et}=C;et&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],et(this._map))},this._map=s,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new qd(s),this._bearingSnap=h.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(h);const d=this._el;this._listeners=[[d,"touchstart",{passive:!0}],[d,"touchmove",{passive:!1}],[d,"touchend",void 0],[d,"touchcancel",void 0],[d,"mousedown",void 0],[d,"mousemove",void 0],[d,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[d,"mouseover",void 0],[d,"mouseout",void 0],[d,"dblclick",void 0],[d,"click",void 0],[d,"keydown",{capture:!1}],[d,"keyup",void 0],[d,"wheel",{passive:!1}],[d,"contextmenu",void 0],[window,"blur",void 0]];for(const[g,b,I]of this._listeners)x.addEventListener(g,b,g===document?this.handleWindowEvent:this.handleEvent,I)}destroy(){for(const[s,h,d]of this._listeners)x.removeEventListener(s,h,s===document?this.handleWindowEvent:this.handleEvent,d)}_addDefaultHandlers(s){const h=this._map,d=h.getCanvasContainer();this._add("mapEvent",new $d(h,s));const g=h.boxZoom=new Xd(h,s);this._add("boxZoom",g),s.interactive&&s.boxZoom&&g.enable();const b=new Ta(h),I=new jf(h);h.doubleClickZoom=new Gf(I,b),this._add("tapZoom",b),this._add("clickZoom",I),s.interactive&&s.doubleClickZoom&&h.doubleClickZoom.enable();const C=new qf;this._add("tapDragZoom",C);const M=h.touchPitch=new Yg(h);this._add("touchPitch",M),s.interactive&&s.touchPitch&&h.touchPitch.enable(s.touchPitch);const N=du(s),R=Ma(s);h.dragRotate=new bo(s,N,R),this._add("mouseRotate",N,["mousePitch"]),this._add("mousePitch",R,["mouseRotate"]),s.interactive&&s.dragRotate&&h.dragRotate.enable();const z=(({enable:Lt,clickTolerance:Ot})=>{const ct=new Ff({checkCorrectEvent:Pt=>x.mouseButton(Pt)===0&&!Pt.ctrlKey});return new La({clickTolerance:Ot,move:(Pt,Bt)=>({around:Bt,panDelta:Bt.sub(Pt)}),activateOnStart:!0,moveStateManager:ct,enable:Lt,assignEvents:ch})})(s),W=new xe(s,h);h.dragPan=new Zf(d,z,W),this._add("mousePan",z),this._add("touchPan",W,["touchZoom","touchRotate"]),s.interactive&&s.dragPan&&h.dragPan.enable(s.dragPan);const nt=new Bf,et=new Yd;h.touchZoomRotate=new el(d,et,nt,C),this._add("touchRotate",nt,["touchPan","touchZoom"]),this._add("touchZoom",et,["touchPan","touchRotate"]),s.interactive&&s.touchZoomRotate&&h.touchZoomRotate.enable(s.touchZoomRotate);const at=h.scrollZoom=new Kg(h,()=>this._triggerRenderFrame());this._add("scrollZoom",at,["mousePan"]),s.interactive&&s.scrollZoom&&h.scrollZoom.enable(s.scrollZoom);const Q=h.keyboard=new Kd(h);this._add("keyboard",Q),s.interactive&&s.keyboard&&h.keyboard.enable(),this._add("blockableMapEvent",new Wd(h))}_add(s,h,d){this._handlers.push({handlerName:s,handler:h,allowed:d}),this._handlersById[s]=h}stop(s){if(!this._updatingCamera){for(const{handler:h}of this._handlers)h.reset();this._inertia.clear(),this._fireEvents({},{},s),this._changes=[]}}isActive(){for(const{handler:s}of this._handlers)if(s.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!oc(this._eventsInProgress)||this.isZooming()}_blockedByActive(s,h,d){for(const g in s)if(g!==d&&(!h||h.indexOf(g)<0))return!0;return!1}_getMapTouches(s){const h=[];for(const d of s)this._el.contains(d.target)&&h.push(d);return h}mergeHandlerResult(s,h,d,g,b){if(!d)return;a.e(s,d);const I={handlerName:g,originalEvent:d.originalEvent||b};d.zoomDelta!==void 0&&(h.zoom=I),d.panDelta!==void 0&&(h.drag=I),d.pitchDelta!==void 0&&(h.pitch=I),d.bearingDelta!==void 0&&(h.rotate=I)}_applyChanges(){const s={},h={},d={};for(const[g,b,I]of this._changes)g.panDelta&&(s.panDelta=(s.panDelta||new a.P(0,0))._add(g.panDelta)),g.zoomDelta&&(s.zoomDelta=(s.zoomDelta||0)+g.zoomDelta),g.bearingDelta&&(s.bearingDelta=(s.bearingDelta||0)+g.bearingDelta),g.pitchDelta&&(s.pitchDelta=(s.pitchDelta||0)+g.pitchDelta),g.around!==void 0&&(s.around=g.around),g.pinchAround!==void 0&&(s.pinchAround=g.pinchAround),g.noInertia&&(s.noInertia=g.noInertia),a.e(h,b),a.e(d,I);this._updateMapTransform(s,h,d),this._changes=[]}_updateMapTransform(s,h,d){const g=this._map,b=g._getTransformForUpdate(),I=g.terrain;if(!(sc(s)||I&&this._terrainMovement))return this._fireEvents(h,d,!0);let{panDelta:C,zoomDelta:M,bearingDelta:N,pitchDelta:R,around:z,pinchAround:W}=s;W!==void 0&&(z=W),g._stop(!0),z=z||g.transform.centerPoint;const nt=b.pointLocation(C?z.sub(C):z);N&&(b.bearing+=N),R&&(b.pitch+=R),M&&(b.zoom+=M),I?this._terrainMovement||!h.drag&&!h.zoom?h.drag&&this._terrainMovement?b.center=b.pointLocation(b.centerPoint.sub(C)):b.setLocationAtPoint(nt,z):(this._terrainMovement=!0,this._map._elevationFreeze=!0,b.setLocationAtPoint(nt,z),this._map.once("moveend",()=>{this._map._elevationFreeze=!1,this._terrainMovement=!1,b.recalculateZoom(g.terrain)})):b.setLocationAtPoint(nt,z),g._applyUpdatedTransform(b),this._map._update(),s.noInertia||this._inertia.record(s),this._fireEvents(h,d,!0)}_fireEvents(s,h,d){const g=oc(this._eventsInProgress),b=oc(s),I={};for(const R in s){const{originalEvent:z}=s[R];this._eventsInProgress[R]||(I[`${R}start`]=z),this._eventsInProgress[R]=s[R]}!g&&b&&this._fireEvent("movestart",b.originalEvent);for(const R in I)this._fireEvent(R,I[R]);b&&this._fireEvent("move",b.originalEvent);for(const R in s){const{originalEvent:z}=s[R];this._fireEvent(R,z)}const C={};let M;for(const R in this._eventsInProgress){const{handlerName:z,originalEvent:W}=this._eventsInProgress[R];this._handlersById[z].isActive()||(delete this._eventsInProgress[R],M=h[z]||W,C[`${R}end`]=M)}for(const R in C)this._fireEvent(R,C[R]);const N=oc(this._eventsInProgress);if(d&&(g||b)&&!N){this._updatingCamera=!0;const R=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),z=W=>W!==0&&-this._bearingSnap<W&&W<this._bearingSnap;!R||!R.essential&&a.h.prefersReducedMotion?(this._map.fire(new a.k("moveend",{originalEvent:M})),z(this._map.getBearing())&&this._map.resetNorth()):(z(R.bearing||this._map.getBearing())&&(R.bearing=0),R.freezeElevation=!0,this._map.easeTo(R,{originalEvent:M})),this._updatingCamera=!1}}_fireEvent(s,h){this._map.fire(new a.k(s,h?{originalEvent:h}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(s=>{delete this._frameId,this.handleEvent(new $f("renderFrame",{timeStamp:s})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class tm extends a.E{constructor(s,h){super(),this._renderFrameCallback=()=>{const d=Math.min((a.h.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(d)),d<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=s,this._bearingSnap=h.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new a.L(this.transform.center.lng,this.transform.center.lat)}setCenter(s,h){return this.jumpTo({center:s},h)}panBy(s,h,d){return s=a.P.convert(s).mult(-1),this.panTo(this.transform.center,a.e({offset:s},h),d)}panTo(s,h,d){return this.easeTo(a.e({center:s},h),d)}getZoom(){return this.transform.zoom}setZoom(s,h){return this.jumpTo({zoom:s},h),this}zoomTo(s,h,d){return this.easeTo(a.e({zoom:s},h),d)}zoomIn(s,h){return this.zoomTo(this.getZoom()+1,s,h),this}zoomOut(s,h){return this.zoomTo(this.getZoom()-1,s,h),this}getBearing(){return this.transform.bearing}setBearing(s,h){return this.jumpTo({bearing:s},h),this}getPadding(){return this.transform.padding}setPadding(s,h){return this.jumpTo({padding:s},h),this}rotateTo(s,h,d){return this.easeTo(a.e({bearing:s},h),d)}resetNorth(s,h){return this.rotateTo(0,a.e({duration:1e3},s),h),this}resetNorthPitch(s,h){return this.easeTo(a.e({bearing:0,pitch:0,duration:1e3},s),h),this}snapToNorth(s,h){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(s,h):this}getPitch(){return this.transform.pitch}setPitch(s,h){return this.jumpTo({pitch:s},h),this}cameraForBounds(s,h){s=ke.convert(s);const d=h&&h.bearing||0;return this._cameraForBoxAndBearing(s.getNorthWest(),s.getSouthEast(),d,h)}_cameraForBoxAndBearing(s,h,d,g){const b={top:0,bottom:0,right:0,left:0};if(typeof(g=a.e({padding:b,offset:[0,0],maxZoom:this.transform.maxZoom},g)).padding=="number"){const Bt=g.padding;g.padding={top:Bt,bottom:Bt,right:Bt,left:Bt}}g.padding=a.e(b,g.padding);const I=this.transform,C=I.padding,M=I.project(a.L.convert(s)),N=I.project(a.L.convert(h)),R=M.rotate(-d*Math.PI/180),z=N.rotate(-d*Math.PI/180),W=new a.P(Math.max(R.x,z.x),Math.max(R.y,z.y)),nt=new a.P(Math.min(R.x,z.x),Math.min(R.y,z.y)),et=W.sub(nt),at=(I.width-(C.left+C.right+g.padding.left+g.padding.right))/et.x,Q=(I.height-(C.top+C.bottom+g.padding.top+g.padding.bottom))/et.y;if(Q<0||at<0)return void a.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const Lt=Math.min(I.scaleZoom(I.scale*Math.min(at,Q)),g.maxZoom),Ot=a.P.convert(g.offset),ct=new a.P((g.padding.left-g.padding.right)/2,(g.padding.top-g.padding.bottom)/2).rotate(d*Math.PI/180),Pt=Ot.add(ct).mult(I.scale/I.zoomScale(Lt));return{center:I.unproject(M.add(N).div(2).sub(Pt)),zoom:Lt,bearing:d}}fitBounds(s,h,d){return this._fitInternal(this.cameraForBounds(s,h),h,d)}fitScreenCoordinates(s,h,d,g,b){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(a.P.convert(s)),this.transform.pointLocation(a.P.convert(h)),d,g),g,b)}_fitInternal(s,h,d){return s?(delete(h=a.e(s,h)).padding,h.linear?this.easeTo(h,d):this.flyTo(h,d)):this}jumpTo(s,h){this.stop();const d=this._getTransformForUpdate();let g=!1,b=!1,I=!1;return"zoom"in s&&d.zoom!==+s.zoom&&(g=!0,d.zoom=+s.zoom),s.center!==void 0&&(d.center=a.L.convert(s.center)),"bearing"in s&&d.bearing!==+s.bearing&&(b=!0,d.bearing=+s.bearing),"pitch"in s&&d.pitch!==+s.pitch&&(I=!0,d.pitch=+s.pitch),s.padding==null||d.isPaddingEqual(s.padding)||(d.padding=s.padding),this._applyUpdatedTransform(d),this.fire(new a.k("movestart",h)).fire(new a.k("move",h)),g&&this.fire(new a.k("zoomstart",h)).fire(new a.k("zoom",h)).fire(new a.k("zoomend",h)),b&&this.fire(new a.k("rotatestart",h)).fire(new a.k("rotate",h)).fire(new a.k("rotateend",h)),I&&this.fire(new a.k("pitchstart",h)).fire(new a.k("pitch",h)).fire(new a.k("pitchend",h)),this.fire(new a.k("moveend",h))}calculateCameraOptionsFromTo(s,h,d,g=0){const b=a.U.fromLngLat(s,h),I=a.U.fromLngLat(d,g),C=I.x-b.x,M=I.y-b.y,N=I.z-b.z,R=Math.hypot(C,M,N);if(R===0)throw new Error("Can't calculate camera options with same From and To");const z=Math.hypot(C,M),W=this.transform.scaleZoom(this.transform.cameraToCenterDistance/R/this.transform.tileSize),nt=180*Math.atan2(C,-M)/Math.PI;let et=180*Math.acos(z/R)/Math.PI;return et=N<0?90-et:90+et,{center:I.toLngLat(),zoom:W,pitch:et,bearing:nt}}easeTo(s,h){this._stop(!1,s.easeId),((s=a.e({offset:[0,0],duration:500,easing:a.bb},s)).animate===!1||!s.essential&&a.h.prefersReducedMotion)&&(s.duration=0);const d=this._getTransformForUpdate(),g=this.getZoom(),b=this.getBearing(),I=this.getPitch(),C=this.getPadding(),M="zoom"in s?+s.zoom:g,N="bearing"in s?this._normalizeBearing(s.bearing,b):b,R="pitch"in s?+s.pitch:I,z="padding"in s?s.padding:d.padding,W=a.P.convert(s.offset);let nt=d.centerPoint.add(W);const et=d.pointLocation(nt),at=a.L.convert(s.center||et);this._normalizeCenter(at);const Q=d.project(et),Lt=d.project(at).sub(Q),Ot=d.zoomScale(M-g);let ct,Pt;s.around&&(ct=a.L.convert(s.around),Pt=d.locationPoint(ct));const Bt={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||M!==g,this._rotating=this._rotating||b!==N,this._pitching=this._pitching||R!==I,this._padding=!d.isPaddingEqual(z),this._easeId=s.easeId,this._prepareEase(h,s.noMoveStart,Bt),this.terrain&&this._prepareElevation(at),this._ease(Vt=>{if(this._zooming&&(d.zoom=a.B.number(g,M,Vt)),this._rotating&&(d.bearing=a.B.number(b,N,Vt)),this._pitching&&(d.pitch=a.B.number(I,R,Vt)),this._padding&&(d.interpolatePadding(C,z,Vt),nt=d.centerPoint.add(W)),this.terrain&&!s.freezeElevation&&this._updateElevation(Vt),ct)d.setLocationAtPoint(ct,Pt);else{const Yt=d.zoomScale(d.zoom-g),ne=M>g?Math.min(2,Ot):Math.max(.5,Ot),te=Math.pow(ne,1-Vt),ae=d.unproject(Q.add(Lt.mult(Vt*te)).mult(Yt));d.setLocationAtPoint(d.renderWorldCopies?ae.wrap():ae,nt)}this._applyUpdatedTransform(d),this._fireMoveEvents(h)},Vt=>{this.terrain&&this._finalizeElevation(),this._afterEase(h,Vt)},s),this}_prepareEase(s,h,d={}){this._moving=!0,h||d.moving||this.fire(new a.k("movestart",s)),this._zooming&&!d.zooming&&this.fire(new a.k("zoomstart",s)),this._rotating&&!d.rotating&&this.fire(new a.k("rotatestart",s)),this._pitching&&!d.pitching&&this.fire(new a.k("pitchstart",s))}_prepareElevation(s){this._elevationCenter=s,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(s,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(s){this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const h=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(s<1&&h!==this._elevationTarget){const d=this._elevationTarget-this._elevationStart;this._elevationStart+=s*(d-(h-(d*s+this._elevationStart))/(1-s)),this._elevationTarget=h}this.transform.elevation=a.B.number(this._elevationStart,this._elevationTarget,s)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(s){if(!this.transformCameraUpdate)return;const h=s.clone(),{center:d,zoom:g,pitch:b,bearing:I,elevation:C}=this.transformCameraUpdate(h);d&&(h.center=d),g!==void 0&&(h.zoom=g),b!==void 0&&(h.pitch=b),I!==void 0&&(h.bearing=I),C!==void 0&&(h.elevation=C),this.transform.apply(h)}_fireMoveEvents(s){this.fire(new a.k("move",s)),this._zooming&&this.fire(new a.k("zoom",s)),this._rotating&&this.fire(new a.k("rotate",s)),this._pitching&&this.fire(new a.k("pitch",s))}_afterEase(s,h){if(this._easeId&&h&&this._easeId===h)return;delete this._easeId;const d=this._zooming,g=this._rotating,b=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,d&&this.fire(new a.k("zoomend",s)),g&&this.fire(new a.k("rotateend",s)),b&&this.fire(new a.k("pitchend",s)),this.fire(new a.k("moveend",s))}flyTo(s,h){if(!s.essential&&a.h.prefersReducedMotion){const Pe=a.F(s,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Pe,h)}this.stop(),s=a.e({offset:[0,0],speed:1.2,curve:1.42,easing:a.bb},s);const d=this._getTransformForUpdate(),g=this.getZoom(),b=this.getBearing(),I=this.getPitch(),C=this.getPadding(),M="zoom"in s?a.ad(+s.zoom,d.minZoom,d.maxZoom):g,N="bearing"in s?this._normalizeBearing(s.bearing,b):b,R="pitch"in s?+s.pitch:I,z="padding"in s?s.padding:d.padding,W=d.zoomScale(M-g),nt=a.P.convert(s.offset);let et=d.centerPoint.add(nt);const at=d.pointLocation(et),Q=a.L.convert(s.center||at);this._normalizeCenter(Q);const Lt=d.project(at),Ot=d.project(Q).sub(Lt);let ct=s.curve;const Pt=Math.max(d.width,d.height),Bt=Pt/W,Vt=Ot.mag();if("minZoom"in s){const Pe=a.ad(Math.min(s.minZoom,g,M),d.minZoom,d.maxZoom),Hn=Pt/d.zoomScale(Pe-g);ct=Math.sqrt(Hn/Vt*2)}const Yt=ct*ct;function ne(Pe){const Hn=(Bt*Bt-Pt*Pt+(Pe?-1:1)*Yt*Yt*Vt*Vt)/(2*(Pe?Bt:Pt)*Yt*Vt);return Math.log(Math.sqrt(Hn*Hn+1)-Hn)}function te(Pe){return(Math.exp(Pe)-Math.exp(-Pe))/2}function ae(Pe){return(Math.exp(Pe)+Math.exp(-Pe))/2}const Le=ne(!1);let vn=function(Pe){return ae(Le)/ae(Le+ct*Pe)},pe=function(Pe){return Pt*((ae(Le)*(te(Hn=Le+ct*Pe)/ae(Hn))-te(Le))/Yt)/Vt;var Hn},Ge=(ne(!0)-Le)/ct;if(Math.abs(Vt)<1e-6||!isFinite(Ge)){if(Math.abs(Pt-Bt)<1e-6)return this.easeTo(s,h);const Pe=Bt<Pt?-1:1;Ge=Math.abs(Math.log(Bt/Pt))/ct,pe=function(){return 0},vn=function(Hn){return Math.exp(Pe*ct*Hn)}}return s.duration="duration"in s?+s.duration:1e3*Ge/("screenSpeed"in s?+s.screenSpeed/ct:+s.speed),s.maxDuration&&s.duration>s.maxDuration&&(s.duration=0),this._zooming=!0,this._rotating=b!==N,this._pitching=R!==I,this._padding=!d.isPaddingEqual(z),this._prepareEase(h,!1),this.terrain&&this._prepareElevation(Q),this._ease(Pe=>{const Hn=Pe*Ge,_n=1/vn(Hn);d.zoom=Pe===1?M:g+d.scaleZoom(_n),this._rotating&&(d.bearing=a.B.number(b,N,Pe)),this._pitching&&(d.pitch=a.B.number(I,R,Pe)),this._padding&&(d.interpolatePadding(C,z,Pe),et=d.centerPoint.add(nt)),this.terrain&&!s.freezeElevation&&this._updateElevation(Pe);const un=Pe===1?Q:d.unproject(Lt.add(Ot.mult(pe(Hn))).mult(_n));d.setLocationAtPoint(d.renderWorldCopies?un.wrap():un,et),this._applyUpdatedTransform(d),this._fireMoveEvents(h)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(h)},s),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(s,h){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const d=this._onEaseEnd;delete this._onEaseEnd,d.call(this,h)}if(!s){const d=this.handlers;d&&d.stop(!1)}return this}_ease(s,h,d){d.animate===!1||d.duration===0?(s(1),h()):(this._easeStart=a.h.now(),this._easeOptions=d,this._onEaseFrame=s,this._onEaseEnd=h,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(s,h){s=a.b5(s,-180,180);const d=Math.abs(s-h);return Math.abs(s-360-h)<d&&(s-=360),Math.abs(s+360-h)<d&&(s+=360),s}_normalizeCenter(s){const h=this.transform;if(!h.renderWorldCopies||h.lngRange)return;const d=s.lng-h.center.lng;s.lng+=d>180?-360:d<-180?360:0}queryTerrainElevation(s){return this.terrain?this.terrain.getElevationForLngLatZoom(a.L.convert(s),this.transform.tileZoom)-this.transform.elevation:null}}class Fo{constructor(s={}){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=h=>{!h||h.sourceDataType!=="metadata"&&h.sourceDataType!=="visibility"&&h.dataType!=="style"&&h.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=s}getDefaultPosition(){return"bottom-right"}onAdd(s){return this._map=s,this._compact=this.options&&this.options.compact,this._container=x.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=x.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=x.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){x.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(s,h){const d=this._map._getUIString(`AttributionControl.${h}`);s.title=d,s.setAttribute("aria-label",d)}_updateAttributions(){if(!this._map.style)return;let s=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?s=s.concat(this.options.customAttribution.map(g=>typeof g!="string"?"":g)):typeof this.options.customAttribution=="string"&&s.push(this.options.customAttribution)),this._map.style.stylesheet){const g=this._map.style.stylesheet;this.styleOwner=g.owner,this.styleId=g.id}const h=this._map.style.sourceCaches;for(const g in h){const b=h[g];if(b.used||b.usedForTerrain){const I=b.getSource();I.attribution&&s.indexOf(I.attribution)<0&&s.push(I.attribution)}}s=s.filter(g=>String(g).trim()),s.sort((g,b)=>g.length-b.length),s=s.filter((g,b)=>{for(let I=b+1;I<s.length;I++)if(s[I].indexOf(g)>=0)return!1;return!0});const d=s.join(" | ");d!==this._attribHTML&&(this._attribHTML=d,s.length?(this._innerContainer.innerHTML=d,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class pi{constructor(s={}){this._updateCompact=()=>{const h=this._container.children;if(h.length){const d=h[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&d.classList.add("maplibregl-compact"):d.classList.remove("maplibregl-compact")}},this.options=s}getDefaultPosition(){return"bottom-left"}onAdd(s){this._map=s,this._compact=this.options&&this.options.compact,this._container=x.create("div","maplibregl-ctrl");const h=x.create("a","maplibregl-ctrl-logo");return h.target="_blank",h.rel="noopener nofollow",h.href="https://maplibre.org/",h.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),h.setAttribute("rel","noopener nofollow"),this._container.appendChild(h),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){x.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class fh{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(s){const h=++this._id;return this._queue.push({callback:s,id:h,cancelled:!1}),h}remove(s){const h=this._currentlyRunning,d=h?this._queue.concat(h):this._queue;for(const g of d)if(g.id===s)return void(g.cancelled=!0)}run(s=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const h=this._currentlyRunning=this._queue;this._queue=[];for(const d of h)if(!d.cancelled&&(d.callback(s),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}const Xf={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.enableTerrain":"Enable terrain","TerrainControl.disableTerrain":"Disable terrain"};var em=a.Q([{name:"a_pos3d",type:"Int16",components:3}]);class nm extends a.E{constructor(s){super(),this.sourceCache=s,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,s.usedForTerrain=!0,s.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(s,h){this.sourceCache.update(s,h),this._renderableTilesKeys=[];const d={};for(const g of s.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:h}))d[g.key]=!0,this._renderableTilesKeys.push(g.key),this._tiles[g.key]||(g.posMatrix=new Float64Array(16),a.aS(g.posMatrix,0,a.N,0,a.N,0,1),this._tiles[g.key]=new pn(g,this.tileSize));for(const g in this._tiles)d[g]||delete this._tiles[g]}freeRtt(s){for(const h in this._tiles){const d=this._tiles[h];(!s||d.tileID.equals(s)||d.tileID.isChildOf(s)||s.isChildOf(d.tileID))&&(d.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(s=>this.getTileByID(s))}getTileByID(s){return this._tiles[s]}getTerrainCoords(s){const h={};for(const d of this._renderableTilesKeys){const g=this._tiles[d].tileID;if(g.canonical.equals(s.canonical)){const b=s.clone();b.posMatrix=new Float64Array(16),a.aS(b.posMatrix,0,a.N,0,a.N,0,1),h[d]=b}else if(g.canonical.isChildOf(s.canonical)){const b=s.clone();b.posMatrix=new Float64Array(16);const I=g.canonical.z-s.canonical.z,C=g.canonical.x-(g.canonical.x>>I<<I),M=g.canonical.y-(g.canonical.y>>I<<I),N=a.N>>I;a.aS(b.posMatrix,0,N,0,N,0,1),a.$(b.posMatrix,b.posMatrix,[-C*N,-M*N,0]),h[d]=b}else if(s.canonical.isChildOf(g.canonical)){const b=s.clone();b.posMatrix=new Float64Array(16);const I=s.canonical.z-g.canonical.z,C=s.canonical.x-(s.canonical.x>>I<<I),M=s.canonical.y-(s.canonical.y>>I<<I),N=a.N>>I;a.aS(b.posMatrix,0,a.N,0,a.N,0,1),a.$(b.posMatrix,b.posMatrix,[C*N,M*N,0]),a.a0(b.posMatrix,b.posMatrix,[1/2**I,1/2**I,0]),h[d]=b}}return h}getSourceTile(s,h){const d=this.sourceCache._source;let g=s.overscaledZ-this.deltaZoom;if(g>d.maxzoom&&(g=d.maxzoom),g<d.minzoom)return null;this._sourceTileCache[s.key]||(this._sourceTileCache[s.key]=s.scaledTo(g).key);let b=this.sourceCache.getTileByID(this._sourceTileCache[s.key]);if((!b||!b.dem)&&h)for(;g>=d.minzoom&&(!b||!b.dem);)b=this.sourceCache.getTileByID(s.scaledTo(g--).key);return b}tilesAfterTime(s=Date.now()){return Object.values(this._tiles).filter(h=>h.timeAdded>=s)}}class im{constructor(s,h,d){this.painter=s,this.sourceCache=new nm(h),this.options=d,this.exaggeration=typeof d.exaggeration=="number"?d.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(s,h,d,g=a.N){var b;if(!(h>=0&&h<g&&d>=0&&d<g))return 0;const I=this.getTerrainData(s),C=(b=I.tile)===null||b===void 0?void 0:b.dem;if(!C)return 0;const M=function(et,at,Q){var Lt=at[0],Ot=at[1];return et[0]=Q[0]*Lt+Q[4]*Ot+Q[12],et[1]=Q[1]*Lt+Q[5]*Ot+Q[13],et}([],[h/g*a.N,d/g*a.N],I.u_terrain_matrix),N=[M[0]*C.dim,M[1]*C.dim],R=Math.floor(N[0]),z=Math.floor(N[1]),W=N[0]-R,nt=N[1]-z;return C.get(R,z)*(1-W)*(1-nt)+C.get(R+1,z)*W*(1-nt)+C.get(R,z+1)*(1-W)*nt+C.get(R+1,z+1)*W*nt}getElevationForLngLatZoom(s,h){const{tileID:d,mercatorX:g,mercatorY:b}=this._getOverscaledTileIDFromLngLatZoom(s,h);return this.getElevation(d,g%a.N,b%a.N,a.N)}getElevation(s,h,d,g=a.N){return this.getDEMElevation(s,h,d,g)*this.exaggeration}getTerrainData(s){if(!this._emptyDemTexture){const g=this.painter.context,b=new a.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new St(g,b,g.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new St(g,new a.R({width:1,height:1}),g.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(g.gl.NEAREST,g.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=a.ao([])}const h=this.sourceCache.getSourceTile(s,!0);if(h&&h.dem&&(!h.demTexture||h.needsTerrainPrepare)){const g=this.painter.context;h.demTexture=this.painter.getTileTexture(h.dem.stride),h.demTexture?h.demTexture.update(h.dem.getPixels(),{premultiply:!1}):h.demTexture=new St(g,h.dem.getPixels(),g.gl.RGBA,{premultiply:!1}),h.demTexture.bind(g.gl.NEAREST,g.gl.CLAMP_TO_EDGE),h.needsTerrainPrepare=!1}const d=h&&h+h.tileID.key+s.key;if(d&&!this._demMatrixCache[d]){const g=this.sourceCache.sourceCache._source.maxzoom;let b=s.canonical.z-h.tileID.canonical.z;s.overscaledZ>s.canonical.z&&(s.canonical.z>=g?b=s.canonical.z-g:a.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const I=s.canonical.x-(s.canonical.x>>b<<b),C=s.canonical.y-(s.canonical.y>>b<<b),M=a.bc(new Float64Array(16),[1/(a.N<<b),1/(a.N<<b),0]);a.$(M,M,[I*a.N,C*a.N,0]),this._demMatrixCache[s.key]={matrix:M,coord:s}}return{u_depth:2,u_terrain:3,u_terrain_dim:h&&h.dem&&h.dem.dim||1,u_terrain_matrix:d?this._demMatrixCache[s.key].matrix:this._emptyDemMatrix,u_terrain_unpack:h&&h.dem&&h.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(h&&h.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:h}}getFramebuffer(s){const h=this.painter,d=h.width/devicePixelRatio,g=h.height/devicePixelRatio;return!this._fbo||this._fbo.width===d&&this._fbo.height===g||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new St(h.context,{width:d,height:g,data:null},h.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(h.context.gl.NEAREST,h.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new St(h.context,{width:d,height:g,data:null},h.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(h.context.gl.NEAREST,h.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=h.context.createFramebuffer(d,g,!0,!1),this._fbo.depthAttachment.set(h.context.createRenderbuffer(h.context.gl.DEPTH_COMPONENT16,d,g))),this._fbo.colorAttachment.set(s==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const s=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const h=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let b=0,I=0;b<this._coordsTextureSize;b++)for(let C=0;C<this._coordsTextureSize;C++,I+=4)h[I+0]=255&C,h[I+1]=255&b,h[I+2]=C>>8<<4|b>>8,h[I+3]=0;const d=new a.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(h.buffer)),g=new St(s,d,s.gl.RGBA,{premultiply:!1});return g.bind(s.gl.NEAREST,s.gl.CLAMP_TO_EDGE),this._coordsTexture=g,g}pointCoordinate(s){const h=new Uint8Array(4),d=this.painter.context,g=d.gl;d.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),g.readPixels(s.x,this.painter.height/devicePixelRatio-s.y-1,1,1,g.RGBA,g.UNSIGNED_BYTE,h),d.bindFramebuffer.set(null);const b=h[0]+(h[2]>>4<<8),I=h[1]+((15&h[2])<<8),C=this.coordsIndex[255-h[3]],M=C&&this.sourceCache.getTileByID(C);if(!M)return null;const N=this._coordsTextureSize,R=(1<<M.tileID.canonical.z)*N;return new a.U(this._allowMercatorOverflow(s,(M.tileID.canonical.x*N+b)/R),(M.tileID.canonical.y*N+I)/R,this.getElevation(M.tileID,b,I,N))}getTerrainMesh(){if(this._mesh)return this._mesh;const s=this.painter.context,h=new a.bd,d=new a.b0,g=this.meshSize,b=a.N/g,I=g*g;for(let z=0;z<=g;z++)for(let W=0;W<=g;W++)h.emplaceBack(W*b,z*b,0);for(let z=0;z<I;z+=g+1)for(let W=0;W<g;W++)d.emplaceBack(W+z,g+W+z+1,g+W+z+2),d.emplaceBack(W+z,g+W+z+2,W+z+1);const C=h.length,M=C+2*(g+1);for(const z of[0,1])for(let W=0;W<=g;W++)for(const nt of[0,1])h.emplaceBack(W*b,z*a.N,nt);for(let z=0;z<2*g;z+=2)d.emplaceBack(M+z,M+z+1,M+z+3),d.emplaceBack(M+z,M+z+3,M+z+2),d.emplaceBack(C+z,C+z+3,C+z+1),d.emplaceBack(C+z,C+z+2,C+z+3);const N=h.length,R=N+2*(g+1);for(const z of[0,1])for(let W=0;W<=g;W++)for(const nt of[0,1])h.emplaceBack(z*a.N,W*b,nt);for(let z=0;z<2*g;z+=2)d.emplaceBack(N+z,N+z+1,N+z+3),d.emplaceBack(N+z,N+z+3,N+z+2),d.emplaceBack(R+z,R+z+3,R+z+1),d.emplaceBack(R+z,R+z+2,R+z+3);return this._mesh={indexBuffer:s.createIndexBuffer(d),vertexBuffer:s.createVertexBuffer(h,em.members),segments:a.S.simpleSegment(0,0,h.length,d.length)},this._mesh}getMeshFrameDelta(s){return 2*Math.PI*a.be/Math.pow(2,s)/5}getMinTileElevationForLngLatZoom(s,h){var d;const{tileID:g}=this._getOverscaledTileIDFromLngLatZoom(s,h);return(d=this.getMinMaxElevation(g).minElevation)!==null&&d!==void 0?d:0}getMinMaxElevation(s){const h=this.getTerrainData(s).tile,d={minElevation:null,maxElevation:null};return h&&h.dem&&(d.minElevation=h.dem.min*this.exaggeration,d.maxElevation=h.dem.max*this.exaggeration),d}_getOverscaledTileIDFromLngLatZoom(s,h){const d=a.U.fromLngLat(s.wrap()),g=(1<<h)*a.N,b=d.x*g,I=d.y*g,C=Math.floor(b/a.N),M=Math.floor(I/a.N);return{tileID:new a.O(h,0,h,C,M),mercatorX:b,mercatorY:I}}_allowMercatorOverflow(s,h){const d=s.x<this.painter.width/2;let g=a.bf(h);const b=this.painter.transform.center.lng;return d&&Math.sign(g)>0&&Math.sign(b)<0||!d&&Math.sign(g)<0&&Math.sign(b)>0?(g=360*Math.sign(b)+g,a.G(g)):h}}class Jg{constructor(s,h,d){this._context=s,this._size=h,this._tileSize=d,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const s of this._objects)s.texture.destroy(),s.fbo.destroy()}_createObject(s){const h=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),d=new St(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return d.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),h.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),h.colorAttachment.set(d.texture),{id:s,fbo:h,texture:d,stamp:-1,inUse:!1}}getObjectForId(s){return this._objects[s]}useObject(s){s.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(h=>s.id!==h),this._recentlyUsed.push(s.id)}stampObject(s){s.stamp=++this._stamp}getOrCreateFreeObject(){for(const h of this._recentlyUsed)if(!this._objects[h].inUse)return this._objects[h];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const s=this._createObject(this._objects.length);return this._objects.push(s),s}freeObject(s){s.inUse=!1}freeAllObjects(){for(const s of this._objects)this.freeObject(s)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(s=>!s.inUse)===!1}}const so={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class ph{constructor(s,h){this.painter=s,this.terrain=h,this.pool=new Jg(s.context,30,h.sourceCache.tileSize*h.qualityFactor)}destruct(){this.pool.destruct()}getTexture(s){return this.pool.getObjectForId(s.rtt[this._stacks.length-1].id).texture}prepareForRender(s,h){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=s._order.filter(d=>!s._layers[d].isHidden(h)),this._coordsDescendingInv={};for(const d in s.sourceCaches){this._coordsDescendingInv[d]={};const g=s.sourceCaches[d].getVisibleCoordinates();for(const b of g){const I=this.terrain.sourceCache.getTerrainCoords(b);for(const C in I)this._coordsDescendingInv[d][C]||(this._coordsDescendingInv[d][C]=[]),this._coordsDescendingInv[d][C].push(I[C])}}this._coordsDescendingInvStr={};for(const d of s._order){const g=s._layers[d],b=g.source;if(so[g.type]&&!this._coordsDescendingInvStr[b]){this._coordsDescendingInvStr[b]={};for(const I in this._coordsDescendingInv[b])this._coordsDescendingInvStr[b][I]=this._coordsDescendingInv[b][I].map(C=>C.key).sort().join()}}for(const d of this._renderableTiles)for(const g in this._coordsDescendingInvStr){const b=this._coordsDescendingInvStr[g][d.tileID.key];b&&b!==d.rttCoords[g]&&(d.rtt=[])}}renderLayer(s){if(s.isHidden(this.painter.transform.zoom))return!1;const h=s.type,d=this.painter,g=this._renderableLayerIds[this._renderableLayerIds.length-1]===s.id;if(so[h]&&(this._prevType&&so[this._prevType]||this._stacks.push([]),this._prevType=h,this._stacks[this._stacks.length-1].push(s.id),!g))return!0;if(so[this._prevType]||so[h]&&g){this._prevType=h;const b=this._stacks.length-1,I=this._stacks[b]||[];for(const C of this._renderableTiles){if(this.pool.isFull()&&(Ni(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(C),C.rtt[b]){const N=this.pool.getObjectForId(C.rtt[b].id);if(N.stamp===C.rtt[b].stamp){this.pool.useObject(N);continue}}const M=this.pool.getOrCreateFreeObject();this.pool.useObject(M),this.pool.stampObject(M),C.rtt[b]={id:M.id,stamp:M.stamp},d.context.bindFramebuffer.set(M.fbo.framebuffer),d.context.clear({color:a.aT.transparent,stencil:0}),d.currentStencilSource=void 0;for(let N=0;N<I.length;N++){const R=d.style._layers[I[N]],z=R.source?this._coordsDescendingInv[R.source][C.tileID.key]:[C.tileID];d.context.viewport.set([0,0,M.fbo.width,M.fbo.height]),d._renderTileClippingMasks(R,z),d.renderLayer(d,d.style.sourceCaches[R.source],R,z),R.source&&(C.rttCoords[R.source]=this._coordsDescendingInvStr[R.source][C.tileID.key])}}return Ni(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),so[h]}return!1}}const Re=_,Ue={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:void 0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:a.c.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096]},ac=y=>{y.touchstart=y.dragStart,y.touchmoveWindow=y.dragMove,y.touchend=y.dragEnd},Hf={showCompass:!0,showZoom:!0,visualizePitch:!1};class Yf{constructor(s,h,d=!1){this.mousedown=I=>{this.startMouse(a.e({},I,{ctrlKey:!0,preventDefault:()=>I.preventDefault()}),x.mousePos(this.element,I)),x.addEventListener(window,"mousemove",this.mousemove),x.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=I=>{this.moveMouse(I,x.mousePos(this.element,I))},this.mouseup=I=>{this.mouseRotate.dragEnd(I),this.mousePitch&&this.mousePitch.dragEnd(I),this.offTemp()},this.touchstart=I=>{I.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=x.touchPos(this.element,I.targetTouches)[0],this.startTouch(I,this._startPos),x.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),x.addEventListener(window,"touchend",this.touchend))},this.touchmove=I=>{I.targetTouches.length!==1?this.reset():(this._lastPos=x.touchPos(this.element,I.targetTouches)[0],this.moveTouch(I,this._lastPos))},this.touchend=I=>{I.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const g=s.dragRotate._mouseRotate.getClickTolerance(),b=s.dragRotate._mousePitch.getClickTolerance();this.element=h,this.mouseRotate=du({clickTolerance:g,enable:!0}),this.touchRotate=(({enable:I,clickTolerance:C,bearingDegreesPerPixelMoved:M=.8})=>{const N=new Hd;return new La({clickTolerance:C,move:(R,z)=>({bearingDelta:(z.x-R.x)*M}),moveStateManager:N,enable:I,assignEvents:ac})})({clickTolerance:g,enable:!0}),this.map=s,d&&(this.mousePitch=Ma({clickTolerance:b,enable:!0}),this.touchPitch=(({enable:I,clickTolerance:C,pitchDegreesPerPixelMoved:M=-.5})=>{const N=new Hd;return new La({clickTolerance:C,move:(R,z)=>({pitchDelta:(z.y-R.y)*M}),moveStateManager:N,enable:I,assignEvents:ac})})({clickTolerance:b,enable:!0})),x.addEventListener(h,"mousedown",this.mousedown),x.addEventListener(h,"touchstart",this.touchstart,{passive:!1}),x.addEventListener(h,"touchcancel",this.reset)}startMouse(s,h){this.mouseRotate.dragStart(s,h),this.mousePitch&&this.mousePitch.dragStart(s,h),x.disableDrag()}startTouch(s,h){this.touchRotate.dragStart(s,h),this.touchPitch&&this.touchPitch.dragStart(s,h),x.disableDrag()}moveMouse(s,h){const d=this.map,{bearingDelta:g}=this.mouseRotate.dragMove(s,h)||{};if(g&&d.setBearing(d.getBearing()+g),this.mousePitch){const{pitchDelta:b}=this.mousePitch.dragMove(s,h)||{};b&&d.setPitch(d.getPitch()+b)}}moveTouch(s,h){const d=this.map,{bearingDelta:g}=this.touchRotate.dragMove(s,h)||{};if(g&&d.setBearing(d.getBearing()+g),this.touchPitch){const{pitchDelta:b}=this.touchPitch.dragMove(s,h)||{};b&&d.setPitch(d.getPitch()+b)}}off(){const s=this.element;x.removeEventListener(s,"mousedown",this.mousedown),x.removeEventListener(s,"touchstart",this.touchstart,{passive:!1}),x.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),x.removeEventListener(window,"touchend",this.touchend),x.removeEventListener(s,"touchcancel",this.reset),this.offTemp()}offTemp(){x.enableDrag(),x.removeEventListener(window,"mousemove",this.mousemove),x.removeEventListener(window,"mouseup",this.mouseup),x.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),x.removeEventListener(window,"touchend",this.touchend)}}let Xi;function Kf(y,s,h){if(y=new a.L(y.lng,y.lat),s){const d=new a.L(y.lng-360,y.lat),g=new a.L(y.lng+360,y.lat),b=h.locationPoint(y).distSqr(s);h.locationPoint(d).distSqr(s)<b?y=d:h.locationPoint(g).distSqr(s)<b&&(y=g)}for(;Math.abs(y.lng-h.center.lng)>180;){const d=h.locationPoint(y);if(d.x>=0&&d.y>=0&&d.x<=h.width&&d.y<=h.height)break;y.lng>h.center.lng?y.lng-=360:y.lng+=360}return y}const us={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function rm(y,s,h){const d=y.classList;for(const g in us)d.remove(`maplibregl-${h}-anchor-${g}`);d.add(`maplibregl-${h}-anchor-${s}`)}class Ml extends a.E{constructor(s){if(super(),this._onKeyPress=h=>{const d=h.code,g=h.charCode||h.keyCode;d!=="Space"&&d!=="Enter"&&g!==32&&g!==13||this.togglePopup()},this._onMapClick=h=>{const d=h.originalEvent.target,g=this._element;this._popup&&(d===g||g.contains(d))&&this.togglePopup()},this._update=h=>{if(!this._map)return;const d=this._map.loaded()&&!this._map.isMoving();((h==null?void 0:h.type)==="terrain"||(h==null?void 0:h.type)==="render"&&!d)&&this._map.once("render",this._update),this._map.transform.renderWorldCopies&&(this._lngLat=Kf(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let g="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?g=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(g=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let b="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?b="rotateX(0deg)":this._pitchAlignment==="map"&&(b=`rotateX(${this._map.getPitch()}deg)`),h&&h.type!=="moveend"||(this._pos=this._pos.round()),x.setTransform(this._element,`${us[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${b} ${g}`),this._map.terrain&&!this._opacityTimeout&&(this._opacityTimeout=setTimeout(()=>{const I=this._map.unproject(this._pos),C=40075016686e-3*Math.abs(Math.cos(this._lngLat.lat*Math.PI/180))/Math.pow(2,this._map.transform.tileZoom+8);this._element.style.opacity=I.distanceTo(this._lngLat)>20*C?"0.2":"1.0",this._opacityTimeout=null},100))},this._onMove=h=>{if(!this._isDragging){const d=this._clickTolerance||this._map._clickTolerance;this._isDragging=h.point.dist(this._pointerdownPos)>=d}this._isDragging&&(this._pos=h.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new a.k("dragstart"))),this.fire(new a.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new a.k("dragend")),this._state="inactive"},this._addDragHandler=h=>{this._element.contains(h.originalEvent.target)&&(h.preventDefault(),this._positionDelta=h.point.sub(this._pos).add(this._offset),this._pointerdownPos=h.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=s&&s.anchor||"center",this._color=s&&s.color||"#3FB1CE",this._scale=s&&s.scale||1,this._draggable=s&&s.draggable||!1,this._clickTolerance=s&&s.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=s&&s.rotation||0,this._rotationAlignment=s&&s.rotationAlignment||"auto",this._pitchAlignment=s&&s.pitchAlignment&&s.pitchAlignment!=="auto"?s.pitchAlignment:this._rotationAlignment,s&&s.element)this._element=s.element,this._offset=a.P.convert(s&&s.offset||[0,0]);else{this._defaultMarker=!0,this._element=x.create("div"),this._element.setAttribute("aria-label","Map marker");const h=x.createNS("http://www.w3.org/2000/svg","svg"),d=41,g=27;h.setAttributeNS(null,"display","block"),h.setAttributeNS(null,"height",`${d}px`),h.setAttributeNS(null,"width",`${g}px`),h.setAttributeNS(null,"viewBox",`0 0 ${g} ${d}`);const b=x.createNS("http://www.w3.org/2000/svg","g");b.setAttributeNS(null,"stroke","none"),b.setAttributeNS(null,"stroke-width","1"),b.setAttributeNS(null,"fill","none"),b.setAttributeNS(null,"fill-rule","evenodd");const I=x.createNS("http://www.w3.org/2000/svg","g");I.setAttributeNS(null,"fill-rule","nonzero");const C=x.createNS("http://www.w3.org/2000/svg","g");C.setAttributeNS(null,"transform","translate(3.0, 29.0)"),C.setAttributeNS(null,"fill","#000000");const M=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const Lt of M){const Ot=x.createNS("http://www.w3.org/2000/svg","ellipse");Ot.setAttributeNS(null,"opacity","0.04"),Ot.setAttributeNS(null,"cx","10.5"),Ot.setAttributeNS(null,"cy","5.80029008"),Ot.setAttributeNS(null,"rx",Lt.rx),Ot.setAttributeNS(null,"ry",Lt.ry),C.appendChild(Ot)}const N=x.createNS("http://www.w3.org/2000/svg","g");N.setAttributeNS(null,"fill",this._color);const R=x.createNS("http://www.w3.org/2000/svg","path");R.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),N.appendChild(R);const z=x.createNS("http://www.w3.org/2000/svg","g");z.setAttributeNS(null,"opacity","0.25"),z.setAttributeNS(null,"fill","#000000");const W=x.createNS("http://www.w3.org/2000/svg","path");W.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),z.appendChild(W);const nt=x.createNS("http://www.w3.org/2000/svg","g");nt.setAttributeNS(null,"transform","translate(6.0, 7.0)"),nt.setAttributeNS(null,"fill","#FFFFFF");const et=x.createNS("http://www.w3.org/2000/svg","g");et.setAttributeNS(null,"transform","translate(8.0, 8.0)");const at=x.createNS("http://www.w3.org/2000/svg","circle");at.setAttributeNS(null,"fill","#000000"),at.setAttributeNS(null,"opacity","0.25"),at.setAttributeNS(null,"cx","5.5"),at.setAttributeNS(null,"cy","5.5"),at.setAttributeNS(null,"r","5.4999962");const Q=x.createNS("http://www.w3.org/2000/svg","circle");Q.setAttributeNS(null,"fill","#FFFFFF"),Q.setAttributeNS(null,"cx","5.5"),Q.setAttributeNS(null,"cy","5.5"),Q.setAttributeNS(null,"r","5.4999962"),et.appendChild(at),et.appendChild(Q),I.appendChild(C),I.appendChild(N),I.appendChild(z),I.appendChild(nt),I.appendChild(et),h.appendChild(I),h.setAttributeNS(null,"height",d*this._scale+"px"),h.setAttributeNS(null,"width",g*this._scale+"px"),this._element.appendChild(h),this._offset=a.P.convert(s&&s.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",h=>{h.preventDefault()}),this._element.addEventListener("mousedown",h=>{h.preventDefault()}),rm(this._element,this._anchor,"marker"),s&&s.className)for(const h of s.className.split(" "))this._element.classList.add(h);this._popup=null}addTo(s){return this.remove(),this._map=s,s.getCanvasContainer().appendChild(this._element),s.on("move",this._update),s.on("moveend",this._update),s.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),x.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(s){return this._lngLat=a.L.convert(s),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(s){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),s){if(!("offset"in s.options)){const g=Math.abs(13.5)/Math.SQRT2;s.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[g,-1*(38.1-13.5+g)],"bottom-right":[-g,-1*(38.1-13.5+g)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=s,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){const s=this._popup;return s?(s.isOpen()?s.remove():s.addTo(this._map),this):this}getOffset(){return this._offset}setOffset(s){return this._offset=a.P.convert(s),this._update(),this}addClassName(s){this._element.classList.add(s)}removeClassName(s){this._element.classList.remove(s)}toggleClassName(s){return this._element.classList.toggle(s)}setDraggable(s){return this._draggable=!!s,this._map&&(s?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(s){return this._rotation=s||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(s){return this._rotationAlignment=s||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(s){return this._pitchAlignment=s&&s!=="auto"?s:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}const Di={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Ti=0,gu=!1;const lc={maxWidth:100,unit:"metric"};function uc(y,s,h){const d=h&&h.maxWidth||100,g=y._container.clientHeight/2,b=y.unproject([0,g]),I=y.unproject([d,g]),C=b.distanceTo(I);if(h&&h.unit==="imperial"){const M=3.2808*C;M>5280?Pl(s,d,M/5280,y._getUIString("ScaleControl.Miles")):Pl(s,d,M,y._getUIString("ScaleControl.Feet"))}else h&&h.unit==="nautical"?Pl(s,d,C/1852,y._getUIString("ScaleControl.NauticalMiles")):C>=1e3?Pl(s,d,C/1e3,y._getUIString("ScaleControl.Kilometers")):Pl(s,d,C,y._getUIString("ScaleControl.Meters"))}function Pl(y,s,h,d){const g=function(b){const I=Math.pow(10,`${Math.floor(b)}`.length-1);let C=b/I;return C=C>=10?10:C>=5?5:C>=3?3:C>=2?2:C>=1?1:function(M){const N=Math.pow(10,Math.ceil(-Math.log(M)/Math.LN10));return Math.round(M*N)/N}(C),I*C}(h);y.style.width=s*(g/h)+"px",y.innerHTML=`${g}&nbsp;${d}`}const Jf={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Qf=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function _u(y){if(y){if(typeof y=="number"){const s=Math.round(Math.abs(y)/Math.SQRT2);return{center:new a.P(0,0),top:new a.P(0,y),"top-left":new a.P(s,s),"top-right":new a.P(-s,s),bottom:new a.P(0,-y),"bottom-left":new a.P(s,-s),"bottom-right":new a.P(-s,-s),left:new a.P(y,0),right:new a.P(-y,0)}}if(y instanceof a.P||Array.isArray(y)){const s=a.P.convert(y);return{center:s,top:s,"top-left":s,"top-right":s,bottom:s,"bottom-left":s,"bottom-right":s,left:s,right:s}}return{center:a.P.convert(y.center||[0,0]),top:a.P.convert(y.top||[0,0]),"top-left":a.P.convert(y["top-left"]||[0,0]),"top-right":a.P.convert(y["top-right"]||[0,0]),bottom:a.P.convert(y.bottom||[0,0]),"bottom-left":a.P.convert(y["bottom-left"]||[0,0]),"bottom-right":a.P.convert(y["bottom-right"]||[0,0]),left:a.P.convert(y.left||[0,0]),right:a.P.convert(y.right||[0,0])}}return _u(new a.P(0,0))}const tp={extend:(y,...s)=>a.e(y,...s),run(y){y()},logToElement(y,s=!1,h="log"){const d=window.document.getElementById(h);d&&(s&&(d.innerHTML=""),d.innerHTML+=`<br>${y}`)}},ep=_;class Vn{static get version(){return ep}static get workerCount(){return es.workerCount}static set workerCount(s){es.workerCount=s}static get maxParallelImageRequests(){return a.c.MAX_PARALLEL_IMAGE_REQUESTS}static set maxParallelImageRequests(s){a.c.MAX_PARALLEL_IMAGE_REQUESTS=s}static get workerUrl(){return a.c.WORKER_URL}static set workerUrl(s){a.c.WORKER_URL=s}static addProtocol(s,h){a.c.REGISTERED_PROTOCOLS[s]=h}static removeProtocol(s){delete a.c.REGISTERED_PROTOCOLS[s]}}return Vn.Map=class extends tm{constructor(y){if(a.bg.mark(a.bh.create),(y=a.e({},Ue,y)).minZoom!=null&&y.maxZoom!=null&&y.minZoom>y.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(y.minPitch!=null&&y.maxPitch!=null&&y.minPitch>y.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(y.minPitch!=null&&y.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(y.maxPitch!=null&&y.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new lh(y.minZoom,y.maxZoom,y.minPitch,y.maxPitch,y.renderWorldCopies),{bearingSnap:y.bearingSnap}),this._cooperativeGesturesOnWheel=s=>{this._onCooperativeGesture(s,s[this._metaKey],1)},this._contextLost=s=>{s.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new a.k("webglcontextlost",{originalEvent:s}))},this._contextRestored=s=>{this._setupPainter(),this.resize(),this._update(),this.fire(new a.k("webglcontextrestored",{originalEvent:s}))},this._onMapScroll=s=>{if(s.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=y.interactive,this._cooperativeGestures=y.cooperativeGestures,this._metaKey=navigator.platform.indexOf("Mac")===0?"metaKey":"ctrlKey",this._maxTileCacheSize=y.maxTileCacheSize,this._maxTileCacheZoomLevels=y.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=y.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=y.preserveDrawingBuffer,this._antialias=y.antialias,this._trackResize=y.trackResize,this._bearingSnap=y.bearingSnap,this._refreshExpiredTiles=y.refreshExpiredTiles,this._fadeDuration=y.fadeDuration,this._crossSourceCollisions=y.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=y.collectResourceTiming,this._renderTaskQueue=new fh,this._controls=[],this._mapId=a.a2(),this._locale=a.e({},Xf,y.locale),this._clickTolerance=y.clickTolerance,this._overridePixelRatio=y.pixelRatio,this._maxCanvasSize=y.maxCanvasSize,this.transformCameraUpdate=y.transformCameraUpdate,this._imageQueueHandle=U.addThrottleControl(()=>this.isMoving()),this._requestManager=new V(y.transformRequest),typeof y.container=="string"){if(this._container=document.getElementById(y.container),!this._container)throw new Error(`Container '${y.container}' not found.`)}else{if(!(y.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=y.container}if(y.maxBounds&&this.setMaxBounds(y.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let s=!1;const h=Ll(d=>{this._trackResize&&!this._removed&&this.resize(d)._update()},50);this._resizeObserver=new ResizeObserver(d=>{s?h(d):s=!0}),this._resizeObserver.observe(this._container)}this.handlers=new Wf(this,y),this._cooperativeGestures&&this._setupCooperativeGestures(),this._hash=y.hash&&new nc(typeof y.hash=="string"&&y.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:y.center,zoom:y.zoom,bearing:y.bearing,pitch:y.pitch}),y.bounds&&(this.resize(),this.fitBounds(y.bounds,a.e({},y.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=y.localIdeographFontFamily,this._validateStyle=y.validateStyle,y.style&&this.setStyle(y.style,{localIdeographFontFamily:y.localIdeographFontFamily}),y.attributionControl&&this.addControl(new Fo({customAttribution:y.customAttribution})),y.maplibreLogo&&this.addControl(new pi,y.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",s=>{this._update(s.dataType==="style"),this.fire(new a.k(`${s.dataType}data`,s))}),this.on("dataloading",s=>{this.fire(new a.k(`${s.dataType}dataloading`,s))}),this.on("dataabort",s=>{this.fire(new a.k("sourcedataabort",s))})}_getMapId(){return this._mapId}addControl(y,s){if(s===void 0&&(s=y.getDefaultPosition?y.getDefaultPosition():"top-right"),!y||!y.onAdd)return this.fire(new a.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const h=y.onAdd(this);this._controls.push(y);const d=this._controlPositions[s];return s.indexOf("bottom")!==-1?d.insertBefore(h,d.firstChild):d.appendChild(h),this}removeControl(y){if(!y||!y.onRemove)return this.fire(new a.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const s=this._controls.indexOf(y);return s>-1&&this._controls.splice(s,1),y.onRemove(this),this}hasControl(y){return this._controls.indexOf(y)>-1}calculateCameraOptionsFromTo(y,s,h,d){return d==null&&this.terrain&&(d=this.terrain.getElevationForLngLatZoom(h,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(y,s,h,d)}resize(y){var s;const h=this._containerDimensions(),d=h[0],g=h[1],b=this._getClampedPixelRatio(d,g);if(this._resizeCanvas(d,g,b),this.painter.resize(d,g,b),this.painter.overLimit()){const C=this.painter.context.gl;this._maxCanvasSize=[C.drawingBufferWidth,C.drawingBufferHeight];const M=this._getClampedPixelRatio(d,g);this._resizeCanvas(d,g,M),this.painter.resize(d,g,M)}this.transform.resize(d,g),(s=this._requestedCameraState)===null||s===void 0||s.resize(d,g);const I=!this._moving;return I&&(this.stop(),this.fire(new a.k("movestart",y)).fire(new a.k("move",y))),this.fire(new a.k("resize",y)),I&&this.fire(new a.k("moveend",y)),this}_getClampedPixelRatio(y,s){const{0:h,1:d}=this._maxCanvasSize,g=this.getPixelRatio(),b=y*g,I=s*g;return Math.min(b>h?h/b:1,I>d?d/I:1)*g}getPixelRatio(){var y;return(y=this._overridePixelRatio)!==null&&y!==void 0?y:devicePixelRatio}setPixelRatio(y){this._overridePixelRatio=y,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(y){return this.transform.setMaxBounds(ke.convert(y)),this._update()}setMinZoom(y){if((y=y??-2)>=-2&&y<=this.transform.maxZoom)return this.transform.minZoom=y,this._update(),this.getZoom()<y&&this.setZoom(y),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(y){if((y=y??22)>=this.transform.minZoom)return this.transform.maxZoom=y,this._update(),this.getZoom()>y&&this.setZoom(y),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(y){if((y=y??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(y>=0&&y<=this.transform.maxPitch)return this.transform.minPitch=y,this._update(),this.getPitch()<y&&this.setPitch(y),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(y){if((y=y??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(y>=this.transform.minPitch)return this.transform.maxPitch=y,this._update(),this.getPitch()>y&&this.setPitch(y),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(y){return this.transform.renderWorldCopies=y,this._update()}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(y){return this._cooperativeGestures=y,this._cooperativeGestures?this._setupCooperativeGestures():this._destroyCooperativeGestures(),this}project(y){return this.transform.locationPoint(a.L.convert(y),this.style&&this.terrain)}unproject(y){return this.transform.pointLocation(a.P.convert(y),this.terrain)}isMoving(){var y;return this._moving||((y=this.handlers)===null||y===void 0?void 0:y.isMoving())}isZooming(){var y;return this._zooming||((y=this.handlers)===null||y===void 0?void 0:y.isZooming())}isRotating(){var y;return this._rotating||((y=this.handlers)===null||y===void 0?void 0:y.isRotating())}_createDelegatedListener(y,s,h){if(y==="mouseenter"||y==="mouseover"){let d=!1;return{layer:s,listener:h,delegates:{mousemove:b=>{const I=this.getLayer(s)?this.queryRenderedFeatures(b.point,{layers:[s]}):[];I.length?d||(d=!0,h.call(this,new zo(y,this,b.originalEvent,{features:I}))):d=!1},mouseout:()=>{d=!1}}}}if(y==="mouseleave"||y==="mouseout"){let d=!1;return{layer:s,listener:h,delegates:{mousemove:I=>{(this.getLayer(s)?this.queryRenderedFeatures(I.point,{layers:[s]}):[]).length?d=!0:d&&(d=!1,h.call(this,new zo(y,this,I.originalEvent)))},mouseout:I=>{d&&(d=!1,h.call(this,new zo(y,this,I.originalEvent)))}}}}{const d=g=>{const b=this.getLayer(s)?this.queryRenderedFeatures(g.point,{layers:[s]}):[];b.length&&(g.features=b,h.call(this,g),delete g.features)};return{layer:s,listener:h,delegates:{[y]:d}}}}on(y,s,h){if(h===void 0)return super.on(y,s);const d=this._createDelegatedListener(y,s,h);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[y]=this._delegatedListeners[y]||[],this._delegatedListeners[y].push(d);for(const g in d.delegates)this.on(g,d.delegates[g]);return this}once(y,s,h){if(h===void 0)return super.once(y,s);const d=this._createDelegatedListener(y,s,h);for(const g in d.delegates)this.once(g,d.delegates[g]);return this}off(y,s,h){return h===void 0?super.off(y,s):(this._delegatedListeners&&this._delegatedListeners[y]&&(d=>{const g=this._delegatedListeners[y];for(let b=0;b<g.length;b++){const I=g[b];if(I.layer===s&&I.listener===h){for(const C in I.delegates)this.off(C,I.delegates[C]);return g.splice(b,1),this}}})(),this)}queryRenderedFeatures(y,s){if(!this.style)return[];let h;const d=y instanceof a.P||Array.isArray(y),g=d?y:[[0,0],[this.transform.width,this.transform.height]];if(s=s||(d?{}:y)||{},g instanceof a.P||typeof g[0]=="number")h=[a.P.convert(g)];else{const b=a.P.convert(g[0]),I=a.P.convert(g[1]);h=[b,new a.P(I.x,b.y),I,new a.P(b.x,I.y),b]}return this.style.queryRenderedFeatures(h,s,this.transform)}querySourceFeatures(y,s){return this.style.querySourceFeatures(y,s)}setStyle(y,s){return(s=a.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},s)).diff!==!1&&s.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&y?(this._diffStyle(y,s),this):(this._localIdeographFontFamily=s.localIdeographFontFamily,this._updateStyle(y,s))}setTransformRequest(y){return this._requestManager.setTransformRequest(y),this}_getUIString(y){const s=this._locale[y];if(s==null)throw new Error(`Missing UI string '${y}'`);return s}_updateStyle(y,s){if(s.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(y,s));const h=this.style&&s.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!y)),y?(this.style=new Dr(this,s||{}),this.style.setEventedParent(this,{style:this.style}),typeof y=="string"?this.style.loadURL(y,s,h):this.style.loadJSON(y,s,h),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Dr(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(y,s){if(typeof y=="string"){const h=this._requestManager.transformRequest(y,Y.Style);a.f(h,(d,g)=>{d?this.fire(new a.j(d)):g&&this._updateDiff(g,s)})}else typeof y=="object"&&this._updateDiff(y,s)}_updateDiff(y,s){try{this.style.setState(y,s)&&this._update(!0)}catch(h){a.w(`Unable to perform style diff: ${h.message||h.error||h}.  Rebuilding the style from scratch.`),this._updateStyle(y,s)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():a.w("There is no style added to the map.")}addSource(y,s){return this._lazyInitEmptyStyle(),this.style.addSource(y,s),this._update(!0)}isSourceLoaded(y){const s=this.style&&this.style.sourceCaches[y];if(s!==void 0)return s.loaded();this.fire(new a.j(new Error(`There is no source with ID '${y}'`)))}setTerrain(y){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),y){const s=this.style.sourceCaches[y.source];if(!s)throw new Error(`cannot load terrain, because there exists no source with ID: ${y.source}`);for(const h in this.style._layers){const d=this.style._layers[h];d.type==="hillshade"&&d.source===y.source&&a.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new im(this.painter,s,y),this.painter.renderToTexture=new ph(this.painter,this.terrain),this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=h=>{h.dataType==="style"?this.terrain.sourceCache.freeRtt():h.dataType==="source"&&h.tile&&(h.sourceId!==y.source||this._elevationFreeze||(this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(h.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform._minEleveationForCurrentTile=0,this.transform.elevation=0;return this.fire(new a.k("terrain",{terrain:y})),this}getTerrain(){var y,s;return(s=(y=this.terrain)===null||y===void 0?void 0:y.options)!==null&&s!==void 0?s:null}areTilesLoaded(){const y=this.style&&this.style.sourceCaches;for(const s in y){const h=y[s]._tiles;for(const d in h){const g=h[d];if(g.state!=="loaded"&&g.state!=="errored")return!1}}return!0}addSourceType(y,s,h){return this._lazyInitEmptyStyle(),this.style.addSourceType(y,s,h)}removeSource(y){return this.style.removeSource(y),this._update(!0)}getSource(y){return this.style.getSource(y)}addImage(y,s,h={}){const{pixelRatio:d=1,sdf:g=!1,stretchX:b,stretchY:I,content:C}=h;if(this._lazyInitEmptyStyle(),!(s instanceof HTMLImageElement||a.a(s))){if(s.width===void 0||s.height===void 0)return this.fire(new a.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:M,height:N,data:R}=s,z=s;return this.style.addImage(y,{data:new a.R({width:M,height:N},new Uint8Array(R)),pixelRatio:d,stretchX:b,stretchY:I,content:C,sdf:g,version:0,userImage:z}),z.onAdd&&z.onAdd(this,y),this}}{const{width:M,height:N,data:R}=a.h.getImageData(s);this.style.addImage(y,{data:new a.R({width:M,height:N},R),pixelRatio:d,stretchX:b,stretchY:I,content:C,sdf:g,version:0})}}updateImage(y,s){const h=this.style.getImage(y);if(!h)return this.fire(new a.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const d=s instanceof HTMLImageElement||a.a(s)?a.h.getImageData(s):s,{width:g,height:b,data:I}=d;if(g===void 0||b===void 0)return this.fire(new a.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(g!==h.data.width||b!==h.data.height)return this.fire(new a.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const C=!(s instanceof HTMLImageElement||a.a(s));return h.data.replace(I,C),this.style.updateImage(y,h),this}getImage(y){return this.style.getImage(y)}hasImage(y){return y?!!this.style.getImage(y):(this.fire(new a.j(new Error("Missing required image id"))),!1)}removeImage(y){this.style.removeImage(y)}loadImage(y,s){U.getImage(this._requestManager.transformRequest(y,Y.Image),s)}listImages(){return this.style.listImages()}addLayer(y,s){return this._lazyInitEmptyStyle(),this.style.addLayer(y,s),this._update(!0)}moveLayer(y,s){return this.style.moveLayer(y,s),this._update(!0)}removeLayer(y){return this.style.removeLayer(y),this._update(!0)}getLayer(y){return this.style.getLayer(y)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(y,s,h){return this.style.setLayerZoomRange(y,s,h),this._update(!0)}setFilter(y,s,h={}){return this.style.setFilter(y,s,h),this._update(!0)}getFilter(y){return this.style.getFilter(y)}setPaintProperty(y,s,h,d={}){return this.style.setPaintProperty(y,s,h,d),this._update(!0)}getPaintProperty(y,s){return this.style.getPaintProperty(y,s)}setLayoutProperty(y,s,h,d={}){return this.style.setLayoutProperty(y,s,h,d),this._update(!0)}getLayoutProperty(y,s){return this.style.getLayoutProperty(y,s)}setGlyphs(y,s={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(y,s),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(y,s,h={}){return this._lazyInitEmptyStyle(),this.style.addSprite(y,s,h,d=>{d||this._update(!0)}),this}removeSprite(y){return this._lazyInitEmptyStyle(),this.style.removeSprite(y),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(y,s={}){return this._lazyInitEmptyStyle(),this.style.setSprite(y,s,h=>{h||this._update(!0)}),this}setLight(y,s={}){return this._lazyInitEmptyStyle(),this.style.setLight(y,s),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(y,s){return this.style.setFeatureState(y,s),this._update()}removeFeatureState(y,s){return this.style.removeFeatureState(y,s),this._update()}getFeatureState(y){return this.style.getFeatureState(y)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let y=0,s=0;return this._container&&(y=this._container.clientWidth||400,s=this._container.clientHeight||300),[y,s]}_setupContainer(){const y=this._container;y.classList.add("maplibregl-map");const s=this._canvasContainer=x.create("div","maplibregl-canvas-container",y);this._interactive&&s.classList.add("maplibregl-interactive"),this._canvas=x.create("canvas","maplibregl-canvas",s),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const h=this._containerDimensions(),d=this._getClampedPixelRatio(h[0],h[1]);this._resizeCanvas(h[0],h[1],d);const g=this._controlContainer=x.create("div","maplibregl-control-container",y),b=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(I=>{b[I]=x.create("div",`maplibregl-ctrl-${I} `,g)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_setupCooperativeGestures(){this._cooperativeGesturesScreen=x.create("div","maplibregl-cooperative-gesture-screen",this._container);let y=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.windowsHelpText?this._cooperativeGestures.windowsHelpText:"Use Ctrl + scroll to zoom the map";navigator.platform.indexOf("Mac")===0&&(y=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.macHelpText?this._cooperativeGestures.macHelpText:"Use  + scroll to zoom the map"),this._cooperativeGesturesScreen.innerHTML=`
            <div class="maplibregl-desktop-message">${y}</div>
            <div class="maplibregl-mobile-message">${typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.mobileHelpText?this._cooperativeGestures.mobileHelpText:"Use two fingers to move the map"}</div>
        `,this._cooperativeGesturesScreen.setAttribute("aria-hidden","true"),this._canvasContainer.addEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.add("maplibregl-cooperative-gestures")}_destroyCooperativeGestures(){x.remove(this._cooperativeGesturesScreen),this._canvasContainer.removeEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.remove("maplibregl-cooperative-gestures")}_resizeCanvas(y,s,h){this._canvas.width=Math.floor(h*y),this._canvas.height=Math.floor(h*s),this._canvas.style.width=`${y}px`,this._canvas.style.height=`${s}px`}_setupPainter(){const y={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let s=null;this._canvas.addEventListener("webglcontextcreationerror",d=>{s={requestedAttributes:y},d&&(s.statusMessage=d.statusMessage,s.type=d.type)},{once:!0});const h=this._canvas.getContext("webgl2",y)||this._canvas.getContext("webgl",y);if(!h){const d="Failed to initialize WebGL";throw s?(s.message=d,new Error(JSON.stringify(s))):new Error(d)}this.painter=new Tl(h,this.transform),S.testSupport(h)}_onCooperativeGesture(y,s,h){return!s&&h<2&&(this._cooperativeGesturesScreen.classList.add("maplibregl-show"),setTimeout(()=>{this._cooperativeGesturesScreen.classList.remove("maplibregl-show")},100)),!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(y){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||y,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(y){return this._update(),this._renderTaskQueue.add(y)}_cancelRenderFrame(y){this._renderTaskQueue.remove(y)}_render(y){const s=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(y),this._removed)return;let h=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const g=this.transform.zoom,b=a.h.now();this.style.zoomHistory.update(g,b);const I=new a.a8(g,{now:b,fadeDuration:s,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),C=I.crossFadingFactor();C===1&&C===this._crossFadingFactor||(h=!0,this._crossFadingFactor=C),this.style.update(I)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform._minEleveationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,s,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:s,showPadding:this.showPadding}),this.fire(new a.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,a.bg.mark(a.bh.load),this.fire(new a.k("load"))),this.style&&(this.style.hasTransitions()||h)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const d=this._sourcesDirty||this._styleDirty||this._placementDirty;return d||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new a.k("idle")),!this._loaded||this._fullyLoaded||d||(this._fullyLoaded=!0,a.bg.mark(a.bh.fullLoad)),this}redraw(){return this.style&&(this._frame&&(this._frame.cancel(),this._frame=null),this._render(0)),this}remove(){var y;this._hash&&this._hash.remove();for(const h of this._controls)h.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),U.removeThrottleControl(this._imageQueueHandle),(y=this._resizeObserver)===null||y===void 0||y.disconnect();const s=this.painter.context.gl.getExtension("WEBGL_lose_context");s&&s.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),x.remove(this._canvasContainer),x.remove(this._controlContainer),this._cooperativeGestures&&this._destroyCooperativeGestures(),this._container.classList.remove("maplibregl-map"),a.bg.clearMetrics(),this._removed=!0,this.fire(new a.k("remove"))}triggerRepaint(){this.style&&!this._frame&&(this._frame=a.h.frame(y=>{a.bg.frame(y),this._frame=null,this._render(y)}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(y){this._showTileBoundaries!==y&&(this._showTileBoundaries=y,this._update())}get showPadding(){return!!this._showPadding}set showPadding(y){this._showPadding!==y&&(this._showPadding=y,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(y){this._showCollisionBoxes!==y&&(this._showCollisionBoxes=y,y?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(y){this._showOverdrawInspector!==y&&(this._showOverdrawInspector=y,this._update())}get repaint(){return!!this._repaint}set repaint(y){this._repaint!==y&&(this._repaint=y,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(y){this._vertices=y,this._update()}get version(){return Re}getCameraTargetElevation(){return this.transform.elevation}},Vn.NavigationControl=class{constructor(y){this._updateZoomButtons=()=>{const s=this._map.getZoom(),h=s===this._map.getMaxZoom(),d=s===this._map.getMinZoom();this._zoomInButton.disabled=h,this._zoomOutButton.disabled=d,this._zoomInButton.setAttribute("aria-disabled",h.toString()),this._zoomOutButton.setAttribute("aria-disabled",d.toString())},this._rotateCompassArrow=()=>{const s=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=s},this._setButtonTitle=(s,h)=>{const d=this._map._getUIString(`NavigationControl.${h}`);s.title=d,s.setAttribute("aria-label",d)},this.options=a.e({},Hf,y),this._container=x.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",s=>s.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",s=>this._map.zoomIn({},{originalEvent:s})),x.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",s=>this._map.zoomOut({},{originalEvent:s})),x.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",s=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:s}):this._map.resetNorth({},{originalEvent:s})}),this._compassIcon=x.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(y){return this._map=y,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Yf(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){x.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(y,s){const h=x.create("button",y,this._container);return h.type="button",h.addEventListener("click",s),h}},Vn.GeolocateControl=class extends a.E{constructor(y){super(),this._onSuccess=s=>{if(this._map){if(this._isOutOfMapMaxBounds(s))return this._setErrorState(),this.fire(new a.k("outofmaxbounds",s)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=s,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(s),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(s),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new a.k("geolocate",s)),this._finish()}},this._updateCamera=s=>{const h=new a.L(s.coords.longitude,s.coords.latitude),d=s.coords.accuracy,g=this._map.getBearing(),b=a.e({bearing:g},this.options.fitBoundsOptions),I=ke.fromLngLat(h,d);this._map.fitBounds(I,b,{geolocateSource:!0})},this._updateMarker=s=>{if(s){const h=new a.L(s.coords.longitude,s.coords.latitude);this._accuracyCircleMarker.setLngLat(h).addTo(this._map),this._userLocationDotMarker.setLngLat(h).addTo(this._map),this._accuracy=s.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=s=>{if(this._map){if(this.options.trackUserLocation)if(s.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const h=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(s.code===3&&gu)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new a.k("error",s)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=s=>{if(this._map){if(this._container.addEventListener("contextmenu",h=>h.preventDefault()),this._geolocateButton=x.create("button","maplibregl-ctrl-geolocate",this._container),x.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",s===!1){a.w("Geolocation support is not available so the GeolocateControl will be disabled.");const h=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h)}else{const h=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=x.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Ml({element:this._dotElement}),this._circleElement=x.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Ml({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",h=>{h.geolocateSource||this._watchState!=="ACTIVE_LOCK"||h.originalEvent&&h.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new a.k("trackuserlocationend")))})}},this.options=a.e({},Di,y)}onAdd(y){return this._map=y,this._container=x.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(s,h=!1){Xi===void 0||h?window.navigator.permissions!==void 0?window.navigator.permissions.query({name:"geolocation"}).then(d=>{Xi=d.state!=="denied",s(Xi)}).catch(()=>{Xi=!!window.navigator.geolocation,s(Xi)}):(Xi=!!window.navigator.geolocation,s(Xi)):s(Xi)}(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),x.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Ti=0,gu=!1}_isOutOfMapMaxBounds(y){const s=this._map.getMaxBounds(),h=y.coords;return s&&(h.longitude<s.getWest()||h.longitude>s.getEast()||h.latitude<s.getSouth()||h.latitude>s.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const y=this._map.getBounds(),s=y.getSouthEast(),h=y.getNorthEast(),d=s.distanceTo(h),g=Math.ceil(this._accuracy/(d/this._map._container.clientHeight)*2);this._circleElement.style.width=`${g}px`,this._circleElement.style.height=`${g}px`}trigger(){if(!this._setup)return a.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new a.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Ti--,gu=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new a.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new a.k("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let y;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Ti++,Ti>1?(y={maximumAge:6e5,timeout:0},gu=!0):(y=this.options.positionOptions,gu=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,y)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},Vn.AttributionControl=Fo,Vn.LogoControl=pi,Vn.ScaleControl=class{constructor(y){this._onMove=()=>{uc(this._map,this._container,this.options)},this.setUnit=s=>{this.options.unit=s,uc(this._map,this._container,this.options)},this.options=a.e({},lc,y)}getDefaultPosition(){return"bottom-left"}onAdd(y){return this._map=y,this._container=x.create("div","maplibregl-ctrl maplibregl-ctrl-scale",y.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){x.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},Vn.FullscreenControl=class extends a.E{constructor(y={}){super(),this._onFullscreenChange=()=>{(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,y&&y.container&&(y.container instanceof HTMLElement?this._container=y.container:a.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(y){return this._map=y,this._container||(this._container=this._map.getContainer()),this._controlContainer=x.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){x.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const y=this._fullscreenButton=x.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);x.create("span","maplibregl-ctrl-icon",y).setAttribute("aria-hidden","true"),y.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const y=this._getTitle();this._fullscreenButton.setAttribute("aria-label",y),this._fullscreenButton.title=y}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new a.k("fullscreenstart")),this._map._cooperativeGestures&&(this._prevCooperativeGestures=this._map._cooperativeGestures,this._map.setCooperativeGestures())):(this.fire(new a.k("fullscreenend")),this._prevCooperativeGestures&&(this._map.setCooperativeGestures(this._prevCooperativeGestures),delete this._prevCooperativeGestures))}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},Vn.TerrainControl=class{constructor(y){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.disableTerrain")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.enableTerrain"))},this.options=y}onAdd(y){return this._map=y,this._container=x.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=x.create("button","maplibregl-ctrl-terrain",this._container),x.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){x.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},Vn.Popup=class extends a.E{constructor(y){super(),this.remove=()=>(this._content&&x.remove(this._content),this._container&&(x.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new a.k("close")),this),this._onMouseUp=s=>{this._update(s.point)},this._onMouseMove=s=>{this._update(s.point)},this._onDrag=s=>{this._update(s.point)},this._update=s=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=x.create("div","maplibregl-popup",this._map.getContainer()),this._tip=x.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const I of this.options.className.split(" "))this._container.classList.add(I);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Kf(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!s)return;const h=this._pos=this._trackPointer&&s?s:this._map.project(this._lngLat);let d=this.options.anchor;const g=_u(this.options.offset);if(!d){const I=this._container.offsetWidth,C=this._container.offsetHeight;let M;M=h.y+g.bottom.y<C?["top"]:h.y>this._map.transform.height-C?["bottom"]:[],h.x<I/2?M.push("left"):h.x>this._map.transform.width-I/2&&M.push("right"),d=M.length===0?"bottom":M.join("-")}const b=h.add(g[d]).round();x.setTransform(this._container,`${us[d]} translate(${b.x}px,${b.y}px)`),rm(this._container,d,"popup")},this._onClose=()=>{this.remove()},this.options=a.e(Object.create(Jf),y)}addTo(y){return this._map&&this.remove(),this._map=y,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new a.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(y){return this._lngLat=a.L.convert(y),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(y){return this.setDOMContent(document.createTextNode(y))}setHTML(y){const s=document.createDocumentFragment(),h=document.createElement("body");let d;for(h.innerHTML=y;d=h.firstChild,d;)s.appendChild(d);return this.setDOMContent(s)}getMaxWidth(){var y;return(y=this._container)===null||y===void 0?void 0:y.style.maxWidth}setMaxWidth(y){return this.options.maxWidth=y,this._update(),this}setDOMContent(y){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=x.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(y),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(y){this._container&&this._container.classList.add(y)}removeClassName(y){this._container&&this._container.classList.remove(y)}setOffset(y){return this.options.offset=y,this._update(),this}toggleClassName(y){if(this._container)return this._container.classList.toggle(y)}_createCloseButton(){this.options.closeButton&&(this._closeButton=x.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const y=this._container.querySelector(Qf);y&&y.focus()}},Vn.Marker=Ml,Vn.Style=Dr,Vn.LngLat=a.L,Vn.LngLatBounds=ke,Vn.Point=a.P,Vn.MercatorCoordinate=a.U,Vn.Evented=a.E,Vn.AJAXError=a.bi,Vn.config=a.c,Vn.CanvasSource=wn,Vn.GeoJSONSource=De,Vn.ImageSource=On,Vn.RasterDEMTileSource=re,Vn.RasterTileSource=qn,Vn.VectorTileSource=Kn,Vn.VideoSource=yi,Vn.setRTLTextPlugin=a.bj,Vn.getRTLTextPluginStatus=a.bk,Vn.prewarm=function(){Ha().acquire(In)},Vn.clearPrewarmedResources=function(){const y=ns;y&&(y.isPreloaded()&&y.numActive()===1?(y.release(In),ns=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},tp.extend(Vn,{isSafari:a.ac,getPerformanceMetrics:a.bg.getPerformanceMetrics}),Vn});var f=r;return f})})(nx);var mg=nx.exports;const Ms=tx(mg);function Uv(e){let t;return n=>{if(n)for(let i in n){let r=t==null?void 0:t[i],l=n[i];r!==l&&e(i,l,r)}else if(t)for(let i in t)e(i,void 0,t[i]);t=n}}function pE(e,...t){let n=[e];for(let i of t)if(i)Array.isArray(i)&&i[0]===e?n.push(...i.slice(1)):n.push(i);else continue;if(n.length!==1)return n.length===2?n[1]:n}function dE(e){return e===!0?["has","point_count"]:e===!1?["!",["has","point_count"]]:void 0}function ry(e,t){return["case",["boolean",["feature-state","hover"],!1],t,e]}var Xm=mE;function mE(e){var t,n,i;if(e){if(Array.isArray(e)){for(t=[],n=e.length,i=0;i<n;i++){var r=e[i];r!=null&&t.push(r)}return t}if(typeof e=="object"){t={};var l=Object.keys(e);for(n=l.length,i=0;i<n;i++){var f=l[i],a=e[f];a!=null&&(t[f]=a)}return t}}}function Gv(e){let t=e[0],n,i,r=jv(e);return{c(){r.c(),n=ts()},m(l,f){r.m(l,f),Ct(l,n,f),i=!0},p(l,f){f[0]&1&&He(t,t=l[0])?(ci(),xt(r,1,1,Ie),hi(),r=jv(l),r.c(),mt(r,1),r.m(n.parentNode,n)):r.p(l,f)},i(l){i||(mt(r),i=!0)},o(l){xt(r),i=!1},d(l){l&&It(n),r.d(l)}}}function jv(e){let t;const n=e[36].default,i=sr(n,e,e[35],null);return{c(){i&&i.c()},m(r,l){i&&i.m(r,l),t=!0},p(r,l){i&&i.p&&(!t||l[1]&16)&&lr(i,n,r,r[35],t?ar(n,r[35],l,null):ur(r[35]),null)},i(r){t||(mt(i,r),t=!0)},o(r){xt(i,r),t=!1},d(r){i&&i.d(r)}}}function gE(e){let t,n,i=e[0]&&Gv(e);return{c(){i&&i.c(),t=ts()},m(r,l){i&&i.m(r,l),Ct(r,t,l),n=!0},p(r,l){r[0]?i?(i.p(r,l),l[0]&1&&mt(i,1)):(i=Gv(r),i.c(),mt(i,1),i.m(t.parentNode,t)):i&&(ci(),xt(i,1,1,()=>{i=null}),hi())},i(r){n||(mt(i),n=!0)},o(r){xt(i),n=!1},d(r){r&&It(t),i&&i.d(r)}}}function _E(e,t,n){let i,r,l,f,a,_,x,S,L,A,P,O,{$$slots:B={},$$scope:U}=t,{id:Y=of("layer")}=t,{source:V=void 0}=t,{sourceLayer:$=void 0}=t,{beforeId:K=void 0}=t,{beforeLayerType:it=void 0}=t,{type:ft}=t,{paint:pt=void 0}=t,{layout:gt=void 0}=t,{filter:ut=void 0}=t,{applyToClusters:St=void 0}=t,{minzoom:_t=void 0}=t,{maxzoom:vt=void 0}=t,{manageHoverState:ee=!1}=t,{hovered:kt=null}=t,{interactive:Gt=!0}=t,{hoverCursor:Qt=void 0}=t,{eventsIfTopMost:se=!1}=t;const Ce=Dc(),{map:yn,source:jn,self:Qe,minzoom:Fe,maxzoom:ke,eventTopMost:fn,layerInfo:Kn}=cE();Se(e,yn,yt=>n(31,L=yt)),Se(e,jn,yt=>n(32,A=yt)),Se(e,Qe,yt=>n(0,S=yt)),Se(e,Fe,yt=>n(34,O=yt)),Se(e,ke,yt=>n(33,P=yt)),aa(()=>{S&&L&&(Kn.delete(S),L==null||L.removeLayer(S))});let qn;function re(yt){var Wn,pn;if(!Gt||!S||!L||se&&fn(yt)!==S)return;let Ee=yt.features??[],qe=(pn=(Wn=Ee[0])==null?void 0:Wn.properties)==null?void 0:pn.cluster_id,nr={event:yt,map:L,clusterId:qe,layer:S,source:a,features:Ee};Ce(yt.type,nr)}function De(yt){var Wn,pn;if(!Gt||!S||!L||se&&fn(yt)!==S)return;Qt&&(L.getCanvas().style.cursor=Qt);let Ee=yt.features??[];n(6,kt=Ee[0]??null);let qe=(pn=(Wn=Ee[0])==null?void 0:Wn.properties)==null?void 0:pn.cluster_id;Ce("mouseenter",{event:yt,map:L,clusterId:qe,layer:S,source:a,features:Ee})}function hn(yt){var Wn,pn,Wi;if(!Gt||!L)return;if(se&&fn(yt)!==S){n(6,kt=null),ee&&qn!==void 0&&(L==null||L.setFeatureState({source:a,sourceLayer:$,id:qn},{hover:!1}),qn=void 0);return}L.getCanvas().style.cursor=Qt;let Ee=yt.features??[],qe=(pn=(Wn=Ee[0])==null?void 0:Wn.properties)==null?void 0:pn.cluster_id,nr=(Wi=Ee[0])==null?void 0:Wi.id;nr!==qn&&(ee&&(qn!==void 0&&(L==null||L.setFeatureState({source:a,id:qn,sourceLayer:$},{hover:!1})),L==null||L.setFeatureState({source:a,id:nr,sourceLayer:$},{hover:!0})),qn=nr,n(6,kt=Ee[0]??null)),Ce("mousemove",{event:yt,map:L,clusterId:qe,layer:S,source:a,features:Ee})}function On(yt){if(!(!Gt||!S||!L)){if(Qt&&(L.getCanvas().style.cursor=""),n(6,kt=null),ee&&qn!==void 0){const Ee={source:a,id:qn,sourceLayer:$};L==null||L.setFeatureState(Ee,{hover:!1}),qn=void 0}Ce("mouseleave",{map:L,layer:S,source:a})}}let yi=!0;function wn(yt){L&&(L.off("click",yt,re),L.off("dblclick",yt,re),L.off("contextmenu",yt,re),L.off("mouseenter",yt,De),L.off("mousemove",yt,hn),L.off("mouseleave",yt,On))}return aa(()=>{L&&S&&wn(S)}),e.$$set=yt=>{"id"in yt&&n(7,Y=yt.id),"source"in yt&&n(8,V=yt.source),"sourceLayer"in yt&&n(9,$=yt.sourceLayer),"beforeId"in yt&&n(10,K=yt.beforeId),"beforeLayerType"in yt&&n(11,it=yt.beforeLayerType),"type"in yt&&n(12,ft=yt.type),"paint"in yt&&n(13,pt=yt.paint),"layout"in yt&&n(14,gt=yt.layout),"filter"in yt&&n(15,ut=yt.filter),"applyToClusters"in yt&&n(16,St=yt.applyToClusters),"minzoom"in yt&&n(17,_t=yt.minzoom),"maxzoom"in yt&&n(18,vt=yt.maxzoom),"manageHoverState"in yt&&n(19,ee=yt.manageHoverState),"hovered"in yt&&n(6,kt=yt.hovered),"interactive"in yt&&n(20,Gt=yt.interactive),"hoverCursor"in yt&&n(21,Qt=yt.hoverCursor),"eventsIfTopMost"in yt&&n(22,se=yt.eventsIfTopMost),"$$scope"in yt&&n(35,U=yt.$$scope)},e.$$.update=()=>{if(e.$$.dirty[0]&65536&&n(30,i=dE(St)),e.$$.dirty[0]&1073774592&&n(24,r=pE("all",i,ut)),e.$$.dirty[0]&131072|e.$$.dirty[1]&8&&n(26,l=_t??O),e.$$.dirty[0]&262144|e.$$.dirty[1]&4&&n(25,f=vt??P),e.$$.dirty[0]&256|e.$$.dirty[1]&2&&n(29,a=V||A),e.$$.dirty[0]&654343809|e.$$.dirty[1]&1&&L&&S!==Y&&a){S&&(wn(S),Kn.delete(S));let yt=K;if(!K&&it){let Ee=L.getStyle().layers,qe=typeof it=="function"?it:Wn=>Wn.type===it,nr=Ee==null?void 0:Ee.find(qe);nr&&(yt=nr.id)}je(Qe,S=Y,S),L.addLayer(Xm({id:S,type:ft,source:a,"source-layer":$,filter:r,paint:pt,layout:gt,minzoom:l,maxzoom:f}),yt),n(23,yi=!0),L.on("click",S,re),L.on("dblclick",S,re),L.on("contextmenu",S,re),L.on("mouseenter",S,De),L.on("mousemove",S,hn),L.on("mouseleave",S,On)}e.$$.dirty[0]&1048577&&S&&Kn.set(S,{interactive:Gt}),e.$$.dirty[0]&1|e.$$.dirty[1]&1&&n(28,_=S?Uv((yt,Ee)=>L==null?void 0:L.setPaintProperty(S,yt,Ee)):void 0),e.$$.dirty[0]&1|e.$$.dirty[1]&1&&n(27,x=S?Uv((yt,Ee)=>L==null?void 0:L.setLayoutProperty(S,yt,Ee)):void 0),e.$$.dirty[0]&268443648&&(_==null||_(pt)),e.$$.dirty[0]&134234112&&(x==null||x(gt)),e.$$.dirty[0]&100663297|e.$$.dirty[1]&1&&S&&(L==null||L.setLayerZoomRange(S,l,f)),e.$$.dirty[0]&25165825|e.$$.dirty[1]&1&&S&&(yi?n(23,yi=!1):L==null||L.setFilter(S,r))},[S,yn,jn,Qe,Fe,ke,kt,Y,V,$,K,it,ft,pt,gt,ut,St,_t,vt,ee,Gt,Qt,se,yi,r,f,l,x,_,a,i,L,A,P,O,U,B]}class gg extends nn{constructor(t){super(),en(this,t,_E,gE,He,{id:7,source:8,sourceLayer:9,beforeId:10,beforeLayerType:11,type:12,paint:13,layout:14,filter:15,applyToClusters:16,minzoom:17,maxzoom:18,manageHoverState:19,hovered:6,interactive:20,hoverCursor:21,eventsIfTopMost:22},null,[-1,-1])}}function yE(e){let t;const n=e[16].default,i=sr(n,e,e[24],null);return{c(){i&&i.c()},m(r,l){i&&i.m(r,l),t=!0},p(r,l){i&&i.p&&(!t||l&16777216)&&lr(i,n,r,r[24],t?ar(n,r[24],l,null):ur(r[24]),null)},i(r){t||(mt(i,r),t=!0)},o(r){xt(i,r),t=!1},d(r){i&&i.d(r)}}}function vE(e){let t,n,i;function r(f){e[17](f)}let l={id:e[1],type:"circle",source:e[2],sourceLayer:e[3],beforeId:e[4],beforeLayerType:e[5],paint:e[6],layout:e[7],filter:e[8],applyToClusters:e[9],minzoom:e[10],maxzoom:e[11],hoverCursor:e[12],manageHoverState:e[13],eventsIfTopMost:e[14],interactive:e[15],$$slots:{default:[yE]},$$scope:{ctx:e}};return e[0]!==void 0&&(l.hovered=e[0]),t=new gg({props:l}),cr.push(()=>vc(t,"hovered",r)),t.$on("click",e[18]),t.$on("dblclick",e[19]),t.$on("contextmenu",e[20]),t.$on("mouseenter",e[21]),t.$on("mousemove",e[22]),t.$on("mouseleave",e[23]),{c(){Zt(t.$$.fragment)},m(f,a){jt(t,f,a),i=!0},p(f,[a]){const _={};a&2&&(_.id=f[1]),a&4&&(_.source=f[2]),a&8&&(_.sourceLayer=f[3]),a&16&&(_.beforeId=f[4]),a&32&&(_.beforeLayerType=f[5]),a&64&&(_.paint=f[6]),a&128&&(_.layout=f[7]),a&256&&(_.filter=f[8]),a&512&&(_.applyToClusters=f[9]),a&1024&&(_.minzoom=f[10]),a&2048&&(_.maxzoom=f[11]),a&4096&&(_.hoverCursor=f[12]),a&8192&&(_.manageHoverState=f[13]),a&16384&&(_.eventsIfTopMost=f[14]),a&32768&&(_.interactive=f[15]),a&16777216&&(_.$$scope={dirty:a,ctx:f}),!n&&a&1&&(n=!0,_.hovered=f[0],yc(()=>n=!1)),t.$set(_)},i(f){i||(mt(t.$$.fragment,f),i=!0)},o(f){xt(t.$$.fragment,f),i=!1},d(f){qt(t,f)}}}function bE(e,t,n){let{$$slots:i={},$$scope:r}=t,{id:l=of("circle")}=t,{source:f=void 0}=t,{sourceLayer:a=void 0}=t,{beforeId:_=void 0}=t,{beforeLayerType:x=void 0}=t,{paint:S}=t,{layout:L=void 0}=t,{filter:A=void 0}=t,{applyToClusters:P=void 0}=t,{minzoom:O=void 0}=t,{maxzoom:B=void 0}=t,{hoverCursor:U=void 0}=t,{manageHoverState:Y=!1}=t,{hovered:V=null}=t,{eventsIfTopMost:$=!1}=t,{interactive:K=!0}=t;function it(vt){V=vt,n(0,V)}function ft(vt){ii.call(this,e,vt)}function pt(vt){ii.call(this,e,vt)}function gt(vt){ii.call(this,e,vt)}function ut(vt){ii.call(this,e,vt)}function St(vt){ii.call(this,e,vt)}function _t(vt){ii.call(this,e,vt)}return e.$$set=vt=>{"id"in vt&&n(1,l=vt.id),"source"in vt&&n(2,f=vt.source),"sourceLayer"in vt&&n(3,a=vt.sourceLayer),"beforeId"in vt&&n(4,_=vt.beforeId),"beforeLayerType"in vt&&n(5,x=vt.beforeLayerType),"paint"in vt&&n(6,S=vt.paint),"layout"in vt&&n(7,L=vt.layout),"filter"in vt&&n(8,A=vt.filter),"applyToClusters"in vt&&n(9,P=vt.applyToClusters),"minzoom"in vt&&n(10,O=vt.minzoom),"maxzoom"in vt&&n(11,B=vt.maxzoom),"hoverCursor"in vt&&n(12,U=vt.hoverCursor),"manageHoverState"in vt&&n(13,Y=vt.manageHoverState),"hovered"in vt&&n(0,V=vt.hovered),"eventsIfTopMost"in vt&&n(14,$=vt.eventsIfTopMost),"interactive"in vt&&n(15,K=vt.interactive),"$$scope"in vt&&n(24,r=vt.$$scope)},[V,l,f,a,_,x,S,L,A,P,O,B,U,Y,$,K,i,it,ft,pt,gt,ut,St,_t,r]}class hd extends nn{constructor(t){super(),en(this,t,bE,vE,He,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}function xE(e){let t;const n=e[15].default,i=sr(n,e,e[23],null);return{c(){i&&i.c()},m(r,l){i&&i.m(r,l),t=!0},p(r,l){i&&i.p&&(!t||l&8388608)&&lr(i,n,r,r[23],t?ar(n,r[23],l,null):ur(r[23]),null)},i(r){t||(mt(i,r),t=!0)},o(r){xt(i,r),t=!1},d(r){i&&i.d(r)}}}function wE(e){let t,n,i;function r(f){e[16](f)}let l={id:e[1],type:"fill",source:e[2],sourceLayer:e[3],beforeId:e[4],beforeLayerType:e[5],paint:e[6],layout:e[7],filter:e[8],minzoom:e[9],maxzoom:e[10],hoverCursor:e[11],manageHoverState:e[12],eventsIfTopMost:e[13],interactive:e[14],$$slots:{default:[xE]},$$scope:{ctx:e}};return e[0]!==void 0&&(l.hovered=e[0]),t=new gg({props:l}),cr.push(()=>vc(t,"hovered",r)),t.$on("click",e[17]),t.$on("dblclick",e[18]),t.$on("contextmenu",e[19]),t.$on("mouseenter",e[20]),t.$on("mousemove",e[21]),t.$on("mouseleave",e[22]),{c(){Zt(t.$$.fragment)},m(f,a){jt(t,f,a),i=!0},p(f,[a]){const _={};a&2&&(_.id=f[1]),a&4&&(_.source=f[2]),a&8&&(_.sourceLayer=f[3]),a&16&&(_.beforeId=f[4]),a&32&&(_.beforeLayerType=f[5]),a&64&&(_.paint=f[6]),a&128&&(_.layout=f[7]),a&256&&(_.filter=f[8]),a&512&&(_.minzoom=f[9]),a&1024&&(_.maxzoom=f[10]),a&2048&&(_.hoverCursor=f[11]),a&4096&&(_.manageHoverState=f[12]),a&8192&&(_.eventsIfTopMost=f[13]),a&16384&&(_.interactive=f[14]),a&8388608&&(_.$$scope={dirty:a,ctx:f}),!n&&a&1&&(n=!0,_.hovered=f[0],yc(()=>n=!1)),t.$set(_)},i(f){i||(mt(t.$$.fragment,f),i=!0)},o(f){xt(t.$$.fragment,f),i=!1},d(f){qt(t,f)}}}function SE(e,t,n){let{$$slots:i={},$$scope:r}=t,{id:l=of("fill")}=t,{source:f=void 0}=t,{sourceLayer:a=void 0}=t,{beforeId:_=void 0}=t,{beforeLayerType:x=void 0}=t,{paint:S}=t,{layout:L=void 0}=t,{filter:A=void 0}=t,{minzoom:P=void 0}=t,{maxzoom:O=void 0}=t,{hoverCursor:B=void 0}=t,{manageHoverState:U=!1}=t,{hovered:Y=null}=t,{eventsIfTopMost:V=!1}=t,{interactive:$=!0}=t;function K(_t){Y=_t,n(0,Y)}function it(_t){ii.call(this,e,_t)}function ft(_t){ii.call(this,e,_t)}function pt(_t){ii.call(this,e,_t)}function gt(_t){ii.call(this,e,_t)}function ut(_t){ii.call(this,e,_t)}function St(_t){ii.call(this,e,_t)}return e.$$set=_t=>{"id"in _t&&n(1,l=_t.id),"source"in _t&&n(2,f=_t.source),"sourceLayer"in _t&&n(3,a=_t.sourceLayer),"beforeId"in _t&&n(4,_=_t.beforeId),"beforeLayerType"in _t&&n(5,x=_t.beforeLayerType),"paint"in _t&&n(6,S=_t.paint),"layout"in _t&&n(7,L=_t.layout),"filter"in _t&&n(8,A=_t.filter),"minzoom"in _t&&n(9,P=_t.minzoom),"maxzoom"in _t&&n(10,O=_t.maxzoom),"hoverCursor"in _t&&n(11,B=_t.hoverCursor),"manageHoverState"in _t&&n(12,U=_t.manageHoverState),"hovered"in _t&&n(0,Y=_t.hovered),"eventsIfTopMost"in _t&&n(13,V=_t.eventsIfTopMost),"interactive"in _t&&n(14,$=_t.interactive),"$$scope"in _t&&n(23,r=_t.$$scope)},[Y,l,f,a,_,x,S,L,A,P,O,B,U,V,$,i,K,it,ft,pt,gt,ut,St,r]}class af extends nn{constructor(t){super(),en(this,t,SE,wE,He,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}function EE(e,t,n){let i;const{map:r}=sf();Se(e,r,_=>n(4,i=_));let{position:l="top-left"}=t,{container:f=void 0}=t,a=null;return aa(()=>{i!=null&&i.loaded()&&a&&i.removeControl(a)}),e.$$set=_=>{"position"in _&&n(1,l=_.position),"container"in _&&n(2,f=_.container)},e.$$.update=()=>{if(e.$$.dirty&30&&i&&!a){let _;typeof f=="string"?_=document.querySelector(f)??void 0:_=f,n(3,a=new Ms.FullscreenControl({container:_})),i.addControl(a,l)}},[r,l,f,a,i]}class IE extends nn{constructor(t){super(),en(this,t,EE,null,He,{position:1,container:2})}}function CE(e,t,n,i,r){let l=!1;e.getSource(t)&&(l=!0,e.removeSource(t));const f=()=>{i(t)&&(e.addSource(t,n),r())};if(l){const a=()=>{t&&(e.getSource(t)?setTimeout(a,1):f())};a()}else f()}function TE(e,t,n){RS().then(()=>{let i=Vb(e);if(!i)return;i.getSource(t)===n&&i.removeSource(t)})}function qv(e){let t=e[0],n,i,r=Zv(e);return{c(){r.c(),n=ts()},m(l,f){r.m(l,f),Ct(l,n,f),i=!0},p(l,f){f&1&&He(t,t=l[0])?(ci(),xt(r,1,1,Ie),hi(),r=Zv(l),r.c(),mt(r,1),r.m(n.parentNode,n)):r.p(l,f)},i(l){i||(mt(r),i=!0)},o(l){xt(r),i=!1},d(l){l&&It(n),r.d(l)}}}function Zv(e){let t;const n=e[15].default,i=sr(n,e,e[14],null);return{c(){i&&i.c()},m(r,l){i&&i.m(r,l),t=!0},p(r,l){i&&i.p&&(!t||l&16384)&&lr(i,n,r,r[14],t?ar(n,r[14],l,null):ur(r[14]),null)},i(r){t||(mt(i,r),t=!0)},o(r){xt(i,r),t=!1},d(r){i&&i.d(r)}}}function LE(e){let t,n,i=e[0]&&qv(e);return{c(){i&&i.c(),t=ts()},m(r,l){i&&i.m(r,l),Ct(r,t,l),n=!0},p(r,[l]){r[0]?i?(i.p(r,l),l&1&&mt(i,1)):(i=qv(r),i.c(),mt(i,1),i.m(t.parentNode,t)):i&&(ci(),xt(i,1,1,()=>{i=null}),hi())},i(r){n||(mt(i),n=!0)},o(r){xt(i),n=!1},d(r){r&&It(t),i&&i.d(r)}}}function ME(e,t,n){let i,r,l,{$$slots:f={},$$scope:a}=t,{id:_=of("geojson")}=t,{data:x}=t,{generateId:S=!1}=t,{promoteId:L=void 0}=t,{filter:A=void 0}=t,{lineMetrics:P=void 0}=t,{cluster:O=void 0}=t;const{map:B,cluster:U,self:Y}=uE();Se(e,B,K=>n(13,r=K)),Se(e,U,K=>n(16,l=K)),Se(e,Y,K=>n(0,i=K));let V,$=!0;return aa(()=>{i&&V&&r&&(TE(B,i,V),je(Y,i=null,i),n(11,V=void 0))}),e.$$set=K=>{"id"in K&&n(4,_=K.id),"data"in K&&n(5,x=K.data),"generateId"in K&&n(6,S=K.generateId),"promoteId"in K&&n(7,L=K.promoteId),"filter"in K&&n(8,A=K.filter),"lineMetrics"in K&&n(9,P=K.lineMetrics),"cluster"in K&&n(10,O=K.cluster),"$$scope"in K&&n(14,a=K.$$scope)},e.$$.update=()=>{e.$$.dirty&1024&&je(U,l=O,l),e.$$.dirty&12273&&r&&i!==_&&(je(Y,i=_,i),CE(r,i,Xm({type:"geojson",data:x,filter:A,lineMetrics:P,generateId:S,promoteId:L,cluster:!!O,clusterMinPoints:O==null?void 0:O.minPoints,clusterMaxZoom:O==null?void 0:O.maxZoom,clusterRadius:O==null?void 0:O.radius,clusterProperties:O==null?void 0:O.properties}),K=>r&&K===i,()=>{i&&(n(11,V=r==null?void 0:r.getSource(i)),n(12,$=!0))})),e.$$.dirty&8208&&(r==null||r.on("style.load",()=>{n(11,V=r==null?void 0:r.getSource(_))})),e.$$.dirty&6176&&V&&($?n(12,$=!1):V.setData(x)),e.$$.dirty&3072&&(V==null||V.setClusterOptions(Xm({cluster:!!O,clusterMaxZoom:O==null?void 0:O.maxZoom,clusterRadius:O==null?void 0:O.radius})))},[i,B,U,Y,_,x,S,L,A,P,O,V,$,r,a,f]}class Ps extends nn{constructor(t){super(),en(this,t,ME,LE,He,{id:4,data:5,generateId:6,promoteId:7,filter:8,lineMetrics:9,cluster:10})}}function PE(e,t,n){let i;const{map:r}=sf();Se(e,r,A=>n(8,i=A));let{position:l="top-left"}=t,{positionOptions:f=void 0}=t,{fitBoundsOptions:a=void 0}=t,{trackUserLocation:_=!1}=t,{showAccuracyCircle:x=!0}=t,{showUserLocation:S=!0}=t,L=null;return aa(()=>{i!=null&&i.loaded()&&L&&i.removeControl(L)}),e.$$set=A=>{"position"in A&&n(1,l=A.position),"positionOptions"in A&&n(2,f=A.positionOptions),"fitBoundsOptions"in A&&n(3,a=A.fitBoundsOptions),"trackUserLocation"in A&&n(4,_=A.trackUserLocation),"showAccuracyCircle"in A&&n(5,x=A.showAccuracyCircle),"showUserLocation"in A&&n(6,S=A.showUserLocation)},e.$$.update=()=>{e.$$.dirty&510&&i&&!L&&(n(7,L=new Ms.GeolocateControl({positionOptions:f,fitBoundsOptions:a,trackUserLocation:_,showAccuracyCircle:x,showUserLocation:S})),i.addControl(L,l))},[r,l,f,a,_,x,S,L,i]}class kE extends nn{constructor(t){super(),en(this,t,PE,null,He,{position:1,positionOptions:2,fitBoundsOptions:3,trackUserLocation:4,showAccuracyCircle:5,showUserLocation:6})}}function AE(e){let t;const n=e[15].default,i=sr(n,e,e[23],null);return{c(){i&&i.c()},m(r,l){i&&i.m(r,l),t=!0},p(r,l){i&&i.p&&(!t||l&8388608)&&lr(i,n,r,r[23],t?ar(n,r[23],l,null):ur(r[23]),null)},i(r){t||(mt(i,r),t=!0)},o(r){xt(i,r),t=!1},d(r){i&&i.d(r)}}}function NE(e){let t,n,i;function r(f){e[16](f)}let l={id:e[1],type:"line",source:e[2],sourceLayer:e[3],beforeId:e[4],beforeLayerType:e[5],paint:e[6],layout:e[7],filter:e[8],minzoom:e[9],maxzoom:e[10],hoverCursor:e[11],manageHoverState:e[12],eventsIfTopMost:e[13],interactive:e[14],$$slots:{default:[AE]},$$scope:{ctx:e}};return e[0]!==void 0&&(l.hovered=e[0]),t=new gg({props:l}),cr.push(()=>vc(t,"hovered",r)),t.$on("click",e[17]),t.$on("dblclick",e[18]),t.$on("contextmenu",e[19]),t.$on("mouseenter",e[20]),t.$on("mousemove",e[21]),t.$on("mouseleave",e[22]),{c(){Zt(t.$$.fragment)},m(f,a){jt(t,f,a),i=!0},p(f,[a]){const _={};a&2&&(_.id=f[1]),a&4&&(_.source=f[2]),a&8&&(_.sourceLayer=f[3]),a&16&&(_.beforeId=f[4]),a&32&&(_.beforeLayerType=f[5]),a&64&&(_.paint=f[6]),a&128&&(_.layout=f[7]),a&256&&(_.filter=f[8]),a&512&&(_.minzoom=f[9]),a&1024&&(_.maxzoom=f[10]),a&2048&&(_.hoverCursor=f[11]),a&4096&&(_.manageHoverState=f[12]),a&8192&&(_.eventsIfTopMost=f[13]),a&16384&&(_.interactive=f[14]),a&8388608&&(_.$$scope={dirty:a,ctx:f}),!n&&a&1&&(n=!0,_.hovered=f[0],yc(()=>n=!1)),t.$set(_)},i(f){i||(mt(t.$$.fragment,f),i=!0)},o(f){xt(t.$$.fragment,f),i=!1},d(f){qt(t,f)}}}function DE(e,t,n){let{$$slots:i={},$$scope:r}=t,{id:l=of("line")}=t,{source:f=void 0}=t,{sourceLayer:a=void 0}=t,{beforeId:_=void 0}=t,{beforeLayerType:x=void 0}=t,{paint:S}=t,{layout:L=void 0}=t,{filter:A=void 0}=t,{minzoom:P=void 0}=t,{maxzoom:O=void 0}=t,{hoverCursor:B=void 0}=t,{manageHoverState:U=!1}=t,{hovered:Y=null}=t,{eventsIfTopMost:V=!1}=t,{interactive:$=!0}=t;function K(_t){Y=_t,n(0,Y)}function it(_t){ii.call(this,e,_t)}function ft(_t){ii.call(this,e,_t)}function pt(_t){ii.call(this,e,_t)}function gt(_t){ii.call(this,e,_t)}function ut(_t){ii.call(this,e,_t)}function St(_t){ii.call(this,e,_t)}return e.$$set=_t=>{"id"in _t&&n(1,l=_t.id),"source"in _t&&n(2,f=_t.source),"sourceLayer"in _t&&n(3,a=_t.sourceLayer),"beforeId"in _t&&n(4,_=_t.beforeId),"beforeLayerType"in _t&&n(5,x=_t.beforeLayerType),"paint"in _t&&n(6,S=_t.paint),"layout"in _t&&n(7,L=_t.layout),"filter"in _t&&n(8,A=_t.filter),"minzoom"in _t&&n(9,P=_t.minzoom),"maxzoom"in _t&&n(10,O=_t.maxzoom),"hoverCursor"in _t&&n(11,B=_t.hoverCursor),"manageHoverState"in _t&&n(12,U=_t.manageHoverState),"hovered"in _t&&n(0,Y=_t.hovered),"eventsIfTopMost"in _t&&n(13,V=_t.eventsIfTopMost),"interactive"in _t&&n(14,$=_t.interactive),"$$scope"in _t&&n(23,r=_t.$$scope)},[Y,l,f,a,_,x,S,L,A,P,O,B,U,V,$,i,K,it,ft,pt,gt,ut,St,r]}class ru extends nn{constructor(t){super(),en(this,t,DE,NE,He,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}function RE(e){let t=e.getCenter(),n=Math.round(e.getZoom()*100)/100,i=Math.ceil((n*Math.LN2+Math.log(512/360/.5))/Math.LN10),r=Math.pow(10,i),l=Math.round(t.lat*r)/r,f=Math.round(t.lng*r)/r,a=`${n}/${l}/${f}`,_=e.getBearing(),x=e.getPitch();return(_||x)&&(a+=`/${Math.round(_*10)/10}`),x&&(a+=`/${Math.round(x)}`),`#${a}`}function OE(e){return e.replace("#","").split("/").map(parseFloat)}var Pm=Py;function Py(e,t){return e===t||e!==e&&t!==t?!0:typeof e!=typeof t||{}.toString.call(e)!={}.toString.call(t)||e!==Object(e)||!e?!1:Array.isArray(e)?$v(e,t):{}.toString.call(e)=="[object Set]"?$v(Array.from(e),Array.from(t)):{}.toString.call(e)=="[object Object]"?FE(e,t):zE(e,t)}function zE(e,t){return e.toString()===t.toString()}function $v(e,t){var n=e.length;if(n!=t.length)return!1;for(var i=0;i<n;i++)if(!Py(e[i],t[i]))return!1;return!0}function FE(e,t){var n=Object.keys(e),i=n.length;if(i!=Object.keys(t).length)return!1;for(var r=0;r<i;r++){var l=n[r];if(!(t.hasOwnProperty(l)&&Py(e[l],t[l])))return!1}return!0}function BE(e,t,n){let i;const{map:r}=sf();Se(e,r,S=>n(6,i=S));let{position:l="top-left"}=t,{showCompass:f=!0}=t,{showZoom:a=!0}=t,{visualizePitch:_=!1}=t,x=null;return aa(()=>{i!=null&&i.loaded()&&x&&i.removeControl(x)}),e.$$set=S=>{"position"in S&&n(1,l=S.position),"showCompass"in S&&n(2,f=S.showCompass),"showZoom"in S&&n(3,a=S.showZoom),"visualizePitch"in S&&n(4,_=S.visualizePitch)},e.$$.update=()=>{e.$$.dirty&126&&i&&!x&&(n(5,x=new Ms.NavigationControl({showCompass:f,showZoom:a,visualizePitch:_})),i.addControl(x,l))},[r,l,f,a,_,x,i]}class VE extends nn{constructor(t){super(),en(this,t,BE,null,He,{position:1,showCompass:2,showZoom:3,visualizePitch:4})}}function UE(e,t,n){let i;const{map:r}=sf();Se(e,r,x=>n(5,i=x));let{position:l="bottom-left"}=t,{maxWidth:f=void 0}=t,{unit:a="metric"}=t,_=null;return aa(()=>{i!=null&&i.loaded()&&_&&i.removeControl(_)}),e.$$set=x=>{"position"in x&&n(1,l=x.position),"maxWidth"in x&&n(2,f=x.maxWidth),"unit"in x&&n(3,a=x.unit)},e.$$.update=()=>{e.$$.dirty&62&&i&&!_&&(n(4,_=new Ms.ScaleControl({maxWidth:f,unit:a})),i.addControl(_,l))},[r,l,f,a,_,i]}class GE extends nn{constructor(t){super(),en(this,t,UE,null,He,{position:1,maxWidth:2,unit:3})}}const jE=e=>({map:e[0]&8,loadedImages:e[0]&16,allImagesLoaded:e[0]&32}),Wv=e=>({map:e[3],loadedImages:e[4],allImagesLoaded:e[5]});function Xv(e){let t,n,i=e[2]&&Hv(e);const r=e[34].default,l=sr(r,e,e[33],Wv);return{c(){i&&i.c(),t=Xt(),l&&l.c()},m(f,a){i&&i.m(f,a),Ct(f,t,a),l&&l.m(f,a),n=!0},p(f,a){f[2]?i?(i.p(f,a),a[0]&4&&mt(i,1)):(i=Hv(f),i.c(),mt(i,1),i.m(t.parentNode,t)):i&&(ci(),xt(i,1,1,()=>{i=null}),hi()),l&&l.p&&(!n||a[0]&56|a[1]&4)&&lr(l,r,f,f[33],n?ar(r,f[33],a,jE):ur(f[33]),Wv)},i(f){n||(mt(i),mt(l,f),n=!0)},o(f){xt(i),xt(l,f),n=!1},d(f){f&&It(t),i&&i.d(f),l&&l.d(f)}}}function Hv(e){let t,n,i,r,l,f,a,_;return t=new VE({props:{position:e[6]}}),i=new kE({props:{position:e[6],fitBoundsOptions:{maxZoom:12}}}),l=new IE({props:{position:e[6]}}),a=new GE({props:{position:e[6]}}),{c(){Zt(t.$$.fragment),n=Xt(),Zt(i.$$.fragment),r=Xt(),Zt(l.$$.fragment),f=Xt(),Zt(a.$$.fragment)},m(x,S){jt(t,x,S),Ct(x,n,S),jt(i,x,S),Ct(x,r,S),jt(l,x,S),Ct(x,f,S),jt(a,x,S),_=!0},p(x,S){const L={};S[0]&64&&(L.position=x[6]),t.$set(L);const A={};S[0]&64&&(A.position=x[6]),i.$set(A);const P={};S[0]&64&&(P.position=x[6]),l.$set(P);const O={};S[0]&64&&(O.position=x[6]),a.$set(O)},i(x){_||(mt(t.$$.fragment,x),mt(i.$$.fragment,x),mt(l.$$.fragment,x),mt(a.$$.fragment,x),_=!0)},o(x){xt(t.$$.fragment,x),xt(i.$$.fragment,x),xt(l.$$.fragment,x),xt(a.$$.fragment,x),_=!1},d(x){x&&(It(n),It(r),It(f)),qt(t,x),qt(i,x),qt(l,x),qt(a,x)}}}function qE(e){let t,n,i,r,l,f=e[3]&&e[0]&&Xv(e);return{c(){t=wt("div"),f&&f.c(),Rt(t,"class",n=Zm(e[1])+" svelte-p00lfq"),hl(t,"expand-map",!e[1])},m(a,_){Ct(a,t,_),f&&f.m(t,null),i=!0,r||(l=Q_(e[9].call(null,t)),r=!0)},p(a,_){a[3]&&a[0]?f?(f.p(a,_),_[0]&9&&mt(f,1)):(f=Xv(a),f.c(),mt(f,1),f.m(t,null)):f&&(ci(),xt(f,1,1,()=>{f=null}),hi()),(!i||_[0]&2&&n!==(n=Zm(a[1])+" svelte-p00lfq"))&&Rt(t,"class",n),(!i||_[0]&2)&&hl(t,"expand-map",!a[1])},i(a){i||(mt(f),i=!0)},o(a){xt(f),i=!1},d(a){a&&It(t),f&&f.d(),r=!1,l()}}}function ZE(e,t,n){let i,r,l,f,{$$slots:a={},$$scope:_}=t,{map:x=null}=t,{class:S=void 0}=t,{style:L}=t,{diffStyleUpdates:A=!1}=t,{center:P=void 0}=t,{zoom:O=void 0}=t,{pitch:B=0}=t,{bearing:U=0}=t,{bounds:Y=void 0}=t,{hash:V=!1}=t,{loaded:$=!1}=t,{minZoom:K=0}=t,{maxZoom:it=22}=t,{zoomOnDoubleClick:ft=!0}=t,{interactive:pt=!0}=t,{attributionControl:gt=!0}=t,{cooperativeGestures:ut=!1}=t,{preserveDrawingBuffer:St=!1}=t,{maxBounds:_t=void 0}=t,{images:vt=[]}=t,{standardControls:ee=!1}=t,{filterLayers:kt=void 0}=t,{transformRequest:Gt=void 0}=t;const Qt=Dc(),{map:se,loadedImages:Ce}=lE();Se(e,se,re=>n(3,l=re)),Se(e,Ce,re=>n(4,f=re));let yn=new Set;function jn(re){l!=null&&l.loaded()&&("url"in re?(yn.add(re.id),l.loadImage(re.url,(De,hn)=>{yn.delete(re.id),De?Qt("error",De):hn&&(l==null||l.addImage(re.id,hn,re.options),f.add(re.id),Ce.set(f))})):(l.addImage(re.id,re.data,re.options),f.add(re.id),Ce.set(f)))}let Qe,Fe,ke,fn;function Kn(re){if(V){let De=OE(window.location.hash);De.length>=3&&(n(11,O=De[0]),n(10,P=[De[2],De[1]])),De.length==5&&(n(15,U=De[3]),n(14,B=De[4]))}return je(se,l=new Ms.Map(Xm({container:re,style:L,center:P,zoom:O,pitch:B,bearing:U,minZoom:K,maxZoom:it,interactive:pt,preserveDrawingBuffer:St,maxBounds:_t,bounds:Y,attributionControl:gt,transformRequest:Gt,cooperativeGestures:ut})),l),l.on("load",De=>{n(0,$=!0),Qt("load",l)}),l.on("error",De=>Qt("error",{...De,map:l})),l.on("movestart",De=>Qt("movestart",{...De,map:l})),l.on("moveend",De=>{if(n(10,P=De.target.getCenter()),n(11,O=De.target.getZoom()),n(12,Y=De.target.getBounds()),Qt("moveend",{...De,map:l}),V){let hn=window.location.href.replace(/(#.+)?$/,RE(l));window.history.replaceState(window.history.state,"",hn)}}),l.on("zoomstart",De=>Qt("zoomstart",{...De,map:l})),l.on("zoom",De=>{n(11,O=De.target.getZoom()),Qt("zoom",{...De,map:l})}),l.on("zoomend",De=>{n(11,O=De.target.getZoom()),Qt("zoomend",{...De,map:l})}),l.on("style.load",()=>{if(l){const De=l.getStyle();if(n(30,Qe=De.layers.map(hn=>hn.id)),n(31,Fe=Object.keys(De.sources)),fn)for(const[hn,On]of Object.entries(fn))l.addSource(hn,On);if(ke)for(const hn of ke)l.addLayer(hn)}}),l.on("styledata",De=>{if(l&&kt){const hn=l.getStyle().layers;if(hn)for(let On of hn)kt(On)||l.setLayoutProperty(On.id,"visibility","none")}Qt("styledata",{...De,map:l})}),{destroy(){n(0,$=!1),l==null||l.remove(),je(se,l=null,l)}}}let qn=L;return e.$$set=re=>{"map"in re&&n(13,x=re.map),"class"in re&&n(1,S=re.class),"style"in re&&n(16,L=re.style),"diffStyleUpdates"in re&&n(17,A=re.diffStyleUpdates),"center"in re&&n(10,P=re.center),"zoom"in re&&n(11,O=re.zoom),"pitch"in re&&n(14,B=re.pitch),"bearing"in re&&n(15,U=re.bearing),"bounds"in re&&n(12,Y=re.bounds),"hash"in re&&n(18,V=re.hash),"loaded"in re&&n(0,$=re.loaded),"minZoom"in re&&n(19,K=re.minZoom),"maxZoom"in re&&n(20,it=re.maxZoom),"zoomOnDoubleClick"in re&&n(21,ft=re.zoomOnDoubleClick),"interactive"in re&&n(22,pt=re.interactive),"attributionControl"in re&&n(23,gt=re.attributionControl),"cooperativeGestures"in re&&n(24,ut=re.cooperativeGestures),"preserveDrawingBuffer"in re&&n(25,St=re.preserveDrawingBuffer),"maxBounds"in re&&n(26,_t=re.maxBounds),"images"in re&&n(27,vt=re.images),"standardControls"in re&&n(2,ee=re.standardControls),"filterLayers"in re&&n(28,kt=re.filterLayers),"transformRequest"in re&&n(29,Gt=re.transformRequest),"$$scope"in re&&n(33,_=re.$$scope)},e.$$.update=()=>{if(e.$$.dirty[0]&4&&n(6,i=typeof ee=="boolean"?void 0:ee),e.$$.dirty[0]&8&&n(13,x=l),e.$$.dirty[0]&134217737&&$&&l!=null&&l.loaded())for(let re of vt)!yn.has(re.id)&&!l.hasImage(re.id)&&jn(re);if(e.$$.dirty[0]&134217744&&n(5,r=vt.every(re=>f.has(re.id))),e.$$.dirty[0]&1073938440|e.$$.dirty[1]&3&&l&&!Pm(L,qn)){const re=l.getStyle();if(Qe&&(ke=re.layers.filter(De=>!Qe.includes(De.id))),Fe){const De=Object.keys(re.sources).filter(hn=>!Fe.includes(hn));fn={};for(const hn of De)fn[hn]=re.sources[hn]}n(32,qn=L),l.setStyle(L,{diff:A})}e.$$.dirty[0]&1032&&P&&!Pm(P,l==null?void 0:l.getCenter())&&(l==null||l.panTo(P)),e.$$.dirty[0]&2056&&O&&!Pm(O,l==null?void 0:l.getZoom())&&(l==null||l.zoomTo(O)),e.$$.dirty[0]&4104&&Y&&!Pm(Y,l==null?void 0:l.getBounds())&&(l==null||l.fitBounds(Y)),e.$$.dirty[0]&2097160&&(ft?l==null||l.doubleClickZoom.enable():l==null||l.doubleClickZoom.disable())},[$,S,ee,l,f,r,i,se,Ce,Kn,P,O,Y,x,B,U,L,A,V,K,it,ft,pt,gt,ut,St,_t,vt,kt,Gt,Qe,Fe,qn,_,a]}class $E extends nn{constructor(t){super(),en(this,t,ZE,qE,He,{map:13,class:1,style:16,diffStyleUpdates:17,center:10,zoom:11,pitch:14,bearing:15,bounds:12,hash:18,loaded:0,minZoom:19,maxZoom:20,zoomOnDoubleClick:21,interactive:22,attributionControl:23,cooperativeGestures:24,preserveDrawingBuffer:25,maxBounds:26,images:27,standardControls:2,filterLayers:28,transformRequest:29},null,[-1,-1])}}function WE(e){let t,n,i,r,l,f,a;const _=e[17].default,x=sr(_,e,e[16],null);return{c(){t=wt("div"),x&&x.c(),Rt(t,"tabindex",n=e[1]?0:void 0),Rt(t,"role",i=e[1]?"button":void 0),gi(t,"z-index",e[2])},m(S,L){Ct(S,t,L),x&&x.m(t,null),l=!0,f||(a=[Q_(e[6].call(null,t)),Q_(r=XE.call(null,t,e[0])),Ze(t,"click",e[18]),Ze(t,"dblclick",e[19]),Ze(t,"contextmenu",e[20]),Ze(t,"mouseenter",e[21]),Ze(t,"mouseleave",e[22]),Ze(t,"mousemove",e[23]),Ze(t,"keydown",e[7])],f=!0)},p(S,[L]){x&&x.p&&(!l||L&65536)&&lr(x,_,S,S[16],l?ar(_,S[16],L,null):ur(S[16]),null),(!l||L&2&&n!==(n=S[1]?0:void 0))&&Rt(t,"tabindex",n),(!l||L&2&&i!==(i=S[1]?"button":void 0))&&Rt(t,"role",i),r&&pg(r.update)&&L&1&&r.update.call(null,S[0]),L&4&&gi(t,"z-index",S[2])},i(S){l||(mt(x,S),l=!0)},o(S){xt(x,S),l=!1},d(S){S&&It(t),x&&x.d(S),f=!1,No(a)}}}function XE(e,t){const n=e.className;function i(r){r?e.className=`${n} ${r}`:e.className=n}return i(t),{update:i}}function HE(e,t,n){let i,r,l,{$$slots:f={},$$scope:a}=t,{lngLat:_}=t,{class:x=void 0}=t,{interactive:S=!0}=t,{asButton:L=!1}=t,{draggable:A=!1}=t,{feature:P=null}=t,{offset:O=void 0}=t,{zIndex:B=void 0}=t,{rotation:U=0}=t;const Y=Dc(),{map:V,layerEvent:$,self:K}=hE();Se(e,V,Gt=>n(25,l=Gt)),Se(e,$,Gt=>n(24,i=Gt)),Se(e,K,Gt=>n(15,r=Gt));function it(Gt){je(K,r=new Ms.Marker({element:Gt,rotation:U,draggable:A,offset:O}).setLngLat(_).addTo(l),r);const Qt=()=>gt("dragstart"),se=()=>{ft(),gt("drag")},Ce=()=>{ft(),gt("dragend")};return A&&(r.on("dragstart",Qt),r.on("drag",se),r.on("dragend",Ce)),{destroy(){A&&(r==null||r.off("dragstart",Qt),r==null||r.off("drag",se),r==null||r.off("dragend",Ce)),r==null||r.remove()}}}function ft(){let Gt=r==null?void 0:r.getLngLat();Gt&&(Array.isArray(_)?n(9,_=[Gt.lng,Gt.lat]):_&&"lon"in _?n(9,_={lon:Gt.lng,lat:Gt.lat}):n(9,_=Gt))}function pt(Gt){Gt.key===" "&&(Gt.preventDefault(),Gt.stopPropagation(),gt("click"))}function gt(Gt){if(!S)return;let Qt=r==null?void 0:r.getLngLat();if(!Qt)return;const se=[Qt.lng,Qt.lat];let Ce={map:l,marker:r,lngLat:se,features:[{type:"Feature",properties:(P==null?void 0:P.properties)??{},geometry:{type:"Point",coordinates:se}}]};je($,i={...Ce,layerType:"marker",type:Gt},i),Y(Gt,Ce)}const ut=()=>gt("click"),St=()=>gt("dblclick"),_t=()=>gt("contextmenu"),vt=Gt=>{gt("mouseenter")},ee=()=>{gt("mouseleave")},kt=()=>gt("mousemove");return e.$$set=Gt=>{"lngLat"in Gt&&n(9,_=Gt.lngLat),"class"in Gt&&n(0,x=Gt.class),"interactive"in Gt&&n(10,S=Gt.interactive),"asButton"in Gt&&n(1,L=Gt.asButton),"draggable"in Gt&&n(11,A=Gt.draggable),"feature"in Gt&&n(12,P=Gt.feature),"offset"in Gt&&n(13,O=Gt.offset),"zIndex"in Gt&&n(2,B=Gt.zIndex),"rotation"in Gt&&n(14,U=Gt.rotation),"$$scope"in Gt&&n(16,a=Gt.$$scope)},e.$$.update=()=>{e.$$.dirty&33280&&(r==null||r.setLngLat(_)),e.$$.dirty&40960&&(r==null||r.setOffset(O??[0,0])),e.$$.dirty&49152&&(r==null||r.setRotation(U))},[x,L,B,V,$,K,it,pt,gt,_,S,A,P,O,U,r,a,f,ut,St,_t,vt,ee,kt]}class Yv extends nn{constructor(t){super(),en(this,t,HE,WE,He,{lngLat:9,class:0,interactive:10,asButton:1,draggable:11,feature:12,offset:13,zIndex:2,rotation:14})}}const YE=e=>({features:e[0]&16,data:e[0]&16,map:e[0]&4,close:e[0]&1}),Kv=e=>{var t;return{features:e[4],data:(t=e[4])==null?void 0:t[0],map:e[2],close:e[31]}};function Jv(e){let t,n,i=(e[4]||e[3]instanceof Ms.Marker)&&Qv(e);return{c(){t=wt("div"),i&&i.c()},m(r,l){Ct(r,t,l),i&&i.m(t,null),e[32](t),n=!0},p(r,l){r[4]||r[3]instanceof Ms.Marker?i?(i.p(r,l),l[0]&24&&mt(i,1)):(i=Qv(r),i.c(),mt(i,1),i.m(t,null)):i&&(ci(),xt(i,1,1,()=>{i=null}),hi())},i(r){n||(mt(i),n=!0)},o(r){xt(i),n=!1},d(r){r&&It(t),i&&i.d(),e[32](null)}}}function Qv(e){let t;const n=e[30].default,i=sr(n,e,e[29],Kv);return{c(){i&&i.c()},m(r,l){i&&i.m(r,l),t=!0},p(r,l){i&&i.p&&(!t||l[0]&536870933)&&lr(i,n,r,r[29],t?ar(n,r[29],l,YE):ur(r[29]),Kv)},i(r){t||(mt(i,r),t=!0)},o(r){xt(i,r),t=!1},d(r){i&&i.d(r)}}}function KE(e){let t,n,i=e[9].default&&Jv(e);return{c(){i&&i.c(),t=ts()},m(r,l){i&&i.m(r,l),Ct(r,t,l),n=!0},p(r,l){r[9].default?i?(i.p(r,l),l[0]&512&&mt(i,1)):(i=Jv(r),i.c(),mt(i,1),i.m(t.parentNode,t)):i&&(ci(),xt(i,1,1,()=>{i=null}),hi())},i(r){n||(mt(i),n=!0)},o(r){xt(i),n=!1},d(r){r&&It(t),i&&i.d(r)}}}function JE(e,t,n){let i,r,l,f,a,_,{$$slots:x={},$$scope:S}=t;const L=MS(x);let{closeButton:A=void 0}=t,{closeOnClickOutside:P=!0}=t,{closeOnClickInside:O=!1}=t,{closeOnMove:B=!1}=t,{openOn:U="click"}=t,{openIfTopMost:Y=!0}=t,{focusAfterOpen:V=!0}=t,{anchor:$=void 0}=t,{offset:K=void 0}=t,{popupClass:it=void 0}=t,{maxWidth:ft=void 0}=t,{lngLat:pt=void 0}=t,{html:gt=void 0}=t,{open:ut=!1}=t;const{map:St,popupTarget:_t,layerEvent:vt,layer:ee,eventTopMost:kt}=sf();Se(e,St,yt=>n(2,l=yt)),Se(e,_t,yt=>n(3,a=yt)),Se(e,vt,yt=>n(28,f=yt)),Se(e,ee,yt=>n(35,_=yt));const Gt=["click","dblclick","contextmenu"];let Qt,se=!1,Ce;function yn(){if(!Qt)return;let yt=Qt.getElement();!yt||yt===Ce||(Ce=yt,U==="hover"&&(Ce.style.pointerEvents="none"),Ce.addEventListener("mouseenter",()=>{n(24,se=!0)},{passive:!0}),Ce.addEventListener("mouseleave",()=>{n(24,se=!1)},{passive:!0}),Ce.addEventListener("click",()=>{O&&n(0,ut=!1)},{passive:!0}))}dg(()=>{if(l)return l.on("click",hn),l.on("contextmenu",hn),typeof a=="string"&&(l.on("click",a,ke),l.on("dblclick",a,ke),l.on("contextmenu",a,ke),l.on("mousemove",a,De),l.on("mouseleave",a,re),l.on("touchstart",a,Kn),l.on("touchend",a,qn)),()=>{l!=null&&l.loaded()&&(Qt==null||Qt.remove(),l.off("click",hn),l.off("contextmenu",hn),a instanceof Ms.Marker?a.getPopup()===Qt&&a.setPopup(void 0):typeof a=="string"&&(l.off("click",a,ke),l.off("dblclick",a,ke),l.off("contextmenu",a,ke),l.off("mousemove",a,De),l.off("mouseleave",a,re),l.off("touchstart",a,Kn),l.off("touchend",a,qn)))}});function jn(yt){return Y?!("marker"in yt)&&!fE(yt)&&kt(yt)!==_:!1}let Qe=null,Fe="normal";function ke(yt){yt.type===U&&(jn(yt)||("layerType"in yt?yt.layerType==="deckgl"?(n(10,pt=yt.coordinate),n(4,Qe=yt.object?[yt.object]:null)):(n(10,pt=yt.lngLat),n(4,Qe=yt.features??[])):(n(10,pt=yt.lngLat),n(4,Qe=yt.features??[])),setTimeout(()=>n(0,ut=!0))))}let fn=null;function Kn(yt){fn=yt.point}function qn(yt){if(!fn||U!=="hover")return;let Ee=fn.dist(yt.point);fn=null,Ee<3&&(n(10,pt=yt.lngLat),n(4,Qe=yt.features??[]),Qt.isOpen()?n(25,Fe="justOpened"):(n(25,Fe="opening"),n(0,ut=!0)))}function re(yt){U!=="hover"||fn||Fe!=="normal"||(n(0,ut=!1),n(4,Qe=null))}function De(yt){if(!(U!=="hover"||fn||Fe!=="normal")){if(jn(yt)){n(0,ut=!1),n(4,Qe=null);return}n(0,ut=!0),n(4,Qe=yt.features??[]),n(10,pt=yt.lngLat)}}function hn(yt){if(Fe==="justOpened"){n(25,Fe="normal");return}if(!P)return;let Ee=[Ce,a instanceof Ms.Marker?a==null?void 0:a.getElement():null];ut&&Qt.isOpen()&&!Ee.some(qe=>qe==null?void 0:qe.contains(yt.originalEvent.target))&&(yt.type==="contextmenu"&&U==="contextmenu"||yt.type!=="contextmenu")&&n(0,ut=!1)}aa(()=>{l&&(Qt!=null&&Qt.isOpen())&&Qt.remove()});let On;const yi=()=>n(0,ut=!1);function wn(yt){cr[yt?"unshift":"push"](()=>{On=yt,n(1,On)})}return e.$$set=yt=>{"closeButton"in yt&&n(11,A=yt.closeButton),"closeOnClickOutside"in yt&&n(12,P=yt.closeOnClickOutside),"closeOnClickInside"in yt&&n(13,O=yt.closeOnClickInside),"closeOnMove"in yt&&n(14,B=yt.closeOnMove),"openOn"in yt&&n(15,U=yt.openOn),"openIfTopMost"in yt&&n(16,Y=yt.openIfTopMost),"focusAfterOpen"in yt&&n(17,V=yt.focusAfterOpen),"anchor"in yt&&n(18,$=yt.anchor),"offset"in yt&&n(19,K=yt.offset),"popupClass"in yt&&n(20,it=yt.popupClass),"maxWidth"in yt&&n(21,ft=yt.maxWidth),"lngLat"in yt&&n(10,pt=yt.lngLat),"html"in yt&&n(22,gt=yt.html),"open"in yt&&n(0,ut=yt.open),"$$scope"in yt&&n(29,S=yt.$$scope)},e.$$.update=()=>{if(e.$$.dirty[0]&14336&&n(27,i=A??(!P&&!O)),e.$$.dirty[0]&146685952&&(Qt||(n(23,Qt=new Ms.Popup({closeButton:i,closeOnClick:!1,closeOnMove:B,focusAfterOpen:V,maxWidth:ft,className:it,anchor:$,offset:K})),Ce=Qt.getElement(),Qt.on("open",()=>{n(0,ut=!0),yn()}),Qt.on("close",yt=>{n(0,ut=!1)}))),e.$$.dirty[0]&8421384&&Qt&&a instanceof Ms.Marker&&(U==="click"?a.setPopup(Qt):a.getPopup()===Qt&&a.setPopup(void 0)),e.$$.dirty[0]&268468224&&Gt.includes(U)&&(f==null?void 0:f.type)===U&&(ke(f),je(vt,f=null,f)),e.$$.dirty[0]&268468224&&n(26,r=U==="hover"&&((f==null?void 0:f.type)==="mousemove"||(f==null?void 0:f.type)==="mouseenter")),e.$$.dirty[0]&352354304&&U==="hover"&&vt&&(r&&f&&(f.layerType==="deckgl"?(n(10,pt=f.coordinate),n(4,Qe=f.object?[f.object]:null)):(n(10,pt=f.lngLat),n(4,Qe=f.features??[]))),n(0,ut=(r||se)??!1)),e.$$.dirty[0]&12582914&&(On?Qt.setDOMContent(On):gt&&Qt.setHTML(gt)),e.$$.dirty[0]&8389632&&pt&&Qt.setLngLat(pt),e.$$.dirty[0]&41943045&&l){let yt=Qt.isOpen();ut&&!yt?(Qt.addTo(l),Fe==="opening"&&n(25,Fe="justOpened")):!ut&&yt&&Qt.remove()}},[ut,On,l,a,Qe,St,_t,vt,ee,L,pt,A,P,O,B,U,Y,V,$,K,it,ft,gt,Qt,se,Fe,r,i,f,S,x,yi,wn]}class QE extends nn{constructor(t){super(),en(this,t,JE,KE,He,{closeButton:11,closeOnClickOutside:12,closeOnClickInside:13,closeOnMove:14,openOn:15,openIfTopMost:16,focusAfterOpen:17,anchor:18,offset:19,popupClass:20,maxWidth:21,lngLat:10,html:22,open:0},null,[-1,-1])}}function tI(e){let t;const n=e[16].default,i=sr(n,e,e[24],null);return{c(){i&&i.c()},m(r,l){i&&i.m(r,l),t=!0},p(r,l){i&&i.p&&(!t||l&16777216)&&lr(i,n,r,r[24],t?ar(n,r[24],l,null):ur(r[24]),null)},i(r){t||(mt(i,r),t=!0)},o(r){xt(i,r),t=!1},d(r){i&&i.d(r)}}}function eI(e){let t,n,i;function r(f){e[17](f)}let l={id:e[1],type:"symbol",source:e[2],sourceLayer:e[3],beforeId:e[4],beforeLayerType:e[5],paint:e[6],layout:e[7],filter:e[8],applyToClusters:e[9],minzoom:e[10],maxzoom:e[11],hoverCursor:e[12],manageHoverState:e[13],eventsIfTopMost:e[14],interactive:e[15],$$slots:{default:[tI]},$$scope:{ctx:e}};return e[0]!==void 0&&(l.hovered=e[0]),t=new gg({props:l}),cr.push(()=>vc(t,"hovered",r)),t.$on("click",e[18]),t.$on("dblclick",e[19]),t.$on("contextmenu",e[20]),t.$on("mouseenter",e[21]),t.$on("mousemove",e[22]),t.$on("mouseleave",e[23]),{c(){Zt(t.$$.fragment)},m(f,a){jt(t,f,a),i=!0},p(f,[a]){const _={};a&2&&(_.id=f[1]),a&4&&(_.source=f[2]),a&8&&(_.sourceLayer=f[3]),a&16&&(_.beforeId=f[4]),a&32&&(_.beforeLayerType=f[5]),a&64&&(_.paint=f[6]),a&128&&(_.layout=f[7]),a&256&&(_.filter=f[8]),a&512&&(_.applyToClusters=f[9]),a&1024&&(_.minzoom=f[10]),a&2048&&(_.maxzoom=f[11]),a&4096&&(_.hoverCursor=f[12]),a&8192&&(_.manageHoverState=f[13]),a&16384&&(_.eventsIfTopMost=f[14]),a&32768&&(_.interactive=f[15]),a&16777216&&(_.$$scope={dirty:a,ctx:f}),!n&&a&1&&(n=!0,_.hovered=f[0],yc(()=>n=!1)),t.$set(_)},i(f){i||(mt(t.$$.fragment,f),i=!0)},o(f){xt(t.$$.fragment,f),i=!1},d(f){qt(t,f)}}}function nI(e,t,n){let{$$slots:i={},$$scope:r}=t,{id:l=of("symbol")}=t,{source:f=void 0}=t,{sourceLayer:a=void 0}=t,{beforeId:_=void 0}=t,{beforeLayerType:x=void 0}=t,{paint:S=void 0}=t,{layout:L=void 0}=t,{filter:A=void 0}=t,{applyToClusters:P=void 0}=t,{minzoom:O=void 0}=t,{maxzoom:B=void 0}=t,{hoverCursor:U=void 0}=t,{manageHoverState:Y=!1}=t,{hovered:V=null}=t,{eventsIfTopMost:$=!1}=t,{interactive:K=!0}=t;function it(vt){V=vt,n(0,V)}function ft(vt){ii.call(this,e,vt)}function pt(vt){ii.call(this,e,vt)}function gt(vt){ii.call(this,e,vt)}function ut(vt){ii.call(this,e,vt)}function St(vt){ii.call(this,e,vt)}function _t(vt){ii.call(this,e,vt)}return e.$$set=vt=>{"id"in vt&&n(1,l=vt.id),"source"in vt&&n(2,f=vt.source),"sourceLayer"in vt&&n(3,a=vt.sourceLayer),"beforeId"in vt&&n(4,_=vt.beforeId),"beforeLayerType"in vt&&n(5,x=vt.beforeLayerType),"paint"in vt&&n(6,S=vt.paint),"layout"in vt&&n(7,L=vt.layout),"filter"in vt&&n(8,A=vt.filter),"applyToClusters"in vt&&n(9,P=vt.applyToClusters),"minzoom"in vt&&n(10,O=vt.minzoom),"maxzoom"in vt&&n(11,B=vt.maxzoom),"hoverCursor"in vt&&n(12,U=vt.hoverCursor),"manageHoverState"in vt&&n(13,Y=vt.manageHoverState),"hovered"in vt&&n(0,V=vt.hovered),"eventsIfTopMost"in vt&&n(14,$=vt.eventsIfTopMost),"interactive"in vt&&n(15,K=vt.interactive),"$$scope"in vt&&n(24,r=vt.$$scope)},[V,l,f,a,_,x,S,L,A,P,O,B,U,Y,$,K,i,it,ft,pt,gt,ut,St,_t,r]}class iI extends nn{constructor(t){super(),en(this,t,nI,eI,He,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}var fd=Uint8Array,rx=Uint16Array,rI=Int32Array,oI=new fd([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),sI=new fd([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),ox=function(e,t){for(var n=new rx(31),i=0;i<31;++i)n[i]=t+=1<<e[i-1];for(var r=new rI(n[30]),i=1;i<30;++i)for(var l=n[i];l<n[i+1];++l)r[l]=l-n[i]<<5|i;return{b:n,r}},sx=ox(oI,2),aI=sx.b,lI=sx.r;aI[28]=258,lI[258]=28;ox(sI,0);var uI=new rx(32768);for(ni=0;ni<32768;++ni)Bl=(ni&43690)>>1|(ni&21845)<<1,Bl=(Bl&52428)>>2|(Bl&13107)<<2,Bl=(Bl&61680)>>4|(Bl&3855)<<4,uI[ni]=((Bl&65280)>>8|(Bl&255)<<8)>>1;var Bl,ni,_g=new fd(288);for(ni=0;ni<144;++ni)_g[ni]=8;var ni;for(ni=144;ni<256;++ni)_g[ni]=9;var ni;for(ni=256;ni<280;++ni)_g[ni]=7;var ni;for(ni=280;ni<288;++ni)_g[ni]=8;var ni,cI=new fd(32);for(ni=0;ni<32;++ni)cI[ni]=5;var ni,hI=new fd(0),fI=typeof TextDecoder<"u"&&new TextDecoder,pI=0;try{fI.decode(hI,{stream:!0}),pI=1}catch{}const ax=li({type:"FeatureCollection",features:[]}),dI=li(!0),lx=li(0),mI=30;class gI{constructor(t,n){Zn(this,"map");Zn(this,"inner");Zn(this,"active");Zn(this,"eventListenersSuccess");Zn(this,"eventListenersUpdated");Zn(this,"eventListenersFailure");Zn(this,"onMouseMove",t=>{if(!this.active)return;const n=[t.point.x-mI,t.point.y],i=this.map.unproject(t.point).distanceTo(this.map.unproject(n));this.inner.onMouseMove(t.lngLat.lng,t.lngLat.lat,i)&&(this.redraw(),this.dataUpdated())});Zn(this,"onClick",()=>{this.active&&(this.inner.onClick(),this.redraw(),this.dataUpdated())});Zn(this,"onDoubleClick",t=>{this.active&&(t.preventDefault(),this.inner.onClick(),this.finish())});Zn(this,"onDragStart",()=>{this.active&&this.inner.onDragStart()&&this.map.dragPan.disable()});Zn(this,"onMouseUp",()=>{this.active&&this.inner.onMouseUp()&&this.map.dragPan.enable()});Zn(this,"onKeyDown",t=>{this.active&&t.key=="Escape"&&(t.stopPropagation(),this.cancel())});Zn(this,"onKeyPress",t=>{this.active&&t.target.tagName!="INPUT"&&(t.key=="Enter"?(t.stopPropagation(),this.finish()):t.key=="s"?(t.stopPropagation(),this.inner.toggleSnapMode(),this.redraw()):t.key=="z"&&t.ctrlKey&&this.undo())});this.map=t,console.time("Deserialize and setup JsRouteSnapper"),this.inner=new Wm(n),console.timeEnd("Deserialize and setup JsRouteSnapper"),this.active=!1,this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[],this.map.on("mousemove",this.onMouseMove),this.map.on("click",this.onClick),this.map.on("dblclick",this.onDoubleClick),this.map.on("dragstart",this.onDragStart),this.map.on("mouseup",this.onMouseUp),document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keypress",this.onKeyPress)}tearDown(){this.map.off("mousemove",this.onMouseMove),this.map.off("click",this.onClick),this.map.off("dblclick",this.onDoubleClick),this.map.off("dragstart",this.onDragStart),this.map.off("mouseup",this.onMouseUp),document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keypress",this.onKeyPress)}startRoute(){this.active||(this.active=!0,this.map.boxZoom.disable(),this.map.doubleClickZoom.disable())}startArea(){this.active||(this.inner.setAreaMode(),this.active=!0,this.map.boxZoom.disable(),this.map.doubleClickZoom.disable())}stop(){this.active=!1,this.inner.clearState(),this.redraw(),this.map.boxZoom.enable(),this.map.doubleClickZoom.enable()}editExistingRoute(t){t.properties??(t.properties={}),this.active&&window.alert("Bug: editExistingRoute called when tool is already active"),t.properties.waypoints||(t.properties.waypoints=[{lon:t.geometry.coordinates[0][0],lat:t.geometry.coordinates[0][1],snapped:!0},{lon:t.geometry.coordinates[t.geometry.coordinates.length-1][0],lat:t.geometry.coordinates[t.geometry.coordinates.length-1][1],snapped:!0}]),this.startRoute(),this.inner.editExisting(t.properties.waypoints),this.redraw()}editExistingArea(t){t.properties??(t.properties={}),this.active&&window.alert("Bug: editExistingArea called when tool is already active"),t.properties.waypoints||window.alert("Bug: editExistingArea called for a polygon not produced by the route-snapper"),this.startArea(),this.inner.editExisting(t.properties.waypoints),this.redraw()}addEventListenerSuccess(t){this.eventListenersSuccess.push(t)}addEventListenerUpdated(t){this.eventListenersUpdated.push(t)}addEventListenerFailure(t){this.eventListenersFailure.push(t)}clearEventListeners(){this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[]}isActive(){return this.active}finish(){let t=this.inner.toFinalFeature();if(t)for(let n of this.eventListenersSuccess)n(JSON.parse(t));else for(let n of this.eventListenersFailure)n();this.stop()}cancel(){this.inner.clearState(),this.finish()}setRouteConfig(t){this.inner.setRouteConfig(t),this.redraw()}addSnappedWaypoint(t){this.inner.addSnappedWaypoint(t[0],t[1]),this.redraw()}undo(){this.inner.undo(),this.redraw()}redraw(){let t=JSON.parse(this.inner.renderGeojson());ax.set(t),this.map.getCanvas().style.cursor=t.cursor,dI.set(t.snap_mode),lx.set(t.undo_length)}dataUpdated(){let t=this.inner.toFinalFeature();if(t)for(let n of this.eventListenersUpdated)n(JSON.parse(t))}}const ky="MZEJTanw3WpxRvt7qDfo";let Du=li(null),ux=li(`https://api.maptiler.com/maps/dataviz/style.json?key=${ky}`),Pu=li(""),Hm=li(!0),oy=li(null),sy=li(null),ay=li(null),Wo=li(null),qp=li(null),Ym=li(new mg.LngLat(0,0)),Km=li(new mg.LngLat(0,0)),gc=li(1),xn=li({mode:"title"}),ly=li("walk_cycle_only");function _I(e){let t,n,i,r,l,f,a,_,x;return{c(){t=wt("label"),n=ge(`Basemap:
  `),i=wt("select"),r=wt("option"),r.textContent="MapTiler Dataviz",l=wt("option"),l.textContent="MapTiler Streets",f=wt("option"),f.textContent="MapTiler Satellite",a=wt("option"),a.textContent="OS Open Zoomstack",r.__value="dataviz",ql(r,r.__value),l.__value="streets",ql(l,l.__value),f.__value="hybrid",ql(f,f.__value),a.__value="uk-openzoomstack-light",ql(a,a.__value),e[0]===void 0&&jp(()=>e[1].call(i))},m(S,L){Ct(S,t,L),dt(t,n),dt(t,i),dt(i,r),dt(i,l),dt(i,f),dt(i,a),$m(i,e[0],!0),_||(x=Ze(i,"change",e[1]),_=!0)},p(S,[L]){L&1&&$m(i,S[0])},i:Ie,o:Ie,d(S){S&&It(t),_=!1,x()}}}function yI(e,t,n){let i="dataviz";function r(){i=Gb(this),n(0,i)}return e.$$.update=()=>{e.$$.dirty&1&&ux.set(`https://api.maptiler.com/maps/${i}/style.json?key=${ky}`)},[i,r]}class vI extends nn{constructor(t){super(),en(this,t,yI,_I,He,{})}}var bI=Object.defineProperty,xI=(e,t,n)=>t in e?bI(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,t1=(e,t,n)=>(xI(e,typeof t!="symbol"?t+"":t,n),n);function Zp(){}function cx(e){return e()}function e1(){return Object.create(null)}function yg(e){e.forEach(cx)}function hx(e){return typeof e=="function"}function wI(e,t){return e!=e?t==t:e!==t||e&&typeof e=="object"||typeof e=="function"}function SI(e){return Object.keys(e).length===0}function EI(e,t){e.appendChild(t)}function II(e,t,n){e.insertBefore(t,n||null)}function fx(e){e.parentNode&&e.parentNode.removeChild(e)}function n1(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function Iu(e,t,n){n==null?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function CI(e){return Array.from(e.childNodes)}function km(e,t,n){e.classList.toggle(t,!!n)}let Ay;function Vp(e){Ay=e}const kh=[],i1=[];let Rh=[];const r1=[],TI=Promise.resolve();let uy=!1;function LI(){uy||(uy=!0,TI.then(px))}function cy(e){Rh.push(e)}const W_=new Set;let Th=0;function px(){if(Th!==0)return;const e=Ay;do{try{for(;Th<kh.length;){const t=kh[Th];Th++,Vp(t),MI(t.$$)}}catch(t){throw kh.length=0,Th=0,t}for(Vp(null),kh.length=0,Th=0;i1.length;)i1.pop()();for(let t=0;t<Rh.length;t+=1){const n=Rh[t];W_.has(n)||(W_.add(n),n())}Rh.length=0}while(kh.length);for(;r1.length;)r1.pop()();uy=!1,W_.clear(),Vp(e)}function MI(e){if(e.fragment!==null){e.update(),yg(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(cy)}}function PI(e){const t=[],n=[];Rh.forEach(i=>e.indexOf(i)===-1?t.push(i):n.push(i)),n.forEach(i=>i()),Rh=t}const kI=new Set;function AI(e,t){e&&e.i&&(kI.delete(e),e.i(t))}function NI(e,t,n){const{fragment:i,after_update:r}=e.$$;i&&i.m(t,n),cy(()=>{const l=e.$$.on_mount.map(cx).filter(hx);e.$$.on_destroy?e.$$.on_destroy.push(...l):yg(l),e.$$.on_mount=[]}),r.forEach(cy)}function DI(e,t){const n=e.$$;n.fragment!==null&&(PI(n.after_update),yg(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function RI(e,t){e.$$.dirty[0]===-1&&(kh.push(e),LI(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function OI(e,t,n,i,r,l,f=null,a=[-1]){const _=Ay;Vp(e);const x=e.$$={fragment:null,ctx:[],props:l,update:Zp,not_equal:r,bound:e1(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(_?_.$$.context:[])),callbacks:e1(),dirty:a,skip_bound:!1,root:t.target||_.$$.root};f&&f(x.root);let S=!1;if(x.ctx=n?n(e,t.props||{},(L,A,...P)=>{const O=P.length?P[0]:A;return x.ctx&&r(x.ctx[L],x.ctx[L]=O)&&(!x.skip_bound&&x.bound[L]&&x.bound[L](O),S&&RI(e,L)),A}):[],x.update(),S=!0,yg(x.before_update),x.fragment=i?i(x.ctx):!1,t.target){if(t.hydrate){const L=CI(t.target);x.fragment&&x.fragment.l(L),L.forEach(fx)}else x.fragment&&x.fragment.c();t.intro&&AI(e.$$.fragment),NI(e,t.target,t.anchor),px()}Vp(_)}class zI{constructor(){t1(this,"$$"),t1(this,"$$set")}$destroy(){DI(this,1),this.$destroy=Zp}$on(t,n){if(!hx(n))return Zp;const i=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return i.push(n),()=>{const r=i.indexOf(n);r!==-1&&i.splice(r,1)}}$set(t){this.$$set&&!SI(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const FI="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(FI);function BI(e){let t,n,i;return{c(){t=n1("svg"),n=n1("path"),Iu(n,"stroke-width","4"),Iu(n,"d","M 5,33.103579 C 5,17.607779 18.457,5 35,5 C 51.543,5 65,17.607779 65,33.103579 C 65,56.388679 40.4668,76.048179 36.6112,79.137779 C 36.3714,79.329879 36.2116,79.457979 36.1427,79.518879 C 35.8203,79.800879 35.4102,79.942779 35,79.942779 C 34.5899,79.942779 34.1797,79.800879 33.8575,79.518879 C 33.7886,79.457979 33.6289,79.330079 33.3893,79.138079 C 29.5346,76.049279 5,56.389379 5,33.103579 Z M 35.0001,49.386379 C 43.1917,49.386379 49.8323,42.646079 49.8323,34.331379 C 49.8323,26.016779 43.1917,19.276479 35.0001,19.276479 C 26.8085,19.276479 20.1679,26.016779 20.1679,34.331379 C 20.1679,42.646079 26.8085,49.386379 35.0001,49.386379 Z"),Iu(n,"class","svelte-gzo3ar"),Iu(t,"width",i=e[0]==="list"?20:void 0),Iu(t,"viewBox","0 0 70 85"),Iu(t,"fill","none"),Iu(t,"class","svelte-gzo3ar"),km(t,"in-map",e[0]!=="list"),km(t,"list-icon",e[0]==="list")},m(r,l){II(r,t,l),EI(t,n)},p(r,[l]){l&1&&i!==(i=r[0]==="list"?20:void 0)&&Iu(t,"width",i),l&1&&km(t,"in-map",r[0]!=="list"),l&1&&km(t,"list-icon",r[0]==="list")},i:Zp,o:Zp,d(r){r&&fx(t)}}}function VI(e,t,n){let{displayIn:i}=t;return e.$$set=r=>{"displayIn"in r&&n(0,i=r.displayIn)},[i]}class UI extends zI{constructor(t){super(),OI(this,t,VI,BI,wI,{displayIn:0})}}const GI=[{verbatimCoordinates:"40.123, -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123 N 74.123 W",verbatimLatitude:"40.123 N",verbatimLongitude:"74.123 W"},{verbatimCoordinates:"40.123 N 74.123 W",verbatimLatitude:"40.123 N",verbatimLongitude:"74.123 W"},{verbatimCoordinates:'40 7 22.8" N 74 7 22.8" W',verbatimLatitude:'40 7 22.8" N',verbatimLongitude:'74 7 22.8" W'},{verbatimCoordinates:"40 7.38 , -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"N40722.8, W74722.8",verbatimLatitude:"N40722.8",verbatimLongitude:"W74722.8"},{verbatimCoordinates:'40722.8"N, 74722.8"W',verbatimLatitude:'40722.8"N',verbatimLongitude:'74722.8"W'},{verbatimCoordinates:`407'22.8"N, 747'22.8"W`,verbatimLatitude:`407'22.8"N`,verbatimLongitude:`747'22.8"W`},{verbatimCoordinates:"40 7 22.8, -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"},{verbatimCoordinates:"40.123 -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123,-74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123N74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"4007.38N7407.38W",verbatimLatitude:"4007.38N",verbatimLongitude:"7407.38W"},{verbatimCoordinates:'40722.8"N, 74722.8"W',verbatimLatitude:'40722.8"N',verbatimLongitude:'74722.8"W'},{verbatimCoordinates:"400722.8N740722.8W",verbatimLatitude:"400722.8N",verbatimLongitude:"740722.8W"},{verbatimCoordinates:"N 40 7.38 W 74 7.38",verbatimLatitude:"N 40 7.38",verbatimLongitude:"W 74 7.38"},{verbatimCoordinates:"40:7:22.8N 74:7:22.8W",verbatimLatitude:"40:7:22.8N",verbatimLongitude:"74:7:22.8W"},{verbatimCoordinates:"40:7:23N,74:7:23W",verbatimLatitude:"40:7:23N",verbatimLongitude:"74:7:23W",decimalLatitude:40.1230555555,decimalLongitude:-74.1230555555},{verbatimCoordinates:'40723"N 74723"W',verbatimLatitude:'40723"N',verbatimLongitude:'74723"W',decimalLatitude:40.1230555555,decimalLongitude:-74.12305555555555},{verbatimCoordinates:'40723"S 74723"E',verbatimLatitude:'40723"S',verbatimLongitude:'74723"E',decimalLatitude:-40.1230555555,decimalLongitude:74.12305555555555},{verbatimCoordinates:'40723" -74723"',verbatimLatitude:'40723"',verbatimLongitude:'-74723"',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:'40d 7 23" N 74d 7 23" W',verbatimLatitude:'40d 7 23" N',verbatimLongitude:'74d 7 23" W',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:"40.123N 74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"40 7.38, -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"40 7.38, -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"40 7 22.8; -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"}],jI={decimalLatitude:40.123,decimalLongitude:-74.123},qI=[{verbatimCoordinates:`504'17.698"south, 1424'2.826"east`,verbatimLatitude:`504'17.698"south`,verbatimLongitude:`1424'2.826"east`,decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"50d4m17.698S 14d24m2.826E",verbatimLatitude:"50d4m17.698S",verbatimLongitude:"14d24m2.826E",decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"40:26:46N,79:56:55W",verbatimLatitude:"40:26:46N",verbatimLongitude:"79:56:55W",decimalLatitude:40.44611111111111,decimalLongitude:-79.9486111111111},{verbatimCoordinates:"40:26:46.302N 79:56:55.903W",verbatimLatitude:"40:26:46.302N",verbatimLongitude:"79:56:55.903W",decimalLatitude:40.446195,decimalLongitude:-79.94886194444445},{verbatimCoordinates:"402647N 795836W",verbatimLatitude:"402647N",verbatimLongitude:"795836W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40d 26 47 N 79d 58 36 W",verbatimLatitude:"40d 26 47 N",verbatimLongitude:"79d 58 36 W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40.446195N 79.948862W",verbatimLatitude:"40.446195N",verbatimLongitude:"79.948862W",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40,446195 79,948862",verbatimLatitude:"40,446195",verbatimLongitude:"79,948862",decimalLatitude:40.446195,decimalLongitude:79.948862},{verbatimCoordinates:"40 26.7717, -79 56.93172",verbatimLatitude:"40 26.7717",verbatimLongitude:"-79 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.446195, -79.948862",verbatimLatitude:"40.446195",verbatimLongitude:"-79.948862",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.123256; -74.123256",verbatimLatitude:"40.123256",verbatimLongitude:"-74.123256",decimalLatitude:40.123256,decimalLongitude:-74.123256},{verbatimCoordinates:"1824S 2245E",verbatimLatitude:"1824S",verbatimLongitude:"2245E",decimalLatitude:-18.4,decimalLongitude:22.75}],ZI=[{verbatimCoordinates:"10.432342S 10.6345345E",verbatimLatitude:"10.432342S",verbatimLongitude:"10.6345345E",decimalLatitude:-10.432342,decimalLongitude:10.6345345},{verbatimCoordinates:"10.00S 10.00E",verbatimLatitude:"10.00S",verbatimLongitude:"10.00E",decimalLatitude:-10,decimalLongitude:10},{verbatimCoordinates:"00.00S 01.00E",verbatimLatitude:"00.00S",verbatimLongitude:"01.00E",decimalLatitude:0,decimalLongitude:1},{verbatimCoordinates:"18.24S 22.45E",verbatimLatitude:"18.24S",verbatimLongitude:"22.45E",decimalLatitude:-18.4,decimalLongitude:22.75},{verbatimCoordinates:"27deg 15min 45.2sec S 18deg 32min 53.7sec E",verbatimLatitude:"27deg 15min 45.2sec S",verbatimLongitude:"18deg 32min 53.7sec E",decimalLatitude:-27.262555555555554,decimalLongitude:18.54825},{verbatimCoordinates:"-23.3245 S / 28.2344 E",verbatimLatitude:"-23.3245 S",verbatimLongitude:"28.2344 E",decimalLatitude:-23.3245,decimalLongitude:28.2344},{verbatimCoordinates:"40 26.7717 -79 56.93172",verbatimLatitude:"40 26.7717",verbatimLongitude:"-79 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"27.15.45S 18.32.53E",verbatimLatitude:"27.15.45S",verbatimLongitude:"18.32.53E",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"-27.15.45 18.32.53",verbatimLatitude:"-27.15.45",verbatimLongitude:"18.32.53",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"27.15.45.2S 18.32.53.4E",verbatimLatitude:"27.15.45.2S",verbatimLongitude:"18.32.53.4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"27.15.45,2S 18.32.53,4E",verbatimLatitude:"27.15.45,2S",verbatimLongitude:"18.32.53,4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"S23.43563   E22.45634 ",verbatimLatitude:"S23.43563 ",verbatimLongitude:"E22.45634 ",decimalLatitude:-23.43563,decimalLongitude:22.45634},{verbatimCoordinates:"27,71372 S 23,07771 E",verbatimLatitude:"27,71372 S",verbatimLongitude:"23,07771 E",decimalLatitude:-27.71372,decimalLongitude:23.07771},{verbatimCoordinates:"27.45.34 S 23.23.23 E",verbatimLatitude:"27.45.34 S",verbatimLongitude:"23.23.23 E",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"S 27.45.34 E 23.23.23",verbatimLatitude:"S 27.45.34",verbatimLongitude:"E 23.23.23",decimalLatitude:-27.759444,decimalLongitude:23.38972222}];function $I(){const e=[];return GI.forEach(t=>{t.decimalLatitude?e.push(t):e.push({...t,...jI})}),[...e,...qI,...ZI]}const WI=$I();WI.map(e=>e.verbatimCoordinates);/**
 * splaytree v3.1.2
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function XI(e,t){var n={label:0,sent:function(){if(l[0]&1)throw l[1];return l[1]},trys:[],ops:[]},i,r,l,f;return f={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(f[Symbol.iterator]=function(){return this}),f;function a(x){return function(S){return _([x,S])}}function _(x){if(i)throw new TypeError("Generator is already executing.");for(;n;)try{if(i=1,r&&(l=x[0]&2?r.return:x[0]?r.throw||((l=r.return)&&l.call(r),0):r.next)&&!(l=l.call(r,x[1])).done)return l;switch(r=0,l&&(x=[x[0]&2,l.value]),x[0]){case 0:case 1:l=x;break;case 4:return n.label++,{value:x[1],done:!1};case 5:n.label++,r=x[1],x=[0];continue;case 7:x=n.ops.pop(),n.trys.pop();continue;default:if(l=n.trys,!(l=l.length>0&&l[l.length-1])&&(x[0]===6||x[0]===2)){n=0;continue}if(x[0]===3&&(!l||x[1]>l[0]&&x[1]<l[3])){n.label=x[1];break}if(x[0]===6&&n.label<l[1]){n.label=l[1],l=x;break}if(l&&n.label<l[2]){n.label=l[2],n.ops.push(x);break}l[2]&&n.ops.pop(),n.trys.pop();continue}x=t.call(e,n)}catch(S){x=[6,S],r=0}finally{i=l=0}if(x[0]&5)throw x[1];return{value:x[0]?x[1]:void 0,done:!0}}}var Ru=function(){function e(t,n){this.next=null,this.key=t,this.data=n,this.left=null,this.right=null}return e}();function HI(e,t){return e>t?1:e<t?-1:0}function Lu(e,t,n){for(var i=new Ru(null,null),r=i,l=i;;){var f=n(e,t.key);if(f<0){if(t.left===null)break;if(n(e,t.left.key)<0){var a=t.left;if(t.left=a.right,a.right=t,t=a,t.left===null)break}l.left=t,l=t,t=t.left}else if(f>0){if(t.right===null)break;if(n(e,t.right.key)>0){var a=t.right;if(t.right=a.left,a.left=t,t=a,t.right===null)break}r.right=t,r=t,t=t.right}else break}return r.right=t.left,l.left=t.right,t.left=i.right,t.right=i.left,t}function X_(e,t,n,i){var r=new Ru(e,t);if(n===null)return r.left=r.right=null,r;n=Lu(e,n,i);var l=i(e,n.key);return l<0?(r.left=n.left,r.right=n,n.left=null):l>=0&&(r.right=n.right,r.left=n,n.right=null),r}function o1(e,t,n){var i=null,r=null;if(t){t=Lu(e,t,n);var l=n(t.key,e);l===0?(i=t.left,r=t.right):l<0?(r=t.right,t.right=null,i=t):(i=t.left,t.left=null,r=t)}return{left:i,right:r}}function YI(e,t,n){return t===null?e:(e===null||(t=Lu(e.key,t,n),t.left=e),t)}function hy(e,t,n,i,r){if(e){i(""+t+(n?" ":" ")+r(e)+`
`);var l=t+(n?"    ":"   ");e.left&&hy(e.left,l,!1,i,r),e.right&&hy(e.right,l,!0,i,r)}}var Ny=function(){function e(t){t===void 0&&(t=HI),this._root=null,this._size=0,this._comparator=t}return e.prototype.insert=function(t,n){return this._size++,this._root=X_(t,n,this._root,this._comparator)},e.prototype.add=function(t,n){var i=new Ru(t,n);this._root===null&&(i.left=i.right=null,this._size++,this._root=i);var r=this._comparator,l=Lu(t,this._root,r),f=r(t,l.key);return f===0?this._root=l:(f<0?(i.left=l.left,i.right=l,l.left=null):f>0&&(i.right=l.right,i.left=l,l.right=null),this._size++,this._root=i),this._root},e.prototype.remove=function(t){this._root=this._remove(t,this._root,this._comparator)},e.prototype._remove=function(t,n,i){var r;if(n===null)return null;n=Lu(t,n,i);var l=i(t,n.key);return l===0?(n.left===null?r=n.right:(r=Lu(t,n.left,i),r.right=n.right),this._size--,r):n},e.prototype.pop=function(){var t=this._root;if(t){for(;t.left;)t=t.left;return this._root=Lu(t.key,this._root,this._comparator),this._root=this._remove(t.key,this._root,this._comparator),{key:t.key,data:t.data}}return null},e.prototype.findStatic=function(t){for(var n=this._root,i=this._comparator;n;){var r=i(t,n.key);if(r===0)return n;r<0?n=n.left:n=n.right}return null},e.prototype.find=function(t){return this._root&&(this._root=Lu(t,this._root,this._comparator),this._comparator(t,this._root.key)!==0)?null:this._root},e.prototype.contains=function(t){for(var n=this._root,i=this._comparator;n;){var r=i(t,n.key);if(r===0)return!0;r<0?n=n.left:n=n.right}return!1},e.prototype.forEach=function(t,n){for(var i=this._root,r=[],l=!1;!l;)i!==null?(r.push(i),i=i.left):r.length!==0?(i=r.pop(),t.call(n,i),i=i.right):l=!0;return this},e.prototype.range=function(t,n,i,r){for(var l=[],f=this._comparator,a=this._root,_;l.length!==0||a;)if(a)l.push(a),a=a.left;else{if(a=l.pop(),_=f(a.key,n),_>0)break;if(f(a.key,t)>=0&&i.call(r,a))return this;a=a.right}return this},e.prototype.keys=function(){var t=[];return this.forEach(function(n){var i=n.key;return t.push(i)}),t},e.prototype.values=function(){var t=[];return this.forEach(function(n){var i=n.data;return t.push(i)}),t},e.prototype.min=function(){return this._root?this.minNode(this._root).key:null},e.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},e.prototype.minNode=function(t){if(t===void 0&&(t=this._root),t)for(;t.left;)t=t.left;return t},e.prototype.maxNode=function(t){if(t===void 0&&(t=this._root),t)for(;t.right;)t=t.right;return t},e.prototype.at=function(t){for(var n=this._root,i=!1,r=0,l=[];!i;)if(n)l.push(n),n=n.left;else if(l.length>0){if(n=l.pop(),r===t)return n;r++,n=n.right}else i=!0;return null},e.prototype.next=function(t){var n=this._root,i=null;if(t.right){for(i=t.right;i.left;)i=i.left;return i}for(var r=this._comparator;n;){var l=r(t.key,n.key);if(l===0)break;l<0?(i=n,n=n.left):n=n.right}return i},e.prototype.prev=function(t){var n=this._root,i=null;if(t.left!==null){for(i=t.left;i.right;)i=i.right;return i}for(var r=this._comparator;n;){var l=r(t.key,n.key);if(l===0)break;l<0?n=n.left:(i=n,n=n.right)}return i},e.prototype.clear=function(){return this._root=null,this._size=0,this},e.prototype.toList=function(){return JI(this._root)},e.prototype.load=function(t,n,i){n===void 0&&(n=[]),i===void 0&&(i=!1);var r=t.length,l=this._comparator;if(i&&dy(t,n,0,r-1,l),this._root===null)this._root=fy(t,n,0,r),this._size=r;else{var f=QI(this.toList(),KI(t,n),l);r=this._size+r,this._root=py({head:f},0,r)}return this},e.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(e.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),e.prototype.toString=function(t){t===void 0&&(t=function(i){return String(i.key)});var n=[];return hy(this._root,"",!0,function(i){return n.push(i)},t),n.join("")},e.prototype.update=function(t,n,i){var r=this._comparator,l=o1(t,this._root,r),f=l.left,a=l.right;r(t,n)<0?a=X_(n,i,a,r):f=X_(n,i,f,r),this._root=YI(f,a,r)},e.prototype.split=function(t){return o1(t,this._root,this._comparator)},e.prototype[Symbol.iterator]=function(){var t,n,i;return XI(this,function(r){switch(r.label){case 0:t=this._root,n=[],i=!1,r.label=1;case 1:return i?[3,6]:t===null?[3,2]:(n.push(t),t=t.left,[3,5]);case 2:return n.length===0?[3,4]:(t=n.pop(),[4,t]);case 3:return r.sent(),t=t.right,[3,5];case 4:i=!0,r.label=5;case 5:return[3,1];case 6:return[2]}})},e}();function fy(e,t,n,i){var r=i-n;if(r>0){var l=n+Math.floor(r/2),f=e[l],a=t[l],_=new Ru(f,a);return _.left=fy(e,t,n,l),_.right=fy(e,t,l+1,i),_}return null}function KI(e,t){for(var n=new Ru(null,null),i=n,r=0;r<e.length;r++)i=i.next=new Ru(e[r],t[r]);return i.next=null,n.next}function JI(e){for(var t=e,n=[],i=!1,r=new Ru(null,null),l=r;!i;)t?(n.push(t),t=t.left):n.length>0?(t=l=l.next=n.pop(),t=t.right):i=!0;return l.next=null,r.next}function py(e,t,n){var i=n-t;if(i>0){var r=t+Math.floor(i/2),l=py(e,t,r),f=e.head;return f.left=l,e.head=e.head.next,f.right=py(e,r+1,n),f}return null}function QI(e,t,n){for(var i=new Ru(null,null),r=i,l=e,f=t;l!==null&&f!==null;)n(l.key,f.key)<0?(r.next=l,l=l.next):(r.next=f,f=f.next),r=r.next;return l!==null?r.next=l:f!==null&&(r.next=f),i.next}function dy(e,t,n,i,r){if(!(n>=i)){for(var l=e[n+i>>1],f=n-1,a=i+1;;){do f++;while(r(e[f],l)<0);do a--;while(r(e[a],l)>0);if(f>=a)break;var _=e[f];e[f]=e[a],e[a]=_,_=t[f],t[f]=t[a],t[a]=_}dy(e,t,n,a,r),dy(e,t,a+1,i,r)}}function ba(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s1(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Xo(e,t,n){return t&&s1(e.prototype,t),n&&s1(e,n),e}var xp=function(e,t){return e.ll.x<=t.x&&t.x<=e.ur.x&&e.ll.y<=t.y&&t.y<=e.ur.y},my=function(e,t){if(t.ur.x<e.ll.x||e.ur.x<t.ll.x||t.ur.y<e.ll.y||e.ur.y<t.ll.y)return null;var n=e.ll.x<t.ll.x?t.ll.x:e.ll.x,i=e.ur.x<t.ur.x?e.ur.x:t.ur.x,r=e.ll.y<t.ll.y?t.ll.y:e.ll.y,l=e.ur.y<t.ur.y?e.ur.y:t.ur.y;return{ll:{x:n,y:r},ur:{x:i,y:l}}},ku=Number.EPSILON;ku===void 0&&(ku=Math.pow(2,-52));var tC=ku*ku,gy=function(e,t){if(-ku<e&&e<ku&&-ku<t&&t<ku)return 0;var n=e-t;return n*n<tC*e*t?0:e<t?-1:1},eC=function(){function e(){ba(this,e),this.reset()}return Xo(e,[{key:"reset",value:function(){this.xRounder=new a1,this.yRounder=new a1}},{key:"round",value:function(t,n){return{x:this.xRounder.round(t),y:this.yRounder.round(n)}}}]),e}(),a1=function(){function e(){ba(this,e),this.tree=new Ny,this.round(0)}return Xo(e,[{key:"round",value:function(t){var n=this.tree.add(t),i=this.tree.prev(n);if(i!==null&&gy(n.key,i.key)===0)return this.tree.remove(t),i.key;var r=this.tree.next(n);return r!==null&&gy(n.key,r.key)===0?(this.tree.remove(t),r.key):t}}]),e}(),$p=new eC,Up=function(e,t){return e.x*t.y-e.y*t.x},dx=function(e,t){return e.x*t.x+e.y*t.y},l1=function(e,t,n){var i={x:t.x-e.x,y:t.y-e.y},r={x:n.x-e.x,y:n.y-e.y},l=Up(i,r);return gy(l,0)},Jm=function(e){return Math.sqrt(dx(e,e))},nC=function(e,t,n){var i={x:t.x-e.x,y:t.y-e.y},r={x:n.x-e.x,y:n.y-e.y};return Up(r,i)/Jm(r)/Jm(i)},iC=function(e,t,n){var i={x:t.x-e.x,y:t.y-e.y},r={x:n.x-e.x,y:n.y-e.y};return dx(r,i)/Jm(r)/Jm(i)},u1=function(e,t,n){return t.y===0?null:{x:e.x+t.x/t.y*(n-e.y),y:n}},c1=function(e,t,n){return t.x===0?null:{x:n,y:e.y+t.y/t.x*(n-e.x)}},rC=function(e,t,n,i){if(t.x===0)return c1(n,i,e.x);if(i.x===0)return c1(e,t,n.x);if(t.y===0)return u1(n,i,e.y);if(i.y===0)return u1(e,t,n.y);var r=Up(t,i);if(r==0)return null;var l={x:n.x-e.x,y:n.y-e.y},f=Up(l,t)/r,a=Up(l,i)/r,_=e.x+a*t.x,x=n.x+f*i.x,S=e.y+a*t.y,L=n.y+f*i.y,A=(_+x)/2,P=(S+L)/2;return{x:A,y:P}},ul=function(){Xo(e,null,[{key:"compare",value:function(t,n){var i=e.comparePoints(t.point,n.point);return i!==0?i:(t.point!==n.point&&t.link(n),t.isLeft!==n.isLeft?t.isLeft?1:-1:Qm.compare(t.segment,n.segment))}},{key:"comparePoints",value:function(t,n){return t.x<n.x?-1:t.x>n.x?1:t.y<n.y?-1:t.y>n.y?1:0}}]);function e(t,n){ba(this,e),t.events===void 0?t.events=[this]:t.events.push(this),this.point=t,this.isLeft=n}return Xo(e,[{key:"link",value:function(t){if(t.point===this.point)throw new Error("Tried to link already linked events");for(var n=t.point.events,i=0,r=n.length;i<r;i++){var l=n[i];this.point.events.push(l),l.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var t=this.point.events.length,n=0;n<t;n++){var i=this.point.events[n];if(i.segment.consumedBy===void 0)for(var r=n+1;r<t;r++){var l=this.point.events[r];l.consumedBy===void 0&&i.otherSE.point.events===l.otherSE.point.events&&i.segment.consume(l.segment)}}}},{key:"getAvailableLinkedEvents",value:function(){for(var t=[],n=0,i=this.point.events.length;n<i;n++){var r=this.point.events[n];r!==this&&!r.segment.ringOut&&r.segment.isInResult()&&t.push(r)}return t}},{key:"getLeftmostComparator",value:function(t){var n=this,i=new Map,r=function(l){var f=l.otherSE;i.set(l,{sine:nC(n.point,t.point,f.point),cosine:iC(n.point,t.point,f.point)})};return function(l,f){i.has(l)||r(l),i.has(f)||r(f);var a=i.get(l),_=a.sine,x=a.cosine,S=i.get(f),L=S.sine,A=S.cosine;return _>=0&&L>=0?x<A?1:x>A?-1:0:_<0&&L<0?x<A?-1:x>A?1:0:L<_?-1:L>_?1:0}}}]),e}(),oC=0,Qm=function(){Xo(e,null,[{key:"compare",value:function(t,n){var i=t.leftSE.point.x,r=n.leftSE.point.x,l=t.rightSE.point.x,f=n.rightSE.point.x;if(f<i)return 1;if(l<r)return-1;var a=t.leftSE.point.y,_=n.leftSE.point.y,x=t.rightSE.point.y,S=n.rightSE.point.y;if(i<r){if(_<a&&_<x)return 1;if(_>a&&_>x)return-1;var L=t.comparePoint(n.leftSE.point);if(L<0)return 1;if(L>0)return-1;var A=n.comparePoint(t.rightSE.point);return A!==0?A:-1}if(i>r){if(a<_&&a<S)return-1;if(a>_&&a>S)return 1;var P=n.comparePoint(t.leftSE.point);if(P!==0)return P;var O=t.comparePoint(n.rightSE.point);return O<0?1:O>0?-1:1}if(a<_)return-1;if(a>_)return 1;if(l<f){var B=n.comparePoint(t.rightSE.point);if(B!==0)return B}if(l>f){var U=t.comparePoint(n.rightSE.point);if(U<0)return 1;if(U>0)return-1}if(l!==f){var Y=x-a,V=l-i,$=S-_,K=f-r;if(Y>V&&$<K)return 1;if(Y<V&&$>K)return-1}return l>f?1:l<f||x<S?-1:x>S?1:t.id<n.id?-1:t.id>n.id?1:0}}]);function e(t,n,i,r){ba(this,e),this.id=++oC,this.leftSE=t,t.segment=this,t.otherSE=n,this.rightSE=n,n.segment=this,n.otherSE=t,this.rings=i,this.windings=r}return Xo(e,[{key:"replaceRightSE",value:function(t){this.rightSE=t,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var t=this.leftSE.point.y,n=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:t<n?t:n},ur:{x:this.rightSE.point.x,y:t>n?t:n}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(t){return t.x===this.leftSE.point.x&&t.y===this.leftSE.point.y||t.x===this.rightSE.point.x&&t.y===this.rightSE.point.y}},{key:"comparePoint",value:function(t){if(this.isAnEndpoint(t))return 0;var n=this.leftSE.point,i=this.rightSE.point,r=this.vector();if(n.x===i.x)return t.x===n.x?0:t.x<n.x?1:-1;var l=(t.y-n.y)/r.y,f=n.x+l*r.x;if(t.x===f)return 0;var a=(t.x-n.x)/r.x,_=n.y+a*r.y;return t.y===_?0:t.y<_?-1:1}},{key:"getIntersection",value:function(t){var n=this.bbox(),i=t.bbox(),r=my(n,i);if(r===null)return null;var l=this.leftSE.point,f=this.rightSE.point,a=t.leftSE.point,_=t.rightSE.point,x=xp(n,a)&&this.comparePoint(a)===0,S=xp(i,l)&&t.comparePoint(l)===0,L=xp(n,_)&&this.comparePoint(_)===0,A=xp(i,f)&&t.comparePoint(f)===0;if(S&&x)return A&&!L?f:!A&&L?_:null;if(S)return L&&l.x===_.x&&l.y===_.y?null:l;if(x)return A&&f.x===a.x&&f.y===a.y?null:a;if(A&&L)return null;if(A)return f;if(L)return _;var P=rC(l,this.vector(),a,t.vector());return P===null||!xp(r,P)?null:$p.round(P.x,P.y)}},{key:"split",value:function(t){var n=[],i=t.events!==void 0,r=new ul(t,!0),l=new ul(t,!1),f=this.rightSE;this.replaceRightSE(l),n.push(l),n.push(r);var a=new e(r,f,this.rings.slice(),this.windings.slice());return ul.comparePoints(a.leftSE.point,a.rightSE.point)>0&&a.swapEvents(),ul.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),i&&(r.checkForConsuming(),l.checkForConsuming()),n}},{key:"swapEvents",value:function(){var t=this.rightSE;this.rightSE=this.leftSE,this.leftSE=t,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var n=0,i=this.windings.length;n<i;n++)this.windings[n]*=-1}},{key:"consume",value:function(t){for(var n=this,i=t;n.consumedBy;)n=n.consumedBy;for(;i.consumedBy;)i=i.consumedBy;var r=e.compare(n,i);if(r!==0){if(r>0){var l=n;n=i,i=l}if(n.prev===i){var f=n;n=i,i=f}for(var a=0,_=i.rings.length;a<_;a++){var x=i.rings[a],S=i.windings[a],L=n.rings.indexOf(x);L===-1?(n.rings.push(x),n.windings.push(S)):n.windings[L]+=S}i.rings=null,i.windings=null,i.consumedBy=n,i.leftSE.consumedBy=n.leftSE,i.rightSE.consumedBy=n.rightSE}}},{key:"prevInResult",value:function(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}},{key:"beforeState",value:function(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{var t=this.prev.consumedBy||this.prev;this._beforeState=t.afterState()}return this._beforeState}},{key:"afterState",value:function(){if(this._afterState!==void 0)return this._afterState;var t=this.beforeState();this._afterState={rings:t.rings.slice(0),windings:t.windings.slice(0),multiPolys:[]};for(var n=this._afterState.rings,i=this._afterState.windings,r=this._afterState.multiPolys,l=0,f=this.rings.length;l<f;l++){var a=this.rings[l],_=this.windings[l],x=n.indexOf(a);x===-1?(n.push(a),i.push(_)):i[x]+=_}for(var S=[],L=[],A=0,P=n.length;A<P;A++)if(i[A]!==0){var O=n[A],B=O.poly;if(L.indexOf(B)===-1)if(O.isExterior)S.push(B);else{L.indexOf(B)===-1&&L.push(B);var U=S.indexOf(O.poly);U!==-1&&S.splice(U,1)}}for(var Y=0,V=S.length;Y<V;Y++){var $=S[Y].multiPoly;r.indexOf($)===-1&&r.push($)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;var t=this.beforeState().multiPolys,n=this.afterState().multiPolys;switch(Oa.type){case"union":{var i=t.length===0,r=n.length===0;this._isInResult=i!==r;break}case"intersection":{var l,f;t.length<n.length?(l=t.length,f=n.length):(l=n.length,f=t.length),this._isInResult=f===Oa.numMultiPolys&&l<f;break}case"xor":{var a=Math.abs(t.length-n.length);this._isInResult=a%2===1;break}case"difference":{var _=function(x){return x.length===1&&x[0].isSubject};this._isInResult=_(t)!==_(n);break}default:throw new Error("Unrecognized operation type found ".concat(Oa.type))}return this._isInResult}}],[{key:"fromRing",value:function(t,n,i){var r,l,f,a=ul.comparePoints(t,n);if(a<0)r=t,l=n,f=1;else if(a>0)r=n,l=t,f=-1;else throw new Error("Tried to create degenerate segment at [".concat(t.x,", ").concat(t.y,"]"));var _=new ul(r,!0),x=new ul(l,!1);return new e(_,x,[i],[f])}}]),e}(),h1=function(){function e(t,n,i){if(ba(this,e),!Array.isArray(t)||t.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=n,this.isExterior=i,this.segments=[],typeof t[0][0]!="number"||typeof t[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var r=$p.round(t[0][0],t[0][1]);this.bbox={ll:{x:r.x,y:r.y},ur:{x:r.x,y:r.y}};for(var l=r,f=1,a=t.length;f<a;f++){if(typeof t[f][0]!="number"||typeof t[f][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var _=$p.round(t[f][0],t[f][1]);_.x===l.x&&_.y===l.y||(this.segments.push(Qm.fromRing(l,_,this)),_.x<this.bbox.ll.x&&(this.bbox.ll.x=_.x),_.y<this.bbox.ll.y&&(this.bbox.ll.y=_.y),_.x>this.bbox.ur.x&&(this.bbox.ur.x=_.x),_.y>this.bbox.ur.y&&(this.bbox.ur.y=_.y),l=_)}(r.x!==l.x||r.y!==l.y)&&this.segments.push(Qm.fromRing(l,r,this))}return Xo(e,[{key:"getSweepEvents",value:function(){for(var t=[],n=0,i=this.segments.length;n<i;n++){var r=this.segments[n];t.push(r.leftSE),t.push(r.rightSE)}return t}}]),e}(),sC=function(){function e(t,n){if(ba(this,e),!Array.isArray(t))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new h1(t[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var i=1,r=t.length;i<r;i++){var l=new h1(t[i],this,!1);l.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=l.bbox.ll.x),l.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=l.bbox.ll.y),l.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=l.bbox.ur.x),l.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=l.bbox.ur.y),this.interiorRings.push(l)}this.multiPoly=n}return Xo(e,[{key:"getSweepEvents",value:function(){for(var t=this.exteriorRing.getSweepEvents(),n=0,i=this.interiorRings.length;n<i;n++)for(var r=this.interiorRings[n].getSweepEvents(),l=0,f=r.length;l<f;l++)t.push(r[l]);return t}}]),e}(),f1=function(){function e(t,n){if(ba(this,e),!Array.isArray(t))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof t[0][0][0]=="number"&&(t=[t])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var i=0,r=t.length;i<r;i++){var l=new sC(t[i],this);l.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=l.bbox.ll.x),l.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=l.bbox.ll.y),l.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=l.bbox.ur.x),l.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=l.bbox.ur.y),this.polys.push(l)}this.isSubject=n}return Xo(e,[{key:"getSweepEvents",value:function(){for(var t=[],n=0,i=this.polys.length;n<i;n++)for(var r=this.polys[n].getSweepEvents(),l=0,f=r.length;l<f;l++)t.push(r[l]);return t}}]),e}(),aC=function(){Xo(e,null,[{key:"factory",value:function(t){for(var n=[],i=0,r=t.length;i<r;i++){var l=t[i];if(!(!l.isInResult()||l.ringOut)){for(var f=null,a=l.leftSE,_=l.rightSE,x=[a],S=a.point,L=[];f=a,a=_,x.push(a),a.point!==S;)for(;;){var A=a.getAvailableLinkedEvents();if(A.length===0){var P=x[0].point,O=x[x.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(P.x,",")+" ".concat(P.y,"]. Last matching segment found ends at")+" [".concat(O.x,", ").concat(O.y,"]."))}if(A.length===1){_=A[0].otherSE;break}for(var B=null,U=0,Y=L.length;U<Y;U++)if(L[U].point===a.point){B=U;break}if(B!==null){var V=L.splice(B)[0],$=x.splice(V.index);$.unshift($[0].otherSE),n.push(new e($.reverse()));continue}L.push({index:x.length,point:a.point});var K=a.getLeftmostComparator(f);_=A.sort(K)[0].otherSE;break}n.push(new e(x))}}return n}}]);function e(t){ba(this,e),this.events=t;for(var n=0,i=t.length;n<i;n++)t[n].segment.ringOut=this;this.poly=null}return Xo(e,[{key:"getGeom",value:function(){for(var t=this.events[0].point,n=[t],i=1,r=this.events.length-1;i<r;i++){var l=this.events[i].point,f=this.events[i+1].point;l1(l,t,f)!==0&&(n.push(l),t=l)}if(n.length===1)return null;var a=n[0],_=n[1];l1(a,t,_)===0&&n.shift(),n.push(n[0]);for(var x=this.isExteriorRing()?1:-1,S=this.isExteriorRing()?0:n.length-1,L=this.isExteriorRing()?n.length:-1,A=[],P=S;P!=L;P+=x)A.push([n[P].x,n[P].y]);return A}},{key:"isExteriorRing",value:function(){if(this._isExteriorRing===void 0){var t=this.enclosingRing();this._isExteriorRing=t?!t.isExteriorRing():!0}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var t=this.events[0],n=1,i=this.events.length;n<i;n++){var r=this.events[n];ul.compare(t,r)>0&&(t=r)}for(var l=t.segment.prevInResult(),f=l?l.prevInResult():null;;){if(!l)return null;if(!f)return l.ringOut;if(f.ringOut!==l.ringOut)return f.ringOut.enclosingRing()!==l.ringOut?l.ringOut:l.ringOut.enclosingRing();l=f.prevInResult(),f=l?l.prevInResult():null}}}]),e}(),p1=function(){function e(t){ba(this,e),this.exteriorRing=t,t.poly=this,this.interiorRings=[]}return Xo(e,[{key:"addInterior",value:function(t){this.interiorRings.push(t),t.poly=this}},{key:"getGeom",value:function(){var t=[this.exteriorRing.getGeom()];if(t[0]===null)return null;for(var n=0,i=this.interiorRings.length;n<i;n++){var r=this.interiorRings[n].getGeom();r!==null&&t.push(r)}return t}}]),e}(),lC=function(){function e(t){ba(this,e),this.rings=t,this.polys=this._composePolys(t)}return Xo(e,[{key:"getGeom",value:function(){for(var t=[],n=0,i=this.polys.length;n<i;n++){var r=this.polys[n].getGeom();r!==null&&t.push(r)}return t}},{key:"_composePolys",value:function(t){for(var n=[],i=0,r=t.length;i<r;i++){var l=t[i];if(!l.poly)if(l.isExteriorRing())n.push(new p1(l));else{var f=l.enclosingRing();f.poly||n.push(new p1(f)),f.poly.addInterior(l)}}return n}}]),e}(),uC=function(){function e(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Qm.compare;ba(this,e),this.queue=t,this.tree=new Ny(n),this.segments=[]}return Xo(e,[{key:"process",value:function(t){var n=t.segment,i=[];if(t.consumedBy)return t.isLeft?this.queue.remove(t.otherSE):this.tree.remove(n),i;var r=t.isLeft?this.tree.insert(n):this.tree.find(n);if(!r)throw new Error("Unable to find segment #".concat(n.id," ")+"[".concat(n.leftSE.point.x,", ").concat(n.leftSE.point.y,"] -> ")+"[".concat(n.rightSE.point.x,", ").concat(n.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var l=r,f=r,a=void 0,_=void 0;a===void 0;)l=this.tree.prev(l),l===null?a=null:l.key.consumedBy===void 0&&(a=l.key);for(;_===void 0;)f=this.tree.next(f),f===null?_=null:f.key.consumedBy===void 0&&(_=f.key);if(t.isLeft){var x=null;if(a){var S=a.getIntersection(n);if(S!==null&&(n.isAnEndpoint(S)||(x=S),!a.isAnEndpoint(S)))for(var L=this._splitSafely(a,S),A=0,P=L.length;A<P;A++)i.push(L[A])}var O=null;if(_){var B=_.getIntersection(n);if(B!==null&&(n.isAnEndpoint(B)||(O=B),!_.isAnEndpoint(B)))for(var U=this._splitSafely(_,B),Y=0,V=U.length;Y<V;Y++)i.push(U[Y])}if(x!==null||O!==null){var $=null;if(x===null)$=O;else if(O===null)$=x;else{var K=ul.comparePoints(x,O);$=K<=0?x:O}this.queue.remove(n.rightSE),i.push(n.rightSE);for(var it=n.split($),ft=0,pt=it.length;ft<pt;ft++)i.push(it[ft])}i.length>0?(this.tree.remove(n),i.push(t)):(this.segments.push(n),n.prev=a)}else{if(a&&_){var gt=a.getIntersection(_);if(gt!==null){if(!a.isAnEndpoint(gt))for(var ut=this._splitSafely(a,gt),St=0,_t=ut.length;St<_t;St++)i.push(ut[St]);if(!_.isAnEndpoint(gt))for(var vt=this._splitSafely(_,gt),ee=0,kt=vt.length;ee<kt;ee++)i.push(vt[ee])}}this.tree.remove(n)}return i}},{key:"_splitSafely",value:function(t,n){this.tree.remove(t);var i=t.rightSE;this.queue.remove(i);var r=t.split(n);return r.push(i),t.consumedBy===void 0&&this.tree.insert(t),r}}]),e}(),d1=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,cC=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,hC=function(){function e(){ba(this,e)}return Xo(e,[{key:"run",value:function(t,n,i){Oa.type=t,$p.reset();for(var r=[new f1(n,!0)],l=0,f=i.length;l<f;l++)r.push(new f1(i[l],!1));if(Oa.numMultiPolys=r.length,Oa.type==="difference")for(var a=r[0],_=1;_<r.length;)my(r[_].bbox,a.bbox)!==null?_++:r.splice(_,1);if(Oa.type==="intersection"){for(var x=0,S=r.length;x<S;x++)for(var L=r[x],A=x+1,P=r.length;A<P;A++)if(my(L.bbox,r[A].bbox)===null)return[]}for(var O=new Ny(ul.compare),B=0,U=r.length;B<U;B++)for(var Y=r[B].getSweepEvents(),V=0,$=Y.length;V<$;V++)if(O.insert(Y[V]),O.size>d1)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var K=new uC(O),it=O.size,ft=O.pop();ft;){var pt=ft.key;if(O.size===it){var gt=pt.segment;throw new Error("Unable to pop() ".concat(pt.isLeft?"left":"right"," SweepEvent ")+"[".concat(pt.point.x,", ").concat(pt.point.y,"] from segment #").concat(gt.id," ")+"[".concat(gt.leftSE.point.x,", ").concat(gt.leftSE.point.y,"] -> ")+"[".concat(gt.rightSE.point.x,", ").concat(gt.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(O.size>d1)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(K.segments.length>cC)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var ut=K.process(pt),St=0,_t=ut.length;St<_t;St++){var vt=ut[St];vt.consumedBy===void 0&&O.insert(vt)}it=O.size,ft=O.pop()}$p.reset();var ee=aC.factory(K.segments),kt=new lC(ee);return kt.getGeom()}}]),e}(),Oa=new hC,fC=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return Oa.run("union",e,n)},pC=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return Oa.run("intersection",e,n)},dC=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return Oa.run("xor",e,n)},mC=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return Oa.run("difference",e,n)},mx={union:fC,intersection:pC,xor:dC,difference:mC},qo=63710088e-1,gx={centimeters:qo*100,centimetres:qo*100,degrees:qo/111325,feet:qo*3.28084,inches:qo*39.37,kilometers:qo/1e3,kilometres:qo/1e3,meters:qo,metres:qo,miles:qo/1609.344,millimeters:qo*1e3,millimetres:qo*1e3,nauticalmiles:qo/1852,radians:1,yards:qo*1.0936};function vg(e,t,n){n===void 0&&(n={});var i={type:"Feature"};return(n.id===0||n.id)&&(i.id=n.id),n.bbox&&(i.bbox=n.bbox),i.properties=t||{},i.geometry=e,i}function gC(e,t,n){if(n===void 0&&(n={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!m1(e[0])||!m1(e[1]))throw new Error("coordinates must contain numbers");var i={type:"Point",coordinates:e};return vg(i,t,n)}function _x(e,t,n){n===void 0&&(n={});for(var i=0,r=e;i<r.length;i++){var l=r[i];if(l.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var f=0;f<l[l.length-1].length;f++)if(l[l.length-1][f]!==l[0][f])throw new Error("First and last Position are not equivalent.")}var a={type:"Polygon",coordinates:e};return vg(a,t,n)}function _y(e,t){t===void 0&&(t={});var n={type:"FeatureCollection"};return t.id&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.features=e,n}function yx(e,t,n){n===void 0&&(n={});var i={type:"MultiPolygon",coordinates:e};return vg(i,t,n)}function _C(e,t){t===void 0&&(t="kilometers");var n=gx[t];if(!n)throw new Error(t+" units is invalid");return e*n}function yC(e,t){t===void 0&&(t="kilometers");var n=gx[t];if(!n)throw new Error(t+" units is invalid");return e/n}function m1(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function tg(e){return e.type==="Feature"?e.geometry:e}function vC(e,t,n){n===void 0&&(n={});var i=tg(e),r=tg(t),l=mx.union(i.coordinates,r.coordinates);return l.length===0?null:l.length===1?_x(l[0],n.properties):yx(l,n.properties)}function vx(e,t,n){if(e!==null)for(var i,r,l,f,a,_,x,S=0,L=0,A,P=e.type,O=P==="FeatureCollection",B=P==="Feature",U=O?e.features.length:1,Y=0;Y<U;Y++){x=O?e.features[Y].geometry:B?e.geometry:e,A=x?x.type==="GeometryCollection":!1,a=A?x.geometries.length:1;for(var V=0;V<a;V++){var $=0,K=0;if(f=A?x.geometries[V]:x,f!==null){_=f.coordinates;var it=f.type;switch(S=n&&(it==="Polygon"||it==="MultiPolygon")?1:0,it){case null:break;case"Point":if(t(_,L,Y,$,K)===!1)return!1;L++,$++;break;case"LineString":case"MultiPoint":for(i=0;i<_.length;i++){if(t(_[i],L,Y,$,K)===!1)return!1;L++,it==="MultiPoint"&&$++}it==="LineString"&&$++;break;case"Polygon":case"MultiLineString":for(i=0;i<_.length;i++){for(r=0;r<_[i].length-S;r++){if(t(_[i][r],L,Y,$,K)===!1)return!1;L++}it==="MultiLineString"&&$++,it==="Polygon"&&K++}it==="Polygon"&&$++;break;case"MultiPolygon":for(i=0;i<_.length;i++){for(K=0,r=0;r<_[i].length;r++){for(l=0;l<_[i][r].length-S;l++){if(t(_[i][r][l],L,Y,$,K)===!1)return!1;L++}K++}$++}break;case"GeometryCollection":for(i=0;i<f.geometries.length;i++)if(vx(f.geometries[i],t,n)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function g1(e,t){if(e.type==="Feature")t(e,0);else if(e.type==="FeatureCollection")for(var n=0;n<e.features.length&&t(e.features[n],n)!==!1;n++);}function bx(e,t){var n,i,r,l,f,a,_,x,S,L,A=0,P=e.type==="FeatureCollection",O=e.type==="Feature",B=P?e.features.length:1;for(n=0;n<B;n++){for(a=P?e.features[n].geometry:O?e.geometry:e,x=P?e.features[n].properties:O?e.properties:{},S=P?e.features[n].bbox:O?e.bbox:void 0,L=P?e.features[n].id:O?e.id:void 0,_=a?a.type==="GeometryCollection":!1,f=_?a.geometries.length:1,r=0;r<f;r++){if(l=_?a.geometries[r]:a,l===null){if(t(null,A,x,S,L)===!1)return!1;continue}switch(l.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(t(l,A,x,S,L)===!1)return!1;break}case"GeometryCollection":{for(i=0;i<l.geometries.length;i++)if(t(l.geometries[i],A,x,S,L)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}A++}}function yy(e){var t=[1/0,1/0,-1/0,-1/0];return vx(e,function(n){t[0]>n[0]&&(t[0]=n[0]),t[1]>n[1]&&(t[1]=n[1]),t[2]<n[0]&&(t[2]=n[0]),t[3]<n[1]&&(t[3]=n[1])}),t}yy.default=yy;function bC(e,t){t===void 0&&(t={});var n=yy(e),i=(n[0]+n[2])/2,r=(n[1]+n[3])/2;return gC([i,r],t.properties,t)}"fill"in Array.prototype||Object.defineProperty(Array.prototype,"fill",{configurable:!0,value:function(e){if(this===void 0||this===null)throw new TypeError(this+" is not an object");var t=Object(this),n=Math.max(Math.min(t.length,9007199254740991),0)||0,i=1 in arguments&&parseInt(Number(arguments[1]),10)||0;i=i<0?Math.max(n+i,0):Math.min(i,n);var r=2 in arguments&&arguments[2]!==void 0?parseInt(Number(arguments[2]),10)||0:n;for(r=r<0?Math.max(n+arguments[2],0):Math.min(r,n);i<r;)t[i]=e,++i;return t},writable:!0});Number.isFinite=Number.isFinite||function(e){return typeof e=="number"&&isFinite(e)};Number.isInteger=Number.isInteger||function(e){return typeof e=="number"&&isFinite(e)&&Math.floor(e)===e};Number.parseFloat=Number.parseFloat||parseFloat;Number.isNaN=Number.isNaN||function(e){return e!==e};Math.trunc=Math.trunc||function(e){return e<0?Math.ceil(e):Math.floor(e)};var bc=function(){};bc.prototype.interfaces_=function(){return[]};bc.prototype.getClass=function(){return bc};bc.prototype.equalsWithTolerance=function(e,t,n){return Math.abs(e-t)<=n};var _i=function(e){function t(n){e.call(this,n),this.name="IllegalArgumentException",this.message=n,this.stack=new e().stack}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(Error),tn=function(){},xx={MAX_VALUE:{configurable:!0}};tn.isNaN=function(e){return Number.isNaN(e)};tn.doubleToLongBits=function(e){return e};tn.longBitsToDouble=function(e){return e};tn.isInfinite=function(e){return!Number.isFinite(e)};xx.MAX_VALUE.get=function(){return Number.MAX_VALUE};Object.defineProperties(tn,xx);var bs=function(){},bg=function(){},Oh=function(){};function xs(){}var Dt=function e(){if(this.x=null,this.y=null,this.z=null,arguments.length===0)this.x=0,this.y=0,this.z=e.NULL_ORDINATE;else if(arguments.length===1){var t=arguments[0];this.x=t.x,this.y=t.y,this.z=t.z}else arguments.length===2?(this.x=arguments[0],this.y=arguments[1],this.z=e.NULL_ORDINATE):arguments.length===3&&(this.x=arguments[0],this.y=arguments[1],this.z=arguments[2])},Rc={DimensionalComparator:{configurable:!0},serialVersionUID:{configurable:!0},NULL_ORDINATE:{configurable:!0},X:{configurable:!0},Y:{configurable:!0},Z:{configurable:!0}};Dt.prototype.setOrdinate=function(e,t){switch(e){case Dt.X:this.x=t;break;case Dt.Y:this.y=t;break;case Dt.Z:this.z=t;break;default:throw new _i("Invalid ordinate index: "+e)}};Dt.prototype.equals2D=function(){if(arguments.length===1){var e=arguments[0];return!(this.x!==e.x||this.y!==e.y)}else if(arguments.length===2){var t=arguments[0],n=arguments[1];return!(!bc.equalsWithTolerance(this.x,t.x,n)||!bc.equalsWithTolerance(this.y,t.y,n))}};Dt.prototype.getOrdinate=function(e){switch(e){case Dt.X:return this.x;case Dt.Y:return this.y;case Dt.Z:return this.z}throw new _i("Invalid ordinate index: "+e)};Dt.prototype.equals3D=function(e){return this.x===e.x&&this.y===e.y&&(this.z===e.z||tn.isNaN(this.z))&&tn.isNaN(e.z)};Dt.prototype.equals=function(e){return e instanceof Dt?this.equals2D(e):!1};Dt.prototype.equalInZ=function(e,t){return bc.equalsWithTolerance(this.z,e.z,t)};Dt.prototype.compareTo=function(e){var t=e;return this.x<t.x?-1:this.x>t.x?1:this.y<t.y?-1:this.y>t.y?1:0};Dt.prototype.clone=function(){};Dt.prototype.copy=function(){return new Dt(this)};Dt.prototype.toString=function(){return"("+this.x+", "+this.y+", "+this.z+")"};Dt.prototype.distance3D=function(e){var t=this.x-e.x,n=this.y-e.y,i=this.z-e.z;return Math.sqrt(t*t+n*n+i*i)};Dt.prototype.distance=function(e){var t=this.x-e.x,n=this.y-e.y;return Math.sqrt(t*t+n*n)};Dt.prototype.hashCode=function(){var e=17;return e=37*e+Dt.hashCode(this.x),e=37*e+Dt.hashCode(this.y),e};Dt.prototype.setCoordinate=function(e){this.x=e.x,this.y=e.y,this.z=e.z};Dt.prototype.interfaces_=function(){return[bs,bg,xs]};Dt.prototype.getClass=function(){return Dt};Dt.hashCode=function(){if(arguments.length===1){var e=arguments[0],t=tn.doubleToLongBits(e);return Math.trunc((t^t)>>>32)}};Rc.DimensionalComparator.get=function(){return Zl};Rc.serialVersionUID.get=function(){return 6683108902428367e3};Rc.NULL_ORDINATE.get=function(){return tn.NaN};Rc.X.get=function(){return 0};Rc.Y.get=function(){return 1};Rc.Z.get=function(){return 2};Object.defineProperties(Dt,Rc);var Zl=function(e){if(this._dimensionsToTest=2,arguments.length!==0&&arguments.length===1){var t=arguments[0];if(t!==2&&t!==3)throw new _i("only 2 or 3 dimensions may be specified");this._dimensionsToTest=t}};Zl.prototype.compare=function(e,t){var n=e,i=t,r=Zl.compare(n.x,i.x);if(r!==0)return r;var l=Zl.compare(n.y,i.y);if(l!==0)return l;if(this._dimensionsToTest<=2)return 0;var f=Zl.compare(n.z,i.z);return f};Zl.prototype.interfaces_=function(){return[Oh]};Zl.prototype.getClass=function(){return Zl};Zl.compare=function(e,t){return e<t?-1:e>t?1:tn.isNaN(e)?tn.isNaN(t)?0:-1:tn.isNaN(t)?1:0};var zh=function(){};zh.prototype.create=function(){};zh.prototype.interfaces_=function(){return[]};zh.prototype.getClass=function(){return zh};var zt=function(){},pd={INTERIOR:{configurable:!0},BOUNDARY:{configurable:!0},EXTERIOR:{configurable:!0},NONE:{configurable:!0}};zt.prototype.interfaces_=function(){return[]};zt.prototype.getClass=function(){return zt};zt.toLocationSymbol=function(e){switch(e){case zt.EXTERIOR:return"e";case zt.BOUNDARY:return"b";case zt.INTERIOR:return"i";case zt.NONE:return"-"}throw new _i("Unknown location value: "+e)};pd.INTERIOR.get=function(){return 0};pd.BOUNDARY.get=function(){return 1};pd.EXTERIOR.get=function(){return 2};pd.NONE.get=function(){return-1};Object.defineProperties(zt,pd);var We=function(e,t){return e.interfaces_&&e.interfaces_().indexOf(t)>-1},Ho=function(){},wx={LOG_10:{configurable:!0}};Ho.prototype.interfaces_=function(){return[]};Ho.prototype.getClass=function(){return Ho};Ho.log10=function(e){var t=Math.log(e);return tn.isInfinite(t)||tn.isNaN(t)?t:t/Ho.LOG_10};Ho.min=function(e,t,n,i){var r=e;return t<r&&(r=t),n<r&&(r=n),i<r&&(r=i),r};Ho.clamp=function(){if(typeof arguments[2]=="number"&&typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var e=arguments[0],t=arguments[1],n=arguments[2];return e<t?t:e>n?n:e}else if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var i=arguments[0],r=arguments[1],l=arguments[2];return i<r?r:i>l?l:i}};Ho.wrap=function(e,t){return e<0?t- -e%t:e%t};Ho.max=function(){if(arguments.length===3){var e=arguments[0],t=arguments[1],n=arguments[2],i=e;return t>i&&(i=t),n>i&&(i=n),i}else if(arguments.length===4){var r=arguments[0],l=arguments[1],f=arguments[2],a=arguments[3],_=r;return l>_&&(_=l),f>_&&(_=f),a>_&&(_=a),_}};Ho.average=function(e,t){return(e+t)/2};wx.LOG_10.get=function(){return Math.log(10)};Object.defineProperties(Ho,wx);var xa=function(e){this.str=e};xa.prototype.append=function(e){this.str+=e};xa.prototype.setCharAt=function(e,t){this.str=this.str.substr(0,e)+t+this.str.substr(e+1)};xa.prototype.toString=function(e){return this.str};var ua=function(e){this.value=e};ua.prototype.intValue=function(){return this.value};ua.prototype.compareTo=function(e){return this.value<e?-1:this.value>e?1:0};ua.isNaN=function(e){return Number.isNaN(e)};var Wp=function(){};Wp.isWhitespace=function(e){return e<=32&&e>=0||e===127};Wp.toUpperCase=function(e){return e.toUpperCase()};var Ut=function e(){if(this._hi=0,this._lo=0,arguments.length===0)this.init(0);else if(arguments.length===1){if(typeof arguments[0]=="number"){var t=arguments[0];this.init(t)}else if(arguments[0]instanceof e){var n=arguments[0];this.init(n)}else if(typeof arguments[0]=="string"){var i=arguments[0];e.call(this,e.parse(i))}}else if(arguments.length===2){var r=arguments[0],l=arguments[1];this.init(r,l)}},Vs={PI:{configurable:!0},TWO_PI:{configurable:!0},PI_2:{configurable:!0},E:{configurable:!0},NaN:{configurable:!0},EPS:{configurable:!0},SPLIT:{configurable:!0},MAX_PRINT_DIGITS:{configurable:!0},TEN:{configurable:!0},ONE:{configurable:!0},SCI_NOT_EXPONENT_CHAR:{configurable:!0},SCI_NOT_ZERO:{configurable:!0}};Ut.prototype.le=function(e){return(this._hi<e._hi||this._hi===e._hi)&&this._lo<=e._lo};Ut.prototype.extractSignificantDigits=function(e,t){var n=this.abs(),i=Ut.magnitude(n._hi),r=Ut.TEN.pow(i);n=n.divide(r),n.gt(Ut.TEN)?(n=n.divide(Ut.TEN),i+=1):n.lt(Ut.ONE)&&(n=n.multiply(Ut.TEN),i-=1);for(var l=i+1,f=new xa,a=Ut.MAX_PRINT_DIGITS-1,_=0;_<=a;_++){e&&_===l&&f.append(".");var x=Math.trunc(n._hi);if(x<0)break;var S=!1,L=0;x>9?(S=!0,L="9"):L="0"+x,f.append(L),n=n.subtract(Ut.valueOf(x)).multiply(Ut.TEN),S&&n.selfAdd(Ut.TEN);var A=!0,P=Ut.magnitude(n._hi);if(P<0&&Math.abs(P)>=a-_&&(A=!1),!A)break}return t[0]=i,f.toString()};Ut.prototype.sqr=function(){return this.multiply(this)};Ut.prototype.doubleValue=function(){return this._hi+this._lo};Ut.prototype.subtract=function(){if(arguments[0]instanceof Ut){var e=arguments[0];return this.add(e.negate())}else if(typeof arguments[0]=="number"){var t=arguments[0];return this.add(-t)}};Ut.prototype.equals=function(){if(arguments.length===1){var e=arguments[0];return this._hi===e._hi&&this._lo===e._lo}};Ut.prototype.isZero=function(){return this._hi===0&&this._lo===0};Ut.prototype.selfSubtract=function(){if(arguments[0]instanceof Ut){var e=arguments[0];return this.isNaN()?this:this.selfAdd(-e._hi,-e._lo)}else if(typeof arguments[0]=="number"){var t=arguments[0];return this.isNaN()?this:this.selfAdd(-t,0)}};Ut.prototype.getSpecialNumberString=function(){return this.isZero()?"0.0":this.isNaN()?"NaN ":null};Ut.prototype.min=function(e){return this.le(e)?this:e};Ut.prototype.selfDivide=function(){if(arguments.length===1){if(arguments[0]instanceof Ut){var e=arguments[0];return this.selfDivide(e._hi,e._lo)}else if(typeof arguments[0]=="number"){var t=arguments[0];return this.selfDivide(t,0)}}else if(arguments.length===2){var n=arguments[0],i=arguments[1],r=null,l=null,f=null,a=null,_=null,x=null,S=null,L=null;return _=this._hi/n,x=Ut.SPLIT*_,r=x-_,L=Ut.SPLIT*n,r=x-r,l=_-r,f=L-n,S=_*n,f=L-f,a=n-f,L=r*f-S+r*a+l*f+l*a,x=(this._hi-S-L+this._lo-_*i)/n,L=_+x,this._hi=L,this._lo=_-L+x,this}};Ut.prototype.dump=function(){return"DD<"+this._hi+", "+this._lo+">"};Ut.prototype.divide=function(){if(arguments[0]instanceof Ut){var e=arguments[0],t=null,n=null,i=null,r=null,l=null,f=null,a=null,_=null;l=this._hi/e._hi,f=Ut.SPLIT*l,t=f-l,_=Ut.SPLIT*e._hi,t=f-t,n=l-t,i=_-e._hi,a=l*e._hi,i=_-i,r=e._hi-i,_=t*i-a+t*r+n*i+n*r,f=(this._hi-a-_+this._lo-l*e._lo)/e._hi,_=l+f;var x=_,S=l-_+f;return new Ut(x,S)}else if(typeof arguments[0]=="number"){var L=arguments[0];return tn.isNaN(L)?Ut.createNaN():Ut.copy(this).selfDivide(L,0)}};Ut.prototype.ge=function(e){return(this._hi>e._hi||this._hi===e._hi)&&this._lo>=e._lo};Ut.prototype.pow=function(e){if(e===0)return Ut.valueOf(1);var t=new Ut(this),n=Ut.valueOf(1),i=Math.abs(e);if(i>1)for(;i>0;)i%2===1&&n.selfMultiply(t),i/=2,i>0&&(t=t.sqr());else n=t;return e<0?n.reciprocal():n};Ut.prototype.ceil=function(){if(this.isNaN())return Ut.NaN;var e=Math.ceil(this._hi),t=0;return e===this._hi&&(t=Math.ceil(this._lo)),new Ut(e,t)};Ut.prototype.compareTo=function(e){var t=e;return this._hi<t._hi?-1:this._hi>t._hi?1:this._lo<t._lo?-1:this._lo>t._lo?1:0};Ut.prototype.rint=function(){if(this.isNaN())return this;var e=this.add(.5);return e.floor()};Ut.prototype.setValue=function(){if(arguments[0]instanceof Ut){var e=arguments[0];return this.init(e),this}else if(typeof arguments[0]=="number"){var t=arguments[0];return this.init(t),this}};Ut.prototype.max=function(e){return this.ge(e)?this:e};Ut.prototype.sqrt=function(){if(this.isZero())return Ut.valueOf(0);if(this.isNegative())return Ut.NaN;var e=1/Math.sqrt(this._hi),t=this._hi*e,n=Ut.valueOf(t),i=this.subtract(n.sqr()),r=i._hi*(e*.5);return n.add(r)};Ut.prototype.selfAdd=function(){if(arguments.length===1){if(arguments[0]instanceof Ut){var e=arguments[0];return this.selfAdd(e._hi,e._lo)}else if(typeof arguments[0]=="number"){var t=arguments[0],n=null,i=null,r=null,l=null,f=null,a=null;return r=this._hi+t,f=r-this._hi,l=r-f,l=t-f+(this._hi-l),a=l+this._lo,n=r+a,i=a+(r-n),this._hi=n+i,this._lo=i+(n-this._hi),this}}else if(arguments.length===2){var _=arguments[0],x=arguments[1],S=null,L=null,A=null,P=null,O=null,B=null,U=null,Y=null;O=this._hi+_,A=this._lo+x,U=O-this._hi,Y=A-this._lo,B=O-U,P=A-Y,B=_-U+(this._hi-B),P=x-Y+(this._lo-P),U=B+A,S=O+U,L=U+(O-S),U=P+L;var V=S+U,$=U+(S-V);return this._hi=V,this._lo=$,this}};Ut.prototype.selfMultiply=function(){if(arguments.length===1){if(arguments[0]instanceof Ut){var e=arguments[0];return this.selfMultiply(e._hi,e._lo)}else if(typeof arguments[0]=="number"){var t=arguments[0];return this.selfMultiply(t,0)}}else if(arguments.length===2){var n=arguments[0],i=arguments[1],r=null,l=null,f=null,a=null,_=null,x=null;_=Ut.SPLIT*this._hi,r=_-this._hi,x=Ut.SPLIT*n,r=_-r,l=this._hi-r,f=x-n,_=this._hi*n,f=x-f,a=n-f,x=r*f-_+r*a+l*f+l*a+(this._hi*i+this._lo*n);var S=_+x;r=_-S;var L=x+r;return this._hi=S,this._lo=L,this}};Ut.prototype.selfSqr=function(){return this.selfMultiply(this)};Ut.prototype.floor=function(){if(this.isNaN())return Ut.NaN;var e=Math.floor(this._hi),t=0;return e===this._hi&&(t=Math.floor(this._lo)),new Ut(e,t)};Ut.prototype.negate=function(){return this.isNaN()?this:new Ut(-this._hi,-this._lo)};Ut.prototype.clone=function(){};Ut.prototype.multiply=function(){if(arguments[0]instanceof Ut){var e=arguments[0];return e.isNaN()?Ut.createNaN():Ut.copy(this).selfMultiply(e)}else if(typeof arguments[0]=="number"){var t=arguments[0];return tn.isNaN(t)?Ut.createNaN():Ut.copy(this).selfMultiply(t,0)}};Ut.prototype.isNaN=function(){return tn.isNaN(this._hi)};Ut.prototype.intValue=function(){return Math.trunc(this._hi)};Ut.prototype.toString=function(){var e=Ut.magnitude(this._hi);return e>=-3&&e<=20?this.toStandardNotation():this.toSciNotation()};Ut.prototype.toStandardNotation=function(){var e=this.getSpecialNumberString();if(e!==null)return e;var t=new Array(1).fill(null),n=this.extractSignificantDigits(!0,t),i=t[0]+1,r=n;if(n.charAt(0)===".")r="0"+n;else if(i<0)r="0."+Ut.stringOfChar("0",-i)+n;else if(n.indexOf(".")===-1){var l=i-n.length,f=Ut.stringOfChar("0",l);r=n+f+".0"}return this.isNegative()?"-"+r:r};Ut.prototype.reciprocal=function(){var e=null,t=null,n=null,i=null,r=null,l=null,f=null,a=null;r=1/this._hi,l=Ut.SPLIT*r,e=l-r,a=Ut.SPLIT*this._hi,e=l-e,t=r-e,n=a-this._hi,f=r*this._hi,n=a-n,i=this._hi-n,a=e*n-f+e*i+t*n+t*i,l=(1-f-a-r*this._lo)/this._hi;var _=r+l,x=r-_+l;return new Ut(_,x)};Ut.prototype.toSciNotation=function(){if(this.isZero())return Ut.SCI_NOT_ZERO;var e=this.getSpecialNumberString();if(e!==null)return e;var t=new Array(1).fill(null),n=this.extractSignificantDigits(!1,t),i=Ut.SCI_NOT_EXPONENT_CHAR+t[0];if(n.charAt(0)==="0")throw new Error("Found leading zero: "+n);var r="";n.length>1&&(r=n.substring(1));var l=n.charAt(0)+"."+r;return this.isNegative()?"-"+l+i:l+i};Ut.prototype.abs=function(){return this.isNaN()?Ut.NaN:this.isNegative()?this.negate():new Ut(this)};Ut.prototype.isPositive=function(){return(this._hi>0||this._hi===0)&&this._lo>0};Ut.prototype.lt=function(e){return(this._hi<e._hi||this._hi===e._hi)&&this._lo<e._lo};Ut.prototype.add=function(){if(arguments[0]instanceof Ut){var e=arguments[0];return Ut.copy(this).selfAdd(e)}else if(typeof arguments[0]=="number"){var t=arguments[0];return Ut.copy(this).selfAdd(t)}};Ut.prototype.init=function(){if(arguments.length===1){if(typeof arguments[0]=="number"){var e=arguments[0];this._hi=e,this._lo=0}else if(arguments[0]instanceof Ut){var t=arguments[0];this._hi=t._hi,this._lo=t._lo}}else if(arguments.length===2){var n=arguments[0],i=arguments[1];this._hi=n,this._lo=i}};Ut.prototype.gt=function(e){return(this._hi>e._hi||this._hi===e._hi)&&this._lo>e._lo};Ut.prototype.isNegative=function(){return(this._hi<0||this._hi===0)&&this._lo<0};Ut.prototype.trunc=function(){return this.isNaN()?Ut.NaN:this.isPositive()?this.floor():this.ceil()};Ut.prototype.signum=function(){return this._hi>0?1:this._hi<0?-1:this._lo>0?1:this._lo<0?-1:0};Ut.prototype.interfaces_=function(){return[xs,bs,bg]};Ut.prototype.getClass=function(){return Ut};Ut.sqr=function(e){return Ut.valueOf(e).selfMultiply(e)};Ut.valueOf=function(){if(typeof arguments[0]=="string"){var e=arguments[0];return Ut.parse(e)}else if(typeof arguments[0]=="number"){var t=arguments[0];return new Ut(t)}};Ut.sqrt=function(e){return Ut.valueOf(e).sqrt()};Ut.parse=function(e){for(var t=0,n=e.length;Wp.isWhitespace(e.charAt(t));)t++;var i=!1;if(t<n){var r=e.charAt(t);(r==="-"||r==="+")&&(t++,r==="-"&&(i=!0))}for(var l=new Ut,f=0,a=0,_=0;!(t>=n);){var x=e.charAt(t);if(t++,Wp.isDigit(x)){var S=x-"0";l.selfMultiply(Ut.TEN),l.selfAdd(S),f++;continue}if(x==="."){a=f;continue}if(x==="e"||x==="E"){var L=e.substring(t);try{_=ua.parseInt(L)}catch(U){throw U instanceof Error?new Error("Invalid exponent "+L+" in string "+e):U}finally{}break}throw new Error("Unexpected character '"+x+"' at position "+t+" in string "+e)}var A=l,P=f-a-_;if(P===0)A=l;else if(P>0){var O=Ut.TEN.pow(P);A=l.divide(O)}else if(P<0){var B=Ut.TEN.pow(-P);A=l.multiply(B)}return i?A.negate():A};Ut.createNaN=function(){return new Ut(tn.NaN,tn.NaN)};Ut.copy=function(e){return new Ut(e)};Ut.magnitude=function(e){var t=Math.abs(e),n=Math.log(t)/Math.log(10),i=Math.trunc(Math.floor(n)),r=Math.pow(10,i);return r*10<=t&&(i+=1),i};Ut.stringOfChar=function(e,t){for(var n=new xa,i=0;i<t;i++)n.append(e);return n.toString()};Vs.PI.get=function(){return new Ut(3.141592653589793,12246467991473532e-32)};Vs.TWO_PI.get=function(){return new Ut(6.283185307179586,24492935982947064e-32)};Vs.PI_2.get=function(){return new Ut(1.5707963267948966,6123233995736766e-32)};Vs.E.get=function(){return new Ut(2.718281828459045,14456468917292502e-32)};Vs.NaN.get=function(){return new Ut(tn.NaN,tn.NaN)};Vs.EPS.get=function(){return 123259516440783e-46};Vs.SPLIT.get=function(){return 134217729};Vs.MAX_PRINT_DIGITS.get=function(){return 32};Vs.TEN.get=function(){return Ut.valueOf(10)};Vs.ONE.get=function(){return Ut.valueOf(1)};Vs.SCI_NOT_EXPONENT_CHAR.get=function(){return"E"};Vs.SCI_NOT_ZERO.get=function(){return"0.0E0"};Object.defineProperties(Ut,Vs);var po=function(){},Sx={DP_SAFE_EPSILON:{configurable:!0}};po.prototype.interfaces_=function(){return[]};po.prototype.getClass=function(){return po};po.orientationIndex=function(e,t,n){var i=po.orientationIndexFilter(e,t,n);if(i<=1)return i;var r=Ut.valueOf(t.x).selfAdd(-e.x),l=Ut.valueOf(t.y).selfAdd(-e.y),f=Ut.valueOf(n.x).selfAdd(-t.x),a=Ut.valueOf(n.y).selfAdd(-t.y);return r.selfMultiply(a).selfSubtract(l.selfMultiply(f)).signum()};po.signOfDet2x2=function(e,t,n,i){var r=e.multiply(i).selfSubtract(t.multiply(n));return r.signum()};po.intersection=function(e,t,n,i){var r=Ut.valueOf(i.y).selfSubtract(n.y).selfMultiply(Ut.valueOf(t.x).selfSubtract(e.x)),l=Ut.valueOf(i.x).selfSubtract(n.x).selfMultiply(Ut.valueOf(t.y).selfSubtract(e.y)),f=r.subtract(l),a=Ut.valueOf(i.x).selfSubtract(n.x).selfMultiply(Ut.valueOf(e.y).selfSubtract(n.y)),_=Ut.valueOf(i.y).selfSubtract(n.y).selfMultiply(Ut.valueOf(e.x).selfSubtract(n.x)),x=a.subtract(_),S=x.selfDivide(f).doubleValue(),L=Ut.valueOf(e.x).selfAdd(Ut.valueOf(t.x).selfSubtract(e.x).selfMultiply(S)).doubleValue(),A=Ut.valueOf(t.x).selfSubtract(e.x).selfMultiply(Ut.valueOf(e.y).selfSubtract(n.y)),P=Ut.valueOf(t.y).selfSubtract(e.y).selfMultiply(Ut.valueOf(e.x).selfSubtract(n.x)),O=A.subtract(P),B=O.selfDivide(f).doubleValue(),U=Ut.valueOf(n.y).selfAdd(Ut.valueOf(i.y).selfSubtract(n.y).selfMultiply(B)).doubleValue();return new Dt(L,U)};po.orientationIndexFilter=function(e,t,n){var i=null,r=(e.x-n.x)*(t.y-n.y),l=(e.y-n.y)*(t.x-n.x),f=r-l;if(r>0){if(l<=0)return po.signum(f);i=r+l}else if(r<0){if(l>=0)return po.signum(f);i=-r-l}else return po.signum(f);var a=po.DP_SAFE_EPSILON*i;return f>=a||-f>=a?po.signum(f):2};po.signum=function(e){return e>0?1:e<0?-1:0};Sx.DP_SAFE_EPSILON.get=function(){return 1e-15};Object.defineProperties(po,Sx);var Mn=function(){},dd={X:{configurable:!0},Y:{configurable:!0},Z:{configurable:!0},M:{configurable:!0}};dd.X.get=function(){return 0};dd.Y.get=function(){return 1};dd.Z.get=function(){return 2};dd.M.get=function(){return 3};Mn.prototype.setOrdinate=function(e,t,n){};Mn.prototype.size=function(){};Mn.prototype.getOrdinate=function(e,t){};Mn.prototype.getCoordinate=function(){};Mn.prototype.getCoordinateCopy=function(e){};Mn.prototype.getDimension=function(){};Mn.prototype.getX=function(e){};Mn.prototype.clone=function(){};Mn.prototype.expandEnvelope=function(e){};Mn.prototype.copy=function(){};Mn.prototype.getY=function(e){};Mn.prototype.toCoordinateArray=function(){};Mn.prototype.interfaces_=function(){return[bg]};Mn.prototype.getClass=function(){return Mn};Object.defineProperties(Mn,dd);var Ex=function(){},lf=function(e){function t(){e.call(this,"Projective point not representable on the Cartesian plane.")}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(Ex),Lr=function(){};Lr.arraycopy=function(e,t,n,i,r){for(var l=0,f=t;f<t+r;f++)n[i+l]=e[f],l++};Lr.getProperty=function(e){return{"line.separator":`
`}[e]};var ks=function e(){if(this.x=null,this.y=null,this.w=null,arguments.length===0)this.x=0,this.y=0,this.w=1;else if(arguments.length===1){var t=arguments[0];this.x=t.x,this.y=t.y,this.w=1}else if(arguments.length===2){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var n=arguments[0],i=arguments[1];this.x=n,this.y=i,this.w=1}else if(arguments[0]instanceof e&&arguments[1]instanceof e){var r=arguments[0],l=arguments[1];this.x=r.y*l.w-l.y*r.w,this.y=l.x*r.w-r.x*l.w,this.w=r.x*l.y-l.x*r.y}else if(arguments[0]instanceof Dt&&arguments[1]instanceof Dt){var f=arguments[0],a=arguments[1];this.x=f.y-a.y,this.y=a.x-f.x,this.w=f.x*a.y-a.x*f.y}}else if(arguments.length===3){var _=arguments[0],x=arguments[1],S=arguments[2];this.x=_,this.y=x,this.w=S}else if(arguments.length===4){var L=arguments[0],A=arguments[1],P=arguments[2],O=arguments[3],B=L.y-A.y,U=A.x-L.x,Y=L.x*A.y-A.x*L.y,V=P.y-O.y,$=O.x-P.x,K=P.x*O.y-O.x*P.y;this.x=U*K-$*Y,this.y=V*Y-B*K,this.w=B*$-V*U}};ks.prototype.getY=function(){var e=this.y/this.w;if(tn.isNaN(e)||tn.isInfinite(e))throw new lf;return e};ks.prototype.getX=function(){var e=this.x/this.w;if(tn.isNaN(e)||tn.isInfinite(e))throw new lf;return e};ks.prototype.getCoordinate=function(){var e=new Dt;return e.x=this.getX(),e.y=this.getY(),e};ks.prototype.interfaces_=function(){return[]};ks.prototype.getClass=function(){return ks};ks.intersection=function(e,t,n,i){var r=e.y-t.y,l=t.x-e.x,f=e.x*t.y-t.x*e.y,a=n.y-i.y,_=i.x-n.x,x=n.x*i.y-i.x*n.y,S=l*x-_*f,L=a*f-r*x,A=r*_-a*l,P=S/A,O=L/A;if(tn.isNaN(P)||tn.isInfinite(P)||tn.isNaN(O)||tn.isInfinite(O))throw new lf;return new Dt(P,O)};var Oe=function e(){if(this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,arguments.length===0)this.init();else if(arguments.length===1){if(arguments[0]instanceof Dt){var t=arguments[0];this.init(t.x,t.x,t.y,t.y)}else if(arguments[0]instanceof e){var n=arguments[0];this.init(n)}}else if(arguments.length===2){var i=arguments[0],r=arguments[1];this.init(i.x,r.x,i.y,r.y)}else if(arguments.length===4){var l=arguments[0],f=arguments[1],a=arguments[2],_=arguments[3];this.init(l,f,a,_)}},Ix={serialVersionUID:{configurable:!0}};Oe.prototype.getArea=function(){return this.getWidth()*this.getHeight()};Oe.prototype.equals=function(e){if(!(e instanceof Oe))return!1;var t=e;return this.isNull()?t.isNull():this._maxx===t.getMaxX()&&this._maxy===t.getMaxY()&&this._minx===t.getMinX()&&this._miny===t.getMinY()};Oe.prototype.intersection=function(e){if(this.isNull()||e.isNull()||!this.intersects(e))return new Oe;var t=this._minx>e._minx?this._minx:e._minx,n=this._miny>e._miny?this._miny:e._miny,i=this._maxx<e._maxx?this._maxx:e._maxx,r=this._maxy<e._maxy?this._maxy:e._maxy;return new Oe(t,i,n,r)};Oe.prototype.isNull=function(){return this._maxx<this._minx};Oe.prototype.getMaxX=function(){return this._maxx};Oe.prototype.covers=function(){if(arguments.length===1){if(arguments[0]instanceof Dt){var e=arguments[0];return this.covers(e.x,e.y)}else if(arguments[0]instanceof Oe){var t=arguments[0];return this.isNull()||t.isNull()?!1:t.getMinX()>=this._minx&&t.getMaxX()<=this._maxx&&t.getMinY()>=this._miny&&t.getMaxY()<=this._maxy}}else if(arguments.length===2){var n=arguments[0],i=arguments[1];return this.isNull()?!1:n>=this._minx&&n<=this._maxx&&i>=this._miny&&i<=this._maxy}};Oe.prototype.intersects=function(){if(arguments.length===1){if(arguments[0]instanceof Oe){var e=arguments[0];return this.isNull()||e.isNull()?!1:!(e._minx>this._maxx||e._maxx<this._minx||e._miny>this._maxy||e._maxy<this._miny)}else if(arguments[0]instanceof Dt){var t=arguments[0];return this.intersects(t.x,t.y)}}else if(arguments.length===2){var n=arguments[0],i=arguments[1];return this.isNull()?!1:!(n>this._maxx||n<this._minx||i>this._maxy||i<this._miny)}};Oe.prototype.getMinY=function(){return this._miny};Oe.prototype.getMinX=function(){return this._minx};Oe.prototype.expandToInclude=function(){if(arguments.length===1){if(arguments[0]instanceof Dt){var e=arguments[0];this.expandToInclude(e.x,e.y)}else if(arguments[0]instanceof Oe){var t=arguments[0];if(t.isNull())return null;this.isNull()?(this._minx=t.getMinX(),this._maxx=t.getMaxX(),this._miny=t.getMinY(),this._maxy=t.getMaxY()):(t._minx<this._minx&&(this._minx=t._minx),t._maxx>this._maxx&&(this._maxx=t._maxx),t._miny<this._miny&&(this._miny=t._miny),t._maxy>this._maxy&&(this._maxy=t._maxy))}}else if(arguments.length===2){var n=arguments[0],i=arguments[1];this.isNull()?(this._minx=n,this._maxx=n,this._miny=i,this._maxy=i):(n<this._minx&&(this._minx=n),n>this._maxx&&(this._maxx=n),i<this._miny&&(this._miny=i),i>this._maxy&&(this._maxy=i))}};Oe.prototype.minExtent=function(){if(this.isNull())return 0;var e=this.getWidth(),t=this.getHeight();return e<t?e:t};Oe.prototype.getWidth=function(){return this.isNull()?0:this._maxx-this._minx};Oe.prototype.compareTo=function(e){var t=e;return this.isNull()?t.isNull()?0:-1:t.isNull()?1:this._minx<t._minx?-1:this._minx>t._minx?1:this._miny<t._miny?-1:this._miny>t._miny?1:this._maxx<t._maxx?-1:this._maxx>t._maxx?1:this._maxy<t._maxy?-1:this._maxy>t._maxy?1:0};Oe.prototype.translate=function(e,t){if(this.isNull())return null;this.init(this.getMinX()+e,this.getMaxX()+e,this.getMinY()+t,this.getMaxY()+t)};Oe.prototype.toString=function(){return"Env["+this._minx+" : "+this._maxx+", "+this._miny+" : "+this._maxy+"]"};Oe.prototype.setToNull=function(){this._minx=0,this._maxx=-1,this._miny=0,this._maxy=-1};Oe.prototype.getHeight=function(){return this.isNull()?0:this._maxy-this._miny};Oe.prototype.maxExtent=function(){if(this.isNull())return 0;var e=this.getWidth(),t=this.getHeight();return e>t?e:t};Oe.prototype.expandBy=function(){if(arguments.length===1){var e=arguments[0];this.expandBy(e,e)}else if(arguments.length===2){var t=arguments[0],n=arguments[1];if(this.isNull())return null;this._minx-=t,this._maxx+=t,this._miny-=n,this._maxy+=n,(this._minx>this._maxx||this._miny>this._maxy)&&this.setToNull()}};Oe.prototype.contains=function(){if(arguments.length===1){if(arguments[0]instanceof Oe){var e=arguments[0];return this.covers(e)}else if(arguments[0]instanceof Dt){var t=arguments[0];return this.covers(t)}}else if(arguments.length===2){var n=arguments[0],i=arguments[1];return this.covers(n,i)}};Oe.prototype.centre=function(){return this.isNull()?null:new Dt((this.getMinX()+this.getMaxX())/2,(this.getMinY()+this.getMaxY())/2)};Oe.prototype.init=function(){if(arguments.length===0)this.setToNull();else if(arguments.length===1){if(arguments[0]instanceof Dt){var e=arguments[0];this.init(e.x,e.x,e.y,e.y)}else if(arguments[0]instanceof Oe){var t=arguments[0];this._minx=t._minx,this._maxx=t._maxx,this._miny=t._miny,this._maxy=t._maxy}}else if(arguments.length===2){var n=arguments[0],i=arguments[1];this.init(n.x,i.x,n.y,i.y)}else if(arguments.length===4){var r=arguments[0],l=arguments[1],f=arguments[2],a=arguments[3];r<l?(this._minx=r,this._maxx=l):(this._minx=l,this._maxx=r),f<a?(this._miny=f,this._maxy=a):(this._miny=a,this._maxy=f)}};Oe.prototype.getMaxY=function(){return this._maxy};Oe.prototype.distance=function(e){if(this.intersects(e))return 0;var t=0;this._maxx<e._minx?t=e._minx-this._maxx:this._minx>e._maxx&&(t=this._minx-e._maxx);var n=0;return this._maxy<e._miny?n=e._miny-this._maxy:this._miny>e._maxy&&(n=this._miny-e._maxy),t===0?n:n===0?t:Math.sqrt(t*t+n*n)};Oe.prototype.hashCode=function(){var e=17;return e=37*e+Dt.hashCode(this._minx),e=37*e+Dt.hashCode(this._maxx),e=37*e+Dt.hashCode(this._miny),e=37*e+Dt.hashCode(this._maxy),e};Oe.prototype.interfaces_=function(){return[bs,xs]};Oe.prototype.getClass=function(){return Oe};Oe.intersects=function(){if(arguments.length===3){var e=arguments[0],t=arguments[1],n=arguments[2];return n.x>=(e.x<t.x?e.x:t.x)&&n.x<=(e.x>t.x?e.x:t.x)&&n.y>=(e.y<t.y?e.y:t.y)&&n.y<=(e.y>t.y?e.y:t.y)}else if(arguments.length===4){var i=arguments[0],r=arguments[1],l=arguments[2],f=arguments[3],a=Math.min(l.x,f.x),_=Math.max(l.x,f.x),x=Math.min(i.x,r.x),S=Math.max(i.x,r.x);return!(x>_||S<a||(a=Math.min(l.y,f.y),_=Math.max(l.y,f.y),x=Math.min(i.y,r.y),S=Math.max(i.y,r.y),x>_)||S<a)}};Ix.serialVersionUID.get=function(){return 5873921885273102e3};Object.defineProperties(Oe,Ix);var Js={typeStr:/^\s*(\w+)\s*\(\s*(.*)\s*\)\s*$/,emptyTypeStr:/^\s*(\w+)\s*EMPTY\s*$/,spaces:/\s+/,parenComma:/\)\s*,\s*\(/,doubleParenComma:/\)\s*\)\s*,\s*\(\s*\(/,trimParens:/^\s*\(?(.*?)\)?\s*$/},xg=function(e){this.geometryFactory=e||new mn};xg.prototype.read=function(e){var t,n,i;e=e.replace(/[\n\r]/g," ");var r=Js.typeStr.exec(e);if(e.search("EMPTY")!==-1&&(r=Js.emptyTypeStr.exec(e),r[2]=void 0),r&&(n=r[1].toLowerCase(),i=r[2],Ah[n]&&(t=Ah[n].apply(this,[i]))),t===void 0)throw new Error("Could not parse WKT "+e);return t};xg.prototype.write=function(e){return this.extractGeometry(e)};xg.prototype.extractGeometry=function(e){var t=e.getGeometryType().toLowerCase();if(!al[t])return null;var n=t.toUpperCase(),i;return e.isEmpty()?i=n+" EMPTY":i=n+"("+al[t].apply(this,[e])+")",i};var al={coordinate:function(e){return e.x+" "+e.y},point:function(e){return al.coordinate.call(this,e._coordinates._coordinates[0])},multipoint:function(e){for(var t=this,n=[],i=0,r=e._geometries.length;i<r;++i)n.push("("+al.point.apply(t,[e._geometries[i]])+")");return n.join(",")},linestring:function(e){for(var t=this,n=[],i=0,r=e._points._coordinates.length;i<r;++i)n.push(al.coordinate.apply(t,[e._points._coordinates[i]]));return n.join(",")},linearring:function(e){for(var t=this,n=[],i=0,r=e._points._coordinates.length;i<r;++i)n.push(al.coordinate.apply(t,[e._points._coordinates[i]]));return n.join(",")},multilinestring:function(e){for(var t=this,n=[],i=0,r=e._geometries.length;i<r;++i)n.push("("+al.linestring.apply(t,[e._geometries[i]])+")");return n.join(",")},polygon:function(e){var t=this,n=[];n.push("("+al.linestring.apply(this,[e._shell])+")");for(var i=0,r=e._holes.length;i<r;++i)n.push("("+al.linestring.apply(t,[e._holes[i]])+")");return n.join(",")},multipolygon:function(e){for(var t=this,n=[],i=0,r=e._geometries.length;i<r;++i)n.push("("+al.polygon.apply(t,[e._geometries[i]])+")");return n.join(",")},geometrycollection:function(e){for(var t=this,n=[],i=0,r=e._geometries.length;i<r;++i)n.push(t.extractGeometry(e._geometries[i]));return n.join(",")}},Ah={point:function(e){if(e===void 0)return this.geometryFactory.createPoint();var t=e.trim().split(Js.spaces);return this.geometryFactory.createPoint(new Dt(Number.parseFloat(t[0]),Number.parseFloat(t[1])))},multipoint:function(e){var t=this;if(e===void 0)return this.geometryFactory.createMultiPoint();for(var n,i=e.trim().split(","),r=[],l=0,f=i.length;l<f;++l)n=i[l].replace(Js.trimParens,"$1"),r.push(Ah.point.apply(t,[n]));return this.geometryFactory.createMultiPoint(r)},linestring:function(e){if(e===void 0)return this.geometryFactory.createLineString();for(var t=e.trim().split(","),n=[],i,r=0,l=t.length;r<l;++r)i=t[r].trim().split(Js.spaces),n.push(new Dt(Number.parseFloat(i[0]),Number.parseFloat(i[1])));return this.geometryFactory.createLineString(n)},linearring:function(e){if(e===void 0)return this.geometryFactory.createLinearRing();for(var t=e.trim().split(","),n=[],i,r=0,l=t.length;r<l;++r)i=t[r].trim().split(Js.spaces),n.push(new Dt(Number.parseFloat(i[0]),Number.parseFloat(i[1])));return this.geometryFactory.createLinearRing(n)},multilinestring:function(e){var t=this;if(e===void 0)return this.geometryFactory.createMultiLineString();for(var n,i=e.trim().split(Js.parenComma),r=[],l=0,f=i.length;l<f;++l)n=i[l].replace(Js.trimParens,"$1"),r.push(Ah.linestring.apply(t,[n]));return this.geometryFactory.createMultiLineString(r)},polygon:function(e){var t=this;if(e===void 0)return this.geometryFactory.createPolygon();for(var n,i,r,l=e.trim().split(Js.parenComma),f,a=[],_=0,x=l.length;_<x;++_)n=l[_].replace(Js.trimParens,"$1"),i=Ah.linestring.apply(t,[n]),r=t.geometryFactory.createLinearRing(i._points),_===0?f=r:a.push(r);return this.geometryFactory.createPolygon(f,a)},multipolygon:function(e){var t=this;if(e===void 0)return this.geometryFactory.createMultiPolygon();for(var n,i=e.trim().split(Js.doubleParenComma),r=[],l=0,f=i.length;l<f;++l)n=i[l].replace(Js.trimParens,"$1"),r.push(Ah.polygon.apply(t,[n]));return this.geometryFactory.createMultiPolygon(r)},geometrycollection:function(e){var t=this;if(e===void 0)return this.geometryFactory.createGeometryCollection();e=e.replace(/,\s*([A-Za-z])/g,"|$1");for(var n=e.trim().split("|"),i=[],r=0,l=n.length;r<l;++r)i.push(t.read(n[r]));return this.geometryFactory.createGeometryCollection(i)}},Ns=function(e){this.parser=new xg(e)};Ns.prototype.write=function(e){return this.parser.write(e)};Ns.toLineString=function(e,t){if(arguments.length!==2)throw new Error("Not implemented");return"LINESTRING ( "+e.x+" "+e.y+", "+t.x+" "+t.y+" )"};var dl=function(e){function t(n){e.call(this,n),this.name="RuntimeException",this.message=n,this.stack=new e().stack}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(Error),eg=function(e){function t(){if(e.call(this),arguments.length===0)e.call(this);else if(arguments.length===1){var n=arguments[0];e.call(this,n)}}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(dl),an=function(){};an.prototype.interfaces_=function(){return[]};an.prototype.getClass=function(){return an};an.shouldNeverReachHere=function(){if(arguments.length===0)an.shouldNeverReachHere(null);else if(arguments.length===1){var e=arguments[0];throw new eg("Should never reach here"+(e!==null?": "+e:""))}};an.isTrue=function(){var e,t;if(arguments.length===1)e=arguments[0],an.isTrue(e,null);else if(arguments.length===2&&(e=arguments[0],t=arguments[1],!e))throw t===null?new eg:new eg(t)};an.equals=function(){var e,t,n;if(arguments.length===2)e=arguments[0],t=arguments[1],an.equals(e,t,null);else if(arguments.length===3&&(e=arguments[0],t=arguments[1],n=arguments[2],!t.equals(e)))throw new eg("Expected "+e+" but encountered "+t+(n!==null?": "+n:""))};var wi=function(){this._result=null,this._inputLines=Array(2).fill().map(function(){return Array(2)}),this._intPt=new Array(2).fill(null),this._intLineIndex=null,this._isProper=null,this._pa=null,this._pb=null,this._precisionModel=null,this._intPt[0]=new Dt,this._intPt[1]=new Dt,this._pa=this._intPt[0],this._pb=this._intPt[1],this._result=0},Oc={DONT_INTERSECT:{configurable:!0},DO_INTERSECT:{configurable:!0},COLLINEAR:{configurable:!0},NO_INTERSECTION:{configurable:!0},POINT_INTERSECTION:{configurable:!0},COLLINEAR_INTERSECTION:{configurable:!0}};wi.prototype.getIndexAlongSegment=function(e,t){return this.computeIntLineIndex(),this._intLineIndex[e][t]};wi.prototype.getTopologySummary=function(){var e=new xa;return this.isEndPoint()&&e.append(" endpoint"),this._isProper&&e.append(" proper"),this.isCollinear()&&e.append(" collinear"),e.toString()};wi.prototype.computeIntersection=function(e,t,n,i){this._inputLines[0][0]=e,this._inputLines[0][1]=t,this._inputLines[1][0]=n,this._inputLines[1][1]=i,this._result=this.computeIntersect(e,t,n,i)};wi.prototype.getIntersectionNum=function(){return this._result};wi.prototype.computeIntLineIndex=function(){if(arguments.length===0)this._intLineIndex===null&&(this._intLineIndex=Array(2).fill().map(function(){return Array(2)}),this.computeIntLineIndex(0),this.computeIntLineIndex(1));else if(arguments.length===1){var e=arguments[0],t=this.getEdgeDistance(e,0),n=this.getEdgeDistance(e,1);t>n?(this._intLineIndex[e][0]=0,this._intLineIndex[e][1]=1):(this._intLineIndex[e][0]=1,this._intLineIndex[e][1]=0)}};wi.prototype.isProper=function(){return this.hasIntersection()&&this._isProper};wi.prototype.setPrecisionModel=function(e){this._precisionModel=e};wi.prototype.isInteriorIntersection=function(){var e=this;if(arguments.length===0)return!!(this.isInteriorIntersection(0)||this.isInteriorIntersection(1));if(arguments.length===1){for(var t=arguments[0],n=0;n<this._result;n++)if(!(e._intPt[n].equals2D(e._inputLines[t][0])||e._intPt[n].equals2D(e._inputLines[t][1])))return!0;return!1}};wi.prototype.getIntersection=function(e){return this._intPt[e]};wi.prototype.isEndPoint=function(){return this.hasIntersection()&&!this._isProper};wi.prototype.hasIntersection=function(){return this._result!==wi.NO_INTERSECTION};wi.prototype.getEdgeDistance=function(e,t){var n=wi.computeEdgeDistance(this._intPt[t],this._inputLines[e][0],this._inputLines[e][1]);return n};wi.prototype.isCollinear=function(){return this._result===wi.COLLINEAR_INTERSECTION};wi.prototype.toString=function(){return Ns.toLineString(this._inputLines[0][0],this._inputLines[0][1])+" - "+Ns.toLineString(this._inputLines[1][0],this._inputLines[1][1])+this.getTopologySummary()};wi.prototype.getEndpoint=function(e,t){return this._inputLines[e][t]};wi.prototype.isIntersection=function(e){for(var t=this,n=0;n<this._result;n++)if(t._intPt[n].equals2D(e))return!0;return!1};wi.prototype.getIntersectionAlongSegment=function(e,t){return this.computeIntLineIndex(),this._intPt[this._intLineIndex[e][t]]};wi.prototype.interfaces_=function(){return[]};wi.prototype.getClass=function(){return wi};wi.computeEdgeDistance=function(e,t,n){var i=Math.abs(n.x-t.x),r=Math.abs(n.y-t.y),l=-1;if(e.equals(t))l=0;else if(e.equals(n))i>r?l=i:l=r;else{var f=Math.abs(e.x-t.x),a=Math.abs(e.y-t.y);i>r?l=f:l=a,l===0&&!e.equals(t)&&(l=Math.max(f,a))}return an.isTrue(!(l===0&&!e.equals(t)),"Bad distance calculation"),l};wi.nonRobustComputeEdgeDistance=function(e,t,n){var i=e.x-t.x,r=e.y-t.y,l=Math.sqrt(i*i+r*r);return an.isTrue(!(l===0&&!e.equals(t)),"Invalid distance calculation"),l};Oc.DONT_INTERSECT.get=function(){return 0};Oc.DO_INTERSECT.get=function(){return 1};Oc.COLLINEAR.get=function(){return 2};Oc.NO_INTERSECTION.get=function(){return 0};Oc.POINT_INTERSECTION.get=function(){return 1};Oc.COLLINEAR_INTERSECTION.get=function(){return 2};Object.defineProperties(wi,Oc);var Zu=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.isInSegmentEnvelopes=function(n){var i=new Oe(this._inputLines[0][0],this._inputLines[0][1]),r=new Oe(this._inputLines[1][0],this._inputLines[1][1]);return i.contains(n)&&r.contains(n)},t.prototype.computeIntersection=function(){if(arguments.length===3){var n=arguments[0],i=arguments[1],r=arguments[2];if(this._isProper=!1,Oe.intersects(i,r,n)&&be.orientationIndex(i,r,n)===0&&be.orientationIndex(r,i,n)===0)return this._isProper=!0,(n.equals(i)||n.equals(r))&&(this._isProper=!1),this._result=e.POINT_INTERSECTION,null;this._result=e.NO_INTERSECTION}else return e.prototype.computeIntersection.apply(this,arguments)},t.prototype.normalizeToMinimum=function(n,i,r,l,f){f.x=this.smallestInAbsValue(n.x,i.x,r.x,l.x),f.y=this.smallestInAbsValue(n.y,i.y,r.y,l.y),n.x-=f.x,n.y-=f.y,i.x-=f.x,i.y-=f.y,r.x-=f.x,r.y-=f.y,l.x-=f.x,l.y-=f.y},t.prototype.safeHCoordinateIntersection=function(n,i,r,l){var f=null;try{f=ks.intersection(n,i,r,l)}catch(a){if(a instanceof lf)f=t.nearestEndpoint(n,i,r,l);else throw a}finally{}return f},t.prototype.intersection=function(n,i,r,l){var f=this.intersectionWithNormalization(n,i,r,l);return this.isInSegmentEnvelopes(f)||(f=new Dt(t.nearestEndpoint(n,i,r,l))),this._precisionModel!==null&&this._precisionModel.makePrecise(f),f},t.prototype.smallestInAbsValue=function(n,i,r,l){var f=n,a=Math.abs(f);return Math.abs(i)<a&&(f=i,a=Math.abs(i)),Math.abs(r)<a&&(f=r,a=Math.abs(r)),Math.abs(l)<a&&(f=l),f},t.prototype.checkDD=function(n,i,r,l,f){var a=po.intersection(n,i,r,l),_=this.isInSegmentEnvelopes(a);Lr.out.println("DD in env = "+_+"  --------------------- "+a),f.distance(a)>1e-4&&Lr.out.println("Distance = "+f.distance(a))},t.prototype.intersectionWithNormalization=function(n,i,r,l){var f=new Dt(n),a=new Dt(i),_=new Dt(r),x=new Dt(l),S=new Dt;this.normalizeToEnvCentre(f,a,_,x,S);var L=this.safeHCoordinateIntersection(f,a,_,x);return L.x+=S.x,L.y+=S.y,L},t.prototype.computeCollinearIntersection=function(n,i,r,l){var f=Oe.intersects(n,i,r),a=Oe.intersects(n,i,l),_=Oe.intersects(r,l,n),x=Oe.intersects(r,l,i);return f&&a?(this._intPt[0]=r,this._intPt[1]=l,e.COLLINEAR_INTERSECTION):_&&x?(this._intPt[0]=n,this._intPt[1]=i,e.COLLINEAR_INTERSECTION):f&&_?(this._intPt[0]=r,this._intPt[1]=n,r.equals(n)&&!a&&!x?e.POINT_INTERSECTION:e.COLLINEAR_INTERSECTION):f&&x?(this._intPt[0]=r,this._intPt[1]=i,r.equals(i)&&!a&&!_?e.POINT_INTERSECTION:e.COLLINEAR_INTERSECTION):a&&_?(this._intPt[0]=l,this._intPt[1]=n,l.equals(n)&&!f&&!x?e.POINT_INTERSECTION:e.COLLINEAR_INTERSECTION):a&&x?(this._intPt[0]=l,this._intPt[1]=i,l.equals(i)&&!f&&!_?e.POINT_INTERSECTION:e.COLLINEAR_INTERSECTION):e.NO_INTERSECTION},t.prototype.normalizeToEnvCentre=function(n,i,r,l,f){var a=n.x<i.x?n.x:i.x,_=n.y<i.y?n.y:i.y,x=n.x>i.x?n.x:i.x,S=n.y>i.y?n.y:i.y,L=r.x<l.x?r.x:l.x,A=r.y<l.y?r.y:l.y,P=r.x>l.x?r.x:l.x,O=r.y>l.y?r.y:l.y,B=a>L?a:L,U=x<P?x:P,Y=_>A?_:A,V=S<O?S:O,$=(B+U)/2,K=(Y+V)/2;f.x=$,f.y=K,n.x-=f.x,n.y-=f.y,i.x-=f.x,i.y-=f.y,r.x-=f.x,r.y-=f.y,l.x-=f.x,l.y-=f.y},t.prototype.computeIntersect=function(n,i,r,l){if(this._isProper=!1,!Oe.intersects(n,i,r,l))return e.NO_INTERSECTION;var f=be.orientationIndex(n,i,r),a=be.orientationIndex(n,i,l);if(f>0&&a>0||f<0&&a<0)return e.NO_INTERSECTION;var _=be.orientationIndex(r,l,n),x=be.orientationIndex(r,l,i);if(_>0&&x>0||_<0&&x<0)return e.NO_INTERSECTION;var S=f===0&&a===0&&_===0&&x===0;return S?this.computeCollinearIntersection(n,i,r,l):(f===0||a===0||_===0||x===0?(this._isProper=!1,n.equals2D(r)||n.equals2D(l)?this._intPt[0]=n:i.equals2D(r)||i.equals2D(l)?this._intPt[0]=i:f===0?this._intPt[0]=new Dt(r):a===0?this._intPt[0]=new Dt(l):_===0?this._intPt[0]=new Dt(n):x===0&&(this._intPt[0]=new Dt(i))):(this._isProper=!0,this._intPt[0]=this.intersection(n,i,r,l)),e.POINT_INTERSECTION)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t.nearestEndpoint=function(n,i,r,l){var f=n,a=be.distancePointLine(n,r,l),_=be.distancePointLine(i,r,l);return _<a&&(a=_,f=i),_=be.distancePointLine(r,n,i),_<a&&(a=_,f=r),_=be.distancePointLine(l,n,i),_<a&&(a=_,f=l),f},t}(wi),xc=function(){};xc.prototype.interfaces_=function(){return[]};xc.prototype.getClass=function(){return xc};xc.orientationIndex=function(e,t,n){var i=t.x-e.x,r=t.y-e.y,l=n.x-t.x,f=n.y-t.y;return xc.signOfDet2x2(i,r,l,f)};xc.signOfDet2x2=function(e,t,n,i){var r=null,l=null,f=null;if(r=1,e===0||i===0)return t===0||n===0?0:t>0?n>0?-r:r:n>0?r:-r;if(t===0||n===0)return i>0?e>0?r:-r:e>0?-r:r;if(t>0?i>0?t<=i||(r=-r,l=e,e=n,n=l,l=t,t=i,i=l):t<=-i?(r=-r,n=-n,i=-i):(l=e,e=-n,n=l,l=t,t=-i,i=l):i>0?-t<=i?(r=-r,e=-e,t=-t):(l=-e,e=n,n=l,l=-t,t=i,i=l):t>=i?(e=-e,t=-t,n=-n,i=-i):(r=-r,l=-e,e=-n,n=l,l=-t,t=-i,i=l),e>0)if(n>0){if(!(e<=n))return r}else return r;else{if(n>0)return-r;if(e>=n)r=-r,e=-e,n=-n;else return-r}for(;;){if(f=Math.floor(n/e),n=n-f*e,i=i-f*t,i<0)return-r;if(i>t)return r;if(e>n+n){if(t<i+i)return r}else{if(t>i+i)return-r;n=e-n,i=t-i,r=-r}if(i===0)return n===0?0:-r;if(n===0||(f=Math.floor(e/n),e=e-f*n,t=t-f*i,t<0))return r;if(t>i)return-r;if(n>e+e){if(i<t+t)return-r}else{if(i>t+t)return r;e=n-e,t=i-t,r=-r}if(t===0)return e===0?0:r;if(e===0)return-r}};var oa=function(){this._p=null,this._crossingCount=0,this._isPointOnSegment=!1;var e=arguments[0];this._p=e};oa.prototype.countSegment=function(e,t){if(e.x<this._p.x&&t.x<this._p.x)return null;if(this._p.x===t.x&&this._p.y===t.y)return this._isPointOnSegment=!0,null;if(e.y===this._p.y&&t.y===this._p.y){var n=e.x,i=t.x;return n>i&&(n=t.x,i=e.x),this._p.x>=n&&this._p.x<=i&&(this._isPointOnSegment=!0),null}if(e.y>this._p.y&&t.y<=this._p.y||t.y>this._p.y&&e.y<=this._p.y){var r=e.x-this._p.x,l=e.y-this._p.y,f=t.x-this._p.x,a=t.y-this._p.y,_=xc.signOfDet2x2(r,l,f,a);if(_===0)return this._isPointOnSegment=!0,null;a<l&&(_=-_),_>0&&this._crossingCount++}};oa.prototype.isPointInPolygon=function(){return this.getLocation()!==zt.EXTERIOR};oa.prototype.getLocation=function(){return this._isPointOnSegment?zt.BOUNDARY:this._crossingCount%2===1?zt.INTERIOR:zt.EXTERIOR};oa.prototype.isOnSegment=function(){return this._isPointOnSegment};oa.prototype.interfaces_=function(){return[]};oa.prototype.getClass=function(){return oa};oa.locatePointInRing=function(){if(arguments[0]instanceof Dt&&We(arguments[1],Mn)){for(var e=arguments[0],t=arguments[1],n=new oa(e),i=new Dt,r=new Dt,l=1;l<t.size();l++)if(t.getCoordinate(l,i),t.getCoordinate(l-1,r),n.countSegment(i,r),n.isOnSegment())return n.getLocation();return n.getLocation()}else if(arguments[0]instanceof Dt&&arguments[1]instanceof Array){for(var f=arguments[0],a=arguments[1],_=new oa(f),x=1;x<a.length;x++){var S=a[x],L=a[x-1];if(_.countSegment(S,L),_.isOnSegment())return _.getLocation()}return _.getLocation()}};var be=function(){},zc={CLOCKWISE:{configurable:!0},RIGHT:{configurable:!0},COUNTERCLOCKWISE:{configurable:!0},LEFT:{configurable:!0},COLLINEAR:{configurable:!0},STRAIGHT:{configurable:!0}};be.prototype.interfaces_=function(){return[]};be.prototype.getClass=function(){return be};be.orientationIndex=function(e,t,n){return po.orientationIndex(e,t,n)};be.signedArea=function(){if(arguments[0]instanceof Array){var e=arguments[0];if(e.length<3)return 0;for(var t=0,n=e[0].x,i=1;i<e.length-1;i++){var r=e[i].x-n,l=e[i+1].y,f=e[i-1].y;t+=r*(f-l)}return t/2}else if(We(arguments[0],Mn)){var a=arguments[0],_=a.size();if(_<3)return 0;var x=new Dt,S=new Dt,L=new Dt;a.getCoordinate(0,S),a.getCoordinate(1,L);var A=S.x;L.x-=A;for(var P=0,O=1;O<_-1;O++)x.y=S.y,S.x=L.x,S.y=L.y,a.getCoordinate(O+1,L),L.x-=A,P+=S.x*(x.y-L.y);return P/2}};be.distanceLineLine=function(e,t,n,i){if(e.equals(t))return be.distancePointLine(e,n,i);if(n.equals(i))return be.distancePointLine(i,e,t);var r=!1;if(!Oe.intersects(e,t,n,i))r=!0;else{var l=(t.x-e.x)*(i.y-n.y)-(t.y-e.y)*(i.x-n.x);if(l===0)r=!0;else{var f=(e.y-n.y)*(i.x-n.x)-(e.x-n.x)*(i.y-n.y),a=(e.y-n.y)*(t.x-e.x)-(e.x-n.x)*(t.y-e.y),_=a/l,x=f/l;(x<0||x>1||_<0||_>1)&&(r=!0)}}return r?Ho.min(be.distancePointLine(e,n,i),be.distancePointLine(t,n,i),be.distancePointLine(n,e,t),be.distancePointLine(i,e,t)):0};be.isPointInRing=function(e,t){return be.locatePointInRing(e,t)!==zt.EXTERIOR};be.computeLength=function(e){var t=e.size();if(t<=1)return 0;var n=0,i=new Dt;e.getCoordinate(0,i);for(var r=i.x,l=i.y,f=1;f<t;f++){e.getCoordinate(f,i);var a=i.x,_=i.y,x=a-r,S=_-l;n+=Math.sqrt(x*x+S*S),r=a,l=_}return n};be.isCCW=function(e){var t=e.length-1;if(t<3)throw new _i("Ring has fewer than 4 points, so orientation cannot be determined");for(var n=e[0],i=0,r=1;r<=t;r++){var l=e[r];l.y>n.y&&(n=l,i=r)}var f=i;do f=f-1,f<0&&(f=t);while(e[f].equals2D(n)&&f!==i);var a=i;do a=(a+1)%t;while(e[a].equals2D(n)&&a!==i);var _=e[f],x=e[a];if(_.equals2D(n)||x.equals2D(n)||_.equals2D(x))return!1;var S=be.computeOrientation(_,n,x),L=!1;return S===0?L=_.x>x.x:L=S>0,L};be.locatePointInRing=function(e,t){return oa.locatePointInRing(e,t)};be.distancePointLinePerpendicular=function(e,t,n){var i=(n.x-t.x)*(n.x-t.x)+(n.y-t.y)*(n.y-t.y),r=((t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y))/i;return Math.abs(r)*Math.sqrt(i)};be.computeOrientation=function(e,t,n){return be.orientationIndex(e,t,n)};be.distancePointLine=function(){if(arguments.length===2){var e=arguments[0],t=arguments[1];if(t.length===0)throw new _i("Line array must contain at least one vertex");for(var n=e.distance(t[0]),i=0;i<t.length-1;i++){var r=be.distancePointLine(e,t[i],t[i+1]);r<n&&(n=r)}return n}else if(arguments.length===3){var l=arguments[0],f=arguments[1],a=arguments[2];if(f.x===a.x&&f.y===a.y)return l.distance(f);var _=(a.x-f.x)*(a.x-f.x)+(a.y-f.y)*(a.y-f.y),x=((l.x-f.x)*(a.x-f.x)+(l.y-f.y)*(a.y-f.y))/_;if(x<=0)return l.distance(f);if(x>=1)return l.distance(a);var S=((f.y-l.y)*(a.x-f.x)-(f.x-l.x)*(a.y-f.y))/_;return Math.abs(S)*Math.sqrt(_)}};be.isOnLine=function(e,t){for(var n=new Zu,i=1;i<t.length;i++){var r=t[i-1],l=t[i];if(n.computeIntersection(e,r,l),n.hasIntersection())return!0}return!1};zc.CLOCKWISE.get=function(){return-1};zc.RIGHT.get=function(){return be.CLOCKWISE};zc.COUNTERCLOCKWISE.get=function(){return 1};zc.LEFT.get=function(){return be.COUNTERCLOCKWISE};zc.COLLINEAR.get=function(){return 0};zc.STRAIGHT.get=function(){return be.COLLINEAR};Object.defineProperties(be,zc);var ml=function(){};ml.prototype.filter=function(e){};ml.prototype.interfaces_=function(){return[]};ml.prototype.getClass=function(){return ml};var $e=function(){var e=arguments[0];this._envelope=null,this._factory=null,this._SRID=null,this._userData=null,this._factory=e,this._SRID=e.getSRID()},Xa={serialVersionUID:{configurable:!0},SORTINDEX_POINT:{configurable:!0},SORTINDEX_MULTIPOINT:{configurable:!0},SORTINDEX_LINESTRING:{configurable:!0},SORTINDEX_LINEARRING:{configurable:!0},SORTINDEX_MULTILINESTRING:{configurable:!0},SORTINDEX_POLYGON:{configurable:!0},SORTINDEX_MULTIPOLYGON:{configurable:!0},SORTINDEX_GEOMETRYCOLLECTION:{configurable:!0},geometryChangedFilter:{configurable:!0}};$e.prototype.isGeometryCollection=function(){return this.getSortIndex()===$e.SORTINDEX_GEOMETRYCOLLECTION};$e.prototype.getFactory=function(){return this._factory};$e.prototype.getGeometryN=function(e){return this};$e.prototype.getArea=function(){return 0};$e.prototype.isRectangle=function(){return!1};$e.prototype.equals=function(){if(arguments[0]instanceof $e){var e=arguments[0];return e===null?!1:this.equalsTopo(e)}else if(arguments[0]instanceof Object){var t=arguments[0];if(!(t instanceof $e))return!1;var n=t;return this.equalsExact(n)}};$e.prototype.equalsExact=function(e){return this===e||this.equalsExact(e,0)};$e.prototype.geometryChanged=function(){this.apply($e.geometryChangedFilter)};$e.prototype.geometryChangedAction=function(){this._envelope=null};$e.prototype.equalsNorm=function(e){return e===null?!1:this.norm().equalsExact(e.norm())};$e.prototype.getLength=function(){return 0};$e.prototype.getNumGeometries=function(){return 1};$e.prototype.compareTo=function(){if(arguments.length===1){var e=arguments[0],t=e;return this.getSortIndex()!==t.getSortIndex()?this.getSortIndex()-t.getSortIndex():this.isEmpty()&&t.isEmpty()?0:this.isEmpty()?-1:t.isEmpty()?1:this.compareToSameClass(e)}else if(arguments.length===2){var n=arguments[0],i=arguments[1];return this.getSortIndex()!==n.getSortIndex()?this.getSortIndex()-n.getSortIndex():this.isEmpty()&&n.isEmpty()?0:this.isEmpty()?-1:n.isEmpty()?1:this.compareToSameClass(n,i)}};$e.prototype.getUserData=function(){return this._userData};$e.prototype.getSRID=function(){return this._SRID};$e.prototype.getEnvelope=function(){return this.getFactory().toGeometry(this.getEnvelopeInternal())};$e.prototype.checkNotGeometryCollection=function(e){if(e.getSortIndex()===$e.SORTINDEX_GEOMETRYCOLLECTION)throw new _i("This method does not support GeometryCollection arguments")};$e.prototype.equal=function(e,t,n){return n===0?e.equals(t):e.distance(t)<=n};$e.prototype.norm=function(){var e=this.copy();return e.normalize(),e};$e.prototype.getPrecisionModel=function(){return this._factory.getPrecisionModel()};$e.prototype.getEnvelopeInternal=function(){return this._envelope===null&&(this._envelope=this.computeEnvelopeInternal()),new Oe(this._envelope)};$e.prototype.setSRID=function(e){this._SRID=e};$e.prototype.setUserData=function(e){this._userData=e};$e.prototype.compare=function(e,t){for(var n=e.iterator(),i=t.iterator();n.hasNext()&&i.hasNext();){var r=n.next(),l=i.next(),f=r.compareTo(l);if(f!==0)return f}return n.hasNext()?1:i.hasNext()?-1:0};$e.prototype.hashCode=function(){return this.getEnvelopeInternal().hashCode()};$e.prototype.isGeometryCollectionOrDerived=function(){return this.getSortIndex()===$e.SORTINDEX_GEOMETRYCOLLECTION||this.getSortIndex()===$e.SORTINDEX_MULTIPOINT||this.getSortIndex()===$e.SORTINDEX_MULTILINESTRING||this.getSortIndex()===$e.SORTINDEX_MULTIPOLYGON};$e.prototype.interfaces_=function(){return[bg,bs,xs]};$e.prototype.getClass=function(){return $e};$e.hasNonEmptyElements=function(e){for(var t=0;t<e.length;t++)if(!e[t].isEmpty())return!0;return!1};$e.hasNullElements=function(e){for(var t=0;t<e.length;t++)if(e[t]===null)return!0;return!1};Xa.serialVersionUID.get=function(){return 8763622679187377e3};Xa.SORTINDEX_POINT.get=function(){return 0};Xa.SORTINDEX_MULTIPOINT.get=function(){return 1};Xa.SORTINDEX_LINESTRING.get=function(){return 2};Xa.SORTINDEX_LINEARRING.get=function(){return 3};Xa.SORTINDEX_MULTILINESTRING.get=function(){return 4};Xa.SORTINDEX_POLYGON.get=function(){return 5};Xa.SORTINDEX_MULTIPOLYGON.get=function(){return 6};Xa.SORTINDEX_GEOMETRYCOLLECTION.get=function(){return 7};Xa.geometryChangedFilter.get=function(){return Dy};Object.defineProperties($e,Xa);var Dy=function(){};Dy.interfaces_=function(){return[ml]};Dy.filter=function(e){e.geometryChangedAction()};var Ba=function(){};Ba.prototype.filter=function(e){};Ba.prototype.interfaces_=function(){return[]};Ba.prototype.getClass=function(){return Ba};var _s=function(){},bl={Mod2BoundaryNodeRule:{configurable:!0},EndPointBoundaryNodeRule:{configurable:!0},MultiValentEndPointBoundaryNodeRule:{configurable:!0},MonoValentEndPointBoundaryNodeRule:{configurable:!0},MOD2_BOUNDARY_RULE:{configurable:!0},ENDPOINT_BOUNDARY_RULE:{configurable:!0},MULTIVALENT_ENDPOINT_BOUNDARY_RULE:{configurable:!0},MONOVALENT_ENDPOINT_BOUNDARY_RULE:{configurable:!0},OGC_SFS_BOUNDARY_RULE:{configurable:!0}};_s.prototype.isInBoundary=function(e){};_s.prototype.interfaces_=function(){return[]};_s.prototype.getClass=function(){return _s};bl.Mod2BoundaryNodeRule.get=function(){return Fh};bl.EndPointBoundaryNodeRule.get=function(){return Bh};bl.MultiValentEndPointBoundaryNodeRule.get=function(){return Vh};bl.MonoValentEndPointBoundaryNodeRule.get=function(){return Uh};bl.MOD2_BOUNDARY_RULE.get=function(){return new Fh};bl.ENDPOINT_BOUNDARY_RULE.get=function(){return new Bh};bl.MULTIVALENT_ENDPOINT_BOUNDARY_RULE.get=function(){return new Vh};bl.MONOVALENT_ENDPOINT_BOUNDARY_RULE.get=function(){return new Uh};bl.OGC_SFS_BOUNDARY_RULE.get=function(){return _s.MOD2_BOUNDARY_RULE};Object.defineProperties(_s,bl);var Fh=function(){};Fh.prototype.isInBoundary=function(e){return e%2===1};Fh.prototype.interfaces_=function(){return[_s]};Fh.prototype.getClass=function(){return Fh};var Bh=function(){};Bh.prototype.isInBoundary=function(e){return e>0};Bh.prototype.interfaces_=function(){return[_s]};Bh.prototype.getClass=function(){return Bh};var Vh=function(){};Vh.prototype.isInBoundary=function(e){return e>1};Vh.prototype.interfaces_=function(){return[_s]};Vh.prototype.getClass=function(){return Vh};var Uh=function(){};Uh.prototype.isInBoundary=function(e){return e===1};Uh.prototype.interfaces_=function(){return[_s]};Uh.prototype.getClass=function(){return Uh};var Ki=function(){};Ki.prototype.add=function(){};Ki.prototype.addAll=function(){};Ki.prototype.isEmpty=function(){};Ki.prototype.iterator=function(){};Ki.prototype.size=function(){};Ki.prototype.toArray=function(){};Ki.prototype.remove=function(){};function Ry(e){this.message=e||""}Ry.prototype=new Error;Ry.prototype.name="IndexOutOfBoundsException";var uf=function(){};uf.prototype.hasNext=function(){};uf.prototype.next=function(){};uf.prototype.remove=function(){};var As=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.get=function(){},t.prototype.set=function(){},t.prototype.isEmpty=function(){},t}(Ki);function cf(e){this.message=e||""}cf.prototype=new Error;cf.prototype.name="NoSuchElementException";var fe=function(e){function t(){e.call(this),this.array_=[],arguments[0]instanceof Ki&&this.addAll(arguments[0])}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.ensureCapacity=function(){},t.prototype.interfaces_=function(){return[e,Ki]},t.prototype.add=function(n){return arguments.length===1?this.array_.push(n):this.array_.splice(arguments[0],arguments[1]),!0},t.prototype.clear=function(){this.array_=[]},t.prototype.addAll=function(n){for(var i=this,r=n.iterator();r.hasNext();)i.add(r.next());return!0},t.prototype.set=function(n,i){var r=this.array_[n];return this.array_[n]=i,r},t.prototype.iterator=function(){return new xC(this)},t.prototype.get=function(n){if(n<0||n>=this.size())throw new Ry;return this.array_[n]},t.prototype.isEmpty=function(){return this.array_.length===0},t.prototype.size=function(){return this.array_.length},t.prototype.toArray=function(){for(var n=this,i=[],r=0,l=this.array_.length;r<l;r++)i.push(n.array_[r]);return i},t.prototype.remove=function(n){for(var i=this,r=!1,l=0,f=this.array_.length;l<f;l++)if(i.array_[l]===n){i.array_.splice(l,1),r=!0;break}return r},t}(As),xC=function(e){function t(n){e.call(this),this.arrayList_=n,this.position_=0}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.next=function(){if(this.position_===this.arrayList_.size())throw new cf;return this.arrayList_.get(this.position_++)},t.prototype.hasNext=function(){return this.position_<this.arrayList_.size()},t.prototype.set=function(n){return this.arrayList_.set(this.position_-1,n)},t.prototype.remove=function(){this.arrayList_.remove(this.arrayList_.get(this.position_))},t}(uf),md=function(e){function t(){if(e.call(this),arguments.length!==0){if(arguments.length===1){var i=arguments[0];this.ensureCapacity(i.length),this.add(i,!0)}else if(arguments.length===2){var r=arguments[0],l=arguments[1];this.ensureCapacity(r.length),this.add(r,l)}}}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={coordArrayType:{configurable:!0}};return n.coordArrayType.get=function(){return new Array(0).fill(null)},t.prototype.getCoordinate=function(i){return this.get(i)},t.prototype.addAll=function(){var i=this;if(arguments.length===2){for(var r=arguments[0],l=arguments[1],f=!1,a=r.iterator();a.hasNext();)i.add(a.next(),l),f=!0;return f}else return e.prototype.addAll.apply(this,arguments)},t.prototype.clone=function(){for(var i=this,r=e.prototype.clone.call(this),l=0;l<this.size();l++)r.add(l,i.get(l).copy());return r},t.prototype.toCoordinateArray=function(){return this.toArray(t.coordArrayType)},t.prototype.add=function(){var i=this;if(arguments.length===1){var r=arguments[0];e.prototype.add.call(this,r)}else if(arguments.length===2){if(arguments[0]instanceof Array&&typeof arguments[1]=="boolean"){var l=arguments[0],f=arguments[1];return this.add(l,f,!0),!0}else if(arguments[0]instanceof Dt&&typeof arguments[1]=="boolean"){var a=arguments[0],_=arguments[1];if(!_&&this.size()>=1){var x=this.get(this.size()-1);if(x.equals2D(a))return null}e.prototype.add.call(this,a)}else if(arguments[0]instanceof Object&&typeof arguments[1]=="boolean"){var S=arguments[0],L=arguments[1];return this.add(S,L),!0}}else if(arguments.length===3){if(typeof arguments[2]=="boolean"&&arguments[0]instanceof Array&&typeof arguments[1]=="boolean"){var A=arguments[0],P=arguments[1],O=arguments[2];if(O)for(var B=0;B<A.length;B++)i.add(A[B],P);else for(var U=A.length-1;U>=0;U--)i.add(A[U],P);return!0}else if(typeof arguments[2]=="boolean"&&Number.isInteger(arguments[0])&&arguments[1]instanceof Dt){var Y=arguments[0],V=arguments[1],$=arguments[2];if(!$){var K=this.size();if(K>0){if(Y>0){var it=this.get(Y-1);if(it.equals2D(V))return null}if(Y<K){var ft=this.get(Y);if(ft.equals2D(V))return null}}}e.prototype.add.call(this,Y,V)}}else if(arguments.length===4){var pt=arguments[0],gt=arguments[1],ut=arguments[2],St=arguments[3],_t=1;ut>St&&(_t=-1);for(var vt=ut;vt!==St;vt+=_t)i.add(pt[vt],gt);return!0}},t.prototype.closeRing=function(){this.size()>0&&this.add(new Dt(this.get(0)),!1)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},Object.defineProperties(t,n),t}(fe),gn=function(){},wg={ForwardComparator:{configurable:!0},BidirectionalComparator:{configurable:!0},coordArrayType:{configurable:!0}};wg.ForwardComparator.get=function(){return Xp};wg.BidirectionalComparator.get=function(){return Gh};wg.coordArrayType.get=function(){return new Array(0).fill(null)};gn.prototype.interfaces_=function(){return[]};gn.prototype.getClass=function(){return gn};gn.isRing=function(e){return!(e.length<4||!e[0].equals2D(e[e.length-1]))};gn.ptNotInList=function(e,t){for(var n=0;n<e.length;n++){var i=e[n];if(gn.indexOf(i,t)<0)return i}return null};gn.scroll=function(e,t){var n=gn.indexOf(t,e);if(n<0)return null;var i=new Array(e.length).fill(null);Lr.arraycopy(e,n,i,0,e.length-n),Lr.arraycopy(e,0,i,e.length-n,n),Lr.arraycopy(i,0,e,0,e.length)};gn.equals=function(){if(arguments.length===2){var e=arguments[0],t=arguments[1];if(e===t)return!0;if(e===null||t===null||e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(!e[n].equals(t[n]))return!1;return!0}else if(arguments.length===3){var i=arguments[0],r=arguments[1],l=arguments[2];if(i===r)return!0;if(i===null||r===null||i.length!==r.length)return!1;for(var f=0;f<i.length;f++)if(l.compare(i[f],r[f])!==0)return!1;return!0}};gn.intersection=function(e,t){for(var n=new md,i=0;i<e.length;i++)t.intersects(e[i])&&n.add(e[i],!0);return n.toCoordinateArray()};gn.hasRepeatedPoints=function(e){for(var t=1;t<e.length;t++)if(e[t-1].equals(e[t]))return!0;return!1};gn.removeRepeatedPoints=function(e){if(!gn.hasRepeatedPoints(e))return e;var t=new md(e,!1);return t.toCoordinateArray()};gn.reverse=function(e){for(var t=e.length-1,n=Math.trunc(t/2),i=0;i<=n;i++){var r=e[i];e[i]=e[t-i],e[t-i]=r}};gn.removeNull=function(e){for(var t=0,n=0;n<e.length;n++)e[n]!==null&&t++;var i=new Array(t).fill(null);if(t===0)return i;for(var r=0,l=0;l<e.length;l++)e[l]!==null&&(i[r++]=e[l]);return i};gn.copyDeep=function(){if(arguments.length===1){for(var e=arguments[0],t=new Array(e.length).fill(null),n=0;n<e.length;n++)t[n]=new Dt(e[n]);return t}else if(arguments.length===5)for(var i=arguments[0],r=arguments[1],l=arguments[2],f=arguments[3],a=arguments[4],_=0;_<a;_++)l[f+_]=new Dt(i[r+_])};gn.isEqualReversed=function(e,t){for(var n=0;n<e.length;n++){var i=e[n],r=t[e.length-n-1];if(i.compareTo(r)!==0)return!1}return!0};gn.envelope=function(e){for(var t=new Oe,n=0;n<e.length;n++)t.expandToInclude(e[n]);return t};gn.toCoordinateArray=function(e){return e.toArray(gn.coordArrayType)};gn.atLeastNCoordinatesOrNothing=function(e,t){return t.length>=e?t:[]};gn.indexOf=function(e,t){for(var n=0;n<t.length;n++)if(e.equals(t[n]))return n;return-1};gn.increasingDirection=function(e){for(var t=0;t<Math.trunc(e.length/2);t++){var n=e.length-1-t,i=e[t].compareTo(e[n]);if(i!==0)return i}return 1};gn.compare=function(e,t){for(var n=0;n<e.length&&n<t.length;){var i=e[n].compareTo(t[n]);if(i!==0)return i;n++}return n<t.length?-1:n<e.length?1:0};gn.minCoordinate=function(e){for(var t=null,n=0;n<e.length;n++)(t===null||t.compareTo(e[n])>0)&&(t=e[n]);return t};gn.extract=function(e,t,n){t=Ho.clamp(t,0,e.length),n=Ho.clamp(n,-1,e.length);var i=n-t+1;n<0&&(i=0),t>=e.length&&(i=0),n<t&&(i=0);var r=new Array(i).fill(null);if(i===0)return r;for(var l=0,f=t;f<=n;f++)r[l++]=e[f];return r};Object.defineProperties(gn,wg);var Xp=function(){};Xp.prototype.compare=function(e,t){var n=e,i=t;return gn.compare(n,i)};Xp.prototype.interfaces_=function(){return[Oh]};Xp.prototype.getClass=function(){return Xp};var Gh=function(){};Gh.prototype.compare=function(e,t){var n=e,i=t;if(n.length<i.length)return-1;if(n.length>i.length)return 1;if(n.length===0)return 0;var r=gn.compare(n,i),l=gn.isEqualReversed(n,i);return l?0:r};Gh.prototype.OLDcompare=function(e,t){var n=e,i=t;if(n.length<i.length)return-1;if(n.length>i.length)return 1;if(n.length===0)return 0;for(var r=gn.increasingDirection(n),l=gn.increasingDirection(i),f=r>0?0:n.length-1,a=l>0?0:n.length-1,_=0;_<n.length;_++){var x=n[f].compareTo(i[a]);if(x!==0)return x;f+=r,a+=l}return 0};Gh.prototype.interfaces_=function(){return[Oh]};Gh.prototype.getClass=function(){return Gh};var Fc=function(){};Fc.prototype.get=function(){};Fc.prototype.put=function(){};Fc.prototype.size=function(){};Fc.prototype.values=function(){};Fc.prototype.entrySet=function(){};var wC=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(Fc);function gd(e){this.message=e||""}gd.prototype=new Error;gd.prototype.name="OperationNotSupported";function Sg(){}Sg.prototype=new Ki;Sg.prototype.contains=function(){};var Oy=function(e){function t(){e.call(this),this.array_=[],arguments[0]instanceof Ki&&this.addAll(arguments[0])}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.contains=function(n){for(var i=this,r=0,l=this.array_.length;r<l;r++){var f=i.array_[r];if(f===n)return!0}return!1},t.prototype.add=function(n){return this.contains(n)?!1:(this.array_.push(n),!0)},t.prototype.addAll=function(n){for(var i=this,r=n.iterator();r.hasNext();)i.add(r.next());return!0},t.prototype.remove=function(n){throw new Error},t.prototype.size=function(){return this.array_.length},t.prototype.isEmpty=function(){return this.array_.length===0},t.prototype.toArray=function(){for(var n=this,i=[],r=0,l=this.array_.length;r<l;r++)i.push(n.array_[r]);return i},t.prototype.iterator=function(){return new SC(this)},t}(Sg),SC=function(e){function t(n){e.call(this),this.hashSet_=n,this.position_=0}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.next=function(){if(this.position_===this.hashSet_.size())throw new cf;return this.hashSet_.array_[this.position_++]},t.prototype.hasNext=function(){return this.position_<this.hashSet_.size()},t.prototype.remove=function(){throw new gd},t}(uf),cl=0,Cu=1;function _1(e){return e===null?cl:e.color}function ti(e){return e===null?null:e.parent}function ol(e,t){e!==null&&(e.color=t)}function H_(e){return e===null?null:e.left}function y1(e){return e===null?null:e.right}function Ur(){this.root_=null,this.size_=0}Ur.prototype=new wC;Ur.prototype.get=function(e){for(var t=this.root_;t!==null;){var n=e.compareTo(t.key);if(n<0)t=t.left;else if(n>0)t=t.right;else return t.value}return null};Ur.prototype.put=function(e,t){if(this.root_===null)return this.root_={key:e,value:t,left:null,right:null,parent:null,color:cl,getValue:function(){return this.value},getKey:function(){return this.key}},this.size_=1,null;var n=this.root_,i,r;do if(i=n,r=e.compareTo(n.key),r<0)n=n.left;else if(r>0)n=n.right;else{var l=n.value;return n.value=t,l}while(n!==null);var f={key:e,left:null,right:null,value:t,parent:i,color:cl,getValue:function(){return this.value},getKey:function(){return this.key}};return r<0?i.left=f:i.right=f,this.fixAfterInsertion(f),this.size_++,null};Ur.prototype.fixAfterInsertion=function(e){var t=this;for(e.color=Cu;e!=null&&e!==this.root_&&e.parent.color===Cu;)if(ti(e)===H_(ti(ti(e)))){var n=y1(ti(ti(e)));_1(n)===Cu?(ol(ti(e),cl),ol(n,cl),ol(ti(ti(e)),Cu),e=ti(ti(e))):(e===y1(ti(e))&&(e=ti(e),t.rotateLeft(e)),ol(ti(e),cl),ol(ti(ti(e)),Cu),t.rotateRight(ti(ti(e))))}else{var i=H_(ti(ti(e)));_1(i)===Cu?(ol(ti(e),cl),ol(i,cl),ol(ti(ti(e)),Cu),e=ti(ti(e))):(e===H_(ti(e))&&(e=ti(e),t.rotateRight(e)),ol(ti(e),cl),ol(ti(ti(e)),Cu),t.rotateLeft(ti(ti(e))))}this.root_.color=cl};Ur.prototype.values=function(){var e=new fe,t=this.getFirstEntry();if(t!==null)for(e.add(t.value);(t=Ur.successor(t))!==null;)e.add(t.value);return e};Ur.prototype.entrySet=function(){var e=new Oy,t=this.getFirstEntry();if(t!==null)for(e.add(t);(t=Ur.successor(t))!==null;)e.add(t);return e};Ur.prototype.rotateLeft=function(e){if(e!=null){var t=e.right;e.right=t.left,t.left!=null&&(t.left.parent=e),t.parent=e.parent,e.parent===null?this.root_=t:e.parent.left===e?e.parent.left=t:e.parent.right=t,t.left=e,e.parent=t}};Ur.prototype.rotateRight=function(e){if(e!=null){var t=e.left;e.left=t.right,t.right!=null&&(t.right.parent=e),t.parent=e.parent,e.parent===null?this.root_=t:e.parent.right===e?e.parent.right=t:e.parent.left=t,t.right=e,e.parent=t}};Ur.prototype.getFirstEntry=function(){var e=this.root_;if(e!=null)for(;e.left!=null;)e=e.left;return e};Ur.successor=function(e){if(e===null)return null;if(e.right!==null){for(var t=e.right;t.left!==null;)t=t.left;return t}else{for(var n=e.parent,i=e;n!==null&&i===n.right;)i=n,n=n.parent;return n}};Ur.prototype.size=function(){return this.size_};var Hp=function(){};Hp.prototype.interfaces_=function(){return[]};Hp.prototype.getClass=function(){return Hp};function Cx(){}Cx.prototype=new Sg;function ca(){this.array_=[],arguments[0]instanceof Ki&&this.addAll(arguments[0])}ca.prototype=new Cx;ca.prototype.contains=function(e){for(var t=this,n=0,i=this.array_.length;n<i;n++){var r=t.array_[n];if(r.compareTo(e)===0)return!0}return!1};ca.prototype.add=function(e){var t=this;if(this.contains(e))return!1;for(var n=0,i=this.array_.length;n<i;n++){var r=t.array_[n];if(r.compareTo(e)===1)return t.array_.splice(n,0,e),!0}return this.array_.push(e),!0};ca.prototype.addAll=function(e){for(var t=this,n=e.iterator();n.hasNext();)t.add(n.next());return!0};ca.prototype.remove=function(e){throw new gd};ca.prototype.size=function(){return this.array_.length};ca.prototype.isEmpty=function(){return this.array_.length===0};ca.prototype.toArray=function(){for(var e=this,t=[],n=0,i=this.array_.length;n<i;n++)t.push(e.array_[n]);return t};ca.prototype.iterator=function(){return new Eg(this)};var Eg=function(e){this.treeSet_=e,this.position_=0};Eg.prototype.next=function(){if(this.position_===this.treeSet_.size())throw new cf;return this.treeSet_.array_[this.position_++]};Eg.prototype.hasNext=function(){return this.position_<this.treeSet_.size()};Eg.prototype.remove=function(){throw new gd};var Au=function(){};Au.sort=function(){var e=arguments[0],t,n,i,r;if(arguments.length===1)r=function(f,a){return f.compareTo(a)},e.sort(r);else if(arguments.length===2)i=arguments[1],r=function(f,a){return i.compare(f,a)},e.sort(r);else if(arguments.length===3){n=e.slice(arguments[1],arguments[2]),n.sort();var l=e.slice(0,arguments[1]).concat(n,e.slice(arguments[2],e.length));for(e.splice(0,e.length),t=0;t<l.length;t++)e.push(l[t])}else if(arguments.length===4)for(n=e.slice(arguments[1],arguments[2]),i=arguments[3],r=function(f,a){return i.compare(f,a)},n.sort(r),l=e.slice(0,arguments[1]).concat(n,e.slice(arguments[2],e.length)),e.splice(0,e.length),t=0;t<l.length;t++)e.push(l[t])};Au.asList=function(e){for(var t=new fe,n=0,i=e.length;n<i;n++)t.add(e[n]);return t};var An=function(){},Us={P:{configurable:!0},L:{configurable:!0},A:{configurable:!0},FALSE:{configurable:!0},TRUE:{configurable:!0},DONTCARE:{configurable:!0},SYM_FALSE:{configurable:!0},SYM_TRUE:{configurable:!0},SYM_DONTCARE:{configurable:!0},SYM_P:{configurable:!0},SYM_L:{configurable:!0},SYM_A:{configurable:!0}};Us.P.get=function(){return 0};Us.L.get=function(){return 1};Us.A.get=function(){return 2};Us.FALSE.get=function(){return-1};Us.TRUE.get=function(){return-2};Us.DONTCARE.get=function(){return-3};Us.SYM_FALSE.get=function(){return"F"};Us.SYM_TRUE.get=function(){return"T"};Us.SYM_DONTCARE.get=function(){return"*"};Us.SYM_P.get=function(){return"0"};Us.SYM_L.get=function(){return"1"};Us.SYM_A.get=function(){return"2"};An.prototype.interfaces_=function(){return[]};An.prototype.getClass=function(){return An};An.toDimensionSymbol=function(e){switch(e){case An.FALSE:return An.SYM_FALSE;case An.TRUE:return An.SYM_TRUE;case An.DONTCARE:return An.SYM_DONTCARE;case An.P:return An.SYM_P;case An.L:return An.SYM_L;case An.A:return An.SYM_A}throw new _i("Unknown dimension value: "+e)};An.toDimensionValue=function(e){switch(Wp.toUpperCase(e)){case An.SYM_FALSE:return An.FALSE;case An.SYM_TRUE:return An.TRUE;case An.SYM_DONTCARE:return An.DONTCARE;case An.SYM_P:return An.P;case An.SYM_L:return An.L;case An.SYM_A:return An.A}throw new _i("Unknown dimension symbol: "+e)};Object.defineProperties(An,Us);var ha=function(){};ha.prototype.filter=function(e){};ha.prototype.interfaces_=function(){return[]};ha.prototype.getClass=function(){return ha};var Ds=function(){};Ds.prototype.filter=function(e,t){};Ds.prototype.isDone=function(){};Ds.prototype.isGeometryChanged=function(){};Ds.prototype.interfaces_=function(){return[]};Ds.prototype.getClass=function(){return Ds};var eo=function(e){function t(i,r){if(e.call(this,r),this._geometries=i||[],e.hasNullElements(this._geometries))throw new _i("geometries must not contain null elements")}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={serialVersionUID:{configurable:!0}};return t.prototype.computeEnvelopeInternal=function(){for(var i=this,r=new Oe,l=0;l<this._geometries.length;l++)r.expandToInclude(i._geometries[l].getEnvelopeInternal());return r},t.prototype.getGeometryN=function(i){return this._geometries[i]},t.prototype.getSortIndex=function(){return e.SORTINDEX_GEOMETRYCOLLECTION},t.prototype.getCoordinates=function(){for(var i=this,r=new Array(this.getNumPoints()).fill(null),l=-1,f=0;f<this._geometries.length;f++)for(var a=i._geometries[f].getCoordinates(),_=0;_<a.length;_++)l++,r[l]=a[_];return r},t.prototype.getArea=function(){for(var i=this,r=0,l=0;l<this._geometries.length;l++)r+=i._geometries[l].getArea();return r},t.prototype.equalsExact=function(){var i=this;if(arguments.length===2){var r=arguments[0],l=arguments[1];if(!this.isEquivalentClass(r))return!1;var f=r;if(this._geometries.length!==f._geometries.length)return!1;for(var a=0;a<this._geometries.length;a++)if(!i._geometries[a].equalsExact(f._geometries[a],l))return!1;return!0}else return e.prototype.equalsExact.apply(this,arguments)},t.prototype.normalize=function(){for(var i=this,r=0;r<this._geometries.length;r++)i._geometries[r].normalize();Au.sort(this._geometries)},t.prototype.getCoordinate=function(){return this.isEmpty()?null:this._geometries[0].getCoordinate()},t.prototype.getBoundaryDimension=function(){for(var i=this,r=An.FALSE,l=0;l<this._geometries.length;l++)r=Math.max(r,i._geometries[l].getBoundaryDimension());return r},t.prototype.getDimension=function(){for(var i=this,r=An.FALSE,l=0;l<this._geometries.length;l++)r=Math.max(r,i._geometries[l].getDimension());return r},t.prototype.getLength=function(){for(var i=this,r=0,l=0;l<this._geometries.length;l++)r+=i._geometries[l].getLength();return r},t.prototype.getNumPoints=function(){for(var i=this,r=0,l=0;l<this._geometries.length;l++)r+=i._geometries[l].getNumPoints();return r},t.prototype.getNumGeometries=function(){return this._geometries.length},t.prototype.reverse=function(){for(var i=this,r=this._geometries.length,l=new Array(r).fill(null),f=0;f<this._geometries.length;f++)l[f]=i._geometries[f].reverse();return this.getFactory().createGeometryCollection(l)},t.prototype.compareToSameClass=function(){var i=this;if(arguments.length===1){var r=arguments[0],l=new ca(Au.asList(this._geometries)),f=new ca(Au.asList(r._geometries));return this.compare(l,f)}else if(arguments.length===2){for(var a=arguments[0],_=arguments[1],x=a,S=this.getNumGeometries(),L=x.getNumGeometries(),A=0;A<S&&A<L;){var P=i.getGeometryN(A),O=x.getGeometryN(A),B=P.compareToSameClass(O,_);if(B!==0)return B;A++}return A<S?1:A<L?-1:0}},t.prototype.apply=function(){var i=this;if(We(arguments[0],Ba))for(var r=arguments[0],l=0;l<this._geometries.length;l++)i._geometries[l].apply(r);else if(We(arguments[0],Ds)){var f=arguments[0];if(this._geometries.length===0)return null;for(var a=0;a<this._geometries.length&&(i._geometries[a].apply(f),!f.isDone());a++);f.isGeometryChanged()&&this.geometryChanged()}else if(We(arguments[0],ha)){var _=arguments[0];_.filter(this);for(var x=0;x<this._geometries.length;x++)i._geometries[x].apply(_)}else if(We(arguments[0],ml)){var S=arguments[0];S.filter(this);for(var L=0;L<this._geometries.length;L++)i._geometries[L].apply(S)}},t.prototype.getBoundary=function(){return this.checkNotGeometryCollection(this),an.shouldNeverReachHere(),null},t.prototype.clone=function(){var i=this,r=e.prototype.clone.call(this);r._geometries=new Array(this._geometries.length).fill(null);for(var l=0;l<this._geometries.length;l++)r._geometries[l]=i._geometries[l].clone();return r},t.prototype.getGeometryType=function(){return"GeometryCollection"},t.prototype.copy=function(){for(var i=this,r=new Array(this._geometries.length).fill(null),l=0;l<r.length;l++)r[l]=i._geometries[l].copy();return new t(r,this._factory)},t.prototype.isEmpty=function(){for(var i=this,r=0;r<this._geometries.length;r++)if(!i._geometries[r].isEmpty())return!1;return!0},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},n.serialVersionUID.get=function(){return-5694727726395021e3},Object.defineProperties(t,n),t}($e),Ou=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={serialVersionUID:{configurable:!0}};return t.prototype.getSortIndex=function(){return $e.SORTINDEX_MULTILINESTRING},t.prototype.equalsExact=function(){if(arguments.length===2){var i=arguments[0],r=arguments[1];return this.isEquivalentClass(i)?e.prototype.equalsExact.call(this,i,r):!1}else return e.prototype.equalsExact.apply(this,arguments)},t.prototype.getBoundaryDimension=function(){return this.isClosed()?An.FALSE:0},t.prototype.isClosed=function(){var i=this;if(this.isEmpty())return!1;for(var r=0;r<this._geometries.length;r++)if(!i._geometries[r].isClosed())return!1;return!0},t.prototype.getDimension=function(){return 1},t.prototype.reverse=function(){for(var i=this,r=this._geometries.length,l=new Array(r).fill(null),f=0;f<this._geometries.length;f++)l[r-1-f]=i._geometries[f].reverse();return this.getFactory().createMultiLineString(l)},t.prototype.getBoundary=function(){return new ds(this).getBoundary()},t.prototype.getGeometryType=function(){return"MultiLineString"},t.prototype.copy=function(){for(var i=this,r=new Array(this._geometries.length).fill(null),l=0;l<r.length;l++)r[l]=i._geometries[l].copy();return new t(r,this._factory)},t.prototype.interfaces_=function(){return[Hp]},t.prototype.getClass=function(){return t},n.serialVersionUID.get=function(){return 8166665132445434e3},Object.defineProperties(t,n),t}(eo),ds=function(){if(this._geom=null,this._geomFact=null,this._bnRule=null,this._endpointMap=null,arguments.length===1){var e=arguments[0],t=_s.MOD2_BOUNDARY_RULE;this._geom=e,this._geomFact=e.getFactory(),this._bnRule=t}else if(arguments.length===2){var n=arguments[0],i=arguments[1];this._geom=n,this._geomFact=n.getFactory(),this._bnRule=i}};ds.prototype.boundaryMultiLineString=function(e){if(this._geom.isEmpty())return this.getEmptyMultiPoint();var t=this.computeBoundaryCoordinates(e);return t.length===1?this._geomFact.createPoint(t[0]):this._geomFact.createMultiPointFromCoords(t)};ds.prototype.getBoundary=function(){return this._geom instanceof Pi?this.boundaryLineString(this._geom):this._geom instanceof Ou?this.boundaryMultiLineString(this._geom):this._geom.getBoundary()};ds.prototype.boundaryLineString=function(e){if(this._geom.isEmpty())return this.getEmptyMultiPoint();if(e.isClosed()){var t=this._bnRule.isInBoundary(2);return t?e.getStartPoint():this._geomFact.createMultiPoint()}return this._geomFact.createMultiPoint([e.getStartPoint(),e.getEndPoint()])};ds.prototype.getEmptyMultiPoint=function(){return this._geomFact.createMultiPoint()};ds.prototype.computeBoundaryCoordinates=function(e){var t=this,n=new fe;this._endpointMap=new Ur;for(var i=0;i<e.getNumGeometries();i++){var r=e.getGeometryN(i);r.getNumPoints()!==0&&(t.addEndpoint(r.getCoordinateN(0)),t.addEndpoint(r.getCoordinateN(r.getNumPoints()-1)))}for(var l=this._endpointMap.entrySet().iterator();l.hasNext();){var f=l.next(),a=f.getValue(),_=a.count;t._bnRule.isInBoundary(_)&&n.add(f.getKey())}return gn.toCoordinateArray(n)};ds.prototype.addEndpoint=function(e){var t=this._endpointMap.get(e);t===null&&(t=new ng,this._endpointMap.put(e,t)),t.count++};ds.prototype.interfaces_=function(){return[]};ds.prototype.getClass=function(){return ds};ds.getBoundary=function(){if(arguments.length===1){var e=arguments[0],t=new ds(e);return t.getBoundary()}else if(arguments.length===2){var n=arguments[0],i=arguments[1],r=new ds(n,i);return r.getBoundary()}};var ng=function(){this.count=null};ng.prototype.interfaces_=function(){return[]};ng.prototype.getClass=function(){return ng};function EC(){}function IC(){}var CC=function(){};function TC(){}function LC(){}function MC(){}var ms=function(){},zy={NEWLINE:{configurable:!0},SIMPLE_ORDINATE_FORMAT:{configurable:!0}};ms.prototype.interfaces_=function(){return[]};ms.prototype.getClass=function(){return ms};ms.chars=function(e,t){for(var n=new Array(t).fill(null),i=0;i<t;i++)n[i]=e;return String(n)};ms.getStackTrace=function(){if(arguments.length===1){var e=arguments[0],t=new TC,n=new EC;return e.printStackTrace(n),t.toString()}else if(arguments.length===2){var i=arguments[0],r=arguments[1],l="";new IC(ms.getStackTrace(i));for(var f=new MC,a=0;a<r;a++)try{l+=f.readLine()+ms.NEWLINE}catch(_){if(_ instanceof LC)an.shouldNeverReachHere();else throw _}finally{}return l}};ms.split=function(e,t){for(var n=t.length,i=new fe,r=""+e,l=r.indexOf(t);l>=0;){var f=r.substring(0,l);i.add(f),r=r.substring(l+n),l=r.indexOf(t)}r.length>0&&i.add(r);for(var a=new Array(i.size()).fill(null),_=0;_<a.length;_++)a[_]=i.get(_);return a};ms.toString=function(){if(arguments.length===1){var e=arguments[0];return ms.SIMPLE_ORDINATE_FORMAT.format(e)}};ms.spaces=function(e){return ms.chars(" ",e)};zy.NEWLINE.get=function(){return Lr.getProperty("line.separator")};zy.SIMPLE_ORDINATE_FORMAT.get=function(){return new CC};Object.defineProperties(ms,zy);var Fi=function(){};Fi.prototype.interfaces_=function(){return[]};Fi.prototype.getClass=function(){return Fi};Fi.copyCoord=function(e,t,n,i){for(var r=Math.min(e.getDimension(),n.getDimension()),l=0;l<r;l++)n.setOrdinate(i,l,e.getOrdinate(t,l))};Fi.isRing=function(e){var t=e.size();return t===0?!0:t<=3?!1:e.getOrdinate(0,Mn.X)===e.getOrdinate(t-1,Mn.X)&&e.getOrdinate(0,Mn.Y)===e.getOrdinate(t-1,Mn.Y)};Fi.isEqual=function(e,t){var n=e.size(),i=t.size();if(n!==i)return!1;for(var r=Math.min(e.getDimension(),t.getDimension()),l=0;l<n;l++)for(var f=0;f<r;f++){var a=e.getOrdinate(l,f),_=t.getOrdinate(l,f);if(e.getOrdinate(l,f)!==t.getOrdinate(l,f)&&!(tn.isNaN(a)&&tn.isNaN(_)))return!1}return!0};Fi.extend=function(e,t,n){var i=e.create(n,t.getDimension()),r=t.size();if(Fi.copy(t,0,i,0,r),r>0)for(var l=r;l<n;l++)Fi.copy(t,r-1,i,l,1);return i};Fi.reverse=function(e){for(var t=e.size()-1,n=Math.trunc(t/2),i=0;i<=n;i++)Fi.swap(e,i,t-i)};Fi.swap=function(e,t,n){if(t===n)return null;for(var i=0;i<e.getDimension();i++){var r=e.getOrdinate(t,i);e.setOrdinate(t,i,e.getOrdinate(n,i)),e.setOrdinate(n,i,r)}};Fi.copy=function(e,t,n,i,r){for(var l=0;l<r;l++)Fi.copyCoord(e,t+l,n,i+l)};Fi.toString=function(){if(arguments.length===1){var e=arguments[0],t=e.size();if(t===0)return"()";var n=e.getDimension(),i=new xa;i.append("(");for(var r=0;r<t;r++){r>0&&i.append(" ");for(var l=0;l<n;l++)l>0&&i.append(","),i.append(ms.toString(e.getOrdinate(r,l)))}return i.append(")"),i.toString()}};Fi.ensureValidRing=function(e,t){var n=t.size();if(n===0)return t;if(n<=3)return Fi.createClosedRing(e,t,4);var i=t.getOrdinate(0,Mn.X)===t.getOrdinate(n-1,Mn.X)&&t.getOrdinate(0,Mn.Y)===t.getOrdinate(n-1,Mn.Y);return i?t:Fi.createClosedRing(e,t,n+1)};Fi.createClosedRing=function(e,t,n){var i=e.create(n,t.getDimension()),r=t.size();Fi.copy(t,0,i,0,r);for(var l=r;l<n;l++)Fi.copy(t,0,i,l,1);return i};var Pi=function(e){function t(i,r){e.call(this,r),this._points=null,this.init(i)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={serialVersionUID:{configurable:!0}};return t.prototype.computeEnvelopeInternal=function(){return this.isEmpty()?new Oe:this._points.expandEnvelope(new Oe)},t.prototype.isRing=function(){return this.isClosed()&&this.isSimple()},t.prototype.getSortIndex=function(){return e.SORTINDEX_LINESTRING},t.prototype.getCoordinates=function(){return this._points.toCoordinateArray()},t.prototype.equalsExact=function(){var i=this;if(arguments.length===2){var r=arguments[0],l=arguments[1];if(!this.isEquivalentClass(r))return!1;var f=r;if(this._points.size()!==f._points.size())return!1;for(var a=0;a<this._points.size();a++)if(!i.equal(i._points.getCoordinate(a),f._points.getCoordinate(a),l))return!1;return!0}else return e.prototype.equalsExact.apply(this,arguments)},t.prototype.normalize=function(){for(var i=this,r=0;r<Math.trunc(this._points.size()/2);r++){var l=i._points.size()-1-r;if(!i._points.getCoordinate(r).equals(i._points.getCoordinate(l)))return i._points.getCoordinate(r).compareTo(i._points.getCoordinate(l))>0&&Fi.reverse(i._points),null}},t.prototype.getCoordinate=function(){return this.isEmpty()?null:this._points.getCoordinate(0)},t.prototype.getBoundaryDimension=function(){return this.isClosed()?An.FALSE:0},t.prototype.isClosed=function(){return this.isEmpty()?!1:this.getCoordinateN(0).equals2D(this.getCoordinateN(this.getNumPoints()-1))},t.prototype.getEndPoint=function(){return this.isEmpty()?null:this.getPointN(this.getNumPoints()-1)},t.prototype.getDimension=function(){return 1},t.prototype.getLength=function(){return be.computeLength(this._points)},t.prototype.getNumPoints=function(){return this._points.size()},t.prototype.reverse=function(){var i=this._points.copy();Fi.reverse(i);var r=this.getFactory().createLineString(i);return r},t.prototype.compareToSameClass=function(){var i=this;if(arguments.length===1){for(var r=arguments[0],l=r,f=0,a=0;f<this._points.size()&&a<l._points.size();){var _=i._points.getCoordinate(f).compareTo(l._points.getCoordinate(a));if(_!==0)return _;f++,a++}return f<this._points.size()?1:a<l._points.size()?-1:0}else if(arguments.length===2){var x=arguments[0],S=arguments[1],L=x;return S.compare(this._points,L._points)}},t.prototype.apply=function(){var i=this;if(We(arguments[0],Ba))for(var r=arguments[0],l=0;l<this._points.size();l++)r.filter(i._points.getCoordinate(l));else if(We(arguments[0],Ds)){var f=arguments[0];if(this._points.size()===0)return null;for(var a=0;a<this._points.size()&&(f.filter(i._points,a),!f.isDone());a++);f.isGeometryChanged()&&this.geometryChanged()}else if(We(arguments[0],ha)){var _=arguments[0];_.filter(this)}else if(We(arguments[0],ml)){var x=arguments[0];x.filter(this)}},t.prototype.getBoundary=function(){return new ds(this).getBoundary()},t.prototype.isEquivalentClass=function(i){return i instanceof t},t.prototype.clone=function(){var i=e.prototype.clone.call(this);return i._points=this._points.clone(),i},t.prototype.getCoordinateN=function(i){return this._points.getCoordinate(i)},t.prototype.getGeometryType=function(){return"LineString"},t.prototype.copy=function(){return new t(this._points.copy(),this._factory)},t.prototype.getCoordinateSequence=function(){return this._points},t.prototype.isEmpty=function(){return this._points.size()===0},t.prototype.init=function(i){if(i===null&&(i=this.getFactory().getCoordinateSequenceFactory().create([])),i.size()===1)throw new _i("Invalid number of points in LineString (found "+i.size()+" - must be 0 or >= 2)");this._points=i},t.prototype.isCoordinate=function(i){for(var r=this,l=0;l<this._points.size();l++)if(r._points.getCoordinate(l).equals(i))return!0;return!1},t.prototype.getStartPoint=function(){return this.isEmpty()?null:this.getPointN(0)},t.prototype.getPointN=function(i){return this.getFactory().createPoint(this._points.getCoordinate(i))},t.prototype.interfaces_=function(){return[Hp]},t.prototype.getClass=function(){return t},n.serialVersionUID.get=function(){return 0x2b2b51ba435c8e00},Object.defineProperties(t,n),t}($e),Yp=function(){};Yp.prototype.interfaces_=function(){return[]};Yp.prototype.getClass=function(){return Yp};var Mo=function(e){function t(i,r){e.call(this,r),this._coordinates=i||null,this.init(this._coordinates)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={serialVersionUID:{configurable:!0}};return t.prototype.computeEnvelopeInternal=function(){if(this.isEmpty())return new Oe;var i=new Oe;return i.expandToInclude(this._coordinates.getX(0),this._coordinates.getY(0)),i},t.prototype.getSortIndex=function(){return e.SORTINDEX_POINT},t.prototype.getCoordinates=function(){return this.isEmpty()?[]:[this.getCoordinate()]},t.prototype.equalsExact=function(){if(arguments.length===2){var i=arguments[0],r=arguments[1];return this.isEquivalentClass(i)?this.isEmpty()&&i.isEmpty()?!0:this.isEmpty()!==i.isEmpty()?!1:this.equal(i.getCoordinate(),this.getCoordinate(),r):!1}else return e.prototype.equalsExact.apply(this,arguments)},t.prototype.normalize=function(){},t.prototype.getCoordinate=function(){return this._coordinates.size()!==0?this._coordinates.getCoordinate(0):null},t.prototype.getBoundaryDimension=function(){return An.FALSE},t.prototype.getDimension=function(){return 0},t.prototype.getNumPoints=function(){return this.isEmpty()?0:1},t.prototype.reverse=function(){return this.copy()},t.prototype.getX=function(){if(this.getCoordinate()===null)throw new Error("getX called on empty Point");return this.getCoordinate().x},t.prototype.compareToSameClass=function(){if(arguments.length===1){var i=arguments[0],r=i;return this.getCoordinate().compareTo(r.getCoordinate())}else if(arguments.length===2){var l=arguments[0],f=arguments[1],a=l;return f.compare(this._coordinates,a._coordinates)}},t.prototype.apply=function(){if(We(arguments[0],Ba)){var i=arguments[0];if(this.isEmpty())return null;i.filter(this.getCoordinate())}else if(We(arguments[0],Ds)){var r=arguments[0];if(this.isEmpty())return null;r.filter(this._coordinates,0),r.isGeometryChanged()&&this.geometryChanged()}else if(We(arguments[0],ha)){var l=arguments[0];l.filter(this)}else if(We(arguments[0],ml)){var f=arguments[0];f.filter(this)}},t.prototype.getBoundary=function(){return this.getFactory().createGeometryCollection(null)},t.prototype.clone=function(){var i=e.prototype.clone.call(this);return i._coordinates=this._coordinates.clone(),i},t.prototype.getGeometryType=function(){return"Point"},t.prototype.copy=function(){return new t(this._coordinates.copy(),this._factory)},t.prototype.getCoordinateSequence=function(){return this._coordinates},t.prototype.getY=function(){if(this.getCoordinate()===null)throw new Error("getY called on empty Point");return this.getCoordinate().y},t.prototype.isEmpty=function(){return this._coordinates.size()===0},t.prototype.init=function(i){i===null&&(i=this.getFactory().getCoordinateSequenceFactory().create([])),an.isTrue(i.size()<=1),this._coordinates=i},t.prototype.isSimple=function(){return!0},t.prototype.interfaces_=function(){return[Yp]},t.prototype.getClass=function(){return t},n.serialVersionUID.get=function(){return 4902022702746615e3},Object.defineProperties(t,n),t}($e),Hl=function(){};Hl.prototype.interfaces_=function(){return[]};Hl.prototype.getClass=function(){return Hl};var er=function(e){function t(i,r,l){if(e.call(this,l),this._shell=null,this._holes=null,i===null&&(i=this.getFactory().createLinearRing()),r===null&&(r=[]),e.hasNullElements(r))throw new _i("holes must not contain null elements");if(i.isEmpty()&&e.hasNonEmptyElements(r))throw new _i("shell is empty but holes are not");this._shell=i,this._holes=r}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={serialVersionUID:{configurable:!0}};return t.prototype.computeEnvelopeInternal=function(){return this._shell.getEnvelopeInternal()},t.prototype.getSortIndex=function(){return e.SORTINDEX_POLYGON},t.prototype.getCoordinates=function(){var i=this;if(this.isEmpty())return[];for(var r=new Array(this.getNumPoints()).fill(null),l=-1,f=this._shell.getCoordinates(),a=0;a<f.length;a++)l++,r[l]=f[a];for(var _=0;_<this._holes.length;_++)for(var x=i._holes[_].getCoordinates(),S=0;S<x.length;S++)l++,r[l]=x[S];return r},t.prototype.getArea=function(){var i=this,r=0;r+=Math.abs(be.signedArea(this._shell.getCoordinateSequence()));for(var l=0;l<this._holes.length;l++)r-=Math.abs(be.signedArea(i._holes[l].getCoordinateSequence()));return r},t.prototype.isRectangle=function(){if(this.getNumInteriorRing()!==0||this._shell===null||this._shell.getNumPoints()!==5)return!1;for(var i=this._shell.getCoordinateSequence(),r=this.getEnvelopeInternal(),l=0;l<5;l++){var f=i.getX(l);if(!(f===r.getMinX()||f===r.getMaxX()))return!1;var a=i.getY(l);if(!(a===r.getMinY()||a===r.getMaxY()))return!1}for(var _=i.getX(0),x=i.getY(0),S=1;S<=4;S++){var L=i.getX(S),A=i.getY(S),P=L!==_,O=A!==x;if(P===O)return!1;_=L,x=A}return!0},t.prototype.equalsExact=function(){var i=this;if(arguments.length===2){var r=arguments[0],l=arguments[1];if(!this.isEquivalentClass(r))return!1;var f=r,a=this._shell,_=f._shell;if(!a.equalsExact(_,l)||this._holes.length!==f._holes.length)return!1;for(var x=0;x<this._holes.length;x++)if(!i._holes[x].equalsExact(f._holes[x],l))return!1;return!0}else return e.prototype.equalsExact.apply(this,arguments)},t.prototype.normalize=function(){var i=this;if(arguments.length===0){this.normalize(this._shell,!0);for(var r=0;r<this._holes.length;r++)i.normalize(i._holes[r],!1);Au.sort(this._holes)}else if(arguments.length===2){var l=arguments[0],f=arguments[1];if(l.isEmpty())return null;var a=new Array(l.getCoordinates().length-1).fill(null);Lr.arraycopy(l.getCoordinates(),0,a,0,a.length);var _=gn.minCoordinate(l.getCoordinates());gn.scroll(a,_),Lr.arraycopy(a,0,l.getCoordinates(),0,a.length),l.getCoordinates()[a.length]=a[0],be.isCCW(l.getCoordinates())===f&&gn.reverse(l.getCoordinates())}},t.prototype.getCoordinate=function(){return this._shell.getCoordinate()},t.prototype.getNumInteriorRing=function(){return this._holes.length},t.prototype.getBoundaryDimension=function(){return 1},t.prototype.getDimension=function(){return 2},t.prototype.getLength=function(){var i=this,r=0;r+=this._shell.getLength();for(var l=0;l<this._holes.length;l++)r+=i._holes[l].getLength();return r},t.prototype.getNumPoints=function(){for(var i=this,r=this._shell.getNumPoints(),l=0;l<this._holes.length;l++)r+=i._holes[l].getNumPoints();return r},t.prototype.reverse=function(){var i=this,r=this.copy();r._shell=this._shell.copy().reverse(),r._holes=new Array(this._holes.length).fill(null);for(var l=0;l<this._holes.length;l++)r._holes[l]=i._holes[l].copy().reverse();return r},t.prototype.convexHull=function(){return this.getExteriorRing().convexHull()},t.prototype.compareToSameClass=function(){var i=this;if(arguments.length===1){var r=arguments[0],l=this._shell,f=r._shell;return l.compareToSameClass(f)}else if(arguments.length===2){var a=arguments[0],_=arguments[1],x=a,S=this._shell,L=x._shell,A=S.compareToSameClass(L,_);if(A!==0)return A;for(var P=this.getNumInteriorRing(),O=x.getNumInteriorRing(),B=0;B<P&&B<O;){var U=i.getInteriorRingN(B),Y=x.getInteriorRingN(B),V=U.compareToSameClass(Y,_);if(V!==0)return V;B++}return B<P?1:B<O?-1:0}},t.prototype.apply=function(i){var r=this;if(We(i,Ba)){this._shell.apply(i);for(var l=0;l<this._holes.length;l++)r._holes[l].apply(i)}else if(We(i,Ds)){if(this._shell.apply(i),!i.isDone())for(var f=0;f<this._holes.length&&(r._holes[f].apply(i),!i.isDone());f++);i.isGeometryChanged()&&this.geometryChanged()}else if(We(i,ha))i.filter(this);else if(We(i,ml)){i.filter(this),this._shell.apply(i);for(var a=0;a<this._holes.length;a++)r._holes[a].apply(i)}},t.prototype.getBoundary=function(){var i=this;if(this.isEmpty())return this.getFactory().createMultiLineString();var r=new Array(this._holes.length+1).fill(null);r[0]=this._shell;for(var l=0;l<this._holes.length;l++)r[l+1]=i._holes[l];return r.length<=1?this.getFactory().createLinearRing(r[0].getCoordinateSequence()):this.getFactory().createMultiLineString(r)},t.prototype.clone=function(){var i=this,r=e.prototype.clone.call(this);r._shell=this._shell.clone(),r._holes=new Array(this._holes.length).fill(null);for(var l=0;l<this._holes.length;l++)r._holes[l]=i._holes[l].clone();return r},t.prototype.getGeometryType=function(){return"Polygon"},t.prototype.copy=function(){for(var i=this,r=this._shell.copy(),l=new Array(this._holes.length).fill(null),f=0;f<l.length;f++)l[f]=i._holes[f].copy();return new t(r,l,this._factory)},t.prototype.getExteriorRing=function(){return this._shell},t.prototype.isEmpty=function(){return this._shell.isEmpty()},t.prototype.getInteriorRingN=function(i){return this._holes[i]},t.prototype.interfaces_=function(){return[Hl]},t.prototype.getClass=function(){return t},n.serialVersionUID.get=function(){return-0x307ffefd8dc97200},Object.defineProperties(t,n),t}($e),jh=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={serialVersionUID:{configurable:!0}};return t.prototype.getSortIndex=function(){return $e.SORTINDEX_MULTIPOINT},t.prototype.isValid=function(){return!0},t.prototype.equalsExact=function(){if(arguments.length===2){var i=arguments[0],r=arguments[1];return this.isEquivalentClass(i)?e.prototype.equalsExact.call(this,i,r):!1}else return e.prototype.equalsExact.apply(this,arguments)},t.prototype.getCoordinate=function(){if(arguments.length===1){var i=arguments[0];return this._geometries[i].getCoordinate()}else return e.prototype.getCoordinate.apply(this,arguments)},t.prototype.getBoundaryDimension=function(){return An.FALSE},t.prototype.getDimension=function(){return 0},t.prototype.getBoundary=function(){return this.getFactory().createGeometryCollection(null)},t.prototype.getGeometryType=function(){return"MultiPoint"},t.prototype.copy=function(){for(var i=this,r=new Array(this._geometries.length).fill(null),l=0;l<r.length;l++)r[l]=i._geometries[l].copy();return new t(r,this._factory)},t.prototype.interfaces_=function(){return[Yp]},t.prototype.getClass=function(){return t},n.serialVersionUID.get=function(){return-8048474874175356e3},Object.defineProperties(t,n),t}(eo),Va=function(e){function t(i,r){i instanceof Dt&&r instanceof mn&&(i=r.getCoordinateSequenceFactory().create(i)),e.call(this,i,r),this.validateConstruction()}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={MINIMUM_VALID_SIZE:{configurable:!0},serialVersionUID:{configurable:!0}};return t.prototype.getSortIndex=function(){return $e.SORTINDEX_LINEARRING},t.prototype.getBoundaryDimension=function(){return An.FALSE},t.prototype.isClosed=function(){return this.isEmpty()?!0:e.prototype.isClosed.call(this)},t.prototype.reverse=function(){var i=this._points.copy();Fi.reverse(i);var r=this.getFactory().createLinearRing(i);return r},t.prototype.validateConstruction=function(){if(!this.isEmpty()&&!e.prototype.isClosed.call(this))throw new _i("Points of LinearRing do not form a closed linestring");if(this.getCoordinateSequence().size()>=1&&this.getCoordinateSequence().size()<t.MINIMUM_VALID_SIZE)throw new _i("Invalid number of points in LinearRing (found "+this.getCoordinateSequence().size()+" - must be 0 or >= 4)")},t.prototype.getGeometryType=function(){return"LinearRing"},t.prototype.copy=function(){return new t(this._points.copy(),this._factory)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},n.MINIMUM_VALID_SIZE.get=function(){return 4},n.serialVersionUID.get=function(){return-0x3b229e262367a600},Object.defineProperties(t,n),t}(Pi),za=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={serialVersionUID:{configurable:!0}};return t.prototype.getSortIndex=function(){return $e.SORTINDEX_MULTIPOLYGON},t.prototype.equalsExact=function(){if(arguments.length===2){var i=arguments[0],r=arguments[1];return this.isEquivalentClass(i)?e.prototype.equalsExact.call(this,i,r):!1}else return e.prototype.equalsExact.apply(this,arguments)},t.prototype.getBoundaryDimension=function(){return 1},t.prototype.getDimension=function(){return 2},t.prototype.reverse=function(){for(var i=this,r=this._geometries.length,l=new Array(r).fill(null),f=0;f<this._geometries.length;f++)l[f]=i._geometries[f].reverse();return this.getFactory().createMultiPolygon(l)},t.prototype.getBoundary=function(){var i=this;if(this.isEmpty())return this.getFactory().createMultiLineString();for(var r=new fe,l=0;l<this._geometries.length;l++)for(var f=i._geometries[l],a=f.getBoundary(),_=0;_<a.getNumGeometries();_++)r.add(a.getGeometryN(_));var x=new Array(r.size()).fill(null);return this.getFactory().createMultiLineString(r.toArray(x))},t.prototype.getGeometryType=function(){return"MultiPolygon"},t.prototype.copy=function(){for(var i=this,r=new Array(this._geometries.length).fill(null),l=0;l<r.length;l++)r[l]=i._geometries[l].copy();return new t(r,this._factory)},t.prototype.interfaces_=function(){return[Hl]},t.prototype.getClass=function(){return t},n.serialVersionUID.get=function(){return-0x7a5aa1369171980},Object.defineProperties(t,n),t}(eo),ys=function(e){this._factory=e||null,this._isUserDataCopied=!1},Ig={NoOpGeometryOperation:{configurable:!0},CoordinateOperation:{configurable:!0},CoordinateSequenceOperation:{configurable:!0}};ys.prototype.setCopyUserData=function(e){this._isUserDataCopied=e};ys.prototype.edit=function(e,t){if(e===null)return null;var n=this.editInternal(e,t);return this._isUserDataCopied&&n.setUserData(e.getUserData()),n};ys.prototype.editInternal=function(e,t){return this._factory===null&&(this._factory=e.getFactory()),e instanceof eo?this.editGeometryCollection(e,t):e instanceof er?this.editPolygon(e,t):e instanceof Mo?t.edit(e,this._factory):e instanceof Pi?t.edit(e,this._factory):(an.shouldNeverReachHere("Unsupported Geometry class: "+e.getClass().getName()),null)};ys.prototype.editGeometryCollection=function(e,t){for(var n=this,i=t.edit(e,this._factory),r=new fe,l=0;l<i.getNumGeometries();l++){var f=n.edit(i.getGeometryN(l),t);f===null||f.isEmpty()||r.add(f)}return i.getClass()===jh?this._factory.createMultiPoint(r.toArray([])):i.getClass()===Ou?this._factory.createMultiLineString(r.toArray([])):i.getClass()===za?this._factory.createMultiPolygon(r.toArray([])):this._factory.createGeometryCollection(r.toArray([]))};ys.prototype.editPolygon=function(e,t){var n=this,i=t.edit(e,this._factory);if(i===null&&(i=this._factory.createPolygon(null)),i.isEmpty())return i;var r=this.edit(i.getExteriorRing(),t);if(r===null||r.isEmpty())return this._factory.createPolygon();for(var l=new fe,f=0;f<i.getNumInteriorRing();f++){var a=n.edit(i.getInteriorRingN(f),t);a===null||a.isEmpty()||l.add(a)}return this._factory.createPolygon(r,l.toArray([]))};ys.prototype.interfaces_=function(){return[]};ys.prototype.getClass=function(){return ys};ys.GeometryEditorOperation=function(){};Ig.NoOpGeometryOperation.get=function(){return Kp};Ig.CoordinateOperation.get=function(){return Jp};Ig.CoordinateSequenceOperation.get=function(){return Qp};Object.defineProperties(ys,Ig);var Kp=function(){};Kp.prototype.edit=function(e,t){return e};Kp.prototype.interfaces_=function(){return[ys.GeometryEditorOperation]};Kp.prototype.getClass=function(){return Kp};var Jp=function(){};Jp.prototype.edit=function(e,t){var n=this.editCoordinates(e.getCoordinates(),e);return n===null?e:e instanceof Va?t.createLinearRing(n):e instanceof Pi?t.createLineString(n):e instanceof Mo?n.length>0?t.createPoint(n[0]):t.createPoint():e};Jp.prototype.interfaces_=function(){return[ys.GeometryEditorOperation]};Jp.prototype.getClass=function(){return Jp};var Qp=function(){};Qp.prototype.edit=function(e,t){return e instanceof Va?t.createLinearRing(this.edit(e.getCoordinateSequence(),e)):e instanceof Pi?t.createLineString(this.edit(e.getCoordinateSequence(),e)):e instanceof Mo?t.createPoint(this.edit(e.getCoordinateSequence(),e)):e};Qp.prototype.interfaces_=function(){return[ys.GeometryEditorOperation]};Qp.prototype.getClass=function(){return Qp};var Ri=function(){var e=this;if(this._dimension=3,this._coordinates=null,arguments.length===1){if(arguments[0]instanceof Array)this._coordinates=arguments[0],this._dimension=3;else if(Number.isInteger(arguments[0])){var t=arguments[0];this._coordinates=new Array(t).fill(null);for(var n=0;n<t;n++)e._coordinates[n]=new Dt}else if(We(arguments[0],Mn)){var i=arguments[0];if(i===null)return this._coordinates=new Array(0).fill(null),null;this._dimension=i.getDimension(),this._coordinates=new Array(i.size()).fill(null);for(var r=0;r<this._coordinates.length;r++)e._coordinates[r]=i.getCoordinateCopy(r)}}else if(arguments.length===2){if(arguments[0]instanceof Array&&Number.isInteger(arguments[1])){var l=arguments[0],f=arguments[1];this._coordinates=l,this._dimension=f,l===null&&(this._coordinates=new Array(0).fill(null))}else if(Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var a=arguments[0],_=arguments[1];this._coordinates=new Array(a).fill(null),this._dimension=_;for(var x=0;x<a;x++)e._coordinates[x]=new Dt}}},Tx={serialVersionUID:{configurable:!0}};Ri.prototype.setOrdinate=function(e,t,n){switch(t){case Mn.X:this._coordinates[e].x=n;break;case Mn.Y:this._coordinates[e].y=n;break;case Mn.Z:this._coordinates[e].z=n;break;default:throw new _i("invalid ordinateIndex")}};Ri.prototype.size=function(){return this._coordinates.length};Ri.prototype.getOrdinate=function(e,t){switch(t){case Mn.X:return this._coordinates[e].x;case Mn.Y:return this._coordinates[e].y;case Mn.Z:return this._coordinates[e].z}return tn.NaN};Ri.prototype.getCoordinate=function(){if(arguments.length===1){var e=arguments[0];return this._coordinates[e]}else if(arguments.length===2){var t=arguments[0],n=arguments[1];n.x=this._coordinates[t].x,n.y=this._coordinates[t].y,n.z=this._coordinates[t].z}};Ri.prototype.getCoordinateCopy=function(e){return new Dt(this._coordinates[e])};Ri.prototype.getDimension=function(){return this._dimension};Ri.prototype.getX=function(e){return this._coordinates[e].x};Ri.prototype.clone=function(){for(var e=this,t=new Array(this.size()).fill(null),n=0;n<this._coordinates.length;n++)t[n]=e._coordinates[n].clone();return new Ri(t,this._dimension)};Ri.prototype.expandEnvelope=function(e){for(var t=this,n=0;n<this._coordinates.length;n++)e.expandToInclude(t._coordinates[n]);return e};Ri.prototype.copy=function(){for(var e=this,t=new Array(this.size()).fill(null),n=0;n<this._coordinates.length;n++)t[n]=e._coordinates[n].copy();return new Ri(t,this._dimension)};Ri.prototype.toString=function(){var e=this;if(this._coordinates.length>0){var t=new xa(17*this._coordinates.length);t.append("("),t.append(this._coordinates[0]);for(var n=1;n<this._coordinates.length;n++)t.append(", "),t.append(e._coordinates[n]);return t.append(")"),t.toString()}else return"()"};Ri.prototype.getY=function(e){return this._coordinates[e].y};Ri.prototype.toCoordinateArray=function(){return this._coordinates};Ri.prototype.interfaces_=function(){return[Mn,xs]};Ri.prototype.getClass=function(){return Ri};Tx.serialVersionUID.get=function(){return-0xcb44a778db18e00};Object.defineProperties(Ri,Tx);var Ua=function(){},Fy={serialVersionUID:{configurable:!0},instanceObject:{configurable:!0}};Ua.prototype.readResolve=function(){return Ua.instance()};Ua.prototype.create=function(){if(arguments.length===1){if(arguments[0]instanceof Array){var e=arguments[0];return new Ri(e)}else if(We(arguments[0],Mn)){var t=arguments[0];return new Ri(t)}}else if(arguments.length===2){var n=arguments[0],i=arguments[1];return i>3&&(i=3),i<2?new Ri(n):new Ri(n,i)}};Ua.prototype.interfaces_=function(){return[zh,xs]};Ua.prototype.getClass=function(){return Ua};Ua.instance=function(){return Ua.instanceObject};Fy.serialVersionUID.get=function(){return-0x38e49fa6cf6f2e00};Fy.instanceObject.get=function(){return new Ua};Object.defineProperties(Ua,Fy);var Lx=function(e){function t(){e.call(this),this.map_=new Map}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.get=function(n){return this.map_.get(n)||null},t.prototype.put=function(n,i){return this.map_.set(n,i),i},t.prototype.values=function(){for(var n=new fe,i=this.map_.values(),r=i.next();!r.done;)n.add(r.value),r=i.next();return n},t.prototype.entrySet=function(){var n=new Oy;return this.map_.entries().forEach(function(i){return n.add(i)}),n},t.prototype.size=function(){return this.map_.size()},t}(Fc),Dn=function e(){if(this._modelType=null,this._scale=null,arguments.length===0)this._modelType=e.FLOATING;else if(arguments.length===1){if(arguments[0]instanceof fa){var t=arguments[0];this._modelType=t,t===e.FIXED&&this.setScale(1)}else if(typeof arguments[0]=="number"){var n=arguments[0];this._modelType=e.FIXED,this.setScale(n)}else if(arguments[0]instanceof e){var i=arguments[0];this._modelType=i._modelType,this._scale=i._scale}}},By={serialVersionUID:{configurable:!0},maximumPreciseValue:{configurable:!0}};Dn.prototype.equals=function(e){if(!(e instanceof Dn))return!1;var t=e;return this._modelType===t._modelType&&this._scale===t._scale};Dn.prototype.compareTo=function(e){var t=e,n=this.getMaximumSignificantDigits(),i=t.getMaximumSignificantDigits();return new ua(n).compareTo(new ua(i))};Dn.prototype.getScale=function(){return this._scale};Dn.prototype.isFloating=function(){return this._modelType===Dn.FLOATING||this._modelType===Dn.FLOATING_SINGLE};Dn.prototype.getType=function(){return this._modelType};Dn.prototype.toString=function(){var e="UNKNOWN";return this._modelType===Dn.FLOATING?e="Floating":this._modelType===Dn.FLOATING_SINGLE?e="Floating-Single":this._modelType===Dn.FIXED&&(e="Fixed (Scale="+this.getScale()+")"),e};Dn.prototype.makePrecise=function(){if(typeof arguments[0]=="number"){var e=arguments[0];if(tn.isNaN(e))return e;if(this._modelType===Dn.FLOATING_SINGLE){var t=e;return t}return this._modelType===Dn.FIXED?Math.round(e*this._scale)/this._scale:e}else if(arguments[0]instanceof Dt){var n=arguments[0];if(this._modelType===Dn.FLOATING)return null;n.x=this.makePrecise(n.x),n.y=this.makePrecise(n.y)}};Dn.prototype.getMaximumSignificantDigits=function(){var e=16;return this._modelType===Dn.FLOATING?e=16:this._modelType===Dn.FLOATING_SINGLE?e=6:this._modelType===Dn.FIXED&&(e=1+Math.trunc(Math.ceil(Math.log(this.getScale())/Math.log(10)))),e};Dn.prototype.setScale=function(e){this._scale=Math.abs(e)};Dn.prototype.interfaces_=function(){return[xs,bs]};Dn.prototype.getClass=function(){return Dn};Dn.mostPrecise=function(e,t){return e.compareTo(t)>=0?e:t};By.serialVersionUID.get=function(){return 7777263578777804e3};By.maximumPreciseValue.get=function(){return 9007199254740992};Object.defineProperties(Dn,By);var fa=function e(t){this._name=t||null,e.nameToTypeMap.put(t,this)},Vy={serialVersionUID:{configurable:!0},nameToTypeMap:{configurable:!0}};fa.prototype.readResolve=function(){return fa.nameToTypeMap.get(this._name)};fa.prototype.toString=function(){return this._name};fa.prototype.interfaces_=function(){return[xs]};fa.prototype.getClass=function(){return fa};Vy.serialVersionUID.get=function(){return-552860263173159e4};Vy.nameToTypeMap.get=function(){return new Lx};Object.defineProperties(fa,Vy);Dn.Type=fa;Dn.FIXED=new fa("FIXED");Dn.FLOATING=new fa("FLOATING");Dn.FLOATING_SINGLE=new fa("FLOATING SINGLE");var mn=function e(){this._precisionModel=new Dn,this._SRID=0,this._coordinateSequenceFactory=e.getDefaultCoordinateSequenceFactory(),arguments.length===0||(arguments.length===1?We(arguments[0],zh)?this._coordinateSequenceFactory=arguments[0]:arguments[0]instanceof Dn&&(this._precisionModel=arguments[0]):arguments.length===2?(this._precisionModel=arguments[0],this._SRID=arguments[1]):arguments.length===3&&(this._precisionModel=arguments[0],this._SRID=arguments[1],this._coordinateSequenceFactory=arguments[2]))},Mx={serialVersionUID:{configurable:!0}};mn.prototype.toGeometry=function(e){return e.isNull()?this.createPoint(null):e.getMinX()===e.getMaxX()&&e.getMinY()===e.getMaxY()?this.createPoint(new Dt(e.getMinX(),e.getMinY())):e.getMinX()===e.getMaxX()||e.getMinY()===e.getMaxY()?this.createLineString([new Dt(e.getMinX(),e.getMinY()),new Dt(e.getMaxX(),e.getMaxY())]):this.createPolygon(this.createLinearRing([new Dt(e.getMinX(),e.getMinY()),new Dt(e.getMinX(),e.getMaxY()),new Dt(e.getMaxX(),e.getMaxY()),new Dt(e.getMaxX(),e.getMinY()),new Dt(e.getMinX(),e.getMinY())]),null)};mn.prototype.createLineString=function(e){if(e){if(e instanceof Array)return new Pi(this.getCoordinateSequenceFactory().create(e),this);if(We(e,Mn))return new Pi(e,this)}else return new Pi(this.getCoordinateSequenceFactory().create([]),this)};mn.prototype.createMultiLineString=function(){if(arguments.length===0)return new Ou(null,this);if(arguments.length===1){var e=arguments[0];return new Ou(e,this)}};mn.prototype.buildGeometry=function(e){for(var t=null,n=!1,i=!1,r=e.iterator();r.hasNext();){var l=r.next(),f=l.getClass();t===null&&(t=f),f!==t&&(n=!0),l.isGeometryCollectionOrDerived()&&(i=!0)}if(t===null)return this.createGeometryCollection();if(n||i)return this.createGeometryCollection(mn.toGeometryArray(e));var a=e.iterator().next(),_=e.size()>1;if(_){if(a instanceof er)return this.createMultiPolygon(mn.toPolygonArray(e));if(a instanceof Pi)return this.createMultiLineString(mn.toLineStringArray(e));if(a instanceof Mo)return this.createMultiPoint(mn.toPointArray(e));an.shouldNeverReachHere("Unhandled class: "+a.getClass().getName())}return a};mn.prototype.createMultiPointFromCoords=function(e){return this.createMultiPoint(e!==null?this.getCoordinateSequenceFactory().create(e):null)};mn.prototype.createPoint=function(){if(arguments.length===0)return this.createPoint(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof Dt){var e=arguments[0];return this.createPoint(e!==null?this.getCoordinateSequenceFactory().create([e]):null)}else if(We(arguments[0],Mn)){var t=arguments[0];return new Mo(t,this)}}};mn.prototype.getCoordinateSequenceFactory=function(){return this._coordinateSequenceFactory};mn.prototype.createPolygon=function(){if(arguments.length===0)return new er(null,null,this);if(arguments.length===1){if(We(arguments[0],Mn)){var e=arguments[0];return this.createPolygon(this.createLinearRing(e))}else if(arguments[0]instanceof Array){var t=arguments[0];return this.createPolygon(this.createLinearRing(t))}else if(arguments[0]instanceof Va){var n=arguments[0];return this.createPolygon(n,null)}}else if(arguments.length===2){var i=arguments[0],r=arguments[1];return new er(i,r,this)}};mn.prototype.getSRID=function(){return this._SRID};mn.prototype.createGeometryCollection=function(){if(arguments.length===0)return new eo(null,this);if(arguments.length===1){var e=arguments[0];return new eo(e,this)}};mn.prototype.createGeometry=function(e){var t=new ys(this);return t.edit(e,{edit:function(){if(arguments.length===2){var n=arguments[0];return this._coordinateSequenceFactory.create(n)}}})};mn.prototype.getPrecisionModel=function(){return this._precisionModel};mn.prototype.createLinearRing=function(){if(arguments.length===0)return this.createLinearRing(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof Array){var e=arguments[0];return this.createLinearRing(e!==null?this.getCoordinateSequenceFactory().create(e):null)}else if(We(arguments[0],Mn)){var t=arguments[0];return new Va(t,this)}}};mn.prototype.createMultiPolygon=function(){if(arguments.length===0)return new za(null,this);if(arguments.length===1){var e=arguments[0];return new za(e,this)}};mn.prototype.createMultiPoint=function(){var e=this;if(arguments.length===0)return new jh(null,this);if(arguments.length===1){if(arguments[0]instanceof Array){var t=arguments[0];return new jh(t,this)}else if(arguments[0]instanceof Array){var n=arguments[0];return this.createMultiPoint(n!==null?this.getCoordinateSequenceFactory().create(n):null)}else if(We(arguments[0],Mn)){var i=arguments[0];if(i===null)return this.createMultiPoint(new Array(0).fill(null));for(var r=new Array(i.size()).fill(null),l=0;l<i.size();l++){var f=e.getCoordinateSequenceFactory().create(1,i.getDimension());Fi.copy(i,l,f,0,1),r[l]=e.createPoint(f)}return this.createMultiPoint(r)}}};mn.prototype.interfaces_=function(){return[xs]};mn.prototype.getClass=function(){return mn};mn.toMultiPolygonArray=function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)};mn.toGeometryArray=function(e){if(e===null)return null;var t=new Array(e.size()).fill(null);return e.toArray(t)};mn.getDefaultCoordinateSequenceFactory=function(){return Ua.instance()};mn.toMultiLineStringArray=function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)};mn.toLineStringArray=function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)};mn.toMultiPointArray=function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)};mn.toLinearRingArray=function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)};mn.toPointArray=function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)};mn.toPolygonArray=function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)};mn.createPointFromInternalCoord=function(e,t){return t.getPrecisionModel().makePrecise(e),t.getFactory().createPoint(e)};Mx.serialVersionUID.get=function(){return-6820524753094096e3};Object.defineProperties(mn,Mx);var PC=["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],Cg=function(e){this.geometryFactory=e||new mn};Cg.prototype.read=function(e){var t;typeof e=="string"?t=JSON.parse(e):t=e;var n=t.type;if(!ta[n])throw new Error("Unknown GeoJSON type: "+t.type);return PC.indexOf(n)!==-1?ta[n].apply(this,[t.coordinates]):n==="GeometryCollection"?ta[n].apply(this,[t.geometries]):ta[n].apply(this,[t])};Cg.prototype.write=function(e){var t=e.getGeometryType();if(!ll[t])throw new Error("Geometry is not supported");return ll[t].apply(this,[e])};var ta={Feature:function(e){var t={};for(var n in e)t[n]=e[n];if(e.geometry){var i=e.geometry.type;if(!ta[i])throw new Error("Unknown GeoJSON type: "+e.type);t.geometry=this.read(e.geometry)}return e.bbox&&(t.bbox=ta.bbox.apply(this,[e.bbox])),t},FeatureCollection:function(e){var t=this,n={};if(e.features){n.features=[];for(var i=0;i<e.features.length;++i)n.features.push(t.read(e.features[i]))}return e.bbox&&(n.bbox=this.parse.bbox.apply(this,[e.bbox])),n},coordinates:function(e){for(var t=[],n=0;n<e.length;++n){var i=e[n];t.push(new Dt(i[0],i[1]))}return t},bbox:function(e){return this.geometryFactory.createLinearRing([new Dt(e[0],e[1]),new Dt(e[2],e[1]),new Dt(e[2],e[3]),new Dt(e[0],e[3]),new Dt(e[0],e[1])])},Point:function(e){var t=new Dt(e[0],e[1]);return this.geometryFactory.createPoint(t)},MultiPoint:function(e){for(var t=this,n=[],i=0;i<e.length;++i)n.push(ta.Point.apply(t,[e[i]]));return this.geometryFactory.createMultiPoint(n)},LineString:function(e){var t=ta.coordinates.apply(this,[e]);return this.geometryFactory.createLineString(t)},MultiLineString:function(e){for(var t=this,n=[],i=0;i<e.length;++i)n.push(ta.LineString.apply(t,[e[i]]));return this.geometryFactory.createMultiLineString(n)},Polygon:function(e){for(var t=this,n=ta.coordinates.apply(this,[e[0]]),i=this.geometryFactory.createLinearRing(n),r=[],l=1;l<e.length;++l){var f=e[l],a=ta.coordinates.apply(t,[f]),_=t.geometryFactory.createLinearRing(a);r.push(_)}return this.geometryFactory.createPolygon(i,r)},MultiPolygon:function(e){for(var t=this,n=[],i=0;i<e.length;++i){var r=e[i];n.push(ta.Polygon.apply(t,[r]))}return this.geometryFactory.createMultiPolygon(n)},GeometryCollection:function(e){for(var t=this,n=[],i=0;i<e.length;++i){var r=e[i];n.push(t.read(r))}return this.geometryFactory.createGeometryCollection(n)}},ll={coordinate:function(e){return[e.x,e.y]},Point:function(e){var t=ll.coordinate.apply(this,[e.getCoordinate()]);return{type:"Point",coordinates:t}},MultiPoint:function(e){for(var t=this,n=[],i=0;i<e._geometries.length;++i){var r=e._geometries[i],l=ll.Point.apply(t,[r]);n.push(l.coordinates)}return{type:"MultiPoint",coordinates:n}},LineString:function(e){for(var t=this,n=[],i=e.getCoordinates(),r=0;r<i.length;++r){var l=i[r];n.push(ll.coordinate.apply(t,[l]))}return{type:"LineString",coordinates:n}},MultiLineString:function(e){for(var t=this,n=[],i=0;i<e._geometries.length;++i){var r=e._geometries[i],l=ll.LineString.apply(t,[r]);n.push(l.coordinates)}return{type:"MultiLineString",coordinates:n}},Polygon:function(e){var t=this,n=[],i=ll.LineString.apply(this,[e._shell]);n.push(i.coordinates);for(var r=0;r<e._holes.length;++r){var l=e._holes[r],f=ll.LineString.apply(t,[l]);n.push(f.coordinates)}return{type:"Polygon",coordinates:n}},MultiPolygon:function(e){for(var t=this,n=[],i=0;i<e._geometries.length;++i){var r=e._geometries[i],l=ll.Polygon.apply(t,[r]);n.push(l.coordinates)}return{type:"MultiPolygon",coordinates:n}},GeometryCollection:function(e){for(var t=this,n=[],i=0;i<e._geometries.length;++i){var r=e._geometries[i],l=r.getGeometryType();n.push(ll[l].apply(t,[r]))}return{type:"GeometryCollection",geometries:n}}},Uy=function(e){this.geometryFactory=e||new mn,this.precisionModel=this.geometryFactory.getPrecisionModel(),this.parser=new Cg(this.geometryFactory)};Uy.prototype.read=function(e){var t=this.parser.read(e);return this.precisionModel.getType()===Dn.FIXED&&this.reducePrecision(t),t};Uy.prototype.reducePrecision=function(e){var t=this,n,i;if(e.coordinate)this.precisionModel.makePrecise(e.coordinate);else if(e.points)for(n=0,i=e.points.length;n<i;n++)t.precisionModel.makePrecise(e.points[n]);else if(e.geometries)for(n=0,i=e.geometries.length;n<i;n++)t.reducePrecision(e.geometries[n])};var Px=function(){this.parser=new Cg(this.geometryFactory)};Px.prototype.write=function(e){return this.parser.write(e)};var oe=function(){},Tg={ON:{configurable:!0},LEFT:{configurable:!0},RIGHT:{configurable:!0}};oe.prototype.interfaces_=function(){return[]};oe.prototype.getClass=function(){return oe};oe.opposite=function(e){return e===oe.LEFT?oe.RIGHT:e===oe.RIGHT?oe.LEFT:e};Tg.ON.get=function(){return 0};Tg.LEFT.get=function(){return 1};Tg.RIGHT.get=function(){return 2};Object.defineProperties(oe,Tg);function Lg(e){this.message=e||""}Lg.prototype=new Error;Lg.prototype.name="EmptyStackException";function wa(){this.array_=[]}wa.prototype=new As;wa.prototype.add=function(e){return this.array_.push(e),!0};wa.prototype.get=function(e){if(e<0||e>=this.size())throw new Error;return this.array_[e]};wa.prototype.push=function(e){return this.array_.push(e),e};wa.prototype.pop=function(e){if(this.array_.length===0)throw new Lg;return this.array_.pop()};wa.prototype.peek=function(){if(this.array_.length===0)throw new Lg;return this.array_[this.array_.length-1]};wa.prototype.empty=function(){return this.array_.length===0};wa.prototype.isEmpty=function(){return this.empty()};wa.prototype.search=function(e){return this.array_.indexOf(e)};wa.prototype.size=function(){return this.array_.length};wa.prototype.toArray=function(){for(var e=this,t=[],n=0,i=this.array_.length;n<i;n++)t.push(e.array_[n]);return t};var pa=function(){this._minIndex=-1,this._minCoord=null,this._minDe=null,this._orientedDe=null};pa.prototype.getCoordinate=function(){return this._minCoord};pa.prototype.getRightmostSide=function(e,t){var n=this.getRightmostSideOfSegment(e,t);return n<0&&(n=this.getRightmostSideOfSegment(e,t-1)),n<0&&(this._minCoord=null,this.checkForRightmostCoordinate(e)),n};pa.prototype.findRightmostEdgeAtVertex=function(){var e=this._minDe.getEdge().getCoordinates();an.isTrue(this._minIndex>0&&this._minIndex<e.length,"rightmost point expected to be interior vertex of edge");var t=e[this._minIndex-1],n=e[this._minIndex+1],i=be.computeOrientation(this._minCoord,n,t),r=!1;(t.y<this._minCoord.y&&n.y<this._minCoord.y&&i===be.COUNTERCLOCKWISE||t.y>this._minCoord.y&&n.y>this._minCoord.y&&i===be.CLOCKWISE)&&(r=!0),r&&(this._minIndex=this._minIndex-1)};pa.prototype.getRightmostSideOfSegment=function(e,t){var n=e.getEdge(),i=n.getCoordinates();if(t<0||t+1>=i.length||i[t].y===i[t+1].y)return-1;var r=oe.LEFT;return i[t].y<i[t+1].y&&(r=oe.RIGHT),r};pa.prototype.getEdge=function(){return this._orientedDe};pa.prototype.checkForRightmostCoordinate=function(e){for(var t=this,n=e.getEdge().getCoordinates(),i=0;i<n.length-1;i++)(t._minCoord===null||n[i].x>t._minCoord.x)&&(t._minDe=e,t._minIndex=i,t._minCoord=n[i])};pa.prototype.findRightmostEdgeAtNode=function(){var e=this._minDe.getNode(),t=e.getEdges();this._minDe=t.getRightmostEdge(),this._minDe.isForward()||(this._minDe=this._minDe.getSym(),this._minIndex=this._minDe.getEdge().getCoordinates().length-1)};pa.prototype.findEdge=function(e){for(var t=this,n=e.iterator();n.hasNext();){var i=n.next();i.isForward()&&t.checkForRightmostCoordinate(i)}an.isTrue(this._minIndex!==0||this._minCoord.equals(this._minDe.getCoordinate()),"inconsistency in rightmost processing"),this._minIndex===0?this.findRightmostEdgeAtNode():this.findRightmostEdgeAtVertex(),this._orientedDe=this._minDe;var r=this.getRightmostSide(this._minDe,this._minIndex);r===oe.LEFT&&(this._orientedDe=this._minDe.getSym())};pa.prototype.interfaces_=function(){return[]};pa.prototype.getClass=function(){return pa};var gl=function(e){function t(n,i){e.call(this,t.msgWithCoord(n,i)),this.pt=i?new Dt(i):null,this.name="TopologyException"}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.getCoordinate=function(){return this.pt},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t.msgWithCoord=function(n,i){return i?n:n+" [ "+i+" ]"},t}(dl),Mg=function(){this.array_=[]};Mg.prototype.addLast=function(e){this.array_.push(e)};Mg.prototype.removeFirst=function(){return this.array_.shift()};Mg.prototype.isEmpty=function(){return this.array_.length===0};var no=function(){this._finder=null,this._dirEdgeList=new fe,this._nodes=new fe,this._rightMostCoord=null,this._env=null,this._finder=new pa};no.prototype.clearVisitedEdges=function(){for(var e=this._dirEdgeList.iterator();e.hasNext();){var t=e.next();t.setVisited(!1)}};no.prototype.getRightmostCoordinate=function(){return this._rightMostCoord};no.prototype.computeNodeDepth=function(e){for(var t=this,n=null,i=e.getEdges().iterator();i.hasNext();){var r=i.next();if(r.isVisited()||r.getSym().isVisited()){n=r;break}}if(n===null)throw new gl("unable to find edge to compute depths at "+e.getCoordinate());e.getEdges().computeDepths(n);for(var l=e.getEdges().iterator();l.hasNext();){var f=l.next();f.setVisited(!0),t.copySymDepths(f)}};no.prototype.computeDepth=function(e){this.clearVisitedEdges();var t=this._finder.getEdge();t.setEdgeDepths(oe.RIGHT,e),this.copySymDepths(t),this.computeDepths(t)};no.prototype.create=function(e){this.addReachable(e),this._finder.findEdge(this._dirEdgeList),this._rightMostCoord=this._finder.getCoordinate()};no.prototype.findResultEdges=function(){for(var e=this._dirEdgeList.iterator();e.hasNext();){var t=e.next();t.getDepth(oe.RIGHT)>=1&&t.getDepth(oe.LEFT)<=0&&!t.isInteriorAreaEdge()&&t.setInResult(!0)}};no.prototype.computeDepths=function(e){var t=this,n=new Oy,i=new Mg,r=e.getNode();for(i.addLast(r),n.add(r),e.setVisited(!0);!i.isEmpty();){var l=i.removeFirst();n.add(l),t.computeNodeDepth(l);for(var f=l.getEdges().iterator();f.hasNext();){var a=f.next(),_=a.getSym();if(!_.isVisited()){var x=_.getNode();n.contains(x)||(i.addLast(x),n.add(x))}}}};no.prototype.compareTo=function(e){var t=e;return this._rightMostCoord.x<t._rightMostCoord.x?-1:this._rightMostCoord.x>t._rightMostCoord.x?1:0};no.prototype.getEnvelope=function(){if(this._env===null){for(var e=new Oe,t=this._dirEdgeList.iterator();t.hasNext();)for(var n=t.next(),i=n.getEdge().getCoordinates(),r=0;r<i.length-1;r++)e.expandToInclude(i[r]);this._env=e}return this._env};no.prototype.addReachable=function(e){var t=this,n=new wa;for(n.add(e);!n.empty();){var i=n.pop();t.add(i,n)}};no.prototype.copySymDepths=function(e){var t=e.getSym();t.setDepth(oe.LEFT,e.getDepth(oe.RIGHT)),t.setDepth(oe.RIGHT,e.getDepth(oe.LEFT))};no.prototype.add=function(e,t){var n=this;e.setVisited(!0),this._nodes.add(e);for(var i=e.getEdges().iterator();i.hasNext();){var r=i.next();n._dirEdgeList.add(r);var l=r.getSym(),f=l.getNode();f.isVisited()||t.push(f)}};no.prototype.getNodes=function(){return this._nodes};no.prototype.getDirectedEdges=function(){return this._dirEdgeList};no.prototype.interfaces_=function(){return[bs]};no.prototype.getClass=function(){return no};var ei=function e(){var t=this;if(this.location=null,arguments.length===1){if(arguments[0]instanceof Array){var n=arguments[0];this.init(n.length)}else if(Number.isInteger(arguments[0])){var i=arguments[0];this.init(1),this.location[oe.ON]=i}else if(arguments[0]instanceof e){var r=arguments[0];if(this.init(r.location.length),r!==null)for(var l=0;l<this.location.length;l++)t.location[l]=r.location[l]}}else if(arguments.length===3){var f=arguments[0],a=arguments[1],_=arguments[2];this.init(3),this.location[oe.ON]=f,this.location[oe.LEFT]=a,this.location[oe.RIGHT]=_}};ei.prototype.setAllLocations=function(e){for(var t=this,n=0;n<this.location.length;n++)t.location[n]=e};ei.prototype.isNull=function(){for(var e=this,t=0;t<this.location.length;t++)if(e.location[t]!==zt.NONE)return!1;return!0};ei.prototype.setAllLocationsIfNull=function(e){for(var t=this,n=0;n<this.location.length;n++)t.location[n]===zt.NONE&&(t.location[n]=e)};ei.prototype.isLine=function(){return this.location.length===1};ei.prototype.merge=function(e){var t=this;if(e.location.length>this.location.length){var n=new Array(3).fill(null);n[oe.ON]=this.location[oe.ON],n[oe.LEFT]=zt.NONE,n[oe.RIGHT]=zt.NONE,this.location=n}for(var i=0;i<this.location.length;i++)t.location[i]===zt.NONE&&i<e.location.length&&(t.location[i]=e.location[i])};ei.prototype.getLocations=function(){return this.location};ei.prototype.flip=function(){if(this.location.length<=1)return null;var e=this.location[oe.LEFT];this.location[oe.LEFT]=this.location[oe.RIGHT],this.location[oe.RIGHT]=e};ei.prototype.toString=function(){var e=new xa;return this.location.length>1&&e.append(zt.toLocationSymbol(this.location[oe.LEFT])),e.append(zt.toLocationSymbol(this.location[oe.ON])),this.location.length>1&&e.append(zt.toLocationSymbol(this.location[oe.RIGHT])),e.toString()};ei.prototype.setLocations=function(e,t,n){this.location[oe.ON]=e,this.location[oe.LEFT]=t,this.location[oe.RIGHT]=n};ei.prototype.get=function(e){return e<this.location.length?this.location[e]:zt.NONE};ei.prototype.isArea=function(){return this.location.length>1};ei.prototype.isAnyNull=function(){for(var e=this,t=0;t<this.location.length;t++)if(e.location[t]===zt.NONE)return!0;return!1};ei.prototype.setLocation=function(){if(arguments.length===1){var e=arguments[0];this.setLocation(oe.ON,e)}else if(arguments.length===2){var t=arguments[0],n=arguments[1];this.location[t]=n}};ei.prototype.init=function(e){this.location=new Array(e).fill(null),this.setAllLocations(zt.NONE)};ei.prototype.isEqualOnSide=function(e,t){return this.location[t]===e.location[t]};ei.prototype.allPositionsEqual=function(e){for(var t=this,n=0;n<this.location.length;n++)if(t.location[n]!==e)return!1;return!0};ei.prototype.interfaces_=function(){return[]};ei.prototype.getClass=function(){return ei};var Un=function e(){if(this.elt=new Array(2).fill(null),arguments.length===1){if(Number.isInteger(arguments[0])){var t=arguments[0];this.elt[0]=new ei(t),this.elt[1]=new ei(t)}else if(arguments[0]instanceof e){var n=arguments[0];this.elt[0]=new ei(n.elt[0]),this.elt[1]=new ei(n.elt[1])}}else if(arguments.length===2){var i=arguments[0],r=arguments[1];this.elt[0]=new ei(zt.NONE),this.elt[1]=new ei(zt.NONE),this.elt[i].setLocation(r)}else if(arguments.length===3){var l=arguments[0],f=arguments[1],a=arguments[2];this.elt[0]=new ei(l,f,a),this.elt[1]=new ei(l,f,a)}else if(arguments.length===4){var _=arguments[0],x=arguments[1],S=arguments[2],L=arguments[3];this.elt[0]=new ei(zt.NONE,zt.NONE,zt.NONE),this.elt[1]=new ei(zt.NONE,zt.NONE,zt.NONE),this.elt[_].setLocations(x,S,L)}};Un.prototype.getGeometryCount=function(){var e=0;return this.elt[0].isNull()||e++,this.elt[1].isNull()||e++,e};Un.prototype.setAllLocations=function(e,t){this.elt[e].setAllLocations(t)};Un.prototype.isNull=function(e){return this.elt[e].isNull()};Un.prototype.setAllLocationsIfNull=function(){if(arguments.length===1){var e=arguments[0];this.setAllLocationsIfNull(0,e),this.setAllLocationsIfNull(1,e)}else if(arguments.length===2){var t=arguments[0],n=arguments[1];this.elt[t].setAllLocationsIfNull(n)}};Un.prototype.isLine=function(e){return this.elt[e].isLine()};Un.prototype.merge=function(e){for(var t=this,n=0;n<2;n++)t.elt[n]===null&&e.elt[n]!==null?t.elt[n]=new ei(e.elt[n]):t.elt[n].merge(e.elt[n])};Un.prototype.flip=function(){this.elt[0].flip(),this.elt[1].flip()};Un.prototype.getLocation=function(){if(arguments.length===1){var e=arguments[0];return this.elt[e].get(oe.ON)}else if(arguments.length===2){var t=arguments[0],n=arguments[1];return this.elt[t].get(n)}};Un.prototype.toString=function(){var e=new xa;return this.elt[0]!==null&&(e.append("A:"),e.append(this.elt[0].toString())),this.elt[1]!==null&&(e.append(" B:"),e.append(this.elt[1].toString())),e.toString()};Un.prototype.isArea=function(){if(arguments.length===0)return this.elt[0].isArea()||this.elt[1].isArea();if(arguments.length===1){var e=arguments[0];return this.elt[e].isArea()}};Un.prototype.isAnyNull=function(e){return this.elt[e].isAnyNull()};Un.prototype.setLocation=function(){if(arguments.length===2){var e=arguments[0],t=arguments[1];this.elt[e].setLocation(oe.ON,t)}else if(arguments.length===3){var n=arguments[0],i=arguments[1],r=arguments[2];this.elt[n].setLocation(i,r)}};Un.prototype.isEqualOnSide=function(e,t){return this.elt[0].isEqualOnSide(e.elt[0],t)&&this.elt[1].isEqualOnSide(e.elt[1],t)};Un.prototype.allPositionsEqual=function(e,t){return this.elt[e].allPositionsEqual(t)};Un.prototype.toLine=function(e){this.elt[e].isArea()&&(this.elt[e]=new ei(this.elt[e].location[0]))};Un.prototype.interfaces_=function(){return[]};Un.prototype.getClass=function(){return Un};Un.toLineLabel=function(e){for(var t=new Un(zt.NONE),n=0;n<2;n++)t.setLocation(n,e.getLocation(n));return t};var $i=function(){this._startDe=null,this._maxNodeDegree=-1,this._edges=new fe,this._pts=new fe,this._label=new Un(zt.NONE),this._ring=null,this._isHole=null,this._shell=null,this._holes=new fe,this._geometryFactory=null;var e=arguments[0],t=arguments[1];this._geometryFactory=t,this.computePoints(e),this.computeRing()};$i.prototype.computeRing=function(){var e=this;if(this._ring!==null)return null;for(var t=new Array(this._pts.size()).fill(null),n=0;n<this._pts.size();n++)t[n]=e._pts.get(n);this._ring=this._geometryFactory.createLinearRing(t),this._isHole=be.isCCW(this._ring.getCoordinates())};$i.prototype.isIsolated=function(){return this._label.getGeometryCount()===1};$i.prototype.computePoints=function(e){var t=this;this._startDe=e;var n=e,i=!0;do{if(n===null)throw new gl("Found null DirectedEdge");if(n.getEdgeRing()===t)throw new gl("Directed Edge visited twice during ring-building at "+n.getCoordinate());t._edges.add(n);var r=n.getLabel();an.isTrue(r.isArea()),t.mergeLabel(r),t.addPoints(n.getEdge(),n.isForward(),i),i=!1,t.setEdgeRing(n,t),n=t.getNext(n)}while(n!==this._startDe)};$i.prototype.getLinearRing=function(){return this._ring};$i.prototype.getCoordinate=function(e){return this._pts.get(e)};$i.prototype.computeMaxNodeDegree=function(){var e=this;this._maxNodeDegree=0;var t=this._startDe;do{var n=t.getNode(),i=n.getEdges().getOutgoingDegree(e);i>e._maxNodeDegree&&(e._maxNodeDegree=i),t=e.getNext(t)}while(t!==this._startDe);this._maxNodeDegree*=2};$i.prototype.addPoints=function(e,t,n){var i=this,r=e.getCoordinates();if(t){var l=1;n&&(l=0);for(var f=l;f<r.length;f++)i._pts.add(r[f])}else{var a=r.length-2;n&&(a=r.length-1);for(var _=a;_>=0;_--)i._pts.add(r[_])}};$i.prototype.isHole=function(){return this._isHole};$i.prototype.setInResult=function(){var e=this._startDe;do e.getEdge().setInResult(!0),e=e.getNext();while(e!==this._startDe)};$i.prototype.containsPoint=function(e){var t=this.getLinearRing(),n=t.getEnvelopeInternal();if(!n.contains(e)||!be.isPointInRing(e,t.getCoordinates()))return!1;for(var i=this._holes.iterator();i.hasNext();){var r=i.next();if(r.containsPoint(e))return!1}return!0};$i.prototype.addHole=function(e){this._holes.add(e)};$i.prototype.isShell=function(){return this._shell===null};$i.prototype.getLabel=function(){return this._label};$i.prototype.getEdges=function(){return this._edges};$i.prototype.getMaxNodeDegree=function(){return this._maxNodeDegree<0&&this.computeMaxNodeDegree(),this._maxNodeDegree};$i.prototype.getShell=function(){return this._shell};$i.prototype.mergeLabel=function(){if(arguments.length===1){var e=arguments[0];this.mergeLabel(e,0),this.mergeLabel(e,1)}else if(arguments.length===2){var t=arguments[0],n=arguments[1],i=t.getLocation(n,oe.RIGHT);if(i===zt.NONE)return null;if(this._label.getLocation(n)===zt.NONE)return this._label.setLocation(n,i),null}};$i.prototype.setShell=function(e){this._shell=e,e!==null&&e.addHole(this)};$i.prototype.toPolygon=function(e){for(var t=this,n=new Array(this._holes.size()).fill(null),i=0;i<this._holes.size();i++)n[i]=t._holes.get(i).getLinearRing();var r=e.createPolygon(this.getLinearRing(),n);return r};$i.prototype.interfaces_=function(){return[]};$i.prototype.getClass=function(){return $i};var kC=function(e){function t(){var n=arguments[0],i=arguments[1];e.call(this,n,i)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.setEdgeRing=function(n,i){n.setMinEdgeRing(i)},t.prototype.getNext=function(n){return n.getNextMin()},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}($i),AC=function(e){function t(){var n=arguments[0],i=arguments[1];e.call(this,n,i)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.buildMinimalRings=function(){var n=this,i=new fe,r=this._startDe;do{if(r.getMinEdgeRing()===null){var l=new kC(r,n._geometryFactory);i.add(l)}r=r.getNext()}while(r!==this._startDe);return i},t.prototype.setEdgeRing=function(n,i){n.setEdgeRing(i)},t.prototype.linkDirectedEdgesForMinimalEdgeRings=function(){var n=this,i=this._startDe;do{var r=i.getNode();r.getEdges().linkMinimalDirectedEdges(n),i=i.getNext()}while(i!==this._startDe)},t.prototype.getNext=function(n){return n.getNext()},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}($i),Yo=function(){if(this._label=null,this._isInResult=!1,this._isCovered=!1,this._isCoveredSet=!1,this._isVisited=!1,arguments.length!==0&&arguments.length===1){var e=arguments[0];this._label=e}};Yo.prototype.setVisited=function(e){this._isVisited=e};Yo.prototype.setInResult=function(e){this._isInResult=e};Yo.prototype.isCovered=function(){return this._isCovered};Yo.prototype.isCoveredSet=function(){return this._isCoveredSet};Yo.prototype.setLabel=function(e){this._label=e};Yo.prototype.getLabel=function(){return this._label};Yo.prototype.setCovered=function(e){this._isCovered=e,this._isCoveredSet=!0};Yo.prototype.updateIM=function(e){an.isTrue(this._label.getGeometryCount()>=2,"found partial label"),this.computeIM(e)};Yo.prototype.isInResult=function(){return this._isInResult};Yo.prototype.isVisited=function(){return this._isVisited};Yo.prototype.interfaces_=function(){return[]};Yo.prototype.getClass=function(){return Yo};var Pg=function(e){function t(){e.call(this),this._coord=null,this._edges=null;var n=arguments[0],i=arguments[1];this._coord=n,this._edges=i,this._label=new Un(0,zt.NONE)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.isIncidentEdgeInResult=function(){for(var n=this.getEdges().getEdges().iterator();n.hasNext();){var i=n.next();if(i.getEdge().isInResult())return!0}return!1},t.prototype.isIsolated=function(){return this._label.getGeometryCount()===1},t.prototype.getCoordinate=function(){return this._coord},t.prototype.print=function(n){n.println("node "+this._coord+" lbl: "+this._label)},t.prototype.computeIM=function(n){},t.prototype.computeMergedLocation=function(n,i){var r=zt.NONE;if(r=this._label.getLocation(i),!n.isNull(i)){var l=n.getLocation(i);r!==zt.BOUNDARY&&(r=l)}return r},t.prototype.setLabel=function(){if(arguments.length===2){var n=arguments[0],i=arguments[1];this._label===null?this._label=new Un(n,i):this._label.setLocation(n,i)}else return e.prototype.setLabel.apply(this,arguments)},t.prototype.getEdges=function(){return this._edges},t.prototype.mergeLabel=function(){var n=this;if(arguments[0]instanceof t){var i=arguments[0];this.mergeLabel(i._label)}else if(arguments[0]instanceof Un)for(var r=arguments[0],l=0;l<2;l++){var f=n.computeMergedLocation(r,l),a=n._label.getLocation(l);a===zt.NONE&&n._label.setLocation(l,f)}},t.prototype.add=function(n){this._edges.insert(n),n.setNode(this)},t.prototype.setLabelBoundary=function(n){if(this._label===null)return null;var i=zt.NONE;this._label!==null&&(i=this._label.getLocation(n));var r=null;switch(i){case zt.BOUNDARY:r=zt.INTERIOR;break;case zt.INTERIOR:r=zt.BOUNDARY;break;default:r=zt.BOUNDARY;break}this._label.setLocation(n,r)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(Yo),da=function(){this.nodeMap=new Ur,this.nodeFact=null;var e=arguments[0];this.nodeFact=e};da.prototype.find=function(e){return this.nodeMap.get(e)};da.prototype.addNode=function(){if(arguments[0]instanceof Dt){var e=arguments[0],t=this.nodeMap.get(e);return t===null&&(t=this.nodeFact.createNode(e),this.nodeMap.put(e,t)),t}else if(arguments[0]instanceof Pg){var n=arguments[0],i=this.nodeMap.get(n.getCoordinate());return i===null?(this.nodeMap.put(n.getCoordinate(),n),n):(i.mergeLabel(n),i)}};da.prototype.print=function(e){for(var t=this.iterator();t.hasNext();){var n=t.next();n.print(e)}};da.prototype.iterator=function(){return this.nodeMap.values().iterator()};da.prototype.values=function(){return this.nodeMap.values()};da.prototype.getBoundaryNodes=function(e){for(var t=new fe,n=this.iterator();n.hasNext();){var i=n.next();i.getLabel().getLocation(e)===zt.BOUNDARY&&t.add(i)}return t};da.prototype.add=function(e){var t=e.getCoordinate(),n=this.addNode(t);n.add(e)};da.prototype.interfaces_=function(){return[]};da.prototype.getClass=function(){return da};var $n=function(){},_d={NE:{configurable:!0},NW:{configurable:!0},SW:{configurable:!0},SE:{configurable:!0}};$n.prototype.interfaces_=function(){return[]};$n.prototype.getClass=function(){return $n};$n.isNorthern=function(e){return e===$n.NE||e===$n.NW};$n.isOpposite=function(e,t){if(e===t)return!1;var n=(e-t+4)%4;return n===2};$n.commonHalfPlane=function(e,t){if(e===t)return e;var n=(e-t+4)%4;if(n===2)return-1;var i=e<t?e:t,r=e>t?e:t;return i===0&&r===3?3:i};$n.isInHalfPlane=function(e,t){return t===$n.SE?e===$n.SE||e===$n.SW:e===t||e===t+1};$n.quadrant=function(){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var e=arguments[0],t=arguments[1];if(e===0&&t===0)throw new _i("Cannot compute the quadrant for point ( "+e+", "+t+" )");return e>=0?t>=0?$n.NE:$n.SE:t>=0?$n.NW:$n.SW}else if(arguments[0]instanceof Dt&&arguments[1]instanceof Dt){var n=arguments[0],i=arguments[1];if(i.x===n.x&&i.y===n.y)throw new _i("Cannot compute the quadrant for two identical points "+n);return i.x>=n.x?i.y>=n.y?$n.NE:$n.SE:i.y>=n.y?$n.NW:$n.SW}};_d.NE.get=function(){return 0};_d.NW.get=function(){return 1};_d.SW.get=function(){return 2};_d.SE.get=function(){return 3};Object.defineProperties($n,_d);var Gr=function(){if(this._edge=null,this._label=null,this._node=null,this._p0=null,this._p1=null,this._dx=null,this._dy=null,this._quadrant=null,arguments.length===1){var e=arguments[0];this._edge=e}else if(arguments.length===3){var t=arguments[0],n=arguments[1],i=arguments[2],r=null;this._edge=t,this.init(n,i),this._label=r}else if(arguments.length===4){var l=arguments[0],f=arguments[1],a=arguments[2],_=arguments[3];this._edge=l,this.init(f,a),this._label=_}};Gr.prototype.compareDirection=function(e){return this._dx===e._dx&&this._dy===e._dy?0:this._quadrant>e._quadrant?1:this._quadrant<e._quadrant?-1:be.computeOrientation(e._p0,e._p1,this._p1)};Gr.prototype.getDy=function(){return this._dy};Gr.prototype.getCoordinate=function(){return this._p0};Gr.prototype.setNode=function(e){this._node=e};Gr.prototype.print=function(e){var t=Math.atan2(this._dy,this._dx),n=this.getClass().getName(),i=n.lastIndexOf("."),r=n.substring(i+1);e.print("  "+r+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+t+"   "+this._label)};Gr.prototype.compareTo=function(e){var t=e;return this.compareDirection(t)};Gr.prototype.getDirectedCoordinate=function(){return this._p1};Gr.prototype.getDx=function(){return this._dx};Gr.prototype.getLabel=function(){return this._label};Gr.prototype.getEdge=function(){return this._edge};Gr.prototype.getQuadrant=function(){return this._quadrant};Gr.prototype.getNode=function(){return this._node};Gr.prototype.toString=function(){var e=Math.atan2(this._dy,this._dx),t=this.getClass().getName(),n=t.lastIndexOf("."),i=t.substring(n+1);return"  "+i+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+e+"   "+this._label};Gr.prototype.computeLabel=function(e){};Gr.prototype.init=function(e,t){this._p0=e,this._p1=t,this._dx=t.x-e.x,this._dy=t.y-e.y,this._quadrant=$n.quadrant(this._dx,this._dy),an.isTrue(!(this._dx===0&&this._dy===0),"EdgeEnd with identical endpoints found")};Gr.prototype.interfaces_=function(){return[bs]};Gr.prototype.getClass=function(){return Gr};var vy=function(e){function t(){var n=arguments[0],i=arguments[1];if(e.call(this,n),this._isForward=null,this._isInResult=!1,this._isVisited=!1,this._sym=null,this._next=null,this._nextMin=null,this._edgeRing=null,this._minEdgeRing=null,this._depth=[0,-999,-999],this._isForward=i,i)this.init(n.getCoordinate(0),n.getCoordinate(1));else{var r=n.getNumPoints()-1;this.init(n.getCoordinate(r),n.getCoordinate(r-1))}this.computeDirectedLabel()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.getNextMin=function(){return this._nextMin},t.prototype.getDepth=function(n){return this._depth[n]},t.prototype.setVisited=function(n){this._isVisited=n},t.prototype.computeDirectedLabel=function(){this._label=new Un(this._edge.getLabel()),this._isForward||this._label.flip()},t.prototype.getNext=function(){return this._next},t.prototype.setDepth=function(n,i){if(this._depth[n]!==-999&&this._depth[n]!==i)throw new gl("assigned depths do not match",this.getCoordinate());this._depth[n]=i},t.prototype.isInteriorAreaEdge=function(){for(var n=this,i=!0,r=0;r<2;r++)n._label.isArea(r)&&n._label.getLocation(r,oe.LEFT)===zt.INTERIOR&&n._label.getLocation(r,oe.RIGHT)===zt.INTERIOR||(i=!1);return i},t.prototype.setNextMin=function(n){this._nextMin=n},t.prototype.print=function(n){e.prototype.print.call(this,n),n.print(" "+this._depth[oe.LEFT]+"/"+this._depth[oe.RIGHT]),n.print(" ("+this.getDepthDelta()+")"),this._isInResult&&n.print(" inResult")},t.prototype.setMinEdgeRing=function(n){this._minEdgeRing=n},t.prototype.isLineEdge=function(){var n=this._label.isLine(0)||this._label.isLine(1),i=!this._label.isArea(0)||this._label.allPositionsEqual(0,zt.EXTERIOR),r=!this._label.isArea(1)||this._label.allPositionsEqual(1,zt.EXTERIOR);return n&&i&&r},t.prototype.setEdgeRing=function(n){this._edgeRing=n},t.prototype.getMinEdgeRing=function(){return this._minEdgeRing},t.prototype.getDepthDelta=function(){var n=this._edge.getDepthDelta();return this._isForward||(n=-n),n},t.prototype.setInResult=function(n){this._isInResult=n},t.prototype.getSym=function(){return this._sym},t.prototype.isForward=function(){return this._isForward},t.prototype.getEdge=function(){return this._edge},t.prototype.printEdge=function(n){this.print(n),n.print(" "),this._isForward?this._edge.print(n):this._edge.printReverse(n)},t.prototype.setSym=function(n){this._sym=n},t.prototype.setVisitedEdge=function(n){this.setVisited(n),this._sym.setVisited(n)},t.prototype.setEdgeDepths=function(n,i){var r=this.getEdge().getDepthDelta();this._isForward||(r=-r);var l=1;n===oe.LEFT&&(l=-1);var f=oe.opposite(n),a=r*l,_=i+a;this.setDepth(n,i),this.setDepth(f,_)},t.prototype.getEdgeRing=function(){return this._edgeRing},t.prototype.isInResult=function(){return this._isInResult},t.prototype.setNext=function(n){this._next=n},t.prototype.isVisited=function(){return this._isVisited},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t.depthFactor=function(n,i){return n===zt.EXTERIOR&&i===zt.INTERIOR?1:n===zt.INTERIOR&&i===zt.EXTERIOR?-1:0},t}(Gr),qh=function(){};qh.prototype.createNode=function(e){return new Pg(e,null)};qh.prototype.interfaces_=function(){return[]};qh.prototype.getClass=function(){return qh};var Si=function(){if(this._edges=new fe,this._nodes=null,this._edgeEndList=new fe,arguments.length===0)this._nodes=new da(new qh);else if(arguments.length===1){var e=arguments[0];this._nodes=new da(e)}};Si.prototype.printEdges=function(e){var t=this;e.println("Edges:");for(var n=0;n<this._edges.size();n++){e.println("edge "+n+":");var i=t._edges.get(n);i.print(e),i.eiList.print(e)}};Si.prototype.find=function(e){return this._nodes.find(e)};Si.prototype.addNode=function(){if(arguments[0]instanceof Pg){var e=arguments[0];return this._nodes.addNode(e)}else if(arguments[0]instanceof Dt){var t=arguments[0];return this._nodes.addNode(t)}};Si.prototype.getNodeIterator=function(){return this._nodes.iterator()};Si.prototype.linkResultDirectedEdges=function(){for(var e=this._nodes.iterator();e.hasNext();){var t=e.next();t.getEdges().linkResultDirectedEdges()}};Si.prototype.debugPrintln=function(e){Lr.out.println(e)};Si.prototype.isBoundaryNode=function(e,t){var n=this._nodes.find(t);if(n===null)return!1;var i=n.getLabel();return i!==null&&i.getLocation(e)===zt.BOUNDARY};Si.prototype.linkAllDirectedEdges=function(){for(var e=this._nodes.iterator();e.hasNext();){var t=e.next();t.getEdges().linkAllDirectedEdges()}};Si.prototype.matchInSameDirection=function(e,t,n,i){return e.equals(n)?be.computeOrientation(e,t,i)===be.COLLINEAR&&$n.quadrant(e,t)===$n.quadrant(n,i):!1};Si.prototype.getEdgeEnds=function(){return this._edgeEndList};Si.prototype.debugPrint=function(e){Lr.out.print(e)};Si.prototype.getEdgeIterator=function(){return this._edges.iterator()};Si.prototype.findEdgeInSameDirection=function(e,t){for(var n=this,i=0;i<this._edges.size();i++){var r=n._edges.get(i),l=r.getCoordinates();if(n.matchInSameDirection(e,t,l[0],l[1])||n.matchInSameDirection(e,t,l[l.length-1],l[l.length-2]))return r}return null};Si.prototype.insertEdge=function(e){this._edges.add(e)};Si.prototype.findEdgeEnd=function(e){for(var t=this.getEdgeEnds().iterator();t.hasNext();){var n=t.next();if(n.getEdge()===e)return n}return null};Si.prototype.addEdges=function(e){for(var t=this,n=e.iterator();n.hasNext();){var i=n.next();t._edges.add(i);var r=new vy(i,!0),l=new vy(i,!1);r.setSym(l),l.setSym(r),t.add(r),t.add(l)}};Si.prototype.add=function(e){this._nodes.add(e),this._edgeEndList.add(e)};Si.prototype.getNodes=function(){return this._nodes.values()};Si.prototype.findEdge=function(e,t){for(var n=this,i=0;i<this._edges.size();i++){var r=n._edges.get(i),l=r.getCoordinates();if(e.equals(l[0])&&t.equals(l[1]))return r}return null};Si.prototype.interfaces_=function(){return[]};Si.prototype.getClass=function(){return Si};Si.linkResultDirectedEdges=function(e){for(var t=e.iterator();t.hasNext();){var n=t.next();n.getEdges().linkResultDirectedEdges()}};var Po=function(){this._geometryFactory=null,this._shellList=new fe;var e=arguments[0];this._geometryFactory=e};Po.prototype.sortShellsAndHoles=function(e,t,n){for(var i=e.iterator();i.hasNext();){var r=i.next();r.isHole()?n.add(r):t.add(r)}};Po.prototype.computePolygons=function(e){for(var t=this,n=new fe,i=e.iterator();i.hasNext();){var r=i.next(),l=r.toPolygon(t._geometryFactory);n.add(l)}return n};Po.prototype.placeFreeHoles=function(e,t){for(var n=this,i=t.iterator();i.hasNext();){var r=i.next();if(r.getShell()===null){var l=n.findEdgeRingContaining(r,e);if(l===null)throw new gl("unable to assign hole to a shell",r.getCoordinate(0));r.setShell(l)}}};Po.prototype.buildMinimalEdgeRings=function(e,t,n){for(var i=this,r=new fe,l=e.iterator();l.hasNext();){var f=l.next();if(f.getMaxNodeDegree()>2){f.linkDirectedEdgesForMinimalEdgeRings();var a=f.buildMinimalRings(),_=i.findShell(a);_!==null?(i.placePolygonHoles(_,a),t.add(_)):n.addAll(a)}else r.add(f)}return r};Po.prototype.containsPoint=function(e){for(var t=this._shellList.iterator();t.hasNext();){var n=t.next();if(n.containsPoint(e))return!0}return!1};Po.prototype.buildMaximalEdgeRings=function(e){for(var t=this,n=new fe,i=e.iterator();i.hasNext();){var r=i.next();if(r.isInResult()&&r.getLabel().isArea()&&r.getEdgeRing()===null){var l=new AC(r,t._geometryFactory);n.add(l),l.setInResult()}}return n};Po.prototype.placePolygonHoles=function(e,t){for(var n=t.iterator();n.hasNext();){var i=n.next();i.isHole()&&i.setShell(e)}};Po.prototype.getPolygons=function(){var e=this.computePolygons(this._shellList);return e};Po.prototype.findEdgeRingContaining=function(e,t){for(var n=e.getLinearRing(),i=n.getEnvelopeInternal(),r=n.getCoordinateN(0),l=null,f=null,a=t.iterator();a.hasNext();){var _=a.next(),x=_.getLinearRing(),S=x.getEnvelopeInternal();l!==null&&(f=l.getLinearRing().getEnvelopeInternal());var L=!1;S.contains(i)&&be.isPointInRing(r,x.getCoordinates())&&(L=!0),L&&(l===null||f.contains(S))&&(l=_)}return l};Po.prototype.findShell=function(e){for(var t=0,n=null,i=e.iterator();i.hasNext();){var r=i.next();r.isHole()||(n=r,t++)}return an.isTrue(t<=1,"found two shells in MinimalEdgeRing list"),n};Po.prototype.add=function(){if(arguments.length===1){var e=arguments[0];this.add(e.getEdgeEnds(),e.getNodes())}else if(arguments.length===2){var t=arguments[0],n=arguments[1];Si.linkResultDirectedEdges(n);var i=this.buildMaximalEdgeRings(t),r=new fe,l=this.buildMinimalEdgeRings(i,this._shellList,r);this.sortShellsAndHoles(l,this._shellList,r),this.placeFreeHoles(this._shellList,r)}};Po.prototype.interfaces_=function(){return[]};Po.prototype.getClass=function(){return Po};var Zh=function(){};Zh.prototype.getBounds=function(){};Zh.prototype.interfaces_=function(){return[]};Zh.prototype.getClass=function(){return Zh};var Rs=function(){this._bounds=null,this._item=null;var e=arguments[0],t=arguments[1];this._bounds=e,this._item=t};Rs.prototype.getItem=function(){return this._item};Rs.prototype.getBounds=function(){return this._bounds};Rs.prototype.interfaces_=function(){return[Zh,xs]};Rs.prototype.getClass=function(){return Rs};var _l=function(){this._size=null,this._items=null,this._size=0,this._items=new fe,this._items.add(null)};_l.prototype.poll=function(){if(this.isEmpty())return null;var e=this._items.get(1);return this._items.set(1,this._items.get(this._size)),this._size-=1,this.reorder(1),e};_l.prototype.size=function(){return this._size};_l.prototype.reorder=function(e){for(var t=this,n=null,i=this._items.get(e);e*2<=this._size&&(n=e*2,n!==t._size&&t._items.get(n+1).compareTo(t._items.get(n))<0&&n++,t._items.get(n).compareTo(i)<0);e=n)t._items.set(e,t._items.get(n));this._items.set(e,i)};_l.prototype.clear=function(){this._size=0,this._items.clear()};_l.prototype.isEmpty=function(){return this._size===0};_l.prototype.add=function(e){var t=this;this._items.add(null),this._size+=1;var n=this._size;for(this._items.set(0,e);e.compareTo(this._items.get(Math.trunc(n/2)))<0;n/=2)t._items.set(n,t._items.get(Math.trunc(n/2)));this._items.set(n,e)};_l.prototype.interfaces_=function(){return[]};_l.prototype.getClass=function(){return _l};var Yl=function(){};Yl.prototype.visitItem=function(e){};Yl.prototype.interfaces_=function(){return[]};Yl.prototype.getClass=function(){return Yl};var wc=function(){};wc.prototype.insert=function(e,t){};wc.prototype.remove=function(e,t){};wc.prototype.query=function(){};wc.prototype.interfaces_=function(){return[]};wc.prototype.getClass=function(){return wc};var tr=function(){if(this._childBoundables=new fe,this._bounds=null,this._level=null,arguments.length!==0&&arguments.length===1){var e=arguments[0];this._level=e}},kx={serialVersionUID:{configurable:!0}};tr.prototype.getLevel=function(){return this._level};tr.prototype.size=function(){return this._childBoundables.size()};tr.prototype.getChildBoundables=function(){return this._childBoundables};tr.prototype.addChildBoundable=function(e){an.isTrue(this._bounds===null),this._childBoundables.add(e)};tr.prototype.isEmpty=function(){return this._childBoundables.isEmpty()};tr.prototype.getBounds=function(){return this._bounds===null&&(this._bounds=this.computeBounds()),this._bounds};tr.prototype.interfaces_=function(){return[Zh,xs]};tr.prototype.getClass=function(){return tr};kx.serialVersionUID.get=function(){return 6493722185909574e3};Object.defineProperties(tr,kx);var Os=function(){};Os.reverseOrder=function(){return{compare:function(e,t){return t.compareTo(e)}}};Os.min=function(e){return Os.sort(e),e.get(0)};Os.sort=function(e,t){var n=e.toArray();t?Au.sort(n,t):Au.sort(n);for(var i=e.iterator(),r=0,l=n.length;r<l;r++)i.next(),i.set(n[r])};Os.singletonList=function(e){var t=new fe;return t.add(e),t};var qi=function(){this._boundable1=null,this._boundable2=null,this._distance=null,this._itemDistance=null;var e=arguments[0],t=arguments[1],n=arguments[2];this._boundable1=e,this._boundable2=t,this._itemDistance=n,this._distance=this.distance()};qi.prototype.expandToQueue=function(e,t){var n=qi.isComposite(this._boundable1),i=qi.isComposite(this._boundable2);if(n&&i)return qi.area(this._boundable1)>qi.area(this._boundable2)?(this.expand(this._boundable1,this._boundable2,e,t),null):(this.expand(this._boundable2,this._boundable1,e,t),null);if(n)return this.expand(this._boundable1,this._boundable2,e,t),null;if(i)return this.expand(this._boundable2,this._boundable1,e,t),null;throw new _i("neither boundable is composite")};qi.prototype.isLeaves=function(){return!(qi.isComposite(this._boundable1)||qi.isComposite(this._boundable2))};qi.prototype.compareTo=function(e){var t=e;return this._distance<t._distance?-1:this._distance>t._distance?1:0};qi.prototype.expand=function(e,t,n,i){for(var r=this,l=e.getChildBoundables(),f=l.iterator();f.hasNext();){var a=f.next(),_=new qi(a,t,r._itemDistance);_.getDistance()<i&&n.add(_)}};qi.prototype.getBoundable=function(e){return e===0?this._boundable1:this._boundable2};qi.prototype.getDistance=function(){return this._distance};qi.prototype.distance=function(){return this.isLeaves()?this._itemDistance.distance(this._boundable1,this._boundable2):this._boundable1.getBounds().distance(this._boundable2.getBounds())};qi.prototype.interfaces_=function(){return[bs]};qi.prototype.getClass=function(){return qi};qi.area=function(e){return e.getBounds().getArea()};qi.isComposite=function(e){return e instanceof tr};var xr=function e(){if(this._root=null,this._built=!1,this._itemBoundables=new fe,this._nodeCapacity=null,arguments.length===0){var t=e.DEFAULT_NODE_CAPACITY;this._nodeCapacity=t}else if(arguments.length===1){var n=arguments[0];an.isTrue(n>1,"Node capacity must be greater than 1"),this._nodeCapacity=n}},kg={IntersectsOp:{configurable:!0},serialVersionUID:{configurable:!0},DEFAULT_NODE_CAPACITY:{configurable:!0}};xr.prototype.getNodeCapacity=function(){return this._nodeCapacity};xr.prototype.lastNode=function(e){return e.get(e.size()-1)};xr.prototype.size=function(){var e=this;if(arguments.length===0)return this.isEmpty()?0:(this.build(),this.size(this._root));if(arguments.length===1){for(var t=arguments[0],n=0,i=t.getChildBoundables().iterator();i.hasNext();){var r=i.next();r instanceof tr?n+=e.size(r):r instanceof Rs&&(n+=1)}return n}};xr.prototype.removeItem=function(e,t){for(var n=null,i=e.getChildBoundables().iterator();i.hasNext();){var r=i.next();r instanceof Rs&&r.getItem()===t&&(n=r)}return n!==null?(e.getChildBoundables().remove(n),!0):!1};xr.prototype.itemsTree=function(){var e=this;if(arguments.length===0){this.build();var t=this.itemsTree(this._root);return t===null?new fe:t}else if(arguments.length===1){for(var n=arguments[0],i=new fe,r=n.getChildBoundables().iterator();r.hasNext();){var l=r.next();if(l instanceof tr){var f=e.itemsTree(l);f!==null&&i.add(f)}else l instanceof Rs?i.add(l.getItem()):an.shouldNeverReachHere()}return i.size()<=0?null:i}};xr.prototype.insert=function(e,t){an.isTrue(!this._built,"Cannot insert items into an STR packed R-tree after it has been built."),this._itemBoundables.add(new Rs(e,t))};xr.prototype.boundablesAtLevel=function(){var e=this;if(arguments.length===1){var t=arguments[0],n=new fe;return this.boundablesAtLevel(t,this._root,n),n}else if(arguments.length===3){var i=arguments[0],r=arguments[1],l=arguments[2];if(an.isTrue(i>-2),r.getLevel()===i)return l.add(r),null;for(var f=r.getChildBoundables().iterator();f.hasNext();){var a=f.next();a instanceof tr?e.boundablesAtLevel(i,a,l):(an.isTrue(a instanceof Rs),i===-1&&l.add(a))}return null}};xr.prototype.query=function(){var e=this;if(arguments.length===1){var t=arguments[0];this.build();var n=new fe;return this.isEmpty()||this.getIntersectsOp().intersects(this._root.getBounds(),t)&&this.query(t,this._root,n),n}else if(arguments.length===2){var i=arguments[0],r=arguments[1];if(this.build(),this.isEmpty())return null;this.getIntersectsOp().intersects(this._root.getBounds(),i)&&this.query(i,this._root,r)}else if(arguments.length===3){if(We(arguments[2],Yl)&&arguments[0]instanceof Object&&arguments[1]instanceof tr)for(var l=arguments[0],f=arguments[1],a=arguments[2],_=f.getChildBoundables(),x=0;x<_.size();x++){var S=_.get(x);e.getIntersectsOp().intersects(S.getBounds(),l)&&(S instanceof tr?e.query(l,S,a):S instanceof Rs?a.visitItem(S.getItem()):an.shouldNeverReachHere())}else if(We(arguments[2],As)&&arguments[0]instanceof Object&&arguments[1]instanceof tr)for(var L=arguments[0],A=arguments[1],P=arguments[2],O=A.getChildBoundables(),B=0;B<O.size();B++){var U=O.get(B);e.getIntersectsOp().intersects(U.getBounds(),L)&&(U instanceof tr?e.query(L,U,P):U instanceof Rs?P.add(U.getItem()):an.shouldNeverReachHere())}}};xr.prototype.build=function(){if(this._built)return null;this._root=this._itemBoundables.isEmpty()?this.createNode(0):this.createHigherLevels(this._itemBoundables,-1),this._itemBoundables=null,this._built=!0};xr.prototype.getRoot=function(){return this.build(),this._root};xr.prototype.remove=function(){var e=this;if(arguments.length===2){var t=arguments[0],n=arguments[1];return this.build(),this.getIntersectsOp().intersects(this._root.getBounds(),t)?this.remove(t,this._root,n):!1}else if(arguments.length===3){var i=arguments[0],r=arguments[1],l=arguments[2],f=this.removeItem(r,l);if(f)return!0;for(var a=null,_=r.getChildBoundables().iterator();_.hasNext();){var x=_.next();if(e.getIntersectsOp().intersects(x.getBounds(),i)&&x instanceof tr&&(f=e.remove(i,x,l),f)){a=x;break}}return a!==null&&a.getChildBoundables().isEmpty()&&r.getChildBoundables().remove(a),f}};xr.prototype.createHigherLevels=function(e,t){an.isTrue(!e.isEmpty());var n=this.createParentBoundables(e,t+1);return n.size()===1?n.get(0):this.createHigherLevels(n,t+1)};xr.prototype.depth=function(){var e=this;if(arguments.length===0)return this.isEmpty()?0:(this.build(),this.depth(this._root));if(arguments.length===1){for(var t=arguments[0],n=0,i=t.getChildBoundables().iterator();i.hasNext();){var r=i.next();if(r instanceof tr){var l=e.depth(r);l>n&&(n=l)}}return n+1}};xr.prototype.createParentBoundables=function(e,t){var n=this;an.isTrue(!e.isEmpty());var i=new fe;i.add(this.createNode(t));var r=new fe(e);Os.sort(r,this.getComparator());for(var l=r.iterator();l.hasNext();){var f=l.next();n.lastNode(i).getChildBoundables().size()===n.getNodeCapacity()&&i.add(n.createNode(t)),n.lastNode(i).addChildBoundable(f)}return i};xr.prototype.isEmpty=function(){return this._built?this._root.isEmpty():this._itemBoundables.isEmpty()};xr.prototype.interfaces_=function(){return[xs]};xr.prototype.getClass=function(){return xr};xr.compareDoubles=function(e,t){return e>t?1:e<t?-1:0};kg.IntersectsOp.get=function(){return NC};kg.serialVersionUID.get=function(){return-3886435814360241e3};kg.DEFAULT_NODE_CAPACITY.get=function(){return 10};Object.defineProperties(xr,kg);var NC=function(){},$h=function(){};$h.prototype.distance=function(e,t){};$h.prototype.interfaces_=function(){return[]};$h.prototype.getClass=function(){return $h};var Ax=function(e){function t(i){i=i||t.DEFAULT_NODE_CAPACITY,e.call(this,i)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={STRtreeNode:{configurable:!0},serialVersionUID:{configurable:!0},xComparator:{configurable:!0},yComparator:{configurable:!0},intersectsOp:{configurable:!0},DEFAULT_NODE_CAPACITY:{configurable:!0}};return t.prototype.createParentBoundablesFromVerticalSlices=function(i,r){var l=this;an.isTrue(i.length>0);for(var f=new fe,a=0;a<i.length;a++)f.addAll(l.createParentBoundablesFromVerticalSlice(i[a],r));return f},t.prototype.createNode=function(i){return new v1(i)},t.prototype.size=function(){return arguments.length===0?e.prototype.size.call(this):e.prototype.size.apply(this,arguments)},t.prototype.insert=function(){if(arguments.length===2){var i=arguments[0],r=arguments[1];if(i.isNull())return null;e.prototype.insert.call(this,i,r)}else return e.prototype.insert.apply(this,arguments)},t.prototype.getIntersectsOp=function(){return t.intersectsOp},t.prototype.verticalSlices=function(i,r){for(var l=Math.trunc(Math.ceil(i.size()/r)),f=new Array(r).fill(null),a=i.iterator(),_=0;_<r;_++){f[_]=new fe;for(var x=0;a.hasNext()&&x<l;){var S=a.next();f[_].add(S),x++}}return f},t.prototype.query=function(){if(arguments.length===1){var i=arguments[0];return e.prototype.query.call(this,i)}else if(arguments.length===2){var r=arguments[0],l=arguments[1];e.prototype.query.call(this,r,l)}else if(arguments.length===3){if(We(arguments[2],Yl)&&arguments[0]instanceof Object&&arguments[1]instanceof tr){var f=arguments[0],a=arguments[1],_=arguments[2];e.prototype.query.call(this,f,a,_)}else if(We(arguments[2],As)&&arguments[0]instanceof Object&&arguments[1]instanceof tr){var x=arguments[0],S=arguments[1],L=arguments[2];e.prototype.query.call(this,x,S,L)}}},t.prototype.getComparator=function(){return t.yComparator},t.prototype.createParentBoundablesFromVerticalSlice=function(i,r){return e.prototype.createParentBoundables.call(this,i,r)},t.prototype.remove=function(){if(arguments.length===2){var i=arguments[0],r=arguments[1];return e.prototype.remove.call(this,i,r)}else return e.prototype.remove.apply(this,arguments)},t.prototype.depth=function(){return arguments.length===0?e.prototype.depth.call(this):e.prototype.depth.apply(this,arguments)},t.prototype.createParentBoundables=function(i,r){an.isTrue(!i.isEmpty());var l=Math.trunc(Math.ceil(i.size()/this.getNodeCapacity())),f=new fe(i);Os.sort(f,t.xComparator);var a=this.verticalSlices(f,Math.trunc(Math.ceil(Math.sqrt(l))));return this.createParentBoundablesFromVerticalSlices(a,r)},t.prototype.nearestNeighbour=function(){if(arguments.length===1){if(We(arguments[0],$h)){var i=arguments[0],r=new qi(this.getRoot(),this.getRoot(),i);return this.nearestNeighbour(r)}else if(arguments[0]instanceof qi){var l=arguments[0];return this.nearestNeighbour(l,tn.POSITIVE_INFINITY)}}else if(arguments.length===2){if(arguments[0]instanceof t&&We(arguments[1],$h)){var f=arguments[0],a=arguments[1],_=new qi(this.getRoot(),f.getRoot(),a);return this.nearestNeighbour(_)}else if(arguments[0]instanceof qi&&typeof arguments[1]=="number"){var x=arguments[0],S=arguments[1],L=S,A=null,P=new _l;for(P.add(x);!P.isEmpty()&&L>0;){var O=P.poll(),B=O.getDistance();if(B>=L)break;O.isLeaves()?(L=B,A=O):O.expandToQueue(P,L)}return[A.getBoundable(0).getItem(),A.getBoundable(1).getItem()]}}else if(arguments.length===3){var U=arguments[0],Y=arguments[1],V=arguments[2],$=new Rs(U,Y),K=new qi(this.getRoot(),$,V);return this.nearestNeighbour(K)[0]}},t.prototype.interfaces_=function(){return[wc,xs]},t.prototype.getClass=function(){return t},t.centreX=function(i){return t.avg(i.getMinX(),i.getMaxX())},t.avg=function(i,r){return(i+r)/2},t.centreY=function(i){return t.avg(i.getMinY(),i.getMaxY())},n.STRtreeNode.get=function(){return v1},n.serialVersionUID.get=function(){return 0x39920f7d5f261e0},n.xComparator.get=function(){return{interfaces_:function(){return[Oh]},compare:function(i,r){return e.compareDoubles(t.centreX(i.getBounds()),t.centreX(r.getBounds()))}}},n.yComparator.get=function(){return{interfaces_:function(){return[Oh]},compare:function(i,r){return e.compareDoubles(t.centreY(i.getBounds()),t.centreY(r.getBounds()))}}},n.intersectsOp.get=function(){return{interfaces_:function(){return[e.IntersectsOp]},intersects:function(i,r){return i.intersects(r)}}},n.DEFAULT_NODE_CAPACITY.get=function(){return 10},Object.defineProperties(t,n),t}(xr),v1=function(e){function t(){var n=arguments[0];e.call(this,n)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.computeBounds=function(){for(var n=null,i=this.getChildBoundables().iterator();i.hasNext();){var r=i.next();n===null?n=new Oe(r.getBounds()):n.expandToInclude(r.getBounds())}return n},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(tr),fo=function(){};fo.prototype.interfaces_=function(){return[]};fo.prototype.getClass=function(){return fo};fo.relativeSign=function(e,t){return e<t?-1:e>t?1:0};fo.compare=function(e,t,n){if(t.equals2D(n))return 0;var i=fo.relativeSign(t.x,n.x),r=fo.relativeSign(t.y,n.y);switch(e){case 0:return fo.compareValue(i,r);case 1:return fo.compareValue(r,i);case 2:return fo.compareValue(r,-i);case 3:return fo.compareValue(-i,r);case 4:return fo.compareValue(-i,-r);case 5:return fo.compareValue(-r,-i);case 6:return fo.compareValue(-r,i);case 7:return fo.compareValue(i,-r)}return an.shouldNeverReachHere("invalid octant value"),0};fo.compareValue=function(e,t){return e<0?-1:e>0?1:t<0?-1:t>0?1:0};var Kl=function(){this._segString=null,this.coord=null,this.segmentIndex=null,this._segmentOctant=null,this._isInterior=null;var e=arguments[0],t=arguments[1],n=arguments[2],i=arguments[3];this._segString=e,this.coord=new Dt(t),this.segmentIndex=n,this._segmentOctant=i,this._isInterior=!t.equals2D(e.getCoordinate(n))};Kl.prototype.getCoordinate=function(){return this.coord};Kl.prototype.print=function(e){e.print(this.coord),e.print(" seg # = "+this.segmentIndex)};Kl.prototype.compareTo=function(e){var t=e;return this.segmentIndex<t.segmentIndex?-1:this.segmentIndex>t.segmentIndex?1:this.coord.equals2D(t.coord)?0:fo.compare(this._segmentOctant,this.coord,t.coord)};Kl.prototype.isEndPoint=function(e){return this.segmentIndex===0&&!this._isInterior||this.segmentIndex===e};Kl.prototype.isInterior=function(){return this._isInterior};Kl.prototype.interfaces_=function(){return[bs]};Kl.prototype.getClass=function(){return Kl};var io=function(){this._nodeMap=new Ur,this._edge=null;var e=arguments[0];this._edge=e};io.prototype.getSplitCoordinates=function(){var e=this,t=new md;this.addEndpoints();for(var n=this.iterator(),i=n.next();n.hasNext();){var r=n.next();e.addEdgeCoordinates(i,r,t),i=r}return t.toCoordinateArray()};io.prototype.addCollapsedNodes=function(){var e=this,t=new fe;this.findCollapsesFromInsertedNodes(t),this.findCollapsesFromExistingVertices(t);for(var n=t.iterator();n.hasNext();){var i=n.next().intValue();e.add(e._edge.getCoordinate(i),i)}};io.prototype.print=function(e){e.println("Intersections:");for(var t=this.iterator();t.hasNext();){var n=t.next();n.print(e)}};io.prototype.findCollapsesFromExistingVertices=function(e){for(var t=this,n=0;n<this._edge.size()-2;n++){var i=t._edge.getCoordinate(n),r=t._edge.getCoordinate(n+2);i.equals2D(r)&&e.add(new ua(n+1))}};io.prototype.addEdgeCoordinates=function(e,t,n){var i=this,r=this._edge.getCoordinate(t.segmentIndex),l=t.isInterior()||!t.coord.equals2D(r);n.add(new Dt(e.coord),!1);for(var f=e.segmentIndex+1;f<=t.segmentIndex;f++)n.add(i._edge.getCoordinate(f));l&&n.add(new Dt(t.coord))};io.prototype.iterator=function(){return this._nodeMap.values().iterator()};io.prototype.addSplitEdges=function(e){var t=this;this.addEndpoints(),this.addCollapsedNodes();for(var n=this.iterator(),i=n.next();n.hasNext();){var r=n.next(),l=t.createSplitEdge(i,r);e.add(l),i=r}};io.prototype.findCollapseIndex=function(e,t,n){if(!e.coord.equals2D(t.coord))return!1;var i=t.segmentIndex-e.segmentIndex;return t.isInterior()||i--,i===1?(n[0]=e.segmentIndex+1,!0):!1};io.prototype.findCollapsesFromInsertedNodes=function(e){for(var t=this,n=new Array(1).fill(null),i=this.iterator(),r=i.next();i.hasNext();){var l=i.next(),f=t.findCollapseIndex(r,l,n);f&&e.add(new ua(n[0])),r=l}};io.prototype.getEdge=function(){return this._edge};io.prototype.addEndpoints=function(){var e=this._edge.size()-1;this.add(this._edge.getCoordinate(0),0),this.add(this._edge.getCoordinate(e),e)};io.prototype.createSplitEdge=function(e,t){var n=this,i=t.segmentIndex-e.segmentIndex+2,r=this._edge.getCoordinate(t.segmentIndex),l=t.isInterior()||!t.coord.equals2D(r);l||i--;var f=new Array(i).fill(null),a=0;f[a++]=new Dt(e.coord);for(var _=e.segmentIndex+1;_<=t.segmentIndex;_++)f[a++]=n._edge.getCoordinate(_);return l&&(f[a]=new Dt(t.coord)),new Bi(f,this._edge.getData())};io.prototype.add=function(e,t){var n=new Kl(this._edge,e,t,this._edge.getSegmentOctant(t)),i=this._nodeMap.get(n);return i!==null?(an.isTrue(i.coord.equals2D(e),"Found equal nodes with different coordinates"),i):(this._nodeMap.put(n,n),n)};io.prototype.checkSplitEdgesCorrectness=function(e){var t=this._edge.getCoordinates(),n=e.get(0),i=n.getCoordinate(0);if(!i.equals2D(t[0]))throw new dl("bad split edge start point at "+i);var r=e.get(e.size()-1),l=r.getCoordinates(),f=l[l.length-1];if(!f.equals2D(t[t.length-1]))throw new dl("bad split edge end point at "+f)};io.prototype.interfaces_=function(){return[]};io.prototype.getClass=function(){return io};var Sc=function(){};Sc.prototype.interfaces_=function(){return[]};Sc.prototype.getClass=function(){return Sc};Sc.octant=function(){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var e=arguments[0],t=arguments[1];if(e===0&&t===0)throw new _i("Cannot compute the octant for point ( "+e+", "+t+" )");var n=Math.abs(e),i=Math.abs(t);return e>=0?t>=0?n>=i?0:1:n>=i?7:6:t>=0?n>=i?3:2:n>=i?4:5}else if(arguments[0]instanceof Dt&&arguments[1]instanceof Dt){var r=arguments[0],l=arguments[1],f=l.x-r.x,a=l.y-r.y;if(f===0&&a===0)throw new _i("Cannot compute the octant for two identical points "+r);return Sc.octant(f,a)}};var Ga=function(){};Ga.prototype.getCoordinates=function(){};Ga.prototype.size=function(){};Ga.prototype.getCoordinate=function(e){};Ga.prototype.isClosed=function(){};Ga.prototype.setData=function(e){};Ga.prototype.getData=function(){};Ga.prototype.interfaces_=function(){return[]};Ga.prototype.getClass=function(){return Ga};var td=function(){};td.prototype.addIntersection=function(e,t){};td.prototype.interfaces_=function(){return[Ga]};td.prototype.getClass=function(){return td};var Bi=function(){this._nodeList=new io(this),this._pts=null,this._data=null;var e=arguments[0],t=arguments[1];this._pts=e,this._data=t};Bi.prototype.getCoordinates=function(){return this._pts};Bi.prototype.size=function(){return this._pts.length};Bi.prototype.getCoordinate=function(e){return this._pts[e]};Bi.prototype.isClosed=function(){return this._pts[0].equals(this._pts[this._pts.length-1])};Bi.prototype.getSegmentOctant=function(e){return e===this._pts.length-1?-1:this.safeOctant(this.getCoordinate(e),this.getCoordinate(e+1))};Bi.prototype.setData=function(e){this._data=e};Bi.prototype.safeOctant=function(e,t){return e.equals2D(t)?0:Sc.octant(e,t)};Bi.prototype.getData=function(){return this._data};Bi.prototype.addIntersection=function(){if(arguments.length===2){var e=arguments[0],t=arguments[1];this.addIntersectionNode(e,t)}else if(arguments.length===4){var n=arguments[0],i=arguments[1],r=arguments[3],l=new Dt(n.getIntersection(r));this.addIntersection(l,i)}};Bi.prototype.toString=function(){return Ns.toLineString(new Ri(this._pts))};Bi.prototype.getNodeList=function(){return this._nodeList};Bi.prototype.addIntersectionNode=function(e,t){var n=t,i=n+1;if(i<this._pts.length){var r=this._pts[i];e.equals2D(r)&&(n=i)}var l=this._nodeList.add(e,n);return l};Bi.prototype.addIntersections=function(e,t,n){for(var i=this,r=0;r<e.getIntersectionNum();r++)i.addIntersection(e,t,n,r)};Bi.prototype.interfaces_=function(){return[td]};Bi.prototype.getClass=function(){return Bi};Bi.getNodedSubstrings=function(){if(arguments.length===1){var e=arguments[0],t=new fe;return Bi.getNodedSubstrings(e,t),t}else if(arguments.length===2)for(var n=arguments[0],i=arguments[1],r=n.iterator();r.hasNext();){var l=r.next();l.getNodeList().addSplitEdges(i)}};var ze=function(){if(this.p0=null,this.p1=null,arguments.length===0)this.p0=new Dt,this.p1=new Dt;else if(arguments.length===1){var e=arguments[0];this.p0=new Dt(e.p0),this.p1=new Dt(e.p1)}else if(arguments.length===2)this.p0=arguments[0],this.p1=arguments[1];else if(arguments.length===4){var t=arguments[0],n=arguments[1],i=arguments[2],r=arguments[3];this.p0=new Dt(t,n),this.p1=new Dt(i,r)}},Nx={serialVersionUID:{configurable:!0}};ze.prototype.minX=function(){return Math.min(this.p0.x,this.p1.x)};ze.prototype.orientationIndex=function(){if(arguments[0]instanceof ze){var e=arguments[0],t=be.orientationIndex(this.p0,this.p1,e.p0),n=be.orientationIndex(this.p0,this.p1,e.p1);return t>=0&&n>=0||t<=0&&n<=0?Math.max(t,n):0}else if(arguments[0]instanceof Dt){var i=arguments[0];return be.orientationIndex(this.p0,this.p1,i)}};ze.prototype.toGeometry=function(e){return e.createLineString([this.p0,this.p1])};ze.prototype.isVertical=function(){return this.p0.x===this.p1.x};ze.prototype.equals=function(e){if(!(e instanceof ze))return!1;var t=e;return this.p0.equals(t.p0)&&this.p1.equals(t.p1)};ze.prototype.intersection=function(e){var t=new Zu;return t.computeIntersection(this.p0,this.p1,e.p0,e.p1),t.hasIntersection()?t.getIntersection(0):null};ze.prototype.project=function(){if(arguments[0]instanceof Dt){var e=arguments[0];if(e.equals(this.p0)||e.equals(this.p1))return new Dt(e);var t=this.projectionFactor(e),n=new Dt;return n.x=this.p0.x+t*(this.p1.x-this.p0.x),n.y=this.p0.y+t*(this.p1.y-this.p0.y),n}else if(arguments[0]instanceof ze){var i=arguments[0],r=this.projectionFactor(i.p0),l=this.projectionFactor(i.p1);if(r>=1&&l>=1||r<=0&&l<=0)return null;var f=this.project(i.p0);r<0&&(f=this.p0),r>1&&(f=this.p1);var a=this.project(i.p1);return l<0&&(a=this.p0),l>1&&(a=this.p1),new ze(f,a)}};ze.prototype.normalize=function(){this.p1.compareTo(this.p0)<0&&this.reverse()};ze.prototype.angle=function(){return Math.atan2(this.p1.y-this.p0.y,this.p1.x-this.p0.x)};ze.prototype.getCoordinate=function(e){return e===0?this.p0:this.p1};ze.prototype.distancePerpendicular=function(e){return be.distancePointLinePerpendicular(e,this.p0,this.p1)};ze.prototype.minY=function(){return Math.min(this.p0.y,this.p1.y)};ze.prototype.midPoint=function(){return ze.midPoint(this.p0,this.p1)};ze.prototype.projectionFactor=function(e){if(e.equals(this.p0))return 0;if(e.equals(this.p1))return 1;var t=this.p1.x-this.p0.x,n=this.p1.y-this.p0.y,i=t*t+n*n;if(i<=0)return tn.NaN;var r=((e.x-this.p0.x)*t+(e.y-this.p0.y)*n)/i;return r};ze.prototype.closestPoints=function(e){var t=this.intersection(e);if(t!==null)return[t,t];var n=new Array(2).fill(null),i=tn.MAX_VALUE,r=null,l=this.closestPoint(e.p0);i=l.distance(e.p0),n[0]=l,n[1]=e.p0;var f=this.closestPoint(e.p1);r=f.distance(e.p1),r<i&&(i=r,n[0]=f,n[1]=e.p1);var a=e.closestPoint(this.p0);r=a.distance(this.p0),r<i&&(i=r,n[0]=this.p0,n[1]=a);var _=e.closestPoint(this.p1);return r=_.distance(this.p1),r<i&&(i=r,n[0]=this.p1,n[1]=_),n};ze.prototype.closestPoint=function(e){var t=this.projectionFactor(e);if(t>0&&t<1)return this.project(e);var n=this.p0.distance(e),i=this.p1.distance(e);return n<i?this.p0:this.p1};ze.prototype.maxX=function(){return Math.max(this.p0.x,this.p1.x)};ze.prototype.getLength=function(){return this.p0.distance(this.p1)};ze.prototype.compareTo=function(e){var t=e,n=this.p0.compareTo(t.p0);return n!==0?n:this.p1.compareTo(t.p1)};ze.prototype.reverse=function(){var e=this.p0;this.p0=this.p1,this.p1=e};ze.prototype.equalsTopo=function(e){return this.p0.equals(e.p0)&&(this.p1.equals(e.p1)||this.p0.equals(e.p1))&&this.p1.equals(e.p0)};ze.prototype.lineIntersection=function(e){try{var t=ks.intersection(this.p0,this.p1,e.p0,e.p1);return t}catch(n){if(!(n instanceof lf))throw n}finally{}return null};ze.prototype.maxY=function(){return Math.max(this.p0.y,this.p1.y)};ze.prototype.pointAlongOffset=function(e,t){var n=this.p0.x+e*(this.p1.x-this.p0.x),i=this.p0.y+e*(this.p1.y-this.p0.y),r=this.p1.x-this.p0.x,l=this.p1.y-this.p0.y,f=Math.sqrt(r*r+l*l),a=0,_=0;if(t!==0){if(f<=0)throw new Error("Cannot compute offset from zero-length line segment");a=t*r/f,_=t*l/f}var x=n-_,S=i+a,L=new Dt(x,S);return L};ze.prototype.setCoordinates=function(){if(arguments.length===1){var e=arguments[0];this.setCoordinates(e.p0,e.p1)}else if(arguments.length===2){var t=arguments[0],n=arguments[1];this.p0.x=t.x,this.p0.y=t.y,this.p1.x=n.x,this.p1.y=n.y}};ze.prototype.segmentFraction=function(e){var t=this.projectionFactor(e);return t<0?t=0:(t>1||tn.isNaN(t))&&(t=1),t};ze.prototype.toString=function(){return"LINESTRING( "+this.p0.x+" "+this.p0.y+", "+this.p1.x+" "+this.p1.y+")"};ze.prototype.isHorizontal=function(){return this.p0.y===this.p1.y};ze.prototype.distance=function(){if(arguments[0]instanceof ze){var e=arguments[0];return be.distanceLineLine(this.p0,this.p1,e.p0,e.p1)}else if(arguments[0]instanceof Dt){var t=arguments[0];return be.distancePointLine(t,this.p0,this.p1)}};ze.prototype.pointAlong=function(e){var t=new Dt;return t.x=this.p0.x+e*(this.p1.x-this.p0.x),t.y=this.p0.y+e*(this.p1.y-this.p0.y),t};ze.prototype.hashCode=function(){var e=tn.doubleToLongBits(this.p0.x);e^=tn.doubleToLongBits(this.p0.y)*31;var t=Math.trunc(e)^Math.trunc(e>>32),n=tn.doubleToLongBits(this.p1.x);n^=tn.doubleToLongBits(this.p1.y)*31;var i=Math.trunc(n)^Math.trunc(n>>32);return t^i};ze.prototype.interfaces_=function(){return[bs,xs]};ze.prototype.getClass=function(){return ze};ze.midPoint=function(e,t){return new Dt((e.x+t.x)/2,(e.y+t.y)/2)};Nx.serialVersionUID.get=function(){return 0x2d2172135f411c00};Object.defineProperties(ze,Nx);var ed=function(){this.tempEnv1=new Oe,this.tempEnv2=new Oe,this._overlapSeg1=new ze,this._overlapSeg2=new ze};ed.prototype.overlap=function(){if(arguments.length!==2&&arguments.length===4){var e=arguments[0],t=arguments[1],n=arguments[2],i=arguments[3];e.getLineSegment(t,this._overlapSeg1),n.getLineSegment(i,this._overlapSeg2),this.overlap(this._overlapSeg1,this._overlapSeg2)}};ed.prototype.interfaces_=function(){return[]};ed.prototype.getClass=function(){return ed};var ko=function(){this._pts=null,this._start=null,this._end=null,this._env=null,this._context=null,this._id=null;var e=arguments[0],t=arguments[1],n=arguments[2],i=arguments[3];this._pts=e,this._start=t,this._end=n,this._context=i};ko.prototype.getLineSegment=function(e,t){t.p0=this._pts[e],t.p1=this._pts[e+1]};ko.prototype.computeSelect=function(e,t,n,i){var r=this._pts[t],l=this._pts[n];if(i.tempEnv1.init(r,l),n-t===1)return i.select(this,t),null;if(!e.intersects(i.tempEnv1))return null;var f=Math.trunc((t+n)/2);t<f&&this.computeSelect(e,t,f,i),f<n&&this.computeSelect(e,f,n,i)};ko.prototype.getCoordinates=function(){for(var e=this,t=new Array(this._end-this._start+1).fill(null),n=0,i=this._start;i<=this._end;i++)t[n++]=e._pts[i];return t};ko.prototype.computeOverlaps=function(e,t){this.computeOverlapsInternal(this._start,this._end,e,e._start,e._end,t)};ko.prototype.setId=function(e){this._id=e};ko.prototype.select=function(e,t){this.computeSelect(e,this._start,this._end,t)};ko.prototype.getEnvelope=function(){if(this._env===null){var e=this._pts[this._start],t=this._pts[this._end];this._env=new Oe(e,t)}return this._env};ko.prototype.getEndIndex=function(){return this._end};ko.prototype.getStartIndex=function(){return this._start};ko.prototype.getContext=function(){return this._context};ko.prototype.getId=function(){return this._id};ko.prototype.computeOverlapsInternal=function(e,t,n,i,r,l){var f=this._pts[e],a=this._pts[t],_=n._pts[i],x=n._pts[r];if(t-e===1&&r-i===1)return l.overlap(this,e,n,i),null;if(l.tempEnv1.init(f,a),l.tempEnv2.init(_,x),!l.tempEnv1.intersects(l.tempEnv2))return null;var S=Math.trunc((e+t)/2),L=Math.trunc((i+r)/2);e<S&&(i<L&&this.computeOverlapsInternal(e,S,n,i,L,l),L<r&&this.computeOverlapsInternal(e,S,n,L,r,l)),S<t&&(i<L&&this.computeOverlapsInternal(S,t,n,i,L,l),L<r&&this.computeOverlapsInternal(S,t,n,L,r,l))};ko.prototype.interfaces_=function(){return[]};ko.prototype.getClass=function(){return ko};var sa=function(){};sa.prototype.interfaces_=function(){return[]};sa.prototype.getClass=function(){return sa};sa.getChainStartIndices=function(e){var t=0,n=new fe;n.add(new ua(t));do{var i=sa.findChainEnd(e,t);n.add(new ua(i)),t=i}while(t<e.length-1);var r=sa.toIntArray(n);return r};sa.findChainEnd=function(e,t){for(var n=t;n<e.length-1&&e[n].equals2D(e[n+1]);)n++;if(n>=e.length-1)return e.length-1;for(var i=$n.quadrant(e[n],e[n+1]),r=t+1;r<e.length;){if(!e[r-1].equals2D(e[r])){var l=$n.quadrant(e[r-1],e[r]);if(l!==i)break}r++}return r-1};sa.getChains=function(){if(arguments.length===1){var e=arguments[0];return sa.getChains(e,null)}else if(arguments.length===2){for(var t=arguments[0],n=arguments[1],i=new fe,r=sa.getChainStartIndices(t),l=0;l<r.length-1;l++){var f=new ko(t,r[l],r[l+1],n);i.add(f)}return i}};sa.toIntArray=function(e){for(var t=new Array(e.size()).fill(null),n=0;n<t.length;n++)t[n]=e.get(n).intValue();return t};var zu=function(){};zu.prototype.computeNodes=function(e){};zu.prototype.getNodedSubstrings=function(){};zu.prototype.interfaces_=function(){return[]};zu.prototype.getClass=function(){return zu};var nd=function(){if(this._segInt=null,arguments.length!==0&&arguments.length===1){var e=arguments[0];this.setSegmentIntersector(e)}};nd.prototype.setSegmentIntersector=function(e){this._segInt=e};nd.prototype.interfaces_=function(){return[zu]};nd.prototype.getClass=function(){return nd};var Gy=function(e){function t(i){i?e.call(this,i):e.call(this),this._monoChains=new fe,this._index=new Ax,this._idCounter=0,this._nodedSegStrings=null,this._nOverlaps=0}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={SegmentOverlapAction:{configurable:!0}};return t.prototype.getMonotoneChains=function(){return this._monoChains},t.prototype.getNodedSubstrings=function(){return Bi.getNodedSubstrings(this._nodedSegStrings)},t.prototype.getIndex=function(){return this._index},t.prototype.add=function(i){for(var r=this,l=sa.getChains(i.getCoordinates(),i),f=l.iterator();f.hasNext();){var a=f.next();a.setId(r._idCounter++),r._index.insert(a.getEnvelope(),a),r._monoChains.add(a)}},t.prototype.computeNodes=function(i){var r=this;this._nodedSegStrings=i;for(var l=i.iterator();l.hasNext();)r.add(l.next());this.intersectChains()},t.prototype.intersectChains=function(){for(var i=this,r=new b1(this._segInt),l=this._monoChains.iterator();l.hasNext();)for(var f=l.next(),a=i._index.query(f.getEnvelope()),_=a.iterator();_.hasNext();){var x=_.next();if(x.getId()>f.getId()&&(f.computeOverlaps(x,r),i._nOverlaps++),i._segInt.isDone())return null}},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},n.SegmentOverlapAction.get=function(){return b1},Object.defineProperties(t,n),t}(nd),b1=function(e){function t(){e.call(this),this._si=null;var n=arguments[0];this._si=n}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.overlap=function(){if(arguments.length===4){var n=arguments[0],i=arguments[1],r=arguments[2],l=arguments[3],f=n.getContext(),a=r.getContext();this._si.processIntersections(f,i,a,l)}else return e.prototype.overlap.apply(this,arguments)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(ed),Nn=function e(){if(this._quadrantSegments=e.DEFAULT_QUADRANT_SEGMENTS,this._endCapStyle=e.CAP_ROUND,this._joinStyle=e.JOIN_ROUND,this._mitreLimit=e.DEFAULT_MITRE_LIMIT,this._isSingleSided=!1,this._simplifyFactor=e.DEFAULT_SIMPLIFY_FACTOR,arguments.length!==0){if(arguments.length===1){var t=arguments[0];this.setQuadrantSegments(t)}else if(arguments.length===2){var n=arguments[0],i=arguments[1];this.setQuadrantSegments(n),this.setEndCapStyle(i)}else if(arguments.length===4){var r=arguments[0],l=arguments[1],f=arguments[2],a=arguments[3];this.setQuadrantSegments(r),this.setEndCapStyle(l),this.setJoinStyle(f),this.setMitreLimit(a)}}},xl={CAP_ROUND:{configurable:!0},CAP_FLAT:{configurable:!0},CAP_SQUARE:{configurable:!0},JOIN_ROUND:{configurable:!0},JOIN_MITRE:{configurable:!0},JOIN_BEVEL:{configurable:!0},DEFAULT_QUADRANT_SEGMENTS:{configurable:!0},DEFAULT_MITRE_LIMIT:{configurable:!0},DEFAULT_SIMPLIFY_FACTOR:{configurable:!0}};Nn.prototype.getEndCapStyle=function(){return this._endCapStyle};Nn.prototype.isSingleSided=function(){return this._isSingleSided};Nn.prototype.setQuadrantSegments=function(e){this._quadrantSegments=e,this._quadrantSegments===0&&(this._joinStyle=Nn.JOIN_BEVEL),this._quadrantSegments<0&&(this._joinStyle=Nn.JOIN_MITRE,this._mitreLimit=Math.abs(this._quadrantSegments)),e<=0&&(this._quadrantSegments=1),this._joinStyle!==Nn.JOIN_ROUND&&(this._quadrantSegments=Nn.DEFAULT_QUADRANT_SEGMENTS)};Nn.prototype.getJoinStyle=function(){return this._joinStyle};Nn.prototype.setJoinStyle=function(e){this._joinStyle=e};Nn.prototype.setSimplifyFactor=function(e){this._simplifyFactor=e<0?0:e};Nn.prototype.getSimplifyFactor=function(){return this._simplifyFactor};Nn.prototype.getQuadrantSegments=function(){return this._quadrantSegments};Nn.prototype.setEndCapStyle=function(e){this._endCapStyle=e};Nn.prototype.getMitreLimit=function(){return this._mitreLimit};Nn.prototype.setMitreLimit=function(e){this._mitreLimit=e};Nn.prototype.setSingleSided=function(e){this._isSingleSided=e};Nn.prototype.interfaces_=function(){return[]};Nn.prototype.getClass=function(){return Nn};Nn.bufferDistanceError=function(e){var t=Math.PI/2/e;return 1-Math.cos(t/2)};xl.CAP_ROUND.get=function(){return 1};xl.CAP_FLAT.get=function(){return 2};xl.CAP_SQUARE.get=function(){return 3};xl.JOIN_ROUND.get=function(){return 1};xl.JOIN_MITRE.get=function(){return 2};xl.JOIN_BEVEL.get=function(){return 3};xl.DEFAULT_QUADRANT_SEGMENTS.get=function(){return 8};xl.DEFAULT_MITRE_LIMIT.get=function(){return 5};xl.DEFAULT_SIMPLIFY_FACTOR.get=function(){return .01};Object.defineProperties(Nn,xl);var ki=function(e){this._distanceTol=null,this._isDeleted=null,this._angleOrientation=be.COUNTERCLOCKWISE,this._inputLine=e||null},yd={INIT:{configurable:!0},DELETE:{configurable:!0},KEEP:{configurable:!0},NUM_PTS_TO_CHECK:{configurable:!0}};ki.prototype.isDeletable=function(e,t,n,i){var r=this._inputLine[e],l=this._inputLine[t],f=this._inputLine[n];return!this.isConcave(r,l,f)||!this.isShallow(r,l,f,i)?!1:this.isShallowSampled(r,l,e,n,i)};ki.prototype.deleteShallowConcavities=function(){for(var e=this,t=1,n=this.findNextNonDeletedIndex(t),i=this.findNextNonDeletedIndex(n),r=!1;i<this._inputLine.length;){var l=!1;e.isDeletable(t,n,i,e._distanceTol)&&(e._isDeleted[n]=ki.DELETE,l=!0,r=!0),l?t=i:t=n,n=e.findNextNonDeletedIndex(t),i=e.findNextNonDeletedIndex(n)}return r};ki.prototype.isShallowConcavity=function(e,t,n,i){var r=be.computeOrientation(e,t,n),l=r===this._angleOrientation;if(!l)return!1;var f=be.distancePointLine(t,e,n);return f<i};ki.prototype.isShallowSampled=function(e,t,n,i,r){var l=this,f=Math.trunc((i-n)/ki.NUM_PTS_TO_CHECK);f<=0&&(f=1);for(var a=n;a<i;a+=f)if(!l.isShallow(e,t,l._inputLine[a],r))return!1;return!0};ki.prototype.isConcave=function(e,t,n){var i=be.computeOrientation(e,t,n),r=i===this._angleOrientation;return r};ki.prototype.simplify=function(e){var t=this;this._distanceTol=Math.abs(e),e<0&&(this._angleOrientation=be.CLOCKWISE),this._isDeleted=new Array(this._inputLine.length).fill(null);var n=!1;do n=t.deleteShallowConcavities();while(n);return this.collapseLine()};ki.prototype.findNextNonDeletedIndex=function(e){for(var t=e+1;t<this._inputLine.length&&this._isDeleted[t]===ki.DELETE;)t++;return t};ki.prototype.isShallow=function(e,t,n,i){var r=be.distancePointLine(t,e,n);return r<i};ki.prototype.collapseLine=function(){for(var e=this,t=new md,n=0;n<this._inputLine.length;n++)e._isDeleted[n]!==ki.DELETE&&t.add(e._inputLine[n]);return t.toCoordinateArray()};ki.prototype.interfaces_=function(){return[]};ki.prototype.getClass=function(){return ki};ki.simplify=function(e,t){var n=new ki(e);return n.simplify(t)};yd.INIT.get=function(){return 0};yd.DELETE.get=function(){return 1};yd.KEEP.get=function(){return 1};yd.NUM_PTS_TO_CHECK.get=function(){return 10};Object.defineProperties(ki,yd);var Ko=function(){this._ptList=null,this._precisionModel=null,this._minimimVertexDistance=0,this._ptList=new fe},Dx={COORDINATE_ARRAY_TYPE:{configurable:!0}};Ko.prototype.getCoordinates=function(){var e=this._ptList.toArray(Ko.COORDINATE_ARRAY_TYPE);return e};Ko.prototype.setPrecisionModel=function(e){this._precisionModel=e};Ko.prototype.addPt=function(e){var t=new Dt(e);if(this._precisionModel.makePrecise(t),this.isRedundant(t))return null;this._ptList.add(t)};Ko.prototype.revere=function(){};Ko.prototype.addPts=function(e,t){var n=this;if(t)for(var i=0;i<e.length;i++)n.addPt(e[i]);else for(var r=e.length-1;r>=0;r--)n.addPt(e[r])};Ko.prototype.isRedundant=function(e){if(this._ptList.size()<1)return!1;var t=this._ptList.get(this._ptList.size()-1),n=e.distance(t);return n<this._minimimVertexDistance};Ko.prototype.toString=function(){var e=new mn,t=e.createLineString(this.getCoordinates());return t.toString()};Ko.prototype.closeRing=function(){if(this._ptList.size()<1)return null;var e=new Dt(this._ptList.get(0)),t=this._ptList.get(this._ptList.size()-1);if(e.equals(t))return null;this._ptList.add(e)};Ko.prototype.setMinimumVertexDistance=function(e){this._minimimVertexDistance=e};Ko.prototype.interfaces_=function(){return[]};Ko.prototype.getClass=function(){return Ko};Dx.COORDINATE_ARRAY_TYPE.get=function(){return new Array(0).fill(null)};Object.defineProperties(Ko,Dx);var En=function(){},Bc={PI_TIMES_2:{configurable:!0},PI_OVER_2:{configurable:!0},PI_OVER_4:{configurable:!0},COUNTERCLOCKWISE:{configurable:!0},CLOCKWISE:{configurable:!0},NONE:{configurable:!0}};En.prototype.interfaces_=function(){return[]};En.prototype.getClass=function(){return En};En.toDegrees=function(e){return e*180/Math.PI};En.normalize=function(e){for(;e>Math.PI;)e-=En.PI_TIMES_2;for(;e<=-Math.PI;)e+=En.PI_TIMES_2;return e};En.angle=function(){if(arguments.length===1){var e=arguments[0];return Math.atan2(e.y,e.x)}else if(arguments.length===2){var t=arguments[0],n=arguments[1],i=n.x-t.x,r=n.y-t.y;return Math.atan2(r,i)}};En.isAcute=function(e,t,n){var i=e.x-t.x,r=e.y-t.y,l=n.x-t.x,f=n.y-t.y,a=i*l+r*f;return a>0};En.isObtuse=function(e,t,n){var i=e.x-t.x,r=e.y-t.y,l=n.x-t.x,f=n.y-t.y,a=i*l+r*f;return a<0};En.interiorAngle=function(e,t,n){var i=En.angle(t,e),r=En.angle(t,n);return Math.abs(r-i)};En.normalizePositive=function(e){if(e<0){for(;e<0;)e+=En.PI_TIMES_2;e>=En.PI_TIMES_2&&(e=0)}else{for(;e>=En.PI_TIMES_2;)e-=En.PI_TIMES_2;e<0&&(e=0)}return e};En.angleBetween=function(e,t,n){var i=En.angle(t,e),r=En.angle(t,n);return En.diff(i,r)};En.diff=function(e,t){var n=null;return e<t?n=t-e:n=e-t,n>Math.PI&&(n=2*Math.PI-n),n};En.toRadians=function(e){return e*Math.PI/180};En.getTurn=function(e,t){var n=Math.sin(t-e);return n>0?En.COUNTERCLOCKWISE:n<0?En.CLOCKWISE:En.NONE};En.angleBetweenOriented=function(e,t,n){var i=En.angle(t,e),r=En.angle(t,n),l=r-i;return l<=-Math.PI?l+En.PI_TIMES_2:l>Math.PI?l-En.PI_TIMES_2:l};Bc.PI_TIMES_2.get=function(){return 2*Math.PI};Bc.PI_OVER_2.get=function(){return Math.PI/2};Bc.PI_OVER_4.get=function(){return Math.PI/4};Bc.COUNTERCLOCKWISE.get=function(){return be.COUNTERCLOCKWISE};Bc.CLOCKWISE.get=function(){return be.CLOCKWISE};Bc.NONE.get=function(){return be.COLLINEAR};Object.defineProperties(En,Bc);var fi=function e(){this._maxCurveSegmentError=0,this._filletAngleQuantum=null,this._closingSegLengthFactor=1,this._segList=null,this._distance=0,this._precisionModel=null,this._bufParams=null,this._li=null,this._s0=null,this._s1=null,this._s2=null,this._seg0=new ze,this._seg1=new ze,this._offset0=new ze,this._offset1=new ze,this._side=0,this._hasNarrowConcaveAngle=!1;var t=arguments[0],n=arguments[1],i=arguments[2];this._precisionModel=t,this._bufParams=n,this._li=new Zu,this._filletAngleQuantum=Math.PI/2/n.getQuadrantSegments(),n.getQuadrantSegments()>=8&&n.getJoinStyle()===Nn.JOIN_ROUND&&(this._closingSegLengthFactor=e.MAX_CLOSING_SEG_LEN_FACTOR),this.init(i)},vd={OFFSET_SEGMENT_SEPARATION_FACTOR:{configurable:!0},INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR:{configurable:!0},CURVE_VERTEX_SNAP_DISTANCE_FACTOR:{configurable:!0},MAX_CLOSING_SEG_LEN_FACTOR:{configurable:!0}};fi.prototype.addNextSegment=function(e,t){if(this._s0=this._s1,this._s1=this._s2,this._s2=e,this._seg0.setCoordinates(this._s0,this._s1),this.computeOffsetSegment(this._seg0,this._side,this._distance,this._offset0),this._seg1.setCoordinates(this._s1,this._s2),this.computeOffsetSegment(this._seg1,this._side,this._distance,this._offset1),this._s1.equals(this._s2))return null;var n=be.computeOrientation(this._s0,this._s1,this._s2),i=n===be.CLOCKWISE&&this._side===oe.LEFT||n===be.COUNTERCLOCKWISE&&this._side===oe.RIGHT;n===0?this.addCollinear(t):i?this.addOutsideTurn(n,t):this.addInsideTurn(n,t)};fi.prototype.addLineEndCap=function(e,t){var n=new ze(e,t),i=new ze;this.computeOffsetSegment(n,oe.LEFT,this._distance,i);var r=new ze;this.computeOffsetSegment(n,oe.RIGHT,this._distance,r);var l=t.x-e.x,f=t.y-e.y,a=Math.atan2(f,l);switch(this._bufParams.getEndCapStyle()){case Nn.CAP_ROUND:this._segList.addPt(i.p1),this.addFilletArc(t,a+Math.PI/2,a-Math.PI/2,be.CLOCKWISE,this._distance),this._segList.addPt(r.p1);break;case Nn.CAP_FLAT:this._segList.addPt(i.p1),this._segList.addPt(r.p1);break;case Nn.CAP_SQUARE:var _=new Dt;_.x=Math.abs(this._distance)*Math.cos(a),_.y=Math.abs(this._distance)*Math.sin(a);var x=new Dt(i.p1.x+_.x,i.p1.y+_.y),S=new Dt(r.p1.x+_.x,r.p1.y+_.y);this._segList.addPt(x),this._segList.addPt(S);break}};fi.prototype.getCoordinates=function(){var e=this._segList.getCoordinates();return e};fi.prototype.addMitreJoin=function(e,t,n,i){var r=!0,l=null;try{l=ks.intersection(t.p0,t.p1,n.p0,n.p1);var f=i<=0?1:l.distance(e)/Math.abs(i);f>this._bufParams.getMitreLimit()&&(r=!1)}catch(a){if(a instanceof lf)l=new Dt(0,0),r=!1;else throw a}finally{}r?this._segList.addPt(l):this.addLimitedMitreJoin(t,n,i,this._bufParams.getMitreLimit())};fi.prototype.addFilletCorner=function(e,t,n,i,r){var l=t.x-e.x,f=t.y-e.y,a=Math.atan2(f,l),_=n.x-e.x,x=n.y-e.y,S=Math.atan2(x,_);i===be.CLOCKWISE?a<=S&&(a+=2*Math.PI):a>=S&&(a-=2*Math.PI),this._segList.addPt(t),this.addFilletArc(e,a,S,i,r),this._segList.addPt(n)};fi.prototype.addOutsideTurn=function(e,t){if(this._offset0.p1.distance(this._offset1.p0)<this._distance*fi.OFFSET_SEGMENT_SEPARATION_FACTOR)return this._segList.addPt(this._offset0.p1),null;this._bufParams.getJoinStyle()===Nn.JOIN_MITRE?this.addMitreJoin(this._s1,this._offset0,this._offset1,this._distance):this._bufParams.getJoinStyle()===Nn.JOIN_BEVEL?this.addBevelJoin(this._offset0,this._offset1):(t&&this._segList.addPt(this._offset0.p1),this.addFilletCorner(this._s1,this._offset0.p1,this._offset1.p0,e,this._distance),this._segList.addPt(this._offset1.p0))};fi.prototype.createSquare=function(e){this._segList.addPt(new Dt(e.x+this._distance,e.y+this._distance)),this._segList.addPt(new Dt(e.x+this._distance,e.y-this._distance)),this._segList.addPt(new Dt(e.x-this._distance,e.y-this._distance)),this._segList.addPt(new Dt(e.x-this._distance,e.y+this._distance)),this._segList.closeRing()};fi.prototype.addSegments=function(e,t){this._segList.addPts(e,t)};fi.prototype.addFirstSegment=function(){this._segList.addPt(this._offset1.p0)};fi.prototype.addLastSegment=function(){this._segList.addPt(this._offset1.p1)};fi.prototype.initSideSegments=function(e,t,n){this._s1=e,this._s2=t,this._side=n,this._seg1.setCoordinates(e,t),this.computeOffsetSegment(this._seg1,n,this._distance,this._offset1)};fi.prototype.addLimitedMitreJoin=function(e,t,n,i){var r=this._seg0.p1,l=En.angle(r,this._seg0.p0),f=En.angleBetweenOriented(this._seg0.p0,r,this._seg1.p1),a=f/2,_=En.normalize(l+a),x=En.normalize(_+Math.PI),S=i*n,L=S*Math.abs(Math.sin(a)),A=n-L,P=r.x+S*Math.cos(x),O=r.y+S*Math.sin(x),B=new Dt(P,O),U=new ze(r,B),Y=U.pointAlongOffset(1,A),V=U.pointAlongOffset(1,-A);this._side===oe.LEFT?(this._segList.addPt(Y),this._segList.addPt(V)):(this._segList.addPt(V),this._segList.addPt(Y))};fi.prototype.computeOffsetSegment=function(e,t,n,i){var r=t===oe.LEFT?1:-1,l=e.p1.x-e.p0.x,f=e.p1.y-e.p0.y,a=Math.sqrt(l*l+f*f),_=r*n*l/a,x=r*n*f/a;i.p0.x=e.p0.x-x,i.p0.y=e.p0.y+_,i.p1.x=e.p1.x-x,i.p1.y=e.p1.y+_};fi.prototype.addFilletArc=function(e,t,n,i,r){var l=this,f=i===be.CLOCKWISE?-1:1,a=Math.abs(t-n),_=Math.trunc(a/this._filletAngleQuantum+.5);if(_<1)return null;for(var x=0,S=a/_,L=x,A=new Dt;L<a;){var P=t+f*L;A.x=e.x+r*Math.cos(P),A.y=e.y+r*Math.sin(P),l._segList.addPt(A),L+=S}};fi.prototype.addInsideTurn=function(e,t){if(this._li.computeIntersection(this._offset0.p0,this._offset0.p1,this._offset1.p0,this._offset1.p1),this._li.hasIntersection())this._segList.addPt(this._li.getIntersection(0));else if(this._hasNarrowConcaveAngle=!0,this._offset0.p1.distance(this._offset1.p0)<this._distance*fi.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR)this._segList.addPt(this._offset0.p1);else{if(this._segList.addPt(this._offset0.p1),this._closingSegLengthFactor>0){var n=new Dt((this._closingSegLengthFactor*this._offset0.p1.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset0.p1.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(n);var i=new Dt((this._closingSegLengthFactor*this._offset1.p0.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset1.p0.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(i)}else this._segList.addPt(this._s1);this._segList.addPt(this._offset1.p0)}};fi.prototype.createCircle=function(e){var t=new Dt(e.x+this._distance,e.y);this._segList.addPt(t),this.addFilletArc(e,0,2*Math.PI,-1,this._distance),this._segList.closeRing()};fi.prototype.addBevelJoin=function(e,t){this._segList.addPt(e.p1),this._segList.addPt(t.p0)};fi.prototype.init=function(e){this._distance=e,this._maxCurveSegmentError=e*(1-Math.cos(this._filletAngleQuantum/2)),this._segList=new Ko,this._segList.setPrecisionModel(this._precisionModel),this._segList.setMinimumVertexDistance(e*fi.CURVE_VERTEX_SNAP_DISTANCE_FACTOR)};fi.prototype.addCollinear=function(e){this._li.computeIntersection(this._s0,this._s1,this._s1,this._s2);var t=this._li.getIntersectionNum();t>=2&&(this._bufParams.getJoinStyle()===Nn.JOIN_BEVEL||this._bufParams.getJoinStyle()===Nn.JOIN_MITRE?(e&&this._segList.addPt(this._offset0.p1),this._segList.addPt(this._offset1.p0)):this.addFilletCorner(this._s1,this._offset0.p1,this._offset1.p0,be.CLOCKWISE,this._distance))};fi.prototype.closeRing=function(){this._segList.closeRing()};fi.prototype.hasNarrowConcaveAngle=function(){return this._hasNarrowConcaveAngle};fi.prototype.interfaces_=function(){return[]};fi.prototype.getClass=function(){return fi};vd.OFFSET_SEGMENT_SEPARATION_FACTOR.get=function(){return .001};vd.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR.get=function(){return .001};vd.CURVE_VERTEX_SNAP_DISTANCE_FACTOR.get=function(){return 1e-6};vd.MAX_CLOSING_SEG_LEN_FACTOR.get=function(){return 80};Object.defineProperties(fi,vd);var mo=function(){this._distance=0,this._precisionModel=null,this._bufParams=null;var e=arguments[0],t=arguments[1];this._precisionModel=e,this._bufParams=t};mo.prototype.getOffsetCurve=function(e,t){if(this._distance=t,t===0)return null;var n=t<0,i=Math.abs(t),r=this.getSegGen(i);e.length<=1?this.computePointCurve(e[0],r):this.computeOffsetCurve(e,n,r);var l=r.getCoordinates();return n&&gn.reverse(l),l};mo.prototype.computeSingleSidedBufferCurve=function(e,t,n){var i=this.simplifyTolerance(this._distance);if(t){n.addSegments(e,!0);var r=ki.simplify(e,-i),l=r.length-1;n.initSideSegments(r[l],r[l-1],oe.LEFT),n.addFirstSegment();for(var f=l-2;f>=0;f--)n.addNextSegment(r[f],!0)}else{n.addSegments(e,!1);var a=ki.simplify(e,i),_=a.length-1;n.initSideSegments(a[0],a[1],oe.LEFT),n.addFirstSegment();for(var x=2;x<=_;x++)n.addNextSegment(a[x],!0)}n.addLastSegment(),n.closeRing()};mo.prototype.computeRingBufferCurve=function(e,t,n){var i=this.simplifyTolerance(this._distance);t===oe.RIGHT&&(i=-i);var r=ki.simplify(e,i),l=r.length-1;n.initSideSegments(r[l-1],r[0],t);for(var f=1;f<=l;f++){var a=f!==1;n.addNextSegment(r[f],a)}n.closeRing()};mo.prototype.computeLineBufferCurve=function(e,t){var n=this.simplifyTolerance(this._distance),i=ki.simplify(e,n),r=i.length-1;t.initSideSegments(i[0],i[1],oe.LEFT);for(var l=2;l<=r;l++)t.addNextSegment(i[l],!0);t.addLastSegment(),t.addLineEndCap(i[r-1],i[r]);var f=ki.simplify(e,-n),a=f.length-1;t.initSideSegments(f[a],f[a-1],oe.LEFT);for(var _=a-2;_>=0;_--)t.addNextSegment(f[_],!0);t.addLastSegment(),t.addLineEndCap(f[1],f[0]),t.closeRing()};mo.prototype.computePointCurve=function(e,t){switch(this._bufParams.getEndCapStyle()){case Nn.CAP_ROUND:t.createCircle(e);break;case Nn.CAP_SQUARE:t.createSquare(e);break}};mo.prototype.getLineCurve=function(e,t){if(this._distance=t,t<0&&!this._bufParams.isSingleSided()||t===0)return null;var n=Math.abs(t),i=this.getSegGen(n);if(e.length<=1)this.computePointCurve(e[0],i);else if(this._bufParams.isSingleSided()){var r=t<0;this.computeSingleSidedBufferCurve(e,r,i)}else this.computeLineBufferCurve(e,i);var l=i.getCoordinates();return l};mo.prototype.getBufferParameters=function(){return this._bufParams};mo.prototype.simplifyTolerance=function(e){return e*this._bufParams.getSimplifyFactor()};mo.prototype.getRingCurve=function(e,t,n){if(this._distance=n,e.length<=2)return this.getLineCurve(e,n);if(n===0)return mo.copyCoordinates(e);var i=this.getSegGen(n);return this.computeRingBufferCurve(e,t,i),i.getCoordinates()};mo.prototype.computeOffsetCurve=function(e,t,n){var i=this.simplifyTolerance(this._distance);if(t){var r=ki.simplify(e,-i),l=r.length-1;n.initSideSegments(r[l],r[l-1],oe.LEFT),n.addFirstSegment();for(var f=l-2;f>=0;f--)n.addNextSegment(r[f],!0)}else{var a=ki.simplify(e,i),_=a.length-1;n.initSideSegments(a[0],a[1],oe.LEFT),n.addFirstSegment();for(var x=2;x<=_;x++)n.addNextSegment(a[x],!0)}n.addLastSegment()};mo.prototype.getSegGen=function(e){return new fi(this._precisionModel,this._bufParams,e)};mo.prototype.interfaces_=function(){return[]};mo.prototype.getClass=function(){return mo};mo.copyCoordinates=function(e){for(var t=new Array(e.length).fill(null),n=0;n<t.length;n++)t[n]=new Dt(e[n]);return t};var Ec=function(){this._subgraphs=null,this._seg=new ze,this._cga=new be;var e=arguments[0];this._subgraphs=e},Rx={DepthSegment:{configurable:!0}};Ec.prototype.findStabbedSegments=function(){var e=this;if(arguments.length===1){for(var t=arguments[0],n=new fe,i=this._subgraphs.iterator();i.hasNext();){var r=i.next(),l=r.getEnvelope();t.y<l.getMinY()||t.y>l.getMaxY()||e.findStabbedSegments(t,r.getDirectedEdges(),n)}return n}else if(arguments.length===3){if(We(arguments[2],As)&&arguments[0]instanceof Dt&&arguments[1]instanceof vy)for(var f=arguments[0],a=arguments[1],_=arguments[2],x=a.getEdge().getCoordinates(),S=0;S<x.length-1;S++){e._seg.p0=x[S],e._seg.p1=x[S+1],e._seg.p0.y>e._seg.p1.y&&e._seg.reverse();var L=Math.max(e._seg.p0.x,e._seg.p1.x);if(!(L<f.x)&&!e._seg.isHorizontal()&&!(f.y<e._seg.p0.y||f.y>e._seg.p1.y)&&be.computeOrientation(e._seg.p0,e._seg.p1,f)!==be.RIGHT){var A=a.getDepth(oe.LEFT);e._seg.p0.equals(x[S])||(A=a.getDepth(oe.RIGHT));var P=new Fu(e._seg,A);_.add(P)}}else if(We(arguments[2],As)&&arguments[0]instanceof Dt&&We(arguments[1],As))for(var O=arguments[0],B=arguments[1],U=arguments[2],Y=B.iterator();Y.hasNext();){var V=Y.next();V.isForward()&&e.findStabbedSegments(O,V,U)}}};Ec.prototype.getDepth=function(e){var t=this.findStabbedSegments(e);if(t.size()===0)return 0;var n=Os.min(t);return n._leftDepth};Ec.prototype.interfaces_=function(){return[]};Ec.prototype.getClass=function(){return Ec};Rx.DepthSegment.get=function(){return Fu};Object.defineProperties(Ec,Rx);var Fu=function(){this._upwardSeg=null,this._leftDepth=null;var e=arguments[0],t=arguments[1];this._upwardSeg=new ze(e),this._leftDepth=t};Fu.prototype.compareTo=function(e){var t=e;if(this._upwardSeg.minX()>=t._upwardSeg.maxX())return 1;if(this._upwardSeg.maxX()<=t._upwardSeg.minX())return-1;var n=this._upwardSeg.orientationIndex(t._upwardSeg);return n!==0||(n=-1*t._upwardSeg.orientationIndex(this._upwardSeg),n!==0)?n:this._upwardSeg.compareTo(t._upwardSeg)};Fu.prototype.compareX=function(e,t){var n=e.p0.compareTo(t.p0);return n!==0?n:e.p1.compareTo(t.p1)};Fu.prototype.toString=function(){return this._upwardSeg.toString()};Fu.prototype.interfaces_=function(){return[bs]};Fu.prototype.getClass=function(){return Fu};var Rn=function(e,t,n){this.p0=e||null,this.p1=t||null,this.p2=n||null};Rn.prototype.area=function(){return Rn.area(this.p0,this.p1,this.p2)};Rn.prototype.signedArea=function(){return Rn.signedArea(this.p0,this.p1,this.p2)};Rn.prototype.interpolateZ=function(e){if(e===null)throw new _i("Supplied point is null.");return Rn.interpolateZ(e,this.p0,this.p1,this.p2)};Rn.prototype.longestSideLength=function(){return Rn.longestSideLength(this.p0,this.p1,this.p2)};Rn.prototype.isAcute=function(){return Rn.isAcute(this.p0,this.p1,this.p2)};Rn.prototype.circumcentre=function(){return Rn.circumcentre(this.p0,this.p1,this.p2)};Rn.prototype.area3D=function(){return Rn.area3D(this.p0,this.p1,this.p2)};Rn.prototype.centroid=function(){return Rn.centroid(this.p0,this.p1,this.p2)};Rn.prototype.inCentre=function(){return Rn.inCentre(this.p0,this.p1,this.p2)};Rn.prototype.interfaces_=function(){return[]};Rn.prototype.getClass=function(){return Rn};Rn.area=function(e,t,n){return Math.abs(((n.x-e.x)*(t.y-e.y)-(t.x-e.x)*(n.y-e.y))/2)};Rn.signedArea=function(e,t,n){return((n.x-e.x)*(t.y-e.y)-(t.x-e.x)*(n.y-e.y))/2};Rn.det=function(e,t,n,i){return e*i-t*n};Rn.interpolateZ=function(e,t,n,i){var r=t.x,l=t.y,f=n.x-r,a=i.x-r,_=n.y-l,x=i.y-l,S=f*x-a*_,L=e.x-r,A=e.y-l,P=(x*L-a*A)/S,O=(-_*L+f*A)/S,B=t.z+P*(n.z-t.z)+O*(i.z-t.z);return B};Rn.longestSideLength=function(e,t,n){var i=e.distance(t),r=t.distance(n),l=n.distance(e),f=i;return r>f&&(f=r),l>f&&(f=l),f};Rn.isAcute=function(e,t,n){return!(!En.isAcute(e,t,n)||!En.isAcute(t,n,e)||!En.isAcute(n,e,t))};Rn.circumcentre=function(e,t,n){var i=n.x,r=n.y,l=e.x-i,f=e.y-r,a=t.x-i,_=t.y-r,x=2*Rn.det(l,f,a,_),S=Rn.det(f,l*l+f*f,_,a*a+_*_),L=Rn.det(l,l*l+f*f,a,a*a+_*_),A=i-S/x,P=r+L/x;return new Dt(A,P)};Rn.perpendicularBisector=function(e,t){var n=t.x-e.x,i=t.y-e.y,r=new ks(e.x+n/2,e.y+i/2,1),l=new ks(e.x-i+n/2,e.y+n+i/2,1);return new ks(r,l)};Rn.angleBisector=function(e,t,n){var i=t.distance(e),r=t.distance(n),l=i/(i+r),f=n.x-e.x,a=n.y-e.y,_=new Dt(e.x+l*f,e.y+l*a);return _};Rn.area3D=function(e,t,n){var i=t.x-e.x,r=t.y-e.y,l=t.z-e.z,f=n.x-e.x,a=n.y-e.y,_=n.z-e.z,x=r*_-l*a,S=l*f-i*_,L=i*a-r*f,A=x*x+S*S+L*L,P=Math.sqrt(A)/2;return P};Rn.centroid=function(e,t,n){var i=(e.x+t.x+n.x)/3,r=(e.y+t.y+n.y)/3;return new Dt(i,r)};Rn.inCentre=function(e,t,n){var i=t.distance(n),r=e.distance(n),l=e.distance(t),f=i+r+l,a=(i*e.x+r*t.x+l*n.x)/f,_=(i*e.y+r*t.y+l*n.y)/f;return new Dt(a,_)};var vs=function(){this._inputGeom=null,this._distance=null,this._curveBuilder=null,this._curveList=new fe;var e=arguments[0],t=arguments[1],n=arguments[2];this._inputGeom=e,this._distance=t,this._curveBuilder=n};vs.prototype.addPoint=function(e){if(this._distance<=0)return null;var t=e.getCoordinates(),n=this._curveBuilder.getLineCurve(t,this._distance);this.addCurve(n,zt.EXTERIOR,zt.INTERIOR)};vs.prototype.addPolygon=function(e){var t=this,n=this._distance,i=oe.LEFT;this._distance<0&&(n=-this._distance,i=oe.RIGHT);var r=e.getExteriorRing(),l=gn.removeRepeatedPoints(r.getCoordinates());if(this._distance<0&&this.isErodedCompletely(r,this._distance)||this._distance<=0&&l.length<3)return null;this.addPolygonRing(l,n,i,zt.EXTERIOR,zt.INTERIOR);for(var f=0;f<e.getNumInteriorRing();f++){var a=e.getInteriorRingN(f),_=gn.removeRepeatedPoints(a.getCoordinates());t._distance>0&&t.isErodedCompletely(a,-t._distance)||t.addPolygonRing(_,n,oe.opposite(i),zt.INTERIOR,zt.EXTERIOR)}};vs.prototype.isTriangleErodedCompletely=function(e,t){var n=new Rn(e[0],e[1],e[2]),i=n.inCentre(),r=be.distancePointLine(i,n.p0,n.p1);return r<Math.abs(t)};vs.prototype.addLineString=function(e){if(this._distance<=0&&!this._curveBuilder.getBufferParameters().isSingleSided())return null;var t=gn.removeRepeatedPoints(e.getCoordinates()),n=this._curveBuilder.getLineCurve(t,this._distance);this.addCurve(n,zt.EXTERIOR,zt.INTERIOR)};vs.prototype.addCurve=function(e,t,n){if(e===null||e.length<2)return null;var i=new Bi(e,new Un(0,zt.BOUNDARY,t,n));this._curveList.add(i)};vs.prototype.getCurves=function(){return this.add(this._inputGeom),this._curveList};vs.prototype.addPolygonRing=function(e,t,n,i,r){if(t===0&&e.length<Va.MINIMUM_VALID_SIZE)return null;var l=i,f=r;e.length>=Va.MINIMUM_VALID_SIZE&&be.isCCW(e)&&(l=r,f=i,n=oe.opposite(n));var a=this._curveBuilder.getRingCurve(e,n,t);this.addCurve(a,l,f)};vs.prototype.add=function(e){if(e.isEmpty())return null;e instanceof er?this.addPolygon(e):e instanceof Pi?this.addLineString(e):e instanceof Mo?this.addPoint(e):e instanceof jh?this.addCollection(e):e instanceof Ou?this.addCollection(e):e instanceof za?this.addCollection(e):e instanceof eo&&this.addCollection(e)};vs.prototype.isErodedCompletely=function(e,t){var n=e.getCoordinates();if(n.length<4)return t<0;if(n.length===4)return this.isTriangleErodedCompletely(n,t);var i=e.getEnvelopeInternal(),r=Math.min(i.getHeight(),i.getWidth());return t<0&&2*Math.abs(t)>r};vs.prototype.addCollection=function(e){for(var t=this,n=0;n<e.getNumGeometries();n++){var i=e.getGeometryN(n);t.add(i)}};vs.prototype.interfaces_=function(){return[]};vs.prototype.getClass=function(){return vs};var Wh=function(){};Wh.prototype.locate=function(e){};Wh.prototype.interfaces_=function(){return[]};Wh.prototype.getClass=function(){return Wh};var Fa=function(){this._parent=null,this._atStart=null,this._max=null,this._index=null,this._subcollectionIterator=null;var e=arguments[0];this._parent=e,this._atStart=!0,this._index=0,this._max=e.getNumGeometries()};Fa.prototype.next=function(){if(this._atStart)return this._atStart=!1,Fa.isAtomic(this._parent)&&this._index++,this._parent;if(this._subcollectionIterator!==null){if(this._subcollectionIterator.hasNext())return this._subcollectionIterator.next();this._subcollectionIterator=null}if(this._index>=this._max)throw new cf;var e=this._parent.getGeometryN(this._index++);return e instanceof eo?(this._subcollectionIterator=new Fa(e),this._subcollectionIterator.next()):e};Fa.prototype.remove=function(){throw new Error(this.getClass().getName())};Fa.prototype.hasNext=function(){if(this._atStart)return!0;if(this._subcollectionIterator!==null){if(this._subcollectionIterator.hasNext())return!0;this._subcollectionIterator=null}return!(this._index>=this._max)};Fa.prototype.interfaces_=function(){return[uf]};Fa.prototype.getClass=function(){return Fa};Fa.isAtomic=function(e){return!(e instanceof eo)};var $o=function(){this._geom=null;var e=arguments[0];this._geom=e};$o.prototype.locate=function(e){return $o.locate(e,this._geom)};$o.prototype.interfaces_=function(){return[Wh]};$o.prototype.getClass=function(){return $o};$o.isPointInRing=function(e,t){return t.getEnvelopeInternal().intersects(e)?be.isPointInRing(e,t.getCoordinates()):!1};$o.containsPointInPolygon=function(e,t){if(t.isEmpty())return!1;var n=t.getExteriorRing();if(!$o.isPointInRing(e,n))return!1;for(var i=0;i<t.getNumInteriorRing();i++){var r=t.getInteriorRingN(i);if($o.isPointInRing(e,r))return!1}return!0};$o.containsPoint=function(e,t){if(t instanceof er)return $o.containsPointInPolygon(e,t);if(t instanceof eo)for(var n=new Fa(t);n.hasNext();){var i=n.next();if(i!==t&&$o.containsPoint(e,i))return!0}return!1};$o.locate=function(e,t){return t.isEmpty()?zt.EXTERIOR:$o.containsPoint(e,t)?zt.INTERIOR:zt.EXTERIOR};var jr=function(){this._edgeMap=new Ur,this._edgeList=null,this._ptInAreaLocation=[zt.NONE,zt.NONE]};jr.prototype.getNextCW=function(e){this.getEdges();var t=this._edgeList.indexOf(e),n=t-1;return t===0&&(n=this._edgeList.size()-1),this._edgeList.get(n)};jr.prototype.propagateSideLabels=function(e){for(var t=zt.NONE,n=this.iterator();n.hasNext();){var i=n.next(),r=i.getLabel();r.isArea(e)&&r.getLocation(e,oe.LEFT)!==zt.NONE&&(t=r.getLocation(e,oe.LEFT))}if(t===zt.NONE)return null;for(var l=t,f=this.iterator();f.hasNext();){var a=f.next(),_=a.getLabel();if(_.getLocation(e,oe.ON)===zt.NONE&&_.setLocation(e,oe.ON,l),_.isArea(e)){var x=_.getLocation(e,oe.LEFT),S=_.getLocation(e,oe.RIGHT);if(S!==zt.NONE){if(S!==l)throw new gl("side location conflict",a.getCoordinate());x===zt.NONE&&an.shouldNeverReachHere("found single null side (at "+a.getCoordinate()+")"),l=x}else an.isTrue(_.getLocation(e,oe.LEFT)===zt.NONE,"found single null side"),_.setLocation(e,oe.RIGHT,l),_.setLocation(e,oe.LEFT,l)}}};jr.prototype.getCoordinate=function(){var e=this.iterator();if(!e.hasNext())return null;var t=e.next();return t.getCoordinate()};jr.prototype.print=function(e){Lr.out.println("EdgeEndStar:   "+this.getCoordinate());for(var t=this.iterator();t.hasNext();){var n=t.next();n.print(e)}};jr.prototype.isAreaLabelsConsistent=function(e){return this.computeEdgeEndLabels(e.getBoundaryNodeRule()),this.checkAreaLabelsConsistent(0)};jr.prototype.checkAreaLabelsConsistent=function(e){var t=this.getEdges();if(t.size()<=0)return!0;var n=t.size()-1,i=t.get(n).getLabel(),r=i.getLocation(e,oe.LEFT);an.isTrue(r!==zt.NONE,"Found unlabelled area edge");for(var l=r,f=this.iterator();f.hasNext();){var a=f.next(),_=a.getLabel();an.isTrue(_.isArea(e),"Found non-area edge");var x=_.getLocation(e,oe.LEFT),S=_.getLocation(e,oe.RIGHT);if(x===S||S!==l)return!1;l=x}return!0};jr.prototype.findIndex=function(e){var t=this;this.iterator();for(var n=0;n<this._edgeList.size();n++){var i=t._edgeList.get(n);if(i===e)return n}return-1};jr.prototype.iterator=function(){return this.getEdges().iterator()};jr.prototype.getEdges=function(){return this._edgeList===null&&(this._edgeList=new fe(this._edgeMap.values())),this._edgeList};jr.prototype.getLocation=function(e,t,n){return this._ptInAreaLocation[e]===zt.NONE&&(this._ptInAreaLocation[e]=$o.locate(t,n[e].getGeometry())),this._ptInAreaLocation[e]};jr.prototype.toString=function(){var e=new xa;e.append("EdgeEndStar:   "+this.getCoordinate()),e.append(`
`);for(var t=this.iterator();t.hasNext();){var n=t.next();e.append(n),e.append(`
`)}return e.toString()};jr.prototype.computeEdgeEndLabels=function(e){for(var t=this.iterator();t.hasNext();){var n=t.next();n.computeLabel(e)}};jr.prototype.computeLabelling=function(e){var t=this;this.computeEdgeEndLabels(e[0].getBoundaryNodeRule()),this.propagateSideLabels(0),this.propagateSideLabels(1);for(var n=[!1,!1],i=this.iterator();i.hasNext();)for(var r=i.next(),l=r.getLabel(),f=0;f<2;f++)l.isLine(f)&&l.getLocation(f)===zt.BOUNDARY&&(n[f]=!0);for(var a=this.iterator();a.hasNext();)for(var _=a.next(),x=_.getLabel(),S=0;S<2;S++)if(x.isAnyNull(S)){var L=zt.NONE;if(n[S])L=zt.EXTERIOR;else{var A=_.getCoordinate();L=t.getLocation(S,A,e)}x.setAllLocationsIfNull(S,L)}};jr.prototype.getDegree=function(){return this._edgeMap.size()};jr.prototype.insertEdgeEnd=function(e,t){this._edgeMap.put(e,t),this._edgeList=null};jr.prototype.interfaces_=function(){return[]};jr.prototype.getClass=function(){return jr};var DC=function(e){function t(){e.call(this),this._resultAreaEdgeList=null,this._label=null,this._SCANNING_FOR_INCOMING=1,this._LINKING_TO_OUTGOING=2}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.linkResultDirectedEdges=function(){var n=this;this.getResultAreaEdges();for(var i=null,r=null,l=this._SCANNING_FOR_INCOMING,f=0;f<this._resultAreaEdgeList.size();f++){var a=n._resultAreaEdgeList.get(f),_=a.getSym();if(a.getLabel().isArea())switch(i===null&&a.isInResult()&&(i=a),l){case n._SCANNING_FOR_INCOMING:if(!_.isInResult())continue;r=_,l=n._LINKING_TO_OUTGOING;break;case n._LINKING_TO_OUTGOING:if(!a.isInResult())continue;r.setNext(a),l=n._SCANNING_FOR_INCOMING;break}}if(l===this._LINKING_TO_OUTGOING){if(i===null)throw new gl("no outgoing dirEdge found",this.getCoordinate());an.isTrue(i.isInResult(),"unable to link last incoming dirEdge"),r.setNext(i)}},t.prototype.insert=function(n){var i=n;this.insertEdgeEnd(i,i)},t.prototype.getRightmostEdge=function(){var n=this.getEdges(),i=n.size();if(i<1)return null;var r=n.get(0);if(i===1)return r;var l=n.get(i-1),f=r.getQuadrant(),a=l.getQuadrant();return $n.isNorthern(f)&&$n.isNorthern(a)?r:!$n.isNorthern(f)&&!$n.isNorthern(a)?l:r.getDy()!==0?r:l.getDy()!==0?l:(an.shouldNeverReachHere("found two horizontal edges incident on node"),null)},t.prototype.print=function(n){Lr.out.println("DirectedEdgeStar: "+this.getCoordinate());for(var i=this.iterator();i.hasNext();){var r=i.next();n.print("out "),r.print(n),n.println(),n.print("in "),r.getSym().print(n),n.println()}},t.prototype.getResultAreaEdges=function(){var n=this;if(this._resultAreaEdgeList!==null)return this._resultAreaEdgeList;this._resultAreaEdgeList=new fe;for(var i=this.iterator();i.hasNext();){var r=i.next();(r.isInResult()||r.getSym().isInResult())&&n._resultAreaEdgeList.add(r)}return this._resultAreaEdgeList},t.prototype.updateLabelling=function(n){for(var i=this.iterator();i.hasNext();){var r=i.next(),l=r.getLabel();l.setAllLocationsIfNull(0,n.getLocation(0)),l.setAllLocationsIfNull(1,n.getLocation(1))}},t.prototype.linkAllDirectedEdges=function(){var n=this;this.getEdges();for(var i=null,r=null,l=this._edgeList.size()-1;l>=0;l--){var f=n._edgeList.get(l),a=f.getSym();r===null&&(r=a),i!==null&&a.setNext(i),i=f}r.setNext(i)},t.prototype.computeDepths=function(){var n=this;if(arguments.length===1){var i=arguments[0],r=this.findIndex(i),l=i.getDepth(oe.LEFT),f=i.getDepth(oe.RIGHT),a=this.computeDepths(r+1,this._edgeList.size(),l),_=this.computeDepths(0,r,a);if(_!==f)throw new gl("depth mismatch at "+i.getCoordinate())}else if(arguments.length===3){for(var x=arguments[0],S=arguments[1],L=arguments[2],A=L,P=x;P<S;P++){var O=n._edgeList.get(P);O.setEdgeDepths(oe.RIGHT,A),A=O.getDepth(oe.LEFT)}return A}},t.prototype.mergeSymLabels=function(){for(var n=this.iterator();n.hasNext();){var i=n.next(),r=i.getLabel();r.merge(i.getSym().getLabel())}},t.prototype.linkMinimalDirectedEdges=function(n){for(var i=this,r=null,l=null,f=this._SCANNING_FOR_INCOMING,a=this._resultAreaEdgeList.size()-1;a>=0;a--){var _=i._resultAreaEdgeList.get(a),x=_.getSym();switch(r===null&&_.getEdgeRing()===n&&(r=_),f){case i._SCANNING_FOR_INCOMING:if(x.getEdgeRing()!==n)continue;l=x,f=i._LINKING_TO_OUTGOING;break;case i._LINKING_TO_OUTGOING:if(_.getEdgeRing()!==n)continue;l.setNextMin(_),f=i._SCANNING_FOR_INCOMING;break}}f===this._LINKING_TO_OUTGOING&&(an.isTrue(r!==null,"found null for first outgoing dirEdge"),an.isTrue(r.getEdgeRing()===n,"unable to link last incoming dirEdge"),l.setNextMin(r))},t.prototype.getOutgoingDegree=function(){if(arguments.length===0){for(var n=0,i=this.iterator();i.hasNext();){var r=i.next();r.isInResult()&&n++}return n}else if(arguments.length===1){for(var l=arguments[0],f=0,a=this.iterator();a.hasNext();){var _=a.next();_.getEdgeRing()===l&&f++}return f}},t.prototype.getLabel=function(){return this._label},t.prototype.findCoveredLineEdges=function(){for(var n=zt.NONE,i=this.iterator();i.hasNext();){var r=i.next(),l=r.getSym();if(!r.isLineEdge()){if(r.isInResult()){n=zt.INTERIOR;break}if(l.isInResult()){n=zt.EXTERIOR;break}}}if(n===zt.NONE)return null;for(var f=n,a=this.iterator();a.hasNext();){var _=a.next(),x=_.getSym();_.isLineEdge()?_.getEdge().setCovered(f===zt.INTERIOR):(_.isInResult()&&(f=zt.EXTERIOR),x.isInResult()&&(f=zt.INTERIOR))}},t.prototype.computeLabelling=function(n){var i=this;e.prototype.computeLabelling.call(this,n),this._label=new Un(zt.NONE);for(var r=this.iterator();r.hasNext();)for(var l=r.next(),f=l.getEdge(),a=f.getLabel(),_=0;_<2;_++){var x=a.getLocation(_);(x===zt.INTERIOR||x===zt.BOUNDARY)&&i._label.setLocation(_,zt.INTERIOR)}},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(jr),Ox=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.createNode=function(n){return new Pg(n,new DC)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(qh),Jl=function e(){this._pts=null,this._orientation=null;var t=arguments[0];this._pts=t,this._orientation=e.orientation(t)};Jl.prototype.compareTo=function(e){var t=e,n=Jl.compareOriented(this._pts,this._orientation,t._pts,t._orientation);return n};Jl.prototype.interfaces_=function(){return[bs]};Jl.prototype.getClass=function(){return Jl};Jl.orientation=function(e){return gn.increasingDirection(e)===1};Jl.compareOriented=function(e,t,n,i){for(var r=t?1:-1,l=i?1:-1,f=t?e.length:-1,a=i?n.length:-1,_=t?0:e.length-1,x=i?0:n.length-1;;){var S=e[_].compareTo(n[x]);if(S!==0)return S;_+=r,x+=l;var L=_===f,A=x===a;if(L&&!A)return-1;if(!L&&A)return 1;if(L&&A)return 0}};var zs=function(){this._edges=new fe,this._ocaMap=new Ur};zs.prototype.print=function(e){var t=this;e.print("MULTILINESTRING ( ");for(var n=0;n<this._edges.size();n++){var i=t._edges.get(n);n>0&&e.print(","),e.print("(");for(var r=i.getCoordinates(),l=0;l<r.length;l++)l>0&&e.print(","),e.print(r[l].x+" "+r[l].y);e.println(")")}e.print(")  ")};zs.prototype.addAll=function(e){for(var t=this,n=e.iterator();n.hasNext();)t.add(n.next())};zs.prototype.findEdgeIndex=function(e){for(var t=this,n=0;n<this._edges.size();n++)if(t._edges.get(n).equals(e))return n;return-1};zs.prototype.iterator=function(){return this._edges.iterator()};zs.prototype.getEdges=function(){return this._edges};zs.prototype.get=function(e){return this._edges.get(e)};zs.prototype.findEqualEdge=function(e){var t=new Jl(e.getCoordinates()),n=this._ocaMap.get(t);return n};zs.prototype.add=function(e){this._edges.add(e);var t=new Jl(e.getCoordinates());this._ocaMap.put(t,e)};zs.prototype.interfaces_=function(){return[]};zs.prototype.getClass=function(){return zs};var Bu=function(){};Bu.prototype.processIntersections=function(e,t,n,i){};Bu.prototype.isDone=function(){};Bu.prototype.interfaces_=function(){return[]};Bu.prototype.getClass=function(){return Bu};var Jo=function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._hasInterior=!1,this._properIntersectionPoint=null,this._li=null,this._isSelfIntersection=null,this.numIntersections=0,this.numInteriorIntersections=0,this.numProperIntersections=0,this.numTests=0;var e=arguments[0];this._li=e};Jo.prototype.isTrivialIntersection=function(e,t,n,i){if(e===n&&this._li.getIntersectionNum()===1){if(Jo.isAdjacentSegments(t,i))return!0;if(e.isClosed()){var r=e.size()-1;if(t===0&&i===r||i===0&&t===r)return!0}}return!1};Jo.prototype.getProperIntersectionPoint=function(){return this._properIntersectionPoint};Jo.prototype.hasProperInteriorIntersection=function(){return this._hasProperInterior};Jo.prototype.getLineIntersector=function(){return this._li};Jo.prototype.hasProperIntersection=function(){return this._hasProper};Jo.prototype.processIntersections=function(e,t,n,i){if(e===n&&t===i)return null;this.numTests++;var r=e.getCoordinates()[t],l=e.getCoordinates()[t+1],f=n.getCoordinates()[i],a=n.getCoordinates()[i+1];this._li.computeIntersection(r,l,f,a),this._li.hasIntersection()&&(this.numIntersections++,this._li.isInteriorIntersection()&&(this.numInteriorIntersections++,this._hasInterior=!0),this.isTrivialIntersection(e,t,n,i)||(this._hasIntersection=!0,e.addIntersections(this._li,t,0),n.addIntersections(this._li,i,1),this._li.isProper()&&(this.numProperIntersections++,this._hasProper=!0,this._hasProperInterior=!0)))};Jo.prototype.hasIntersection=function(){return this._hasIntersection};Jo.prototype.isDone=function(){return!1};Jo.prototype.hasInteriorIntersection=function(){return this._hasInterior};Jo.prototype.interfaces_=function(){return[Bu]};Jo.prototype.getClass=function(){return Jo};Jo.isAdjacentSegments=function(e,t){return Math.abs(e-t)===1};var ma=function(){this.coord=null,this.segmentIndex=null,this.dist=null;var e=arguments[0],t=arguments[1],n=arguments[2];this.coord=new Dt(e),this.segmentIndex=t,this.dist=n};ma.prototype.getSegmentIndex=function(){return this.segmentIndex};ma.prototype.getCoordinate=function(){return this.coord};ma.prototype.print=function(e){e.print(this.coord),e.print(" seg # = "+this.segmentIndex),e.println(" dist = "+this.dist)};ma.prototype.compareTo=function(e){var t=e;return this.compare(t.segmentIndex,t.dist)};ma.prototype.isEndPoint=function(e){return this.segmentIndex===0&&this.dist===0||this.segmentIndex===e};ma.prototype.toString=function(){return this.coord+" seg # = "+this.segmentIndex+" dist = "+this.dist};ma.prototype.getDistance=function(){return this.dist};ma.prototype.compare=function(e,t){return this.segmentIndex<e?-1:this.segmentIndex>e?1:this.dist<t?-1:this.dist>t?1:0};ma.prototype.interfaces_=function(){return[bs]};ma.prototype.getClass=function(){return ma};var ja=function(){this._nodeMap=new Ur,this.edge=null;var e=arguments[0];this.edge=e};ja.prototype.print=function(e){e.println("Intersections:");for(var t=this.iterator();t.hasNext();){var n=t.next();n.print(e)}};ja.prototype.iterator=function(){return this._nodeMap.values().iterator()};ja.prototype.addSplitEdges=function(e){var t=this;this.addEndpoints();for(var n=this.iterator(),i=n.next();n.hasNext();){var r=n.next(),l=t.createSplitEdge(i,r);e.add(l),i=r}};ja.prototype.addEndpoints=function(){var e=this.edge.pts.length-1;this.add(this.edge.pts[0],0,0),this.add(this.edge.pts[e],e,0)};ja.prototype.createSplitEdge=function(e,t){var n=this,i=t.segmentIndex-e.segmentIndex+2,r=this.edge.pts[t.segmentIndex],l=t.dist>0||!t.coord.equals2D(r);l||i--;var f=new Array(i).fill(null),a=0;f[a++]=new Dt(e.coord);for(var _=e.segmentIndex+1;_<=t.segmentIndex;_++)f[a++]=n.edge.pts[_];return l&&(f[a]=t.coord),new ig(f,new Un(this.edge._label))};ja.prototype.add=function(e,t,n){var i=new ma(e,t,n),r=this._nodeMap.get(i);return r!==null?r:(this._nodeMap.put(i,i),i)};ja.prototype.isIntersection=function(e){for(var t=this.iterator();t.hasNext();){var n=t.next();if(n.coord.equals(e))return!0}return!1};ja.prototype.interfaces_=function(){return[]};ja.prototype.getClass=function(){return ja};var Vu=function(){};Vu.prototype.getChainStartIndices=function(e){var t=this,n=0,i=new fe;i.add(new ua(n));do{var r=t.findChainEnd(e,n);i.add(new ua(r)),n=r}while(n<e.length-1);var l=Vu.toIntArray(i);return l};Vu.prototype.findChainEnd=function(e,t){for(var n=$n.quadrant(e[t],e[t+1]),i=t+1;i<e.length;){var r=$n.quadrant(e[i-1],e[i]);if(r!==n)break;i++}return i-1};Vu.prototype.interfaces_=function(){return[]};Vu.prototype.getClass=function(){return Vu};Vu.toIntArray=function(e){for(var t=new Array(e.size()).fill(null),n=0;n<t.length;n++)t[n]=e.get(n).intValue();return t};var yl=function(){this.e=null,this.pts=null,this.startIndex=null,this.env1=new Oe,this.env2=new Oe;var e=arguments[0];this.e=e,this.pts=e.getCoordinates();var t=new Vu;this.startIndex=t.getChainStartIndices(this.pts)};yl.prototype.getCoordinates=function(){return this.pts};yl.prototype.getMaxX=function(e){var t=this.pts[this.startIndex[e]].x,n=this.pts[this.startIndex[e+1]].x;return t>n?t:n};yl.prototype.getMinX=function(e){var t=this.pts[this.startIndex[e]].x,n=this.pts[this.startIndex[e+1]].x;return t<n?t:n};yl.prototype.computeIntersectsForChain=function(){if(arguments.length===4){var e=arguments[0],t=arguments[1],n=arguments[2],i=arguments[3];this.computeIntersectsForChain(this.startIndex[e],this.startIndex[e+1],t,t.startIndex[n],t.startIndex[n+1],i)}else if(arguments.length===6){var r=arguments[0],l=arguments[1],f=arguments[2],a=arguments[3],_=arguments[4],x=arguments[5],S=this.pts[r],L=this.pts[l],A=f.pts[a],P=f.pts[_];if(l-r===1&&_-a===1)return x.addIntersections(this.e,r,f.e,a),null;if(this.env1.init(S,L),this.env2.init(A,P),!this.env1.intersects(this.env2))return null;var O=Math.trunc((r+l)/2),B=Math.trunc((a+_)/2);r<O&&(a<B&&this.computeIntersectsForChain(r,O,f,a,B,x),B<_&&this.computeIntersectsForChain(r,O,f,B,_,x)),O<l&&(a<B&&this.computeIntersectsForChain(O,l,f,a,B,x),B<_&&this.computeIntersectsForChain(O,l,f,B,_,x))}};yl.prototype.getStartIndexes=function(){return this.startIndex};yl.prototype.computeIntersects=function(e,t){for(var n=this,i=0;i<this.startIndex.length-1;i++)for(var r=0;r<e.startIndex.length-1;r++)n.computeIntersectsForChain(i,e,r,t)};yl.prototype.interfaces_=function(){return[]};yl.prototype.getClass=function(){return yl};var Cr=function e(){var t=this;this._depth=Array(2).fill().map(function(){return Array(3)});for(var n=0;n<2;n++)for(var i=0;i<3;i++)t._depth[n][i]=e.NULL_VALUE},zx={NULL_VALUE:{configurable:!0}};Cr.prototype.getDepth=function(e,t){return this._depth[e][t]};Cr.prototype.setDepth=function(e,t,n){this._depth[e][t]=n};Cr.prototype.isNull=function(){var e=this;if(arguments.length===0){for(var t=0;t<2;t++)for(var n=0;n<3;n++)if(e._depth[t][n]!==Cr.NULL_VALUE)return!1;return!0}else if(arguments.length===1){var i=arguments[0];return this._depth[i][1]===Cr.NULL_VALUE}else if(arguments.length===2){var r=arguments[0],l=arguments[1];return this._depth[r][l]===Cr.NULL_VALUE}};Cr.prototype.normalize=function(){for(var e=this,t=0;t<2;t++)if(!e.isNull(t)){var n=e._depth[t][1];e._depth[t][2]<n&&(n=e._depth[t][2]),n<0&&(n=0);for(var i=1;i<3;i++){var r=0;e._depth[t][i]>n&&(r=1),e._depth[t][i]=r}}};Cr.prototype.getDelta=function(e){return this._depth[e][oe.RIGHT]-this._depth[e][oe.LEFT]};Cr.prototype.getLocation=function(e,t){return this._depth[e][t]<=0?zt.EXTERIOR:zt.INTERIOR};Cr.prototype.toString=function(){return"A: "+this._depth[0][1]+","+this._depth[0][2]+" B: "+this._depth[1][1]+","+this._depth[1][2]};Cr.prototype.add=function(){var e=this;if(arguments.length===1)for(var t=arguments[0],n=0;n<2;n++)for(var i=1;i<3;i++){var r=t.getLocation(n,i);(r===zt.EXTERIOR||r===zt.INTERIOR)&&(e.isNull(n,i)?e._depth[n][i]=Cr.depthAtLocation(r):e._depth[n][i]+=Cr.depthAtLocation(r))}else if(arguments.length===3){var l=arguments[0],f=arguments[1],a=arguments[2];a===zt.INTERIOR&&this._depth[l][f]++}};Cr.prototype.interfaces_=function(){return[]};Cr.prototype.getClass=function(){return Cr};Cr.depthAtLocation=function(e){return e===zt.EXTERIOR?0:e===zt.INTERIOR?1:Cr.NULL_VALUE};zx.NULL_VALUE.get=function(){return-1};Object.defineProperties(Cr,zx);var ig=function(e){function t(){if(e.call(this),this.pts=null,this._env=null,this.eiList=new ja(this),this._name=null,this._mce=null,this._isIsolated=!0,this._depth=new Cr,this._depthDelta=0,arguments.length===1){var n=arguments[0];t.call(this,n,null)}else if(arguments.length===2){var i=arguments[0],r=arguments[1];this.pts=i,this._label=r}}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.getDepth=function(){return this._depth},t.prototype.getCollapsedEdge=function(){var n=new Array(2).fill(null);n[0]=this.pts[0],n[1]=this.pts[1];var i=new t(n,Un.toLineLabel(this._label));return i},t.prototype.isIsolated=function(){return this._isIsolated},t.prototype.getCoordinates=function(){return this.pts},t.prototype.setIsolated=function(n){this._isIsolated=n},t.prototype.setName=function(n){this._name=n},t.prototype.equals=function(n){var i=this;if(!(n instanceof t))return!1;var r=n;if(this.pts.length!==r.pts.length)return!1;for(var l=!0,f=!0,a=this.pts.length,_=0;_<this.pts.length;_++)if(i.pts[_].equals2D(r.pts[_])||(l=!1),i.pts[_].equals2D(r.pts[--a])||(f=!1),!l&&!f)return!1;return!0},t.prototype.getCoordinate=function(){if(arguments.length===0)return this.pts.length>0?this.pts[0]:null;if(arguments.length===1){var n=arguments[0];return this.pts[n]}},t.prototype.print=function(n){var i=this;n.print("edge "+this._name+": "),n.print("LINESTRING (");for(var r=0;r<this.pts.length;r++)r>0&&n.print(","),n.print(i.pts[r].x+" "+i.pts[r].y);n.print(")  "+this._label+" "+this._depthDelta)},t.prototype.computeIM=function(n){t.updateIM(this._label,n)},t.prototype.isCollapsed=function(){return!this._label.isArea()||this.pts.length!==3?!1:!!this.pts[0].equals(this.pts[2])},t.prototype.isClosed=function(){return this.pts[0].equals(this.pts[this.pts.length-1])},t.prototype.getMaximumSegmentIndex=function(){return this.pts.length-1},t.prototype.getDepthDelta=function(){return this._depthDelta},t.prototype.getNumPoints=function(){return this.pts.length},t.prototype.printReverse=function(n){var i=this;n.print("edge "+this._name+": ");for(var r=this.pts.length-1;r>=0;r--)n.print(i.pts[r]+" ");n.println("")},t.prototype.getMonotoneChainEdge=function(){return this._mce===null&&(this._mce=new yl(this)),this._mce},t.prototype.getEnvelope=function(){var n=this;if(this._env===null){this._env=new Oe;for(var i=0;i<this.pts.length;i++)n._env.expandToInclude(n.pts[i])}return this._env},t.prototype.addIntersection=function(n,i,r,l){var f=new Dt(n.getIntersection(l)),a=i,_=n.getEdgeDistance(r,l),x=a+1;if(x<this.pts.length){var S=this.pts[x];f.equals2D(S)&&(a=x,_=0)}this.eiList.add(f,a,_)},t.prototype.toString=function(){var n=this,i=new xa;i.append("edge "+this._name+": "),i.append("LINESTRING (");for(var r=0;r<this.pts.length;r++)r>0&&i.append(","),i.append(n.pts[r].x+" "+n.pts[r].y);return i.append(")  "+this._label+" "+this._depthDelta),i.toString()},t.prototype.isPointwiseEqual=function(n){var i=this;if(this.pts.length!==n.pts.length)return!1;for(var r=0;r<this.pts.length;r++)if(!i.pts[r].equals2D(n.pts[r]))return!1;return!0},t.prototype.setDepthDelta=function(n){this._depthDelta=n},t.prototype.getEdgeIntersectionList=function(){return this.eiList},t.prototype.addIntersections=function(n,i,r){for(var l=this,f=0;f<n.getIntersectionNum();f++)l.addIntersection(n,i,r,f)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t.updateIM=function(){if(arguments.length===2){var n=arguments[0],i=arguments[1];i.setAtLeastIfValid(n.getLocation(0,oe.ON),n.getLocation(1,oe.ON),1),n.isArea()&&(i.setAtLeastIfValid(n.getLocation(0,oe.LEFT),n.getLocation(1,oe.LEFT),2),i.setAtLeastIfValid(n.getLocation(0,oe.RIGHT),n.getLocation(1,oe.RIGHT),2))}else return e.prototype.updateIM.apply(this,arguments)},t}(Yo),to=function(e){this._workingPrecisionModel=null,this._workingNoder=null,this._geomFact=null,this._graph=null,this._edgeList=new zs,this._bufParams=e||null};to.prototype.setWorkingPrecisionModel=function(e){this._workingPrecisionModel=e};to.prototype.insertUniqueEdge=function(e){var t=this._edgeList.findEqualEdge(e);if(t!==null){var n=t.getLabel(),i=e.getLabel();t.isPointwiseEqual(e)||(i=new Un(e.getLabel()),i.flip()),n.merge(i);var r=to.depthDelta(i),l=t.getDepthDelta(),f=l+r;t.setDepthDelta(f)}else this._edgeList.add(e),e.setDepthDelta(to.depthDelta(e.getLabel()))};to.prototype.buildSubgraphs=function(e,t){for(var n=new fe,i=e.iterator();i.hasNext();){var r=i.next(),l=r.getRightmostCoordinate(),f=new Ec(n),a=f.getDepth(l);r.computeDepth(a),r.findResultEdges(),n.add(r),t.add(r.getDirectedEdges(),r.getNodes())}};to.prototype.createSubgraphs=function(e){for(var t=new fe,n=e.getNodes().iterator();n.hasNext();){var i=n.next();if(!i.isVisited()){var r=new no;r.create(i),t.add(r)}}return Os.sort(t,Os.reverseOrder()),t};to.prototype.createEmptyResultGeometry=function(){var e=this._geomFact.createPolygon();return e};to.prototype.getNoder=function(e){if(this._workingNoder!==null)return this._workingNoder;var t=new Gy,n=new Zu;return n.setPrecisionModel(e),t.setSegmentIntersector(new Jo(n)),t};to.prototype.buffer=function(e,t){var n=this._workingPrecisionModel;n===null&&(n=e.getPrecisionModel()),this._geomFact=e.getFactory();var i=new mo(n,this._bufParams),r=new vs(e,t,i),l=r.getCurves();if(l.size()<=0)return this.createEmptyResultGeometry();this.computeNodedEdges(l,n),this._graph=new Si(new Ox),this._graph.addEdges(this._edgeList.getEdges());var f=this.createSubgraphs(this._graph),a=new Po(this._geomFact);this.buildSubgraphs(f,a);var _=a.getPolygons();if(_.size()<=0)return this.createEmptyResultGeometry();var x=this._geomFact.buildGeometry(_);return x};to.prototype.computeNodedEdges=function(e,t){var n=this,i=this.getNoder(t);i.computeNodes(e);for(var r=i.getNodedSubstrings(),l=r.iterator();l.hasNext();){var f=l.next(),a=f.getCoordinates();if(!(a.length===2&&a[0].equals2D(a[1]))){var _=f.getData(),x=new ig(f.getCoordinates(),new Un(_));n.insertUniqueEdge(x)}}};to.prototype.setNoder=function(e){this._workingNoder=e};to.prototype.interfaces_=function(){return[]};to.prototype.getClass=function(){return to};to.depthDelta=function(e){var t=e.getLocation(0,oe.LEFT),n=e.getLocation(0,oe.RIGHT);return t===zt.INTERIOR&&n===zt.EXTERIOR?1:t===zt.EXTERIOR&&n===zt.INTERIOR?-1:0};to.convertSegStrings=function(e){for(var t=new mn,n=new fe;e.hasNext();){var i=e.next(),r=t.createLineString(i.getCoordinates());n.add(r)}return t.buildGeometry(n)};var Ql=function(){if(this._noder=null,this._scaleFactor=null,this._offsetX=null,this._offsetY=null,this._isScaled=!1,arguments.length===2){var e=arguments[0],t=arguments[1];this._noder=e,this._scaleFactor=t,this._offsetX=0,this._offsetY=0,this._isScaled=!this.isIntegerPrecision()}else if(arguments.length===4){var n=arguments[0],i=arguments[1],r=arguments[2],l=arguments[3];this._noder=n,this._scaleFactor=i,this._offsetX=r,this._offsetY=l,this._isScaled=!this.isIntegerPrecision()}};Ql.prototype.rescale=function(){var e=this;if(We(arguments[0],Ki))for(var t=arguments[0],n=t.iterator();n.hasNext();){var i=n.next();e.rescale(i.getCoordinates())}else if(arguments[0]instanceof Array){for(var r=arguments[0],l=0;l<r.length;l++)r[l].x=r[l].x/e._scaleFactor+e._offsetX,r[l].y=r[l].y/e._scaleFactor+e._offsetY;r.length===2&&r[0].equals2D(r[1])&&Lr.out.println(r)}};Ql.prototype.scale=function(){var e=this;if(We(arguments[0],Ki)){for(var t=arguments[0],n=new fe,i=t.iterator();i.hasNext();){var r=i.next();n.add(new Bi(e.scale(r.getCoordinates()),r.getData()))}return n}else if(arguments[0]instanceof Array){for(var l=arguments[0],f=new Array(l.length).fill(null),a=0;a<l.length;a++)f[a]=new Dt(Math.round((l[a].x-e._offsetX)*e._scaleFactor),Math.round((l[a].y-e._offsetY)*e._scaleFactor),l[a].z);var _=gn.removeRepeatedPoints(f);return _}};Ql.prototype.isIntegerPrecision=function(){return this._scaleFactor===1};Ql.prototype.getNodedSubstrings=function(){var e=this._noder.getNodedSubstrings();return this._isScaled&&this.rescale(e),e};Ql.prototype.computeNodes=function(e){var t=e;this._isScaled&&(t=this.scale(e)),this._noder.computeNodes(t)};Ql.prototype.interfaces_=function(){return[zu]};Ql.prototype.getClass=function(){return Ql};var ga=function(){this._li=new Zu,this._segStrings=null;var e=arguments[0];this._segStrings=e},Fx={fact:{configurable:!0}};ga.prototype.checkEndPtVertexIntersections=function(){var e=this;if(arguments.length===0)for(var t=this._segStrings.iterator();t.hasNext();){var n=t.next(),i=n.getCoordinates();e.checkEndPtVertexIntersections(i[0],e._segStrings),e.checkEndPtVertexIntersections(i[i.length-1],e._segStrings)}else if(arguments.length===2){for(var r=arguments[0],l=arguments[1],f=l.iterator();f.hasNext();)for(var a=f.next(),_=a.getCoordinates(),x=1;x<_.length-1;x++)if(_[x].equals(r))throw new dl("found endpt/interior pt intersection at index "+x+" :pt "+r)}};ga.prototype.checkInteriorIntersections=function(){var e=this;if(arguments.length===0)for(var t=this._segStrings.iterator();t.hasNext();)for(var n=t.next(),i=this._segStrings.iterator();i.hasNext();){var r=i.next();e.checkInteriorIntersections(n,r)}else if(arguments.length===2)for(var l=arguments[0],f=arguments[1],a=l.getCoordinates(),_=f.getCoordinates(),x=0;x<a.length-1;x++)for(var S=0;S<_.length-1;S++)e.checkInteriorIntersections(l,x,f,S);else if(arguments.length===4){var L=arguments[0],A=arguments[1],P=arguments[2],O=arguments[3];if(L===P&&A===O)return null;var B=L.getCoordinates()[A],U=L.getCoordinates()[A+1],Y=P.getCoordinates()[O],V=P.getCoordinates()[O+1];if(this._li.computeIntersection(B,U,Y,V),this._li.hasIntersection()&&(this._li.isProper()||this.hasInteriorIntersection(this._li,B,U)||this.hasInteriorIntersection(this._li,Y,V)))throw new dl("found non-noded intersection at "+B+"-"+U+" and "+Y+"-"+V)}};ga.prototype.checkValid=function(){this.checkEndPtVertexIntersections(),this.checkInteriorIntersections(),this.checkCollapses()};ga.prototype.checkCollapses=function(){var e=this;if(arguments.length===0)for(var t=this._segStrings.iterator();t.hasNext();){var n=t.next();e.checkCollapses(n)}else if(arguments.length===1)for(var i=arguments[0],r=i.getCoordinates(),l=0;l<r.length-2;l++)e.checkCollapse(r[l],r[l+1],r[l+2])};ga.prototype.hasInteriorIntersection=function(e,t,n){for(var i=0;i<e.getIntersectionNum();i++){var r=e.getIntersection(i);if(!(r.equals(t)||r.equals(n)))return!0}return!1};ga.prototype.checkCollapse=function(e,t,n){if(e.equals(n))throw new dl("found non-noded collapse at "+ga.fact.createLineString([e,t,n]))};ga.prototype.interfaces_=function(){return[]};ga.prototype.getClass=function(){return ga};Fx.fact.get=function(){return new mn};Object.defineProperties(ga,Fx);var go=function(){this._li=null,this._pt=null,this._originalPt=null,this._ptScaled=null,this._p0Scaled=null,this._p1Scaled=null,this._scaleFactor=null,this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,this._corner=new Array(4).fill(null),this._safeEnv=null;var e=arguments[0],t=arguments[1],n=arguments[2];if(this._originalPt=e,this._pt=e,this._scaleFactor=t,this._li=n,t<=0)throw new _i("Scale factor must be non-zero");t!==1&&(this._pt=new Dt(this.scale(e.x),this.scale(e.y)),this._p0Scaled=new Dt,this._p1Scaled=new Dt),this.initCorners(this._pt)},Bx={SAFE_ENV_EXPANSION_FACTOR:{configurable:!0}};go.prototype.intersectsScaled=function(e,t){var n=Math.min(e.x,t.x),i=Math.max(e.x,t.x),r=Math.min(e.y,t.y),l=Math.max(e.y,t.y),f=this._maxx<n||this._minx>i||this._maxy<r||this._miny>l;if(f)return!1;var a=this.intersectsToleranceSquare(e,t);return an.isTrue(!(f&&a),"Found bad envelope test"),a};go.prototype.initCorners=function(e){var t=.5;this._minx=e.x-t,this._maxx=e.x+t,this._miny=e.y-t,this._maxy=e.y+t,this._corner[0]=new Dt(this._maxx,this._maxy),this._corner[1]=new Dt(this._minx,this._maxy),this._corner[2]=new Dt(this._minx,this._miny),this._corner[3]=new Dt(this._maxx,this._miny)};go.prototype.intersects=function(e,t){return this._scaleFactor===1?this.intersectsScaled(e,t):(this.copyScaled(e,this._p0Scaled),this.copyScaled(t,this._p1Scaled),this.intersectsScaled(this._p0Scaled,this._p1Scaled))};go.prototype.scale=function(e){return Math.round(e*this._scaleFactor)};go.prototype.getCoordinate=function(){return this._originalPt};go.prototype.copyScaled=function(e,t){t.x=this.scale(e.x),t.y=this.scale(e.y)};go.prototype.getSafeEnvelope=function(){if(this._safeEnv===null){var e=go.SAFE_ENV_EXPANSION_FACTOR/this._scaleFactor;this._safeEnv=new Oe(this._originalPt.x-e,this._originalPt.x+e,this._originalPt.y-e,this._originalPt.y+e)}return this._safeEnv};go.prototype.intersectsPixelClosure=function(e,t){return this._li.computeIntersection(e,t,this._corner[0],this._corner[1]),!!(this._li.hasIntersection()||(this._li.computeIntersection(e,t,this._corner[1],this._corner[2]),this._li.hasIntersection())||(this._li.computeIntersection(e,t,this._corner[2],this._corner[3]),this._li.hasIntersection())||(this._li.computeIntersection(e,t,this._corner[3],this._corner[0]),this._li.hasIntersection()))};go.prototype.intersectsToleranceSquare=function(e,t){var n=!1,i=!1;return this._li.computeIntersection(e,t,this._corner[0],this._corner[1]),!!(this._li.isProper()||(this._li.computeIntersection(e,t,this._corner[1],this._corner[2]),this._li.isProper())||(this._li.hasIntersection()&&(n=!0),this._li.computeIntersection(e,t,this._corner[2],this._corner[3]),this._li.isProper())||(this._li.hasIntersection()&&(i=!0),this._li.computeIntersection(e,t,this._corner[3],this._corner[0]),this._li.isProper())||n&&i||e.equals(this._pt)||t.equals(this._pt))};go.prototype.addSnappedNode=function(e,t){var n=e.getCoordinate(t),i=e.getCoordinate(t+1);return this.intersects(n,i)?(e.addIntersection(this.getCoordinate(),t),!0):!1};go.prototype.interfaces_=function(){return[]};go.prototype.getClass=function(){return go};Bx.SAFE_ENV_EXPANSION_FACTOR.get=function(){return .75};Object.defineProperties(go,Bx);var id=function(){this.tempEnv1=new Oe,this.selectedSegment=new ze};id.prototype.select=function(){if(arguments.length!==1&&arguments.length===2){var e=arguments[0],t=arguments[1];e.getLineSegment(t,this.selectedSegment),this.select(this.selectedSegment)}};id.prototype.interfaces_=function(){return[]};id.prototype.getClass=function(){return id};var Xh=function(){this._index=null;var e=arguments[0];this._index=e},Vx={HotPixelSnapAction:{configurable:!0}};Xh.prototype.snap=function(){if(arguments.length===1){var e=arguments[0];return this.snap(e,null,-1)}else if(arguments.length===3){var t=arguments[0],n=arguments[1],i=arguments[2],r=t.getSafeEnvelope(),l=new Ux(t,n,i);return this._index.query(r,{interfaces_:function(){return[Yl]},visitItem:function(f){var a=f;a.select(r,l)}}),l.isNodeAdded()}};Xh.prototype.interfaces_=function(){return[]};Xh.prototype.getClass=function(){return Xh};Vx.HotPixelSnapAction.get=function(){return Ux};Object.defineProperties(Xh,Vx);var Ux=function(e){function t(){e.call(this),this._hotPixel=null,this._parentEdge=null,this._hotPixelVertexIndex=null,this._isNodeAdded=!1;var n=arguments[0],i=arguments[1],r=arguments[2];this._hotPixel=n,this._parentEdge=i,this._hotPixelVertexIndex=r}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.isNodeAdded=function(){return this._isNodeAdded},t.prototype.select=function(){if(arguments.length===2){var n=arguments[0],i=arguments[1],r=n.getContext();if(this._parentEdge!==null&&r===this._parentEdge&&i===this._hotPixelVertexIndex)return null;this._isNodeAdded=this._hotPixel.addSnappedNode(r,i)}else return e.prototype.select.apply(this,arguments)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(id),Ic=function(){this._li=null,this._interiorIntersections=null;var e=arguments[0];this._li=e,this._interiorIntersections=new fe};Ic.prototype.processIntersections=function(e,t,n,i){var r=this;if(e===n&&t===i)return null;var l=e.getCoordinates()[t],f=e.getCoordinates()[t+1],a=n.getCoordinates()[i],_=n.getCoordinates()[i+1];if(this._li.computeIntersection(l,f,a,_),this._li.hasIntersection()&&this._li.isInteriorIntersection()){for(var x=0;x<this._li.getIntersectionNum();x++)r._interiorIntersections.add(r._li.getIntersection(x));e.addIntersections(this._li,t,0),n.addIntersections(this._li,i,1)}};Ic.prototype.isDone=function(){return!1};Ic.prototype.getInteriorIntersections=function(){return this._interiorIntersections};Ic.prototype.interfaces_=function(){return[Bu]};Ic.prototype.getClass=function(){return Ic};var qa=function(){this._pm=null,this._li=null,this._scaleFactor=null,this._noder=null,this._pointSnapper=null,this._nodedSegStrings=null;var e=arguments[0];this._pm=e,this._li=new Zu,this._li.setPrecisionModel(e),this._scaleFactor=e.getScale()};qa.prototype.checkCorrectness=function(e){var t=Bi.getNodedSubstrings(e),n=new ga(t);try{n.checkValid()}catch(i){if(i instanceof Ex)i.printStackTrace();else throw i}finally{}};qa.prototype.getNodedSubstrings=function(){return Bi.getNodedSubstrings(this._nodedSegStrings)};qa.prototype.snapRound=function(e,t){var n=this.findInteriorIntersections(e,t);this.computeIntersectionSnaps(n),this.computeVertexSnaps(e)};qa.prototype.findInteriorIntersections=function(e,t){var n=new Ic(t);return this._noder.setSegmentIntersector(n),this._noder.computeNodes(e),n.getInteriorIntersections()};qa.prototype.computeVertexSnaps=function(){var e=this;if(We(arguments[0],Ki))for(var t=arguments[0],n=t.iterator();n.hasNext();){var i=n.next();e.computeVertexSnaps(i)}else if(arguments[0]instanceof Bi)for(var r=arguments[0],l=r.getCoordinates(),f=0;f<l.length;f++){var a=new go(l[f],e._scaleFactor,e._li),_=e._pointSnapper.snap(a,r,f);_&&r.addIntersection(l[f],f)}};qa.prototype.computeNodes=function(e){this._nodedSegStrings=e,this._noder=new Gy,this._pointSnapper=new Xh(this._noder.getIndex()),this.snapRound(e,this._li)};qa.prototype.computeIntersectionSnaps=function(e){for(var t=this,n=e.iterator();n.hasNext();){var i=n.next(),r=new go(i,t._scaleFactor,t._li);t._pointSnapper.snap(r)}};qa.prototype.interfaces_=function(){return[zu]};qa.prototype.getClass=function(){return qa};var Ir=function(){if(this._argGeom=null,this._distance=null,this._bufParams=new Nn,this._resultGeometry=null,this._saveException=null,arguments.length===1){var e=arguments[0];this._argGeom=e}else if(arguments.length===2){var t=arguments[0],n=arguments[1];this._argGeom=t,this._bufParams=n}},hf={CAP_ROUND:{configurable:!0},CAP_BUTT:{configurable:!0},CAP_FLAT:{configurable:!0},CAP_SQUARE:{configurable:!0},MAX_PRECISION_DIGITS:{configurable:!0}};Ir.prototype.bufferFixedPrecision=function(e){var t=new Ql(new qa(new Dn(1)),e.getScale()),n=new to(this._bufParams);n.setWorkingPrecisionModel(e),n.setNoder(t),this._resultGeometry=n.buffer(this._argGeom,this._distance)};Ir.prototype.bufferReducedPrecision=function(){var e=this;if(arguments.length===0){for(var t=Ir.MAX_PRECISION_DIGITS;t>=0;t--){try{e.bufferReducedPrecision(t)}catch(l){if(l instanceof gl)e._saveException=l;else throw l}finally{}if(e._resultGeometry!==null)return null}throw this._saveException}else if(arguments.length===1){var n=arguments[0],i=Ir.precisionScaleFactor(this._argGeom,this._distance,n),r=new Dn(i);this.bufferFixedPrecision(r)}};Ir.prototype.computeGeometry=function(){if(this.bufferOriginalPrecision(),this._resultGeometry!==null)return null;var e=this._argGeom.getFactory().getPrecisionModel();e.getType()===Dn.FIXED?this.bufferFixedPrecision(e):this.bufferReducedPrecision()};Ir.prototype.setQuadrantSegments=function(e){this._bufParams.setQuadrantSegments(e)};Ir.prototype.bufferOriginalPrecision=function(){try{var e=new to(this._bufParams);this._resultGeometry=e.buffer(this._argGeom,this._distance)}catch(t){if(t instanceof dl)this._saveException=t;else throw t}finally{}};Ir.prototype.getResultGeometry=function(e){return this._distance=e,this.computeGeometry(),this._resultGeometry};Ir.prototype.setEndCapStyle=function(e){this._bufParams.setEndCapStyle(e)};Ir.prototype.interfaces_=function(){return[]};Ir.prototype.getClass=function(){return Ir};Ir.bufferOp=function(){if(arguments.length===2){var e=arguments[0],t=arguments[1],n=new Ir(e),i=n.getResultGeometry(t);return i}else if(arguments.length===3){if(Number.isInteger(arguments[2])&&arguments[0]instanceof $e&&typeof arguments[1]=="number"){var r=arguments[0],l=arguments[1],f=arguments[2],a=new Ir(r);a.setQuadrantSegments(f);var _=a.getResultGeometry(l);return _}else if(arguments[2]instanceof Nn&&arguments[0]instanceof $e&&typeof arguments[1]=="number"){var x=arguments[0],S=arguments[1],L=arguments[2],A=new Ir(x,L),P=A.getResultGeometry(S);return P}}else if(arguments.length===4){var O=arguments[0],B=arguments[1],U=arguments[2],Y=arguments[3],V=new Ir(O);V.setQuadrantSegments(U),V.setEndCapStyle(Y);var $=V.getResultGeometry(B);return $}};Ir.precisionScaleFactor=function(e,t,n){var i=e.getEnvelopeInternal(),r=Ho.max(Math.abs(i.getMaxX()),Math.abs(i.getMaxY()),Math.abs(i.getMinX()),Math.abs(i.getMinY())),l=t>0?t:0,f=r+2*l,a=Math.trunc(Math.log(f)/Math.log(10)+1),_=n-a,x=Math.pow(10,_);return x};hf.CAP_ROUND.get=function(){return Nn.CAP_ROUND};hf.CAP_BUTT.get=function(){return Nn.CAP_FLAT};hf.CAP_FLAT.get=function(){return Nn.CAP_FLAT};hf.CAP_SQUARE.get=function(){return Nn.CAP_SQUARE};hf.MAX_PRECISION_DIGITS.get=function(){return 12};Object.defineProperties(Ir,hf);var Kr=function(){this._pt=[new Dt,new Dt],this._distance=tn.NaN,this._isNull=!0};Kr.prototype.getCoordinates=function(){return this._pt};Kr.prototype.getCoordinate=function(e){return this._pt[e]};Kr.prototype.setMinimum=function(){if(arguments.length===1){var e=arguments[0];this.setMinimum(e._pt[0],e._pt[1])}else if(arguments.length===2){var t=arguments[0],n=arguments[1];if(this._isNull)return this.initialize(t,n),null;var i=t.distance(n);i<this._distance&&this.initialize(t,n,i)}};Kr.prototype.initialize=function(){if(arguments.length===0)this._isNull=!0;else if(arguments.length===2){var e=arguments[0],t=arguments[1];this._pt[0].setCoordinate(e),this._pt[1].setCoordinate(t),this._distance=e.distance(t),this._isNull=!1}else if(arguments.length===3){var n=arguments[0],i=arguments[1],r=arguments[2];this._pt[0].setCoordinate(n),this._pt[1].setCoordinate(i),this._distance=r,this._isNull=!1}};Kr.prototype.getDistance=function(){return this._distance};Kr.prototype.setMaximum=function(){if(arguments.length===1){var e=arguments[0];this.setMaximum(e._pt[0],e._pt[1])}else if(arguments.length===2){var t=arguments[0],n=arguments[1];if(this._isNull)return this.initialize(t,n),null;var i=t.distance(n);i>this._distance&&this.initialize(t,n,i)}};Kr.prototype.interfaces_=function(){return[]};Kr.prototype.getClass=function(){return Kr};var Ra=function(){};Ra.prototype.interfaces_=function(){return[]};Ra.prototype.getClass=function(){return Ra};Ra.computeDistance=function(){if(arguments[2]instanceof Kr&&arguments[0]instanceof Pi&&arguments[1]instanceof Dt)for(var e=arguments[0],t=arguments[1],n=arguments[2],i=e.getCoordinates(),r=new ze,l=0;l<i.length-1;l++){r.setCoordinates(i[l],i[l+1]);var f=r.closestPoint(t);n.setMinimum(f,t)}else if(arguments[2]instanceof Kr&&arguments[0]instanceof er&&arguments[1]instanceof Dt){var a=arguments[0],_=arguments[1],x=arguments[2];Ra.computeDistance(a.getExteriorRing(),_,x);for(var S=0;S<a.getNumInteriorRing();S++)Ra.computeDistance(a.getInteriorRingN(S),_,x)}else if(arguments[2]instanceof Kr&&arguments[0]instanceof $e&&arguments[1]instanceof Dt){var L=arguments[0],A=arguments[1],P=arguments[2];if(L instanceof Pi)Ra.computeDistance(L,A,P);else if(L instanceof er)Ra.computeDistance(L,A,P);else if(L instanceof eo)for(var O=L,B=0;B<O.getNumGeometries();B++){var U=O.getGeometryN(B);Ra.computeDistance(U,A,P)}else P.setMinimum(L.getCoordinate(),A)}else if(arguments[2]instanceof Kr&&arguments[0]instanceof ze&&arguments[1]instanceof Dt){var Y=arguments[0],V=arguments[1],$=arguments[2],K=Y.closestPoint(V);$.setMinimum(K,V)}};var Uu=function(e){this._maxPtDist=new Kr,this._inputGeom=e||null},jy={MaxPointDistanceFilter:{configurable:!0},MaxMidpointDistanceFilter:{configurable:!0}};Uu.prototype.computeMaxMidpointDistance=function(e){var t=new tu(this._inputGeom);e.apply(t),this._maxPtDist.setMaximum(t.getMaxPointDistance())};Uu.prototype.computeMaxVertexDistance=function(e){var t=new Cc(this._inputGeom);e.apply(t),this._maxPtDist.setMaximum(t.getMaxPointDistance())};Uu.prototype.findDistance=function(e){return this.computeMaxVertexDistance(e),this.computeMaxMidpointDistance(e),this._maxPtDist.getDistance()};Uu.prototype.getDistancePoints=function(){return this._maxPtDist};Uu.prototype.interfaces_=function(){return[]};Uu.prototype.getClass=function(){return Uu};jy.MaxPointDistanceFilter.get=function(){return Cc};jy.MaxMidpointDistanceFilter.get=function(){return tu};Object.defineProperties(Uu,jy);var Cc=function(e){this._maxPtDist=new Kr,this._minPtDist=new Kr,this._geom=e||null};Cc.prototype.filter=function(e){this._minPtDist.initialize(),Ra.computeDistance(this._geom,e,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)};Cc.prototype.getMaxPointDistance=function(){return this._maxPtDist};Cc.prototype.interfaces_=function(){return[Ba]};Cc.prototype.getClass=function(){return Cc};var tu=function(e){this._maxPtDist=new Kr,this._minPtDist=new Kr,this._geom=e||null};tu.prototype.filter=function(e,t){if(t===0)return null;var n=e.getCoordinate(t-1),i=e.getCoordinate(t),r=new Dt((n.x+i.x)/2,(n.y+i.y)/2);this._minPtDist.initialize(),Ra.computeDistance(this._geom,r,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)};tu.prototype.isDone=function(){return!1};tu.prototype.isGeometryChanged=function(){return!1};tu.prototype.getMaxPointDistance=function(){return this._maxPtDist};tu.prototype.interfaces_=function(){return[Ds]};tu.prototype.getClass=function(){return tu};var pl=function(e){this._comps=e||null};pl.prototype.filter=function(e){e instanceof er&&this._comps.add(e)};pl.prototype.interfaces_=function(){return[ha]};pl.prototype.getClass=function(){return pl};pl.getPolygons=function(){if(arguments.length===1){var e=arguments[0];return pl.getPolygons(e,new fe)}else if(arguments.length===2){var t=arguments[0],n=arguments[1];return t instanceof er?n.add(t):t instanceof eo&&t.apply(new pl(n)),n}};var Er=function(){if(this._lines=null,this._isForcedToLineString=!1,arguments.length===1){var e=arguments[0];this._lines=e}else if(arguments.length===2){var t=arguments[0],n=arguments[1];this._lines=t,this._isForcedToLineString=n}};Er.prototype.filter=function(e){if(this._isForcedToLineString&&e instanceof Va){var t=e.getFactory().createLineString(e.getCoordinateSequence());return this._lines.add(t),null}e instanceof Pi&&this._lines.add(e)};Er.prototype.setForceToLineString=function(e){this._isForcedToLineString=e};Er.prototype.interfaces_=function(){return[ml]};Er.prototype.getClass=function(){return Er};Er.getGeometry=function(){if(arguments.length===1){var e=arguments[0];return e.getFactory().buildGeometry(Er.getLines(e))}else if(arguments.length===2){var t=arguments[0],n=arguments[1];return t.getFactory().buildGeometry(Er.getLines(t,n))}};Er.getLines=function(){if(arguments.length===1){var e=arguments[0];return Er.getLines(e,!1)}else if(arguments.length===2){if(We(arguments[0],Ki)&&We(arguments[1],Ki)){for(var t=arguments[0],n=arguments[1],i=t.iterator();i.hasNext();){var r=i.next();Er.getLines(r,n)}return n}else if(arguments[0]instanceof $e&&typeof arguments[1]=="boolean"){var l=arguments[0],f=arguments[1],a=new fe;return l.apply(new Er(a,f)),a}else if(arguments[0]instanceof $e&&We(arguments[1],Ki)){var _=arguments[0],x=arguments[1];return _ instanceof Pi?x.add(_):_.apply(new Er(x)),x}}else if(arguments.length===3){if(typeof arguments[2]=="boolean"&&We(arguments[0],Ki)&&We(arguments[1],Ki)){for(var S=arguments[0],L=arguments[1],A=arguments[2],P=S.iterator();P.hasNext();){var O=P.next();Er.getLines(O,L,A)}return L}else if(typeof arguments[2]=="boolean"&&arguments[0]instanceof $e&&We(arguments[1],Ki)){var B=arguments[0],U=arguments[1],Y=arguments[2];return B.apply(new Er(U,Y)),U}}};var Fs=function(){if(this._boundaryRule=_s.OGC_SFS_BOUNDARY_RULE,this._isIn=null,this._numBoundaries=null,arguments.length!==0&&arguments.length===1){var e=arguments[0];if(e===null)throw new _i("Rule must be non-null");this._boundaryRule=e}};Fs.prototype.locateInternal=function(){var e=this;if(arguments[0]instanceof Dt&&arguments[1]instanceof er){var t=arguments[0],n=arguments[1];if(n.isEmpty())return zt.EXTERIOR;var i=n.getExteriorRing(),r=this.locateInPolygonRing(t,i);if(r===zt.EXTERIOR)return zt.EXTERIOR;if(r===zt.BOUNDARY)return zt.BOUNDARY;for(var l=0;l<n.getNumInteriorRing();l++){var f=n.getInteriorRingN(l),a=e.locateInPolygonRing(t,f);if(a===zt.INTERIOR)return zt.EXTERIOR;if(a===zt.BOUNDARY)return zt.BOUNDARY}return zt.INTERIOR}else if(arguments[0]instanceof Dt&&arguments[1]instanceof Pi){var _=arguments[0],x=arguments[1];if(!x.getEnvelopeInternal().intersects(_))return zt.EXTERIOR;var S=x.getCoordinates();return!x.isClosed()&&(_.equals(S[0])||_.equals(S[S.length-1]))?zt.BOUNDARY:be.isOnLine(_,S)?zt.INTERIOR:zt.EXTERIOR}else if(arguments[0]instanceof Dt&&arguments[1]instanceof Mo){var L=arguments[0],A=arguments[1],P=A.getCoordinate();return P.equals2D(L)?zt.INTERIOR:zt.EXTERIOR}};Fs.prototype.locateInPolygonRing=function(e,t){return t.getEnvelopeInternal().intersects(e)?be.locatePointInRing(e,t.getCoordinates()):zt.EXTERIOR};Fs.prototype.intersects=function(e,t){return this.locate(e,t)!==zt.EXTERIOR};Fs.prototype.updateLocationInfo=function(e){e===zt.INTERIOR&&(this._isIn=!0),e===zt.BOUNDARY&&this._numBoundaries++};Fs.prototype.computeLocation=function(e,t){var n=this;if(t instanceof Mo&&this.updateLocationInfo(this.locateInternal(e,t)),t instanceof Pi)this.updateLocationInfo(this.locateInternal(e,t));else if(t instanceof er)this.updateLocationInfo(this.locateInternal(e,t));else if(t instanceof Ou)for(var i=t,r=0;r<i.getNumGeometries();r++){var l=i.getGeometryN(r);n.updateLocationInfo(n.locateInternal(e,l))}else if(t instanceof za)for(var f=t,a=0;a<f.getNumGeometries();a++){var _=f.getGeometryN(a);n.updateLocationInfo(n.locateInternal(e,_))}else if(t instanceof eo)for(var x=new Fa(t);x.hasNext();){var S=x.next();S!==t&&n.computeLocation(e,S)}};Fs.prototype.locate=function(e,t){return t.isEmpty()?zt.EXTERIOR:t instanceof Pi?this.locateInternal(e,t):t instanceof er?this.locateInternal(e,t):(this._isIn=!1,this._numBoundaries=0,this.computeLocation(e,t),this._boundaryRule.isInBoundary(this._numBoundaries)?zt.BOUNDARY:this._numBoundaries>0||this._isIn?zt.INTERIOR:zt.EXTERIOR)};Fs.prototype.interfaces_=function(){return[]};Fs.prototype.getClass=function(){return Fs};var Jr=function e(){if(this._component=null,this._segIndex=null,this._pt=null,arguments.length===2){var t=arguments[0],n=arguments[1];e.call(this,t,e.INSIDE_AREA,n)}else if(arguments.length===3){var i=arguments[0],r=arguments[1],l=arguments[2];this._component=i,this._segIndex=r,this._pt=l}},Gx={INSIDE_AREA:{configurable:!0}};Jr.prototype.isInsideArea=function(){return this._segIndex===Jr.INSIDE_AREA};Jr.prototype.getCoordinate=function(){return this._pt};Jr.prototype.getGeometryComponent=function(){return this._component};Jr.prototype.getSegmentIndex=function(){return this._segIndex};Jr.prototype.interfaces_=function(){return[]};Jr.prototype.getClass=function(){return Jr};Gx.INSIDE_AREA.get=function(){return-1};Object.defineProperties(Jr,Gx);var Wl=function(e){this._pts=e||null};Wl.prototype.filter=function(e){e instanceof Mo&&this._pts.add(e)};Wl.prototype.interfaces_=function(){return[ha]};Wl.prototype.getClass=function(){return Wl};Wl.getPoints=function(){if(arguments.length===1){var e=arguments[0];return e instanceof Mo?Os.singletonList(e):Wl.getPoints(e,new fe)}else if(arguments.length===2){var t=arguments[0],n=arguments[1];return t instanceof Mo?n.add(t):t instanceof eo&&t.apply(new Wl(n)),n}};var Tc=function(){this._locations=null;var e=arguments[0];this._locations=e};Tc.prototype.filter=function(e){(e instanceof Mo||e instanceof Pi||e instanceof er)&&this._locations.add(new Jr(e,0,e.getCoordinate()))};Tc.prototype.interfaces_=function(){return[ha]};Tc.prototype.getClass=function(){return Tc};Tc.getLocations=function(e){var t=new fe;return e.apply(new Tc(t)),t};var Mr=function(){if(this._geom=null,this._terminateDistance=0,this._ptLocator=new Fs,this._minDistanceLocation=null,this._minDistance=tn.MAX_VALUE,arguments.length===2){var e=arguments[0],t=arguments[1];this._geom=[e,t],this._terminateDistance=0}else if(arguments.length===3){var n=arguments[0],i=arguments[1],r=arguments[2];this._geom=new Array(2).fill(null),this._geom[0]=n,this._geom[1]=i,this._terminateDistance=r}};Mr.prototype.computeContainmentDistance=function(){var e=this;if(arguments.length===0){var t=new Array(2).fill(null);if(this.computeContainmentDistance(0,t),this._minDistance<=this._terminateDistance)return null;this.computeContainmentDistance(1,t)}else if(arguments.length===2){var n=arguments[0],i=arguments[1],r=1-n,l=pl.getPolygons(this._geom[n]);if(l.size()>0){var f=Tc.getLocations(this._geom[r]);if(this.computeContainmentDistance(f,l,i),this._minDistance<=this._terminateDistance)return this._minDistanceLocation[r]=i[0],this._minDistanceLocation[n]=i[1],null}}else if(arguments.length===3){if(arguments[2]instanceof Array&&We(arguments[0],As)&&We(arguments[1],As)){for(var a=arguments[0],_=arguments[1],x=arguments[2],S=0;S<a.size();S++)for(var L=a.get(S),A=0;A<_.size();A++)if(e.computeContainmentDistance(L,_.get(A),x),e._minDistance<=e._terminateDistance)return null}else if(arguments[2]instanceof Array&&arguments[0]instanceof Jr&&arguments[1]instanceof er){var P=arguments[0],O=arguments[1],B=arguments[2],U=P.getCoordinate();if(zt.EXTERIOR!==this._ptLocator.locate(U,O))return this._minDistance=0,B[0]=P,B[1]=new Jr(O,U),null}}};Mr.prototype.computeMinDistanceLinesPoints=function(e,t,n){for(var i=this,r=0;r<e.size();r++)for(var l=e.get(r),f=0;f<t.size();f++){var a=t.get(f);if(i.computeMinDistance(l,a,n),i._minDistance<=i._terminateDistance)return null}};Mr.prototype.computeFacetDistance=function(){var e=new Array(2).fill(null),t=Er.getLines(this._geom[0]),n=Er.getLines(this._geom[1]),i=Wl.getPoints(this._geom[0]),r=Wl.getPoints(this._geom[1]);if(this.computeMinDistanceLines(t,n,e),this.updateMinDistance(e,!1),this._minDistance<=this._terminateDistance||(e[0]=null,e[1]=null,this.computeMinDistanceLinesPoints(t,r,e),this.updateMinDistance(e,!1),this._minDistance<=this._terminateDistance)||(e[0]=null,e[1]=null,this.computeMinDistanceLinesPoints(n,i,e),this.updateMinDistance(e,!0),this._minDistance<=this._terminateDistance))return null;e[0]=null,e[1]=null,this.computeMinDistancePoints(i,r,e),this.updateMinDistance(e,!1)};Mr.prototype.nearestLocations=function(){return this.computeMinDistance(),this._minDistanceLocation};Mr.prototype.updateMinDistance=function(e,t){if(e[0]===null)return null;t?(this._minDistanceLocation[0]=e[1],this._minDistanceLocation[1]=e[0]):(this._minDistanceLocation[0]=e[0],this._minDistanceLocation[1]=e[1])};Mr.prototype.nearestPoints=function(){this.computeMinDistance();var e=[this._minDistanceLocation[0].getCoordinate(),this._minDistanceLocation[1].getCoordinate()];return e};Mr.prototype.computeMinDistance=function(){var e=this;if(arguments.length===0){if(this._minDistanceLocation!==null||(this._minDistanceLocation=new Array(2).fill(null),this.computeContainmentDistance(),this._minDistance<=this._terminateDistance))return null;this.computeFacetDistance()}else if(arguments.length===3){if(arguments[2]instanceof Array&&arguments[0]instanceof Pi&&arguments[1]instanceof Mo){var t=arguments[0],n=arguments[1],i=arguments[2];if(t.getEnvelopeInternal().distance(n.getEnvelopeInternal())>this._minDistance)return null;for(var r=t.getCoordinates(),l=n.getCoordinate(),f=0;f<r.length-1;f++){var a=be.distancePointLine(l,r[f],r[f+1]);if(a<e._minDistance){e._minDistance=a;var _=new ze(r[f],r[f+1]),x=_.closestPoint(l);i[0]=new Jr(t,f,x),i[1]=new Jr(n,0,l)}if(e._minDistance<=e._terminateDistance)return null}}else if(arguments[2]instanceof Array&&arguments[0]instanceof Pi&&arguments[1]instanceof Pi){var S=arguments[0],L=arguments[1],A=arguments[2];if(S.getEnvelopeInternal().distance(L.getEnvelopeInternal())>this._minDistance)return null;for(var P=S.getCoordinates(),O=L.getCoordinates(),B=0;B<P.length-1;B++)for(var U=0;U<O.length-1;U++){var Y=be.distanceLineLine(P[B],P[B+1],O[U],O[U+1]);if(Y<e._minDistance){e._minDistance=Y;var V=new ze(P[B],P[B+1]),$=new ze(O[U],O[U+1]),K=V.closestPoints($);A[0]=new Jr(S,B,K[0]),A[1]=new Jr(L,U,K[1])}if(e._minDistance<=e._terminateDistance)return null}}}};Mr.prototype.computeMinDistancePoints=function(e,t,n){for(var i=this,r=0;r<e.size();r++)for(var l=e.get(r),f=0;f<t.size();f++){var a=t.get(f),_=l.getCoordinate().distance(a.getCoordinate());if(_<i._minDistance&&(i._minDistance=_,n[0]=new Jr(l,0,l.getCoordinate()),n[1]=new Jr(a,0,a.getCoordinate())),i._minDistance<=i._terminateDistance)return null}};Mr.prototype.distance=function(){if(this._geom[0]===null||this._geom[1]===null)throw new _i("null geometries are not supported");return this._geom[0].isEmpty()||this._geom[1].isEmpty()?0:(this.computeMinDistance(),this._minDistance)};Mr.prototype.computeMinDistanceLines=function(e,t,n){for(var i=this,r=0;r<e.size();r++)for(var l=e.get(r),f=0;f<t.size();f++){var a=t.get(f);if(i.computeMinDistance(l,a,n),i._minDistance<=i._terminateDistance)return null}};Mr.prototype.interfaces_=function(){return[]};Mr.prototype.getClass=function(){return Mr};Mr.distance=function(e,t){var n=new Mr(e,t);return n.distance()};Mr.isWithinDistance=function(e,t,n){var i=new Mr(e,t,n);return i.distance()<=n};Mr.nearestPoints=function(e,t){var n=new Mr(e,t);return n.nearestPoints()};var Br=function(){this._pt=[new Dt,new Dt],this._distance=tn.NaN,this._isNull=!0};Br.prototype.getCoordinates=function(){return this._pt};Br.prototype.getCoordinate=function(e){return this._pt[e]};Br.prototype.setMinimum=function(){if(arguments.length===1){var e=arguments[0];this.setMinimum(e._pt[0],e._pt[1])}else if(arguments.length===2){var t=arguments[0],n=arguments[1];if(this._isNull)return this.initialize(t,n),null;var i=t.distance(n);i<this._distance&&this.initialize(t,n,i)}};Br.prototype.initialize=function(){if(arguments.length===0)this._isNull=!0;else if(arguments.length===2){var e=arguments[0],t=arguments[1];this._pt[0].setCoordinate(e),this._pt[1].setCoordinate(t),this._distance=e.distance(t),this._isNull=!1}else if(arguments.length===3){var n=arguments[0],i=arguments[1],r=arguments[2];this._pt[0].setCoordinate(n),this._pt[1].setCoordinate(i),this._distance=r,this._isNull=!1}};Br.prototype.toString=function(){return Ns.toLineString(this._pt[0],this._pt[1])};Br.prototype.getDistance=function(){return this._distance};Br.prototype.setMaximum=function(){if(arguments.length===1){var e=arguments[0];this.setMaximum(e._pt[0],e._pt[1])}else if(arguments.length===2){var t=arguments[0],n=arguments[1];if(this._isNull)return this.initialize(t,n),null;var i=t.distance(n);i>this._distance&&this.initialize(t,n,i)}};Br.prototype.interfaces_=function(){return[]};Br.prototype.getClass=function(){return Br};var na=function(){};na.prototype.interfaces_=function(){return[]};na.prototype.getClass=function(){return na};na.computeDistance=function(){if(arguments[2]instanceof Br&&arguments[0]instanceof Pi&&arguments[1]instanceof Dt)for(var e=arguments[0],t=arguments[1],n=arguments[2],i=new ze,r=e.getCoordinates(),l=0;l<r.length-1;l++){i.setCoordinates(r[l],r[l+1]);var f=i.closestPoint(t);n.setMinimum(f,t)}else if(arguments[2]instanceof Br&&arguments[0]instanceof er&&arguments[1]instanceof Dt){var a=arguments[0],_=arguments[1],x=arguments[2];na.computeDistance(a.getExteriorRing(),_,x);for(var S=0;S<a.getNumInteriorRing();S++)na.computeDistance(a.getInteriorRingN(S),_,x)}else if(arguments[2]instanceof Br&&arguments[0]instanceof $e&&arguments[1]instanceof Dt){var L=arguments[0],A=arguments[1],P=arguments[2];if(L instanceof Pi)na.computeDistance(L,A,P);else if(L instanceof er)na.computeDistance(L,A,P);else if(L instanceof eo)for(var O=L,B=0;B<O.getNumGeometries();B++){var U=O.getGeometryN(B);na.computeDistance(U,A,P)}else P.setMinimum(L.getCoordinate(),A)}else if(arguments[2]instanceof Br&&arguments[0]instanceof ze&&arguments[1]instanceof Dt){var Y=arguments[0],V=arguments[1],$=arguments[2],K=Y.closestPoint(V);$.setMinimum(K,V)}};var gs=function(){this._g0=null,this._g1=null,this._ptDist=new Br,this._densifyFrac=0;var e=arguments[0],t=arguments[1];this._g0=e,this._g1=t},qy={MaxPointDistanceFilter:{configurable:!0},MaxDensifiedByFractionDistanceFilter:{configurable:!0}};gs.prototype.getCoordinates=function(){return this._ptDist.getCoordinates()};gs.prototype.setDensifyFraction=function(e){if(e>1||e<=0)throw new _i("Fraction is not in range (0.0 - 1.0]");this._densifyFrac=e};gs.prototype.compute=function(e,t){this.computeOrientedDistance(e,t,this._ptDist),this.computeOrientedDistance(t,e,this._ptDist)};gs.prototype.distance=function(){return this.compute(this._g0,this._g1),this._ptDist.getDistance()};gs.prototype.computeOrientedDistance=function(e,t,n){var i=new Lc(t);if(e.apply(i),n.setMaximum(i.getMaxPointDistance()),this._densifyFrac>0){var r=new eu(t,this._densifyFrac);e.apply(r),n.setMaximum(r.getMaxPointDistance())}};gs.prototype.orientedDistance=function(){return this.computeOrientedDistance(this._g0,this._g1,this._ptDist),this._ptDist.getDistance()};gs.prototype.interfaces_=function(){return[]};gs.prototype.getClass=function(){return gs};gs.distance=function(){if(arguments.length===2){var e=arguments[0],t=arguments[1],n=new gs(e,t);return n.distance()}else if(arguments.length===3){var i=arguments[0],r=arguments[1],l=arguments[2],f=new gs(i,r);return f.setDensifyFraction(l),f.distance()}};qy.MaxPointDistanceFilter.get=function(){return Lc};qy.MaxDensifiedByFractionDistanceFilter.get=function(){return eu};Object.defineProperties(gs,qy);var Lc=function(){this._maxPtDist=new Br,this._minPtDist=new Br,this._euclideanDist=new na,this._geom=null;var e=arguments[0];this._geom=e};Lc.prototype.filter=function(e){this._minPtDist.initialize(),na.computeDistance(this._geom,e,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)};Lc.prototype.getMaxPointDistance=function(){return this._maxPtDist};Lc.prototype.interfaces_=function(){return[Ba]};Lc.prototype.getClass=function(){return Lc};var eu=function(){this._maxPtDist=new Br,this._minPtDist=new Br,this._geom=null,this._numSubSegs=0;var e=arguments[0],t=arguments[1];this._geom=e,this._numSubSegs=Math.trunc(Math.round(1/t))};eu.prototype.filter=function(e,t){var n=this;if(t===0)return null;for(var i=e.getCoordinate(t-1),r=e.getCoordinate(t),l=(r.x-i.x)/this._numSubSegs,f=(r.y-i.y)/this._numSubSegs,a=0;a<this._numSubSegs;a++){var _=i.x+a*l,x=i.y+a*f,S=new Dt(_,x);n._minPtDist.initialize(),na.computeDistance(n._geom,S,n._minPtDist),n._maxPtDist.setMaximum(n._minPtDist)}};eu.prototype.isDone=function(){return!1};eu.prototype.isGeometryChanged=function(){return!1};eu.prototype.getMaxPointDistance=function(){return this._maxPtDist};eu.prototype.interfaces_=function(){return[Ds]};eu.prototype.getClass=function(){return eu};var Lo=function(e,t,n){this._minValidDistance=null,this._maxValidDistance=null,this._minDistanceFound=null,this._maxDistanceFound=null,this._isValid=!0,this._errMsg=null,this._errorLocation=null,this._errorIndicator=null,this._input=e||null,this._bufDistance=t||null,this._result=n||null},Zy={VERBOSE:{configurable:!0},MAX_DISTANCE_DIFF_FRAC:{configurable:!0}};Lo.prototype.checkMaximumDistance=function(e,t,n){var i=new gs(t,e);if(i.setDensifyFraction(.25),this._maxDistanceFound=i.orientedDistance(),this._maxDistanceFound>n){this._isValid=!1;var r=i.getCoordinates();this._errorLocation=r[1],this._errorIndicator=e.getFactory().createLineString(r),this._errMsg="Distance between buffer curve and input is too large ("+this._maxDistanceFound+" at "+Ns.toLineString(r[0],r[1])+")"}};Lo.prototype.isValid=function(){var e=Math.abs(this._bufDistance),t=Lo.MAX_DISTANCE_DIFF_FRAC*e;return this._minValidDistance=e-t,this._maxValidDistance=e+t,this._input.isEmpty()||this._result.isEmpty()?!0:(this._bufDistance>0?this.checkPositiveValid():this.checkNegativeValid(),Lo.VERBOSE&&Lr.out.println("Min Dist= "+this._minDistanceFound+"  err= "+(1-this._minDistanceFound/this._bufDistance)+"  Max Dist= "+this._maxDistanceFound+"  err= "+(this._maxDistanceFound/this._bufDistance-1)),this._isValid)};Lo.prototype.checkNegativeValid=function(){if(!(this._input instanceof er||this._input instanceof za||this._input instanceof eo))return null;var e=this.getPolygonLines(this._input);if(this.checkMinimumDistance(e,this._result,this._minValidDistance),!this._isValid)return null;this.checkMaximumDistance(e,this._result,this._maxValidDistance)};Lo.prototype.getErrorIndicator=function(){return this._errorIndicator};Lo.prototype.checkMinimumDistance=function(e,t,n){var i=new Mr(e,t,n);if(this._minDistanceFound=i.distance(),this._minDistanceFound<n){this._isValid=!1;var r=i.nearestPoints();this._errorLocation=i.nearestPoints()[1],this._errorIndicator=e.getFactory().createLineString(r),this._errMsg="Distance between buffer curve and input is too small ("+this._minDistanceFound+" at "+Ns.toLineString(r[0],r[1])+" )"}};Lo.prototype.checkPositiveValid=function(){var e=this._result.getBoundary();if(this.checkMinimumDistance(this._input,e,this._minValidDistance),!this._isValid)return null;this.checkMaximumDistance(this._input,e,this._maxValidDistance)};Lo.prototype.getErrorLocation=function(){return this._errorLocation};Lo.prototype.getPolygonLines=function(e){for(var t=new fe,n=new Er(t),i=pl.getPolygons(e),r=i.iterator();r.hasNext();){var l=r.next();l.apply(n)}return e.getFactory().buildGeometry(t)};Lo.prototype.getErrorMessage=function(){return this._errMsg};Lo.prototype.interfaces_=function(){return[]};Lo.prototype.getClass=function(){return Lo};Zy.VERBOSE.get=function(){return!1};Zy.MAX_DISTANCE_DIFF_FRAC.get=function(){return .012};Object.defineProperties(Lo,Zy);var Pr=function(e,t,n){this._isValid=!0,this._errorMsg=null,this._errorLocation=null,this._errorIndicator=null,this._input=e||null,this._distance=t||null,this._result=n||null},$y={VERBOSE:{configurable:!0},MAX_ENV_DIFF_FRAC:{configurable:!0}};Pr.prototype.isValid=function(){return this.checkPolygonal(),this._isValid?(this.checkExpectedEmpty(),this._isValid?(this.checkEnvelope(),this._isValid?(this.checkArea(),this._isValid?(this.checkDistance(),this._isValid):this._isValid):this._isValid):this._isValid):this._isValid};Pr.prototype.checkEnvelope=function(){if(this._distance<0)return null;var e=this._distance*Pr.MAX_ENV_DIFF_FRAC;e===0&&(e=.001);var t=new Oe(this._input.getEnvelopeInternal());t.expandBy(this._distance);var n=new Oe(this._result.getEnvelopeInternal());n.expandBy(e),n.contains(t)||(this._isValid=!1,this._errorMsg="Buffer envelope is incorrect",this._errorIndicator=this._input.getFactory().toGeometry(n)),this.report("Envelope")};Pr.prototype.checkDistance=function(){var e=new Lo(this._input,this._distance,this._result);e.isValid()||(this._isValid=!1,this._errorMsg=e.getErrorMessage(),this._errorLocation=e.getErrorLocation(),this._errorIndicator=e.getErrorIndicator()),this.report("Distance")};Pr.prototype.checkArea=function(){var e=this._input.getArea(),t=this._result.getArea();this._distance>0&&e>t&&(this._isValid=!1,this._errorMsg="Area of positive buffer is smaller than input",this._errorIndicator=this._result),this._distance<0&&e<t&&(this._isValid=!1,this._errorMsg="Area of negative buffer is larger than input",this._errorIndicator=this._result),this.report("Area")};Pr.prototype.checkPolygonal=function(){this._result instanceof er||this._result instanceof za||(this._isValid=!1),this._errorMsg="Result is not polygonal",this._errorIndicator=this._result,this.report("Polygonal")};Pr.prototype.getErrorIndicator=function(){return this._errorIndicator};Pr.prototype.getErrorLocation=function(){return this._errorLocation};Pr.prototype.checkExpectedEmpty=function(){if(this._input.getDimension()>=2||this._distance>0)return null;this._result.isEmpty()||(this._isValid=!1,this._errorMsg="Result is non-empty",this._errorIndicator=this._result),this.report("ExpectedEmpty")};Pr.prototype.report=function(e){if(!Pr.VERBOSE)return null;Lr.out.println("Check "+e+": "+(this._isValid?"passed":"FAILED"))};Pr.prototype.getErrorMessage=function(){return this._errorMsg};Pr.prototype.interfaces_=function(){return[]};Pr.prototype.getClass=function(){return Pr};Pr.isValidMsg=function(e,t,n){var i=new Pr(e,t,n);return i.isValid()?null:i.getErrorMessage()};Pr.isValid=function(e,t,n){var i=new Pr(e,t,n);return!!i.isValid()};$y.VERBOSE.get=function(){return!1};$y.MAX_ENV_DIFF_FRAC.get=function(){return .012};Object.defineProperties(Pr,$y);var _a=function(){this._pts=null,this._data=null;var e=arguments[0],t=arguments[1];this._pts=e,this._data=t};_a.prototype.getCoordinates=function(){return this._pts};_a.prototype.size=function(){return this._pts.length};_a.prototype.getCoordinate=function(e){return this._pts[e]};_a.prototype.isClosed=function(){return this._pts[0].equals(this._pts[this._pts.length-1])};_a.prototype.getSegmentOctant=function(e){return e===this._pts.length-1?-1:Sc.octant(this.getCoordinate(e),this.getCoordinate(e+1))};_a.prototype.setData=function(e){this._data=e};_a.prototype.getData=function(){return this._data};_a.prototype.toString=function(){return Ns.toLineString(new Ri(this._pts))};_a.prototype.interfaces_=function(){return[Ga]};_a.prototype.getClass=function(){return _a};var wr=function(){this._findAllIntersections=!1,this._isCheckEndSegmentsOnly=!1,this._li=null,this._interiorIntersection=null,this._intSegments=null,this._intersections=new fe,this._intersectionCount=0,this._keepIntersections=!0;var e=arguments[0];this._li=e,this._interiorIntersection=null};wr.prototype.getInteriorIntersection=function(){return this._interiorIntersection};wr.prototype.setCheckEndSegmentsOnly=function(e){this._isCheckEndSegmentsOnly=e};wr.prototype.getIntersectionSegments=function(){return this._intSegments};wr.prototype.count=function(){return this._intersectionCount};wr.prototype.getIntersections=function(){return this._intersections};wr.prototype.setFindAllIntersections=function(e){this._findAllIntersections=e};wr.prototype.setKeepIntersections=function(e){this._keepIntersections=e};wr.prototype.processIntersections=function(e,t,n,i){if(!this._findAllIntersections&&this.hasIntersection()||e===n&&t===i)return null;if(this._isCheckEndSegmentsOnly){var r=this.isEndSegment(e,t)||this.isEndSegment(n,i);if(!r)return null}var l=e.getCoordinates()[t],f=e.getCoordinates()[t+1],a=n.getCoordinates()[i],_=n.getCoordinates()[i+1];this._li.computeIntersection(l,f,a,_),this._li.hasIntersection()&&this._li.isInteriorIntersection()&&(this._intSegments=new Array(4).fill(null),this._intSegments[0]=l,this._intSegments[1]=f,this._intSegments[2]=a,this._intSegments[3]=_,this._interiorIntersection=this._li.getIntersection(0),this._keepIntersections&&this._intersections.add(this._interiorIntersection),this._intersectionCount++)};wr.prototype.isEndSegment=function(e,t){return t===0||t>=e.size()-2};wr.prototype.hasIntersection=function(){return this._interiorIntersection!==null};wr.prototype.isDone=function(){return this._findAllIntersections?!1:this._interiorIntersection!==null};wr.prototype.interfaces_=function(){return[Bu]};wr.prototype.getClass=function(){return wr};wr.createAllIntersectionsFinder=function(e){var t=new wr(e);return t.setFindAllIntersections(!0),t};wr.createAnyIntersectionFinder=function(e){return new wr(e)};wr.createIntersectionCounter=function(e){var t=new wr(e);return t.setFindAllIntersections(!0),t.setKeepIntersections(!1),t};var Bs=function(){this._li=new Zu,this._segStrings=null,this._findAllIntersections=!1,this._segInt=null,this._isValid=!0;var e=arguments[0];this._segStrings=e};Bs.prototype.execute=function(){if(this._segInt!==null)return null;this.checkInteriorIntersections()};Bs.prototype.getIntersections=function(){return this._segInt.getIntersections()};Bs.prototype.isValid=function(){return this.execute(),this._isValid};Bs.prototype.setFindAllIntersections=function(e){this._findAllIntersections=e};Bs.prototype.checkInteriorIntersections=function(){this._isValid=!0,this._segInt=new wr(this._li),this._segInt.setFindAllIntersections(this._findAllIntersections);var e=new Gy;if(e.setSegmentIntersector(this._segInt),e.computeNodes(this._segStrings),this._segInt.hasIntersection())return this._isValid=!1,null};Bs.prototype.checkValid=function(){if(this.execute(),!this._isValid)throw new gl(this.getErrorMessage(),this._segInt.getInteriorIntersection())};Bs.prototype.getErrorMessage=function(){if(this._isValid)return"no intersections found";var e=this._segInt.getIntersectionSegments();return"found non-noded intersection between "+Ns.toLineString(e[0],e[1])+" and "+Ns.toLineString(e[2],e[3])};Bs.prototype.interfaces_=function(){return[]};Bs.prototype.getClass=function(){return Bs};Bs.computeIntersections=function(e){var t=new Bs(e);return t.setFindAllIntersections(!0),t.isValid(),t.getIntersections()};var Gu=function e(){this._nv=null;var t=arguments[0];this._nv=new Bs(e.toSegmentStrings(t))};Gu.prototype.checkValid=function(){this._nv.checkValid()};Gu.prototype.interfaces_=function(){return[]};Gu.prototype.getClass=function(){return Gu};Gu.toSegmentStrings=function(e){for(var t=new fe,n=e.iterator();n.hasNext();){var i=n.next();t.add(new _a(i.getCoordinates(),i))}return t};Gu.checkValid=function(e){var t=new Gu(e);t.checkValid()};var Mc=function(e){this._mapOp=e};Mc.prototype.map=function(e){for(var t=this,n=new fe,i=0;i<e.getNumGeometries();i++){var r=t._mapOp.map(e.getGeometryN(i));r.isEmpty()||n.add(r)}return e.getFactory().createGeometryCollection(mn.toGeometryArray(n))};Mc.prototype.interfaces_=function(){return[]};Mc.prototype.getClass=function(){return Mc};Mc.map=function(e,t){var n=new Mc(t);return n.map(e)};var ya=function(){this._op=null,this._geometryFactory=null,this._ptLocator=null,this._lineEdgesList=new fe,this._resultLineList=new fe;var e=arguments[0],t=arguments[1],n=arguments[2];this._op=e,this._geometryFactory=t,this._ptLocator=n};ya.prototype.collectLines=function(e){for(var t=this,n=this._op.getGraph().getEdgeEnds().iterator();n.hasNext();){var i=n.next();t.collectLineEdge(i,e,t._lineEdgesList),t.collectBoundaryTouchEdge(i,e,t._lineEdgesList)}};ya.prototype.labelIsolatedLine=function(e,t){var n=this._ptLocator.locate(e.getCoordinate(),this._op.getArgGeometry(t));e.getLabel().setLocation(t,n)};ya.prototype.build=function(e){return this.findCoveredLineEdges(),this.collectLines(e),this.buildLines(e),this._resultLineList};ya.prototype.collectLineEdge=function(e,t,n){var i=e.getLabel(),r=e.getEdge();e.isLineEdge()&&!e.isVisited()&&sn.isResultOfOp(i,t)&&!r.isCovered()&&(n.add(r),e.setVisitedEdge(!0))};ya.prototype.findCoveredLineEdges=function(){for(var e=this,t=this._op.getGraph().getNodes().iterator();t.hasNext();){var n=t.next();n.getEdges().findCoveredLineEdges()}for(var i=this._op.getGraph().getEdgeEnds().iterator();i.hasNext();){var r=i.next(),l=r.getEdge();if(r.isLineEdge()&&!l.isCoveredSet()){var f=e._op.isCoveredByA(r.getCoordinate());l.setCovered(f)}}};ya.prototype.labelIsolatedLines=function(e){for(var t=this,n=e.iterator();n.hasNext();){var i=n.next(),r=i.getLabel();i.isIsolated()&&(r.isNull(0)?t.labelIsolatedLine(i,0):t.labelIsolatedLine(i,1))}};ya.prototype.buildLines=function(e){for(var t=this,n=this._lineEdgesList.iterator();n.hasNext();){var i=n.next(),r=t._geometryFactory.createLineString(i.getCoordinates());t._resultLineList.add(r),i.setInResult(!0)}};ya.prototype.collectBoundaryTouchEdge=function(e,t,n){var i=e.getLabel();if(e.isLineEdge()||e.isVisited()||e.isInteriorAreaEdge()||e.getEdge().isInResult())return null;an.isTrue(!(e.isInResult()||e.getSym().isInResult())||!e.getEdge().isInResult()),sn.isResultOfOp(i,t)&&t===sn.INTERSECTION&&(n.add(e.getEdge()),e.setVisitedEdge(!0))};ya.prototype.interfaces_=function(){return[]};ya.prototype.getClass=function(){return ya};var Pc=function(){this._op=null,this._geometryFactory=null,this._resultPointList=new fe;var e=arguments[0],t=arguments[1];this._op=e,this._geometryFactory=t};Pc.prototype.filterCoveredNodeToPoint=function(e){var t=e.getCoordinate();if(!this._op.isCoveredByLA(t)){var n=this._geometryFactory.createPoint(t);this._resultPointList.add(n)}};Pc.prototype.extractNonCoveredResultNodes=function(e){for(var t=this,n=this._op.getGraph().getNodes().iterator();n.hasNext();){var i=n.next();if(!i.isInResult()&&!i.isIncidentEdgeInResult()&&(i.getEdges().getDegree()===0||e===sn.INTERSECTION)){var r=i.getLabel();sn.isResultOfOp(r,e)&&t.filterCoveredNodeToPoint(i)}}};Pc.prototype.build=function(e){return this.extractNonCoveredResultNodes(e),this._resultPointList};Pc.prototype.interfaces_=function(){return[]};Pc.prototype.getClass=function(){return Pc};var _o=function(){this._inputGeom=null,this._factory=null,this._pruneEmptyGeometry=!0,this._preserveGeometryCollectionType=!0,this._preserveCollections=!1,this._preserveType=!1};_o.prototype.transformPoint=function(e,t){return this._factory.createPoint(this.transformCoordinates(e.getCoordinateSequence(),e))};_o.prototype.transformPolygon=function(e,t){var n=this,i=!0,r=this.transformLinearRing(e.getExteriorRing(),e);(r===null||!(r instanceof Va)||r.isEmpty())&&(i=!1);for(var l=new fe,f=0;f<e.getNumInteriorRing();f++){var a=n.transformLinearRing(e.getInteriorRingN(f),e);a===null||a.isEmpty()||(a instanceof Va||(i=!1),l.add(a))}if(i)return this._factory.createPolygon(r,l.toArray([]));var _=new fe;return r!==null&&_.add(r),_.addAll(l),this._factory.buildGeometry(_)};_o.prototype.createCoordinateSequence=function(e){return this._factory.getCoordinateSequenceFactory().create(e)};_o.prototype.getInputGeometry=function(){return this._inputGeom};_o.prototype.transformMultiLineString=function(e,t){for(var n=this,i=new fe,r=0;r<e.getNumGeometries();r++){var l=n.transformLineString(e.getGeometryN(r),e);l!==null&&(l.isEmpty()||i.add(l))}return this._factory.buildGeometry(i)};_o.prototype.transformCoordinates=function(e,t){return this.copy(e)};_o.prototype.transformLineString=function(e,t){return this._factory.createLineString(this.transformCoordinates(e.getCoordinateSequence(),e))};_o.prototype.transformMultiPoint=function(e,t){for(var n=this,i=new fe,r=0;r<e.getNumGeometries();r++){var l=n.transformPoint(e.getGeometryN(r),e);l!==null&&(l.isEmpty()||i.add(l))}return this._factory.buildGeometry(i)};_o.prototype.transformMultiPolygon=function(e,t){for(var n=this,i=new fe,r=0;r<e.getNumGeometries();r++){var l=n.transformPolygon(e.getGeometryN(r),e);l!==null&&(l.isEmpty()||i.add(l))}return this._factory.buildGeometry(i)};_o.prototype.copy=function(e){return e.copy()};_o.prototype.transformGeometryCollection=function(e,t){for(var n=this,i=new fe,r=0;r<e.getNumGeometries();r++){var l=n.transform(e.getGeometryN(r));l!==null&&(n._pruneEmptyGeometry&&l.isEmpty()||i.add(l))}return this._preserveGeometryCollectionType?this._factory.createGeometryCollection(mn.toGeometryArray(i)):this._factory.buildGeometry(i)};_o.prototype.transform=function(e){if(this._inputGeom=e,this._factory=e.getFactory(),e instanceof Mo)return this.transformPoint(e,null);if(e instanceof jh)return this.transformMultiPoint(e,null);if(e instanceof Va)return this.transformLinearRing(e,null);if(e instanceof Pi)return this.transformLineString(e,null);if(e instanceof Ou)return this.transformMultiLineString(e,null);if(e instanceof er)return this.transformPolygon(e,null);if(e instanceof za)return this.transformMultiPolygon(e,null);if(e instanceof eo)return this.transformGeometryCollection(e,null);throw new _i("Unknown Geometry subtype: "+e.getClass().getName())};_o.prototype.transformLinearRing=function(e,t){var n=this.transformCoordinates(e.getCoordinateSequence(),e);if(n===null)return this._factory.createLinearRing(null);var i=n.size();return i>0&&i<4&&!this._preserveType?this._factory.createLineString(n):this._factory.createLinearRing(n)};_o.prototype.interfaces_=function(){return[]};_o.prototype.getClass=function(){return _o};var Za=function e(){if(this._snapTolerance=0,this._srcPts=null,this._seg=new ze,this._allowSnappingToSourceVertices=!1,this._isClosed=!1,arguments[0]instanceof Pi&&typeof arguments[1]=="number"){var t=arguments[0],n=arguments[1];e.call(this,t.getCoordinates(),n)}else if(arguments[0]instanceof Array&&typeof arguments[1]=="number"){var i=arguments[0],r=arguments[1];this._srcPts=i,this._isClosed=e.isClosed(i),this._snapTolerance=r}};Za.prototype.snapVertices=function(e,t){for(var n=this,i=this._isClosed?e.size()-1:e.size(),r=0;r<i;r++){var l=e.get(r),f=n.findSnapForVertex(l,t);f!==null&&(e.set(r,new Dt(f)),r===0&&n._isClosed&&e.set(e.size()-1,new Dt(f)))}};Za.prototype.findSnapForVertex=function(e,t){for(var n=this,i=0;i<t.length;i++){if(e.equals2D(t[i]))return null;if(e.distance(t[i])<n._snapTolerance)return t[i]}return null};Za.prototype.snapTo=function(e){var t=new md(this._srcPts);this.snapVertices(t,e),this.snapSegments(t,e);var n=t.toCoordinateArray();return n};Za.prototype.snapSegments=function(e,t){var n=this;if(t.length===0)return null;var i=t.length;t[0].equals2D(t[t.length-1])&&(i=t.length-1);for(var r=0;r<i;r++){var l=t[r],f=n.findSegmentIndexToSnap(l,e);f>=0&&e.add(f+1,new Dt(l),!1)}};Za.prototype.findSegmentIndexToSnap=function(e,t){for(var n=this,i=tn.MAX_VALUE,r=-1,l=0;l<t.size()-1;l++){if(n._seg.p0=t.get(l),n._seg.p1=t.get(l+1),n._seg.p0.equals2D(e)||n._seg.p1.equals2D(e)){if(n._allowSnappingToSourceVertices)continue;return-1}var f=n._seg.distance(e);f<n._snapTolerance&&f<i&&(i=f,r=l)}return r};Za.prototype.setAllowSnappingToSourceVertices=function(e){this._allowSnappingToSourceVertices=e};Za.prototype.interfaces_=function(){return[]};Za.prototype.getClass=function(){return Za};Za.isClosed=function(e){return e.length<=1?!1:e[0].equals2D(e[e.length-1])};var Oi=function(e){this._srcGeom=e||null},jx={SNAP_PRECISION_FACTOR:{configurable:!0}};Oi.prototype.snapTo=function(e,t){var n=this.extractTargetCoordinates(e),i=new qx(t,n);return i.transform(this._srcGeom)};Oi.prototype.snapToSelf=function(e,t){var n=this.extractTargetCoordinates(this._srcGeom),i=new qx(e,n,!0),r=i.transform(this._srcGeom),l=r;return t&&We(l,Hl)&&(l=r.buffer(0)),l};Oi.prototype.computeSnapTolerance=function(e){var t=this.computeMinimumSegmentLength(e),n=t/10;return n};Oi.prototype.extractTargetCoordinates=function(e){for(var t=new ca,n=e.getCoordinates(),i=0;i<n.length;i++)t.add(n[i]);return t.toArray(new Array(0).fill(null))};Oi.prototype.computeMinimumSegmentLength=function(e){for(var t=tn.MAX_VALUE,n=0;n<e.length-1;n++){var i=e[n].distance(e[n+1]);i<t&&(t=i)}return t};Oi.prototype.interfaces_=function(){return[]};Oi.prototype.getClass=function(){return Oi};Oi.snap=function(e,t,n){var i=new Array(2).fill(null),r=new Oi(e);i[0]=r.snapTo(t,n);var l=new Oi(t);return i[1]=l.snapTo(i[0],n),i};Oi.computeOverlaySnapTolerance=function(){if(arguments.length===1){var e=arguments[0],t=Oi.computeSizeBasedSnapTolerance(e),n=e.getPrecisionModel();if(n.getType()===Dn.FIXED){var i=1/n.getScale()*2/1.415;i>t&&(t=i)}return t}else if(arguments.length===2){var r=arguments[0],l=arguments[1];return Math.min(Oi.computeOverlaySnapTolerance(r),Oi.computeOverlaySnapTolerance(l))}};Oi.computeSizeBasedSnapTolerance=function(e){var t=e.getEnvelopeInternal(),n=Math.min(t.getHeight(),t.getWidth()),i=n*Oi.SNAP_PRECISION_FACTOR;return i};Oi.snapToSelf=function(e,t,n){var i=new Oi(e);return i.snapToSelf(t,n)};jx.SNAP_PRECISION_FACTOR.get=function(){return 1e-9};Object.defineProperties(Oi,jx);var qx=function(e){function t(n,i,r){e.call(this),this._snapTolerance=n||null,this._snapPts=i||null,this._isSelfSnap=r!==void 0?r:!1}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.snapLine=function(n,i){var r=new Za(n,this._snapTolerance);return r.setAllowSnappingToSourceVertices(this._isSelfSnap),r.snapTo(i)},t.prototype.transformCoordinates=function(n,i){var r=n.toCoordinateArray(),l=this.snapLine(r,this._snapPts);return this._factory.getCoordinateSequenceFactory().create(l)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(_o),Yr=function(){this._isFirst=!0,this._commonMantissaBitsCount=53,this._commonBits=0,this._commonSignExp=null};Yr.prototype.getCommon=function(){return tn.longBitsToDouble(this._commonBits)};Yr.prototype.add=function(e){var t=tn.doubleToLongBits(e);if(this._isFirst)return this._commonBits=t,this._commonSignExp=Yr.signExpBits(this._commonBits),this._isFirst=!1,null;var n=Yr.signExpBits(t);if(n!==this._commonSignExp)return this._commonBits=0,null;this._commonMantissaBitsCount=Yr.numCommonMostSigMantissaBits(this._commonBits,t),this._commonBits=Yr.zeroLowerBits(this._commonBits,64-(12+this._commonMantissaBitsCount))};Yr.prototype.toString=function(){if(arguments.length===1){var e=arguments[0],t=tn.longBitsToDouble(e),n=tn.toBinaryString(e),i="0000000000000000000000000000000000000000000000000000000000000000"+n,r=i.substring(i.length-64),l=r.substring(0,1)+"  "+r.substring(1,12)+"(exp) "+r.substring(12)+" [ "+t+" ]";return l}};Yr.prototype.interfaces_=function(){return[]};Yr.prototype.getClass=function(){return Yr};Yr.getBit=function(e,t){var n=1<<t;return e&n?1:0};Yr.signExpBits=function(e){return e>>52};Yr.zeroLowerBits=function(e,t){var n=(1<<t)-1,i=~n,r=e&i;return r};Yr.numCommonMostSigMantissaBits=function(e,t){for(var n=0,i=52;i>=0;i--){if(Yr.getBit(e,i)!==Yr.getBit(t,i))return n;n++}return 52};var nu=function(){this._commonCoord=null,this._ccFilter=new kc},Wy={CommonCoordinateFilter:{configurable:!0},Translater:{configurable:!0}};nu.prototype.addCommonBits=function(e){var t=new iu(this._commonCoord);e.apply(t),e.geometryChanged()};nu.prototype.removeCommonBits=function(e){if(this._commonCoord.x===0&&this._commonCoord.y===0)return e;var t=new Dt(this._commonCoord);t.x=-t.x,t.y=-t.y;var n=new iu(t);return e.apply(n),e.geometryChanged(),e};nu.prototype.getCommonCoordinate=function(){return this._commonCoord};nu.prototype.add=function(e){e.apply(this._ccFilter),this._commonCoord=this._ccFilter.getCommonCoordinate()};nu.prototype.interfaces_=function(){return[]};nu.prototype.getClass=function(){return nu};Wy.CommonCoordinateFilter.get=function(){return kc};Wy.Translater.get=function(){return iu};Object.defineProperties(nu,Wy);var kc=function(){this._commonBitsX=new Yr,this._commonBitsY=new Yr};kc.prototype.filter=function(e){this._commonBitsX.add(e.x),this._commonBitsY.add(e.y)};kc.prototype.getCommonCoordinate=function(){return new Dt(this._commonBitsX.getCommon(),this._commonBitsY.getCommon())};kc.prototype.interfaces_=function(){return[Ba]};kc.prototype.getClass=function(){return kc};var iu=function(){this.trans=null;var e=arguments[0];this.trans=e};iu.prototype.filter=function(e,t){var n=e.getOrdinate(t,0)+this.trans.x,i=e.getOrdinate(t,1)+this.trans.y;e.setOrdinate(t,0,n),e.setOrdinate(t,1,i)};iu.prototype.isDone=function(){return!1};iu.prototype.isGeometryChanged=function(){return!0};iu.prototype.interfaces_=function(){return[Ds]};iu.prototype.getClass=function(){return iu};var Sr=function(e,t){this._geom=new Array(2).fill(null),this._snapTolerance=null,this._cbr=null,this._geom[0]=e,this._geom[1]=t,this.computeSnapTolerance()};Sr.prototype.selfSnap=function(e){var t=new Oi(e),n=t.snapTo(e,this._snapTolerance);return n};Sr.prototype.removeCommonBits=function(e){this._cbr=new nu,this._cbr.add(e[0]),this._cbr.add(e[1]);var t=new Array(2).fill(null);return t[0]=this._cbr.removeCommonBits(e[0].copy()),t[1]=this._cbr.removeCommonBits(e[1].copy()),t};Sr.prototype.prepareResult=function(e){return this._cbr.addCommonBits(e),e};Sr.prototype.getResultGeometry=function(e){var t=this.snap(this._geom),n=sn.overlayOp(t[0],t[1],e);return this.prepareResult(n)};Sr.prototype.checkValid=function(e){e.isValid()||Lr.out.println("Snapped geometry is invalid")};Sr.prototype.computeSnapTolerance=function(){this._snapTolerance=Oi.computeOverlaySnapTolerance(this._geom[0],this._geom[1])};Sr.prototype.snap=function(e){var t=this.removeCommonBits(e),n=Oi.snap(t[0],t[1],this._snapTolerance);return n};Sr.prototype.interfaces_=function(){return[]};Sr.prototype.getClass=function(){return Sr};Sr.overlayOp=function(e,t,n){var i=new Sr(e,t);return i.getResultGeometry(n)};Sr.union=function(e,t){return Sr.overlayOp(e,t,sn.UNION)};Sr.intersection=function(e,t){return Sr.overlayOp(e,t,sn.INTERSECTION)};Sr.symDifference=function(e,t){return Sr.overlayOp(e,t,sn.SYMDIFFERENCE)};Sr.difference=function(e,t){return Sr.overlayOp(e,t,sn.DIFFERENCE)};var ro=function(e,t){this._geom=new Array(2).fill(null),this._geom[0]=e,this._geom[1]=t};ro.prototype.getResultGeometry=function(e){var t=null,n=!1,i=null;try{t=sn.overlayOp(this._geom[0],this._geom[1],e);var r=!0;r&&(n=!0)}catch(l){if(l instanceof dl)i=l;else throw l}finally{}if(!n)try{t=Sr.overlayOp(this._geom[0],this._geom[1],e)}catch(l){throw l instanceof dl?i:l}finally{}return t};ro.prototype.interfaces_=function(){return[]};ro.prototype.getClass=function(){return ro};ro.overlayOp=function(e,t,n){var i=new ro(e,t);return i.getResultGeometry(n)};ro.union=function(e,t){return ro.overlayOp(e,t,sn.UNION)};ro.intersection=function(e,t){return ro.overlayOp(e,t,sn.INTERSECTION)};ro.symDifference=function(e,t){return ro.overlayOp(e,t,sn.SYMDIFFERENCE)};ro.difference=function(e,t){return ro.overlayOp(e,t,sn.DIFFERENCE)};var rd=function(){this.mce=null,this.chainIndex=null;var e=arguments[0],t=arguments[1];this.mce=e,this.chainIndex=t};rd.prototype.computeIntersections=function(e,t){this.mce.computeIntersectsForChain(this.chainIndex,e.mce,e.chainIndex,t)};rd.prototype.interfaces_=function(){return[]};rd.prototype.getClass=function(){return rd};var Ao=function e(){if(this._label=null,this._xValue=null,this._eventType=null,this._insertEvent=null,this._deleteEventIndex=null,this._obj=null,arguments.length===2){var t=arguments[0],n=arguments[1];this._eventType=e.DELETE,this._xValue=t,this._insertEvent=n}else if(arguments.length===3){var i=arguments[0],r=arguments[1],l=arguments[2];this._eventType=e.INSERT,this._label=i,this._xValue=r,this._obj=l}},Xy={INSERT:{configurable:!0},DELETE:{configurable:!0}};Ao.prototype.isDelete=function(){return this._eventType===Ao.DELETE};Ao.prototype.setDeleteEventIndex=function(e){this._deleteEventIndex=e};Ao.prototype.getObject=function(){return this._obj};Ao.prototype.compareTo=function(e){var t=e;return this._xValue<t._xValue?-1:this._xValue>t._xValue?1:this._eventType<t._eventType?-1:this._eventType>t._eventType?1:0};Ao.prototype.getInsertEvent=function(){return this._insertEvent};Ao.prototype.isInsert=function(){return this._eventType===Ao.INSERT};Ao.prototype.isSameLabel=function(e){return this._label===null?!1:this._label===e._label};Ao.prototype.getDeleteEventIndex=function(){return this._deleteEventIndex};Ao.prototype.interfaces_=function(){return[bs]};Ao.prototype.getClass=function(){return Ao};Xy.INSERT.get=function(){return 1};Xy.DELETE.get=function(){return 2};Object.defineProperties(Ao,Xy);var rg=function(){};rg.prototype.interfaces_=function(){return[]};rg.prototype.getClass=function(){return rg};var kr=function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._properIntersectionPoint=null,this._li=null,this._includeProper=null,this._recordIsolated=null,this._isSelfIntersection=null,this._numIntersections=0,this.numTests=0,this._bdyNodes=null,this._isDone=!1,this._isDoneWhenProperInt=!1;var e=arguments[0],t=arguments[1],n=arguments[2];this._li=e,this._includeProper=t,this._recordIsolated=n};kr.prototype.isTrivialIntersection=function(e,t,n,i){if(e===n&&this._li.getIntersectionNum()===1){if(kr.isAdjacentSegments(t,i))return!0;if(e.isClosed()){var r=e.getNumPoints()-1;if(t===0&&i===r||i===0&&t===r)return!0}}return!1};kr.prototype.getProperIntersectionPoint=function(){return this._properIntersectionPoint};kr.prototype.setIsDoneIfProperInt=function(e){this._isDoneWhenProperInt=e};kr.prototype.hasProperInteriorIntersection=function(){return this._hasProperInterior};kr.prototype.isBoundaryPointInternal=function(e,t){for(var n=t.iterator();n.hasNext();){var i=n.next(),r=i.getCoordinate();if(e.isIntersection(r))return!0}return!1};kr.prototype.hasProperIntersection=function(){return this._hasProper};kr.prototype.hasIntersection=function(){return this._hasIntersection};kr.prototype.isDone=function(){return this._isDone};kr.prototype.isBoundaryPoint=function(e,t){return t===null?!1:!!(this.isBoundaryPointInternal(e,t[0])||this.isBoundaryPointInternal(e,t[1]))};kr.prototype.setBoundaryNodes=function(e,t){this._bdyNodes=new Array(2).fill(null),this._bdyNodes[0]=e,this._bdyNodes[1]=t};kr.prototype.addIntersections=function(e,t,n,i){if(e===n&&t===i)return null;this.numTests++;var r=e.getCoordinates()[t],l=e.getCoordinates()[t+1],f=n.getCoordinates()[i],a=n.getCoordinates()[i+1];this._li.computeIntersection(r,l,f,a),this._li.hasIntersection()&&(this._recordIsolated&&(e.setIsolated(!1),n.setIsolated(!1)),this._numIntersections++,this.isTrivialIntersection(e,t,n,i)||(this._hasIntersection=!0,(this._includeProper||!this._li.isProper())&&(e.addIntersections(this._li,t,0),n.addIntersections(this._li,i,1)),this._li.isProper()&&(this._properIntersectionPoint=this._li.getIntersection(0).copy(),this._hasProper=!0,this._isDoneWhenProperInt&&(this._isDone=!0),this.isBoundaryPoint(this._li,this._bdyNodes)||(this._hasProperInterior=!0))))};kr.prototype.interfaces_=function(){return[]};kr.prototype.getClass=function(){return kr};kr.isAdjacentSegments=function(e,t){return Math.abs(e-t)===1};var RC=function(e){function t(){e.call(this),this.events=new fe,this.nOverlaps=null}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.prepareEvents=function(){var n=this;Os.sort(this.events);for(var i=0;i<this.events.size();i++){var r=n.events.get(i);r.isDelete()&&r.getInsertEvent().setDeleteEventIndex(i)}},t.prototype.computeIntersections=function(){var n=this;if(arguments.length===1){var i=arguments[0];this.nOverlaps=0,this.prepareEvents();for(var r=0;r<this.events.size();r++){var l=n.events.get(r);if(l.isInsert()&&n.processOverlaps(r,l.getDeleteEventIndex(),l,i),i.isDone())break}}else if(arguments.length===3){if(arguments[2]instanceof kr&&We(arguments[0],As)&&We(arguments[1],As)){var f=arguments[0],a=arguments[1],_=arguments[2];this.addEdges(f,f),this.addEdges(a,a),this.computeIntersections(_)}else if(typeof arguments[2]=="boolean"&&We(arguments[0],As)&&arguments[1]instanceof kr){var x=arguments[0],S=arguments[1],L=arguments[2];L?this.addEdges(x,null):this.addEdges(x),this.computeIntersections(S)}}},t.prototype.addEdge=function(n,i){for(var r=this,l=n.getMonotoneChainEdge(),f=l.getStartIndexes(),a=0;a<f.length-1;a++){var _=new rd(l,a),x=new Ao(i,l.getMinX(a),_);r.events.add(x),r.events.add(new Ao(l.getMaxX(a),x))}},t.prototype.processOverlaps=function(n,i,r,l){for(var f=this,a=r.getObject(),_=n;_<i;_++){var x=f.events.get(_);if(x.isInsert()){var S=x.getObject();r.isSameLabel(x)||(a.computeIntersections(S,l),f.nOverlaps++)}}},t.prototype.addEdges=function(){var n=this;if(arguments.length===1)for(var i=arguments[0],r=i.iterator();r.hasNext();){var l=r.next();n.addEdge(l,l)}else if(arguments.length===2)for(var f=arguments[0],a=arguments[1],_=f.iterator();_.hasNext();){var x=_.next();n.addEdge(x,a)}},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(rg),$a=function(){this._min=tn.POSITIVE_INFINITY,this._max=tn.NEGATIVE_INFINITY},Zx={NodeComparator:{configurable:!0}};$a.prototype.getMin=function(){return this._min};$a.prototype.intersects=function(e,t){return!(this._min>t||this._max<e)};$a.prototype.getMax=function(){return this._max};$a.prototype.toString=function(){return Ns.toLineString(new Dt(this._min,0),new Dt(this._max,0))};$a.prototype.interfaces_=function(){return[]};$a.prototype.getClass=function(){return $a};Zx.NodeComparator.get=function(){return od};Object.defineProperties($a,Zx);var od=function(){};od.prototype.compare=function(e,t){var n=e,i=t,r=(n._min+n._max)/2,l=(i._min+i._max)/2;return r<l?-1:r>l?1:0};od.prototype.interfaces_=function(){return[Oh]};od.prototype.getClass=function(){return od};var OC=function(e){function t(){e.call(this),this._item=null;var n=arguments[0],i=arguments[1],r=arguments[2];this._min=n,this._max=i,this._item=r}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.query=function(n,i,r){if(!this.intersects(n,i))return null;r.visitItem(this._item)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}($a),zC=function(e){function t(){e.call(this),this._node1=null,this._node2=null;var n=arguments[0],i=arguments[1];this._node1=n,this._node2=i,this.buildExtent(this._node1,this._node2)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.buildExtent=function(n,i){this._min=Math.min(n._min,i._min),this._max=Math.max(n._max,i._max)},t.prototype.query=function(n,i,r){if(!this.intersects(n,i))return null;this._node1!==null&&this._node1.query(n,i,r),this._node2!==null&&this._node2.query(n,i,r)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}($a),Wa=function(){this._leaves=new fe,this._root=null,this._level=0};Wa.prototype.buildTree=function(){var e=this;Os.sort(this._leaves,new $a.NodeComparator);for(var t=this._leaves,n=null,i=new fe;;){if(e.buildLevel(t,i),i.size()===1)return i.get(0);n=t,t=i,i=n}};Wa.prototype.insert=function(e,t,n){if(this._root!==null)throw new Error("Index cannot be added to once it has been queried");this._leaves.add(new OC(e,t,n))};Wa.prototype.query=function(e,t,n){this.init(),this._root.query(e,t,n)};Wa.prototype.buildRoot=function(){if(this._root!==null)return null;this._root=this.buildTree()};Wa.prototype.printNode=function(e){Lr.out.println(Ns.toLineString(new Dt(e._min,this._level),new Dt(e._max,this._level)))};Wa.prototype.init=function(){if(this._root!==null)return null;this.buildRoot()};Wa.prototype.buildLevel=function(e,t){this._level++,t.clear();for(var n=0;n<e.size();n+=2){var i=e.get(n),r=n+1<e.size()?e.get(n):null;if(r===null)t.add(i);else{var l=new zC(e.get(n),e.get(n+1));t.add(l)}}};Wa.prototype.interfaces_=function(){return[]};Wa.prototype.getClass=function(){return Wa};var Hh=function(){this._items=new fe};Hh.prototype.visitItem=function(e){this._items.add(e)};Hh.prototype.getItems=function(){return this._items};Hh.prototype.interfaces_=function(){return[Yl]};Hh.prototype.getClass=function(){return Hh};var Yh=function(){this._index=null;var e=arguments[0];if(!We(e,Hl))throw new _i("Argument must be Polygonal");this._index=new ju(e)},Hy={SegmentVisitor:{configurable:!0},IntervalIndexedGeometry:{configurable:!0}};Yh.prototype.locate=function(e){var t=new oa(e),n=new Kh(t);return this._index.query(e.y,e.y,n),t.getLocation()};Yh.prototype.interfaces_=function(){return[Wh]};Yh.prototype.getClass=function(){return Yh};Hy.SegmentVisitor.get=function(){return Kh};Hy.IntervalIndexedGeometry.get=function(){return ju};Object.defineProperties(Yh,Hy);var Kh=function(){this._counter=null;var e=arguments[0];this._counter=e};Kh.prototype.visitItem=function(e){var t=e;this._counter.countSegment(t.getCoordinate(0),t.getCoordinate(1))};Kh.prototype.interfaces_=function(){return[Yl]};Kh.prototype.getClass=function(){return Kh};var ju=function(){this._index=new Wa;var e=arguments[0];this.init(e)};ju.prototype.init=function(e){for(var t=this,n=Er.getLines(e),i=n.iterator();i.hasNext();){var r=i.next(),l=r.getCoordinates();t.addLine(l)}};ju.prototype.addLine=function(e){for(var t=this,n=1;n<e.length;n++){var i=new ze(e[n-1],e[n]),r=Math.min(i.p0.y,i.p1.y),l=Math.max(i.p0.y,i.p1.y);t._index.insert(r,l,i)}};ju.prototype.query=function(){if(arguments.length===2){var e=arguments[0],t=arguments[1],n=new Hh;return this._index.query(e,t,n),n.getItems()}else if(arguments.length===3){var i=arguments[0],r=arguments[1],l=arguments[2];this._index.query(i,r,l)}};ju.prototype.interfaces_=function(){return[]};ju.prototype.getClass=function(){return ju};var wp=function(e){function t(){if(e.call(this),this._parentGeom=null,this._lineEdgeMap=new Lx,this._boundaryNodeRule=null,this._useBoundaryDeterminationRule=!0,this._argIndex=null,this._boundaryNodes=null,this._hasTooFewPoints=!1,this._invalidPoint=null,this._areaPtLocator=null,this._ptLocator=new Fs,arguments.length===2){var n=arguments[0],i=arguments[1],r=_s.OGC_SFS_BOUNDARY_RULE;this._argIndex=n,this._parentGeom=i,this._boundaryNodeRule=r,i!==null&&this.add(i)}else if(arguments.length===3){var l=arguments[0],f=arguments[1],a=arguments[2];this._argIndex=l,this._parentGeom=f,this._boundaryNodeRule=a,f!==null&&this.add(f)}}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.insertBoundaryPoint=function(n,i){var r=this._nodes.addNode(i),l=r.getLabel(),f=1,a=zt.NONE;a=l.getLocation(n,oe.ON),a===zt.BOUNDARY&&f++;var _=t.determineBoundary(this._boundaryNodeRule,f);l.setLocation(n,_)},t.prototype.computeSelfNodes=function(){if(arguments.length===2){var n=arguments[0],i=arguments[1];return this.computeSelfNodes(n,i,!1)}else if(arguments.length===3){var r=arguments[0],l=arguments[1],f=arguments[2],a=new kr(r,!0,!1);a.setIsDoneIfProperInt(f);var _=this.createEdgeSetIntersector(),x=this._parentGeom instanceof Va||this._parentGeom instanceof er||this._parentGeom instanceof za,S=l||!x;return _.computeIntersections(this._edges,a,S),this.addSelfIntersectionNodes(this._argIndex),a}},t.prototype.computeSplitEdges=function(n){for(var i=this._edges.iterator();i.hasNext();){var r=i.next();r.eiList.addSplitEdges(n)}},t.prototype.computeEdgeIntersections=function(n,i,r){var l=new kr(i,r,!0);l.setBoundaryNodes(this.getBoundaryNodes(),n.getBoundaryNodes());var f=this.createEdgeSetIntersector();return f.computeIntersections(this._edges,n._edges,l),l},t.prototype.getGeometry=function(){return this._parentGeom},t.prototype.getBoundaryNodeRule=function(){return this._boundaryNodeRule},t.prototype.hasTooFewPoints=function(){return this._hasTooFewPoints},t.prototype.addPoint=function(){if(arguments[0]instanceof Mo){var n=arguments[0],i=n.getCoordinate();this.insertPoint(this._argIndex,i,zt.INTERIOR)}else if(arguments[0]instanceof Dt){var r=arguments[0];this.insertPoint(this._argIndex,r,zt.INTERIOR)}},t.prototype.addPolygon=function(n){var i=this;this.addPolygonRing(n.getExteriorRing(),zt.EXTERIOR,zt.INTERIOR);for(var r=0;r<n.getNumInteriorRing();r++){var l=n.getInteriorRingN(r);i.addPolygonRing(l,zt.INTERIOR,zt.EXTERIOR)}},t.prototype.addEdge=function(n){this.insertEdge(n);var i=n.getCoordinates();this.insertPoint(this._argIndex,i[0],zt.BOUNDARY),this.insertPoint(this._argIndex,i[i.length-1],zt.BOUNDARY)},t.prototype.addLineString=function(n){var i=gn.removeRepeatedPoints(n.getCoordinates());if(i.length<2)return this._hasTooFewPoints=!0,this._invalidPoint=i[0],null;var r=new ig(i,new Un(this._argIndex,zt.INTERIOR));this._lineEdgeMap.put(n,r),this.insertEdge(r),an.isTrue(i.length>=2,"found LineString with single point"),this.insertBoundaryPoint(this._argIndex,i[0]),this.insertBoundaryPoint(this._argIndex,i[i.length-1])},t.prototype.getInvalidPoint=function(){return this._invalidPoint},t.prototype.getBoundaryPoints=function(){for(var n=this.getBoundaryNodes(),i=new Array(n.size()).fill(null),r=0,l=n.iterator();l.hasNext();){var f=l.next();i[r++]=f.getCoordinate().copy()}return i},t.prototype.getBoundaryNodes=function(){return this._boundaryNodes===null&&(this._boundaryNodes=this._nodes.getBoundaryNodes(this._argIndex)),this._boundaryNodes},t.prototype.addSelfIntersectionNode=function(n,i,r){if(this.isBoundaryNode(n,i))return null;r===zt.BOUNDARY&&this._useBoundaryDeterminationRule?this.insertBoundaryPoint(n,i):this.insertPoint(n,i,r)},t.prototype.addPolygonRing=function(n,i,r){if(n.isEmpty())return null;var l=gn.removeRepeatedPoints(n.getCoordinates());if(l.length<4)return this._hasTooFewPoints=!0,this._invalidPoint=l[0],null;var f=i,a=r;be.isCCW(l)&&(f=r,a=i);var _=new ig(l,new Un(this._argIndex,zt.BOUNDARY,f,a));this._lineEdgeMap.put(n,_),this.insertEdge(_),this.insertPoint(this._argIndex,l[0],zt.BOUNDARY)},t.prototype.insertPoint=function(n,i,r){var l=this._nodes.addNode(i),f=l.getLabel();f===null?l._label=new Un(n,r):f.setLocation(n,r)},t.prototype.createEdgeSetIntersector=function(){return new RC},t.prototype.addSelfIntersectionNodes=function(n){for(var i=this,r=this._edges.iterator();r.hasNext();)for(var l=r.next(),f=l.getLabel().getLocation(n),a=l.eiList.iterator();a.hasNext();){var _=a.next();i.addSelfIntersectionNode(n,_.coord,f)}},t.prototype.add=function(){if(arguments.length===1){var n=arguments[0];if(n.isEmpty())return null;if(n instanceof za&&(this._useBoundaryDeterminationRule=!1),n instanceof er)this.addPolygon(n);else if(n instanceof Pi)this.addLineString(n);else if(n instanceof Mo)this.addPoint(n);else if(n instanceof jh)this.addCollection(n);else if(n instanceof Ou)this.addCollection(n);else if(n instanceof za)this.addCollection(n);else if(n instanceof eo)this.addCollection(n);else throw new Error(n.getClass().getName())}else return e.prototype.add.apply(this,arguments)},t.prototype.addCollection=function(n){for(var i=this,r=0;r<n.getNumGeometries();r++){var l=n.getGeometryN(r);i.add(l)}},t.prototype.locate=function(n){return We(this._parentGeom,Hl)&&this._parentGeom.getNumGeometries()>50?(this._areaPtLocator===null&&(this._areaPtLocator=new Yh(this._parentGeom)),this._areaPtLocator.locate(n)):this._ptLocator.locate(n,this._parentGeom)},t.prototype.findEdge=function(){if(arguments.length===1){var n=arguments[0];return this._lineEdgeMap.get(n)}else return e.prototype.findEdge.apply(this,arguments)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t.determineBoundary=function(n,i){return n.isInBoundary(i)?zt.BOUNDARY:zt.INTERIOR},t}(Si),Jh=function(){if(this._li=new Zu,this._resultPrecisionModel=null,this._arg=null,arguments.length===1){var e=arguments[0];this.setComputationPrecision(e.getPrecisionModel()),this._arg=new Array(1).fill(null),this._arg[0]=new wp(0,e)}else if(arguments.length===2){var t=arguments[0],n=arguments[1],i=_s.OGC_SFS_BOUNDARY_RULE;t.getPrecisionModel().compareTo(n.getPrecisionModel())>=0?this.setComputationPrecision(t.getPrecisionModel()):this.setComputationPrecision(n.getPrecisionModel()),this._arg=new Array(2).fill(null),this._arg[0]=new wp(0,t,i),this._arg[1]=new wp(1,n,i)}else if(arguments.length===3){var r=arguments[0],l=arguments[1],f=arguments[2];r.getPrecisionModel().compareTo(l.getPrecisionModel())>=0?this.setComputationPrecision(r.getPrecisionModel()):this.setComputationPrecision(l.getPrecisionModel()),this._arg=new Array(2).fill(null),this._arg[0]=new wp(0,r,f),this._arg[1]=new wp(1,l,f)}};Jh.prototype.getArgGeometry=function(e){return this._arg[e].getGeometry()};Jh.prototype.setComputationPrecision=function(e){this._resultPrecisionModel=e,this._li.setPrecisionModel(this._resultPrecisionModel)};Jh.prototype.interfaces_=function(){return[]};Jh.prototype.getClass=function(){return Jh};var Nu=function(){};Nu.prototype.interfaces_=function(){return[]};Nu.prototype.getClass=function(){return Nu};Nu.map=function(){if(arguments[0]instanceof $e&&We(arguments[1],Nu.MapOp)){for(var e=arguments[0],t=arguments[1],n=new fe,i=0;i<e.getNumGeometries();i++){var r=t.map(e.getGeometryN(i));r!==null&&n.add(r)}return e.getFactory().buildGeometry(n)}else if(We(arguments[0],Ki)&&We(arguments[1],Nu.MapOp)){for(var l=arguments[0],f=arguments[1],a=new fe,_=l.iterator();_.hasNext();){var x=_.next(),S=f.map(x);S!==null&&a.add(S)}return a}};Nu.MapOp=function(){};var sn=function(e){function t(){var n=arguments[0],i=arguments[1];e.call(this,n,i),this._ptLocator=new Fs,this._geomFact=null,this._resultGeom=null,this._graph=null,this._edgeList=new zs,this._resultPolyList=new fe,this._resultLineList=new fe,this._resultPointList=new fe,this._graph=new Si(new Ox),this._geomFact=n.getFactory()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.insertUniqueEdge=function(n){var i=this._edgeList.findEqualEdge(n);if(i!==null){var r=i.getLabel(),l=n.getLabel();i.isPointwiseEqual(n)||(l=new Un(n.getLabel()),l.flip());var f=i.getDepth();f.isNull()&&f.add(r),f.add(l),r.merge(l)}else this._edgeList.add(n)},t.prototype.getGraph=function(){return this._graph},t.prototype.cancelDuplicateResultEdges=function(){for(var n=this._graph.getEdgeEnds().iterator();n.hasNext();){var i=n.next(),r=i.getSym();i.isInResult()&&r.isInResult()&&(i.setInResult(!1),r.setInResult(!1))}},t.prototype.isCoveredByLA=function(n){return!!(this.isCovered(n,this._resultLineList)||this.isCovered(n,this._resultPolyList))},t.prototype.computeGeometry=function(n,i,r,l){var f=new fe;return f.addAll(n),f.addAll(i),f.addAll(r),f.isEmpty()?t.createEmptyResult(l,this._arg[0].getGeometry(),this._arg[1].getGeometry(),this._geomFact):this._geomFact.buildGeometry(f)},t.prototype.mergeSymLabels=function(){for(var n=this._graph.getNodes().iterator();n.hasNext();){var i=n.next();i.getEdges().mergeSymLabels()}},t.prototype.isCovered=function(n,i){for(var r=this,l=i.iterator();l.hasNext();){var f=l.next(),a=r._ptLocator.locate(n,f);if(a!==zt.EXTERIOR)return!0}return!1},t.prototype.replaceCollapsedEdges=function(){for(var n=new fe,i=this._edgeList.iterator();i.hasNext();){var r=i.next();r.isCollapsed()&&(i.remove(),n.add(r.getCollapsedEdge()))}this._edgeList.addAll(n)},t.prototype.updateNodeLabelling=function(){for(var n=this._graph.getNodes().iterator();n.hasNext();){var i=n.next(),r=i.getEdges().getLabel();i.getLabel().merge(r)}},t.prototype.getResultGeometry=function(n){return this.computeOverlay(n),this._resultGeom},t.prototype.insertUniqueEdges=function(n){for(var i=this,r=n.iterator();r.hasNext();){var l=r.next();i.insertUniqueEdge(l)}},t.prototype.computeOverlay=function(n){this.copyPoints(0),this.copyPoints(1),this._arg[0].computeSelfNodes(this._li,!1),this._arg[1].computeSelfNodes(this._li,!1),this._arg[0].computeEdgeIntersections(this._arg[1],this._li,!0);var i=new fe;this._arg[0].computeSplitEdges(i),this._arg[1].computeSplitEdges(i),this.insertUniqueEdges(i),this.computeLabelsFromDepths(),this.replaceCollapsedEdges(),Gu.checkValid(this._edgeList.getEdges()),this._graph.addEdges(this._edgeList.getEdges()),this.computeLabelling(),this.labelIncompleteNodes(),this.findResultAreaEdges(n),this.cancelDuplicateResultEdges();var r=new Po(this._geomFact);r.add(this._graph),this._resultPolyList=r.getPolygons();var l=new ya(this,this._geomFact,this._ptLocator);this._resultLineList=l.build(n);var f=new Pc(this,this._geomFact,this._ptLocator);this._resultPointList=f.build(n),this._resultGeom=this.computeGeometry(this._resultPointList,this._resultLineList,this._resultPolyList,n)},t.prototype.labelIncompleteNode=function(n,i){var r=this._ptLocator.locate(n.getCoordinate(),this._arg[i].getGeometry());n.getLabel().setLocation(i,r)},t.prototype.copyPoints=function(n){for(var i=this,r=this._arg[n].getNodeIterator();r.hasNext();){var l=r.next(),f=i._graph.addNode(l.getCoordinate());f.setLabel(n,l.getLabel().getLocation(n))}},t.prototype.findResultAreaEdges=function(n){for(var i=this._graph.getEdgeEnds().iterator();i.hasNext();){var r=i.next(),l=r.getLabel();l.isArea()&&!r.isInteriorAreaEdge()&&t.isResultOfOp(l.getLocation(0,oe.RIGHT),l.getLocation(1,oe.RIGHT),n)&&r.setInResult(!0)}},t.prototype.computeLabelsFromDepths=function(){for(var n=this._edgeList.iterator();n.hasNext();){var i=n.next(),r=i.getLabel(),l=i.getDepth();if(!l.isNull()){l.normalize();for(var f=0;f<2;f++)!r.isNull(f)&&r.isArea()&&!l.isNull(f)&&(l.getDelta(f)===0?r.toLine(f):(an.isTrue(!l.isNull(f,oe.LEFT),"depth of LEFT side has not been initialized"),r.setLocation(f,oe.LEFT,l.getLocation(f,oe.LEFT)),an.isTrue(!l.isNull(f,oe.RIGHT),"depth of RIGHT side has not been initialized"),r.setLocation(f,oe.RIGHT,l.getLocation(f,oe.RIGHT))))}}},t.prototype.computeLabelling=function(){for(var n=this,i=this._graph.getNodes().iterator();i.hasNext();){var r=i.next();r.getEdges().computeLabelling(n._arg)}this.mergeSymLabels(),this.updateNodeLabelling()},t.prototype.labelIncompleteNodes=function(){for(var n=this,i=this._graph.getNodes().iterator();i.hasNext();){var r=i.next(),l=r.getLabel();r.isIsolated()&&(l.isNull(0)?n.labelIncompleteNode(r,0):n.labelIncompleteNode(r,1)),r.getEdges().updateLabelling(l)}},t.prototype.isCoveredByA=function(n){return!!this.isCovered(n,this._resultPolyList)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(Jh);sn.overlayOp=function(e,t,n){var i=new sn(e,t),r=i.getResultGeometry(n);return r};sn.intersection=function(e,t){if(e.isEmpty()||t.isEmpty())return sn.createEmptyResult(sn.INTERSECTION,e,t,e.getFactory());if(e.isGeometryCollection()){var n=t;return Mc.map(e,{interfaces_:function(){return[Nu.MapOp]},map:function(i){return i.intersection(n)}})}return e.checkNotGeometryCollection(e),e.checkNotGeometryCollection(t),ro.overlayOp(e,t,sn.INTERSECTION)};sn.symDifference=function(e,t){if(e.isEmpty()||t.isEmpty()){if(e.isEmpty()&&t.isEmpty())return sn.createEmptyResult(sn.SYMDIFFERENCE,e,t,e.getFactory());if(e.isEmpty())return t.copy();if(t.isEmpty())return e.copy()}return e.checkNotGeometryCollection(e),e.checkNotGeometryCollection(t),ro.overlayOp(e,t,sn.SYMDIFFERENCE)};sn.resultDimension=function(e,t,n){var i=t.getDimension(),r=n.getDimension(),l=-1;switch(e){case sn.INTERSECTION:l=Math.min(i,r);break;case sn.UNION:l=Math.max(i,r);break;case sn.DIFFERENCE:l=i;break;case sn.SYMDIFFERENCE:l=Math.max(i,r);break}return l};sn.createEmptyResult=function(e,t,n,i){var r=null;switch(sn.resultDimension(e,t,n)){case-1:r=i.createGeometryCollection(new Array(0).fill(null));break;case 0:r=i.createPoint();break;case 1:r=i.createLineString();break;case 2:r=i.createPolygon();break}return r};sn.difference=function(e,t){return e.isEmpty()?sn.createEmptyResult(sn.DIFFERENCE,e,t,e.getFactory()):t.isEmpty()?e.copy():(e.checkNotGeometryCollection(e),e.checkNotGeometryCollection(t),ro.overlayOp(e,t,sn.DIFFERENCE))};sn.isResultOfOp=function(){if(arguments.length===2){var e=arguments[0],t=arguments[1],n=e.getLocation(0),i=e.getLocation(1);return sn.isResultOfOp(n,i,t)}else if(arguments.length===3){var r=arguments[0],l=arguments[1],f=arguments[2];switch(r===zt.BOUNDARY&&(r=zt.INTERIOR),l===zt.BOUNDARY&&(l=zt.INTERIOR),f){case sn.INTERSECTION:return r===zt.INTERIOR&&l===zt.INTERIOR;case sn.UNION:return r===zt.INTERIOR||l===zt.INTERIOR;case sn.DIFFERENCE:return r===zt.INTERIOR&&l!==zt.INTERIOR;case sn.SYMDIFFERENCE:return r===zt.INTERIOR&&l!==zt.INTERIOR||r!==zt.INTERIOR&&l===zt.INTERIOR}return!1}};sn.INTERSECTION=1;sn.UNION=2;sn.DIFFERENCE=3;sn.SYMDIFFERENCE=4;var Xl=function(){this._g=null,this._boundaryDistanceTolerance=null,this._linework=null,this._ptLocator=new Fs,this._seg=new ze;var e=arguments[0],t=arguments[1];this._g=e,this._boundaryDistanceTolerance=t,this._linework=this.extractLinework(e)};Xl.prototype.isWithinToleranceOfBoundary=function(e){for(var t=this,n=0;n<this._linework.getNumGeometries();n++)for(var i=t._linework.getGeometryN(n),r=i.getCoordinateSequence(),l=0;l<r.size()-1;l++){r.getCoordinate(l,t._seg.p0),r.getCoordinate(l+1,t._seg.p1);var f=t._seg.distance(e);if(f<=t._boundaryDistanceTolerance)return!0}return!1};Xl.prototype.getLocation=function(e){return this.isWithinToleranceOfBoundary(e)?zt.BOUNDARY:this._ptLocator.locate(e,this._g)};Xl.prototype.extractLinework=function(e){var t=new Qh;e.apply(t);var n=t.getLinework(),i=mn.toLineStringArray(n);return e.getFactory().createMultiLineString(i)};Xl.prototype.interfaces_=function(){return[]};Xl.prototype.getClass=function(){return Xl};var Qh=function(){this._linework=null,this._linework=new fe};Qh.prototype.getLinework=function(){return this._linework};Qh.prototype.filter=function(e){var t=this;if(e instanceof er){var n=e;this._linework.add(n.getExteriorRing());for(var i=0;i<n.getNumInteriorRing();i++)t._linework.add(n.getInteriorRingN(i))}};Qh.prototype.interfaces_=function(){return[ha]};Qh.prototype.getClass=function(){return Qh};var qu=function(){this._g=null,this._doLeft=!0,this._doRight=!0;var e=arguments[0];this._g=e};qu.prototype.extractPoints=function(e,t,n){for(var i=this,r=e.getCoordinates(),l=0;l<r.length-1;l++)i.computeOffsetPoints(r[l],r[l+1],t,n)};qu.prototype.setSidesToGenerate=function(e,t){this._doLeft=e,this._doRight=t};qu.prototype.getPoints=function(e){for(var t=this,n=new fe,i=Er.getLines(this._g),r=i.iterator();r.hasNext();){var l=r.next();t.extractPoints(l,e,n)}return n};qu.prototype.computeOffsetPoints=function(e,t,n,i){var r=t.x-e.x,l=t.y-e.y,f=Math.sqrt(r*r+l*l),a=n*r/f,_=n*l/f,x=(t.x+e.x)/2,S=(t.y+e.y)/2;if(this._doLeft){var L=new Dt(x-_,S+a);i.add(L)}if(this._doRight){var A=new Dt(x+_,S-a);i.add(A)}};qu.prototype.interfaces_=function(){return[]};qu.prototype.getClass=function(){return qu};var Qo=function e(){this._geom=null,this._locFinder=null,this._location=new Array(3).fill(null),this._invalidLocation=null,this._boundaryDistanceTolerance=e.TOLERANCE,this._testCoords=new fe;var t=arguments[0],n=arguments[1],i=arguments[2];this._boundaryDistanceTolerance=e.computeBoundaryDistanceTolerance(t,n),this._geom=[t,n,i],this._locFinder=[new Xl(this._geom[0],this._boundaryDistanceTolerance),new Xl(this._geom[1],this._boundaryDistanceTolerance),new Xl(this._geom[2],this._boundaryDistanceTolerance)]},$x={TOLERANCE:{configurable:!0}};Qo.prototype.reportResult=function(e,t,n){Lr.out.println("Overlay result invalid - A:"+zt.toLocationSymbol(t[0])+" B:"+zt.toLocationSymbol(t[1])+" expected:"+(n?"i":"e")+" actual:"+zt.toLocationSymbol(t[2]))};Qo.prototype.isValid=function(e){this.addTestPts(this._geom[0]),this.addTestPts(this._geom[1]);var t=this.checkValid(e);return t};Qo.prototype.checkValid=function(){var e=this;if(arguments.length===1){for(var t=arguments[0],n=0;n<this._testCoords.size();n++){var i=e._testCoords.get(n);if(!e.checkValid(t,i))return e._invalidLocation=i,!1}return!0}else if(arguments.length===2){var r=arguments[0],l=arguments[1];return this._location[0]=this._locFinder[0].getLocation(l),this._location[1]=this._locFinder[1].getLocation(l),this._location[2]=this._locFinder[2].getLocation(l),Qo.hasLocation(this._location,zt.BOUNDARY)?!0:this.isValidResult(r,this._location)}};Qo.prototype.addTestPts=function(e){var t=new qu(e);this._testCoords.addAll(t.getPoints(5*this._boundaryDistanceTolerance))};Qo.prototype.isValidResult=function(e,t){var n=sn.isResultOfOp(t[0],t[1],e),i=t[2]===zt.INTERIOR,r=!(n^i);return r||this.reportResult(e,t,n),r};Qo.prototype.getInvalidLocation=function(){return this._invalidLocation};Qo.prototype.interfaces_=function(){return[]};Qo.prototype.getClass=function(){return Qo};Qo.hasLocation=function(e,t){for(var n=0;n<3;n++)if(e[n]===t)return!0;return!1};Qo.computeBoundaryDistanceTolerance=function(e,t){return Math.min(Oi.computeSizeBasedSnapTolerance(e),Oi.computeSizeBasedSnapTolerance(t))};Qo.isValid=function(e,t,n,i){var r=new Qo(e,t,i);return r.isValid(n)};$x.TOLERANCE.get=function(){return 1e-6};Object.defineProperties(Qo,$x);var Zo=function e(t){this._geomFactory=null,this._skipEmpty=!1,this._inputGeoms=null,this._geomFactory=e.extractFactory(t),this._inputGeoms=t};Zo.prototype.extractElements=function(e,t){var n=this;if(e===null)return null;for(var i=0;i<e.getNumGeometries();i++){var r=e.getGeometryN(i);n._skipEmpty&&r.isEmpty()||t.add(r)}};Zo.prototype.combine=function(){for(var e=this,t=new fe,n=this._inputGeoms.iterator();n.hasNext();){var i=n.next();e.extractElements(i,t)}return t.size()===0?this._geomFactory!==null?this._geomFactory.createGeometryCollection(null):null:this._geomFactory.buildGeometry(t)};Zo.prototype.interfaces_=function(){return[]};Zo.prototype.getClass=function(){return Zo};Zo.combine=function(){if(arguments.length===1){var e=arguments[0],t=new Zo(e);return t.combine()}else if(arguments.length===2){var n=arguments[0],i=arguments[1],r=new Zo(Zo.createList(n,i));return r.combine()}else if(arguments.length===3){var l=arguments[0],f=arguments[1],a=arguments[2],_=new Zo(Zo.createList(l,f,a));return _.combine()}};Zo.extractFactory=function(e){return e.isEmpty()?null:e.iterator().next().getFactory()};Zo.createList=function(){if(arguments.length===2){var e=arguments[0],t=arguments[1],n=new fe;return n.add(e),n.add(t),n}else if(arguments.length===3){var i=arguments[0],r=arguments[1],l=arguments[2],f=new fe;return f.add(i),f.add(r),f.add(l),f}};var Zi=function(){this._inputPolys=null,this._geomFactory=null;var e=arguments[0];this._inputPolys=e,this._inputPolys===null&&(this._inputPolys=new fe)},Wx={STRTREE_NODE_CAPACITY:{configurable:!0}};Zi.prototype.reduceToGeometries=function(e){for(var t=this,n=new fe,i=e.iterator();i.hasNext();){var r=i.next(),l=null;We(r,As)?l=t.unionTree(r):r instanceof $e&&(l=r),n.add(l)}return n};Zi.prototype.extractByEnvelope=function(e,t,n){for(var i=new fe,r=0;r<t.getNumGeometries();r++){var l=t.getGeometryN(r);l.getEnvelopeInternal().intersects(e)?i.add(l):n.add(l)}return this._geomFactory.buildGeometry(i)};Zi.prototype.unionOptimized=function(e,t){var n=e.getEnvelopeInternal(),i=t.getEnvelopeInternal();if(!n.intersects(i)){var r=Zo.combine(e,t);return r}if(e.getNumGeometries()<=1&&t.getNumGeometries()<=1)return this.unionActual(e,t);var l=n.intersection(i);return this.unionUsingEnvelopeIntersection(e,t,l)};Zi.prototype.union=function(){if(this._inputPolys===null)throw new Error("union() method cannot be called twice");if(this._inputPolys.isEmpty())return null;this._geomFactory=this._inputPolys.iterator().next().getFactory();for(var e=new Ax(Zi.STRTREE_NODE_CAPACITY),t=this._inputPolys.iterator();t.hasNext();){var n=t.next();e.insert(n.getEnvelopeInternal(),n)}this._inputPolys=null;var i=e.itemsTree(),r=this.unionTree(i);return r};Zi.prototype.binaryUnion=function(){if(arguments.length===1){var e=arguments[0];return this.binaryUnion(e,0,e.size())}else if(arguments.length===3){var t=arguments[0],n=arguments[1],i=arguments[2];if(i-n<=1){var r=Zi.getGeometry(t,n);return this.unionSafe(r,null)}else{if(i-n===2)return this.unionSafe(Zi.getGeometry(t,n),Zi.getGeometry(t,n+1));var l=Math.trunc((i+n)/2),f=this.binaryUnion(t,n,l),a=this.binaryUnion(t,l,i);return this.unionSafe(f,a)}}};Zi.prototype.repeatedUnion=function(e){for(var t=null,n=e.iterator();n.hasNext();){var i=n.next();t===null?t=i.copy():t=t.union(i)}return t};Zi.prototype.unionSafe=function(e,t){return e===null&&t===null?null:e===null?t.copy():t===null?e.copy():this.unionOptimized(e,t)};Zi.prototype.unionActual=function(e,t){return Zi.restrictToPolygons(e.union(t))};Zi.prototype.unionTree=function(e){var t=this.reduceToGeometries(e),n=this.binaryUnion(t);return n};Zi.prototype.unionUsingEnvelopeIntersection=function(e,t,n){var i=new fe,r=this.extractByEnvelope(n,e,i),l=this.extractByEnvelope(n,t,i),f=this.unionActual(r,l);i.add(f);var a=Zo.combine(i);return a};Zi.prototype.bufferUnion=function(){if(arguments.length===1){var e=arguments[0],t=e.get(0).getFactory(),n=t.buildGeometry(e),i=n.buffer(0);return i}else if(arguments.length===2){var r=arguments[0],l=arguments[1],f=r.getFactory(),a=f.createGeometryCollection([r,l]),_=a.buffer(0);return _}};Zi.prototype.interfaces_=function(){return[]};Zi.prototype.getClass=function(){return Zi};Zi.restrictToPolygons=function(e){if(We(e,Hl))return e;var t=pl.getPolygons(e);return t.size()===1?t.get(0):e.getFactory().createMultiPolygon(mn.toPolygonArray(t))};Zi.getGeometry=function(e,t){return t>=e.size()?null:e.get(t)};Zi.union=function(e){var t=new Zi(e);return t.union()};Wx.STRTREE_NODE_CAPACITY.get=function(){return 4};Object.defineProperties(Zi,Wx);var og=function(){};og.prototype.interfaces_=function(){return[]};og.prototype.getClass=function(){return og};og.union=function(e,t){if(e.isEmpty()||t.isEmpty()){if(e.isEmpty()&&t.isEmpty())return sn.createEmptyResult(sn.UNION,e,t,e.getFactory());if(e.isEmpty())return t.copy();if(t.isEmpty())return e.copy()}return e.checkNotGeometryCollection(e),e.checkNotGeometryCollection(t),ro.overlayOp(e,t,sn.UNION)};function $u(){return new sg}function sg(){this.reset()}sg.prototype={constructor:sg,reset:function(){this.s=this.t=0},add:function(e){x1(Am,e,this.t),x1(this,Am.s,this.s),this.s?this.t+=Am.t:this.s=Am.t},valueOf:function(){return this.s}};var Am=new sg;function x1(e,t,n){var i=e.s=t+n,r=i-t,l=i-r;e.t=t-l+(n-r)}var Mi=1e-6,Yn=Math.PI,fl=Yn/2,w1=Yn/4,vl=Yn*2,Tu=180/Yn,Qs=Yn/180,Qr=Math.abs,FC=Math.atan,tf=Math.atan2,Ji=Math.cos,Qi=Math.sin,ff=Math.sqrt;function Xx(e){return e>1?0:e<-1?Yn:Math.acos(e)}function Ac(e){return e>1?fl:e<-1?-fl:Math.asin(e)}function Np(){}function ag(e,t){e&&E1.hasOwnProperty(e.type)&&E1[e.type](e,t)}var S1={Feature:function(e,t){ag(e.geometry,t)},FeatureCollection:function(e,t){for(var n=e.features,i=-1,r=n.length;++i<r;)ag(n[i].geometry,t)}},E1={Sphere:function(e,t){t.sphere()},Point:function(e,t){e=e.coordinates,t.point(e[0],e[1],e[2])},MultiPoint:function(e,t){for(var n=e.coordinates,i=-1,r=n.length;++i<r;)e=n[i],t.point(e[0],e[1],e[2])},LineString:function(e,t){by(e.coordinates,t,0)},MultiLineString:function(e,t){for(var n=e.coordinates,i=-1,r=n.length;++i<r;)by(n[i],t,0)},Polygon:function(e,t){I1(e.coordinates,t)},MultiPolygon:function(e,t){for(var n=e.coordinates,i=-1,r=n.length;++i<r;)I1(n[i],t)},GeometryCollection:function(e,t){for(var n=e.geometries,i=-1,r=n.length;++i<r;)ag(n[i],t)}};function by(e,t,n){var i=-1,r=e.length-n,l;for(t.lineStart();++i<r;)l=e[i],t.point(l[0],l[1],l[2]);t.lineEnd()}function I1(e,t){var n=-1,i=e.length;for(t.polygonStart();++n<i;)by(e[n],t,1);t.polygonEnd()}function BC(e,t){e&&S1.hasOwnProperty(e.type)?S1[e.type](e,t):ag(e,t)}$u();$u();function xy(e){return[tf(e[1],e[0]),Ac(e[2])]}function ef(e){var t=e[0],n=e[1],i=Ji(n);return[i*Ji(t),i*Qi(t),Qi(n)]}function Nm(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function lg(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}function Y_(e,t){e[0]+=t[0],e[1]+=t[1],e[2]+=t[2]}function Dm(e,t){return[e[0]*t,e[1]*t,e[2]*t]}function wy(e){var t=ff(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]/=t,e[1]/=t,e[2]/=t}$u();function Hx(e,t){function n(i,r){return i=e(i,r),t(i[0],i[1])}return e.invert&&t.invert&&(n.invert=function(i,r){return i=t.invert(i,r),i&&e.invert(i[0],i[1])}),n}function Sy(e,t){return[e>Yn?e-vl:e<-Yn?e+vl:e,t]}Sy.invert=Sy;function VC(e,t,n){return(e%=vl)?t||n?Hx(T1(e),L1(t,n)):T1(e):t||n?L1(t,n):Sy}function C1(e){return function(t,n){return t+=e,[t>Yn?t-vl:t<-Yn?t+vl:t,n]}}function T1(e){var t=C1(e);return t.invert=C1(-e),t}function L1(e,t){var n=Ji(e),i=Qi(e),r=Ji(t),l=Qi(t);function f(a,_){var x=Ji(_),S=Ji(a)*x,L=Qi(a)*x,A=Qi(_),P=A*n+S*i;return[tf(L*r-P*l,S*n-A*i),Ac(P*r+L*l)]}return f.invert=function(a,_){var x=Ji(_),S=Ji(a)*x,L=Qi(a)*x,A=Qi(_),P=A*r-L*l;return[tf(L*r+A*l,S*n+P*i),Ac(P*n-S*i)]},f}function UC(e,t,n,i,r,l){if(n){var f=Ji(t),a=Qi(t),_=i*n;r==null?(r=t+i*vl,l=t-_/2):(r=M1(f,r),l=M1(f,l),(i>0?r<l:r>l)&&(r+=i*vl));for(var x,S=r;i>0?S>l:S<l;S-=_)x=xy([f,-a*Ji(S),-a*Qi(S)]),e.point(x[0],x[1])}}function M1(e,t){t=ef(t),t[0]-=e,wy(t);var n=Xx(-t[1]);return((-t[2]<0?-n:n)+vl-Mi)%vl}function Yx(){var e=[],t;return{point:function(n,i){t.push([n,i])},lineStart:function(){e.push(t=[])},lineEnd:Np,rejoin:function(){e.length>1&&e.push(e.pop().concat(e.shift()))},result:function(){var n=e;return e=[],t=null,n}}}function GC(e,t,n,i,r,l){var f=e[0],a=e[1],_=t[0],x=t[1],S=0,L=1,A=_-f,P=x-a,O;if(O=n-f,!(!A&&O>0)){if(O/=A,A<0){if(O<S)return;O<L&&(L=O)}else if(A>0){if(O>L)return;O>S&&(S=O)}if(O=r-f,!(!A&&O<0)){if(O/=A,A<0){if(O>L)return;O>S&&(S=O)}else if(A>0){if(O<S)return;O<L&&(L=O)}if(O=i-a,!(!P&&O>0)){if(O/=P,P<0){if(O<S)return;O<L&&(L=O)}else if(P>0){if(O>L)return;O>S&&(S=O)}if(O=l-a,!(!P&&O<0)){if(O/=P,P<0){if(O>L)return;O>S&&(S=O)}else if(P>0){if(O<S)return;O<L&&(L=O)}return S>0&&(e[0]=f+S*A,e[1]=a+S*P),L<1&&(t[0]=f+L*A,t[1]=a+L*P),!0}}}}}function jm(e,t){return Qr(e[0]-t[0])<Mi&&Qr(e[1]-t[1])<Mi}function Rm(e,t,n,i){this.x=e,this.z=t,this.o=n,this.e=i,this.v=!1,this.n=this.p=null}function Kx(e,t,n,i,r){var l=[],f=[],a,_;if(e.forEach(function(O){if(!((B=O.length-1)<=0)){var B,U=O[0],Y=O[B],V;if(jm(U,Y)){for(r.lineStart(),a=0;a<B;++a)r.point((U=O[a])[0],U[1]);r.lineEnd();return}l.push(V=new Rm(U,O,null,!0)),f.push(V.o=new Rm(U,null,V,!1)),l.push(V=new Rm(Y,O,null,!1)),f.push(V.o=new Rm(Y,null,V,!0))}}),!!l.length){for(f.sort(t),P1(l),P1(f),a=0,_=f.length;a<_;++a)f[a].e=n=!n;for(var x=l[0],S,L;;){for(var A=x,P=!0;A.v;)if((A=A.n)===x)return;S=A.z,r.lineStart();do{if(A.v=A.o.v=!0,A.e){if(P)for(a=0,_=S.length;a<_;++a)r.point((L=S[a])[0],L[1]);else i(A.x,A.n.x,1,r);A=A.n}else{if(P)for(S=A.p.z,a=S.length-1;a>=0;--a)r.point((L=S[a])[0],L[1]);else i(A.x,A.p.x,-1,r);A=A.p}A=A.o,S=A.z,P=!P}while(!A.v);r.lineEnd()}}}function P1(e){if(t=e.length){for(var t,n=0,i=e[0],r;++n<t;)i.n=r=e[n],r.p=i,i=r;i.n=r=e[0],r.p=i}}function Jx(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function jC(e){return e.length===1&&(e=qC(e)),{left:function(t,n,i,r){for(i==null&&(i=0),r==null&&(r=t.length);i<r;){var l=i+r>>>1;e(t[l],n)<0?i=l+1:r=l}return i},right:function(t,n,i,r){for(i==null&&(i=0),r==null&&(r=t.length);i<r;){var l=i+r>>>1;e(t[l],n)>0?r=l:i=l+1}return i}}}function qC(e){return function(t,n){return Jx(e(t),n)}}jC(Jx);function Qx(e){for(var t=e.length,n,i=-1,r=0,l,f;++i<t;)r+=e[i].length;for(l=new Array(r);--t>=0;)for(f=e[t],n=f.length;--n>=0;)l[--r]=f[n];return l}var Dp=1e9,Om=-Dp;function ZC(e,t,n,i){function r(x,S){return e<=x&&x<=n&&t<=S&&S<=i}function l(x,S,L,A){var P=0,O=0;if(x==null||(P=f(x,L))!==(O=f(S,L))||_(x,S)<0^L>0)do A.point(P===0||P===3?e:n,P>1?i:t);while((P=(P+L+4)%4)!==O);else A.point(S[0],S[1])}function f(x,S){return Qr(x[0]-e)<Mi?S>0?0:3:Qr(x[0]-n)<Mi?S>0?2:1:Qr(x[1]-t)<Mi?S>0?1:0:S>0?3:2}function a(x,S){return _(x.x,S.x)}function _(x,S){var L=f(x,1),A=f(S,1);return L!==A?L-A:L===0?S[1]-x[1]:L===1?x[0]-S[0]:L===2?x[1]-S[1]:S[0]-x[0]}return function(x){var S=x,L=Yx(),A,P,O,B,U,Y,V,$,K,it,ft,pt={point:gt,lineStart:vt,lineEnd:ee,polygonStart:St,polygonEnd:_t};function gt(Gt,Qt){r(Gt,Qt)&&S.point(Gt,Qt)}function ut(){for(var Gt=0,Qt=0,se=P.length;Qt<se;++Qt)for(var Ce=P[Qt],yn=1,jn=Ce.length,Qe=Ce[0],Fe,ke,fn=Qe[0],Kn=Qe[1];yn<jn;++yn)Fe=fn,ke=Kn,Qe=Ce[yn],fn=Qe[0],Kn=Qe[1],ke<=i?Kn>i&&(fn-Fe)*(i-ke)>(Kn-ke)*(e-Fe)&&++Gt:Kn<=i&&(fn-Fe)*(i-ke)<(Kn-ke)*(e-Fe)&&--Gt;return Gt}function St(){S=L,A=[],P=[],ft=!0}function _t(){var Gt=ut(),Qt=ft&&Gt,se=(A=Qx(A)).length;(Qt||se)&&(x.polygonStart(),Qt&&(x.lineStart(),l(null,null,1,x),x.lineEnd()),se&&Kx(A,a,Gt,l,x),x.polygonEnd()),S=x,A=P=O=null}function vt(){pt.point=kt,P&&P.push(O=[]),it=!0,K=!1,V=$=NaN}function ee(){A&&(kt(B,U),Y&&K&&L.rejoin(),A.push(L.result())),pt.point=gt,K&&S.lineEnd()}function kt(Gt,Qt){var se=r(Gt,Qt);if(P&&O.push([Gt,Qt]),it)B=Gt,U=Qt,Y=se,it=!1,se&&(S.lineStart(),S.point(Gt,Qt));else if(se&&K)S.point(Gt,Qt);else{var Ce=[V=Math.max(Om,Math.min(Dp,V)),$=Math.max(Om,Math.min(Dp,$))],yn=[Gt=Math.max(Om,Math.min(Dp,Gt)),Qt=Math.max(Om,Math.min(Dp,Qt))];GC(Ce,yn,e,t,n,i)?(K||(S.lineStart(),S.point(Ce[0],Ce[1])),S.point(yn[0],yn[1]),se||S.lineEnd(),ft=!1):se&&(S.lineStart(),S.point(Gt,Qt),ft=!1)}V=Gt,$=Qt,K=se}return pt}}var K_=$u();function $C(e,t){var n=t[0],i=t[1],r=[Qi(n),-Ji(n),0],l=0,f=0;K_.reset();for(var a=0,_=e.length;a<_;++a)if(S=(x=e[a]).length)for(var x,S,L=x[S-1],A=L[0],P=L[1]/2+w1,O=Qi(P),B=Ji(P),U=0;U<S;++U,A=V,O=K,B=it,L=Y){var Y=x[U],V=Y[0],$=Y[1]/2+w1,K=Qi($),it=Ji($),ft=V-A,pt=ft>=0?1:-1,gt=pt*ft,ut=gt>Yn,St=O*K;if(K_.add(tf(St*pt*Qi(gt),B*it+St*Ji(gt))),l+=ut?ft+pt*vl:ft,ut^A>=n^V>=n){var _t=lg(ef(L),ef(Y));wy(_t);var vt=lg(r,_t);wy(vt);var ee=(ut^ft>=0?-1:1)*Ac(vt[2]);(i>ee||i===ee&&(_t[0]||_t[1]))&&(f+=ut^ft>=0?1:-1)}}return(l<-Mi||l<Mi&&K_<-Mi)^f&1}$u();function k1(e){return e}$u();$u();var nf=1/0,ug=nf,sd=-nf,cg=sd,A1={point:WC,lineStart:Np,lineEnd:Np,polygonStart:Np,polygonEnd:Np,result:function(){var e=[[nf,ug],[sd,cg]];return sd=cg=-(ug=nf=1/0),e}};function WC(e,t){e<nf&&(nf=e),e>sd&&(sd=e),t<ug&&(ug=t),t>cg&&(cg=t)}$u();function tw(e,t,n,i){return function(r,l){var f=t(l),a=r.invert(i[0],i[1]),_=Yx(),x=t(_),S=!1,L,A,P,O={point:B,lineStart:Y,lineEnd:V,polygonStart:function(){O.point=$,O.lineStart=K,O.lineEnd=it,A=[],L=[]},polygonEnd:function(){O.point=B,O.lineStart=Y,O.lineEnd=V,A=Qx(A);var ft=$C(L,a);A.length?(S||(l.polygonStart(),S=!0),Kx(A,HC,ft,n,l)):ft&&(S||(l.polygonStart(),S=!0),l.lineStart(),n(null,null,1,l),l.lineEnd()),S&&(l.polygonEnd(),S=!1),A=L=null},sphere:function(){l.polygonStart(),l.lineStart(),n(null,null,1,l),l.lineEnd(),l.polygonEnd()}};function B(ft,pt){var gt=r(ft,pt);e(ft=gt[0],pt=gt[1])&&l.point(ft,pt)}function U(ft,pt){var gt=r(ft,pt);f.point(gt[0],gt[1])}function Y(){O.point=U,f.lineStart()}function V(){O.point=B,f.lineEnd()}function $(ft,pt){P.push([ft,pt]);var gt=r(ft,pt);x.point(gt[0],gt[1])}function K(){x.lineStart(),P=[]}function it(){$(P[0][0],P[0][1]),x.lineEnd();var ft=x.clean(),pt=_.result(),gt,ut=pt.length,St,_t,vt;if(P.pop(),L.push(P),P=null,!!ut){if(ft&1){if(_t=pt[0],(St=_t.length-1)>0){for(S||(l.polygonStart(),S=!0),l.lineStart(),gt=0;gt<St;++gt)l.point((vt=_t[gt])[0],vt[1]);l.lineEnd()}return}ut>1&&ft&2&&pt.push(pt.pop().concat(pt.shift())),A.push(pt.filter(XC))}}return O}}function XC(e){return e.length>1}function HC(e,t){return((e=e.x)[0]<0?e[1]-fl-Mi:fl-e[1])-((t=t.x)[0]<0?t[1]-fl-Mi:fl-t[1])}const N1=tw(function(){return!0},YC,JC,[-Yn,-fl]);function YC(e){var t=NaN,n=NaN,i=NaN,r;return{lineStart:function(){e.lineStart(),r=1},point:function(l,f){var a=l>0?Yn:-Yn,_=Qr(l-t);Qr(_-Yn)<Mi?(e.point(t,n=(n+f)/2>0?fl:-fl),e.point(i,n),e.lineEnd(),e.lineStart(),e.point(a,n),e.point(l,n),r=0):i!==a&&_>=Yn&&(Qr(t-i)<Mi&&(t-=i*Mi),Qr(l-a)<Mi&&(l-=a*Mi),n=KC(t,n,l,f),e.point(i,n),e.lineEnd(),e.lineStart(),e.point(a,n),r=0),e.point(t=l,n=f),i=a},lineEnd:function(){e.lineEnd(),t=n=NaN},clean:function(){return 2-r}}}function KC(e,t,n,i){var r,l,f=Qi(e-n);return Qr(f)>Mi?FC((Qi(t)*(l=Ji(i))*Qi(n)-Qi(i)*(r=Ji(t))*Qi(e))/(r*l*f)):(t+i)/2}function JC(e,t,n,i){var r;if(e==null)r=n*fl,i.point(-Yn,r),i.point(0,r),i.point(Yn,r),i.point(Yn,0),i.point(Yn,-r),i.point(0,-r),i.point(-Yn,-r),i.point(-Yn,0),i.point(-Yn,r);else if(Qr(e[0]-t[0])>Mi){var l=e[0]<t[0]?Yn:-Yn;r=n*l/2,i.point(-l,r),i.point(0,r),i.point(l,r)}else i.point(t[0],t[1])}function QC(e,t){var n=Ji(e),i=n>0,r=Qr(n)>Mi;function l(S,L,A,P){UC(P,e,t,A,S,L)}function f(S,L){return Ji(S)*Ji(L)>n}function a(S){var L,A,P,O,B;return{lineStart:function(){O=P=!1,B=1},point:function(U,Y){var V=[U,Y],$,K=f(U,Y),it=i?K?0:x(U,Y):K?x(U+(U<0?Yn:-Yn),Y):0;if(!L&&(O=P=K)&&S.lineStart(),K!==P&&($=_(L,V),(!$||jm(L,$)||jm(V,$))&&(V[0]+=Mi,V[1]+=Mi,K=f(V[0],V[1]))),K!==P)B=0,K?(S.lineStart(),$=_(V,L),S.point($[0],$[1])):($=_(L,V),S.point($[0],$[1]),S.lineEnd()),L=$;else if(r&&L&&i^K){var ft;!(it&A)&&(ft=_(V,L,!0))&&(B=0,i?(S.lineStart(),S.point(ft[0][0],ft[0][1]),S.point(ft[1][0],ft[1][1]),S.lineEnd()):(S.point(ft[1][0],ft[1][1]),S.lineEnd(),S.lineStart(),S.point(ft[0][0],ft[0][1])))}K&&(!L||!jm(L,V))&&S.point(V[0],V[1]),L=V,P=K,A=it},lineEnd:function(){P&&S.lineEnd(),L=null},clean:function(){return B|(O&&P)<<1}}}function _(S,L,A){var P=ef(S),O=ef(L),B=[1,0,0],U=lg(P,O),Y=Nm(U,U),V=U[0],$=Y-V*V;if(!$)return!A&&S;var K=n*Y/$,it=-n*V/$,ft=lg(B,U),pt=Dm(B,K),gt=Dm(U,it);Y_(pt,gt);var ut=ft,St=Nm(pt,ut),_t=Nm(ut,ut),vt=St*St-_t*(Nm(pt,pt)-1);if(!(vt<0)){var ee=ff(vt),kt=Dm(ut,(-St-ee)/_t);if(Y_(kt,pt),kt=xy(kt),!A)return kt;var Gt=S[0],Qt=L[0],se=S[1],Ce=L[1],yn;Qt<Gt&&(yn=Gt,Gt=Qt,Qt=yn);var jn=Qt-Gt,Qe=Qr(jn-Yn)<Mi,Fe=Qe||jn<Mi;if(!Qe&&Ce<se&&(yn=se,se=Ce,Ce=yn),Fe?Qe?se+Ce>0^kt[1]<(Qr(kt[0]-Gt)<Mi?se:Ce):se<=kt[1]&&kt[1]<=Ce:jn>Yn^(Gt<=kt[0]&&kt[0]<=Qt)){var ke=Dm(ut,(-St+ee)/_t);return Y_(ke,pt),[kt,xy(ke)]}}}function x(S,L){var A=i?e:Yn-e,P=0;return S<-A?P|=1:S>A&&(P|=2),L<-A?P|=4:L>A&&(P|=8),P}return tw(f,a,l,i?[0,-e]:[-Yn,e-Yn])}function ew(e){return function(t){var n=new Ey;for(var i in e)n[i]=e[i];return n.stream=t,n}}function Ey(){}Ey.prototype={constructor:Ey,point:function(e,t){this.stream.point(e,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function nw(e,t,n){var i=t[1][0]-t[0][0],r=t[1][1]-t[0][1],l=e.clipExtent&&e.clipExtent();e.scale(150).translate([0,0]),l!=null&&e.clipExtent(null),BC(n,e.stream(A1));var f=A1.result(),a=Math.min(i/(f[1][0]-f[0][0]),r/(f[1][1]-f[0][1])),_=+t[0][0]+(i-a*(f[1][0]+f[0][0]))/2,x=+t[0][1]+(r-a*(f[1][1]+f[0][1]))/2;return l!=null&&e.clipExtent(l),e.scale(a*150).translate([_,x])}function tT(e,t,n){return nw(e,[[0,0],t],n)}var D1=16,eT=Ji(30*Qs);function R1(e,t){return+t?iT(e,t):nT(e)}function nT(e){return ew({point:function(t,n){t=e(t,n),this.stream.point(t[0],t[1])}})}function iT(e,t){function n(i,r,l,f,a,_,x,S,L,A,P,O,B,U){var Y=x-i,V=S-r,$=Y*Y+V*V;if($>4*t&&B--){var K=f+A,it=a+P,ft=_+O,pt=ff(K*K+it*it+ft*ft),gt=Ac(ft/=pt),ut=Qr(Qr(ft)-1)<Mi||Qr(l-L)<Mi?(l+L)/2:tf(it,K),St=e(ut,gt),_t=St[0],vt=St[1],ee=_t-i,kt=vt-r,Gt=V*ee-Y*kt;(Gt*Gt/$>t||Qr((Y*ee+V*kt)/$-.5)>.3||f*A+a*P+_*O<eT)&&(n(i,r,l,f,a,_,_t,vt,ut,K/=pt,it/=pt,ft,B,U),U.point(_t,vt),n(_t,vt,ut,K,it,ft,x,S,L,A,P,O,B,U))}}return function(i){var r,l,f,a,_,x,S,L,A,P,O,B,U={point:Y,lineStart:V,lineEnd:K,polygonStart:function(){i.polygonStart(),U.lineStart=it},polygonEnd:function(){i.polygonEnd(),U.lineStart=V}};function Y(gt,ut){gt=e(gt,ut),i.point(gt[0],gt[1])}function V(){L=NaN,U.point=$,i.lineStart()}function $(gt,ut){var St=ef([gt,ut]),_t=e(gt,ut);n(L,A,S,P,O,B,L=_t[0],A=_t[1],S=gt,P=St[0],O=St[1],B=St[2],D1,i),i.point(L,A)}function K(){U.point=Y,i.lineEnd()}function it(){V(),U.point=ft,U.lineEnd=pt}function ft(gt,ut){$(r=gt,ut),l=L,f=A,a=P,_=O,x=B,U.point=$}function pt(){n(L,A,S,P,O,B,l,f,r,a,_,x,D1,i),U.lineEnd=K,K()}return U}}var rT=ew({point:function(e,t){this.stream.point(e*Qs,t*Qs)}});function oT(e){return sT(function(){return e})()}function sT(e){var t,n=150,i=480,r=250,l,f,a=0,_=0,x=0,S=0,L=0,A,P,O=null,B=N1,U=null,Y,V,$,K=k1,it=.5,ft=R1(_t,it),pt,gt;function ut(kt){return kt=P(kt[0]*Qs,kt[1]*Qs),[kt[0]*n+l,f-kt[1]*n]}function St(kt){return kt=P.invert((kt[0]-l)/n,(f-kt[1])/n),kt&&[kt[0]*Tu,kt[1]*Tu]}function _t(kt,Gt){return kt=t(kt,Gt),[kt[0]*n+l,f-kt[1]*n]}ut.stream=function(kt){return pt&&gt===kt?pt:pt=rT(B(A,ft(K(gt=kt))))},ut.clipAngle=function(kt){return arguments.length?(B=+kt?QC(O=kt*Qs,6*Qs):(O=null,N1),ee()):O*Tu},ut.clipExtent=function(kt){return arguments.length?(K=kt==null?(U=Y=V=$=null,k1):ZC(U=+kt[0][0],Y=+kt[0][1],V=+kt[1][0],$=+kt[1][1]),ee()):U==null?null:[[U,Y],[V,$]]},ut.scale=function(kt){return arguments.length?(n=+kt,vt()):n},ut.translate=function(kt){return arguments.length?(i=+kt[0],r=+kt[1],vt()):[i,r]},ut.center=function(kt){return arguments.length?(a=kt[0]%360*Qs,_=kt[1]%360*Qs,vt()):[a*Tu,_*Tu]},ut.rotate=function(kt){return arguments.length?(x=kt[0]%360*Qs,S=kt[1]%360*Qs,L=kt.length>2?kt[2]%360*Qs:0,vt()):[x*Tu,S*Tu,L*Tu]},ut.precision=function(kt){return arguments.length?(ft=R1(_t,it=kt*kt),ee()):ff(it)},ut.fitExtent=function(kt,Gt){return nw(ut,kt,Gt)},ut.fitSize=function(kt,Gt){return tT(ut,kt,Gt)};function vt(){P=Hx(A=VC(x,S,L),t);var kt=t(a,_);return l=i-kt[0]*n,f=r+kt[1]*n,ee()}function ee(){return pt=gt=null,ut}return function(){return t=e.apply(this,arguments),ut.invert=t.invert&&St,vt()}}function iw(e){return function(t,n){var i=Ji(t),r=Ji(n),l=e(i*r);return[l*r*Qi(t),l*Qi(n)]}}function rw(e){return function(t,n){var i=ff(t*t+n*n),r=e(i),l=Qi(r),f=Ji(r);return[tf(t*l,i*f),Ac(i&&n*l/i)]}}var aT=iw(function(e){return ff(2/(1+e))});aT.invert=rw(function(e){return 2*Ac(e/2)});var ow=iw(function(e){return(e=Xx(e))&&e/Qi(e)});ow.invert=rw(function(e){return e});function lT(){return oT(ow).scale(79.4188).clipAngle(180-.001)}function O1(e,t){return[e,t]}O1.invert=O1;function uT(e,t,n){n=n||{};var i=n.units||"kilometers",r=n.steps||8;if(!e)throw new Error("geojson is required");if(typeof n!="object")throw new Error("options must be an object");if(typeof r!="number")throw new Error("steps must be an number");if(t===void 0)throw new Error("radius is required");if(r<=0)throw new Error("steps must be greater than 0");var l=[];switch(e.type){case"GeometryCollection":return bx(e,function(f){var a=qm(f,t,i,r);a&&l.push(a)}),_y(l);case"FeatureCollection":return g1(e,function(f){var a=qm(f,t,i,r);a&&g1(a,function(_){_&&l.push(_)})}),_y(l)}return qm(e,t,i,r)}function qm(e,t,n,i){var r=e.properties||{},l=e.type==="Feature"?e.geometry:e;if(l.type==="GeometryCollection"){var f=[];return bx(e,function(B){var U=qm(B,t,n,i);U&&f.push(U)}),_y(f)}var a=cT(l),_={type:l.type,coordinates:aw(l.coordinates,a)},x=new Uy,S=x.read(_),L=_C(yC(t,n),"meters"),A=Ir.bufferOp(S,L,i),P=new Px;if(A=P.write(A),!sw(A.coordinates)){var O={type:A.type,coordinates:lw(A.coordinates,a)};return vg(O,r)}}function sw(e){return Array.isArray(e[0])?sw(e[0]):isNaN(e[0])}function aw(e,t){return typeof e[0]!="object"?t(e):e.map(function(n){return aw(n,t)})}function lw(e,t){return typeof e[0]!="object"?t.invert(e):e.map(function(n){return lw(n,t)})}function cT(e){var t=bC(e).geometry.coordinates,n=[-t[0],-t[1]];return lT().rotate(n).scale(qo)}function hT(e,t){var n=tg(e),i=tg(t),r=e.properties||{},l=mx.difference(n.coordinates,i.coordinates);return l.length===0?null:l.length===1?_x(l[0],r):yx(l,r)}function z1(e){let t;for(const n of e)t&&n[0]-t[0]>=180?n[0]-=360:t&&n[0]-t[0]<-180&&(n[0]+=360),t=n}function F1(e,t){const n=hT({type:"Polygon",coordinates:[[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]]},e);if(!n)return;n.properties={isMask:"y"};const i=uT(e,0);if(i.geometry.type==="Polygon")for(const r of i.geometry.coordinates)z1(r);else for(const r of i.geometry.coordinates)for(const l of r)z1(l);t({type:"FeatureCollection",features:[i,n]})}let B1={type:"FeatureCollection",features:[]};function fT(e,t,n=!0,i=!0,r={},l={},f={fill:{paint:{"fill-color":"#000","fill-opacity":.1},filter:["all",["==",["geometry-type"],"Polygon"],["has","isMask"]]},line:{layout:{"line-cap":"square"},paint:{"line-width":["case",["==",["geometry-type"],"Polygon"],2,3],"line-dasharray":[1,1],"line-color":"#3170fe"},filter:["!",["has","isMask"]]}}){let a,_=[],x,S;function L(){(f!=null&&f.fill||f!=null&&f.line)&&e.addSource("full-geom",{type:"geojson",data:B1}),f!=null&&f.fill&&e.addLayer({...f==null?void 0:f.fill,id:"full-geom-fill",type:"fill",source:"full-geom"}),f!=null&&f.line&&e.addLayer({...f==null?void 0:f.line,id:"full-geom-line",type:"line",source:"full-geom"})}e.loaded()?L():e.once("load",()=>{L()});const A=O=>{a==null||a({type:"mapClick",coordinates:[O.lngLat.lng,O.lngLat.lat]})};function P(O=!1){if(!t)throw new Error;const B=document.createElement("div");return O&&B.classList.add("marker-interactive"),new UI({props:{displayIn:"maplibre"},target:B}),new t.Marker({element:B,offset:[1,-13]})}return{setEventHandler(O){O?(a=O,e.on("click",A)):(a=void 0,e.off("click",A))},flyTo(O,B){e.flyTo({center:O,zoom:B,...r})},fitBounds(O,B,U){e.fitBounds([[O[0],O[1]],[O[2],O[3]]],{padding:B,maxZoom:U,...l})},indicateReverse(O){e.getCanvasContainer().style.cursor=O?"crosshair":""},setReverseMarker(O){!t||!n||(S?O?S.setLngLat(O):(S.remove(),S=void 0):O&&(S=(typeof n=="object"?new t.Marker(n):P()).setLngLat(O).addTo(e),S.getElement().classList.add("marker-reverse")))},setMarkers(O,B){if(!n)return;function U(Y){var V;(V=e.getSource("full-geom"))==null||V.setData(Y)}for(const Y of _)Y.remove();if(_.length=0,U(B1),!!t){if(B){let Y=!1;if(B.geometry.type==="GeometryCollection"){const V=B.geometry.geometries.filter($=>$.type==="Polygon"||$.type==="MultiPolygon");if(V.length>0){let $=V.pop();for(const K of V)$=vC($,K);F1({...B,geometry:$},U),Y=!0}else{const $=B.geometry.geometries.filter(K=>K.type==="LineString"||K.type==="MultiLineString");$.length>0&&(U({...B,geometry:{type:"GeometryCollection",geometries:$}}),Y=!0)}}if(!Y){if(B.geometry.type==="Polygon"||B.geometry.type==="MultiPolygon")F1(B,U);else if(B.geometry.type==="LineString"||B.geometry.type==="MultiLineString"){U(B);return}}n&&_.push((typeof n=="object"?new t.Marker(n):P()).setLngLat(B.center).addTo(e))}if(i)for(const Y of O??[]){if(Y===B)continue;const V=(typeof i=="object"?new t.Marker(i):P(!0)).setLngLat(Y.center).setPopup(new t.Popup({offset:[1,-27],closeButton:!1,closeOnMove:!0,className:"maptiler-gc-popup"}).setText(Y.place_type[0]==="reverse"?Y.place_name:Y.place_name.replace(/,.*/,""))).addTo(e),$=V.getElement();$.addEventListener("click",K=>{K.stopPropagation(),a==null||a({type:"markerClick",id:Y.id})}),$.addEventListener("mouseenter",()=>{a==null||a({type:"markerMouseEnter",id:Y.id}),V.togglePopup()}),$.addEventListener("mouseleave",()=>{a==null||a({type:"markerMouseLeave",id:Y.id}),V.togglePopup()}),_.push(V)}}},setSelectedMarker(O){x&&x.getElement().classList.toggle("marker-selected",!1),x=O>-1?_[O]:void 0,x==null||x.getElement().classList.toggle("marker-selected",!0)},getCenterAndZoom(){const O=e.getCenter();return[e.getZoom(),O.lng,O.lat]}}}function pT(e){let t,n;return{c(){t=$l("svg"),n=$l("path"),Rt(n,"d","M13.12.706a.982.982 0 0 0-1.391 0L6.907 5.517 2.087.696a.982.982 0 1 0-1.391 1.39l4.821 4.821L.696 11.73a.982.982 0 1 0 1.39 1.39l4.821-4.821 4.822 4.821a.982.982 0 1 0 1.39-1.39L8.298 6.908l4.821-4.822a.988.988 0 0 0 0-1.38Z"),Rt(t,"viewBox","0 0 14 14"),Rt(t,"width","13"),Rt(t,"height","13"),Rt(t,"class","svelte-en2qvf")},m(i,r){Ct(i,t,r),dt(t,n)},p:Ie,i:Ie,o:Ie,d(i){i&&It(t)}}}class uw extends nn{constructor(t){super(),en(this,t,null,pT,He,{})}}function dT(e){let t,n;return{c(){t=$l("svg"),n=$l("path"),Rt(n,"d","M15 0C6.705 0 0 6.705 0 15C0 23.295 6.705 30 15 30C23.295 30 30 23.295 30 15C30 6.705 23.295 0 15 0ZM22.5 20.385L20.385 22.5L15 17.115L9.615 22.5L7.5 20.385L12.885 15L7.5 9.615L9.615 7.5L15 12.885L20.385 7.5L22.5 9.615L17.115 15L22.5 20.385Z"),Rt(t,"viewBox","0 0 30 30"),Rt(t,"fill","none"),Rt(t,"xmlns","http://www.w3.org/2000/svg"),Rt(t,"class","svelte-d2loi5")},m(i,r){Ct(i,t,r),dt(t,n)},p:Ie,i:Ie,o:Ie,d(i){i&&It(t)}}}class cw extends nn{constructor(t){super(),en(this,t,null,dT,He,{})}}function mT(e){let t,n;return{c(){t=wt("img"),hr(t.src,n=e[3]+"area.svg")||Rt(t,"src",n),Rt(t,"alt",e[6]),Rt(t,"class","svelte-ltkwvy")},m(i,r){Ct(i,t,r)},p(i,r){r&8&&!hr(t.src,n=i[3]+"area.svg")&&Rt(t,"src",n),r&64&&Rt(t,"alt",i[6])},d(i){i&&It(t)}}}function gT(e){let t,n;return{c(){t=wt("img"),hr(t.src,n=e[3]+"reverse.svg")||Rt(t,"src",n),Rt(t,"alt",e[6]),Rt(t,"class","svelte-ltkwvy")},m(i,r){Ct(i,t,r)},p(i,r){r&8&&!hr(t.src,n=i[3]+"reverse.svg")&&Rt(t,"src",n),r&64&&Rt(t,"alt",i[6])},d(i){i&&It(t)}}}function _T(e){let t,n;return{c(){t=wt("img"),hr(t.src,n=e[3]+"poi.svg")||Rt(t,"src",n),Rt(t,"alt",e[6]),Rt(t,"class","svelte-ltkwvy")},m(i,r){Ct(i,t,r)},p(i,r){r&8&&!hr(t.src,n=i[3]+"poi.svg")&&Rt(t,"src",n),r&64&&Rt(t,"alt",i[6])},d(i){i&&It(t)}}}function yT(e){let t,n;return{c(){t=wt("img"),hr(t.src,n=e[3]+"postal_code.svg")||Rt(t,"src",n),Rt(t,"alt",e[6]),Rt(t,"class","svelte-ltkwvy")},m(i,r){Ct(i,t,r)},p(i,r){r&8&&!hr(t.src,n=i[3]+"postal_code.svg")&&Rt(t,"src",n),r&64&&Rt(t,"alt",i[6])},d(i){i&&It(t)}}}function vT(e){let t,n;return{c(){t=wt("img"),hr(t.src,n=e[3]+"street.svg")||Rt(t,"src",n),Rt(t,"alt",e[6]),Rt(t,"class","svelte-ltkwvy")},m(i,r){Ct(i,t,r)},p(i,r){r&8&&!hr(t.src,n=i[3]+"street.svg")&&Rt(t,"src",n),r&64&&Rt(t,"alt",i[6])},d(i){i&&It(t)}}}function bT(e){let t,n;return{c(){t=wt("img"),hr(t.src,n=e[3]+"road.svg")||Rt(t,"src",n),Rt(t,"alt",e[6]),Rt(t,"class","svelte-ltkwvy")},m(i,r){Ct(i,t,r)},p(i,r){r&8&&!hr(t.src,n=i[3]+"road.svg")&&Rt(t,"src",n),r&64&&Rt(t,"alt",i[6])},d(i){i&&It(t)}}}function xT(e){let t,n;return{c(){t=wt("img"),hr(t.src,n=e[3]+"housenumber.svg")||Rt(t,"src",n),Rt(t,"alt",e[6]),Rt(t,"class","svelte-ltkwvy")},m(i,r){Ct(i,t,r)},p(i,r){r&8&&!hr(t.src,n=i[3]+"housenumber.svg")&&Rt(t,"src",n),r&64&&Rt(t,"alt",i[6])},d(i){i&&It(t)}}}function wT(e){let t,n,i,r;return{c(){t=wt("img"),hr(t.src,n=e[5])||Rt(t,"src",n),Rt(t,"alt",e[4]),Rt(t,"class","svelte-ltkwvy")},m(l,f){Ct(l,t,f),i||(r=Ze(t,"error",e[14]),i=!0)},p(l,f){f&32&&!hr(t.src,n=l[5])&&Rt(t,"src",n),f&16&&Rt(t,"alt",l[4])},d(l){l&&It(t),i=!1,r()}}}function V1(e){let t,n;return{c(){t=wt("span"),n=ge(e[6]),Rt(t,"class","secondary svelte-ltkwvy")},m(i,r){Ct(i,t,r),dt(t,n)},p(i,r){r&64&&zi(n,i[6])},d(i){i&&It(t)}}}function ST(e){var pt,gt;let t,n,i,r,l,f,a,_,x=(e[7]?e[0].place_name:e[0].place_name.replace(/,.*/,""))+"",S,L,A=e[2]==="always"||e[2]&&!e[0].address&&((pt=e[0].properties)==null?void 0:pt.kind)!=="road"&&((gt=e[0].properties)==null?void 0:gt.kind)!=="road_relation"&&!e[0].id.startsWith("address.")&&!e[0].id.startsWith("postal_code.")&&(!e[0].id.startsWith("poi.")||!e[5])&&!e[7],P,O,B=(e[7]?"":e[0].place_name.replace(/[^,]*,?\s*/,""))+"",U,Y,V;function $(ut,St){var _t,vt;return St&1&&(n=null),St&1&&(i=null),St&1&&(r=null),ut[5]?wT:ut[0].address?xT:((_t=ut[0].properties)==null?void 0:_t.kind)==="road"||((vt=ut[0].properties)==null?void 0:vt.kind)==="road_relation"?bT:(n==null&&(n=!!ut[0].id.startsWith("address.")),n?vT:(i==null&&(i=!!ut[0].id.startsWith("postal_code.")),i?yT:(r==null&&(r=!!ut[0].id.startsWith("poi.")),r?_T:ut[7]?gT:mT)))}let K=$(e,-1),it=K(e),ft=A&&V1(e);return{c(){t=wt("li"),it.c(),l=Xt(),f=wt("span"),a=wt("span"),_=wt("span"),S=ge(x),L=Xt(),ft&&ft.c(),P=Xt(),O=wt("span"),U=ge(B),Rt(_,"class","primary svelte-ltkwvy"),Rt(a,"class","svelte-ltkwvy"),Rt(O,"class","line2 svelte-ltkwvy"),Rt(f,"class","texts svelte-ltkwvy"),Rt(t,"tabindex","0"),Rt(t,"data-selected",e[1]),Rt(t,"class","svelte-ltkwvy"),hl(t,"selected",e[1])},m(ut,St){Ct(ut,t,St),it.m(t,null),dt(t,l),dt(t,f),dt(f,a),dt(a,_),dt(_,S),dt(a,L),ft&&ft.m(a,null),dt(f,P),dt(f,O),dt(O,U),Y||(V=[Ze(t,"mouseenter",e[12]),Ze(t,"focus",e[13])],Y=!0)},p(ut,[St]){var _t,vt;K===(K=$(ut,St))&&it?it.p(ut,St):(it.d(1),it=K(ut),it&&(it.c(),it.m(t,l))),St&1&&x!==(x=(ut[7]?ut[0].place_name:ut[0].place_name.replace(/,.*/,""))+"")&&zi(S,x),St&37&&(A=ut[2]==="always"||ut[2]&&!ut[0].address&&((_t=ut[0].properties)==null?void 0:_t.kind)!=="road"&&((vt=ut[0].properties)==null?void 0:vt.kind)!=="road_relation"&&!ut[0].id.startsWith("address.")&&!ut[0].id.startsWith("postal_code.")&&(!ut[0].id.startsWith("poi.")||!ut[5])&&!ut[7]),A?ft?ft.p(ut,St):(ft=V1(ut),ft.c(),ft.m(a,null)):ft&&(ft.d(1),ft=null),St&1&&B!==(B=(ut[7]?"":ut[0].place_name.replace(/[^,]*,?\s*/,""))+"")&&zi(U,B),St&2&&Rt(t,"data-selected",ut[1]),St&2&&hl(t,"selected",ut[1])},i:Ie,o:Ie,d(ut){ut&&It(t),it.d(),ft&&ft.d(),Y=!1,No(V)}}}function ET(e,t,n){var $;let i,r,{feature:l}=t,{selected:f=!1}=t,{showPlaceType:a}=t,{missingIconsCache:_}=t,{iconsBaseUrl:x}=t;const S=($=l.properties)==null?void 0:$.categories;let L,A,P=0,O=l.place_type[0]==="reverse";function B(K){A&&_.add(A),n(10,P++,P)}function U(K){ii.call(this,e,K)}function Y(K){ii.call(this,e,K)}const V=K=>B(K.currentTarget);return e.$$set=K=>{"feature"in K&&n(0,l=K.feature),"selected"in K&&n(1,f=K.selected),"showPlaceType"in K&&n(2,a=K.showPlaceType),"missingIconsCache"in K&&n(9,_=K.missingIconsCache),"iconsBaseUrl"in K&&n(3,x=K.iconsBaseUrl)},e.$$.update=()=>{var K,it,ft,pt;if(e.$$.dirty&3640)do n(11,i--,i),n(4,L=S==null?void 0:S[i]),n(5,A=L?x+L.replace(/ /g,"_")+".svg":void 0);while(i>-1&&(!A||_.has(A)));e.$$.dirty&1&&n(6,r=l.id.startsWith("poi.")?(it=(K=l.properties)==null?void 0:K.categories)==null?void 0:it.join(", "):((pt=(ft=l.properties)==null?void 0:ft.place_type_name)==null?void 0:pt[0])??l.place_type[0])},n(11,i=(S==null?void 0:S.length)??0),[l,f,a,x,L,A,r,O,B,_,P,i,U,Y,V]}class IT extends nn{constructor(t){super(),en(this,t,ET,ST,He,{feature:0,selected:1,showPlaceType:2,missingIconsCache:9,iconsBaseUrl:3})}}function CT(e){let t;return{c(){t=wt("div"),t.innerHTML='<svg viewBox="0 0 18 18" width="24" height="24" class="svelte-7cmwmc"><path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"></path><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"></path></svg>',Rt(t,"class","svelte-7cmwmc")},m(n,i){Ct(n,t,i)},p:Ie,i:Ie,o:Ie,d(n){n&&It(t)}}}class TT extends nn{constructor(t){super(),en(this,t,null,CT,He,{})}}function LT(e){let t,n;return{c(){t=$l("svg"),n=$l("path"),Rt(n,"d","M30.003-26.765C13.46-26.765 0-14.158 0 1.337c0 23.286 24.535 42.952 28.39 46.04.24.192.402.316.471.376.323.282.732.424 1.142.424.41 0 .82-.142 1.142-.424.068-.06.231-.183.471-.376 3.856-3.09 28.39-22.754 28.39-46.04 0-15.495-13.46-28.102-30.003-28.102Zm1.757 12.469c4.38 0 7.858 1.052 10.431 3.158 2.595 2.105 3.89 4.913 3.89 8.422 0 2.34-.53 4.362-1.593 6.063-1.063 1.702-3.086 3.616-6.063 5.742-2.042 1.51-3.337 2.659-3.89 3.446-.532.787-.8 1.82-.8 3.096v1.914h-8.449V15.18c0-2.041.434-3.815 1.306-5.325.872-1.51 2.467-3.118 4.785-4.82 2.233-1.594 3.7-2.89 4.402-3.889a5.582 5.582 0 0 0 1.087-3.35c0-1.382-.51-2.435-1.531-3.158-1.02-.723-2.45-1.087-4.28-1.087-3.19 0-6.826 1.047-10.91 3.131l-3.472-6.986c4.742-2.659 9.77-3.992 15.087-3.992Zm-1.88 37.324c1.765 0 3.124.472 4.08 1.408.98.936 1.47 2.276 1.47 4.02 0 1.68-.49 3.007-1.47 3.985-.977.957-2.336 1.435-4.08 1.435-1.787 0-3.171-.465-4.15-1.4-.978-.958-1.47-2.298-1.47-4.02 0-1.787.48-3.14 1.436-4.054.957-.915 2.355-1.374 4.184-1.374Z"),Rt(t,"viewBox","0 0 60.006 21.412"),Rt(t,"width","14"),Rt(t,"height","20"),Rt(t,"class","svelte-en2qvf")},m(i,r){Ct(i,t,r),dt(t,n)},p:Ie,i:Ie,o:Ie,d(i){i&&It(t)}}}class MT extends nn{constructor(t){super(),en(this,t,null,LT,He,{})}}function PT(e){let t,n,i;return{c(){t=$l("svg"),n=$l("circle"),i=$l("path"),Rt(n,"cx","4.789"),Rt(n,"cy","4.787"),Rt(n,"r","3.85"),gi(n,"stroke-width","1.875"),gi(n,"fill","none"),Rt(i,"d","M12.063 12.063 7.635 7.635"),gi(i,"stroke-width","1.875"),gi(i,"stroke-linecap","round"),Rt(t,"xmlns","http://www.w3.org/2000/svg"),Rt(t,"width","13"),Rt(t,"height","13"),Rt(t,"viewBox","0 0 13 13"),Rt(t,"class","svelte-1bpbt60")},m(r,l){Ct(r,t,l),dt(t,n),dt(t,i)},p:Ie,i:Ie,o:Ie,d(r){r&&It(t)}}}class kT extends nn{constructor(t){super(),en(this,t,null,PT,He,{})}}function AT(e,t,n){const i=t[1],r=t[0],l=i-r;return e===i&&n?e:((e-r)%l+l)%l+r}function U1(e){const t=[...e];return t[2]<t[0]&&(t[2]+=360),t}let Sp;async function NT(e,t,n){const i=e==null?void 0:e.getCenterAndZoom();for(const r of t??[])if(!(i&&(r.minZoom!=null&&r.minZoom>i[0]||r.maxZoom!=null&&r.maxZoom<i[0]))){if(r.type==="fixed")return r.coordinates.join(",");t:if(r.type==="client-geolocation"){if(Sp&&r.cachedLocationExpiry&&Sp.time+r.cachedLocationExpiry>Date.now()){if(!Sp.coords)break t;return Sp.coords}let l;try{return l=await new Promise((f,a)=>{n.signal.addEventListener("abort",()=>{a(Error("aborted"))}),navigator.geolocation.getCurrentPosition(_=>{f([_.coords.longitude,_.coords.latitude].map(x=>x.toFixed(6)).join(","))},_=>{a(_)},r)}),l}catch{}finally{r.cachedLocationExpiry&&(Sp={time:Date.now(),coords:l})}if(n.signal.aborted)return}if(r.type==="server-geolocation")return"ip";if(i&&r.type==="map-center")return i[1].toFixed(6)+","+i[2].toFixed(6)}}const G1=/(NORTH|SOUTH|[NS])?[\s]*([+-]?[0-8]?[0-9](?:[\.,]\d{3,}))[\s]*([]?)[\s]*(NORTH|SOUTH|[NS])?[\s]*[,/;]?[\s]*(EAST|WEST|[EW])?[\s]*([+-]?[0-1]?[0-9]?[0-9](?:[\.,]\d{3,}))[\s]*([]?)[\s]*(EAST|WEST|[EW])?/i,j1=/(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(EAST|WEST|[EW])?/i,q1=/(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)\s*(EAST|WEST|[EW])?/i,Z1=/(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''||||["\.])?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''||||["\.])?\s*(EAST|WEST|[EW])?/i;function DT(e){if(!["DMS","DM","DD"].includes(e))throw new Error("invalid format specified");if(this.decimalCoordinates&&this.decimalCoordinates.trim()){if(e=="DD")return this.decimalCoordinates;const t=this.decimalCoordinates.split(",").map(f=>Number(f.trim()));let n=$1(t[0],e),i=$1(t[1],e);n.endsWith('.0"')&&i.endsWith('.0"')&&(n=n.replace(/\.0"$/,'"'),i=i.replace(/\.0"$/,'"'));const r=t[0]>=0?" N":" S",l=t[1]>=0?" E":" W";return`${n+r}, ${i+l}`}else throw new Error("no decimal coordinates to convert")}function $1(e,t){const n=Math.abs(e),i=Math.floor(n),r=(n-i)*60;if(t=="DM"){let a=RT(r,3).toFixed(3).padStart(6,"0");return`${i} ${a}'`}let l=Math.floor(r),f=((r-l)*60).toFixed(1).padStart(4,"0");return l=l.toString().padStart(2,"0"),`${i} ${l}' ${f}"`}function RT(e,t){const n=Math.pow(10,t);return Math.round((e+Number.EPSILON)*n)/n}function Yy(e,t){t||(t=5),e=e.replace(/\s+/g," ").trim();let n=null,i=null,r="",l="",f=[],a=!1;if(G1.test(e))if(f=G1.exec(e),a=zm(f),a){if(n=f[2],i=f[6],n.includes(",")&&(n=n.replace(",",".")),i.includes(",")&&(i=i.replace(",",".")),Number(Math.round(n))==Number(n))throw new Error("integer only coordinate provided");if(Number(Math.round(i))==Number(i))throw new Error("integer only coordinate provided");f[1]?(r=f[1],l=f[5]):f[4]&&(r=f[4],l=f[8])}else throw new Error("invalid decimal coordinate format");else if(j1.test(e))if(f=j1.exec(e),a=zm(f),a)n=Math.abs(parseInt(f[2])),f[4]&&(n+=f[4]/60),f[6]&&(n+=f[6].replace(",",".")/3600),parseInt(f[2])<0&&(n=-1*n),i=Math.abs(parseInt(f[9])),f[11]&&(i+=f[11]/60),f[13]&&(i+=f[13].replace(",",".")/3600),parseInt(f[9])<0&&(i=-1*i),f[1]?(r=f[1],l=f[8]):f[7]&&(r=f[7],l=f[14]);else throw new Error("invalid DMS coordinates format");else if(q1.test(e))if(f=q1.exec(e),a=zm(f),a)n=Math.abs(parseInt(f[2])),f[4]&&(n+=f[4]/60),f[6]&&(n+=f[6]/3600),parseInt(f[2])<0&&(n=-1*n),i=Math.abs(parseInt(f[10])),f[12]&&(i+=f[12]/60),f[14]&&(i+=f[14]/3600),parseInt(f[10])<0&&(i=-1*i),f[1]?(r=f[1],l=f[9]):f[8]&&(r=f[8],l=f[16]);else throw new Error("invalid DMS coordinates format");else if(Z1.test(e))if(f=Z1.exec(e),a=zm(f),a)n=Math.abs(parseInt(f[2])),f[4]&&(n+=f[4]/60),f[6]&&(n+=f[6]/3600),parseInt(f[2])<0&&(n=-1*n),i=Math.abs(parseInt(f[10])),f[12]&&(i+=f[12]/60),f[14]&&(i+=f[14]/3600),parseInt(f[10])<0&&(i=-1*i),f[1]?(r=f[1],l=f[9]):f[8]&&(r=f[8],l=f[16]);else throw new Error("invalid coordinates format");if(a){if(Math.abs(i)>=180)throw new Error("invalid longitude value");if(Math.abs(n)>=90)throw new Error("invalid latitude value");if((r||l)&&(!r||!l))throw new Error("invalid coordinates format");if(r&&r==l)throw new Error("invalid coordinates format");let _=/S|SOUTH/i;_.test(r)&&n>0&&(n=-1*n),_=/W|WEST/i,_.test(l)&&i>0&&(i=-1*i);const x=f[0].trim();let S,L;const A=/[,/;\u0020]/g,P=x.match(A);if(P==null){const U=Math.floor(e.length/2);S=x.substring(0,U).trim(),L=x.substring(U).trim()}else{let U;P.length%2==1?U=Math.floor(P.length/2):U=P.length/2-1;let Y=0;if(U==0)Y=x.indexOf(P[0]),S=x.substring(0,Y).trim(),L=x.substring(Y+1).trim();else{let V=0,$=0;for(;V<=U;)Y=x.indexOf(P[V],$),$=Y+1,V++;S=x.substring(0,Y).trim(),L=x.substring(Y+1).trim()}}const O=S.split(".");if(O.length==2&&O[1]==0&&O[1].length!=2)throw new Error("invalid coordinates format");const B=L.split(".");if(B.length==2&&B[1]==0&&B[1].length!=2)throw new Error("invalid coordinates format");if(/^\d+$/.test(S)||/^\d+$/.test(L))throw new Error("degree only coordinate/s provided");return isNaN(n)&&n.includes(",")&&(n=n.replace(",",".")),n=Number(Number(n).toFixed(t)),isNaN(i)&&i.includes(",")&&(i=i.replace(",",".")),i=Number(Number(i).toFixed(t)),Object.freeze({verbatimCoordinates:x,verbatimLatitude:S,verbatimLongitude:L,decimalLatitude:n,decimalLongitude:i,decimalCoordinates:`${n},${i}`,closeEnough:OT,toCoordinateFormat:DT})}else throw new Error("coordinates pattern match failed")}function zm(e){if(!isNaN(e[0]))return!1;const t=[...e];if(t.shift(),t.length%2>0)return!1;const n=/^[-+]?\d+([\.,]\d+)?$/,i=/[eastsouthnorthwest]+/i,r=t.length/2;for(let l=0;l<r;l++){const f=t[l],a=t[l+r],_=n.test(f)&&n.test(a),x=i.test(f)&&i.test(a),S=f==a;if(!(f==null&&a==null)){if(f==null||a==null)return!1;if(_||x||S)continue;return!1}}return!0}function W1(e,t){const n=Math.abs(e-t);return Number(n.toFixed(6))<=1e-5}function OT(e){if(e.includes(",")){const t=e.split(",");if(Number(t[0])==NaN||Number(t[1])==NaN)throw new Error("coords are not valid decimals");return W1(this.decimalLatitude,Number(t[0]))&&W1(this.decimalLongitude,t[1])}else throw new Error("coords being tested must be separated by a comma")}const zT=Object.freeze({DMS:"DMS",DM:"DM",DD:"DD"});Yy.to=zT;const FT=[{verbatimCoordinates:"40.123, -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123 N 74.123 W",verbatimLatitude:"40.123 N",verbatimLongitude:"74.123 W"},{verbatimCoordinates:"40.123 N 74.123 W",verbatimLatitude:"40.123 N",verbatimLongitude:"74.123 W"},{verbatimCoordinates:'40 7 22.8" N 74 7 22.8" W',verbatimLatitude:'40 7 22.8" N',verbatimLongitude:'74 7 22.8" W'},{verbatimCoordinates:"40 7.38 , -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"N40722.8, W74722.8",verbatimLatitude:"N40722.8",verbatimLongitude:"W74722.8"},{verbatimCoordinates:'40722.8"N, 74722.8"W',verbatimLatitude:'40722.8"N',verbatimLongitude:'74722.8"W'},{verbatimCoordinates:`407'22.8"N, 747'22.8"W`,verbatimLatitude:`407'22.8"N`,verbatimLongitude:`747'22.8"W`},{verbatimCoordinates:"40 7 22.8, -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"},{verbatimCoordinates:"40.123 -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123,-74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123N74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"4007.38N7407.38W",verbatimLatitude:"4007.38N",verbatimLongitude:"7407.38W"},{verbatimCoordinates:'40722.8"N, 74722.8"W',verbatimLatitude:'40722.8"N',verbatimLongitude:'74722.8"W'},{verbatimCoordinates:"400722.8N740722.8W",verbatimLatitude:"400722.8N",verbatimLongitude:"740722.8W"},{verbatimCoordinates:"N 40 7.38 W 74 7.38",verbatimLatitude:"N 40 7.38",verbatimLongitude:"W 74 7.38"},{verbatimCoordinates:"40:7:22.8N 74:7:22.8W",verbatimLatitude:"40:7:22.8N",verbatimLongitude:"74:7:22.8W"},{verbatimCoordinates:"40:7:23N,74:7:23W",verbatimLatitude:"40:7:23N",verbatimLongitude:"74:7:23W",decimalLatitude:40.1230555555,decimalLongitude:-74.1230555555},{verbatimCoordinates:'40723"N 74723"W',verbatimLatitude:'40723"N',verbatimLongitude:'74723"W',decimalLatitude:40.1230555555,decimalLongitude:-74.12305555555555},{verbatimCoordinates:'40723"S 74723"E',verbatimLatitude:'40723"S',verbatimLongitude:'74723"E',decimalLatitude:-40.1230555555,decimalLongitude:74.12305555555555},{verbatimCoordinates:'40723" -74723"',verbatimLatitude:'40723"',verbatimLongitude:'-74723"',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:'40d 7 23" N 74d 7 23" W',verbatimLatitude:'40d 7 23" N',verbatimLongitude:'74d 7 23" W',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:"40.123N 74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"40 7.38, -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"40 7.38, -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"40 7 22.8; -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"}],BT={decimalLatitude:40.123,decimalLongitude:-74.123},VT=[{verbatimCoordinates:`504'17.698"south, 1424'2.826"east`,verbatimLatitude:`504'17.698"south`,verbatimLongitude:`1424'2.826"east`,decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"50d4m17.698S 14d24m2.826E",verbatimLatitude:"50d4m17.698S",verbatimLongitude:"14d24m2.826E",decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"40:26:46N,79:56:55W",verbatimLatitude:"40:26:46N",verbatimLongitude:"79:56:55W",decimalLatitude:40.44611111111111,decimalLongitude:-79.9486111111111},{verbatimCoordinates:"40:26:46.302N 79:56:55.903W",verbatimLatitude:"40:26:46.302N",verbatimLongitude:"79:56:55.903W",decimalLatitude:40.446195,decimalLongitude:-79.94886194444445},{verbatimCoordinates:"402647N 795836W",verbatimLatitude:"402647N",verbatimLongitude:"795836W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40d 26 47 N 79d 58 36 W",verbatimLatitude:"40d 26 47 N",verbatimLongitude:"79d 58 36 W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40.446195N 79.948862W",verbatimLatitude:"40.446195N",verbatimLongitude:"79.948862W",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40,446195 79,948862",verbatimLatitude:"40,446195",verbatimLongitude:"79,948862",decimalLatitude:40.446195,decimalLongitude:79.948862},{verbatimCoordinates:"40 26.7717, -79 56.93172",verbatimLatitude:"40 26.7717",verbatimLongitude:"-79 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.446195, -79.948862",verbatimLatitude:"40.446195",verbatimLongitude:"-79.948862",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.123256; -74.123256",verbatimLatitude:"40.123256",verbatimLongitude:"-74.123256",decimalLatitude:40.123256,decimalLongitude:-74.123256},{verbatimCoordinates:"1824S 2245E",verbatimLatitude:"1824S",verbatimLongitude:"2245E",decimalLatitude:-18.4,decimalLongitude:22.75}],UT=[{verbatimCoordinates:"10.432342S 10.6345345E",verbatimLatitude:"10.432342S",verbatimLongitude:"10.6345345E",decimalLatitude:-10.432342,decimalLongitude:10.6345345},{verbatimCoordinates:"10.00S 10.00E",verbatimLatitude:"10.00S",verbatimLongitude:"10.00E",decimalLatitude:-10,decimalLongitude:10},{verbatimCoordinates:"00.00S 01.00E",verbatimLatitude:"00.00S",verbatimLongitude:"01.00E",decimalLatitude:0,decimalLongitude:1},{verbatimCoordinates:"18.24S 22.45E",verbatimLatitude:"18.24S",verbatimLongitude:"22.45E",decimalLatitude:-18.4,decimalLongitude:22.75},{verbatimCoordinates:"27deg 15min 45.2sec S 18deg 32min 53.7sec E",verbatimLatitude:"27deg 15min 45.2sec S",verbatimLongitude:"18deg 32min 53.7sec E",decimalLatitude:-27.262555555555554,decimalLongitude:18.54825},{verbatimCoordinates:"-23.3245 S / 28.2344 E",verbatimLatitude:"-23.3245 S",verbatimLongitude:"28.2344 E",decimalLatitude:-23.3245,decimalLongitude:28.2344},{verbatimCoordinates:"40 26.7717 -79 56.93172",verbatimLatitude:"40 26.7717",verbatimLongitude:"-79 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"27.15.45S 18.32.53E",verbatimLatitude:"27.15.45S",verbatimLongitude:"18.32.53E",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"-27.15.45 18.32.53",verbatimLatitude:"-27.15.45",verbatimLongitude:"18.32.53",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"27.15.45.2S 18.32.53.4E",verbatimLatitude:"27.15.45.2S",verbatimLongitude:"18.32.53.4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"27.15.45,2S 18.32.53,4E",verbatimLatitude:"27.15.45,2S",verbatimLongitude:"18.32.53,4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"S23.43563   E22.45634 ",verbatimLatitude:"S23.43563 ",verbatimLongitude:"E22.45634 ",decimalLatitude:-23.43563,decimalLongitude:22.45634},{verbatimCoordinates:"27,71372 S 23,07771 E",verbatimLatitude:"27,71372 S",verbatimLongitude:"23,07771 E",decimalLatitude:-27.71372,decimalLongitude:23.07771},{verbatimCoordinates:"27.45.34 S 23.23.23 E",verbatimLatitude:"27.45.34 S",verbatimLongitude:"23.23.23 E",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"S 27.45.34 E 23.23.23",verbatimLatitude:"S 27.45.34",verbatimLongitude:"E 23.23.23",decimalLatitude:-27.759444,decimalLongitude:23.38972222}];function GT(){const e=[];return FT.forEach(t=>{t.decimalLatitude?e.push(t):e.push({...t,...BT})}),[...e,...VT,...UT]}const jT=GT();Yy.formats=jT.map(e=>e.verbatimCoordinates);const qT=Yy;function X1(e,t,n){const i=e.slice();return i[81]=t[n],i[83]=n,i}function H1(e){let t,n;return t=new TT({}),{c(){Zt(t.$$.fragment)},m(i,r){jt(t,i,r),n=!0},i(i){n||(mt(t.$$.fragment,i),n=!0)},o(i){xt(t.$$.fragment,i),n=!1},d(i){qt(t,i)}}}function Y1(e){let t,n,i,r,l;return n=new MT({}),{c(){t=wt("button"),Zt(n.$$.fragment),Rt(t,"type","button"),Rt(t,"title",e[9]),Rt(t,"class","svelte-zh3kmv"),hl(t,"active",e[0])},m(f,a){Ct(f,t,a),jt(n,t,null),i=!0,r||(l=Ze(t,"click",e[67]),r=!0)},p(f,a){(!i||a[0]&512)&&Rt(t,"title",f[9]),(!i||a[0]&1)&&hl(t,"active",f[0])},i(f){i||(mt(n.$$.fragment,f),i=!0)},o(f){xt(n.$$.fragment,f),i=!1},d(f){f&&It(t),qt(n),r=!1,l()}}}function ZT(e){let t,n=[],i=new Map,r,l,f,a=la(e[14]);const _=x=>x[81].id+(x[81].address?","+x[81].address:"");for(let x=0;x<a.length;x+=1){let S=X1(e,a,x),L=_(S);i.set(L,n[x]=K1(L,S))}return{c(){t=wt("ul");for(let x=0;x<n.length;x+=1)n[x].c();Rt(t,"class","svelte-zh3kmv")},m(x,S){Ct(x,t,S);for(let L=0;L<n.length;L+=1)n[L]&&n[L].m(t,null);r=!0,l||(f=[Ze(t,"mouseleave",e[71]),Ze(t,"blur",e[72])],l=!0)},p(x,S){S[0]&17880064&&(a=la(x[14]),ci(),n=BS(n,S,_,1,x,a,i,t,FS,K1,null,X1),hi())},i(x){if(!r){for(let S=0;S<a.length;S+=1)mt(n[S]);r=!0}},o(x){for(let S=0;S<n.length;S+=1)xt(n[S]);r=!1},d(x){x&&It(t);for(let S=0;S<n.length;S+=1)n[S].d();l=!1,No(f)}}}function $T(e){let t,n,i,r,l,f;return n=new cw({}),{c(){t=wt("div"),Zt(n.$$.fragment),i=Xt(),r=wt("div"),l=ge(e[7]),Rt(r,"class","svelte-zh3kmv"),Rt(t,"class","no-results svelte-zh3kmv")},m(a,_){Ct(a,t,_),jt(n,t,null),dt(t,i),dt(t,r),dt(r,l),f=!0},p(a,_){(!f||_[0]&128)&&zi(l,a[7])},i(a){f||(mt(n.$$.fragment,a),f=!0)},o(a){xt(n.$$.fragment,a),f=!1},d(a){a&&It(t),qt(n)}}}function WT(e){let t="",n;return{c(){n=ge(t)},m(i,r){Ct(i,n,r)},p:Ie,i:Ie,o:Ie,d(i){i&&It(n)}}}function XT(e){let t,n,i,r,l,f,a,_,x,S,L;return n=new cw({}),_=new uw({}),{c(){t=wt("div"),Zt(n.$$.fragment),i=Xt(),r=wt("div"),l=ge(e[6]),f=Xt(),a=wt("button"),Zt(_.$$.fragment),Rt(r,"class","svelte-zh3kmv"),Rt(a,"class","svelte-zh3kmv"),Rt(t,"class","error svelte-zh3kmv")},m(A,P){Ct(A,t,P),jt(n,t,null),dt(t,i),dt(t,r),dt(r,l),dt(t,f),dt(t,a),jt(_,a,null),x=!0,S||(L=Ze(a,"click",e[68]),S=!0)},p(A,P){(!x||P[0]&64)&&zi(l,A[6])},i(A){x||(mt(n.$$.fragment,A),mt(_.$$.fragment,A),x=!0)},o(A){xt(n.$$.fragment,A),xt(_.$$.fragment,A),x=!1},d(A){A&&It(t),qt(n),qt(_),S=!1,L()}}}function K1(e,t){let n,i,r;function l(){return t[69](t[83])}function f(){return t[70](t[81])}return i=new IT({props:{feature:t[81],showPlaceType:t[10],selected:t[15]===t[83],missingIconsCache:t[20],iconsBaseUrl:t[12]}}),i.$on("mouseenter",l),i.$on("focus",f),{key:e,first:null,c(){n=ts(),Zt(i.$$.fragment),this.first=n},m(a,_){Ct(a,n,_),jt(i,a,_),r=!0},p(a,_){t=a;const x={};_[0]&16384&&(x.feature=t[81]),_[0]&1024&&(x.showPlaceType=t[10]),_[0]&49152&&(x.selected=t[15]===t[83]),_[0]&4096&&(x.iconsBaseUrl=t[12]),i.$set(x)},i(a){r||(mt(i.$$.fragment,a),r=!0)},o(a){xt(i.$$.fragment,a),r=!1},d(a){a&&It(n),qt(i,a)}}}function HT(e){let t,n,i,r,l,f,a,_,x,S,L,A,P,O,B,U,Y,V,$,K,it,ft=!1;l=new kT({}),L=new uw({});let pt=e[19]&&H1(),gt=e[5]===!0&&Y1(e);const ut=e[59].default,St=sr(ut,e,e[58],null),_t=[XT,WT,$T,ZT],vt=[];function ee(kt,Gt){var Qt,se;return kt[18]?0:kt[16]?((Qt=kt[14])==null?void 0:Qt.length)===0?2:kt[16]&&((se=kt[14])!=null&&se.length)?3:-1:1}return~(U=ee(e))&&(Y=vt[U]=_t[U](e)),{c(){t=Xt(),n=wt("form"),i=wt("div"),r=wt("button"),Zt(l.$$.fragment),f=Xt(),a=wt("input"),_=Xt(),x=wt("div"),S=wt("button"),Zt(L.$$.fragment),A=Xt(),pt&&pt.c(),P=Xt(),gt&&gt.c(),O=Xt(),St&&St.c(),B=Xt(),Y&&Y.c(),Rt(r,"class","search-button svelte-zh3kmv"),Rt(r,"type","button"),Rt(a,"placeholder",e[8]),Rt(a,"aria-label",e[8]),Rt(a,"class","svelte-zh3kmv"),Rt(S,"type","button"),Rt(S,"title",e[3]),Rt(S,"class","svelte-zh3kmv"),Rt(x,"class","clear-button-container svelte-zh3kmv"),hl(x,"displayable",e[1]!==""),Rt(i,"class","input-group svelte-zh3kmv"),Rt(n,"tabindex","0"),Rt(n,"class",V=Zm(e[2])+" svelte-zh3kmv"),hl(n,"can-collapse",e[4]&&e[1]==="")},m(kt,Gt){Ct(kt,t,Gt),Ct(kt,n,Gt),dt(n,i),dt(i,r),jt(l,r,null),dt(i,f),dt(i,a),e[61](a),ql(a,e[1]),dt(i,_),dt(i,x),dt(x,S),jt(L,S,null),dt(x,A),pt&&pt.m(x,null),dt(i,P),gt&&gt.m(i,null),dt(i,O),St&&St.m(i,null),dt(n,B),~U&&vt[U].m(n,null),$=!0,K||(it=[Ze(r,"click",e[60]),Ze(a,"input",e[62]),Ze(a,"focus",e[63]),Ze(a,"blur",e[64]),Ze(a,"keydown",e[22]),Ze(a,"input",e[65]),Ze(S,"click",e[66]),Ze(n,"submit",kS(e[21]))],K=!0)},p(kt,Gt){(!$||Gt[0]&256)&&Rt(a,"placeholder",kt[8]),(!$||Gt[0]&256)&&Rt(a,"aria-label",kt[8]),Gt[0]&2&&a.value!==kt[1]&&ql(a,kt[1]),(!$||Gt[0]&8)&&Rt(S,"title",kt[3]),kt[19]?pt?Gt[0]&524288&&mt(pt,1):(pt=H1(),pt.c(),mt(pt,1),pt.m(x,null)):pt&&(ci(),xt(pt,1,1,()=>{pt=null}),hi()),(!$||Gt[0]&2)&&hl(x,"displayable",kt[1]!==""),kt[5]===!0?gt?(gt.p(kt,Gt),Gt[0]&32&&mt(gt,1)):(gt=Y1(kt),gt.c(),mt(gt,1),gt.m(i,O)):gt&&(ci(),xt(gt,1,1,()=>{gt=null}),hi()),St&&St.p&&(!$||Gt[1]&134217728)&&lr(St,ut,kt,kt[58],$?ar(ut,kt[58],Gt,null):ur(kt[58]),null);let Qt=U;U=ee(kt),U===Qt?~U&&vt[U].p(kt,Gt):(Y&&(ci(),xt(vt[Qt],1,1,()=>{vt[Qt]=null}),hi()),~U?(Y=vt[U],Y?Y.p(kt,Gt):(Y=vt[U]=_t[U](kt),Y.c()),mt(Y,1),Y.m(n,null)):Y=null),(!$||Gt[0]&4&&V!==(V=Zm(kt[2])+" svelte-zh3kmv"))&&Rt(n,"class",V),(!$||Gt[0]&22)&&hl(n,"can-collapse",kt[4]&&kt[1]==="")},i(kt){$||(mt(ft),mt(l.$$.fragment,kt),mt(L.$$.fragment,kt),mt(pt),mt(gt),mt(St,kt),mt(Y),$=!0)},o(kt){xt(ft),xt(l.$$.fragment,kt),xt(L.$$.fragment,kt),xt(pt),xt(gt),xt(St,kt),xt(Y),$=!1},d(kt){kt&&(It(t),It(n)),qt(l),e[61](null),qt(L),pt&&pt.d(),gt&&gt.d(),St&&St.d(kt),~U&&vt[U].d(),K=!1,No(it)}}}function YT(e,t,n){let i,{$$slots:r={},$$scope:l}=t,{class:f=void 0}=t,{apiKey:a}=t,{bbox:_=void 0}=t,{clearButtonTitle:x="clear"}=t,{clearOnBlur:S=!1}=t,{collapsed:L=!1}=t,{country:A=void 0}=t,{debounceSearch:P=200}=t,{enableReverse:O=!1}=t,{errorMessage:B="Something went wrong"}=t,{filter:U=()=>!0}=t,{flyTo:Y=!0}=t,{fuzzyMatch:V=!0}=t,{language:$=void 0}=t,{limit:K=void 0}=t,{mapController:it=void 0}=t,{minLength:ft=2}=t,{noResultsMessage:pt="Oops! Looks like you're trying to predict something that's not quite right. We can't seem to find what you're looking for. Maybe try double-checking your spelling or try a different search term. Keep on typing - we'll do our best to get you where you need to go!"}=t,{placeholder:gt="Search"}=t,{proximity:ut=[{type:"server-geolocation"}]}=t,{reverseActive:St=O==="always"}=t,{reverseButtonTitle:_t="toggle reverse geocoding"}=t,{searchValue:vt=""}=t,{showFullGeometry:ee=!0}=t,{showPlaceType:kt="ifNeeded"}=t,{showResultsWhileTyping:Gt=!0}=t,{selectFirst:Qt=!0}=t,{flyToSelected:se=!1}=t,{markerOnSelected:Ce=!0}=t,{types:yn=void 0}=t,{excludeTypes:jn=!1}=t,{zoom:Qe=16}=t,{maxZoom:Fe=18}=t,{apiUrl:ke="https://api.maptiler.com/geocoding"}=t,{fetchParameters:fn={}}=t,{iconsBaseUrl:Kn="https://cdn.maptiler.com/maptiler-geocoding-control/v1.2.1/icons/"}=t,{adjustUrlQuery:qn=Z=>{}}=t;function re(){Wn.focus()}function De(){Wn.blur()}function hn(Z,ot=!0){n(1,vt=Z),ot?(n(15,pn=-1),ns()):(yo(),setTimeout(()=>{Wn.focus(),Wn.select()}))}function On(){n(14,yt=void 0),n(55,qe=void 0),n(15,pn=-1)}function yi(){n(54,Ee=[]),n(55,qe=void 0)}let wn=!1,yt,Ee,qe,nr="",Wn,pn=-1,Wi,$t=[],Vi,fr,zn,In;const es=new Set,oo=Dc();aa(()=>{it&&(it.setEventHandler(void 0),it.indicateReverse(!1),it.setSelectedMarker(-1),it.setMarkers(void 0,void 0))});function ns(Z){if(fr&&(clearTimeout(fr),fr=void 0),pn>-1&&yt)n(55,qe=yt[pn]),n(1,vt=qe.place_type[0]==="reverse"?qe.place_name:qe.place_name.replace(/,.*/,"")),n(18,Wi=void 0),n(54,Ee=void 0),n(15,pn=-1);else if(vt){const ot=Z||!Ha(vt);Gs(vt,{exact:!0}).then(()=>{n(54,Ee=yt),n(55,qe=void 0),ot&&js()}).catch(Mt=>n(18,Wi=Mt))}}function Ha(Z){try{return qT(Z,6)}catch{return!1}}async function Gs(Z,{byId:ot=!1,exact:Mt=!1}={}){n(18,Wi=void 0),Vi==null||Vi.abort();const bt=new AbortController;n(19,Vi=bt);try{const rt=Ha(Z),Tt=new URLSearchParams;if($!==void 0&&Tt.set("language",Array.isArray($)?$.join(","):$??""),yn&&Tt.set("types",yn.join(",")),jn&&Tt.set("excludeTypes",String(jn)),_&&Tt.set("bbox",_.map(Ne=>Ne.toFixed(6)).join(",")),A&&Tt.set("country",Array.isArray(A)?A.join(","):A),!ot&&!rt){const Ne=await NT(it,ut,bt);Ne&&Tt.set("proximity",Ne),(Mt||!Gt)&&Tt.set("autocomplete","false"),Tt.set("fuzzyMatch",String(V))}K!==void 0&&(!rt||(yn==null?void 0:yn.length)===1)&&Tt.set("limit",String(K)),Tt.set("key",a),qn(Tt);const Wt=ke+"/"+encodeURIComponent(rt?rt.decimalLongitude+","+rt.decimalLatitude:Z)+".json?"+Tt.toString();if(Wt===nr){ot?(n(14,yt=void 0),n(55,qe=$t[0])):n(14,yt=$t);return}nr=Wt;const Ht=await fetch(Wt,{signal:bt.signal,...fn});if(!Ht.ok)throw new Error(await Ht.text());const Kt=await Ht.json();oo("response",{url:Wt,featureCollection:Kt}),ot?(n(14,yt=void 0),n(55,qe=Kt.features[0]),$t=[qe]):(n(14,yt=Kt.features.filter(U)),rt&&yt.unshift({type:"Feature",properties:{},id:"reverse_"+rt.decimalLongitude+"_"+rt.decimalLatitude,text:rt.decimalLatitude+", "+rt.decimalLongitude,place_name:rt.decimalLatitude+", "+rt.decimalLongitude,place_type:["reverse"],center:[rt.decimalLongitude,rt.decimalLatitude],bbox:[rt.decimalLongitude,rt.decimalLatitude,rt.decimalLongitude,rt.decimalLatitude],geometry:{type:"Point",coordinates:[rt.decimalLongitude,rt.decimalLatitude]}}),$t=yt,rt&&Wn.focus())}catch(rt){if(rt&&typeof rt=="object"&&"name"in rt&&rt.name==="AbortError")return;throw rt}finally{bt===Vi&&n(19,Vi=void 0)}}function js(){var Mt;if(!(Ee!=null&&Ee.length)||!Y)return;const Z=[180,90,-180,-90],ot=!Ee.some(bt=>!bt.matching_text);for(const bt of Ee)if(ot||!bt.matching_text)for(const rt of[0,1,2,3])Z[rt]=Math[rt<2?"min":"max"](Z[rt],((Mt=bt.bbox)==null?void 0:Mt[rt])??bt.center[rt%2]);it&&Ee.length>0&&(qe&&Z[0]===Z[2]&&Z[1]===Z[3]?it.flyTo(qe.center,Qe):it.fitBounds(U1(Z),50,Fe))}function Sa(Z){n(0,St=O==="always"),n(14,yt=void 0),n(55,qe=void 0),n(15,pn=-1),hn(Z[1].toFixed(6)+", "+AT(Z[0],[-180,180],!0).toFixed(6),!1)}function le(Z){if(!yt)return;let ot=Z.key==="ArrowDown"?1:Z.key==="ArrowUp"?-1:0;ot&&(pn===(Qt?0:-1)&&ot===-1&&n(15,pn=yt.length),n(15,pn+=ot),pn>=yt.length&&n(15,pn=-1),pn<0&&Qt&&n(15,pn=0),Z.preventDefault())}function yo(Z=!0){if(n(18,Wi=void 0),Gt){if(fr&&clearTimeout(fr),vt.length<ft)return;const ot=vt;fr=window.setTimeout(()=>{Gs(ot).catch(Mt=>n(18,Wi=Mt))},Z?P:0)}else n(14,yt=void 0),n(18,Wi=void 0)}function ri(Z){n(55,qe=Z),n(1,vt=Z.place_name),n(15,pn=-1)}const Ea=()=>Wn.focus();function ws(Z){cr[Z?"unshift":"push"](()=>{Wn=Z,n(17,Wn)})}function ce(){vt=this.value,n(1,vt),n(13,wn),n(27,S)}const ln=()=>n(13,wn=!0),Ke=()=>n(13,wn=!1),Ar=()=>yo(),is=()=>{n(1,vt=""),Wn.focus()},on=()=>n(0,St=!St),Ss=()=>n(18,Wi=void 0),st=Z=>n(15,pn=Z),G=Z=>ri(Z),q=()=>{Qt||n(15,pn=-1)},J=()=>{};return e.$$set=Z=>{"class"in Z&&n(2,f=Z.class),"apiKey"in Z&&n(25,a=Z.apiKey),"bbox"in Z&&n(26,_=Z.bbox),"clearButtonTitle"in Z&&n(3,x=Z.clearButtonTitle),"clearOnBlur"in Z&&n(27,S=Z.clearOnBlur),"collapsed"in Z&&n(4,L=Z.collapsed),"country"in Z&&n(28,A=Z.country),"debounceSearch"in Z&&n(29,P=Z.debounceSearch),"enableReverse"in Z&&n(5,O=Z.enableReverse),"errorMessage"in Z&&n(6,B=Z.errorMessage),"filter"in Z&&n(30,U=Z.filter),"flyTo"in Z&&n(31,Y=Z.flyTo),"fuzzyMatch"in Z&&n(32,V=Z.fuzzyMatch),"language"in Z&&n(33,$=Z.language),"limit"in Z&&n(34,K=Z.limit),"mapController"in Z&&n(35,it=Z.mapController),"minLength"in Z&&n(36,ft=Z.minLength),"noResultsMessage"in Z&&n(7,pt=Z.noResultsMessage),"placeholder"in Z&&n(8,gt=Z.placeholder),"proximity"in Z&&n(37,ut=Z.proximity),"reverseActive"in Z&&n(0,St=Z.reverseActive),"reverseButtonTitle"in Z&&n(9,_t=Z.reverseButtonTitle),"searchValue"in Z&&n(1,vt=Z.searchValue),"showFullGeometry"in Z&&n(38,ee=Z.showFullGeometry),"showPlaceType"in Z&&n(10,kt=Z.showPlaceType),"showResultsWhileTyping"in Z&&n(39,Gt=Z.showResultsWhileTyping),"selectFirst"in Z&&n(11,Qt=Z.selectFirst),"flyToSelected"in Z&&n(40,se=Z.flyToSelected),"markerOnSelected"in Z&&n(41,Ce=Z.markerOnSelected),"types"in Z&&n(42,yn=Z.types),"excludeTypes"in Z&&n(43,jn=Z.excludeTypes),"zoom"in Z&&n(44,Qe=Z.zoom),"maxZoom"in Z&&n(45,Fe=Z.maxZoom),"apiUrl"in Z&&n(46,ke=Z.apiUrl),"fetchParameters"in Z&&n(47,fn=Z.fetchParameters),"iconsBaseUrl"in Z&&n(12,Kn=Z.iconsBaseUrl),"adjustUrlQuery"in Z&&n(48,qn=Z.adjustUrlQuery),"$$scope"in Z&&n(58,l=Z.$$scope)},e.$$.update=()=>{if(e.$$.dirty[0]&134225920&&setTimeout(()=>{n(16,zn=wn),S&&!wn&&n(1,vt="")}),e.$$.dirty[0]&16386|e.$$.dirty[1]&32&&vt.length<ft&&(n(55,qe=void 0),n(14,yt=void 0),n(18,Wi=void 0),n(54,Ee=yt)),e.$$.dirty[1]&16777344&&ee&&qe&&!qe.address&&qe.geometry.type==="Point"&&qe.place_type[0]!=="reverse"&&Gs(qe.id,{byId:!0}).catch(Z=>n(18,Wi=Z)),e.$$.dirty[1]&50356241&&(it&&qe&&qe.id!==In&&Y&&(!qe.bbox||qe.bbox[0]===qe.bbox[2]&&qe.bbox[1]===qe.bbox[3]?it.flyTo(qe.center,qe.id.startsWith("poi.")||qe.id.startsWith("address.")?Fe:Qe):it.fitBounds(U1(qe.bbox),50,Fe),n(14,yt=void 0),n(54,Ee=void 0),n(15,pn=-1)),n(56,In=qe==null?void 0:qe.id)),e.$$.dirty[0]&18432&&Qt&&yt!=null&&yt.length&&n(15,pn=0),e.$$.dirty[0]&2050&&(Qt||n(15,pn=-1)),e.$$.dirty[0]&16384|e.$$.dirty[1]&8388608&&Ee!==yt&&n(54,Ee=void 0),e.$$.dirty[0]&81921|e.$$.dirty[1]&8388624&&it&&it.setEventHandler(Z=>{switch(Z.type){case"mapClick":St&&Sa(Z.coordinates);break;case"markerClick":{const ot=yt==null?void 0:yt.find(Mt=>Mt.id===Z.id);ot&&ri(ot)}break;case"markerMouseEnter":Ee&&n(15,pn=zn?(yt==null?void 0:yt.findIndex(ot=>ot.id===Z.id))??-1:-1);break;case"markerMouseLeave":Ee&&n(15,pn=-1);break}}),e.$$.dirty[0]&49152&&n(57,i=yt==null?void 0:yt[pn]),e.$$.dirty[1]&67133969&&it&&i&&Y&&se&&it.flyTo(i.center,i.id.startsWith("poi.")||i.id.startsWith("address.")?Fe:Qe),e.$$.dirty[1]&1040&&(Ce||it==null||it.setMarkers(void 0,void 0)),e.$$.dirty[1]&75498512&&it&&Ce&&!Ee&&(it.setMarkers(i?[i]:void 0,void 0),it.setSelectedMarker(i?0:-1)),e.$$.dirty[1]&25165840&&it&&it.setMarkers(Ee,qe),e.$$.dirty[0]&32768|e.$$.dirty[1]&8388624&&Ee&&it&&it.setSelectedMarker(pn),e.$$.dirty[0]&2|e.$$.dirty[1]&16&&it){const Z=Ha(vt);it.setReverseMarker(Z?[Z.decimalLongitude,Z.decimalLatitude]:void 0)}e.$$.dirty[1]&67108864&&oo("select",i),e.$$.dirty[1]&16777216&&oo("pick",qe),e.$$.dirty[0]&81920&&oo("optionsVisibilityChange",zn&&!!yt),e.$$.dirty[0]&16384&&oo("featuresListed",yt),e.$$.dirty[1]&8388608&&oo("featuresMarked",Ee),e.$$.dirty[0]&1&&oo("reverseToggle",St),e.$$.dirty[0]&2&&oo("queryChange",vt),e.$$.dirty[0]&1|e.$$.dirty[1]&16&&it&&it.indicateReverse(St)},[St,vt,f,x,L,O,B,pt,gt,_t,kt,Qt,Kn,wn,yt,pn,zn,Wn,Wi,Vi,es,ns,le,yo,ri,a,_,S,A,P,U,Y,V,$,K,it,ft,ut,ee,Gt,se,Ce,yn,jn,Qe,Fe,ke,fn,qn,re,De,hn,On,yi,Ee,qe,In,i,l,r,Ea,ws,ce,ln,Ke,Ar,is,on,Ss,st,G,q,J]}class KT extends nn{constructor(t){super(),en(this,t,YT,HT,He,{class:2,apiKey:25,bbox:26,clearButtonTitle:3,clearOnBlur:27,collapsed:4,country:28,debounceSearch:29,enableReverse:5,errorMessage:6,filter:30,flyTo:31,fuzzyMatch:32,language:33,limit:34,mapController:35,minLength:36,noResultsMessage:7,placeholder:8,proximity:37,reverseActive:0,reverseButtonTitle:9,searchValue:1,showFullGeometry:38,showPlaceType:10,showResultsWhileTyping:39,selectFirst:11,flyToSelected:40,markerOnSelected:41,types:42,excludeTypes:43,zoom:44,maxZoom:45,apiUrl:46,fetchParameters:47,iconsBaseUrl:12,adjustUrlQuery:48,focus:49,blur:50,setQuery:51,clearList:52,clearMap:53},null,[-1,-1,-1])}get focus(){return this.$$.ctx[49]}get blur(){return this.$$.ctx[50]}get setQuery(){return this.$$.ctx[51]}get clearList(){return this.$$.ctx[52]}get clearMap(){return this.$$.ctx[53]}}function J1(e){let t,n,i;return n=new KT({props:{mapController:e[0],apiKey:ky}}),{c(){t=wt("div"),Zt(n.$$.fragment),Rt(t,"class","svelte-ixhnie")},m(r,l){Ct(r,t,l),jt(n,t,null),i=!0},p(r,l){const f={};l&1&&(f.mapController=r[0]),n.$set(f)},i(r){i||(mt(n.$$.fragment,r),i=!0)},o(r){xt(n.$$.fragment,r),i=!1},d(r){r&&It(t),qt(n)}}}function JT(e){let t,n,i=e[0]&&J1(e);return{c(){i&&i.c(),t=ts()},m(r,l){i&&i.m(r,l),Ct(r,t,l),n=!0},p(r,[l]){r[0]?i?(i.p(r,l),l&1&&mt(i,1)):(i=J1(r),i.c(),mt(i,1),i.m(t.parentNode,t)):i&&(ci(),xt(i,1,1,()=>{i=null}),hi())},i(r){n||(mt(i),n=!0)},o(r){xt(i),n=!1},d(r){r&&It(t),i&&i.d(r)}}}function QT(e,t,n){let i,r;return Se(e,Du,l=>n(1,r=l)),e.$$.update=()=>{e.$$.dirty&2&&n(0,i=r?fT(r,Ms):null)},[i,r]}class tL extends nn{constructor(t){super(),en(this,t,QT,JT,He,{})}}const eL=e=>({}),Q1=e=>({}),nL=e=>({}),tb=e=>({}),iL=e=>({}),eb=e=>({});function rL(e){let t,n,i,r,l,f;const a=e[1].top,_=sr(a,e,e[0],eb),x=e[1].left,S=sr(x,e,e[0],tb),L=e[1].main,A=sr(L,e,e[0],Q1);return{c(){t=wt("div"),_&&_.c(),n=Xt(),i=wt("div"),S&&S.c(),r=Xt(),l=wt("div"),A&&A.c(),Rt(t,"class","top svelte-3nmiww"),Rt(i,"class","left svelte-3nmiww"),Rt(l,"class","main svelte-3nmiww")},m(P,O){Ct(P,t,O),_&&_.m(t,null),Ct(P,n,O),Ct(P,i,O),S&&S.m(i,null),Ct(P,r,O),Ct(P,l,O),A&&A.m(l,null),f=!0},p(P,[O]){_&&_.p&&(!f||O&1)&&lr(_,a,P,P[0],f?ar(a,P[0],O,iL):ur(P[0]),eb),S&&S.p&&(!f||O&1)&&lr(S,x,P,P[0],f?ar(x,P[0],O,nL):ur(P[0]),tb),A&&A.p&&(!f||O&1)&&lr(A,L,P,P[0],f?ar(L,P[0],O,eL):ur(P[0]),Q1)},i(P){f||(mt(_,P),mt(S,P),mt(A,P),f=!0)},o(P){xt(_,P),xt(S,P),xt(A,P),f=!1},d(P){P&&(It(t),It(n),It(i),It(r),It(l)),_&&_.d(P),S&&S.d(P),A&&A.d(P)}}}function oL(e,t,n){let{$$slots:i={},$$scope:r}=t;return e.$$set=l=>{"$$scope"in l&&n(0,r=l.$$scope)},[r,i]}class sL extends nn{constructor(t){super(),en(this,t,oL,rL,He,{})}}function aL(e){let t,n,i,r;const l=e[1].default,f=sr(l,e,e[0],null);return{c(){t=wt("a"),f&&f.c(),Rt(t,"href","#")},m(a,_){Ct(a,t,_),f&&f.m(t,null),n=!0,i||(r=Ze(t,"click",e[2]),i=!0)},p(a,[_]){f&&f.p&&(!n||_&1)&&lr(f,l,a,a[0],n?ar(l,a[0],_,null):ur(a[0]),null)},i(a){n||(mt(f,a),n=!0)},o(a){xt(f,a),n=!1},d(a){a&&It(t),f&&f.d(a),i=!1,r()}}}function lL(e,t,n){let{$$slots:i={},$$scope:r}=t;function l(f){ii.call(this,e,f)}return e.$$set=f=>{"$$scope"in f&&n(0,r=f.$$scope)},[r,i,l]}class xi extends nn{constructor(t){super(),en(this,t,lL,aL,He,{})}}function nb(e){let t,n;return{c(){t=wt("div"),n=ge(e[0]),Rt(t,"class","svelte-1uuov7f")},m(i,r){Ct(i,t,r),dt(t,n)},p(i,r){r&1&&zi(n,i[0])},d(i){i&&It(t)}}}function uL(e){let t,n=e[0]&&nb(e);return{c(){n&&n.c(),t=ts()},m(i,r){n&&n.m(i,r),Ct(i,t,r)},p(i,[r]){i[0]?n?n.p(i,r):(n=nb(i),n.c(),n.m(t.parentNode,t)):n&&(n.d(1),n=null)},i:Ie,o:Ie,d(i){i&&It(t),n&&n.d(i)}}}function cL(e,t,n){let{msg:i=null}=t;return e.$$set=r=>{"msg"in r&&n(0,i=r.msg)},[i]}class hw extends nn{constructor(t){super(),en(this,t,cL,uL,He,{msg:0})}}const hL=e=>({dialog:e&1}),ib=e=>({dialog:e[0]});function fL(e){let t,n,i,r,l;const f=e[4].default,a=sr(f,e,e[3],ib);return{c(){t=wt("dialog"),n=wt("article"),a&&a.c(),t.open=!0},m(_,x){Ct(_,t,x),dt(t,n),a&&a.m(n,null),e[6](t),i=!0,r||(l=[Ze(window,"click",e[1]),Ze(window,"keydown",e[2]),Ze(t,"close",e[5])],r=!0)},p(_,[x]){a&&a.p&&(!i||x&9)&&lr(a,f,_,_[3],i?ar(f,_[3],x,hL):ur(_[3]),ib)},i(_){i||(mt(a,_),i=!0)},o(_){xt(a,_),i=!1},d(_){_&&It(t),a&&a.d(_),e[6](null),r=!1,No(l)}}}function pL(e,t,n){let{$$slots:i={},$$scope:r}=t,l;function f(S){l.open&&S.target==l&&l.close()}function a(S){(S.key=="Escape"||S.key=="Enter")&&(S.stopPropagation(),l.close())}function _(S){ii.call(this,e,S)}function x(S){cr[S?"unshift":"push"](()=>{l=S,n(0,l)})}return e.$$set=S=>{"$$scope"in S&&n(3,r=S.$$scope)},[l,f,a,r,i,_,x]}class Ky extends nn{constructor(t){super(),en(this,t,pL,fL,He,{})}}var To=63710088e-1,Jy={centimeters:To*100,centimetres:To*100,degrees:To/111325,feet:To*3.28084,inches:To*39.37,kilometers:To/1e3,kilometres:To/1e3,meters:To,metres:To,miles:To/1609.344,millimeters:To*1e3,millimetres:To*1e3,nauticalmiles:To/1852,radians:1,yards:To*1.0936},dL={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/To,yards:1.0936133},Iy={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function va(e,t,n){n===void 0&&(n={});var i={type:"Feature"};return(n.id===0||n.id)&&(i.id=n.id),n.bbox&&(i.bbox=n.bbox),i.properties=t||{},i.geometry=e,i}function mL(e,t,n){switch(e){case"Point":return ps(t).geometry;case"LineString":return ia(t).geometry;case"Polygon":return Qy(t).geometry;case"MultiPoint":return pw(t).geometry;case"MultiLineString":return fw(t).geometry;case"MultiPolygon":return dw(t).geometry;default:throw new Error(e+" is invalid")}}function ps(e,t,n){if(n===void 0&&(n={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!hg(e[0])||!hg(e[1]))throw new Error("coordinates must contain numbers");var i={type:"Point",coordinates:e};return va(i,t,n)}function gL(e,t,n){return n===void 0&&(n={}),Nc(e.map(function(i){return ps(i,t)}),n)}function Qy(e,t,n){n===void 0&&(n={});for(var i=0,r=e;i<r.length;i++){var l=r[i];if(l.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var f=0;f<l[l.length-1].length;f++)if(l[l.length-1][f]!==l[0][f])throw new Error("First and last Position are not equivalent.")}var a={type:"Polygon",coordinates:e};return va(a,t,n)}function _L(e,t,n){return n===void 0&&(n={}),Nc(e.map(function(i){return Qy(i,t)}),n)}function ia(e,t,n){if(n===void 0&&(n={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");var i={type:"LineString",coordinates:e};return va(i,t,n)}function yL(e,t,n){return n===void 0&&(n={}),Nc(e.map(function(i){return ia(i,t)}),n)}function Nc(e,t){t===void 0&&(t={});var n={type:"FeatureCollection"};return t.id&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.features=e,n}function fw(e,t,n){n===void 0&&(n={});var i={type:"MultiLineString",coordinates:e};return va(i,t,n)}function pw(e,t,n){n===void 0&&(n={});var i={type:"MultiPoint",coordinates:e};return va(i,t,n)}function dw(e,t,n){n===void 0&&(n={});var i={type:"MultiPolygon",coordinates:e};return va(i,t,n)}function vL(e,t,n){n===void 0&&(n={});var i={type:"GeometryCollection",geometries:e};return va(i,t,n)}function bL(e,t){if(t===void 0&&(t=0),t&&!(t>=0))throw new Error("precision must be a positive number");var n=Math.pow(10,t||0);return Math.round(e*n)/n}function t0(e,t){t===void 0&&(t="kilometers");var n=Jy[t];if(!n)throw new Error(t+" units is invalid");return e*n}function Ag(e,t){t===void 0&&(t="kilometers");var n=Jy[t];if(!n)throw new Error(t+" units is invalid");return e/n}function xL(e,t){return ad(Ag(e,t))}function wL(e){var t=e%360;return t<0&&(t+=360),t}function ad(e){var t=e%(2*Math.PI);return t*180/Math.PI}function ra(e){var t=e%360;return t*Math.PI/180}function SL(e,t,n){if(t===void 0&&(t="kilometers"),n===void 0&&(n="kilometers"),!(e>=0))throw new Error("length must be a positive number");return t0(Ag(e,t),n)}function EL(e,t,n){if(t===void 0&&(t="meters"),n===void 0&&(n="kilometers"),!(e>=0))throw new Error("area must be a positive number");var i=Iy[t];if(!i)throw new Error("invalid original units");var r=Iy[n];if(!r)throw new Error("invalid final units");return e/i*r}function hg(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function e0(e){return!!e&&e.constructor===Object}function IL(e){if(!e)throw new Error("bbox is required");if(!Array.isArray(e))throw new Error("bbox must be an Array");if(e.length!==4&&e.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");e.forEach(function(t){if(!hg(t))throw new Error("bbox must only contain numbers")})}function CL(e){if(!e)throw new Error("id is required");if(["string","number"].indexOf(typeof e)===-1)throw new Error("id must be a number or a string")}const TL=Object.freeze(Object.defineProperty({__proto__:null,areaFactors:Iy,bearingToAzimuth:wL,convertArea:EL,convertLength:SL,degreesToRadians:ra,earthRadius:To,factors:Jy,feature:va,featureCollection:Nc,geometry:mL,geometryCollection:vL,isNumber:hg,isObject:e0,lengthToDegrees:xL,lengthToRadians:Ag,lineString:ia,lineStrings:yL,multiLineString:fw,multiPoint:pw,multiPolygon:dw,point:ps,points:gL,polygon:Qy,polygons:_L,radiansToDegrees:ad,radiansToLength:t0,round:bL,unitsFactors:dL,validateBBox:IL,validateId:CL},Symbol.toStringTag,{value:"Module"}));function ld(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if(e.type==="Feature"&&e.geometry!==null&&e.geometry.type==="Point")return e.geometry.coordinates;if(e.type==="Point")return e.coordinates}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return e;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function rf(e){if(Array.isArray(e))return e;if(e.type==="Feature"){if(e.geometry!==null)return e.geometry.coordinates}else if(e.coordinates)return e.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function mw(e,t,n){if(n===void 0&&(n={}),n.final===!0)return LL(e,t);var i=ld(e),r=ld(t),l=ra(i[0]),f=ra(r[0]),a=ra(i[1]),_=ra(r[1]),x=Math.sin(f-l)*Math.cos(_),S=Math.cos(a)*Math.sin(_)-Math.sin(a)*Math.cos(_)*Math.cos(f-l);return ad(Math.atan2(x,S))}function LL(e,t){var n=mw(t,e);return n=(n+180)%360,n}function Ep(e,t,n){n===void 0&&(n={});var i=ld(e),r=ld(t),l=ra(r[1]-i[1]),f=ra(r[0]-i[0]),a=ra(i[1]),_=ra(r[1]),x=Math.pow(Math.sin(l/2),2)+Math.pow(Math.sin(f/2),2)*Math.cos(a)*Math.cos(_);return t0(2*Math.atan2(Math.sqrt(x),Math.sqrt(1-x)),n.units)}function rb(e,t,n,i){i===void 0&&(i={});var r=ld(e),l=ra(r[0]),f=ra(r[1]),a=ra(n),_=Ag(t,i.units),x=Math.asin(Math.sin(f)*Math.cos(_)+Math.cos(f)*Math.sin(_)*Math.cos(a)),S=l+Math.atan2(Math.sin(a)*Math.sin(_)*Math.cos(f),Math.cos(_)-Math.sin(f)*Math.sin(x)),L=ad(S),A=ad(x);return ps([L,A],i.properties)}function bd(e,t,n){if(e!==null)for(var i,r,l,f,a,_,x,S=0,L=0,A,P=e.type,O=P==="FeatureCollection",B=P==="Feature",U=O?e.features.length:1,Y=0;Y<U;Y++){x=O?e.features[Y].geometry:B?e.geometry:e,A=x?x.type==="GeometryCollection":!1,a=A?x.geometries.length:1;for(var V=0;V<a;V++){var $=0,K=0;if(f=A?x.geometries[V]:x,f!==null){_=f.coordinates;var it=f.type;switch(S=n&&(it==="Polygon"||it==="MultiPolygon")?1:0,it){case null:break;case"Point":if(t(_,L,Y,$,K)===!1)return!1;L++,$++;break;case"LineString":case"MultiPoint":for(i=0;i<_.length;i++){if(t(_[i],L,Y,$,K)===!1)return!1;L++,it==="MultiPoint"&&$++}it==="LineString"&&$++;break;case"Polygon":case"MultiLineString":for(i=0;i<_.length;i++){for(r=0;r<_[i].length-S;r++){if(t(_[i][r],L,Y,$,K)===!1)return!1;L++}it==="MultiLineString"&&$++,it==="Polygon"&&K++}it==="Polygon"&&$++;break;case"MultiPolygon":for(i=0;i<_.length;i++){for(K=0,r=0;r<_[i].length;r++){for(l=0;l<_[i][r].length-S;l++){if(t(_[i][r][l],L,Y,$,K)===!1)return!1;L++}K++}$++}break;case"GeometryCollection":for(i=0;i<f.geometries.length;i++)if(bd(f.geometries[i],t,n)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function ML(e,t,n,i){var r=n;return bd(e,function(l,f,a,_,x){f===0&&n===void 0?r=l:r=t(r,l,f,a,_,x)},i),r}function gw(e,t){var n;switch(e.type){case"FeatureCollection":for(n=0;n<e.features.length&&t(e.features[n].properties,n)!==!1;n++);break;case"Feature":t(e.properties,0);break}}function PL(e,t,n){var i=n;return gw(e,function(r,l){l===0&&n===void 0?i=r:i=t(i,r,l)}),i}function fg(e,t){if(e.type==="Feature")t(e,0);else if(e.type==="FeatureCollection")for(var n=0;n<e.features.length&&t(e.features[n],n)!==!1;n++);}function kL(e,t,n){var i=n;return fg(e,function(r,l){l===0&&n===void 0?i=r:i=t(i,r,l)}),i}function AL(e){var t=[];return bd(e,function(n){t.push(n)}),t}function n0(e,t){var n,i,r,l,f,a,_,x,S,L,A=0,P=e.type==="FeatureCollection",O=e.type==="Feature",B=P?e.features.length:1;for(n=0;n<B;n++){for(a=P?e.features[n].geometry:O?e.geometry:e,x=P?e.features[n].properties:O?e.properties:{},S=P?e.features[n].bbox:O?e.bbox:void 0,L=P?e.features[n].id:O?e.id:void 0,_=a?a.type==="GeometryCollection":!1,f=_?a.geometries.length:1,r=0;r<f;r++){if(l=_?a.geometries[r]:a,l===null){if(t(null,A,x,S,L)===!1)return!1;continue}switch(l.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(t(l,A,x,S,L)===!1)return!1;break}case"GeometryCollection":{for(i=0;i<l.geometries.length;i++)if(t(l.geometries[i],A,x,S,L)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}A++}}function NL(e,t,n){var i=n;return n0(e,function(r,l,f,a,_){l===0&&n===void 0?i=r:i=t(i,r,l,f,a,_)}),i}function pf(e,t){n0(e,function(n,i,r,l,f){var a=n===null?null:n.type;switch(a){case null:case"Point":case"LineString":case"Polygon":return t(va(n,r,{bbox:l,id:f}),i,0)===!1?!1:void 0}var _;switch(a){case"MultiPoint":_="Point";break;case"MultiLineString":_="LineString";break;case"MultiPolygon":_="Polygon";break}for(var x=0;x<n.coordinates.length;x++){var S=n.coordinates[x],L={type:_,coordinates:S};if(t(va(L,r),i,x)===!1)return!1}})}function DL(e,t,n){var i=n;return pf(e,function(r,l,f){l===0&&f===0&&n===void 0?i=r:i=t(i,r,l,f)}),i}function _w(e,t){pf(e,function(n,i,r){var l=0;if(n.geometry){var f=n.geometry.type;if(!(f==="Point"||f==="MultiPoint")){var a,_=0,x=0,S=0;if(bd(n,function(L,A,P,O,B){if(a===void 0||i>_||O>x||B>S){a=L,_=i,x=O,S=B,l=0;return}var U=ia([a,L],n.properties);if(t(U,i,r,B,l)===!1)return!1;l++,a=L})===!1)return!1}}})}function RL(e,t,n){var i=n,r=!1;return _w(e,function(l,f,a,_,x){r===!1&&n===void 0?i=l:i=t(i,l,f,a,_,x),r=!0}),i}function yw(e,t){if(!e)throw new Error("geojson is required");pf(e,function(n,i,r){if(n.geometry!==null){var l=n.geometry.type,f=n.geometry.coordinates;switch(l){case"LineString":if(t(n,i,r,0,0)===!1)return!1;break;case"Polygon":for(var a=0;a<f.length;a++)if(t(ia(f[a],n.properties),i,r,a)===!1)return!1;break}}})}function OL(e,t,n){var i=n;return yw(e,function(r,l,f,a){l===0&&n===void 0?i=r:i=t(i,r,l,f,a)}),i}function zL(e,t){if(t=t||{},!e0(t))throw new Error("options is invalid");var n=t.featureIndex||0,i=t.multiFeatureIndex||0,r=t.geometryIndex||0,l=t.segmentIndex||0,f=t.properties,a;switch(e.type){case"FeatureCollection":n<0&&(n=e.features.length+n),f=f||e.features[n].properties,a=e.features[n].geometry;break;case"Feature":f=f||e.properties,a=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":a=e;break;default:throw new Error("geojson is invalid")}if(a===null)return null;var _=a.coordinates;switch(a.type){case"Point":case"MultiPoint":return null;case"LineString":return l<0&&(l=_.length+l-1),ia([_[l],_[l+1]],f,t);case"Polygon":return r<0&&(r=_.length+r),l<0&&(l=_[r].length+l-1),ia([_[r][l],_[r][l+1]],f,t);case"MultiLineString":return i<0&&(i=_.length+i),l<0&&(l=_[i].length+l-1),ia([_[i][l],_[i][l+1]],f,t);case"MultiPolygon":return i<0&&(i=_.length+i),r<0&&(r=_[i].length+r),l<0&&(l=_[i][r].length-l-1),ia([_[i][r][l],_[i][r][l+1]],f,t)}throw new Error("geojson is invalid")}function FL(e,t){if(t=t||{},!e0(t))throw new Error("options is invalid");var n=t.featureIndex||0,i=t.multiFeatureIndex||0,r=t.geometryIndex||0,l=t.coordIndex||0,f=t.properties,a;switch(e.type){case"FeatureCollection":n<0&&(n=e.features.length+n),f=f||e.features[n].properties,a=e.features[n].geometry;break;case"Feature":f=f||e.properties,a=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":a=e;break;default:throw new Error("geojson is invalid")}if(a===null)return null;var _=a.coordinates;switch(a.type){case"Point":return ps(_,f,t);case"MultiPoint":return i<0&&(i=_.length+i),ps(_[i],f,t);case"LineString":return l<0&&(l=_.length+l),ps(_[l],f,t);case"Polygon":return r<0&&(r=_.length+r),l<0&&(l=_[r].length+l),ps(_[r][l],f,t);case"MultiLineString":return i<0&&(i=_.length+i),l<0&&(l=_[i].length+l),ps(_[i][l],f,t);case"MultiPolygon":return i<0&&(i=_.length+i),r<0&&(r=_[i].length+r),l<0&&(l=_[i][r].length-l),ps(_[i][r][l],f,t)}throw new Error("geojson is invalid")}const BL=Object.freeze(Object.defineProperty({__proto__:null,coordAll:AL,coordEach:bd,coordReduce:ML,featureEach:fg,featureReduce:kL,findPoint:FL,findSegment:zL,flattenEach:pf,flattenReduce:DL,geomEach:n0,geomReduce:NL,lineEach:yw,lineReduce:OL,propEach:gw,propReduce:PL,segmentEach:_w,segmentReduce:RL},Symbol.toStringTag,{value:"Module"}));function ob(e){if(!e)throw new Error("geojson is required");var t=[];return pf(e,function(n){VL(n,t)}),Nc(t)}function VL(e,t){var n=[],i=e.geometry;if(i!==null){switch(i.type){case"Polygon":n=rf(i);break;case"LineString":n=[rf(i)]}n.forEach(function(r){var l=UL(r,e.properties);l.forEach(function(f){f.id=t.length,t.push(f)})})}}function UL(e,t){var n=[];return e.reduce(function(i,r){var l=ia([i,r],t);return l.bbox=GL(i,r),n.push(l),r}),n}function GL(e,t){var n=e[0],i=e[1],r=t[0],l=t[1],f=n<r?n:r,a=i<l?i:l,_=n>r?n:r,x=i>l?i:l;return[f,a,_,x]}var i0={exports:{}},vw={exports:{}};(function(e,t){(function(n,i){e.exports=i()})(Qb,function(){function n(V,$,K,it,ft){(function pt(gt,ut,St,_t,vt){for(;_t>St;){if(_t-St>600){var ee=_t-St+1,kt=ut-St+1,Gt=Math.log(ee),Qt=.5*Math.exp(2*Gt/3),se=.5*Math.sqrt(Gt*Qt*(ee-Qt)/ee)*(kt-ee/2<0?-1:1),Ce=Math.max(St,Math.floor(ut-kt*Qt/ee+se)),yn=Math.min(_t,Math.floor(ut+(ee-kt)*Qt/ee+se));pt(gt,ut,Ce,yn,vt)}var jn=gt[ut],Qe=St,Fe=_t;for(i(gt,St,ut),vt(gt[_t],jn)>0&&i(gt,St,_t);Qe<Fe;){for(i(gt,Qe,Fe),Qe++,Fe--;vt(gt[Qe],jn)<0;)Qe++;for(;vt(gt[Fe],jn)>0;)Fe--}vt(gt[St],jn)===0?i(gt,St,Fe):i(gt,++Fe,_t),Fe<=ut&&(St=Fe+1),ut<=Fe&&(_t=Fe-1)}})(V,$,K||0,it||V.length-1,ft||r)}function i(V,$,K){var it=V[$];V[$]=V[K],V[K]=it}function r(V,$){return V<$?-1:V>$?1:0}var l=function(V){V===void 0&&(V=9),this._maxEntries=Math.max(4,V),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function f(V,$,K){if(!K)return $.indexOf(V);for(var it=0;it<$.length;it++)if(K(V,$[it]))return it;return-1}function a(V,$){_(V,0,V.children.length,$,V)}function _(V,$,K,it,ft){ft||(ft=U(null)),ft.minX=1/0,ft.minY=1/0,ft.maxX=-1/0,ft.maxY=-1/0;for(var pt=$;pt<K;pt++){var gt=V.children[pt];x(ft,V.leaf?it(gt):gt)}return ft}function x(V,$){return V.minX=Math.min(V.minX,$.minX),V.minY=Math.min(V.minY,$.minY),V.maxX=Math.max(V.maxX,$.maxX),V.maxY=Math.max(V.maxY,$.maxY),V}function S(V,$){return V.minX-$.minX}function L(V,$){return V.minY-$.minY}function A(V){return(V.maxX-V.minX)*(V.maxY-V.minY)}function P(V){return V.maxX-V.minX+(V.maxY-V.minY)}function O(V,$){return V.minX<=$.minX&&V.minY<=$.minY&&$.maxX<=V.maxX&&$.maxY<=V.maxY}function B(V,$){return $.minX<=V.maxX&&$.minY<=V.maxY&&$.maxX>=V.minX&&$.maxY>=V.minY}function U(V){return{children:V,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function Y(V,$,K,it,ft){for(var pt=[$,K];pt.length;)if(!((K=pt.pop())-($=pt.pop())<=it)){var gt=$+Math.ceil((K-$)/it/2)*it;n(V,gt,$,K,ft),pt.push($,gt,gt,K)}}return l.prototype.all=function(){return this._all(this.data,[])},l.prototype.search=function(V){var $=this.data,K=[];if(!B(V,$))return K;for(var it=this.toBBox,ft=[];$;){for(var pt=0;pt<$.children.length;pt++){var gt=$.children[pt],ut=$.leaf?it(gt):gt;B(V,ut)&&($.leaf?K.push(gt):O(V,ut)?this._all(gt,K):ft.push(gt))}$=ft.pop()}return K},l.prototype.collides=function(V){var $=this.data;if(!B(V,$))return!1;for(var K=[];$;){for(var it=0;it<$.children.length;it++){var ft=$.children[it],pt=$.leaf?this.toBBox(ft):ft;if(B(V,pt)){if($.leaf||O(V,pt))return!0;K.push(ft)}}$=K.pop()}return!1},l.prototype.load=function(V){if(!V||!V.length)return this;if(V.length<this._minEntries){for(var $=0;$<V.length;$++)this.insert(V[$]);return this}var K=this._build(V.slice(),0,V.length-1,0);if(this.data.children.length)if(this.data.height===K.height)this._splitRoot(this.data,K);else{if(this.data.height<K.height){var it=this.data;this.data=K,K=it}this._insert(K,this.data.height-K.height-1,!0)}else this.data=K;return this},l.prototype.insert=function(V){return V&&this._insert(V,this.data.height-1),this},l.prototype.clear=function(){return this.data=U([]),this},l.prototype.remove=function(V,$){if(!V)return this;for(var K,it,ft,pt=this.data,gt=this.toBBox(V),ut=[],St=[];pt||ut.length;){if(pt||(pt=ut.pop(),it=ut[ut.length-1],K=St.pop(),ft=!0),pt.leaf){var _t=f(V,pt.children,$);if(_t!==-1)return pt.children.splice(_t,1),ut.push(pt),this._condense(ut),this}ft||pt.leaf||!O(pt,gt)?it?(K++,pt=it.children[K],ft=!1):pt=null:(ut.push(pt),St.push(K),K=0,it=pt,pt=pt.children[0])}return this},l.prototype.toBBox=function(V){return V},l.prototype.compareMinX=function(V,$){return V.minX-$.minX},l.prototype.compareMinY=function(V,$){return V.minY-$.minY},l.prototype.toJSON=function(){return this.data},l.prototype.fromJSON=function(V){return this.data=V,this},l.prototype._all=function(V,$){for(var K=[];V;)V.leaf?$.push.apply($,V.children):K.push.apply(K,V.children),V=K.pop();return $},l.prototype._build=function(V,$,K,it){var ft,pt=K-$+1,gt=this._maxEntries;if(pt<=gt)return a(ft=U(V.slice($,K+1)),this.toBBox),ft;it||(it=Math.ceil(Math.log(pt)/Math.log(gt)),gt=Math.ceil(pt/Math.pow(gt,it-1))),(ft=U([])).leaf=!1,ft.height=it;var ut=Math.ceil(pt/gt),St=ut*Math.ceil(Math.sqrt(gt));Y(V,$,K,St,this.compareMinX);for(var _t=$;_t<=K;_t+=St){var vt=Math.min(_t+St-1,K);Y(V,_t,vt,ut,this.compareMinY);for(var ee=_t;ee<=vt;ee+=ut){var kt=Math.min(ee+ut-1,vt);ft.children.push(this._build(V,ee,kt,it-1))}}return a(ft,this.toBBox),ft},l.prototype._chooseSubtree=function(V,$,K,it){for(;it.push($),!$.leaf&&it.length-1!==K;){for(var ft=1/0,pt=1/0,gt=void 0,ut=0;ut<$.children.length;ut++){var St=$.children[ut],_t=A(St),vt=(ee=V,kt=St,(Math.max(kt.maxX,ee.maxX)-Math.min(kt.minX,ee.minX))*(Math.max(kt.maxY,ee.maxY)-Math.min(kt.minY,ee.minY))-_t);vt<pt?(pt=vt,ft=_t<ft?_t:ft,gt=St):vt===pt&&_t<ft&&(ft=_t,gt=St)}$=gt||$.children[0]}var ee,kt;return $},l.prototype._insert=function(V,$,K){var it=K?V:this.toBBox(V),ft=[],pt=this._chooseSubtree(it,this.data,$,ft);for(pt.children.push(V),x(pt,it);$>=0&&ft[$].children.length>this._maxEntries;)this._split(ft,$),$--;this._adjustParentBBoxes(it,ft,$)},l.prototype._split=function(V,$){var K=V[$],it=K.children.length,ft=this._minEntries;this._chooseSplitAxis(K,ft,it);var pt=this._chooseSplitIndex(K,ft,it),gt=U(K.children.splice(pt,K.children.length-pt));gt.height=K.height,gt.leaf=K.leaf,a(K,this.toBBox),a(gt,this.toBBox),$?V[$-1].children.push(gt):this._splitRoot(K,gt)},l.prototype._splitRoot=function(V,$){this.data=U([V,$]),this.data.height=V.height+1,this.data.leaf=!1,a(this.data,this.toBBox)},l.prototype._chooseSplitIndex=function(V,$,K){for(var it,ft,pt,gt,ut,St,_t,vt=1/0,ee=1/0,kt=$;kt<=K-$;kt++){var Gt=_(V,0,kt,this.toBBox),Qt=_(V,kt,K,this.toBBox),se=(ft=Gt,pt=Qt,gt=void 0,ut=void 0,St=void 0,_t=void 0,gt=Math.max(ft.minX,pt.minX),ut=Math.max(ft.minY,pt.minY),St=Math.min(ft.maxX,pt.maxX),_t=Math.min(ft.maxY,pt.maxY),Math.max(0,St-gt)*Math.max(0,_t-ut)),Ce=A(Gt)+A(Qt);se<vt?(vt=se,it=kt,ee=Ce<ee?Ce:ee):se===vt&&Ce<ee&&(ee=Ce,it=kt)}return it||K-$},l.prototype._chooseSplitAxis=function(V,$,K){var it=V.leaf?this.compareMinX:S,ft=V.leaf?this.compareMinY:L;this._allDistMargin(V,$,K,it)<this._allDistMargin(V,$,K,ft)&&V.children.sort(it)},l.prototype._allDistMargin=function(V,$,K,it){V.children.sort(it);for(var ft=this.toBBox,pt=_(V,0,$,ft),gt=_(V,K-$,K,ft),ut=P(pt)+P(gt),St=$;St<K-$;St++){var _t=V.children[St];x(pt,V.leaf?ft(_t):_t),ut+=P(pt)}for(var vt=K-$-1;vt>=$;vt--){var ee=V.children[vt];x(gt,V.leaf?ft(ee):ee),ut+=P(gt)}return ut},l.prototype._adjustParentBBoxes=function(V,$,K){for(var it=K;it>=0;it--)x($[it],V)},l.prototype._condense=function(V){for(var $=V.length-1,K=void 0;$>=0;$--)V[$].children.length===0?$>0?(K=V[$-1].children).splice(K.indexOf(V[$]),1):this.clear():a(V[$],this.toBBox)},l})})(vw);var jL=vw.exports;const qL=ex(TL),bw=ex(BL);var r0={};Object.defineProperty(r0,"__esModule",{value:!0});var ZL=bw;function Cy(e){var t=[1/0,1/0,-1/0,-1/0];return ZL.coordEach(e,function(n){t[0]>n[0]&&(t[0]=n[0]),t[1]>n[1]&&(t[1]=n[1]),t[2]<n[0]&&(t[2]=n[0]),t[3]<n[1]&&(t[3]=n[1])}),t}Cy.default=Cy;r0.default=Cy;var sl=jL,xw=qL,ww=bw,Lh=r0.default,$L=ww.featureEach;ww.coordEach;xw.polygon;var sb=xw.featureCollection;function Sw(e){var t=new sl(e);return t.insert=function(n){if(n.type!=="Feature")throw new Error("invalid feature");return n.bbox=n.bbox?n.bbox:Lh(n),sl.prototype.insert.call(this,n)},t.load=function(n){var i=[];return Array.isArray(n)?n.forEach(function(r){if(r.type!=="Feature")throw new Error("invalid features");r.bbox=r.bbox?r.bbox:Lh(r),i.push(r)}):$L(n,function(r){if(r.type!=="Feature")throw new Error("invalid features");r.bbox=r.bbox?r.bbox:Lh(r),i.push(r)}),sl.prototype.load.call(this,i)},t.remove=function(n,i){if(n.type!=="Feature")throw new Error("invalid feature");return n.bbox=n.bbox?n.bbox:Lh(n),sl.prototype.remove.call(this,n,i)},t.clear=function(){return sl.prototype.clear.call(this)},t.search=function(n){var i=sl.prototype.search.call(this,this.toBBox(n));return sb(i)},t.collides=function(n){return sl.prototype.collides.call(this,this.toBBox(n))},t.all=function(){var n=sl.prototype.all.call(this);return sb(n)},t.toJSON=function(){return sl.prototype.toJSON.call(this)},t.fromJSON=function(n){return sl.prototype.fromJSON.call(this,n)},t.toBBox=function(n){var i;if(n.bbox)i=n.bbox;else if(Array.isArray(n)&&n.length===4)i=n;else if(Array.isArray(n)&&n.length===6)i=[n[0],n[1],n[3],n[4]];else if(n.type==="Feature")i=Lh(n);else if(n.type==="FeatureCollection")i=Lh(n);else throw new Error("invalid geojson");return{minX:i[0],minY:i[1],maxX:i[2],maxY:i[3]}},t}i0.exports=Sw;i0.exports.default=Sw;var WL=i0.exports;const XL=tx(WL);function HL(e,t){var n={},i=[];if(e.type==="LineString"&&(e=va(e)),t.type==="LineString"&&(t=va(t)),e.type==="Feature"&&t.type==="Feature"&&e.geometry!==null&&t.geometry!==null&&e.geometry.type==="LineString"&&t.geometry.type==="LineString"&&e.geometry.coordinates.length===2&&t.geometry.coordinates.length===2){var r=ab(e,t);return r&&i.push(r),Nc(i)}var l=XL();return l.load(ob(t)),fg(ob(e),function(f){fg(l.search(f),function(a){var _=ab(f,a);if(_){var x=rf(_).join(",");n[x]||(n[x]=!0,i.push(_))}})}),Nc(i)}function ab(e,t){var n=rf(e),i=rf(t);if(n.length!==2)throw new Error("<intersects> line1 must only contain 2 coordinates");if(i.length!==2)throw new Error("<intersects> line2 must only contain 2 coordinates");var r=n[0][0],l=n[0][1],f=n[1][0],a=n[1][1],_=i[0][0],x=i[0][1],S=i[1][0],L=i[1][1],A=(L-x)*(f-r)-(S-_)*(a-l),P=(S-_)*(l-x)-(L-x)*(r-_),O=(f-r)*(l-x)-(a-l)*(r-_);if(A===0)return null;var B=P/A,U=O/A;if(B>=0&&B<=1&&U>=0&&U<=1){var Y=r+B*(f-r),V=l+B*(a-l);return ps([Y,V])}return null}function YL(e,t,n){n===void 0&&(n={});var i=ps([1/0,1/0],{dist:1/0}),r=0;return pf(e,function(l){for(var f=rf(l),a=0;a<f.length-1;a++){var _=ps(f[a]);_.properties.dist=Ep(t,_,n);var x=ps(f[a+1]);x.properties.dist=Ep(t,x,n);var S=Ep(_,x,n),L=Math.max(_.properties.dist,x.properties.dist),A=mw(_,x),P=rb(t,L,A+90,n),O=rb(t,L,A-90,n),B=HL(ia([P.geometry.coordinates,O.geometry.coordinates]),ia([_.geometry.coordinates,x.geometry.coordinates])),U=null;B.features.length>0&&(U=B.features[0],U.properties.dist=Ep(t,U,n),U.properties.location=r+Ep(_,U,n)),_.properties.dist<i.properties.dist&&(i=_,i.properties.index=a,i.properties.location=r),x.properties.dist<i.properties.dist&&(i=x,i.properties.index=a+1,i.properties.location=r+S),U&&U.properties.dist<i.properties.dist&&(i=U,i.properties.index=a),r+=S}}),i}const Ew=li({type:"FeatureCollection",features:[]}),Iw=li(0),KL=100;class JL{constructor(t){Zn(this,"map");Zn(this,"active");Zn(this,"eventListenersSuccess");Zn(this,"eventListenersUpdated");Zn(this,"eventListenersFailure");Zn(this,"points");Zn(this,"cursor");Zn(this,"hover");Zn(this,"dragFrom");Zn(this,"previousStates");Zn(this,"onMouseMove",t=>{if(this.active&&!this.dragFrom)this.recalculateHovering(t);else if(this.active&&this.dragFrom){if(this.hover=="polygon"){let n=this.dragFrom[0]-t.lngLat.lng,i=this.dragFrom[1]-t.lngLat.lat;for(let r of this.points)r[0]-=n,r[1]-=i}else this.points[this.hover]=t.lngLat.toArray();this.dragFrom=t.lngLat.toArray(),this.redraw()}});Zn(this,"onClick",t=>{if(this.beforeUpdate(),this.active&&this.cursor){let n=[];if(lb(this.points).forEach((i,r)=>{n.push([r+1,YL(i,this.cursor).properties.dist])}),n.sort((i,r)=>i[1]-r[1]),n.length>0){let i=n[0][0];this.points.splice(i,0,this.cursor.geometry.coordinates),this.hover=i}else this.points.push(this.cursor.geometry.coordinates),this.hover=this.points.length-1;this.redraw(),this.pointsUpdated()}else this.active&&typeof this.hover=="number"&&(this.points.splice(this.hover,1),this.hover=null,this.redraw(),this.pointsUpdated(),this.recalculateHovering(t))});Zn(this,"onDoubleClick",t=>{this.active&&(t.preventDefault(),this.cursor=J_(t.lngLat.toArray()),this.onClick(t),this.finish())});Zn(this,"onMouseDown",t=>{this.active&&!this.dragFrom&&this.hover!=null&&(t.preventDefault(),this.cursor=null,this.dragFrom=t.lngLat.toArray(),this.beforeUpdate(),this.redraw())});Zn(this,"onMouseUp",()=>{this.active&&this.dragFrom&&(this.dragFrom=null,this.redraw(),this.pointsUpdated())});Zn(this,"onKeypress",t=>{this.active&&(t.key=="Enter"?(t.stopPropagation(),this.finish()):t.key=="z"&&t.ctrlKey&&this.undo())});Zn(this,"onKeyDown",t=>{this.active&&t.key=="Escape"&&(t.stopPropagation(),this.cancel())});this.map=t,this.active=!1,this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[],this.points=[],this.cursor=null,this.hover=null,this.dragFrom=null,this.previousStates=[],this.map.on("mousemove",this.onMouseMove),this.map.on("click",this.onClick),this.map.on("dblclick",this.onDoubleClick),this.map.on("mousedown",this.onMouseDown),this.map.on("mouseup",this.onMouseUp),document.addEventListener("keypress",this.onKeypress),document.addEventListener("keydown",this.onKeyDown)}tearDown(){this.map.off("mousemove",this.onMouseMove),this.map.off("click",this.onClick),this.map.off("dblclick",this.onDoubleClick),this.map.off("mousedown",this.onMouseDown),this.map.off("mouseup",this.onMouseUp),document.removeEventListener("keypress",this.onKeypress),document.removeEventListener("keydown",this.onKeyDown)}finish(){let t=this.polygonFeature();if(t)for(let n of this.eventListenersSuccess)n(t);else for(let n of this.eventListenersFailure)n();this.stop()}cancel(){for(let t of this.eventListenersFailure)t();this.stop()}addEventListenerSuccess(t){this.eventListenersSuccess.push(t)}addEventListenerUpdated(t){this.eventListenersUpdated.push(t)}addEventListenerFailure(t){this.eventListenersFailure.push(t)}clearEventListeners(){this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[]}startNew(){this.active=!0,this.map.doubleClickZoom.disable()}editExisting(t){this.active=!0,this.map.doubleClickZoom.disable(),this.points=JSON.parse(JSON.stringify(t.geometry.coordinates[0])),this.points.pop(),this.redraw()}stop(){this.map.doubleClickZoom.enable(),this.points=[],this.cursor=null,this.active=!1,this.hover=null,this.dragFrom=null,this.previousStates=[],this.redraw(),this.map.getCanvas().style.cursor="inherit"}undo(){this.dragFrom!=null||this.previousStates.length==0||(this.points=this.previousStates.pop(),this.hover=null,this.redraw())}redraw(){let t={type:"FeatureCollection",features:[]};this.points.forEach((r,l)=>{let f=J_(r);f.properties.hover=this.hover==l,f.properties.idx=l,t.features.push(f)}),t.features=t.features.concat(lb(this.points));let n=this.polygonFeature();n&&(n.properties.hover=this.hover=="polygon",t.features.push(n)),Ew.set(t);let i="crosshair";this.hover!=null&&(i=this.dragFrom?"grabbing":"pointer"),this.map.getCanvas().style.cursor=i,Iw.set(this.previousStates.length)}pointsUpdated(){let t=this.polygonFeature();if(t)for(let n of this.eventListenersUpdated)n(t)}recalculateHovering(t){this.cursor=null,this.hover=null;for(let n of this.map.queryRenderedFeatures(t.point,{layers:["edit-polygon-fill","edit-polygon-vertices"]}))if(n.geometry.type=="Polygon"){this.hover="polygon";break}else if(n.geometry.type=="Point"&&Object.hasOwn(n.properties,"idx")){this.hover=n.properties.idx;break}this.hover==null&&(this.cursor=J_(t.lngLat.toArray())),this.redraw()}polygonFeature(){if(this.points.length<3)return null;let t=this.points.map(Mw),n=[JSON.parse(JSON.stringify(t))];return n[0].push(JSON.parse(JSON.stringify(n[0][0]))),{type:"Feature",geometry:{type:"Polygon",coordinates:n},properties:{}}}beforeUpdate(){this.previousStates.push(JSON.parse(JSON.stringify(this.points))),this.previousStates.length>KL&&this.previousStates.shift()}}function lb(e){let t=[];for(let n=0;n<e.length-1;n++)t.push({type:"Feature",geometry:{type:"LineString",coordinates:[e[n],e[n+1]]},properties:{}});return e.length>=3&&t.push({type:"Feature",geometry:{type:"LineString",coordinates:[e[e.length-1],e[0]]},properties:{}}),t}function QL(e){let t,n,i;return{c(){t=ge("Undo ("),n=ge(e[1]),i=ge(")")},m(r,l){Ct(r,t,l),Ct(r,n,l),Ct(r,i,l)},p(r,l){l&2&&zi(n,r[1])},d(r){r&&(It(t),It(n),It(i))}}}function tM(e){let t;return{c(){t=ge("Undo")},m(n,i){Ct(n,t,i)},p:Ie,d(n){n&&It(t)}}}function eM(e){let t,n,i,r,l,f;function a(S,L){return S[1]==0?tM:QL}let _=a(e),x=_(e);return{c(){t=wt("button"),x.c(),i=Xt(),r=wt("ul"),r.innerHTML=`<li><b>Click</b>
    the map to add a vertex</li> <li><b>Click</b>
    a vertex to delete it</li> <li><b>Drag</b>
    a vertex or the polygon to move it</li> <li>Press <b>Control+Z</b>
    to undo your last change</li> <li>Press <b>Enter</b>
    or
    <b>double click</b>
    to finish</li> <li>Press <b>Escape</b>
    to cancel</li>`,t.disabled=n=e[1]==0},m(S,L){Ct(S,t,L),x.m(t,null),Ct(S,i,L),Ct(S,r,L),l||(f=Ze(t,"click",e[2]),l=!0)},p(S,[L]){_===(_=a(S))&&x?x.p(S,L):(x.d(1),x=_(S),x&&(x.c(),x.m(t,null))),L&2&&n!==(n=S[1]==0)&&(t.disabled=n)},i:Ie,o:Ie,d(S){S&&(It(t),It(i),It(r)),x.d(),l=!1,f()}}}function nM(e,t,n){let i;Se(e,Iw,f=>n(1,i=f));let{polygonTool:r}=t;const l=()=>r.undo();return e.$$set=f=>{"polygonTool"in f&&n(0,r=f.polygonTool)},[r,i,l]}class iM extends nn{constructor(t){super(),en(this,t,nM,eM,He,{polygonTool:0})}}function rM(e){let t,n,i,r,l,f,a;return{c(){t=wt("button"),t.textContent="Import current view",n=Xt(),i=wt("i"),i.textContent="or...",r=Xt(),l=wt("button"),l.textContent="Draw an area to import on the map",Rt(t,"type","button"),Rt(l,"type","button")},m(_,x){Ct(_,t,x),Ct(_,n,x),Ct(_,i,x),Ct(_,r,x),Ct(_,l,x),f||(a=[Ze(t,"click",e[1]),Ze(l,"click",e[2])],f=!0)},p:Ie,i:Ie,o:Ie,d(_){_&&(It(t),It(n),It(i),It(r),It(l)),f=!1,No(a)}}}function oM(e){let t,n;return t=new iM({props:{polygonTool:e[0]}}),{c(){Zt(t.$$.fragment)},m(i,r){jt(t,i,r),n=!0},p(i,r){const l={};r&1&&(l.polygonTool=i[0]),t.$set(l)},i(i){n||(mt(t.$$.fragment,i),n=!0)},o(i){xt(t.$$.fragment,i),n=!1},d(i){qt(t,i)}}}function sM(e){let t,n,i,r;const l=[oM,rM],f=[];function a(_,x){return _[0]?0:1}return t=a(e),n=f[t]=l[t](e),{c(){n.c(),i=ts()},m(_,x){f[t].m(_,x),Ct(_,i,x),r=!0},p(_,[x]){let S=t;t=a(_),t===S?f[t].p(_,x):(ci(),xt(f[S],1,1,()=>{f[S]=null}),hi(),n=f[t],n?n.p(_,x):(n=f[t]=l[t](_),n.c()),mt(n,1),n.m(i.parentNode,i))},i(_){r||(mt(n),r=!0)},o(_){xt(n),r=!1},d(_){_&&It(i),f[t].d(_)}}}function Ip(e){return[e.lng,e.lat]}function aM(e,t,n){let{map:i}=t;const r=Dc();let l=null;async function f(S){try{r("loading","Loading from Overpass");let A=await(await fetch(Pw(S))).text();r("gotXml",A)}catch(L){r("error",L.toString())}}function a(){let S=i.getBounds();return{type:"Feature",properties:{},geometry:{coordinates:[[Ip(S.getSouthWest()),Ip(S.getNorthWest()),Ip(S.getNorthEast()),Ip(S.getSouthEast()),Ip(S.getSouthWest())]],type:"Polygon"}}}async function _(){if(i){if(i.getZoom()<13){r("error","Zoom in more to import");return}await f(a())}}function x(){i&&(n(0,l=new JL(i)),l.startNew(),l.addEventListenerSuccess(async S=>{n(0,l=null),await f(S)}),l.addEventListenerFailure(()=>{n(0,l=null)}))}return e.$$set=S=>{"map"in S&&n(3,i=S.map)},[l,_,x,i]}class lM extends nn{constructor(t){super(),en(this,t,aM,sM,He,{map:3})}}const uM=e=>({props:e&8}),ub=e=>({props:fM(e[3])});function cM(e){let t;const n=e[1].default,i=sr(n,e,e[2],ub);return{c(){i&&i.c()},m(r,l){i&&i.m(r,l),t=!0},p(r,l){i&&i.p&&(!t||l&12)&&lr(i,n,r,r[2],t?ar(n,r[2],l,uM):ur(r[2]),ub)},i(r){t||(mt(i,r),t=!0)},o(r){xt(i,r),t=!1},d(r){i&&i.d(r)}}}function hM(e){let t,n;return t=new QE({props:{openOn:e[0],$$slots:{default:[cM,({features:i})=>({3:i}),({features:i})=>i?8:0]},$$scope:{ctx:e}}}),{c(){Zt(t.$$.fragment)},m(i,r){jt(t,i,r),n=!0},p(i,[r]){const l={};r&1&&(l.openOn=i[0]),r&12&&(l.$$scope={dirty:r,ctx:i}),t.$set(l)},i(i){n||(mt(t.$$.fragment,i),n=!0)},o(i){xt(t.$$.fragment,i),n=!1},d(i){qt(t,i)}}}function fM(e){return e?e[0].properties??{}:(console.log("A Popup with null features should be impossible"),{})}function pM(e,t,n){let{$$slots:i={},$$scope:r}=t,{openOn:l="hover"}=t;return e.$$set=f=>{"openOn"in f&&n(0,l=f.openOn),"$$scope"in f&&n(2,r=f.$$scope)},[l,i,r]}class wl extends nn{constructor(t){super(),en(this,t,pM,hM,He,{openOn:0})}}function cb(e,t,n){const i=e.slice();return i[1]=t[n][0],i[2]=t[n][1],i}function hb(e){let t,n,i=e[1]+"",r,l,f,a=e[2]+"",_,x;return{c(){t=wt("tr"),n=wt("td"),r=ge(i),l=Xt(),f=wt("td"),_=ge(a),x=Xt()},m(S,L){Ct(S,t,L),dt(t,n),dt(n,r),dt(t,l),dt(t,f),dt(f,_),dt(t,x)},p(S,L){L&1&&i!==(i=S[1]+"")&&zi(r,i),L&1&&a!==(a=S[2]+"")&&zi(_,a)},d(S){S&&It(t)}}}function dM(e){let t,n,i=la(Object.entries(e[0])),r=[];for(let l=0;l<i.length;l+=1)r[l]=hb(cb(e,i,l));return{c(){t=wt("table"),n=wt("tbody");for(let l=0;l<r.length;l+=1)r[l].c();Rt(t,"class","svelte-lh2o9l")},m(l,f){Ct(l,t,f),dt(t,n);for(let a=0;a<r.length;a+=1)r[a]&&r[a].m(n,null)},p(l,[f]){if(f&1){i=la(Object.entries(l[0]));let a;for(a=0;a<i.length;a+=1){const _=cb(l,i,a);r[a]?r[a].p(_,f):(r[a]=hb(_),r[a].c(),r[a].m(n,null))}for(;a<r.length;a+=1)r[a].d(1);r.length=i.length}},i:Ie,o:Ie,d(l){l&&It(t),ud(r,l)}}}function mM(e,t,n){let{properties:i}=t;return e.$$set=r=>{"properties"in r&&n(0,i=r.properties)},[i]}class df extends nn{constructor(t){super(),en(this,t,mM,dM,He,{properties:0})}}function Vr(e){return{id:e,beforeId:gM(e)}}function gM(e){let t=Vb(Du);if(!t){console.warn(`getBeforeId(${e}) called before map is ready. Z-ordering may be incorrect.`);return}let n,i=!1;for(let r=fb.length-1;r>=0;r--){let l=fb[r];if(l==e){i=!0;break}t.getLayer(l)&&(n=l)}if(!i)throw new Error(`Layer ID ${e} not defined in layerZorder`);return n}const fb=["Background","neighbourhood-boundaries","Residential","debug-borders","debug-crosses","debug-filters","cells","interior-roads","compare-route","shortcuts","shortcuts-focus","Building","route-points","route-lines","route-polygons","Road labels","modal-filters","boundary","freehand-line","edit-polygon-fill","edit-polygon-lines","edit-polygon-vertices"],Cw=["==",["geometry-type"],"Polygon"],Tw=["==",["geometry-type"],"LineString"],Lw=["==",["geometry-type"],"Point"];function Rp(e,t,n){let i=["match",e];for(let[r,l]of Object.entries(t))i.push(r),i.push(l);return i.push(n),i}function _M(e,t){let n=document.createElement("a");n.setAttribute("href","data:text/plain;charset=utf-8, "+encodeURIComponent(t)),n.setAttribute("download",e),document.body.appendChild(n),n.click(),document.body.removeChild(n)}function ui(e){if(e==null||e==null)throw new Error("Oops, notNull given something null");return e}function J_(e){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:Mw(e)}}}function Mw(e){return[Math.round(e[0]*1e7)/1e7,Math.round(e[1]*1e7)/1e7]}function Pw(e){let t='poly:"';for(let[i,r]of e.geometry.coordinates[0])t+=`${r} ${i} `;return t=t.slice(0,-1)+'"',`https://overpass-api.de/api/interpreter?data=${`(nwr(${t}); node(w)->.x; <;); out meta;`}`}function yM(e){let t;return{c(){t=ge("Back")},m(n,i){Ct(n,t,i)},d(n){n&&It(t)}}}function vM(e){let t,n,i,r;return t=new xi({props:{$$slots:{default:[yM]},$$scope:{ctx:e}}}),t.$on("click",e[2]),{c(){Zt(t.$$.fragment)},m(l,f){jt(t,l,f),n=!0,i||(r=Ze(window,"keydown",e[1]),i=!0)},p(l,[f]){const a={};f&8&&(a.$$scope={dirty:f,ctx:l}),t.$set(a)},i(l){n||(mt(t.$$.fragment,l),n=!0)},o(l){xt(t.$$.fragment,l),n=!1},d(l){qt(t,l),i=!1,r()}}}function bM(e){let t=Dc();function n(r){r.key=="Escape"&&(r.stopPropagation(),t("click"))}return[t,n,()=>t("click")]}class Ng extends nn{constructor(t){super(),en(this,t,bM,vM,He,{})}}function Ty(e){let t=["#8dd3c7","#ffffb3","#bebada","#80b1d3","#fdb462","#b3de69","#fccde5","#bc80bd","#ccebc5","#ffed6f"];for(let n of e.features)n.properties??(n.properties={}),n.properties.cell_color=="disconnected"?n.properties.color="red":Object.hasOwn(n.properties,"cell_color")&&(n.properties.color=t[n.properties.cell_color%t.length]);return e}const xM=e=>({}),pb=e=>({}),wM=e=>({}),db=e=>({});function mb(e){let t;const n=e[5]["line-popup"],i=sr(n,e,e[7],db);return{c(){i&&i.c()},m(r,l){i&&i.m(r,l),t=!0},p(r,l){i&&i.p&&(!t||l&128)&&lr(i,n,r,r[7],t?ar(n,r[7],l,wM):ur(r[7]),db)},i(r){t||(mt(i,r),t=!0)},o(r){xt(i,r),t=!1},d(r){i&&i.d(r)}}}function SM(e){let t,n,i=e[0]&&mb(e);return{c(){i&&i.c(),t=ts()},m(r,l){i&&i.m(r,l),Ct(r,t,l),n=!0},p(r,l){r[0]?i?(i.p(r,l),l&1&&mt(i,1)):(i=mb(r),i.c(),mt(i,1),i.m(t.parentNode,t)):i&&(ci(),xt(i,1,1,()=>{i=null}),hi())},i(r){n||(mt(i),n=!0)},o(r){xt(i),n=!1},d(r){r&&It(t),i&&i.d(r)}}}function EM(e){let t,n,i,r,l;const f=[Vr("cells"),{filter:["==",["get","kind"],"cell"]},{paint:{"fill-color":["get","color"],"fill-opacity":.3}}];let a={};for(let A=0;A<f.length;A+=1)a=Tr(a,f[A]);t=new af({props:a});const _=[Vr("interior-roads"),{filter:["==",["get","kind"],"interior_road"]},{paint:{"line-width":5,"line-color":["interpolate-hcl",["linear"],["get","shortcuts"],0,"white",1,"#F19A93",e[2],"#A32015"]}},{hoverCursor:e[0]?"pointer":void 0}];let x={$$slots:{default:[SM]},$$scope:{ctx:e}};for(let A=0;A<_.length;A+=1)x=Tr(x,_[A]);i=new ru({props:x}),i.$on("click",e[6]);const S=e[5]["more-layers"],L=sr(S,e,e[7],pb);return{c(){Zt(t.$$.fragment),n=Xt(),Zt(i.$$.fragment),r=Xt(),L&&L.c()},m(A,P){jt(t,A,P),Ct(A,n,P),jt(i,A,P),Ct(A,r,P),L&&L.m(A,P),l=!0},p(A,P){const O={};t.$set(O);const B=P&5?Wb(_,[_[0],_[1],P&4&&{paint:{"line-width":5,"line-color":["interpolate-hcl",["linear"],["get","shortcuts"],0,"white",1,"#F19A93",A[2],"#A32015"]}},P&1&&{hoverCursor:A[0]?"pointer":void 0}]):{};P&129&&(B.$$scope={dirty:P,ctx:A}),i.$set(B),L&&L.p&&(!l||P&128)&&lr(L,S,A,A[7],l?ar(S,A[7],P,xM):ur(A[7]),pb)},i(A){l||(mt(t.$$.fragment,A),mt(i.$$.fragment,A),mt(L,A),l=!0)},o(A){xt(t.$$.fragment,A),xt(i.$$.fragment,A),xt(L,A),l=!1},d(A){A&&(It(n),It(r)),qt(t,A),qt(i,A),L&&L.d(A)}}}function IM(e){let t,n;return t=new Ps({props:{data:e[3],generateId:!0,$$slots:{default:[EM]},$$scope:{ctx:e}}}),{c(){Zt(t.$$.fragment)},m(i,r){jt(t,i,r),n=!0},p(i,[r]){const l={};r&8&&(l.data=i[3]),r&135&&(l.$$scope={dirty:r,ctx:i}),t.$set(l)},i(i){n||(mt(t.$$.fragment,i),n=!0)},o(i){xt(t.$$.fragment,i),n=!1},d(i){qt(t,i)}}}function CM(e,t,n){let i,r,{$$slots:l={},$$scope:f}=t,{gjInput:a}=t,{interactive:_=!0}=t,{onClickLine:x=L=>{}}=t;const S=L=>_&&x(L.detail.features[0]);return e.$$set=L=>{"gjInput"in L&&n(4,a=L.gjInput),"interactive"in L&&n(0,_=L.interactive),"onClickLine"in L&&n(1,x=L.onClickLine),"$$scope"in L&&n(7,f=L.$$scope)},e.$$.update=()=>{e.$$.dirty&16&&n(3,i=Ty(a)),e.$$.dirty&16&&n(2,r=Math.max(...a.features.map(L=>L.properties.shortcuts??0)))},[_,x,r,i,a,l,S,f]}class Dg extends nn{constructor(t){super(),en(this,t,CM,IM,He,{gjInput:4,interactive:0,onClickLine:1})}}const TM=e=>({}),gb=e=>({}),LM=e=>({}),_b=e=>({}),MM=e=>({}),yb=e=>({});function PM(e){let t,n,i,r,l,f;const a=e[4].top,_=sr(a,e,e[3],yb),x=e[4].sidebar,S=sr(x,e,e[3],_b),L=e[4].map,A=sr(L,e,e[3],gb);return{c(){t=wt("div"),_&&_.c(),n=Xt(),i=wt("div"),S&&S.c(),r=Xt(),l=wt("div"),A&&A.c()},m(P,O){Ct(P,t,O),_&&_.m(t,null),e[5](t),Ct(P,n,O),Ct(P,i,O),S&&S.m(i,null),e[6](i),Ct(P,r,O),Ct(P,l,O),A&&A.m(l,null),e[7](l),f=!0},p(P,[O]){_&&_.p&&(!f||O&8)&&lr(_,a,P,P[3],f?ar(a,P[3],O,MM):ur(P[3]),yb),S&&S.p&&(!f||O&8)&&lr(S,x,P,P[3],f?ar(x,P[3],O,LM):ur(P[3]),_b),A&&A.p&&(!f||O&8)&&lr(A,L,P,P[3],f?ar(L,P[3],O,TM):ur(P[3]),gb)},i(P){f||(mt(_,P),mt(S,P),mt(A,P),f=!0)},o(P){xt(_,P),xt(S,P),xt(A,P),f=!1},d(P){P&&(It(t),It(n),It(i),It(r),It(l)),_&&_.d(P),e[5](null),S&&S.d(P),e[6](null),A&&A.d(P),e[7](null)}}}function kM(e,t,n){let i,r,l;Se(e,oy,L=>n(0,i=L)),Se(e,sy,L=>n(1,r=L)),Se(e,ay,L=>n(2,l=L));let{$$slots:f={},$$scope:a}=t;function _(L){cr[L?"unshift":"push"](()=>{i=L,oy.set(i)})}function x(L){cr[L?"unshift":"push"](()=>{r=L,sy.set(r)})}function S(L){cr[L?"unshift":"push"](()=>{l=L,ay.set(l)})}return e.$$set=L=>{"$$scope"in L&&n(3,a=L.$$scope)},[i,r,l,a,f,_,x,S]}class Wu extends nn{constructor(t){super(),en(this,t,kM,PM,He,{})}}function AM(e){let t;return{c(){t=ge("Choose study area")},m(n,i){Ct(n,t,i)},d(n){n&&It(t)}}}function NM(e){let t;return{c(){t=ge("Pick neighbourhood")},m(n,i){Ct(n,t,i)},d(n){n&&It(t)}}}function DM(e){let t;return{c(){t=ge("Editing modal filters")},m(n,i){Ct(n,t,i)},d(n){n&&It(t)}}}function RM(e){let t,n,i,r,l,f,a,_,x,S,L,A,P,O;return l=new xi({props:{$$slots:{default:[AM]},$$scope:{ctx:e}}}),l.$on("click",e[4]),_=new xi({props:{$$slots:{default:[NM]},$$scope:{ctx:e}}}),_.$on("click",e[5]),L=new xi({props:{$$slots:{default:[DM]},$$scope:{ctx:e}}}),L.$on("click",e[6]),{c(){t=wt("div"),n=wt("nav"),i=wt("ul"),r=wt("li"),Zt(l.$$.fragment),f=Xt(),a=wt("li"),Zt(_.$$.fragment),x=Xt(),S=wt("li"),Zt(L.$$.fragment),A=Xt(),P=wt("li"),P.textContent="Debug mode",Rt(n,"aria-label","breadcrumb"),Rt(t,"slot","top")},m(B,U){Ct(B,t,U),dt(t,n),dt(n,i),dt(i,r),jt(l,r,null),dt(i,f),dt(i,a),jt(_,a,null),dt(i,x),dt(i,S),jt(L,S,null),dt(i,A),dt(i,P),O=!0},p(B,U){const Y={};U&256&&(Y.$$scope={dirty:U,ctx:B}),l.$set(Y);const V={};U&256&&(V.$$scope={dirty:U,ctx:B}),_.$set(V);const $={};U&256&&($.$$scope={dirty:U,ctx:B}),L.$set($)},i(B){O||(mt(l.$$.fragment,B),mt(_.$$.fragment,B),mt(L.$$.fragment,B),O=!0)},o(B){xt(l.$$.fragment,B),xt(_.$$.fragment,B),xt(L.$$.fragment,B),O=!1},d(B){B&&It(t),qt(l),qt(_),qt(L)}}}function OM(e){let t,n,i;return n=new Ng({}),n.$on("click",e[3]),{c(){t=wt("div"),Zt(n.$$.fragment),Rt(t,"slot","sidebar")},m(r,l){Ct(r,t,l),jt(n,t,null),i=!0},p:Ie,i(r){i||(mt(n.$$.fragment,r),i=!0)},o(r){xt(n.$$.fragment,r),i=!1},d(r){r&&It(t),qt(n)}}}function zM(e){let t,n;return t=new df({props:{properties:e[7]}}),{c(){Zt(t.$$.fragment)},m(i,r){jt(t,i,r),n=!0},p(i,r){const l={};r&128&&(l.properties=i[7]),t.$set(l)},i(i){n||(mt(t.$$.fragment,i),n=!0)},o(i){xt(t.$$.fragment,i),n=!1},d(i){qt(t,i)}}}function FM(e){let t,n,i;return n=new wl({props:{openOn:"hover",$$slots:{default:[zM,({props:r})=>({7:r}),({props:r})=>r?128:0]},$$scope:{ctx:e}}}),{c(){t=wt("div"),Zt(n.$$.fragment),Rt(t,"slot","line-popup")},m(r,l){Ct(r,t,l),jt(n,t,null),i=!0},p(r,l){const f={};l&384&&(f.$$scope={dirty:l,ctx:r}),n.$set(f)},i(r){i||(mt(n.$$.fragment,r),i=!0)},o(r){xt(n.$$.fragment,r),i=!1},d(r){r&&It(t),qt(n)}}}function BM(e){let t,n;return t=new df({props:{properties:e[7]}}),{c(){Zt(t.$$.fragment)},m(i,r){jt(t,i,r),n=!0},p(i,r){const l={};r&128&&(l.properties=i[7]),t.$set(l)},i(i){n||(mt(t.$$.fragment,i),n=!0)},o(i){xt(t.$$.fragment,i),n=!1},d(i){qt(t,i)}}}function VM(e){let t,n;return t=new wl({props:{openOn:"hover",$$slots:{default:[BM,({props:i})=>({7:i}),({props:i})=>i?128:0]},$$scope:{ctx:e}}}),{c(){Zt(t.$$.fragment)},m(i,r){jt(t,i,r),n=!0},p(i,r){const l={};r&384&&(l.$$scope={dirty:r,ctx:i}),t.$set(l)},i(i){n||(mt(t.$$.fragment,i),n=!0)},o(i){xt(t.$$.fragment,i),n=!1},d(i){qt(t,i)}}}function UM(e){let t,n;return t=new df({props:{properties:e[7]}}),{c(){Zt(t.$$.fragment)},m(i,r){jt(t,i,r),n=!0},p(i,r){const l={};r&128&&(l.properties=i[7]),t.$set(l)},i(i){n||(mt(t.$$.fragment,i),n=!0)},o(i){xt(t.$$.fragment,i),n=!1},d(i){qt(t,i)}}}function GM(e){let t,n;return t=new wl({props:{openOn:"hover",$$slots:{default:[UM,({props:i})=>({7:i}),({props:i})=>i?128:0]},$$scope:{ctx:e}}}),{c(){Zt(t.$$.fragment)},m(i,r){jt(t,i,r),n=!0},p(i,r){const l={};r&384&&(l.$$scope={dirty:r,ctx:i}),t.$set(l)},i(i){n||(mt(t.$$.fragment,i),n=!0)},o(i){xt(t.$$.fragment,i),n=!1},d(i){qt(t,i)}}}function jM(e){let t,n,i,r;const l=[Vr("debug-borders"),{filter:["==",["get","kind"],"border_intersection"]},{paint:{"circle-radius":15,"circle-color":"green"}}];let f={$$slots:{default:[VM]},$$scope:{ctx:e}};for(let x=0;x<l.length;x+=1)f=Tr(f,l[x]);t=new hd({props:f});const a=[Vr("debug-crosses"),{filter:["==",["get","kind"],"crosses"]},{paint:{"line-width":5,"line-color":"blue"}}];let _={$$slots:{default:[GM]},$$scope:{ctx:e}};for(let x=0;x<a.length;x+=1)_=Tr(_,a[x]);return i=new ru({props:_}),{c(){Zt(t.$$.fragment),n=Xt(),Zt(i.$$.fragment)},m(x,S){jt(t,x,S),Ct(x,n,S),jt(i,x,S),r=!0},p(x,S){const L={};S&256&&(L.$$scope={dirty:S,ctx:x}),t.$set(L);const A={};S&256&&(A.$$scope={dirty:S,ctx:x}),i.$set(A)},i(x){r||(mt(t.$$.fragment,x),mt(i.$$.fragment,x),r=!0)},o(x){xt(t.$$.fragment,x),xt(i.$$.fragment,x),r=!1},d(x){x&&It(n),qt(t,x),qt(i,x)}}}function qM(e){let t,n;return t=new df({props:{properties:e[7]}}),{c(){Zt(t.$$.fragment)},m(i,r){jt(t,i,r),n=!0},p(i,r){const l={};r&128&&(l.properties=i[7]),t.$set(l)},i(i){n||(mt(t.$$.fragment,i),n=!0)},o(i){xt(t.$$.fragment,i),n=!1},d(i){qt(t,i)}}}function ZM(e){let t,n;return t=new wl({props:{openOn:"hover",$$slots:{default:[qM,({props:i})=>({7:i}),({props:i})=>i?128:0]},$$scope:{ctx:e}}}),{c(){Zt(t.$$.fragment)},m(i,r){jt(t,i,r),n=!0},p(i,r){const l={};r&384&&(l.$$scope={dirty:r,ctx:i}),t.$set(l)},i(i){n||(mt(t.$$.fragment,i),n=!0)},o(i){xt(t.$$.fragment,i),n=!1},d(i){qt(t,i)}}}function $M(e){let t,n;const i=[Vr("debug-filters"),{paint:{"circle-radius":15,"circle-color":"black"}}];let r={$$slots:{default:[ZM]},$$scope:{ctx:e}};for(let l=0;l<i.length;l+=1)r=Tr(r,i[l]);return t=new hd({props:r}),{c(){Zt(t.$$.fragment)},m(l,f){jt(t,l,f),n=!0},p(l,f){const a={};f&256&&(a.$$scope={dirty:f,ctx:l}),t.$set(a)},i(l){n||(mt(t.$$.fragment,l),n=!0)},o(l){xt(t.$$.fragment,l),n=!1},d(l){qt(t,l)}}}function WM(e){let t,n,i,r,l;return n=new Dg({props:{gjInput:JSON.parse(ui(e[0]).renderNeighbourhood()),interactive:!0,onClickLine:e[2],$$slots:{"more-layers":[jM],"line-popup":[FM]},$$scope:{ctx:e}}}),r=new Ps({props:{data:JSON.parse(ui(e[0]).renderModalFilters()),generateId:!0,$$slots:{default:[$M]},$$scope:{ctx:e}}}),{c(){t=wt("div"),Zt(n.$$.fragment),i=Xt(),Zt(r.$$.fragment),Rt(t,"slot","map")},m(f,a){Ct(f,t,a),jt(n,t,null),dt(t,i),jt(r,t,null),l=!0},p(f,a){const _={};a&1&&(_.gjInput=JSON.parse(ui(f[0]).renderNeighbourhood())),a&256&&(_.$$scope={dirty:a,ctx:f}),n.$set(_);const x={};a&1&&(x.data=JSON.parse(ui(f[0]).renderModalFilters())),a&256&&(x.$$scope={dirty:a,ctx:f}),r.$set(x)},i(f){l||(mt(n.$$.fragment,f),mt(r.$$.fragment,f),l=!0)},o(f){xt(n.$$.fragment,f),xt(r.$$.fragment,f),l=!1},d(f){f&&It(t),qt(n),qt(r)}}}function XM(e){let t,n;return t=new Wu({props:{$$slots:{map:[WM],sidebar:[OM],top:[RM]},$$scope:{ctx:e}}}),{c(){Zt(t.$$.fragment)},m(i,r){jt(t,i,r),n=!0},p(i,[r]){const l={};r&259&&(l.$$scope={dirty:r,ctx:i}),t.$set(l)},i(i){n||(mt(t.$$.fragment,i),n=!0)},o(i){xt(t.$$.fragment,i),n=!1},d(i){qt(t,i)}}}function HM(e,t,n){let i,r;return Se(e,Wo,S=>n(0,i=S)),Se(e,xn,S=>n(1,r=S)),[i,r,S=>window.open(ui(S.properties).way,"_blank"),()=>je(xn,r={mode:"neighbourhood"},r),()=>je(xn,r={mode:"title"},r),()=>je(xn,r={mode:"network"},r),()=>je(xn,r={mode:"neighbourhood"},r)]}class YM extends nn{constructor(t){super(),en(this,t,HM,XM,He,{})}}function KM(e){let t;return{c(){t=ge("Choose study area")},m(n,i){Ct(n,t,i)},d(n){n&&It(t)}}}function JM(e){let t,n,i,r,l,f,a,_;return l=new xi({props:{$$slots:{default:[KM]},$$scope:{ctx:e}}}),l.$on("click",e[3]),{c(){t=wt("div"),n=wt("nav"),i=wt("ul"),r=wt("li"),Zt(l.$$.fragment),f=Xt(),a=wt("li"),a.textContent="Debug route snapper",Rt(n,"aria-label","breadcrumb"),Rt(t,"slot","top")},m(x,S){Ct(x,t,S),dt(t,n),dt(n,i),dt(i,r),jt(l,r,null),dt(i,f),dt(i,a),_=!0},p(x,S){const L={};S&32&&(L.$$scope={dirty:S,ctx:x}),l.$set(L)},i(x){_||(mt(l.$$.fragment,x),_=!0)},o(x){xt(l.$$.fragment,x),_=!1},d(x){x&&It(t),qt(l)}}}function QM(e){let t,n,i;return n=new Ng({}),n.$on("click",e[2]),{c(){t=wt("div"),Zt(n.$$.fragment),Rt(t,"slot","sidebar")},m(r,l){Ct(r,t,l),jt(n,t,null),i=!0},p:Ie,i(r){i||(mt(n.$$.fragment,r),i=!0)},o(r){xt(n.$$.fragment,r),i=!1},d(r){r&&It(t),qt(n)}}}function tP(e){let t,n;return t=new df({props:{properties:e[4]}}),{c(){Zt(t.$$.fragment)},m(i,r){jt(t,i,r),n=!0},p(i,r){const l={};r&16&&(l.properties=i[4]),t.$set(l)},i(i){n||(mt(t.$$.fragment,i),n=!0)},o(i){xt(t.$$.fragment,i),n=!1},d(i){qt(t,i)}}}function eP(e){let t,n;return t=new wl({props:{openOn:"hover",$$slots:{default:[tP,({props:i})=>({4:i}),({props:i})=>i?16:0]},$$scope:{ctx:e}}}),{c(){Zt(t.$$.fragment)},m(i,r){jt(t,i,r),n=!0},p(i,r){const l={};r&48&&(l.$$scope={dirty:r,ctx:i}),t.$set(l)},i(i){n||(mt(t.$$.fragment,i),n=!0)},o(i){xt(t.$$.fragment,i),n=!1},d(i){qt(t,i)}}}function nP(e){let t,n;return t=new df({props:{properties:e[4]}}),{c(){Zt(t.$$.fragment)},m(i,r){jt(t,i,r),n=!0},p(i,r){const l={};r&16&&(l.properties=i[4]),t.$set(l)},i(i){n||(mt(t.$$.fragment,i),n=!0)},o(i){xt(t.$$.fragment,i),n=!1},d(i){qt(t,i)}}}function iP(e){let t,n;return t=new wl({props:{openOn:"hover",$$slots:{default:[nP,({props:i})=>({4:i}),({props:i})=>i?16:0]},$$scope:{ctx:e}}}),{c(){Zt(t.$$.fragment)},m(i,r){jt(t,i,r),n=!0},p(i,r){const l={};r&48&&(l.$$scope={dirty:r,ctx:i}),t.$set(l)},i(i){n||(mt(t.$$.fragment,i),n=!0)},o(i){xt(t.$$.fragment,i),n=!1},d(i){qt(t,i)}}}function rP(e){let t,n,i,r;return t=new ru({props:{manageHoverState:!0,paint:{"line-width":8,"line-color":"black","line-opacity":ry(.5,1)},$$slots:{default:[eP]},$$scope:{ctx:e}}}),i=new hd({props:{manageHoverState:!0,paint:{"circle-radius":10,"circle-color":"black","circle-opacity":ry(.5,1)},$$slots:{default:[iP]},$$scope:{ctx:e}}}),{c(){Zt(t.$$.fragment),n=Xt(),Zt(i.$$.fragment)},m(l,f){jt(t,l,f),Ct(l,n,f),jt(i,l,f),r=!0},p(l,f){const a={};f&32&&(a.$$scope={dirty:f,ctx:l}),t.$set(a);const _={};f&32&&(_.$$scope={dirty:f,ctx:l}),i.$set(_)},i(l){r||(mt(t.$$.fragment,l),mt(i.$$.fragment,l),r=!0)},o(l){xt(t.$$.fragment,l),xt(i.$$.fragment,l),r=!1},d(l){l&&It(n),qt(t,l),qt(i,l)}}}function oP(e){let t,n,i;return n=new Ps({props:{data:JSON.parse(ui(e[0]).toRouteSnapperGj()),generateId:!0,$$slots:{default:[rP]},$$scope:{ctx:e}}}),{c(){t=wt("div"),Zt(n.$$.fragment),Rt(t,"slot","map")},m(r,l){Ct(r,t,l),jt(n,t,null),i=!0},p(r,l){const f={};l&1&&(f.data=JSON.parse(ui(r[0]).toRouteSnapperGj())),l&32&&(f.$$scope={dirty:l,ctx:r}),n.$set(f)},i(r){i||(mt(n.$$.fragment,r),i=!0)},o(r){xt(n.$$.fragment,r),i=!1},d(r){r&&It(t),qt(n)}}}function sP(e){let t,n;return t=new Wu({props:{$$slots:{map:[oP],sidebar:[QM],top:[JM]},$$scope:{ctx:e}}}),{c(){Zt(t.$$.fragment)},m(i,r){jt(t,i,r),n=!0},p(i,[r]){const l={};r&35&&(l.$$scope={dirty:r,ctx:i}),t.$set(l)},i(i){n||(mt(t.$$.fragment,i),n=!0)},o(i){xt(t.$$.fragment,i),n=!1},d(i){qt(t,i)}}}function aP(e,t,n){let i,r;return Se(e,Wo,a=>n(0,i=a)),Se(e,xn,a=>n(1,r=a)),[i,r,()=>je(xn,r={mode:"network"},r),()=>je(xn,r={mode:"title"},r)]}class lP extends nn{constructor(t){super(),en(this,t,aP,sP,He,{})}}function uP(e){let t,n,i,r,l,f,a,_,x,S,L,A,P,O,B,U,Y,V;return B=new hw({props:{msg:e[0]}}),{c(){t=wt("details"),n=wt("summary"),n.textContent="Save / load project",i=Xt(),r=wt("button"),r.textContent="Save to GJ",l=Xt(),f=wt("label"),a=ge(`Load edits from GJ
    `),_=wt("input"),x=Xt(),S=wt("div"),L=wt("button"),L.textContent="Save to local storage",A=Xt(),P=wt("button"),P.textContent="Load from local storage",O=Xt(),Zt(B.$$.fragment),Rt(_,"type","file"),gi(S,"display","flex"),gi(S,"justify-content","space-between")},m($,K){Ct($,t,K),dt(t,n),dt(t,i),dt(t,r),dt(t,l),dt(t,f),dt(f,a),dt(f,_),e[7](_),dt(t,x),dt(t,S),dt(S,L),dt(S,A),dt(S,P),Ct($,O,K),jt(B,$,K),U=!0,Y||(V=[Ze(r,"click",e[2]),Ze(_,"change",e[3]),Ze(L,"click",e[5]),Ze(P,"click",e[4])],Y=!0)},p($,[K]){const it={};K&1&&(it.msg=$[0]),B.$set(it)},i($){U||(mt(B.$$.fragment,$),U=!0)},o($){xt(B.$$.fragment,$),U=!1},d($){$&&(It(t),It(O)),e[7](null),qt(B,$),Y=!1,No(V)}}}function cP(e,t,n){let i,r,l,f;Se(e,Wo,B=>n(9,r=B)),Se(e,xn,B=>n(10,l=B)),Se(e,Pu,B=>n(6,f=B));let a=null;function _(){_M(i,r.toSavefile())}let x;async function S(B){n(0,a="Loading project from file");try{P(await x.files[0].text())}catch(U){window.alert(`Couldn't open this file: ${U}`)}n(0,a=null)}function L(){n(0,a="Loading projects from local storage");try{let B=window.localStorage.getItem(i);B?P(B):window.alert("Nothing was saved in local storage")}catch(B){window.alert(`Couldn't load from local storage: ${B}`)}n(0,a=null)}function A(){window.localStorage.setItem(i,r.toSavefile())}function P(B){r.loadSavefile(JSON.parse(B)),je(xn,l={mode:"network"},l),Wo.set(r)}function O(B){cr[B?"unshift":"push"](()=>{x=B,n(1,x)})}return e.$$.update=()=>{e.$$.dirty&64&&(i=`ltn_${f||"custom"}.geojson`)},[a,x,_,S,L,A,f,O]}class kw extends nn{constructor(t){super(),en(this,t,cP,uP,He,{})}}function vb(e,t,n){const i=e.slice();return i[7]=t[n][0],i[8]=t[n][1],i[9]=t[n][2],i}function bb(e){let t,n,i,r,l,f,a=e[8]+"",_,x,S,L,A;function P(){return e[3](e[7])}return{c(){t=wt("button"),n=wt("img"),r=Xt(),l=wt("br"),f=Xt(),_=ge(a),x=Xt(),hr(n.src,i=`/ltn//filters/${e[7]}_icon.gif`)||Rt(n,"src",i),Rt(n,"width","80"),Rt(n,"alt",e[8]),Rt(t,"class","outline"),gi(t,"width","100%"),t.disabled=S=e[0]==e[7]},m(O,B){Ct(O,t,B),dt(t,n),dt(t,r),dt(t,l),dt(t,f),dt(t,_),dt(t,x),L||(A=Ze(t,"click",P),L=!0)},p(O,B){e=O,B&1&&S!==(S=e[0]==e[7])&&(t.disabled=S)},d(O){O&&It(t),L=!1,A()}}}function hP(e){let t,n,i,r,l,f,a,_,x,S,L,A,P=e[1][2]+"",O,B,U,Y,V,$,K=la(e[2]),it=[];for(let pt=0;pt<K.length;pt+=1)it[pt]=bb(vb(e,K,pt));function ft(){return e[4](e[6])}return{c(){t=wt("h3"),t.textContent="Choose a modal filter to place on streets",n=Xt(),i=wt("table"),r=wt("tr"),l=wt("td");for(let pt=0;pt<it.length;pt+=1)it[pt].c();f=Xt(),a=wt("td"),_=wt("img"),L=Xt(),A=wt("p"),O=ge(P),B=Xt(),U=wt("center"),Y=wt("button"),Y.textContent="Confirm",hr(_.src,x=`/ltn//filters/${e[0]}.gif`)||Rt(_,"src",x),Rt(_,"height","300"),Rt(_,"alt",S=e[1][1])},m(pt,gt){Ct(pt,t,gt),Ct(pt,n,gt),Ct(pt,i,gt),dt(i,r),dt(r,l);for(let ut=0;ut<it.length;ut+=1)it[ut]&&it[ut].m(l,null);dt(r,f),dt(r,a),dt(a,_),dt(a,L),dt(a,A),dt(A,O),Ct(pt,B,gt),Ct(pt,U,gt),dt(U,Y),V||($=Ze(Y,"click",ft),V=!0)},p(pt,gt){if(e=pt,gt&5){K=la(e[2]);let ut;for(ut=0;ut<K.length;ut+=1){const St=vb(e,K,ut);it[ut]?it[ut].p(St,gt):(it[ut]=bb(St),it[ut].c(),it[ut].m(l,null))}for(;ut<it.length;ut+=1)it[ut].d(1);it.length=K.length}gt&1&&!hr(_.src,x=`/ltn//filters/${e[0]}.gif`)&&Rt(_,"src",x),gt&2&&S!==(S=e[1][1])&&Rt(_,"alt",S),gt&2&&P!==(P=e[1][2]+"")&&zi(O,P)},d(pt){pt&&(It(t),It(n),It(i),It(B),It(U)),ud(it,pt),V=!1,$()}}}function fP(e){let t,n;return t=new Ky({props:{$$slots:{default:[hP,({dialog:i})=>({6:i}),({dialog:i})=>i?64:0]},$$scope:{ctx:e}}}),t.$on("close",e[5]),{c(){Zt(t.$$.fragment)},m(i,r){jt(t,i,r),n=!0},p(i,[r]){const l={};r&4163&&(l.$$scope={dirty:r,ctx:i}),t.$set(l)},i(i){n||(mt(t.$$.fragment,i),n=!0)},o(i){xt(t.$$.fragment,i),n=!1},d(i){qt(t,i)}}}function pP(e,t,n){let i,r;Se(e,ly,x=>n(0,r=x));let l=[["walk_cycle_only","Walking/cycling only","A physical barrier that only allows people walking, cycling, and rolling to pass. Often planters or bollards. Larger vehicles cannot enter."],["no_entry","No entry","An alternative sign to indicate vehicles are not allowed to enter the street. Only people walking, cycling, and rolling may pass through."],["bus_gate","Bus gate","A bus gate sign and traffic cameras are installed to allow buses, pedestrians, and cyclists to pass. There is no physical barrier."],["school_street","School street","A closure during school hours only. The barrier usually allows teachers and staff to access the school."]];const f=x=>je(ly,r=x,r),a=x=>ui(x).close();function _(x){ii.call(this,e,x)}return e.$$.update=()=>{e.$$.dirty&1&&n(1,i=l.find(x=>x[0]==r))},[r,i,l,f,a,_]}class dP extends nn{constructor(t){super(),en(this,t,pP,fP,He,{})}}function xb(e){let t,n;return t=new Ps({props:{data:e[0],$$slots:{default:[mP]},$$scope:{ctx:e}}}),{c(){Zt(t.$$.fragment)},m(i,r){jt(t,i,r),n=!0},p(i,r){const l={};r&1&&(l.data=i[0]),r&64&&(l.$$scope={dirty:r,ctx:i}),t.$set(l)},i(i){n||(mt(t.$$.fragment,i),n=!0)},o(i){xt(t.$$.fragment,i),n=!1},d(i){qt(t,i)}}}function mP(e){let t,n;const i=[Vr("freehand-line"),{paint:{"line-width":5,"line-color":"red"}}];let r={};for(let l=0;l<i.length;l+=1)r=Tr(r,i[l]);return t=new ru({props:r}),{c(){Zt(t.$$.fragment)},m(l,f){jt(t,l,f),n=!0},p(l,f){const a={};t.$set(a)},i(l){n||(mt(t.$$.fragment,l),n=!0)},o(l){xt(t.$$.fragment,l),n=!1},d(l){qt(t,l)}}}function gP(e){let t,n,i=e[0]&&xb(e);return{c(){i&&i.c(),t=ts()},m(r,l){i&&i.m(r,l),Ct(r,t,l),n=!0},p(r,[l]){r[0]?i?(i.p(r,l),l&1&&mt(i,1)):(i=xb(r),i.c(),mt(i,1),i.m(t.parentNode,t)):i&&(ci(),xt(i,1,1,()=>{i=null}),hi())},i(r){n||(mt(i),n=!0)},o(r){xt(i),n=!1},d(r){r&&It(t),i&&i.d(r)}}}function _P(e,t,n){let{map:i}=t,r=null;const l=Dc();i.on("dragstart",f),i.on("mousemove",a),i.on("mouseup",_),aa(()=>{i.dragPan.enable(),i.off("dragstart",f),i.off("mousemove",a),i.off("mouseup",_)});function f(){i.dragPan.disable(),n(0,r={type:"Feature",properties:{},geometry:{type:"LineString",coordinates:[]}})}function a(x){r&&(r.geometry.coordinates.push(x.lngLat.toArray()),n(0,r))}function _(){r&&(l("done",r),n(0,r=null))}return e.$$set=x=>{"map"in x&&n(1,i=x.map)},[r,i]}class yP extends nn{constructor(t){super(),en(this,t,_P,gP,He,{map:1})}}function vP(e){let t;const n=e[3].default,i=sr(n,e,e[5],null);return{c(){i&&i.c()},m(r,l){i&&i.m(r,l),t=!0},p(r,l){i&&i.p&&(!t||l&32)&&lr(i,n,r,r[5],t?ar(n,r[5],l,null):ur(r[5]),null)},i(r){t||(mt(i,r),t=!0)},o(r){xt(i,r),t=!1},d(r){i&&i.d(r)}}}function bP(e){let t,n;const i=[Vr("modal-filters"),{layout:{"icon-image":["get","filter_kind"],"icon-allow-overlap":!0,"icon-size":.1}}];let r={$$slots:{default:[vP]},$$scope:{ctx:e}};for(let l=0;l<i.length;l+=1)r=Tr(r,i[l]);return t=new iI({props:r}),t.$on("click",e[4]),{c(){Zt(t.$$.fragment)},m(l,f){jt(t,l,f),n=!0},p(l,f){const a={};f&32&&(a.$$scope={dirty:f,ctx:l}),t.$set(a)},i(l){n||(mt(t.$$.fragment,l),n=!0)},o(l){xt(t.$$.fragment,l),n=!1},d(l){qt(t,l)}}}function xP(e){let t,n;return t=new Ps({props:{data:e[0],generateId:!0,$$slots:{default:[bP]},$$scope:{ctx:e}}}),{c(){Zt(t.$$.fragment)},m(i,r){jt(t,i,r),n=!0},p(i,[r]){const l={};r&1&&(l.data=i[0]),r&32&&(l.$$scope={dirty:r,ctx:i}),t.$set(l)},i(i){n||(mt(t.$$.fragment,i),n=!0)},o(i){xt(t.$$.fragment,i),n=!1},d(i){qt(t,i)}}}function wP(e,t,n){let i,r,l;Se(e,Wo,x=>n(1,r=x)),Se(e,gc,x=>n(2,l=x));let{$$slots:f={},$$scope:a}=t;function _(x){ii.call(this,e,x)}return e.$$set=x=>{"$$scope"in x&&n(5,a=x.$$scope)},e.$$.update=()=>{e.$$.dirty&6&&n(0,i=l>0?JSON.parse(r.renderModalFilters()):null)},[i,r,l,f,_,a]}class Rg extends nn{constructor(t){super(),en(this,t,wP,xP,He,{})}}function SP(e){let t;return{c(){t=ge("Choose study area")},m(n,i){Ct(n,t,i)},d(n){n&&It(t)}}}function EP(e){let t;return{c(){t=ge("Pick neighbourhood")},m(n,i){Ct(n,t,i)},d(n){n&&It(t)}}}function IP(e){let t;return{c(){t=ge("View shortcuts")},m(n,i){Ct(n,t,i)},d(n){n&&It(t)}}}function CP(e){let t;return{c(){t=ge("Route")},m(n,i){Ct(n,t,i)},d(n){n&&It(t)}}}function TP(e){let t;return{c(){t=ge("Change this boundary")},m(n,i){Ct(n,t,i)},d(n){n&&It(t)}}}function LP(e){let t;return{c(){t=ge("Debug")},m(n,i){Ct(n,t,i)},d(n){n&&It(t)}}}function MP(e){let t,n,i,r,l,f,a,_,x,S,L,A,P,O,B,U,Y,V,$,K,it,ft,pt,gt,ut;return l=new xi({props:{$$slots:{default:[SP]},$$scope:{ctx:e}}}),l.$on("click",e[20]),_=new xi({props:{$$slots:{default:[EP]},$$scope:{ctx:e}}}),_.$on("click",e[21]),B=new xi({props:{$$slots:{default:[IP]},$$scope:{ctx:e}}}),B.$on("click",e[22]),V=new xi({props:{$$slots:{default:[CP]},$$scope:{ctx:e}}}),V.$on("click",e[23]),it=new xi({props:{$$slots:{default:[TP]},$$scope:{ctx:e}}}),it.$on("click",e[24]),gt=new xi({props:{$$slots:{default:[LP]},$$scope:{ctx:e}}}),gt.$on("click",e[25]),{c(){t=wt("div"),n=wt("nav"),i=wt("ul"),r=wt("li"),Zt(l.$$.fragment),f=Xt(),a=wt("li"),Zt(_.$$.fragment),x=Xt(),S=wt("li"),S.textContent="Editing modal filters",L=Xt(),A=wt("nav"),P=wt("ul"),O=wt("li"),Zt(B.$$.fragment),U=Xt(),Y=wt("li"),Zt(V.$$.fragment),$=Xt(),K=wt("li"),Zt(it.$$.fragment),ft=Xt(),pt=wt("li"),Zt(gt.$$.fragment),Rt(n,"aria-label","breadcrumb"),Rt(t,"slot","top"),gi(t,"display","flex"),gi(t,"justify-content","space-between")},m(St,_t){Ct(St,t,_t),dt(t,n),dt(n,i),dt(i,r),jt(l,r,null),dt(i,f),dt(i,a),jt(_,a,null),dt(i,x),dt(i,S),dt(t,L),dt(t,A),dt(A,P),dt(P,O),jt(B,O,null),dt(P,U),dt(P,Y),jt(V,Y,null),dt(P,$),dt(P,K),jt(it,K,null),dt(P,ft),dt(P,pt),jt(gt,pt,null),ut=!0},p(St,_t){const vt={};_t[1]&1&&(vt.$$scope={dirty:_t,ctx:St}),l.$set(vt);const ee={};_t[1]&1&&(ee.$$scope={dirty:_t,ctx:St}),_.$set(ee);const kt={};_t[1]&1&&(kt.$$scope={dirty:_t,ctx:St}),B.$set(kt);const Gt={};_t[1]&1&&(Gt.$$scope={dirty:_t,ctx:St}),V.$set(Gt);const Qt={};_t[1]&1&&(Qt.$$scope={dirty:_t,ctx:St}),it.$set(Qt);const se={};_t[1]&1&&(se.$$scope={dirty:_t,ctx:St}),gt.$set(se)},i(St){ut||(mt(l.$$.fragment,St),mt(_.$$.fragment,St),mt(B.$$.fragment,St),mt(V.$$.fragment,St),mt(it.$$.fragment,St),mt(gt.$$.fragment,St),ut=!0)},o(St){xt(l.$$.fragment,St),xt(_.$$.fragment,St),xt(B.$$.fragment,St),xt(V.$$.fragment,St),xt(it.$$.fragment,St),xt(gt.$$.fragment,St),ut=!1},d(St){St&&It(t),qt(l),qt(_),qt(B),qt(V),qt(it),qt(gt)}}}function PP(e){let t,n,i;return{c(){t=ge("Undo ("),n=ge(e[4]),i=ge(")")},m(r,l){Ct(r,t,l),Ct(r,n,l),Ct(r,i,l)},p(r,l){l[0]&16&&zi(n,r[4])},d(r){r&&(It(t),It(n),It(i))}}}function kP(e){let t;return{c(){t=ge("Undo")},m(n,i){Ct(n,t,i)},p:Ie,d(n){n&&It(t)}}}function AP(e){let t,n,i;return{c(){t=ge("Redo ("),n=ge(e[5]),i=ge(")")},m(r,l){Ct(r,t,l),Ct(r,n,l),Ct(r,i,l)},p(r,l){l[0]&32&&zi(n,r[5])},d(r){r&&(It(t),It(n),It(i))}}}function NP(e){let t;return{c(){t=ge("Redo")},m(n,i){Ct(n,t,i)},p:Ie,d(n){n&&It(t)}}}function wb(e){let t,n;return t=new dP({}),t.$on("close",e[19]),{c(){Zt(t.$$.fragment)},m(i,r){jt(t,i,r),n=!0},p:Ie,i(i){n||(mt(t.$$.fragment,i),n=!0)},o(i){xt(t.$$.fragment,i),n=!1},d(i){qt(t,i)}}}function DP(e){let t,n,i,r,l=ui(ui(e[6]).properties).name+"",f,a,_,x,S,L,A,P,O,B,U,Y,V,$,K,it,ft,pt,gt,ut,St,_t,vt,ee,kt,Gt,Qt,se,Ce,yn,jn,Qe,Fe,ke,fn,Kn;function qn(yt,Ee){return yt[4]==0?kP:PP}let re=qn(e),De=re(e);function hn(yt,Ee){return yt[5]==0?NP:AP}let On=hn(e),yi=On(e),wn=e[3]&&wb(e);return Fe=new kw({}),{c(){t=wt("div"),n=wt("p"),i=ge("Editing neighbourhood "),r=wt("u"),f=ge(l),a=Xt(),_=wt("p"),_.textContent=`Now that you've defined a neighbourhood boundary, you can see the possible
      shortcuts that vehicles are currently able to take through it. You can add
      a new modal filter to try and solve this. The colored "cell" areas show
      what's reachable for drivers without leaving the boundary you've drawn.`,x=Xt(),S=wt("hr"),L=Xt(),A=wt("button"),P=wt("img"),B=ge(`
      Add a modal filter`),Y=Xt(),V=wt("button"),$=ge("Add many modal filters along line"),it=Xt(),ft=wt("button"),pt=ge("Change modal filter type"),ut=Xt(),St=wt("div"),_t=wt("button"),De.c(),ee=Xt(),kt=wt("button"),yi.c(),Qt=Xt(),wn&&wn.c(),se=Xt(),Ce=wt("hr"),yn=Xt(),jn=wt("hr"),Qe=Xt(),Zt(Fe.$$.fragment),hr(P.src,O=`/ltn//filters/${e[8]}_icon.gif`)||Rt(P,"src",O),Rt(P,"width","30"),Rt(P,"alt","Add a modal filter"),A.disabled=U=e[0]||e[2],V.disabled=K=e[0]||e[2],ft.disabled=gt=e[0]||e[2],_t.disabled=vt=e[4]==0,kt.disabled=Gt=e[5]==0,gi(St,"display","flex"),gi(St,"justify-content","space-between"),Rt(t,"slot","sidebar")},m(yt,Ee){Ct(yt,t,Ee),dt(t,n),dt(n,i),dt(n,r),dt(r,f),dt(t,a),dt(t,_),dt(t,x),dt(t,S),dt(t,L),dt(t,A),dt(A,P),dt(A,B),dt(t,Y),dt(t,V),dt(V,$),dt(t,it),dt(t,ft),dt(ft,pt),dt(t,ut),dt(t,St),dt(St,_t),De.m(_t,null),dt(St,ee),dt(St,kt),yi.m(kt,null),dt(t,Qt),wn&&wn.m(t,null),dt(t,se),dt(t,Ce),dt(t,yn),dt(t,jn),dt(t,Qe),jt(Fe,t,null),ke=!0,fn||(Kn=[Ze(A,"click",e[16]),Ze(V,"click",e[17]),Ze(ft,"click",e[18]),Ze(_t,"click",e[12]),Ze(kt,"click",e[13])],fn=!0)},p(yt,Ee){(!ke||Ee[0]&64)&&l!==(l=ui(ui(yt[6]).properties).name+"")&&zi(f,l),(!ke||Ee[0]&256&&!hr(P.src,O=`/ltn//filters/${yt[8]}_icon.gif`))&&Rt(P,"src",O),(!ke||Ee[0]&5&&U!==(U=yt[0]||yt[2]))&&(A.disabled=U),(!ke||Ee[0]&5&&K!==(K=yt[0]||yt[2]))&&(V.disabled=K),(!ke||Ee[0]&5&&gt!==(gt=yt[0]||yt[2]))&&(ft.disabled=gt),re===(re=qn(yt))&&De?De.p(yt,Ee):(De.d(1),De=re(yt),De&&(De.c(),De.m(_t,null))),(!ke||Ee[0]&16&&vt!==(vt=yt[4]==0))&&(_t.disabled=vt),On===(On=hn(yt))&&yi?yi.p(yt,Ee):(yi.d(1),yi=On(yt),yi&&(yi.c(),yi.m(kt,null))),(!ke||Ee[0]&32&&Gt!==(Gt=yt[5]==0))&&(kt.disabled=Gt),yt[3]?wn?(wn.p(yt,Ee),Ee[0]&8&&mt(wn,1)):(wn=wb(yt),wn.c(),mt(wn,1),wn.m(t,se)):wn&&(ci(),xt(wn,1,1,()=>{wn=null}),hi())},i(yt){ke||(mt(wn),mt(Fe.$$.fragment,yt),ke=!0)},o(yt){xt(wn),xt(Fe.$$.fragment,yt),ke=!1},d(yt){yt&&It(t),De.d(),yi.d(),wn&&wn.d(),qt(Fe),fn=!1,No(Kn)}}}function RP(e){let t,n=e[30].shortcuts+"",i,r,l=(e[30].name??"unnamed road")+"",f;return{c(){t=wt("p"),i=ge(n),r=ge(" shortcuts through "),f=ge(l)},m(a,_){Ct(a,t,_),dt(t,i),dt(t,r),dt(t,f)},p(a,_){_[0]&1073741824&&n!==(n=a[30].shortcuts+"")&&zi(i,n),_[0]&1073741824&&l!==(l=(a[30].name??"unnamed road")+"")&&zi(f,l)},d(a){a&&It(t)}}}function OP(e){let t,n,i;return n=new wl({props:{openOn:"hover",$$slots:{default:[RP,({props:r})=>({30:r}),({props:r})=>[r?1073741824:0]]},$$scope:{ctx:e}}}),{c(){t=wt("div"),Zt(n.$$.fragment),Rt(t,"slot","line-popup")},m(r,l){Ct(r,t,l),jt(n,t,null),i=!0},p(r,l){const f={};l[0]&1073741824|l[1]&1&&(f.$$scope={dirty:l,ctx:r}),n.$set(f)},i(r){i||(mt(n.$$.fragment,r),i=!0)},o(r){xt(n.$$.fragment,r),i=!1},d(r){r&&It(t),qt(n)}}}function zP(e){let t;return{c(){t=ge("Click to delete")},m(n,i){Ct(n,t,i)},d(n){n&&It(t)}}}function FP(e){let t,n;return t=new wl({props:{openOn:"hover",$$slots:{default:[zP]},$$scope:{ctx:e}}}),{c(){Zt(t.$$.fragment)},m(i,r){jt(t,i,r),n=!0},p(i,r){const l={};r[1]&1&&(l.$$scope={dirty:r,ctx:i}),t.$set(l)},i(i){n||(mt(t.$$.fragment,i),n=!0)},o(i){xt(t.$$.fragment,i),n=!1},d(i){qt(t,i)}}}function Sb(e){let t,n;return t=new yP({props:{map:ui(e[1])}}),t.$on("done",e[14]),{c(){Zt(t.$$.fragment)},m(i,r){jt(t,i,r),n=!0},p(i,r){const l={};r[0]&2&&(l.map=ui(i[1])),t.$set(l)},i(i){n||(mt(t.$$.fragment,i),n=!0)},o(i){xt(t.$$.fragment,i),n=!1},d(i){qt(t,i)}}}function BP(e){let t,n,i,r,l,f;n=new Dg({props:{gjInput:e[7],interactive:!e[0]&&!e[2],$$slots:{"line-popup":[OP]},$$scope:{ctx:e}}}),r=new Rg({props:{$$slots:{default:[FP]},$$scope:{ctx:e}}}),r.$on("click",e[10]);let a=e[2]&&Sb(e);return{c(){t=wt("div"),Zt(n.$$.fragment),i=Xt(),Zt(r.$$.fragment),l=Xt(),a&&a.c(),Rt(t,"slot","map")},m(_,x){Ct(_,t,x),jt(n,t,null),dt(t,i),jt(r,t,null),dt(t,l),a&&a.m(t,null),f=!0},p(_,x){const S={};x[0]&128&&(S.gjInput=_[7]),x[0]&5&&(S.interactive=!_[0]&&!_[2]),x[1]&1&&(S.$$scope={dirty:x,ctx:_}),n.$set(S);const L={};x[1]&1&&(L.$$scope={dirty:x,ctx:_}),r.$set(L),_[2]?a?(a.p(_,x),x[0]&4&&mt(a,1)):(a=Sb(_),a.c(),mt(a,1),a.m(t,null)):a&&(ci(),xt(a,1,1,()=>{a=null}),hi())},i(_){f||(mt(n.$$.fragment,_),mt(r.$$.fragment,_),mt(a),f=!0)},o(_){xt(n.$$.fragment,_),xt(r.$$.fragment,_),xt(a),f=!1},d(_){_&&It(t),qt(n),qt(r),a&&a.d()}}}function VP(e){let t,n,i,r;return t=new Wu({props:{$$slots:{map:[BP],sidebar:[DP],top:[MP]},$$scope:{ctx:e}}}),{c(){Zt(t.$$.fragment)},m(l,f){jt(t,l,f),n=!0,i||(r=Ze(window,"keydown",e[11]),i=!0)},p(l,f){const a={};f[0]&1023|f[1]&1&&(a.$$scope={dirty:f,ctx:l}),t.$set(a)},i(l){n||(mt(t.$$.fragment,l),n=!0)},o(l){xt(t.$$.fragment,l),n=!1},d(l){qt(t,l),i=!1,r()}}}function UP(e,t,n){let i,r,l,f,a;Se(e,gc,se=>n(15,i=se)),Se(e,ly,se=>n(8,r=se)),Se(e,Wo,se=>n(26,l=se)),Se(e,Du,se=>n(1,f=se)),Se(e,xn,se=>n(9,a=se));let _=!1,x=!1,S=!1,L=0,A=0,P,O;function B(se){n(7,O=JSON.parse(l.renderNeighbourhood())),n(6,P=O.features.find(Ce=>Ce.properties.kind=="boundary")),n(4,L=O.undo_length),n(5,A=O.redo_length)}aa(()=>{Y()});function U(se){l.addModalFilter(se.lngLat,r),je(gc,i++,i),Y()}function Y(){n(0,_=!1),f.off("click",U),f.getCanvas().style.cursor="inherit"}function V(se){let Ce=se.detail.features[0];l.deleteModalFilter(Ce.properties.road),je(gc,i++,i)}function $(se){se.key=="a"&&!_&&!x&&n(0,_=!0),se.key=="z"&&se.ctrlKey&&K(),se.key=="y"&&se.ctrlKey&&it()}function K(){l.undo(),je(gc,i++,i)}function it(){l.redo(),je(gc,i++,i)}function ft(se){let Ce=se.detail;Ce&&(l.addManyModalFilters(Ce,r),je(gc,i++,i)),n(2,x=!1)}const pt=()=>n(0,_=!0),gt=()=>n(2,x=!0),ut=()=>n(3,S=!0),St=()=>n(3,S=!1),_t=()=>je(xn,a={mode:"title"},a),vt=()=>je(xn,a={mode:"network"},a),ee=()=>je(xn,a={mode:"view-shortcuts"},a),kt=()=>je(xn,a={mode:"route",prevMode:"neighbourhood"},a),Gt=()=>je(xn,a={mode:"set-boundary",name:ui(ui(P).properties).name,existing:P},a),Qt=()=>je(xn,a={mode:"debug"},a);return e.$$.update=()=>{e.$$.dirty[0]&32768&&B(),e.$$.dirty[0]&3&&_&&(f.on("click",U),f.getCanvas().style.cursor="crosshair")},[_,f,x,S,L,A,P,O,r,a,V,$,K,it,ft,i,pt,gt,ut,St,_t,vt,ee,kt,Gt,Qt]}class GP extends nn{constructor(t){super(),en(this,t,UP,VP,He,{},null,[-1,-1])}}function Eb(e,t,n){const i=e.slice();return i[14]=t[n],i}function jP(e){let t;return{c(){t=ge("Choose study area")},m(n,i){Ct(n,t,i)},d(n){n&&It(t)}}}function qP(e){let t;return{c(){t=ge("Route")},m(n,i){Ct(n,t,i)},d(n){n&&It(t)}}}function ZP(e){let t;return{c(){t=ge("Debug route snapper")},m(n,i){Ct(n,t,i)},d(n){n&&It(t)}}}function $P(e){let t,n,i,r,l,f,a,_,x,S,L,A,P,O,B,U;return l=new xi({props:{$$slots:{default:[jP]},$$scope:{ctx:e}}}),l.$on("click",e[10]),A=new xi({props:{$$slots:{default:[qP]},$$scope:{ctx:e}}}),A.$on("click",e[11]),B=new xi({props:{$$slots:{default:[ZP]},$$scope:{ctx:e}}}),B.$on("click",e[12]),{c(){t=wt("div"),n=wt("nav"),i=wt("ul"),r=wt("li"),Zt(l.$$.fragment),f=Xt(),a=wt("li"),a.textContent="Pick neighbourhood",_=Xt(),x=wt("nav"),S=wt("ul"),L=wt("li"),Zt(A.$$.fragment),P=Xt(),O=wt("li"),Zt(B.$$.fragment),Rt(n,"aria-label","breadcrumb"),Rt(t,"slot","top"),gi(t,"display","flex"),gi(t,"justify-content","space-between")},m(Y,V){Ct(Y,t,V),dt(t,n),dt(n,i),dt(i,r),jt(l,r,null),dt(i,f),dt(i,a),dt(t,_),dt(t,x),dt(x,S),dt(S,L),jt(A,L,null),dt(S,P),dt(S,O),jt(B,O,null),U=!0},p(Y,V){const $={};V&131072&&($.$$scope={dirty:V,ctx:Y}),l.$set($);const K={};V&131072&&(K.$$scope={dirty:V,ctx:Y}),A.$set(K);const it={};V&131072&&(it.$$scope={dirty:V,ctx:Y}),B.$set(it)},i(Y){U||(mt(l.$$.fragment,Y),mt(A.$$.fragment,Y),mt(B.$$.fragment,Y),U=!0)},o(Y){xt(l.$$.fragment,Y),xt(A.$$.fragment,Y),xt(B.$$.fragment,Y),U=!1},d(Y){Y&&It(t),qt(l),qt(A),qt(B)}}}function WP(e){let t;return{c(){t=ge("Draw a new boundary")},m(n,i){Ct(n,t,i)},d(n){n&&It(t)}}}function XP(e){let t=e[14]+"",n;return{c(){n=ge(t)},m(i,r){Ct(i,n,r)},p(i,r){r&2&&t!==(t=i[14]+"")&&zi(n,t)},d(i){i&&It(n)}}}function Ib(e){let t,n,i,r,l,f,a,_,x;function S(){return e[8](e[14])}i=new xi({props:{$$slots:{default:[XP]},$$scope:{ctx:e}}}),i.$on("click",S);function L(){return e[9](e[14])}return{c(){t=wt("li"),n=wt("span"),Zt(i.$$.fragment),r=Xt(),l=wt("button"),l.textContent="X",f=Xt(),Rt(l,"class","secondary outline"),gi(n,"display","flex"),gi(n,"justify-content","space-between")},m(A,P){Ct(A,t,P),dt(t,n),jt(i,n,null),dt(n,r),dt(n,l),dt(t,f),a=!0,_||(x=Ze(l,"click",L),_=!0)},p(A,P){e=A;const O={};P&131074&&(O.$$scope={dirty:P,ctx:e}),i.$set(O)},i(A){a||(mt(i.$$.fragment,A),a=!0)},o(A){xt(i.$$.fragment,A),a=!1},d(A){A&&It(t),qt(i),_=!1,x()}}}function HP(e){let t,n,i,r,l,f,a,_,x,S,L;r=new xi({props:{$$slots:{default:[WP]},$$scope:{ctx:e}}}),r.$on("click",e[5]);let A=la(e[1]),P=[];for(let B=0;B<A.length;B+=1)P[B]=Ib(Eb(e,A,B));const O=B=>xt(P[B],1,1,()=>{P[B]=null});return S=new kw({}),{c(){t=wt("div"),n=wt("p"),n.textContent=`Inside the neighbourhood you define, the goal is to eliminate (or
      deliberately permit) through-traffic. An appropriate neighbourhood
      boundary depends on many factors. The simplest approach is to find the
      area bounded on all sides by "main" roads, which are designed for higher
      traffic volumes. There are many other considerations, though -- maybe
      severances like rivers or rail should be part of a boundary. Bridges and
      tunnels near a boundary may be confusing as well. And note that your
      boundary may not match the conventional definition of "neighbourhood."`,i=Xt(),Zt(r.$$.fragment),l=Xt(),f=wt("ul");for(let B=0;B<P.length;B+=1)P[B].c();a=Xt(),_=wt("hr"),x=Xt(),Zt(S.$$.fragment),Rt(t,"slot","sidebar")},m(B,U){Ct(B,t,U),dt(t,n),dt(t,i),jt(r,t,null),dt(t,l),dt(t,f);for(let Y=0;Y<P.length;Y+=1)P[Y]&&P[Y].m(f,null);dt(t,a),dt(t,_),dt(t,x),jt(S,t,null),L=!0},p(B,U){const Y={};if(U&131072&&(Y.$$scope={dirty:U,ctx:B}),r.$set(Y),U&26){A=la(B[1]);let V;for(V=0;V<A.length;V+=1){const $=Eb(B,A,V);P[V]?(P[V].p($,U),mt(P[V],1)):(P[V]=Ib($),P[V].c(),mt(P[V],1),P[V].m(f,null))}for(ci(),V=A.length;V<P.length;V+=1)O(V);hi()}},i(B){if(!L){mt(r.$$.fragment,B);for(let U=0;U<A.length;U+=1)mt(P[U]);mt(S.$$.fragment,B),L=!0}},o(B){xt(r.$$.fragment,B),P=P.filter(Boolean);for(let U=0;U<P.length;U+=1)xt(P[U]);xt(S.$$.fragment,B),L=!1},d(B){B&&It(t),qt(r),ud(P,B),qt(S)}}}function YP(e){let t,n=e[13].name+"",i;return{c(){t=wt("p"),i=ge(n)},m(r,l){Ct(r,t,l),dt(t,i)},p(r,l){l&8192&&n!==(n=r[13].name+"")&&zi(i,n)},d(r){r&&It(t)}}}function KP(e){let t,n;return t=new wl({props:{openOn:"hover",$$slots:{default:[YP,({props:i})=>({13:i}),({props:i})=>i?8192:0]},$$scope:{ctx:e}}}),{c(){Zt(t.$$.fragment)},m(i,r){jt(t,i,r),n=!0},p(i,r){const l={};r&139264&&(l.$$scope={dirty:r,ctx:i}),t.$set(l)},i(i){n||(mt(t.$$.fragment,i),n=!0)},o(i){xt(t.$$.fragment,i),n=!1},d(i){qt(t,i)}}}function JP(e){let t,n,i,r;const l=[Vr("neighbourhood-boundaries"),{filter:["==",["get","kind"],"boundary"]},{paint:{"fill-color":"red","fill-opacity":ry(.3,.5)}},{manageHoverState:!0},{hoverCursor:"pointer"}];let f={$$slots:{default:[KP]},$$scope:{ctx:e}};for(let a=0;a<l.length;a+=1)f=Tr(f,l[a]);return t=new af({props:f}),t.$on("click",e[7]),i=new Rg({}),{c(){Zt(t.$$.fragment),n=Xt(),Zt(i.$$.fragment)},m(a,_){jt(t,a,_),Ct(a,n,_),jt(i,a,_),r=!0},p(a,_){const x={};_&131072&&(x.$$scope={dirty:_,ctx:a}),t.$set(x)},i(a){r||(mt(t.$$.fragment,a),mt(i.$$.fragment,a),r=!0)},o(a){xt(t.$$.fragment,a),xt(i.$$.fragment,a),r=!1},d(a){a&&It(n),qt(t,a),qt(i,a)}}}function QP(e){let t,n,i;return n=new Ps({props:{data:e[0],generateId:!0,$$slots:{default:[JP]},$$scope:{ctx:e}}}),{c(){t=wt("div"),Zt(n.$$.fragment),Rt(t,"slot","map")},m(r,l){Ct(r,t,l),jt(n,t,null),i=!0},p(r,l){const f={};l&1&&(f.data=r[0]),l&131072&&(f.$$scope={dirty:l,ctx:r}),n.$set(f)},i(r){i||(mt(n.$$.fragment,r),i=!0)},o(r){xt(n.$$.fragment,r),i=!1},d(r){r&&It(t),qt(n)}}}function tk(e){let t,n;return t=new Wu({props:{$$slots:{map:[QP],sidebar:[HP],top:[$P]},$$scope:{ctx:e}}}),{c(){Zt(t.$$.fragment)},m(i,r){jt(t,i,r),n=!0},p(i,[r]){const l={};r&131079&&(l.$$scope={dirty:r,ctx:i}),t.$set(l)},i(i){n||(mt(t.$$.fragment,i),n=!0)},o(i){xt(t.$$.fragment,i),n=!1},d(i){qt(t,i)}}}function ek(e,t,n){let i,r,l,f;Se(e,xn,U=>n(2,l=U)),Se(e,Wo,U=>n(6,f=U));function a(U){f.setCurrentNeighbourhood(U),je(xn,l={mode:"neighbourhood"},l)}function _(U){f.deleteNeighbourhoodBoundary(U),n(0,i=JSON.parse(f.toSavefile()))}function x(){let U=window.prompt("What do you want to name the neighbourhood?");U&&je(xn,l={mode:"set-boundary",name:U,existing:null},l)}const S=U=>a(ui(U.detail.features[0].properties).name),L=U=>a(U),A=U=>_(U),P=()=>je(xn,l={mode:"title"},l),O=()=>je(xn,l={mode:"route",prevMode:"network"},l),B=()=>je(xn,l={mode:"debug-gj"},l);return e.$$.update=()=>{e.$$.dirty&64&&n(0,i=JSON.parse(f.toSavefile())),e.$$.dirty&1&&n(1,r=i.features.filter(U=>U.properties.kind=="boundary").map(U=>U.properties.name))},[i,r,l,a,_,x,f,S,L,A,P,O,B]}class nk extends nn{constructor(t){super(),en(this,t,ek,tk,He,{})}}function ik(e){let t;return{c(){t=ge("Choose study area")},m(n,i){Ct(n,t,i)},d(n){n&&It(t)}}}function rk(e){let t;return{c(){t=ge("Pick neighbourhood")},m(n,i){Ct(n,t,i)},d(n){n&&It(t)}}}function Cb(e){let t,n,i;return n=new xi({props:{$$slots:{default:[ok]},$$scope:{ctx:e}}}),n.$on("click",e[11]),{c(){t=wt("li"),Zt(n.$$.fragment)},m(r,l){Ct(r,t,l),jt(n,t,null),i=!0},p(r,l){const f={};l&4096&&(f.$$scope={dirty:l,ctx:r}),n.$set(f)},i(r){i||(mt(n.$$.fragment,r),i=!0)},o(r){xt(n.$$.fragment,r),i=!1},d(r){r&&It(t),qt(n)}}}function ok(e){let t;return{c(){t=ge("Editing modal filters")},m(n,i){Ct(n,t,i)},d(n){n&&It(t)}}}function sk(e){let t,n,i,r,l,f,a,_,x,S,L,A;l=new xi({props:{$$slots:{default:[ik]},$$scope:{ctx:e}}}),l.$on("click",e[9]),_=new xi({props:{$$slots:{default:[rk]},$$scope:{ctx:e}}}),_.$on("click",e[10]);let P=e[0]=="neighbourhood"&&Cb(e);return{c(){t=wt("div"),n=wt("nav"),i=wt("ul"),r=wt("li"),Zt(l.$$.fragment),f=Xt(),a=wt("li"),Zt(_.$$.fragment),x=Xt(),P&&P.c(),S=Xt(),L=wt("li"),L.textContent="Routing",Rt(n,"aria-label","breadcrumb"),Rt(t,"slot","top")},m(O,B){Ct(O,t,B),dt(t,n),dt(n,i),dt(i,r),jt(l,r,null),dt(i,f),dt(i,a),jt(_,a,null),dt(i,x),P&&P.m(i,null),dt(i,S),dt(i,L),A=!0},p(O,B){const U={};B&4096&&(U.$$scope={dirty:B,ctx:O}),l.$set(U);const Y={};B&4096&&(Y.$$scope={dirty:B,ctx:O}),_.$set(Y),O[0]=="neighbourhood"?P?(P.p(O,B),B&1&&mt(P,1)):(P=Cb(O),P.c(),mt(P,1),P.m(i,S)):P&&(ci(),xt(P,1,1,()=>{P=null}),hi())},i(O){A||(mt(l.$$.fragment,O),mt(_.$$.fragment,O),mt(P),A=!0)},o(O){xt(l.$$.fragment,O),xt(_.$$.fragment,O),xt(P),A=!1},d(O){O&&It(t),qt(l),qt(_),P&&P.d()}}}function ak(e){let t,n,i,r,l,f,a;return n=new Ng({}),n.$on("click",e[6]),{c(){t=wt("div"),Zt(n.$$.fragment),i=Xt(),r=wt("p"),r.textContent="Drag markers for a route",l=Xt(),f=wt("p"),f.innerHTML=`<span style="color: red">Route before</span>
      ,
      <span style="color: blue">route after</span>`,Rt(t,"slot","sidebar")},m(_,x){Ct(_,t,x),jt(n,t,null),dt(t,i),dt(t,r),dt(t,l),dt(t,f),a=!0},p:Ie,i(_){a||(mt(n.$$.fragment,_),a=!0)},o(_){xt(n.$$.fragment,_),a=!1},d(_){_&&It(t),qt(n)}}}function Tb(e){let t,n;return t=new Dg({props:{gjInput:JSON.parse(ui(e[3]).renderNeighbourhood()),interactive:!1}}),{c(){Zt(t.$$.fragment)},m(i,r){jt(t,i,r),n=!0},p(i,r){const l={};r&8&&(l.gjInput=JSON.parse(ui(i[3]).renderNeighbourhood())),t.$set(l)},i(i){n||(mt(t.$$.fragment,i),n=!0)},o(i){xt(t.$$.fragment,i),n=!1},d(i){qt(t,i)}}}function lk(e){let t,n;const i=[Vr("compare-route"),{paint:{"line-width":10,"line-color":Rp(["get","kind"],{before:"red",after:"blue"},"red")}}];let r={};for(let l=0;l<i.length;l+=1)r=Tr(r,i[l]);return t=new ru({props:r}),{c(){Zt(t.$$.fragment)},m(l,f){jt(t,l,f),n=!0},p(l,f){const a={};t.$set(a)},i(l){n||(mt(t.$$.fragment,l),n=!0)},o(l){xt(t.$$.fragment,l),n=!1},d(l){qt(t,l)}}}function uk(e){let t;return{c(){t=wt("span"),t.textContent="A",Rt(t,"class","dot svelte-1ukzawy")},m(n,i){Ct(n,t,i)},p:Ie,d(n){n&&It(t)}}}function ck(e){let t;return{c(){t=wt("span"),t.textContent="B",Rt(t,"class","dot svelte-1ukzawy")},m(n,i){Ct(n,t,i)},p:Ie,d(n){n&&It(t)}}}function hk(e){let t,n,i,r,l,f,a,_,x,S,L,A,P=e[0]=="neighbourhood"&&Tb(e);i=new Rg({}),l=new Ps({props:{data:e[4],$$slots:{default:[lk]},$$scope:{ctx:e}}});function O(V){e[7](V)}let B={draggable:!0,$$slots:{default:[uk]},$$scope:{ctx:e}};e[2]!==void 0&&(B.lngLat=e[2]),a=new Yv({props:B}),cr.push(()=>vc(a,"lngLat",O));function U(V){e[8](V)}let Y={draggable:!0,$$slots:{default:[ck]},$$scope:{ctx:e}};return e[1]!==void 0&&(Y.lngLat=e[1]),S=new Yv({props:Y}),cr.push(()=>vc(S,"lngLat",U)),{c(){t=wt("div"),P&&P.c(),n=Xt(),Zt(i.$$.fragment),r=Xt(),Zt(l.$$.fragment),f=Xt(),Zt(a.$$.fragment),x=Xt(),Zt(S.$$.fragment),Rt(t,"slot","map")},m(V,$){Ct(V,t,$),P&&P.m(t,null),dt(t,n),jt(i,t,null),dt(t,r),jt(l,t,null),dt(t,f),jt(a,t,null),dt(t,x),jt(S,t,null),A=!0},p(V,$){V[0]=="neighbourhood"?P?(P.p(V,$),$&1&&mt(P,1)):(P=Tb(V),P.c(),mt(P,1),P.m(t,n)):P&&(ci(),xt(P,1,1,()=>{P=null}),hi());const K={};$&16&&(K.data=V[4]),$&4096&&(K.$$scope={dirty:$,ctx:V}),l.$set(K);const it={};$&4096&&(it.$$scope={dirty:$,ctx:V}),!_&&$&4&&(_=!0,it.lngLat=V[2],yc(()=>_=!1)),a.$set(it);const ft={};$&4096&&(ft.$$scope={dirty:$,ctx:V}),!L&&$&2&&(L=!0,ft.lngLat=V[1],yc(()=>L=!1)),S.$set(ft)},i(V){A||(mt(P),mt(i.$$.fragment,V),mt(l.$$.fragment,V),mt(a.$$.fragment,V),mt(S.$$.fragment,V),A=!0)},o(V){xt(P),xt(i.$$.fragment,V),xt(l.$$.fragment,V),xt(a.$$.fragment,V),xt(S.$$.fragment,V),A=!1},d(V){V&&It(t),P&&P.d(),qt(i),qt(l),qt(a),qt(S)}}}function fk(e){let t,n;return t=new Wu({props:{$$slots:{map:[hk],sidebar:[ak],top:[sk]},$$scope:{ctx:e}}}),{c(){Zt(t.$$.fragment)},m(i,r){jt(t,i,r),n=!0},p(i,[r]){const l={};r&4159&&(l.$$scope={dirty:r,ctx:i}),t.$set(l)},i(i){n||(mt(t.$$.fragment,i),n=!0)},o(i){xt(t.$$.fragment,i),n=!1},d(i){qt(t,i)}}}function pk(e,t,n){let i,r,l,f,a;Se(e,xn,B=>n(5,r=B)),Se(e,Km,B=>n(1,l=B)),Se(e,Ym,B=>n(2,f=B)),Se(e,Wo,B=>n(3,a=B));let{prevMode:_}=t;function x(){je(xn,r={mode:_},r)}function S(B){f=B,Ym.set(f)}function L(B){l=B,Km.set(l)}const A=()=>je(xn,r={mode:"title"},r),P=()=>je(xn,r={mode:"network"},r),O=()=>je(xn,r={mode:"neighbourhood"},r);return e.$$set=B=>{"prevMode"in B&&n(0,_=B.prevMode)},e.$$.update=()=>{e.$$.dirty&14&&n(4,i=JSON.parse(a.compareRoute(f.lng,f.lat,l.lng,l.lat)))},[_,l,f,a,i,r,x,S,L,A,P,O]}class dk extends nn{constructor(t){super(),en(this,t,pk,fk,He,{prevMode:0})}}const mk="/ltn/assets/settings-342fb430.svg";function Lb(e){let t,n;return t=new Ky({props:{$$slots:{default:[gk]},$$scope:{ctx:e}}}),t.$on("close",e[3]),{c(){Zt(t.$$.fragment)},m(i,r){jt(t,i,r),n=!0},p(i,r){const l={};r&17&&(l.$$scope={dirty:r,ctx:i}),t.$set(l)},i(i){n||(mt(t.$$.fragment,i),n=!0)},o(i){xt(t.$$.fragment,i),n=!1},d(i){qt(t,i)}}}function gk(e){let t,n,i,r,l,f,a,_,x;return i=new vI({}),{c(){t=wt("h1"),t.textContent="Settings",n=Xt(),Zt(i.$$.fragment),r=Xt(),l=wt("center"),f=wt("button"),f.textContent="Confirm"},m(S,L){Ct(S,t,L),Ct(S,n,L),jt(i,S,L),Ct(S,r,L),Ct(S,l,L),dt(l,f),a=!0,_||(x=Ze(f,"click",e[2]),_=!0)},p:Ie,i(S){a||(mt(i.$$.fragment,S),a=!0)},o(S){xt(i.$$.fragment,S),a=!1},d(S){S&&(It(t),It(n),It(r),It(l)),qt(i,S),_=!1,x()}}}function _k(e){let t,n,i,r,l,f,a=e[0]&&Lb(e);return{c(){t=wt("button"),t.innerHTML=`<img src="${mk}" alt="Settings"/>`,n=Xt(),a&&a.c(),i=ts(),Rt(t,"class","outline")},m(_,x){Ct(_,t,x),Ct(_,n,x),a&&a.m(_,x),Ct(_,i,x),r=!0,l||(f=Ze(t,"click",e[1]),l=!0)},p(_,[x]){_[0]?a?(a.p(_,x),x&1&&mt(a,1)):(a=Lb(_),a.c(),mt(a,1),a.m(i.parentNode,i)):a&&(ci(),xt(a,1,1,()=>{a=null}),hi())},i(_){r||(mt(a),r=!0)},o(_){xt(a),r=!1},d(_){_&&(It(t),It(n),It(i)),a&&a.d(_),l=!1,f()}}}function yk(e,t,n){let i=!1;return[i,()=>n(0,i=!0),()=>n(0,i=!1),()=>n(0,i=!1)]}class vk extends nn{constructor(t){super(),en(this,t,yk,_k,He,{})}}function bk(e){let t,n,i,r,l,f;const a=[Vr("route-points"),{filter:Lw},{paint:{"circle-color":Rp(["get","type"],{"snapped-waypoint":"red","free-waypoint":"blue"},"black"),"circle-opacity":["case",["has","hovered"],.5,1],"circle-radius":Rp(["get","type"],{node:Fm/2},Fm)}}];let _={};for(let P=0;P<a.length;P+=1)_=Tr(_,a[P]);t=new hd({props:_});const x=[Vr("route-lines"),{filter:Tw},{paint:{"line-color":["case",["get","snapped"],"red","blue"],"line-width":2.5}}];let S={};for(let P=0;P<x.length;P+=1)S=Tr(S,x[P]);i=new ru({props:S});const L=[Vr("route-polygons"),{filter:Cw},{paint:{"fill-color":"black","fill-opacity":.5}}];let A={};for(let P=0;P<L.length;P+=1)A=Tr(A,L[P]);return l=new af({props:A}),{c(){Zt(t.$$.fragment),n=Xt(),Zt(i.$$.fragment),r=Xt(),Zt(l.$$.fragment)},m(P,O){jt(t,P,O),Ct(P,n,O),jt(i,P,O),Ct(P,r,O),jt(l,P,O),f=!0},p(P,O){const B=O&0?Wb(a,[a[0],a[1],{paint:{"circle-color":Rp(["get","type"],{"snapped-waypoint":"red","free-waypoint":"blue"},"black"),"circle-opacity":["case",["has","hovered"],.5,1],"circle-radius":Rp(["get","type"],{node:Fm/2},Fm)}}]):{};t.$set(B);const U={};i.$set(U);const Y={};l.$set(Y)},i(P){f||(mt(t.$$.fragment,P),mt(i.$$.fragment,P),mt(l.$$.fragment,P),f=!0)},o(P){xt(t.$$.fragment,P),xt(i.$$.fragment,P),xt(l.$$.fragment,P),f=!1},d(P){P&&(It(n),It(r)),qt(t,P),qt(i,P),qt(l,P)}}}function xk(e){let t,n;return t=new Ps({props:{data:e[0],$$slots:{default:[bk]},$$scope:{ctx:e}}}),{c(){Zt(t.$$.fragment)},m(i,r){jt(t,i,r),n=!0},p(i,[r]){const l={};r&1&&(l.data=i[0]),r&2&&(l.$$scope={dirty:r,ctx:i}),t.$set(l)},i(i){n||(mt(t.$$.fragment,i),n=!0)},o(i){xt(t.$$.fragment,i),n=!1},d(i){qt(t,i)}}}const Fm=10;function wk(e,t,n){let i;return Se(e,ax,r=>n(0,i=r)),[i]}class Sk extends nn{constructor(t){super(),en(this,t,wk,xk,He,{})}}function Ek(e){let t,n,i;return{c(){t=ge("Undo ("),n=ge(e[1]),i=ge(")")},m(r,l){Ct(r,t,l),Ct(r,n,l),Ct(r,i,l)},p(r,l){l&2&&zi(n,r[1])},d(r){r&&(It(t),It(n),It(i))}}}function Ik(e){let t;return{c(){t=ge("Undo")},m(n,i){Ct(n,t,i)},p:Ie,d(n){n&&It(t)}}}function Ck(e){let t,n,i,r,l,f;function a(S,L){return S[1]==0?Ik:Ek}let _=a(e),x=_(e);return{c(){t=wt("button"),x.c(),i=Xt(),r=wt("ul"),r.innerHTML=`<li><b>Click</b>
    the map to add points</li> <li><b>Click and drag</b>
    any point to move it</li> <li><b>Click</b>
    a waypoint to delete it</li> <li>Press <b>Control+Z</b>
    to undo your last change</li> <li>Press <b>Enter</b>
    or
    <b>double click</b>
    to finish</li> <li>Press <b>Escape</b>
    to cancel</li>`,t.disabled=n=e[1]==0},m(S,L){Ct(S,t,L),x.m(t,null),Ct(S,i,L),Ct(S,r,L),l||(f=Ze(t,"click",e[2]),l=!0)},p(S,[L]){_===(_=a(S))&&x?x.p(S,L):(x.d(1),x=_(S),x&&(x.c(),x.m(t,null))),L&2&&n!==(n=S[1]==0)&&(t.disabled=n)},i:Ie,o:Ie,d(S){S&&(It(t),It(i),It(r)),x.d(),l=!1,f()}}}function Tk(e,t,n){let i;Se(e,lx,f=>n(1,i=f));let{route_tool:r}=t;const l=()=>r.undo();return e.$$set=f=>{"route_tool"in f&&n(0,r=f.route_tool)},[r,i,l]}class Lk extends nn{constructor(t){super(),en(this,t,Tk,Ck,He,{route_tool:0})}}function Mk(e){let t;return{c(){t=ge("Choose study area")},m(n,i){Ct(n,t,i)},d(n){n&&It(t)}}}function Pk(e){let t;return{c(){t=ge("Pick neighbourhood")},m(n,i){Ct(n,t,i)},d(n){n&&It(t)}}}function kk(e){let t;return{c(){t=wt("li"),t.textContent="Creating new neighbourhood boundary"},m(n,i){Ct(n,t,i)},p:Ie,i:Ie,o:Ie,d(n){n&&It(t)}}}function Ak(e){let t,n,i,r,l;return n=new xi({props:{$$slots:{default:[Nk]},$$scope:{ctx:e}}}),n.$on("click",e[8]),{c(){t=wt("li"),Zt(n.$$.fragment),i=Xt(),r=wt("li"),r.textContent="Changing neighbourhood boundary"},m(f,a){Ct(f,t,a),jt(n,t,null),Ct(f,i,a),Ct(f,r,a),l=!0},p(f,a){const _={};a&1024&&(_.$$scope={dirty:a,ctx:f}),n.$set(_)},i(f){l||(mt(n.$$.fragment,f),l=!0)},o(f){xt(n.$$.fragment,f),l=!1},d(f){f&&(It(t),It(i),It(r)),qt(n)}}}function Nk(e){let t;return{c(){t=ge("Editing modal filters")},m(n,i){Ct(n,t,i)},d(n){n&&It(t)}}}function Dk(e){let t,n,i,r,l,f,a,_,x,S,L,A;l=new xi({props:{$$slots:{default:[Mk]},$$scope:{ctx:e}}}),l.$on("click",e[6]),_=new xi({props:{$$slots:{default:[Pk]},$$scope:{ctx:e}}}),_.$on("click",e[7]);const P=[Ak,kk],O=[];function B(U,Y){return U[1]?0:1}return S=B(e),L=O[S]=P[S](e),{c(){t=wt("div"),n=wt("nav"),i=wt("ul"),r=wt("li"),Zt(l.$$.fragment),f=Xt(),a=wt("li"),Zt(_.$$.fragment),x=Xt(),L.c(),Rt(n,"aria-label","breadcrumb"),Rt(t,"slot","top")},m(U,Y){Ct(U,t,Y),dt(t,n),dt(n,i),dt(i,r),jt(l,r,null),dt(i,f),dt(i,a),jt(_,a,null),dt(i,x),O[S].m(i,null),A=!0},p(U,Y){const V={};Y&1024&&(V.$$scope={dirty:Y,ctx:U}),l.$set(V);const $={};Y&1024&&($.$$scope={dirty:Y,ctx:U}),_.$set($);let K=S;S=B(U),S===K?O[S].p(U,Y):(ci(),xt(O[K],1,1,()=>{O[K]=null}),hi(),L=O[S],L?L.p(U,Y):(L=O[S]=P[S](U),L.c()),mt(L,1),L.m(i,null))},i(U){A||(mt(l.$$.fragment,U),mt(_.$$.fragment,U),mt(L),A=!0)},o(U){xt(l.$$.fragment,U),xt(_.$$.fragment,U),xt(L),A=!1},d(U){U&&It(t),qt(l),qt(_),O[S].d()}}}function Rk(e){let t;return{c(){t=ge("Finish")},m(n,i){Ct(n,t,i)},d(n){n&&It(t)}}}function Ok(e){let t;return{c(){t=ge("Cancel")},m(n,i){Ct(n,t,i)},d(n){n&&It(t)}}}function zk(e){let t,n,i,r,l,f,a,_,x,S,L,A,P,O;return a=new xi({props:{$$slots:{default:[Rk]},$$scope:{ctx:e}}}),a.$on("click",e[5]),x=new xi({props:{$$slots:{default:[Ok]},$$scope:{ctx:e}}}),x.$on("click",e[4]),P=new Lk({props:{route_tool:ui(e[2])}}),{c(){t=wt("div"),n=wt("h1"),i=ge("Draw your neighbourhood boundary for "),r=ge(e[0]),l=Xt(),f=wt("div"),Zt(a.$$.fragment),_=Xt(),Zt(x.$$.fragment),S=Xt(),L=wt("p"),L.textContent="TODO: maybe move the instructions from the previous screen to here...",A=Xt(),Zt(P.$$.fragment),gi(f,"display","flex"),gi(f,"justify-content","space-between"),Rt(t,"slot","sidebar")},m(B,U){Ct(B,t,U),dt(t,n),dt(n,i),dt(n,r),dt(t,l),dt(t,f),jt(a,f,null),dt(f,_),jt(x,f,null),dt(t,S),dt(t,L),dt(t,A),jt(P,t,null),O=!0},p(B,U){(!O||U&1)&&zi(r,B[0]);const Y={};U&1024&&(Y.$$scope={dirty:U,ctx:B}),a.$set(Y);const V={};U&1024&&(V.$$scope={dirty:U,ctx:B}),x.$set(V);const $={};U&4&&($.route_tool=ui(B[2])),P.$set($)},i(B){O||(mt(a.$$.fragment,B),mt(x.$$.fragment,B),mt(P.$$.fragment,B),O=!0)},o(B){xt(a.$$.fragment,B),xt(x.$$.fragment,B),xt(P.$$.fragment,B),O=!1},d(B){B&&It(t),qt(a),qt(x),qt(P)}}}function Fk(e){let t,n,i;return n=new Sk({}),{c(){t=wt("div"),Zt(n.$$.fragment),Rt(t,"slot","map")},m(r,l){Ct(r,t,l),jt(n,t,null),i=!0},p:Ie,i(r){i||(mt(n.$$.fragment,r),i=!0)},o(r){xt(n.$$.fragment,r),i=!1},d(r){r&&It(t),qt(n)}}}function Bk(e){let t,n;return t=new Wu({props:{$$slots:{map:[Fk],sidebar:[zk],top:[Dk]},$$scope:{ctx:e}}}),{c(){Zt(t.$$.fragment)},m(i,r){jt(t,i,r),n=!0},p(i,[r]){const l={};r&1039&&(l.$$scope={dirty:r,ctx:i}),t.$set(l)},i(i){n||(mt(t.$$.fragment,i),n=!0)},o(i){xt(t.$$.fragment,i),n=!1},d(i){qt(t,i)}}}function Vk(e,t,n){let i,r,l;Se(e,qp,P=>n(2,i=P)),Se(e,xn,P=>n(3,r=P)),Se(e,Wo,P=>n(9,l=P));let{name:f}=t,{existing:a}=t;a?i.editExistingArea(a):i.startArea();function _(){a?je(xn,r={mode:"neighbourhood"},r):je(xn,r={mode:"network"},r),i.clearEventListeners()}i.addEventListenerSuccess(P=>{try{l.setNeighbourhoodBoundary(f,P),l.setCurrentNeighbourhood(f),je(xn,r={mode:"neighbourhood"},r),i.clearEventListeners()}catch{window.alert("Known georust bug hit, sorry. You may need to just refresh the page now."),_()}}),i.addEventListenerFailure(_);const x=()=>ui(i).finish(),S=()=>je(xn,r={mode:"title"},r),L=()=>je(xn,r={mode:"network"},r),A=()=>je(xn,r={mode:"neighbourhood"},r);return e.$$set=P=>{"name"in P&&n(0,f=P.name),"existing"in P&&n(1,a=P.existing)},[f,a,i,r,_,x,S,L,A]}class Uk extends nn{constructor(t){super(),en(this,t,Vk,Bk,He,{name:0,existing:1})}}function Gk(e){let t,n,i,r,l,f;const a=[Vr("edit-polygon-fill"),{filter:Cw},{paint:{"fill-color":"red","fill-opacity":["case",["boolean",["get","hover"],"false"],1,.5]}}];let _={};for(let P=0;P<a.length;P+=1)_=Tr(_,a[P]);t=new af({props:_});const x=[Vr("edit-polygon-lines"),{filter:Tw},{paint:{"line-color":"black","line-width":8,"line-opacity":.5}}];let S={};for(let P=0;P<x.length;P+=1)S=Tr(S,x[P]);i=new ru({props:S});const L=[Vr("edit-polygon-vertices"),{filter:Lw},{paint:{"circle-color":"black","circle-opacity":["case",["has","hovered"],1,.5],"circle-radius":10}}];let A={};for(let P=0;P<L.length;P+=1)A=Tr(A,L[P]);return l=new hd({props:A}),{c(){Zt(t.$$.fragment),n=Xt(),Zt(i.$$.fragment),r=Xt(),Zt(l.$$.fragment)},m(P,O){jt(t,P,O),Ct(P,n,O),jt(i,P,O),Ct(P,r,O),jt(l,P,O),f=!0},p(P,O){const B={};t.$set(B);const U={};i.$set(U);const Y={};l.$set(Y)},i(P){f||(mt(t.$$.fragment,P),mt(i.$$.fragment,P),mt(l.$$.fragment,P),f=!0)},o(P){xt(t.$$.fragment,P),xt(i.$$.fragment,P),xt(l.$$.fragment,P),f=!1},d(P){P&&(It(n),It(r)),qt(t,P),qt(i,P),qt(l,P)}}}function jk(e){let t,n;return t=new Ps({props:{data:e[0],$$slots:{default:[Gk]},$$scope:{ctx:e}}}),{c(){Zt(t.$$.fragment)},m(i,r){jt(t,i,r),n=!0},p(i,[r]){const l={};r&1&&(l.data=i[0]),r&2&&(l.$$scope={dirty:r,ctx:i}),t.$set(l)},i(i){n||(mt(t.$$.fragment,i),n=!0)},o(i){xt(t.$$.fragment,i),n=!1},d(i){qt(t,i)}}}function qk(e,t,n){let i;return Se(e,Ew,r=>n(0,i=r)),[i]}class Zk extends nn{constructor(t){super(),en(this,t,qk,jk,He,{})}}function Mb(e){let t,n;return t=new Ky({props:{$$slots:{default:[$k,({dialog:i})=>({3:i}),({dialog:i})=>i?8:0]},$$scope:{ctx:e}}}),t.$on("close",e[2]),{c(){Zt(t.$$.fragment)},m(i,r){jt(t,i,r),n=!0},p(i,r){const l={};r&24&&(l.$$scope={dirty:r,ctx:i}),t.$set(l)},i(i){n||(mt(t.$$.fragment,i),n=!0)},o(i){xt(t.$$.fragment,i),n=!1},d(i){qt(t,i)}}}function $k(e){let t,n,i,r,l,f,a,_,x,S,L,A,P,O;function B(){return e[1](e[3])}return{c(){t=wt("h1"),t.textContent="The Low-traffic neighbourhood (LTN) tool, v2",n=Xt(),i=wt("p"),i.innerHTML=`This is an <b>experimental</b>
      version of the
      <a href="https://a-b-street.github.io/docs/software/ltn/index.html" target="_blank">A/B Street LTN tool</a>
      . Most parts of it do not work yet, and you should probably use the other version
      of the tool instead.`,r=Xt(),l=wt("p"),l.textContent="To use this tool, you need to:",f=Xt(),a=wt("ol"),a.innerHTML=`<li>Choose your study area to analyze</li> <li>Define one or more neighbourhood boundaries</li> <li>Optionally, fix the basemap data on existing modal filters, turn
        restrictions, one-ways, etc</li> <li>Create one or more proposals with new modal filters, and explore their
        effects</li>`,_=Xt(),x=wt("p"),x.innerHTML=`This tool is created by <a href="https://github.com/dabreegster/" target="_blank">Dustin Carlino</a>
      and relies heavily on
      <a href="https://www.openstreetmap.org/about" target="_blank">OpenStreetMap</a>
      data.`,S=Xt(),L=wt("center"),A=wt("button"),A.textContent="Start!"},m(U,Y){Ct(U,t,Y),Ct(U,n,Y),Ct(U,i,Y),Ct(U,r,Y),Ct(U,l,Y),Ct(U,f,Y),Ct(U,a,Y),Ct(U,_,Y),Ct(U,x,Y),Ct(U,S,Y),Ct(U,L,Y),dt(L,A),P||(O=Ze(A,"click",B),P=!0)},p(U,Y){e=U},d(U){U&&(It(t),It(n),It(i),It(r),It(l),It(f),It(a),It(_),It(x),It(S),It(L)),P=!1,O()}}}function Wk(e){let t,n,i=e[0]&&Mb(e);return{c(){i&&i.c(),t=ts()},m(r,l){i&&i.m(r,l),Ct(r,t,l),n=!0},p(r,[l]){r[0]?i?(i.p(r,l),l&1&&mt(i,1)):(i=Mb(r),i.c(),mt(i,1),i.m(t.parentNode,t)):i&&(ci(),xt(i,1,1,()=>{i=null}),hi())},i(r){n||(mt(i),n=!0)},o(r){xt(i),n=!1},d(r){r&&It(t),i&&i.d(r)}}}function Xk(e,t,n){let i;return Se(e,Hm,f=>n(0,i=f)),[i,f=>ui(f).close(),()=>je(Hm,i=!1,i)]}class Hk extends nn{constructor(t){super(),en(this,t,Xk,Wk,He,{})}}function Pb(e,t,n){const i=e.slice();return i[22]=t[n][0],i[23]=t[n][1],i}function kb(e,t,n){const i=e.slice();return i[26]=t[n][0],i[27]=t[n][1],i}function Ab(e){let t,n=e[27]+"",i,r;return{c(){t=wt("option"),i=ge(n),t.__value=r=e[26],ql(t,t.__value)},m(l,f){Ct(l,t,f),dt(t,i)},p(l,f){f&4&&n!==(n=l[27]+"")&&zi(i,n),f&4&&r!==(r=l[26])&&(t.__value=r,ql(t,t.__value))},d(l){l&&It(t)}}}function Nb(e){let t,n,i=la(e[23]),r=[];for(let l=0;l<i.length;l+=1)r[l]=Ab(kb(e,i,l));return{c(){t=wt("optgroup");for(let l=0;l<r.length;l+=1)r[l].c();Rt(t,"label",n=e[22])},m(l,f){Ct(l,t,f);for(let a=0;a<r.length;a+=1)r[a]&&r[a].m(t,null)},p(l,f){if(f&4){i=la(l[23]);let a;for(a=0;a<i.length;a+=1){const _=kb(l,i,a);r[a]?r[a].p(_,f):(r[a]=Ab(_),r[a].c(),r[a].m(t,null))}for(;a<r.length;a+=1)r[a].d(1);r.length=i.length}f&4&&n!==(n=l[22])&&Rt(t,"label",n)},d(l){l&&It(t),ud(r,l)}}}function Yk(e){let t,n,i,r,l,f,a,_,x,S,L,A,P,O,B,U,Y,V,$;t=new hw({props:{msg:e[1]}});let K=la(e[2]),it=[];for(let ft=0;ft<K.length;ft+=1)it[ft]=Nb(Pb(e,K,ft));return U=new lM({props:{map:e[5]}}),U.$on("gotXml",e[7]),U.$on("loading",e[12]),U.$on("error",e[13]),{c(){Zt(t.$$.fragment),n=Xt(),i=wt("label"),r=ge(`Load an example:
  `),l=wt("select"),f=wt("option"),f.textContent="Custom file loaded";for(let ft=0;ft<it.length;ft+=1)it[ft].c();a=Xt(),_=wt("i"),_.textContent="or...",x=Xt(),S=wt("label"),L=ge(`Load an osm.xml or a .pbf file:
  `),A=wt("input"),P=Xt(),O=wt("i"),O.textContent="or...",B=Xt(),Zt(U.$$.fragment),f.__value="",ql(f,f.__value),e[4]===void 0&&jp(()=>e[9].call(l)),Rt(A,"type","file")},m(ft,pt){jt(t,ft,pt),Ct(ft,n,pt),Ct(ft,i,pt),dt(i,r),dt(i,l),dt(l,f);for(let gt=0;gt<it.length;gt+=1)it[gt]&&it[gt].m(l,null);$m(l,e[4],!0),Ct(ft,a,pt),Ct(ft,_,pt),Ct(ft,x,pt),Ct(ft,S,pt),dt(S,L),dt(S,A),e[11](A),Ct(ft,P,pt),Ct(ft,O,pt),Ct(ft,B,pt),jt(U,ft,pt),Y=!0,V||($=[Ze(l,"change",e[9]),Ze(l,"change",e[10]),Ze(A,"change",e[6])],V=!0)},p(ft,[pt]){const gt={};if(pt&2&&(gt.msg=ft[1]),t.$set(gt),pt&4){K=la(ft[2]);let St;for(St=0;St<K.length;St+=1){const _t=Pb(ft,K,St);it[St]?it[St].p(_t,pt):(it[St]=Nb(_t),it[St].c(),it[St].m(l,null))}for(;St<it.length;St+=1)it[St].d(1);it.length=K.length}pt&20&&$m(l,ft[4]);const ut={};pt&32&&(ut.map=ft[5]),U.$set(ut)},i(ft){Y||(mt(t.$$.fragment,ft),mt(U.$$.fragment,ft),Y=!0)},o(ft){xt(t.$$.fragment,ft),xt(U.$$.fragment,ft),Y=!1},d(ft){ft&&(It(n),It(i),It(a),It(_),It(x),It(S),It(P),It(O),It(B)),qt(t,ft),ud(it,ft),e[11](null),qt(U,ft),V=!1,No($)}}}function Kk(e,t,n){let i,r,l,f,a,_,x;Se(e,Wo,ut=>n(15,i=ut)),Se(e,Pu,ut=>n(4,r=ut)),Se(e,Km,ut=>n(16,l=ut)),Se(e,Ym,ut=>n(17,f=ut)),Se(e,Du,ut=>n(5,a=ut)),Se(e,qp,ut=>n(18,_=ut)),Se(e,xn,ut=>n(19,x=ut));let S=null,L=!1,A=[];dg(async()=>{try{let ut=await fetch("/osm/areas.json");if(ut.ok)L=!0,console.log("Using local cache, not od2net.org"),n(2,A=await ut.json());else{let St=await fetch("https://assets.od2net.org/severance_pbfs/areas.json");n(2,A=await St.json())}}catch{}});let P;async function O(ut){try{B(await P.files[0].arrayBuffer()),je(Pu,r="",r)}catch(St){window.alert(`Couldn't open this file: ${St}`)}n(1,S=null)}function B(ut){n(1,S="Building map model from OSM input"),console.time("load"),je(Wo,i=new HS(new Uint8Array(ut),r==""?void 0:r),i),console.timeEnd("load");let St=`ltn_${r||"custom"}.geojson`,_t=window.localStorage.getItem(St);if(_t)try{i.loadSavefile(JSON.parse(_t))}catch(vt){console.log(`Didn't restore from local storage ${St}: ${vt}`)}je(xn,x={mode:"network"},x),je(qp,_=new gI(a,i.toRouteSnapper()),_),a.fitBounds(Array.from(i.getBounds()),{animate:!1}),je(Ym,f=$(),f),je(Km,l=$(),l)}function U(ut){try{B(new TextEncoder().encode(ut.detail)),je(Pu,r="",r)}catch(St){window.alert(`Couldn't import from Overpass: ${St}`)}n(1,S=null)}async function Y(ut){ut!=""&&(L?await V(`/osm/${ut}.pbf`):await V(`https://assets.od2net.org/severance_pbfs/${ut}.pbf`))}async function V(ut){try{n(1,S=`Downloading ${ut}`);let St=await fetch(ut);B(await St.arrayBuffer())}catch(St){window.alert(`Couldn't open from URL ${ut}: ${St}`)}n(1,S=null)}function $(){let ut=i.getBounds(),St=ut[0]+Math.random()*(ut[2]-ut[0]),_t=ut[1]+Math.random()*(ut[3]-ut[1]);return new mg.LngLat(St,_t)}function K(){r=Gb(this),Pu.set(r),n(2,A)}const it=()=>Y(r);function ft(ut){cr[ut?"unshift":"push"](()=>{P=ut,n(3,P)})}return[Y,S,A,P,r,a,O,U,B,K,it,ft,ut=>n(1,S=ut.detail),ut=>window.alert(ut.detail)]}class Jk extends nn{constructor(t){super(),en(this,t,Kk,Yk,He,{loadMap:8,loadExample:0})}get loadMap(){return this.$$.ctx[8]}get loadExample(){return this.$$.ctx[0]}}function Qk(e){let t;return{c(){t=wt("div"),t.innerHTML='<nav aria-label="breadcrumb"><ul><li>Choose study area</li></ul></nav>',Rt(t,"slot","top")},m(n,i){Ct(n,t,i)},p:Ie,d(n){n&&It(t)}}}function Db(e){let t,n,i,r,l;return{c(){t=wt("label"),n=ge(`Load a project from a file
        `),i=wt("input"),Rt(i,"type","file")},m(f,a){Ct(f,t,a),dt(t,n),dt(t,i),e[7](i),r||(l=Ze(i,"change",e[5]),r=!0)},p:Ie,d(f){f&&It(t),e[7](null),r=!1,l()}}}function tA(e){let t;return{c(){t=wt("p"),t.textContent="Waiting for MapLibre and WASM to load..."},m(n,i){Ct(n,t,i)},p:Ie,i:Ie,o:Ie,d(n){n&&It(t)}}}function eA(e){let t,n,i={};return t=new Jk({props:i}),e[8](t),{c(){Zt(t.$$.fragment)},m(r,l){jt(t,r,l),n=!0},p(r,l){const f={};t.$set(f)},i(r){n||(mt(t.$$.fragment,r),n=!0)},o(r){xt(t.$$.fragment,r),n=!1},d(r){e[8](null),qt(t,r)}}}function nA(e){let t,n,i,r,l,f,a,_,x,S,L,A,P;n=new Hk({});let O=e[1]&&Db(e);const B=[eA,tA],U=[];function Y(V,$){return V[4]&&V[0]?0:1}return x=Y(e),S=U[x]=B[x](e),{c(){t=wt("div"),Zt(n.$$.fragment),i=Xt(),r=wt("button"),r.textContent="About the LTN tool",l=Xt(),O&&O.c(),f=Xt(),a=wt("hr"),_=Xt(),S.c(),Rt(t,"slot","sidebar")},m(V,$){Ct(V,t,$),jt(n,t,null),dt(t,i),dt(t,r),dt(t,l),O&&O.m(t,null),dt(t,f),dt(t,a),dt(t,_),U[x].m(t,null),L=!0,A||(P=Ze(r,"click",e[6]),A=!0)},p(V,$){V[1]?O?O.p(V,$):(O=Db(V),O.c(),O.m(t,f)):O&&(O.d(1),O=null);let K=x;x=Y(V),x===K?U[x].p(V,$):(ci(),xt(U[K],1,1,()=>{U[K]=null}),hi(),S=U[x],S?S.p(V,$):(S=U[x]=B[x](V),S.c()),mt(S,1),S.m(t,null))},i(V){L||(mt(n.$$.fragment,V),mt(S),L=!0)},o(V){xt(n.$$.fragment,V),xt(S),L=!1},d(V){V&&It(t),qt(n),O&&O.d(),U[x].d(),A=!1,P()}}}function iA(e){let t,n,i;return n=new Zk({}),{c(){t=wt("div"),Zt(n.$$.fragment),Rt(t,"slot","map")},m(r,l){Ct(r,t,l),jt(n,t,null),i=!0},p:Ie,i(r){i||(mt(n.$$.fragment,r),i=!0)},o(r){xt(n.$$.fragment,r),i=!1},d(r){r&&It(t),qt(n)}}}function rA(e){let t,n;return t=new Wu({props:{$$slots:{map:[iA],sidebar:[nA],top:[Qk]},$$scope:{ctx:e}}}),{c(){Zt(t.$$.fragment)},m(i,r){jt(t,i,r),n=!0},p(i,[r]){const l={};r&4127&&(l.$$scope={dirty:r,ctx:i}),t.$set(l)},i(i){n||(mt(t.$$.fragment,i),n=!0)},o(i){xt(t.$$.fragment,i),n=!1},d(i){qt(t,i)}}}function oA(e,t,n){let i,r,l,f,a;Se(e,Pu,B=>n(9,i=B)),Se(e,qp,B=>n(10,r=B)),Se(e,Wo,B=>n(11,l=B)),Se(e,Hm,B=>n(3,f=B)),Se(e,Du,B=>n(4,a=B));let{wasmReady:_}=t;je(Wo,l=null,l),je(qp,r=null,r);let x,S;async function L(B){try{let U=JSON.parse(await S.files[0].text());if(U.study_area_name)je(Pu,i=U.study_area_name,i),window.localStorage.setItem(`ltn_${U.study_area_name}.geojson`,JSON.stringify(U)),await x.loadExample(U.study_area_name);else{je(Pu,i="",i);let Y=U.features.find(K=>K.properties.kind=="study_area_boundary"),$=await(await fetch(Pw(Y))).arrayBuffer();window.localStorage.setItem("ltn_custom.geojson",JSON.stringify(U)),x.loadMap($)}}catch(U){window.alert(`Couldn't open this file: ${U}`)}}const A=()=>je(Hm,f=!0,f);function P(B){cr[B?"unshift":"push"](()=>{S=B,n(2,S)})}function O(B){cr[B?"unshift":"push"](()=>{x=B,n(1,x)})}return e.$$set=B=>{"wasmReady"in B&&n(0,_=B.wasmReady)},[_,x,S,f,a,L,A,P,O]}class sA extends nn{constructor(t){super(),en(this,t,oA,rA,He,{wasmReady:0})}}const{window:aA}=PS;function lA(e){let t;return{c(){t=ge("Choose study area")},m(n,i){Ct(n,t,i)},d(n){n&&It(t)}}}function uA(e){let t;return{c(){t=ge("Pick neighbourhood")},m(n,i){Ct(n,t,i)},d(n){n&&It(t)}}}function cA(e){let t;return{c(){t=ge("Editing modal filters")},m(n,i){Ct(n,t,i)},d(n){n&&It(t)}}}function hA(e){let t,n,i,r,l,f,a,_,x,S,L,A,P,O;return l=new xi({props:{$$slots:{default:[lA]},$$scope:{ctx:e}}}),l.$on("click",e[9]),_=new xi({props:{$$slots:{default:[uA]},$$scope:{ctx:e}}}),_.$on("click",e[10]),L=new xi({props:{$$slots:{default:[cA]},$$scope:{ctx:e}}}),L.$on("click",e[5]),{c(){t=wt("div"),n=wt("nav"),i=wt("ul"),r=wt("li"),Zt(l.$$.fragment),f=Xt(),a=wt("li"),Zt(_.$$.fragment),x=Xt(),S=wt("li"),Zt(L.$$.fragment),A=Xt(),P=wt("li"),P.textContent="Viewing shortcuts",Rt(n,"aria-label","breadcrumb"),Rt(t,"slot","top")},m(B,U){Ct(B,t,U),dt(t,n),dt(n,i),dt(i,r),jt(l,r,null),dt(i,f),dt(i,a),jt(_,a,null),dt(i,x),dt(i,S),jt(L,S,null),dt(i,A),dt(i,P),O=!0},p(B,U){const Y={};U&8192&&(Y.$$scope={dirty:U,ctx:B}),l.$set(Y);const V={};U&8192&&(V.$$scope={dirty:U,ctx:B}),_.$set(V);const $={};U&8192&&($.$$scope={dirty:U,ctx:B}),L.$set($)},i(B){O||(mt(l.$$.fragment,B),mt(_.$$.fragment,B),mt(L.$$.fragment,B),O=!0)},o(B){xt(l.$$.fragment,B),xt(_.$$.fragment,B),xt(L.$$.fragment,B),O=!1},d(B){B&&It(t),qt(l),qt(_),qt(L)}}}function fA(e){let t,n,i,r,l,f,a,_,x,S=e[0].shortcutIndex+1+"",L,A,P=e[0].gj.features.length+"",O,B,U,Y,V,$,K,it,ft,pt=ui(e[0].gj.features[e[0].shortcutIndex].properties).directness.toFixed(1)+"",gt,ut,St,_t,vt;return{c(){t=wt("p"),t.textContent=`This shows all possible shortcuts crossing the blue road you've chosen.
        A shortcut is defined as a route starting and ending outside the
        neighbourhood, but cutting through it. It might not actually be
        considered a "good shortcut" in practice -- this tool doesn't know any
        real traffic patterns; it's just looking for any possible path. This
        view lets you understand the limits of this assumption.`,n=Xt(),i=wt("button"),i.textContent="Pick a different road",r=Xt(),l=wt("div"),f=wt("button"),a=ge("Previous"),x=Xt(),L=ge(S),A=ge(" / "),O=ge(P),B=Xt(),U=wt("button"),Y=ge("Next"),$=Xt(),K=wt("p"),it=ge("This shortcut is "),ft=wt("b"),gt=ge(pt),ut=ge("x"),St=ge(`
        the length of the shortest route using all roads, not just this neighbourhood`),f.disabled=_=e[0].shortcutIndex==0,U.disabled=V=e[0].shortcutIndex==e[0].gj.features.length-1,gi(l,"display","flex"),gi(l,"justify-content","space-between")},m(ee,kt){Ct(ee,t,kt),Ct(ee,n,kt),Ct(ee,i,kt),Ct(ee,r,kt),Ct(ee,l,kt),dt(l,f),dt(f,a),dt(l,x),dt(l,L),dt(l,A),dt(l,O),dt(l,B),dt(l,U),dt(U,Y),Ct(ee,$,kt),Ct(ee,K,kt),dt(K,it),dt(K,ft),dt(ft,gt),dt(ft,ut),dt(K,St),_t||(vt=[Ze(i,"click",e[8]),Ze(f,"click",e[6]),Ze(U,"click",e[7])],_t=!0)},p(ee,kt){kt&1&&_!==(_=ee[0].shortcutIndex==0)&&(f.disabled=_),kt&1&&S!==(S=ee[0].shortcutIndex+1+"")&&zi(L,S),kt&1&&P!==(P=ee[0].gj.features.length+"")&&zi(O,P),kt&1&&V!==(V=ee[0].shortcutIndex==ee[0].gj.features.length-1)&&(U.disabled=V),kt&1&&pt!==(pt=ui(ee[0].gj.features[ee[0].shortcutIndex].properties).directness.toFixed(1)+"")&&zi(gt,pt)},d(ee){ee&&(It(t),It(n),It(i),It(r),It(l),It($),It(K)),_t=!1,No(vt)}}}function pA(e){let t;return{c(){t=wt("p"),t.textContent="Click a road to see shortcuts"},m(n,i){Ct(n,t,i)},p:Ie,d(n){n&&It(t)}}}function dA(e){let t,n,i,r;n=new Ng({}),n.$on("click",e[5]);function l(_,x){if(_[0].state=="neutral")return pA;if(_[0].state=="chose-road")return fA}let f=l(e),a=f&&f(e);return{c(){t=wt("div"),Zt(n.$$.fragment),i=Xt(),a&&a.c(),Rt(t,"slot","sidebar")},m(_,x){Ct(_,t,x),jt(n,t,null),dt(t,i),a&&a.m(t,null),r=!0},p(_,x){f===(f=l(_))&&a?a.p(_,x):(a&&a.d(1),a=f&&f(_),a&&(a.c(),a.m(t,null)))},i(_){r||(mt(n.$$.fragment,_),r=!0)},o(_){xt(n.$$.fragment,_),r=!1},d(_){_&&It(t),qt(n),a&&a.d()}}}function mA(e){let t,n,i,r,l,f;return t=new Ps({props:{data:Ty(JSON.parse(ui(e[2]).renderNeighbourhood())),$$slots:{default:[_A]},$$scope:{ctx:e}}}),i=new Ps({props:{data:e[0].gj.features[e[0].shortcutIndex],$$slots:{default:[yA]},$$scope:{ctx:e}}}),l=new Ps({props:{data:e[0].roadGj,$$slots:{default:[vA]},$$scope:{ctx:e}}}),{c(){Zt(t.$$.fragment),n=Xt(),Zt(i.$$.fragment),r=Xt(),Zt(l.$$.fragment)},m(a,_){jt(t,a,_),Ct(a,n,_),jt(i,a,_),Ct(a,r,_),jt(l,a,_),f=!0},p(a,_){const x={};_&4&&(x.data=Ty(JSON.parse(ui(a[2]).renderNeighbourhood()))),_&8192&&(x.$$scope={dirty:_,ctx:a}),t.$set(x);const S={};_&1&&(S.data=a[0].gj.features[a[0].shortcutIndex]),_&8192&&(S.$$scope={dirty:_,ctx:a}),i.$set(S);const L={};_&1&&(L.data=a[0].roadGj),_&8192&&(L.$$scope={dirty:_,ctx:a}),l.$set(L)},i(a){f||(mt(t.$$.fragment,a),mt(i.$$.fragment,a),mt(l.$$.fragment,a),f=!0)},o(a){xt(t.$$.fragment,a),xt(i.$$.fragment,a),xt(l.$$.fragment,a),f=!1},d(a){a&&(It(n),It(r)),qt(t,a),qt(i,a),qt(l,a)}}}function gA(e){let t,n;return t=new Dg({props:{gjInput:JSON.parse(ui(e[2]).renderNeighbourhood()),onClickLine:e[3],$$slots:{"line-popup":[xA]},$$scope:{ctx:e}}}),{c(){Zt(t.$$.fragment)},m(i,r){jt(t,i,r),n=!0},p(i,r){const l={};r&4&&(l.gjInput=JSON.parse(ui(i[2]).renderNeighbourhood())),r&8192&&(l.$$scope={dirty:r,ctx:i}),t.$set(l)},i(i){n||(mt(t.$$.fragment,i),n=!0)},o(i){xt(t.$$.fragment,i),n=!1},d(i){qt(t,i)}}}function _A(e){let t,n;const i=[Vr("cells"),{filter:["==",["get","kind"],"cell"]},{paint:{"fill-color":["get","color"],"fill-opacity":.3}}];let r={};for(let l=0;l<i.length;l+=1)r=Tr(r,i[l]);return t=new af({props:r}),{c(){Zt(t.$$.fragment)},m(l,f){jt(t,l,f),n=!0},p(l,f){const a={};t.$set(a)},i(l){n||(mt(t.$$.fragment,l),n=!0)},o(l){xt(t.$$.fragment,l),n=!1},d(l){qt(t,l)}}}function yA(e){let t,n;const i=[Vr("shortcuts"),{paint:{"line-width":5,"line-color":"red"}}];let r={};for(let l=0;l<i.length;l+=1)r=Tr(r,i[l]);return t=new ru({props:r}),{c(){Zt(t.$$.fragment)},m(l,f){jt(t,l,f),n=!0},p(l,f){const a={};t.$set(a)},i(l){n||(mt(t.$$.fragment,l),n=!0)},o(l){xt(t.$$.fragment,l),n=!1},d(l){qt(t,l)}}}function vA(e){let t,n;const i=[Vr("shortcuts-focus"),{paint:{"line-width":5,"line-color":"blue"}}];let r={};for(let l=0;l<i.length;l+=1)r=Tr(r,i[l]);return t=new ru({props:r}),{c(){Zt(t.$$.fragment)},m(l,f){jt(t,l,f),n=!0},p(l,f){const a={};t.$set(a)},i(l){n||(mt(t.$$.fragment,l),n=!0)},o(l){xt(t.$$.fragment,l),n=!1},d(l){qt(t,l)}}}function bA(e){let t,n=e[12].shortcuts+"",i,r,l=(e[12].name??"unnamed road")+"",f;return{c(){t=wt("p"),i=ge(n),r=ge(" shortcuts through "),f=ge(l)},m(a,_){Ct(a,t,_),dt(t,i),dt(t,r),dt(t,f)},p(a,_){_&4096&&n!==(n=a[12].shortcuts+"")&&zi(i,n),_&4096&&l!==(l=(a[12].name??"unnamed road")+"")&&zi(f,l)},d(a){a&&It(t)}}}function xA(e){let t,n,i;return n=new wl({props:{openOn:"hover",$$slots:{default:[bA,({props:r})=>({12:r}),({props:r})=>r?4096:0]},$$scope:{ctx:e}}}),{c(){t=wt("div"),Zt(n.$$.fragment),Rt(t,"slot","line-popup")},m(r,l){Ct(r,t,l),jt(n,t,null),i=!0},p(r,l){const f={};l&12288&&(f.$$scope={dirty:l,ctx:r}),n.$set(f)},i(r){i||(mt(n.$$.fragment,r),i=!0)},o(r){xt(n.$$.fragment,r),i=!1},d(r){r&&It(t),qt(n)}}}function wA(e){let t,n,i,r,l,f;const a=[gA,mA],_=[];function x(S,L){return S[0].state=="neutral"?0:S[0].state=="chose-road"?1:-1}return~(n=x(e))&&(i=_[n]=a[n](e)),l=new Rg({}),{c(){t=wt("div"),i&&i.c(),r=Xt(),Zt(l.$$.fragment),Rt(t,"slot","map")},m(S,L){Ct(S,t,L),~n&&_[n].m(t,null),dt(t,r),jt(l,t,null),f=!0},p(S,L){let A=n;n=x(S),n===A?~n&&_[n].p(S,L):(i&&(ci(),xt(_[A],1,1,()=>{_[A]=null}),hi()),~n?(i=_[n],i?i.p(S,L):(i=_[n]=a[n](S),i.c()),mt(i,1),i.m(t,r)):i=null)},i(S){f||(mt(i),mt(l.$$.fragment,S),f=!0)},o(S){xt(i),xt(l.$$.fragment,S),f=!1},d(S){S&&It(t),~n&&_[n].d(),qt(l)}}}function SA(e){let t,n,i,r;return t=new Wu({props:{$$slots:{map:[wA],sidebar:[dA],top:[hA]},$$scope:{ctx:e}}}),{c(){Zt(t.$$.fragment)},m(l,f){jt(t,l,f),n=!0,i||(r=Ze(aA,"keydown",e[4]),i=!0)},p(l,[f]){const a={};f&8199&&(a.$$scope={dirty:f,ctx:l}),t.$set(a)},i(l){n||(mt(t.$$.fragment,l),n=!0)},o(l){xt(t.$$.fragment,l),n=!1},d(l){qt(t,l),i=!1,r()}}}function EA(e,t,n){let i,r,l;Se(e,xn,B=>n(1,i=B)),Se(e,Du,B=>n(11,r=B)),Se(e,Wo,B=>n(2,l=B));let f={state:"neutral"};function a(B){let U=JSON.parse(l.getShortcutsCrossingRoad(B.properties.id));if(U.features.length==0){window.alert("No shortcuts here");return}n(0,f={state:"chose-road",roadGj:B,gj:U,shortcutIndex:0})}dg(()=>{r==null||r.keyboard.disable()}),aa(()=>{r==null||r.keyboard.enable()});function _(B){f.state=="chose-road"&&(B.key=="ArrowLeft"&&f.shortcutIndex>0&&(B.stopPropagation(),n(0,f.shortcutIndex--,f)),B.key=="ArrowRight"&&(B.stopPropagation(),f.shortcutIndex!=f.gj.features.length-1&&n(0,f.shortcutIndex++,f)))}function x(){je(xn,i={mode:"neighbourhood"},i)}function S(){f.state=="chose-road"&&n(0,f.shortcutIndex--,f)}function L(){f.state=="chose-road"&&n(0,f.shortcutIndex++,f)}return[f,i,l,a,_,x,S,L,()=>n(0,f={state:"neutral"}),()=>je(xn,i={mode:"title"},i),()=>je(xn,i={mode:"network"},i)]}class IA extends nn{constructor(t){super(),en(this,t,EA,SA,He,{})}}function CA(e){let t,n,i,r,l,f,a,_;return l=new vk({}),{c(){t=wt("div"),n=wt("img"),r=Xt(),Zt(l.$$.fragment),f=Xt(),a=wt("span"),hr(n.src,i=GS)||Rt(n,"src",i),gi(n,"height","8vh"),gi(n,"margin-right","20px"),Rt(n,"alt","A/B Street logo"),gi(a,"width","100%"),Rt(t,"slot","top"),gi(t,"display","flex")},m(x,S){Ct(x,t,S),dt(t,n),dt(t,r),jt(l,t,null),dt(t,f),dt(t,a),e[16](a),_=!0},p:Ie,i(x){_||(mt(l.$$.fragment,x),_=!0)},o(x){xt(l.$$.fragment,x),_=!1},d(x){x&&It(t),qt(l),e[16](null)}}}function Rb(e){let t,n,i;return{c(){t=wt("button"),t.textContent="Zoom to fit study area",Rt(t,"class","secondary")},m(r,l){Ct(r,t,l),n||(i=Ze(t,"click",e[8]),n=!0)},p:Ie,d(r){r&&It(t),n=!1,i()}}}function TA(e){let t,n,i,r,l,f=e[5]&&Rb(e);return{c(){t=wt("div"),n=wt("div"),i=Xt(),r=wt("hr"),l=Xt(),f&&f.c(),Rt(t,"slot","left")},m(a,_){Ct(a,t,_),dt(t,n),e[15](n),dt(t,i),dt(t,r),dt(t,l),f&&f.m(t,null)},p(a,_){a[5]?f?f.p(a,_):(f=Rb(a),f.c(),f.m(t,null)):f&&(f.d(1),f=null)},d(a){a&&It(t),e[15](null),f&&f.d()}}}function Ob(e){let t,n;return t=new sA({props:{wasmReady:e[4]}}),{c(){Zt(t.$$.fragment)},m(i,r){jt(t,i,r),n=!0},p(i,r){const l={};r&16&&(l.wasmReady=i[4]),t.$set(l)},i(i){n||(mt(t.$$.fragment,i),n=!0)},o(i){xt(t.$$.fragment,i),n=!1},d(i){qt(t,i)}}}function zb(e){let t,n,i,r,l,f;t=new Ps({props:{data:JSON.parse(e[5].getInvertedBoundary()),$$slots:{default:[LA]},$$scope:{ctx:e}}});const a=[RA,DA,NA,AA,kA,PA,MA],_=[];function x(S,L){return S[7].mode=="network"?0:S[7].mode=="set-boundary"?1:S[7].mode=="neighbourhood"?2:S[7].mode=="view-shortcuts"?3:S[7].mode=="route"?4:S[7].mode=="debug"?5:S[7].mode=="debug-gj"?6:-1}return~(i=x(e))&&(r=_[i]=a[i](e)),{c(){Zt(t.$$.fragment),n=Xt(),r&&r.c(),l=ts()},m(S,L){jt(t,S,L),Ct(S,n,L),~i&&_[i].m(S,L),Ct(S,l,L),f=!0},p(S,L){const A={};L&32&&(A.data=JSON.parse(S[5].getInvertedBoundary())),L&262144&&(A.$$scope={dirty:L,ctx:S}),t.$set(A);let P=i;i=x(S),i===P?~i&&_[i].p(S,L):(r&&(ci(),xt(_[P],1,1,()=>{_[P]=null}),hi()),~i?(r=_[i],r?r.p(S,L):(r=_[i]=a[i](S),r.c()),mt(r,1),r.m(l.parentNode,l)):r=null)},i(S){f||(mt(t.$$.fragment,S),mt(r),f=!0)},o(S){xt(t.$$.fragment,S),xt(r),f=!1},d(S){S&&(It(n),It(l)),qt(t,S),~i&&_[i].d(S)}}}function LA(e){let t,n;const i=[Vr("boundary"),{paint:{"fill-color":"black","fill-opacity":.3}}];let r={};for(let l=0;l<i.length;l+=1)r=Tr(r,i[l]);return t=new af({props:r}),{c(){Zt(t.$$.fragment)},m(l,f){jt(t,l,f),n=!0},p(l,f){const a={};t.$set(a)},i(l){n||(mt(t.$$.fragment,l),n=!0)},o(l){xt(t.$$.fragment,l),n=!1},d(l){qt(t,l)}}}function MA(e){let t,n;return t=new lP({}),{c(){Zt(t.$$.fragment)},m(i,r){jt(t,i,r),n=!0},p:Ie,i(i){n||(mt(t.$$.fragment,i),n=!0)},o(i){xt(t.$$.fragment,i),n=!1},d(i){qt(t,i)}}}function PA(e){let t,n;return t=new YM({}),{c(){Zt(t.$$.fragment)},m(i,r){jt(t,i,r),n=!0},p:Ie,i(i){n||(mt(t.$$.fragment,i),n=!0)},o(i){xt(t.$$.fragment,i),n=!1},d(i){qt(t,i)}}}function kA(e){let t,n;return t=new dk({props:{prevMode:e[7].prevMode}}),{c(){Zt(t.$$.fragment)},m(i,r){jt(t,i,r),n=!0},p(i,r){const l={};r&128&&(l.prevMode=i[7].prevMode),t.$set(l)},i(i){n||(mt(t.$$.fragment,i),n=!0)},o(i){xt(t.$$.fragment,i),n=!1},d(i){qt(t,i)}}}function AA(e){let t,n;return t=new IA({}),{c(){Zt(t.$$.fragment)},m(i,r){jt(t,i,r),n=!0},p:Ie,i(i){n||(mt(t.$$.fragment,i),n=!0)},o(i){xt(t.$$.fragment,i),n=!1},d(i){qt(t,i)}}}function NA(e){let t,n;return t=new GP({}),{c(){Zt(t.$$.fragment)},m(i,r){jt(t,i,r),n=!0},p:Ie,i(i){n||(mt(t.$$.fragment,i),n=!0)},o(i){xt(t.$$.fragment,i),n=!1},d(i){qt(t,i)}}}function DA(e){let t,n;return t=new Uk({props:{name:e[7].name,existing:e[7].existing}}),{c(){Zt(t.$$.fragment)},m(i,r){jt(t,i,r),n=!0},p(i,r){const l={};r&128&&(l.name=i[7].name),r&128&&(l.existing=i[7].existing),t.$set(l)},i(i){n||(mt(t.$$.fragment,i),n=!0)},o(i){xt(t.$$.fragment,i),n=!1},d(i){qt(t,i)}}}function RA(e){let t,n;return t=new nk({}),{c(){Zt(t.$$.fragment)},m(i,r){jt(t,i,r),n=!0},p:Ie,i(i){n||(mt(t.$$.fragment,i),n=!0)},o(i){xt(t.$$.fragment,i),n=!1},d(i){qt(t,i)}}}function OA(e){let t,n,i,r,l,f,a;t=new tL({});let _=e[7].mode=="title"&&Ob(e),x=e[5]&&zb(e);return{c(){Zt(t.$$.fragment),n=Xt(),i=wt("div"),r=Xt(),_&&_.c(),l=Xt(),x&&x.c(),f=ts()},m(S,L){jt(t,S,L),Ct(S,n,L),Ct(S,i,L),e[12](i),Ct(S,r,L),_&&_.m(S,L),Ct(S,l,L),x&&x.m(S,L),Ct(S,f,L),a=!0},p(S,L){S[7].mode=="title"?_?(_.p(S,L),L&128&&mt(_,1)):(_=Ob(S),_.c(),mt(_,1),_.m(l.parentNode,l)):_&&(ci(),xt(_,1,1,()=>{_=null}),hi()),S[5]?x?(x.p(S,L),L&32&&mt(x,1)):(x=zb(S),x.c(),mt(x,1),x.m(f.parentNode,f)):x&&(ci(),xt(x,1,1,()=>{x=null}),hi())},i(S){a||(mt(t.$$.fragment,S),mt(_),mt(x),a=!0)},o(S){xt(t.$$.fragment,S),xt(_),xt(x),a=!1},d(S){S&&(It(n),It(i),It(r),It(l),It(f)),qt(t,S),e[12](null),_&&_.d(S),x&&x.d(S)}}}function zA(e){let t,n,i,r;function l(a){e[13](a)}let f={style:e[6],standardControls:!0,hash:!0,images:[{id:"walk_cycle_only",url:"/ltn//filters/walk_cycle_only_icon.gif"},{id:"no_entry",url:"/ltn//filters/no_entry_icon.gif"},{id:"bus_gate",url:"/ltn//filters/bus_gate_icon.gif"},{id:"school_street",url:"/ltn//filters/school_street_icon.gif"}],$$slots:{default:[OA]},$$scope:{ctx:e}};return e[0]!==void 0&&(f.map=e[0]),n=new $E({props:f}),cr.push(()=>vc(n,"map",l)),n.$on("error",e[14]),{c(){t=wt("div"),Zt(n.$$.fragment),Rt(t,"slot","main"),gi(t,"position","relative"),gi(t,"width","100%"),gi(t,"height","100%")},m(a,_){Ct(a,t,_),jt(n,t,null),r=!0},p(a,_){const x={};_&64&&(x.style=a[6]),_&262328&&(x.$$scope={dirty:_,ctx:a}),!i&&_&1&&(i=!0,x.map=a[0],yc(()=>i=!1)),n.$set(x)},i(a){r||(mt(n.$$.fragment,a),r=!0)},o(a){xt(n.$$.fragment,a),r=!1},d(a){a&&It(t),qt(n)}}}function FA(e){let t,n;return t=new sL({props:{$$slots:{main:[zA],left:[TA],top:[CA]},$$scope:{ctx:e}}}),{c(){Zt(t.$$.fragment)},m(i,r){jt(t,i,r),n=!0},p(i,[r]){const l={};r&262399&&(l.$$scope={dirty:r,ctx:i}),t.$set(l)},i(i){n||(mt(t.$$.fragment,i),n=!0)},o(i){xt(t.$$.fragment,i),n=!1},d(i){qt(t,i)}}}function BA(e,t,n){let i,r,l,f,a,_,x;Se(e,ay,it=>n(9,i=it)),Se(e,sy,it=>n(10,r=it)),Se(e,oy,it=>n(11,l=it)),Se(e,Wo,it=>n(5,f=it)),Se(e,Du,it=>n(17,a=it)),Se(e,ux,it=>n(6,_=it)),Se(e,xn,it=>n(7,x=it));let S=!1;dg(async()=>{await Yb(),await Jb(),n(4,S=!0)});let L;function A(){a.fitBounds(Array.from(f.getBounds()),{animate:!1})}let P,O,B;function U(it){cr[it?"unshift":"push"](()=>{B=it,n(3,B),n(9,i)})}function Y(it){L=it,n(0,L)}const V=it=>{console.log(it.detail.error)};function $(it){cr[it?"unshift":"push"](()=>{O=it,n(2,O),n(10,r)})}function K(it){cr[it?"unshift":"push"](()=>{P=it,n(1,P),n(11,l)})}return e.$$.update=()=>{e.$$.dirty&1&&L&&Du.set(L),e.$$.dirty&2050&&P&&l&&(n(1,P.innerHTML="",P),P.appendChild(l)),e.$$.dirty&1028&&O&&r&&(n(2,O.innerHTML="",O),O.appendChild(r)),e.$$.dirty&520&&B&&i&&(n(3,B.innerHTML="",B),B.appendChild(i))},[L,P,O,B,S,f,_,x,A,i,r,l,U,Y,V,$,K]}class VA extends nn{constructor(t){super(),en(this,t,BA,FA,He,{})}}new VA({target:document.getElementById("app")});
